cscope 15 /home/bharathi/Downloads/kernel_692/linux-6.9.2/drivers/net/wireless/intel/iwlwifi               0003797319
	@cfg/1000.c

8 
	~<löux/moduÀ.h
>

9 
	~<löux/°rögify.h
>

10 
	~"iwl-c⁄fig.h
"

11 
	~"iwl-agn-hw.h
"

14 
	#IWL1000_UCODE_API_MAX
 5

	)

15 
	#IWL100_UCODE_API_MAX
 5

	)

18 
	#IWL1000_UCODE_API_MIN
 1

	)

19 
	#IWL100_UCODE_API_MIN
 5

	)

22 
	#EEPROM_1000_TX_POWER_VERSION
 (4)

	)

23 
	#EEPROM_1000_EEPROM_VERSION
 (0x15C)

	)

25 
	#IWL1000_FW_PRE
 "iwlwifi-1000"

	)

26 
	#IWL1000_MODULE_FIRMWARE
(
≠i
Ë
IWL1000_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

28 
	#IWL100_FW_PRE
 "iwlwifi-100"

	)

29 
	#IWL100_MODULE_FIRMWARE
(
≠i
Ë
IWL100_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

32 c⁄° 
iwl_ba£_∑øms
 
	giwl1000_ba£_∑øms
 = {

33 .
num_of_queues
 = 
IWLAGN_NUM_QUEUES
,

34 .
	gmax_tfd_queue_size
 = 256,

35 .
	gì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_2K
,

36 .
	g∂l_cfg
 = 
åue
,

37 .
	gmax_Œ_ôems
 = 
OTP_MAX_LL_ITEMS_1000
,

38 .
	gshadow_øm_suµ‹t
 = 
Ál£
,

39 .
	gÀd_com≥nßti⁄
 = 51,

40 .
	gwd_timeout
 = 
IWL_WATCHDOG_DISABLED
,

41 .
	gmax_evít_log_size
 = 128,

42 .
	gscd_chaö_ext_wa
 = 
åue
,

45 c⁄° 
iwl_ht_∑øms
 
	giwl1000_ht_∑øms
 = {

46 .
ht_gªífõld_suµ‹t
 = 
åue
,

47 .
	gu£_πs_f‹_aggªg©i⁄
 = 
åue
,

48 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
),

51 c⁄° 
iwl_ì¥om_∑øms
 
	giwl1000_ì¥om_∑øms
 = {

52 .
ªguœt‹y_b™ds
 = {

53 
EEPROM_REG_BAND_1_CHANNELS
,

54 
EEPROM_REG_BAND_2_CHANNELS
,

55 
EEPROM_REG_BAND_3_CHANNELS
,

56 
EEPROM_REG_BAND_4_CHANNELS
,

57 
EEPROM_REG_BAND_5_CHANNELS
,

58 
EEPROM_REG_BAND_24_HT40_CHANNELS
,

59 
EEPROM_REGULATORY_BAND_NO_HT40
,

63 
	#IWL_DEVICE_1000
 \

64 .
fw_«me_¥e
 = 
IWL1000_FW_PRE
, \

65 .
ucode_≠i_max
 = 
IWL1000_UCODE_API_MAX
, \

66 .
ucode_≠i_mö
 = 
IWL1000_UCODE_API_MIN
, \

67 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_1000
, \

68 .
max_ö°_size
 = 
IWLAGN_RTC_INST_SIZE
, \

69 .
max_d©a_size
 = 
IWLAGN_RTC_DATA_SIZE
, \

70 .
nvm_vî
 = 
EEPROM_1000_EEPROM_VERSION
, \

71 .
nvm_ˇlib_vî
 = 
EEPROM_1000_TX_POWER_VERSION
, \

72 .
å™s
.
ba£_∑øms
 = &
iwl1000_ba£_∑øms
, \

73 .
ì¥om_∑øms
 = &
iwl1000_ì¥om_∑øms
, \

74 .
Àd_mode
 = 
IWL_LED_BLINK


	)

76 c⁄° 
iwl_cfg
 
	giwl1000_bgn_cfg
 = {

77 .
«me
 = "Intel(R) Centrino(R) Wireless-N 1000 BGN",

78 
	gIWL_DEVICE_1000
,

79 .
	ght_∑øms
 = &
iwl1000_ht_∑øms
,

82 c⁄° 
iwl_cfg
 
	giwl1000_bg_cfg
 = {

83 .
«me
 = "Intel(R) Centrino(R) Wireless-N 1000 BG",

84 
	gIWL_DEVICE_1000
,

87 
	#IWL_DEVICE_100
 \

88 .
fw_«me_¥e
 = 
IWL100_FW_PRE
, \

89 .
ucode_≠i_max
 = 
IWL100_UCODE_API_MAX
, \

90 .
ucode_≠i_mö
 = 
IWL100_UCODE_API_MIN
, \

91 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_100
, \

92 .
max_ö°_size
 = 
IWLAGN_RTC_INST_SIZE
, \

93 .
max_d©a_size
 = 
IWLAGN_RTC_DATA_SIZE
, \

94 .
nvm_vî
 = 
EEPROM_1000_EEPROM_VERSION
, \

95 .
nvm_ˇlib_vî
 = 
EEPROM_1000_TX_POWER_VERSION
, \

96 .
å™s
.
ba£_∑øms
 = &
iwl1000_ba£_∑øms
, \

97 .
ì¥om_∑øms
 = &
iwl1000_ì¥om_∑øms
, \

98 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

99 .
rx_wôh_siso_divîsôy
 = 
åue


	)

101 c⁄° 
iwl_cfg
 
	giwl100_bgn_cfg
 = {

102 .
«me
 = "Intel(R) Centrino(R) Wireless-N 100 BGN",

103 
	gIWL_DEVICE_100
,

104 .
	ght_∑øms
 = &
iwl1000_ht_∑øms
,

107 c⁄° 
iwl_cfg
 
	giwl100_bg_cfg
 = {

108 .
«me
 = "Intel(R) Centrino(R) Wireless-N 100 BG",

109 
	gIWL_DEVICE_100
,

112 
MODULE_FIRMWARE
(
IWL1000_MODULE_FIRMWARE
(
IWL1000_UCODE_API_MAX
));

113 
MODULE_FIRMWARE
(
IWL100_MODULE_FIRMWARE
(
IWL100_UCODE_API_MAX
));

	@cfg/2000.c

8 
	~<löux/moduÀ.h
>

9 
	~<löux/°rögify.h
>

10 
	~"iwl-c⁄fig.h
"

11 
	~"iwl-agn-hw.h
"

12 
	~"dvm/comm™ds.h
"

15 
	#IWL2030_UCODE_API_MAX
 6

	)

16 
	#IWL2000_UCODE_API_MAX
 6

	)

17 
	#IWL105_UCODE_API_MAX
 6

	)

18 
	#IWL135_UCODE_API_MAX
 6

	)

21 
	#IWL2030_UCODE_API_MIN
 5

	)

22 
	#IWL2000_UCODE_API_MIN
 5

	)

23 
	#IWL105_UCODE_API_MIN
 5

	)

24 
	#IWL135_UCODE_API_MIN
 5

	)

27 
	#EEPROM_2000_TX_POWER_VERSION
 (6)

	)

28 
	#EEPROM_2000_EEPROM_VERSION
 (0x805)

	)

31 
	#IWL2030_FW_PRE
 "iwlwifi-2030"

	)

32 
	#IWL2030_MODULE_FIRMWARE
(
≠i
Ë
IWL2030_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

34 
	#IWL2000_FW_PRE
 "iwlwifi-2000"

	)

35 
	#IWL2000_MODULE_FIRMWARE
(
≠i
Ë
IWL2000_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

37 
	#IWL105_FW_PRE
 "iwlwifi-105"

	)

38 
	#IWL105_MODULE_FIRMWARE
(
≠i
Ë
IWL105_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

40 
	#IWL135_FW_PRE
 "iwlwifi-135"

	)

41 
	#IWL135_MODULE_FIRMWARE
(
≠i
Ë
IWL135_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

43 c⁄° 
iwl_ba£_∑øms
 
	giwl2000_ba£_∑øms
 = {

44 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_2K
,

45 .
	gnum_of_queues
 = 
IWLAGN_NUM_QUEUES
,

46 .
	gmax_tfd_queue_size
 = 256,

47 .
	gmax_Œ_ôems
 = 
OTP_MAX_LL_ITEMS_2x00
,

48 .
	gshadow_øm_suµ‹t
 = 
åue
,

49 .
	gÀd_com≥nßti⁄
 = 51,

50 .
	gwd_timeout
 = 
IWL_DEF_WD_TIMEOUT
,

51 .
	gmax_evít_log_size
 = 512,

52 .
	gshadow_ªg_íabÀ
 = 
Ál£
,

53 .
	gscd_chaö_ext_wa
 = 
åue
,

57 c⁄° 
iwl_ba£_∑øms
 
	giwl2030_ba£_∑øms
 = {

58 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_2K
,

59 .
	gnum_of_queues
 = 
IWLAGN_NUM_QUEUES
,

60 .
	gmax_tfd_queue_size
 = 256,

61 .
	gmax_Œ_ôems
 = 
OTP_MAX_LL_ITEMS_2x00
,

62 .
	gshadow_øm_suµ‹t
 = 
åue
,

63 .
	gÀd_com≥nßti⁄
 = 57,

64 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

65 .
	gmax_evít_log_size
 = 512,

66 .
	gshadow_ªg_íabÀ
 = 
Ál£
,

67 .
	gscd_chaö_ext_wa
 = 
åue
,

70 c⁄° 
iwl_ht_∑øms
 
	giwl2000_ht_∑øms
 = {

71 .
ht_gªífõld_suµ‹t
 = 
åue
,

72 .
	gu£_πs_f‹_aggªg©i⁄
 = 
åue
,

73 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
),

76 c⁄° 
iwl_ì¥om_∑øms
 
	giwl20x0_ì¥om_∑øms
 = {

77 .
ªguœt‹y_b™ds
 = {

78 
EEPROM_REG_BAND_1_CHANNELS
,

79 
EEPROM_REG_BAND_2_CHANNELS
,

80 
EEPROM_REG_BAND_3_CHANNELS
,

81 
EEPROM_REG_BAND_4_CHANNELS
,

82 
EEPROM_REG_BAND_5_CHANNELS
,

83 
EEPROM_6000_REG_BAND_24_HT40_CHANNELS
,

84 
EEPROM_REGULATORY_BAND_NO_HT40
,

86 .
	gíh™˚d_txpowî
 = 
åue
,

89 
	#IWL_DEVICE_2000
 \

90 .
fw_«me_¥e
 = 
IWL2000_FW_PRE
, \

91 .
ucode_≠i_max
 = 
IWL2000_UCODE_API_MAX
, \

92 .
ucode_≠i_mö
 = 
IWL2000_UCODE_API_MIN
, \

93 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_2000
, \

94 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

95 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

96 .
nvm_vî
 = 
EEPROM_2000_EEPROM_VERSION
, \

97 .
nvm_ˇlib_vî
 = 
EEPROM_2000_TX_POWER_VERSION
, \

98 .
å™s
.
ba£_∑øms
 = &
iwl2000_ba£_∑øms
, \

99 .
ì¥om_∑øms
 = &
iwl20x0_ì¥om_∑øms
, \

100 .
Àd_mode
 = 
IWL_LED_RF_STATE


	)

103 c⁄° 
iwl_cfg
 
	giwl2000_2bgn_cfg
 = {

104 .
«me
 = "Intel(R) Centrino(R) Wireless-N 2200 BGN",

105 
	gIWL_DEVICE_2000
,

106 .
	ght_∑øms
 = &
iwl2000_ht_∑øms
,

109 c⁄° 
iwl_cfg
 
	giwl2000_2bgn_d_cfg
 = {

110 .
«me
 = "Intel(R) Centrino(R) Wireless-N 2200D BGN",

111 
	gIWL_DEVICE_2000
,

112 .
	ght_∑øms
 = &
iwl2000_ht_∑øms
,

115 
	#IWL_DEVICE_2030
 \

116 .
fw_«me_¥e
 = 
IWL2030_FW_PRE
, \

117 .
ucode_≠i_max
 = 
IWL2030_UCODE_API_MAX
, \

118 .
ucode_≠i_mö
 = 
IWL2030_UCODE_API_MIN
, \

119 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_2030
, \

120 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

121 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

122 .
nvm_vî
 = 
EEPROM_2000_EEPROM_VERSION
, \

123 .
nvm_ˇlib_vî
 = 
EEPROM_2000_TX_POWER_VERSION
, \

124 .
å™s
.
ba£_∑øms
 = &
iwl2030_ba£_∑øms
, \

125 .
ì¥om_∑øms
 = &
iwl20x0_ì¥om_∑øms
, \

126 .
Àd_mode
 = 
IWL_LED_RF_STATE


	)

128 c⁄° 
iwl_cfg
 
	giwl2030_2bgn_cfg
 = {

129 .
«me
 = "Intel(R) Centrino(R) Wireless-N 2230 BGN",

130 
	gIWL_DEVICE_2030
,

131 .
	ght_∑øms
 = &
iwl2000_ht_∑øms
,

134 
	#IWL_DEVICE_105
 \

135 .
fw_«me_¥e
 = 
IWL105_FW_PRE
, \

136 .
ucode_≠i_max
 = 
IWL105_UCODE_API_MAX
, \

137 .
ucode_≠i_mö
 = 
IWL105_UCODE_API_MIN
, \

138 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_105
, \

139 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

140 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

141 .
nvm_vî
 = 
EEPROM_2000_EEPROM_VERSION
, \

142 .
nvm_ˇlib_vî
 = 
EEPROM_2000_TX_POWER_VERSION
, \

143 .
å™s
.
ba£_∑øms
 = &
iwl2000_ba£_∑øms
, \

144 .
ì¥om_∑øms
 = &
iwl20x0_ì¥om_∑øms
, \

145 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

146 .
rx_wôh_siso_divîsôy
 = 
åue


	)

148 c⁄° 
iwl_cfg
 
	giwl105_bgn_cfg
 = {

149 .
«me
 = "Intel(R) Centrino(R) Wireless-N 105 BGN",

150 
	gIWL_DEVICE_105
,

151 .
	ght_∑øms
 = &
iwl2000_ht_∑øms
,

154 c⁄° 
iwl_cfg
 
	giwl105_bgn_d_cfg
 = {

155 .
«me
 = "Intel(R) Centrino(R) Wireless-N 105D BGN",

156 
	gIWL_DEVICE_105
,

157 .
	ght_∑øms
 = &
iwl2000_ht_∑øms
,

160 
	#IWL_DEVICE_135
 \

161 .
fw_«me_¥e
 = 
IWL135_FW_PRE
, \

162 .
ucode_≠i_max
 = 
IWL135_UCODE_API_MAX
, \

163 .
ucode_≠i_mö
 = 
IWL135_UCODE_API_MIN
, \

164 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_135
, \

165 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

166 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

167 .
nvm_vî
 = 
EEPROM_2000_EEPROM_VERSION
, \

168 .
nvm_ˇlib_vî
 = 
EEPROM_2000_TX_POWER_VERSION
, \

169 .
å™s
.
ba£_∑øms
 = &
iwl2030_ba£_∑øms
, \

170 .
ì¥om_∑øms
 = &
iwl20x0_ì¥om_∑øms
, \

171 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

172 .
rx_wôh_siso_divîsôy
 = 
åue


	)

174 c⁄° 
iwl_cfg
 
	giwl135_bgn_cfg
 = {

175 .
«me
 = "Intel(R) Centrino(R) Wireless-N 135 BGN",

176 
	gIWL_DEVICE_135
,

177 .
	ght_∑øms
 = &
iwl2000_ht_∑øms
,

180 
MODULE_FIRMWARE
(
IWL2000_MODULE_FIRMWARE
(
IWL2000_UCODE_API_MAX
));

181 
MODULE_FIRMWARE
(
IWL2030_MODULE_FIRMWARE
(
IWL2030_UCODE_API_MAX
));

182 
MODULE_FIRMWARE
(
IWL105_MODULE_FIRMWARE
(
IWL105_UCODE_API_MAX
));

183 
MODULE_FIRMWARE
(
IWL135_MODULE_FIRMWARE
(
IWL135_UCODE_API_MAX
));

	@cfg/22000.c

6 
	~<löux/moduÀ.h
>

7 
	~<löux/°rögify.h
>

8 
	~"iwl-c⁄fig.h
"

9 
	~"iwl-¥ph.h
"

10 
	~"fw/≠i/txq.h
"

13 
	#IWL_22000_UCODE_API_MAX
 77

	)

16 
	#IWL_22000_UCODE_API_MIN
 50

	)

19 
	#IWL_22000_NVM_VERSION
 0x0a1d

	)

22 
	#IWL_22000_DCCM_OFFSET
 0x800000

	)

23 
	#IWL_22000_DCCM_LEN
 0x10000

	)

24 
	#IWL_22000_DCCM2_OFFSET
 0x880000

	)

25 
	#IWL_22000_DCCM2_LEN
 0x8000

	)

26 
	#IWL_22000_SMEM_OFFSET
 0x400000

	)

27 
	#IWL_22000_SMEM_LEN
 0xD0000

	)

29 
	#IWL_QU_B_HR_B_FW_PRE
 "iwlwifi-Qu-b0-hr-b0"

	)

30 
	#IWL_QU_C_HR_B_FW_PRE
 "iwlwifi-Qu-c0-hr-b0"

	)

31 
	#IWL_QU_B_JF_B_FW_PRE
 "iwlwifi-Qu-b0-jf-b0"

	)

32 
	#IWL_QU_C_JF_B_FW_PRE
 "iwlwifi-Qu-c0-jf-b0"

	)

33 
	#IWL_QUZ_A_HR_B_FW_PRE
 "iwlwifi-QuZ-a0-hr-b0"

	)

34 
	#IWL_QUZ_A_JF_B_FW_PRE
 "iwlwifi-QuZ-a0-jf-b0"

	)

35 
	#IWL_CC_A_FW_PRE
 "iwlwifi-cc-a0"

	)

37 
	#IWL_QU_B_HR_B_MODULE_FIRMWARE
(
≠i
) \

38 
IWL_QU_B_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

39 
	#IWL_QUZ_A_HR_B_MODULE_FIRMWARE
(
≠i
) \

40 
IWL_QUZ_A_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

41 
	#IWL_QUZ_A_JF_B_MODULE_FIRMWARE
(
≠i
) \

42 
IWL_QUZ_A_JF_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

43 
	#IWL_QU_C_HR_B_MODULE_FIRMWARE
(
≠i
) \

44 
IWL_QU_C_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

45 
	#IWL_QU_B_JF_B_MODULE_FIRMWARE
(
≠i
) \

46 
IWL_QU_B_JF_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

47 
	#IWL_CC_A_MODULE_FIRMWARE
(
≠i
) \

48 
IWL_CC_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

50 c⁄° 
iwl_ba£_∑øms
 
	giwl_22000_ba£_∑øms
 = {

51 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_32K
,

52 .
	gnum_of_queues
 = 512,

53 .
	gmax_tfd_queue_size
 = 256,

54 .
	gshadow_øm_suµ‹t
 = 
åue
,

55 .
	gÀd_com≥nßti⁄
 = 57,

56 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

57 .
	gmax_evít_log_size
 = 512,

58 .
	gshadow_ªg_íabÀ
 = 
åue
,

59 .
	gpcõ_l1_Ælowed
 = 
åue
,

62 c⁄° 
iwl_ht_∑øms
 
	giwl_22000_ht_∑øms
 = {

63 .
°bc
 = 
åue
,

64 .
	gldpc
 = 
åue
,

65 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
) |

66 
BIT
(
NL80211_BAND_6GHZ
),

69 
	#IWL_DEVICE_22000_COMMON
 \

70 .
ucode_≠i_mö
 = 
IWL_22000_UCODE_API_MIN
, \

71 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

72 .
nvm_hw_£˘i⁄_num
 = 10, \

73 .
n⁄_sh¨ed_™t
 = 
ANT_B
, \

74 .
dccm_off£t
 = 
IWL_22000_DCCM_OFFSET
, \

75 .
dccm_Àn
 = 
IWL_22000_DCCM_LEN
, \

76 .
dccm2_off£t
 = 
IWL_22000_DCCM2_OFFSET
, \

77 .
dccm2_Àn
 = 
IWL_22000_DCCM2_LEN
, \

78 .
smem_off£t
 = 
IWL_22000_SMEM_OFFSET
, \

79 .
smem_Àn
 = 
IWL_22000_SMEM_LEN
, \

80 .
„©uªs
 = 
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
, \

81 .
≠mg_nŸ_suµ‹ãd
 = 
åue
, \

82 .
å™s
.
mq_rx_suµ‹ãd
 = 
åue
, \

83 .
vht_mu_mimo_suµ‹ãd
 = 
åue
, \

84 .
mac_addr_‰om_c§
 = 0x380, \

85 .
ht_∑øms
 = &
iwl_22000_ht_∑øms
, \

86 .
nvm_vî
 = 
IWL_22000_NVM_VERSION
, \

87 .
å™s
.
rf_id
 = 
åue
, \

88 .
å™s
.
gí2
 = 
åue
, \

89 .
nvm_ty≥
 = 
IWL_NVM_EXT
, \

90 .
dbgc_suµ‹ãd
 = 
åue
, \

91 .
mö_umac_îr‹_evít_èbÀ
 = 0x400000, \

92 .
d3_debug_d©a_ba£_addr
 = 0x401000, \

93 .
d3_debug_d©a_Àngth
 = 60 * 1024, \

94 .
m⁄_smem_ªgs
 = { \

95 .
wrôe_±r
 = { \

96 .
addr
 = 
LDBG_M2S_BUF_WPTR
, \

97 .
mask
 = 
LDBG_M2S_BUF_WPTR_VAL_MSK
, \

99 .
cy˛e_˙t
 = { \

100 .
addr
 = 
LDBG_M2S_BUF_WRAP_CNT
, \

101 .
mask
 = 
LDBG_M2S_BUF_WRAP_CNT_VAL_MSK
, \

103 }

	)

105 
	#IWL_DEVICE_22500
 \

106 
IWL_DEVICE_22000_COMMON
, \

107 .
ucode_≠i_max
 = 
IWL_22000_UCODE_API_MAX
, \

108 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_22000
, \

109 .
å™s
.
ba£_∑øms
 = &
iwl_22000_ba£_∑øms
, \

110 .
gp2_ªg_addr
 = 0xa02c68, \

111 .
m⁄_døm_ªgs
 = { \

112 .
wrôe_±r
 = { \

113 .
addr
 = 
MON_BUFF_WRPTR_VER2
, \

114 .
mask
 = 0xffffffff, \

116 .
cy˛e_˙t
 = { \

117 .
addr
 = 
MON_BUFF_CYCLE_CNT_VER2
, \

118 .
mask
 = 0xffffffff, \

120 }

	)

122 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_qu_å™s_cfg
 = {

123 .
mq_rx_suµ‹ãd
 = 
åue
,

124 .
	grf_id
 = 
åue
,

125 .
	ggí2
 = 
åue
,

126 .
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_22000
,

127 .
	gba£_∑øms
 = &
iwl_22000_ba£_∑øms
,

128 .
	göãgøãd
 = 
åue
,

129 .
	gxèl_œãncy
 = 500,

130 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_200US
,

133 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_qu_medium_œãncy_å™s_cfg
 = {

134 .
mq_rx_suµ‹ãd
 = 
åue
,

135 .
	grf_id
 = 
åue
,

136 .
	ggí2
 = 
åue
,

137 .
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_22000
,

138 .
	gba£_∑øms
 = &
iwl_22000_ba£_∑øms
,

139 .
	göãgøãd
 = 
åue
,

140 .
	gxèl_œãncy
 = 1820,

141 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_1820US
,

144 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_qu_l⁄g_œãncy_å™s_cfg
 = {

145 .
mq_rx_suµ‹ãd
 = 
åue
,

146 .
	grf_id
 = 
åue
,

147 .
	ggí2
 = 
åue
,

148 .
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_22000
,

149 .
	gba£_∑øms
 = &
iwl_22000_ba£_∑øms
,

150 .
	göãgøãd
 = 
åue
,

151 .
	gxèl_œãncy
 = 12000,

152 .
	glow_œãncy_xèl
 = 
åue
,

153 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_2500US
,

163 
	#IWL_NUM_RBDS_NON_HE
 512

	)

164 
	#IWL_NUM_RBDS_22000_HE
 2048

	)

171 c⁄° 
iwl_cfg
 
	giwl9560_qu_b0_jf_b0_cfg
 = {

172 .
fw_«me_¥e
 = 
IWL_QU_B_JF_B_FW_PRE
,

173 
	gIWL_DEVICE_22500
,

174 .
	gnum_rbds
 = 
IWL_NUM_RBDS_NON_HE
,

177 c⁄° 
iwl_cfg
 
	giwl9560_qu_c0_jf_b0_cfg
 = {

178 .
fw_«me_¥e
 = 
IWL_QU_C_JF_B_FW_PRE
,

179 
	gIWL_DEVICE_22500
,

180 .
	gnum_rbds
 = 
IWL_NUM_RBDS_NON_HE
,

183 c⁄° 
iwl_cfg
 
	giwl9560_quz_a0_jf_b0_cfg
 = {

184 .
fw_«me_¥e
 = 
IWL_QUZ_A_JF_B_FW_PRE
,

185 
	gIWL_DEVICE_22500
,

191 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

192 .
	gnum_rbds
 = 
IWL_NUM_RBDS_NON_HE
,

195 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_ax200_å™s_cfg
 = {

196 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_22000
,

197 .
	gba£_∑øms
 = &
iwl_22000_ba£_∑øms
,

198 .
	gmq_rx_suµ‹ãd
 = 
åue
,

199 .
	grf_id
 = 
åue
,

200 .
	ggí2
 = 
åue
,

201 .
	gbi§_w‹k¨ound
 = 1,

204 c⁄° 
	giwl_ax101_«me
[] = "Intel(R) Wi-Fi 6 AX101";

205 c⁄° 
	giwl_ax200_«me
[] = "Intel(R) Wi-Fi 6 AX200 160MHz";

206 c⁄° 
	giwl_ax201_«me
[] = "Intel(R) Wi-Fi 6 AX201 160MHz";

207 c⁄° 
	giwl_ax203_«me
[] = "Intel(R) Wi-Fi 6 AX203";

208 c⁄° 
	giwl_ax204_«me
[] = "Intel(R) Wi-Fi 6 AX204 160MHz";

210 c⁄° 
	giwl_ax200_kûÀr_1650w_«me
[] =

212 c⁄° 
	giwl_ax200_kûÀr_1650x_«me
[] =

214 c⁄° 
	giwl_ax201_kûÀr_1650s_«me
[] =

216 c⁄° 
	giwl_ax201_kûÀr_1650i_«me
[] =

219 c⁄° 
iwl_cfg
 
	giwl_qu_b0_hr1_b0
 = {

220 .
fw_«me_¥e
 = 
IWL_QU_B_HR_B_FW_PRE
,

221 
	gIWL_DEVICE_22500
,

227 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

228 .
	gtx_wôh_siso_divîsôy
 = 
åue
,

229 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

232 c⁄° 
iwl_cfg
 
	giwl_qu_b0_hr_b0
 = {

233 .
fw_«me_¥e
 = 
IWL_QU_B_HR_B_FW_PRE
,

234 
	gIWL_DEVICE_22500
,

240 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

241 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

244 c⁄° 
iwl_cfg
 
	giwl_ax201_cfg_qu_hr
 = {

245 .
«me
 = "Intel(R) Wi-Fi 6 AX201 160MHz",

246 .
	gfw_«me_¥e
 = 
IWL_QU_B_HR_B_FW_PRE
,

247 
	gIWL_DEVICE_22500
,

253 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

254 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

257 c⁄° 
iwl_cfg
 
	giwl_qu_c0_hr1_b0
 = {

258 .
fw_«me_¥e
 = 
IWL_QU_C_HR_B_FW_PRE
,

259 
	gIWL_DEVICE_22500
,

265 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

266 .
	gtx_wôh_siso_divîsôy
 = 
åue
,

267 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

270 c⁄° 
iwl_cfg
 
	giwl_qu_c0_hr_b0
 = {

271 .
fw_«me_¥e
 = 
IWL_QU_C_HR_B_FW_PRE
,

272 
	gIWL_DEVICE_22500
,

278 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

279 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

282 c⁄° 
iwl_cfg
 
	giwl_ax201_cfg_qu_c0_hr_b0
 = {

283 .
«me
 = "Intel(R) Wi-Fi 6 AX201 160MHz",

284 .
	gfw_«me_¥e
 = 
IWL_QU_C_HR_B_FW_PRE
,

285 
	gIWL_DEVICE_22500
,

291 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

292 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

295 c⁄° 
iwl_cfg
 
	giwl_quz_a0_hr1_b0
 = {

296 .
fw_«me_¥e
 = 
IWL_QUZ_A_HR_B_FW_PRE
,

297 
	gIWL_DEVICE_22500
,

303 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

304 .
	gtx_wôh_siso_divîsôy
 = 
åue
,

305 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

308 c⁄° 
iwl_cfg
 
	giwl_ax201_cfg_quz_hr
 = {

309 .
«me
 = "Intel(R) Wi-Fi 6 AX201 160MHz",

310 .
	gfw_«me_¥e
 = 
IWL_QUZ_A_HR_B_FW_PRE
,

311 
	gIWL_DEVICE_22500
,

317 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

318 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

321 c⁄° 
iwl_cfg
 
	giwl_ax1650s_cfg_quz_hr
 = {

322 .
«me
 = "Killer(R) Wi-Fi 6 AX1650s 160MHz Wireless Network Adapter (201D2W)",

323 .
	gfw_«me_¥e
 = 
IWL_QUZ_A_HR_B_FW_PRE
,

324 
	gIWL_DEVICE_22500
,

330 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

331 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

334 c⁄° 
iwl_cfg
 
	giwl_ax1650i_cfg_quz_hr
 = {

335 .
«me
 = "Killer(R) Wi-Fi 6 AX1650i 160MHz Wireless Network Adapter (201NGW)",

336 .
	gfw_«me_¥e
 = 
IWL_QUZ_A_HR_B_FW_PRE
,

337 
	gIWL_DEVICE_22500
,

343 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

344 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

347 c⁄° 
iwl_cfg
 
	giwl_ax200_cfg_cc
 = {

348 .
fw_«me_¥e
 = 
IWL_CC_A_FW_PRE
,

349 
	gIWL_DEVICE_22500
,

355 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

356 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

359 c⁄° 
iwl_cfg
 
	gkûÀr1650s_2ax_cfg_qu_b0_hr_b0
 = {

360 .
«me
 = "Killer(R) Wi-Fi 6 AX1650s 160MHz Wireless Network Adapter (201NGW)",

361 .
	gfw_«me_¥e
 = 
IWL_QU_B_HR_B_FW_PRE
,

362 
	gIWL_DEVICE_22500
,

368 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

369 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

372 c⁄° 
iwl_cfg
 
	gkûÀr1650i_2ax_cfg_qu_b0_hr_b0
 = {

373 .
«me
 = "Killer(R) Wi-Fi 6 AX1650i 160MHz Wireless Network Adapter (201D2W)",

374 .
	gfw_«me_¥e
 = 
IWL_QU_B_HR_B_FW_PRE
,

375 
	gIWL_DEVICE_22500
,

381 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

382 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

385 c⁄° 
iwl_cfg
 
	gkûÀr1650s_2ax_cfg_qu_c0_hr_b0
 = {

386 .
«me
 = "Killer(R) Wi-Fi 6 AX1650s 160MHz Wireless Network Adapter (201NGW)",

387 .
	gfw_«me_¥e
 = 
IWL_QU_C_HR_B_FW_PRE
,

388 
	gIWL_DEVICE_22500
,

394 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

395 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

398 c⁄° 
iwl_cfg
 
	gkûÀr1650i_2ax_cfg_qu_c0_hr_b0
 = {

399 .
«me
 = "Killer(R) Wi-Fi 6 AX1650i 160MHz Wireless Network Adapter (201D2W)",

400 .
	gfw_«me_¥e
 = 
IWL_QU_C_HR_B_FW_PRE
,

401 
	gIWL_DEVICE_22500
,

407 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

408 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

411 c⁄° 
iwl_cfg
 
	giwl_cfg_quz_a0_hr_b0
 = {

412 .
fw_«me_¥e
 = 
IWL_QUZ_A_HR_B_FW_PRE
,

413 
	gIWL_DEVICE_22500
,

419 .
	gmax_tx_agg_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
,

420 .
	gnum_rbds
 = 
IWL_NUM_RBDS_22000_HE
,

423 
MODULE_FIRMWARE
(
IWL_QU_B_HR_B_MODULE_FIRMWARE
(
IWL_22000_UCODE_API_MAX
));

424 
MODULE_FIRMWARE
(
IWL_QU_C_HR_B_MODULE_FIRMWARE
(
IWL_22000_UCODE_API_MAX
));

425 
MODULE_FIRMWARE
(
IWL_QU_B_JF_B_MODULE_FIRMWARE
(
IWL_22000_UCODE_API_MAX
));

426 
MODULE_FIRMWARE
(
IWL_QUZ_A_HR_B_MODULE_FIRMWARE
(
IWL_22000_UCODE_API_MAX
));

427 
MODULE_FIRMWARE
(
IWL_QUZ_A_JF_B_MODULE_FIRMWARE
(
IWL_22000_UCODE_API_MAX
));

428 
MODULE_FIRMWARE
(
IWL_CC_A_MODULE_FIRMWARE
(
IWL_22000_UCODE_API_MAX
));

	@cfg/5000.c

8 
	~<löux/moduÀ.h
>

9 
	~<löux/°rögify.h
>

10 
	~"iwl-c⁄fig.h
"

11 
	~"iwl-agn-hw.h
"

14 
	#IWL5000_UCODE_API_MAX
 5

	)

15 
	#IWL5150_UCODE_API_MAX
 2

	)

18 
	#IWL5000_UCODE_API_MIN
 1

	)

19 
	#IWL5150_UCODE_API_MIN
 1

	)

22 
	#EEPROM_5000_TX_POWER_VERSION
 (4)

	)

23 
	#EEPROM_5000_EEPROM_VERSION
 (0x11A)

	)

24 
	#EEPROM_5050_TX_POWER_VERSION
 (4)

	)

25 
	#EEPROM_5050_EEPROM_VERSION
 (0x21E)

	)

27 
	#IWL5000_FW_PRE
 "iwlwifi-5000"

	)

28 
	#IWL5000_MODULE_FIRMWARE
(
≠i
Ë
IWL5000_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

30 
	#IWL5150_FW_PRE
 "iwlwifi-5150"

	)

31 
	#IWL5150_MODULE_FIRMWARE
(
≠i
Ë
IWL5150_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

33 c⁄° 
iwl_ba£_∑øms
 
	giwl5000_ba£_∑øms
 = {

34 .
ì¥om_size
 = 
IWLAGN_EEPROM_IMG_SIZE
,

35 .
	gnum_of_queues
 = 
IWLAGN_NUM_QUEUES
,

36 .
	gmax_tfd_queue_size
 = 256,

37 .
	g∂l_cfg
 = 
åue
,

38 .
	gÀd_com≥nßti⁄
 = 51,

39 .
	gwd_timeout
 = 
IWL_WATCHDOG_DISABLED
,

40 .
	gmax_evít_log_size
 = 512,

41 .
	gscd_chaö_ext_wa
 = 
åue
,

44 c⁄° 
iwl_ht_∑øms
 
	giwl5000_ht_∑øms
 = {

45 .
ht_gªífõld_suµ‹t
 = 
åue
,

46 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
),

49 c⁄° 
iwl_ì¥om_∑øms
 
	giwl5000_ì¥om_∑øms
 = {

50 .
ªguœt‹y_b™ds
 = {

51 
EEPROM_REG_BAND_1_CHANNELS
,

52 
EEPROM_REG_BAND_2_CHANNELS
,

53 
EEPROM_REG_BAND_3_CHANNELS
,

54 
EEPROM_REG_BAND_4_CHANNELS
,

55 
EEPROM_REG_BAND_5_CHANNELS
,

56 
EEPROM_REG_BAND_24_HT40_CHANNELS
,

57 
EEPROM_REG_BAND_52_HT40_CHANNELS


61 
	#IWL_DEVICE_5000
 \

62 .
fw_«me_¥e
 = 
IWL5000_FW_PRE
, \

63 .
ucode_≠i_max
 = 
IWL5000_UCODE_API_MAX
, \

64 .
ucode_≠i_mö
 = 
IWL5000_UCODE_API_MIN
, \

65 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_5000
, \

66 .
max_ö°_size
 = 
IWLAGN_RTC_INST_SIZE
, \

67 .
max_d©a_size
 = 
IWLAGN_RTC_DATA_SIZE
, \

68 .
nvm_vî
 = 
EEPROM_5000_EEPROM_VERSION
, \

69 .
nvm_ˇlib_vî
 = 
EEPROM_5000_TX_POWER_VERSION
, \

70 .
å™s
.
ba£_∑øms
 = &
iwl5000_ba£_∑øms
, \

71 .
ì¥om_∑øms
 = &
iwl5000_ì¥om_∑øms
, \

72 .
Àd_mode
 = 
IWL_LED_BLINK


	)

74 c⁄° 
iwl_cfg
 
	giwl5300_agn_cfg
 = {

75 .
«me
 = "Intel(R) Ultimate N WiFi Link 5300 AGN",

76 
	gIWL_DEVICE_5000
,

78 .
	gvÆid_tx_™t
 = 
ANT_ABC
,

79 .
	gvÆid_rx_™t
 = 
ANT_ABC
,

80 .
	ght_∑øms
 = &
iwl5000_ht_∑øms
,

83 c⁄° 
iwl_cfg
 
	giwl5100_bgn_cfg
 = {

84 .
«me
 = "Intel(R) WiFi Link 5100 BGN",

85 
	gIWL_DEVICE_5000
,

86 .
	gvÆid_tx_™t
 = 
ANT_B
,

87 .
	gvÆid_rx_™t
 = 
ANT_AB
,

88 .
	ght_∑øms
 = &
iwl5000_ht_∑øms
,

91 c⁄° 
iwl_cfg
 
	giwl5100_abg_cfg
 = {

92 .
«me
 = "Intel(R) WiFi Link 5100 ABG",

93 
	gIWL_DEVICE_5000
,

94 .
	gvÆid_tx_™t
 = 
ANT_B
,

95 .
	gvÆid_rx_™t
 = 
ANT_AB
,

98 c⁄° 
iwl_cfg
 
	giwl5100_agn_cfg
 = {

99 .
«me
 = "Intel(R) WiFi Link 5100 AGN",

100 
	gIWL_DEVICE_5000
,

101 .
	gvÆid_tx_™t
 = 
ANT_B
,

102 .
	gvÆid_rx_™t
 = 
ANT_AB
,

103 .
	ght_∑øms
 = &
iwl5000_ht_∑øms
,

106 c⁄° 
iwl_cfg
 
	giwl5350_agn_cfg
 = {

107 .
«me
 = "Intel(R) WiMAX/WiFi Link 5350 AGN",

108 .
	gfw_«me_¥e
 = 
IWL5000_FW_PRE
,

109 .
	gucode_≠i_max
 = 
IWL5000_UCODE_API_MAX
,

110 .
	gucode_≠i_mö
 = 
IWL5000_UCODE_API_MIN
,

111 .
	gå™s
.
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_5000
,

112 .
	gmax_ö°_size
 = 
IWLAGN_RTC_INST_SIZE
,

113 .
	gmax_d©a_size
 = 
IWLAGN_RTC_DATA_SIZE
,

114 .
	gnvm_vî
 = 
EEPROM_5050_EEPROM_VERSION
,

115 .
	gnvm_ˇlib_vî
 = 
EEPROM_5050_TX_POWER_VERSION
,

116 .
	gå™s
.
	gba£_∑øms
 = &
iwl5000_ba£_∑øms
,

117 .
	gì¥om_∑øms
 = &
iwl5000_ì¥om_∑øms
,

118 .
	ght_∑øms
 = &
iwl5000_ht_∑øms
,

119 .
	gÀd_mode
 = 
IWL_LED_BLINK
,

120 .
	göã∫Æ_wimax_c€x
 = 
åue
,

123 
	#IWL_DEVICE_5150
 \

124 .
fw_«me_¥e
 = 
IWL5150_FW_PRE
, \

125 .
ucode_≠i_max
 = 
IWL5150_UCODE_API_MAX
, \

126 .
ucode_≠i_mö
 = 
IWL5150_UCODE_API_MIN
, \

127 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_5150
, \

128 .
max_ö°_size
 = 
IWLAGN_RTC_INST_SIZE
, \

129 .
max_d©a_size
 = 
IWLAGN_RTC_DATA_SIZE
, \

130 .
nvm_vî
 = 
EEPROM_5050_EEPROM_VERSION
, \

131 .
nvm_ˇlib_vî
 = 
EEPROM_5050_TX_POWER_VERSION
, \

132 .
å™s
.
ba£_∑øms
 = &
iwl5000_ba£_∑øms
, \

133 .
ì¥om_∑øms
 = &
iwl5000_ì¥om_∑øms
, \

134 .
Àd_mode
 = 
IWL_LED_BLINK
, \

135 .
öã∫Æ_wimax_c€x
 = 
åue


	)

137 c⁄° 
iwl_cfg
 
	giwl5150_agn_cfg
 = {

138 .
«me
 = "Intel(R) WiMAX/WiFi Link 5150 AGN",

139 
	gIWL_DEVICE_5150
,

140 .
	ght_∑øms
 = &
iwl5000_ht_∑øms
,

144 c⁄° 
iwl_cfg
 
	giwl5150_abg_cfg
 = {

145 .
«me
 = "Intel(R) WiMAX/WiFi Link 5150 ABG",

146 
	gIWL_DEVICE_5150
,

149 
MODULE_FIRMWARE
(
IWL5000_MODULE_FIRMWARE
(
IWL5000_UCODE_API_MAX
));

150 
MODULE_FIRMWARE
(
IWL5150_MODULE_FIRMWARE
(
IWL5150_UCODE_API_MAX
));

	@cfg/6000.c

8 
	~<löux/moduÀ.h
>

9 
	~<löux/°rögify.h
>

10 
	~"iwl-c⁄fig.h
"

11 
	~"iwl-agn-hw.h
"

12 
	~"dvm/comm™ds.h
"

15 
	#IWL6000_UCODE_API_MAX
 6

	)

16 
	#IWL6050_UCODE_API_MAX
 5

	)

17 
	#IWL6000G2_UCODE_API_MAX
 6

	)

18 
	#IWL6035_UCODE_API_MAX
 6

	)

21 
	#IWL6000_UCODE_API_MIN
 4

	)

22 
	#IWL6050_UCODE_API_MIN
 4

	)

23 
	#IWL6000G2_UCODE_API_MIN
 5

	)

24 
	#IWL6035_UCODE_API_MIN
 6

	)

27 
	#EEPROM_6000_TX_POWER_VERSION
 (4)

	)

28 
	#EEPROM_6000_EEPROM_VERSION
 (0x423)

	)

29 
	#EEPROM_6050_TX_POWER_VERSION
 (4)

	)

30 
	#EEPROM_6050_EEPROM_VERSION
 (0x532)

	)

31 
	#EEPROM_6150_TX_POWER_VERSION
 (6)

	)

32 
	#EEPROM_6150_EEPROM_VERSION
 (0x553)

	)

33 
	#EEPROM_6005_TX_POWER_VERSION
 (6)

	)

34 
	#EEPROM_6005_EEPROM_VERSION
 (0x709)

	)

35 
	#EEPROM_6030_TX_POWER_VERSION
 (6)

	)

36 
	#EEPROM_6030_EEPROM_VERSION
 (0x709)

	)

37 
	#EEPROM_6035_TX_POWER_VERSION
 (6)

	)

38 
	#EEPROM_6035_EEPROM_VERSION
 (0x753)

	)

40 
	#IWL6000_FW_PRE
 "iwlwifi-6000"

	)

41 
	#IWL6000_MODULE_FIRMWARE
(
≠i
Ë
IWL6000_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

43 
	#IWL6050_FW_PRE
 "iwlwifi-6050"

	)

44 
	#IWL6050_MODULE_FIRMWARE
(
≠i
Ë
IWL6050_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

46 
	#IWL6005_FW_PRE
 "iwlwifi-6000g2a"

	)

47 
	#IWL6005_MODULE_FIRMWARE
(
≠i
Ë
IWL6005_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

49 
	#IWL6030_FW_PRE
 "iwlwifi-6000g2b"

	)

50 
	#IWL6030_MODULE_FIRMWARE
(
≠i
Ë
IWL6030_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

52 c⁄° 
iwl_ba£_∑øms
 
	giwl6000_ba£_∑øms
 = {

53 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_2K
,

54 .
	gnum_of_queues
 = 
IWLAGN_NUM_QUEUES
,

55 .
	gmax_tfd_queue_size
 = 256,

56 .
	gmax_Œ_ôems
 = 
OTP_MAX_LL_ITEMS_6x00
,

57 .
	gshadow_øm_suµ‹t
 = 
åue
,

58 .
	gÀd_com≥nßti⁄
 = 51,

59 .
	gwd_timeout
 = 
IWL_DEF_WD_TIMEOUT
,

60 .
	gmax_evít_log_size
 = 512,

61 .
	gshadow_ªg_íabÀ
 = 
Ál£
,

62 .
	gscd_chaö_ext_wa
 = 
åue
,

65 c⁄° 
iwl_ba£_∑øms
 
	giwl6050_ba£_∑øms
 = {

66 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_2K
,

67 .
	gnum_of_queues
 = 
IWLAGN_NUM_QUEUES
,

68 .
	gmax_tfd_queue_size
 = 256,

69 .
	gmax_Œ_ôems
 = 
OTP_MAX_LL_ITEMS_6x50
,

70 .
	gshadow_øm_suµ‹t
 = 
åue
,

71 .
	gÀd_com≥nßti⁄
 = 51,

72 .
	gwd_timeout
 = 
IWL_DEF_WD_TIMEOUT
,

73 .
	gmax_evít_log_size
 = 1024,

74 .
	gshadow_ªg_íabÀ
 = 
Ál£
,

75 .
	gscd_chaö_ext_wa
 = 
åue
,

78 c⁄° 
iwl_ba£_∑øms
 
	giwl6000_g2_ba£_∑øms
 = {

79 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_2K
,

80 .
	gnum_of_queues
 = 
IWLAGN_NUM_QUEUES
,

81 .
	gmax_tfd_queue_size
 = 256,

82 .
	gmax_Œ_ôems
 = 
OTP_MAX_LL_ITEMS_6x00
,

83 .
	gshadow_øm_suµ‹t
 = 
åue
,

84 .
	gÀd_com≥nßti⁄
 = 57,

85 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

86 .
	gmax_evít_log_size
 = 512,

87 .
	gshadow_ªg_íabÀ
 = 
Ál£
,

88 .
	gscd_chaö_ext_wa
 = 
åue
,

91 c⁄° 
iwl_ht_∑øms
 
	giwl6000_ht_∑øms
 = {

92 .
ht_gªífõld_suµ‹t
 = 
åue
,

93 .
	gu£_πs_f‹_aggªg©i⁄
 = 
åue
,

94 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
),

97 c⁄° 
iwl_ì¥om_∑øms
 
	giwl6000_ì¥om_∑øms
 = {

98 .
ªguœt‹y_b™ds
 = {

99 
EEPROM_REG_BAND_1_CHANNELS
,

100 
EEPROM_REG_BAND_2_CHANNELS
,

101 
EEPROM_REG_BAND_3_CHANNELS
,

102 
EEPROM_REG_BAND_4_CHANNELS
,

103 
EEPROM_REG_BAND_5_CHANNELS
,

104 
EEPROM_6000_REG_BAND_24_HT40_CHANNELS
,

105 
EEPROM_REG_BAND_52_HT40_CHANNELS


107 .
	gíh™˚d_txpowî
 = 
åue
,

110 
	#IWL_DEVICE_6005
 \

111 .
fw_«me_¥e
 = 
IWL6005_FW_PRE
, \

112 .
ucode_≠i_max
 = 
IWL6000G2_UCODE_API_MAX
, \

113 .
ucode_≠i_mö
 = 
IWL6000G2_UCODE_API_MIN
, \

114 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6005
, \

115 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

116 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

117 .
nvm_vî
 = 
EEPROM_6005_EEPROM_VERSION
, \

118 .
nvm_ˇlib_vî
 = 
EEPROM_6005_TX_POWER_VERSION
, \

119 .
å™s
.
ba£_∑øms
 = &
iwl6000_g2_ba£_∑øms
, \

120 .
ì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
, \

121 .
Àd_mode
 = 
IWL_LED_RF_STATE


	)

123 c⁄° 
iwl_cfg
 
	giwl6005_2agn_cfg
 = {

124 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6205 AGN",

125 
	gIWL_DEVICE_6005
,

126 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

129 c⁄° 
iwl_cfg
 
	giwl6005_2abg_cfg
 = {

130 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6205 ABG",

131 
	gIWL_DEVICE_6005
,

134 c⁄° 
iwl_cfg
 
	giwl6005_2bg_cfg
 = {

135 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6205 BG",

136 
	gIWL_DEVICE_6005
,

139 c⁄° 
iwl_cfg
 
	giwl6005_2agn_sff_cfg
 = {

140 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6205S AGN",

141 
	gIWL_DEVICE_6005
,

142 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

145 c⁄° 
iwl_cfg
 
	giwl6005_2agn_d_cfg
 = {

146 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6205D AGN",

147 
	gIWL_DEVICE_6005
,

148 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

151 c⁄° 
iwl_cfg
 
	giwl6005_2agn_mow1_cfg
 = {

152 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6206 AGN",

153 
	gIWL_DEVICE_6005
,

154 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

157 c⁄° 
iwl_cfg
 
	giwl6005_2agn_mow2_cfg
 = {

158 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6207 AGN",

159 
	gIWL_DEVICE_6005
,

160 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

163 
	#IWL_DEVICE_6030
 \

164 .
fw_«me_¥e
 = 
IWL6030_FW_PRE
, \

165 .
ucode_≠i_max
 = 
IWL6000G2_UCODE_API_MAX
, \

166 .
ucode_≠i_mö
 = 
IWL6000G2_UCODE_API_MIN
, \

167 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6030
, \

168 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

169 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

170 .
nvm_vî
 = 
EEPROM_6030_EEPROM_VERSION
, \

171 .
nvm_ˇlib_vî
 = 
EEPROM_6030_TX_POWER_VERSION
, \

172 .
å™s
.
ba£_∑øms
 = &
iwl6000_g2_ba£_∑øms
, \

173 .
ì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
, \

174 .
Àd_mode
 = 
IWL_LED_RF_STATE


	)

176 c⁄° 
iwl_cfg
 
	giwl6030_2agn_cfg
 = {

177 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6230 AGN",

178 
	gIWL_DEVICE_6030
,

179 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

182 c⁄° 
iwl_cfg
 
	giwl6030_2abg_cfg
 = {

183 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6230 ABG",

184 
	gIWL_DEVICE_6030
,

187 c⁄° 
iwl_cfg
 
	giwl6030_2bgn_cfg
 = {

188 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6230 BGN",

189 
	gIWL_DEVICE_6030
,

190 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

193 c⁄° 
iwl_cfg
 
	giwl6030_2bg_cfg
 = {

194 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6230 BG",

195 
	gIWL_DEVICE_6030
,

198 
	#IWL_DEVICE_6035
 \

199 .
fw_«me_¥e
 = 
IWL6030_FW_PRE
, \

200 .
ucode_≠i_max
 = 
IWL6035_UCODE_API_MAX
, \

201 .
ucode_≠i_mö
 = 
IWL6035_UCODE_API_MIN
, \

202 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6030
, \

203 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

204 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

205 .
nvm_vî
 = 
EEPROM_6030_EEPROM_VERSION
, \

206 .
nvm_ˇlib_vî
 = 
EEPROM_6030_TX_POWER_VERSION
, \

207 .
å™s
.
ba£_∑øms
 = &
iwl6000_g2_ba£_∑øms
, \

208 .
ì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
, \

209 .
Àd_mode
 = 
IWL_LED_RF_STATE


	)

211 c⁄° 
iwl_cfg
 
	giwl6035_2agn_cfg
 = {

212 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6235 AGN",

213 
	gIWL_DEVICE_6035
,

214 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

217 c⁄° 
iwl_cfg
 
	giwl6035_2agn_sff_cfg
 = {

218 .
«me
 = "Intel(R) Centrino(R) Ultimate-N 6235 AGN",

219 
	gIWL_DEVICE_6035
,

220 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

223 c⁄° 
iwl_cfg
 
	giwl1030_bgn_cfg
 = {

224 .
«me
 = "Intel(R) Centrino(R) Wireless-N 1030 BGN",

225 
	gIWL_DEVICE_6030
,

226 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

229 c⁄° 
iwl_cfg
 
	giwl1030_bg_cfg
 = {

230 .
«me
 = "Intel(R) Centrino(R) Wireless-N 1030 BG",

231 
	gIWL_DEVICE_6030
,

234 c⁄° 
iwl_cfg
 
	giwl130_bgn_cfg
 = {

235 .
«me
 = "Intel(R) Centrino(R) Wireless-N 130 BGN",

236 
	gIWL_DEVICE_6030
,

237 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

238 .
	grx_wôh_siso_divîsôy
 = 
åue
,

241 c⁄° 
iwl_cfg
 
	giwl130_bg_cfg
 = {

242 .
«me
 = "Intel(R) Centrino(R) Wireless-N 130 BG",

243 
	gIWL_DEVICE_6030
,

244 .
	grx_wôh_siso_divîsôy
 = 
åue
,

250 
	#IWL_DEVICE_6000i
 \

251 .
fw_«me_¥e
 = 
IWL6000_FW_PRE
, \

252 .
ucode_≠i_max
 = 
IWL6000_UCODE_API_MAX
, \

253 .
ucode_≠i_mö
 = 
IWL6000_UCODE_API_MIN
, \

254 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6000i
, \

255 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

256 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

257 .
vÆid_tx_™t
 = 
ANT_BC
, \

258 .
vÆid_rx_™t
 = 
ANT_BC
, \

259 .
nvm_vî
 = 
EEPROM_6000_EEPROM_VERSION
, \

260 .
nvm_ˇlib_vî
 = 
EEPROM_6000_TX_POWER_VERSION
, \

261 .
å™s
.
ba£_∑øms
 = &
iwl6000_ba£_∑øms
, \

262 .
ì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
, \

263 .
Àd_mode
 = 
IWL_LED_BLINK


	)

265 c⁄° 
iwl_cfg
 
	giwl6000i_2agn_cfg
 = {

266 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6200 AGN",

267 
	gIWL_DEVICE_6000i
,

268 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

271 c⁄° 
iwl_cfg
 
	giwl6000i_2abg_cfg
 = {

272 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6200 ABG",

273 
	gIWL_DEVICE_6000i
,

276 c⁄° 
iwl_cfg
 
	giwl6000i_2bg_cfg
 = {

277 .
«me
 = "Intel(R) Centrino(R) Advanced-N 6200 BG",

278 
	gIWL_DEVICE_6000i
,

281 
	#IWL_DEVICE_6050
 \

282 .
fw_«me_¥e
 = 
IWL6050_FW_PRE
, \

283 .
ucode_≠i_max
 = 
IWL6050_UCODE_API_MAX
, \

284 .
ucode_≠i_mö
 = 
IWL6050_UCODE_API_MIN
, \

285 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6050
, \

286 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

287 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

288 .
vÆid_tx_™t
 = 
ANT_AB
, \

289 .
vÆid_rx_™t
 = 
ANT_AB
, \

290 .
nvm_vî
 = 
EEPROM_6050_EEPROM_VERSION
, \

291 .
nvm_ˇlib_vî
 = 
EEPROM_6050_TX_POWER_VERSION
, \

292 .
å™s
.
ba£_∑øms
 = &
iwl6050_ba£_∑øms
, \

293 .
ì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
, \

294 .
Àd_mode
 = 
IWL_LED_BLINK
, \

295 .
öã∫Æ_wimax_c€x
 = 
åue


	)

297 c⁄° 
iwl_cfg
 
	giwl6050_2agn_cfg
 = {

298 .
«me
 = "Intel(R) Centrino(R) Advanced-N + WiMAX 6250 AGN",

299 
	gIWL_DEVICE_6050
,

300 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

303 c⁄° 
iwl_cfg
 
	giwl6050_2abg_cfg
 = {

304 .
«me
 = "Intel(R) Centrino(R) Advanced-N + WiMAX 6250 ABG",

305 
	gIWL_DEVICE_6050
,

308 
	#IWL_DEVICE_6150
 \

309 .
fw_«me_¥e
 = 
IWL6050_FW_PRE
, \

310 .
ucode_≠i_max
 = 
IWL6050_UCODE_API_MAX
, \

311 .
ucode_≠i_mö
 = 
IWL6050_UCODE_API_MIN
, \

312 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6150
, \

313 .
max_ö°_size
 = 
IWL60_RTC_INST_SIZE
, \

314 .
max_d©a_size
 = 
IWL60_RTC_DATA_SIZE
, \

315 .
nvm_vî
 = 
EEPROM_6150_EEPROM_VERSION
, \

316 .
nvm_ˇlib_vî
 = 
EEPROM_6150_TX_POWER_VERSION
, \

317 .
å™s
.
ba£_∑øms
 = &
iwl6050_ba£_∑øms
, \

318 .
ì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
, \

319 .
Àd_mode
 = 
IWL_LED_BLINK
, \

320 .
öã∫Æ_wimax_c€x
 = 
åue


	)

322 c⁄° 
iwl_cfg
 
	giwl6150_bgn_cfg
 = {

323 .
«me
 = "Intel(R) Centrino(R) Wireless-N + WiMAX 6150 BGN",

324 
	gIWL_DEVICE_6150
,

325 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

328 c⁄° 
iwl_cfg
 
	giwl6150_bg_cfg
 = {

329 .
«me
 = "Intel(R) Centrino(R) Wireless-N + WiMAX 6150 BG",

330 
	gIWL_DEVICE_6150
,

333 c⁄° 
iwl_cfg
 
	giwl6000_3agn_cfg
 = {

334 .
«me
 = "Intel(R) Centrino(R) Ultimate-N 6300 AGN",

335 .
	gfw_«me_¥e
 = 
IWL6000_FW_PRE
,

336 .
	gucode_≠i_max
 = 
IWL6000_UCODE_API_MAX
,

337 .
	gucode_≠i_mö
 = 
IWL6000_UCODE_API_MIN
,

338 .
	gå™s
.
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_6000
,

339 .
	gmax_ö°_size
 = 
IWL60_RTC_INST_SIZE
,

340 .
	gmax_d©a_size
 = 
IWL60_RTC_DATA_SIZE
,

341 .
	gnvm_vî
 = 
EEPROM_6000_EEPROM_VERSION
,

342 .
	gnvm_ˇlib_vî
 = 
EEPROM_6000_TX_POWER_VERSION
,

343 .
	gå™s
.
	gba£_∑øms
 = &
iwl6000_ba£_∑øms
,

344 .
	gì¥om_∑øms
 = &
iwl6000_ì¥om_∑øms
,

345 .
	ght_∑øms
 = &
iwl6000_ht_∑øms
,

346 .
	gÀd_mode
 = 
IWL_LED_BLINK
,

349 
MODULE_FIRMWARE
(
IWL6000_MODULE_FIRMWARE
(
IWL6000_UCODE_API_MAX
));

350 
MODULE_FIRMWARE
(
IWL6050_MODULE_FIRMWARE
(
IWL6050_UCODE_API_MAX
));

351 
MODULE_FIRMWARE
(
IWL6005_MODULE_FIRMWARE
(
IWL6000G2_UCODE_API_MAX
));

352 
MODULE_FIRMWARE
(
IWL6030_MODULE_FIRMWARE
(
IWL6000G2_UCODE_API_MAX
));

	@cfg/7000.c

7 
	~<löux/moduÀ.h
>

8 
	~<löux/°rögify.h
>

9 
	~"iwl-c⁄fig.h
"

12 
	#IWL7260_UCODE_API_MAX
 17

	)

13 
	#IWL7265_UCODE_API_MAX
 17

	)

14 
	#IWL7265D_UCODE_API_MAX
 29

	)

15 
	#IWL3168_UCODE_API_MAX
 29

	)

18 
	#IWL7260_UCODE_API_MIN
 17

	)

19 
	#IWL7265_UCODE_API_MIN
 17

	)

20 
	#IWL7265D_UCODE_API_MIN
 22

	)

21 
	#IWL3168_UCODE_API_MIN
 22

	)

24 
	#IWL7260_NVM_VERSION
 0x0a1d

	)

25 
	#IWL3160_NVM_VERSION
 0x709

	)

26 
	#IWL3165_NVM_VERSION
 0x709

	)

27 
	#IWL3168_NVM_VERSION
 0xd01

	)

28 
	#IWL7265_NVM_VERSION
 0x0a1d

	)

29 
	#IWL7265D_NVM_VERSION
 0x0c11

	)

32 
	#IWL7000_DCCM_OFFSET
 0x800000

	)

33 
	#IWL7260_DCCM_LEN
 0x14000

	)

34 
	#IWL3160_DCCM_LEN
 0x10000

	)

35 
	#IWL7265_DCCM_LEN
 0x17A00

	)

37 
	#IWL7260_FW_PRE
 "iwlwifi-7260"

	)

38 
	#IWL7260_MODULE_FIRMWARE
(
≠i
Ë
IWL7260_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

40 
	#IWL3160_FW_PRE
 "iwlwifi-3160"

	)

41 
	#IWL3160_MODULE_FIRMWARE
(
≠i
Ë
IWL3160_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

43 
	#IWL3168_FW_PRE
 "iwlwifi-3168"

	)

44 
	#IWL3168_MODULE_FIRMWARE
(
≠i
Ë
IWL3168_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

46 
	#IWL7265_FW_PRE
 "iwlwifi-7265"

	)

47 
	#IWL7265_MODULE_FIRMWARE
(
≠i
Ë
IWL7265_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

49 
	#IWL7265D_FW_PRE
 "iwlwifi-7265D"

	)

50 
	#IWL7265D_MODULE_FIRMWARE
(
≠i
Ë
IWL7265D_FW_PRE
 "-" 
	`__°rögify
◊piË".ucode"

	)

52 c⁄° 
iwl_ba£_∑øms
 
	giwl7000_ba£_∑øms
 = {

53 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_16K
,

54 .
	gnum_of_queues
 = 31,

55 .
	gmax_tfd_queue_size
 = 256,

56 .
	gshadow_øm_suµ‹t
 = 
åue
,

57 .
	gÀd_com≥nßti⁄
 = 57,

58 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

59 .
	gmax_evít_log_size
 = 512,

60 .
	gshadow_ªg_íabÀ
 = 
åue
,

61 .
	gpcõ_l1_Ælowed
 = 
åue
,

62 .
	g≠mg_wake_up_wa
 = 
åue
,

65 c⁄° 
iwl_â_∑øms
 
	giwl7000_high_ãmp_â_∑øms
 = {

66 .
˘_kûl_íåy
 = 118,

67 .
	g˘_kûl_exô
 = 96,

68 .
	g˘_kûl_duøti⁄
 = 5,

69 .
	gdy«mic_smps_íåy
 = 114,

70 .
	gdy«mic_smps_exô
 = 110,

71 .
	gtx_¥Ÿe˘i⁄_íåy
 = 114,

72 .
	gtx_¥Ÿe˘i⁄_exô
 = 108,

73 .
	gtx_backoff
 = {

74 {.
ãm≥øtuª
 = 112, .
	gbackoff
 = 300},

75 {.
	gãm≥øtuª
 = 113, .
	gbackoff
 = 800},

76 {.
	gãm≥øtuª
 = 114, .
	gbackoff
 = 1500},

77 {.
	gãm≥øtuª
 = 115, .
	gbackoff
 = 3000},

78 {.
	gãm≥øtuª
 = 116, .
	gbackoff
 = 5000},

79 {.
	gãm≥øtuª
 = 117, .
	gbackoff
 = 10000},

81 .
	gsuµ‹t_˘_kûl
 = 
åue
,

82 .
	gsuµ‹t_dy«mic_smps
 = 
åue
,

83 .
	gsuµ‹t_tx_¥Ÿe˘i⁄
 = 
åue
,

84 .
	gsuµ‹t_tx_backoff
 = 
åue
,

87 c⁄° 
iwl_ht_∑øms
 
	giwl7000_ht_∑øms
 = {

88 .
°bc
 = 
åue
,

89 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
),

92 
	#IWL_DEVICE_7000_COMMON
 \

93 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_7000
, \

94 .
å™s
.
ba£_∑øms
 = &
iwl7000_ba£_∑øms
, \

95 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

96 .
nvm_hw_£˘i⁄_num
 = 0, \

97 .
n⁄_sh¨ed_™t
 = 
ANT_A
, \

98 .
dccm_off£t
 = 
IWL7000_DCCM_OFFSET


	)

100 
	#IWL_DEVICE_7000
 \

101 
IWL_DEVICE_7000_COMMON
, \

102 .
ucode_≠i_max
 = 
IWL7260_UCODE_API_MAX
, \

103 .
ucode_≠i_mö
 = 
IWL7260_UCODE_API_MIN


	)

105 
	#IWL_DEVICE_7005
 \

106 
IWL_DEVICE_7000_COMMON
, \

107 .
ucode_≠i_max
 = 
IWL7265_UCODE_API_MAX
, \

108 .
ucode_≠i_mö
 = 
IWL7265_UCODE_API_MIN


	)

110 
	#IWL_DEVICE_3008
 \

111 
IWL_DEVICE_7000_COMMON
, \

112 .
ucode_≠i_max
 = 
IWL3168_UCODE_API_MAX
, \

113 .
ucode_≠i_mö
 = 
IWL3168_UCODE_API_MIN


	)

115 
	#IWL_DEVICE_7005D
 \

116 
IWL_DEVICE_7000_COMMON
, \

117 .
ucode_≠i_max
 = 
IWL7265D_UCODE_API_MAX
, \

118 .
ucode_≠i_mö
 = 
IWL7265D_UCODE_API_MIN


	)

120 c⁄° 
iwl_cfg
 
	giwl7260_2ac_cfg
 = {

121 .
«me
 = "Intel(R) Dual Band Wireless AC 7260",

122 .
	gfw_«me_¥e
 = 
IWL7260_FW_PRE
,

123 
	gIWL_DEVICE_7000
,

124 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

125 .
	gnvm_vî
 = 
IWL7260_NVM_VERSION
,

126 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

127 .
	gÕ_xèl_w‹k¨ound
 = 
åue
,

128 .
	gdccm_Àn
 = 
IWL7260_DCCM_LEN
,

131 c⁄° 
iwl_cfg
 
	giwl7260_2ac_cfg_high_ãmp
 = {

132 .
«me
 = "Intel(R) Dual Band Wireless AC 7260",

133 .
	gfw_«me_¥e
 = 
IWL7260_FW_PRE
,

134 
	gIWL_DEVICE_7000
,

135 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

136 .
	gnvm_vî
 = 
IWL7260_NVM_VERSION
,

137 .
	ghigh_ãmp
 = 
åue
,

138 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

139 .
	gÕ_xèl_w‹k¨ound
 = 
åue
,

140 .
	gdccm_Àn
 = 
IWL7260_DCCM_LEN
,

141 .
	gthîmÆ_∑øms
 = &
iwl7000_high_ãmp_â_∑øms
,

144 c⁄° 
iwl_cfg
 
	giwl7260_2n_cfg
 = {

145 .
«me
 = "Intel(R) Dual Band Wireless N 7260",

146 .
	gfw_«me_¥e
 = 
IWL7260_FW_PRE
,

147 
	gIWL_DEVICE_7000
,

148 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

149 .
	gnvm_vî
 = 
IWL7260_NVM_VERSION
,

150 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

151 .
	gÕ_xèl_w‹k¨ound
 = 
åue
,

152 .
	gdccm_Àn
 = 
IWL7260_DCCM_LEN
,

155 c⁄° 
iwl_cfg
 
	giwl7260_n_cfg
 = {

156 .
«me
 = "Intel(R) Wireless N 7260",

157 .
	gfw_«me_¥e
 = 
IWL7260_FW_PRE
,

158 
	gIWL_DEVICE_7000
,

159 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

160 .
	gnvm_vî
 = 
IWL7260_NVM_VERSION
,

161 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

162 .
	gÕ_xèl_w‹k¨ound
 = 
åue
,

163 .
	gdccm_Àn
 = 
IWL7260_DCCM_LEN
,

166 c⁄° 
iwl_cfg
 
	giwl3160_2ac_cfg
 = {

167 .
«me
 = "Intel(R) Dual Band Wireless AC 3160",

168 .
	gfw_«me_¥e
 = 
IWL3160_FW_PRE
,

169 
	gIWL_DEVICE_7000
,

170 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

171 .
	gnvm_vî
 = 
IWL3160_NVM_VERSION
,

172 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

173 .
	gdccm_Àn
 = 
IWL3160_DCCM_LEN
,

176 c⁄° 
iwl_cfg
 
	giwl3160_2n_cfg
 = {

177 .
«me
 = "Intel(R) Dual Band Wireless N 3160",

178 .
	gfw_«me_¥e
 = 
IWL3160_FW_PRE
,

179 
	gIWL_DEVICE_7000
,

180 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

181 .
	gnvm_vî
 = 
IWL3160_NVM_VERSION
,

182 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

183 .
	gdccm_Àn
 = 
IWL3160_DCCM_LEN
,

186 c⁄° 
iwl_cfg
 
	giwl3160_n_cfg
 = {

187 .
«me
 = "Intel(R) Wireless N 3160",

188 .
	gfw_«me_¥e
 = 
IWL3160_FW_PRE
,

189 
	gIWL_DEVICE_7000
,

190 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

191 .
	gnvm_vî
 = 
IWL3160_NVM_VERSION
,

192 .
	gho°_öãºu±_›î©i⁄_mode
 = 
åue
,

193 .
	gdccm_Àn
 = 
IWL3160_DCCM_LEN
,

196 c⁄° 
iwl_pwr_tx_backoff
 
	giwl7265_pwr_tx_backoffs
[] = {

197 {.
pwr
 = 1600, .
	gbackoff
 = 0},

198 {.
	gpwr
 = 1300, .
	gbackoff
 = 467},

199 {.
	gpwr
 = 900, .
	gbackoff
 = 1900},

200 {.
	gpwr
 = 800, .
	gbackoff
 = 2630},

201 {.
	gpwr
 = 700, .
	gbackoff
 = 3720},

202 {.
	gpwr
 = 600, .
	gbackoff
 = 5550},

203 {.
	gpwr
 = 500, .
	gbackoff
 = 9350},

207 c⁄° 
iwl_ht_∑øms
 
	giwl7265_ht_∑øms
 = {

208 .
°bc
 = 
åue
,

209 .
	gldpc
 = 
åue
,

210 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
),

213 c⁄° 
iwl_cfg
 
	giwl3165_2ac_cfg
 = {

214 .
«me
 = "Intel(R) Dual Band Wireless AC 3165",

215 .
	gfw_«me_¥e
 = 
IWL7265D_FW_PRE
,

216 
	gIWL_DEVICE_7005D
,

217 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

218 .
	gnvm_vî
 = 
IWL3165_NVM_VERSION
,

219 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

220 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

223 c⁄° 
iwl_cfg
 
	giwl3168_2ac_cfg
 = {

224 .
«me
 = "Intel(R) Dual Band Wireless AC 3168",

225 .
	gfw_«me_¥e
 = 
IWL3168_FW_PRE
,

226 
	gIWL_DEVICE_3008
,

227 .
	ght_∑øms
 = &
iwl7000_ht_∑øms
,

228 .
	gnvm_vî
 = 
IWL3168_NVM_VERSION
,

229 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

230 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

231 .
	gnvm_ty≥
 = 
IWL_NVM_SDP
,

234 c⁄° 
iwl_cfg
 
	giwl7265_2ac_cfg
 = {

235 .
«me
 = "Intel(R) Dual Band Wireless AC 7265",

236 .
	gfw_«me_¥e
 = 
IWL7265_FW_PRE
,

237 
	gIWL_DEVICE_7005
,

238 .
	ght_∑øms
 = &
iwl7265_ht_∑øms
,

239 .
	gnvm_vî
 = 
IWL7265_NVM_VERSION
,

240 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

241 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

244 c⁄° 
iwl_cfg
 
	giwl7265_2n_cfg
 = {

245 .
«me
 = "Intel(R) Dual Band Wireless N 7265",

246 .
	gfw_«me_¥e
 = 
IWL7265_FW_PRE
,

247 
	gIWL_DEVICE_7005
,

248 .
	ght_∑øms
 = &
iwl7265_ht_∑øms
,

249 .
	gnvm_vî
 = 
IWL7265_NVM_VERSION
,

250 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

251 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

254 c⁄° 
iwl_cfg
 
	giwl7265_n_cfg
 = {

255 .
«me
 = "Intel(R) Wireless N 7265",

256 .
	gfw_«me_¥e
 = 
IWL7265_FW_PRE
,

257 
	gIWL_DEVICE_7005
,

258 .
	ght_∑øms
 = &
iwl7265_ht_∑øms
,

259 .
	gnvm_vî
 = 
IWL7265_NVM_VERSION
,

260 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

261 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

264 c⁄° 
iwl_cfg
 
	giwl7265d_2ac_cfg
 = {

265 .
«me
 = "Intel(R) Dual Band Wireless AC 7265",

266 .
	gfw_«me_¥e
 = 
IWL7265D_FW_PRE
,

267 
	gIWL_DEVICE_7005D
,

268 .
	ght_∑øms
 = &
iwl7265_ht_∑øms
,

269 .
	gnvm_vî
 = 
IWL7265D_NVM_VERSION
,

270 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

271 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

274 c⁄° 
iwl_cfg
 
	giwl7265d_2n_cfg
 = {

275 .
«me
 = "Intel(R) Dual Band Wireless N 7265",

276 .
	gfw_«me_¥e
 = 
IWL7265D_FW_PRE
,

277 
	gIWL_DEVICE_7005D
,

278 .
	ght_∑øms
 = &
iwl7265_ht_∑øms
,

279 .
	gnvm_vî
 = 
IWL7265D_NVM_VERSION
,

280 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

281 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

284 c⁄° 
iwl_cfg
 
	giwl7265d_n_cfg
 = {

285 .
«me
 = "Intel(R) Wireless N 7265",

286 .
	gfw_«me_¥e
 = 
IWL7265D_FW_PRE
,

287 
	gIWL_DEVICE_7005D
,

288 .
	ght_∑øms
 = &
iwl7265_ht_∑øms
,

289 .
	gnvm_vî
 = 
IWL7265D_NVM_VERSION
,

290 .
	gpwr_tx_backoffs
 = 
iwl7265_pwr_tx_backoffs
,

291 .
	gdccm_Àn
 = 
IWL7265_DCCM_LEN
,

294 
MODULE_FIRMWARE
(
IWL7260_MODULE_FIRMWARE
(
IWL7260_UCODE_API_MAX
));

295 
MODULE_FIRMWARE
(
IWL3160_MODULE_FIRMWARE
(
IWL7260_UCODE_API_MAX
));

296 
MODULE_FIRMWARE
(
IWL3168_MODULE_FIRMWARE
(
IWL3168_UCODE_API_MAX
));

297 
MODULE_FIRMWARE
(
IWL7265_MODULE_FIRMWARE
(
IWL7265_UCODE_API_MAX
));

298 
MODULE_FIRMWARE
(
IWL7265D_MODULE_FIRMWARE
(
IWL7265D_UCODE_API_MAX
));

	@cfg/8000.c

7 
	~<löux/moduÀ.h
>

8 
	~<löux/°rögify.h
>

9 
	~"iwl-c⁄fig.h
"

12 
	#IWL8000_UCODE_API_MAX
 36

	)

13 
	#IWL8265_UCODE_API_MAX
 36

	)

16 
	#IWL8000_UCODE_API_MIN
 22

	)

17 
	#IWL8265_UCODE_API_MIN
 22

	)

20 
	#IWL8000_NVM_VERSION
 0x0a1d

	)

23 
	#IWL8260_DCCM_OFFSET
 0x800000

	)

24 
	#IWL8260_DCCM_LEN
 0x18000

	)

25 
	#IWL8260_DCCM2_OFFSET
 0x880000

	)

26 
	#IWL8260_DCCM2_LEN
 0x8000

	)

27 
	#IWL8260_SMEM_OFFSET
 0x400000

	)

28 
	#IWL8260_SMEM_LEN
 0x68000

	)

30 
	#IWL8000_FW_PRE
 "iwlwifi-8000C"

	)

31 
	#IWL8000_MODULE_FIRMWARE
(
≠i
) \

32 
IWL8000_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

34 
	#IWL8265_FW_PRE
 "iwlwifi-8265"

	)

35 
	#IWL8265_MODULE_FIRMWARE
(
≠i
) \

36 
IWL8265_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

38 
	#DEFAULT_NVM_FILE_FAMILY_8000C
 "nvmD©a-8000C"

	)

40 c⁄° 
iwl_ba£_∑øms
 
	giwl8000_ba£_∑øms
 = {

41 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_32K
,

42 .
	gnum_of_queues
 = 31,

43 .
	gmax_tfd_queue_size
 = 256,

44 .
	gshadow_øm_suµ‹t
 = 
åue
,

45 .
	gÀd_com≥nßti⁄
 = 57,

46 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

47 .
	gmax_evít_log_size
 = 512,

48 .
	gshadow_ªg_íabÀ
 = 
åue
,

49 .
	gpcõ_l1_Ælowed
 = 
åue
,

52 c⁄° 
iwl_ht_∑øms
 
	giwl8000_ht_∑øms
 = {

53 .
°bc
 = 
åue
,

54 .
	gldpc
 = 
åue
,

55 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
),

58 c⁄° 
iwl_â_∑øms
 
	giwl8000_â_∑øms
 = {

59 .
˘_kûl_íåy
 = 115,

60 .
	g˘_kûl_exô
 = 93,

61 .
	g˘_kûl_duøti⁄
 = 5,

62 .
	gdy«mic_smps_íåy
 = 111,

63 .
	gdy«mic_smps_exô
 = 107,

64 .
	gtx_¥Ÿe˘i⁄_íåy
 = 112,

65 .
	gtx_¥Ÿe˘i⁄_exô
 = 105,

66 .
	gtx_backoff
 = {

67 {.
ãm≥øtuª
 = 110, .
	gbackoff
 = 200},

68 {.
	gãm≥øtuª
 = 111, .
	gbackoff
 = 600},

69 {.
	gãm≥øtuª
 = 112, .
	gbackoff
 = 1200},

70 {.
	gãm≥øtuª
 = 113, .
	gbackoff
 = 2000},

71 {.
	gãm≥øtuª
 = 114, .
	gbackoff
 = 4000},

73 .
	gsuµ‹t_˘_kûl
 = 
åue
,

74 .
	gsuµ‹t_dy«mic_smps
 = 
åue
,

75 .
	gsuµ‹t_tx_¥Ÿe˘i⁄
 = 
åue
,

76 .
	gsuµ‹t_tx_backoff
 = 
åue
,

79 
	#IWL_DEVICE_8000_COMMON
 \

80 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_8000
, \

81 .
å™s
.
ba£_∑øms
 = &
iwl8000_ba£_∑øms
, \

82 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

83 .
nvm_hw_£˘i⁄_num
 = 10, \

84 .
„©uªs
 = 
NETIF_F_RXCSUM
, \

85 .
n⁄_sh¨ed_™t
 = 
ANT_A
, \

86 .
dccm_off£t
 = 
IWL8260_DCCM_OFFSET
, \

87 .
dccm_Àn
 = 
IWL8260_DCCM_LEN
, \

88 .
dccm2_off£t
 = 
IWL8260_DCCM2_OFFSET
, \

89 .
dccm2_Àn
 = 
IWL8260_DCCM2_LEN
, \

90 .
smem_off£t
 = 
IWL8260_SMEM_OFFSET
, \

91 .
smem_Àn
 = 
IWL8260_SMEM_LEN
, \

92 .
deÁu…_nvm_fûe_C_°ï
 = 
DEFAULT_NVM_FILE_FAMILY_8000C
, \

93 .
thîmÆ_∑øms
 = &
iwl8000_â_∑øms
, \

94 .
≠mg_nŸ_suµ‹ãd
 = 
åue
, \

95 .
nvm_ty≥
 = 
IWL_NVM_EXT
, \

96 .
dbgc_suµ‹ãd
 = 
åue
, \

97 .
mö_umac_îr‹_evít_èbÀ
 = 0x800000

	)

99 
	#IWL_DEVICE_8000
 \

100 
IWL_DEVICE_8000_COMMON
, \

101 .
ucode_≠i_max
 = 
IWL8000_UCODE_API_MAX
, \

102 .
ucode_≠i_mö
 = 
IWL8000_UCODE_API_MIN
 \

103 

	)

104 
	#IWL_DEVICE_8260
 \

105 
IWL_DEVICE_8000_COMMON
, \

106 .
ucode_≠i_max
 = 
IWL8000_UCODE_API_MAX
, \

107 .
ucode_≠i_mö
 = 
IWL8000_UCODE_API_MIN
 \

108 

	)

109 
	#IWL_DEVICE_8265
 \

110 
IWL_DEVICE_8000_COMMON
, \

111 .
ucode_≠i_max
 = 
IWL8265_UCODE_API_MAX
, \

112 .
ucode_≠i_mö
 = 
IWL8265_UCODE_API_MIN
 \

113 

	)

114 c⁄° 
iwl_cfg
 
	giwl8260_2n_cfg
 = {

115 .
«me
 = "Intel(R) Dual Band Wireless N 8260",

116 .
	gfw_«me_¥e
 = 
IWL8000_FW_PRE
,

117 
	gIWL_DEVICE_8260
,

118 .
	ght_∑øms
 = &
iwl8000_ht_∑øms
,

119 .
	gnvm_vî
 = 
IWL8000_NVM_VERSION
,

122 c⁄° 
iwl_cfg
 
	giwl8260_2ac_cfg
 = {

123 .
«me
 = "Intel(R) Dual Band Wireless AC 8260",

124 .
	gfw_«me_¥e
 = 
IWL8000_FW_PRE
,

125 
	gIWL_DEVICE_8260
,

126 .
	ght_∑øms
 = &
iwl8000_ht_∑øms
,

127 .
	gnvm_vî
 = 
IWL8000_NVM_VERSION
,

130 c⁄° 
iwl_cfg
 
	giwl8265_2ac_cfg
 = {

131 .
«me
 = "Intel(R) Dual Band Wireless AC 8265",

132 .
	gfw_«me_¥e
 = 
IWL8265_FW_PRE
,

133 
	gIWL_DEVICE_8265
,

134 .
	ght_∑øms
 = &
iwl8000_ht_∑øms
,

135 .
	gnvm_vî
 = 
IWL8000_NVM_VERSION
,

136 .
	gvht_mu_mimo_suµ‹ãd
 = 
åue
,

139 c⁄° 
iwl_cfg
 
	giwl8275_2ac_cfg
 = {

140 .
«me
 = "Intel(R) Dual Band Wireless AC 8275",

141 .
	gfw_«me_¥e
 = 
IWL8265_FW_PRE
,

142 
	gIWL_DEVICE_8265
,

143 .
	ght_∑øms
 = &
iwl8000_ht_∑øms
,

144 .
	gnvm_vî
 = 
IWL8000_NVM_VERSION
,

145 .
	gvht_mu_mimo_suµ‹ãd
 = 
åue
,

148 c⁄° 
iwl_cfg
 
	giwl4165_2ac_cfg
 = {

149 .
«me
 = "Intel(R) Dual Band Wireless AC 4165",

150 .
	gfw_«me_¥e
 = 
IWL8000_FW_PRE
,

151 
	gIWL_DEVICE_8000
,

152 .
	ght_∑øms
 = &
iwl8000_ht_∑øms
,

153 .
	gnvm_vî
 = 
IWL8000_NVM_VERSION
,

156 
MODULE_FIRMWARE
(
IWL8000_MODULE_FIRMWARE
(
IWL8000_UCODE_API_MAX
));

157 
MODULE_FIRMWARE
(
IWL8265_MODULE_FIRMWARE
(
IWL8265_UCODE_API_MAX
));

	@cfg/9000.c

6 
	~<löux/moduÀ.h
>

7 
	~<löux/°rögify.h
>

8 
	~"iwl-c⁄fig.h
"

9 
	~"fw/fûe.h
"

10 
	~"iwl-¥ph.h
"

13 
	#IWL9000_UCODE_API_MAX
 46

	)

16 
	#IWL9000_UCODE_API_MIN
 30

	)

19 
	#IWL9000_NVM_VERSION
 0x0a1d

	)

22 
	#IWL9000_DCCM_OFFSET
 0x800000

	)

23 
	#IWL9000_DCCM_LEN
 0x18000

	)

24 
	#IWL9000_DCCM2_OFFSET
 0x880000

	)

25 
	#IWL9000_DCCM2_LEN
 0x8000

	)

26 
	#IWL9000_SMEM_OFFSET
 0x400000

	)

27 
	#IWL9000_SMEM_LEN
 0x68000

	)

29 
	#IWL9000_FW_PRE
 "iwlwifi-9000-pu-b0-jf-b0"

	)

30 
	#IWL9260_FW_PRE
 "iwlwifi-9260-th-b0-jf-b0"

	)

31 
	#IWL9000_MODULE_FIRMWARE
(
≠i
) \

32 
IWL9000_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

33 
	#IWL9260_MODULE_FIRMWARE
(
≠i
) \

34 
IWL9260_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

36 c⁄° 
iwl_ba£_∑øms
 
	giwl9000_ba£_∑øms
 = {

37 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_32K
,

38 .
	gnum_of_queues
 = 31,

39 .
	gmax_tfd_queue_size
 = 256,

40 .
	gshadow_øm_suµ‹t
 = 
åue
,

41 .
	gÀd_com≥nßti⁄
 = 57,

42 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

43 .
	gmax_evít_log_size
 = 512,

44 .
	gshadow_ªg_íabÀ
 = 
åue
,

45 .
	gpcõ_l1_Ælowed
 = 
åue
,

48 c⁄° 
iwl_ht_∑øms
 
	giwl9000_ht_∑øms
 = {

49 .
°bc
 = 
åue
,

50 .
	gldpc
 = 
åue
,

51 .
	ght40_b™ds
 = 
BIT
(
NL80211_BAND_2GHZ
Ë| BIT(
NL80211_BAND_5GHZ
),

54 c⁄° 
iwl_â_∑øms
 
	giwl9000_â_∑øms
 = {

55 .
˘_kûl_íåy
 = 115,

56 .
	g˘_kûl_exô
 = 93,

57 .
	g˘_kûl_duøti⁄
 = 5,

58 .
	gdy«mic_smps_íåy
 = 111,

59 .
	gdy«mic_smps_exô
 = 107,

60 .
	gtx_¥Ÿe˘i⁄_íåy
 = 112,

61 .
	gtx_¥Ÿe˘i⁄_exô
 = 105,

62 .
	gtx_backoff
 = {

63 {.
ãm≥øtuª
 = 110, .
	gbackoff
 = 200},

64 {.
	gãm≥øtuª
 = 111, .
	gbackoff
 = 600},

65 {.
	gãm≥øtuª
 = 112, .
	gbackoff
 = 1200},

66 {.
	gãm≥øtuª
 = 113, .
	gbackoff
 = 2000},

67 {.
	gãm≥øtuª
 = 114, .
	gbackoff
 = 4000},

69 .
	gsuµ‹t_˘_kûl
 = 
åue
,

70 .
	gsuµ‹t_dy«mic_smps
 = 
åue
,

71 .
	gsuµ‹t_tx_¥Ÿe˘i⁄
 = 
åue
,

72 .
	gsuµ‹t_tx_backoff
 = 
åue
,

75 
	#IWL_DEVICE_9000
 \

76 .
ucode_≠i_max
 = 
IWL9000_UCODE_API_MAX
, \

77 .
ucode_≠i_mö
 = 
IWL9000_UCODE_API_MIN
, \

78 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

79 .
nvm_hw_£˘i⁄_num
 = 10, \

80 .
n⁄_sh¨ed_™t
 = 
ANT_B
, \

81 .
dccm_off£t
 = 
IWL9000_DCCM_OFFSET
, \

82 .
dccm_Àn
 = 
IWL9000_DCCM_LEN
, \

83 .
dccm2_off£t
 = 
IWL9000_DCCM2_OFFSET
, \

84 .
dccm2_Àn
 = 
IWL9000_DCCM2_LEN
, \

85 .
smem_off£t
 = 
IWL9000_SMEM_OFFSET
, \

86 .
smem_Àn
 = 
IWL9000_SMEM_LEN
, \

87 .
„©uªs
 = 
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
, \

88 .
thîmÆ_∑øms
 = &
iwl9000_â_∑øms
, \

89 .
≠mg_nŸ_suµ‹ãd
 = 
åue
, \

90 .
num_rbds
 = 512, \

91 .
vht_mu_mimo_suµ‹ãd
 = 
åue
, \

92 .
mac_addr_‰om_c§
 = 0x380, \

93 .
nvm_ty≥
 = 
IWL_NVM_EXT
, \

94 .
dbgc_suµ‹ãd
 = 
åue
, \

95 .
mö_umac_îr‹_evít_èbÀ
 = 0x800000, \

96 .
d3_debug_d©a_ba£_addr
 = 0x401000, \

97 .
d3_debug_d©a_Àngth
 = 92 * 1024, \

98 .
ht_∑øms
 = &
iwl9000_ht_∑øms
, \

99 .
nvm_vî
 = 
IWL9000_NVM_VERSION
, \

100 .
m⁄_smem_ªgs
 = { \

101 .
wrôe_±r
 = { \

102 .
addr
 = 
LDBG_M2S_BUF_WPTR
, \

103 .
mask
 = 
LDBG_M2S_BUF_WPTR_VAL_MSK
, \

105 .
cy˛e_˙t
 = { \

106 .
addr
 = 
LDBG_M2S_BUF_WRAP_CNT
, \

107 .
mask
 = 
LDBG_M2S_BUF_WRAP_CNT_VAL_MSK
, \

110 .
m⁄_døm_ªgs
 = { \

111 .
wrôe_±r
 = { \

112 .
addr
 = 
MON_BUFF_WRPTR_VER2
, \

113 .
mask
 = 0xffffffff, \

115 .
cy˛e_˙t
 = { \

116 .
addr
 = 
MON_BUFF_CYCLE_CNT_VER2
, \

117 .
mask
 = 0xffffffff, \

119 }

	)

121 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl9000_å™s_cfg
 = {

122 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_9000
,

123 .
	gba£_∑øms
 = &
iwl9000_ba£_∑øms
,

124 .
	gmq_rx_suµ‹ãd
 = 
åue
,

125 .
	grf_id
 = 
åue
,

128 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl9560_å™s_cfg
 = {

129 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_9000
,

130 .
	gba£_∑øms
 = &
iwl9000_ba£_∑øms
,

131 .
	gmq_rx_suµ‹ãd
 = 
åue
,

132 .
	grf_id
 = 
åue
,

133 .
	göãgøãd
 = 
åue
,

134 .
	gxèl_œãncy
 = 650,

137 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl9560_l⁄g_œãncy_å™s_cfg
 = {

138 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_9000
,

139 .
	gba£_∑øms
 = &
iwl9000_ba£_∑øms
,

140 .
	gmq_rx_suµ‹ãd
 = 
åue
,

141 .
	grf_id
 = 
åue
,

142 .
	göãgøãd
 = 
åue
,

143 .
	gxèl_œãncy
 = 2820,

146 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl9560_sh¨ed_˛k_å™s_cfg
 = {

147 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_9000
,

148 .
	gba£_∑øms
 = &
iwl9000_ba£_∑øms
,

149 .
	gmq_rx_suµ‹ãd
 = 
åue
,

150 .
	grf_id
 = 
åue
,

151 .
	göãgøãd
 = 
åue
,

152 .
	gxèl_œãncy
 = 670,

153 .
	gexåa_phy_cfg_Êags
 = 
FW_PHY_CFG_SHARED_CLK


156 c⁄° 
	giwl9162_«me
[] = "Intel(R) Wireless-AC 9162";

157 c⁄° 
	giwl9260_«me
[] = "Intel(R) Wireless-AC 9260";

158 c⁄° 
	giwl9260_1_«me
[] = "Intel(R) Wireless-AC 9260-1";

159 c⁄° 
	giwl9270_«me
[] = "Intel(R) Wireless-AC 9270";

160 c⁄° 
	giwl9461_«me
[] = "Intel(R) Wireless-AC 9461";

161 c⁄° 
	giwl9462_«me
[] = "Intel(R) Wireless-AC 9462";

162 c⁄° 
	giwl9560_«me
[] = "Intel(R) Wireless-AC 9560";

163 c⁄° 
	giwl9162_160_«me
[] = "Intel(R) Wireless-AC 9162 160MHz";

164 c⁄° 
	giwl9260_160_«me
[] = "Intel(R) Wireless-AC 9260 160MHz";

165 c⁄° 
	giwl9270_160_«me
[] = "Intel(R) Wireless-AC 9270 160MHz";

166 c⁄° 
	giwl9461_160_«me
[] = "Intel(R) Wireless-AC 9461 160MHz";

167 c⁄° 
	giwl9462_160_«me
[] = "Intel(R) Wireless-AC 9462 160MHz";

168 c⁄° 
	giwl9560_160_«me
[] = "Intel(R) Wireless-AC 9560 160MHz";

170 c⁄° 
	giwl9260_kûÀr_1550_«me
[] =

172 c⁄° 
	giwl9560_kûÀr_1550i_«me
[] =

174 c⁄° 
	giwl9560_kûÀr_1550i_160_«me
[] =

176 c⁄° 
	giwl9560_kûÀr_1550s_«me
[] =

178 c⁄° 
	giwl9560_kûÀr_1550s_160_«me
[] =

181 c⁄° 
iwl_cfg
 
	giwl9260_2ac_cfg
 = {

182 .
fw_«me_¥e
 = 
IWL9260_FW_PRE
,

183 
	gIWL_DEVICE_9000
,

186 c⁄° 
iwl_cfg
 
	giwl9560_2ac_cfg_soc
 = {

187 .
fw_«me_¥e
 = 
IWL9000_FW_PRE
,

188 
	gIWL_DEVICE_9000
,

191 
MODULE_FIRMWARE
(
IWL9000_MODULE_FIRMWARE
(
IWL9000_UCODE_API_MAX
));

192 
MODULE_FIRMWARE
(
IWL9260_MODULE_FIRMWARE
(
IWL9000_UCODE_API_MAX
));

	@cfg/ax210.c

6 
	~<löux/moduÀ.h
>

7 
	~<löux/°rögify.h
>

8 
	~"iwl-c⁄fig.h
"

9 
	~"iwl-¥ph.h
"

10 
	~"fw/≠i/txq.h
"

13 
	#IWL_AX210_UCODE_API_MAX
 89

	)

16 
	#IWL_AX210_UCODE_API_MIN
 59

	)

19 
	#IWL_AX210_NVM_VERSION
 0x0a1d

	)

22 
	#IWL_AX210_DCCM_OFFSET
 0x800000

	)

23 
	#IWL_AX210_DCCM_LEN
 0x10000

	)

24 
	#IWL_AX210_DCCM2_OFFSET
 0x880000

	)

25 
	#IWL_AX210_DCCM2_LEN
 0x8000

	)

26 
	#IWL_AX210_SMEM_OFFSET
 0x400000

	)

27 
	#IWL_AX210_SMEM_LEN
 0xD0000

	)

29 
	#IWL_SO_A_JF_B_FW_PRE
 "iwlwifi-so-a0-jf-b0"

	)

30 
	#IWL_SO_A_HR_B_FW_PRE
 "iwlwifi-so-a0-hr-b0"

	)

31 
	#IWL_SO_A_GF_A_FW_PRE
 "iwlwifi-so-a0-gf-a0"

	)

32 
	#IWL_TY_A_GF_A_FW_PRE
 "iwlwifi-ty-a0-gf-a0"

	)

33 
	#IWL_SO_A_GF4_A_FW_PRE
 "iwlwifi-so-a0-gf4-a0"

	)

34 
	#IWL_SO_A_MR_A_FW_PRE
 "iwlwifi-so-a0-mr-a0"

	)

35 
	#IWL_MA_A_HR_B_FW_PRE
 "iwlwifi-ma-a0-hr-b0"

	)

36 
	#IWL_MA_A_GF_A_FW_PRE
 "iwlwifi-ma-a0-gf-a0"

	)

37 
	#IWL_MA_A_GF4_A_FW_PRE
 "iwlwifi-ma-a0-gf4-a0"

	)

38 
	#IWL_MA_A_MR_A_FW_PRE
 "iwlwifi-ma-a0-mr-a0"

	)

39 
	#IWL_MA_B_HR_B_FW_PRE
 "iwlwifi-ma-b0-hr-b0"

	)

40 
	#IWL_MA_B_GF_A_FW_PRE
 "iwlwifi-ma-b0-gf-a0"

	)

41 
	#IWL_MA_B_GF4_A_FW_PRE
 "iwlwifi-ma-b0-gf4-a0"

	)

42 
	#IWL_MA_B_MR_A_FW_PRE
 "iwlwifi-ma-b0-mr-a0"

	)

44 
	#IWL_SO_A_JF_B_MODULE_FIRMWARE
(
≠i
) \

45 
IWL_SO_A_JF_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

46 
	#IWL_SO_A_HR_B_MODULE_FIRMWARE
(
≠i
) \

47 
IWL_SO_A_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

48 
	#IWL_SO_A_GF_A_MODULE_FIRMWARE
(
≠i
) \

49 
IWL_SO_A_GF_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

50 
	#IWL_TY_A_GF_A_MODULE_FIRMWARE
(
≠i
) \

51 
IWL_TY_A_GF_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

52 
	#IWL_MA_A_HR_B_FW_MODULE_FIRMWARE
(
≠i
) \

53 
IWL_MA_A_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

54 
	#IWL_MA_A_GF_A_FW_MODULE_FIRMWARE
(
≠i
) \

55 
IWL_MA_A_GF_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

56 
	#IWL_MA_A_GF4_A_FW_MODULE_FIRMWARE
(
≠i
) \

57 
IWL_MA_A_GF4_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

58 
	#IWL_MA_A_MR_A_FW_MODULE_FIRMWARE
(
≠i
) \

59 
IWL_MA_A_MR_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

60 
	#IWL_MA_B_HR_B_FW_MODULE_FIRMWARE
(
≠i
) \

61 
IWL_MA_B_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

62 
	#IWL_MA_B_GF_A_FW_MODULE_FIRMWARE
(
≠i
) \

63 
IWL_MA_B_GF_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

64 
	#IWL_MA_B_GF4_A_FW_MODULE_FIRMWARE
(
≠i
) \

65 
IWL_MA_B_GF4_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

66 
	#IWL_MA_B_MR_A_FW_MODULE_FIRMWARE
(
≠i
) \

67 
IWL_MA_B_MR_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

69 c⁄° 
iwl_ba£_∑øms
 
	giwl_ax210_ba£_∑øms
 = {

70 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_32K
,

71 .
	gnum_of_queues
 = 512,

72 .
	gmax_tfd_queue_size
 = 65536,

73 .
	gshadow_øm_suµ‹t
 = 
åue
,

74 .
	gÀd_com≥nßti⁄
 = 57,

75 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

76 .
	gmax_evít_log_size
 = 512,

77 .
	gshadow_ªg_íabÀ
 = 
åue
,

78 .
	gpcõ_l1_Ælowed
 = 
åue
,

81 
	#IWL_DEVICE_AX210_COMMON
 \

82 .
ucode_≠i_mö
 = 
IWL_AX210_UCODE_API_MIN
, \

83 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

84 .
nvm_hw_£˘i⁄_num
 = 10, \

85 .
n⁄_sh¨ed_™t
 = 
ANT_B
, \

86 .
dccm_off£t
 = 
IWL_AX210_DCCM_OFFSET
, \

87 .
dccm_Àn
 = 
IWL_AX210_DCCM_LEN
, \

88 .
dccm2_off£t
 = 
IWL_AX210_DCCM2_OFFSET
, \

89 .
dccm2_Àn
 = 
IWL_AX210_DCCM2_LEN
, \

90 .
smem_off£t
 = 
IWL_AX210_SMEM_OFFSET
, \

91 .
smem_Àn
 = 
IWL_AX210_SMEM_LEN
, \

92 .
„©uªs
 = 
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
, \

93 .
≠mg_nŸ_suµ‹ãd
 = 
åue
, \

94 .
å™s
.
mq_rx_suµ‹ãd
 = 
åue
, \

95 .
vht_mu_mimo_suµ‹ãd
 = 
åue
, \

96 .
mac_addr_‰om_c§
 = 0x380, \

97 .
ht_∑øms
 = &
iwl_22000_ht_∑øms
, \

98 .
nvm_vî
 = 
IWL_AX210_NVM_VERSION
, \

99 .
å™s
.
rf_id
 = 
åue
, \

100 .
å™s
.
gí2
 = 
åue
, \

101 .
nvm_ty≥
 = 
IWL_NVM_EXT
, \

102 .
dbgc_suµ‹ãd
 = 
åue
, \

103 .
mö_umac_îr‹_evít_èbÀ
 = 0x400000, \

104 .
d3_debug_d©a_ba£_addr
 = 0x401000, \

105 .
d3_debug_d©a_Àngth
 = 60 * 1024, \

106 .
m⁄_smem_ªgs
 = { \

107 .
wrôe_±r
 = { \

108 .
addr
 = 
LDBG_M2S_BUF_WPTR
, \

109 .
mask
 = 
LDBG_M2S_BUF_WPTR_VAL_MSK
, \

111 .
cy˛e_˙t
 = { \

112 .
addr
 = 
LDBG_M2S_BUF_WRAP_CNT
, \

113 .
mask
 = 
LDBG_M2S_BUF_WRAP_CNT_VAL_MSK
, \

115 }

	)

117 
	#IWL_DEVICE_AX210
 \

118 
IWL_DEVICE_AX210_COMMON
, \

119 .
ucode_≠i_max
 = 
IWL_AX210_UCODE_API_MAX
, \

120 .
å™s
.
umac_¥ph_off£t
 = 0x300000, \

121 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_AX210
, \

122 .
å™s
.
ba£_∑øms
 = &
iwl_ax210_ba£_∑øms
, \

123 .
mö_txq_size
 = 128, \

124 .
gp2_ªg_addr
 = 0xd02c68, \

125 .
mö_ba_txq_size
 = 
IWL_DEFAULT_QUEUE_SIZE_HE
, \

126 .
m⁄_døm_ªgs
 = { \

127 .
wrôe_±r
 = { \

128 .
addr
 = 
DBGC_CUR_DBGBUF_STATUS
, \

129 .
mask
 = 
DBGC_CUR_DBGBUF_STATUS_OFFSET_MSK
, \

131 .
cy˛e_˙t
 = { \

132 .
addr
 = 
DBGC_DBGBUF_WRAP_AROUND
, \

133 .
mask
 = 0xffffffff, \

135 .
cur_‰ag
 = { \

136 .
addr
 = 
DBGC_CUR_DBGBUF_STATUS
, \

137 .
mask
 = 
DBGC_CUR_DBGBUF_STATUS_IDX_MSK
, \

139 }

	)

141 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_so_å™s_cfg
 = {

142 .
mq_rx_suµ‹ãd
 = 
åue
,

143 .
	grf_id
 = 
åue
,

144 .
	ggí2
 = 
åue
,

145 .
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_AX210
,

146 .
	gba£_∑øms
 = &
iwl_ax210_ba£_∑øms
,

147 .
	gumac_¥ph_off£t
 = 0x300000,

148 .
	göãgøãd
 = 
åue
,

150 .
	gxèl_œãncy
 = 500,

151 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_200US
,

154 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_so_l⁄g_œãncy_å™s_cfg
 = {

155 .
mq_rx_suµ‹ãd
 = 
åue
,

156 .
	grf_id
 = 
åue
,

157 .
	ggí2
 = 
åue
,

158 .
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_AX210
,

159 .
	gba£_∑øms
 = &
iwl_ax210_ba£_∑øms
,

160 .
	gumac_¥ph_off£t
 = 0x300000,

161 .
	göãgøãd
 = 
åue
,

162 .
	glow_œãncy_xèl
 = 
åue
,

163 .
	gxèl_œãncy
 = 12000,

164 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_2500US
,

167 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_so_l⁄g_œãncy_imr_å™s_cfg
 = {

168 .
mq_rx_suµ‹ãd
 = 
åue
,

169 .
	grf_id
 = 
åue
,

170 .
	ggí2
 = 
åue
,

171 .
	gdevi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_AX210
,

172 .
	gba£_∑øms
 = &
iwl_ax210_ba£_∑øms
,

173 .
	gumac_¥ph_off£t
 = 0x300000,

174 .
	göãgøãd
 = 
åue
,

175 .
	glow_œãncy_xèl
 = 
åue
,

176 .
	gxèl_œãncy
 = 12000,

177 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_2500US
,

178 .
	gimr_íabÀd
 = 
åue
,

188 
	#IWL_NUM_RBDS_NON_HE
 512

	)

189 
	#IWL_NUM_RBDS_AX210_HE
 4096

	)

191 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_ma_å™s_cfg
 = {

192 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_AX210
,

193 .
	gba£_∑øms
 = &
iwl_ax210_ba£_∑øms
,

194 .
	gmq_rx_suµ‹ãd
 = 
åue
,

195 .
	grf_id
 = 
åue
,

196 .
	ggí2
 = 
åue
,

197 .
	göãgøãd
 = 
åue
,

198 .
	gumac_¥ph_off£t
 = 0x300000

201 c⁄° 
	giwl_ax211_«me
[] = "Intel(R) Wi-Fi 6E AX211 160MHz";

202 c⁄° 
	giwl_ax221_«me
[] = "Intel(R) Wi-Fi 6E AX221 160MHz";

203 c⁄° 
	giwl_ax231_«me
[] = "Intel(R) Wi-Fi 6E AX231 160MHz";

204 c⁄° 
	giwl_ax411_«me
[] = "Intel(R) Wi-Fi 6E AX411 160MHz";

206 c⁄° 
	giwl_ax210_kûÀr_1675w_«me
[] =

208 c⁄° 
	giwl_ax210_kûÀr_1675x_«me
[] =

210 c⁄° 
	giwl_ax211_kûÀr_1675s_«me
[] =

212 c⁄° 
	giwl_ax211_kûÀr_1675i_«me
[] =

214 c⁄° 
	giwl_ax411_kûÀr_1690s_«me
[] =

216 c⁄° 
	giwl_ax411_kûÀr_1690i_«me
[] =

219 c⁄° 
iwl_cfg
 
	giwœx210_2ax_cfg_so_jf_b0
 = {

220 .
«me
 = "Intel(R) Wireless-AC 9560 160MHz",

221 .
	gfw_«me_¥e
 = 
IWL_SO_A_JF_B_FW_PRE
,

222 
	gIWL_DEVICE_AX210
,

223 .
	gnum_rbds
 = 
IWL_NUM_RBDS_NON_HE
,

226 c⁄° 
iwl_cfg
 
	giwœx211_2ax_cfg_so_gf_a0
 = {

227 .
«me
 = 
iwl_ax211_«me
,

228 .
	gfw_«me_¥e
 = 
IWL_SO_A_GF_A_FW_PRE
,

229 .
	guhb_suµ‹ãd
 = 
åue
,

230 
	gIWL_DEVICE_AX210
,

231 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

234 c⁄° 
iwl_cfg
 
	giwœx211_2ax_cfg_so_gf_a0_l⁄g
 = {

235 .
«me
 = 
iwl_ax211_«me
,

236 .
	gfw_«me_¥e
 = 
IWL_SO_A_GF_A_FW_PRE
,

237 .
	guhb_suµ‹ãd
 = 
åue
,

238 
	gIWL_DEVICE_AX210
,

239 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

240 .
	gå™s
.
	gxèl_œãncy
 = 12000,

241 .
	gå™s
.
	glow_œãncy_xèl
 = 
åue
,

244 c⁄° 
iwl_cfg
 
	giwœx210_2ax_cfg_ty_gf_a0
 = {

245 .
«me
 = "Intel(R) Wi-Fi 6 AX210 160MHz",

246 .
	gfw_«me_¥e
 = 
IWL_TY_A_GF_A_FW_PRE
,

247 .
	guhb_suµ‹ãd
 = 
åue
,

248 
	gIWL_DEVICE_AX210
,

249 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

252 c⁄° 
iwl_cfg
 
	giwœx411_2ax_cfg_so_gf4_a0
 = {

253 .
«me
 = 
iwl_ax411_«me
,

254 .
	gfw_«me_¥e
 = 
IWL_SO_A_GF4_A_FW_PRE
,

255 .
	guhb_suµ‹ãd
 = 
åue
,

256 
	gIWL_DEVICE_AX210
,

257 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

260 c⁄° 
iwl_cfg
 
	giwœx411_2ax_cfg_so_gf4_a0_l⁄g
 = {

261 .
«me
 = 
iwl_ax411_«me
,

262 .
	gfw_«me_¥e
 = 
IWL_SO_A_GF4_A_FW_PRE
,

263 .
	guhb_suµ‹ãd
 = 
åue
,

264 
	gIWL_DEVICE_AX210
,

265 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

266 .
	gå™s
.
	gxèl_œãncy
 = 12000,

267 .
	gå™s
.
	glow_œãncy_xèl
 = 
åue
,

270 c⁄° 
iwl_cfg
 
	giwl_cfg_so_a0_ms_a0
 = {

271 .
fw_«me_¥e
 = 
IWL_SO_A_MR_A_FW_PRE
,

272 .
	guhb_suµ‹ãd
 = 
Ál£
,

273 
	gIWL_DEVICE_AX210
,

274 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

277 c⁄° 
iwl_cfg
 
	giwl_cfg_ma
 = {

278 .
fw_«me_mac
 = "ma",

279 .
	guhb_suµ‹ãd
 = 
åue
,

280 
	gIWL_DEVICE_AX210
,

281 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

284 c⁄° 
iwl_cfg
 
	giwl_cfg_so_a0_hr_a0
 = {

285 .
fw_«me_¥e
 = 
IWL_SO_A_HR_B_FW_PRE
,

286 
	gIWL_DEVICE_AX210
,

287 .
	gnum_rbds
 = 
IWL_NUM_RBDS_AX210_HE
,

290 
MODULE_FIRMWARE
(
IWL_SO_A_JF_B_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

291 
MODULE_FIRMWARE
(
IWL_SO_A_HR_B_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

292 
MODULE_FIRMWARE
(
IWL_SO_A_GF_A_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

293 
MODULE_FIRMWARE
(
IWL_TY_A_GF_A_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

294 
MODULE_FIRMWARE
(
IWL_MA_A_HR_B_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

295 
MODULE_FIRMWARE
(
IWL_MA_A_GF_A_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

296 
MODULE_FIRMWARE
(
IWL_MA_A_GF4_A_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

297 
MODULE_FIRMWARE
(
IWL_MA_A_MR_A_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

298 
MODULE_FIRMWARE
(
IWL_MA_B_HR_B_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

299 
MODULE_FIRMWARE
(
IWL_MA_B_GF_A_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

300 
MODULE_FIRMWARE
(
IWL_MA_B_GF4_A_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

301 
MODULE_FIRMWARE
(
IWL_MA_B_MR_A_FW_MODULE_FIRMWARE
(
IWL_AX210_UCODE_API_MAX
));

303 
MODULE_FIRMWARE
("iwlwifi-so-a0-gf-a0.pnvm");

304 
MODULE_FIRMWARE
("iwlwifi-so-a0-gf4-a0.pnvm");

305 
MODULE_FIRMWARE
("iwlwifi-ty-a0-gf-a0.pnvm");

306 
MODULE_FIRMWARE
("iwlwifi-ma-b0-gf-a0.pnvm");

307 
MODULE_FIRMWARE
("iwlwifi-ma-b0-gf4-a0.pnvm");

	@cfg/bz.c

6 
	~<löux/moduÀ.h
>

7 
	~<löux/°rögify.h
>

8 
	~"iwl-c⁄fig.h
"

9 
	~"iwl-¥ph.h
"

10 
	~"fw/≠i/txq.h
"

13 
	#IWL_BZ_UCODE_API_MAX
 89

	)

16 
	#IWL_BZ_UCODE_API_MIN
 80

	)

19 
	#IWL_BZ_NVM_VERSION
 0x0a1d

	)

22 
	#IWL_BZ_DCCM_OFFSET
 0x800000

	)

23 
	#IWL_BZ_DCCM_LEN
 0x10000

	)

24 
	#IWL_BZ_DCCM2_OFFSET
 0x880000

	)

25 
	#IWL_BZ_DCCM2_LEN
 0x8000

	)

26 
	#IWL_BZ_SMEM_OFFSET
 0x400000

	)

27 
	#IWL_BZ_SMEM_LEN
 0xD0000

	)

29 
	#IWL_BZ_A_HR_B_FW_PRE
 "iwlwifi-bz-a0-hr-b0"

	)

30 
	#IWL_BZ_A_GF_A_FW_PRE
 "iwlwifi-bz-a0-gf-a0"

	)

31 
	#IWL_BZ_A_GF4_A_FW_PRE
 "iwlwifi-bz-a0-gf4-a0"

	)

32 
	#IWL_BZ_A_FM_B_FW_PRE
 "iwlwifi-bz-a0-fm-b0"

	)

33 
	#IWL_BZ_A_FM_C_FW_PRE
 "iwlwifi-bz-a0-fm-c0"

	)

34 
	#IWL_BZ_A_FM4_B_FW_PRE
 "iwlwifi-bz-a0-fm4-b0"

	)

35 
	#IWL_GL_B_FM_B_FW_PRE
 "iwlwifi-gl-b0-fm-b0"

	)

36 
	#IWL_GL_C_FM_C_FW_PRE
 "iwlwifi-gl-c0-fm-c0"

	)

38 
	#IWL_BZ_A_HR_B_MODULE_FIRMWARE
(
≠i
) \

39 
IWL_BZ_A_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

40 
	#IWL_BZ_A_GF_A_MODULE_FIRMWARE
(
≠i
) \

41 
IWL_BZ_A_GF_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

42 
	#IWL_BZ_A_GF4_A_MODULE_FIRMWARE
(
≠i
) \

43 
IWL_BZ_A_GF4_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

44 
	#IWL_BZ_A_FM_B_MODULE_FIRMWARE
(
≠i
) \

45 
IWL_BZ_A_FM_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

46 
	#IWL_BZ_A_FM_C_MODULE_FIRMWARE
(
≠i
) \

47 
IWL_BZ_A_FM_C_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

48 
	#IWL_BZ_A_FM4_B_MODULE_FIRMWARE
(
≠i
) \

49 
IWL_BZ_A_FM4_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

50 
	#IWL_GL_B_FM_B_MODULE_FIRMWARE
(
≠i
) \

51 
IWL_GL_B_FM_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

52 
	#IWL_GL_C_FM_C_MODULE_FIRMWARE
(
≠i
) \

53 
IWL_GL_C_FM_C_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

55 c⁄° 
iwl_ba£_∑øms
 
	giwl_bz_ba£_∑øms
 = {

56 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_32K
,

57 .
	gnum_of_queues
 = 512,

58 .
	gmax_tfd_queue_size
 = 65536,

59 .
	gshadow_øm_suµ‹t
 = 
åue
,

60 .
	gÀd_com≥nßti⁄
 = 57,

61 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

62 .
	gmax_evít_log_size
 = 512,

63 .
	gshadow_ªg_íabÀ
 = 
åue
,

64 .
	gpcõ_l1_Ælowed
 = 
åue
,

67 
	#IWL_DEVICE_BZ_COMMON
 \

68 .
ucode_≠i_max
 = 
IWL_BZ_UCODE_API_MAX
, \

69 .
ucode_≠i_mö
 = 
IWL_BZ_UCODE_API_MIN
, \

70 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

71 .
nvm_hw_£˘i⁄_num
 = 10, \

72 .
n⁄_sh¨ed_™t
 = 
ANT_B
, \

73 .
dccm_off£t
 = 
IWL_BZ_DCCM_OFFSET
, \

74 .
dccm_Àn
 = 
IWL_BZ_DCCM_LEN
, \

75 .
dccm2_off£t
 = 
IWL_BZ_DCCM2_OFFSET
, \

76 .
dccm2_Àn
 = 
IWL_BZ_DCCM2_LEN
, \

77 .
smem_off£t
 = 
IWL_BZ_SMEM_OFFSET
, \

78 .
smem_Àn
 = 
IWL_BZ_SMEM_LEN
, \

79 .
≠mg_nŸ_suµ‹ãd
 = 
åue
, \

80 .
å™s
.
mq_rx_suµ‹ãd
 = 
åue
, \

81 .
vht_mu_mimo_suµ‹ãd
 = 
åue
, \

82 .
mac_addr_‰om_c§
 = 0x30, \

83 .
nvm_vî
 = 
IWL_BZ_NVM_VERSION
, \

84 .
å™s
.
rf_id
 = 
åue
, \

85 .
å™s
.
gí2
 = 
åue
, \

86 .
nvm_ty≥
 = 
IWL_NVM_EXT
, \

87 .
dbgc_suµ‹ãd
 = 
åue
, \

88 .
mö_umac_îr‹_evít_èbÀ
 = 0xD0000, \

89 .
d3_debug_d©a_ba£_addr
 = 0x401000, \

90 .
d3_debug_d©a_Àngth
 = 60 * 1024, \

91 .
m⁄_smem_ªgs
 = { \

92 .
wrôe_±r
 = { \

93 .
addr
 = 
LDBG_M2S_BUF_WPTR
, \

94 .
mask
 = 
LDBG_M2S_BUF_WPTR_VAL_MSK
, \

96 .
cy˛e_˙t
 = { \

97 .
addr
 = 
LDBG_M2S_BUF_WRAP_CNT
, \

98 .
mask
 = 
LDBG_M2S_BUF_WRAP_CNT_VAL_MSK
, \

101 .
å™s
.
umac_¥ph_off£t
 = 0x300000, \

102 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_BZ
, \

103 .
å™s
.
ba£_∑øms
 = &
iwl_bz_ba£_∑øms
, \

104 .
mö_txq_size
 = 128, \

105 .
gp2_ªg_addr
 = 0xd02c68, \

106 .
mö_ba_txq_size
 = 
IWL_DEFAULT_QUEUE_SIZE_EHT
, \

107 .
m⁄_døm_ªgs
 = { \

108 .
wrôe_±r
 = { \

109 .
addr
 = 
DBGC_CUR_DBGBUF_STATUS
, \

110 .
mask
 = 
DBGC_CUR_DBGBUF_STATUS_OFFSET_MSK
, \

112 .
cy˛e_˙t
 = { \

113 .
addr
 = 
DBGC_DBGBUF_WRAP_AROUND
, \

114 .
mask
 = 0xffffffff, \

116 .
cur_‰ag
 = { \

117 .
addr
 = 
DBGC_CUR_DBGBUF_STATUS
, \

118 .
mask
 = 
DBGC_CUR_DBGBUF_STATUS_IDX_MSK
, \

121 .
m⁄_dbgi_ªgs
 = { \

122 .
wrôe_±r
 = { \

123 .
addr
 = 
DBGI_SRAM_FIFO_POINTERS
, \

124 .
mask
 = 
DBGI_SRAM_FIFO_POINTERS_WR_PTR_MSK
, \

126 }

	)

128 
	#IWL_DEVICE_BZ
 \

129 
IWL_DEVICE_BZ_COMMON
, \

130 .
ht_∑øms
 = &
iwl_22000_ht_∑øms


	)

136 
	#IWL_NUM_RBDS_BZ_EHT
 (512 * 16)

	)

138 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_bz_å™s_cfg
 = {

139 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_BZ
,

140 .
	gba£_∑øms
 = &
iwl_bz_ba£_∑øms
,

141 .
	gmq_rx_suµ‹ãd
 = 
åue
,

142 .
	grf_id
 = 
åue
,

143 .
	ggí2
 = 
åue
,

144 .
	göãgøãd
 = 
åue
,

145 .
	gumac_¥ph_off£t
 = 0x300000,

146 .
	gxèl_œãncy
 = 12000,

147 .
	glow_œãncy_xèl
 = 
åue
,

148 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_2500US
,

151 c⁄° 
	giwl_bz_«me
[] = "Intel(R) TBD Bz device";

152 c⁄° 
	giwl_mç_«me
[] = "Intel(R) Wi-Fi 7 BE202 160MHz";

154 c⁄° 
iwl_cfg
 
	giwl_cfg_bz
 = {

155 .
fw_«me_mac
 = "bz",

156 .
	guhb_suµ‹ãd
 = 
åue
,

157 
	gIWL_DEVICE_BZ
,

158 .
	g„©uªs
 = 
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
,

159 .
	gnum_rbds
 = 
IWL_NUM_RBDS_BZ_EHT
,

162 c⁄° 
iwl_cfg
 
	giwl_cfg_gl
 = {

163 .
fw_«me_mac
 = "gl",

164 .
	guhb_suµ‹ãd
 = 
åue
,

165 
	gIWL_DEVICE_BZ
,

166 .
	g„©uªs
 = 
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
,

167 .
	gnum_rbds
 = 
IWL_NUM_RBDS_BZ_EHT
,

171 
MODULE_FIRMWARE
(
IWL_BZ_A_HR_B_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

172 
MODULE_FIRMWARE
(
IWL_BZ_A_GF_A_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

173 
MODULE_FIRMWARE
(
IWL_BZ_A_GF4_A_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

174 
MODULE_FIRMWARE
(
IWL_BZ_A_FM_B_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

175 
MODULE_FIRMWARE
(
IWL_BZ_A_FM_C_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

176 
MODULE_FIRMWARE
(
IWL_BZ_A_FM4_B_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

177 
MODULE_FIRMWARE
(
IWL_GL_B_FM_B_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

178 
MODULE_FIRMWARE
(
IWL_GL_C_FM_C_MODULE_FIRMWARE
(
IWL_BZ_UCODE_API_MAX
));

180 
MODULE_FIRMWARE
("iwlwifi-gl-c0-fm-c0.pnvm");

	@cfg/sc.c

6 
	~<löux/moduÀ.h
>

7 
	~<löux/°rögify.h
>

8 
	~"iwl-c⁄fig.h
"

9 
	~"iwl-¥ph.h
"

10 
	~"fw/≠i/txq.h
"

13 
	#IWL_SC_UCODE_API_MAX
 89

	)

16 
	#IWL_SC_UCODE_API_MIN
 82

	)

19 
	#IWL_SC_NVM_VERSION
 0x0a1d

	)

22 
	#IWL_SC_DCCM_OFFSET
 0x800000

	)

23 
	#IWL_SC_DCCM_LEN
 0x10000

	)

24 
	#IWL_SC_DCCM2_OFFSET
 0x880000

	)

25 
	#IWL_SC_DCCM2_LEN
 0x8000

	)

26 
	#IWL_SC_SMEM_OFFSET
 0x400000

	)

27 
	#IWL_SC_SMEM_LEN
 0xD0000

	)

29 
	#IWL_SC_A_FM_B_FW_PRE
 "iwlwifi-sc-a0-fm-b0"

	)

30 
	#IWL_SC_A_FM_C_FW_PRE
 "iwlwifi-sc-a0-fm-c0"

	)

31 
	#IWL_SC_A_HR_A_FW_PRE
 "iwlwifi-sc-a0-hr-b0"

	)

32 
	#IWL_SC_A_HR_B_FW_PRE
 "iwlwifi-sc-a0-hr-b0"

	)

33 
	#IWL_SC_A_GF_A_FW_PRE
 "iwlwifi-sc-a0-gf-a0"

	)

34 
	#IWL_SC_A_GF4_A_FW_PRE
 "iwlwifi-sc-a0-gf4-a0"

	)

35 
	#IWL_SC_A_WH_A_FW_PRE
 "iwlwifi-sc-a0-wh-a0"

	)

36 
	#IWL_SC2_A_FM_C_FW_PRE
 "iwlwifi-sc2-a0-fm-c0"

	)

37 
	#IWL_SC2_A_WH_A_FW_PRE
 "iwlwifi-sc2-a0-wh-a0"

	)

38 
	#IWL_SC2F_A_FM_C_FW_PRE
 "iwlwifi-sc2f-a0-fm-c0"

	)

39 
	#IWL_SC2F_A_WH_A_FW_PRE
 "iwlwifi-sc2f-a0-wh-a0"

	)

41 
	#IWL_SC_A_FM_B_FW_MODULE_FIRMWARE
(
≠i
) \

42 
IWL_SC_A_FM_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

43 
	#IWL_SC_A_FM_C_FW_MODULE_FIRMWARE
(
≠i
) \

44 
IWL_SC_A_FM_C_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

45 
	#IWL_SC_A_HR_A_FW_MODULE_FIRMWARE
(
≠i
) \

46 
IWL_SC_A_HR_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

47 
	#IWL_SC_A_HR_B_FW_MODULE_FIRMWARE
(
≠i
) \

48 
IWL_SC_A_HR_B_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

49 
	#IWL_SC_A_GF_A_FW_MODULE_FIRMWARE
(
≠i
) \

50 
IWL_SC_A_GF_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

51 
	#IWL_SC_A_GF4_A_FW_MODULE_FIRMWARE
(
≠i
) \

52 
IWL_SC_A_GF4_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

53 
	#IWL_SC_A_WH_A_FW_MODULE_FIRMWARE
(
≠i
) \

54 
IWL_SC_A_WH_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

55 
	#IWL_SC2_A_FM_C_FW_MODULE_FIRMWARE
(
≠i
) \

56 
IWL_SC2_A_FM_C_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

57 
	#IWL_SC2_A_WH_A_FW_MODULE_FIRMWARE
(
≠i
) \

58 
IWL_SC2_A_WH_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

59 
	#IWL_SC2F_A_FM_C_FW_MODULE_FIRMWARE
(
≠i
) \

60 
IWL_SC2F_A_FM_C_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

61 
	#IWL_SC2F_A_WH_A_FW_MODULE_FIRMWARE
(
≠i
) \

62 
IWL_SC2F_A_WH_A_FW_PRE
 "-" 
	`__°rögify
(
≠i
Ë".ucode"

	)

64 c⁄° 
iwl_ba£_∑øms
 
	giwl_sc_ba£_∑øms
 = {

65 .
ì¥om_size
 = 
OTP_LOW_IMAGE_SIZE_32K
,

66 .
	gnum_of_queues
 = 512,

67 .
	gmax_tfd_queue_size
 = 65536,

68 .
	gshadow_øm_suµ‹t
 = 
åue
,

69 .
	gÀd_com≥nßti⁄
 = 57,

70 .
	gwd_timeout
 = 
IWL_LONG_WD_TIMEOUT
,

71 .
	gmax_evít_log_size
 = 512,

72 .
	gshadow_ªg_íabÀ
 = 
åue
,

73 .
	gpcõ_l1_Ælowed
 = 
åue
,

76 
	#IWL_DEVICE_BZ_COMMON
 \

77 .
ucode_≠i_max
 = 
IWL_SC_UCODE_API_MAX
, \

78 .
ucode_≠i_mö
 = 
IWL_SC_UCODE_API_MIN
, \

79 .
Àd_mode
 = 
IWL_LED_RF_STATE
, \

80 .
nvm_hw_£˘i⁄_num
 = 10, \

81 .
n⁄_sh¨ed_™t
 = 
ANT_B
, \

82 .
dccm_off£t
 = 
IWL_SC_DCCM_OFFSET
, \

83 .
dccm_Àn
 = 
IWL_SC_DCCM_LEN
, \

84 .
dccm2_off£t
 = 
IWL_SC_DCCM2_OFFSET
, \

85 .
dccm2_Àn
 = 
IWL_SC_DCCM2_LEN
, \

86 .
smem_off£t
 = 
IWL_SC_SMEM_OFFSET
, \

87 .
smem_Àn
 = 
IWL_SC_SMEM_LEN
, \

88 .
≠mg_nŸ_suµ‹ãd
 = 
åue
, \

89 .
å™s
.
mq_rx_suµ‹ãd
 = 
åue
, \

90 .
vht_mu_mimo_suµ‹ãd
 = 
åue
, \

91 .
mac_addr_‰om_c§
 = 0x30, \

92 .
nvm_vî
 = 
IWL_SC_NVM_VERSION
, \

93 .
å™s
.
rf_id
 = 
åue
, \

94 .
å™s
.
gí2
 = 
åue
, \

95 .
nvm_ty≥
 = 
IWL_NVM_EXT
, \

96 .
dbgc_suµ‹ãd
 = 
åue
, \

97 .
mö_umac_îr‹_evít_èbÀ
 = 0xD0000, \

98 .
d3_debug_d©a_ba£_addr
 = 0x401000, \

99 .
d3_debug_d©a_Àngth
 = 60 * 1024, \

100 .
m⁄_smem_ªgs
 = { \

101 .
wrôe_±r
 = { \

102 .
addr
 = 
LDBG_M2S_BUF_WPTR
, \

103 .
mask
 = 
LDBG_M2S_BUF_WPTR_VAL_MSK
, \

105 .
cy˛e_˙t
 = { \

106 .
addr
 = 
LDBG_M2S_BUF_WRAP_CNT
, \

107 .
mask
 = 
LDBG_M2S_BUF_WRAP_CNT_VAL_MSK
, \

110 .
å™s
.
umac_¥ph_off£t
 = 0x300000, \

111 .
å™s
.
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_SC
, \

112 .
å™s
.
ba£_∑øms
 = &
iwl_sc_ba£_∑øms
, \

113 .
mö_txq_size
 = 128, \

114 .
gp2_ªg_addr
 = 0xd02c68, \

115 .
mö_ba_txq_size
 = 
IWL_DEFAULT_QUEUE_SIZE_EHT
, \

116 .
m⁄_døm_ªgs
 = { \

117 .
wrôe_±r
 = { \

118 .
addr
 = 
DBGC_CUR_DBGBUF_STATUS
, \

119 .
mask
 = 
DBGC_CUR_DBGBUF_STATUS_OFFSET_MSK
, \

121 .
cy˛e_˙t
 = { \

122 .
addr
 = 
DBGC_DBGBUF_WRAP_AROUND
, \

123 .
mask
 = 0xffffffff, \

125 .
cur_‰ag
 = { \

126 .
addr
 = 
DBGC_CUR_DBGBUF_STATUS
, \

127 .
mask
 = 
DBGC_CUR_DBGBUF_STATUS_IDX_MSK
, \

130 .
m⁄_dbgi_ªgs
 = { \

131 .
wrôe_±r
 = { \

132 .
addr
 = 
DBGI_SRAM_FIFO_POINTERS
, \

133 .
mask
 = 
DBGI_SRAM_FIFO_POINTERS_WR_PTR_MSK
, \

135 }

	)

137 
	#IWL_DEVICE_SC
 \

138 
IWL_DEVICE_BZ_COMMON
, \

139 .
uhb_suµ‹ãd
 = 
åue
, \

140 .
„©uªs
 = 
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
, \

141 .
num_rbds
 = 
IWL_NUM_RBDS_SC_EHT
, \

142 .
ht_∑øms
 = &
iwl_22000_ht_∑øms


	)

148 
	#IWL_NUM_RBDS_SC_EHT
 (512 * 16)

	)

150 c⁄° 
iwl_cfg_å™s_∑øms
 
	giwl_sc_å™s_cfg
 = {

151 .
devi˚_Ámûy
 = 
IWL_DEVICE_FAMILY_SC
,

152 .
	gba£_∑øms
 = &
iwl_sc_ba£_∑øms
,

153 .
	gmq_rx_suµ‹ãd
 = 
åue
,

154 .
	grf_id
 = 
åue
,

155 .
	ggí2
 = 
åue
,

156 .
	göãgøãd
 = 
åue
,

157 .
	gumac_¥ph_off£t
 = 0x300000,

158 .
	gxèl_œãncy
 = 12000,

159 .
	glow_œãncy_xèl
 = 
åue
,

160 .
	g…r_dñay
 = 
IWL_CFG_TRANS_LTR_DELAY_2500US
,

163 c⁄° 
	giwl_sc_«me
[] = "Intel(R) TBD Sc device";

165 c⁄° 
iwl_cfg
 
	giwl_cfg_sc
 = {

166 .
fw_«me_mac
 = "sc",

167 
	gIWL_DEVICE_SC
,

170 c⁄° 
	giwl_sc2_«me
[] = "Intel(R) TBD Sc2 device";

172 c⁄° 
iwl_cfg
 
	giwl_cfg_sc2
 = {

173 .
fw_«me_mac
 = "sc2",

174 
	gIWL_DEVICE_SC
,

177 c⁄° 
	giwl_sc2f_«me
[] = "Intel(R) TBD Sc2f device";

179 c⁄° 
iwl_cfg
 
	giwl_cfg_sc2f
 = {

180 .
fw_«me_mac
 = "sc2f",

181 
	gIWL_DEVICE_SC
,

184 
MODULE_FIRMWARE
(
IWL_SC_A_FM_B_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

185 
MODULE_FIRMWARE
(
IWL_SC_A_FM_C_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

186 
MODULE_FIRMWARE
(
IWL_SC_A_HR_A_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

187 
MODULE_FIRMWARE
(
IWL_SC_A_HR_B_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

188 
MODULE_FIRMWARE
(
IWL_SC_A_GF_A_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

189 
MODULE_FIRMWARE
(
IWL_SC_A_GF4_A_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

190 
MODULE_FIRMWARE
(
IWL_SC_A_WH_A_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

191 
MODULE_FIRMWARE
(
IWL_SC2_A_FM_C_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

192 
MODULE_FIRMWARE
(
IWL_SC2_A_WH_A_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

193 
MODULE_FIRMWARE
(
IWL_SC2F_A_FM_C_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

194 
MODULE_FIRMWARE
(
IWL_SC2F_A_WH_A_FW_MODULE_FIRMWARE
(
IWL_SC_UCODE_API_MAX
));

	@dvm/agn.h

5 #i‚de‡
__iwl_agn_h__


6 
	#__iwl_agn_h__


	)

8 
	~"iwl-c⁄fig.h
"

10 
	~"dev.h
"

13 
	#IWLAGN_FIRST_AMPDU_QUEUE
 11

	)

16 
	#IWL_AUX_QUEUE
 10

	)

18 
	#IWL_INVALID_STATION
 255

	)

21 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_1000_cfg
;

22 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_2000_cfg
;

23 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_105_cfg
;

24 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_2030_cfg
;

25 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_5000_cfg
;

26 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_5150_cfg
;

27 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_6000_cfg
;

28 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_6005_cfg
;

29 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_6050_cfg
;

30 c⁄° 
iwl_dvm_cfg
 
iwl_dvm_6030_cfg
;

33 
	#TIME_UNIT
 1024

	)

38 
	#STATUS_RF_KILL_HW
 0

	)

39 
	#STATUS_CT_KILL
 1

	)

40 
	#STATUS_ALIVE
 2

	)

41 
	#STATUS_READY
 3

	)

42 
	#STATUS_EXIT_PENDING
 5

	)

43 
	#STATUS_STATISTICS
 6

	)

44 
	#STATUS_SCANNING
 7

	)

45 
	#STATUS_SCAN_ABORTING
 8

	)

46 
	#STATUS_SCAN_HW
 9

	)

47 
	#STATUS_FW_ERROR
 10

	)

48 
	#STATUS_CHANNEL_SWITCH_PENDING
 11

	)

49 
	#STATUS_SCAN_COMPLETE
 12

	)

50 
	#STATUS_POWER_PMI
 13

	)

52 
	giwl_ucode_ˇ∑bûôõs
;

54 c⁄° 
õì80211_›s
 
iwœgn_hw_›s
;

56 
ölöe
 
	$iwl_£t_ˇlib_hdr
(
iwl_ˇlib_hdr
 *
hdr
, 
u8
 
cmd
)

58 
hdr
->
›_code
 = 
cmd
;

59 
hdr
->
fú°_group
 = 0;

60 
hdr
->
groups_num
 = 1;

61 
hdr
->
d©a_vÆid
 = 1;

62 
	}
}

64 
iwl_down
(
iwl_¥iv
 *
¥iv
);

65 
iwl_ˇn˚l_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
);

66 
iwœgn_¥ï¨e_ª°¨t
(
iwl_¥iv
 *
¥iv
);

67 
iwl_rx_di•©ch
(
iwl_›_mode
 *
›_mode
, 
«pi_°ru˘
 *
«pi
,

68 
iwl_rx_cmd_buf„r
 *
rxb
);

70 
boﬁ
 
iwl_check_f‹_˘_kûl
(
iwl_¥iv
 *
¥iv
);

72 
iwœgn_li·_∑ssive_no_rx
(
iwl_¥iv
 *
¥iv
);

75 
õì80211_hw
 *
iwl_Æloc_Æl
();

76 
iwœgn_mac_£tup_ªgi°î
(
iwl_¥iv
 *
¥iv
,

77 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
);

78 
iwœgn_mac_uƒegi°î
(
iwl_¥iv
 *
¥iv
);

81 
iwl_dvm_£nd_cmd
(
iwl_¥iv
 *
¥iv
, 
iwl_ho°_cmd
 *
cmd
);

82 
iwl_dvm_£nd_cmd_pdu
(
iwl_¥iv
 *
¥iv
, 
u8
 
id
,

83 
u32
 
Êags
, 
u16
 
Àn
, c⁄° *
d©a
);

86 
iwl_c⁄√˘i⁄_öô_rx_c⁄fig
(
iwl_¥iv
 *
¥iv
,

87 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

88 
iwœgn_£t_∑n_∑øms
(
iwl_¥iv
 *
¥iv
);

89 
iwœgn_commô_rx⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

90 
iwœgn_£t_rx⁄_chaö
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

91 
iwœgn_mac_c⁄fig
(
õì80211_hw
 *
hw
, 
u32
 
ch™ged
);

92 
iwœgn_bss_öfo_ch™ged
(
õì80211_hw
 *
hw
,

93 
õì80211_vif
 *
vif
,

94 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

95 
u64
 
ch™ges
);

96 
iwœgn_c⁄fig_ht40
(
õì80211_c⁄f
 *
c⁄f
,

97 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

98 
iwl_£t_rx⁄_ht
(
iwl_¥iv
 *
¥iv
, 
iwl_ht_c⁄fig
 *
ht_c⁄f
);

99 
iwl_£t_rx⁄_ch™√l
(
iwl_¥iv
 *
¥iv
, 
õì80211_ch™√l
 *
ch
,

100 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

101 
iwl_£t_Êags_f‹_b™d
(
iwl_¥iv
 *
¥iv
,

102 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

103 
∆80211_b™d
 
b™d
,

104 
õì80211_vif
 *
vif
);

107 
iwl_£nd_bt_ív
(
iwl_¥iv
 *
¥iv
, 
u8
 
a˘i⁄
, u8 
ty≥
);

108 
iwl_£nd_¥io_tbl
(
iwl_¥iv
 *
¥iv
);

109 
iwl_öô_Æive_°¨t
(
iwl_¥iv
 *
¥iv
);

110 
iwl_run_öô_ucode
(
iwl_¥iv
 *
¥iv
);

111 
iwl_lﬂd_ucode_waô_Æive
(
iwl_¥iv
 *
¥iv
,

112 
iwl_ucode_ty≥
 
ucode_ty≥
);

113 
iwl_£nd_ˇlib_ªsu…s
(
iwl_¥iv
 *
¥iv
);

114 
iwl_ˇlib_£t
(
iwl_¥iv
 *
¥iv
,

115 c⁄° 
iwl_ˇlib_cmd
 *
cmd
, 
size_t
 
Àn
);

116 
iwl_ˇlib_‰ì_ªsu…s
(
iwl_¥iv
 *
¥iv
);

117 
iwl_dump_nic_evít_log
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
fuŒ_log
,

118 **
buf
);

119 
iwœgn_hw_vÆid_πc_d©a_addr
(
u32
 
addr
);

122 
iwœgn_£nd_tx_powî
(
iwl_¥iv
 *
¥iv
);

123 
iwœgn_ãm≥øtuª
(
iwl_¥iv
 *
¥iv
);

124 
iwœgn_txfifo_Êush
(
iwl_¥iv
 *
¥iv
, 
u32
 
scd_q_msk
);

125 
iwœgn_dev_txfifo_Êush
(
iwl_¥iv
 *
¥iv
);

126 
iwœgn_£nd_bóc⁄_cmd
(
iwl_¥iv
 *
¥iv
);

127 
iwl_£nd_°©i°ics_ªque°
(
iwl_¥iv
 *
¥iv
,

128 
u8
 
Êags
, 
boﬁ
 
˛ór
);

130 
ölöe
 c⁄° 
õì80211_suµ‹ãd_b™d
 *
	$iwl_gë_hw_mode
(

131 
iwl_¥iv
 *
¥iv
, 
∆80211_b™d
 
b™d
)

133  
¥iv
->
hw
->
wùhy
->
b™ds
[
b™d
];

134 
	}
}

136 #ifde‡
CONFIG_PM_SLEEP


137 
iwœgn_£nd_∑âîns
(
iwl_¥iv
 *
¥iv
,

138 
cfg80211_wowœn
 *
wowœn
);

139 
iwœgn_su•íd
(
iwl_¥iv
 *
¥iv
, 
cfg80211_wowœn
 *
wowœn
);

143 
iwœgn_hwøã_to_mac80211_idx
(
u32
 
øã_n_Êags
, 
∆80211_b™d
 
b™d
);

144 
iwl_£tup_rx_h™dÀrs
(
iwl_¥iv
 *
¥iv
);

145 
iwl_chswôch_d⁄e
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
is_suc˚ss
);

149 
iwœgn_tx_skb
(
iwl_¥iv
 *
¥iv
,

150 
õì80211_°a
 *
°a
,

151 
sk_buff
 *
skb
);

152 
iwœgn_tx_agg_°¨t
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

153 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 *
s¢
);

154 
iwœgn_tx_agg_›î
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

155 
õì80211_°a
 *
°a
, 
u16
 
tid
, 
u8
 
buf_size
);

156 
iwœgn_tx_agg_°›
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

157 
õì80211_°a
 *
°a
, 
u16
 
tid
);

158 
iwœgn_tx_agg_Êush
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

159 
õì80211_°a
 *
°a
, 
u16
 
tid
);

160 
iwœgn_rx_ª∂y_com¥es£d_ba
(
iwl_¥iv
 *
¥iv
,

161 
iwl_rx_cmd_buf„r
 *
rxb
);

162 
iwœgn_rx_ª∂y_tx
(
iwl_¥iv
 *
¥iv
, 
iwl_rx_cmd_buf„r
 *
rxb
);

164 
ölöe
 
u32
 
	$iwl_tx_°©us_to_mac80211
(
u32
 
°©us
)

166 
°©us
 &
TX_STATUS_MSK
;

168 
°©us
) {

169 
TX_STATUS_SUCCESS
:

170 
TX_STATUS_DIRECT_DONE
:

171  
IEEE80211_TX_STAT_ACK
;

172 
TX_STATUS_FAIL_DEST_PS
:

173 
TX_STATUS_FAIL_PASSIVE_NO_RX
:

174  
IEEE80211_TX_STAT_TX_FILTERED
;

178 
	}
}

180 
ölöe
 
boﬁ
 
	$iwl_is_tx_suc˚ss
(
u32
 
°©us
)

182 
°©us
 &
TX_STATUS_MSK
;

183  (
°©us
 =
TX_STATUS_SUCCESS
) ||

184 (
°©us
 =
TX_STATUS_DIRECT_DONE
);

185 
	}
}

187 
u8
 
iwl_toggÀ_tx_™t
(
iwl_¥iv
 *
¥iv
, u8 
™t_idx
, u8 
vÆid
);

190 
iwœgn_po°_sˇn
(
iwl_¥iv
 *
¥iv
);

191 
iwl_f‹˚_rf_ª£t
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
exã∫Æ
);

192 
iwl_öô_sˇn_∑øms
(
iwl_¥iv
 *
¥iv
);

193 
iwl_sˇn_ˇn˚l
(
iwl_¥iv
 *
¥iv
);

194 
iwl_sˇn_ˇn˚l_timeout
(
iwl_¥iv
 *
¥iv
, 
ms
);

195 
iwl_f‹˚_sˇn_íd
(
iwl_¥iv
 *
¥iv
);

196 
iwl_öã∫Æ_sh‹t_hw_sˇn
(
iwl_¥iv
 *
¥iv
);

197 
iwl_£tup_rx_sˇn_h™dÀrs
(
iwl_¥iv
 *
¥iv
);

198 
iwl_£tup_sˇn_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
);

199 
iwl_ˇn˚l_sˇn_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
);

200 
__mu°_check
 
iwl_sˇn_öôüã
(
iwl_¥iv
 *
¥iv
,

201 
õì80211_vif
 *
vif
,

202 
iwl_sˇn_ty≥
 
sˇn_ty≥
,

203 
∆80211_b™d
 
b™d
);

211 
	#IWL_ACTIVE_QUIET_TIME
 
	`˝u_to_À16
(10Ë

	)

212 
	#IWL_PLCP_QUIET_THRESH
 
	`˝u_to_À16
(1Ë

	)

214 
	#IWL_SCAN_CHECK_WATCHDOG
 (
HZ
 * 15)

	)

218 
iwœgn_£nd_adv™˚_bt_c⁄fig
(
iwl_¥iv
 *
¥iv
);

219 
iwœgn_bt_rx_h™dÀr_£tup
(
iwl_¥iv
 *
¥iv
);

220 
iwœgn_bt_£tup_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
);

221 
iwœgn_bt_ˇn˚l_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
);

222 
iwœgn_bt_c€x_rssi_m⁄ô‹
(
iwl_¥iv
 *
¥iv
);

223 
iwœgn_bt_adju°_rssi_m⁄ô‹
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
rssi_ía
);

225 
ölöe
 
boﬁ
 
	$iwl_adv™˚d_bt_c€xi°
(
iwl_¥iv
 *
¥iv
)

227  
¥iv
->
lib
->
bt_∑øms
 &&

228 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
;

229 
	}
}

231 #ifde‡
CONFIG_IWLWIFI_DEBUG


232 c⁄° *
iwl_gë_tx_Áû_ªas⁄
(
u32
 
°©us
);

233 c⁄° *
iwl_gë_agg_tx_Áû_ªas⁄
(
u16
 
°©us
);

235 
ölöe
 c⁄° *
	$iwl_gë_tx_Áû_ªas⁄
(
u32
 
°©us
Ë{  ""; 
	}
}

236 
ölöe
 c⁄° *
	$iwl_gë_agg_tx_Áû_ªas⁄
(
u16
 
°©us
Ë{  ""; 
	}
}

241 
iwœgn_m™age_ibss_°©i⁄
(
iwl_¥iv
 *
¥iv
,

242 
õì80211_vif
 *
vif
, 
boﬁ
 
add
);

243 
	#IWL_STA_DRIVER_ACTIVE
 
	`BIT
(0Ë

	)

244 
	#IWL_STA_UCODE_ACTIVE
 
	`BIT
(1Ë

	)

245 
	#IWL_STA_UCODE_INPROGRESS
 
	`BIT
(2Ë

	)

247 
	#IWL_STA_LOCAL
 
	`BIT
(3Ë

	)

249 
	#IWL_STA_BCAST
 
	`BIT
(4Ë

	)

252 
iwl_ª°‹e_°©i⁄s
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

253 
iwl_˛ór_ucode_°©i⁄s
(
iwl_¥iv
 *
¥iv
,

254 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

255 
iwl_dóŒoc_bˇ°_°©i⁄s
(
iwl_¥iv
 *
¥iv
);

256 
iwl_gë_‰ì_ucode_key_off£t
(
iwl_¥iv
 *
¥iv
);

257 
iwl_£nd_add_°a
(
iwl_¥iv
 *
¥iv
,

258 
iwl_add°a_cmd
 *
°a
, 
u8
 
Êags
);

259 
iwl_add_°©i⁄_comm⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

260 c⁄° 
u8
 *
addr
, 
boﬁ
 
is_≠
,

261 
õì80211_°a
 *
°a
, 
u8
 *
°a_id_r
);

262 
iwl_ªmove_°©i⁄
(
iwl_¥iv
 *
¥iv
, c⁄° 
u8
 
°a_id
,

263 c⁄° 
u8
 *
addr
);

264 
iwl_dó˘iv©e_°©i⁄
(
iwl_¥iv
 *
¥iv
, c⁄° 
u8
 
°a_id
,

265 c⁄° 
u8
 *
addr
);

266 
u8
 
iwl_¥ï_°©i⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

267 c⁄° 
u8
 *
addr
, 
boﬁ
 
is_≠
, 
õì80211_°a
 *
°a
);

269 
iwl_£nd_lq_cmd
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

270 
iwl_lök_quÆôy_cmd
 *
lq
, 
u8
 
Êags
, 
boﬁ
 
öô
);

271 
iwl_add_°a_ˇŒback
(
iwl_¥iv
 *
¥iv
, 
iwl_rx_cmd_buf„r
 *
rxb
);

272 
iwl_°a_upd©e_ht
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

273 
õì80211_°a
 *
°a
);

275 
boﬁ
 
iwl_is_ht40_tx_Ælowed
(
iwl_¥iv
 *
¥iv
,

276 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

277 
õì80211_°a
 *
°a
);

279 
ölöe
 
	$iwl_°a_id
(
õì80211_°a
 *
°a
)

281 i‡(
	`WARN_ON
(!
°a
))

282  
IWL_INVALID_STATION
;

284  ((
iwl_°©i⁄_¥iv
 *)
°a
->
drv_¥iv
)->
°a_id
;

285 
	}
}

287 
iwœgn_Æloc_bˇ°_°©i⁄
(
iwl_¥iv
 *
¥iv
,

288 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

289 
iwœgn_add_bssid_°©i⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

290 c⁄° 
u8
 *
addr
, u8 *
°a_id_r
);

291 
iwl_ªmove_deÁu…_wï_key
(
iwl_¥iv
 *
¥iv
,

292 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

293 
õì80211_key_c⁄f
 *
key
);

294 
iwl_£t_deÁu…_wï_key
(
iwl_¥iv
 *
¥iv
,

295 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

296 
õì80211_key_c⁄f
 *
key
);

297 
iwl_ª°‹e_deÁu…_wï_keys
(
iwl_¥iv
 *
¥iv
,

298 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

299 
iwl_£t_dy«mic_key
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

300 
õì80211_key_c⁄f
 *
key
,

301 
õì80211_°a
 *
°a
);

302 
iwl_ªmove_dy«mic_key
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

303 
õì80211_key_c⁄f
 *
key
,

304 
õì80211_°a
 *
°a
);

305 
iwl_upd©e_tkù_key
(
iwl_¥iv
 *
¥iv
,

306 
õì80211_vif
 *
vif
,

307 
õì80211_key_c⁄f
 *
keyc⁄f
,

308 
õì80211_°a
 *
°a
, 
u32
 
iv32
, 
u16
 *
pha£1key
);

309 
iwl_°a_tx_modify_íabÀ_tid
(
iwl_¥iv
 *
¥iv
, 
°a_id
, 
tid
);

310 
iwl_°a_rx_agg_°¨t
(
iwl_¥iv
 *
¥iv
, 
õì80211_°a
 *
°a
,

311 
tid
, 
u16
 
s¢
);

312 
iwl_°a_rx_agg_°›
(
iwl_¥iv
 *
¥iv
, 
õì80211_°a
 *
°a
,

313 
tid
);

314 
iwl_°a_modify_¶ìp_tx_cou¡
(
iwl_¥iv
 *
¥iv
, 
°a_id
, 
˙t
);

315 
iwl_upd©e_bˇ°_°©i⁄
(
iwl_¥iv
 *
¥iv
,

316 
iwl_rx⁄_c⁄ãxt
 *
˘x
);

317 
iwl_upd©e_bˇ°_°©i⁄s
(
iwl_¥iv
 *
¥iv
);

320 
ölöe
 
u32
 
	$iwl_™t_idx_to_Êags
(
u8
 
™t_idx
)

322  
	`BIT
(
™t_idx
Ë<< 
RATE_MCS_ANT_POS
;

323 
	}
}

325 
ölöe
 
u8
 
	$iwl_hw_gë_øã
(
__À32
 
øã_n_Êags
)

327  
	`À32_to_˝u
(
øã_n_Êags
Ë& 
RATE_MCS_RATE_MSK
;

328 
	}
}

330 
ölöe
 
__À32
 
	$iwl_hw_£t_øã_n_Êags
(
u8
 
øã
, 
u32
 
Êags
)

332  
	`˝u_to_À32
(
Êags
|(
u32
)
øã
);

333 
	}
}

335 
iwl_Æive_°¨t
(
iwl_¥iv
 *
¥iv
);

337 #ifde‡
CONFIG_IWLWIFI_DEBUG


338 
iwl_¥öt_rx_c⁄fig_cmd
(
iwl_¥iv
 *
¥iv
,

339 
iwl_rx⁄_c⁄ãxt_id
 
˘xid
);

341 
ölöe
 
	$iwl_¥öt_rx_c⁄fig_cmd
(
iwl_¥iv
 *
¥iv
,

342 
iwl_rx⁄_c⁄ãxt_id
 
˘xid
)

344 
	}
}

349 
ölöe
 
	$iwl_is_ªady
(
iwl_¥iv
 *
¥iv
)

352  
	`ã°_bô
(
STATUS_READY
, &
¥iv
->
°©us
) &&

353 !
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
);

354 
	}
}

356 
ölöe
 
	$iwl_is_Æive
(
iwl_¥iv
 *
¥iv
)

358  
	`ã°_bô
(
STATUS_ALIVE
, &
¥iv
->
°©us
);

359 
	}
}

361 
ölöe
 
	$iwl_is_rfkûl
(
iwl_¥iv
 *
¥iv
)

363  
	`ã°_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
);

364 
	}
}

366 
ölöe
 
	$iwl_is_˘kûl
(
iwl_¥iv
 *
¥iv
)

368  
	`ã°_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

369 
	}
}

371 
ölöe
 
	$iwl_is_ªady_rf
(
iwl_¥iv
 *
¥iv
)

373 i‡(
	`iwl_is_rfkûl
(
¥iv
))

376  
	`iwl_is_ªady
(
¥iv
);

377 
	}
}

379 
ölöe
 
	$iwl_dvm_£t_pmi
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
°©e
)

381 i‡(
°©e
)

382 
	`£t_bô
(
STATUS_POWER_PMI
, &
¥iv
->
°©us
);

384 
	`˛ór_bô
(
STATUS_POWER_PMI
, &
¥iv
->
°©us
);

385 
	`iwl_å™s_£t_pmi
(
¥iv
->
å™s
, 
°©e
);

386 
	}
}

388 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


389 
iwl_dbgfs_ªgi°î
(
iwl_¥iv
 *
¥iv
, 
díåy
 *
dbgfs_dú
);

391 
ölöe
 
	$iwl_dbgfs_ªgi°î
(
iwl_¥iv
 *
¥iv
,

392 
díåy
 *
dbgfs_dú
Ë{ 
	}
}

395 #ifde‡
CONFIG_IWLWIFI_DEBUG


396 
	#IWL_DEBUG_QUIET_RFKILL
(
m
, 
fmt
, 
¨gs
...) \

398 i‡(!
	`iwl_is_rfkûl
((
m
))) \

399 
	`IWL_ERR
(
m
, 
fmt
, ##
¨gs
); \

401 
	`__iwl_îr
((
m
)->
dev
, \

402 
	`iwl_have_debug_Àvñ
(
IWL_DL_RADIO
) ? \

403 
IWL_ERR_MODE_RFKILL
 : \

404 
IWL_ERR_MODE_TRACE_ONLY
, \

405 
fmt
, ##
¨gs
); \

406 } 0)

	)

408 
	#IWL_DEBUG_QUIET_RFKILL
(
m
, 
fmt
, 
¨gs
...) \

410 i‡(!
	`iwl_is_rfkûl
((
m
))) \

411 
	`IWL_ERR
(
m
, 
fmt
, ##
¨gs
); \

413 
	`__iwl_îr
((
m
)->
dev
, 
IWL_ERR_MODE_TRACE_ONLY
, \

414 
fmt
, ##
¨gs
); \

415 } 0)

	)

	@dvm/calib.c

5 
	~<löux/¶ab.h
>

6 
	~<√t/mac80211.h
>

8 
	~"iwl-å™s.h
"

10 
	~"dev.h
"

11 
	~"ˇlib.h
"

12 
	~"agn.h
"

19 
	siwl_ˇlib_ªsu…
 {

20 
li°_hód
 
	mli°
;

21 
size_t
 
	mcmd_Àn
;

22 
iwl_ˇlib_cmd
 
	mcmd
;

25 
	s°©i°ics_gíîÆ_d©a
 {

26 
u32
 
	mbóc⁄_sûí˚_rssi_a
;

27 
u32
 
	mbóc⁄_sûí˚_rssi_b
;

28 
u32
 
	mbóc⁄_sûí˚_rssi_c
;

29 
u32
 
	mbóc⁄_íîgy_a
;

30 
u32
 
	mbóc⁄_íîgy_b
;

31 
u32
 
	mbóc⁄_íîgy_c
;

34 
	$iwl_£nd_ˇlib_ªsu…s
(
iwl_¥iv
 *
¥iv
)

36 
iwl_ho°_cmd
 
hcmd
 = {

37 .
id
 = 
REPLY_PHY_CALIBRATION_CMD
,

39 
iwl_ˇlib_ªsu…
 *
ªs
;

41 
	`li°_f‹_óch_íåy
(
ªs
, &
¥iv
->
ˇlib_ªsu…s
, 
li°
) {

42 
ªt
;

44 
hcmd
.
Àn
[0] = 
ªs
->
cmd_Àn
;

45 
hcmd
.
d©a
[0] = &
ªs
->
cmd
;

46 
hcmd
.
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
;

47 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
hcmd
);

48 i‡(
ªt
) {

49 
	`IWL_ERR
(
¥iv
, "Error %d on calib cmd %d\n",

50 
ªt
, 
ªs
->
cmd
.
hdr
.
›_code
);

51  
ªt
;

56 
	}
}

58 
	$iwl_ˇlib_£t
(
iwl_¥iv
 *
¥iv
,

59 c⁄° 
iwl_ˇlib_cmd
 *
cmd
, 
size_t
 
Àn
)

61 
iwl_ˇlib_ªsu…
 *
ªs
, *
tmp
;

63 i‡(
	`check_sub_ovîÊow
(
Àn
, (*
cmd
), &len))

64  -
ENOMEM
;

66 
ªs
 = 
	`kmÆloc
(
	`°ru˘_size
‘es, 
cmd
.
d©a
, 
Àn
), 
GFP_ATOMIC
);

67 i‡(!
ªs
)

68  -
ENOMEM
;

69 
ªs
->
cmd
 = *cmd;

70 
	`mem˝y
(
ªs
->
cmd
.
d©a
, cmd->d©a, 
Àn
);

71 
ªs
->
cmd_Àn
 = 
	`°ru˘_size
(
cmd
, 
d©a
, 
Àn
);

73 
	`li°_f‹_óch_íåy
(
tmp
, &
¥iv
->
ˇlib_ªsu…s
, 
li°
) {

74 i‡(
tmp
->
cmd
.
hdr
.
›_code
 =
ªs
->cmd.hdr.op_code) {

75 
	`li°_ª∂a˚
(&
tmp
->
li°
, &
ªs
->list);

76 
	`k‰ì
(
tmp
);

82 
	`li°_add_èû
(&
ªs
->
li°
, &
¥iv
->
ˇlib_ªsu…s
);

85 
	}
}

87 
	$iwl_ˇlib_‰ì_ªsu…s
(
iwl_¥iv
 *
¥iv
)

89 
iwl_ˇlib_ªsu…
 *
ªs
, *
tmp
;

91 
	`li°_f‹_óch_íåy_ß„
(
ªs
, 
tmp
, &
¥iv
->
ˇlib_ªsu…s
, 
li°
) {

92 
	`li°_dñ
(&
ªs
->
li°
);

93 
	`k‰ì
(
ªs
);

95 
	}
}

109 
	$iwl_£ns_íîgy_cck
(
iwl_¥iv
 *
¥iv
,

110 
u32
 
n‹m_Á
,

111 
u32
 
rx_íabÀ_time
,

112 
°©i°ics_gíîÆ_d©a
 *
rx_öfo
)

114 
u32
 
max_ƒg_cck
 = 0;

115 
i
 = 0;

116 
u8
 
max_sûí˚_rssi
 = 0;

117 
u32
 
sûí˚_ªf
 = 0;

118 
u8
 
sûí˚_rssi_a
 = 0;

119 
u8
 
sûí˚_rssi_b
 = 0;

120 
u8
 
sûí˚_rssi_c
 = 0;

121 
u32
 
vÆ
;

132 
u32
 
Ál£_Æ¨ms
 = 
n‹m_Á
 * 200 * 1024;

133 
u32
 
max_Ál£_Æ¨ms
 = 
MAX_FA_CCK
 * 
rx_íabÀ_time
;

134 
u32
 
mö_Ál£_Æ¨ms
 = 
MIN_FA_CCK
 * 
rx_íabÀ_time
;

135 
iwl_£nsôivôy_d©a
 *
d©a
 = 
NULL
;

136 c⁄° 
iwl_£nsôivôy_ønges
 *
ønges
 = 
¥iv
->
hw_∑øms
.
£ns
;

138 
d©a
 = &(
¥iv
->
£nsôivôy_d©a
);

140 
d©a
->
ƒg_auto_c‹r_sûí˚_diff
 = 0;

145 
sûí˚_rssi_a
 = (
u8
)((
rx_öfo
->
bóc⁄_sûí˚_rssi_a
 &

146 
ALL_BAND_FILTER
) >> 8);

147 
sûí˚_rssi_b
 = (
u8
)((
rx_öfo
->
bóc⁄_sûí˚_rssi_b
 &

148 
ALL_BAND_FILTER
) >> 8);

149 
sûí˚_rssi_c
 = (
u8
)((
rx_öfo
->
bóc⁄_sûí˚_rssi_c
 &

150 
ALL_BAND_FILTER
) >> 8);

152 
vÆ
 = 
	`max
(
sûí˚_rssi_b
, 
sûí˚_rssi_c
);

153 
max_sûí˚_rssi
 = 
	`max
(
sûí˚_rssi_a
, (
u8
Ë
vÆ
);

156 
d©a
->
ƒg_sûí˚_rssi
[d©a->
ƒg_sûí˚_idx
] = 
max_sûí˚_rssi
;

157 
d©a
->
ƒg_sûí˚_idx
++;

158 i‡(
d©a
->
ƒg_sûí˚_idx
 >
NRG_NUM_PREV_STAT_L
)

159 
d©a
->
ƒg_sûí˚_idx
 = 0;

162 
i
 = 0; i < 
NRG_NUM_PREV_STAT_L
; i++) {

163 
vÆ
 = 
d©a
->
ƒg_sûí˚_rssi
[
i
];

164 
sûí˚_ªf
 = 
	`max
(sûí˚_ªf, 
vÆ
);

166 
	`IWL_DEBUG_CALIB
(
¥iv
, "silenceá %u, b %u, c %u, 20-bcn max %u\n",

167 
sûí˚_rssi_a
, 
sûí˚_rssi_b
, 
sûí˚_rssi_c
,

168 
sûí˚_ªf
);

173 
i
 = 
d©a
->
ƒg_íîgy_idx
;

174 
vÆ
 = 
	`mö
(
rx_öfo
->
bóc⁄_íîgy_b
,Ñx_öfo->
bóc⁄_íîgy_c
);

175 
d©a
->
ƒg_vÆue
[
i
] = 
	`mö
(
rx_öfo
->
bóc⁄_íîgy_a
, 
vÆ
);

177 
d©a
->
ƒg_íîgy_idx
++;

178 i‡(
d©a
->
ƒg_íîgy_idx
 >= 10)

179 
d©a
->
ƒg_íîgy_idx
 = 0;

185 
max_ƒg_cck
 = 
d©a
->
ƒg_vÆue
[0];

186 
i
 = 1; i < 10; i++)

187 
max_ƒg_cck
 = (
u32
Ë
	`max
(max_ƒg_cck, (
d©a
->
ƒg_vÆue
[
i
]));

188 
max_ƒg_cck
 += 6;

190 
	`IWL_DEBUG_CALIB
(
¥iv
, "rxÉnergyá %u, b %u, c %u, 10-bcn max/min %u\n",

191 
rx_öfo
->
bóc⁄_íîgy_a
,Ñx_öfo->
bóc⁄_íîgy_b
,

192 
rx_öfo
->
bóc⁄_íîgy_c
, 
max_ƒg_cck
 - 6);

196 i‡(
Ál£_Æ¨ms
 < 
mö_Ál£_Æ¨ms
)

197 
d©a
->
num_ö_cck_no_Á
++;

199 
d©a
->
num_ö_cck_no_Á
 = 0;

200 
	`IWL_DEBUG_CALIB
(
¥iv
, "consecutive bcns with few falseálarms = %u\n",

201 
d©a
->
num_ö_cck_no_Á
);

204 i‡((
Ál£_Æ¨ms
 > 
max_Ál£_Æ¨ms
) &&

205 (
d©a
->
auto_c‹r_cck
 > 
AUTO_CORR_MAX_TH_CCK
)) {

206 
	`IWL_DEBUG_CALIB
(
¥iv
, "norm FA %u > max FA %u\n",

207 
Ál£_Æ¨ms
, 
max_Ál£_Æ¨ms
);

208 
	`IWL_DEBUG_CALIB
(
¥iv
, "...Ñeducing sensitivity\n");

209 
d©a
->
ƒg_cuº_°©e
 = 
IWL_FA_TOO_MANY
;

211 
d©a
->
ƒg_sûí˚_ªf
 = 
sûí˚_ªf
;

215 
d©a
->
ƒg_th_cck
 = d©a->ƒg_th_cck - 
NRG_STEP_CCK
;

217 } i‡(
Ál£_Æ¨ms
 < 
mö_Ál£_Æ¨ms
) {

218 
d©a
->
ƒg_cuº_°©e
 = 
IWL_FA_TOO_FEW
;

222 
d©a
->
ƒg_auto_c‹r_sûí˚_diff
 = (
s32
)d©a->
ƒg_sûí˚_ªf
 -

223 (
s32
)
sûí˚_ªf
;

225 
	`IWL_DEBUG_CALIB
(
¥iv
, "norm FA %u < min FA %u, silence diff %d\n",

226 
Ál£_Æ¨ms
, 
mö_Ál£_Æ¨ms
,

227 
d©a
->
ƒg_auto_c‹r_sûí˚_diff
);

235 i‡((
d©a
->
ƒg_¥ev_°©e
 !
IWL_FA_TOO_MANY
) &&

236 ((
d©a
->
ƒg_auto_c‹r_sûí˚_diff
 > 
NRG_DIFF
) ||

237 (
d©a
->
num_ö_cck_no_Á
 > 
MAX_NUMBER_CCK_NO_FA
))) {

239 
	`IWL_DEBUG_CALIB
(
¥iv
, "... increasing sensitivity\n");

241 
vÆ
 = 
d©a
->
ƒg_th_cck
 + 
NRG_STEP_CCK
;

242 
d©a
->
ƒg_th_cck
 = 
	`mö
((
u32
)
ønges
->
mö_ƒg_cck
, 
vÆ
);

244 
	`IWL_DEBUG_CALIB
(
¥iv
, "... butÇot changing sensitivity\n");

249 
	`IWL_DEBUG_CALIB
(
¥iv
, " FA in safe zone\n");

250 
d©a
->
ƒg_cuº_°©e
 = 
IWL_FA_GOOD_RANGE
;

253 
d©a
->
ƒg_sûí˚_ªf
 = 
sûí˚_ªf
;

258 i‡(
d©a
->
ƒg_¥ev_°©e
 =
IWL_FA_TOO_MANY
) {

259 
	`IWL_DEBUG_CALIB
(
¥iv
, "... increasing margin\n");

260 i‡(
d©a
->
ƒg_th_cck
 > (
max_ƒg_cck
 + 
NRG_MARGIN
))

261 
d©a
->
ƒg_th_cck
 -
NRG_MARGIN
;

263 
d©a
->
ƒg_th_cck
 = 
max_ƒg_cck
;

272 
d©a
->
ƒg_th_cck
 = 
	`max
(
max_ƒg_cck
, data->nrg_th_cck);

273 
	`IWL_DEBUG_CALIB
(
¥iv
, "√wÇrg_th_cck %u\n", 
d©a
->
ƒg_th_cck
);

275 
d©a
->
ƒg_¥ev_°©e
 = d©a->
ƒg_cuº_°©e
;

278 i‡(
Ál£_Æ¨ms
 > 
mö_Ál£_Æ¨ms
) {

283 i‡(
d©a
->
auto_c‹r_cck
 < 
AUTO_CORR_MAX_TH_CCK
)

284 
d©a
->
auto_c‹r_cck
 = 
AUTO_CORR_MAX_TH_CCK
 + 1;

286 
vÆ
 = 
d©a
->
auto_c‹r_cck
 + 
AUTO_CORR_STEP_CCK
;

287 
d©a
->
auto_c‹r_cck
 =

288 
	`mö
((
u32
)
ønges
->
auto_c‹r_max_cck
, 
vÆ
);

290 
vÆ
 = 
d©a
->
auto_c‹r_cck_mrc
 + 
AUTO_CORR_STEP_CCK
;

291 
d©a
->
auto_c‹r_cck_mrc
 =

292 
	`mö
((
u32
)
ønges
->
auto_c‹r_max_cck_mrc
, 
vÆ
);

293 } i‡((
Ál£_Æ¨ms
 < 
mö_Ál£_Æ¨ms
) &&

294 ((
d©a
->
ƒg_auto_c‹r_sûí˚_diff
 > 
NRG_DIFF
) ||

295 (
d©a
->
num_ö_cck_no_Á
 > 
MAX_NUMBER_CCK_NO_FA
))) {

298 
vÆ
 = 
d©a
->
auto_c‹r_cck
 - 
AUTO_CORR_STEP_CCK
;

299 
d©a
->
auto_c‹r_cck
 =

300 
	`max
((
u32
)
ønges
->
auto_c‹r_mö_cck
, 
vÆ
);

301 
vÆ
 = 
d©a
->
auto_c‹r_cck_mrc
 - 
AUTO_CORR_STEP_CCK
;

302 
d©a
->
auto_c‹r_cck_mrc
 =

303 
	`max
((
u32
)
ønges
->
auto_c‹r_mö_cck_mrc
, 
vÆ
);

307 
	}
}

310 
	$iwl_£ns_auto_c‹r_ofdm
(
iwl_¥iv
 *
¥iv
,

311 
u32
 
n‹m_Á
,

312 
u32
 
rx_íabÀ_time
)

314 
u32
 
vÆ
;

315 
u32
 
Ál£_Æ¨ms
 = 
n‹m_Á
 * 200 * 1024;

316 
u32
 
max_Ál£_Æ¨ms
 = 
MAX_FA_OFDM
 * 
rx_íabÀ_time
;

317 
u32
 
mö_Ál£_Æ¨ms
 = 
MIN_FA_OFDM
 * 
rx_íabÀ_time
;

318 
iwl_£nsôivôy_d©a
 *
d©a
 = 
NULL
;

319 c⁄° 
iwl_£nsôivôy_ønges
 *
ønges
 = 
¥iv
->
hw_∑øms
.
£ns
;

321 
d©a
 = &(
¥iv
->
£nsôivôy_d©a
);

324 i‡(
Ál£_Æ¨ms
 > 
max_Ál£_Æ¨ms
) {

326 
	`IWL_DEBUG_CALIB
(
¥iv
, "norm FA %u > max FA %u)\n",

327 
Ál£_Æ¨ms
, 
max_Ál£_Æ¨ms
);

329 
vÆ
 = 
d©a
->
auto_c‹r_ofdm
 + 
AUTO_CORR_STEP_OFDM
;

330 
d©a
->
auto_c‹r_ofdm
 =

331 
	`mö
((
u32
)
ønges
->
auto_c‹r_max_ofdm
, 
vÆ
);

333 
vÆ
 = 
d©a
->
auto_c‹r_ofdm_mrc
 + 
AUTO_CORR_STEP_OFDM
;

334 
d©a
->
auto_c‹r_ofdm_mrc
 =

335 
	`mö
((
u32
)
ønges
->
auto_c‹r_max_ofdm_mrc
, 
vÆ
);

337 
vÆ
 = 
d©a
->
auto_c‹r_ofdm_x1
 + 
AUTO_CORR_STEP_OFDM
;

338 
d©a
->
auto_c‹r_ofdm_x1
 =

339 
	`mö
((
u32
)
ønges
->
auto_c‹r_max_ofdm_x1
, 
vÆ
);

341 
vÆ
 = 
d©a
->
auto_c‹r_ofdm_mrc_x1
 + 
AUTO_CORR_STEP_OFDM
;

342 
d©a
->
auto_c‹r_ofdm_mrc_x1
 =

343 
	`mö
((
u32
)
ønges
->
auto_c‹r_max_ofdm_mrc_x1
, 
vÆ
);

347 i‡(
Ál£_Æ¨ms
 < 
mö_Ál£_Æ¨ms
) {

349 
	`IWL_DEBUG_CALIB
(
¥iv
, "norm FA %u < min FA %u\n",

350 
Ál£_Æ¨ms
, 
mö_Ál£_Æ¨ms
);

352 
vÆ
 = 
d©a
->
auto_c‹r_ofdm
 - 
AUTO_CORR_STEP_OFDM
;

353 
d©a
->
auto_c‹r_ofdm
 =

354 
	`max
((
u32
)
ønges
->
auto_c‹r_mö_ofdm
, 
vÆ
);

356 
vÆ
 = 
d©a
->
auto_c‹r_ofdm_mrc
 - 
AUTO_CORR_STEP_OFDM
;

357 
d©a
->
auto_c‹r_ofdm_mrc
 =

358 
	`max
((
u32
)
ønges
->
auto_c‹r_mö_ofdm_mrc
, 
vÆ
);

360 
vÆ
 = 
d©a
->
auto_c‹r_ofdm_x1
 - 
AUTO_CORR_STEP_OFDM
;

361 
d©a
->
auto_c‹r_ofdm_x1
 =

362 
	`max
((
u32
)
ønges
->
auto_c‹r_mö_ofdm_x1
, 
vÆ
);

364 
vÆ
 = 
d©a
->
auto_c‹r_ofdm_mrc_x1
 - 
AUTO_CORR_STEP_OFDM
;

365 
d©a
->
auto_c‹r_ofdm_mrc_x1
 =

366 
	`max
((
u32
)
ønges
->
auto_c‹r_mö_ofdm_mrc_x1
, 
vÆ
);

368 
	`IWL_DEBUG_CALIB
(
¥iv
, "min FA %u <Çorm FA %u < max FA %u OK\n",

369 
mö_Ál£_Æ¨ms
, 
Ál£_Æ¨ms
, 
max_Ál£_Æ¨ms
);

372 
	}
}

374 
	$iwl_¥ï¨e_Àgacy_£nsôivôy_tbl
(
iwl_¥iv
 *
¥iv
,

375 
iwl_£nsôivôy_d©a
 *
d©a
,

376 
__À16
 *
tbl
)

378 
tbl
[
HD_AUTO_CORR32_X4_TH_ADD_MIN_INDEX
] =

379 
	`˝u_to_À16
((
u16
)
d©a
->
auto_c‹r_ofdm
);

380 
tbl
[
HD_AUTO_CORR32_X4_TH_ADD_MIN_MRC_INDEX
] =

381 
	`˝u_to_À16
((
u16
)
d©a
->
auto_c‹r_ofdm_mrc
);

382 
tbl
[
HD_AUTO_CORR32_X1_TH_ADD_MIN_INDEX
] =

383 
	`˝u_to_À16
((
u16
)
d©a
->
auto_c‹r_ofdm_x1
);

384 
tbl
[
HD_AUTO_CORR32_X1_TH_ADD_MIN_MRC_INDEX
] =

385 
	`˝u_to_À16
((
u16
)
d©a
->
auto_c‹r_ofdm_mrc_x1
);

387 
tbl
[
HD_AUTO_CORR40_X4_TH_ADD_MIN_INDEX
] =

388 
	`˝u_to_À16
((
u16
)
d©a
->
auto_c‹r_cck
);

389 
tbl
[
HD_AUTO_CORR40_X4_TH_ADD_MIN_MRC_INDEX
] =

390 
	`˝u_to_À16
((
u16
)
d©a
->
auto_c‹r_cck_mrc
);

392 
tbl
[
HD_MIN_ENERGY_CCK_DET_INDEX
] =

393 
	`˝u_to_À16
((
u16
)
d©a
->
ƒg_th_cck
);

394 
tbl
[
HD_MIN_ENERGY_OFDM_DET_INDEX
] =

395 
	`˝u_to_À16
((
u16
)
d©a
->
ƒg_th_ofdm
);

397 
tbl
[
HD_BARKER_CORR_TH_ADD_MIN_INDEX
] =

398 
	`˝u_to_À16
(
d©a
->
b¨kî_c‹r_th_mö
);

399 
tbl
[
HD_BARKER_CORR_TH_ADD_MIN_MRC_INDEX
] =

400 
	`˝u_to_À16
(
d©a
->
b¨kî_c‹r_th_mö_mrc
);

401 
tbl
[
HD_OFDM_ENERGY_TH_IN_INDEX
] =

402 
	`˝u_to_À16
(
d©a
->
ƒg_th_cˇ
);

404 
	`IWL_DEBUG_CALIB
(
¥iv
, "ofdm:ác %u mrc %u x1 %u mrc_x1 %uÅhresh %u\n",

405 
d©a
->
auto_c‹r_ofdm
, d©a->
auto_c‹r_ofdm_mrc
,

406 
d©a
->
auto_c‹r_ofdm_x1
, d©a->
auto_c‹r_ofdm_mrc_x1
,

407 
d©a
->
ƒg_th_ofdm
);

409 
	`IWL_DEBUG_CALIB
(
¥iv
, "cck:ác %u mrc %uÅhresh %u\n",

410 
d©a
->
auto_c‹r_cck
, d©a->
auto_c‹r_cck_mrc
,

411 
d©a
->
ƒg_th_cck
);

412 
	}
}

415 
	$iwl_£nsôivôy_wrôe
(
iwl_¥iv
 *
¥iv
)

417 
iwl_£nsôivôy_cmd
 
cmd
;

418 
iwl_£nsôivôy_d©a
 *
d©a
 = 
NULL
;

419 
iwl_ho°_cmd
 
cmd_out
 = {

420 .
id
 = 
SENSITIVITY_CMD
,

421 .
Àn
 = { (
iwl_£nsôivôy_cmd
), },

422 .
Êags
 = 
CMD_ASYNC
,

423 .
d©a
 = { &
cmd
, },

426 
d©a
 = &(
¥iv
->
£nsôivôy_d©a
);

428 
	`mem£t
(&
cmd
, 0, (cmd));

430 
	`iwl_¥ï¨e_Àgacy_£nsôivôy_tbl
(
¥iv
, 
d©a
, &
cmd
.
èbÀ
[0]);

433 
cmd
.
c⁄åﬁ
 = 
SENSITIVITY_CMD_CONTROL_WORK_TABLE
;

436 i‡(!
	`memcmp
(&
cmd
.
èbÀ
[0], &(
¥iv
->
£nsôivôy_tbl
[0]),

437 (
u16
)*
HD_TABLE_SIZE
)) {

438 
	`IWL_DEBUG_CALIB
(
¥iv
, "No change in SENSITIVITY_CMD\n");

443 
	`mem˝y
(&(
¥iv
->
£nsôivôy_tbl
[0]), &(
cmd
.
èbÀ
[0]),

444 (
u16
)*
HD_TABLE_SIZE
);

446  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd_out
);

447 
	}
}

450 
	$iwl_íh™˚_£nsôivôy_wrôe
(
iwl_¥iv
 *
¥iv
)

452 
iwl_íh™˚_£nsôivôy_cmd
 
cmd
;

453 
iwl_£nsôivôy_d©a
 *
d©a
 = 
NULL
;

454 
iwl_ho°_cmd
 
cmd_out
 = {

455 .
id
 = 
SENSITIVITY_CMD
,

456 .
Àn
 = { (
iwl_íh™˚_£nsôivôy_cmd
), },

457 .
Êags
 = 
CMD_ASYNC
,

458 .
d©a
 = { &
cmd
, },

461 
d©a
 = &(
¥iv
->
£nsôivôy_d©a
);

463 
	`mem£t
(&
cmd
, 0, (cmd));

465 
	`iwl_¥ï¨e_Àgacy_£nsôivôy_tbl
(
¥iv
, 
d©a
, &
cmd
.
íh™˚_èbÀ
[0]);

467 i‡(
¥iv
->
lib
->
hd_v2
) {

468 
cmd
.
íh™˚_èbÀ
[
HD_INA_NON_SQUARE_DET_OFDM_INDEX
] =

469 
HD_INA_NON_SQUARE_DET_OFDM_DATA_V2
;

470 
cmd
.
íh™˚_èbÀ
[
HD_INA_NON_SQUARE_DET_CCK_INDEX
] =

471 
HD_INA_NON_SQUARE_DET_CCK_DATA_V2
;

472 
cmd
.
íh™˚_èbÀ
[
HD_CORR_11_INSTEAD_OF_CORR_9_EN_INDEX
] =

473 
HD_CORR_11_INSTEAD_OF_CORR_9_EN_DATA_V2
;

474 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_INDEX
] =

475 
HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_DATA_V2
;

476 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_INDEX
] =

477 
HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V2
;

478 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_SLOPE_INDEX
] =

479 
HD_OFDM_NON_SQUARE_DET_SLOPE_DATA_V2
;

480 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_INTERCEPT_INDEX
] =

481 
HD_OFDM_NON_SQUARE_DET_INTERCEPT_DATA_V2
;

482 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_SLOPE_MRC_INDEX
] =

483 
HD_CCK_NON_SQUARE_DET_SLOPE_MRC_DATA_V2
;

484 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_INDEX
] =

485 
HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V2
;

486 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_SLOPE_INDEX
] =

487 
HD_CCK_NON_SQUARE_DET_SLOPE_DATA_V2
;

488 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_INTERCEPT_INDEX
] =

489 
HD_CCK_NON_SQUARE_DET_INTERCEPT_DATA_V2
;

491 
cmd
.
íh™˚_èbÀ
[
HD_INA_NON_SQUARE_DET_OFDM_INDEX
] =

492 
HD_INA_NON_SQUARE_DET_OFDM_DATA_V1
;

493 
cmd
.
íh™˚_èbÀ
[
HD_INA_NON_SQUARE_DET_CCK_INDEX
] =

494 
HD_INA_NON_SQUARE_DET_CCK_DATA_V1
;

495 
cmd
.
íh™˚_èbÀ
[
HD_CORR_11_INSTEAD_OF_CORR_9_EN_INDEX
] =

496 
HD_CORR_11_INSTEAD_OF_CORR_9_EN_DATA_V1
;

497 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_INDEX
] =

498 
HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_DATA_V1
;

499 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_INDEX
] =

500 
HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V1
;

501 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_SLOPE_INDEX
] =

502 
HD_OFDM_NON_SQUARE_DET_SLOPE_DATA_V1
;

503 
cmd
.
íh™˚_èbÀ
[
HD_OFDM_NON_SQUARE_DET_INTERCEPT_INDEX
] =

504 
HD_OFDM_NON_SQUARE_DET_INTERCEPT_DATA_V1
;

505 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_SLOPE_MRC_INDEX
] =

506 
HD_CCK_NON_SQUARE_DET_SLOPE_MRC_DATA_V1
;

507 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_INDEX
] =

508 
HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V1
;

509 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_SLOPE_INDEX
] =

510 
HD_CCK_NON_SQUARE_DET_SLOPE_DATA_V1
;

511 
cmd
.
íh™˚_èbÀ
[
HD_CCK_NON_SQUARE_DET_INTERCEPT_INDEX
] =

512 
HD_CCK_NON_SQUARE_DET_INTERCEPT_DATA_V1
;

516 
cmd
.
c⁄åﬁ
 = 
SENSITIVITY_CMD_CONTROL_WORK_TABLE
;

519 i‡(!
	`memcmp
(&
cmd
.
íh™˚_èbÀ
[0], &(
¥iv
->
£nsôivôy_tbl
[0]),

520 (
u16
)*
HD_TABLE_SIZE
) &&

521 !
	`memcmp
(&
cmd
.
íh™˚_èbÀ
[
HD_INA_NON_SQUARE_DET_OFDM_INDEX
],

522 &(
¥iv
->
íh™˚_£nsôivôy_tbl
[0]),

523 (
u16
)*
ENHANCE_HD_TABLE_ENTRIES
)) {

524 
	`IWL_DEBUG_CALIB
(
¥iv
, "No change in SENSITIVITY_CMD\n");

529 
	`mem˝y
(&(
¥iv
->
£nsôivôy_tbl
[0]), &(
cmd
.
íh™˚_èbÀ
[0]),

530 (
u16
)*
HD_TABLE_SIZE
);

531 
	`mem˝y
(&(
¥iv
->
íh™˚_£nsôivôy_tbl
[0]),

532 &(
cmd
.
íh™˚_èbÀ
[
HD_INA_NON_SQUARE_DET_OFDM_INDEX
]),

533 (
u16
)*
ENHANCE_HD_TABLE_ENTRIES
);

535  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd_out
);

536 
	}
}

538 
	$iwl_öô_£nsôivôy
(
iwl_¥iv
 *
¥iv
)

540 
ªt
 = 0;

541 
i
;

542 
iwl_£nsôivôy_d©a
 *
d©a
 = 
NULL
;

543 c⁄° 
iwl_£nsôivôy_ønges
 *
ønges
 = 
¥iv
->
hw_∑øms
.
£ns
;

545 i‡(
¥iv
->
ˇlib_dißbÀd
 & 
IWL_SENSITIVITY_CALIB_DISABLED
)

548 
	`IWL_DEBUG_CALIB
(
¥iv
, "Start iwl_init_sensitivity\n");

551 
d©a
 = &(
¥iv
->
£nsôivôy_d©a
);

553 i‡(
ønges
 =
NULL
)

556 
	`mem£t
(
d©a
, 0, (
iwl_£nsôivôy_d©a
));

558 
d©a
->
num_ö_cck_no_Á
 = 0;

559 
d©a
->
ƒg_cuº_°©e
 = 
IWL_FA_TOO_MANY
;

560 
d©a
->
ƒg_¥ev_°©e
 = 
IWL_FA_TOO_MANY
;

561 
d©a
->
ƒg_sûí˚_ªf
 = 0;

562 
d©a
->
ƒg_sûí˚_idx
 = 0;

563 
d©a
->
ƒg_íîgy_idx
 = 0;

565 
i
 = 0; i < 10; i++)

566 
d©a
->
ƒg_vÆue
[
i
] = 0;

568 
i
 = 0; i < 
NRG_NUM_PREV_STAT_L
; i++)

569 
d©a
->
ƒg_sûí˚_rssi
[
i
] = 0;

571 
d©a
->
auto_c‹r_ofdm
 = 
ønges
->
auto_c‹r_mö_ofdm
;

572 
d©a
->
auto_c‹r_ofdm_mrc
 = 
ønges
->
auto_c‹r_mö_ofdm_mrc
;

573 
d©a
->
auto_c‹r_ofdm_x1
 = 
ønges
->
auto_c‹r_mö_ofdm_x1
;

574 
d©a
->
auto_c‹r_ofdm_mrc_x1
 = 
ønges
->
auto_c‹r_mö_ofdm_mrc_x1
;

575 
d©a
->
auto_c‹r_cck
 = 
AUTO_CORR_CCK_MIN_VAL_DEF
;

576 
d©a
->
auto_c‹r_cck_mrc
 = 
ønges
->
auto_c‹r_mö_cck_mrc
;

577 
d©a
->
ƒg_th_cck
 = 
ønges
->nrg_th_cck;

578 
d©a
->
ƒg_th_ofdm
 = 
ønges
->nrg_th_ofdm;

579 
d©a
->
b¨kî_c‹r_th_mö
 = 
ønges
->barker_corr_th_min;

580 
d©a
->
b¨kî_c‹r_th_mö_mrc
 = 
ønges
->barker_corr_th_min_mrc;

581 
d©a
->
ƒg_th_cˇ
 = 
ønges
->nrg_th_cca;

583 
d©a
->
œ°_bad_∂˝_˙t_ofdm
 = 0;

584 
d©a
->
œ°_Á_˙t_ofdm
 = 0;

585 
d©a
->
œ°_bad_∂˝_˙t_cck
 = 0;

586 
d©a
->
œ°_Á_˙t_cck
 = 0;

588 i‡(
¥iv
->
fw
->
íh™˚_£nsôivôy_èbÀ
)

589 
ªt
 |
	`iwl_íh™˚_£nsôivôy_wrôe
(
¥iv
);

591 
ªt
 |
	`iwl_£nsôivôy_wrôe
(
¥iv
);

592 
	`IWL_DEBUG_CALIB
(
¥iv
, "<<ªtu∫ 0x%X\n", 
ªt
);

593 
	}
}

595 
	$iwl_£nsôivôy_ˇlibøti⁄
(
iwl_¥iv
 *
¥iv
)

597 
u32
 
rx_íabÀ_time
;

598 
u32
 
Á_cck
;

599 
u32
 
Á_ofdm
;

600 
u32
 
bad_∂˝_cck
;

601 
u32
 
bad_∂˝_ofdm
;

602 
u32
 
n‹m_Á_ofdm
;

603 
u32
 
n‹m_Á_cck
;

604 
iwl_£nsôivôy_d©a
 *
d©a
 = 
NULL
;

605 
°©i°ics_rx_n⁄_phy
 *
rx_öfo
;

606 
°©i°ics_rx_phy
 *
ofdm
, *
cck
;

607 
°©i°ics_gíîÆ_d©a
 
°©is
;

609 i‡(
¥iv
->
ˇlib_dißbÀd
 & 
IWL_SENSITIVITY_CALIB_DISABLED
)

612 
d©a
 = &(
¥iv
->
£nsôivôy_d©a
);

614 i‡(!
	`iwl_is_™y_assocüãd
(
¥iv
)) {

615 
	`IWL_DEBUG_CALIB
(
¥iv
, "<< -Çotássociated\n");

619 
	`•ö_lock_bh
(&
¥iv
->
°©i°ics
.
lock
);

620 
rx_öfo
 = &
¥iv
->
°©i°ics
.
rx_n⁄_phy
;

621 
ofdm
 = &
¥iv
->
°©i°ics
.
rx_ofdm
;

622 
cck
 = &
¥iv
->
°©i°ics
.
rx_cck
;

623 i‡(
rx_öfo
->
öãr„ªn˚_d©a_Êag
 !
INTERFERENCE_DATA_AVAILABLE
) {

624 
	`IWL_DEBUG_CALIB
(
¥iv
, "<< invalid data.\n");

625 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

630 
rx_íabÀ_time
 = 
	`À32_to_˝u
(
rx_öfo
->
ch™√l_lﬂd
);

631 
Á_cck
 = 
	`À32_to_˝u
(
cck
->
Ál£_Æ¨m_˙t
);

632 
Á_ofdm
 = 
	`À32_to_˝u
(
ofdm
->
Ál£_Æ¨m_˙t
);

633 
bad_∂˝_cck
 = 
	`À32_to_˝u
(
cck
->
∂˝_îr
);

634 
bad_∂˝_ofdm
 = 
	`À32_to_˝u
(
ofdm
->
∂˝_îr
);

636 
°©is
.
bóc⁄_sûí˚_rssi_a
 =

637 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_a
);

638 
°©is
.
bóc⁄_sûí˚_rssi_b
 =

639 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_b
);

640 
°©is
.
bóc⁄_sûí˚_rssi_c
 =

641 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_c
);

642 
°©is
.
bóc⁄_íîgy_a
 =

643 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_íîgy_a
);

644 
°©is
.
bóc⁄_íîgy_b
 =

645 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_íîgy_b
);

646 
°©is
.
bóc⁄_íîgy_c
 =

647 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_íîgy_c
);

649 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

651 
	`IWL_DEBUG_CALIB
(
¥iv
, "rx_íabÀ_timê%u u£cs\n", 
rx_íabÀ_time
);

653 i‡(!
rx_íabÀ_time
) {

654 
	`IWL_DEBUG_CALIB
(
¥iv
, "<< RX Enable Time == 0!\n");

661 i‡(
d©a
->
œ°_bad_∂˝_˙t_cck
 > 
bad_∂˝_cck
)

662 
d©a
->
œ°_bad_∂˝_˙t_cck
 = 
bad_∂˝_cck
;

664 
bad_∂˝_cck
 -
d©a
->
œ°_bad_∂˝_˙t_cck
;

665 
d©a
->
œ°_bad_∂˝_˙t_cck
 +
bad_∂˝_cck
;

668 i‡(
d©a
->
œ°_bad_∂˝_˙t_ofdm
 > 
bad_∂˝_ofdm
)

669 
d©a
->
œ°_bad_∂˝_˙t_ofdm
 = 
bad_∂˝_ofdm
;

671 
bad_∂˝_ofdm
 -
d©a
->
œ°_bad_∂˝_˙t_ofdm
;

672 
d©a
->
œ°_bad_∂˝_˙t_ofdm
 +
bad_∂˝_ofdm
;

675 i‡(
d©a
->
œ°_Á_˙t_ofdm
 > 
Á_ofdm
)

676 
d©a
->
œ°_Á_˙t_ofdm
 = 
Á_ofdm
;

678 
Á_ofdm
 -
d©a
->
œ°_Á_˙t_ofdm
;

679 
d©a
->
œ°_Á_˙t_ofdm
 +
Á_ofdm
;

682 i‡(
d©a
->
œ°_Á_˙t_cck
 > 
Á_cck
)

683 
d©a
->
œ°_Á_˙t_cck
 = 
Á_cck
;

685 
Á_cck
 -
d©a
->
œ°_Á_˙t_cck
;

686 
d©a
->
œ°_Á_˙t_cck
 +
Á_cck
;

690 
n‹m_Á_ofdm
 = 
Á_ofdm
 + 
bad_∂˝_ofdm
;

691 
n‹m_Á_cck
 = 
Á_cck
 + 
bad_∂˝_cck
;

693 
	`IWL_DEBUG_CALIB
(
¥iv
, "cck: f®%u bad∞%u ofdm: f®%u bad∞%u\n", 
Á_cck
,

694 
bad_∂˝_cck
, 
Á_ofdm
, 
bad_∂˝_ofdm
);

696 
	`iwl_£ns_auto_c‹r_ofdm
(
¥iv
, 
n‹m_Á_ofdm
, 
rx_íabÀ_time
);

697 
	`iwl_£ns_íîgy_cck
(
¥iv
, 
n‹m_Á_cck
, 
rx_íabÀ_time
, &
°©is
);

698 i‡(
¥iv
->
fw
->
íh™˚_£nsôivôy_èbÀ
)

699 
	`iwl_íh™˚_£nsôivôy_wrôe
(
¥iv
);

701 
	`iwl_£nsôivôy_wrôe
(
¥iv
);

702 
	}
}

704 
ölöe
 
u8
 
	$föd_fú°_chaö
(
u8
 
mask
)

706 i‡(
mask
 & 
ANT_A
)

707  
CHAIN_A
;

708 i‡(
mask
 & 
ANT_B
)

709  
CHAIN_B
;

710  
CHAIN_C
;

711 
	}
}

717 
	$iwl_föd_disc⁄n_™ã¬a
(
iwl_¥iv
 *
¥iv
, 
u32
* 
avîage_sig
,

718 
iwl_chaö_noi£_d©a
 *
d©a
)

720 
u32
 
a˘ive_chaös
 = 0;

721 
u32
 
max_avîage_sig
;

722 
u16
 
max_avîage_sig_™ã¬a_i
;

723 
u8
 
num_tx_chaös
;

724 
u8
 
fú°_chaö
;

725 
u16
 
i
 = 0;

727 
avîage_sig
[0] = 
d©a
->
chaö_sig«l_a
 / 
IWL_CAL_NUM_BEACONS
;

728 
avîage_sig
[1] = 
d©a
->
chaö_sig«l_b
 / 
IWL_CAL_NUM_BEACONS
;

729 
avîage_sig
[2] = 
d©a
->
chaö_sig«l_c
 / 
IWL_CAL_NUM_BEACONS
;

731 i‡(
avîage_sig
[0] >=áverage_sig[1]) {

732 
max_avîage_sig
 = 
avîage_sig
[0];

733 
max_avîage_sig_™ã¬a_i
 = 0;

734 
a˘ive_chaös
 = (1 << 
max_avîage_sig_™ã¬a_i
);

736 
max_avîage_sig
 = 
avîage_sig
[1];

737 
max_avîage_sig_™ã¬a_i
 = 1;

738 
a˘ive_chaös
 = (1 << 
max_avîage_sig_™ã¬a_i
);

741 i‡(
avîage_sig
[2] >
max_avîage_sig
) {

742 
max_avîage_sig
 = 
avîage_sig
[2];

743 
max_avîage_sig_™ã¬a_i
 = 2;

744 
a˘ive_chaös
 = (1 << 
max_avîage_sig_™ã¬a_i
);

747 
	`IWL_DEBUG_CALIB
(
¥iv
, "average_sig:á %d b %d c %d\n",

748 
avîage_sig
[0],áverage_sig[1],áverage_sig[2]);

749 
	`IWL_DEBUG_CALIB
(
¥iv
, "max_average_sig = %d,ántenna %d\n",

750 
max_avîage_sig
, 
max_avîage_sig_™ã¬a_i
);

753 
i
 = 0; i < 
NUM_RX_CHAINS
; i++) {

754 i‡(
i
 !
max_avîage_sig_™ã¬a_i
) {

755 
s32
 
rssi_dñè
 = (
max_avîage_sig
 - 
avîage_sig
[
i
]);

759 i‡(
rssi_dñè
 > 
MAXIMUM_ALLOWED_PATHLOSS
)

760 
d©a
->
disc⁄n_¨øy
[
i
] = 1;

762 
a˘ive_chaös
 |(1 << 
i
);

763 
	`IWL_DEBUG_CALIB
(
¥iv
, "i = %dÑssiDelta = %d "

765 
i
, 
rssi_dñè
, 
d©a
->
disc⁄n_¨øy
[i]);

779 
a˘ive_chaös
 &
¥iv
->
nvm_d©a
->
vÆid_rx_™t
;

781 
num_tx_chaös
 = 0;

782 
i
 = 0; i < 
NUM_RX_CHAINS
; i++) {

785 
u8
 
™t_msk
 = (1 << 
i
);

786 i‡(!(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
™t_msk
))

789 
num_tx_chaös
++;

790 i‡(
d©a
->
disc⁄n_¨øy
[
i
] == 0)

793 i‡(
num_tx_chaös
 =
¥iv
->
hw_∑øms
.
tx_chaös_num
 &&

794 
d©a
->
disc⁄n_¨øy
[
i
]) {

799 
fú°_chaö
 =

800 
	`föd_fú°_chaö
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

801 
d©a
->
disc⁄n_¨øy
[
fú°_chaö
] = 0;

802 
a˘ive_chaös
 |
	`BIT
(
fú°_chaö
);

803 
	`IWL_DEBUG_CALIB
(
¥iv
,

805 
fú°_chaö
);

810 i‡(
a˘ive_chaös
 !
¥iv
->
nvm_d©a
->
vÆid_rx_™t
 &&

811 
a˘ive_chaös
 !
¥iv
->
chaö_noi£_d©a
.active_chains)

812 
	`IWL_DEBUG_CALIB
(
¥iv
,

815 
a˘ive_chaös
,

816 
¥iv
->
nvm_d©a
->
vÆid_rx_™t
);

819 
d©a
->
a˘ive_chaös
 =áctive_chains;

820 
	`IWL_DEBUG_CALIB
(
¥iv
, "active_chains (bitwise) = 0x%x\n",

821 
a˘ive_chaös
);

822 
	}
}

824 
	$iwœgn_gaö_compuèti⁄
(
iwl_¥iv
 *
¥iv
,

825 
u32
 
avîage_noi£
[
NUM_RX_CHAINS
],

826 
u8
 
deÁu…_chaö
)

828 
i
;

829 
s32
 
dñè_g
;

830 
iwl_chaö_noi£_d©a
 *
d©a
 = &
¥iv
->
chaö_noi£_d©a
;

835 
i
 = 
deÁu…_chaö
 + 1; i < 
NUM_RX_CHAINS
; i++) {

836 i‡((
d©a
->
disc⁄n_¨øy
[
i
])) {

837 
d©a
->
dñè_gaö_code
[
i
] = 0;

841 
dñè_g
 = (
¥iv
->
lib
->
chaö_noi£_sˇÀ
 *

842 ((
s32
)
avîage_noi£
[
deÁu…_chaö
] -

843 (
s32
)
avîage_noi£
[
i
])) / 1500;

846 
d©a
->
dñè_gaö_code
[
i
] =

847 
	`mö
(
	`abs
(
dñè_g
), 
CHAIN_NOISE_MAX_DELTA_GAIN_CODE
);

849 i‡(
dñè_g
 < 0)

858 
d©a
->
dñè_gaö_code
[
i
] |= (1 << 2);

861 
	`IWL_DEBUG_CALIB
(
¥iv
, "Delta gains: ANT_B = %d ANT_C = %d\n",

862 
d©a
->
dñè_gaö_code
[1], data->delta_gain_code[2]);

864 i‡(!
d©a
->
ødio_wrôe
) {

865 
iwl_ˇlib_chaö_noi£_gaö_cmd
 
cmd
;

867 
	`mem£t
(&
cmd
, 0, (cmd));

869 
	`iwl_£t_ˇlib_hdr
(&
cmd
.
hdr
,

870 
¥iv
->
phy_ˇlib_chaö_noi£_gaö_cmd
);

871 
cmd
.
dñè_gaö_1
 = 
d©a
->
dñè_gaö_code
[1];

872 
cmd
.
dñè_gaö_2
 = 
d©a
->
dñè_gaö_code
[2];

873 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_PHY_CALIBRATION_CMD
,

874 
CMD_ASYNC
, (
cmd
), &cmd);

876 
d©a
->
ødio_wrôe
 = 1;

877 
d©a
->
°©e
 = 
IWL_CHAIN_NOISE_CALIBRATED
;

879 
	}
}

887 
	$iwl_chaö_noi£_ˇlibøti⁄
(
iwl_¥iv
 *
¥iv
)

889 
iwl_chaö_noi£_d©a
 *
d©a
 = 
NULL
;

891 
u32
 
chaö_noi£_a
;

892 
u32
 
chaö_noi£_b
;

893 
u32
 
chaö_noi£_c
;

894 
u32
 
chaö_sig_a
;

895 
u32
 
chaö_sig_b
;

896 
u32
 
chaö_sig_c
;

897 
u32
 
avîage_sig
[
NUM_RX_CHAINS
] = {
INITIALIZATION_VALUE
};

898 
u32
 
avîage_noi£
[
NUM_RX_CHAINS
] = {
INITIALIZATION_VALUE
};

899 
u32
 
mö_avîage_noi£
 = 
MIN_AVERAGE_NOISE_MAX_VALUE
;

900 
u16
 
mö_avîage_noi£_™ã¬a_i
 = 
INITIALIZATION_VALUE
;

901 
u16
 
i
 = 0;

902 
u16
 
rx⁄_chnum
 = 
INITIALIZATION_VALUE
;

903 
u16
 
°©_chnum
 = 
INITIALIZATION_VALUE
;

904 
u8
 
rx⁄_b™d24
;

905 
u8
 
°©_b™d24
;

906 
°©i°ics_rx_n⁄_phy
 *
rx_öfo
;

913 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

915 i‡(
¥iv
->
ˇlib_dißbÀd
 & 
IWL_CHAIN_NOISE_CALIB_DISABLED
)

918 
d©a
 = &(
¥iv
->
chaö_noi£_d©a
);

924 i‡(
d©a
->
°©e
 !
IWL_CHAIN_NOISE_ACCUMULATE
) {

925 i‡(
d©a
->
°©e
 =
IWL_CHAIN_NOISE_ALIVE
)

926 
	`IWL_DEBUG_CALIB
(
¥iv
, "Wait forÇoise calibÑeset\n");

930 
	`•ö_lock_bh
(&
¥iv
->
°©i°ics
.
lock
);

932 
rx_öfo
 = &
¥iv
->
°©i°ics
.
rx_n⁄_phy
;

934 i‡(
rx_öfo
->
öãr„ªn˚_d©a_Êag
 !
INTERFERENCE_DATA_AVAILABLE
) {

935 
	`IWL_DEBUG_CALIB
(
¥iv
, " << Interference data unavailable\n");

936 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

940 
rx⁄_b™d24
 = !!(
˘x
->
°agög
.
Êags
 & 
RXON_FLG_BAND_24G_MSK
);

941 
rx⁄_chnum
 = 
	`À16_to_˝u
(
˘x
->
°agög
.
ch™√l
);

942 
°©_b™d24
 =

943 !!(
¥iv
->
°©i°ics
.
Êag
 & 
STATISTICS_REPLY_FLG_BAND_24G_MSK
);

944 
°©_chnum
 = 
	`À32_to_˝u
(
¥iv
->
°©i°ics
.
Êag
) >> 16;

948 i‡((
rx⁄_chnum
 !
°©_chnum
Ë|| (
rx⁄_b™d24
 !
°©_b™d24
)) {

949 
	`IWL_DEBUG_CALIB
(
¥iv
, "StatsÇot from chan=%d, band24=%d\n",

950 
rx⁄_chnum
, 
rx⁄_b™d24
);

951 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

959 
chaö_noi£_a
 = 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_a
) &

960 
IN_BAND_FILTER
;

961 
chaö_noi£_b
 = 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_b
) &

962 
IN_BAND_FILTER
;

963 
chaö_noi£_c
 = 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_c
) &

964 
IN_BAND_FILTER
;

966 
chaö_sig_a
 = 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_rssi_a
Ë& 
IN_BAND_FILTER
;

967 
chaö_sig_b
 = 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_rssi_b
Ë& 
IN_BAND_FILTER
;

968 
chaö_sig_c
 = 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_rssi_c
Ë& 
IN_BAND_FILTER
;

970 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

972 
d©a
->
bóc⁄_cou¡
++;

974 
d©a
->
chaö_noi£_a
 = (chain_noise_a + data->chain_noise_a);

975 
d©a
->
chaö_noi£_b
 = (chain_noise_b + data->chain_noise_b);

976 
d©a
->
chaö_noi£_c
 = (chain_noise_c + data->chain_noise_c);

978 
d©a
->
chaö_sig«l_a
 = (
chaö_sig_a
 + data->chain_signal_a);

979 
d©a
->
chaö_sig«l_b
 = (
chaö_sig_b
 + data->chain_signal_b);

980 
d©a
->
chaö_sig«l_c
 = (
chaö_sig_c
 + data->chain_signal_c);

982 
	`IWL_DEBUG_CALIB
(
¥iv
, "chan=%d, band24=%d, beacon=%d\n",

983 
rx⁄_chnum
, 
rx⁄_b™d24
, 
d©a
->
bóc⁄_cou¡
);

984 
	`IWL_DEBUG_CALIB
(
¥iv
, "chain_sig:á %d b %d c %d\n",

985 
chaö_sig_a
, 
chaö_sig_b
, 
chaö_sig_c
);

986 
	`IWL_DEBUG_CALIB
(
¥iv
, "chain_noise:á %d b %d c %d\n",

987 
chaö_noi£_a
, 
chaö_noi£_b
, 
chaö_noi£_c
);

992 i‡(
d©a
->
bóc⁄_cou¡
 !
IWL_CAL_NUM_BEACONS
)

996 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

997 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

1000 
d©a
->
a˘ive_chaös
 = 
¥iv
->
nvm_d©a
->
vÆid_rx_™t
;

1001 
i
 = 0; i < 
NUM_RX_CHAINS
; i++)

1002 i‡(!(
d©a
->
a˘ive_chaös
 & (1<<
i
)))

1003 
d©a
->
disc⁄n_¨øy
[
i
] = 1;

1005 
	`iwl_föd_disc⁄n_™ã¬a
(
¥iv
, 
avîage_sig
, 
d©a
);

1008 
avîage_noi£
[0] = 
d©a
->
chaö_noi£_a
 / 
IWL_CAL_NUM_BEACONS
;

1009 
avîage_noi£
[1] = 
d©a
->
chaö_noi£_b
 / 
IWL_CAL_NUM_BEACONS
;

1010 
avîage_noi£
[2] = 
d©a
->
chaö_noi£_c
 / 
IWL_CAL_NUM_BEACONS
;

1012 
i
 = 0; i < 
NUM_RX_CHAINS
; i++) {

1013 i‡(!(
d©a
->
disc⁄n_¨øy
[
i
]) &&

1014 (
avîage_noi£
[
i
] <
mö_avîage_noi£
)) {

1017 
mö_avîage_noi£
 = 
avîage_noi£
[
i
];

1018 
mö_avîage_noi£_™ã¬a_i
 = 
i
;

1022 
	`IWL_DEBUG_CALIB
(
¥iv
, "average_noise:á %d b %d c %d\n",

1023 
avîage_noi£
[0],áverage_noise[1],

1024 
avîage_noi£
[2]);

1026 
	`IWL_DEBUG_CALIB
(
¥iv
, "min_average_noise = %d,ántenna %d\n",

1027 
mö_avîage_noi£
, 
mö_avîage_noi£_™ã¬a_i
);

1029 
	`iwœgn_gaö_compuèti⁄
(

1030 
¥iv
, 
avîage_noi£
,

1031 
	`föd_fú°_chaö
(
¥iv
->
nvm_d©a
->
vÆid_rx_™t
));

1036 
	`iwl_upd©e_chaö_Êags
(
¥iv
);

1038 
d©a
->
°©e
 = 
IWL_CHAIN_NOISE_DONE
;

1039 
	`iwl_powî_upd©e_mode
(
¥iv
, 
Ál£
);

1040 
	}
}

1042 
	$iwl_ª£t_run_time_ˇlib
(
iwl_¥iv
 *
¥iv
)

1044 
i
;

1045 
	`mem£t
(&(
¥iv
->
£nsôivôy_d©a
), 0,

1046 (
iwl_£nsôivôy_d©a
));

1047 
	`mem£t
(&(
¥iv
->
chaö_noi£_d©a
), 0,

1048 (
iwl_chaö_noi£_d©a
));

1049 
i
 = 0; i < 
NUM_RX_CHAINS
; i++)

1050 
¥iv
->
chaö_noi£_d©a
.
dñè_gaö_code
[
i
] =

1051 
CHAIN_NOISE_DELTA_GAIN_INIT_VAL
;

1055 
	`iwl_£nd_°©i°ics_ªque°
(
¥iv
, 
CMD_ASYNC
, 
åue
);

1056 
	}
}

	@dvm/calib.h

5 #i‚de‡
__iwl_ˇlib_h__


6 
	#__iwl_ˇlib_h__


	)

8 
	~"dev.h
"

9 
	~"comm™ds.h
"

11 
iwl_chaö_noi£_ˇlibøti⁄
(
iwl_¥iv
 *
¥iv
);

12 
iwl_£nsôivôy_ˇlibøti⁄
(
iwl_¥iv
 *
¥iv
);

14 
iwl_öô_£nsôivôy
(
iwl_¥iv
 *
¥iv
);

15 
iwl_ª£t_run_time_ˇlib
(
iwl_¥iv
 *
¥iv
);

	@dvm/commands.h

11 #i‚de‡
__iwl_comm™ds_h__


12 
	#__iwl_comm™ds_h__


	)

14 
	~<löux/õì80211.h
>

15 
	~<löux/ty≥s.h
>

19 
	mREPLY_ALIVE
 = 0x1,

20 
	mREPLY_ERROR
 = 0x2,

21 
	mREPLY_ECHO
 = 0x3,

24 
	mREPLY_RXON
 = 0x10,

25 
	mREPLY_RXON_ASSOC
 = 0x11,

26 
	mREPLY_QOS_PARAM
 = 0x13,

27 
	mREPLY_RXON_TIMING
 = 0x14,

30 
	mREPLY_ADD_STA
 = 0x18,

31 
	mREPLY_REMOVE_STA
 = 0x19,

32 
	mREPLY_REMOVE_ALL_STA
 = 0x1a,

33 
	mREPLY_TXFIFO_FLUSH
 = 0x1e,

36 
	mREPLY_WEPKEY
 = 0x20,

39 
	mREPLY_TX
 = 0x1c,

40 
	mREPLY_LEDS_CMD
 = 0x48,

41 
	mREPLY_TX_LINK_QUALITY_CMD
 = 0x4e,

44 
	mCOEX_PRIORITY_TABLE_CMD
 = 0x5a,

45 
	mCOEX_MEDIUM_NOTIFICATION
 = 0x5b,

46 
	mCOEX_EVENT_CMD
 = 0x5c,

49 
	mTEMPERATURE_NOTIFICATION
 = 0x62,

50 
	mCALIBRATION_CFG_CMD
 = 0x65,

51 
	mCALIBRATION_RES_NOTIFICATION
 = 0x66,

52 
	mCALIBRATION_COMPLETE_NOTIFICATION
 = 0x67,

55 
	mREPLY_QUIET_CMD
 = 0x71,

56 
	mREPLY_CHANNEL_SWITCH
 = 0x72,

57 
	mCHANNEL_SWITCH_NOTIFICATION
 = 0x73,

58 
	mREPLY_SPECTRUM_MEASUREMENT_CMD
 = 0x74,

59 
	mSPECTRUM_MEASURE_NOTIFICATION
 = 0x75,

62 
	mPOWER_TABLE_CMD
 = 0x77,

63 
	mPM_SLEEP_NOTIFICATION
 = 0x7A,

64 
	mPM_DEBUG_STATISTIC_NOTIFIC
 = 0x7B,

67 
	mREPLY_SCAN_CMD
 = 0x80,

68 
	mREPLY_SCAN_ABORT_CMD
 = 0x81,

69 
	mSCAN_START_NOTIFICATION
 = 0x82,

70 
	mSCAN_RESULTS_NOTIFICATION
 = 0x83,

71 
	mSCAN_COMPLETE_NOTIFICATION
 = 0x84,

74 
	mBEACON_NOTIFICATION
 = 0x90,

75 
	mREPLY_TX_BEACON
 = 0x91,

76 
	mWHO_IS_AWAKE_NOTIFICATION
 = 0x94,

79 
	mREPLY_TX_POWER_DBM_CMD
 = 0x95,

80 
	mQUIET_NOTIFICATION
 = 0x96,

81 
	mREPLY_TX_PWR_TABLE_CMD
 = 0x97,

82 
	mREPLY_TX_POWER_DBM_CMD_V1
 = 0x98,

83 
	mTX_ANT_CONFIGURATION_CMD
 = 0x98,

84 
	mMEASURE_ABORT_NOTIFICATION
 = 0x99,

87 
	mREPLY_BT_CONFIG
 = 0x9b,

90 
	mREPLY_STATISTICS_CMD
 = 0x9c,

91 
	mSTATISTICS_NOTIFICATION
 = 0x9d,

94 
	mREPLY_CARD_STATE_CMD
 = 0xa0,

95 
	mCARD_STATE_NOTIFICATION
 = 0xa1,

98 
	mMISSED_BEACONS_NOTIFICATION
 = 0xa2,

100 
	mREPLY_CT_KILL_CONFIG_CMD
 = 0xa4,

101 
	mSENSITIVITY_CMD
 = 0xa8,

102 
	mREPLY_PHY_CALIBRATION_CMD
 = 0xb0,

103 
	mREPLY_RX_PHY_CMD
 = 0xc0,

104 
	mREPLY_RX_MPDU_CMD
 = 0xc1,

105 
	mREPLY_RX
 = 0xc3,

106 
	mREPLY_COMPRESSED_BA
 = 0xc5,

109 
	mREPLY_BT_COEX_PRIO_TABLE
 = 0xcc,

110 
	mREPLY_BT_COEX_PROT_ENV
 = 0xcd,

111 
	mREPLY_BT_COEX_PROFILE_NOTIF
 = 0xce,

114 
	mREPLY_WIPAN_PARAMS
 = 0xb2,

115 
	mREPLY_WIPAN_RXON
 = 0xb3,

116 
	mREPLY_WIPAN_RXON_TIMING
 = 0xb4,

117 
	mREPLY_WIPAN_RXON_ASSOC
 = 0xb6,

118 
	mREPLY_WIPAN_QOS_PARAM
 = 0xb7,

119 
	mREPLY_WIPAN_WEPKEY
 = 0xb8,

120 
	mREPLY_WIPAN_P2P_CHANNEL_SWITCH
 = 0xb9,

121 
	mREPLY_WIPAN_NOA_NOTIFICATION
 = 0xbc,

122 
	mREPLY_WIPAN_DEACTIVATION_COMPLETE
 = 0xbd,

124 
	mREPLY_WOWLAN_PATTERNS
 = 0xe0,

125 
	mREPLY_WOWLAN_WAKEUP_FILTER
 = 0xe1,

126 
	mREPLY_WOWLAN_TSC_RSC_PARAMS
 = 0xe2,

127 
	mREPLY_WOWLAN_TKIP_PARAMS
 = 0xe3,

128 
	mREPLY_WOWLAN_KEK_KCK_MATERIAL
 = 0xe4,

129 
	mREPLY_WOWLAN_GET_STATUS
 = 0xe5,

130 
	mREPLY_D3_CONFIG
 = 0xd3,

132 
	mREPLY_MAX
 = 0xff

144 
	#IWL_MIN_NUM_QUEUES
 11

	)

149 
	#IWL_DEFAULT_CMD_QUEUE_NUM
 4

	)

150 
	#IWL_IPAN_CMD_QUEUE_NUM
 9

	)

152 
	#IWL_TX_FIFO_BK
 0

	)

153 
	#IWL_TX_FIFO_BE
 1

	)

154 
	#IWL_TX_FIFO_VI
 2

	)

155 
	#IWL_TX_FIFO_VO
 3

	)

156 
	#IWL_TX_FIFO_BK_IPAN
 
IWL_TX_FIFO_BK


	)

157 
	#IWL_TX_FIFO_BE_IPAN
 4

	)

158 
	#IWL_TX_FIFO_VI_IPAN
 
IWL_TX_FIFO_VI


	)

159 
	#IWL_TX_FIFO_VO_IPAN
 5

	)

161 
	#IWL_TX_FIFO_AUX
 5

	)

162 
	#IWL_TX_FIFO_UNUSED
 255

	)

164 
	#IWLAGN_CMD_FIFO_NUM
 7

	)

171 
	#IWL_IPAN_MCAST_QUEUE
 8

	)

221 
	#RATE_MCS_CODE_MSK
 0x7

	)

222 
	#RATE_MCS_SPATIAL_POS
 3

	)

223 
	#RATE_MCS_SPATIAL_MSK
 0x18

	)

224 
	#RATE_MCS_HT_DUP_POS
 5

	)

225 
	#RATE_MCS_HT_DUP_MSK
 0x20

	)

227 
	#RATE_MCS_RATE_MSK
 0xff

	)

230 
	#RATE_MCS_FLAGS_POS
 8

	)

231 
	#RATE_MCS_HT_POS
 8

	)

232 
	#RATE_MCS_HT_MSK
 0x100

	)

235 
	#RATE_MCS_CCK_POS
 9

	)

236 
	#RATE_MCS_CCK_MSK
 0x200

	)

239 
	#RATE_MCS_GF_POS
 10

	)

240 
	#RATE_MCS_GF_MSK
 0x400

	)

243 
	#RATE_MCS_HT40_POS
 11

	)

244 
	#RATE_MCS_HT40_MSK
 0x800

	)

247 
	#RATE_MCS_DUP_POS
 12

	)

248 
	#RATE_MCS_DUP_MSK
 0x1000

	)

251 
	#RATE_MCS_SGI_POS
 13

	)

252 
	#RATE_MCS_SGI_MSK
 0x2000

	)

258 
	#RATE_MCS_ANT_POS
 14

	)

259 
	#RATE_MCS_ANT_A_MSK
 0x04000

	)

260 
	#RATE_MCS_ANT_B_MSK
 0x08000

	)

261 
	#RATE_MCS_ANT_C_MSK
 0x10000

	)

262 
	#RATE_MCS_ANT_AB_MSK
 (
RATE_MCS_ANT_A_MSK
 | 
RATE_MCS_ANT_B_MSK
)

	)

263 
	#RATE_MCS_ANT_ABC_MSK
 (
RATE_MCS_ANT_AB_MSK
 | 
RATE_MCS_ANT_C_MSK
)

	)

264 
	#RATE_ANT_NUM
 3

	)

266 
	#POWER_TABLE_NUM_ENTRIES
 33

	)

267 
	#POWER_TABLE_NUM_HT_OFDM_ENTRIES
 32

	)

268 
	#POWER_TABLE_CCK_ENTRY
 32

	)

270 
	#IWL_PWR_NUM_HT_OFDM_ENTRIES
 24

	)

271 
	#IWL_PWR_CCK_ENTRIES
 2

	)

280 
	stx_powî_duÆ_°ªam
 {

281 
__À32
 
	mdw
;

282 } 
	g__∑cked
;

288 
	#IWLAGN_TX_POWER_AUTO
 0x7f

	)

289 
	#IWLAGN_TX_POWER_NO_CLOSED
 (0x1 << 6)

	)

291 
	siwœgn_tx_powî_dbm_cmd
 {

292 
s8
 
	mglobÆ_lmt
;

293 
u8
 
	mÊags
;

294 
s8
 
	m§v_ch™_lmt
;

295 
u8
 
	mª£rved
;

296 } 
	g__∑cked
;

304 
	siwl_tx_™t_c⁄fig_cmd
 {

305 
__À32
 
	mvÆid
;

306 } 
	g__∑cked
;

314 
	#UCODE_VALID_OK
 
	`˝u_to_À32
(0x1)

	)

362 
	siwl_îr‹_evít_èbÀ
 {

363 
u32
 
	mvÆid
;

364 
u32
 
	mîr‹_id
;

365 
u32
 
	mpc
;

366 
u32
 
	mblök1
;

367 
u32
 
	mblök2
;

368 
u32
 
	mûök1
;

369 
u32
 
	mûök2
;

370 
u32
 
	md©a1
;

371 
u32
 
	md©a2
;

372 
u32
 
	mlöe
;

373 
u32
 
	mbc⁄_time
;

374 
u32
 
	mtsf_low
;

375 
u32
 
	mtsf_hi
;

376 
u32
 
	mgp1
;

377 
u32
 
	mgp2
;

378 
u32
 
	mgp3
;

379 
u32
 
	mucode_vî
;

380 
u32
 
	mhw_vî
;

381 
u32
 
	mbrd_vî
;

382 
u32
 
	mlog_pc
;

383 
u32
 
	m‰ame_±r
;

384 
u32
 
	m°ack_±r
;

385 
u32
 
	mhcmd
;

386 
u32
 
	mi§0
;

388 
u32
 
	mi§1
;

390 
u32
 
	mi§2
;

392 
u32
 
	mi§3
;

394 
u32
 
	mi§4
;

396 
u32
 
	mi§_¥ef
;

397 
u32
 
	mwaô_evít
;

398 
u32
 
	ml2p_c⁄åﬁ
;

399 
u32
 
	ml2p_duøti⁄
;

400 
u32
 
	ml2p_mhvÆid
;

401 
u32
 
	ml2p_addr_m©ch
;

402 
u32
 
	mlmpm_pmg_£l
;

404 
u32
 
	mu_time°amp
;

406 
u32
 
	mÊow_h™dÀr
;

407 } 
	g__∑cked
;

409 
	siwl_Æive_ª•
 {

410 
u8
 
	mucode_mö‹
;

411 
u8
 
	mucode_maj‹
;

412 
__À16
 
	mª£rved1
;

413 
u8
 
	msw_ªv
[8];

414 
u8
 
	mvî_ty≥
;

415 
u8
 
	mvî_subty≥
;

416 
__À16
 
	mª£rved2
;

417 
__À32
 
	mlog_evít_èbÀ_±r
;

418 
__À32
 
	mîr‹_evít_èbÀ_±r
;

419 
__À32
 
	mtime°amp
;

420 
__À32
 
	mis_vÆid
;

421 } 
	g__∑cked
;

426 
	siwl_îr‹_ª•
 {

427 
__À32
 
	mîr‹_ty≥
;

428 
u8
 
	mcmd_id
;

429 
u8
 
	mª£rved1
;

430 
__À16
 
	mbad_cmd_£q_num
;

431 
__À32
 
	mîr‹_öfo
;

432 
__À64
 
	mtime°amp
;

433 } 
	g__∑cked
;

446 
	mRXON_DEV_TYPE_AP
 = 1,

447 
	mRXON_DEV_TYPE_ESS
 = 3,

448 
	mRXON_DEV_TYPE_IBSS
 = 4,

449 
	mRXON_DEV_TYPE_SNIFFER
 = 6,

450 
	mRXON_DEV_TYPE_CP
 = 7,

451 
	mRXON_DEV_TYPE_2STA
 = 8,

452 
	mRXON_DEV_TYPE_P2P
 = 9,

456 
	#RXON_RX_CHAIN_DRIVER_FORCE_MSK
 
	`˝u_to_À16
(0x1 << 0)

	)

457 
	#RXON_RX_CHAIN_DRIVER_FORCE_POS
 (0)

	)

458 
	#RXON_RX_CHAIN_VALID_MSK
 
	`˝u_to_À16
(0x7 << 1)

	)

459 
	#RXON_RX_CHAIN_VALID_POS
 (1)

	)

460 
	#RXON_RX_CHAIN_FORCE_SEL_MSK
 
	`˝u_to_À16
(0x7 << 4)

	)

461 
	#RXON_RX_CHAIN_FORCE_SEL_POS
 (4)

	)

462 
	#RXON_RX_CHAIN_FORCE_MIMO_SEL_MSK
 
	`˝u_to_À16
(0x7 << 7)

	)

463 
	#RXON_RX_CHAIN_FORCE_MIMO_SEL_POS
 (7)

	)

464 
	#RXON_RX_CHAIN_CNT_MSK
 
	`˝u_to_À16
(0x3 << 10)

	)

465 
	#RXON_RX_CHAIN_CNT_POS
 (10)

	)

466 
	#RXON_RX_CHAIN_MIMO_CNT_MSK
 
	`˝u_to_À16
(0x3 << 12)

	)

467 
	#RXON_RX_CHAIN_MIMO_CNT_POS
 (12)

	)

468 
	#RXON_RX_CHAIN_MIMO_FORCE_MSK
 
	`˝u_to_À16
(0x1 << 14)

	)

469 
	#RXON_RX_CHAIN_MIMO_FORCE_POS
 (14)

	)

473 
	#RXON_FLG_BAND_24G_MSK
 
	`˝u_to_À32
(1 << 0)

	)

474 
	#RXON_FLG_CCK_MSK
 
	`˝u_to_À32
(1 << 1)

	)

476 
	#RXON_FLG_AUTO_DETECT_MSK
 
	`˝u_to_À32
(1 << 2)

	)

478 
	#RXON_FLG_TGG_PROTECT_MSK
 
	`˝u_to_À32
(1 << 3)

	)

480 
	#RXON_FLG_SHORT_SLOT_MSK
 
	`˝u_to_À32
(1 << 4)

	)

481 
	#RXON_FLG_SHORT_PREAMBLE_MSK
 
	`˝u_to_À32
(1 << 5)

	)

483 
	#RXON_FLG_DIS_DIV_MSK
 
	`˝u_to_À32
(1 << 7)

	)

484 
	#RXON_FLG_ANT_SEL_MSK
 
	`˝u_to_À32
(0x0f00)

	)

485 
	#RXON_FLG_ANT_A_MSK
 
	`˝u_to_À32
(1 << 8)

	)

486 
	#RXON_FLG_ANT_B_MSK
 
	`˝u_to_À32
(1 << 9)

	)

488 
	#RXON_FLG_RADAR_DETECT_MSK
 
	`˝u_to_À32
(1 << 12)

	)

489 
	#RXON_FLG_TGJ_NARROW_BAND_MSK
 
	`˝u_to_À32
(1 << 13)

	)

492 
	#RXON_FLG_TSF2HOST_MSK
 
	`˝u_to_À32
(1 << 15)

	)

496 
	#RXON_FLG_CTRL_CHANNEL_LOC_POS
 (22)

	)

497 
	#RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
 
	`˝u_to_À32
(0x1 << 22)

	)

499 
	#RXON_FLG_HT_OPERATING_MODE_POS
 (23)

	)

501 
	#RXON_FLG_HT_PROT_MSK
 
	`˝u_to_À32
(0x1 << 23)

	)

502 
	#RXON_FLG_HT40_PROT_MSK
 
	`˝u_to_À32
(0x2 << 23)

	)

504 
	#RXON_FLG_CHANNEL_MODE_POS
 (25)

	)

505 
	#RXON_FLG_CHANNEL_MODE_MSK
 
	`˝u_to_À32
(0x3 << 25)

	)

509 
	mCHANNEL_MODE_LEGACY
 = 0,

510 
	mCHANNEL_MODE_PURE_40
 = 1,

511 
	mCHANNEL_MODE_MIXED
 = 2,

512 
	mCHANNEL_MODE_RESERVED
 = 3,

514 
	#RXON_FLG_CHANNEL_MODE_LEGACY
 
	`˝u_to_À32
(
CHANNEL_MODE_LEGACY
 << 
RXON_FLG_CHANNEL_MODE_POS
)

	)

515 
	#RXON_FLG_CHANNEL_MODE_PURE_40
 
	`˝u_to_À32
(
CHANNEL_MODE_PURE_40
 << 
RXON_FLG_CHANNEL_MODE_POS
)

	)

516 
	#RXON_FLG_CHANNEL_MODE_MIXED
 
	`˝u_to_À32
(
CHANNEL_MODE_MIXED
 << 
RXON_FLG_CHANNEL_MODE_POS
)

	)

519 
	#RXON_FLG_SELF_CTS_EN
 
	`˝u_to_À32
(0x1<<30)

	)

523 
	#RXON_FILTER_PROMISC_MSK
 
	`˝u_to_À32
(1 << 0)

	)

525 
	#RXON_FILTER_CTL2HOST_MSK
 
	`˝u_to_À32
(1 << 1)

	)

527 
	#RXON_FILTER_ACCEPT_GRP_MSK
 
	`˝u_to_À32
(1 << 2)

	)

529 
	#RXON_FILTER_DIS_DECRYPT_MSK
 
	`˝u_to_À32
(1 << 3)

	)

531 
	#RXON_FILTER_DIS_GRP_DECRYPT_MSK
 
	`˝u_to_À32
(1 << 4)

	)

533 
	#RXON_FILTER_ASSOC_MSK
 
	`˝u_to_À32
(1 << 5)

	)

535 
	#RXON_FILTER_BCON_AWARE_MSK
 
	`˝u_to_À32
(1 << 6)

	)

555 
	siwl_rx⁄_cmd
 {

556 
u8
 
	mnode_addr
[6];

557 
__À16
 
	mª£rved1
;

558 
u8
 
	mbssid_addr
[6];

559 
__À16
 
	mª£rved2
;

560 
u8
 
	mwœp_bssid_addr
[6];

561 
__À16
 
	mª£rved3
;

562 
u8
 
	mdev_ty≥
;

563 
u8
 
	maú_¥›ag©i⁄
;

564 
__À16
 
	mrx_chaö
;

565 
u8
 
	mofdm_basic_øãs
;

566 
u8
 
	mcck_basic_øãs
;

567 
__À16
 
	massoc_id
;

568 
__À32
 
	mÊags
;

569 
__À32
 
	mfûãr_Êags
;

570 
__À16
 
	mch™√l
;

571 
u8
 
	mofdm_ht_sögÀ_°ªam_basic_øãs
;

572 
u8
 
	mofdm_ht_duÆ_°ªam_basic_øãs
;

573 
u8
 
	mofdm_ht_åùÀ_°ªam_basic_øãs
;

574 
u8
 
	mª£rved5
;

575 
__À16
 
	macquisôi⁄_d©a
;

576 
__À16
 
	mª£rved6
;

577 } 
	g__∑cked
;

582 
	siwl_rx⁄_assoc_cmd
 {

583 
__À32
 
	mÊags
;

584 
__À32
 
	mfûãr_Êags
;

585 
u8
 
	mofdm_basic_øãs
;

586 
u8
 
	mcck_basic_øãs
;

587 
__À16
 
	mª£rved1
;

588 
u8
 
	mofdm_ht_sögÀ_°ªam_basic_øãs
;

589 
u8
 
	mofdm_ht_duÆ_°ªam_basic_øãs
;

590 
u8
 
	mofdm_ht_åùÀ_°ªam_basic_øãs
;

591 
u8
 
	mª£rved2
;

592 
__À16
 
	mrx_chaö_£À˘_Êags
;

593 
__À16
 
	macquisôi⁄_d©a
;

594 
__À32
 
	mª£rved3
;

595 } 
	g__∑cked
;

597 
	#IWL_CONN_MAX_LISTEN_INTERVAL
 10

	)

598 
	#IWL_MAX_UCODE_BEACON_INTERVAL
 4

	)

603 
	siwl_rx⁄_time_cmd
 {

604 
__À64
 
	mtime°amp
;

605 
__À16
 
	mbóc⁄_öãrvÆ
;

606 
__À16
 
	m©im_wödow
;

607 
__À32
 
	mbóc⁄_öô_vÆ
;

608 
__À16
 
	mli°í_öãrvÆ
;

609 
u8
 
	mdtim_≥riod
;

610 
u8
 
	mdñè_˝_bss_tbâs
;

611 } 
	g__∑cked
;

627 
	siwl5000_ch™√l_swôch_cmd
 {

628 
u8
 
	mb™d
;

629 
u8
 
	mex≥˘_bóc⁄
;

630 
__À16
 
	mch™√l
;

631 
__À32
 
	mrx⁄_Êags
;

632 
__À32
 
	mrx⁄_fûãr_Êags
;

633 
__À32
 
	mswôch_time
;

634 
__À32
 
	mª£rved
[2][
IWL_PWR_NUM_HT_OFDM_ENTRIES
 + 
IWL_PWR_CCK_ENTRIES
];

635 } 
	g__∑cked
;

648 
	siwl6000_ch™√l_swôch_cmd
 {

649 
u8
 
	mb™d
;

650 
u8
 
	mex≥˘_bóc⁄
;

651 
__À16
 
	mch™√l
;

652 
__À32
 
	mrx⁄_Êags
;

653 
__À32
 
	mrx⁄_fûãr_Êags
;

654 
__À32
 
	mswôch_time
;

655 
__À32
 
	mª£rved
[3][
IWL_PWR_NUM_HT_OFDM_ENTRIES
 + 
IWL_PWR_CCK_ENTRIES
];

656 } 
	g__∑cked
;

661 
	siwl_cß_nŸifiˇti⁄
 {

662 
__À16
 
	mb™d
;

663 
__À16
 
	mch™√l
;

664 
__À32
 
	m°©us
;

665 } 
	g__∑cked
;

690 
	siwl_ac_qos
 {

691 
__À16
 
	mcw_mö
;

692 
__À16
 
	mcw_max
;

693 
u8
 
	maif¢
;

694 
u8
 
	mª£rved1
;

695 
__À16
 
	medˇ_tx›
;

696 } 
	g__∑cked
;

699 
	#QOS_PARAM_FLG_UPDATE_EDCA_MSK
 
	`˝u_to_À32
(0x01)

	)

700 
	#QOS_PARAM_FLG_TGN_MSK
 
	`˝u_to_À32
(0x02)

	)

701 
	#QOS_PARAM_FLG_TXOP_TYPE_MSK
 
	`˝u_to_À32
(0x10)

	)

704 
	#AC_NUM
 4

	)

712 
	siwl_qo•¨am_cmd
 {

713 
__À32
 
	mqos_Êags
;

714 
iwl_ac_qos
 
	mac
[
AC_NUM
];

715 } 
	g__∑cked
;

727 
	#IWL_AP_ID
 0

	)

728 
	#IWL_AP_ID_PAN
 1

	)

729 
	#IWL_STA_ID
 2

	)

730 
	#IWLAGN_PAN_BCAST_ID
 14

	)

731 
	#IWLAGN_BROADCAST_ID
 15

	)

732 
	#IWLAGN_STATION_COUNT
 16

	)

734 
	#IWL_TID_NON_QOS
 
IWL_MAX_TID_COUNT


	)

736 
	#STA_FLG_TX_RATE_MSK
 
	`˝u_to_À32
(1 << 2)

	)

737 
	#STA_FLG_PWR_SAVE_MSK
 
	`˝u_to_À32
(1 << 8)

	)

738 
	#STA_FLG_PAN_STATION
 
	`˝u_to_À32
(1 << 13)

	)

739 
	#STA_FLG_RTS_MIMO_PROT_MSK
 
	`˝u_to_À32
(1 << 17)

	)

740 
	#STA_FLG_AGG_MPDU_8US_MSK
 
	`˝u_to_À32
(1 << 18)

	)

741 
	#STA_FLG_MAX_AGG_SIZE_POS
 (19)

	)

742 
	#STA_FLG_MAX_AGG_SIZE_MSK
 
	`˝u_to_À32
(3 << 19)

	)

743 
	#STA_FLG_HT40_EN_MSK
 
	`˝u_to_À32
(1 << 21)

	)

744 
	#STA_FLG_MIMO_DIS_MSK
 
	`˝u_to_À32
(1 << 22)

	)

745 
	#STA_FLG_AGG_MPDU_DENSITY_POS
 (23)

	)

746 
	#STA_FLG_AGG_MPDU_DENSITY_MSK
 
	`˝u_to_À32
(7 << 23)

	)

749 
	#STA_CONTROL_MODIFY_MSK
 0x01

	)

752 
	#STA_KEY_FLG_ENCRYPT_MSK
 
	`˝u_to_À16
(0x0007)

	)

753 
	#STA_KEY_FLG_NO_ENC
 
	`˝u_to_À16
(0x0000)

	)

754 
	#STA_KEY_FLG_WEP
 
	`˝u_to_À16
(0x0001)

	)

755 
	#STA_KEY_FLG_CCMP
 
	`˝u_to_À16
(0x0002)

	)

756 
	#STA_KEY_FLG_TKIP
 
	`˝u_to_À16
(0x0003)

	)

758 
	#STA_KEY_FLG_KEYID_POS
 8

	)

759 
	#STA_KEY_FLG_INVALID
 
	`˝u_to_À16
(0x0800)

	)

761 
	#STA_KEY_FLG_MAP_KEY_MSK
 
	`˝u_to_À16
(0x0008)

	)

764 
	#STA_KEY_FLG_KEY_SIZE_MSK
 
	`˝u_to_À16
(0x1000)

	)

765 
	#STA_KEY_MULTICAST_MSK
 
	`˝u_to_À16
(0x4000)

	)

766 
	#STA_KEY_MAX_NUM
 8

	)

767 
	#STA_KEY_MAX_NUM_PAN
 16

	)

769 
	#IWLAGN_HW_KEY_DEFAULT
 0x„

	)

772 
	#STA_MODIFY_KEY_MASK
 0x01

	)

773 
	#STA_MODIFY_TID_DISABLE_TX
 0x02

	)

774 
	#STA_MODIFY_TX_RATE_MSK
 0x04

	)

775 
	#STA_MODIFY_ADDBA_TID_MSK
 0x08

	)

776 
	#STA_MODIFY_DELBA_TID_MSK
 0x10

	)

777 
	#STA_MODIFY_SLEEP_TX_COUNT_MSK
 0x20

	)

780 
	siwl_keyöfo
 {

781 
__À16
 
	mkey_Êags
;

782 
u8
 
	mtkù_rx_tsc_byã2
;

783 
u8
 
	mª£rved1
;

784 
__À16
 
	mtkù_rx_âak
[5];

785 
u8
 
	mkey_off£t
;

786 
u8
 
	mª£rved2
;

787 
u8
 
	mkey
[16];

788 
__À64
 
	mtx_£cur_£q_˙t
;

789 
__À64
 
	mhw_tkù_mic_rx_key
;

790 
__À64
 
	mhw_tkù_mic_tx_key
;

791 } 
	g__∑cked
;

807 
	s°a_id_modify
 {

808 
u8
 
	maddr
[
ETH_ALEN
];

809 
__À16
 
	mª£rved1
;

810 
u8
 
	m°a_id
;

811 
u8
 
	mmodify_mask
;

812 
__À16
 
	mª£rved2
;

813 } 
	g__∑cked
;

841 
	siwl_add°a_cmd
 {

842 
u8
 
	mmode
;

843 
u8
 
	mª£rved
[3];

844 
°a_id_modify
 
	m°a
;

845 
iwl_keyöfo
 
	mkey
;

846 
__À32
 
	m°©i⁄_Êags
;

847 
__À32
 
	m°©i⁄_Êags_msk
;

852 
__À16
 
	mtid_dißbÀ_tx
;

853 
__À16
 
	mÀgacy_ª£rved
;

857 
u8
 
	madd_immedüã_ba_tid
;

861 
u8
 
	mªmove_immedüã_ba_tid
;

865 
__À16
 
	madd_immedüã_ba_s¢
;

872 
__À16
 
	m¶ìp_tx_cou¡
;

874 
__À16
 
	mª£rved2
;

875 } 
	g__∑cked
;

878 
	#ADD_STA_SUCCESS_MSK
 0x1

	)

879 
	#ADD_STA_NO_ROOM_IN_TABLE
 0x2

	)

880 
	#ADD_STA_NO_BLOCK_ACK_RESOURCE
 0x4

	)

881 
	#ADD_STA_MODIFY_NON_EXIST_STA
 0x8

	)

885 
	siwl_add_°a_ª•
 {

886 
u8
 
	m°©us
;

887 } 
	g__∑cked
;

889 
	#REM_STA_SUCCESS_MSK
 0x1

	)

893 
	siwl_ªm_°a_ª•
 {

894 
u8
 
	m°©us
;

895 } 
	g__∑cked
;

900 
	siwl_ªm_°a_cmd
 {

901 
u8
 
	mnum_°a
;

902 
u8
 
	mª£rved
[3];

903 
u8
 
	maddr
[
ETH_ALEN
];

904 
u8
 
	mª£rved2
[2];

905 } 
	g__∑cked
;

909 
	#IWL_SCD_BK_MSK
 
	`BIT
(0)

	)

910 
	#IWL_SCD_BE_MSK
 
	`BIT
(1)

	)

911 
	#IWL_SCD_VI_MSK
 
	`BIT
(2)

	)

912 
	#IWL_SCD_VO_MSK
 
	`BIT
(3)

	)

913 
	#IWL_SCD_MGMT_MSK
 
	`BIT
(3)

	)

916 
	#IWL_PAN_SCD_BK_MSK
 
	`BIT
(4)

	)

917 
	#IWL_PAN_SCD_BE_MSK
 
	`BIT
(5)

	)

918 
	#IWL_PAN_SCD_VI_MSK
 
	`BIT
(6)

	)

919 
	#IWL_PAN_SCD_VO_MSK
 
	`BIT
(7)

	)

920 
	#IWL_PAN_SCD_MGMT_MSK
 
	`BIT
(7)

	)

921 
	#IWL_PAN_SCD_MULTICAST_MSK
 
	`BIT
(8)

	)

923 
	#IWL_AGG_TX_QUEUE_MSK
 0xffc00

	)

925 
	#IWL_DROP_ALL
 
	`BIT
(1)

	)

948 
	siwl_txfifo_Êush_cmd_v3
 {

949 
__À32
 
	mqueue_c⁄åﬁ
;

950 
__À16
 
	mÊush_c⁄åﬁ
;

951 
__À16
 
	mª£rved
;

952 } 
	g__∑cked
;

954 
	siwl_txfifo_Êush_cmd_v2
 {

955 
__À16
 
	mqueue_c⁄åﬁ
;

956 
__À16
 
	mÊush_c⁄åﬁ
;

957 } 
	g__∑cked
;

962 
	siwl_wï_key
 {

963 
u8
 
	mkey_ödex
;

964 
u8
 
	mkey_off£t
;

965 
u8
 
	mª£rved1
[2];

966 
u8
 
	mkey_size
;

967 
u8
 
	mª£rved2
[3];

968 
u8
 
	mkey
[16];

969 } 
	g__∑cked
;

971 
	siwl_wï_cmd
 {

972 
u8
 
	mnum_keys
;

973 
u8
 
	mglobÆ_key_ty≥
;

974 
u8
 
	mÊags
;

975 
u8
 
	mª£rved
;

976 
iwl_wï_key
 
	mkey
[];

977 } 
	g__∑cked
;

979 
	#WEP_KEY_WEP_TYPE
 1

	)

980 
	#WEP_KEYS_MAX
 4

	)

981 
	#WEP_INVALID_OFFSET
 0xff

	)

982 
	#WEP_KEY_LEN_64
 5

	)

983 
	#WEP_KEY_LEN_128
 13

	)

991 
	#RX_RES_STATUS_NO_CRC32_ERROR
 
	`˝u_to_À32
(1 << 0)

	)

992 
	#RX_RES_STATUS_NO_RXE_OVERFLOW
 
	`˝u_to_À32
(1 << 1)

	)

994 
	#RX_RES_PHY_FLAGS_BAND_24_MSK
 
	`˝u_to_À16
(1 << 0)

	)

995 
	#RX_RES_PHY_FLAGS_MOD_CCK_MSK
 
	`˝u_to_À16
(1 << 1)

	)

996 
	#RX_RES_PHY_FLAGS_SHORT_PREAMBLE_MSK
 
	`˝u_to_À16
(1 << 2)

	)

997 
	#RX_RES_PHY_FLAGS_NARROW_BAND_MSK
 
	`˝u_to_À16
(1 << 3)

	)

998 
	#RX_RES_PHY_FLAGS_ANTENNA_MSK
 0x70

	)

999 
	#RX_RES_PHY_FLAGS_ANTENNA_POS
 4

	)

1000 
	#RX_RES_PHY_FLAGS_AGG_MSK
 
	`˝u_to_À16
(1 << 7)

	)

1002 
	#RX_RES_STATUS_SEC_TYPE_MSK
 (0x7 << 8)

	)

1003 
	#RX_RES_STATUS_SEC_TYPE_NONE
 (0x0 << 8)

	)

1004 
	#RX_RES_STATUS_SEC_TYPE_WEP
 (0x1 << 8)

	)

1005 
	#RX_RES_STATUS_SEC_TYPE_CCMP
 (0x2 << 8)

	)

1006 
	#RX_RES_STATUS_SEC_TYPE_TKIP
 (0x3 << 8)

	)

1007 
	#RX_RES_STATUS_SEC_TYPE_ERR
 (0x7 << 8)

	)

1009 
	#RX_RES_STATUS_STATION_FOUND
 (1<<6)

	)

1010 
	#RX_RES_STATUS_NO_STATION_INFO_MISMATCH
 (1<<7)

	)

1012 
	#RX_RES_STATUS_DECRYPT_TYPE_MSK
 (0x3 << 11)

	)

1013 
	#RX_RES_STATUS_NOT_DECRYPT
 (0x0 << 11)

	)

1014 
	#RX_RES_STATUS_DECRYPT_OK
 (0x3 << 11)

	)

1015 
	#RX_RES_STATUS_BAD_ICV_MIC
 (0x1 << 11)

	)

1016 
	#RX_RES_STATUS_BAD_KEY_TTAK
 (0x2 << 11)

	)

1018 
	#RX_MPDU_RES_STATUS_ICV_OK
 (0x20)

	)

1019 
	#RX_MPDU_RES_STATUS_MIC_OK
 (0x40)

	)

1020 
	#RX_MPDU_RES_STATUS_TTAK_OK
 (1 << 7)

	)

1021 
	#RX_MPDU_RES_STATUS_DEC_DONE_MSK
 (0x800)

	)

1024 
	#IWLAGN_RX_RES_PHY_CNT
 8

	)

1025 
	#IWLAGN_RX_RES_AGC_IDX
 1

	)

1026 
	#IWLAGN_RX_RES_RSSI_AB_IDX
 2

	)

1027 
	#IWLAGN_RX_RES_RSSI_C_IDX
 3

	)

1028 
	#IWLAGN_OFDM_AGC_MSK
 0x„00

	)

1029 
	#IWLAGN_OFDM_AGC_BIT_POS
 9

	)

1030 
	#IWLAGN_OFDM_RSSI_INBAND_A_BITMSK
 0x00ff

	)

1031 
	#IWLAGN_OFDM_RSSI_ALLBAND_A_BITMSK
 0xff00

	)

1032 
	#IWLAGN_OFDM_RSSI_A_BIT_POS
 0

	)

1033 
	#IWLAGN_OFDM_RSSI_INBAND_B_BITMSK
 0xff0000

	)

1034 
	#IWLAGN_OFDM_RSSI_ALLBAND_B_BITMSK
 0xff000000

	)

1035 
	#IWLAGN_OFDM_RSSI_B_BIT_POS
 16

	)

1036 
	#IWLAGN_OFDM_RSSI_INBAND_C_BITMSK
 0x00ff

	)

1037 
	#IWLAGN_OFDM_RSSI_ALLBAND_C_BITMSK
 0xff00

	)

1038 
	#IWLAGN_OFDM_RSSI_C_BIT_POS
 0

	)

1040 
	siwœgn_n⁄_cfg_phy
 {

1041 
__À32
 
	mn⁄_cfg_phy
[
IWLAGN_RX_RES_PHY_CNT
];

1042 } 
	g__∑cked
;

1049 
	siwl_rx_phy_ªs
 {

1050 
u8
 
	mn⁄_cfg_phy_˙t
;

1051 
u8
 
	mcfg_phy_˙t
;

1052 
u8
 
	m°©_id
;

1053 
u8
 
	mª£rved1
;

1054 
__À64
 
	mtime°amp
;

1055 
__À32
 
	mbóc⁄_time_°amp
;

1056 
__À16
 
	mphy_Êags
;

1057 
__À16
 
	mch™√l
;

1058 
u8
 
	mn⁄_cfg_phy_buf
[32];

1059 
__À32
 
	møã_n_Êags
;

1060 
__À16
 
	mbyã_cou¡
;

1061 
__À16
 
	m‰ame_time
;

1062 } 
	g__∑cked
;

1064 
	siwl_rx_mpdu_ªs_°¨t
 {

1065 
__À16
 
	mbyã_cou¡
;

1066 
__À16
 
	mª£rved
;

1067 } 
	g__∑cked
;

1101 
	#TX_CMD_FLG_PROT_REQUIRE_MSK
 
	`˝u_to_À32
(1 << 0)

	)

1106 
	#TX_CMD_FLG_ACK_MSK
 
	`˝u_to_À32
(1 << 3)

	)

1114 
	#TX_CMD_FLG_STA_RATE_MSK
 
	`˝u_to_À32
(1 << 4)

	)

1118 
	#TX_CMD_FLG_IMM_BA_RSP_MASK
 
	`˝u_to_À32
(1 << 6)

	)

1121 
	#TX_CMD_FLG_ANT_SEL_MSK
 
	`˝u_to_À32
(0xf00)

	)

1125 
	#TX_CMD_FLG_IGNORE_BT
 
	`˝u_to_À32
(1 << 12)

	)

1131 
	#TX_CMD_FLG_SEQ_CTL_MSK
 
	`˝u_to_À32
(1 << 13)

	)

1135 
	#TX_CMD_FLG_MORE_FRAG_MSK
 
	`˝u_to_À32
(1 << 14)

	)

1140 
	#TX_CMD_FLG_TSF_MSK
 
	`˝u_to_À32
(1 << 16)

	)

1148 
	#TX_CMD_FLG_MH_PAD_MSK
 
	`˝u_to_À32
(1 << 20)

	)

1152 
	#TX_CMD_FLG_AGG_CCMP_MSK
 
	`˝u_to_À32
(1 << 22)

	)

1155 
	#TX_CMD_FLG_DUR_MSK
 
	`˝u_to_À32
(1 << 25)

	)

1161 
	#TX_CMD_SEC_WEP
 0x01

	)

1162 
	#TX_CMD_SEC_CCM
 0x02

	)

1163 
	#TX_CMD_SEC_TKIP
 0x03

	)

1164 
	#TX_CMD_SEC_MSK
 0x03

	)

1165 
	#TX_CMD_SEC_SHIFT
 6

	)

1166 
	#TX_CMD_SEC_KEY128
 0x08

	)

1176 
	siwl_døm_s¸©ch
 {

1177 
u8
 
	måy_˙t
;

1178 
u8
 
	mbt_kûl_˙t
;

1179 
__À16
 
	mª£rved
;

1180 } 
	g__∑cked
;

1182 
	siwl_tx_cmd
 {

1193 
__À16
 
	mÀn
;

1200 
__À16
 
	m√xt_‰ame_Àn
;

1202 
__À32
 
	mtx_Êags
;

1206 
iwl_døm_s¸©ch
 
	ms¸©ch
;

1209 
__À32
 
	møã_n_Êags
;

1212 
u8
 
	m°a_id
;

1215 
u8
 
	m£c_˘l
;

1224 
u8
 
	möôül_øã_ödex
;

1225 
u8
 
	mª£rved
;

1226 
u8
 
	mkey
[16];

1227 
__À16
 
	m√xt_‰ame_Êags
;

1228 
__À16
 
	mª£rved2
;

1230 
__À32
 
	mli„_time
;

1231 
__À32
 
	m©ãm±
;

1232 } 
	m°›_time
;

1236 
__À32
 
	mdøm_lsb_±r
;

1237 
u8
 
	mdøm_msb_±r
;

1239 
u8
 
	mπs_ªåy_limô
;

1240 
u8
 
	md©a_ªåy_limô
;

1241 
u8
 
	mtid_t•ec
;

1243 
__À16
 
	mpm_‰ame_timeout
;

1244 
__À16
 
	m©ãm±_duøti⁄
;

1245 } 
	mtimeout
;

1251 
__À16
 
	mdrivî_tx›
;

1258 
DECLARE_FLEX_ARRAY
(
u8
, 
∑ylﬂd
);

1259 
DECLARE_FLEX_ARRAY
(
õì80211_hdr
, 
hdr
);

1261 } 
	g__∑cked
;

1271 
	mTX_STATUS_SUCCESS
 = 0x01,

1272 
	mTX_STATUS_DIRECT_DONE
 = 0x02,

1274 
	mTX_STATUS_POSTPONE_DELAY
 = 0x40,

1275 
	mTX_STATUS_POSTPONE_FEW_BYTES
 = 0x41,

1276 
	mTX_STATUS_POSTPONE_BT_PRIO
 = 0x42,

1277 
	mTX_STATUS_POSTPONE_QUIET_PERIOD
 = 0x43,

1278 
	mTX_STATUS_POSTPONE_CALC_TTAK
 = 0x44,

1280 
	mTX_STATUS_FAIL_INTERNAL_CROSSED_RETRY
 = 0x81,

1281 
	mTX_STATUS_FAIL_SHORT_LIMIT
 = 0x82,

1282 
	mTX_STATUS_FAIL_LONG_LIMIT
 = 0x83,

1283 
	mTX_STATUS_FAIL_FIFO_UNDERRUN
 = 0x84,

1284 
	mTX_STATUS_FAIL_DRAIN_FLOW
 = 0x85,

1285 
	mTX_STATUS_FAIL_RFKILL_FLUSH
 = 0x86,

1286 
	mTX_STATUS_FAIL_LIFE_EXPIRE
 = 0x87,

1287 
	mTX_STATUS_FAIL_DEST_PS
 = 0x88,

1288 
	mTX_STATUS_FAIL_HOST_ABORTED
 = 0x89,

1289 
	mTX_STATUS_FAIL_BT_RETRY
 = 0x8a,

1290 
	mTX_STATUS_FAIL_STA_INVALID
 = 0x8b,

1291 
	mTX_STATUS_FAIL_FRAG_DROPPED
 = 0x8c,

1292 
	mTX_STATUS_FAIL_TID_DISABLE
 = 0x8d,

1293 
	mTX_STATUS_FAIL_FIFO_FLUSHED
 = 0x8e,

1294 
	mTX_STATUS_FAIL_INSUFFICIENT_CF_POLL
 = 0x8f,

1295 
	mTX_STATUS_FAIL_PASSIVE_NO_RX
 = 0x90,

1296 
	mTX_STATUS_FAIL_NO_BEACON_ON_RADAR
 = 0x91,

1299 
	#TX_PACKET_MODE_REGULAR
 0x0000

	)

1300 
	#TX_PACKET_MODE_BURST_SEQ
 0x0100

	)

1301 
	#TX_PACKET_MODE_BURST_FIRST
 0x0200

	)

1304 
	mTX_POWER_PA_NOT_ACTIVE
 = 0x0,

1308 
	mTX_STATUS_MSK
 = 0x000000ff,

1309 
	mTX_STATUS_DELAY_MSK
 = 0x00000040,

1310 
	mTX_STATUS_ABORT_MSK
 = 0x00000080,

1311 
	mTX_PACKET_MODE_MSK
 = 0x0000ff00,

1312 
	mTX_FIFO_NUMBER_MSK
 = 0x00070000,

1313 
	mTX_RESERVED
 = 0x00780000,

1314 
	mTX_POWER_PA_DETECT_MSK
 = 0x7f800000,

1315 
	mTX_ABORT_REQUIRED_MSK
 = 0x80000000,

1323 
	mAGG_TX_STATE_TRANSMITTED
 = 0x00,

1324 
	mAGG_TX_STATE_UNDERRUN_MSK
 = 0x01,

1325 
	mAGG_TX_STATE_BT_PRIO_MSK
 = 0x02,

1326 
	mAGG_TX_STATE_FEW_BYTES_MSK
 = 0x04,

1327 
	mAGG_TX_STATE_ABORT_MSK
 = 0x08,

1328 
	mAGG_TX_STATE_LAST_SENT_TTL_MSK
 = 0x10,

1329 
	mAGG_TX_STATE_LAST_SENT_TRY_CNT_MSK
 = 0x20,

1330 
	mAGG_TX_STATE_LAST_SENT_BT_KILL_MSK
 = 0x40,

1331 
	mAGG_TX_STATE_SCD_QUERY_MSK
 = 0x80,

1332 
	mAGG_TX_STATE_TEST_BAD_CRC32_MSK
 = 0x100,

1333 
	mAGG_TX_STATE_RESPONSE_MSK
 = 0x1ff,

1334 
	mAGG_TX_STATE_DUMP_TX_MSK
 = 0x200,

1335 
	mAGG_TX_STATE_DELAY_TX_MSK
 = 0x400

1338 
	#AGG_TX_STATUS_MSK
 0x00000ff‡

	)

1339 
	#AGG_TX_TRY_MSK
 0x0000f000

	)

1340 
	#AGG_TX_TRY_POS
 12

	)

1342 
	#AGG_TX_STATE_LAST_SENT_MSK
 (
AGG_TX_STATE_LAST_SENT_TTL_MSK
 | \

1343 
AGG_TX_STATE_LAST_SENT_TRY_CNT_MSK
 | \

1344 
AGG_TX_STATE_LAST_SENT_BT_KILL_MSK
)

	)

1347 
	#AGG_TX_STATE_TRY_CNT_POS
 12

	)

1348 
	#AGG_TX_STATE_TRY_CNT_MSK
 0xf000

	)

1351 
	#AGG_TX_STATE_SEQ_NUM_POS
 16

	)

1352 
	#AGG_TX_STATE_SEQ_NUM_MSK
 0xffff0000

	)

1376 
	sagg_tx_°©us
 {

1377 
__À16
 
	m°©us
;

1378 
__À16
 
	m£quí˚
;

1379 } 
	g__∑cked
;

1382 
	#IWLAGN_TX_RES_TID_POS
 0

	)

1383 
	#IWLAGN_TX_RES_TID_MSK
 0x0f

	)

1384 
	#IWLAGN_TX_RES_RA_POS
 4

	)

1385 
	#IWLAGN_TX_RES_RA_MSK
 0xf0

	)

1387 
	siwœgn_tx_ª•
 {

1388 
u8
 
	m‰ame_cou¡
;

1389 
u8
 
	mbt_kûl_cou¡
;

1390 
u8
 
	mÁûuª_πs
;

1391 
u8
 
	mÁûuª_‰ame
;

1395 
__À32
 
	møã_n_Êags
;

1399 
__À16
 
	mwúñess_medü_time
;

1401 
u8
 
	m∑_°©us
;

1402 
u8
 
	m∑_öãg_ªs_a
[3];

1403 
u8
 
	m∑_öãg_ªs_b
[3];

1404 
u8
 
	m∑_öãg_ªs_C
[3];

1406 
__À32
 
	mtfd_öfo
;

1407 
__À16
 
	m£q_˘l
;

1408 
__À16
 
	mbyã_˙t
;

1409 
u8
 
	méc_öfo
;

1410 
u8
 
	mø_tid
;

1411 
__À16
 
	m‰ame_˘æ
;

1425 
agg_tx_°©us
 
	m°©us
;

1427 } 
	g__∑cked
;

1433 
	siwl_com¥es£d_ba_ª•
 {

1434 
__À32
 
	m°a_addr_lo32
;

1435 
__À16
 
	m°a_addr_hi16
;

1436 
__À16
 
	mª£rved
;

1439 
u8
 
	m°a_id
;

1440 
u8
 
	mtid
;

1441 
__À16
 
	m£q_˘l
;

1442 
__À64
 
	mbôm≠
;

1443 
__À16
 
	mscd_Êow
;

1444 
__À16
 
	mscd_s¢
;

1445 
u8
 
	mtxed
;

1446 
u8
 
	mtxed_2_d⁄e
;

1447 
__À16
 
	mª£rved1
;

1448 } 
	g__∑cked
;

1456 
	#LINK_QUAL_FLAGS_SET_STA_TLC_RTS_MSK
 (1 << 0)

	)

1459 
	#LINK_QUAL_AC_NUM
 
AC_NUM


	)

1462 
	#LINK_QUAL_MAX_RETRY_NUM
 16

	)

1465 
	#LINK_QUAL_ANT_A_MSK
 (1 << 0)

	)

1466 
	#LINK_QUAL_ANT_B_MSK
 (1 << 1)

	)

1467 
	#LINK_QUAL_ANT_MSK
 (
LINK_QUAL_ANT_A_MSK
|
LINK_QUAL_ANT_B_MSK
)

	)

1475 
	siwl_lök_quÆ_gíîÆ_∑øms
 {

1476 
u8
 
	mÊags
;

1479 
u8
 
	mmimo_dñimôî
;

1482 
u8
 
	msögÀ_°ªam_™t_msk
;

1485 
u8
 
	mduÆ_°ªam_™t_msk
;

1498 
u8
 
	m°¨t_øã_ödex
[
LINK_QUAL_AC_NUM
];

1499 } 
	g__∑cked
;

1501 
	#LINK_QUAL_AGG_TIME_LIMIT_DEF
 (4000Ë

	)

1502 
	#LINK_QUAL_AGG_TIME_LIMIT_MAX
 (8000)

	)

1503 
	#LINK_QUAL_AGG_TIME_LIMIT_MIN
 (100)

	)

1505 
	#LINK_QUAL_AGG_DISABLE_START_DEF
 (3)

	)

1506 
	#LINK_QUAL_AGG_DISABLE_START_MAX
 (255)

	)

1507 
	#LINK_QUAL_AGG_DISABLE_START_MIN
 (0)

	)

1509 
	#LINK_QUAL_AGG_FRAME_LIMIT_DEF
 (63)

	)

1510 
	#LINK_QUAL_AGG_FRAME_LIMIT_MAX
 (63)

	)

1511 
	#LINK_QUAL_AGG_FRAME_LIMIT_MIN
 (0)

	)

1518 
	siwl_lök_quÆ_agg_∑øms
 {

1524 
__À16
 
	magg_time_limô
;

1532 
u8
 
	magg_dis_°¨t_th
;

1539 
u8
 
	magg_‰ame_˙t_limô
;

1541 
__À32
 
	mª£rved
;

1542 } 
	g__∑cked
;

1732 
	siwl_lök_quÆôy_cmd
 {

1735 
u8
 
	m°a_id
;

1736 
u8
 
	mª£rved1
;

1737 
__À16
 
	mc⁄åﬁ
;

1738 
iwl_lök_quÆ_gíîÆ_∑øms
 
	mgíîÆ_∑øms
;

1739 
iwl_lök_quÆ_agg_∑øms
 
	magg_∑øms
;

1747 
__À32
 
	møã_n_Êags
;

1748 } 
	mrs_èbÀ
[
LINK_QUAL_MAX_RETRY_NUM
];

1749 
__À32
 
	mª£rved2
;

1750 } 
	g__∑cked
;

1761 
	#BT_COEX_DISABLE
 (0x0)

	)

1762 
	#BT_ENABLE_CHANNEL_ANNOUNCE
 
	`BIT
(0)

	)

1763 
	#BT_ENABLE_PRIORITY
 
	`BIT
(1)

	)

1764 
	#BT_ENABLE_2_WIRE
 
	`BIT
(2)

	)

1766 
	#BT_COEX_DISABLE
 (0x0)

	)

1767 
	#BT_COEX_ENABLE
 (
BT_ENABLE_CHANNEL_ANNOUNCE
 | 
BT_ENABLE_PRIORITY
)

	)

1769 
	#BT_LEAD_TIME_MIN
 (0x0)

	)

1770 
	#BT_LEAD_TIME_DEF
 (0x1E)

	)

1771 
	#BT_LEAD_TIME_MAX
 (0xFF)

	)

1773 
	#BT_MAX_KILL_MIN
 (0x1)

	)

1774 
	#BT_MAX_KILL_DEF
 (0x5)

	)

1775 
	#BT_MAX_KILL_MAX
 (0xFF)

	)

1777 
	#BT_DURATION_LIMIT_DEF
 625

	)

1778 
	#BT_DURATION_LIMIT_MAX
 1250

	)

1779 
	#BT_DURATION_LIMIT_MIN
 625

	)

1781 
	#BT_ON_THRESHOLD_DEF
 4

	)

1782 
	#BT_ON_THRESHOLD_MAX
 1000

	)

1783 
	#BT_ON_THRESHOLD_MIN
 1

	)

1785 
	#BT_FRAG_THRESHOLD_DEF
 0

	)

1786 
	#BT_FRAG_THRESHOLD_MAX
 0

	)

1787 
	#BT_FRAG_THRESHOLD_MIN
 0

	)

1789 
	#BT_AGG_THRESHOLD_DEF
 1200

	)

1790 
	#BT_AGG_THRESHOLD_MAX
 8000

	)

1791 
	#BT_AGG_THRESHOLD_MIN
 400

	)

1800 
	siwl_bt_cmd
 {

1801 
u8
 
	mÊags
;

1802 
u8
 
	mÀad_time
;

1803 
u8
 
	mmax_kûl
;

1804 
u8
 
	mª£rved
;

1805 
__À32
 
	mkûl_ack_mask
;

1806 
__À32
 
	mkûl_˘s_mask
;

1807 } 
	g__∑cked
;

1809 
	#IWLAGN_BT_FLAG_CHANNEL_INHIBITION
 
	`BIT
(0)

	)

1811 
	#IWLAGN_BT_FLAG_COEX_MODE_MASK
 (
	`BIT
(3)|BIT(4)|BIT(5))

	)

1812 
	#IWLAGN_BT_FLAG_COEX_MODE_SHIFT
 3

	)

1813 
	#IWLAGN_BT_FLAG_COEX_MODE_DISABLED
 0

	)

1814 
	#IWLAGN_BT_FLAG_COEX_MODE_LEGACY_2W
 1

	)

1815 
	#IWLAGN_BT_FLAG_COEX_MODE_3W
 2

	)

1816 
	#IWLAGN_BT_FLAG_COEX_MODE_4W
 3

	)

1818 
	#IWLAGN_BT_FLAG_UCODE_DEFAULT
 
	`BIT
(6)

	)

1820 
	#IWLAGN_BT_FLAG_SYNC_2_BT_DISABLE
 
	`BIT
(7)

	)

1822 
	#IWLAGN_BT_PSP_MIN_RSSI_THRESHOLD
 -75

	)

1823 
	#IWLAGN_BT_PSP_MAX_RSSI_THRESHOLD
 -65

	)

1825 
	#IWLAGN_BT_PRIO_BOOST_MAX
 0xFF

	)

1826 
	#IWLAGN_BT_PRIO_BOOST_MIN
 0x00

	)

1827 
	#IWLAGN_BT_PRIO_BOOST_DEFAULT
 0xF0

	)

1828 
	#IWLAGN_BT_PRIO_BOOST_DEFAULT32
 0xF0F0F0F0

	)

1830 
	#IWLAGN_BT_MAX_KILL_DEFAULT
 5

	)

1832 
	#IWLAGN_BT3_T7_DEFAULT
 1

	)

1834 
	eiwl_bt_kûl_idx
 {

1835 
	mIWL_BT_KILL_DEFAULT
 = 0,

1836 
	mIWL_BT_KILL_OVERRIDE
 = 1,

1837 
	mIWL_BT_KILL_REDUCE
 = 2,

1840 
	#IWLAGN_BT_KILL_ACK_MASK_DEFAULT
 
	`˝u_to_À32
(0xffff0000)

	)

1841 
	#IWLAGN_BT_KILL_CTS_MASK_DEFAULT
 
	`˝u_to_À32
(0xffff0000)

	)

1842 
	#IWLAGN_BT_KILL_ACK_CTS_MASK_SCO
 
	`˝u_to_À32
(0xffffffff)

	)

1843 
	#IWLAGN_BT_KILL_ACK_CTS_MASK_REDUCE
 
	`˝u_to_À32
(0)

	)

1845 
	#IWLAGN_BT3_PRIO_SAMPLE_DEFAULT
 2

	)

1847 
	#IWLAGN_BT3_T2_DEFAULT
 0xc

	)

1849 
	#IWLAGN_BT_VALID_ENABLE_FLAGS
 
	`˝u_to_À16
(
	`BIT
(0))

	)

1850 
	#IWLAGN_BT_VALID_BOOST
 
	`˝u_to_À16
(
	`BIT
(1))

	)

1851 
	#IWLAGN_BT_VALID_MAX_KILL
 
	`˝u_to_À16
(
	`BIT
(2))

	)

1852 
	#IWLAGN_BT_VALID_3W_TIMERS
 
	`˝u_to_À16
(
	`BIT
(3))

	)

1853 
	#IWLAGN_BT_VALID_KILL_ACK_MASK
 
	`˝u_to_À16
(
	`BIT
(4))

	)

1854 
	#IWLAGN_BT_VALID_KILL_CTS_MASK
 
	`˝u_to_À16
(
	`BIT
(5))

	)

1855 
	#IWLAGN_BT_VALID_REDUCED_TX_PWR
 
	`˝u_to_À16
(
	`BIT
(6))

	)

1856 
	#IWLAGN_BT_VALID_3W_LUT
 
	`˝u_to_À16
(
	`BIT
(7))

	)

1858 
	#IWLAGN_BT_ALL_VALID_MSK
 (
IWLAGN_BT_VALID_ENABLE_FLAGS
 | \

1859 
IWLAGN_BT_VALID_BOOST
 | \

1860 
IWLAGN_BT_VALID_MAX_KILL
 | \

1861 
IWLAGN_BT_VALID_3W_TIMERS
 | \

1862 
IWLAGN_BT_VALID_KILL_ACK_MASK
 | \

1863 
IWLAGN_BT_VALID_KILL_CTS_MASK
 | \

1864 
IWLAGN_BT_VALID_REDUCED_TX_PWR
 | \

1865 
IWLAGN_BT_VALID_3W_LUT
)

	)

1867 
	#IWLAGN_BT_REDUCED_TX_PWR
 
	`BIT
(0)

	)

1869 
	#IWLAGN_BT_DECISION_LUT_SIZE
 12

	)

1871 
	siwl_basic_bt_cmd
 {

1872 
u8
 
	mÊags
;

1873 
u8
 
	mÀdtime
;

1874 
u8
 
	mmax_kûl
;

1875 
u8
 
	mbt3_timî_t7_vÆue
;

1876 
__À32
 
	mkûl_ack_mask
;

1877 
__À32
 
	mkûl_˘s_mask
;

1878 
u8
 
	mbt3_¥io_ßm∂e_time
;

1879 
u8
 
	mbt3_timî_t2_vÆue
;

1880 
__À16
 
	mbt4_ªa˘i⁄_time
;

1881 
__À32
 
	mbt3_lookup_èbÀ
[
IWLAGN_BT_DECISION_LUT_SIZE
];

1886 
u8
 
	mªdu˚_txpowî
;

1887 
u8
 
	mª£rved
;

1888 
__À16
 
	mvÆid
;

1891 
	siwl_bt_cmd_v1
 {

1892 
iwl_basic_bt_cmd
 
	mbasic
;

1893 
u8
 
	m¥io_boo°
;

1898 
u8
 
	mtx_¥io_boo°
;

1899 
__À16
 
	mrx_¥io_boo°
;

1902 
	siwl_bt_cmd_v2
 {

1903 
iwl_basic_bt_cmd
 
	mbasic
;

1904 
__À32
 
	m¥io_boo°
;

1909 
u8
 
	mª£rved
;

1910 
u8
 
	mtx_¥io_boo°
;

1911 
__À16
 
	mrx_¥io_boo°
;

1914 
	#IWLAGN_BT_SCO_ACTIVE
 
	`˝u_to_À32
(
	`BIT
(0))

	)

1916 
	siwœgn_bt_sco_cmd
 {

1917 
__À32
 
	mÊags
;

1929 
	#MEASUREMENT_FILTER_FLAG
 (
RXON_FILTER_PROMISC_MSK
 | \

1930 
RXON_FILTER_CTL2HOST_MSK
 | \

1931 
RXON_FILTER_ACCEPT_GRP_MSK
 | \

1932 
RXON_FILTER_DIS_DECRYPT_MSK
 | \

1933 
RXON_FILTER_DIS_GRP_DECRYPT_MSK
 | \

1934 
RXON_FILTER_ASSOC_MSK
 | \

1935 
RXON_FILTER_BCON_AWARE_MSK
)

	)

1937 
	siwl_mósuª_ch™√l
 {

1938 
__À32
 
	mduøti⁄
;

1940 
u8
 
	mch™√l
;

1941 
u8
 
	mty≥
;

1942 
__À16
 
	mª£rved
;

1943 } 
	g__∑cked
;

1948 
	siwl_•e˘rum_cmd
 {

1949 
__À16
 
	mÀn
;

1950 
u8
 
	mtokí
;

1951 
u8
 
	mid
;

1952 
u8
 
	m‹igö
;

1953 
u8
 
	m≥riodic
;

1954 
__À16
 
	m∑th_loss_timeout
;

1955 
__À32
 
	m°¨t_time
;

1956 
__À32
 
	mª£rved2
;

1957 
__À32
 
	mÊags
;

1958 
__À32
 
	mfûãr_Êags
;

1959 
__À16
 
	mch™√l_cou¡
;

1960 
__À16
 
	mª£rved3
;

1961 
iwl_mósuª_ch™√l
 
	mch™√ls
[10];

1962 } 
	g__∑cked
;

1967 
	siwl_•e˘rum_ª•
 {

1968 
u8
 
	mtokí
;

1969 
u8
 
	mid
;

1970 
__À16
 
	m°©us
;

1973 } 
	g__∑cked
;

1975 
	eiwl_mósuªmít_°©e
 {

1976 
	mIWL_MEASUREMENT_START
 = 0,

1977 
	mIWL_MEASUREMENT_STOP
 = 1,

1980 
	eiwl_mósuªmít_°©us
 {

1981 
	mIWL_MEASUREMENT_OK
 = 0,

1982 
	mIWL_MEASUREMENT_CONCURRENT
 = 1,

1983 
	mIWL_MEASUREMENT_CSA_CONFLICT
 = 2,

1984 
	mIWL_MEASUREMENT_TGH_CONFLICT
 = 3,

1986 
	mIWL_MEASUREMENT_STOPPED
 = 6,

1987 
	mIWL_MEASUREMENT_TIMEOUT
 = 7,

1988 
	mIWL_MEASUREMENT_PERIODIC_FAILED
 = 8,

1991 
	#NUM_ELEMENTS_IN_HISTOGRAM
 8

	)

1993 
	siwl_mósuªmít_hi°ogøm
 {

1994 
__À32
 
	mofdm
[
NUM_ELEMENTS_IN_HISTOGRAM
];

1995 
__À32
 
	mcck
[
NUM_ELEMENTS_IN_HISTOGRAM
];

1996 } 
	g__∑cked
;

1999 
	siwl_mósuªmít_cˇ_cou¡îs
 {

2000 
__À32
 
	mofdm
;

2001 
__À32
 
	mcck
;

2002 } 
	g__∑cked
;

2004 
	eiwl_mósuª_ty≥
 {

2005 
	mIWL_MEASURE_BASIC
 = (1 << 0),

2006 
	mIWL_MEASURE_CHANNEL_LOAD
 = (1 << 1),

2007 
	mIWL_MEASURE_HISTOGRAM_RPI
 = (1 << 2),

2008 
	mIWL_MEASURE_HISTOGRAM_NOISE
 = (1 << 3),

2009 
	mIWL_MEASURE_FRAME
 = (1 << 4),

2011 
	mIWL_MEASURE_IDLE
 = (1 << 7),

2017 
	siwl_•e˘rum_nŸifiˇti⁄
 {

2018 
u8
 
	mid
;

2019 
u8
 
	mtokí
;

2020 
u8
 
	mch™√l_ödex
;

2021 
u8
 
	m°©e
;

2022 
__À32
 
	m°¨t_time
;

2023 
u8
 
	mb™d
;

2024 
u8
 
	mch™√l
;

2025 
u8
 
	mty≥
;

2026 
u8
 
	mª£rved1
;

2029 
__À32
 
	mcˇ_ofdm
;

2030 
__À32
 
	mcˇ_cck
;

2031 
__À32
 
	mcˇ_time
;

2032 
u8
 
	mbasic_ty≥
;

2034 
u8
 
	mª£rved2
[3];

2035 
iwl_mósuªmít_hi°ogøm
 
	mhi°ogøm
;

2036 
__À32
 
	m°›_time
;

2037 
__À32
 
	m°©us
;

2038 } 
	g__∑cked
;

2081 
	#IWL_POWER_VEC_SIZE
 5

	)

2083 
	#IWL_POWER_DRIVER_ALLOW_SLEEP_MSK
 
	`˝u_to_À16
(
	`BIT
(0))

	)

2084 
	#IWL_POWER_POWER_SAVE_ENA_MSK
 
	`˝u_to_À16
(
	`BIT
(0))

	)

2085 
	#IWL_POWER_POWER_MANAGEMENT_ENA_MSK
 
	`˝u_to_À16
(
	`BIT
(1))

	)

2086 
	#IWL_POWER_SLEEP_OVER_DTIM_MSK
 
	`˝u_to_À16
(
	`BIT
(2))

	)

2087 
	#IWL_POWER_PCI_PM_MSK
 
	`˝u_to_À16
(
	`BIT
(3))

	)

2088 
	#IWL_POWER_FAST_PD
 
	`˝u_to_À16
(
	`BIT
(4))

	)

2089 
	#IWL_POWER_BEACON_FILTERING
 
	`˝u_to_À16
(
	`BIT
(5))

	)

2090 
	#IWL_POWER_SHADOW_REG_ENA
 
	`˝u_to_À16
(
	`BIT
(6))

	)

2091 
	#IWL_POWER_CT_KILL_SET
 
	`˝u_to_À16
(
	`BIT
(7))

	)

2092 
	#IWL_POWER_BT_SCO_ENA
 
	`˝u_to_À16
(
	`BIT
(8))

	)

2093 
	#IWL_POWER_ADVANCE_PM_ENA_MSK
 
	`˝u_to_À16
(
	`BIT
(9))

	)

2095 
	siwl_powîèbÀ_cmd
 {

2096 
__À16
 
	mÊags
;

2097 
u8
 
	mkìp_Æive_£c⁄ds
;

2098 
u8
 
	mdebug_Êags
;

2099 
__À32
 
	mrx_d©a_timeout
;

2100 
__À32
 
	mtx_d©a_timeout
;

2101 
__À32
 
	m¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
];

2102 
__À32
 
	mkìp_Æive_bóc⁄s
;

2103 } 
	g__∑cked
;

2109 
	siwl_¶ìp_nŸifiˇti⁄
 {

2110 
u8
 
	mpm_¶ìp_mode
;

2111 
u8
 
	mpm_wakeup_§c
;

2112 
__À16
 
	mª£rved
;

2113 
__À32
 
	m¶ìp_time
;

2114 
__À32
 
	mtsf_low
;

2115 
__À32
 
	mbc⁄_timî
;

2116 } 
	g__∑cked
;

2120 
	mIWL_PM_NO_SLEEP
 = 0,

2121 
	mIWL_PM_SLP_MAC
 = 1,

2122 
	mIWL_PM_SLP_FULL_MAC_UNASSOCIATE
 = 2,

2123 
	mIWL_PM_SLP_FULL_MAC_CARD_STATE
 = 3,

2124 
	mIWL_PM_SLP_PHY
 = 4,

2125 
	mIWL_PM_SLP_REPENT
 = 5,

2126 
	mIWL_PM_WAKEUP_BY_TIMER
 = 6,

2127 
	mIWL_PM_WAKEUP_BY_DRIVER
 = 7,

2128 
	mIWL_PM_WAKEUP_BY_RFKILL
 = 8,

2130 
	mIWL_PM_NUM_OF_MODES
 = 12,

2136 
	#CARD_STATE_CMD_DISABLE
 0x00

	)

2137 
	#CARD_STATE_CMD_ENABLE
 0x01

	)

2138 
	#CARD_STATE_CMD_HALT
 0x02

	)

2139 
	siwl_ˇrd_°©e_cmd
 {

2140 
__À32
 
	m°©us
;

2141 } 
	g__∑cked
;

2146 
	siwl_ˇrd_°©e_nŸif
 {

2147 
__À32
 
	mÊags
;

2148 } 
	g__∑cked
;

2150 
	#HW_CARD_DISABLED
 0x01

	)

2151 
	#SW_CARD_DISABLED
 0x02

	)

2152 
	#CT_CARD_DISABLED
 0x04

	)

2153 
	#RXON_CARD_DISABLED
 0x10

	)

2155 
	siwl_˘_kûl_c⁄fig
 {

2156 
__À32
 
	mª£rved
;

2157 
__À32
 
	m¸ôiˇl_ãm≥øtuª_M
;

2158 
__À32
 
	m¸ôiˇl_ãm≥øtuª_R
;

2159 } 
	g__∑cked
;

2162 
	siwl_˘_kûl_thrŸéög_c⁄fig
 {

2163 
__À32
 
	m¸ôiˇl_ãm≥øtuª_exô
;

2164 
__À32
 
	mª£rved
;

2165 
__À32
 
	m¸ôiˇl_ãm≥øtuª_íãr
;

2166 } 
	g__∑cked
;

2174 
	#SCAN_CHANNEL_TYPE_PASSIVE
 
	`˝u_to_À32
(0)

	)

2175 
	#SCAN_CHANNEL_TYPE_ACTIVE
 
	`˝u_to_À32
(1)

	)

2197 
	siwl_sˇn_ch™√l
 {

2205 
__À32
 
	mty≥
;

2206 
__À16
 
	mch™√l
;

2207 
u8
 
	mtx_gaö
;

2208 
u8
 
	md•_©ãn
;

2209 
__À16
 
	ma˘ive_dwñl
;

2210 
__À16
 
	m∑ssive_dwñl
;

2211 } 
	g__∑cked
;

2214 
	#IWL_SCAN_PROBE_MASK
(
n
Ë
	`˝u_to_À32
((
	`BIT
“Ë| (BIT“Ë- BIT(1))))

	)

2224 
	siwl_ssid_õ
 {

2225 
u8
 
	mid
;

2226 
u8
 
	mÀn
;

2227 
u8
 
	mssid
[32];

2228 } 
	g__∑cked
;

2230 
	#PROBE_OPTION_MAX
 20

	)

2231 
	#TX_CMD_LIFE_TIME_INFINITE
 
	`˝u_to_À32
(0xFFFFFFFF)

	)

2232 
	#IWL_GOOD_CRC_TH_DISABLED
 0

	)

2233 
	#IWL_GOOD_CRC_TH_DEFAULT
 
	`˝u_to_À16
(1)

	)

2234 
	#IWL_GOOD_CRC_TH_NEVER
 
	`˝u_to_À16
(0xffff)

	)

2235 
	#IWL_MAX_CMD_SIZE
 4096

	)

2290 
	eiwl_sˇn_Êags
 {

2292 
	mIWL_SCAN_FLAGS_ACTION_FRAME_TX
 = 
BIT
(1),

2296 
	siwl_sˇn_cmd
 {

2297 
__À16
 
	mÀn
;

2298 
u8
 
	msˇn_Êags
;

2299 
u8
 
	mch™√l_cou¡
;

2300 
__À16
 
	mquõt_time
;

2302 
__À16
 
	mquõt_∂˝_th
;

2303 
__À16
 
	mgood_CRC_th
;

2304 
__À16
 
	mrx_chaö
;

2305 
__À32
 
	mmax_out_time
;

2307 
__À32
 
	msu•íd_time
;

2310 
__À32
 
	mÊags
;

2311 
__À32
 
	mfûãr_Êags
;

2315 
iwl_tx_cmd
 
	mtx_cmd
;

2318 
iwl_ssid_õ
 
	mdúe˘_sˇn
[
PROBE_OPTION_MAX
];

2335 
u8
 
	md©a
[];

2336 } 
	g__∑cked
;

2339 
	#CAN_ABORT_STATUS
 
	`˝u_to_À32
(0x1)

	)

2341 
	#ABORT_STATUS
 0x2

	)

2346 
	siwl_sˇƒeq_nŸifiˇti⁄
 {

2347 
__À32
 
	m°©us
;

2348 } 
	g__∑cked
;

2353 
	siwl_sˇn°¨t_nŸifiˇti⁄
 {

2354 
__À32
 
	mtsf_low
;

2355 
__À32
 
	mtsf_high
;

2356 
__À32
 
	mbóc⁄_timî
;

2357 
u8
 
	mch™√l
;

2358 
u8
 
	mb™d
;

2359 
u8
 
	mª£rved
[2];

2360 
__À32
 
	m°©us
;

2361 } 
	g__∑cked
;

2363 
	#SCAN_OWNER_STATUS
 0x1

	)

2364 
	#MEASURE_OWNER_STATUS
 0x2

	)

2366 
	#IWL_PROBE_STATUS_OK
 0

	)

2367 
	#IWL_PROBE_STATUS_TX_FAILED
 
	`BIT
(0)

	)

2369 
	#IWL_PROBE_STATUS_FAIL_TTL
 
	`BIT
(1)

	)

2370 
	#IWL_PROBE_STATUS_FAIL_BT
 
	`BIT
(2)

	)

2372 
	#NUMBER_OF_STATISTICS
 1

	)

2376 
	siwl_sˇƒesu…s_nŸifiˇti⁄
 {

2377 
u8
 
	mch™√l
;

2378 
u8
 
	mb™d
;

2379 
u8
 
	m¥obe_°©us
;

2380 
u8
 
	mnum_¥obe_nŸ_£¡
;

2381 
__À32
 
	mtsf_low
;

2382 
__À32
 
	mtsf_high
;

2383 
__À32
 
	m°©i°ics
[
NUMBER_OF_STATISTICS
];

2384 } 
	g__∑cked
;

2389 
	siwl_sˇncom∂ëe_nŸifiˇti⁄
 {

2390 
u8
 
	msˇ¬ed_ch™√ls
;

2391 
u8
 
	m°©us
;

2392 
u8
 
	mbt_°©us
;

2393 
u8
 
	mœ°_ch™√l
;

2394 
__À32
 
	mtsf_low
;

2395 
__À32
 
	mtsf_high
;

2396 } 
	g__∑cked
;

2405 
	eiwl_ibss_m™agî
 {

2406 
	mIWL_NOT_IBSS_MANAGER
 = 0,

2407 
	mIWL_IBSS_MANAGER
 = 1,

2414 
	siwœgn_bóc⁄_nŸif
 {

2415 
iwœgn_tx_ª•
 
	mbóc⁄_nŸify_hdr
;

2416 
__À32
 
	mlow_tsf
;

2417 
__À32
 
	mhigh_tsf
;

2418 
__À32
 
	mibss_mgr_°©us
;

2419 } 
	g__∑cked
;

2425 
	siwl_tx_bóc⁄_cmd
 {

2426 
iwl_tx_cmd
 
	mtx
;

2427 
__À16
 
	mtim_idx
;

2428 
u8
 
	mtim_size
;

2429 
u8
 
	mª£rved1
;

2430 
õì80211_hdr
 
	m‰ame
[];

2431 } 
	g__∑cked
;

2439 
	#IWL_TEMP_CONVERT
 260

	)

2441 
	#SUP_RATE_11A_MAX_NUM_CHANNELS
 8

	)

2442 
	#SUP_RATE_11B_MAX_NUM_CHANNELS
 4

	)

2443 
	#SUP_RATE_11G_MAX_NUM_CHANNELS
 12

	)

2446 
	søã_hi°ogøm
 {

2448 
__À32
 
	ma
[
SUP_RATE_11A_MAX_NUM_CHANNELS
];

2449 
__À32
 
	mb
[
SUP_RATE_11B_MAX_NUM_CHANNELS
];

2450 
__À32
 
	mg
[
SUP_RATE_11G_MAX_NUM_CHANNELS
];

2451 } 
	msuc˚ss
;

2453 
__À32
 
	ma
[
SUP_RATE_11A_MAX_NUM_CHANNELS
];

2454 
__À32
 
	mb
[
SUP_RATE_11B_MAX_NUM_CHANNELS
];

2455 
__À32
 
	mg
[
SUP_RATE_11G_MAX_NUM_CHANNELS
];

2456 } 
	mÁûed
;

2457 } 
	g__∑cked
;

2461 
	s°©i°ics_dbg
 {

2462 
__À32
 
	mbur°_check
;

2463 
__À32
 
	mbur°_cou¡
;

2464 
__À32
 
	mwaô_f‹_sûí˚_timeout_˙t
;

2465 
__À32
 
	mª£rved
[3];

2466 } 
	g__∑cked
;

2468 
	s°©i°ics_rx_phy
 {

2469 
__À32
 
	möa_˙t
;

2470 
__À32
 
	mföa_˙t
;

2471 
__À32
 
	m∂˝_îr
;

2472 
__À32
 
	m¸c32_îr
;

2473 
__À32
 
	movîrun_îr
;

2474 
__À32
 
	móæy_ovîrun_îr
;

2475 
__À32
 
	m¸c32_good
;

2476 
__À32
 
	mÁl£_Æ¨m_˙t
;

2477 
__À32
 
	mföa_sync_îr_˙t
;

2478 
__À32
 
	msfd_timeout
;

2479 
__À32
 
	mföa_timeout
;

2480 
__À32
 
	muƒe•⁄ded_πs
;

2481 
__À32
 
	mrxe_‰ame_limô_ovîrun
;

2482 
__À32
 
	m£¡_ack_˙t
;

2483 
__À32
 
	m£¡_˘s_˙t
;

2484 
__À32
 
	m£¡_ba_r•_˙t
;

2485 
__À32
 
	md•_£lf_kûl
;

2486 
__À32
 
	mmh_f‹m©_îr
;

2487 
__À32
 
	mª_acq_maö_rssi_sum
;

2488 
__À32
 
	mª£rved3
;

2489 } 
	g__∑cked
;

2491 
	s°©i°ics_rx_ht_phy
 {

2492 
__À32
 
	m∂˝_îr
;

2493 
__À32
 
	movîrun_îr
;

2494 
__À32
 
	móæy_ovîrun_îr
;

2495 
__À32
 
	m¸c32_good
;

2496 
__À32
 
	m¸c32_îr
;

2497 
__À32
 
	mmh_f‹m©_îr
;

2498 
__À32
 
	magg_¸c32_good
;

2499 
__À32
 
	magg_mpdu_˙t
;

2500 
__À32
 
	magg_˙t
;

2501 
__À32
 
	munsuµ‹t_mcs
;

2502 } 
	g__∑cked
;

2504 
	#INTERFERENCE_DATA_AVAILABLE
 
	`˝u_to_À32
(1)

	)

2506 
	s°©i°ics_rx_n⁄_phy
 {

2507 
__À32
 
	mbogus_˘s
;

2508 
__À32
 
	mbogus_ack
;

2509 
__À32
 
	mn⁄_bssid_‰ames
;

2511 
__À32
 
	mfûãªd_‰ames
;

2513 
__À32
 
	mn⁄_ch™√l_bóc⁄s
;

2515 
__À32
 
	mch™√l_bóc⁄s
;

2517 
__À32
 
	mnum_mis£d_bc⁄
;

2518 
__À32
 
	madc_rx_ßtuøti⁄_time
;

2520 
__À32
 
	möa_dëe˘i⁄_£¨ch_time
;

2522 
__À32
 
	mbóc⁄_sûí˚_rssi_a
;

2523 
__À32
 
	mbóc⁄_sûí˚_rssi_b
;

2524 
__À32
 
	mbóc⁄_sûí˚_rssi_c
;

2525 
__À32
 
	möãr„ªn˚_d©a_Êag
;

2528 
__À32
 
	mch™√l_lﬂd
;

2529 
__À32
 
	md•_Ál£_Æ¨ms
;

2531 
__À32
 
	mbóc⁄_rssi_a
;

2532 
__À32
 
	mbóc⁄_rssi_b
;

2533 
__À32
 
	mbóc⁄_rssi_c
;

2534 
__À32
 
	mbóc⁄_íîgy_a
;

2535 
__À32
 
	mbóc⁄_íîgy_b
;

2536 
__À32
 
	mbóc⁄_íîgy_c
;

2537 } 
	g__∑cked
;

2539 
	s°©i°ics_rx_n⁄_phy_bt
 {

2540 
°©i°ics_rx_n⁄_phy
 
	mcomm⁄
;

2542 
__À32
 
	mnum_bt_kûls
;

2543 
__À32
 
	mª£rved
[2];

2544 } 
	g__∑cked
;

2546 
	s°©i°ics_rx
 {

2547 
°©i°ics_rx_phy
 
	mofdm
;

2548 
°©i°ics_rx_phy
 
	mcck
;

2549 
°©i°ics_rx_n⁄_phy
 
	mgíîÆ
;

2550 
°©i°ics_rx_ht_phy
 
	mofdm_ht
;

2551 } 
	g__∑cked
;

2553 
	s°©i°ics_rx_bt
 {

2554 
°©i°ics_rx_phy
 
	mofdm
;

2555 
°©i°ics_rx_phy
 
	mcck
;

2556 
°©i°ics_rx_n⁄_phy_bt
 
	mgíîÆ
;

2557 
°©i°ics_rx_ht_phy
 
	mofdm_ht
;

2558 } 
	g__∑cked
;

2568 
	s°©i°ics_tx_powî
 {

2569 
u8
 
	m™t_a
;

2570 
u8
 
	m™t_b
;

2571 
u8
 
	m™t_c
;

2572 
u8
 
	mª£rved
;

2573 } 
	g__∑cked
;

2575 
	s°©i°ics_tx_n⁄_phy_agg
 {

2576 
__À32
 
	mba_timeout
;

2577 
__À32
 
	mba_ªscheduÀ_‰ames
;

2578 
__À32
 
	mscd_quîy_agg_‰ame_˙t
;

2579 
__À32
 
	mscd_quîy_no_agg
;

2580 
__À32
 
	mscd_quîy_agg
;

2581 
__À32
 
	mscd_quîy_mism©ch
;

2582 
__À32
 
	m‰ame_nŸ_ªady
;

2583 
__À32
 
	mundîrun
;

2584 
__À32
 
	mbt_¥io_kûl
;

2585 
__À32
 
	mrx_ba_r•_˙t
;

2586 } 
	g__∑cked
;

2588 
	s°©i°ics_tx
 {

2589 
__À32
 
	m¥ómbÀ_˙t
;

2590 
__À32
 
	mrx_dëe˘ed_˙t
;

2591 
__À32
 
	mbt_¥io_de„r_˙t
;

2592 
__À32
 
	mbt_¥io_kûl_˙t
;

2593 
__À32
 
	m„w_byãs_˙t
;

2594 
__À32
 
	m˘s_timeout
;

2595 
__À32
 
	mack_timeout
;

2596 
__À32
 
	mex≥˘ed_ack_˙t
;

2597 
__À32
 
	ma˘uÆ_ack_˙t
;

2598 
__À32
 
	mdump_msdu_˙t
;

2599 
__À32
 
	mbur°_ab‹t_√xt_‰ame_mism©ch_˙t
;

2600 
__À32
 
	mbur°_ab‹t_missög_√xt_‰ame_˙t
;

2601 
__À32
 
	m˘s_timeout_cﬁlisi⁄
;

2602 
__À32
 
	mack_‹_ba_timeout_cﬁlisi⁄
;

2603 
°©i°ics_tx_n⁄_phy_agg
 
	magg
;

2609 
°©i°ics_tx_powî
 
	mtx_powî
;

2610 
__À32
 
	mª£rved1
;

2611 } 
	g__∑cked
;

2614 
	s°©i°ics_div
 {

2615 
__À32
 
	mtx_⁄_a
;

2616 
__À32
 
	mtx_⁄_b
;

2617 
__À32
 
	mexec_time
;

2618 
__À32
 
	m¥obe_time
;

2619 
__À32
 
	mª£rved1
;

2620 
__À32
 
	mª£rved2
;

2621 } 
	g__∑cked
;

2623 
	s°©i°ics_gíîÆ_comm⁄
 {

2624 
__À32
 
	mãm≥øtuª
;

2625 
__À32
 
	mãm≥øtuª_m
;

2626 
°©i°ics_dbg
 
	mdbg
;

2627 
__À32
 
	m¶ìp_time
;

2628 
__À32
 
	m¶Ÿs_out
;

2629 
__À32
 
	m¶Ÿs_idÀ
;

2630 
__À32
 
	mâl_time°amp
;

2631 
°©i°ics_div
 
	mdiv
;

2632 
__À32
 
	mrx_íabÀ_cou¡î
;

2638 
__À32
 
	mnum_of_sos_°©es
;

2639 } 
	g__∑cked
;

2641 
	s°©i°ics_bt_a˘ivôy
 {

2643 
__À32
 
	mhi_¥i‹ôy_tx_ªq_˙t
;

2644 
__À32
 
	mhi_¥i‹ôy_tx_díõd_˙t
;

2645 
__À32
 
	mlo_¥i‹ôy_tx_ªq_˙t
;

2646 
__À32
 
	mlo_¥i‹ôy_tx_díõd_˙t
;

2648 
__À32
 
	mhi_¥i‹ôy_rx_ªq_˙t
;

2649 
__À32
 
	mhi_¥i‹ôy_rx_díõd_˙t
;

2650 
__À32
 
	mlo_¥i‹ôy_rx_ªq_˙t
;

2651 
__À32
 
	mlo_¥i‹ôy_rx_díõd_˙t
;

2652 } 
	g__∑cked
;

2654 
	s°©i°ics_gíîÆ
 {

2655 
°©i°ics_gíîÆ_comm⁄
 
	mcomm⁄
;

2656 
__À32
 
	mª£rved2
;

2657 
__À32
 
	mª£rved3
;

2658 } 
	g__∑cked
;

2660 
	s°©i°ics_gíîÆ_bt
 {

2661 
°©i°ics_gíîÆ_comm⁄
 
	mcomm⁄
;

2662 
°©i°ics_bt_a˘ivôy
 
	ma˘ivôy
;

2663 
__À32
 
	mª£rved2
;

2664 
__À32
 
	mª£rved3
;

2665 } 
	g__∑cked
;

2667 
	#UCODE_STATISTICS_CLEAR_MSK
 (0x1 << 0)

	)

2668 
	#UCODE_STATISTICS_FREQUENCY_MSK
 (0x1 << 1)

	)

2669 
	#UCODE_STATISTICS_NARROW_BAND_MSK
 (0x1 << 2)

	)

2686 
	#IWL_STATS_CONF_CLEAR_STATS
 
	`˝u_to_À32
(0x1Ë

	)

2687 
	#IWL_STATS_CONF_DISABLE_NOTIF
 
	`˝u_to_À32
(0x2)

	)

2688 
	siwl_°©i°ics_cmd
 {

2689 
__À32
 
	mc⁄figuøti⁄_Êags
;

2690 } 
	g__∑cked
;

2707 
	#STATISTICS_REPLY_FLG_BAND_24G_MSK
 
	`˝u_to_À32
(0x2)

	)

2708 
	#STATISTICS_REPLY_FLG_HT40_MODE_MSK
 
	`˝u_to_À32
(0x8)

	)

2710 
	siwl_nŸif_°©i°ics
 {

2711 
__À32
 
	mÊag
;

2712 
°©i°ics_rx
 
	mrx
;

2713 
°©i°ics_tx
 
	mtx
;

2714 
°©i°ics_gíîÆ
 
	mgíîÆ
;

2715 } 
	g__∑cked
;

2717 
	siwl_bt_nŸif_°©i°ics
 {

2718 
__À32
 
	mÊag
;

2719 
°©i°ics_rx_bt
 
	mrx
;

2720 
°©i°ics_tx
 
	mtx
;

2721 
°©i°ics_gíîÆ_bt
 
	mgíîÆ
;

2722 } 
	g__∑cked
;

2744 
	#IWL_MISSED_BEACON_THRESHOLD_MIN
 (1)

	)

2745 
	#IWL_MISSED_BEACON_THRESHOLD_DEF
 (5)

	)

2746 
	#IWL_MISSED_BEACON_THRESHOLD_MAX
 
IWL_MISSED_BEACON_THRESHOLD_DEF


	)

2748 
	siwl_mis£d_bóc⁄_nŸif
 {

2749 
__À32
 
	mc⁄£cutive_mis£d_bóc⁄s
;

2750 
__À32
 
	mtŸÆ_mis£d_bec⁄s
;

2751 
__À32
 
	mnum_ex≥˘ed_bóc⁄s
;

2752 
__À32
 
	mnum_ªcvd_bóc⁄s
;

2753 } 
	g__∑cked
;

2928 
	#HD_TABLE_SIZE
 (11Ë

	)

2929 
	#HD_MIN_ENERGY_CCK_DET_INDEX
 (0Ë

	)

2930 
	#HD_MIN_ENERGY_OFDM_DET_INDEX
 (1)

	)

2931 
	#HD_AUTO_CORR32_X1_TH_ADD_MIN_INDEX
 (2)

	)

2932 
	#HD_AUTO_CORR32_X1_TH_ADD_MIN_MRC_INDEX
 (3)

	)

2933 
	#HD_AUTO_CORR40_X4_TH_ADD_MIN_MRC_INDEX
 (4)

	)

2934 
	#HD_AUTO_CORR32_X4_TH_ADD_MIN_INDEX
 (5)

	)

2935 
	#HD_AUTO_CORR32_X4_TH_ADD_MIN_MRC_INDEX
 (6)

	)

2936 
	#HD_BARKER_CORR_TH_ADD_MIN_INDEX
 (7)

	)

2937 
	#HD_BARKER_CORR_TH_ADD_MIN_MRC_INDEX
 (8)

	)

2938 
	#HD_AUTO_CORR40_X4_TH_ADD_MIN_INDEX
 (9)

	)

2939 
	#HD_OFDM_ENERGY_TH_IN_INDEX
 (10)

	)

2944 
	#HD_INA_NON_SQUARE_DET_OFDM_INDEX
 (11)

	)

2945 
	#HD_INA_NON_SQUARE_DET_CCK_INDEX
 (12)

	)

2946 
	#HD_CORR_11_INSTEAD_OF_CORR_9_EN_INDEX
 (13)

	)

2947 
	#HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_INDEX
 (14)

	)

2948 
	#HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_INDEX
 (15)

	)

2949 
	#HD_OFDM_NON_SQUARE_DET_SLOPE_INDEX
 (16)

	)

2950 
	#HD_OFDM_NON_SQUARE_DET_INTERCEPT_INDEX
 (17)

	)

2951 
	#HD_CCK_NON_SQUARE_DET_SLOPE_MRC_INDEX
 (18)

	)

2952 
	#HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_INDEX
 (19)

	)

2953 
	#HD_CCK_NON_SQUARE_DET_SLOPE_INDEX
 (20)

	)

2954 
	#HD_CCK_NON_SQUARE_DET_INTERCEPT_INDEX
 (21)

	)

2955 
	#HD_RESERVED
 (22)

	)

2958 
	#ENHANCE_HD_TABLE_SIZE
 (23)

	)

2961 
	#ENHANCE_HD_TABLE_ENTRIES
 (
ENHANCE_HD_TABLE_SIZE
 - 
HD_TABLE_SIZE
)

	)

2963 
	#HD_INA_NON_SQUARE_DET_OFDM_DATA_V1
 
	`˝u_to_À16
(0)

	)

2964 
	#HD_INA_NON_SQUARE_DET_CCK_DATA_V1
 
	`˝u_to_À16
(0)

	)

2965 
	#HD_CORR_11_INSTEAD_OF_CORR_9_EN_DATA_V1
 
	`˝u_to_À16
(0)

	)

2966 
	#HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_DATA_V1
 
	`˝u_to_À16
(668)

	)

2967 
	#HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V1
 
	`˝u_to_À16
(4)

	)

2968 
	#HD_OFDM_NON_SQUARE_DET_SLOPE_DATA_V1
 
	`˝u_to_À16
(486)

	)

2969 
	#HD_OFDM_NON_SQUARE_DET_INTERCEPT_DATA_V1
 
	`˝u_to_À16
(37)

	)

2970 
	#HD_CCK_NON_SQUARE_DET_SLOPE_MRC_DATA_V1
 
	`˝u_to_À16
(853)

	)

2971 
	#HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V1
 
	`˝u_to_À16
(4)

	)

2972 
	#HD_CCK_NON_SQUARE_DET_SLOPE_DATA_V1
 
	`˝u_to_À16
(476)

	)

2973 
	#HD_CCK_NON_SQUARE_DET_INTERCEPT_DATA_V1
 
	`˝u_to_À16
(99)

	)

2975 
	#HD_INA_NON_SQUARE_DET_OFDM_DATA_V2
 
	`˝u_to_À16
(1)

	)

2976 
	#HD_INA_NON_SQUARE_DET_CCK_DATA_V2
 
	`˝u_to_À16
(1)

	)

2977 
	#HD_CORR_11_INSTEAD_OF_CORR_9_EN_DATA_V2
 
	`˝u_to_À16
(1)

	)

2978 
	#HD_OFDM_NON_SQUARE_DET_SLOPE_MRC_DATA_V2
 
	`˝u_to_À16
(600)

	)

2979 
	#HD_OFDM_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V2
 
	`˝u_to_À16
(40)

	)

2980 
	#HD_OFDM_NON_SQUARE_DET_SLOPE_DATA_V2
 
	`˝u_to_À16
(486)

	)

2981 
	#HD_OFDM_NON_SQUARE_DET_INTERCEPT_DATA_V2
 
	`˝u_to_À16
(45)

	)

2982 
	#HD_CCK_NON_SQUARE_DET_SLOPE_MRC_DATA_V2
 
	`˝u_to_À16
(853)

	)

2983 
	#HD_CCK_NON_SQUARE_DET_INTERCEPT_MRC_DATA_V2
 
	`˝u_to_À16
(60)

	)

2984 
	#HD_CCK_NON_SQUARE_DET_SLOPE_DATA_V2
 
	`˝u_to_À16
(476)

	)

2985 
	#HD_CCK_NON_SQUARE_DET_INTERCEPT_DATA_V2
 
	`˝u_to_À16
(99)

	)

2989 
	#SENSITIVITY_CMD_CONTROL_DEFAULT_TABLE
 
	`˝u_to_À16
(0)

	)

2990 
	#SENSITIVITY_CMD_CONTROL_WORK_TABLE
 
	`˝u_to_À16
(1)

	)

2999 
	siwl_£nsôivôy_cmd
 {

3000 
__À16
 
	mc⁄åﬁ
;

3001 
__À16
 
	mèbÀ
[
HD_TABLE_SIZE
];

3002 } 
	g__∑cked
;

3007 
	siwl_íh™˚_£nsôivôy_cmd
 {

3008 
__À16
 
	mc⁄åﬁ
;

3009 
__À16
 
	míh™˚_èbÀ
[
ENHANCE_HD_TABLE_SIZE
];

3010 } 
	g__∑cked
;

3070 
	mIWL_PHY_CALIBRATE_DC_CMD
 = 8,

3071 
	mIWL_PHY_CALIBRATE_LO_CMD
 = 9,

3072 
	mIWL_PHY_CALIBRATE_TX_IQ_CMD
 = 11,

3073 
	mIWL_PHY_CALIBRATE_CRYSTAL_FRQ_CMD
 = 15,

3074 
	mIWL_PHY_CALIBRATE_BASE_BAND_CMD
 = 16,

3075 
	mIWL_PHY_CALIBRATE_TX_IQ_PERD_CMD
 = 17,

3076 
	mIWL_PHY_CALIBRATE_TEMP_OFFSET_CMD
 = 18,

3082 
	eiwl_ucode_ˇlib_cfg
 {

3083 
	mIWL_CALIB_CFG_RX_BB_IDX
 = 
BIT
(0),

3084 
	mIWL_CALIB_CFG_DC_IDX
 = 
BIT
(1),

3085 
	mIWL_CALIB_CFG_LO_IDX
 = 
BIT
(2),

3086 
	mIWL_CALIB_CFG_TX_IQ_IDX
 = 
BIT
(3),

3087 
	mIWL_CALIB_CFG_RX_IQ_IDX
 = 
BIT
(4),

3088 
	mIWL_CALIB_CFG_NOISE_IDX
 = 
BIT
(5),

3089 
	mIWL_CALIB_CFG_CRYSTAL_IDX
 = 
BIT
(6),

3090 
	mIWL_CALIB_CFG_TEMPERATURE_IDX
 = 
BIT
(7),

3091 
	mIWL_CALIB_CFG_PAPD_IDX
 = 
BIT
(8),

3092 
	mIWL_CALIB_CFG_SENSITIVITY_IDX
 = 
BIT
(9),

3093 
	mIWL_CALIB_CFG_TX_PWR_IDX
 = 
BIT
(10),

3096 
	#IWL_CALIB_INIT_CFG_ALL
 
	`˝u_to_À32
(
IWL_CALIB_CFG_RX_BB_IDX
 | \

3097 
IWL_CALIB_CFG_DC_IDX
 | \

3098 
IWL_CALIB_CFG_LO_IDX
 | \

3099 
IWL_CALIB_CFG_TX_IQ_IDX
 | \

3100 
IWL_CALIB_CFG_RX_IQ_IDX
 | \

3101 
IWL_CALIB_CFG_CRYSTAL_IDX
)

	)

3103 
	#IWL_CALIB_RT_CFG_ALL
 
	`˝u_to_À32
(
IWL_CALIB_CFG_RX_BB_IDX
 | \

3104 
IWL_CALIB_CFG_DC_IDX
 | \

3105 
IWL_CALIB_CFG_LO_IDX
 | \

3106 
IWL_CALIB_CFG_TX_IQ_IDX
 | \

3107 
IWL_CALIB_CFG_RX_IQ_IDX
 | \

3108 
IWL_CALIB_CFG_TEMPERATURE_IDX
 | \

3109 
IWL_CALIB_CFG_PAPD_IDX
 | \

3110 
IWL_CALIB_CFG_TX_PWR_IDX
 | \

3111 
IWL_CALIB_CFG_CRYSTAL_IDX
)

	)

3113 
	#IWL_CALIB_CFG_FLAG_SEND_COMPLETE_NTFY_MSK
 
	`˝u_to_À32
(
	`BIT
(0))

	)

3115 
	siwl_ˇlib_cfg_ñm¡_s
 {

3116 
__À32
 
	mis_íabÀ
;

3117 
__À32
 
	m°¨t
;

3118 
__À32
 
	m£nd_ªs
;

3119 
__À32
 
	m≠∂y_ªs
;

3120 
__À32
 
	mª£rved
;

3121 } 
	g__∑cked
;

3123 
	siwl_ˇlib_cfg_°©us_s
 {

3124 
iwl_ˇlib_cfg_ñm¡_s
 
	m⁄˚
;

3125 
iwl_ˇlib_cfg_ñm¡_s
 
	m≥rd
;

3126 
__À32
 
	mÊags
;

3127 } 
	g__∑cked
;

3129 
	siwl_ˇlib_cfg_cmd
 {

3130 
iwl_ˇlib_cfg_°©us_s
 
	mucd_ˇlib_cfg
;

3131 
iwl_ˇlib_cfg_°©us_s
 
	mdrv_ˇlib_cfg
;

3132 
__À32
 
	mª£rved1
;

3133 } 
	g__∑cked
;

3135 
	siwl_ˇlib_hdr
 {

3136 
u8
 
	m›_code
;

3137 
u8
 
	mfú°_group
;

3138 
u8
 
	mgroups_num
;

3139 
u8
 
	md©a_vÆid
;

3140 } 
	g__∑cked
;

3142 
	siwl_ˇlib_cmd
 {

3143 
iwl_ˇlib_hdr
 
	mhdr
;

3144 
u8
 
	md©a
[];

3145 } 
	g__∑cked
;

3147 
	siwl_ˇlib_xèl_‰eq_cmd
 {

3148 
iwl_ˇlib_hdr
 
	mhdr
;

3149 
u8
 
	mˇp_pö1
;

3150 
u8
 
	mˇp_pö2
;

3151 
u8
 
	m∑d
[2];

3152 } 
	g__∑cked
;

3154 
	#DEFAULT_RADIO_SENSOR_OFFSET
 
	`˝u_to_À16
(2700)

	)

3155 
	siwl_ˇlib_ãm≥øtuª_off£t_cmd
 {

3156 
iwl_ˇlib_hdr
 
	mhdr
;

3157 
__À16
 
	mødio_£ns‹_off£t
;

3158 
__À16
 
	mª£rved
;

3159 } 
	g__∑cked
;

3161 
	siwl_ˇlib_ãm≥øtuª_off£t_v2_cmd
 {

3162 
iwl_ˇlib_hdr
 
	mhdr
;

3163 
__À16
 
	mødio_£ns‹_off£t_high
;

3164 
__À16
 
	mødio_£ns‹_off£t_low
;

3165 
__À16
 
	mbu∫tVﬁègeRef
;

3166 
__À16
 
	mª£rved
;

3167 } 
	g__∑cked
;

3170 
	siwl_ˇlib_chaö_noi£_ª£t_cmd
 {

3171 
iwl_ˇlib_hdr
 
	mhdr
;

3172 
u8
 
	md©a
[];

3176 
	siwl_ˇlib_chaö_noi£_gaö_cmd
 {

3177 
iwl_ˇlib_hdr
 
	mhdr
;

3178 
u8
 
	mdñè_gaö_1
;

3179 
u8
 
	mdñè_gaö_2
;

3180 
u8
 
	m∑d
[2];

3181 } 
	g__∑cked
;

3196 
	siwl_Àd_cmd
 {

3197 
__À32
 
	möãrvÆ
;

3198 
u8
 
	mid
;

3199 
u8
 
	moff
;

3201 
u8
 
	m⁄
;

3203 
u8
 
	mª£rved
;

3204 } 
	g__∑cked
;

3217 
	#COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 (0x1)

	)

3218 
	#COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
 (0x2)

	)

3219 
	#COEX_EVT_FLAG_DELAY_MEDIUM_FREE_NTFY_FLG
 (0x4)

	)

3221 
	#COEX_CU_UNASSOC_IDLE_RP
 4

	)

3222 
	#COEX_CU_UNASSOC_MANUAL_SCAN_RP
 4

	)

3223 
	#COEX_CU_UNASSOC_AUTO_SCAN_RP
 4

	)

3224 
	#COEX_CU_CALIBRATION_RP
 4

	)

3225 
	#COEX_CU_PERIODIC_CALIBRATION_RP
 4

	)

3226 
	#COEX_CU_CONNECTION_ESTAB_RP
 4

	)

3227 
	#COEX_CU_ASSOCIATED_IDLE_RP
 4

	)

3228 
	#COEX_CU_ASSOC_MANUAL_SCAN_RP
 4

	)

3229 
	#COEX_CU_ASSOC_AUTO_SCAN_RP
 4

	)

3230 
	#COEX_CU_ASSOC_ACTIVE_LEVEL_RP
 4

	)

3231 
	#COEX_CU_RF_ON_RP
 6

	)

3232 
	#COEX_CU_RF_OFF_RP
 4

	)

3233 
	#COEX_CU_STAND_ALONE_DEBUG_RP
 6

	)

3234 
	#COEX_CU_IPAN_ASSOC_LEVEL_RP
 4

	)

3235 
	#COEX_CU_RSRVD1_RP
 4

	)

3236 
	#COEX_CU_RSRVD2_RP
 4

	)

3238 
	#COEX_CU_UNASSOC_IDLE_WP
 3

	)

3239 
	#COEX_CU_UNASSOC_MANUAL_SCAN_WP
 3

	)

3240 
	#COEX_CU_UNASSOC_AUTO_SCAN_WP
 3

	)

3241 
	#COEX_CU_CALIBRATION_WP
 3

	)

3242 
	#COEX_CU_PERIODIC_CALIBRATION_WP
 3

	)

3243 
	#COEX_CU_CONNECTION_ESTAB_WP
 3

	)

3244 
	#COEX_CU_ASSOCIATED_IDLE_WP
 3

	)

3245 
	#COEX_CU_ASSOC_MANUAL_SCAN_WP
 3

	)

3246 
	#COEX_CU_ASSOC_AUTO_SCAN_WP
 3

	)

3247 
	#COEX_CU_ASSOC_ACTIVE_LEVEL_WP
 3

	)

3248 
	#COEX_CU_RF_ON_WP
 3

	)

3249 
	#COEX_CU_RF_OFF_WP
 3

	)

3250 
	#COEX_CU_STAND_ALONE_DEBUG_WP
 6

	)

3251 
	#COEX_CU_IPAN_ASSOC_LEVEL_WP
 3

	)

3252 
	#COEX_CU_RSRVD1_WP
 3

	)

3253 
	#COEX_CU_RSRVD2_WP
 3

	)

3255 
	#COEX_UNASSOC_IDLE_FLAGS
 0

	)

3256 
	#COEX_UNASSOC_MANUAL_SCAN_FLAGS
 \

3257 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3258 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
)

	)

3259 
	#COEX_UNASSOC_AUTO_SCAN_FLAGS
 \

3260 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3261 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
)

	)

3262 
	#COEX_CALIBRATION_FLAGS
 \

3263 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3264 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
)

	)

3265 
	#COEX_PERIODIC_CALIBRATION_FLAGS
 0

	)

3270 
	#COEX_CONNECTION_ESTAB_FLAGS
 \

3271 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3272 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
 | \

3273 
COEX_EVT_FLAG_DELAY_MEDIUM_FREE_NTFY_FLG
)

	)

3274 
	#COEX_ASSOCIATED_IDLE_FLAGS
 0

	)

3275 
	#COEX_ASSOC_MANUAL_SCAN_FLAGS
 \

3276 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3277 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
)

	)

3278 
	#COEX_ASSOC_AUTO_SCAN_FLAGS
 \

3279 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3280 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
)

	)

3281 
	#COEX_ASSOC_ACTIVE_LEVEL_FLAGS
 0

	)

3282 
	#COEX_RF_ON_FLAGS
 0

	)

3283 
	#COEX_RF_OFF_FLAGS
 0

	)

3284 
	#COEX_STAND_ALONE_DEBUG_FLAGS
 \

3285 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3286 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
)

	)

3287 
	#COEX_IPAN_ASSOC_LEVEL_FLAGS
 \

3288 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3289 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
 | \

3290 
COEX_EVT_FLAG_DELAY_MEDIUM_FREE_NTFY_FLG
)

	)

3291 
	#COEX_RSRVD1_FLAGS
 0

	)

3292 
	#COEX_RSRVD2_FLAGS
 0

	)

3297 
	#COEX_CU_RF_ON_FLAGS
 \

3298 (
COEX_EVT_FLAG_MEDIUM_FREE_NTFY_FLG
 | \

3299 
COEX_EVT_FLAG_MEDIUM_ACTV_NTFY_FLG
 | \

3300 
COEX_EVT_FLAG_DELAY_MEDIUM_FREE_NTFY_FLG
)

	)

3305 
	mCOEX_UNASSOC_IDLE
 = 0,

3306 
	mCOEX_UNASSOC_MANUAL_SCAN
 = 1,

3307 
	mCOEX_UNASSOC_AUTO_SCAN
 = 2,

3309 
	mCOEX_CALIBRATION
 = 3,

3310 
	mCOEX_PERIODIC_CALIBRATION
 = 4,

3312 
	mCOEX_CONNECTION_ESTAB
 = 5,

3314 
	mCOEX_ASSOCIATED_IDLE
 = 6,

3315 
	mCOEX_ASSOC_MANUAL_SCAN
 = 7,

3316 
	mCOEX_ASSOC_AUTO_SCAN
 = 8,

3317 
	mCOEX_ASSOC_ACTIVE_LEVEL
 = 9,

3319 
	mCOEX_RF_ON
 = 10,

3320 
	mCOEX_RF_OFF
 = 11,

3321 
	mCOEX_STAND_ALONE_DEBUG
 = 12,

3323 
	mCOEX_IPAN_ASSOC_LEVEL
 = 13,

3325 
	mCOEX_RSRVD1
 = 14,

3326 
	mCOEX_RSRVD2
 = 15,

3327 
	mCOEX_NUM_OF_EVENTS
 = 16

3335 
	siwl_wimax_c€x_evít_íåy
 {

3336 
u8
 
	mªque°_¥io
;

3337 
u8
 
	mwö_medium_¥io
;

3338 
u8
 
	mª£rved
;

3339 
u8
 
	mÊags
;

3340 } 
	g__∑cked
;

3345 
	#COEX_FLAGS_STA_TABLE_VALID_MSK
 (0x1)

	)

3347 
	#COEX_FLAGS_UNASSOC_WA_UNMASK_MSK
 (0x4)

	)

3349 
	#COEX_FLAGS_ASSOC_WA_UNMASK_MSK
 (0x8)

	)

3351 
	#COEX_FLAGS_COEX_ENABLE_MSK
 (0x80)

	)

3353 
	siwl_wimax_c€x_cmd
 {

3354 
u8
 
	mÊags
;

3355 
u8
 
	mª£rved
[3];

3356 
iwl_wimax_c€x_evít_íåy
 
	m°a_¥io
[
COEX_NUM_OF_EVENTS
];

3357 } 
	g__∑cked
;

3373 
	#COEX_MEDIUM_BUSY
 (0x0Ë

	)

3374 
	#COEX_MEDIUM_ACTIVE
 (0x1Ë

	)

3375 
	#COEX_MEDIUM_PRE_RELEASE
 (0x2Ë

	)

3376 
	#COEX_MEDIUM_MSK
 (0x7)

	)

3379 
	#COEX_MEDIUM_CHANGED
 (0x8)

	)

3380 
	#COEX_MEDIUM_CHANGED_MSK
 (0x8)

	)

3381 
	#COEX_MEDIUM_SHIFT
 (3)

	)

3383 
	siwl_c€x_medium_nŸifiˇti⁄
 {

3384 
__À32
 
	m°©us
;

3385 
__À32
 
	mevíts
;

3386 } 
	g__∑cked
;

3395 
	#COEX_EVENT_REQUEST_MSK
 (0x1)

	)

3397 
	siwl_c€x_evít_cmd
 {

3398 
u8
 
	mÊags
;

3399 
u8
 
	mevít
;

3400 
__À16
 
	mª£rved
;

3401 } 
	g__∑cked
;

3403 
	siwl_c€x_evít_ª•
 {

3404 
__À32
 
	m°©us
;

3405 } 
	g__∑cked
;

3417 
	eiwl_bt_c€x_¥ofûe_åaffic_lﬂd
 {

3418 
	mIWL_BT_COEX_TRAFFIC_LOAD_NONE
 = 0,

3419 
	mIWL_BT_COEX_TRAFFIC_LOAD_LOW
 = 1,

3420 
	mIWL_BT_COEX_TRAFFIC_LOAD_HIGH
 = 2,

3421 
	mIWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
 = 3,

3428 
	#BT_SESSION_ACTIVITY_1_UART_MSG
 0x1

	)

3429 
	#BT_SESSION_ACTIVITY_2_UART_MSG
 0x2

	)

3432 
	#BT_UART_MSG_FRAME1MSGTYPE_POS
 (0)

	)

3433 
	#BT_UART_MSG_FRAME1MSGTYPE_MSK
 \

3434 (0x7 << 
BT_UART_MSG_FRAME1MSGTYPE_POS
)

	)

3435 
	#BT_UART_MSG_FRAME1SSN_POS
 (3)

	)

3436 
	#BT_UART_MSG_FRAME1SSN_MSK
 \

3437 (0x3 << 
BT_UART_MSG_FRAME1SSN_POS
)

	)

3438 
	#BT_UART_MSG_FRAME1UPDATEREQ_POS
 (5)

	)

3439 
	#BT_UART_MSG_FRAME1UPDATEREQ_MSK
 \

3440 (0x1 << 
BT_UART_MSG_FRAME1UPDATEREQ_POS
)

	)

3441 
	#BT_UART_MSG_FRAME1RESERVED_POS
 (6)

	)

3442 
	#BT_UART_MSG_FRAME1RESERVED_MSK
 \

3443 (0x3 << 
BT_UART_MSG_FRAME1RESERVED_POS
)

	)

3445 
	#BT_UART_MSG_FRAME2OPENCONNECTIONS_POS
 (0)

	)

3446 
	#BT_UART_MSG_FRAME2OPENCONNECTIONS_MSK
 \

3447 (0x3 << 
BT_UART_MSG_FRAME2OPENCONNECTIONS_POS
)

	)

3448 
	#BT_UART_MSG_FRAME2TRAFFICLOAD_POS
 (2)

	)

3449 
	#BT_UART_MSG_FRAME2TRAFFICLOAD_MSK
 \

3450 (0x3 << 
BT_UART_MSG_FRAME2TRAFFICLOAD_POS
)

	)

3451 
	#BT_UART_MSG_FRAME2CHLSEQN_POS
 (4)

	)

3452 
	#BT_UART_MSG_FRAME2CHLSEQN_MSK
 \

3453 (0x1 << 
BT_UART_MSG_FRAME2CHLSEQN_POS
)

	)

3454 
	#BT_UART_MSG_FRAME2INBAND_POS
 (5)

	)

3455 
	#BT_UART_MSG_FRAME2INBAND_MSK
 \

3456 (0x1 << 
BT_UART_MSG_FRAME2INBAND_POS
)

	)

3457 
	#BT_UART_MSG_FRAME2RESERVED_POS
 (6)

	)

3458 
	#BT_UART_MSG_FRAME2RESERVED_MSK
 \

3459 (0x3 << 
BT_UART_MSG_FRAME2RESERVED_POS
)

	)

3461 
	#BT_UART_MSG_FRAME3SCOESCO_POS
 (0)

	)

3462 
	#BT_UART_MSG_FRAME3SCOESCO_MSK
 \

3463 (0x1 << 
BT_UART_MSG_FRAME3SCOESCO_POS
)

	)

3464 
	#BT_UART_MSG_FRAME3SNIFF_POS
 (1)

	)

3465 
	#BT_UART_MSG_FRAME3SNIFF_MSK
 \

3466 (0x1 << 
BT_UART_MSG_FRAME3SNIFF_POS
)

	)

3467 
	#BT_UART_MSG_FRAME3A2DP_POS
 (2)

	)

3468 
	#BT_UART_MSG_FRAME3A2DP_MSK
 \

3469 (0x1 << 
BT_UART_MSG_FRAME3A2DP_POS
)

	)

3470 
	#BT_UART_MSG_FRAME3ACL_POS
 (3)

	)

3471 
	#BT_UART_MSG_FRAME3ACL_MSK
 \

3472 (0x1 << 
BT_UART_MSG_FRAME3ACL_POS
)

	)

3473 
	#BT_UART_MSG_FRAME3MASTER_POS
 (4)

	)

3474 
	#BT_UART_MSG_FRAME3MASTER_MSK
 \

3475 (0x1 << 
BT_UART_MSG_FRAME3MASTER_POS
)

	)

3476 
	#BT_UART_MSG_FRAME3OBEX_POS
 (5)

	)

3477 
	#BT_UART_MSG_FRAME3OBEX_MSK
 \

3478 (0x1 << 
BT_UART_MSG_FRAME3OBEX_POS
)

	)

3479 
	#BT_UART_MSG_FRAME3RESERVED_POS
 (6)

	)

3480 
	#BT_UART_MSG_FRAME3RESERVED_MSK
 \

3481 (0x3 << 
BT_UART_MSG_FRAME3RESERVED_POS
)

	)

3483 
	#BT_UART_MSG_FRAME4IDLEDURATION_POS
 (0)

	)

3484 
	#BT_UART_MSG_FRAME4IDLEDURATION_MSK
 \

3485 (0x3F << 
BT_UART_MSG_FRAME4IDLEDURATION_POS
)

	)

3486 
	#BT_UART_MSG_FRAME4RESERVED_POS
 (6)

	)

3487 
	#BT_UART_MSG_FRAME4RESERVED_MSK
 \

3488 (0x3 << 
BT_UART_MSG_FRAME4RESERVED_POS
)

	)

3490 
	#BT_UART_MSG_FRAME5TXACTIVITY_POS
 (0)

	)

3491 
	#BT_UART_MSG_FRAME5TXACTIVITY_MSK
 \

3492 (0x3 << 
BT_UART_MSG_FRAME5TXACTIVITY_POS
)

	)

3493 
	#BT_UART_MSG_FRAME5RXACTIVITY_POS
 (2)

	)

3494 
	#BT_UART_MSG_FRAME5RXACTIVITY_MSK
 \

3495 (0x3 << 
BT_UART_MSG_FRAME5RXACTIVITY_POS
)

	)

3496 
	#BT_UART_MSG_FRAME5ESCORETRANSMIT_POS
 (4)

	)

3497 
	#BT_UART_MSG_FRAME5ESCORETRANSMIT_MSK
 \

3498 (0x3 << 
BT_UART_MSG_FRAME5ESCORETRANSMIT_POS
)

	)

3499 
	#BT_UART_MSG_FRAME5RESERVED_POS
 (6)

	)

3500 
	#BT_UART_MSG_FRAME5RESERVED_MSK
 \

3501 (0x3 << 
BT_UART_MSG_FRAME5RESERVED_POS
)

	)

3503 
	#BT_UART_MSG_FRAME6SNIFFINTERVAL_POS
 (0)

	)

3504 
	#BT_UART_MSG_FRAME6SNIFFINTERVAL_MSK
 \

3505 (0x1F << 
BT_UART_MSG_FRAME6SNIFFINTERVAL_POS
)

	)

3506 
	#BT_UART_MSG_FRAME6DISCOVERABLE_POS
 (5)

	)

3507 
	#BT_UART_MSG_FRAME6DISCOVERABLE_MSK
 \

3508 (0x1 << 
BT_UART_MSG_FRAME6DISCOVERABLE_POS
)

	)

3509 
	#BT_UART_MSG_FRAME6RESERVED_POS
 (6)

	)

3510 
	#BT_UART_MSG_FRAME6RESERVED_MSK
 \

3511 (0x3 << 
BT_UART_MSG_FRAME6RESERVED_POS
)

	)

3513 
	#BT_UART_MSG_FRAME7SNIFFACTIVITY_POS
 (0)

	)

3514 
	#BT_UART_MSG_FRAME7SNIFFACTIVITY_MSK
 \

3515 (0x7 << 
BT_UART_MSG_FRAME7SNIFFACTIVITY_POS
)

	)

3516 
	#BT_UART_MSG_FRAME7PAGE_POS
 (3)

	)

3517 
	#BT_UART_MSG_FRAME7PAGE_MSK
 \

3518 (0x1 << 
BT_UART_MSG_FRAME7PAGE_POS
)

	)

3519 
	#BT_UART_MSG_FRAME7INQUIRY_POS
 (4)

	)

3520 
	#BT_UART_MSG_FRAME7INQUIRY_MSK
 \

3521 (0x1 << 
BT_UART_MSG_FRAME7INQUIRY_POS
)

	)

3522 
	#BT_UART_MSG_FRAME7CONNECTABLE_POS
 (5)

	)

3523 
	#BT_UART_MSG_FRAME7CONNECTABLE_MSK
 \

3524 (0x1 << 
BT_UART_MSG_FRAME7CONNECTABLE_POS
)

	)

3525 
	#BT_UART_MSG_FRAME7RESERVED_POS
 (6)

	)

3526 
	#BT_UART_MSG_FRAME7RESERVED_MSK
 \

3527 (0x3 << 
BT_UART_MSG_FRAME7RESERVED_POS
)

	)

3530 
	#BT_UART_MSG_2_FRAME1RESERVED1_POS
 (5)

	)

3531 
	#BT_UART_MSG_2_FRAME1RESERVED1_MSK
 \

3532 (0x1<<
BT_UART_MSG_2_FRAME1RESERVED1_POS
)

	)

3533 
	#BT_UART_MSG_2_FRAME1RESERVED2_POS
 (6)

	)

3534 
	#BT_UART_MSG_2_FRAME1RESERVED2_MSK
 \

3535 (0x3<<
BT_UART_MSG_2_FRAME1RESERVED2_POS
)

	)

3537 
	#BT_UART_MSG_2_FRAME2AGGTRAFFICLOAD_POS
 (0)

	)

3538 
	#BT_UART_MSG_2_FRAME2AGGTRAFFICLOAD_MSK
 \

3539 (0x3F<<
BT_UART_MSG_2_FRAME2AGGTRAFFICLOAD_POS
)

	)

3540 
	#BT_UART_MSG_2_FRAME2RESERVED_POS
 (6)

	)

3541 
	#BT_UART_MSG_2_FRAME2RESERVED_MSK
 \

3542 (0x3<<
BT_UART_MSG_2_FRAME2RESERVED_POS
)

	)

3544 
	#BT_UART_MSG_2_FRAME3BRLASTTXPOWER_POS
 (0)

	)

3545 
	#BT_UART_MSG_2_FRAME3BRLASTTXPOWER_MSK
 \

3546 (0xF<<
BT_UART_MSG_2_FRAME3BRLASTTXPOWER_POS
)

	)

3547 
	#BT_UART_MSG_2_FRAME3INQPAGESRMODE_POS
 (4)

	)

3548 
	#BT_UART_MSG_2_FRAME3INQPAGESRMODE_MSK
 \

3549 (0x1<<
BT_UART_MSG_2_FRAME3INQPAGESRMODE_POS
)

	)

3550 
	#BT_UART_MSG_2_FRAME3LEMASTER_POS
 (5)

	)

3551 
	#BT_UART_MSG_2_FRAME3LEMASTER_MSK
 \

3552 (0x1<<
BT_UART_MSG_2_FRAME3LEMASTER_POS
)

	)

3553 
	#BT_UART_MSG_2_FRAME3RESERVED_POS
 (6)

	)

3554 
	#BT_UART_MSG_2_FRAME3RESERVED_MSK
 \

3555 (0x3<<
BT_UART_MSG_2_FRAME3RESERVED_POS
)

	)

3557 
	#BT_UART_MSG_2_FRAME4LELASTTXPOWER_POS
 (0)

	)

3558 
	#BT_UART_MSG_2_FRAME4LELASTTXPOWER_MSK
 \

3559 (0xF<<
BT_UART_MSG_2_FRAME4LELASTTXPOWER_POS
)

	)

3560 
	#BT_UART_MSG_2_FRAME4NUMLECONN_POS
 (4)

	)

3561 
	#BT_UART_MSG_2_FRAME4NUMLECONN_MSK
 \

3562 (0x3<<
BT_UART_MSG_2_FRAME4NUMLECONN_POS
)

	)

3563 
	#BT_UART_MSG_2_FRAME4RESERVED_POS
 (6)

	)

3564 
	#BT_UART_MSG_2_FRAME4RESERVED_MSK
 \

3565 (0x3<<
BT_UART_MSG_2_FRAME4RESERVED_POS
)

	)

3567 
	#BT_UART_MSG_2_FRAME5BTMINRSSI_POS
 (0)

	)

3568 
	#BT_UART_MSG_2_FRAME5BTMINRSSI_MSK
 \

3569 (0xF<<
BT_UART_MSG_2_FRAME5BTMINRSSI_POS
)

	)

3570 
	#BT_UART_MSG_2_FRAME5LESCANINITMODE_POS
 (4)

	)

3571 
	#BT_UART_MSG_2_FRAME5LESCANINITMODE_MSK
 \

3572 (0x1<<
BT_UART_MSG_2_FRAME5LESCANINITMODE_POS
)

	)

3573 
	#BT_UART_MSG_2_FRAME5LEADVERMODE_POS
 (5)

	)

3574 
	#BT_UART_MSG_2_FRAME5LEADVERMODE_MSK
 \

3575 (0x1<<
BT_UART_MSG_2_FRAME5LEADVERMODE_POS
)

	)

3576 
	#BT_UART_MSG_2_FRAME5RESERVED_POS
 (6)

	)

3577 
	#BT_UART_MSG_2_FRAME5RESERVED_MSK
 \

3578 (0x3<<
BT_UART_MSG_2_FRAME5RESERVED_POS
)

	)

3580 
	#BT_UART_MSG_2_FRAME6LECONNINTERVAL_POS
 (0)

	)

3581 
	#BT_UART_MSG_2_FRAME6LECONNINTERVAL_MSK
 \

3582 (0x1F<<
BT_UART_MSG_2_FRAME6LECONNINTERVAL_POS
)

	)

3583 
	#BT_UART_MSG_2_FRAME6RFU_POS
 (5)

	)

3584 
	#BT_UART_MSG_2_FRAME6RFU_MSK
 \

3585 (0x1<<
BT_UART_MSG_2_FRAME6RFU_POS
)

	)

3586 
	#BT_UART_MSG_2_FRAME6RESERVED_POS
 (6)

	)

3587 
	#BT_UART_MSG_2_FRAME6RESERVED_MSK
 \

3588 (0x3<<
BT_UART_MSG_2_FRAME6RESERVED_POS
)

	)

3590 
	#BT_UART_MSG_2_FRAME7LECONNSLAVELAT_POS
 (0)

	)

3591 
	#BT_UART_MSG_2_FRAME7LECONNSLAVELAT_MSK
 \

3592 (0x7<<
BT_UART_MSG_2_FRAME7LECONNSLAVELAT_POS
)

	)

3593 
	#BT_UART_MSG_2_FRAME7LEPROFILE1_POS
 (3)

	)

3594 
	#BT_UART_MSG_2_FRAME7LEPROFILE1_MSK
 \

3595 (0x1<<
BT_UART_MSG_2_FRAME7LEPROFILE1_POS
)

	)

3596 
	#BT_UART_MSG_2_FRAME7LEPROFILE2_POS
 (4)

	)

3597 
	#BT_UART_MSG_2_FRAME7LEPROFILE2_MSK
 \

3598 (0x1<<
BT_UART_MSG_2_FRAME7LEPROFILE2_POS
)

	)

3599 
	#BT_UART_MSG_2_FRAME7LEPROFILEOTHER_POS
 (5)

	)

3600 
	#BT_UART_MSG_2_FRAME7LEPROFILEOTHER_MSK
 \

3601 (0x1<<
BT_UART_MSG_2_FRAME7LEPROFILEOTHER_POS
)

	)

3602 
	#BT_UART_MSG_2_FRAME7RESERVED_POS
 (6)

	)

3603 
	#BT_UART_MSG_2_FRAME7RESERVED_MSK
 \

3604 (0x3<<
BT_UART_MSG_2_FRAME7RESERVED_POS
)

	)

3607 
	#BT_ENABLE_REDUCED_TXPOWER_THRESHOLD
 (-62)

	)

3608 
	#BT_DISABLE_REDUCED_TXPOWER_THRESHOLD
 (-65)

	)

3610 
	siwl_bt_u¨t_msg
 {

3611 
u8
 
	mhódî
;

3612 
u8
 
	m‰ame1
;

3613 
u8
 
	m‰ame2
;

3614 
u8
 
	m‰ame3
;

3615 
u8
 
	m‰ame4
;

3616 
u8
 
	m‰ame5
;

3617 
u8
 
	m‰ame6
;

3618 
u8
 
	m‰ame7
;

3619 } 
	g__∑cked
;

3621 
	siwl_bt_c€x_¥ofûe_nŸif
 {

3622 
iwl_bt_u¨t_msg
 
	mœ°_bt_u¨t_msg
;

3623 
u8
 
	mbt_°©us
;

3624 
u8
 
	mbt_åaffic_lﬂd
;

3625 
u8
 
	mbt_ci_com∂ün˚
;

3626 
u8
 
	mª£rved
;

3627 } 
	g__∑cked
;

3629 
	#IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
 0

	)

3630 
	#IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_MSK
 0x1

	)

3631 
	#IWL_BT_COEX_PRIO_TBL_PRIO_POS
 1

	)

3632 
	#IWL_BT_COEX_PRIO_TBL_PRIO_MASK
 0x0e

	)

3633 
	#IWL_BT_COEX_PRIO_TBL_RESERVED_POS
 4

	)

3634 
	#IWL_BT_COEX_PRIO_TBL_RESERVED_MASK
 0xf0

	)

3635 
	#IWL_BT_COEX_PRIO_TBL_PRIO_SHIFT
 1

	)

3641 
	ebt_c€x_¥io_èbÀ_evíts
 {

3642 
	mBT_COEX_PRIO_TBL_EVT_INIT_CALIB1
 = 0,

3643 
	mBT_COEX_PRIO_TBL_EVT_INIT_CALIB2
 = 1,

3644 
	mBT_COEX_PRIO_TBL_EVT_PERIODIC_CALIB_LOW1
 = 2,

3645 
	mBT_COEX_PRIO_TBL_EVT_PERIODIC_CALIB_LOW2
 = 3,

3646 
	mBT_COEX_PRIO_TBL_EVT_PERIODIC_CALIB_HIGH1
 = 4,

3647 
	mBT_COEX_PRIO_TBL_EVT_PERIODIC_CALIB_HIGH2
 = 5,

3648 
	mBT_COEX_PRIO_TBL_EVT_DTIM
 = 6,

3649 
	mBT_COEX_PRIO_TBL_EVT_SCAN52
 = 7,

3650 
	mBT_COEX_PRIO_TBL_EVT_SCAN24
 = 8,

3651 
	mBT_COEX_PRIO_TBL_EVT_RESERVED0
 = 9,

3652 
	mBT_COEX_PRIO_TBL_EVT_RESERVED1
 = 10,

3653 
	mBT_COEX_PRIO_TBL_EVT_RESERVED2
 = 11,

3654 
	mBT_COEX_PRIO_TBL_EVT_RESERVED3
 = 12,

3655 
	mBT_COEX_PRIO_TBL_EVT_RESERVED4
 = 13,

3656 
	mBT_COEX_PRIO_TBL_EVT_RESERVED5
 = 14,

3657 
	mBT_COEX_PRIO_TBL_EVT_RESERVED6
 = 15,

3659 
	mBT_COEX_PRIO_TBL_EVT_MAX
,

3662 
	ebt_c€x_¥io_èbÀ_¥i‹ôõs
 {

3663 
	mBT_COEX_PRIO_TBL_DISABLED
 = 0,

3664 
	mBT_COEX_PRIO_TBL_PRIO_LOW
 = 1,

3665 
	mBT_COEX_PRIO_TBL_PRIO_HIGH
 = 2,

3666 
	mBT_COEX_PRIO_TBL_PRIO_BYPASS
 = 3,

3667 
	mBT_COEX_PRIO_TBL_PRIO_COEX_OFF
 = 4,

3668 
	mBT_COEX_PRIO_TBL_PRIO_COEX_ON
 = 5,

3669 
	mBT_COEX_PRIO_TBL_PRIO_RSRVD1
 = 6,

3670 
	mBT_COEX_PRIO_TBL_PRIO_RSRVD2
 = 7,

3671 
	mBT_COEX_PRIO_TBL_MAX
,

3674 
	siwl_bt_c€x_¥io_èbÀ_cmd
 {

3675 
u8
 
	m¥io_tbl
[
BT_COEX_PRIO_TBL_EVT_MAX
];

3676 } 
	g__∑cked
;

3678 
	#IWL_BT_COEX_ENV_CLOSE
 0

	)

3679 
	#IWL_BT_COEX_ENV_OPEN
 1

	)

3684 
	siwl_bt_c€x_¥Ÿ_ív_cmd
 {

3685 
u8
 
	ma˘i⁄
;

3686 
u8
 
	mty≥
;

3687 
u8
 
	mª£rved
[2];

3688 } 
	g__∑cked
;

3693 
	eiwœgn_d3_wakeup_fûãrs
 {

3694 
	mIWLAGN_D3_WAKEUP_RFKILL
 = 
BIT
(0),

3695 
	mIWLAGN_D3_WAKEUP_SYSASSERT
 = 
BIT
(1),

3698 
	siwœgn_d3_c⁄fig_cmd
 {

3699 
__À32
 
	mmö_¶ìp_time
;

3700 
__À32
 
	mwakeup_Êags
;

3701 } 
	g__∑cked
;

3706 
	#IWLAGN_WOWLAN_MIN_PATTERN_LEN
 16

	)

3707 
	#IWLAGN_WOWLAN_MAX_PATTERN_LEN
 128

	)

3709 
	siwœgn_wowœn_∑âîn
 {

3710 
u8
 
	mmask
[
IWLAGN_WOWLAN_MAX_PATTERN_LEN
 / 8];

3711 
u8
 
	m∑âîn
[
IWLAGN_WOWLAN_MAX_PATTERN_LEN
];

3712 
u8
 
	mmask_size
;

3713 
u8
 
	m∑âîn_size
;

3714 
__À16
 
	mª£rved
;

3715 } 
	g__∑cked
;

3717 
	#IWLAGN_WOWLAN_MAX_PATTERNS
 20

	)

3719 
	siwœgn_wowœn_∑âîns_cmd
 {

3720 
__À32
 
	mn_∑âîns
;

3721 
iwœgn_wowœn_∑âîn
 
	m∑âîns
[];

3722 } 
	g__∑cked
;

3727 
	eiwœgn_wowœn_wakeup_fûãrs
 {

3728 
	mIWLAGN_WOWLAN_WAKEUP_MAGIC_PACKET
 = 
BIT
(0),

3729 
	mIWLAGN_WOWLAN_WAKEUP_PATTERN_MATCH
 = 
BIT
(1),

3730 
	mIWLAGN_WOWLAN_WAKEUP_BEACON_MISS
 = 
BIT
(2),

3731 
	mIWLAGN_WOWLAN_WAKEUP_LINK_CHANGE
 = 
BIT
(3),

3732 
	mIWLAGN_WOWLAN_WAKEUP_GTK_REKEY_FAIL
 = 
BIT
(4),

3733 
	mIWLAGN_WOWLAN_WAKEUP_EAP_IDENT_REQ
 = 
BIT
(5),

3734 
	mIWLAGN_WOWLAN_WAKEUP_4WAY_HANDSHAKE
 = 
BIT
(6),

3735 
	mIWLAGN_WOWLAN_WAKEUP_ALWAYS
 = 
BIT
(7),

3736 
	mIWLAGN_WOWLAN_WAKEUP_ENABLE_NET_DETECT
 = 
BIT
(8),

3739 
	siwœgn_wowœn_wakeup_fûãr_cmd
 {

3740 
__À32
 
	míabÀd
;

3741 
__À16
 
	mn⁄_qos_£q
;

3742 
__À16
 
	mª£rved
;

3743 
__À16
 
	mqos_£q
[8];

3749 
	#IWLAGN_NUM_RSC
 16

	)

3751 
	stkù_sc
 {

3752 
__À16
 
	miv16
;

3753 
__À16
 
	m∑d
;

3754 
__À32
 
	miv32
;

3755 } 
	g__∑cked
;

3757 
	siwœgn_tkù_rsc_tsc
 {

3758 
tkù_sc
 
	muniˇ°_rsc
[
IWLAGN_NUM_RSC
];

3759 
tkù_sc
 
	mmu…iˇ°_rsc
[
IWLAGN_NUM_RSC
];

3760 
tkù_sc
 
	mtsc
;

3761 } 
	g__∑cked
;

3763 
	s´s_sc
 {

3764 
__À64
 
	m≤
;

3765 } 
	g__∑cked
;

3767 
	siwœgn_´s_rsc_tsc
 {

3768 
´s_sc
 
	muniˇ°_rsc
[
IWLAGN_NUM_RSC
];

3769 
´s_sc
 
	mmu…iˇ°_rsc
[
IWLAGN_NUM_RSC
];

3770 
´s_sc
 
	mtsc
;

3771 } 
	g__∑cked
;

3773 
	uiwœgn_Æl_tsc_rsc
 {

3774 
iwœgn_tkù_rsc_tsc
 
	mtkù
;

3775 
iwœgn_´s_rsc_tsc
 
	m´s
;

3778 
	siwœgn_wowœn_rsc_tsc_∑øms_cmd
 {

3779 
iwœgn_Æl_tsc_rsc
 
	mÆl_tsc_rsc
;

3780 } 
	g__∑cked
;

3785 
	#IWLAGN_MIC_KEY_SIZE
 8

	)

3786 
	#IWLAGN_P1K_SIZE
 5

	)

3787 
	siwœgn_mic_keys
 {

3788 
u8
 
	mtx
[
IWLAGN_MIC_KEY_SIZE
];

3789 
u8
 
	mrx_uniˇ°
[
IWLAGN_MIC_KEY_SIZE
];

3790 
u8
 
	mrx_mˇ°
[
IWLAGN_MIC_KEY_SIZE
];

3791 } 
	g__∑cked
;

3793 
	siwœgn_p1k_ˇche
 {

3794 
__À16
 
	mp1k
[
IWLAGN_P1K_SIZE
];

3795 } 
	g__∑cked
;

3797 
	#IWLAGN_NUM_RX_P1K_CACHE
 2

	)

3799 
	siwœgn_wowœn_tkù_∑øms_cmd
 {

3800 
iwœgn_mic_keys
 
	mmic_keys
;

3801 
iwœgn_p1k_ˇche
 
	mtx
;

3802 
iwœgn_p1k_ˇche
 
	mrx_uni
[
IWLAGN_NUM_RX_P1K_CACHE
];

3803 
iwœgn_p1k_ˇche
 
	mrx_mu…i
[
IWLAGN_NUM_RX_P1K_CACHE
];

3804 } 
	g__∑cked
;

3810 
	#IWLAGN_KCK_MAX_SIZE
 32

	)

3811 
	#IWLAGN_KEK_MAX_SIZE
 32

	)

3813 
	siwœgn_wowœn_kek_kck_m©îül_cmd
 {

3814 
u8
 
	mkck
[
IWLAGN_KCK_MAX_SIZE
];

3815 
u8
 
	mkek
[
IWLAGN_KEK_MAX_SIZE
];

3816 
__À16
 
	mkck_Àn
;

3817 
__À16
 
	mkek_Àn
;

3818 
__À64
 
	mª∂ay_˘r
;

3819 } 
	g__∑cked
;

3821 
	#RF_KILL_INDICATOR_FOR_WOWLAN
 0x87

	)

3826 
	siwœgn_wowœn_°©us
 {

3827 
__À64
 
	mª∂ay_˘r
;

3828 
__À32
 
	mªkey_°©us
;

3829 
__À32
 
	mwakeup_ªas⁄
;

3830 
u8
 
	m∑âîn_numbî
;

3831 
u8
 
	mª£rved1
;

3832 
__À16
 
	mqos_£q_˘r
[8];

3833 
__À16
 
	mn⁄_qos_£q_˘r
;

3834 
__À16
 
	mª£rved2
;

3835 
iwœgn_Æl_tsc_rsc
 
	mtsc_rsc
;

3836 
__À16
 
	mª£rved3
;

3837 } 
	g__∑cked
;

3846 
	#IWL_MIN_SLOT_TIME
 20

	)

3856 
	siwl_wù™_¶Ÿ
 {

3857 
__À16
 
	mwidth
;

3858 
u8
 
	mty≥
;

3859 
u8
 
	mª£rved
;

3860 } 
	g__∑cked
;

3862 
	#IWL_WIPAN_PARAMS_FLG_LEAVE_CHANNEL_CTS
 
	`BIT
(1Ë

	)

3863 
	#IWL_WIPAN_PARAMS_FLG_LEAVE_CHANNEL_QUIET
 
	`BIT
(2Ë

	)

3864 
	#IWL_WIPAN_PARAMS_FLG_SLOTTED_MODE
 
	`BIT
(3Ë

	)

3865 
	#IWL_WIPAN_PARAMS_FLG_FILTER_BEACON_NOTIF
 
	`BIT
(4)

	)

3866 
	#IWL_WIPAN_PARAMS_FLG_FULL_SLOTTED_MODE
 
	`BIT
(5)

	)

3885 
	siwl_wù™_∑øms_cmd
 {

3886 
__À16
 
	mÊags
;

3887 
u8
 
	mª£rved
;

3888 
u8
 
	mnum_¶Ÿs
;

3889 
iwl_wù™_¶Ÿ
 
	m¶Ÿs
[10];

3890 } 
	g__∑cked
;

3900 
	siwl_wù™_p2p_ch™√l_swôch_cmd
 {

3901 
__À16
 
	mch™√l
;

3902 
__À16
 
	mª£rved
;

3916 
	siwl_wù™_nﬂ_des¸ùt‹
 {

3917 
u8
 
	mcou¡
;

3918 
__À32
 
	mduøti⁄
;

3919 
__À32
 
	möãrvÆ
;

3920 
__À32
 
	m°¨âime
;

3921 } 
	g__∑cked
;

3923 
	siwl_wù™_nﬂ_©åibuã
 {

3924 
u8
 
	mid
;

3925 
__À16
 
	mÀngth
;

3926 
u8
 
	mödex
;

3927 
u8
 
	m˘_wödow
;

3928 
iwl_wù™_nﬂ_des¸ùt‹
 
	mdes¸0
, 
	mdes¸1
;

3929 
u8
 
	mª£rved
;

3930 } 
	g__∑cked
;

3932 
	siwl_wù™_nﬂ_nŸifiˇti⁄
 {

3933 
u32
 
	mnﬂ_a˘ive
;

3934 
iwl_wù™_nﬂ_©åibuã
 
	mnﬂ_©åibuã
;

3935 } 
	g__∑cked
;

	@dvm/debugfs.c

8 
	~<löux/¶ab.h
>

9 
	~<löux/kî√l.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/debugfs.h
>

12 
	~<löux/õì80211.h
>

13 
	~<√t/mac80211.h
>

15 
	~"iwl-debug.h
"

16 
	~"iwl-å™s.h
"

17 
	~"iwl-io.h
"

18 
	~"dev.h
"

19 
	~"agn.h
"

22 
	#DEBUGFS_ADD_FILE
(
«me
, 
∑ª¡
, 
mode
) do { \

23 
	`debugfs_¸óã_fûe
(#«me, 
mode
, 
∑ª¡
, 
¥iv
, \

24 &
iwl_dbgfs_
##
«me
##
_›s
); \

25 } 0)

	)

28 
	#DEBUGFS_READ_FILE_OPS
(
«me
) \

29 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

30 .
ªad
 = 
iwl_dbgfs_
##
«me
##
_ªad
, \

31 .
›í
 = 
sim∂e_›í
, \

32 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

33 };

	)

35 
	#DEBUGFS_WRITE_FILE_OPS
(
«me
) \

36 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

37 .
wrôe
 = 
iwl_dbgfs_
##
«me
##
_wrôe
, \

38 .
›í
 = 
sim∂e_›í
, \

39 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

40 };

	)

43 
	#DEBUGFS_READ_WRITE_FILE_OPS
(
«me
) \

44 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

45 .
wrôe
 = 
iwl_dbgfs_
##
«me
##
_wrôe
, \

46 .
ªad
 = 
iwl_dbgfs_
##
«me
##
_ªad
, \

47 .
›í
 = 
sim∂e_›í
, \

48 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

49 };

	)

51 
ssize_t
 
	$iwl_dbgfs_§am_ªad
(
fûe
 *file,

52 
__u£r
 *
u£r_buf
,

53 
size_t
 
cou¡
, 
loff_t
 *
µos
)

55 
u32
 
vÆ
 = 0;

56 *
buf
;

57 
ssize_t
 
ªt
;

58 
i
 = 0;

59 
boﬁ
 
devi˚_f‹m©
 = 
Ál£
;

60 
off£t
 = 0;

61 
Àn
 = 0;

62 
pos
 = 0;

63 
§am
;

64 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

65 c⁄° 
fw_img
 *
img
;

66 
size_t
 
bufsz
;

68 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

69  -
EAGAIN
;

72 i‡(!
¥iv
->
dbgfs_§am_off£t
 && !¥iv->
dbgfs_§am_Àn
) {

73 
¥iv
->
dbgfs_§am_off£t
 = 0x800000;

74 i‡(!
¥iv
->
ucode_lﬂded
)

75  -
EINVAL
;

76 
img
 = &
¥iv
->
fw
->img[¥iv->
cur_ucode
];

77 
¥iv
->
dbgfs_§am_Àn
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
Àn
;

79 
Àn
 = 
¥iv
->
dbgfs_§am_Àn
;

81 i‡(
Àn
 == -4) {

82 
devi˚_f‹m©
 = 
åue
;

83 
Àn
 = 4;

86 
bufsz
 = 50 + 
Àn
 * 4;

87 
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

88 i‡(!
buf
)

89  -
ENOMEM
;

91 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "sram_len: 0x%x\n",

92 
Àn
);

93 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "sram_offset: 0x%x\n",

94 
¥iv
->
dbgfs_§am_off£t
);

97 
off£t
 = 
¥iv
->
dbgfs_§am_off£t
 & 0x3;

98 
§am
 = 
¥iv
->
dbgfs_§am_off£t
 & ~0x3;

101 
vÆ
 = 
	`iwl_å™s_ªad_mem32
(
¥iv
->
å™s
, 
§am
);

103 ; 
Àn
;Üen--) {

105 i‡(
i
 == 0)

106 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

107 "%08X: ", 
§am
 + 
off£t
);

109 i‡(
devi˚_f‹m©
)

110 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

111 "%02x", (
vÆ
 >> (8 * (3 - 
off£t
))) & 0xff);

113 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

114 "%02x ", (
vÆ
 >> (8 * 
off£t
)) & 0xff);

117 i‡(++
off£t
 == 4) {

118 
§am
 += 4;

119 
off£t
 = 0;

120 
vÆ
 = 
	`iwl_å™s_ªad_mem32
(
¥iv
->
å™s
, 
§am
);

124 i‡(++
i
 == 16) {

125 
i
 = 0;

126 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

127 } i‡(!(
i
 & 7)) {

128 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " ");

129 } i‡(!(
i
 & 3)) {

130 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " ");

133 i‡(
i
)

134 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

136 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

137 
	`k‰ì
(
buf
);

138  
ªt
;

139 
	}
}

141 
ssize_t
 
	$iwl_dbgfs_§am_wrôe
(
fûe
 *file,

142 c⁄° 
__u£r
 *
u£r_buf
,

143 
size_t
 
cou¡
, 
loff_t
 *
µos
)

145 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

146 
buf
[64];

147 
buf_size
;

148 
u32
 
off£t
, 
Àn
;

150 
	`mem£t
(
buf
, 0, (buf));

151 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

152 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

153  -
EFAULT
;

155 i‡(
	`ssˇnf
(
buf
, "%x,%x", &
off£t
, &
Àn
) == 2) {

156 
¥iv
->
dbgfs_§am_off£t
 = 
off£t
;

157 
¥iv
->
dbgfs_§am_Àn
 = 
Àn
;

158 } i‡(
	`ssˇnf
(
buf
, "%x", &
off£t
) == 1) {

159 
¥iv
->
dbgfs_§am_off£t
 = 
off£t
;

160 
¥iv
->
dbgfs_§am_Àn
 = -4;

162 
¥iv
->
dbgfs_§am_off£t
 = 0;

163 
¥iv
->
dbgfs_§am_Àn
 = 0;

166  
cou¡
;

167 
	}
}

169 
ssize_t
 
	$iwl_dbgfs_wowœn_§am_ªad
(
fûe
 *file,

170 
__u£r
 *
u£r_buf
,

171 
size_t
 
cou¡
, 
loff_t
 *
µos
)

173 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

174 c⁄° 
fw_img
 *
img
 = &
¥iv
->
fw
->img[
IWL_UCODE_WOWLAN
];

176 i‡(!
¥iv
->
wowœn_§am
)

177  -
ENODATA
;

179  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
,

180 
¥iv
->
wowœn_§am
,

181 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
Àn
);

182 
	}
}

183 
ssize_t
 
	$iwl_dbgfs_°©i⁄s_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

184 
size_t
 
cou¡
, 
loff_t
 *
µos
)

186 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

187 
iwl_°©i⁄_íåy
 *
°©i⁄
;

188 
iwl_tid_d©a
 *
tid_d©a
;

189 *
buf
;

190 
i
, 
j
, 
pos
 = 0;

191 
ssize_t
 
ªt
;

193 c⁄° 
size_t
 
bufsz
 = 30 + (Ë* 500 * (
¥iv
->
num_°©i⁄s
);

195 
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

196 i‡(!
buf
)

197  -
ENOMEM
;

199 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "num of stations: %d\n\n",

200 
¥iv
->
num_°©i⁄s
);

202 
i
 = 0; i < 
IWLAGN_STATION_COUNT
; i++) {

203 
°©i⁄
 = &
¥iv
->
°©i⁄s
[
i
];

204 i‡(!
°©i⁄
->
u£d
)

206 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

208 
i
, 
°©i⁄
->
°a
.°a.
addr
,

209 
°©i⁄
->
°a
.
°©i⁄_Êags_msk
);

210 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

214 
j
 = 0; j < 
IWL_MAX_TID_COUNT
; j++) {

215 
tid_d©a
 = &
¥iv
->tid_d©a[
i
][
j
];

216 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

219 
j
, 
tid_d©a
->
£q_numbî
,

220 
tid_d©a
->
√xt_ª˛aimed
,

221 
tid_d©a
->
agg
.
øã_n_Êags
,

222 
tid_d©a
->
agg
.
°©e
,

223 
tid_d©a
->
agg
.
txq_id
);

225 i‡(
tid_d©a
->
agg
.
waô_f‹_ba
)

226 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

228 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

231 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

234 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

235 
	`k‰ì
(
buf
);

236  
ªt
;

237 
	}
}

239 
ssize_t
 
	$iwl_dbgfs_nvm_ªad
(
fûe
 *file,

240 
__u£r
 *
u£r_buf
,

241 
size_t
 
cou¡
,

242 
loff_t
 *
µos
)

244 
ssize_t
 
ªt
;

245 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

246 
pos
 = 0, 
ofs
 = 0, 
buf_size
 = 0;

247 c⁄° 
u8
 *
±r
;

248 *
buf
;

249 
u16
 
nvm_vî
;

250 
size_t
 
ì¥om_Àn
 = 
¥iv
->
ì¥om_blob_size
;

251 
buf_size
 = 4 * 
ì¥om_Àn
 + 256;

253 i‡(
ì¥om_Àn
 % 16)

254  -
ENODATA
;

256 
±r
 = 
¥iv
->
ì¥om_blob
;

257 i‡(!
±r
)

258  -
ENOMEM
;

261 
buf
 = 
	`kzÆloc
(
buf_size
, 
GFP_KERNEL
);

262 i‡(!
buf
)

263  -
ENOMEM
;

265 
nvm_vî
 = 
¥iv
->
nvm_d©a
->
nvm_vîsi⁄
;

266 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buf_size
 -Öos,

267 "NVM vîsi⁄: 0x%x\n", 
nvm_vî
);

268 
ofs
 = 0 ; of†< 
ì¥om_Àn
 ; ofs += 16) {

269 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buf_size
 -Öos, "0x%.4x %16ph\n",

270 
ofs
, 
±r
 + ofs);

273 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

274 
	`k‰ì
(
buf
);

275  
ªt
;

276 
	}
}

278 
ssize_t
 
	$iwl_dbgfs_ch™√ls_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

279 
size_t
 
cou¡
, 
loff_t
 *
µos
)

281 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

282 
õì80211_ch™√l
 *
ch™√ls
 = 
NULL
;

283 c⁄° 
õì80211_suµ‹ãd_b™d
 *
suµ_b™d
 = 
NULL
;

284 
pos
 = 0, 
i
, 
bufsz
 = 
PAGE_SIZE
;

285 *
buf
;

286 
ssize_t
 
ªt
;

288 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

289 i‡(!
buf
)

290  -
ENOMEM
;

292 
suµ_b™d
 = 
	`iwl_gë_hw_mode
(
¥iv
, 
NL80211_BAND_2GHZ
);

293 i‡(
suµ_b™d
) {

294 
ch™√ls
 = 
suµ_b™d
->channels;

296 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

298 
suµ_b™d
->
n_ch™√ls
);

300 
i
 = 0; i < 
suµ_b™d
->
n_ch™√ls
; i++)

301 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

303 
ch™√ls
[
i
].
hw_vÆue
,

304 
ch™√ls
[
i
].
max_powî
,

305 
ch™√ls
[
i
].
Êags
 & 
IEEE80211_CHAN_RADAR
 ?

307 ((
ch™√ls
[
i
].
Êags
 & 
IEEE80211_CHAN_NO_IR
)

308 || (
ch™√ls
[
i
].
Êags
 &

309 
IEEE80211_CHAN_RADAR
)) ? "" :

311 
ch™√ls
[
i
].
Êags
 &

312 
IEEE80211_CHAN_NO_IR
 ?

315 
suµ_b™d
 = 
	`iwl_gë_hw_mode
(
¥iv
, 
NL80211_BAND_5GHZ
);

316 i‡(
suµ_b™d
) {

317 
ch™√ls
 = 
suµ_b™d
->channels;

319 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

321 
suµ_b™d
->
n_ch™√ls
);

323 
i
 = 0; i < 
suµ_b™d
->
n_ch™√ls
; i++)

324 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

326 
ch™√ls
[
i
].
hw_vÆue
,

327 
ch™√ls
[
i
].
max_powî
,

328 
ch™√ls
[
i
].
Êags
 & 
IEEE80211_CHAN_RADAR
 ?

330 ((
ch™√ls
[
i
].
Êags
 & 
IEEE80211_CHAN_NO_IR
)

331 || (
ch™√ls
[
i
].
Êags
 &

332 
IEEE80211_CHAN_RADAR
)) ? "" :

334 
ch™√ls
[
i
].
Êags
 &

335 
IEEE80211_CHAN_NO_IR
 ?

338 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

339 
	`k‰ì
(
buf
);

340  
ªt
;

341 
	}
}

343 
ssize_t
 
	$iwl_dbgfs_°©us_ªad
(
fûe
 *file,

344 
__u£r
 *
u£r_buf
,

345 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

347 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

348 
buf
[512];

349 
pos
 = 0;

350 c⁄° 
size_t
 
bufsz
 = (
buf
);

352 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_RF_KILL_HW:\t %d\n",

353 
	`ã°_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
));

354 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_CT_KILL:\t\t %d\n",

355 
	`ã°_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
));

356 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_ALIVE:\t\t %d\n",

357 
	`ã°_bô
(
STATUS_ALIVE
, &
¥iv
->
°©us
));

358 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_READY:\t\t %d\n",

359 
	`ã°_bô
(
STATUS_READY
, &
¥iv
->
°©us
));

360 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_EXIT_PENDING:\t %d\n",

361 
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
));

362 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_STATISTICS:\t %d\n",

363 
	`ã°_bô
(
STATUS_STATISTICS
, &
¥iv
->
°©us
));

364 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_SCANNING:\t %d\n",

365 
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
));

366 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_SCAN_ABORTING:\t %d\n",

367 
	`ã°_bô
(
STATUS_SCAN_ABORTING
, &
¥iv
->
°©us
));

368 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_SCAN_HW:\t\t %d\n",

369 
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
));

370 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_POWER_PMI:\t %d\n",

371 
	`ã°_bô
(
STATUS_POWER_PMI
, &
¥iv
->
°©us
));

372 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "STATUS_FW_ERROR:\t %d\n",

373 
	`ã°_bô
(
STATUS_FW_ERROR
, &
¥iv
->
°©us
));

374  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

375 
	}
}

377 
ssize_t
 
	$iwl_dbgfs_rx_h™dÀrs_ªad
(
fûe
 *file,

378 
__u£r
 *
u£r_buf
,

379 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

381 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

383 
pos
 = 0;

384 
˙t
 = 0;

385 *
buf
;

386 
bufsz
 = 24 * 64;

387 
ssize_t
 
ªt
;

389 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

390 i‡(!
buf
)

391  -
ENOMEM
;

393 
˙t
 = 0; c¡ < 
REPLY_MAX
; cnt++) {

394 i‡(
¥iv
->
rx_h™dÀrs_°©s
[
˙t
] > 0)

395 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

397 
	`iwl_gë_cmd_°rög
(
¥iv
->
å™s
, (
u32
)
˙t
),

398 
¥iv
->
rx_h™dÀrs_°©s
[
˙t
]);

401 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

402 
	`k‰ì
(
buf
);

403  
ªt
;

404 
	}
}

406 
ssize_t
 
	$iwl_dbgfs_rx_h™dÀrs_wrôe
(
fûe
 *file,

407 c⁄° 
__u£r
 *
u£r_buf
,

408 
size_t
 
cou¡
, 
loff_t
 *
µos
)

410 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

412 
buf
[8];

413 
buf_size
;

414 
u32
 
ª£t_Êag
;

416 
	`mem£t
(
buf
, 0, (buf));

417 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

418 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

419  -
EFAULT
;

420 i‡(
	`ssˇnf
(
buf
, "%x", &
ª£t_Êag
) != 1)

421  -
EFAULT
;

422 i‡(
ª£t_Êag
 == 0)

423 
	`mem£t
(&
¥iv
->
rx_h™dÀrs_°©s
[0], 0,

424 (
¥iv
->
rx_h™dÀrs_°©s
));

426  
cou¡
;

427 
	}
}

429 
ssize_t
 
	$iwl_dbgfs_qos_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

430 
size_t
 
cou¡
, 
loff_t
 *
µos
)

432 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

433 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

434 
pos
 = 0, 
i
;

435 
buf
[256 * 
NUM_IWL_RXON_CTX
];

436 c⁄° 
size_t
 
bufsz
 = (
buf
);

438 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

439 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "context %d:\n",

440 
˘x
->
˘xid
);

441 
i
 = 0; i < 
AC_NUM
; i++) {

442 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

444 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

445 "AC[%d]\t%u\t%u\t%u\t%u\n", 
i
,

446 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
i
].
cw_mö
,

447 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
i
].
cw_max
,

448 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
i
].
aif¢
,

449 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
i
].
edˇ_tx›
);

451 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

453  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

454 
	}
}

456 
ssize_t
 
	$iwl_dbgfs_thîmÆ_thrŸéög_ªad
(
fûe
 *file,

457 
__u£r
 *
u£r_buf
,

458 
size_t
 
cou¡
, 
loff_t
 *
µos
)

460 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

461 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

462 
iwl_â_ª°ri˘i⁄
 *
ª°ri˘i⁄
;

463 
buf
[100];

464 
pos
 = 0;

465 c⁄° 
size_t
 
bufsz
 = (
buf
);

467 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

469 
â
->
adv™˚d_â
 ? "Advance" : "Legacy");

470 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

472 
â
->
°©e
);

473 i‡(
â
->
adv™˚d_â
) {

474 
ª°ri˘i⁄
 = 
â
->ª°ri˘i⁄ +Åt->
°©e
;

475 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

477 
ª°ri˘i⁄
->
tx_°ªam
);

478 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

480 
ª°ri˘i⁄
->
rx_°ªam
);

481 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

483 
ª°ri˘i⁄
->
is_ht
);

485  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

486 
	}
}

488 
ssize_t
 
	$iwl_dbgfs_dißbÀ_ht40_wrôe
(
fûe
 *file,

489 c⁄° 
__u£r
 *
u£r_buf
,

490 
size_t
 
cou¡
, 
loff_t
 *
µos
)

492 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

493 
buf
[8];

494 
buf_size
;

495 
ht40
;

497 
	`mem£t
(
buf
, 0, (buf));

498 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

499 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

500  -
EFAULT
;

501 i‡(
	`ssˇnf
(
buf
, "%d", &
ht40
) != 1)

502  -
EFAULT
;

503 i‡(!
	`iwl_is_™y_assocüãd
(
¥iv
))

504 
¥iv
->
dißbÀ_ht40
 = 
ht40
 ? 
åue
 : 
Ál£
;

506  -
EINVAL
;

508  
cou¡
;

509 
	}
}

511 
ssize_t
 
	$iwl_dbgfs_dißbÀ_ht40_ªad
(
fûe
 *file,

512 
__u£r
 *
u£r_buf
,

513 
size_t
 
cou¡
, 
loff_t
 *
µos
)

515 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

516 
buf
[100];

517 
pos
 = 0;

518 c⁄° 
size_t
 
bufsz
 = (
buf
);

520 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

522 
¥iv
->
dißbÀ_ht40
 ? "Disabled" : "Enabled");

523  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

524 
	}
}

526 
ssize_t
 
	$iwl_dbgfs_ãm≥øtuª_ªad
(
fûe
 *file,

527 
__u£r
 *
u£r_buf
,

528 
size_t
 
cou¡
, 
loff_t
 *
µos
)

530 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

531 
buf
[8];

532 
pos
 = 0;

533 c⁄° 
size_t
 
bufsz
 = (
buf
);

535 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%d\n", 
¥iv
->
ãm≥øtuª
);

536  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

537 
	}
}

540 
ssize_t
 
	$iwl_dbgfs_¶ìp_Àvñ_ovîride_wrôe
(
fûe
 *file,

541 c⁄° 
__u£r
 *
u£r_buf
,

542 
size_t
 
cou¡
, 
loff_t
 *
µos
)

544 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

545 
buf
[8];

546 
buf_size
;

547 
vÆue
;

549 
	`mem£t
(
buf
, 0, (buf));

550 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

551 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

552  -
EFAULT
;

554 i‡(
	`ssˇnf
(
buf
, "%d", &
vÆue
) != 1)

555  -
EINVAL
;

562 i‡(
vÆue
 == 0)

563  -
EINVAL
;

564 i‡(
vÆue
 > 0)

565 
vÆue
 -= 1;

567 i‡(
vÆue
 !-1 && (vÆuê< 0 || vÆuê>
IWL_POWER_NUM
))

568  -
EINVAL
;

570 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

571  -
EAGAIN
;

573 
¥iv
->
powî_d©a
.
debug_¶ìp_Àvñ_ovîride
 = 
vÆue
;

575 
	`muãx_lock
(&
¥iv
->
muãx
);

576 
	`iwl_powî_upd©e_mode
(
¥iv
, 
åue
);

577 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

579  
cou¡
;

580 
	}
}

582 
ssize_t
 
	$iwl_dbgfs_¶ìp_Àvñ_ovîride_ªad
(
fûe
 *file,

583 
__u£r
 *
u£r_buf
,

584 
size_t
 
cou¡
, 
loff_t
 *
µos
)

586 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

587 
buf
[10];

588 
pos
, 
vÆue
;

589 c⁄° 
size_t
 
bufsz
 = (
buf
);

592 
vÆue
 = 
¥iv
->
powî_d©a
.
debug_¶ìp_Àvñ_ovîride
;

593 i‡(
vÆue
 >= 0)

594 
vÆue
 += 1;

596 
pos
 = 
	`s˙¥ötf
(
buf
, 
bufsz
, "%d\n", 
vÆue
);

597  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

598 
	}
}

600 
ssize_t
 
	$iwl_dbgfs_cuºít_¶ìp_comm™d_ªad
(
fûe
 *file,

601 
__u£r
 *
u£r_buf
,

602 
size_t
 
cou¡
, 
loff_t
 *
µos
)

604 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

605 
buf
[200];

606 
pos
 = 0, 
i
;

607 c⁄° 
size_t
 
bufsz
 = (
buf
);

608 
iwl_powîèbÀ_cmd
 *
cmd
 = &
¥iv
->
powî_d©a
.
¶ìp_cmd
;

610 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

611 "Êags: %#.2x\n", 
	`À16_to_˝u
(
cmd
->
Êags
));

612 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

614 
	`À32_to_˝u
(
cmd
->
rx_d©a_timeout
),

615 
	`À32_to_˝u
(
cmd
->
tx_d©a_timeout
));

616 
i
 = 0; i < 
IWL_POWER_VEC_SIZE
; i++)

617 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

618 "¶ìp_öãrvÆ[%d]: %d\n", 
i
,

619 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
i
]));

621  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

622 
	}
}

624 
DEBUGFS_READ_WRITE_FILE_OPS
(
§am
);

625 
DEBUGFS_READ_FILE_OPS
(
wowœn_§am
);

626 
DEBUGFS_READ_FILE_OPS
(
nvm
);

627 
DEBUGFS_READ_FILE_OPS
(
°©i⁄s
);

628 
DEBUGFS_READ_FILE_OPS
(
ch™√ls
);

629 
DEBUGFS_READ_FILE_OPS
(
°©us
);

630 
DEBUGFS_READ_WRITE_FILE_OPS
(
rx_h™dÀrs
);

631 
DEBUGFS_READ_FILE_OPS
(
qos
);

632 
DEBUGFS_READ_FILE_OPS
(
thîmÆ_thrŸéög
);

633 
DEBUGFS_READ_WRITE_FILE_OPS
(
dißbÀ_ht40
);

634 
DEBUGFS_READ_FILE_OPS
(
ãm≥øtuª
);

635 
DEBUGFS_READ_WRITE_FILE_OPS
(
¶ìp_Àvñ_ovîride
);

636 
DEBUGFS_READ_FILE_OPS
(
cuºít_¶ìp_comm™d
);

638 
	#fmt_vÆue
 " %-30†%10u\n"

	)

639 
	#fmt_hex
 " %-30† 0x%02X\n"

	)

640 
	#fmt_èbÀ
 " %-30†%10u %10u %10u %10u\n"

	)

641 
	#fmt_hódî
 "%-32† cuºíà cumuœtivê dñè max\n"

	)

643 
	$iwl_°©i°ics_Êag
(
iwl_¥iv
 *
¥iv
, *
buf
, 
bufsz
)

645 
p
 = 0;

646 
u32
 
Êag
;

648 
	`lockdï_as£π_hñd
(&
¥iv
->
°©i°ics
.
lock
);

650 
Êag
 = 
	`À32_to_˝u
(
¥iv
->
°©i°ics
.flag);

652 
p
 +
	`s˙¥ötf
(
buf
 +Ö, 
bufsz
 -Ö, "Sèti°ic†Fœg(0x%X):\n", 
Êag
);

653 i‡(
Êag
 & 
UCODE_STATISTICS_CLEAR_MSK
)

654 
p
 +
	`s˙¥ötf
(
buf
 +Ö, 
bufsz
 -Ö,

656 
p
 +
	`s˙¥ötf
(
buf
 +Ö, 
bufsz
 -Ö, "\tOperational Frequency: %s\n",

657 (
Êag
 & 
UCODE_STATISTICS_FREQUENCY_MSK
)

659 
p
 +
	`s˙¥ötf
(
buf
 +Ö, 
bufsz
 -Ö, "\tTGj Narrow Band: %s\n",

660 (
Êag
 & 
UCODE_STATISTICS_NARROW_BAND_MSK
)

663  
p
;

664 
	}
}

666 
ssize_t
 
	$iwl_dbgfs_ucode_rx_°©s_ªad
(
fûe
 *file,

667 
__u£r
 *
u£r_buf
,

668 
size_t
 
cou¡
, 
loff_t
 *
µos
)

670 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

671 
pos
 = 0;

672 *
buf
;

673 
bufsz
 = (
°©i°ics_rx_phy
) * 40 +

674 (
°©i°ics_rx_n⁄_phy
) * 40 +

675 (
°©i°ics_rx_ht_phy
) * 40 + 400;

676 
ssize_t
 
ªt
;

677 
°©i°ics_rx_phy
 *
ofdm
, *
accum_ofdm
, *
dñè_ofdm
, *
max_ofdm
;

678 
°©i°ics_rx_phy
 *
cck
, *
accum_cck
, *
dñè_cck
, *
max_cck
;

679 
°©i°ics_rx_n⁄_phy
 *
gíîÆ
, *
accum_gíîÆ
;

680 
°©i°ics_rx_n⁄_phy
 *
dñè_gíîÆ
, *
max_gíîÆ
;

681 
°©i°ics_rx_ht_phy
 *
ht
, *
accum_ht
, *
dñè_ht
, *
max_ht
;

683 i‡(!
	`iwl_is_Æive
(
¥iv
))

684  -
EAGAIN
;

686 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

687 i‡(!
buf
)

688  -
ENOMEM
;

695 
	`•ö_lock_bh
(&
¥iv
->
°©i°ics
.
lock
);

696 
ofdm
 = &
¥iv
->
°©i°ics
.
rx_ofdm
;

697 
cck
 = &
¥iv
->
°©i°ics
.
rx_cck
;

698 
gíîÆ
 = &
¥iv
->
°©i°ics
.
rx_n⁄_phy
;

699 
ht
 = &
¥iv
->
°©i°ics
.
rx_ofdm_ht
;

700 
accum_ofdm
 = &
¥iv
->
accum_°©s
.
rx_ofdm
;

701 
accum_cck
 = &
¥iv
->
accum_°©s
.
rx_cck
;

702 
accum_gíîÆ
 = &
¥iv
->
accum_°©s
.
rx_n⁄_phy
;

703 
accum_ht
 = &
¥iv
->
accum_°©s
.
rx_ofdm_ht
;

704 
dñè_ofdm
 = &
¥iv
->
dñè_°©s
.
rx_ofdm
;

705 
dñè_cck
 = &
¥iv
->
dñè_°©s
.
rx_cck
;

706 
dñè_gíîÆ
 = &
¥iv
->
dñè_°©s
.
rx_n⁄_phy
;

707 
dñè_ht
 = &
¥iv
->
dñè_°©s
.
rx_ofdm_ht
;

708 
max_ofdm
 = &
¥iv
->
max_dñè_°©s
.
rx_ofdm
;

709 
max_cck
 = &
¥iv
->
max_dñè_°©s
.
rx_cck
;

710 
max_gíîÆ
 = &
¥iv
->
max_dñè_°©s
.
rx_n⁄_phy
;

711 
max_ht
 = &
¥iv
->
max_dñè_°©s
.
rx_ofdm_ht
;

713 
pos
 +
	`iwl_°©i°ics_Êag
(
¥iv
, 
buf
, 
bufsz
);

714 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

715 
fmt_hódî
, "Statistics_Rx - OFDM:");

716 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

717 
fmt_èbÀ
, "ina_cnt:",

718 
	`À32_to_˝u
(
ofdm
->
öa_˙t
),

719 
accum_ofdm
->
öa_˙t
,

720 
dñè_ofdm
->
öa_˙t
, 
max_ofdm
->ina_cnt);

721 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

722 
fmt_èbÀ
, "fina_cnt:",

723 
	`À32_to_˝u
(
ofdm
->
föa_˙t
), 
accum_ofdm
->fina_cnt,

724 
dñè_ofdm
->
föa_˙t
, 
max_ofdm
->fina_cnt);

725 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

726 
fmt_èbÀ
, "plcp_err:",

727 
	`À32_to_˝u
(
ofdm
->
∂˝_îr
), 
accum_ofdm
->plcp_err,

728 
dñè_ofdm
->
∂˝_îr
, 
max_ofdm
->plcp_err);

729 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

730 
fmt_èbÀ
, "crc32_err:",

731 
	`À32_to_˝u
(
ofdm
->
¸c32_îr
), 
accum_ofdm
->crc32_err,

732 
dñè_ofdm
->
¸c32_îr
, 
max_ofdm
->crc32_err);

733 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

734 
fmt_èbÀ
, "overrun_err:",

735 
	`À32_to_˝u
(
ofdm
->
ovîrun_îr
),

736 
accum_ofdm
->
ovîrun_îr
, 
dñè_ofdm
->overrun_err,

737 
max_ofdm
->
ovîrun_îr
);

738 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

739 
fmt_èbÀ
, "early_overrun_err:",

740 
	`À32_to_˝u
(
ofdm
->
óæy_ovîrun_îr
),

741 
accum_ofdm
->
óæy_ovîrun_îr
,

742 
dñè_ofdm
->
óæy_ovîrun_îr
,

743 
max_ofdm
->
óæy_ovîrun_îr
);

744 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

745 
fmt_èbÀ
, "crc32_good:",

746 
	`À32_to_˝u
(
ofdm
->
¸c32_good
),

747 
accum_ofdm
->
¸c32_good
, 
dñè_ofdm
->crc32_good,

748 
max_ofdm
->
¸c32_good
);

749 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

750 
fmt_èbÀ
, "false_alarm_cnt:",

751 
	`À32_to_˝u
(
ofdm
->
Ál£_Æ¨m_˙t
),

752 
accum_ofdm
->
Ál£_Æ¨m_˙t
,

753 
dñè_ofdm
->
Ál£_Æ¨m_˙t
,

754 
max_ofdm
->
Ál£_Æ¨m_˙t
);

755 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

756 
fmt_èbÀ
, "fina_sync_err_cnt:",

757 
	`À32_to_˝u
(
ofdm
->
föa_sync_îr_˙t
),

758 
accum_ofdm
->
föa_sync_îr_˙t
,

759 
dñè_ofdm
->
föa_sync_îr_˙t
,

760 
max_ofdm
->
föa_sync_îr_˙t
);

761 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

762 
fmt_èbÀ
, "sfd_timeout:",

763 
	`À32_to_˝u
(
ofdm
->
sfd_timeout
),

764 
accum_ofdm
->
sfd_timeout
, 
dñè_ofdm
->sfd_timeout,

765 
max_ofdm
->
sfd_timeout
);

766 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

767 
fmt_èbÀ
, "fina_timeout:",

768 
	`À32_to_˝u
(
ofdm
->
föa_timeout
),

769 
accum_ofdm
->
föa_timeout
, 
dñè_ofdm
->fina_timeout,

770 
max_ofdm
->
föa_timeout
);

771 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

772 
fmt_èbÀ
, "unresponded_rts:",

773 
	`À32_to_˝u
(
ofdm
->
uƒe•⁄ded_πs
),

774 
accum_ofdm
->
uƒe•⁄ded_πs
,

775 
dñè_ofdm
->
uƒe•⁄ded_πs
,

776 
max_ofdm
->
uƒe•⁄ded_πs
);

777 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

778 
fmt_èbÀ
, "rxe_frame_lmt_ovrun:",

779 
	`À32_to_˝u
(
ofdm
->
rxe_‰ame_limô_ovîrun
),

780 
accum_ofdm
->
rxe_‰ame_limô_ovîrun
,

781 
dñè_ofdm
->
rxe_‰ame_limô_ovîrun
,

782 
max_ofdm
->
rxe_‰ame_limô_ovîrun
);

783 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

784 
fmt_èbÀ
, "sent_ack_cnt:",

785 
	`À32_to_˝u
(
ofdm
->
£¡_ack_˙t
),

786 
accum_ofdm
->
£¡_ack_˙t
, 
dñè_ofdm
->sent_ack_cnt,

787 
max_ofdm
->
£¡_ack_˙t
);

788 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

789 
fmt_èbÀ
, "sent_cts_cnt:",

790 
	`À32_to_˝u
(
ofdm
->
£¡_˘s_˙t
),

791 
accum_ofdm
->
£¡_˘s_˙t
, 
dñè_ofdm
->sent_cts_cnt,

792 
max_ofdm
->
£¡_˘s_˙t
);

793 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

794 
fmt_èbÀ
, "sent_ba_rsp_cnt:",

795 
	`À32_to_˝u
(
ofdm
->
£¡_ba_r•_˙t
),

796 
accum_ofdm
->
£¡_ba_r•_˙t
,

797 
dñè_ofdm
->
£¡_ba_r•_˙t
,

798 
max_ofdm
->
£¡_ba_r•_˙t
);

799 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

800 
fmt_èbÀ
, "dsp_self_kill:",

801 
	`À32_to_˝u
(
ofdm
->
d•_£lf_kûl
),

802 
accum_ofdm
->
d•_£lf_kûl
,

803 
dñè_ofdm
->
d•_£lf_kûl
,

804 
max_ofdm
->
d•_£lf_kûl
);

805 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

806 
fmt_èbÀ
, "mh_format_err:",

807 
	`À32_to_˝u
(
ofdm
->
mh_f‹m©_îr
),

808 
accum_ofdm
->
mh_f‹m©_îr
,

809 
dñè_ofdm
->
mh_f‹m©_îr
,

810 
max_ofdm
->
mh_f‹m©_îr
);

811 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

812 
fmt_èbÀ
, "re_acq_main_rssi_sum:",

813 
	`À32_to_˝u
(
ofdm
->
ª_acq_maö_rssi_sum
),

814 
accum_ofdm
->
ª_acq_maö_rssi_sum
,

815 
dñè_ofdm
->
ª_acq_maö_rssi_sum
,

816 
max_ofdm
->
ª_acq_maö_rssi_sum
);

818 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

819 
fmt_hódî
, "Statistics_Rx - CCK:");

820 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

821 
fmt_èbÀ
, "ina_cnt:",

822 
	`À32_to_˝u
(
cck
->
öa_˙t
), 
accum_cck
->ina_cnt,

823 
dñè_cck
->
öa_˙t
, 
max_cck
->ina_cnt);

824 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

825 
fmt_èbÀ
, "fina_cnt:",

826 
	`À32_to_˝u
(
cck
->
föa_˙t
), 
accum_cck
->fina_cnt,

827 
dñè_cck
->
föa_˙t
, 
max_cck
->fina_cnt);

828 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

829 
fmt_èbÀ
, "plcp_err:",

830 
	`À32_to_˝u
(
cck
->
∂˝_îr
), 
accum_cck
->plcp_err,

831 
dñè_cck
->
∂˝_îr
, 
max_cck
->plcp_err);

832 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

833 
fmt_èbÀ
, "crc32_err:",

834 
	`À32_to_˝u
(
cck
->
¸c32_îr
), 
accum_cck
->crc32_err,

835 
dñè_cck
->
¸c32_îr
, 
max_cck
->crc32_err);

836 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

837 
fmt_èbÀ
, "overrun_err:",

838 
	`À32_to_˝u
(
cck
->
ovîrun_îr
),

839 
accum_cck
->
ovîrun_îr
, 
dñè_cck
->overrun_err,

840 
max_cck
->
ovîrun_îr
);

841 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

842 
fmt_èbÀ
, "early_overrun_err:",

843 
	`À32_to_˝u
(
cck
->
óæy_ovîrun_îr
),

844 
accum_cck
->
óæy_ovîrun_îr
,

845 
dñè_cck
->
óæy_ovîrun_îr
,

846 
max_cck
->
óæy_ovîrun_îr
);

847 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

848 
fmt_èbÀ
, "crc32_good:",

849 
	`À32_to_˝u
(
cck
->
¸c32_good
), 
accum_cck
->crc32_good,

850 
dñè_cck
->
¸c32_good
, 
max_cck
->crc32_good);

851 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

852 
fmt_èbÀ
, "false_alarm_cnt:",

853 
	`À32_to_˝u
(
cck
->
Ál£_Æ¨m_˙t
),

854 
accum_cck
->
Ál£_Æ¨m_˙t
,

855 
dñè_cck
->
Ál£_Æ¨m_˙t
, 
max_cck
->false_alarm_cnt);

856 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

857 
fmt_èbÀ
, "fina_sync_err_cnt:",

858 
	`À32_to_˝u
(
cck
->
föa_sync_îr_˙t
),

859 
accum_cck
->
föa_sync_îr_˙t
,

860 
dñè_cck
->
föa_sync_îr_˙t
,

861 
max_cck
->
föa_sync_îr_˙t
);

862 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

863 
fmt_èbÀ
, "sfd_timeout:",

864 
	`À32_to_˝u
(
cck
->
sfd_timeout
),

865 
accum_cck
->
sfd_timeout
, 
dñè_cck
->sfd_timeout,

866 
max_cck
->
sfd_timeout
);

867 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

868 
fmt_èbÀ
, "fina_timeout:",

869 
	`À32_to_˝u
(
cck
->
föa_timeout
),

870 
accum_cck
->
föa_timeout
, 
dñè_cck
->fina_timeout,

871 
max_cck
->
föa_timeout
);

872 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

873 
fmt_èbÀ
, "unresponded_rts:",

874 
	`À32_to_˝u
(
cck
->
uƒe•⁄ded_πs
),

875 
accum_cck
->
uƒe•⁄ded_πs
, 
dñè_cck
->unresponded_rts,

876 
max_cck
->
uƒe•⁄ded_πs
);

877 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

878 
fmt_èbÀ
, "rxe_frame_lmt_ovrun:",

879 
	`À32_to_˝u
(
cck
->
rxe_‰ame_limô_ovîrun
),

880 
accum_cck
->
rxe_‰ame_limô_ovîrun
,

881 
dñè_cck
->
rxe_‰ame_limô_ovîrun
,

882 
max_cck
->
rxe_‰ame_limô_ovîrun
);

883 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

884 
fmt_èbÀ
, "sent_ack_cnt:",

885 
	`À32_to_˝u
(
cck
->
£¡_ack_˙t
),

886 
accum_cck
->
£¡_ack_˙t
, 
dñè_cck
->sent_ack_cnt,

887 
max_cck
->
£¡_ack_˙t
);

888 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

889 
fmt_èbÀ
, "sent_cts_cnt:",

890 
	`À32_to_˝u
(
cck
->
£¡_˘s_˙t
),

891 
accum_cck
->
£¡_˘s_˙t
, 
dñè_cck
->sent_cts_cnt,

892 
max_cck
->
£¡_˘s_˙t
);

893 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

894 
fmt_èbÀ
, "sent_ba_rsp_cnt:",

895 
	`À32_to_˝u
(
cck
->
£¡_ba_r•_˙t
),

896 
accum_cck
->
£¡_ba_r•_˙t
,

897 
dñè_cck
->
£¡_ba_r•_˙t
,

898 
max_cck
->
£¡_ba_r•_˙t
);

899 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

900 
fmt_èbÀ
, "dsp_self_kill:",

901 
	`À32_to_˝u
(
cck
->
d•_£lf_kûl
),

902 
accum_cck
->
d•_£lf_kûl
, 
dñè_cck
->dsp_self_kill,

903 
max_cck
->
d•_£lf_kûl
);

904 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

905 
fmt_èbÀ
, "mh_format_err:",

906 
	`À32_to_˝u
(
cck
->
mh_f‹m©_îr
),

907 
accum_cck
->
mh_f‹m©_îr
, 
dñè_cck
->mh_format_err,

908 
max_cck
->
mh_f‹m©_îr
);

909 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

910 
fmt_èbÀ
, "re_acq_main_rssi_sum:",

911 
	`À32_to_˝u
(
cck
->
ª_acq_maö_rssi_sum
),

912 
accum_cck
->
ª_acq_maö_rssi_sum
,

913 
dñè_cck
->
ª_acq_maö_rssi_sum
,

914 
max_cck
->
ª_acq_maö_rssi_sum
);

916 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

917 
fmt_hódî
, "Statistics_Rx - GENERAL:");

918 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

919 
fmt_èbÀ
, "bogus_cts:",

920 
	`À32_to_˝u
(
gíîÆ
->
bogus_˘s
),

921 
accum_gíîÆ
->
bogus_˘s
, 
dñè_gíîÆ
->bogus_cts,

922 
max_gíîÆ
->
bogus_˘s
);

923 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

924 
fmt_èbÀ
, "bogus_ack:",

925 
	`À32_to_˝u
(
gíîÆ
->
bogus_ack
),

926 
accum_gíîÆ
->
bogus_ack
, 
dñè_gíîÆ
->bogus_ack,

927 
max_gíîÆ
->
bogus_ack
);

928 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

929 
fmt_èbÀ
, "non_bssid_frames:",

930 
	`À32_to_˝u
(
gíîÆ
->
n⁄_bssid_‰ames
),

931 
accum_gíîÆ
->
n⁄_bssid_‰ames
,

932 
dñè_gíîÆ
->
n⁄_bssid_‰ames
,

933 
max_gíîÆ
->
n⁄_bssid_‰ames
);

934 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

935 
fmt_èbÀ
, "filtered_frames:",

936 
	`À32_to_˝u
(
gíîÆ
->
fûãªd_‰ames
),

937 
accum_gíîÆ
->
fûãªd_‰ames
,

938 
dñè_gíîÆ
->
fûãªd_‰ames
,

939 
max_gíîÆ
->
fûãªd_‰ames
);

940 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

941 
fmt_èbÀ
, "non_channel_beacons:",

942 
	`À32_to_˝u
(
gíîÆ
->
n⁄_ch™√l_bóc⁄s
),

943 
accum_gíîÆ
->
n⁄_ch™√l_bóc⁄s
,

944 
dñè_gíîÆ
->
n⁄_ch™√l_bóc⁄s
,

945 
max_gíîÆ
->
n⁄_ch™√l_bóc⁄s
);

946 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

947 
fmt_èbÀ
, "channel_beacons:",

948 
	`À32_to_˝u
(
gíîÆ
->
ch™√l_bóc⁄s
),

949 
accum_gíîÆ
->
ch™√l_bóc⁄s
,

950 
dñè_gíîÆ
->
ch™√l_bóc⁄s
,

951 
max_gíîÆ
->
ch™√l_bóc⁄s
);

952 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

953 
fmt_èbÀ
, "num_missed_bcon:",

954 
	`À32_to_˝u
(
gíîÆ
->
num_mis£d_bc⁄
),

955 
accum_gíîÆ
->
num_mis£d_bc⁄
,

956 
dñè_gíîÆ
->
num_mis£d_bc⁄
,

957 
max_gíîÆ
->
num_mis£d_bc⁄
);

958 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

959 
fmt_èbÀ
, "adc_rx_saturation_time:",

960 
	`À32_to_˝u
(
gíîÆ
->
adc_rx_ßtuøti⁄_time
),

961 
accum_gíîÆ
->
adc_rx_ßtuøti⁄_time
,

962 
dñè_gíîÆ
->
adc_rx_ßtuøti⁄_time
,

963 
max_gíîÆ
->
adc_rx_ßtuøti⁄_time
);

964 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

965 
fmt_èbÀ
, "ina_detect_search_tm:",

966 
	`À32_to_˝u
(
gíîÆ
->
öa_dëe˘i⁄_£¨ch_time
),

967 
accum_gíîÆ
->
öa_dëe˘i⁄_£¨ch_time
,

968 
dñè_gíîÆ
->
öa_dëe˘i⁄_£¨ch_time
,

969 
max_gíîÆ
->
öa_dëe˘i⁄_£¨ch_time
);

970 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

971 
fmt_èbÀ
, "beacon_silence_rssi_a:",

972 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_sûí˚_rssi_a
),

973 
accum_gíîÆ
->
bóc⁄_sûí˚_rssi_a
,

974 
dñè_gíîÆ
->
bóc⁄_sûí˚_rssi_a
,

975 
max_gíîÆ
->
bóc⁄_sûí˚_rssi_a
);

976 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

977 
fmt_èbÀ
, "beacon_silence_rssi_b:",

978 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_sûí˚_rssi_b
),

979 
accum_gíîÆ
->
bóc⁄_sûí˚_rssi_b
,

980 
dñè_gíîÆ
->
bóc⁄_sûí˚_rssi_b
,

981 
max_gíîÆ
->
bóc⁄_sûí˚_rssi_b
);

982 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

983 
fmt_èbÀ
, "beacon_silence_rssi_c:",

984 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_sûí˚_rssi_c
),

985 
accum_gíîÆ
->
bóc⁄_sûí˚_rssi_c
,

986 
dñè_gíîÆ
->
bóc⁄_sûí˚_rssi_c
,

987 
max_gíîÆ
->
bóc⁄_sûí˚_rssi_c
);

988 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

989 
fmt_èbÀ
, "interference_data_flag:",

990 
	`À32_to_˝u
(
gíîÆ
->
öãr„ªn˚_d©a_Êag
),

991 
accum_gíîÆ
->
öãr„ªn˚_d©a_Êag
,

992 
dñè_gíîÆ
->
öãr„ªn˚_d©a_Êag
,

993 
max_gíîÆ
->
öãr„ªn˚_d©a_Êag
);

994 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

995 
fmt_èbÀ
, "channel_load:",

996 
	`À32_to_˝u
(
gíîÆ
->
ch™√l_lﬂd
),

997 
accum_gíîÆ
->
ch™√l_lﬂd
,

998 
dñè_gíîÆ
->
ch™√l_lﬂd
,

999 
max_gíîÆ
->
ch™√l_lﬂd
);

1000 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1001 
fmt_èbÀ
, "dsp_false_alarms:",

1002 
	`À32_to_˝u
(
gíîÆ
->
d•_Ál£_Æ¨ms
),

1003 
accum_gíîÆ
->
d•_Ál£_Æ¨ms
,

1004 
dñè_gíîÆ
->
d•_Ál£_Æ¨ms
,

1005 
max_gíîÆ
->
d•_Ál£_Æ¨ms
);

1006 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1007 
fmt_èbÀ
, "beacon_rssi_a:",

1008 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_rssi_a
),

1009 
accum_gíîÆ
->
bóc⁄_rssi_a
,

1010 
dñè_gíîÆ
->
bóc⁄_rssi_a
,

1011 
max_gíîÆ
->
bóc⁄_rssi_a
);

1012 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1013 
fmt_èbÀ
, "beacon_rssi_b:",

1014 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_rssi_b
),

1015 
accum_gíîÆ
->
bóc⁄_rssi_b
,

1016 
dñè_gíîÆ
->
bóc⁄_rssi_b
,

1017 
max_gíîÆ
->
bóc⁄_rssi_b
);

1018 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1019 
fmt_èbÀ
, "beacon_rssi_c:",

1020 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_rssi_c
),

1021 
accum_gíîÆ
->
bóc⁄_rssi_c
,

1022 
dñè_gíîÆ
->
bóc⁄_rssi_c
,

1023 
max_gíîÆ
->
bóc⁄_rssi_c
);

1024 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1025 
fmt_èbÀ
, "beacon_energy_a:",

1026 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_íîgy_a
),

1027 
accum_gíîÆ
->
bóc⁄_íîgy_a
,

1028 
dñè_gíîÆ
->
bóc⁄_íîgy_a
,

1029 
max_gíîÆ
->
bóc⁄_íîgy_a
);

1030 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1031 
fmt_èbÀ
, "beacon_energy_b:",

1032 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_íîgy_b
),

1033 
accum_gíîÆ
->
bóc⁄_íîgy_b
,

1034 
dñè_gíîÆ
->
bóc⁄_íîgy_b
,

1035 
max_gíîÆ
->
bóc⁄_íîgy_b
);

1036 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1037 
fmt_èbÀ
, "beacon_energy_c:",

1038 
	`À32_to_˝u
(
gíîÆ
->
bóc⁄_íîgy_c
),

1039 
accum_gíîÆ
->
bóc⁄_íîgy_c
,

1040 
dñè_gíîÆ
->
bóc⁄_íîgy_c
,

1041 
max_gíîÆ
->
bóc⁄_íîgy_c
);

1043 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1044 
fmt_hódî
, "Statistics_Rx - OFDM_HT:");

1045 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1046 
fmt_èbÀ
, "plcp_err:",

1047 
	`À32_to_˝u
(
ht
->
∂˝_îr
), 
accum_ht
->plcp_err,

1048 
dñè_ht
->
∂˝_îr
, 
max_ht
->plcp_err);

1049 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1050 
fmt_èbÀ
, "overrun_err:",

1051 
	`À32_to_˝u
(
ht
->
ovîrun_îr
), 
accum_ht
->overrun_err,

1052 
dñè_ht
->
ovîrun_îr
, 
max_ht
->overrun_err);

1053 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1054 
fmt_èbÀ
, "early_overrun_err:",

1055 
	`À32_to_˝u
(
ht
->
óæy_ovîrun_îr
),

1056 
accum_ht
->
óæy_ovîrun_îr
,

1057 
dñè_ht
->
óæy_ovîrun_îr
,

1058 
max_ht
->
óæy_ovîrun_îr
);

1059 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1060 
fmt_èbÀ
, "crc32_good:",

1061 
	`À32_to_˝u
(
ht
->
¸c32_good
), 
accum_ht
->crc32_good,

1062 
dñè_ht
->
¸c32_good
, 
max_ht
->crc32_good);

1063 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1064 
fmt_èbÀ
, "crc32_err:",

1065 
	`À32_to_˝u
(
ht
->
¸c32_îr
), 
accum_ht
->crc32_err,

1066 
dñè_ht
->
¸c32_îr
, 
max_ht
->crc32_err);

1067 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1068 
fmt_èbÀ
, "mh_format_err:",

1069 
	`À32_to_˝u
(
ht
->
mh_f‹m©_îr
),

1070 
accum_ht
->
mh_f‹m©_îr
,

1071 
dñè_ht
->
mh_f‹m©_îr
, 
max_ht
->mh_format_err);

1072 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1073 
fmt_èbÀ
, "agg_crc32_good:",

1074 
	`À32_to_˝u
(
ht
->
agg_¸c32_good
),

1075 
accum_ht
->
agg_¸c32_good
,

1076 
dñè_ht
->
agg_¸c32_good
, 
max_ht
->agg_crc32_good);

1077 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1078 
fmt_èbÀ
, "agg_mpdu_cnt:",

1079 
	`À32_to_˝u
(
ht
->
agg_mpdu_˙t
),

1080 
accum_ht
->
agg_mpdu_˙t
,

1081 
dñè_ht
->
agg_mpdu_˙t
, 
max_ht
->agg_mpdu_cnt);

1082 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1083 
fmt_èbÀ
, "agg_cnt:",

1084 
	`À32_to_˝u
(
ht
->
agg_˙t
), 
accum_ht
->agg_cnt,

1085 
dñè_ht
->
agg_˙t
, 
max_ht
->agg_cnt);

1086 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1087 
fmt_èbÀ
, "unsupport_mcs:",

1088 
	`À32_to_˝u
(
ht
->
unsuµ‹t_mcs
),

1089 
accum_ht
->
unsuµ‹t_mcs
,

1090 
dñè_ht
->
unsuµ‹t_mcs
, 
max_ht
->unsupport_mcs);

1092 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1094 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1095 
	`k‰ì
(
buf
);

1096  
ªt
;

1097 
	}
}

1099 
ssize_t
 
	$iwl_dbgfs_ucode_tx_°©s_ªad
(
fûe
 *file,

1100 
__u£r
 *
u£r_buf
,

1101 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1103 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1104 
pos
 = 0;

1105 *
buf
;

1106 
bufsz
 = ((
°©i°ics_tx
) * 48) + 250;

1107 
ssize_t
 
ªt
;

1108 
°©i°ics_tx
 *
tx
, *
accum_tx
, *
dñè_tx
, *
max_tx
;

1110 i‡(!
	`iwl_is_Æive
(
¥iv
))

1111  -
EAGAIN
;

1113 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1114 i‡(!
buf
)

1115  -
ENOMEM
;

1121 
	`•ö_lock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1123 
tx
 = &
¥iv
->
°©i°ics
.tx;

1124 
accum_tx
 = &
¥iv
->
accum_°©s
.
tx
;

1125 
dñè_tx
 = &
¥iv
->
dñè_°©s
.
tx
;

1126 
max_tx
 = &
¥iv
->
max_dñè_°©s
.
tx
;

1128 
pos
 +
	`iwl_°©i°ics_Êag
(
¥iv
, 
buf
, 
bufsz
);

1129 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1130 
fmt_hódî
, "Statistics_Tx:");

1131 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1132 
fmt_èbÀ
, "preamble:",

1133 
	`À32_to_˝u
(
tx
->
¥ómbÀ_˙t
),

1134 
accum_tx
->
¥ómbÀ_˙t
,

1135 
dñè_tx
->
¥ómbÀ_˙t
, 
max_tx
->preamble_cnt);

1136 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1137 
fmt_èbÀ
, "rx_detected_cnt:",

1138 
	`À32_to_˝u
(
tx
->
rx_dëe˘ed_˙t
),

1139 
accum_tx
->
rx_dëe˘ed_˙t
,

1140 
dñè_tx
->
rx_dëe˘ed_˙t
, 
max_tx
->rx_detected_cnt);

1141 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1142 
fmt_èbÀ
, "bt_prio_defer_cnt:",

1143 
	`À32_to_˝u
(
tx
->
bt_¥io_de„r_˙t
),

1144 
accum_tx
->
bt_¥io_de„r_˙t
,

1145 
dñè_tx
->
bt_¥io_de„r_˙t
,

1146 
max_tx
->
bt_¥io_de„r_˙t
);

1147 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1148 
fmt_èbÀ
, "bt_prio_kill_cnt:",

1149 
	`À32_to_˝u
(
tx
->
bt_¥io_kûl_˙t
),

1150 
accum_tx
->
bt_¥io_kûl_˙t
,

1151 
dñè_tx
->
bt_¥io_kûl_˙t
,

1152 
max_tx
->
bt_¥io_kûl_˙t
);

1153 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1154 
fmt_èbÀ
, "few_bytes_cnt:",

1155 
	`À32_to_˝u
(
tx
->
„w_byãs_˙t
),

1156 
accum_tx
->
„w_byãs_˙t
,

1157 
dñè_tx
->
„w_byãs_˙t
, 
max_tx
->few_bytes_cnt);

1158 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1159 
fmt_èbÀ
, "cts_timeout:",

1160 
	`À32_to_˝u
(
tx
->
˘s_timeout
), 
accum_tx
->cts_timeout,

1161 
dñè_tx
->
˘s_timeout
, 
max_tx
->cts_timeout);

1162 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1163 
fmt_èbÀ
, "ack_timeout:",

1164 
	`À32_to_˝u
(
tx
->
ack_timeout
),

1165 
accum_tx
->
ack_timeout
,

1166 
dñè_tx
->
ack_timeout
, 
max_tx
->ack_timeout);

1167 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1168 
fmt_èbÀ
, "expected_ack_cnt:",

1169 
	`À32_to_˝u
(
tx
->
ex≥˘ed_ack_˙t
),

1170 
accum_tx
->
ex≥˘ed_ack_˙t
,

1171 
dñè_tx
->
ex≥˘ed_ack_˙t
,

1172 
max_tx
->
ex≥˘ed_ack_˙t
);

1173 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1174 
fmt_èbÀ
, "actual_ack_cnt:",

1175 
	`À32_to_˝u
(
tx
->
a˘uÆ_ack_˙t
),

1176 
accum_tx
->
a˘uÆ_ack_˙t
,

1177 
dñè_tx
->
a˘uÆ_ack_˙t
,

1178 
max_tx
->
a˘uÆ_ack_˙t
);

1179 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1180 
fmt_èbÀ
, "dump_msdu_cnt:",

1181 
	`À32_to_˝u
(
tx
->
dump_msdu_˙t
),

1182 
accum_tx
->
dump_msdu_˙t
,

1183 
dñè_tx
->
dump_msdu_˙t
,

1184 
max_tx
->
dump_msdu_˙t
);

1185 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1186 
fmt_èbÀ
, "abort_nxt_frame_mismatch:",

1187 
	`À32_to_˝u
(
tx
->
bur°_ab‹t_√xt_‰ame_mism©ch_˙t
),

1188 
accum_tx
->
bur°_ab‹t_√xt_‰ame_mism©ch_˙t
,

1189 
dñè_tx
->
bur°_ab‹t_√xt_‰ame_mism©ch_˙t
,

1190 
max_tx
->
bur°_ab‹t_√xt_‰ame_mism©ch_˙t
);

1191 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1192 
fmt_èbÀ
, "abort_missing_nxt_frame:",

1193 
	`À32_to_˝u
(
tx
->
bur°_ab‹t_missög_√xt_‰ame_˙t
),

1194 
accum_tx
->
bur°_ab‹t_missög_√xt_‰ame_˙t
,

1195 
dñè_tx
->
bur°_ab‹t_missög_√xt_‰ame_˙t
,

1196 
max_tx
->
bur°_ab‹t_missög_√xt_‰ame_˙t
);

1197 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1198 
fmt_èbÀ
, "cts_timeout_collision:",

1199 
	`À32_to_˝u
(
tx
->
˘s_timeout_cﬁlisi⁄
),

1200 
accum_tx
->
˘s_timeout_cﬁlisi⁄
,

1201 
dñè_tx
->
˘s_timeout_cﬁlisi⁄
,

1202 
max_tx
->
˘s_timeout_cﬁlisi⁄
);

1203 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1204 
fmt_èbÀ
, "ack_ba_timeout_collision:",

1205 
	`À32_to_˝u
(
tx
->
ack_‹_ba_timeout_cﬁlisi⁄
),

1206 
accum_tx
->
ack_‹_ba_timeout_cﬁlisi⁄
,

1207 
dñè_tx
->
ack_‹_ba_timeout_cﬁlisi⁄
,

1208 
max_tx
->
ack_‹_ba_timeout_cﬁlisi⁄
);

1209 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1210 
fmt_èbÀ
, "agg ba_timeout:",

1211 
	`À32_to_˝u
(
tx
->
agg
.
ba_timeout
),

1212 
accum_tx
->
agg
.
ba_timeout
,

1213 
dñè_tx
->
agg
.
ba_timeout
,

1214 
max_tx
->
agg
.
ba_timeout
);

1215 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1216 
fmt_èbÀ
, "agg ba_resched_frames:",

1217 
	`À32_to_˝u
(
tx
->
agg
.
ba_ªscheduÀ_‰ames
),

1218 
accum_tx
->
agg
.
ba_ªscheduÀ_‰ames
,

1219 
dñè_tx
->
agg
.
ba_ªscheduÀ_‰ames
,

1220 
max_tx
->
agg
.
ba_ªscheduÀ_‰ames
);

1221 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1222 
fmt_èbÀ
, "agg scd_query_agg_frame:",

1223 
	`À32_to_˝u
(
tx
->
agg
.
scd_quîy_agg_‰ame_˙t
),

1224 
accum_tx
->
agg
.
scd_quîy_agg_‰ame_˙t
,

1225 
dñè_tx
->
agg
.
scd_quîy_agg_‰ame_˙t
,

1226 
max_tx
->
agg
.
scd_quîy_agg_‰ame_˙t
);

1227 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1228 
fmt_èbÀ
, "agg scd_query_no_agg:",

1229 
	`À32_to_˝u
(
tx
->
agg
.
scd_quîy_no_agg
),

1230 
accum_tx
->
agg
.
scd_quîy_no_agg
,

1231 
dñè_tx
->
agg
.
scd_quîy_no_agg
,

1232 
max_tx
->
agg
.
scd_quîy_no_agg
);

1233 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1234 
fmt_èbÀ
, "agg scd_query_agg:",

1235 
	`À32_to_˝u
(
tx
->
agg
.
scd_quîy_agg
),

1236 
accum_tx
->
agg
.
scd_quîy_agg
,

1237 
dñè_tx
->
agg
.
scd_quîy_agg
,

1238 
max_tx
->
agg
.
scd_quîy_agg
);

1239 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1240 
fmt_èbÀ
, "agg scd_query_mismatch:",

1241 
	`À32_to_˝u
(
tx
->
agg
.
scd_quîy_mism©ch
),

1242 
accum_tx
->
agg
.
scd_quîy_mism©ch
,

1243 
dñè_tx
->
agg
.
scd_quîy_mism©ch
,

1244 
max_tx
->
agg
.
scd_quîy_mism©ch
);

1245 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1246 
fmt_èbÀ
, "agg frame_not_ready:",

1247 
	`À32_to_˝u
(
tx
->
agg
.
‰ame_nŸ_ªady
),

1248 
accum_tx
->
agg
.
‰ame_nŸ_ªady
,

1249 
dñè_tx
->
agg
.
‰ame_nŸ_ªady
,

1250 
max_tx
->
agg
.
‰ame_nŸ_ªady
);

1251 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1252 
fmt_èbÀ
, "agg underrun:",

1253 
	`À32_to_˝u
(
tx
->
agg
.
undîrun
),

1254 
accum_tx
->
agg
.
undîrun
,

1255 
dñè_tx
->
agg
.
undîrun
, 
max_tx
->agg.underrun);

1256 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1257 
fmt_èbÀ
, "agg bt_prio_kill:",

1258 
	`À32_to_˝u
(
tx
->
agg
.
bt_¥io_kûl
),

1259 
accum_tx
->
agg
.
bt_¥io_kûl
,

1260 
dñè_tx
->
agg
.
bt_¥io_kûl
,

1261 
max_tx
->
agg
.
bt_¥io_kûl
);

1262 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1263 
fmt_èbÀ
, "aggÑx_ba_rsp_cnt:",

1264 
	`À32_to_˝u
(
tx
->
agg
.
rx_ba_r•_˙t
),

1265 
accum_tx
->
agg
.
rx_ba_r•_˙t
,

1266 
dñè_tx
->
agg
.
rx_ba_r•_˙t
,

1267 
max_tx
->
agg
.
rx_ba_r•_˙t
);

1269 i‡(
tx
->
tx_powî
.
™t_a
 ||Åx->tx_powî.
™t_b
 ||Åx->tx_powî.
™t_c
) {

1270 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1272 i‡((
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
ANT_A
) &&

1273 
tx
->
tx_powî
.
™t_a
)

1274 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1275 
fmt_hex
, "antenna A:",

1276 
tx
->
tx_powî
.
™t_a
);

1277 i‡((
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
ANT_B
) &&

1278 
tx
->
tx_powî
.
™t_b
)

1279 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1280 
fmt_hex
, "antenna B:",

1281 
tx
->
tx_powî
.
™t_b
);

1282 i‡((
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
ANT_C
) &&

1283 
tx
->
tx_powî
.
™t_c
)

1284 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1285 
fmt_hex
, "antenna C:",

1286 
tx
->
tx_powî
.
™t_c
);

1289 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1291 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1292 
	`k‰ì
(
buf
);

1293  
ªt
;

1294 
	}
}

1296 
ssize_t
 
	$iwl_dbgfs_ucode_gíîÆ_°©s_ªad
(
fûe
 *file,

1297 
__u£r
 *
u£r_buf
,

1298 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1300 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1301 
pos
 = 0;

1302 *
buf
;

1303 
bufsz
 = (
°©i°ics_gíîÆ
) * 10 + 300;

1304 
ssize_t
 
ªt
;

1305 
°©i°ics_gíîÆ_comm⁄
 *
gíîÆ
, *
accum_gíîÆ
;

1306 
°©i°ics_gíîÆ_comm⁄
 *
dñè_gíîÆ
, *
max_gíîÆ
;

1307 
°©i°ics_dbg
 *
dbg
, *
accum_dbg
, *
dñè_dbg
, *
max_dbg
;

1308 
°©i°ics_div
 *
div
, *
accum_div
, *
dñè_div
, *
max_div
;

1310 i‡(!
	`iwl_is_Æive
(
¥iv
))

1311  -
EAGAIN
;

1313 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1314 i‡(!
buf
)

1315  -
ENOMEM
;

1322 
	`•ö_lock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1324 
gíîÆ
 = &
¥iv
->
°©i°ics
.
comm⁄
;

1325 
dbg
 = &
¥iv
->
°©i°ics
.
comm⁄
.dbg;

1326 
div
 = &
¥iv
->
°©i°ics
.
comm⁄
.div;

1327 
accum_gíîÆ
 = &
¥iv
->
accum_°©s
.
comm⁄
;

1328 
accum_dbg
 = &
¥iv
->
accum_°©s
.
comm⁄
.
dbg
;

1329 
accum_div
 = &
¥iv
->
accum_°©s
.
comm⁄
.
div
;

1330 
dñè_gíîÆ
 = &
¥iv
->
dñè_°©s
.
comm⁄
;

1331 
max_gíîÆ
 = &
¥iv
->
max_dñè_°©s
.
comm⁄
;

1332 
dñè_dbg
 = &
¥iv
->
dñè_°©s
.
comm⁄
.
dbg
;

1333 
max_dbg
 = &
¥iv
->
max_dñè_°©s
.
comm⁄
.
dbg
;

1334 
dñè_div
 = &
¥iv
->
dñè_°©s
.
comm⁄
.
div
;

1335 
max_div
 = &
¥iv
->
max_dñè_°©s
.
comm⁄
.
div
;

1337 
pos
 +
	`iwl_°©i°ics_Êag
(
¥iv
, 
buf
, 
bufsz
);

1338 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1339 
fmt_hódî
, "Statistics_General:");

1340 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1341 
fmt_vÆue
, "temperature:",

1342 
	`À32_to_˝u
(
gíîÆ
->
ãm≥øtuª
));

1343 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1344 
fmt_vÆue
, "temperature_m:",

1345 
	`À32_to_˝u
(
gíîÆ
->
ãm≥øtuª_m
));

1346 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1347 
fmt_vÆue
, "ttl_timestamp:",

1348 
	`À32_to_˝u
(
gíîÆ
->
âl_time°amp
));

1349 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1350 
fmt_èbÀ
, "burst_check:",

1351 
	`À32_to_˝u
(
dbg
->
bur°_check
),

1352 
accum_dbg
->
bur°_check
,

1353 
dñè_dbg
->
bur°_check
, 
max_dbg
->burst_check);

1354 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1355 
fmt_èbÀ
, "burst_count:",

1356 
	`À32_to_˝u
(
dbg
->
bur°_cou¡
),

1357 
accum_dbg
->
bur°_cou¡
,

1358 
dñè_dbg
->
bur°_cou¡
, 
max_dbg
->burst_count);

1359 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1360 
fmt_èbÀ
, "wait_for_silence_timeout_count:",

1361 
	`À32_to_˝u
(
dbg
->
waô_f‹_sûí˚_timeout_˙t
),

1362 
accum_dbg
->
waô_f‹_sûí˚_timeout_˙t
,

1363 
dñè_dbg
->
waô_f‹_sûí˚_timeout_˙t
,

1364 
max_dbg
->
waô_f‹_sûí˚_timeout_˙t
);

1365 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1366 
fmt_èbÀ
, "sleep_time:",

1367 
	`À32_to_˝u
(
gíîÆ
->
¶ìp_time
),

1368 
accum_gíîÆ
->
¶ìp_time
,

1369 
dñè_gíîÆ
->
¶ìp_time
, 
max_gíîÆ
->sleep_time);

1370 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1371 
fmt_èbÀ
, "slots_out:",

1372 
	`À32_to_˝u
(
gíîÆ
->
¶Ÿs_out
),

1373 
accum_gíîÆ
->
¶Ÿs_out
,

1374 
dñè_gíîÆ
->
¶Ÿs_out
, 
max_gíîÆ
->slots_out);

1375 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1376 
fmt_èbÀ
, "slots_idle:",

1377 
	`À32_to_˝u
(
gíîÆ
->
¶Ÿs_idÀ
),

1378 
accum_gíîÆ
->
¶Ÿs_idÀ
,

1379 
dñè_gíîÆ
->
¶Ÿs_idÀ
, 
max_gíîÆ
->slots_idle);

1380 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1381 
fmt_èbÀ
, "tx_on_a:",

1382 
	`À32_to_˝u
(
div
->
tx_⁄_a
), 
accum_div
->tx_on_a,

1383 
dñè_div
->
tx_⁄_a
, 
max_div
->tx_on_a);

1384 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1385 
fmt_èbÀ
, "tx_on_b:",

1386 
	`À32_to_˝u
(
div
->
tx_⁄_b
), 
accum_div
->tx_on_b,

1387 
dñè_div
->
tx_⁄_b
, 
max_div
->tx_on_b);

1388 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1389 
fmt_èbÀ
, "exec_time:",

1390 
	`À32_to_˝u
(
div
->
exec_time
), 
accum_div
->exec_time,

1391 
dñè_div
->
exec_time
, 
max_div
->exec_time);

1392 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1393 
fmt_èbÀ
, "probe_time:",

1394 
	`À32_to_˝u
(
div
->
¥obe_time
), 
accum_div
->probe_time,

1395 
dñè_div
->
¥obe_time
, 
max_div
->probe_time);

1396 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1397 
fmt_èbÀ
, "rx_enable_counter:",

1398 
	`À32_to_˝u
(
gíîÆ
->
rx_íabÀ_cou¡î
),

1399 
accum_gíîÆ
->
rx_íabÀ_cou¡î
,

1400 
dñè_gíîÆ
->
rx_íabÀ_cou¡î
,

1401 
max_gíîÆ
->
rx_íabÀ_cou¡î
);

1402 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1403 
fmt_èbÀ
, "num_of_sos_states:",

1404 
	`À32_to_˝u
(
gíîÆ
->
num_of_sos_°©es
),

1405 
accum_gíîÆ
->
num_of_sos_°©es
,

1406 
dñè_gíîÆ
->
num_of_sos_°©es
,

1407 
max_gíîÆ
->
num_of_sos_°©es
);

1409 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1411 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1412 
	`k‰ì
(
buf
);

1413  
ªt
;

1414 
	}
}

1416 
ssize_t
 
	$iwl_dbgfs_ucode_bt_°©s_ªad
(
fûe
 *file,

1417 
__u£r
 *
u£r_buf
,

1418 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1420 
iwl_¥iv
 *
¥iv
 = (iwl_¥iv *)
fûe
->
¥iv©e_d©a
;

1421 
pos
 = 0;

1422 *
buf
;

1423 
bufsz
 = ((
°©i°ics_bt_a˘ivôy
) * 24) + 200;

1424 
ssize_t
 
ªt
;

1425 
°©i°ics_bt_a˘ivôy
 *
bt
, *
accum_bt
;

1427 i‡(!
	`iwl_is_Æive
(
¥iv
))

1428  -
EAGAIN
;

1430 i‡(!
¥iv
->
bt_íabÀ_Êag
)

1431  -
EINVAL
;

1434 
	`muãx_lock
(&
¥iv
->
muãx
);

1435 
ªt
 = 
	`iwl_£nd_°©i°ics_ªque°
(
¥iv
, 0, 
Ál£
);

1436 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1438 i‡(
ªt
)

1439  -
EAGAIN
;

1440 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1441 i‡(!
buf
)

1442  -
ENOMEM
;

1450 
	`•ö_lock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1452 
bt
 = &
¥iv
->
°©i°ics
.
bt_a˘ivôy
;

1453 
accum_bt
 = &
¥iv
->
accum_°©s
.
bt_a˘ivôy
;

1455 
pos
 +
	`iwl_°©i°ics_Êag
(
¥iv
, 
buf
, 
bufsz
);

1456 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Statistics_BT:\n");

1457 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1459 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1461 
	`À32_to_˝u
(
bt
->
hi_¥i‹ôy_tx_ªq_˙t
),

1462 
accum_bt
->
hi_¥i‹ôy_tx_ªq_˙t
);

1463 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1465 
	`À32_to_˝u
(
bt
->
hi_¥i‹ôy_tx_díõd_˙t
),

1466 
accum_bt
->
hi_¥i‹ôy_tx_díõd_˙t
);

1467 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1469 
	`À32_to_˝u
(
bt
->
lo_¥i‹ôy_tx_ªq_˙t
),

1470 
accum_bt
->
lo_¥i‹ôy_tx_ªq_˙t
);

1471 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1473 
	`À32_to_˝u
(
bt
->
lo_¥i‹ôy_tx_díõd_˙t
),

1474 
accum_bt
->
lo_¥i‹ôy_tx_díõd_˙t
);

1475 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1477 
	`À32_to_˝u
(
bt
->
hi_¥i‹ôy_rx_ªq_˙t
),

1478 
accum_bt
->
hi_¥i‹ôy_rx_ªq_˙t
);

1479 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1481 
	`À32_to_˝u
(
bt
->
hi_¥i‹ôy_rx_díõd_˙t
),

1482 
accum_bt
->
hi_¥i‹ôy_rx_díõd_˙t
);

1483 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1485 
	`À32_to_˝u
(
bt
->
lo_¥i‹ôy_rx_ªq_˙t
),

1486 
accum_bt
->
lo_¥i‹ôy_rx_ªq_˙t
);

1487 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1489 
	`À32_to_˝u
(
bt
->
lo_¥i‹ôy_rx_díõd_˙t
),

1490 
accum_bt
->
lo_¥i‹ôy_rx_díõd_˙t
);

1492 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1494 
	`À32_to_˝u
(
¥iv
->
°©i°ics
.
num_bt_kûls
),

1495 
¥iv
->
°©i°ics
.
accum_num_bt_kûls
);

1497 
	`•ö_u∆ock_bh
(&
¥iv
->
°©i°ics
.
lock
);

1499 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1500 
	`k‰ì
(
buf
);

1501  
ªt
;

1502 
	}
}

1504 
ssize_t
 
	$iwl_dbgfs_ª∂y_tx_îr‹_ªad
(
fûe
 *file,

1505 
__u£r
 *
u£r_buf
,

1506 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1508 
iwl_¥iv
 *
¥iv
 = (iwl_¥iv *)
fûe
->
¥iv©e_d©a
;

1509 
pos
 = 0;

1510 *
buf
;

1511 
bufsz
 = ((
ª∂y_tx_îr‹_°©i°ics
) * 24) +

1512 ((
ª∂y_agg_tx_îr‹_°©i°ics
) * 24) + 200;

1513 
ssize_t
 
ªt
;

1515 i‡(!
	`iwl_is_Æive
(
¥iv
))

1516  -
EAGAIN
;

1518 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1519 i‡(!
buf
)

1520  -
ENOMEM
;

1522 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Statistics_TX_Error:\n");

1523 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t\t%u\n",

1524 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_POSTPONE_DELAY
),

1525 
¥iv
->
ª∂y_tx_°©s
.
µ_dñay
);

1526 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1527 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_POSTPONE_FEW_BYTES
),

1528 
¥iv
->
ª∂y_tx_°©s
.
µ_„w_byãs
);

1529 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1530 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_POSTPONE_BT_PRIO
),

1531 
¥iv
->
ª∂y_tx_°©s
.
µ_bt_¥io
);

1532 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1533 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_POSTPONE_QUIET_PERIOD
),

1534 
¥iv
->
ª∂y_tx_°©s
.
µ_quõt_≥riod
);

1535 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1536 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_POSTPONE_CALC_TTAK
),

1537 
¥iv
->
ª∂y_tx_°©s
.
µ_ˇlc_âak
);

1538 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1539 
	`iwl_gë_tx_Áû_ªas⁄
(

1540 
TX_STATUS_FAIL_INTERNAL_CROSSED_RETRY
),

1541 
¥iv
->
ª∂y_tx_°©s
.
öt_¸os£d_ªåy
);

1542 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1543 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_SHORT_LIMIT
),

1544 
¥iv
->
ª∂y_tx_°©s
.
sh‹t_limô
);

1545 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1546 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_LONG_LIMIT
),

1547 
¥iv
->
ª∂y_tx_°©s
.
l⁄g_limô
);

1548 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1549 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_FIFO_UNDERRUN
),

1550 
¥iv
->
ª∂y_tx_°©s
.
fifo_undîrun
);

1551 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1552 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_DRAIN_FLOW
),

1553 
¥iv
->
ª∂y_tx_°©s
.
døö_Êow
);

1554 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1555 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_RFKILL_FLUSH
),

1556 
¥iv
->
ª∂y_tx_°©s
.
rfkûl_Êush
);

1557 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1558 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_LIFE_EXPIRE
),

1559 
¥iv
->
ª∂y_tx_°©s
.
li„_expúe
);

1560 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1561 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_DEST_PS
),

1562 
¥iv
->
ª∂y_tx_°©s
.
de°_ps
);

1563 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1564 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_HOST_ABORTED
),

1565 
¥iv
->
ª∂y_tx_°©s
.
ho°_ab‹t
);

1566 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1567 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_BT_RETRY
),

1568 
¥iv
->
ª∂y_tx_°©s
.
µ_dñay
);

1569 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1570 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_STA_INVALID
),

1571 
¥iv
->
ª∂y_tx_°©s
.
°a_övÆid
);

1572 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1573 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_FRAG_DROPPED
),

1574 
¥iv
->
ª∂y_tx_°©s
.
‰ag_dr›
);

1575 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1576 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_TID_DISABLE
),

1577 
¥iv
->
ª∂y_tx_°©s
.
tid_dißbÀ
);

1578 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1579 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_FIFO_FLUSHED
),

1580 
¥iv
->
ª∂y_tx_°©s
.
fifo_Êush
);

1581 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1582 
	`iwl_gë_tx_Áû_ªas⁄
(

1583 
TX_STATUS_FAIL_INSUFFICIENT_CF_POLL
),

1584 
¥iv
->
ª∂y_tx_°©s
.
ösuff_cf_pﬁl
);

1585 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1586 
	`iwl_gë_tx_Áû_ªas⁄
(
TX_STATUS_FAIL_PASSIVE_NO_RX
),

1587 
¥iv
->
ª∂y_tx_°©s
.
Áû_hw_dr›
);

1588 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1589 
	`iwl_gë_tx_Áû_ªas⁄
(

1590 
TX_STATUS_FAIL_NO_BEACON_ON_RADAR
),

1591 
¥iv
->
ª∂y_tx_°©s
.
°a_cﬁ‹_mism©ch
);

1592 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "UNKNOWN:\t\t\t%u\n",

1593 
¥iv
->
ª∂y_tx_°©s
.
unknown
);

1595 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1598 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1599 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_UNDERRUN_MSK
),

1600 
¥iv
->
ª∂y_agg_tx_°©s
.
undîrun
);

1601 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1602 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_BT_PRIO_MSK
),

1603 
¥iv
->
ª∂y_agg_tx_°©s
.
bt_¥io
);

1604 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1605 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_FEW_BYTES_MSK
),

1606 
¥iv
->
ª∂y_agg_tx_°©s
.
„w_byãs
);

1607 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1608 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_ABORT_MSK
),

1609 
¥iv
->
ª∂y_agg_tx_°©s
.
ab‹t
);

1610 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1611 
	`iwl_gë_agg_tx_Áû_ªas⁄
(

1612 
AGG_TX_STATE_LAST_SENT_TTL_MSK
),

1613 
¥iv
->
ª∂y_agg_tx_°©s
.
œ°_£¡_âl
);

1614 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1615 
	`iwl_gë_agg_tx_Áû_ªas⁄
(

1616 
AGG_TX_STATE_LAST_SENT_TRY_CNT_MSK
),

1617 
¥iv
->
ª∂y_agg_tx_°©s
.
œ°_£¡_åy
);

1618 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1619 
	`iwl_gë_agg_tx_Áû_ªas⁄
(

1620 
AGG_TX_STATE_LAST_SENT_BT_KILL_MSK
),

1621 
¥iv
->
ª∂y_agg_tx_°©s
.
œ°_£¡_bt_kûl
);

1622 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1623 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_SCD_QUERY_MSK
),

1624 
¥iv
->
ª∂y_agg_tx_°©s
.
scd_quîy
);

1625 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t%u\n",

1626 
	`iwl_gë_agg_tx_Áû_ªas⁄
(

1627 
AGG_TX_STATE_TEST_BAD_CRC32_MSK
),

1628 
¥iv
->
ª∂y_agg_tx_°©s
.
bad_¸c32
);

1629 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1630 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_RESPONSE_MSK
),

1631 
¥iv
->
ª∂y_agg_tx_°©s
.
ª•⁄£
);

1632 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1633 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_DUMP_TX_MSK
),

1634 
¥iv
->
ª∂y_agg_tx_°©s
.
dump_tx
);

1635 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s:\t\t\t%u\n",

1636 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
AGG_TX_STATE_DELAY_TX_MSK
),

1637 
¥iv
->
ª∂y_agg_tx_°©s
.
dñay_tx
);

1638 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "UNKNOWN:\t\t\t%u\n",

1639 
¥iv
->
ª∂y_agg_tx_°©s
.
unknown
);

1641 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1642 
	`k‰ì
(
buf
);

1643  
ªt
;

1644 
	}
}

1646 
ssize_t
 
	$iwl_dbgfs_£nsôivôy_ªad
(
fûe
 *file,

1647 
__u£r
 *
u£r_buf
,

1648 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1650 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1651 
pos
 = 0;

1652 
˙t
 = 0;

1653 *
buf
;

1654 
bufsz
 = (
iwl_£nsôivôy_d©a
) * 4 + 100;

1655 
ssize_t
 
ªt
;

1656 
iwl_£nsôivôy_d©a
 *
d©a
;

1658 
d©a
 = &
¥iv
->
£nsôivôy_d©a
;

1659 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1660 i‡(!
buf
)

1661  -
ENOMEM
;

1663 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "auto_corr_ofdm:\t\t\t %u\n",

1664 
d©a
->
auto_c‹r_ofdm
);

1665 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1667 
d©a
->
auto_c‹r_ofdm_mrc
);

1668 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "auto_corr_ofdm_x1:\t\t %u\n",

1669 
d©a
->
auto_c‹r_ofdm_x1
);

1670 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1672 
d©a
->
auto_c‹r_ofdm_mrc_x1
);

1673 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "auto_corr_cck:\t\t\t %u\n",

1674 
d©a
->
auto_c‹r_cck
);

1675 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "auto_corr_cck_mrc:\t\t %u\n",

1676 
d©a
->
auto_c‹r_cck_mrc
);

1677 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1679 
d©a
->
œ°_bad_∂˝_˙t_ofdm
);

1680 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "last_fa_cnt_ofdm:\t\t %u\n",

1681 
d©a
->
œ°_Á_˙t_ofdm
);

1682 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1684 
d©a
->
œ°_bad_∂˝_˙t_cck
);

1685 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "last_fa_cnt_cck:\t\t %u\n",

1686 
d©a
->
œ°_Á_˙t_cck
);

1687 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_curr_state:\t\t\t %u\n",

1688 
d©a
->
ƒg_cuº_°©e
);

1689 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_prev_state:\t\t\t %u\n",

1690 
d©a
->
ƒg_¥ev_°©e
);

1691 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_value:\t\t\t");

1692 
˙t
 = 0; cnt < 10; cnt++) {

1693 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " %u",

1694 
d©a
->
ƒg_vÆue
[
˙t
]);

1696 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

1697 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_silence_rssi:\t\t");

1698 
˙t
 = 0; c¡ < 
NRG_NUM_PREV_STAT_L
; cnt++) {

1699 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " %u",

1700 
d©a
->
ƒg_sûí˚_rssi
[
˙t
]);

1702 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

1703 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_silence_ref:\t\t %u\n",

1704 
d©a
->
ƒg_sûí˚_ªf
);

1705 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_energy_idx:\t\t\t %u\n",

1706 
d©a
->
ƒg_íîgy_idx
);

1707 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_silence_idx:\t\t %u\n",

1708 
d©a
->
ƒg_sûí˚_idx
);

1709 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_th_cck:\t\t\t %u\n",

1710 
d©a
->
ƒg_th_cck
);

1711 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1713 
d©a
->
ƒg_auto_c‹r_sûí˚_diff
);

1714 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "num_in_cck_no_fa:\t\t %u\n",

1715 
d©a
->
num_ö_cck_no_Á
);

1716 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "nrg_th_ofdm:\t\t\t %u\n",

1717 
d©a
->
ƒg_th_ofdm
);

1719 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1720 
	`k‰ì
(
buf
);

1721  
ªt
;

1722 
	}
}

1725 
ssize_t
 
	$iwl_dbgfs_chaö_noi£_ªad
(
fûe
 *file,

1726 
__u£r
 *
u£r_buf
,

1727 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1729 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1730 
pos
 = 0;

1731 
˙t
 = 0;

1732 *
buf
;

1733 
bufsz
 = (
iwl_chaö_noi£_d©a
) * 4 + 100;

1734 
ssize_t
 
ªt
;

1735 
iwl_chaö_noi£_d©a
 *
d©a
;

1737 
d©a
 = &
¥iv
->
chaö_noi£_d©a
;

1738 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1739 i‡(!
buf
)

1740  -
ENOMEM
;

1742 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "active_chains:\t\t\t %u\n",

1743 
d©a
->
a˘ive_chaös
);

1744 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "chain_noise_a:\t\t\t %u\n",

1745 
d©a
->
chaö_noi£_a
);

1746 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "chain_noise_b:\t\t\t %u\n",

1747 
d©a
->
chaö_noi£_b
);

1748 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "chain_noise_c:\t\t\t %u\n",

1749 
d©a
->
chaö_noi£_c
);

1750 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "chain_signal_a:\t\t\t %u\n",

1751 
d©a
->
chaö_sig«l_a
);

1752 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "chain_signal_b:\t\t\t %u\n",

1753 
d©a
->
chaö_sig«l_b
);

1754 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "chain_signal_c:\t\t\t %u\n",

1755 
d©a
->
chaö_sig«l_c
);

1756 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "beacon_count:\t\t\t %u\n",

1757 
d©a
->
bóc⁄_cou¡
);

1759 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "disconn_array:\t\t\t");

1760 
˙t
 = 0; c¡ < 
NUM_RX_CHAINS
; cnt++) {

1761 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " %u",

1762 
d©a
->
disc⁄n_¨øy
[
˙t
]);

1764 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

1765 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "delta_gain_code:\t\t");

1766 
˙t
 = 0; c¡ < 
NUM_RX_CHAINS
; cnt++) {

1767 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " %u",

1768 
d©a
->
dñè_gaö_code
[
˙t
]);

1770 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\n");

1771 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "radio_write:\t\t\t %u\n",

1772 
d©a
->
ødio_wrôe
);

1773 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "state:\t\t\t\t %u\n",

1774 
d©a
->
°©e
);

1776 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1777 
	`k‰ì
(
buf
);

1778  
ªt
;

1779 
	}
}

1781 
ssize_t
 
	$iwl_dbgfs_powî_ßve_°©us_ªad
(
fûe
 *file,

1782 
__u£r
 *
u£r_buf
,

1783 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1785 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1786 
buf
[60];

1787 
pos
 = 0;

1788 c⁄° 
size_t
 
bufsz
 = (
buf
);

1789 
u32
 
pwrßve_°©us
;

1791 
pwrßve_°©us
 = 
	`iwl_ªad32
(
¥iv
->
å™s
, 
CSR_GP_CNTRL
) &

1792 
CSR_GP_REG_POWER_SAVE_STATUS_MSK
;

1794 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Power Save Status: ");

1795 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%s\n",

1796 (
pwrßve_°©us
 =
CSR_GP_REG_NO_POWER_SAVE
) ? "none" :

1797 (
pwrßve_°©us
 =
CSR_GP_REG_MAC_POWER_SAVE
) ? "MAC" :

1798 (
pwrßve_°©us
 =
CSR_GP_REG_PHY_POWER_SAVE
) ? "PHY" :

1801  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1802 
	}
}

1804 
ssize_t
 
	$iwl_dbgfs_˛ór_ucode_°©i°ics_wrôe
(
fûe
 *file,

1805 c⁄° 
__u£r
 *
u£r_buf
,

1806 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1808 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1809 
buf
[8];

1810 
buf_size
;

1811 
˛ór
;

1813 
	`mem£t
(
buf
, 0, (buf));

1814 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1815 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

1816  -
EFAULT
;

1817 i‡(
	`ssˇnf
(
buf
, "%d", &
˛ór
) != 1)

1818  -
EFAULT
;

1821 
	`muãx_lock
(&
¥iv
->
muãx
);

1822 
	`iwl_£nd_°©i°ics_ªque°
(
¥iv
, 0, 
åue
);

1823 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1825  
cou¡
;

1826 
	}
}

1828 
ssize_t
 
	$iwl_dbgfs_ucode_åacög_ªad
(
fûe
 *file,

1829 
__u£r
 *
u£r_buf
,

1830 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1832 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1833 
pos
 = 0;

1834 
buf
[128];

1835 c⁄° 
size_t
 
bufsz
 = (
buf
);

1837 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "ucodeÅraceÅimer is %s\n",

1838 
¥iv
->
evít_log
.
ucode_åa˚
 ? "On" : "Off");

1839 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "non_wraps_count:\t\t %u\n",

1840 
¥iv
->
evít_log
.
n⁄_wøps_cou¡
);

1841 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "wraps_once_count:\t\t %u\n",

1842 
¥iv
->
evít_log
.
wøps_⁄˚_cou¡
);

1843 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "wraps_more_count:\t\t %u\n",

1844 
¥iv
->
evít_log
.
wøps_m‹e_cou¡
);

1846  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1847 
	}
}

1849 
ssize_t
 
	$iwl_dbgfs_ucode_åacög_wrôe
(
fûe
 *file,

1850 c⁄° 
__u£r
 *
u£r_buf
,

1851 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1853 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1854 
buf
[8];

1855 
buf_size
;

1856 
åa˚
;

1858 
	`mem£t
(
buf
, 0, (buf));

1859 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1860 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

1861  -
EFAULT
;

1862 i‡(
	`ssˇnf
(
buf
, "%d", &
åa˚
) != 1)

1863  -
EFAULT
;

1865 i‡(
åa˚
) {

1866 
¥iv
->
evít_log
.
ucode_åa˚
 = 
åue
;

1867 i‡(
	`iwl_is_Æive
(
¥iv
)) {

1869 
	`mod_timî
(&
¥iv
->
ucode_åa˚
, 
jiffõs
);

1872 
¥iv
->
evít_log
.
ucode_åa˚
 = 
Ál£
;

1873 
	`dñ_timî_sync
(&
¥iv
->
ucode_åa˚
);

1876  
cou¡
;

1877 
	}
}

1879 
ssize_t
 
	$iwl_dbgfs_rx⁄_Êags_ªad
(
fûe
 *file,

1880 
__u£r
 *
u£r_buf
,

1881 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1883 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1884 
Àn
 = 0;

1885 
buf
[20];

1887 
Àn
 = 
	`•rötf
(
buf
, "0x%04X\n",

1888 
	`À32_to_˝u
(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
a˘ive
.
Êags
));

1889  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1890 
	}
}

1892 
ssize_t
 
	$iwl_dbgfs_rx⁄_fûãr_Êags_ªad
(
fûe
 *file,

1893 
__u£r
 *
u£r_buf
,

1894 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1896 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1897 
Àn
 = 0;

1898 
buf
[20];

1900 
Àn
 = 
	`•rötf
(
buf
, "0x%04X\n",

1901 
	`À32_to_˝u
(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
a˘ive
.
fûãr_Êags
));

1902  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1903 
	}
}

1905 
ssize_t
 
	$iwl_dbgfs_mis£d_bóc⁄_ªad
(
fûe
 *file,

1906 
__u£r
 *
u£r_buf
,

1907 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1909 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1910 
pos
 = 0;

1911 
buf
[12];

1912 c⁄° 
size_t
 
bufsz
 = (
buf
);

1914 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%d\n",

1915 
¥iv
->
mis£d_bóc⁄_thªshﬁd
);

1917  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1918 
	}
}

1920 
ssize_t
 
	$iwl_dbgfs_mis£d_bóc⁄_wrôe
(
fûe
 *file,

1921 c⁄° 
__u£r
 *
u£r_buf
,

1922 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1924 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1925 
buf
[8];

1926 
buf_size
;

1927 
mis£d
;

1929 
	`mem£t
(
buf
, 0, (buf));

1930 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1931 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

1932  -
EFAULT
;

1933 i‡(
	`ssˇnf
(
buf
, "%d", &
mis£d
) != 1)

1934  -
EINVAL
;

1936 i‡(
mis£d
 < 
IWL_MISSED_BEACON_THRESHOLD_MIN
 ||

1937 
mis£d
 > 
IWL_MISSED_BEACON_THRESHOLD_MAX
)

1938 
¥iv
->
mis£d_bóc⁄_thªshﬁd
 =

1939 
IWL_MISSED_BEACON_THRESHOLD_DEF
;

1941 
¥iv
->
mis£d_bóc⁄_thªshﬁd
 = 
mis£d
;

1943  
cou¡
;

1944 
	}
}

1946 
ssize_t
 
	$iwl_dbgfs_∂˝_dñè_ªad
(
fûe
 *file,

1947 
__u£r
 *
u£r_buf
,

1948 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1950 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1951 
pos
 = 0;

1952 
buf
[12];

1953 c⁄° 
size_t
 
bufsz
 = (
buf
);

1955 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%u\n",

1956 
¥iv
->
∂˝_dñè_thªshﬁd
);

1958  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1959 
	}
}

1961 
ssize_t
 
	$iwl_dbgfs_∂˝_dñè_wrôe
(
fûe
 *file,

1962 c⁄° 
__u£r
 *
u£r_buf
,

1963 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

1965 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1966 
buf
[8];

1967 
buf_size
;

1968 
∂˝
;

1970 
	`mem£t
(
buf
, 0, (buf));

1971 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1972 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

1973  -
EFAULT
;

1974 i‡(
	`ssˇnf
(
buf
, "%d", &
∂˝
) != 1)

1975  -
EINVAL
;

1976 i‡((
∂˝
 < 
IWL_MAX_PLCP_ERR_THRESHOLD_MIN
) ||

1977 (
∂˝
 > 
IWL_MAX_PLCP_ERR_THRESHOLD_MAX
))

1978 
¥iv
->
∂˝_dñè_thªshﬁd
 =

1979 
IWL_MAX_PLCP_ERR_THRESHOLD_DISABLE
;

1981 
¥iv
->
∂˝_dñè_thªshﬁd
 = 
∂˝
;

1982  
cou¡
;

1983 
	}
}

1985 
ssize_t
 
	$iwl_dbgfs_rf_ª£t_ªad
(
fûe
 *file,

1986 
__u£r
 *
u£r_buf
,

1987 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1989 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

1990 
pos
 = 0;

1991 
buf
[300];

1992 c⁄° 
size_t
 
bufsz
 = (
buf
);

1993 
iwl_rf_ª£t
 *
rf_ª£t
 = &
¥iv
->rf_reset;

1995 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1997 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

1999 
rf_ª£t
->
ª£t_ªque°_cou¡
);

2000 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2002 
rf_ª£t
->
ª£t_suc˚ss_cou¡
);

2003 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2005 
rf_ª£t
->
ª£t_ªje˘_cou¡
);

2007  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2008 
	}
}

2010 
ssize_t
 
	$iwl_dbgfs_rf_ª£t_wrôe
(
fûe
 *file,

2011 c⁄° 
__u£r
 *
u£r_buf
,

2012 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

2014 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2015 
ªt
;

2017 
ªt
 = 
	`iwl_f‹˚_rf_ª£t
(
¥iv
, 
åue
);

2018  
ªt
 ?Ñë : 
cou¡
;

2019 
	}
}

2021 
ssize_t
 
	$iwl_dbgfs_txfifo_Êush_wrôe
(
fûe
 *file,

2022 c⁄° 
__u£r
 *
u£r_buf
,

2023 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

2025 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2026 
buf
[8];

2027 
buf_size
;

2028 
Êush
;

2030 
	`mem£t
(
buf
, 0, (buf));

2031 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2032 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

2033  -
EFAULT
;

2034 i‡(
	`ssˇnf
(
buf
, "%d", &
Êush
) != 1)

2035  -
EINVAL
;

2037 i‡(
	`iwl_is_rfkûl
(
¥iv
))

2038  -
EFAULT
;

2040 
	`iwœgn_dev_txfifo_Êush
(
¥iv
);

2042  
cou¡
;

2043 
	}
}

2045 
ssize_t
 
	$iwl_dbgfs_bt_åaffic_ªad
(
fûe
 *file,

2046 
__u£r
 *
u£r_buf
,

2047 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

2049 
iwl_¥iv
 *
¥iv
 = (iwl_¥iv *)
fûe
->
¥iv©e_d©a
;

2050 
pos
 = 0;

2051 
buf
[200];

2052 c⁄° 
size_t
 
bufsz
 = (
buf
);

2054 i‡(!
¥iv
->
bt_íabÀ_Êag
) {

2055 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "BT coex disabled\n");

2056  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2058 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "BTÉnable flag: 0x%x\n",

2059 
¥iv
->
bt_íabÀ_Êag
);

2060 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "BT in %s mode\n",

2061 
¥iv
->
bt_fuŒ_c⁄cuºít
 ? "full concurrency" : "3-wire");

2062 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "BT status: %s, "

2064 
¥iv
->
bt_°©us
 ? "On" : "Off",Öriv->
œ°_bt_åaffic_lﬂd
);

2065 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "ch_announcement: %d, "

2067 
¥iv
->
bt_ch_™noun˚
,Öriv->
kûl_ack_mask
,

2068 
¥iv
->
kûl_˘s_mask
);

2070 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "bluetoothÅrafficÜoad: ");

2071 
¥iv
->
bt_åaffic_lﬂd
) {

2072 
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
:

2073 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Continuous\n");

2075 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
:

2076 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "High\n");

2078 
IWL_BT_COEX_TRAFFIC_LOAD_LOW
:

2079 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Low\n");

2081 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
:

2083 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "None\n");

2087  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2088 
	}
}

2090 
ssize_t
 
	$iwl_dbgfs_¥Ÿe˘i⁄_mode_ªad
(
fûe
 *file,

2091 
__u£r
 *
u£r_buf
,

2092 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2094 
iwl_¥iv
 *
¥iv
 = (iwl_¥iv *)
fûe
->
¥iv©e_d©a
;

2096 
pos
 = 0;

2097 
buf
[40];

2098 c⁄° 
size_t
 
bufsz
 = (
buf
);

2100 i‡(
¥iv
->
cfg
->
ht_∑øms
)

2101 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2103 (
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
) ?

2106 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "N/A");

2108  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2109 
	}
}

2111 
ssize_t
 
	$iwl_dbgfs_¥Ÿe˘i⁄_mode_wrôe
(
fûe
 *file,

2112 c⁄° 
__u£r
 *
u£r_buf
,

2113 
size_t
 
cou¡
, 
loff_t
 *
µos
) {

2115 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2116 
buf
[8];

2117 
buf_size
;

2118 
πs
;

2120 i‡(!
¥iv
->
cfg
->
ht_∑øms
)

2121  -
EINVAL
;

2123 
	`mem£t
(
buf
, 0, (buf));

2124 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2125 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

2126  -
EFAULT
;

2127 i‡(
	`ssˇnf
(
buf
, "%d", &
πs
) != 1)

2128  -
EINVAL
;

2129 i‡(
πs
)

2130 
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
 = 
åue
;

2132 
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
 = 
Ál£
;

2133  
cou¡
;

2134 
	}
}

2136 
	$iwl_cmd_echo_ã°
(
iwl_¥iv
 *
¥iv
)

2138 
ªt
;

2139 
iwl_ho°_cmd
 
cmd
 = {

2140 .
id
 = 
REPLY_ECHO
,

2141 .
Àn
 = { 0 },

2144 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

2145 i‡(
ªt
)

2146 
	`IWL_ERR
(
¥iv
, "echÿã°ög faû: 0X%x\n", 
ªt
);

2148 
	`IWL_DEBUG_INFO
(
¥iv
, "echoÅestingÖass\n");

2149  
ªt
;

2150 
	}
}

2152 
ssize_t
 
	$iwl_dbgfs_echo_ã°_wrôe
(
fûe
 *file,

2153 c⁄° 
__u£r
 *
u£r_buf
,

2154 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2156 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2157 
buf
[8];

2158 
buf_size
;

2160 
	`mem£t
(
buf
, 0, (buf));

2161 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2162 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

2163  -
EFAULT
;

2165 
	`iwl_cmd_echo_ã°
(
¥iv
);

2166  
cou¡
;

2167 
	}
}

2169 #ifde‡
CONFIG_IWLWIFI_DEBUG


2170 
ssize_t
 
	$iwl_dbgfs_log_evít_ªad
(
fûe
 *file,

2171 
__u£r
 *
u£r_buf
,

2172 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2174 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2175 *
buf
 = 
NULL
;

2176 
ssize_t
 
ªt
;

2178 
ªt
 = 
	`iwl_dump_nic_evít_log
(
¥iv
, 
åue
, &
buf
);

2179 i‡(
ªt
 > 0)

2180 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
,Ñet);

2181 
	`k‰ì
(
buf
);

2182  
ªt
;

2183 
	}
}

2185 
ssize_t
 
	$iwl_dbgfs_log_evít_wrôe
(
fûe
 *file,

2186 c⁄° 
__u£r
 *
u£r_buf
,

2187 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2189 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2190 
u32
 
evít_log_Êag
;

2191 
buf
[8];

2192 
buf_size
;

2195 i‡(!
	`iwl_is_ªady
(
¥iv
))

2196  -
EAGAIN
;

2198 
	`mem£t
(
buf
, 0, (buf));

2199 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2200 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

2201  -
EFAULT
;

2202 i‡(
	`ssˇnf
(
buf
, "%u", &
evít_log_Êag
) != 1)

2203  -
EFAULT
;

2204 i‡(
evít_log_Êag
 == 1)

2205 
	`iwl_dump_nic_evít_log
(
¥iv
, 
åue
, 
NULL
);

2207  
cou¡
;

2208 
	}
}

2211 
ssize_t
 
	$iwl_dbgfs_ˇlib_dißbÀd_ªad
(
fûe
 *file,

2212 
__u£r
 *
u£r_buf
,

2213 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2215 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2216 
buf
[120];

2217 
pos
 = 0;

2218 c⁄° 
size_t
 
bufsz
 = (
buf
);

2220 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2222 (
¥iv
->
ˇlib_dißbÀd
 &

2223 
IWL_SENSITIVITY_CALIB_DISABLED
) ?

2225 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2227 (
¥iv
->
ˇlib_dißbÀd
 &

2228 
IWL_CHAIN_NOISE_CALIB_DISABLED
) ?

2230 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2232 (
¥iv
->
ˇlib_dißbÀd
 &

2233 
IWL_TX_POWER_CALIB_DISABLED
) ?

2236  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2237 
	}
}

2239 
ssize_t
 
	$iwl_dbgfs_ˇlib_dißbÀd_wrôe
(
fûe
 *file,

2240 c⁄° 
__u£r
 *
u£r_buf
,

2241 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2243 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2244 
buf
[8];

2245 
u32
 
ˇlib_dißbÀd
;

2246 
buf_size
;

2248 
	`mem£t
(
buf
, 0, (buf));

2249 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2250 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

2251  -
EFAULT
;

2252 i‡(
	`ssˇnf
(
buf
, "%x", &
ˇlib_dißbÀd
) != 1)

2253  -
EFAULT
;

2255 
¥iv
->
ˇlib_dißbÀd
 = calib_disabled;

2257  
cou¡
;

2258 
	}
}

2260 
ssize_t
 
	$iwl_dbgfs_fw_ª°¨t_wrôe
(
fûe
 *file,

2261 c⁄° 
__u£r
 *
u£r_buf
,

2262 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2264 
iwl_¥iv
 *
¥iv
 = 
fûe
->
¥iv©e_d©a
;

2265 
boﬁ
 
fw_ª°¨t
 = 
iwlwifi_mod_∑øms
.fw_restart;

2266 
__maybe_unu£d
 
ªt
;

2268 
iwlwifi_mod_∑øms
.
fw_ª°¨t
 = 
åue
;

2270 
	`muãx_lock
(&
¥iv
->
muãx
);

2273 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_ERROR
, 0, 0, 
NULL
);

2275 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

2277 
iwlwifi_mod_∑øms
.
fw_ª°¨t
 = fw_restart;

2279  
cou¡
;

2280 
	}
}

2282 
DEBUGFS_READ_FILE_OPS
(
ucode_rx_°©s
);

2283 
DEBUGFS_READ_FILE_OPS
(
ucode_tx_°©s
);

2284 
DEBUGFS_READ_FILE_OPS
(
ucode_gíîÆ_°©s
);

2285 
DEBUGFS_READ_FILE_OPS
(
£nsôivôy
);

2286 
DEBUGFS_READ_FILE_OPS
(
chaö_noi£
);

2287 
DEBUGFS_READ_FILE_OPS
(
powî_ßve_°©us
);

2288 
DEBUGFS_WRITE_FILE_OPS
(
˛ór_ucode_°©i°ics
);

2289 
DEBUGFS_READ_WRITE_FILE_OPS
(
ucode_åacög
);

2290 
DEBUGFS_READ_WRITE_FILE_OPS
(
mis£d_bóc⁄
);

2291 
DEBUGFS_READ_WRITE_FILE_OPS
(
∂˝_dñè
);

2292 
DEBUGFS_READ_WRITE_FILE_OPS
(
rf_ª£t
);

2293 
DEBUGFS_READ_FILE_OPS
(
rx⁄_Êags
);

2294 
DEBUGFS_READ_FILE_OPS
(
rx⁄_fûãr_Êags
);

2295 
DEBUGFS_WRITE_FILE_OPS
(
txfifo_Êush
);

2296 
DEBUGFS_READ_FILE_OPS
(
ucode_bt_°©s
);

2297 
DEBUGFS_READ_FILE_OPS
(
bt_åaffic
);

2298 
DEBUGFS_READ_WRITE_FILE_OPS
(
¥Ÿe˘i⁄_mode
);

2299 
DEBUGFS_READ_FILE_OPS
(
ª∂y_tx_îr‹
);

2300 
DEBUGFS_WRITE_FILE_OPS
(
echo_ã°
);

2301 
DEBUGFS_WRITE_FILE_OPS
(
fw_ª°¨t
);

2302 #ifde‡
CONFIG_IWLWIFI_DEBUG


2303 
DEBUGFS_READ_WRITE_FILE_OPS
(
log_evít
);

2305 
DEBUGFS_READ_WRITE_FILE_OPS
(
ˇlib_dißbÀd
);

2311 
	$iwl_dbgfs_ªgi°î
(
iwl_¥iv
 *
¥iv
, 
díåy
 *
dbgfs_dú
)

2313 
díåy
 *
dú_d©a
, *
dú_rf
, *
dú_debug
;

2315 
¥iv
->
debugfs_dú
 = 
dbgfs_dú
;

2317 
dú_d©a
 = 
	`debugfs_¸óã_dú
("d©a", 
dbgfs_dú
);

2318 
dú_rf
 = 
	`debugfs_¸óã_dú
("rf", 
dbgfs_dú
);

2319 
dú_debug
 = 
	`debugfs_¸óã_dú
("debug", 
dbgfs_dú
);

2321 
	`DEBUGFS_ADD_FILE
(
nvm
, 
dú_d©a
, 0400);

2322 
	`DEBUGFS_ADD_FILE
(
§am
, 
dú_d©a
, 0600);

2323 
	`DEBUGFS_ADD_FILE
(
wowœn_§am
, 
dú_d©a
, 0400);

2324 
	`DEBUGFS_ADD_FILE
(
°©i⁄s
, 
dú_d©a
, 0400);

2325 
	`DEBUGFS_ADD_FILE
(
ch™√ls
, 
dú_d©a
, 0400);

2326 
	`DEBUGFS_ADD_FILE
(
°©us
, 
dú_d©a
, 0400);

2327 
	`DEBUGFS_ADD_FILE
(
rx_h™dÀrs
, 
dú_d©a
, 0600);

2328 
	`DEBUGFS_ADD_FILE
(
qos
, 
dú_d©a
, 0400);

2329 
	`DEBUGFS_ADD_FILE
(
¶ìp_Àvñ_ovîride
, 
dú_d©a
, 0600);

2330 
	`DEBUGFS_ADD_FILE
(
cuºít_¶ìp_comm™d
, 
dú_d©a
, 0400);

2331 
	`DEBUGFS_ADD_FILE
(
thîmÆ_thrŸéög
, 
dú_d©a
, 0400);

2332 
	`DEBUGFS_ADD_FILE
(
dißbÀ_ht40
, 
dú_d©a
, 0600);

2333 
	`DEBUGFS_ADD_FILE
(
ãm≥øtuª
, 
dú_d©a
, 0400);

2335 
	`DEBUGFS_ADD_FILE
(
powî_ßve_°©us
, 
dú_debug
, 0400);

2336 
	`DEBUGFS_ADD_FILE
(
˛ór_ucode_°©i°ics
, 
dú_debug
, 0200);

2337 
	`DEBUGFS_ADD_FILE
(
mis£d_bóc⁄
, 
dú_debug
, 0200);

2338 
	`DEBUGFS_ADD_FILE
(
∂˝_dñè
, 
dú_debug
, 0600);

2339 
	`DEBUGFS_ADD_FILE
(
rf_ª£t
, 
dú_debug
, 0600);

2340 
	`DEBUGFS_ADD_FILE
(
ucode_rx_°©s
, 
dú_debug
, 0400);

2341 
	`DEBUGFS_ADD_FILE
(
ucode_tx_°©s
, 
dú_debug
, 0400);

2342 
	`DEBUGFS_ADD_FILE
(
ucode_gíîÆ_°©s
, 
dú_debug
, 0400);

2343 
	`DEBUGFS_ADD_FILE
(
txfifo_Êush
, 
dú_debug
, 0200);

2344 
	`DEBUGFS_ADD_FILE
(
¥Ÿe˘i⁄_mode
, 
dú_debug
, 0600);

2345 
	`DEBUGFS_ADD_FILE
(
£nsôivôy
, 
dú_debug
, 0400);

2346 
	`DEBUGFS_ADD_FILE
(
chaö_noi£
, 
dú_debug
, 0400);

2347 
	`DEBUGFS_ADD_FILE
(
ucode_åacög
, 
dú_debug
, 0600);

2348 
	`DEBUGFS_ADD_FILE
(
ucode_bt_°©s
, 
dú_debug
, 0400);

2349 
	`DEBUGFS_ADD_FILE
(
ª∂y_tx_îr‹
, 
dú_debug
, 0400);

2350 
	`DEBUGFS_ADD_FILE
(
rx⁄_Êags
, 
dú_debug
, 0200);

2351 
	`DEBUGFS_ADD_FILE
(
rx⁄_fûãr_Êags
, 
dú_debug
, 0200);

2352 
	`DEBUGFS_ADD_FILE
(
echo_ã°
, 
dú_debug
, 0200);

2353 
	`DEBUGFS_ADD_FILE
(
fw_ª°¨t
, 
dú_debug
, 0200);

2354 #ifde‡
CONFIG_IWLWIFI_DEBUG


2355 
	`DEBUGFS_ADD_FILE
(
log_evít
, 
dú_debug
, 0600);

2358 i‡(
	`iwl_adv™˚d_bt_c€xi°
(
¥iv
))

2359 
	`DEBUGFS_ADD_FILE
(
bt_åaffic
, 
dú_debug
, 0400);

2362 
	`DEBUGFS_ADD_FILE
(
ˇlib_dißbÀd
, 
dú_rf
, 0600);

2370 i‡(
¥iv
->
mac80211_ªgi°îed
) {

2371 
buf
[100];

2372 
díåy
 *
mac80211_dú
, *
dev_dú
;

2374 
dev_dú
 = 
dbgfs_dú
->
d_∑ª¡
;

2375 
mac80211_dú
 = 
¥iv
->
hw
->
wùhy
->
debugfsdú
;

2377 
	`¢¥ötf
(
buf
, 100, "../../%pd2", 
dev_dú
);

2379 
	`debugfs_¸óã_symlök
("iwlwifi", 
mac80211_dú
, 
buf
);

2381 
	}
}

	@dvm/dev.h

11 #i‚de‡
__iwl_dev_h__


12 
	#__iwl_dev_h__


	)

14 
	~<löux/öãºu±.h
>

15 
	~<löux/kî√l.h
>

16 
	~<löux/waô.h
>

17 
	~<löux/Àds.h
>

18 
	~<löux/¶ab.h
>

19 
	~<löux/muãx.h
>

21 
	~"fw/img.h
"

22 
	~"iwl-ì¥om-∑r£.h
"

23 
	~"iwl-c§.h
"

24 
	~"iwl-debug.h
"

25 
	~"iwl-agn-hw.h
"

26 
	~"iwl-›-mode.h
"

27 
	~"fw/nŸif-waô.h
"

28 
	~"iwl-å™s.h
"

30 
	~"Àd.h
"

31 
	~"powî.h
"

32 
	~"rs.h
"

33 
	~"â.h
"

36 
	#CT_KILL_THRESHOLD_LEGACY
 110

	)

37 
	#CT_KILL_THRESHOLD
 114

	)

38 
	#CT_KILL_EXIT_THRESHOLD
 95

	)

50 
	#IWL_NOISE_MEAS_NOT_AVAILABLE
 (-127)

	)

60 
	#DEFAULT_RTS_THRESHOLD
 2347U

	)

61 
	#MIN_RTS_THRESHOLD
 0U

	)

62 
	#MAX_RTS_THRESHOLD
 2347U

	)

63 
	#MAX_MSDU_SIZE
 2304U

	)

64 
	#MAX_MPDU_SIZE
 2346U

	)

65 
	#DEFAULT_BEACON_INTERVAL
 200U

	)

66 
	#DEFAULT_SHORT_RETRY_LIMIT
 7U

	)

67 
	#DEFAULT_LONG_RETRY_LIMIT
 4U

	)

69 
	#IWL_NUM_SCAN_RATES
 (2)

	)

72 
	#IEEE80211_DATA_LEN
 2304

	)

73 
	#IEEE80211_4ADDR_LEN
 30

	)

74 
	#IEEE80211_HLEN
 (
IEEE80211_4ADDR_LEN
)

	)

75 
	#IEEE80211_FRAME_LEN
 (
IEEE80211_DATA_LEN
 + 
IEEE80211_HLEN
)

	)

77 
	#SUP_RATE_11A_MAX_NUM_CHANNELS
 8

	)

78 
	#SUP_RATE_11B_MAX_NUM_CHANNELS
 4

	)

79 
	#SUP_RATE_11G_MAX_NUM_CHANNELS
 12

	)

81 
	#IWL_SUPPORTED_RATES_IE_LEN
 8

	)

83 
	#IWL_INVALID_RATE
 0xFF

	)

84 
	#IWL_INVALID_VALUE
 -1

	)

86 
	uiwl_ht_øã_suµ
 {

87 
u16
 
	møãs
;

89 
u8
 
	msiso_øã
;

90 
u8
 
	mmimo_øã
;

94 
	siwl_ht_c⁄fig
 {

95 
boﬁ
 
	msögÀ_chaö_sufficõ¡
;

96 
õì80211_smps_mode
 
	msmps
;

100 
	siwl_qos_öfo
 {

101 
	mqos_a˘ive
;

102 
iwl_qo•¨am_cmd
 
	mdef_qos_∑rm
;

119 
	eiwl_agg_°©e
 {

120 
	mIWL_AGG_OFF
 = 0,

121 
	mIWL_AGG_STARTING
,

122 
	mIWL_AGG_ON
,

123 
	mIWL_EMPTYING_HW_QUEUE_ADDBA
,

124 
	mIWL_EMPTYING_HW_QUEUE_DELBA
,

145 
	siwl_ht_agg
 {

146 
u32
 
	møã_n_Êags
;

147 
iwl_agg_°©e
 
	m°©e
;

148 
u16
 
	mtxq_id
;

149 
u16
 
	ms¢
;

150 
boﬁ
 
	mwaô_f‹_ba
;

163 
	siwl_tid_d©a
 {

164 
u16
 
	m£q_numbî
;

165 
u16
 
	m√xt_ª˛aimed
;

166 
iwl_ht_agg
 
	magg
;

175 
	siwl_°©i⁄_íåy
 {

176 
iwl_add°a_cmd
 
	m°a
;

177 
u8
 
	mu£d
, 
	m˘xid
;

178 
iwl_lök_quÆôy_cmd
 *
	mlq
;

188 
	siwl_°©i⁄_¥iv
 {

189 
iwl_rx⁄_c⁄ãxt
 *
	m˘x
;

190 
iwl_lq_°a
 
	mlq_°a
;

191 
©omic_t
 
	m≥ndög_‰ames
;

192 
boﬁ
 
	m˛õ¡
;

193 
boﬁ
 
	ma¶ìp
;

194 
u8
 
	mmax_agg_bufsize
;

195 
u8
 
	m°a_id
;

204 
	siwl_vif_¥iv
 {

205 
iwl_rx⁄_c⁄ãxt
 *
	m˘x
;

206 
u8
 
	mibss_bssid_°a_id
;

209 
	siwl_£nsôivôy_ønges
 {

210 
u16
 
	mmö_ƒg_cck
;

212 
u16
 
	mƒg_th_cck
;

213 
u16
 
	mƒg_th_ofdm
;

215 
u16
 
	mauto_c‹r_mö_ofdm
;

216 
u16
 
	mauto_c‹r_mö_ofdm_mrc
;

217 
u16
 
	mauto_c‹r_mö_ofdm_x1
;

218 
u16
 
	mauto_c‹r_mö_ofdm_mrc_x1
;

220 
u16
 
	mauto_c‹r_max_ofdm
;

221 
u16
 
	mauto_c‹r_max_ofdm_mrc
;

222 
u16
 
	mauto_c‹r_max_ofdm_x1
;

223 
u16
 
	mauto_c‹r_max_ofdm_mrc_x1
;

225 
u16
 
	mauto_c‹r_max_cck
;

226 
u16
 
	mauto_c‹r_max_cck_mrc
;

227 
u16
 
	mauto_c‹r_mö_cck
;

228 
u16
 
	mauto_c‹r_mö_cck_mrc
;

230 
u16
 
	mb¨kî_c‹r_th_mö
;

231 
u16
 
	mb¨kî_c‹r_th_mö_mrc
;

232 
u16
 
	mƒg_th_cˇ
;

248 
iwl_upd©e_chaö_Êags
(
iwl_¥iv
 *
¥iv
);

249 c⁄° 
u8
 
iwl_bˇ°_addr
[
ETH_ALEN
];

251 
	#IWL_OPERATION_MODE_AUTO
 0

	)

252 
	#IWL_OPERATION_MODE_HT_ONLY
 1

	)

253 
	#IWL_OPERATION_MODE_MIXED
 2

	)

254 
	#IWL_OPERATION_MODE_20MHZ
 3

	)

256 
	#TX_POWER_IWL_ILLEGAL_VOLTAGE
 -10000

	)

259 
	#INITIALIZATION_VALUE
 0xFFFF

	)

260 
	#IWL_CAL_NUM_BEACONS
 16

	)

261 
	#MAXIMUM_ALLOWED_PATHLOSS
 15

	)

263 
	#CHAIN_NOISE_MAX_DELTA_GAIN_CODE
 3

	)

265 
	#MAX_FA_OFDM
 50

	)

266 
	#MIN_FA_OFDM
 5

	)

267 
	#MAX_FA_CCK
 50

	)

268 
	#MIN_FA_CCK
 5

	)

270 
	#AUTO_CORR_STEP_OFDM
 1

	)

272 
	#AUTO_CORR_STEP_CCK
 3

	)

273 
	#AUTO_CORR_MAX_TH_CCK
 160

	)

275 
	#NRG_DIFF
 2

	)

276 
	#NRG_STEP_CCK
 2

	)

277 
	#NRG_MARGIN
 8

	)

278 
	#MAX_NUMBER_CCK_NO_FA
 100

	)

280 
	#AUTO_CORR_CCK_MIN_VAL_DEF
 (125)

	)

282 
	#CHAIN_A
 0

	)

283 
	#CHAIN_B
 1

	)

284 
	#CHAIN_C
 2

	)

285 
	#CHAIN_NOISE_DELTA_GAIN_INIT_VAL
 4

	)

286 
	#ALL_BAND_FILTER
 0xFF00

	)

287 
	#IN_BAND_FILTER
 0xFF

	)

288 
	#MIN_AVERAGE_NOISE_MAX_VALUE
 0xFFFFFFFF

	)

290 
	#NRG_NUM_PREV_STAT_L
 20

	)

291 
	#NUM_RX_CHAINS
 3

	)

293 
	eiwœgn_Ál£_Æ¨m_°©e
 {

294 
	mIWL_FA_TOO_MANY
 = 0,

295 
	mIWL_FA_TOO_FEW
 = 1,

296 
	mIWL_FA_GOOD_RANGE
 = 2,

299 
	eiwœgn_chaö_noi£_°©e
 {

300 
	mIWL_CHAIN_NOISE_ALIVE
 = 0,

301 
	mIWL_CHAIN_NOISE_ACCUMULATE
,

302 
	mIWL_CHAIN_NOISE_CALIBRATED
,

303 
	mIWL_CHAIN_NOISE_DONE
,

307 
	siwl_£nsôivôy_d©a
 {

308 
u32
 
	mauto_c‹r_ofdm
;

309 
u32
 
	mauto_c‹r_ofdm_mrc
;

310 
u32
 
	mauto_c‹r_ofdm_x1
;

311 
u32
 
	mauto_c‹r_ofdm_mrc_x1
;

312 
u32
 
	mauto_c‹r_cck
;

313 
u32
 
	mauto_c‹r_cck_mrc
;

315 
u32
 
	mœ°_bad_∂˝_˙t_ofdm
;

316 
u32
 
	mœ°_Á_˙t_ofdm
;

317 
u32
 
	mœ°_bad_∂˝_˙t_cck
;

318 
u32
 
	mœ°_Á_˙t_cck
;

320 
u32
 
	mƒg_cuº_°©e
;

321 
u32
 
	mƒg_¥ev_°©e
;

322 
u32
 
	mƒg_vÆue
[10];

323 
u8
 
	mƒg_sûí˚_rssi
[
NRG_NUM_PREV_STAT_L
];

324 
u32
 
	mƒg_sûí˚_ªf
;

325 
u32
 
	mƒg_íîgy_idx
;

326 
u32
 
	mƒg_sûí˚_idx
;

327 
u32
 
	mƒg_th_cck
;

328 
s32
 
	mƒg_auto_c‹r_sûí˚_diff
;

329 
u32
 
	mnum_ö_cck_no_Á
;

330 
u32
 
	mƒg_th_ofdm
;

332 
u16
 
	mb¨kî_c‹r_th_mö
;

333 
u16
 
	mb¨kî_c‹r_th_mö_mrc
;

334 
u16
 
	mƒg_th_cˇ
;

338 
	siwl_chaö_noi£_d©a
 {

339 
u32
 
	ma˘ive_chaös
;

340 
u32
 
	mchaö_noi£_a
;

341 
u32
 
	mchaö_noi£_b
;

342 
u32
 
	mchaö_noi£_c
;

343 
u32
 
	mchaö_sig«l_a
;

344 
u32
 
	mchaö_sig«l_b
;

345 
u32
 
	mchaö_sig«l_c
;

346 
u16
 
	mbóc⁄_cou¡
;

347 
u8
 
	mdisc⁄n_¨øy
[
NUM_RX_CHAINS
];

348 
u8
 
	mdñè_gaö_code
[
NUM_RX_CHAINS
];

349 
u8
 
	mødio_wrôe
;

350 
u8
 
	m°©e
;

354 
	mMEASUREMENT_READY
 = (1 << 0),

355 
	mMEASUREMENT_ACTIVE
 = (1 << 1),

359 
	sª∂y_tx_îr‹_°©i°ics
 {

360 
u32
 
	mµ_dñay
;

361 
u32
 
	mµ_„w_byãs
;

362 
u32
 
	mµ_bt_¥io
;

363 
u32
 
	mµ_quõt_≥riod
;

364 
u32
 
	mµ_ˇlc_âak
;

365 
u32
 
	möt_¸os£d_ªåy
;

366 
u32
 
	msh‹t_limô
;

367 
u32
 
	ml⁄g_limô
;

368 
u32
 
	mfifo_undîrun
;

369 
u32
 
	mdøö_Êow
;

370 
u32
 
	mrfkûl_Êush
;

371 
u32
 
	mli„_expúe
;

372 
u32
 
	mde°_ps
;

373 
u32
 
	mho°_ab‹t
;

374 
u32
 
	mbt_ªåy
;

375 
u32
 
	m°a_övÆid
;

376 
u32
 
	m‰ag_dr›
;

377 
u32
 
	mtid_dißbÀ
;

378 
u32
 
	mfifo_Êush
;

379 
u32
 
	mösuff_cf_pﬁl
;

380 
u32
 
	mÁû_hw_dr›
;

381 
u32
 
	m°a_cﬁ‹_mism©ch
;

382 
u32
 
	munknown
;

386 
	sª∂y_agg_tx_îr‹_°©i°ics
 {

387 
u32
 
	mundîrun
;

388 
u32
 
	mbt_¥io
;

389 
u32
 
	m„w_byãs
;

390 
u32
 
	mab‹t
;

391 
u32
 
	mœ°_£¡_âl
;

392 
u32
 
	mœ°_£¡_åy
;

393 
u32
 
	mœ°_£¡_bt_kûl
;

394 
u32
 
	mscd_quîy
;

395 
u32
 
	mbad_¸c32
;

396 
u32
 
	mª•⁄£
;

397 
u32
 
	mdump_tx
;

398 
u32
 
	mdñay_tx
;

399 
u32
 
	munknown
;

406 
	#UCODE_TRACE_PERIOD
 (10)

	)

419 
	siwl_evít_log
 {

420 
boﬁ
 
	mucode_åa˚
;

421 
u32
 
	mnum_wøps
;

422 
u32
 
	m√xt_íåy
;

423 
	mn⁄_wøps_cou¡
;

424 
	mwøps_⁄˚_cou¡
;

425 
	mwøps_m‹e_cou¡
;

428 
	#IWL_DELAY_NEXT_FORCE_RF_RESET
 (
HZ
*3)

	)

431 
	#IWL_BT_ANTENNA_COUPLING_THRESHOLD
 (35)

	)

434 
	#IWL_MIN_RELOAD_DURATION
 1000

	)

435 
	#IWL_MAX_CONTINUE_RELOAD_CNT
 4

	)

438 
	siwl_rf_ª£t
 {

439 
	mª£t_ªque°_cou¡
;

440 
	mª£t_suc˚ss_cou¡
;

441 
	mª£t_ªje˘_cou¡
;

442 
	mœ°_ª£t_jiffõs
;

445 
	eiwl_rx⁄_c⁄ãxt_id
 {

446 
	mIWL_RXON_CTX_BSS
,

447 
	mIWL_RXON_CTX_PAN
,

449 
	mNUM_IWL_RXON_CTX


458 
	#IWLAGN_EXT_BEACON_TIME_POS
 22

	)

460 
	siwl_rx⁄_c⁄ãxt
 {

461 
õì80211_vif
 *
	mvif
;

463 
u8
 
	mmˇ°_queue
;

464 
u8
 
	mac_to_queue
[
IEEE80211_NUM_ACS
];

465 
u8
 
	mac_to_fifo
[
IEEE80211_NUM_ACS
];

472 
boﬁ
 
	mÆways_a˘ive
, 
	mis_a˘ive
;

474 
boﬁ
 
	mht_√ed_mu…ùÀ_chaös
;

476 
iwl_rx⁄_c⁄ãxt_id
 
	m˘xid
;

478 
u32
 
	möãrÁ˚_modes
, 
	mex˛usive_öãrÁ˚_modes
;

479 
u8
 
	munu£d_devty≥
, 
	m≠_devty≥
, 
	mibss_devty≥
, 
	m°©i⁄_devty≥
;

487 c⁄° 
iwl_rx⁄_cmd
 
	ma˘ive
;

488 
iwl_rx⁄_cmd
 
	m°agög
;

490 
iwl_rx⁄_time_cmd
 
	mtimög
;

492 
iwl_qos_öfo
 
	mqos_d©a
;

494 
u8
 
	mbˇ°_°a_id
, 
	m≠_°a_id
;

496 
u8
 
	mrx⁄_cmd
, 
	mrx⁄_assoc_cmd
, 
	mrx⁄_timög_cmd
;

497 
u8
 
	mqos_cmd
;

498 
u8
 
	mwï_key_cmd
;

500 
iwl_wï_key
 
	mwï_keys
[
WEP_KEYS_MAX
];

501 
u8
 
	mkey_m≠pög_keys
;

503 
__À32
 
	m°©i⁄_Êags
;

505 
	mbóc⁄_öt
;

508 
boﬁ
 
	mn⁄_gf_°a_¥e£¡
;

509 
u8
 
	m¥Ÿe˘i⁄
;

510 
boﬁ
 
	míabÀd
, 
	mis_40mhz
;

511 
u8
 
	mexãnsi⁄_ch™_off£t
;

512 } 
	mht
;

515 
	eiwl_sˇn_ty≥
 {

516 
	mIWL_SCAN_NORMAL
,

517 
	mIWL_SCAN_RADIO_RESET
,

534 
	siwl_hw_∑øms
 {

535 
u8
 
	mtx_chaös_num
;

536 
u8
 
	mrx_chaös_num
;

537 
boﬁ
 
	mu£_πs_f‹_aggªg©i⁄
;

538 
u32
 
	m˘_kûl_thªshﬁd
;

539 
u32
 
	m˘_kûl_exô_thªshﬁd
;

541 c⁄° 
iwl_£nsôivôy_ønges
 *
	m£ns
;

553 
	siwl_dvm_bt_∑øms
 {

554 
boﬁ
 
	madv™˚d_bt_c€xi°
;

555 
u8
 
	mbt_öô_åaffic_lﬂd
;

556 
u32
 
	mbt_¥io_boo°
;

557 
u16
 
	magg_time_limô
;

558 
boﬁ
 
	mbt_sco_dißbÀ
;

559 
boﬁ
 
	mbt_£ssi⁄_2
;

582 
	siwl_dvm_cfg
 {

583 (*
	m£t_hw_∑øms
)(
iwl_¥iv
 *
	m¥iv
);

584 (*
	m£t_ch™√l_swôch
)(
iwl_¥iv
 *
	m¥iv
,

585 
õì80211_ch™√l_swôch
 *
	mch_swôch
);

586 (*
	mnic_c⁄fig
)(
iwl_¥iv
 *
	m¥iv
);

587 (*
	mãm≥øtuª
)(
iwl_¥iv
 *
	m¥iv
);

589 c⁄° 
iwl_dvm_bt_∑øms
 *
	mbt_∑øms
;

590 
s32
 
	mchaö_noi£_sˇÀ
;

591 
u8
 
	m∂˝_dñè_thªshﬁd
;

592 
boﬁ
 
	madv_thîmÆ_thrŸée
;

593 
boﬁ
 
	msuµ‹t_˘_kûl_exô
;

594 
boﬁ
 
	mhd_v2
;

595 
boﬁ
 
	mno_idÀ_suµ‹t
;

596 
boﬁ
 
	m√ed_ãmp_off£t_ˇlib
;

597 
boﬁ
 
	mno_xèl_ˇlib
;

598 
boﬁ
 
	mãmp_off£t_v2
;

599 
boﬁ
 
	madv_pm
;

602 
	siwl_wù™_nﬂ_d©a
 {

603 
rcu_hód
 
	mrcu_hód
;

604 
u32
 
	mÀngth
;

605 
u8
 
	md©a
[];

610 
	mIWL_CALIB_ENABLE_ALL
 = 0,

612 
	mIWL_SENSITIVITY_CALIB_DISABLED
 = 
BIT
(0),

613 
	mIWL_CHAIN_NOISE_CALIB_DISABLED
 = 
BIT
(1),

614 
	mIWL_TX_POWER_CALIB_DISABLED
 = 
BIT
(2),

616 
	mIWL_CALIB_DISABLE_ALL
 = 0xFFFFFFFF,

619 
	#IWL_OP_MODE_GET_DVM
(
_iwl_›_mode
) \

620 ((
iwl_¥iv
 *Ë((
_iwl_›_mode
)->
›_mode_•ecific
))

	)

622 
	#IWL_MAC80211_GET_DVM
(
_hw
) \

623 ((
iwl_¥iv
 *Ë((
iwl_›_mode
 *) \

624 (
_hw
)->
¥iv
)->
›_mode_•ecific
)

	)

626 
	siwl_¥iv
 {

628 
iwl_å™s
 *
	må™s
;

629 
devi˚
 *
	mdev
;

630 c⁄° 
iwl_cfg
 *
	mcfg
;

631 c⁄° 
iwl_fw
 *
	mfw
;

632 c⁄° 
iwl_dvm_cfg
 *
	mlib
;

633 
	m°©us
;

635 
•ölock_t
 
	m°a_lock
;

636 
muãx
 
	mmuãx
;

638 
	må™•‹t_queue_°›
;

639 
boﬁ
 
	m∑ssive_no_rx
;

640 
	#IWL_INVALID_MAC80211_QUEUE
 0xff

	)

641 
u8
 
	mqueue_to_mac80211
[
IWL_MAX_HW_QUEUES
];

642 
©omic_t
 
	mqueue_°›_cou¡
[
IWL_MAX_HW_QUEUES
];

644 
	magg_q_Æloc
[
BITS_TO_LONGS
(
IWL_MAX_HW_QUEUES
)];

647 
õì80211_hw
 *
	mhw
;

649 
«pi_°ru˘
 *
	m«pi
;

651 
li°_hód
 
	mˇlib_ªsu…s
;

653 
w‹kqueue_°ru˘
 *
	mw‹kqueue
;

655 
iwl_hw_∑øms
 
	mhw_∑øms
;

657 
∆80211_b™d
 
	mb™d
;

658 
u8
 
	mvÆid_c⁄ãxts
;

660 (*
	mrx_h™dÀrs
[
REPLY_MAX
])(
iwl_¥iv
 *
	m¥iv
,

661 
iwl_rx_cmd_buf„r
 *
	mrxb
);

663 
iwl_nŸif_waô_d©a
 
	mnŸif_waô
;

666 
iwl_•e˘rum_nŸifiˇti⁄
 
	mmósuª_ªp‹t
;

667 
u8
 
	mmósuªmít_°©us
;

670 
u32
 
	mucode_bóc⁄_time
;

671 
	mmis£d_bóc⁄_thªshﬁd
;

674 
u32
 
	mibss_m™agî
;

677 
	mrx_°©i°ics_jiffõs
;

680 
u32
 
	mrx_h™dÀrs_°©s
[
REPLY_MAX
];

683 
iwl_rf_ª£t
 
	mrf_ª£t
;

686 
	mªlﬂd_jiffõs
;

687 
	mªlﬂd_cou¡
;

688 
boﬁ
 
	mucode_lﬂded
;

690 
u8
 
	m∂˝_dñè_thªshﬁd
;

693 
s32
 
	mãm≥øtuª
;

694 
s32
 
	mœ°_ãm≥øtuª
;

696 
iwl_wù™_nﬂ_d©a
 
__rcu
 *
	mnﬂ_d©a
;

699 
	msˇn_°¨t
;

700 
	msˇn_°¨t_tsf
;

701 
size_t
 
	msˇn_cmd_size
;

702 *
	msˇn_cmd
;

703 
∆80211_b™d
 
	msˇn_b™d
;

704 
cfg80211_sˇn_ªque°
 *
	msˇn_ªque°
;

705 
õì80211_vif
 *
	msˇn_vif
;

706 
iwl_sˇn_ty≥
 
	msˇn_ty≥
;

707 
u8
 
	msˇn_tx_™t
[
NUM_NL80211_BANDS
];

708 
u8
 
	mmgmt_tx_™t
;

711 
u8
 
	m°a_key_max_num
;

713 
boﬁ
 
	m√w_sˇn_thªshﬁd_behaviour
;

715 
boﬁ
 
	mwowœn
;

718 
mac_addªss
 
	maddªs£s
[2];

720 
iwl_rx⁄_c⁄ãxt
 
	mc⁄ãxts
[
NUM_IWL_RXON_CTX
];

722 
__À16
 
	mswôch_ch™√l
;

724 
u8
 
	m°¨t_ˇlib
;

725 
iwl_£nsôivôy_d©a
 
	m£nsôivôy_d©a
;

726 
iwl_chaö_noi£_d©a
 
	mchaö_noi£_d©a
;

727 
__À16
 
	m£nsôivôy_tbl
[
HD_TABLE_SIZE
];

728 
__À16
 
	míh™˚_£nsôivôy_tbl
[
ENHANCE_HD_TABLE_ENTRIES
];

730 
iwl_ht_c⁄fig
 
	mcuºít_ht_c⁄fig
;

733 
u8
 
	mªåy_øã
;

735 
	ma˘ivôy_timî_a˘ive
;

737 
iwl_powî_mgr
 
	mpowî_d©a
;

738 
iwl_â_mgmt
 
	mthîmÆ_thrŸée
;

741 
	mnum_°©i⁄s
;

742 
iwl_°©i⁄_íåy
 
	m°©i⁄s
[
IWLAGN_STATION_COUNT
];

743 
	mucode_key_èbÀ
;

744 
iwl_tid_d©a
 
	mtid_d©a
[
IWLAGN_STATION_COUNT
][
IWL_MAX_TID_COUNT
];

745 
©omic_t
 
	mnum_aux_ö_Êight
;

747 
u8
 
	mmac80211_ªgi°îed
;

750 
u8
 
	mis_›í
;

752 
∆80211_i·y≥
 
	miw_mode
;

755 
u64
 
	mtime°amp
;

758 
__À32
 
	mÊag
;

759 
°©i°ics_gíîÆ_comm⁄
 
	mcomm⁄
;

760 
°©i°ics_rx_n⁄_phy
 
	mrx_n⁄_phy
;

761 
°©i°ics_rx_phy
 
	mrx_ofdm
;

762 
°©i°ics_rx_ht_phy
 
	mrx_ofdm_ht
;

763 
°©i°ics_rx_phy
 
	mrx_cck
;

764 
°©i°ics_tx
 
	mtx
;

765 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


766 
°©i°ics_bt_a˘ivôy
 
	mbt_a˘ivôy
;

767 
__À32
 
	mnum_bt_kûls
, 
	maccum_num_bt_kûls
;

769 
•ölock_t
 
	mlock
;

770 } 
	m°©i°ics
;

771 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


773 
°©i°ics_gíîÆ_comm⁄
 
	mcomm⁄
;

774 
°©i°ics_rx_n⁄_phy
 
	mrx_n⁄_phy
;

775 
°©i°ics_rx_phy
 
	mrx_ofdm
;

776 
°©i°ics_rx_ht_phy
 
	mrx_ofdm_ht
;

777 
°©i°ics_rx_phy
 
	mrx_cck
;

778 
°©i°ics_tx
 
	mtx
;

779 
°©i°ics_bt_a˘ivôy
 
	mbt_a˘ivôy
;

780 } 
	maccum_°©s
, 
	mdñè_°©s
, 
	mmax_dñè_°©s
;

787 
u8
 
	magg_tids_cou¡
;

789 
iwl_rx_phy_ªs
 
	mœ°_phy_ªs
;

790 
u32
 
	mampdu_ªf
;

791 
boﬁ
 
	mœ°_phy_ªs_vÆid
;

798 
u8
 
	mphy_ˇlib_chaö_noi£_ª£t_cmd
;

799 
u8
 
	mphy_ˇlib_chaö_noi£_gaö_cmd
;

802 
ª∂y_tx_îr‹_°©i°ics
 
	mª∂y_tx_°©s
;

803 
ª∂y_agg_tx_îr‹_°©i°ics
 
	mª∂y_agg_tx_°©s
;

806 
u8
 
	mbt_íabÀ_Êag
;

807 
u8
 
	mbt_°©us
;

808 
u8
 
	mbt_åaffic_lﬂd
, 
	mœ°_bt_åaffic_lﬂd
;

809 
boﬁ
 
	mbt_ch_™noun˚
;

810 
boﬁ
 
	mbt_fuŒ_c⁄cuºít
;

811 
__À32
 
	mkûl_ack_mask
;

812 
__À32
 
	mkûl_˘s_mask
;

813 
__À16
 
	mbt_vÆid
;

814 
boﬁ
 
	mªdu˚d_txpowî
;

815 
u16
 
	mbt_⁄_thªsh
;

816 
u16
 
	mbt_duøti⁄
;

817 
u16
 
	mdy«mic_‰ag_thªsh
;

818 
u8
 
	mbt_ci_com∂ün˚
;

819 
w‹k_°ru˘
 
	mbt_åaffic_ch™ge_w‹k
;

820 
boﬁ
 
	mbt_íabÀ_p•ﬁl
;

821 
iwl_rx⁄_c⁄ãxt
 *
	mcur_rssi_˘x
;

822 
boﬁ
 
	mbt_is_sco
;

824 
w‹k_°ru˘
 
	mª°¨t
;

825 
w‹k_°ru˘
 
	msˇn_com∂ëed
;

826 
w‹k_°ru˘
 
	mab‹t_sˇn
;

828 
w‹k_°ru˘
 
	mbóc⁄_upd©e
;

829 
iwl_rx⁄_c⁄ãxt
 *
	mbóc⁄_˘x
;

830 
sk_buff
 *
	mbóc⁄_skb
;

831 *
	mbóc⁄_cmd
;

833 
w‹k_°ru˘
 
	mâ_w‹k
;

834 
w‹k_°ru˘
 
	m˘_íãr
;

835 
w‹k_°ru˘
 
	m˘_exô
;

836 
w‹k_°ru˘
 
	m°¨t_öã∫Æ_sˇn
;

837 
w‹k_°ru˘
 
	mtx_Êush
;

838 
w‹k_°ru˘
 
	mbt_fuŒ_c⁄cuºícy
;

839 
w‹k_°ru˘
 
	mbt_ru¡ime_c⁄fig
;

841 
dñayed_w‹k
 
	msˇn_check
;

844 
s8
 
	mtx_powî_u£r_lmt
;

845 
s8
 
	mtx_powî_√xt
;

847 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


849 
díåy
 *
	mdebugfs_dú
;

850 
u32
 
	mdbgfs_§am_off£t
, 
	mdbgfs_§am_Àn
;

851 
boﬁ
 
	mdißbÀ_ht40
;

852 *
	mwowœn_§am
;

855 
iwl_nvm_d©a
 *
	mnvm_d©a
;

857 
u8
 *
	mì¥om_blob
;

858 
size_t
 
	mì¥om_blob_size
;

860 
w‹k_°ru˘
 
	mtxpowî_w‹k
;

861 
u32
 
	mˇlib_dißbÀd
;

862 
w‹k_°ru˘
 
	mrun_time_ˇlib_w‹k
;

863 
timî_li°
 
	m°©i°ics_≥riodic
;

864 
timî_li°
 
	mucode_åa˚
;

866 
iwl_evít_log
 
	mevít_log
;

868 #ifde‡
CONFIG_IWLWIFI_LEDS


869 
Àd_˛assdev
 
	mÀd
;

870 
	mblök_⁄
, 
	mblök_off
;

871 
boﬁ
 
	mÀd_ªgi°îed
;

875 
u8
 
	mkck
[
NL80211_KCK_LEN
], 
	mkek
[
NL80211_KEK_LEN
];

876 
__À64
 
	mª∂ay_˘r
;

877 
__À16
 
	mœ°_£q_˘l
;

878 
boﬁ
 
	mhave_ªkey_d©a
;

879 #ifde‡
CONFIG_PM_SLEEP


880 
wùhy_wowœn_suµ‹t
 
	mwowœn_suµ‹t
;

885 
u32
 
	mîr‹_evít_èbÀ
;

886 
u32
 
	mlog_evít_èbÀ
;

887 } 
	mdevi˚_poöãrs
;

890 
iwl_ucode_ty≥
 
	mcur_ucode
;

893 
ölöe
 
iwl_rx⁄_c⁄ãxt
 *

894 
	$iwl_rx⁄_˘x_‰om_vif
(
õì80211_vif
 *
vif
)

896 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

898  
vif_¥iv
->
˘x
;

899 
	}
}

901 
	#f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) \

902 
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
]; \

903 
˘x
 < &
¥iv
->
c⁄ãxts
[
NUM_IWL_RXON_CTX
]; ctx++) \

904 i‡(
¥iv
->
vÆid_c⁄ãxts
 & 
	`BIT
(
˘x
->
˘xid
))

	)

906 
ölöe
 
	$iwl_is_assocüãd_˘x
(
iwl_rx⁄_c⁄ãxt
 *
˘x
)

908  (
˘x
->
a˘ive
.
fûãr_Êags
 & 
RXON_FILTER_ASSOC_MSK
) ? 1 : 0;

909 
	}
}

911 
ölöe
 
	$iwl_is_assocüãd
(
iwl_¥iv
 *
¥iv
,

912 
iwl_rx⁄_c⁄ãxt_id
 
˘xid
)

914  
	`iwl_is_assocüãd_˘x
(&
¥iv
->
c⁄ãxts
[
˘xid
]);

915 
	}
}

917 
ölöe
 
	$iwl_is_™y_assocüãd
(
iwl_¥iv
 *
¥iv
)

919 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

920 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
)

921 i‡(
	`iwl_is_assocüãd_˘x
(
˘x
))

922  
åue
;

923  
Ál£
;

924 
	}
}

	@dvm/devices.c

8 
	~<löux/unôs.h
>

13 
	~"iwl-io.h
"

14 
	~"iwl-¥ph.h
"

15 
	~"iwl-ì¥om-∑r£.h
"

17 
	~"agn.h
"

18 
	~"dev.h
"

19 
	~"comm™ds.h
"

37 
	$iwl1000_£t_˘_thªshﬁd
(
iwl_¥iv
 *
¥iv
)

40 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
 = 
CT_KILL_THRESHOLD_LEGACY
;

41 
¥iv
->
hw_∑øms
.
˘_kûl_exô_thªshﬁd
 = 
CT_KILL_EXIT_THRESHOLD
;

42 
	}
}

45 
	$iwl1000_nic_c⁄fig
(
iwl_¥iv
 *
¥iv
)

49 
	`iwl_£t_bôs_mask_¥ph
(
¥iv
->
å™s
, 
APMG_DIGITAL_SVR_REG
,

50 
APMG_SVR_DIGITAL_VOLTAGE_1_32
,

51 ~
APMG_SVR_VOLTAGE_CONFIG_BIT_MSK
);

52 
	}
}

59 
ölöe
 
u32
 
	$iwl_bóc⁄_time_mask_low
(
iwl_¥iv
 *
¥iv
,

60 
u16
 
tsf_bôs
)

62  (1 << 
tsf_bôs
) - 1;

63 
	}
}

70 
ölöe
 
u32
 
	$iwl_bóc⁄_time_mask_high
(
iwl_¥iv
 *
¥iv
,

71 
u16
 
tsf_bôs
)

73  ((1 << (32 - 
tsf_bôs
)) - 1) <<Åsf_bits;

74 
	}
}

82 
u32
 
	$iwl_u£cs_to_bóc⁄s
(
iwl_¥iv
 *
¥iv
, 
u32
 
u£c
,

83 
u32
 
bóc⁄_öãrvÆ
)

85 
u32
 
quŸ
;

86 
u32
 
ªm
;

87 
u32
 
öãrvÆ
 = 
bóc⁄_öãrvÆ
 * 
TIME_UNIT
;

89 i‡(!
öãrvÆ
 || !
u£c
)

92 
quŸ
 = (
u£c
 / 
öãrvÆ
) &

93 (
	`iwl_bóc⁄_time_mask_high
(
¥iv
, 
IWLAGN_EXT_BEACON_TIME_POS
) >>

94 
IWLAGN_EXT_BEACON_TIME_POS
);

95 
ªm
 = (
u£c
 % 
öãrvÆ
Ë& 
	`iwl_bóc⁄_time_mask_low
(
¥iv
,

96 
IWLAGN_EXT_BEACON_TIME_POS
);

98  (
quŸ
 << 
IWLAGN_EXT_BEACON_TIME_POS
Ë+ 
ªm
;

99 
	}
}

104 
__À32
 
	$iwl_add_bóc⁄_time
(
iwl_¥iv
 *
¥iv
, 
u32
 
ba£
,

105 
u32
 
add⁄
, u32 
bóc⁄_öãrvÆ
)

107 
u32
 
ba£_low
 = 
ba£
 & 
	`iwl_bóc⁄_time_mask_low
(
¥iv
,

108 
IWLAGN_EXT_BEACON_TIME_POS
);

109 
u32
 
add⁄_low
 = 
add⁄
 & 
	`iwl_bóc⁄_time_mask_low
(
¥iv
,

110 
IWLAGN_EXT_BEACON_TIME_POS
);

111 
u32
 
öãrvÆ
 = 
bóc⁄_öãrvÆ
 * 
TIME_UNIT
;

112 
u32
 
ªs
 = (
ba£
 & 
	`iwl_bóc⁄_time_mask_high
(
¥iv
,

113 
IWLAGN_EXT_BEACON_TIME_POS
)) +

114 (
add⁄
 & 
	`iwl_bóc⁄_time_mask_high
(
¥iv
,

115 
IWLAGN_EXT_BEACON_TIME_POS
));

117 i‡(
ba£_low
 > 
add⁄_low
)

118 
ªs
 +
ba£_low
 - 
add⁄_low
;

119 i‡(
ba£_low
 < 
add⁄_low
) {

120 
ªs
 +
öãrvÆ
 + 
ba£_low
 - 
add⁄_low
;

121 
ªs
 +(1 << 
IWLAGN_EXT_BEACON_TIME_POS
);

123 
ªs
 +(1 << 
IWLAGN_EXT_BEACON_TIME_POS
);

125  
	`˝u_to_À32
(
ªs
);

126 
	}
}

128 c⁄° 
iwl_£nsôivôy_ønges
 
	giwl1000_£nsôivôy
 = {

129 .
mö_ƒg_cck
 = 95,

130 .
	gauto_c‹r_mö_ofdm
 = 90,

131 .
	gauto_c‹r_mö_ofdm_mrc
 = 170,

132 .
	gauto_c‹r_mö_ofdm_x1
 = 120,

133 .
	gauto_c‹r_mö_ofdm_mrc_x1
 = 240,

135 .
	gauto_c‹r_max_ofdm
 = 120,

136 .
	gauto_c‹r_max_ofdm_mrc
 = 210,

137 .
	gauto_c‹r_max_ofdm_x1
 = 155,

138 .
	gauto_c‹r_max_ofdm_mrc_x1
 = 290,

140 .
	gauto_c‹r_mö_cck
 = 125,

141 .
	gauto_c‹r_max_cck
 = 200,

142 .
	gauto_c‹r_mö_cck_mrc
 = 170,

143 .
	gauto_c‹r_max_cck_mrc
 = 400,

144 .
	gƒg_th_cck
 = 95,

145 .
	gƒg_th_ofdm
 = 95,

147 .
	gb¨kî_c‹r_th_mö
 = 190,

148 .
	gb¨kî_c‹r_th_mö_mrc
 = 390,

149 .
	gƒg_th_cˇ
 = 62,

152 
	$iwl1000_hw_£t_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

154 
	`iwl1000_£t_˘_thªshﬁd
(
¥iv
);

157 
¥iv
->
hw_∑øms
.
£ns
 = &
iwl1000_£nsôivôy
;

158 
	}
}

160 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_1000_cfg
 = {

161 .
£t_hw_∑øms
 = 
iwl1000_hw_£t_hw_∑øms
,

162 .
	gnic_c⁄fig
 = 
iwl1000_nic_c⁄fig
,

163 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

164 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

165 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_EXT_LONG_THRESHOLD_DEF
,

166 .
	gchaö_noi£_sˇÀ
 = 1000,

175 
	$iwl2000_£t_˘_thªshﬁd
(
iwl_¥iv
 *
¥iv
)

178 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
 = 
CT_KILL_THRESHOLD
;

179 
¥iv
->
hw_∑øms
.
˘_kûl_exô_thªshﬁd
 = 
CT_KILL_EXIT_THRESHOLD
;

180 
	}
}

183 
	$iwl2000_nic_c⁄fig
(
iwl_¥iv
 *
¥iv
)

185 
	`iwl_£t_bô
(
¥iv
->
å™s
, 
CSR_GP_DRIVER_REG
,

186 
CSR_GP_DRIVER_REG_BIT_RADIO_IQ_INVER
);

187 
	}
}

189 c⁄° 
iwl_£nsôivôy_ønges
 
	giwl2000_£nsôivôy
 = {

190 .
mö_ƒg_cck
 = 97,

191 .
	gauto_c‹r_mö_ofdm
 = 80,

192 .
	gauto_c‹r_mö_ofdm_mrc
 = 128,

193 .
	gauto_c‹r_mö_ofdm_x1
 = 105,

194 .
	gauto_c‹r_mö_ofdm_mrc_x1
 = 192,

196 .
	gauto_c‹r_max_ofdm
 = 145,

197 .
	gauto_c‹r_max_ofdm_mrc
 = 232,

198 .
	gauto_c‹r_max_ofdm_x1
 = 110,

199 .
	gauto_c‹r_max_ofdm_mrc_x1
 = 232,

201 .
	gauto_c‹r_mö_cck
 = 125,

202 .
	gauto_c‹r_max_cck
 = 175,

203 .
	gauto_c‹r_mö_cck_mrc
 = 160,

204 .
	gauto_c‹r_max_cck_mrc
 = 310,

205 .
	gƒg_th_cck
 = 97,

206 .
	gƒg_th_ofdm
 = 100,

208 .
	gb¨kî_c‹r_th_mö
 = 190,

209 .
	gb¨kî_c‹r_th_mö_mrc
 = 390,

210 .
	gƒg_th_cˇ
 = 62,

213 
	$iwl2000_hw_£t_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

215 
	`iwl2000_£t_˘_thªshﬁd
(
¥iv
);

218 
¥iv
->
hw_∑øms
.
£ns
 = &
iwl2000_£nsôivôy
;

219 
	}
}

221 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_2000_cfg
 = {

222 .
£t_hw_∑øms
 = 
iwl2000_hw_£t_hw_∑øms
,

223 .
	gnic_c⁄fig
 = 
iwl2000_nic_c⁄fig
,

224 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

225 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

226 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

227 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

228 .
	gchaö_noi£_sˇÀ
 = 1000,

229 .
	ghd_v2
 = 
åue
,

230 .
	g√ed_ãmp_off£t_ˇlib
 = 
åue
,

231 .
	gãmp_off£t_v2
 = 
åue
,

234 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_105_cfg
 = {

235 .
£t_hw_∑øms
 = 
iwl2000_hw_£t_hw_∑øms
,

236 .
	gnic_c⁄fig
 = 
iwl2000_nic_c⁄fig
,

237 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

238 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

239 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

240 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

241 .
	gchaö_noi£_sˇÀ
 = 1000,

242 .
	ghd_v2
 = 
åue
,

243 .
	g√ed_ãmp_off£t_ˇlib
 = 
åue
,

244 .
	gãmp_off£t_v2
 = 
åue
,

245 .
	gadv_pm
 = 
åue
,

248 c⁄° 
iwl_dvm_bt_∑øms
 
	giwl2030_bt_∑øms
 = {

250 .
adv™˚d_bt_c€xi°
 = 
åue
,

251 .
	gagg_time_limô
 = 
BT_AGG_THRESHOLD_DEF
,

252 .
	gbt_öô_åaffic_lﬂd
 = 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
,

253 .
	gbt_¥io_boo°
 = 
IWLAGN_BT_PRIO_BOOST_DEFAULT32
,

254 .
	gbt_sco_dißbÀ
 = 
åue
,

255 .
	gbt_£ssi⁄_2
 = 
åue
,

258 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_2030_cfg
 = {

259 .
£t_hw_∑øms
 = 
iwl2000_hw_£t_hw_∑øms
,

260 .
	gnic_c⁄fig
 = 
iwl2000_nic_c⁄fig
,

261 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

262 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

263 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

264 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

265 .
	gchaö_noi£_sˇÀ
 = 1000,

266 .
	ghd_v2
 = 
åue
,

267 .
	gbt_∑øms
 = &
iwl2030_bt_∑øms
,

268 .
	g√ed_ãmp_off£t_ˇlib
 = 
åue
,

269 .
	gãmp_off£t_v2
 = 
åue
,

270 .
	gadv_pm
 = 
åue
,

279 c⁄° 
iwl_£nsôivôy_ønges
 
	giwl5000_£nsôivôy
 = {

280 .
mö_ƒg_cck
 = 100,

281 .
	gauto_c‹r_mö_ofdm
 = 90,

282 .
	gauto_c‹r_mö_ofdm_mrc
 = 170,

283 .
	gauto_c‹r_mö_ofdm_x1
 = 105,

284 .
	gauto_c‹r_mö_ofdm_mrc_x1
 = 220,

286 .
	gauto_c‹r_max_ofdm
 = 120,

287 .
	gauto_c‹r_max_ofdm_mrc
 = 210,

288 .
	gauto_c‹r_max_ofdm_x1
 = 120,

289 .
	gauto_c‹r_max_ofdm_mrc_x1
 = 240,

291 .
	gauto_c‹r_mö_cck
 = 125,

292 .
	gauto_c‹r_max_cck
 = 200,

293 .
	gauto_c‹r_mö_cck_mrc
 = 200,

294 .
	gauto_c‹r_max_cck_mrc
 = 400,

295 .
	gƒg_th_cck
 = 100,

296 .
	gƒg_th_ofdm
 = 100,

298 .
	gb¨kî_c‹r_th_mö
 = 190,

299 .
	gb¨kî_c‹r_th_mö_mrc
 = 390,

300 .
	gƒg_th_cˇ
 = 62,

303 c⁄° 
iwl_£nsôivôy_ønges
 
	giwl5150_£nsôivôy
 = {

304 .
mö_ƒg_cck
 = 95,

305 .
	gauto_c‹r_mö_ofdm
 = 90,

306 .
	gauto_c‹r_mö_ofdm_mrc
 = 170,

307 .
	gauto_c‹r_mö_ofdm_x1
 = 105,

308 .
	gauto_c‹r_mö_ofdm_mrc_x1
 = 220,

310 .
	gauto_c‹r_max_ofdm
 = 120,

311 .
	gauto_c‹r_max_ofdm_mrc
 = 210,

313 .
	gauto_c‹r_max_ofdm_x1
 = 105,

314 .
	gauto_c‹r_max_ofdm_mrc_x1
 = 220,

316 .
	gauto_c‹r_mö_cck
 = 125,

317 .
	gauto_c‹r_max_cck
 = 200,

318 .
	gauto_c‹r_mö_cck_mrc
 = 170,

319 .
	gauto_c‹r_max_cck_mrc
 = 400,

320 .
	gƒg_th_cck
 = 95,

321 .
	gƒg_th_ofdm
 = 95,

323 .
	gb¨kî_c‹r_th_mö
 = 190,

324 .
	gb¨kî_c‹r_th_mö_mrc
 = 390,

325 .
	gƒg_th_cˇ
 = 62,

328 
	#IWL_5150_VOLTAGE_TO_TEMPERATURE_COEFF
 (-5)

	)

330 
s32
 
	$iwl_ãmp_ˇlib_to_off£t
(
iwl_¥iv
 *
¥iv
)

332 
u16
 
ãm≥øtuª
, 
vﬁège
;

334 
ãm≥øtuª
 = 
	`À16_to_˝u
(
¥iv
->
nvm_d©a
->
kñvö_ãm≥øtuª
);

335 
vﬁège
 = 
	`À16_to_˝u
(
¥iv
->
nvm_d©a
->
kñvö_vﬁège
);

338  (
s32
)(
ãm≥øtuª
 -

339 
vﬁège
 / 
IWL_5150_VOLTAGE_TO_TEMPERATURE_COEFF
);

340 
	}
}

342 
	$iwl5150_£t_˘_thªshﬁd
(
iwl_¥iv
 *
¥iv
)

344 c⁄° 
s32
 
vﬁt2ãmp_c€f
 = 
IWL_5150_VOLTAGE_TO_TEMPERATURE_COEFF
;

345 
s32
 
thªshﬁd
 = (s32)
	`˚lsius_to_kñvö
(
CT_KILL_THRESHOLD_LEGACY
) -

346 
	`iwl_ãmp_ˇlib_to_off£t
(
¥iv
);

348 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
 = 
thªshﬁd
 * 
vﬁt2ãmp_c€f
;

349 
	}
}

351 
	$iwl5000_£t_˘_thªshﬁd
(
iwl_¥iv
 *
¥iv
)

354 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
 = 
CT_KILL_THRESHOLD_LEGACY
;

355 
	}
}

357 
	$iwl5000_hw_£t_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

359 
	`iwl5000_£t_˘_thªshﬁd
(
¥iv
);

362 
¥iv
->
hw_∑øms
.
£ns
 = &
iwl5000_£nsôivôy
;

363 
	}
}

365 
	$iwl5150_hw_£t_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

367 
	`iwl5150_£t_˘_thªshﬁd
(
¥iv
);

370 
¥iv
->
hw_∑øms
.
£ns
 = &
iwl5150_£nsôivôy
;

371 
	}
}

373 
	$iwl5150_ãm≥øtuª
(
iwl_¥iv
 *
¥iv
)

375 
u32
 
vt
 = 0;

376 
s32
 
off£t
 = 
	`iwl_ãmp_ˇlib_to_off£t
(
¥iv
);

378 
vt
 = 
	`À32_to_˝u
(
¥iv
->
°©i°ics
.
comm⁄
.
ãm≥øtuª
);

379 
vt
 = và/ 
IWL_5150_VOLTAGE_TO_TEMPERATURE_COEFF
 + 
off£t
;

381 
¥iv
->
ãm≥øtuª
 = 
	`kñvö_to_˚lsius
(
vt
);

382 
	`iwl_â_h™dÀr
(
¥iv
);

383 
	}
}

385 
	$iwl5000_hw_ch™√l_swôch
(
iwl_¥iv
 *
¥iv
,

386 
õì80211_ch™√l_swôch
 *
ch_swôch
)

392 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

393 
iwl5000_ch™√l_swôch_cmd
 
cmd
;

394 
u32
 
swôch_time_ö_u£c
, 
ucode_swôch_time
;

395 
u16
 
ch
;

396 
u32
 
tsf_low
;

397 
u8
 
swôch_cou¡
;

398 
u16
 
bóc⁄_öãrvÆ
 = 
	`À16_to_˝u
(
˘x
->
timög
.beacon_interval);

399 
õì80211_vif
 *
vif
 = 
˘x
->vif;

400 
iwl_ho°_cmd
 
hcmd
 = {

401 .
id
 = 
REPLY_CHANNEL_SWITCH
,

402 .
Àn
 = { (
cmd
), },

403 .
d©a
 = { &
cmd
, },

406 
cmd
.
b™d
 = 
¥iv
->b™d =
NL80211_BAND_2GHZ
;

407 
ch
 = 
ch_swôch
->
ch™def
.
ch™
->
hw_vÆue
;

408 
	`IWL_DEBUG_11H
(
¥iv
, "channel switch from %dÅo %d\n",

409 
˘x
->
a˘ive
.
ch™√l
, 
ch
);

410 
cmd
.
ch™√l
 = 
	`˝u_to_À16
(
ch
);

411 
cmd
.
rx⁄_Êags
 = 
˘x
->
°agög
.
Êags
;

412 
cmd
.
rx⁄_fûãr_Êags
 = 
˘x
->
°agög
.
fûãr_Êags
;

413 
swôch_cou¡
 = 
ch_swôch
->
cou¡
;

414 
tsf_low
 = 
ch_swôch
->
time°amp
 & 0x0ffffffff;

419 i‡((
¥iv
->
ucode_bóc⁄_time
 > 
tsf_low
Ë&& 
bóc⁄_öãrvÆ
) {

420 i‡(
swôch_cou¡
 > ((
¥iv
->
ucode_bóc⁄_time
 - 
tsf_low
) /

421 
bóc⁄_öãrvÆ
)) {

422 
swôch_cou¡
 -(
¥iv
->
ucode_bóc⁄_time
 -

423 
tsf_low
Ë/ 
bóc⁄_öãrvÆ
;

425 
swôch_cou¡
 = 0;

427 i‡(
swôch_cou¡
 <= 1)

428 
cmd
.
swôch_time
 = 
	`˝u_to_À32
(
¥iv
->
ucode_bóc⁄_time
);

430 
swôch_time_ö_u£c
 =

431 
vif
->
bss_c⁄f
.
bóc⁄_öt
 * 
swôch_cou¡
 * 
TIME_UNIT
;

432 
ucode_swôch_time
 = 
	`iwl_u£cs_to_bóc⁄s
(
¥iv
,

433 
swôch_time_ö_u£c
,

434 
bóc⁄_öãrvÆ
);

435 
cmd
.
swôch_time
 = 
	`iwl_add_bóc⁄_time
(
¥iv
,

436 
¥iv
->
ucode_bóc⁄_time
,

437 
ucode_swôch_time
,

438 
bóc⁄_öãrvÆ
);

440 
	`IWL_DEBUG_11H
(
¥iv
, "uCodeÅime forÅhe switch is 0x%x\n",

441 
cmd
.
swôch_time
);

442 
cmd
.
ex≥˘_bóc⁄
 =

443 
ch_swôch
->
ch™def
.
ch™
->
Êags
 & 
IEEE80211_CHAN_RADAR
;

445  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
hcmd
);

446 
	}
}

448 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_5000_cfg
 = {

449 .
£t_hw_∑øms
 = 
iwl5000_hw_£t_hw_∑øms
,

450 .
	g£t_ch™√l_swôch
 = 
iwl5000_hw_ch™√l_swôch
,

451 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

452 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_LONG_THRESHOLD_DEF
,

453 .
	gchaö_noi£_sˇÀ
 = 1000,

454 .
	gno_idÀ_suµ‹t
 = 
åue
,

457 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_5150_cfg
 = {

458 .
£t_hw_∑øms
 = 
iwl5150_hw_£t_hw_∑øms
,

459 .
	g£t_ch™√l_swôch
 = 
iwl5000_hw_ch™√l_swôch
,

460 .
	gãm≥øtuª
 = 
iwl5150_ãm≥øtuª
,

461 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_LONG_THRESHOLD_DEF
,

462 .
	gchaö_noi£_sˇÀ
 = 1000,

463 .
	gno_idÀ_suµ‹t
 = 
åue
,

464 .
	gno_xèl_ˇlib
 = 
åue
,

474 
	$iwl6000_£t_˘_thªshﬁd
(
iwl_¥iv
 *
¥iv
)

477 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
 = 
CT_KILL_THRESHOLD
;

478 
¥iv
->
hw_∑øms
.
˘_kûl_exô_thªshﬁd
 = 
CT_KILL_EXIT_THRESHOLD
;

479 
	}
}

482 
	$iwl6000_nic_c⁄fig
(
iwl_¥iv
 *
¥iv
)

484 
¥iv
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
) {

485 
IWL_DEVICE_FAMILY_6005
:

486 
IWL_DEVICE_FAMILY_6030
:

487 
IWL_DEVICE_FAMILY_6000
:

489 
IWL_DEVICE_FAMILY_6000i
:

491 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_GP_DRIVER_REG
,

492 
CSR_GP_DRIVER_REG_BIT_RADIO_SKU_2x2_IPA
);

494 
IWL_DEVICE_FAMILY_6050
:

496 i‡(
¥iv
->
nvm_d©a
->
ˇlib_vîsi⁄
 >= 6)

497 
	`iwl_£t_bô
(
¥iv
->
å™s
, 
CSR_GP_DRIVER_REG
,

498 
CSR_GP_DRIVER_REG_BIT_CALIB_VERSION6
);

500 
IWL_DEVICE_FAMILY_6150
:

502 i‡(
¥iv
->
nvm_d©a
->
ˇlib_vîsi⁄
 >= 6)

503 
	`iwl_£t_bô
(
¥iv
->
å™s
, 
CSR_GP_DRIVER_REG
,

504 
CSR_GP_DRIVER_REG_BIT_CALIB_VERSION6
);

505 
	`iwl_£t_bô
(
¥iv
->
å™s
, 
CSR_GP_DRIVER_REG
,

506 
CSR_GP_DRIVER_REG_BIT_6050_1x2
);

509 
	`WARN_ON
(1);

511 
	}
}

513 c⁄° 
iwl_£nsôivôy_ønges
 
	giwl6000_£nsôivôy
 = {

514 .
mö_ƒg_cck
 = 110,

515 .
	gauto_c‹r_mö_ofdm
 = 80,

516 .
	gauto_c‹r_mö_ofdm_mrc
 = 128,

517 .
	gauto_c‹r_mö_ofdm_x1
 = 105,

518 .
	gauto_c‹r_mö_ofdm_mrc_x1
 = 192,

520 .
	gauto_c‹r_max_ofdm
 = 145,

521 .
	gauto_c‹r_max_ofdm_mrc
 = 232,

522 .
	gauto_c‹r_max_ofdm_x1
 = 110,

523 .
	gauto_c‹r_max_ofdm_mrc_x1
 = 232,

525 .
	gauto_c‹r_mö_cck
 = 125,

526 .
	gauto_c‹r_max_cck
 = 175,

527 .
	gauto_c‹r_mö_cck_mrc
 = 160,

528 .
	gauto_c‹r_max_cck_mrc
 = 310,

529 .
	gƒg_th_cck
 = 110,

530 .
	gƒg_th_ofdm
 = 110,

532 .
	gb¨kî_c‹r_th_mö
 = 190,

533 .
	gb¨kî_c‹r_th_mö_mrc
 = 336,

534 .
	gƒg_th_cˇ
 = 62,

537 
	$iwl6000_hw_£t_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

539 
	`iwl6000_£t_˘_thªshﬁd
(
¥iv
);

542 
¥iv
->
hw_∑øms
.
£ns
 = &
iwl6000_£nsôivôy
;

544 
	}
}

546 
	$iwl6000_hw_ch™√l_swôch
(
iwl_¥iv
 *
¥iv
,

547 
õì80211_ch™√l_swôch
 *
ch_swôch
)

553 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

554 
iwl6000_ch™√l_swôch_cmd
 *
cmd
;

555 
u32
 
swôch_time_ö_u£c
, 
ucode_swôch_time
;

556 
u16
 
ch
;

557 
u32
 
tsf_low
;

558 
u8
 
swôch_cou¡
;

559 
u16
 
bóc⁄_öãrvÆ
 = 
	`À16_to_˝u
(
˘x
->
timög
.beacon_interval);

560 
õì80211_vif
 *
vif
 = 
˘x
->vif;

561 
iwl_ho°_cmd
 
hcmd
 = {

562 .
id
 = 
REPLY_CHANNEL_SWITCH
,

563 .
Àn
 = { (*
cmd
), },

564 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

566 
îr
;

568 
cmd
 = 
	`kzÆloc
((*cmd), 
GFP_KERNEL
);

569 i‡(!
cmd
)

570  -
ENOMEM
;

572 
hcmd
.
d©a
[0] = 
cmd
;

574 
cmd
->
b™d
 = 
¥iv
->b™d =
NL80211_BAND_2GHZ
;

575 
ch
 = 
ch_swôch
->
ch™def
.
ch™
->
hw_vÆue
;

576 
	`IWL_DEBUG_11H
(
¥iv
, "channel switch from %uÅo %u\n",

577 
˘x
->
a˘ive
.
ch™√l
, 
ch
);

578 
cmd
->
ch™√l
 = 
	`˝u_to_À16
(
ch
);

579 
cmd
->
rx⁄_Êags
 = 
˘x
->
°agög
.
Êags
;

580 
cmd
->
rx⁄_fûãr_Êags
 = 
˘x
->
°agög
.
fûãr_Êags
;

581 
swôch_cou¡
 = 
ch_swôch
->
cou¡
;

582 
tsf_low
 = 
ch_swôch
->
time°amp
 & 0x0ffffffff;

587 i‡((
¥iv
->
ucode_bóc⁄_time
 > 
tsf_low
Ë&& 
bóc⁄_öãrvÆ
) {

588 i‡(
swôch_cou¡
 > ((
¥iv
->
ucode_bóc⁄_time
 - 
tsf_low
) /

589 
bóc⁄_öãrvÆ
)) {

590 
swôch_cou¡
 -(
¥iv
->
ucode_bóc⁄_time
 -

591 
tsf_low
Ë/ 
bóc⁄_öãrvÆ
;

593 
swôch_cou¡
 = 0;

595 i‡(
swôch_cou¡
 <= 1)

596 
cmd
->
swôch_time
 = 
	`˝u_to_À32
(
¥iv
->
ucode_bóc⁄_time
);

598 
swôch_time_ö_u£c
 =

599 
vif
->
bss_c⁄f
.
bóc⁄_öt
 * 
swôch_cou¡
 * 
TIME_UNIT
;

600 
ucode_swôch_time
 = 
	`iwl_u£cs_to_bóc⁄s
(
¥iv
,

601 
swôch_time_ö_u£c
,

602 
bóc⁄_öãrvÆ
);

603 
cmd
->
swôch_time
 = 
	`iwl_add_bóc⁄_time
(
¥iv
,

604 
¥iv
->
ucode_bóc⁄_time
,

605 
ucode_swôch_time
,

606 
bóc⁄_öãrvÆ
);

608 
	`IWL_DEBUG_11H
(
¥iv
, "uCodeÅime forÅhe switch is 0x%x\n",

609 
cmd
->
swôch_time
);

610 
cmd
->
ex≥˘_bóc⁄
 =

611 
ch_swôch
->
ch™def
.
ch™
->
Êags
 & 
IEEE80211_CHAN_RADAR
;

613 
îr
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
hcmd
);

614 
	`k‰ì
(
cmd
);

615  
îr
;

616 
	}
}

618 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_6000_cfg
 = {

619 .
£t_hw_∑øms
 = 
iwl6000_hw_£t_hw_∑øms
,

620 .
	g£t_ch™√l_swôch
 = 
iwl6000_hw_ch™√l_swôch
,

621 .
	gnic_c⁄fig
 = 
iwl6000_nic_c⁄fig
,

622 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

623 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

624 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

625 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

626 .
	gchaö_noi£_sˇÀ
 = 1000,

629 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_6005_cfg
 = {

630 .
£t_hw_∑øms
 = 
iwl6000_hw_£t_hw_∑øms
,

631 .
	g£t_ch™√l_swôch
 = 
iwl6000_hw_ch™√l_swôch
,

632 .
	gnic_c⁄fig
 = 
iwl6000_nic_c⁄fig
,

633 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

634 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

635 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

636 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

637 .
	gchaö_noi£_sˇÀ
 = 1000,

638 .
	g√ed_ãmp_off£t_ˇlib
 = 
åue
,

641 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_6050_cfg
 = {

642 .
£t_hw_∑øms
 = 
iwl6000_hw_£t_hw_∑øms
,

643 .
	g£t_ch™√l_swôch
 = 
iwl6000_hw_ch™√l_swôch
,

644 .
	gnic_c⁄fig
 = 
iwl6000_nic_c⁄fig
,

645 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

646 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

647 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

648 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

649 .
	gchaö_noi£_sˇÀ
 = 1500,

652 c⁄° 
iwl_dvm_bt_∑øms
 
	giwl6000_bt_∑øms
 = {

654 .
adv™˚d_bt_c€xi°
 = 
åue
,

655 .
	gagg_time_limô
 = 
BT_AGG_THRESHOLD_DEF
,

656 .
	gbt_öô_åaffic_lﬂd
 = 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
,

657 .
	gbt_¥io_boo°
 = 
IWLAGN_BT_PRIO_BOOST_DEFAULT
,

658 .
	gbt_sco_dißbÀ
 = 
åue
,

661 c⁄° 
iwl_dvm_cfg
 
	giwl_dvm_6030_cfg
 = {

662 .
£t_hw_∑øms
 = 
iwl6000_hw_£t_hw_∑øms
,

663 .
	g£t_ch™√l_swôch
 = 
iwl6000_hw_ch™√l_swôch
,

664 .
	gnic_c⁄fig
 = 
iwl6000_nic_c⁄fig
,

665 .
	gãm≥øtuª
 = 
iwœgn_ãm≥øtuª
,

666 .
	gadv_thîmÆ_thrŸée
 = 
åue
,

667 .
	gsuµ‹t_˘_kûl_exô
 = 
åue
,

668 .
	g∂˝_dñè_thªshﬁd
 = 
IWL_MAX_PLCP_ERR_THRESHOLD_DEF
,

669 .
	gchaö_noi£_sˇÀ
 = 1000,

670 .
	gbt_∑øms
 = &
iwl6000_bt_∑øms
,

671 .
	g√ed_ãmp_off£t_ˇlib
 = 
åue
,

672 .
	gadv_pm
 = 
åue
,

	@dvm/iwldvm.mod.c

1 
	~<löux/moduÀ.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<löux/buûd-ß….h
>

4 
	~<löux/ñ‚Ÿe-…o.h
>

5 
	~<löux/exp‹t-öã∫Æ.h
>

6 
	~<löux/vîmagic.h
>

7 
	~<löux/compûî.h
>

9 #ifde‡
CONFIG_UNWINDER_ORC


10 
	~<asm/‹c_hódî.h
>

11 
	gORC_HEADER
;

14 
	gBUILD_SALT
;

15 
	gBUILD_LTO_INFO
;

17 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

18 
MODULE_INFO
(
«me
, 
KBUILD_MODNAME
);

20 
__visibÀ
 
moduÀ
 
__this_moduÀ


21 
__£˘i⁄
(".gnu.linkonce.this_module") = {

22 .
«me
 = 
KBUILD_MODNAME
,

23 .
	göô
 = 
öô_moduÀ
,

24 #ifde‡
CONFIG_MODULE_UNLOAD


25 .
	gexô
 = 
˛ónup_moduÀ
,

27 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

30 #ifde‡
CONFIG_MITIGATION_RETPOLINE


31 
MODULE_INFO
(
ªçﬁöe
, "Y");

36 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

37 
__u£d
 
__£˘i⁄
("__versions") = {

196 
MODULE_INFO
(
dïíds
, "iwlwifi,mac80211,cfg80211");

199 
MODULE_INFO
(
§cvîsi⁄
, "FCC89FE3607D4928823DC46");

	@dvm/led.c

9 
	~<löux/kî√l.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/dñay.h
>

12 
	~<löux/skbuff.h
>

13 
	~<löux/√tdevi˚.h
>

14 
	~<√t/mac80211.h
>

15 
	~<löux/ëhîdevi˚.h
>

16 
	~<asm/u«lig√d.h
>

17 
	~"iwl-io.h
"

18 
	~"iwl-å™s.h
"

19 
	~"iwl-mod∑øms.h
"

20 
	~"dev.h
"

21 
	~"agn.h
"

36 c⁄° 
õì80211_çt_blök
 
	giwl_blök
[] = {

37 { .
throughput
 = 0, .
	gblök_time
 = 334 },

38 { .
	gthroughput
 = 1 * 1024 - 1, .
	gblök_time
 = 260 },

39 { .
	gthroughput
 = 5 * 1024 - 1, .
	gblök_time
 = 220 },

40 { .
	gthroughput
 = 10 * 1024 - 1, .
	gblök_time
 = 190 },

41 { .
	gthroughput
 = 20 * 1024 - 1, .
	gblök_time
 = 170 },

42 { .
	gthroughput
 = 50 * 1024 - 1, .
	gblök_time
 = 150 },

43 { .
	gthroughput
 = 70 * 1024 - 1, .
	gblök_time
 = 130 },

44 { .
	gthroughput
 = 100 * 1024 - 1, .
	gblök_time
 = 110 },

45 { .
	gthroughput
 = 200 * 1024 - 1, .
	gblök_time
 = 80 },

46 { .
	gthroughput
 = 300 * 1024 - 1, .
	gblök_time
 = 50 },

50 
	$iwœgn_Àd_íabÀ
(
iwl_¥iv
 *
¥iv
)

52 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_LED_REG
, 
CSR_LED_REG_TURN_ON
);

53 
	}
}

66 
ölöe
 
u8
 
	$iwl_blök_com≥nßti⁄
(
iwl_¥iv
 *
¥iv
,

67 
u8
 
time
, 
u16
 
com≥nßti⁄
)

69 i‡(!
com≥nßti⁄
) {

70 
	`IWL_ERR
(
¥iv
, "undefined blink compensation: "

72  
time
;

75  (
u8
)((
time
 * 
com≥nßti⁄
) >> 6);

76 
	}
}

78 
	$iwl_£nd_Àd_cmd
(
iwl_¥iv
 *
¥iv
, 
iwl_Àd_cmd
 *
Àd_cmd
)

80 
iwl_ho°_cmd
 
cmd
 = {

81 .
id
 = 
REPLY_LEDS_CMD
,

82 .
Àn
 = { (
iwl_Àd_cmd
), },

83 .
d©a
 = { 
Àd_cmd
, },

84 .
Êags
 = 
CMD_ASYNC
,

86 
u32
 
ªg
;

88 
ªg
 = 
	`iwl_ªad32
(
¥iv
->
å™s
, 
CSR_LED_REG
);

89 i‡(
ªg
 !‘eg & 
CSR_LED_BSM_CTRL_MSK
))

90 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_LED_REG
,

91 
ªg
 & 
CSR_LED_BSM_CTRL_MSK
);

93  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

94 
	}
}

97 
	$iwl_Àd_cmd
(
iwl_¥iv
 *
¥iv
,

98 
⁄
,

99 
off
)

101 
iwl_Àd_cmd
 
Àd_cmd
 = {

102 .
id
 = 
IWL_LED_LINK
,

103 .
öãrvÆ
 = 
IWL_DEF_LED_INTRVL


105 
ªt
;

107 i‡(!
	`ã°_bô
(
STATUS_READY
, &
¥iv
->
°©us
))

108  -
EBUSY
;

110 i‡(
¥iv
->
blök_⁄
 =
⁄
 &&Öriv->
blök_off
 =
off
)

113 i‡(
off
 == 0) {

115 
⁄
 = 
IWL_LED_SOLID
;

118 
Àd_cmd
.
⁄
 = 
	`iwl_blök_com≥nßti⁄
(
¥iv
, on,

119 
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
Àd_com≥nßti⁄
);

120 
Àd_cmd
.
off
 = 
	`iwl_blök_com≥nßti⁄
(
¥iv
, off,

121 
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
Àd_com≥nßti⁄
);

123 
ªt
 = 
	`iwl_£nd_Àd_cmd
(
¥iv
, &
Àd_cmd
);

124 i‡(!
ªt
) {

125 
¥iv
->
blök_⁄
 = 
⁄
;

126 
¥iv
->
blök_off
 = 
off
;

128  
ªt
;

129 
	}
}

131 
	$iwl_Àd_brighäess_£t
(
Àd_˛assdev
 *
Àd_cdev
,

132 
Àd_brighäess
 
brighäess
)

134 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
Àd_cdev
, iwl_¥iv, 
Àd
);

135 
⁄
 = 0;

136 
off
 = 0;

138 i‡(
brighäess
 > 0)

139 
⁄
 = 
IWL_LED_SOLID
;

141 
off
 = 
IWL_LED_SOLID
;

143 
	`iwl_Àd_cmd
(
¥iv
, 
⁄
, 
off
);

144 
	}
}

146 
	$iwl_Àd_blök_£t
(
Àd_˛assdev
 *
Àd_cdev
,

147 *
dñay_⁄
,

148 *
dñay_off
)

150 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
Àd_cdev
, iwl_¥iv, 
Àd
);

152  
	`iwl_Àd_cmd
(
¥iv
, *
dñay_⁄
, *
dñay_off
);

153 
	}
}

155 
	$iwl_Àds_öô
(
iwl_¥iv
 *
¥iv
)

157 
mode
 = 
iwlwifi_mod_∑øms
.
Àd_mode
;

158 
ªt
;

160 i‡(
mode
 =
IWL_LED_DISABLE
) {

161 
	`IWL_INFO
(
¥iv
, "Led disabled\n");

164 i‡(
mode
 =
IWL_LED_DEFAULT
)

165 
mode
 = 
¥iv
->
cfg
->
Àd_mode
;

167 
¥iv
->
Àd
.
«me
 = 
	`ka•rötf
(
GFP_KERNEL
, "%s-led",

168 
	`wùhy_«me
(
¥iv
->
hw
->
wùhy
));

169 i‡(!
¥iv
->
Àd
.
«me
)

172 
¥iv
->
Àd
.
brighäess_£t
 = 
iwl_Àd_brighäess_£t
;

173 
¥iv
->
Àd
.
blök_£t
 = 
iwl_Àd_blök_£t
;

174 
¥iv
->
Àd
.
max_brighäess
 = 1;

176 
mode
) {

177 
IWL_LED_DEFAULT
:

178 
	`WARN_ON
(1);

180 
IWL_LED_BLINK
:

181 
¥iv
->
Àd
.
deÁu…_åiggî
 =

182 
	`õì80211_¸óã_çt_Àd_åiggî
(
¥iv
->
hw
,

183 
IEEE80211_TPT_LEDTRIG_FL_CONNECTED
,

184 
iwl_blök
, 
	`ARRAY_SIZE
(iwl_blink));

186 
IWL_LED_RF_STATE
:

187 
¥iv
->
Àd
.
deÁu…_åiggî
 =

188 
	`õì80211_gë_ødio_Àd_«me
(
¥iv
->
hw
);

192 
ªt
 = 
	`Àd_˛assdev_ªgi°î
(
¥iv
->
å™s
->
dev
, &¥iv->
Àd
);

193 i‡(
ªt
) {

194 
	`k‰ì
(
¥iv
->
Àd
.
«me
);

198 
¥iv
->
Àd_ªgi°îed
 = 
åue
;

199 
	}
}

201 
	$iwl_Àds_exô
(
iwl_¥iv
 *
¥iv
)

203 i‡(!
¥iv
->
Àd_ªgi°îed
)

206 
	`Àd_˛assdev_uƒegi°î
(&
¥iv
->
Àd
);

207 
	`k‰ì
(
¥iv
->
Àd
.
«me
);

208 
	}
}

	@dvm/led.h

7 #i‚de‡
__iwl_Àds_h__


8 
	#__iwl_Àds_h__


	)

11 
	giwl_¥iv
;

13 
	#IWL_LED_SOLID
 11

	)

14 
	#IWL_DEF_LED_INTRVL
 
	`˝u_to_À32
(1000)

	)

16 
	#IWL_LED_ACTIVITY
 (0<<1)

	)

17 
	#IWL_LED_LINK
 (1<<1)

	)

19 #ifde‡
CONFIG_IWLWIFI_LEDS


20 
iwœgn_Àd_íabÀ
(
iwl_¥iv
 *
¥iv
);

21 
iwl_Àds_öô
(
iwl_¥iv
 *
¥iv
);

22 
iwl_Àds_exô
(
iwl_¥iv
 *
¥iv
);

24 
ölöe
 
	$iwœgn_Àd_íabÀ
(
iwl_¥iv
 *
¥iv
)

26 
	}
}

27 
ölöe
 
	$iwl_Àds_öô
(
iwl_¥iv
 *
¥iv
)

29 
	}
}

30 
ölöe
 
	$iwl_Àds_exô
(
iwl_¥iv
 *
¥iv
)

32 
	}
}

	@dvm/lib.c

6 
	~<löux/ëhîdevi˚.h
>

7 
	~<löux/kî√l.h
>

8 
	~<löux/moduÀ.h
>

9 
	~<löux/sched.h
>

10 
	~<√t/mac80211.h
>

12 
	~"iwl-io.h
"

13 
	~"iwl-agn-hw.h
"

14 
	~"iwl-å™s.h
"

15 
	~"iwl-mod∑øms.h
"

17 
	~"dev.h
"

18 
	~"agn.h
"

20 
	$iwœgn_hw_vÆid_πc_d©a_addr
(
u32
 
addr
)

22  (
addr
 >
IWLAGN_RTC_DATA_LOWER_BOUND
) &&

23 (
addr
 < 
IWLAGN_RTC_DATA_UPPER_BOUND
);

24 
	}
}

26 
	$iwœgn_£nd_tx_powî
(
iwl_¥iv
 *
¥iv
)

28 
iwœgn_tx_powî_dbm_cmd
 
tx_powî_cmd
;

29 
u8
 
tx_™t_cfg_cmd
;

31 i‡(
	`WARN_ONCE
(
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
),

33  -
EAGAIN
;

36 
tx_powî_cmd
.
globÆ_lmt
 = (
s8
)(2 * 
¥iv
->
tx_powî_u£r_lmt
);

38 i‡(
tx_powî_cmd
.
globÆ_lmt
 > 
¥iv
->
nvm_d©a
->
max_tx_pwr_hÆf_dbm
) {

50 
tx_powî_cmd
.
globÆ_lmt
 =

51 
¥iv
->
nvm_d©a
->
max_tx_pwr_hÆf_dbm
;

53 
tx_powî_cmd
.
Êags
 = 
IWLAGN_TX_POWER_NO_CLOSED
;

54 
tx_powî_cmd
.
§v_ch™_lmt
 = 
IWLAGN_TX_POWER_AUTO
;

56 i‡(
	`IWL_UCODE_API
(
¥iv
->
fw
->
ucode_vî
) == 1)

57 
tx_™t_cfg_cmd
 = 
REPLY_TX_POWER_DBM_CMD_V1
;

59 
tx_™t_cfg_cmd
 = 
REPLY_TX_POWER_DBM_CMD
;

61  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
tx_™t_cfg_cmd
, 0,

62 (
tx_powî_cmd
), &tx_power_cmd);

63 
	}
}

65 
	$iwœgn_ãm≥øtuª
(
iwl_¥iv
 *
¥iv
)

67 
	`lockdï_as£π_hñd
(&
¥iv
->
°©i°ics
.
lock
);

70 
¥iv
->
ãm≥øtuª
 = 
	`À32_to_˝u
’riv->
°©i°ics
.
comm⁄
.temperature);

71 
	`iwl_â_h™dÀr
(
¥iv
);

72 
	}
}

74 
	$iwœgn_hwøã_to_mac80211_idx
(
u32
 
øã_n_Êags
, 
∆80211_b™d
 
b™d
)

76 
idx
 = 0;

77 
b™d_off£t
 = 0;

80 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK
) {

81 
idx
 = (
øã_n_Êags
 & 0xff);

82  
idx
;

85 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

86 
b™d_off£t
 = 
IWL_FIRST_OFDM_RATE
;

87 
idx
 = 
b™d_off£t
; idx < 
IWL_RATE_COUNT_LEGACY
; idx++)

88 i‡(
iwl_øãs
[
idx
].
∂˝
 =(
øã_n_Êags
 & 0xFF))

89  
idx
 - 
b™d_off£t
;

93 
	}
}

95 
	$iwœgn_m™age_ibss_°©i⁄
(
iwl_¥iv
 *
¥iv
,

96 
õì80211_vif
 *
vif
, 
boﬁ
 
add
)

98 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

100 i‡(
add
)

101  
	`iwœgn_add_bssid_°©i⁄
(
¥iv
, 
vif_¥iv
->
˘x
,

102 
vif
->
bss_c⁄f
.
bssid
,

103 &
vif_¥iv
->
ibss_bssid_°a_id
);

104  
	`iwl_ªmove_°©i⁄
(
¥iv
, 
vif_¥iv
->
ibss_bssid_°a_id
,

105 
vif
->
bss_c⁄f
.
bssid
);

106 
	}
}

115 
	$iwœgn_txfifo_Êush
(
iwl_¥iv
 *
¥iv
, 
u32
 
scd_q_msk
)

117 
iwl_txfifo_Êush_cmd_v3
 
Êush_cmd_v3
 = {

118 .
Êush_c⁄åﬁ
 = 
	`˝u_to_À16
(
IWL_DROP_ALL
),

120 
iwl_txfifo_Êush_cmd_v2
 
Êush_cmd_v2
 = {

121 .
Êush_c⁄åﬁ
 = 
	`˝u_to_À16
(
IWL_DROP_ALL
),

124 
u32
 
queue_c⁄åﬁ
 = 
IWL_SCD_VO_MSK
 | 
IWL_SCD_VI_MSK
 |

125 
IWL_SCD_BE_MSK
 | 
IWL_SCD_BK_MSK
 | 
IWL_SCD_MGMT_MSK
;

127 i‡((
¥iv
->
vÆid_c⁄ãxts
 !
	`BIT
(
IWL_RXON_CTX_BSS
)))

128 
queue_c⁄åﬁ
 |
IWL_PAN_SCD_VO_MSK
 | 
IWL_PAN_SCD_VI_MSK
 |

129 
IWL_PAN_SCD_BE_MSK
 | 
IWL_PAN_SCD_BK_MSK
 |

130 
IWL_PAN_SCD_MGMT_MSK
 |

131 
IWL_PAN_SCD_MULTICAST_MSK
;

133 i‡(
¥iv
->
nvm_d©a
->
sku_ˇp_11n_íabÀ
)

134 
queue_c⁄åﬁ
 |
IWL_AGG_TX_QUEUE_MSK
;

136 i‡(
scd_q_msk
)

137 
queue_c⁄åﬁ
 = 
scd_q_msk
;

139 
	`IWL_DEBUG_INFO
(
¥iv
, "queuêc⁄åﬁ: 0x%x\n", 
queue_c⁄åﬁ
);

140 
Êush_cmd_v3
.
queue_c⁄åﬁ
 = 
	`˝u_to_À32
(queue_control);

141 
Êush_cmd_v2
.
queue_c⁄åﬁ
 = 
	`˝u_to_À16
((
u16
)queue_control);

143 i‡(
	`IWL_UCODE_API
(
¥iv
->
fw
->
ucode_vî
) > 2)

144  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_TXFIFO_FLUSH
, 0,

145 (
Êush_cmd_v3
),

146 &
Êush_cmd_v3
);

147  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_TXFIFO_FLUSH
, 0,

148 (
Êush_cmd_v2
), &flush_cmd_v2);

149 
	}
}

151 
	$iwœgn_dev_txfifo_Êush
(
iwl_¥iv
 *
¥iv
)

153 
	`muãx_lock
(&
¥iv
->
muãx
);

154 
	`õì80211_°›_queues
(
¥iv
->
hw
);

155 i‡(
	`iwœgn_txfifo_Êush
(
¥iv
, 0)) {

156 
	`IWL_ERR
(
¥iv
, "flushÑequest fail\n");

157 
d⁄e
;

159 
	`IWL_DEBUG_INFO
(
¥iv
, "waitÅransmit/flusháll frames\n");

160 
	`iwl_å™s_waô_tx_queues_em±y
(
¥iv
->
å™s
, 0xffffffff);

161 
d⁄e
:

162 
	`õì80211_wake_queues
(
¥iv
->
hw
);

163 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

164 
	}
}

170 c⁄° 
__À32
 
	giwœgn_def_3w_lookup
[
IWLAGN_BT_DECISION_LUT_SIZE
] = {

171 
˝u_to_À32
(0xaaaaaaaa),

172 
˝u_to_À32
(0xaaaaaaaa),

173 
˝u_to_À32
(0xaeaaaaaa),

174 
˝u_to_À32
(0xaaaaaaaa),

175 
˝u_to_À32
(0xcc00ff28),

176 
˝u_to_À32
(0x0000aaaa),

177 
˝u_to_À32
(0xcc00aaaa),

178 
˝u_to_À32
(0x0000aaaa),

179 
˝u_to_À32
(0xc0004000),

180 
˝u_to_À32
(0x00004000),

181 
˝u_to_À32
(0xf0005000),

182 
˝u_to_À32
(0xf0005000),

186 c⁄° 
__À32
 
	giwœgn_c⁄cuºít_lookup
[
IWLAGN_BT_DECISION_LUT_SIZE
] = {

187 
˝u_to_À32
(0xaaaaaaaa),

188 
˝u_to_À32
(0xaaaaaaaa),

189 
˝u_to_À32
(0xaaaaaaaa),

190 
˝u_to_À32
(0xaaaaaaaa),

191 
˝u_to_À32
(0xaaaaaaaa),

192 
˝u_to_À32
(0xaaaaaaaa),

193 
˝u_to_À32
(0xaaaaaaaa),

194 
˝u_to_À32
(0xaaaaaaaa),

195 
˝u_to_À32
(0x00000000),

196 
˝u_to_À32
(0x00000000),

197 
˝u_to_À32
(0x00000000),

198 
˝u_to_À32
(0x00000000),

201 
	$iwœgn_£nd_adv™˚_bt_c⁄fig
(
iwl_¥iv
 *
¥iv
)

203 
iwl_basic_bt_cmd
 
basic
 = {

204 .
max_kûl
 = 
IWLAGN_BT_MAX_KILL_DEFAULT
,

205 .
bt3_timî_t7_vÆue
 = 
IWLAGN_BT3_T7_DEFAULT
,

206 .
bt3_¥io_ßm∂e_time
 = 
IWLAGN_BT3_PRIO_SAMPLE_DEFAULT
,

207 .
bt3_timî_t2_vÆue
 = 
IWLAGN_BT3_T2_DEFAULT
,

209 
iwl_bt_cmd_v1
 
bt_cmd_v1
;

210 
iwl_bt_cmd_v2
 
bt_cmd_v2
;

211 
ªt
;

213 
	`BUILD_BUG_ON
((
iwœgn_def_3w_lookup
) !=

214 (
basic
.
bt3_lookup_èbÀ
));

216 i‡(
¥iv
->
lib
->
bt_∑øms
) {

223 i‡(
¥iv
->
lib
->
bt_∑øms
->
bt_£ssi⁄_2
) {

224 
bt_cmd_v2
.
¥io_boo°
 = 
	`˝u_to_À32
(

225 
¥iv
->
lib
->
bt_∑øms
->
bt_¥io_boo°
);

226 
bt_cmd_v2
.
tx_¥io_boo°
 = 0;

227 
bt_cmd_v2
.
rx_¥io_boo°
 = 0;

230 
	`WARN_ON
(
¥iv
->
lib
->
bt_∑øms
->
bt_¥io_boo°
 & ~0xFF);

231 
bt_cmd_v1
.
¥io_boo°
 =

232 
¥iv
->
lib
->
bt_∑øms
->
bt_¥io_boo°
;

233 
bt_cmd_v1
.
tx_¥io_boo°
 = 0;

234 
bt_cmd_v1
.
rx_¥io_boo°
 = 0;

237 
	`IWL_ERR
(
¥iv
, "failedÅo construct BT Coex Config\n");

251 
basic
.
kûl_ack_mask
 = 
¥iv
->kill_ack_mask;

252 
basic
.
kûl_˘s_mask
 = 
¥iv
->kill_cts_mask;

253 i‡(
¥iv
->
ªdu˚d_txpowî
)

254 
basic
.
ªdu˚_txpowî
 = 
IWLAGN_BT_REDUCED_TX_PWR
;

255 
basic
.
vÆid
 = 
¥iv
->
bt_vÆid
;

263 i‡(!
iwlwifi_mod_∑øms
.
bt_c€x_a˘ive
 ||

264 
¥iv
->
iw_mode
 =
NL80211_IFTYPE_ADHOC
) {

265 
basic
.
Êags
 = 
IWLAGN_BT_FLAG_COEX_MODE_DISABLED
;

267 
basic
.
Êags
 = 
IWLAGN_BT_FLAG_COEX_MODE_3W
 <<

268 
IWLAGN_BT_FLAG_COEX_MODE_SHIFT
;

270 i‡(!
¥iv
->
bt_íabÀ_p•ﬁl
)

271 
basic
.
Êags
 |
IWLAGN_BT_FLAG_SYNC_2_BT_DISABLE
;

273 
basic
.
Êags
 &~
IWLAGN_BT_FLAG_SYNC_2_BT_DISABLE
;

275 i‡(
¥iv
->
bt_ch_™noun˚
)

276 
basic
.
Êags
 |
IWLAGN_BT_FLAG_CHANNEL_INHIBITION
;

277 
	`IWL_DEBUG_COEX
(
¥iv
, "BT c€x fœg: 0X%x\n", 
basic
.
Êags
);

279 
¥iv
->
bt_íabÀ_Êag
 = 
basic
.
Êags
;

280 i‡(
¥iv
->
bt_fuŒ_c⁄cuºít
)

281 
	`mem˝y
(
basic
.
bt3_lookup_èbÀ
, 
iwœgn_c⁄cuºít_lookup
,

282 (
iwœgn_c⁄cuºít_lookup
));

284 
	`mem˝y
(
basic
.
bt3_lookup_èbÀ
, 
iwœgn_def_3w_lookup
,

285 (
iwœgn_def_3w_lookup
));

287 
	`IWL_DEBUG_COEX
(
¥iv
, "BT coex %s in %s mode\n",

288 
basic
.
Êags
 ? "active" : "disabled",

289 
¥iv
->
bt_fuŒ_c⁄cuºít
 ?

292 i‡(
¥iv
->
lib
->
bt_∑øms
->
bt_£ssi⁄_2
) {

293 
	`mem˝y
(&
bt_cmd_v2
.
basic
, &basic,

294 (
basic
));

295 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_BT_CONFIG
,

296 0, (
bt_cmd_v2
), &bt_cmd_v2);

298 
	`mem˝y
(&
bt_cmd_v1
.
basic
, &basic,

299 (
basic
));

300 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_BT_CONFIG
,

301 0, (
bt_cmd_v1
), &bt_cmd_v1);

303 i‡(
ªt
)

304 
	`IWL_ERR
(
¥iv
, "failedÅo send BT Coex Config\n");

306 
	}
}

308 
	$iwœgn_bt_adju°_rssi_m⁄ô‹
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
rssi_ía
)

310 
iwl_rx⁄_c⁄ãxt
 *
˘x
, *
found_˘x
 = 
NULL
;

311 
boﬁ
 
found_≠
 = 
Ál£
;

313 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

316 i‡(
rssi_ía
) {

317 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

318 i‡(
˘x
->
vif
 && ctx->vif->
ty≥
 =
NL80211_IFTYPE_AP
 &&

319 
	`iwl_is_assocüãd_˘x
(
˘x
)) {

320 
found_≠
 = 
åue
;

330 i‡(!
rssi_ía
 || 
found_≠
) {

331 i‡(
¥iv
->
cur_rssi_˘x
) {

332 
˘x
 = 
¥iv
->
cur_rssi_˘x
;

333 
	`õì80211_dißbÀ_rssi_ªp‹ts
(
˘x
->
vif
);

334 
¥iv
->
cur_rssi_˘x
 = 
NULL
;

343 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

344 i‡(
˘x
->
vif
 && ctx->vif->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

345 
	`iwl_is_assocüãd_˘x
(
˘x
)) {

346 
found_˘x
 = 
˘x
;

355 i‡(
found_˘x
 =
¥iv
->
cur_rssi_˘x
)

364 i‡(
¥iv
->
cur_rssi_˘x
) {

365 
˘x
 = 
¥iv
->
cur_rssi_˘x
;

366 i‡(
˘x
->
vif
)

367 
	`õì80211_dißbÀ_rssi_ªp‹ts
(
˘x
->
vif
);

370 
¥iv
->
cur_rssi_˘x
 = 
found_˘x
;

372 i‡(!
found_˘x
)

375 
	`õì80211_íabÀ_rssi_ªp‹ts
(
found_˘x
->
vif
,

376 
IWLAGN_BT_PSP_MIN_RSSI_THRESHOLD
,

377 
IWLAGN_BT_PSP_MAX_RSSI_THRESHOLD
);

378 
	}
}

380 
boﬁ
 
	$iwœgn_bt_åaffic_is_sco
(
iwl_bt_u¨t_msg
 *
u¨t_msg
)

382  (
BT_UART_MSG_FRAME3SCOESCO_MSK
 & 
u¨t_msg
->
‰ame3
) >>

383 
BT_UART_MSG_FRAME3SCOESCO_POS
;

384 
	}
}

386 
	$iwœgn_bt_åaffic_ch™ge_w‹k
(
w‹k_°ru˘
 *
w‹k
)

388 
iwl_¥iv
 *
¥iv
 =

389 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
bt_åaffic_ch™ge_w‹k
);

390 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

391 
smps_ªque°
 = -1;

393 i‡(
¥iv
->
bt_íabÀ_Êag
 =
IWLAGN_BT_FLAG_COEX_MODE_DISABLED
) {

403 
	`IWL_DEBUG_COEX
(
¥iv
, "BTÅrafficÜoad changes: %d\n",

404 
¥iv
->
bt_åaffic_lﬂd
);

406 
¥iv
->
bt_åaffic_lﬂd
) {

407 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
:

408 i‡(
¥iv
->
bt_°©us
)

409 
smps_ªque°
 = 
IEEE80211_SMPS_DYNAMIC
;

411 
smps_ªque°
 = 
IEEE80211_SMPS_AUTOMATIC
;

413 
IWL_BT_COEX_TRAFFIC_LOAD_LOW
:

414 
smps_ªque°
 = 
IEEE80211_SMPS_DYNAMIC
;

416 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
:

417 
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
:

418 
smps_ªque°
 = 
IEEE80211_SMPS_STATIC
;

421 
	`IWL_ERR
(
¥iv
, "Invalid BTÅrafficÜoad: %d\n",

422 
¥iv
->
bt_åaffic_lﬂd
);

426 
	`muãx_lock
(&
¥iv
->
muãx
);

435 i‡(
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
))

436 
out
;

438 
	`iwl_upd©e_chaö_Êags
(
¥iv
);

440 i‡(
smps_ªque°
 != -1) {

441 
¥iv
->
cuºít_ht_c⁄fig
.
smps
 = 
smps_ªque°
;

442 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

443 i‡(
˘x
->
vif
 && ctx->vif->
ty≥
 =
NL80211_IFTYPE_STATION
)

444 
	`õì80211_ªque°_smps
(
˘x
->
vif
, 0, 
smps_ªque°
);

452 
	`iwœgn_bt_c€x_rssi_m⁄ô‹
(
¥iv
);

453 
out
:

454 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

455 
	}
}

462 
	$iwœgn_bt_c€x_rssi_m⁄ô‹
(
iwl_¥iv
 *
¥iv
)

464 i‡(
¥iv
->
bt_is_sco
 &&

465 
¥iv
->
bt_åaffic_lﬂd
 =
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
)

466 
	`iwœgn_bt_adju°_rssi_m⁄ô‹
(
¥iv
, 
åue
);

468 
	`iwœgn_bt_adju°_rssi_m⁄ô‹
(
¥iv
, 
Ál£
);

469 
	}
}

471 
	$iwœgn_¥öt_u¨tmsg
(
iwl_¥iv
 *
¥iv
,

472 
iwl_bt_u¨t_msg
 *
u¨t_msg
)

474 
	`IWL_DEBUG_COEX
(
¥iv
, "Message Type = 0x%X, SSN = 0x%X, "

476 (
BT_UART_MSG_FRAME1MSGTYPE_MSK
 & 
u¨t_msg
->
‰ame1
) >>

477 
BT_UART_MSG_FRAME1MSGTYPE_POS
,

478 (
BT_UART_MSG_FRAME1SSN_MSK
 & 
u¨t_msg
->
‰ame1
) >>

479 
BT_UART_MSG_FRAME1SSN_POS
,

480 (
BT_UART_MSG_FRAME1UPDATEREQ_MSK
 & 
u¨t_msg
->
‰ame1
) >>

481 
BT_UART_MSG_FRAME1UPDATEREQ_POS
);

483 
	`IWL_DEBUG_COEX
(
¥iv
, "Open connections = 0x%X, TrafficÜoad = 0x%X, "

485 (
BT_UART_MSG_FRAME2OPENCONNECTIONS_MSK
 & 
u¨t_msg
->
‰ame2
) >>

486 
BT_UART_MSG_FRAME2OPENCONNECTIONS_POS
,

487 (
BT_UART_MSG_FRAME2TRAFFICLOAD_MSK
 & 
u¨t_msg
->
‰ame2
) >>

488 
BT_UART_MSG_FRAME2TRAFFICLOAD_POS
,

489 (
BT_UART_MSG_FRAME2CHLSEQN_MSK
 & 
u¨t_msg
->
‰ame2
) >>

490 
BT_UART_MSG_FRAME2CHLSEQN_POS
,

491 (
BT_UART_MSG_FRAME2INBAND_MSK
 & 
u¨t_msg
->
‰ame2
) >>

492 
BT_UART_MSG_FRAME2INBAND_POS
);

494 
	`IWL_DEBUG_COEX
(
¥iv
, "SCO/eSCO = 0x%X, Sniff = 0x%X, A2DP = 0x%X, "

496 (
BT_UART_MSG_FRAME3SCOESCO_MSK
 & 
u¨t_msg
->
‰ame3
) >>

497 
BT_UART_MSG_FRAME3SCOESCO_POS
,

498 (
BT_UART_MSG_FRAME3SNIFF_MSK
 & 
u¨t_msg
->
‰ame3
) >>

499 
BT_UART_MSG_FRAME3SNIFF_POS
,

500 (
BT_UART_MSG_FRAME3A2DP_MSK
 & 
u¨t_msg
->
‰ame3
) >>

501 
BT_UART_MSG_FRAME3A2DP_POS
,

502 (
BT_UART_MSG_FRAME3ACL_MSK
 & 
u¨t_msg
->
‰ame3
) >>

503 
BT_UART_MSG_FRAME3ACL_POS
,

504 (
BT_UART_MSG_FRAME3MASTER_MSK
 & 
u¨t_msg
->
‰ame3
) >>

505 
BT_UART_MSG_FRAME3MASTER_POS
,

506 (
BT_UART_MSG_FRAME3OBEX_MSK
 & 
u¨t_msg
->
‰ame3
) >>

507 
BT_UART_MSG_FRAME3OBEX_POS
);

509 
	`IWL_DEBUG_COEX
(
¥iv
, "Idle duration = 0x%X\n",

510 (
BT_UART_MSG_FRAME4IDLEDURATION_MSK
 & 
u¨t_msg
->
‰ame4
) >>

511 
BT_UART_MSG_FRAME4IDLEDURATION_POS
);

513 
	`IWL_DEBUG_COEX
(
¥iv
, "Tx Activity = 0x%X, Rx Activity = 0x%X, "

515 (
BT_UART_MSG_FRAME5TXACTIVITY_MSK
 & 
u¨t_msg
->
‰ame5
) >>

516 
BT_UART_MSG_FRAME5TXACTIVITY_POS
,

517 (
BT_UART_MSG_FRAME5RXACTIVITY_MSK
 & 
u¨t_msg
->
‰ame5
) >>

518 
BT_UART_MSG_FRAME5RXACTIVITY_POS
,

519 (
BT_UART_MSG_FRAME5ESCORETRANSMIT_MSK
 & 
u¨t_msg
->
‰ame5
) >>

520 
BT_UART_MSG_FRAME5ESCORETRANSMIT_POS
);

522 
	`IWL_DEBUG_COEX
(
¥iv
, "Sniff Interval = 0x%X, Discoverable = 0x%X\n",

523 (
BT_UART_MSG_FRAME6SNIFFINTERVAL_MSK
 & 
u¨t_msg
->
‰ame6
) >>

524 
BT_UART_MSG_FRAME6SNIFFINTERVAL_POS
,

525 (
BT_UART_MSG_FRAME6DISCOVERABLE_MSK
 & 
u¨t_msg
->
‰ame6
) >>

526 
BT_UART_MSG_FRAME6DISCOVERABLE_POS
);

528 
	`IWL_DEBUG_COEX
(
¥iv
, "Sniff Activity = 0x%X, Page = "

530 (
BT_UART_MSG_FRAME7SNIFFACTIVITY_MSK
 & 
u¨t_msg
->
‰ame7
) >>

531 
BT_UART_MSG_FRAME7SNIFFACTIVITY_POS
,

532 (
BT_UART_MSG_FRAME7PAGE_MSK
 & 
u¨t_msg
->
‰ame7
) >>

533 
BT_UART_MSG_FRAME7PAGE_POS
,

534 (
BT_UART_MSG_FRAME7INQUIRY_MSK
 & 
u¨t_msg
->
‰ame7
) >>

535 
BT_UART_MSG_FRAME7INQUIRY_POS
,

536 (
BT_UART_MSG_FRAME7CONNECTABLE_MSK
 & 
u¨t_msg
->
‰ame7
) >>

537 
BT_UART_MSG_FRAME7CONNECTABLE_POS
);

538 
	}
}

540 
boﬁ
 
	$iwœgn_£t_kûl_msk
(
iwl_¥iv
 *
¥iv
,

541 
iwl_bt_u¨t_msg
 *
u¨t_msg
)

543 
boﬁ
 
√ed_upd©e
 = 
Ál£
;

544 
u8
 
kûl_msk
 = 
IWL_BT_KILL_REDUCE
;

545 c⁄° 
__À32
 
bt_kûl_ack_msg
[3] = {

546 
IWLAGN_BT_KILL_ACK_MASK_DEFAULT
,

547 
IWLAGN_BT_KILL_ACK_CTS_MASK_SCO
,

548 
IWLAGN_BT_KILL_ACK_CTS_MASK_REDUCE
};

549 c⁄° 
__À32
 
bt_kûl_˘s_msg
[3] = {

550 
IWLAGN_BT_KILL_CTS_MASK_DEFAULT
,

551 
IWLAGN_BT_KILL_ACK_CTS_MASK_SCO
,

552 
IWLAGN_BT_KILL_ACK_CTS_MASK_REDUCE
};

554 i‡(!
¥iv
->
ªdu˚d_txpowî
)

555 
kûl_msk
 = (
BT_UART_MSG_FRAME3SCOESCO_MSK
 & 
u¨t_msg
->
‰ame3
)

556 ? 
IWL_BT_KILL_OVERRIDE
 : 
IWL_BT_KILL_DEFAULT
;

557 i‡(
¥iv
->
kûl_ack_mask
 !
bt_kûl_ack_msg
[
kûl_msk
] ||

558 
¥iv
->
kûl_˘s_mask
 !
bt_kûl_˘s_msg
[
kûl_msk
]) {

559 
¥iv
->
bt_vÆid
 |
IWLAGN_BT_VALID_KILL_ACK_MASK
;

560 
¥iv
->
kûl_ack_mask
 = 
bt_kûl_ack_msg
[
kûl_msk
];

561 
¥iv
->
bt_vÆid
 |
IWLAGN_BT_VALID_KILL_CTS_MASK
;

562 
¥iv
->
kûl_˘s_mask
 = 
bt_kûl_˘s_msg
[
kûl_msk
];

563 
√ed_upd©e
 = 
åue
;

565  
√ed_upd©e
;

566 
	}
}

577 
boﬁ
 
	$iwœgn_fûl_txpowî_mode
(
iwl_¥iv
 *
¥iv
,

578 
iwl_bt_u¨t_msg
 *
u¨t_msg
)

580 
boﬁ
 
√ed_upd©e
 = 
Ál£
;

581 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

582 
ave_rssi
;

584 i‡(!
˘x
->
vif
 || (˘x->vif->
ty≥
 !
NL80211_IFTYPE_STATION
)) {

585 
	`IWL_DEBUG_INFO
(
¥iv
, "BSS ctxÇotáctive orÇot in sta mode\n");

586  
Ál£
;

589 
ave_rssi
 = 
	`õì80211_ave_rssi
(
˘x
->
vif
);

590 i‡(!
ave_rssi
) {

592 
	`IWL_DEBUG_COEX
(
¥iv
, "noÑssi dataávailable\n");

593  
√ed_upd©e
;

595 i‡(!
¥iv
->
ªdu˚d_txpowî
 &&

596 !
	`iwl_is_assocüãd
(
¥iv
, 
IWL_RXON_CTX_PAN
) &&

597 (
ave_rssi
 > 
BT_ENABLE_REDUCED_TXPOWER_THRESHOLD
) &&

598 (
u¨t_msg
->
‰ame3
 & (
BT_UART_MSG_FRAME3ACL_MSK
 |

599 
BT_UART_MSG_FRAME3OBEX_MSK
)) &&

600 !(
u¨t_msg
->
‰ame3
 & (
BT_UART_MSG_FRAME3SCOESCO_MSK
 |

601 
BT_UART_MSG_FRAME3SNIFF_MSK
 | 
BT_UART_MSG_FRAME3A2DP_MSK
))) {

603 
¥iv
->
ªdu˚d_txpowî
 = 
åue
;

604 
¥iv
->
bt_vÆid
 |
IWLAGN_BT_VALID_REDUCED_TX_PWR
;

605 
√ed_upd©e
 = 
åue
;

606 } i‡(
¥iv
->
ªdu˚d_txpowî
 &&

607 (
	`iwl_is_assocüãd
(
¥iv
, 
IWL_RXON_CTX_PAN
) ||

608 (
ave_rssi
 < 
BT_DISABLE_REDUCED_TXPOWER_THRESHOLD
) ||

609 (
u¨t_msg
->
‰ame3
 & (
BT_UART_MSG_FRAME3SCOESCO_MSK
 |

610 
BT_UART_MSG_FRAME3SNIFF_MSK
 | 
BT_UART_MSG_FRAME3A2DP_MSK
)) ||

611 !(
u¨t_msg
->
‰ame3
 & (
BT_UART_MSG_FRAME3ACL_MSK
 |

612 
BT_UART_MSG_FRAME3OBEX_MSK
)))) {

614 
¥iv
->
ªdu˚d_txpowî
 = 
Ál£
;

615 
¥iv
->
bt_vÆid
 |
IWLAGN_BT_VALID_REDUCED_TX_PWR
;

616 
√ed_upd©e
 = 
åue
;

619  
√ed_upd©e
;

620 
	}
}

622 
	$iwœgn_bt_c€x_¥ofûe_nŸif
(
iwl_¥iv
 *
¥iv
,

623 
iwl_rx_cmd_buf„r
 *
rxb
)

625 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

626 
iwl_bt_c€x_¥ofûe_nŸif
 *
c€x
 = (*)
pkt
->
d©a
;

627 
iwl_bt_u¨t_msg
 *
u¨t_msg
 = &
c€x
->
œ°_bt_u¨t_msg
;

629 i‡(
¥iv
->
bt_íabÀ_Êag
 =
IWLAGN_BT_FLAG_COEX_MODE_DISABLED
) {

634 
	`IWL_DEBUG_COEX
(
¥iv
, "BT CoexÇotification:\n");

635 
	`IWL_DEBUG_COEX
(
¥iv
, " sètus: %d\n", 
c€x
->
bt_°©us
);

636 
	`IWL_DEBUG_COEX
(
¥iv
, "Åøffi¯lﬂd: %d\n", 
c€x
->
bt_åaffic_lﬂd
);

637 
	`IWL_DEBUG_COEX
(
¥iv
, " CI compliance: %d\n",

638 
c€x
->
bt_ci_com∂ün˚
);

639 
	`iwœgn_¥öt_u¨tmsg
(
¥iv
, 
u¨t_msg
);

641 
¥iv
->
œ°_bt_åaffic_lﬂd
 =Öriv->
bt_åaffic_lﬂd
;

642 
¥iv
->
bt_is_sco
 = 
	`iwœgn_bt_åaffic_is_sco
(
u¨t_msg
);

644 i‡(
¥iv
->
iw_mode
 !
NL80211_IFTYPE_ADHOC
) {

645 i‡(
¥iv
->
bt_°©us
 !
c€x
->bt_status ||

646 
¥iv
->
œ°_bt_åaffic_lﬂd
 !
c€x
->
bt_åaffic_lﬂd
) {

647 i‡(
c€x
->
bt_°©us
) {

649 i‡(!
¥iv
->
bt_ch_™noun˚
)

650 
¥iv
->
bt_åaffic_lﬂd
 =

651 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
;

653 
¥iv
->
bt_åaffic_lﬂd
 =

654 
c€x
->
bt_åaffic_lﬂd
;

657 
¥iv
->
bt_åaffic_lﬂd
 =

658 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
;

660 
¥iv
->
bt_°©us
 = 
c€x
->bt_status;

661 
	`queue_w‹k
(
¥iv
->
w‹kqueue
,

662 &
¥iv
->
bt_åaffic_ch™ge_w‹k
);

668 i‡(
	`iwœgn_fûl_txpowî_mode
(
¥iv
, 
u¨t_msg
) ||

669 
	`iwœgn_£t_kûl_msk
(
¥iv
, 
u¨t_msg
))

670 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
bt_ru¡ime_c⁄fig
);

675 
¥iv
->
bt_ci_com∂ün˚
 = 
c€x
->bt_ci_compliance;

676 
	}
}

678 
	$iwœgn_bt_rx_h™dÀr_£tup
(
iwl_¥iv
 *
¥iv
)

680 
¥iv
->
rx_h™dÀrs
[
REPLY_BT_COEX_PROFILE_NOTIF
] =

681 
iwœgn_bt_c€x_¥ofûe_nŸif
;

682 
	}
}

684 
	$iwœgn_bt_£tup_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
)

686 
	`INIT_WORK
(&
¥iv
->
bt_åaffic_ch™ge_w‹k
,

687 
iwœgn_bt_åaffic_ch™ge_w‹k
);

688 
	}
}

690 
	$iwœgn_bt_ˇn˚l_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
)

692 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
bt_åaffic_ch™ge_w‹k
);

693 
	}
}

695 
boﬁ
 
	$is_sögÀ_rx_°ªam
(
iwl_¥iv
 *
¥iv
)

697  
¥iv
->
cuºít_ht_c⁄fig
.
smps
 =
IEEE80211_SMPS_STATIC
 ||

698 
¥iv
->
cuºít_ht_c⁄fig
.
sögÀ_chaö_sufficõ¡
;

699 
	}
}

701 
	#IWL_NUM_RX_CHAINS_MULTIPLE
 3

	)

702 
	#IWL_NUM_RX_CHAINS_SINGLE
 2

	)

703 
	#IWL_NUM_IDLE_CHAINS_DUAL
 2

	)

704 
	#IWL_NUM_IDLE_CHAINS_SINGLE
 1

	)

716 
	$iwl_gë_a˘ive_rx_chaö_cou¡
(
iwl_¥iv
 *
¥iv
)

718 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

719 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
 &&

720 (
¥iv
->
bt_fuŒ_c⁄cuºít
 ||

721 
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
)) {

726  
IWL_NUM_RX_CHAINS_SINGLE
;

729 i‡(
	`is_sögÀ_rx_°ªam
(
¥iv
))

730  
IWL_NUM_RX_CHAINS_SINGLE
;

732  
IWL_NUM_RX_CHAINS_MULTIPLE
;

733 
	}
}

739 
	$iwl_gë_idÀ_rx_chaö_cou¡
(
iwl_¥iv
 *
¥iv
, 
a˘ive_˙t
)

742 
¥iv
->
cuºít_ht_c⁄fig
.
smps
) {

743 
IEEE80211_SMPS_STATIC
:

744 
IEEE80211_SMPS_DYNAMIC
:

745  
IWL_NUM_IDLE_CHAINS_SINGLE
;

746 
IEEE80211_SMPS_AUTOMATIC
:

747 
IEEE80211_SMPS_OFF
:

748  
a˘ive_˙t
;

750 
	`WARN
(1, "invalid SMPS mode %d",

751 
¥iv
->
cuºít_ht_c⁄fig
.
smps
);

752  
a˘ive_˙t
;

754 
	}
}

757 
u8
 
	$iwl_cou¡_chaö_bôm≠
(
u32
 
chaö_bôm≠
)

759 
u8
 
ªs
;

760 
ªs
 = (
chaö_bôm≠
 & 
	`BIT
(0)) >> 0;

761 
ªs
 +(
chaö_bôm≠
 & 
	`BIT
(1)) >> 1;

762 
ªs
 +(
chaö_bôm≠
 & 
	`BIT
(2)) >> 2;

763 
ªs
 +(
chaö_bôm≠
 & 
	`BIT
(3)) >> 3;

764  
ªs
;

765 
	}
}

773 
	$iwœgn_£t_rx⁄_chaö
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

775 
boﬁ
 
is_sögÀ
 = 
	`is_sögÀ_rx_°ªam
(
¥iv
);

776 
boﬁ
 
is_ˇm
 = !
	`ã°_bô
(
STATUS_POWER_PMI
, &
¥iv
->
°©us
);

777 
u8
 
idÀ_rx_˙t
, 
a˘ive_rx_˙t
, 
vÆid_rx_˙t
;

778 
u32
 
a˘ive_chaös
;

779 
u16
 
rx_chaö
;

785 i‡(
¥iv
->
chaö_noi£_d©a
.
a˘ive_chaös
)

786 
a˘ive_chaös
 = 
¥iv
->
chaö_noi£_d©a
.active_chains;

788 
a˘ive_chaös
 = 
¥iv
->
nvm_d©a
->
vÆid_rx_™t
;

790 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

791 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
 &&

792 (
¥iv
->
bt_fuŒ_c⁄cuºít
 ||

793 
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
)) {

798 
a˘ive_chaös
 = 
	`fú°_™ã¬a
(active_chains);

801 
rx_chaö
 = 
a˘ive_chaös
 << 
RXON_RX_CHAIN_VALID_POS
;

804 
a˘ive_rx_˙t
 = 
	`iwl_gë_a˘ive_rx_chaö_cou¡
(
¥iv
);

805 
idÀ_rx_˙t
 = 
	`iwl_gë_idÀ_rx_chaö_cou¡
(
¥iv
, 
a˘ive_rx_˙t
);

811 
vÆid_rx_˙t
 = 
	`iwl_cou¡_chaö_bôm≠
(
a˘ive_chaös
);

812 i‡(
vÆid_rx_˙t
 < 
a˘ive_rx_˙t
)

813 
a˘ive_rx_˙t
 = 
vÆid_rx_˙t
;

815 i‡(
vÆid_rx_˙t
 < 
idÀ_rx_˙t
)

816 
idÀ_rx_˙t
 = 
vÆid_rx_˙t
;

818 
rx_chaö
 |
a˘ive_rx_˙t
 << 
RXON_RX_CHAIN_MIMO_CNT_POS
;

819 
rx_chaö
 |
idÀ_rx_˙t
 << 
RXON_RX_CHAIN_CNT_POS
;

821 
˘x
->
°agög
.
rx_chaö
 = 
	`˝u_to_À16
(rx_chain);

823 i‡(!
is_sögÀ
 && (
a˘ive_rx_˙t
 >
IWL_NUM_RX_CHAINS_SINGLE
Ë&& 
is_ˇm
)

824 
˘x
->
°agög
.
rx_chaö
 |
RXON_RX_CHAIN_MIMO_FORCE_MSK
;

826 
˘x
->
°agög
.
rx_chaö
 &~
RXON_RX_CHAIN_MIMO_FORCE_MSK
;

828 
	`IWL_DEBUG_ASSOC
(
¥iv
, "rx_chain=0x%Xáctive=%d idle=%d\n",

829 
˘x
->
°agög
.
rx_chaö
,

830 
a˘ive_rx_˙t
, 
idÀ_rx_˙t
);

832 
	`WARN_ON
(
a˘ive_rx_˙t
 =0 || 
idÀ_rx_˙t
 == 0 ||

833 
a˘ive_rx_˙t
 < 
idÀ_rx_˙t
);

834 
	}
}

836 
u8
 
	$iwl_toggÀ_tx_™t
(
iwl_¥iv
 *
¥iv
, 
u8
 
™t
, u8 
vÆid
)

838 
i
;

839 
u8
 
öd
 = 
™t
;

841 i‡(
¥iv
->
b™d
 =
NL80211_BAND_2GHZ
 &&

842 
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
)

845 
i
 = 0; i < 
RATE_ANT_NUM
 - 1; i++) {

846 
öd
 = (öd + 1Ë< 
RATE_ANT_NUM
 ? ind + 1 : 0;

847 i‡(
vÆid
 & 
	`BIT
(
öd
))

848  
öd
;

850  
™t
;

851 
	}
}

853 #ifde‡
CONFIG_PM_SLEEP


854 
	$iwœgn_c⁄vît_p1k
(
u16
 *
p1k
, 
__À16
 *
out
)

856 
i
;

858 
i
 = 0; i < 
IWLAGN_P1K_SIZE
; i++)

859 
out
[
i
] = 
	`˝u_to_À16
(
p1k
[i]);

860 
	}
}

862 
	swowœn_key_d©a
 {

863 
iwl_rx⁄_c⁄ãxt
 *
	m˘x
;

864 
iwœgn_wowœn_rsc_tsc_∑øms_cmd
 *
	mrsc_tsc
;

865 
iwœgn_wowœn_tkù_∑øms_cmd
 *
	mtkù
;

866 c⁄° 
u8
 *
	mbssid
;

867 
boﬁ
 
	mîr‹
, 
	mu£_rsc_tsc
, 
	mu£_tkù
;

871 
	$iwœgn_wowœn_¥ogøm_keys
(
õì80211_hw
 *
hw
,

872 
õì80211_vif
 *
vif
,

873 
õì80211_°a
 *
°a
,

874 
õì80211_key_c⁄f
 *
key
,

875 *
_d©a
)

877 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

878 
wowœn_key_d©a
 *
d©a
 = 
_d©a
;

879 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
d©a
->ctx;

880 
´s_sc
 *´s_sc, *
´s_tx_sc
 = 
NULL
;

881 
tkù_sc
 *tkù_sc, *
tkù_tx_sc
 = 
NULL
;

882 
iwœgn_p1k_ˇche
 *
rx_p1ks
;

883 
u8
 *
rx_mic_key
;

884 
õì80211_key_£q
 
£q
;

885 
u32
 
cur_rx_iv32
 = 0;

886 
u16
 
p1k
[
IWLAGN_P1K_SIZE
];

887 
ªt
, 
i
;

889 
	`muãx_lock
(&
¥iv
->
muãx
);

891 i‡((
key
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

892 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
) &&

893 !
°a
 && !
˘x
->
key_m≠pög_keys
)

894 
ªt
 = 
	`iwl_£t_deÁu…_wï_key
(
¥iv
, 
˘x
, 
key
);

896 
ªt
 = 
	`iwl_£t_dy«mic_key
(
¥iv
, 
˘x
, 
key
, 
°a
);

898 i‡(
ªt
) {

899 
	`IWL_ERR
(
¥iv
, "Error setting key during suspend!\n");

900 
d©a
->
îr‹
 = 
åue
;

903 
key
->
cùhî
) {

904 
WLAN_CIPHER_SUITE_TKIP
:

905 i‡(
°a
) {

906 
u64
 
≤64
;

908 
tkù_sc
 = 
d©a
->
rsc_tsc
->
Æl_tsc_rsc
.
tkù
.
uniˇ°_rsc
;

909 
tkù_tx_sc
 = &
d©a
->
rsc_tsc
->
Æl_tsc_rsc
.
tkù
.
tsc
;

911 
rx_p1ks
 = 
d©a
->
tkù
->
rx_uni
;

913 
≤64
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

914 
tkù_tx_sc
->
iv16
 = 
	`˝u_to_À16
(
	`TKIP_PN_TO_IV16
(
≤64
));

915 
tkù_tx_sc
->
iv32
 = 
	`˝u_to_À32
(
	`TKIP_PN_TO_IV32
(
≤64
));

917 
	`õì80211_gë_tkù_p1k_iv
(
key
, 
£q
.
tkù
.
iv32
, 
p1k
);

918 
	`iwœgn_c⁄vît_p1k
(
p1k
, 
d©a
->
tkù
->
tx
.p1k);

920 
	`mem˝y
(
d©a
->
tkù
->
mic_keys
.
tx
,

921 &
key
->key[
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
],

922 
IWLAGN_MIC_KEY_SIZE
);

924 
rx_mic_key
 = 
d©a
->
tkù
->
mic_keys
.
rx_uniˇ°
;

926 
tkù_sc
 =

927 
d©a
->
rsc_tsc
->
Æl_tsc_rsc
.
tkù
.
mu…iˇ°_rsc
;

928 
rx_p1ks
 = 
d©a
->
tkù
->
rx_mu…i
;

929 
rx_mic_key
 = 
d©a
->
tkù
->
mic_keys
.
rx_mˇ°
;

937 
i
 = 0; i < 
IWLAGN_NUM_RSC
; i++) {

938 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

939 
tkù_sc
[
i
].
iv16
 = 
	`˝u_to_À16
(
£q
.
tkù
.iv16);

940 
tkù_sc
[
i
].
iv32
 = 
	`˝u_to_À32
(
£q
.
tkù
.iv32);

942 i‡(
£q
.
tkù
.
iv32
 > 
cur_rx_iv32
)

943 
cur_rx_iv32
 = 
£q
.
tkù
.
iv32
;

946 
	`õì80211_gë_tkù_rx_p1k
(
key
, 
d©a
->
bssid
, 
cur_rx_iv32
, 
p1k
);

947 
	`iwœgn_c⁄vît_p1k
(
p1k
, 
rx_p1ks
[0].p1k);

948 
	`õì80211_gë_tkù_rx_p1k
(
key
, 
d©a
->
bssid
,

949 
cur_rx_iv32
 + 1, 
p1k
);

950 
	`iwœgn_c⁄vît_p1k
(
p1k
, 
rx_p1ks
[1].p1k);

952 
	`mem˝y
(
rx_mic_key
,

953 &
key
->key[
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
],

954 
IWLAGN_MIC_KEY_SIZE
);

956 
d©a
->
u£_tkù
 = 
åue
;

957 
d©a
->
u£_rsc_tsc
 = 
åue
;

959 
WLAN_CIPHER_SUITE_CCMP
:

960 i‡(
°a
) {

961 
u64
 
≤64
;

963 
´s_sc
 = 
d©a
->
rsc_tsc
->
Æl_tsc_rsc
.
´s
.
uniˇ°_rsc
;

964 
´s_tx_sc
 = &
d©a
->
rsc_tsc
->
Æl_tsc_rsc
.
´s
.
tsc
;

966 
≤64
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

967 
´s_tx_sc
->
≤
 = 
	`˝u_to_À64
(
≤64
);

969 
´s_sc
 = 
d©a
->
rsc_tsc
->
Æl_tsc_rsc
.
´s
.
mu…iˇ°_rsc
;

975 
i
 = 0; i < 
IWLAGN_NUM_RSC
; i++) {

976 
u8
 *
≤
 = 
£q
.
ccmp
.pn;

978 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

979 
´s_sc
[
i
].
≤
 = 
	`˝u_to_À64
(

980 (
u64
)
≤
[5] |

981 ((
u64
)
≤
[4] << 8) |

982 ((
u64
)
≤
[3] << 16) |

983 ((
u64
)
≤
[2] << 24) |

984 ((
u64
)
≤
[1] << 32) |

985 ((
u64
)
≤
[0] << 40));

987 
d©a
->
u£_rsc_tsc
 = 
åue
;

991 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

992 
	}
}

994 
	$iwœgn_£nd_∑âîns
(
iwl_¥iv
 *
¥iv
,

995 
cfg80211_wowœn
 *
wowœn
)

997 
iwœgn_wowœn_∑âîns_cmd
 *
∑âîn_cmd
;

998 
iwl_ho°_cmd
 
cmd
 = {

999 .
id
 = 
REPLY_WOWLAN_PATTERNS
,

1000 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

1002 
i
, 
îr
;

1004 i‡(!
wowœn
->
n_∑âîns
)

1007 
cmd
.
Àn
[0] = 
	`°ru˘_size
(
∑âîn_cmd
, 
∑âîns
, 
wowœn
->
n_∑âîns
);

1009 
∑âîn_cmd
 = 
	`kmÆloc
(
cmd
.
Àn
[0], 
GFP_KERNEL
);

1010 i‡(!
∑âîn_cmd
)

1011  -
ENOMEM
;

1013 
∑âîn_cmd
->
n_∑âîns
 = 
	`˝u_to_À32
(
wowœn
->n_patterns);

1015 
i
 = 0; i < 
wowœn
->
n_∑âîns
; i++) {

1016 
mask_Àn
 = 
	`DIV_ROUND_UP
(
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
, 8);

1018 
	`mem˝y
(&
∑âîn_cmd
->
∑âîns
[
i
].
mask
,

1019 
wowœn
->
∑âîns
[
i
].
mask
, 
mask_Àn
);

1020 
	`mem˝y
(&
∑âîn_cmd
->
∑âîns
[
i
].
∑âîn
,

1021 
wowœn
->
∑âîns
[
i
].
∑âîn
,

1022 
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
);

1023 
∑âîn_cmd
->
∑âîns
[
i
].
mask_size
 = 
mask_Àn
;

1024 
∑âîn_cmd
->
∑âîns
[
i
].
∑âîn_size
 =

1025 
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
;

1028 
cmd
.
d©a
[0] = 
∑âîn_cmd
;

1029 
îr
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

1030 
	`k‰ì
(
∑âîn_cmd
);

1031  
îr
;

1032 
	}
}

1034 
	$iwœgn_su•íd
(
iwl_¥iv
 *
¥iv
, 
cfg80211_wowœn
 *
wowœn
)

1036 
iwœgn_wowœn_wakeup_fûãr_cmd
 
wakeup_fûãr_cmd
;

1037 
iwl_rx⁄_cmd
 
rx⁄
;

1038 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

1039 
iwœgn_wowœn_kek_kck_m©îül_cmd
 
kek_kck_cmd
;

1040 
iwœgn_wowœn_tkù_∑øms_cmd
 
tkù_cmd
 = {};

1041 
iwœgn_d3_c⁄fig_cmd
 
d3_cfg_cmd
 = {

1047 .
mö_¶ìp_time
 = 
	`˝u_to_À32
(10 * 1000 * 1000),

1049 
wowœn_key_d©a
 
key_d©a
 = {

1050 .
˘x
 = ctx,

1051 .
bssid
 = 
˘x
->
a˘ive
.
bssid_addr
,

1052 .
u£_rsc_tsc
 = 
Ál£
,

1053 .
tkù
 = &
tkù_cmd
,

1054 .
u£_tkù
 = 
Ál£
,

1056 
ªt
, 
i
;

1057 
u16
 
£q
;

1059 
key_d©a
.
rsc_tsc
 = 
	`kzÆloc
((*key_d©a.rsc_tsc), 
GFP_KERNEL
);

1060 i‡(!
key_d©a
.
rsc_tsc
)

1061  -
ENOMEM
;

1063 
	`mem£t
(&
wakeup_fûãr_cmd
, 0, (wakeup_filter_cmd));

1069 
£q
 = 
	`À16_to_˝u
(
¥iv
->
œ°_£q_˘l
Ë& 
IEEE80211_SCTL_SEQ
;

1070 
wakeup_fûãr_cmd
.
n⁄_qos_£q
 = 
	`˝u_to_À16
(
£q
);

1076 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

1077 
£q
 = 
¥iv
->
tid_d©a
[
IWL_AP_ID
][
i
].
£q_numbî
;

1078 
£q
 -= 0x10;

1079 
wakeup_fûãr_cmd
.
qos_£q
[
i
] = 
	`˝u_to_À16
(
£q
);

1082 i‡(
wowœn
->
disc⁄√˘
)

1083 
wakeup_fûãr_cmd
.
íabÀd
 |=

1084 
	`˝u_to_À32
(
IWLAGN_WOWLAN_WAKEUP_BEACON_MISS
 |

1085 
IWLAGN_WOWLAN_WAKEUP_LINK_CHANGE
);

1086 i‡(
wowœn
->
magic_pkt
)

1087 
wakeup_fûãr_cmd
.
íabÀd
 |=

1088 
	`˝u_to_À32
(
IWLAGN_WOWLAN_WAKEUP_MAGIC_PACKET
);

1089 i‡(
wowœn
->
gtk_ªkey_Áûuª
)

1090 
wakeup_fûãr_cmd
.
íabÀd
 |=

1091 
	`˝u_to_À32
(
IWLAGN_WOWLAN_WAKEUP_GTK_REKEY_FAIL
);

1092 i‡(
wowœn
->
óp_idítôy_ªq
)

1093 
wakeup_fûãr_cmd
.
íabÀd
 |=

1094 
	`˝u_to_À32
(
IWLAGN_WOWLAN_WAKEUP_EAP_IDENT_REQ
);

1095 i‡(
wowœn
->
four_way_h™dshake
)

1096 
wakeup_fûãr_cmd
.
íabÀd
 |=

1097 
	`˝u_to_À32
(
IWLAGN_WOWLAN_WAKEUP_4WAY_HANDSHAKE
);

1098 i‡(
wowœn
->
n_∑âîns
)

1099 
wakeup_fûãr_cmd
.
íabÀd
 |=

1100 
	`˝u_to_À32
(
IWLAGN_WOWLAN_WAKEUP_PATTERN_MATCH
);

1102 i‡(
wowœn
->
rfkûl_ªÀa£
)

1103 
d3_cfg_cmd
.
wakeup_Êags
 |=

1104 
	`˝u_to_À32
(
IWLAGN_D3_WAKEUP_RFKILL
);

1106 
	`iwl_sˇn_ˇn˚l_timeout
(
¥iv
, 200);

1108 
	`mem˝y
(&
rx⁄
, &
˘x
->
a˘ive
, (rxon));

1110 
¥iv
->
ucode_lﬂded
 = 
Ál£
;

1111 
	`iwl_å™s_°›_devi˚
(
¥iv
->
å™s
);

1112 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
¥iv
->
å™s
);

1113 i‡(
ªt
)

1114 
out
;

1116 
¥iv
->
wowœn
 = 
åue
;

1118 
ªt
 = 
	`iwl_lﬂd_ucode_waô_Æive
(
¥iv
, 
IWL_UCODE_WOWLAN
);

1119 i‡(
ªt
)

1120 
out
;

1123 
ªt
 = 
	`iwl_Æive_°¨t
(
¥iv
);

1124 i‡(
ªt
)

1125 
out
;

1127 
	`mem˝y
(&
˘x
->
°agög
, &
rx⁄
, (rxon));

1128 
ªt
 = 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

1129 i‡(
ªt
)

1130 
out
;

1132 
ªt
 = 
	`iwl_powî_upd©e_mode
(
¥iv
, 
åue
);

1133 i‡(
ªt
)

1134 
out
;

1136 i‡(!
iwlwifi_mod_∑øms
.
sw¸y±o
) {

1138 
¥iv
->
ucode_key_èbÀ
 = 0;

1139 
˘x
->
key_m≠pög_keys
 = 0;

1146 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1147 
	`õì80211_ôî_keys
(
¥iv
->
hw
, 
˘x
->
vif
,

1148 
iwœgn_wowœn_¥ogøm_keys
,

1149 &
key_d©a
);

1150 
	`muãx_lock
(&
¥iv
->
muãx
);

1151 i‡(
key_d©a
.
îr‹
) {

1152 
ªt
 = -
EIO
;

1153 
out
;

1156 i‡(
key_d©a
.
u£_rsc_tsc
) {

1157 
iwl_ho°_cmd
 
rsc_tsc_cmd
 = {

1158 .
id
 = 
REPLY_WOWLAN_TSC_RSC_PARAMS
,

1159 .
d©a
[0] = 
key_d©a
.
rsc_tsc
,

1160 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

1161 .
Àn
[0] = (*
key_d©a
.
rsc_tsc
),

1164 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
rsc_tsc_cmd
);

1165 i‡(
ªt
)

1166 
out
;

1169 i‡(
key_d©a
.
u£_tkù
) {

1170 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

1171 
REPLY_WOWLAN_TKIP_PARAMS
,

1172 0, (
tkù_cmd
),

1173 &
tkù_cmd
);

1174 i‡(
ªt
)

1175 
out
;

1178 i‡(
¥iv
->
have_ªkey_d©a
) {

1179 
	`mem£t
(&
kek_kck_cmd
, 0, (kek_kck_cmd));

1180 
	`mem˝y
(
kek_kck_cmd
.
kck
, 
¥iv
->kck, 
NL80211_KCK_LEN
);

1181 
kek_kck_cmd
.
kck_Àn
 = 
	`˝u_to_À16
(
NL80211_KCK_LEN
);

1182 
	`mem˝y
(
kek_kck_cmd
.
kek
, 
¥iv
->kek, 
NL80211_KEK_LEN
);

1183 
kek_kck_cmd
.
kek_Àn
 = 
	`˝u_to_À16
(
NL80211_KEK_LEN
);

1184 
kek_kck_cmd
.
ª∂ay_˘r
 = 
¥iv
->replay_ctr;

1186 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

1187 
REPLY_WOWLAN_KEK_KCK_MATERIAL
,

1188 0, (
kek_kck_cmd
),

1189 &
kek_kck_cmd
);

1190 i‡(
ªt
)

1191 
out
;

1195 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_D3_CONFIG
, 0,

1196 (
d3_cfg_cmd
), &d3_cfg_cmd);

1197 i‡(
ªt
)

1198 
out
;

1200 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_WOWLAN_WAKEUP_FILTER
,

1201 0, (
wakeup_fûãr_cmd
),

1202 &
wakeup_fûãr_cmd
);

1203 i‡(
ªt
)

1204 
out
;

1206 
ªt
 = 
	`iwœgn_£nd_∑âîns
(
¥iv
, 
wowœn
);

1207 
out
:

1208 
	`k‰ì
(
key_d©a
.
rsc_tsc
);

1209  
ªt
;

1210 
	}
}

1213 
	$iwl_dvm_£nd_cmd
(
iwl_¥iv
 *
¥iv
, 
iwl_ho°_cmd
 *
cmd
)

1215 i‡(
	`iwl_is_rfkûl
(
¥iv
Ë|| 
	`iwl_is_˘kûl
(priv)) {

1216 
	`IWL_WARN
(
¥iv
, "Not sending command - %s KILL\n",

1217 
	`iwl_is_rfkûl
(
¥iv
) ? "RF" : "CT");

1218  -
EIO
;

1221 i‡(
	`ã°_bô
(
STATUS_FW_ERROR
, &
¥iv
->
°©us
)) {

1222 
	`IWL_ERR
(
¥iv
, "Command %s failed: FW Error\n",

1223 
	`iwl_gë_cmd_°rög
(
¥iv
->
å™s
, 
cmd
->
id
));

1224  -
EIO
;

1231 i‡(!
¥iv
->
ucode_lﬂded
) {

1232 
	`IWL_ERR
(
¥iv
, "FwÇŸÜﬂded - dr›pög CMD: %x\n", 
cmd
->
id
);

1233  -
EIO
;

1241 i‡(!(
cmd
->
Êags
 & 
CMD_ASYNC
))

1242 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1244  
	`iwl_å™s_£nd_cmd
(
¥iv
->
å™s
, 
cmd
);

1245 
	}
}

1247 
	$iwl_dvm_£nd_cmd_pdu
(
iwl_¥iv
 *
¥iv
, 
u8
 
id
,

1248 
u32
 
Êags
, 
u16
 
Àn
, c⁄° *
d©a
)

1250 
iwl_ho°_cmd
 
cmd
 = {

1251 .
id
 = id,

1252 .
Àn
 = {Üen, },

1253 .
d©a
 = { data, },

1254 .
Êags
 = flags,

1257  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

1258 
	}
}

	@dvm/mac80211.c

10 
	~<löux/kî√l.h
>

11 
	~<löux/moduÀ.h
>

12 
	~<löux/¶ab.h
>

13 
	~<löux/dma-m≠pög.h
>

14 
	~<löux/dñay.h
>

15 
	~<löux/sched.h
>

16 
	~<löux/skbuff.h
>

17 
	~<löux/√tdevi˚.h
>

18 
	~<löux/ëhîdevi˚.h
>

19 
	~<löux/if_¨p.h
>

21 
	~<√t/õì80211_ødiŸ≠.h
>

22 
	~<√t/mac80211.h
>

24 
	~<asm/div64.h
>

26 
	~"iwl-io.h
"

27 
	~"iwl-å™s.h
"

28 
	~"iwl-›-mode.h
"

29 
	~"iwl-mod∑øms.h
"

31 
	~"dev.h
"

32 
	~"ˇlib.h
"

33 
	~"agn.h
"

41 c⁄° 
õì80211_iÁ˚_limô
 
	giwœgn_°a_≠_limôs
[] = {

43 .
max
 = 1,

44 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

47 .
	gmax
 = 1,

48 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_AP
),

52 c⁄° 
õì80211_iÁ˚_limô
 
	giwœgn_2°a_limôs
[] = {

54 .
max
 = 2,

55 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

59 c⁄° 
õì80211_iÁ˚_combö©i⁄


60 
	giwœgn_iÁ˚_combö©i⁄s_duÆmode
[] = {

61 { .
num_dif„ª¡_ch™√ls
 = 1,

62 .
	gmax_öãrÁ˚s
 = 2,

63 .
	gbóc⁄_öt_ö‰a_m©ch
 = 
åue
,

64 .
	glimôs
 = 
iwœgn_°a_≠_limôs
,

65 .
	gn_limôs
 = 
ARRAY_SIZE
(
iwœgn_°a_≠_limôs
),

67 { .
	gnum_dif„ª¡_ch™√ls
 = 1,

68 .
	gmax_öãrÁ˚s
 = 2,

69 .
	glimôs
 = 
iwœgn_2°a_limôs
,

70 .
	gn_limôs
 = 
ARRAY_SIZE
(
iwœgn_2°a_limôs
),

78 
	$iwœgn_mac_£tup_ªgi°î
(
iwl_¥iv
 *
¥iv
,

79 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

81 
ªt
;

82 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

83 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

85 
hw
->
øã_c⁄åﬁ_Æg‹ôhm
 = "iwl-agn-rs";

88 
	`õì80211_hw_£t
(
hw
, 
SIGNAL_DBM
);

89 
	`õì80211_hw_£t
(
hw
, 
AMPDU_AGGREGATION
);

90 
	`õì80211_hw_£t
(
hw
, 
NEED_DTIM_BEFORE_ASSOC
);

91 
	`õì80211_hw_£t
(
hw
, 
SPECTRUM_MGMT
);

92 
	`õì80211_hw_£t
(
hw
, 
REPORTS_TX_ACK_STATUS
);

93 
	`õì80211_hw_£t
(
hw
, 
QUEUE_CONTROL
);

94 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_PS
);

95 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_DYNAMIC_PS
);

96 
	`õì80211_hw_£t
(
hw
, 
SUPPORT_FAST_XMIT
);

97 
	`õì80211_hw_£t
(
hw
, 
WANT_MONITOR_VIF
);

99 i‡(
¥iv
->
å™s
->
max_skb_‰ags
)

100 
hw
->
√tdev_„©uªs
 = 
NETIF_F_HIGHDMA
 | 
NETIF_F_SG
;

102 
hw
->
offch™√l_tx_hw_queue
 = 
IWL_AUX_QUEUE
;

103 
hw
->
ødiŸ≠_mcs_dëaûs
 |
IEEE80211_RADIOTAP_MCS_HAVE_FMT
;

112 i‡(
¥iv
->
nvm_d©a
->
sku_ˇp_11n_íabÀ
)

113 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_DYNAMIC_SMPS
 |

114 
NL80211_FEATURE_STATIC_SMPS
;

121 i‡(
¥iv
->
fw
->
ucode_ˇ∑
.
Êags
 & 
IWL_UCODE_TLV_FLAGS_MFP
 &&

122 !
iwlwifi_mod_∑øms
.
sw¸y±o
)

123 
	`õì80211_hw_£t
(
hw
, 
MFP_CAPABLE
);

125 
hw
->
°a_d©a_size
 = (
iwl_°©i⁄_¥iv
);

126 
hw
->
vif_d©a_size
 = (
iwl_vif_¥iv
);

128 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

129 
hw
->
wùhy
->
öãrÁ˚_modes
 |
˘x
->interface_modes;

130 
hw
->
wùhy
->
öãrÁ˚_modes
 |
˘x
->
ex˛usive_öãrÁ˚_modes
;

133 
	`BUILD_BUG_ON
(
NUM_IWL_RXON_CTX
 != 2);

135 i‡(
hw
->
wùhy
->
öãrÁ˚_modes
 & 
	`BIT
(
NL80211_IFTYPE_AP
)) {

136 
hw
->
wùhy
->
iÁ˚_combö©i⁄s
 =

137 
iwœgn_iÁ˚_combö©i⁄s_duÆmode
;

138 
hw
->
wùhy
->
n_iÁ˚_combö©i⁄s
 =

139 
	`ARRAY_SIZE
(
iwœgn_iÁ˚_combö©i⁄s_duÆmode
);

142 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_IBSS_RSN
;

143 
hw
->
wùhy
->
ªguœt‹y_Êags
 |
REGULATORY_CUSTOM_REG
 |

144 
REGULATORY_DISABLE_BEACON_HINTS
;

146 #ifde‡
CONFIG_PM_SLEEP


147 i‡(
¥iv
->
fw
->
img
[
IWL_UCODE_WOWLAN
].
num_£c
 &&

148 
¥iv
->
å™s
->
›s
->
d3_su•íd
 &&

149 
¥iv
->
å™s
->
›s
->
d3_ªsume
 &&

150 
	`devi˚_ˇn_wakeup
(
¥iv
->
å™s
->
dev
)) {

151 
¥iv
->
wowœn_suµ‹t
.
Êags
 = 
WIPHY_WOWLAN_MAGIC_PKT
 |

152 
WIPHY_WOWLAN_DISCONNECT
 |

153 
WIPHY_WOWLAN_EAP_IDENTITY_REQ
 |

154 
WIPHY_WOWLAN_RFKILL_RELEASE
;

155 i‡(!
iwlwifi_mod_∑øms
.
sw¸y±o
)

156 
¥iv
->
wowœn_suµ‹t
.
Êags
 |=

157 
WIPHY_WOWLAN_SUPPORTS_GTK_REKEY
 |

158 
WIPHY_WOWLAN_GTK_REKEY_FAILURE
;

160 
¥iv
->
wowœn_suµ‹t
.
n_∑âîns
 = 
IWLAGN_WOWLAN_MAX_PATTERNS
;

161 
¥iv
->
wowœn_suµ‹t
.
∑âîn_mö_Àn
 =

162 
IWLAGN_WOWLAN_MIN_PATTERN_LEN
;

163 
¥iv
->
wowœn_suµ‹t
.
∑âîn_max_Àn
 =

164 
IWLAGN_WOWLAN_MAX_PATTERN_LEN
;

165 
hw
->
wùhy
->
wowœn
 = &
¥iv
->
wowœn_suµ‹t
;

169 i‡(
iwlwifi_mod_∑øms
.
powî_ßve
)

170 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_PS_ON_BY_DEFAULT
;

172 
hw
->
wùhy
->
Êags
 &~
WIPHY_FLAG_PS_ON_BY_DEFAULT
;

174 
hw
->
wùhy
->
max_sˇn_ssids
 = 
PROBE_OPTION_MAX
;

176 
hw
->
wùhy
->
max_sˇn_õ_Àn
 = 
ˇ∑
->
max_¥obe_Àngth
 - 24 - 34;

182 
hw
->
queues
 = 
IWLAGN_FIRST_AMPDU_QUEUE
;

184 
hw
->
max_li°í_öãrvÆ
 = 
IWL_CONN_MAX_LISTEN_INTERVAL
;

186 i‡(
¥iv
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
].
n_ch™√ls
)

187 
¥iv
->
hw
->
wùhy
->
b™ds
[
NL80211_BAND_2GHZ
] =

188 &
¥iv
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

189 i‡(
¥iv
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
].
n_ch™√ls
)

190 
¥iv
->
hw
->
wùhy
->
b™ds
[
NL80211_BAND_5GHZ
] =

191 &
¥iv
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

193 
hw
->
wùhy
->
hw_vîsi⁄
 = 
¥iv
->
å™s
->
hw_id
;

195 
	`iwl_Àds_öô
(
¥iv
);

197 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
, 
NL80211_EXT_FEATURE_CQM_RSSI_LIST
);

198 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
, 
NL80211_EXT_FEATURE_EXT_KEY_ID
);

200 
ªt
 = 
	`õì80211_ªgi°î_hw
(
¥iv
->
hw
);

201 i‡(
ªt
) {

202 
	`IWL_ERR
(
¥iv
, "FaûedÅÿªgi°î hw (îr‹ %d)\n", 
ªt
);

203 
	`iwl_Àds_exô
(
¥iv
);

204  
ªt
;

206 
¥iv
->
mac80211_ªgi°îed
 = 1;

209 
	}
}

211 
	$iwœgn_mac_uƒegi°î
(
iwl_¥iv
 *
¥iv
)

213 i‡(!
¥iv
->
mac80211_ªgi°îed
)

215 
	`iwl_Àds_exô
(
¥iv
);

216 
	`õì80211_uƒegi°î_hw
(
¥iv
->
hw
);

217 
¥iv
->
mac80211_ªgi°îed
 = 0;

218 
	}
}

220 
	$__iwl_up
(
iwl_¥iv
 *
¥iv
)

222 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

223 
ªt
;

225 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

227 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
)) {

228 
	`IWL_WARN
(
¥iv
, "ExitÖending; willÇot bringÅhe NIC up\n");

229  -
EIO
;

232 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

233 
ªt
 = 
	`iwœgn_Æloc_bˇ°_°©i⁄
(
¥iv
, 
˘x
);

234 i‡(
ªt
) {

235 
	`iwl_dóŒoc_bˇ°_°©i⁄s
(
¥iv
);

236  
ªt
;

240 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
¥iv
->
å™s
);

241 i‡(
ªt
) {

242 
	`IWL_ERR
(
¥iv
, "FaûedÅÿ°¨àHW: %d\n", 
ªt
);

243 
îr‹
;

246 
ªt
 = 
	`iwl_run_öô_ucode
(
¥iv
);

247 i‡(
ªt
) {

248 
	`IWL_ERR
(
¥iv
, "FaûedÅÿru¿INIT ucode: %d\n", 
ªt
);

249 
îr‹
;

252 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
¥iv
->
å™s
);

253 i‡(
ªt
) {

254 
	`IWL_ERR
(
¥iv
, "FaûedÅÿ°¨àHW: %d\n", 
ªt
);

255 
îr‹
;

258 
ªt
 = 
	`iwl_lﬂd_ucode_waô_Æive
(
¥iv
, 
IWL_UCODE_REGULAR
);

259 i‡(
ªt
) {

260 
	`IWL_ERR
(
¥iv
, "FaûedÅÿ°¨àRT ucode: %d\n", 
ªt
);

261 
îr‹
;

264 
ªt
 = 
	`iwl_Æive_°¨t
(
¥iv
);

265 i‡(
ªt
)

266 
îr‹
;

269 
îr‹
:

270 
	`£t_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
);

271 
	`iwl_down
(
¥iv
);

272 
	`˛ór_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
);

274 
	`IWL_ERR
(
¥iv
, "UnableÅo initialize device.\n");

275  
ªt
;

276 
	}
}

278 
	$iwœgn_mac_°¨t
(
õì80211_hw
 *
hw
)

280 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

281 
ªt
;

283 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

286 
	`muãx_lock
(&
¥iv
->
muãx
);

287 
ªt
 = 
	`__iwl_up
(
¥iv
);

288 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

289 i‡(
ªt
)

290  
ªt
;

292 
	`IWL_DEBUG_INFO
(
¥iv
, "Start UP work done.\n");

295 i‡(
	`WARN_ON
(!
	`ã°_bô
(
STATUS_READY
, &
¥iv
->
°©us
)))

296 
ªt
 = -
EIO
;

298 
	`iwœgn_Àd_íabÀ
(
¥iv
);

300 
¥iv
->
is_›í
 = 1;

301 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

302  
ªt
;

303 
	}
}

305 
	$iwœgn_mac_°›
(
õì80211_hw
 *
hw
)

307 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

309 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

311 i‡(!
¥iv
->
is_›í
)

314 
¥iv
->
is_›í
 = 0;

316 
	`muãx_lock
(&
¥iv
->
muãx
);

317 
	`iwl_down
(
¥iv
);

318 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

320 
	`iwl_ˇn˚l_de„ºed_w‹k
(
¥iv
);

322 
	`Êush_w‹kqueue
(
¥iv
->
w‹kqueue
);

324 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

325 
	}
}

327 
	$iwœgn_mac_£t_ªkey_d©a
(
õì80211_hw
 *
hw
,

328 
õì80211_vif
 *
vif
,

329 
cfg80211_gtk_ªkey_d©a
 *
d©a
)

331 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

333 i‡(
iwlwifi_mod_∑øms
.
sw¸y±o
)

336 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

337 
	`muãx_lock
(&
¥iv
->
muãx
);

339 i‡(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
vif
 != vif)

340 
out
;

342 
	`mem˝y
(
¥iv
->
kek
, 
d©a
->kek, 
NL80211_KEK_LEN
);

343 
	`mem˝y
(
¥iv
->
kck
, 
d©a
->kck, 
NL80211_KCK_LEN
);

344 
¥iv
->
ª∂ay_˘r
 =

345 
	`˝u_to_À64
(
	`be64_to_˝up
((
__be64
 *)&
d©a
->
ª∂ay_˘r
));

346 
¥iv
->
have_ªkey_d©a
 = 
åue
;

348 
out
:

349 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

350 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

351 
	}
}

353 #ifde‡
CONFIG_PM_SLEEP


355 
	$iwœgn_mac_su•íd
(
õì80211_hw
 *
hw
,

356 
cfg80211_wowœn
 *
wowœn
)

358 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

359 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

360 
ªt
;

362 i‡(
	`WARN_ON
(!
wowœn
))

363  -
EINVAL
;

365 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

366 
	`muãx_lock
(&
¥iv
->
muãx
);

369 i‡(!
˘x
->
vif
 || ctx->vif->
ty≥
 !
NL80211_IFTYPE_STATION
 ||

370 !
	`iwl_is_assocüãd_˘x
(
˘x
)) {

371 
ªt
 = 1;

372 
out
;

375 
ªt
 = 
	`iwœgn_su•íd
(
¥iv
, 
wowœn
);

376 i‡(
ªt
)

377 
îr‹
;

380 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_SET
,

381 
CSR_UCODE_DRV_GP1_BIT_D3_CFG_COMPLETE
);

383 
	`iwl_å™s_d3_su•íd
(
¥iv
->
å™s
, 
Ál£
, 
åue
);

385 
out
;

387 
îr‹
:

388 
¥iv
->
wowœn
 = 
Ál£
;

389 
	`iwœgn_¥ï¨e_ª°¨t
(
¥iv
);

390 
	`õì80211_ª°¨t_hw
(
¥iv
->
hw
);

391 
out
:

392 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

393 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

395  
ªt
;

396 
	}
}

398 
	siwl_ªsume_d©a
 {

399 
iwl_¥iv
 *
	m¥iv
;

400 
iwœgn_wowœn_°©us
 *
	mcmd
;

401 
boﬁ
 
	mvÆid
;

404 
boﬁ
 
	$iwl_ªsume_°©us_‚
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

405 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

407 
iwl_ªsume_d©a
 *
ªsume_d©a
 = 
d©a
;

408 
iwl_¥iv
 *
¥iv
 = 
ªsume_d©a
->priv;

410 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë!(*
ªsume_d©a
->
cmd
)) {

411 
	`IWL_ERR
(
¥iv
, "rx wrong size data\n");

412  
åue
;

414 
	`mem˝y
(
ªsume_d©a
->
cmd
, 
pkt
->
d©a
, (*resume_data->cmd));

415 
ªsume_d©a
->
vÆid
 = 
åue
;

417  
åue
;

418 
	}
}

420 
	$iwœgn_mac_ªsume
(
õì80211_hw
 *
hw
)

422 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

423 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

424 
õì80211_vif
 *
vif
;

425 
u32
 
ba£
;

426 
ªt
;

427 
iwl_d3_°©us
 
d3_°©us
;

428 
	sîr‹_èbÀ_°¨t
 {

430 
u32
 
vÆid
;

431 
u32
 
îr‹_id
;

432 } 
îr_öfo
;

433 
iwl_nŸifiˇti⁄_waô
 
°©us_waô
;

434 c⁄° 
u16
 
°©us_cmd
[] = {

435 
REPLY_WOWLAN_GET_STATUS
,

437 
iwœgn_wowœn_°©us
 
°©us_d©a
 = {};

438 
iwl_ªsume_d©a
 
ªsume_d©a
 = {

439 .
¥iv
 =Öriv,

440 .
cmd
 = &
°©us_d©a
,

441 .
vÆid
 = 
Ál£
,

443 
cfg80211_wowœn_wakeup
 
wakeup
 = {

444 .
∑âîn_idx
 = -1,

446 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


447 c⁄° 
fw_img
 *
img
;

450 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

451 
	`muãx_lock
(&
¥iv
->
muãx
);

454 
vif
 = 
˘x
->vif;

456 
ªt
 = 
	`iwl_å™s_d3_ªsume
(
¥iv
->
å™s
, &
d3_°©us
, 
Ál£
, 
åue
);

457 i‡(
ªt
)

458 
out_u∆ock
;

460 i‡(
d3_°©us
 !
IWL_D3_STATUS_ALIVE
) {

461 
	`IWL_INFO
(
¥iv
, "Device wasÑeset during suspend\n");

462 
out_u∆ock
;

466 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_CLR
,

467 
CSR_UCODE_DRV_GP1_BIT_D3_CFG_COMPLETE
);

469 
ba£
 = 
¥iv
->
devi˚_poöãrs
.
îr‹_evít_èbÀ
;

470 i‡(!
	`iwœgn_hw_vÆid_πc_d©a_addr
(
ba£
)) {

471 
	`IWL_WARN
(
¥iv
, "InvalidÉrrorÅable duringÑesume!\n");

472 
out_u∆ock
;

475 
	`iwl_å™s_ªad_mem_byãs
(
¥iv
->
å™s
, 
ba£
,

476 &
îr_öfo
, (err_info));

478 i‡(
îr_öfo
.
vÆid
) {

479 
	`IWL_INFO
(
¥iv
, "errorÅable is valid (%d, 0x%x)\n",

480 
îr_öfo
.
vÆid
,Éº_öfo.
îr‹_id
);

481 i‡(
îr_öfo
.
îr‹_id
 =
RF_KILL_INDICATOR_FOR_WOWLAN
) {

482 
wakeup
.
rfkûl_ªÀa£
 = 
åue
;

483 
	`õì80211_ªp‹t_wowœn_wakeup
(
vif
, &
wakeup
,

484 
GFP_KERNEL
);

486 
out_u∆ock
;

489 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


490 
img
 = &
¥iv
->
fw
->img[
IWL_UCODE_WOWLAN
];

491 i‡(!
¥iv
->
wowœn_§am
)

492 
¥iv
->
wowœn_§am
 =

493 
	`kzÆloc
(
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
Àn
,

494 
GFP_KERNEL
);

496 i‡(
¥iv
->
wowœn_§am
)

497 
	`iwl_å™s_ªad_mem
(
¥iv
->
å™s
, 0x800000,

498 
¥iv
->
wowœn_§am
,

499 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
Àn
 / 4);

510 
	`iwl_öô_nŸifiˇti⁄_waô
(&
¥iv
->
nŸif_waô
, &
°©us_waô
, 
°©us_cmd
,

511 
	`ARRAY_SIZE
(
°©us_cmd
), 
iwl_ªsume_°©us_‚
,

512 &
ªsume_d©a
);

514 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_WOWLAN_GET_STATUS
, 
CMD_ASYNC
, 0, 
NULL
);

515 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_ECHO
, 
CMD_ASYNC
, 0, 
NULL
);

518 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
, &
°©us_waô
, 
HZ
/5);

519 i‡(
ªt
)

520 
out_u∆ock
;

522 i‡(
ªsume_d©a
.
vÆid
 && 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
vif
) {

523 
u32
 
ªas⁄s
 = 
	`À32_to_˝u
(
°©us_d©a
.
wakeup_ªas⁄
);

524 
cfg80211_wowœn_wakeup
 *
wakeup_ªp‹t
;

526 
	`IWL_INFO
(
¥iv
, "WoWLAN wakeu∞ªas⁄(s): 0x%.8x\n", 
ªas⁄s
);

528 i‡(
ªas⁄s
) {

529 i‡(
ªas⁄s
 & 
IWLAGN_WOWLAN_WAKEUP_MAGIC_PACKET
)

530 
wakeup
.
magic_pkt
 = 
åue
;

531 i‡(
ªas⁄s
 & 
IWLAGN_WOWLAN_WAKEUP_PATTERN_MATCH
)

532 
wakeup
.
∑âîn_idx
 = 
°©us_d©a
.
∑âîn_numbî
;

533 i‡(
ªas⁄s
 & (
IWLAGN_WOWLAN_WAKEUP_BEACON_MISS
 |

534 
IWLAGN_WOWLAN_WAKEUP_LINK_CHANGE
))

535 
wakeup
.
disc⁄√˘
 = 
åue
;

536 i‡(
ªas⁄s
 & 
IWLAGN_WOWLAN_WAKEUP_GTK_REKEY_FAIL
)

537 
wakeup
.
gtk_ªkey_Áûuª
 = 
åue
;

538 i‡(
ªas⁄s
 & 
IWLAGN_WOWLAN_WAKEUP_EAP_IDENT_REQ
)

539 
wakeup
.
óp_idítôy_ªq
 = 
åue
;

540 i‡(
ªas⁄s
 & 
IWLAGN_WOWLAN_WAKEUP_4WAY_HANDSHAKE
)

541 
wakeup
.
four_way_h™dshake
 = 
åue
;

542 
wakeup_ªp‹t
 = &
wakeup
;

544 
wakeup_ªp‹t
 = 
NULL
;

547 
	`õì80211_ªp‹t_wowœn_wakeup
(
vif
, 
wakeup_ªp‹t
, 
GFP_KERNEL
);

550 
¥iv
->
wowœn
 = 
Ál£
;

552 
	`iwœgn_¥ï¨e_ª°¨t
(
¥iv
);

554 
	`mem£t
((*)&
˘x
->
a˘ive
, 0, (ctx->active));

555 
	`iwl_c⁄√˘i⁄_öô_rx_c⁄fig
(
¥iv
, 
˘x
);

556 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

558 
out_u∆ock
:

559 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

560 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

562 
	`õì80211_ªsume_disc⁄√˘
(
vif
);

565 
	}
}

567 
	$iwœgn_mac_£t_wakeup
(
õì80211_hw
 *
hw
, 
boﬁ
 
íabÀd
)

569 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

571 
	`devi˚_£t_wakeup_íabÀ
(
¥iv
->
å™s
->
dev
, 
íabÀd
);

572 
	}
}

575 
	$iwœgn_mac_tx
(
õì80211_hw
 *
hw
,

576 
õì80211_tx_c⁄åﬁ
 *
c⁄åﬁ
,

577 
sk_buff
 *
skb
)

579 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

581 i‡(
	`iwœgn_tx_skb
(
¥iv
, 
c⁄åﬁ
->
°a
, 
skb
))

582 
	`õì80211_‰ì_txskb
(
hw
, 
skb
);

583 
	}
}

585 
	$iwœgn_mac_upd©e_tkù_key
(
õì80211_hw
 *
hw
,

586 
õì80211_vif
 *
vif
,

587 
õì80211_key_c⁄f
 *
keyc⁄f
,

588 
õì80211_°a
 *
°a
,

589 
u32
 
iv32
, 
u16
 *
pha£1key
)

591 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

593 
	`iwl_upd©e_tkù_key
(
¥iv
, 
vif
, 
keyc⁄f
, 
°a
, 
iv32
, 
pha£1key
);

594 
	}
}

596 
	$iwœgn_mac_£t_key
(
õì80211_hw
 *
hw
, 
£t_key_cmd
 
cmd
,

597 
õì80211_vif
 *
vif
,

598 
õì80211_°a
 *
°a
,

599 
õì80211_key_c⁄f
 *
key
)

601 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

602 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

603 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
vif_¥iv
->ctx;

604 
ªt
;

605 
boﬁ
 
is_deÁu…_wï_key
 = 
Ál£
;

607 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

609 i‡(
iwlwifi_mod_∑øms
.
sw¸y±o
) {

610 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave - hwcrypto disabled\n");

611  -
EOPNOTSUPP
;

614 
key
->
cùhî
) {

615 
WLAN_CIPHER_SUITE_TKIP
:

616 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_MMIC
;

617 
ÁŒthrough
;

618 
WLAN_CIPHER_SUITE_CCMP
:

619 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_IV
;

632 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
 &&

633 !(
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

634 
key
->
hw_key_idx
 = 
WEP_INVALID_OFFSET
;

639 i‡(
cmd
 =
DISABLE_KEY
 && 
key
->
hw_key_idx
 =
WEP_INVALID_OFFSET
)

642 
	`muãx_lock
(&
¥iv
->
muãx
);

643 
	`iwl_sˇn_ˇn˚l_timeout
(
¥iv
, 100);

645 
	`BUILD_BUG_ON
(
WEP_INVALID_OFFSET
 =
IWLAGN_HW_KEY_DEFAULT
);

653 i‡((
key
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

654 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
Ë&& !
°a
) {

655 i‡(
cmd
 =
SET_KEY
)

656 
is_deÁu…_wï_key
 = !
˘x
->
key_m≠pög_keys
;

658 
is_deÁu…_wï_key
 =

659 
key
->
hw_key_idx
 =
IWLAGN_HW_KEY_DEFAULT
;

663 
cmd
) {

664 
SET_KEY
:

665 i‡(
is_deÁu…_wï_key
) {

666 
ªt
 = 
	`iwl_£t_deÁu…_wï_key
(
¥iv
, 
vif_¥iv
->
˘x
, 
key
);

669 
ªt
 = 
	`iwl_£t_dy«mic_key
(
¥iv
, 
vif_¥iv
->
˘x
, 
key
, 
°a
);

670 i‡(
ªt
) {

675 
ªt
 = 0;

676 
key
->
hw_key_idx
 = 
WEP_INVALID_OFFSET
;

679 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enable hwcrypto key\n");

681 
DISABLE_KEY
:

682 i‡(
is_deÁu…_wï_key
)

683 
ªt
 = 
	`iwl_ªmove_deÁu…_wï_key
(
¥iv
, 
˘x
, 
key
);

685 
ªt
 = 
	`iwl_ªmove_dy«mic_key
(
¥iv
, 
˘x
, 
key
, 
°a
);

687 
	`IWL_DEBUG_MAC80211
(
¥iv
, "disable hwcrypto key\n");

690 
ªt
 = -
EINVAL
;

693 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

694 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

696  
ªt
;

697 
	}
}

699 
	$iwœgn_mac_ampdu_a˘i⁄
(
õì80211_hw
 *
hw
,

700 
õì80211_vif
 *
vif
,

701 
õì80211_ampdu_∑øms
 *
∑øms
)

703 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

704 
ªt
 = -
EINVAL
;

705 
õì80211_°a
 *
°a
 = 
∑øms
->sta;

706 
õì80211_ampdu_mlme_a˘i⁄
 
a˘i⁄
 = 
∑øms
->action;

707 
u16
 
tid
 = 
∑øms
->tid;

708 
u16
 *
s¢
 = &
∑øms
->ssn;

709 
u8
 
buf_size
 = 
∑øms
->buf_size;

710 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*Ë
°a
->
drv_¥iv
;

712 
	`IWL_DEBUG_HT
(
¥iv
, "A-MPDUáction onáddr %pMÅid %d\n",

713 
°a
->
addr
, 
tid
);

715 i‡(!(
¥iv
->
nvm_d©a
->
sku_ˇp_11n_íabÀ
))

716  -
EACCES
;

718 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

719 
	`muãx_lock
(&
¥iv
->
muãx
);

721 
a˘i⁄
) {

722 
IEEE80211_AMPDU_RX_START
:

723 i‡(!
	`iwl_íabÀ_rx_ampdu
())

725 
	`IWL_DEBUG_HT
(
¥iv
, "start Rx\n");

726 
ªt
 = 
	`iwl_°a_rx_agg_°¨t
(
¥iv
, 
°a
, 
tid
, *
s¢
);

728 
IEEE80211_AMPDU_RX_STOP
:

729 
	`IWL_DEBUG_HT
(
¥iv
, "stop Rx\n");

730 
ªt
 = 
	`iwl_°a_rx_agg_°›
(
¥iv
, 
°a
, 
tid
);

732 
IEEE80211_AMPDU_TX_START
:

733 i‡(!
¥iv
->
å™s
->
›s
->
txq_íabÀ
)

735 i‡(!
	`iwl_íabÀ_tx_ampdu
())

737 
	`IWL_DEBUG_HT
(
¥iv
, "start Tx\n");

738 
ªt
 = 
	`iwœgn_tx_agg_°¨t
(
¥iv
, 
vif
, 
°a
, 
tid
, 
s¢
);

740 
IEEE80211_AMPDU_TX_STOP_FLUSH
:

741 
IEEE80211_AMPDU_TX_STOP_FLUSH_CONT
:

742 
	`IWL_DEBUG_HT
(
¥iv
, "Flush Tx\n");

743 
ªt
 = 
	`iwœgn_tx_agg_Êush
(
¥iv
, 
vif
, 
°a
, 
tid
);

745 
IEEE80211_AMPDU_TX_STOP_CONT
:

746 
	`IWL_DEBUG_HT
(
¥iv
, "stop Tx\n");

747 
ªt
 = 
	`iwœgn_tx_agg_°›
(
¥iv
, 
vif
, 
°a
, 
tid
);

748 i‡((
ªt
 =0Ë&& (
¥iv
->
agg_tids_cou¡
 > 0)) {

749 
¥iv
->
agg_tids_cou¡
--;

750 
	`IWL_DEBUG_HT
(
¥iv
, "priv->agg_tids_count = %u\n",

751 
¥iv
->
agg_tids_cou¡
);

753 i‡(!
¥iv
->
agg_tids_cou¡
 &&

754 
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
) {

758 
°a_¥iv
->
lq_°a
.
lq
.
gíîÆ_∑øms
.
Êags
 &=

759 ~
LINK_QUAL_FLAGS_SET_STA_TLC_RTS_MSK
;

760 
	`iwl_£nd_lq_cmd
(
¥iv
, 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
),

761 &
°a_¥iv
->
lq_°a
.
lq
, 
CMD_ASYNC
, 
Ál£
);

764 
IEEE80211_AMPDU_TX_OPERATIONAL
:

765 
ªt
 = 
	`iwœgn_tx_agg_›î
(
¥iv
, 
vif
, 
°a
, 
tid
, 
buf_size
);

768 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

769 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

770  
ªt
;

771 
	}
}

773 
	$iwœgn_mac_°a_add
(
õì80211_hw
 *
hw
,

774 
õì80211_vif
 *
vif
,

775 
õì80211_°a
 *
°a
)

777 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

778 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

779 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

780 
boﬁ
 
is_≠
 = 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
;

781 
ªt
;

782 
u8
 
°a_id
;

784 
	`IWL_DEBUG_INFO
(
¥iv
, "proceedingÅoádd station %pM\n",

785 
°a
->
addr
);

786 
°a_¥iv
->
°a_id
 = 
IWL_INVALID_STATION
;

788 
	`©omic_£t
(&
°a_¥iv
->
≥ndög_‰ames
, 0);

789 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

790 
°a_¥iv
->
˛õ¡
 = 
åue
;

792 
ªt
 = 
	`iwl_add_°©i⁄_comm⁄
(
¥iv
, 
vif_¥iv
->
˘x
, 
°a
->
addr
,

793 
is_≠
, 
°a
, &
°a_id
);

794 i‡(
ªt
) {

795 
	`IWL_ERR
(
¥iv
, "UnableÅoádd station %pM (%d)\n",

796 
°a
->
addr
, 
ªt
);

798  
ªt
;

801 
°a_¥iv
->
°a_id
 = sta_id;

804 
	}
}

806 
	$iwœgn_mac_°a_ªmove
(
õì80211_hw
 *
hw
,

807 
õì80211_vif
 *
vif
,

808 
õì80211_°a
 *
°a
)

810 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

811 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

812 
ªt
;

814 
	`IWL_DEBUG_INFO
(
¥iv
, "¥o˚edögÅÿªmovê°©i⁄ %pM\n", 
°a
->
addr
);

816 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

822 
ªt
 = 0;

823 
	`iwl_dó˘iv©e_°©i⁄
(
¥iv
, 
°a_¥iv
->
°a_id
, 
°a
->
addr
);

825 
ªt
 = 
	`iwl_ªmove_°©i⁄
(
¥iv
, 
°a_¥iv
->
°a_id
, 
°a
->
addr
);

826 i‡(
ªt
)

827 
	`IWL_DEBUG_QUIET_RFKILL
(
¥iv
,

828 "Eº‹Ñemovög sèti⁄ %pM\n", 
°a
->
addr
);

830  
ªt
;

831 
	}
}

833 
	$iwœgn_mac_°a_°©e
(
õì80211_hw
 *
hw
,

834 
õì80211_vif
 *
vif
,

835 
õì80211_°a
 *
°a
,

836 
õì80211_°a_°©e
 
ﬁd_°©e
,

837 
õì80211_°a_°©e
 
√w_°©e
)

839 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

840 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

842 
NONE
, 
ADD
, 
REMOVE
, 
HT_RATE_INIT
, 
ADD_RATE_INIT
,

843 } 
›
 = 
NONE
;

844 
ªt
;

846 
	`IWL_DEBUG_MAC80211
(
¥iv
, "station %pM state change %d->%d\n",

847 
°a
->
addr
, 
ﬁd_°©e
, 
√w_°©e
);

849 
	`muãx_lock
(&
¥iv
->
muãx
);

850 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

851 i‡(
ﬁd_°©e
 =
IEEE80211_STA_NOTEXIST
 &&

852 
√w_°©e
 =
IEEE80211_STA_NONE
)

853 
›
 = 
ADD
;

854 i‡(
ﬁd_°©e
 =
IEEE80211_STA_NONE
 &&

855 
√w_°©e
 =
IEEE80211_STA_NOTEXIST
)

856 
›
 = 
REMOVE
;

857 i‡(
ﬁd_°©e
 =
IEEE80211_STA_AUTH
 &&

858 
√w_°©e
 =
IEEE80211_STA_ASSOC
)

859 
›
 = 
HT_RATE_INIT
;

861 i‡(
ﬁd_°©e
 =
IEEE80211_STA_AUTH
 &&

862 
√w_°©e
 =
IEEE80211_STA_ASSOC
)

863 
›
 = 
ADD_RATE_INIT
;

864 i‡(
ﬁd_°©e
 =
IEEE80211_STA_ASSOC
 &&

865 
√w_°©e
 =
IEEE80211_STA_AUTH
)

866 
›
 = 
REMOVE
;

869 
›
) {

870 
ADD
:

871 
ªt
 = 
	`iwœgn_mac_°a_add
(
hw
, 
vif
, 
°a
);

872 i‡(
ªt
)

880 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

881 
¥iv
->
°©i⁄s
[
	`iwl_°a_id
(
°a
)].
u£d
 &=

882 ~
IWL_STA_UCODE_INPROGRESS
;

883 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

885 
REMOVE
:

886 
ªt
 = 
	`iwœgn_mac_°a_ªmove
(
hw
, 
vif
, 
°a
);

888 
ADD_RATE_INIT
:

889 
ªt
 = 
	`iwœgn_mac_°a_add
(
hw
, 
vif
, 
°a
);

890 i‡(
ªt
)

893 
	`IWL_DEBUG_INFO
(
¥iv
,

895 
°a
->
addr
);

896 
	`iwl_rs_øã_öô
(
¥iv
, 
°a
, 
	`iwl_°a_id
(sta));

897 
ªt
 = 0;

899 
HT_RATE_INIT
:

901 
ªt
 = 
	`iwl_°a_upd©e_ht
(
¥iv
, 
vif_¥iv
->
˘x
, 
°a
);

902 i‡(
ªt
)

904 
	`IWL_DEBUG_INFO
(
¥iv
,

906 
°a
->
addr
);

907 
	`iwl_rs_øã_öô
(
¥iv
, 
°a
, 
	`iwl_°a_id
(sta));

908 
ªt
 = 0;

911 
ªt
 = 0;

919 i‡(
	`iwl_is_rfkûl
(
¥iv
))

920 
ªt
 = 0;

922 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

923 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

925  
ªt
;

926 
	}
}

928 
	$iwœgn_mac_ch™√l_swôch
(
õì80211_hw
 *
hw
,

929 
õì80211_vif
 *
vif
,

930 
õì80211_ch™√l_swôch
 *
ch_swôch
)

932 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

933 
õì80211_c⁄f
 *
c⁄f
 = &
hw
->conf;

934 
õì80211_ch™√l
 *
ch™√l
 = 
ch_swôch
->
ch™def
.
ch™
;

935 
iwl_ht_c⁄fig
 *
ht_c⁄f
 = &
¥iv
->
cuºít_ht_c⁄fig
;

944 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

945 
u16
 
ch
;

947 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

949 
	`muãx_lock
(&
¥iv
->
muãx
);

951 i‡(
	`iwl_is_rfkûl
(
¥iv
))

952 
out
;

954 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
) ||

955 
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
) ||

956 
	`ã°_bô
(
STATUS_CHANNEL_SWITCH_PENDING
, &
¥iv
->
°©us
))

957 
out
;

959 i‡(!
	`iwl_is_assocüãd_˘x
(
˘x
))

960 
out
;

962 i‡(!
¥iv
->
lib
->
£t_ch™√l_swôch
)

963 
out
;

965 
ch
 = 
ch™√l
->
hw_vÆue
;

966 i‡(
	`À16_to_˝u
(
˘x
->
a˘ive
.
ch™√l
Ë=
ch
)

967 
out
;

969 
¥iv
->
cuºít_ht_c⁄fig
.
smps
 = 
c⁄f
->
smps_mode
;

972 
	`cfg80211_gë_ch™def_ty≥
(&
ch_swôch
->
ch™def
)) {

973 
NL80211_CHAN_NO_HT
:

974 
NL80211_CHAN_HT20
:

975 
˘x
->
ht
.
is_40mhz
 = 
Ál£
;

976 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
 = 
IEEE80211_HT_PARAM_CHA_SEC_NONE
;

978 
NL80211_CHAN_HT40MINUS
:

979 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
 = 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
;

980 
˘x
->
ht
.
is_40mhz
 = 
åue
;

982 
NL80211_CHAN_HT40PLUS
:

983 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
 = 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
;

984 
˘x
->
ht
.
is_40mhz
 = 
åue
;

988 i‡((
	`À16_to_˝u
(
˘x
->
°agög
.
ch™√l
Ë!
ch
))

989 
˘x
->
°agög
.
Êags
 = 0;

991 
	`iwl_£t_rx⁄_ch™√l
(
¥iv
, 
ch™√l
, 
˘x
);

992 
	`iwl_£t_rx⁄_ht
(
¥iv
, 
ht_c⁄f
);

993 
	`iwl_£t_Êags_f‹_b™d
(
¥iv
, 
˘x
, 
ch™√l
->
b™d
, ctx->
vif
);

999 
	`£t_bô
(
STATUS_CHANNEL_SWITCH_PENDING
, &
¥iv
->
°©us
);

1000 
¥iv
->
swôch_ch™√l
 = 
	`˝u_to_À16
(
ch
);

1001 i‡(
¥iv
->
lib
->
	`£t_ch™√l_swôch
’riv, 
ch_swôch
)) {

1002 
	`˛ór_bô
(
STATUS_CHANNEL_SWITCH_PENDING
, &
¥iv
->
°©us
);

1003 
¥iv
->
swôch_ch™√l
 = 0;

1004 
	`õì80211_chswôch_d⁄e
(
˘x
->
vif
, 
Ál£
, 0);

1007 
out
:

1008 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1009 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1010 
	}
}

1012 
	$iwl_chswôch_d⁄e
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
is_suc˚ss
)

1018 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

1020 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

1023 i‡(!
	`ã°_™d_˛ór_bô
(
STATUS_CHANNEL_SWITCH_PENDING
, &
¥iv
->
°©us
))

1026 i‡(
˘x
->
vif
)

1027 
	`õì80211_chswôch_d⁄e
(
˘x
->
vif
, 
is_suc˚ss
, 0);

1028 
	}
}

1030 
	$iwœgn_c⁄figuª_fûãr
(
õì80211_hw
 *
hw
,

1031 
ch™ged_Êags
,

1032 *
tŸÆ_Êags
,

1033 
u64
 
mu…iˇ°
)

1035 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1036 
__À32
 
fûãr_‹
 = 0, 
fûãr_«nd
 = 0;

1037 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

1039 
	#CHK
(
ã°
, 
Êag
) do { \

1040 i‡(*
tŸÆ_Êags
 & (
ã°
)) \

1041 
fûãr_‹
 |(
Êag
); \

1043 
fûãr_«nd
 |(
Êag
); \

1044 } 0)

	)

1046 
	`IWL_DEBUG_MAC80211
(
¥iv
, "Enter: changed: 0x%x,Åotal: 0x%x\n",

1047 
ch™ged_Êags
, *
tŸÆ_Êags
);

1049 
	`CHK
(
FIF_OTHER_BSS
, 
RXON_FILTER_PROMISC_MSK
);

1051 
	`CHK
(
FIF_CONTROL
, 
RXON_FILTER_CTL2HOST_MSK
 | 
RXON_FILTER_PROMISC_MSK
);

1052 
	`CHK
(
FIF_BCN_PRBRESP_PROMISC
, 
RXON_FILTER_BCON_AWARE_MSK
);

1054 #unde‡
CHK


1056 
	`muãx_lock
(&
¥iv
->
muãx
);

1058 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

1059 
˘x
->
°agög
.
fûãr_Êags
 &~
fûãr_«nd
;

1060 
˘x
->
°agög
.
fûãr_Êags
 |
fûãr_‹
;

1068 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1076 *
tŸÆ_Êags
 &
FIF_OTHER_BSS
 | 
FIF_ALLMULTI
 |

1077 
FIF_BCN_PRBRESP_PROMISC
 | 
FIF_CONTROL
;

1078 
	}
}

1080 
	$iwœgn_mac_Êush
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

1081 
u32
 
queues
, 
boﬁ
 
dr›
)

1083 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1084 
u32
 
scd_queues
;

1086 
	`muãx_lock
(&
¥iv
->
muãx
);

1087 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1089 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
)) {

1090 
	`IWL_DEBUG_TX
(
¥iv
, "Aborting flush dueÅo device shutdown\n");

1091 
d⁄e
;

1093 i‡(
	`iwl_is_rfkûl
(
¥iv
)) {

1094 
	`IWL_DEBUG_TX
(
¥iv
, "Aborting flush dueÅo RF Kill\n");

1095 
d⁄e
;

1098 
scd_queues
 = 
	`BIT
(
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
) - 1;

1099 
scd_queues
 &~(
	`BIT
(
IWL_IPAN_CMD_QUEUE_NUM
) |

1100 
	`BIT
(
IWL_DEFAULT_CMD_QUEUE_NUM
));

1102 i‡(
dr›
) {

1103 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "Flushing SCD queues: 0x%x\n",

1104 
scd_queues
);

1105 i‡(
	`iwœgn_txfifo_Êush
(
¥iv
, 
scd_queues
)) {

1106 
	`IWL_ERR
(
¥iv
, "flushÑequest fail\n");

1107 
d⁄e
;

1111 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "waitÅransmit/flusháll frames\n");

1112 
	`iwl_å™s_waô_tx_queues_em±y
(
¥iv
->
å™s
, 
scd_queues
);

1113 
d⁄e
:

1114 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1115 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1116 
	}
}

1118 
	$iwœgn_mac_evít_ˇŒback
(
õì80211_hw
 *
hw
,

1119 
õì80211_vif
 *
vif
,

1120 c⁄° 
õì80211_evít
 *
evít
)

1122 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1124 i‡(
evít
->
ty≥
 !
RSSI_EVENT
)

1127 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1129 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

1130 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

1131 i‡(
evít
->
u
.
rssi
.
d©a
 =
RSSI_EVENT_LOW
)

1132 
¥iv
->
bt_íabÀ_p•ﬁl
 = 
åue
;

1133 i‡(
evít
->
u
.
rssi
.
d©a
 =
RSSI_EVENT_HIGH
)

1134 
¥iv
->
bt_íabÀ_p•ﬁl
 = 
Ál£
;

1136 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
bt_ru¡ime_c⁄fig
);

1138 
	`IWL_DEBUG_MAC80211
(
¥iv
, "Advanced BT coex disabled,"

1142 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1143 
	}
}

1145 
	$iwœgn_mac_£t_tim
(
õì80211_hw
 *
hw
,

1146 
õì80211_°a
 *
°a
, 
boﬁ
 
£t
)

1148 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1150 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
bóc⁄_upd©e
);

1153 
	}
}

1155 
	$iwœgn_mac_c⁄f_tx
(
õì80211_hw
 *
hw
,

1156 
õì80211_vif
 *
vif
,

1157 
lök_id
, 
u16
 
queue
,

1158 c⁄° 
õì80211_tx_queue_∑øms
 *
∑øms
)

1160 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1161 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

1162 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
vif_¥iv
->ctx;

1163 
q
;

1165 i‡(
	`WARN_ON
(!
˘x
))

1166  -
EINVAL
;

1168 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1170 i‡(!
	`iwl_is_ªady_rf
(
¥iv
)) {

1171 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave - RFÇotÑeady\n");

1172  -
EIO
;

1175 i‡(
queue
 >
AC_NUM
) {

1176 
	`IWL_DEBUG_MAC80211
(
¥iv
, "Àavê- queuê>AC_NUM %d\n", 
queue
);

1180 
q
 = 
AC_NUM
 - 1 - 
queue
;

1182 
	`muãx_lock
(&
¥iv
->
muãx
);

1184 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
q
].
cw_mö
 =

1185 
	`˝u_to_À16
(
∑øms
->
cw_mö
);

1186 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
q
].
cw_max
 =

1187 
	`˝u_to_À16
(
∑øms
->
cw_max
);

1188 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
q
].
aif¢
 = 
∑øms
->
aifs
;

1189 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
q
].
edˇ_tx›
 =

1190 
	`˝u_to_À16
((
∑øms
->
tx›
 * 32));

1192 
˘x
->
qos_d©a
.
def_qos_∑rm
.
ac
[
q
].
ª£rved1
 = 0;

1194 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1196 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1198 
	}
}

1200 
	$iwœgn_mac_tx_œ°_bóc⁄
(
õì80211_hw
 *
hw
)

1202 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1204  
¥iv
->
ibss_m™agî
 =
IWL_IBSS_MANAGER
;

1205 
	}
}

1207 
	$iwl_£t_mode
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

1209 
	`iwl_c⁄√˘i⁄_öô_rx_c⁄fig
(
¥iv
, 
˘x
);

1211 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

1213  
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

1214 
	}
}

1216 
	$iwl_£tup_öãrÁ˚
(
iwl_¥iv
 *
¥iv
,

1217 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

1219 
õì80211_vif
 *
vif
 = 
˘x
->vif;

1220 
îr
, 
ac
;

1222 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1229 
¥iv
->
iw_mode
 = 
vif
->
ty≥
;

1231 
˘x
->
is_a˘ive
 = 
åue
;

1233 
îr
 = 
	`iwl_£t_mode
(
¥iv
, 
˘x
);

1234 i‡(
îr
) {

1235 i‡(!
˘x
->
Æways_a˘ive
)

1236 
˘x
->
is_a˘ive
 = 
Ál£
;

1237  
îr
;

1240 i‡(
¥iv
->
lib
->
bt_∑øms
 &&Öriv->lib->bt_∑øms->
adv™˚d_bt_c€xi°
 &&

1241 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

1247 
¥iv
->
bt_åaffic_lﬂd
 = 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
;

1251 
ac
 = 0;á¯< 
IEEE80211_NUM_ACS
;ác++)

1252 
vif
->
hw_queue
[
ac
] = 
˘x
->
ac_to_queue
[ac];

1254 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

1255 
vif
->
ˇb_queue
 = 
˘x
->
mˇ°_queue
;

1257 
vif
->
ˇb_queue
 = 
IEEE80211_INVAL_HW_QUEUE
;

1260 
	}
}

1262 
	$iwœgn_mac_add_öãrÁ˚
(
õì80211_hw
 *
hw
,

1263 
õì80211_vif
 *
vif
)

1265 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1266 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

1267 
iwl_rx⁄_c⁄ãxt
 *
tmp
, *
˘x
 = 
NULL
;

1268 
îr
;

1269 
∆80211_i·y≥
 
vi·y≥
 = 
	`õì80211_vif_ty≥_p2p
(
vif
);

1270 
boﬁ
 
ª£t
 = 
Ál£
;

1272 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter:Åype %d,áddr %pM\n",

1273 
vi·y≥
, 
vif
->
addr
);

1275 
	`muãx_lock
(&
¥iv
->
muãx
);

1277 i‡(!
	`iwl_is_ªady_rf
(
¥iv
)) {

1278 
	`IWL_WARN
(
¥iv
, "TryÅoádd interface when deviceÇotÑeady\n");

1279 
îr
 = -
EINVAL
;

1280 
out
;

1283 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
tmp
) {

1284 
u32
 
possibÀ_modes
 =

1285 
tmp
->
öãrÁ˚_modes
 |Åmp->
ex˛usive_öãrÁ˚_modes
;

1287 i‡(
tmp
->
vif
) {

1289 i‡(
tmp
->
vif
 == vif) {

1290 
ª£t
 = 
åue
;

1291 
˘x
 = 
tmp
;

1296 i‡(
tmp
->
ex˛usive_öãrÁ˚_modes
 &

1297 
	`BIT
(
tmp
->
vif
->
ty≥
)) {

1298 
îr
 = -
EINVAL
;

1299 
out
;

1304 i‡(!(
possibÀ_modes
 & 
	`BIT
(
vi·y≥
)))

1308 
˘x
 = 
tmp
;

1312 i‡(!
˘x
) {

1313 
îr
 = -
EOPNOTSUPP
;

1314 
out
;

1317 
vif_¥iv
->
˘x
 = ctx;

1318 
˘x
->
vif
 = vif;

1329 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
)

1330 
	`õì80211_hw_£t
(
¥iv
->
hw
, 
RX_INCLUDES_FCS
);

1332 
	`__˛ór_bô
(
IEEE80211_HW_RX_INCLUDES_FCS
, 
¥iv
->
hw
->
Êags
);

1334 
îr
 = 
	`iwl_£tup_öãrÁ˚
(
¥iv
, 
˘x
);

1335 i‡(!
îr
 || 
ª£t
)

1336 
out
;

1338 
˘x
->
vif
 = 
NULL
;

1339 
¥iv
->
iw_mode
 = 
NL80211_IFTYPE_STATION
;

1340 
out
:

1341 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1343 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1344  
îr
;

1345 
	}
}

1347 
	$iwl_ã¨down_öãrÁ˚
(
iwl_¥iv
 *
¥iv
,

1348 
õì80211_vif
 *
vif
,

1349 
boﬁ
 
mode_ch™ge
)

1351 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

1353 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1355 i‡(
¥iv
->
sˇn_vif
 =
vif
) {

1356 
	`iwl_sˇn_ˇn˚l_timeout
(
¥iv
, 200);

1357 
	`iwl_f‹˚_sˇn_íd
(
¥iv
);

1360 i‡(!
mode_ch™ge
) {

1361 
	`iwl_£t_mode
(
¥iv
, 
˘x
);

1362 i‡(!
˘x
->
Æways_a˘ive
)

1363 
˘x
->
is_a˘ive
 = 
Ál£
;

1373 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
)

1374 
¥iv
->
bt_åaffic_lﬂd
 =Öriv->
œ°_bt_åaffic_lﬂd
;

1375 
	}
}

1377 
	$iwœgn_mac_ªmove_öãrÁ˚
(
õì80211_hw
 *
hw
,

1378 
õì80211_vif
 *
vif
)

1380 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1381 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

1383 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1385 
	`muãx_lock
(&
¥iv
->
muãx
);

1387 
	`WARN_ON
(
˘x
->
vif
 != vif);

1388 
˘x
->
vif
 = 
NULL
;

1390 
	`iwl_ã¨down_öãrÁ˚
(
¥iv
, 
vif
, 
Ál£
);

1392 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1394 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1396 
	}
}

1398 
	$iwœgn_mac_ch™ge_öãrÁ˚
(
õì80211_hw
 *
hw
,

1399 
õì80211_vif
 *
vif
,

1400 
∆80211_i·y≥
 
√wty≥
, 
boﬁ
 
√wp2p
)

1402 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1403 
iwl_rx⁄_c⁄ãxt
 *
˘x
, *
tmp
;

1404 
∆80211_i·y≥
 
√wvi·y≥
 = 
√wty≥
;

1405 
u32
 
öãrÁ˚_modes
;

1406 
îr
;

1408 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1410 
√wty≥
 = 
	`õì80211_i·y≥_p2p
“ewty≥, 
√wp2p
);

1412 
	`muãx_lock
(&
¥iv
->
muãx
);

1414 
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

1421 i‡(
˘x
->
˘xid
 !
IWL_RXON_CTX_BSS
) {

1422 
îr
 = -
EBUSY
;

1423 
out
;

1426 i‡(!
˘x
->
vif
 || !
	`iwl_is_ªady_rf
(
¥iv
)) {

1431 
îr
 = -
EBUSY
;

1432 
out
;

1436 
öãrÁ˚_modes
 = 
˘x
->öãrÁ˚_mode†| ctx->
ex˛usive_öãrÁ˚_modes
;

1437 i‡(!(
öãrÁ˚_modes
 & 
	`BIT
(
√wty≥
))) {

1438 
îr
 = -
EBUSY
;

1439 
out
;

1442 i‡(
˘x
->
ex˛usive_öãrÁ˚_modes
 & 
	`BIT
(
√wty≥
)) {

1443 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
tmp
) {

1444 i‡(
˘x
 =
tmp
)

1447 i‡(!
tmp
->
is_a˘ive
)

1454 
îr
 = -
EBUSY
;

1455 
out
;

1460 
	`iwl_ã¨down_öãrÁ˚
(
¥iv
, 
vif
, 
åue
);

1461 
vif
->
ty≥
 = 
√wvi·y≥
;

1462 
vif
->
p2p
 = 
√wp2p
;

1463 
îr
 = 
	`iwl_£tup_öãrÁ˚
(
¥iv
, 
˘x
);

1464 
	`WARN_ON
(
îr
);

1472 
îr
 = 0;

1474 
out
:

1475 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1476 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1478  
îr
;

1479 
	}
}

1481 
	$iwœgn_mac_hw_sˇn
(
õì80211_hw
 *
hw
,

1482 
õì80211_vif
 *
vif
,

1483 
õì80211_sˇn_ªque°
 *
hw_ªq
)

1485 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1486 
cfg80211_sˇn_ªque°
 *
ªq
 = &
hw_ªq
->req;

1487 
ªt
;

1489 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1491 i‡(
ªq
->
n_ch™√ls
 == 0)

1492  -
EINVAL
;

1494 
	`muãx_lock
(&
¥iv
->
muãx
);

1500 i‡(
¥iv
->
sˇn_ty≥
 !
IWL_SCAN_NORMAL
) {

1501 
	`IWL_DEBUG_SCAN
(
¥iv
,

1503 
¥iv
->
sˇn_ªque°
 = 
ªq
;

1504 
¥iv
->
sˇn_vif
 = 
vif
;

1505 
ªt
 = 0;

1507 
¥iv
->
sˇn_ªque°
 = 
ªq
;

1508 
¥iv
->
sˇn_vif
 = 
vif
;

1513 
ªt
 = 
	`iwl_sˇn_öôüã
(
¥iv
, 
vif
, 
IWL_SCAN_NORMAL
,

1514 
ªq
->
ch™√ls
[0]->
b™d
);

1515 i‡(
ªt
) {

1516 
¥iv
->
sˇn_ªque°
 = 
NULL
;

1517 
¥iv
->
sˇn_vif
 = 
NULL
;

1521 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1523 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1525  
ªt
;

1526 
	}
}

1528 
	$iwl_°a_modify_ps_wake
(
iwl_¥iv
 *
¥iv
, 
°a_id
)

1530 
iwl_add°a_cmd
 
cmd
 = {

1531 .
mode
 = 
STA_CONTROL_MODIFY_MSK
,

1532 .
°©i⁄_Êags_msk
 = 
STA_FLG_PWR_SAVE_MSK
,

1533 .
°a
.
°a_id
 = sta_id,

1536 
	`iwl_£nd_add_°a
(
¥iv
, &
cmd
, 
CMD_ASYNC
);

1537 
	}
}

1539 
	$iwœgn_mac_°a_nŸify
(
õì80211_hw
 *
hw
,

1540 
õì80211_vif
 *
vif
,

1541 
°a_nŸify_cmd
 
cmd
,

1542 
õì80211_°a
 *
°a
)

1544 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1545 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

1546 
°a_id
;

1548 
	`IWL_DEBUG_MAC80211
(
¥iv
, "enter\n");

1550 
cmd
) {

1551 
STA_NOTIFY_SLEEP
:

1552 
	`WARN_ON
(!
°a_¥iv
->
˛õ¡
);

1553 
°a_¥iv
->
a¶ìp
 = 
åue
;

1554 i‡(
	`©omic_ªad
(&
°a_¥iv
->
≥ndög_‰ames
) > 0)

1555 
	`õì80211_°a_block_awake
(
hw
, 
°a
, 
åue
);

1557 
STA_NOTIFY_AWAKE
:

1558 
	`WARN_ON
(!
°a_¥iv
->
˛õ¡
);

1559 i‡(!
°a_¥iv
->
a¶ìp
)

1561 
°a_¥iv
->
a¶ìp
 = 
Ál£
;

1562 
°a_id
 = 
	`iwl_°a_id
(
°a
);

1563 i‡(
°a_id
 !
IWL_INVALID_STATION
)

1564 
	`iwl_°a_modify_ps_wake
(
¥iv
, 
°a_id
);

1569 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1570 
	}
}

1572 c⁄° 
õì80211_›s
 
	giwœgn_hw_›s
 = {

1573 .
add_ch™˘x
 = 
õì80211_emuœã_add_ch™˘x
,

1574 .
	gªmove_ch™˘x
 = 
õì80211_emuœã_ªmove_ch™˘x
,

1575 .
	gch™ge_ch™˘x
 = 
õì80211_emuœã_ch™ge_ch™˘x
,

1576 .
	gswôch_vif_ch™˘x
 = 
õì80211_emuœã_swôch_vif_ch™˘x
,

1577 .
	gtx
 = 
iwœgn_mac_tx
,

1578 .
	gwake_tx_queue
 = 
õì80211_h™dÀ_wake_tx_queue
,

1579 .
	g°¨t
 = 
iwœgn_mac_°¨t
,

1580 .
	g°›
 = 
iwœgn_mac_°›
,

1581 #ifde‡
CONFIG_PM_SLEEP


1582 .
	gsu•íd
 = 
iwœgn_mac_su•íd
,

1583 .
	gªsume
 = 
iwœgn_mac_ªsume
,

1584 .
	g£t_wakeup
 = 
iwœgn_mac_£t_wakeup
,

1586 .
	gadd_öãrÁ˚
 = 
iwœgn_mac_add_öãrÁ˚
,

1587 .
	gªmove_öãrÁ˚
 = 
iwœgn_mac_ªmove_öãrÁ˚
,

1588 .
	gch™ge_öãrÁ˚
 = 
iwœgn_mac_ch™ge_öãrÁ˚
,

1589 .
	gc⁄fig
 = 
iwœgn_mac_c⁄fig
,

1590 .
	gc⁄figuª_fûãr
 = 
iwœgn_c⁄figuª_fûãr
,

1591 .
	g£t_key
 = 
iwœgn_mac_£t_key
,

1592 .
	gupd©e_tkù_key
 = 
iwœgn_mac_upd©e_tkù_key
,

1593 .
	g£t_ªkey_d©a
 = 
iwœgn_mac_£t_ªkey_d©a
,

1594 .
	gc⁄f_tx
 = 
iwœgn_mac_c⁄f_tx
,

1595 .
	gbss_öfo_ch™ged
 = 
iwœgn_bss_öfo_ch™ged
,

1596 .
	gampdu_a˘i⁄
 = 
iwœgn_mac_ampdu_a˘i⁄
,

1597 .
	ghw_sˇn
 = 
iwœgn_mac_hw_sˇn
,

1598 .
	g°a_nŸify
 = 
iwœgn_mac_°a_nŸify
,

1599 .
	g°a_°©e
 = 
iwœgn_mac_°a_°©e
,

1600 .
	gch™√l_swôch
 = 
iwœgn_mac_ch™√l_swôch
,

1601 .
	gÊush
 = 
iwœgn_mac_Êush
,

1602 .
	gtx_œ°_bóc⁄
 = 
iwœgn_mac_tx_œ°_bóc⁄
,

1603 .
	gevít_ˇŒback
 = 
iwœgn_mac_evít_ˇŒback
,

1604 .
	g£t_tim
 = 
iwœgn_mac_£t_tim
,

1608 
õì80211_hw
 *
	$iwl_Æloc_Æl
()

1610 
iwl_¥iv
 *
¥iv
;

1611 
iwl_›_mode
 *
›_mode
;

1614 
õì80211_hw
 *
hw
;

1616 
hw
 = 
	`õì80211_Æloc_hw
((
iwl_¥iv
) +

1617 (
iwl_›_mode
), &
iwœgn_hw_›s
);

1618 i‡(!
hw
)

1619 
out
;

1621 
›_mode
 = 
hw
->
¥iv
;

1622 
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1623 
¥iv
->
hw
 = hw;

1625 
out
:

1626  
hw
;

1627 
	}
}

	@dvm/main.c

11 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

13 
	~<löux/kî√l.h
>

14 
	~<löux/moduÀ.h
>

15 
	~<löux/öô.h
>

16 
	~<löux/¶ab.h
>

17 
	~<löux/dñay.h
>

18 
	~<löux/sched.h
>

19 
	~<löux/skbuff.h
>

20 
	~<löux/√tdevi˚.h
>

21 
	~<löux/ëhîdevi˚.h
>

22 
	~<löux/if_¨p.h
>

24 
	~<√t/mac80211.h
>

26 
	~<asm/div64.h
>

28 
	~"iwl-ì¥om-ªad.h
"

29 
	~"iwl-ì¥om-∑r£.h
"

30 
	~"iwl-io.h
"

31 
	~"iwl-å™s.h
"

32 
	~"iwl-›-mode.h
"

33 
	~"iwl-drv.h
"

34 
	~"iwl-mod∑øms.h
"

35 
	~"iwl-¥ph.h
"

37 
	~"dev.h
"

38 
	~"ˇlib.h
"

39 
	~"agn.h
"

48 
	#DRV_DESCRIPTION
 "I¡ñ(RËWúñes†WiFòLök AGN drivî f‹ Löux"

	)

49 
MODULE_DESCRIPTION
(
DRV_DESCRIPTION
);

50 
MODULE_LICENSE
("GPL");

51 
MODULE_IMPORT_NS
(
IWLWIFI
);

57 c⁄° 
iwl_hcmd_«mes
 
	giwl_dvm_cmd_«mes
[] = {

58 
HCMD_NAME
(
REPLY_ALIVE
),

59 
HCMD_NAME
(
REPLY_ERROR
),

60 
HCMD_NAME
(
REPLY_ECHO
),

61 
HCMD_NAME
(
REPLY_RXON
),

62 
HCMD_NAME
(
REPLY_RXON_ASSOC
),

63 
HCMD_NAME
(
REPLY_QOS_PARAM
),

64 
HCMD_NAME
(
REPLY_RXON_TIMING
),

65 
HCMD_NAME
(
REPLY_ADD_STA
),

66 
HCMD_NAME
(
REPLY_REMOVE_STA
),

67 
HCMD_NAME
(
REPLY_REMOVE_ALL_STA
),

68 
HCMD_NAME
(
REPLY_TX
),

69 
HCMD_NAME
(
REPLY_TXFIFO_FLUSH
),

70 
HCMD_NAME
(
REPLY_WEPKEY
),

71 
HCMD_NAME
(
REPLY_LEDS_CMD
),

72 
HCMD_NAME
(
REPLY_TX_LINK_QUALITY_CMD
),

73 
HCMD_NAME
(
COEX_PRIORITY_TABLE_CMD
),

74 
HCMD_NAME
(
COEX_MEDIUM_NOTIFICATION
),

75 
HCMD_NAME
(
COEX_EVENT_CMD
),

76 
HCMD_NAME
(
TEMPERATURE_NOTIFICATION
),

77 
HCMD_NAME
(
CALIBRATION_CFG_CMD
),

78 
HCMD_NAME
(
CALIBRATION_RES_NOTIFICATION
),

79 
HCMD_NAME
(
CALIBRATION_COMPLETE_NOTIFICATION
),

80 
HCMD_NAME
(
REPLY_QUIET_CMD
),

81 
HCMD_NAME
(
REPLY_CHANNEL_SWITCH
),

82 
HCMD_NAME
(
CHANNEL_SWITCH_NOTIFICATION
),

83 
HCMD_NAME
(
REPLY_SPECTRUM_MEASUREMENT_CMD
),

84 
HCMD_NAME
(
SPECTRUM_MEASURE_NOTIFICATION
),

85 
HCMD_NAME
(
POWER_TABLE_CMD
),

86 
HCMD_NAME
(
PM_SLEEP_NOTIFICATION
),

87 
HCMD_NAME
(
PM_DEBUG_STATISTIC_NOTIFIC
),

88 
HCMD_NAME
(
REPLY_SCAN_CMD
),

89 
HCMD_NAME
(
REPLY_SCAN_ABORT_CMD
),

90 
HCMD_NAME
(
SCAN_START_NOTIFICATION
),

91 
HCMD_NAME
(
SCAN_RESULTS_NOTIFICATION
),

92 
HCMD_NAME
(
SCAN_COMPLETE_NOTIFICATION
),

93 
HCMD_NAME
(
BEACON_NOTIFICATION
),

94 
HCMD_NAME
(
REPLY_TX_BEACON
),

95 
HCMD_NAME
(
WHO_IS_AWAKE_NOTIFICATION
),

96 
HCMD_NAME
(
REPLY_TX_POWER_DBM_CMD
),

97 
HCMD_NAME
(
QUIET_NOTIFICATION
),

98 
HCMD_NAME
(
REPLY_TX_PWR_TABLE_CMD
),

99 
HCMD_NAME
(
REPLY_TX_POWER_DBM_CMD_V1
),

100 
HCMD_NAME
(
TX_ANT_CONFIGURATION_CMD
),

101 
HCMD_NAME
(
MEASURE_ABORT_NOTIFICATION
),

102 
HCMD_NAME
(
REPLY_BT_CONFIG
),

103 
HCMD_NAME
(
REPLY_STATISTICS_CMD
),

104 
HCMD_NAME
(
STATISTICS_NOTIFICATION
),

105 
HCMD_NAME
(
REPLY_CARD_STATE_CMD
),

106 
HCMD_NAME
(
CARD_STATE_NOTIFICATION
),

107 
HCMD_NAME
(
MISSED_BEACONS_NOTIFICATION
),

108 
HCMD_NAME
(
REPLY_CT_KILL_CONFIG_CMD
),

109 
HCMD_NAME
(
SENSITIVITY_CMD
),

110 
HCMD_NAME
(
REPLY_PHY_CALIBRATION_CMD
),

111 
HCMD_NAME
(
REPLY_WIPAN_PARAMS
),

112 
HCMD_NAME
(
REPLY_WIPAN_RXON
),

113 
HCMD_NAME
(
REPLY_WIPAN_RXON_TIMING
),

114 
HCMD_NAME
(
REPLY_WIPAN_RXON_ASSOC
),

115 
HCMD_NAME
(
REPLY_WIPAN_QOS_PARAM
),

116 
HCMD_NAME
(
REPLY_WIPAN_WEPKEY
),

117 
HCMD_NAME
(
REPLY_WIPAN_P2P_CHANNEL_SWITCH
),

118 
HCMD_NAME
(
REPLY_WIPAN_NOA_NOTIFICATION
),

119 
HCMD_NAME
(
REPLY_WIPAN_DEACTIVATION_COMPLETE
),

120 
HCMD_NAME
(
REPLY_RX_PHY_CMD
),

121 
HCMD_NAME
(
REPLY_RX_MPDU_CMD
),

122 
HCMD_NAME
(
REPLY_RX
),

123 
HCMD_NAME
(
REPLY_COMPRESSED_BA
),

124 
HCMD_NAME
(
REPLY_BT_COEX_PRIO_TABLE
),

125 
HCMD_NAME
(
REPLY_BT_COEX_PROT_ENV
),

126 
HCMD_NAME
(
REPLY_BT_COEX_PROFILE_NOTIF
),

127 
HCMD_NAME
(
REPLY_D3_CONFIG
),

128 
HCMD_NAME
(
REPLY_WOWLAN_PATTERNS
),

129 
HCMD_NAME
(
REPLY_WOWLAN_WAKEUP_FILTER
),

130 
HCMD_NAME
(
REPLY_WOWLAN_TSC_RSC_PARAMS
),

131 
HCMD_NAME
(
REPLY_WOWLAN_TKIP_PARAMS
),

132 
HCMD_NAME
(
REPLY_WOWLAN_KEK_KCK_MATERIAL
),

133 
HCMD_NAME
(
REPLY_WOWLAN_GET_STATUS
),

136 c⁄° 
iwl_hcmd_¨r
 
	giwl_dvm_groups
[] = {

137 [0x0] = 
HCMD_ARR
(
iwl_dvm_cmd_«mes
),

140 c⁄° 
iwl_›_mode_›s
 
	giwl_dvm_›s
;

142 
	$iwl_upd©e_chaö_Êags
(
iwl_¥iv
 *
¥iv
)

144 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

146 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

147 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

148 i‡(
˘x
->
a˘ive
.
rx_chaö
 !˘x->
°agög
.rx_chain)

149 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

151 
	}
}

154 
	$iwl_£t_bóc⁄_tim
(
iwl_¥iv
 *
¥iv
,

155 
iwl_tx_bóc⁄_cmd
 *
tx_bóc⁄_cmd
,

156 
u8
 *
bóc⁄
, 
u32
 
‰ame_size
)

158 
u16
 
tim_idx
;

159 
õì80211_mgmt
 *
mgmt
 = (õì80211_mgmà*)
bóc⁄
;

165 
tim_idx
 = 
mgmt
->
u
.
bóc⁄
.
v¨übÀ
 - beacon;

168 (
tim_idx
 < (
‰ame_size
 - 2)) &&

169 (
bóc⁄
[
tim_idx
] !
WLAN_EID_TIM
))

170 
tim_idx
 +
bóc⁄
[tim_idx+1] + 2;

173 i‡((
tim_idx
 < (
‰ame_size
 - 1)Ë&& (
bóc⁄
[tim_idx] =
WLAN_EID_TIM
)) {

174 
tx_bóc⁄_cmd
->
tim_idx
 = 
	`˝u_to_À16
(tim_idx);

175 
tx_bóc⁄_cmd
->
tim_size
 = 
bóc⁄
[
tim_idx
+1];

177 
	`IWL_WARN
(
¥iv
, "UnableÅo find TIM Element in beacon\n");

178 
	}
}

180 
	$iwœgn_£nd_bóc⁄_cmd
(
iwl_¥iv
 *
¥iv
)

182 
iwl_tx_bóc⁄_cmd
 *
tx_bóc⁄_cmd
;

183 
iwl_ho°_cmd
 
cmd
 = {

184 .
id
 = 
REPLY_TX_BEACON
,

186 
õì80211_tx_öfo
 *
öfo
;

187 
u32
 
‰ame_size
;

188 
u32
 
øã_Êags
;

189 
u32
 
øã
;

196 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

198 i‡(!
¥iv
->
bóc⁄_˘x
) {

199 
	`IWL_ERR
(
¥iv
, "tryingÅo build beacon w/o beacon context!\n");

203 i‡(
	`WARN_ON
(!
¥iv
->
bóc⁄_skb
))

204  -
EINVAL
;

207 i‡(!
¥iv
->
bóc⁄_cmd
)

208 
¥iv
->
bóc⁄_cmd
 = 
	`kzÆloc
((*
tx_bóc⁄_cmd
), 
GFP_KERNEL
);

209 
tx_bóc⁄_cmd
 = 
¥iv
->
bóc⁄_cmd
;

210 i‡(!
tx_bóc⁄_cmd
)

211  -
ENOMEM
;

213 
‰ame_size
 = 
¥iv
->
bóc⁄_skb
->
Àn
;

216 
tx_bóc⁄_cmd
->
tx
.
Àn
 = 
	`˝u_to_À16
((
u16
)
‰ame_size
);

217 
tx_bóc⁄_cmd
->
tx
.
°a_id
 = 
¥iv
->
bóc⁄_˘x
->
bˇ°_°a_id
;

218 
tx_bóc⁄_cmd
->
tx
.
°›_time
.
li„_time
 = 
TX_CMD_LIFE_TIME_INFINITE
;

219 
tx_bóc⁄_cmd
->
tx
.
tx_Êags
 = 
TX_CMD_FLG_SEQ_CTL_MSK
 |

220 
TX_CMD_FLG_TSF_MSK
 | 
TX_CMD_FLG_STA_RATE_MSK
;

223 
	`iwl_£t_bóc⁄_tim
(
¥iv
, 
tx_bóc⁄_cmd
,Öriv->
bóc⁄_skb
->
d©a
,

224 
‰ame_size
);

227 
öfo
 = 
	`IEEE80211_SKB_CB
(
¥iv
->
bóc⁄_skb
);

234 i‡(
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
 < 0 ||

235 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 & 
IEEE80211_TX_RC_MCS
)

236 
øã
 = 0;

238 
øã
 = 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
;

240 
¥iv
->
mgmt_tx_™t
 = 
	`iwl_toggÀ_tx_™t
(priv,Öriv->mgmt_tx_ant,

241 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

242 
øã_Êags
 = 
	`iwl_™t_idx_to_Êags
(
¥iv
->
mgmt_tx_™t
);

245 i‡(
öfo
->
b™d
 =
NL80211_BAND_5GHZ
)

246 
øã
 +
IWL_FIRST_OFDM_RATE
;

247 i‡(
øã
 >
IWL_FIRST_CCK_RATE
 &&Ñ©ê<
IWL_LAST_CCK_RATE
)

248 
øã_Êags
 |
RATE_MCS_CCK_MSK
;

250 
tx_bóc⁄_cmd
->
tx
.
øã_n_Êags
 =

251 
	`iwl_hw_£t_øã_n_Êags
(
øã
, 
øã_Êags
);

254 
cmd
.
Àn
[0] = (*
tx_bóc⁄_cmd
);

255 
cmd
.
d©a
[0] = 
tx_bóc⁄_cmd
;

256 
cmd
.
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
;

257 
cmd
.
Àn
[1] = 
‰ame_size
;

258 
cmd
.
d©a
[1] = 
¥iv
->
bóc⁄_skb
->data;

259 
cmd
.
d©aÊags
[1] = 
IWL_HCMD_DFL_NOCOPY
;

261  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

262 
	}
}

264 
	$iwl_bg_bóc⁄_upd©e
(
w‹k_°ru˘
 *
w‹k
)

266 
iwl_¥iv
 *
¥iv
 =

267 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
bóc⁄_upd©e
);

268 
sk_buff
 *
bóc⁄
;

270 
	`muãx_lock
(&
¥iv
->
muãx
);

271 i‡(!
¥iv
->
bóc⁄_˘x
) {

272 
	`IWL_ERR
(
¥iv
, "updating beacon w/o beacon context!\n");

273 
out
;

276 i‡(
¥iv
->
bóc⁄_˘x
->
vif
->
ty≥
 !
NL80211_IFTYPE_AP
) {

283 
out
;

287 
bóc⁄
 = 
	`õì80211_bóc⁄_gë
(
¥iv
->
hw
,Öriv->
bóc⁄_˘x
->
vif
, 0);

288 i‡(!
bóc⁄
) {

289 
	`IWL_ERR
(
¥iv
, "update beacon failed -- keeping old\n");

290 
out
;

294 
	`dev_k‰ì_skb
(
¥iv
->
bóc⁄_skb
);

296 
¥iv
->
bóc⁄_skb
 = 
bóc⁄
;

298 
	`iwœgn_£nd_bóc⁄_cmd
(
¥iv
);

299 
out
:

300 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

301 
	}
}

303 
	$iwl_bg_bt_ru¡ime_c⁄fig
(
w‹k_°ru˘
 *
w‹k
)

305 
iwl_¥iv
 *
¥iv
 =

306 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
bt_ru¡ime_c⁄fig
);

308 
	`muãx_lock
(&
¥iv
->
muãx
);

309 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

310 
out
;

313 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

314 
out
;

316 
	`iwœgn_£nd_adv™˚_bt_c⁄fig
(
¥iv
);

317 
out
:

318 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

319 
	}
}

321 
	$iwl_bg_bt_fuŒ_c⁄cuºícy
(
w‹k_°ru˘
 *
w‹k
)

323 
iwl_¥iv
 *
¥iv
 =

324 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
bt_fuŒ_c⁄cuºícy
);

325 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

327 
	`muãx_lock
(&
¥iv
->
muãx
);

329 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

330 
out
;

333 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

334 
out
;

336 
	`IWL_DEBUG_INFO
(
¥iv
, "BT coex in %s mode\n",

337 
¥iv
->
bt_fuŒ_c⁄cuºít
 ?

344 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

345 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

346 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

349 
	`iwœgn_£nd_adv™˚_bt_c⁄fig
(
¥iv
);

350 
out
:

351 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

352 
	}
}

354 
	$iwl_£nd_°©i°ics_ªque°
(
iwl_¥iv
 *
¥iv
, 
u8
 
Êags
, 
boﬁ
 
˛ór
)

356 
iwl_°©i°ics_cmd
 
°©i°ics_cmd
 = {

357 .
c⁄figuøti⁄_Êags
 =

358 
˛ór
 ? 
IWL_STATS_CONF_CLEAR_STATS
 : 0,

361 i‡(
Êags
 & 
CMD_ASYNC
)

362  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_STATISTICS_CMD
,

363 
CMD_ASYNC
,

364 (
iwl_°©i°ics_cmd
),

365 &
°©i°ics_cmd
);

367  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_STATISTICS_CMD
, 0,

368 (
iwl_°©i°ics_cmd
),

369 &
°©i°ics_cmd
);

370 
	}
}

382 
	$iwl_bg_°©i°ics_≥riodic
(
timî_li°
 *
t
)

384 
iwl_¥iv
 *
¥iv
 = 
	`‰om_timî
’riv, 
t
, 
°©i°ics_≥riodic
);

386 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

390 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

393 
	`iwl_£nd_°©i°ics_ªque°
(
¥iv
, 
CMD_ASYNC
, 
Ál£
);

394 
	}
}

397 
	$iwl_¥öt_c⁄t_evít_åa˚
(
iwl_¥iv
 *
¥iv
, 
u32
 
ba£
,

398 
u32
 
°¨t_idx
, u32 
num_evíts
,

399 
u32
 
ˇ∑côy
, u32 
mode
)

401 
u32
 
i
;

402 
u32
 
±r
;

403 
u32
 
ev
, 
time
, 
d©a
;

405 i‡(
mode
 == 0)

406 
±r
 = 
ba£
 + (4 * (
u32
)Ë+ (
°¨t_idx
 * 2 * (u32));

408 
±r
 = 
ba£
 + (4 * (
u32
)Ë+ (
°¨t_idx
 * 3 * (u32));

411 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
¥iv
->
å™s
))

415 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
HBUS_TARG_MEM_RADDR
, 
±r
);

423 i‡(
	`WARN_ON
(
num_evíts
 > 
ˇ∑côy
 - 
°¨t_idx
))

424 
num_evíts
 = 
ˇ∑côy
 - 
°¨t_idx
;

430 
i
 = 0; i < 
num_evíts
; i++) {

431 
ev
 = 
	`iwl_ªad32
(
¥iv
->
å™s
, 
HBUS_TARG_MEM_RDAT
);

432 
time
 = 
	`iwl_ªad32
(
¥iv
->
å™s
, 
HBUS_TARG_MEM_RDAT
);

433 i‡(
mode
 == 0) {

434 
	`åa˚_iwlwifi_dev_ucode_c⁄t_evít
(

435 
¥iv
->
å™s
->
dev
, 0, 
time
, 
ev
);

437 
d©a
 = 
	`iwl_ªad32
(
¥iv
->
å™s
, 
HBUS_TARG_MEM_RDAT
);

438 
	`åa˚_iwlwifi_dev_ucode_c⁄t_evít
(

439 
¥iv
->
å™s
->
dev
, 
time
, 
d©a
, 
ev
);

443 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
¥iv
->
å™s
);

444 
	}
}

446 
	$iwl_c⁄töuous_evít_åa˚
(
iwl_¥iv
 *
¥iv
)

448 
u32
 
ˇ∑côy
;

450 
u32
 
ˇ∑côy
;

451 
u32
 
mode
;

452 
u32
 
wøp_cou¡î
;

453 
u32
 
wrôe_cou¡î
;

454 } 
__∑cked
 
ªad
;

455 
u32
 
ba£
;

456 
u32
 
mode
;

457 
u32
 
num_wøps
;

458 
u32
 
√xt_íåy
;

460 
ba£
 = 
¥iv
->
devi˚_poöãrs
.
log_evít_èbÀ
;

461 i‡(
	`iwœgn_hw_vÆid_πc_d©a_addr
(
ba£
)) {

462 
	`iwl_å™s_ªad_mem_byãs
(
¥iv
->
å™s
, 
ba£
,

463 &
ªad
, (read));

464 
ˇ∑côy
 = 
ªad
.capacity;

465 
mode
 = 
ªad
.mode;

466 
num_wøps
 = 
ªad
.
wøp_cou¡î
;

467 
√xt_íåy
 = 
ªad
.
wrôe_cou¡î
;

476 i‡(
	`u∆ikñy
(
√xt_íåy
 =
ˇ∑côy
))

477 
√xt_íåy
 = 0;

486 i‡(
	`u∆ikñy
(
√xt_íåy
 < 
¥iv
->
evít_log
.next_entry &&

487 
num_wøps
 =
¥iv
->
evít_log
.num_wraps))

488 
num_wøps
++;

490 i‡(
num_wøps
 =
¥iv
->
evít_log
.num_wraps) {

491 
	`iwl_¥öt_c⁄t_evít_åa˚
(

492 
¥iv
, 
ba£
,Öriv->
evít_log
.
√xt_íåy
,

493 
√xt_íåy
 - 
¥iv
->
evít_log
.next_entry,

494 
ˇ∑côy
, 
mode
);

496 
¥iv
->
evít_log
.
n⁄_wøps_cou¡
++;

498 i‡(
num_wøps
 - 
¥iv
->
evít_log
.num_wraps > 1)

499 
¥iv
->
evít_log
.
wøps_m‹e_cou¡
++;

501 
¥iv
->
evít_log
.
wøps_⁄˚_cou¡
++;

503 
	`åa˚_iwlwifi_dev_ucode_wøp_evít
(
¥iv
->
å™s
->
dev
,

504 
num_wøps
 - 
¥iv
->
evít_log
.num_wraps,

505 
√xt_íåy
, 
¥iv
->
evít_log
.next_entry);

507 i‡(
√xt_íåy
 < 
¥iv
->
evít_log
.next_entry) {

508 
	`iwl_¥öt_c⁄t_evít_åa˚
(

509 
¥iv
, 
ba£
,Öriv->
evít_log
.
√xt_íåy
,

510 
ˇ∑côy
 - 
¥iv
->
evít_log
.
√xt_íåy
,

511 
ˇ∑côy
, 
mode
);

513 
	`iwl_¥öt_c⁄t_evít_åa˚
(

514 
¥iv
, 
ba£
, 0, 
√xt_íåy
, 
ˇ∑côy
, 
mode
);

516 
	`iwl_¥öt_c⁄t_evít_åa˚
(

517 
¥iv
, 
ba£
, 
√xt_íåy
,

518 
ˇ∑côy
 - 
√xt_íåy
,

519 
ˇ∑côy
, 
mode
);

521 
	`iwl_¥öt_c⁄t_evít_åa˚
(

522 
¥iv
, 
ba£
, 0, 
√xt_íåy
, 
ˇ∑côy
, 
mode
);

526 
¥iv
->
evít_log
.
num_wøps
 =Çum_wraps;

527 
¥iv
->
evít_log
.
√xt_íåy
 =Çext_entry;

528 
	}
}

538 
	$iwl_bg_ucode_åa˚
(
timî_li°
 *
t
)

540 
iwl_¥iv
 *
¥iv
 = 
	`‰om_timî
’riv, 
t
, 
ucode_åa˚
);

542 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

545 i‡(
¥iv
->
evít_log
.
ucode_åa˚
) {

546 
	`iwl_c⁄töuous_evít_åa˚
(
¥iv
);

548 
	`mod_timî
(&
¥iv
->
ucode_åa˚
,

549 
jiffõs
 + 
	`m£cs_to_jiffõs
(
UCODE_TRACE_PERIOD
));

551 
	}
}

553 
	$iwl_bg_tx_Êush
(
w‹k_°ru˘
 *
w‹k
)

555 
iwl_¥iv
 *
¥iv
 =

556 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
tx_Êush
);

558 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

562 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

565 
	`IWL_DEBUG_INFO
(
¥iv
, "deviceÑequest: flushállÅx frames\n");

566 
	`iwœgn_dev_txfifo_Êush
(
¥iv
);

567 
	}
}

573 c⁄° 
u8
 
	giwœgn_bss_ac_to_fifo
[] = {

574 
IWL_TX_FIFO_VO
,

575 
IWL_TX_FIFO_VI
,

576 
IWL_TX_FIFO_BE
,

577 
IWL_TX_FIFO_BK
,

580 c⁄° 
u8
 
	giwœgn_bss_ac_to_queue
[] = {

584 c⁄° 
u8
 
	giwœgn_∑n_ac_to_fifo
[] = {

585 
IWL_TX_FIFO_VO_IPAN
,

586 
IWL_TX_FIFO_VI_IPAN
,

587 
IWL_TX_FIFO_BE_IPAN
,

588 
IWL_TX_FIFO_BK_IPAN
,

591 c⁄° 
u8
 
	giwœgn_∑n_ac_to_queue
[] = {

595 
	$iwl_öô_c⁄ãxt
(
iwl_¥iv
 *
¥iv
, 
u32
 
ucode_Êags
)

597 
i
;

603 
¥iv
->
vÆid_c⁄ãxts
 = 
	`BIT
(
IWL_RXON_CTX_BSS
);

604 i‡(
ucode_Êags
 & 
IWL_UCODE_TLV_FLAGS_PAN
)

605 
¥iv
->
vÆid_c⁄ãxts
 |
	`BIT
(
IWL_RXON_CTX_PAN
);

607 
i
 = 0; i < 
NUM_IWL_RXON_CTX
; i++)

608 
¥iv
->
c⁄ãxts
[
i
].
˘xid
 = i;

610 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
Æways_a˘ive
 = 
åue
;

611 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
is_a˘ive
 = 
åue
;

612 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
rx⁄_cmd
 = 
REPLY_RXON
;

613 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
rx⁄_timög_cmd
 = 
REPLY_RXON_TIMING
;

614 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
rx⁄_assoc_cmd
 = 
REPLY_RXON_ASSOC
;

615 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
qos_cmd
 = 
REPLY_QOS_PARAM
;

616 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
≠_°a_id
 = 
IWL_AP_ID
;

617 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
wï_key_cmd
 = 
REPLY_WEPKEY
;

618 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
bˇ°_°a_id
 = 
IWLAGN_BROADCAST_ID
;

619 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
ex˛usive_öãrÁ˚_modes
 =

620 
	`BIT
(
NL80211_IFTYPE_ADHOC
Ë| BIT(
NL80211_IFTYPE_MONITOR
);

621 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
öãrÁ˚_modes
 =

622 
	`BIT
(
NL80211_IFTYPE_STATION
);

623 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
≠_devty≥
 = 
RXON_DEV_TYPE_AP
;

624 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
ibss_devty≥
 = 
RXON_DEV_TYPE_IBSS
;

625 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
°©i⁄_devty≥
 = 
RXON_DEV_TYPE_ESS
;

626 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
unu£d_devty≥
 = 
RXON_DEV_TYPE_ESS
;

627 
	`mem˝y
(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
ac_to_queue
,

628 
iwœgn_bss_ac_to_queue
, (iwlagn_bss_ac_to_queue));

629 
	`mem˝y
(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
ac_to_fifo
,

630 
iwœgn_bss_ac_to_fifo
, (iwlagn_bss_ac_to_fifo));

632 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
rx⁄_cmd
 = 
REPLY_WIPAN_RXON
;

633 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
rx⁄_timög_cmd
 =

634 
REPLY_WIPAN_RXON_TIMING
;

635 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
rx⁄_assoc_cmd
 =

636 
REPLY_WIPAN_RXON_ASSOC
;

637 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
qos_cmd
 = 
REPLY_WIPAN_QOS_PARAM
;

638 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
≠_°a_id
 = 
IWL_AP_ID_PAN
;

639 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
wï_key_cmd
 = 
REPLY_WIPAN_WEPKEY
;

640 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
bˇ°_°a_id
 = 
IWLAGN_PAN_BCAST_ID
;

641 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
°©i⁄_Êags
 = 
STA_FLG_PAN_STATION
;

642 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
öãrÁ˚_modes
 =

643 
	`BIT
(
NL80211_IFTYPE_STATION
Ë| BIT(
NL80211_IFTYPE_AP
);

645 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
≠_devty≥
 = 
RXON_DEV_TYPE_CP
;

646 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
°©i⁄_devty≥
 = 
RXON_DEV_TYPE_2STA
;

647 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
unu£d_devty≥
 = 
RXON_DEV_TYPE_P2P
;

648 
	`mem˝y
(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
ac_to_queue
,

649 
iwœgn_∑n_ac_to_queue
, (iwlagn_pan_ac_to_queue));

650 
	`mem˝y
(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
ac_to_fifo
,

651 
iwœgn_∑n_ac_to_fifo
, (iwlagn_pan_ac_to_fifo));

652 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
mˇ°_queue
 = 
IWL_IPAN_MCAST_QUEUE
;

654 
	`BUILD_BUG_ON
(
NUM_IWL_RXON_CTX
 != 2);

655 
	}
}

657 
	$iwl_rf_kûl_˘_c⁄fig
(
iwl_¥iv
 *
¥iv
)

659 
iwl_˘_kûl_c⁄fig
 
cmd
;

660 
iwl_˘_kûl_thrŸéög_c⁄fig
 
adv_cmd
;

661 
ªt
 = 0;

663 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_CLR
,

664 
CSR_UCODE_DRV_GP1_REG_BIT_CT_KILL_EXIT
);

666 
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_toggÀ
 = 
Ál£
;

668 i‡(
¥iv
->
lib
->
suµ‹t_˘_kûl_exô
) {

669 
adv_cmd
.
¸ôiˇl_ãm≥øtuª_íãr
 =

670 
	`˝u_to_À32
(
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
);

671 
adv_cmd
.
¸ôiˇl_ãm≥øtuª_exô
 =

672 
	`˝u_to_À32
(
¥iv
->
hw_∑øms
.
˘_kûl_exô_thªshﬁd
);

674 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

675 
REPLY_CT_KILL_CONFIG_CMD
,

676 0, (
adv_cmd
), &adv_cmd);

677 i‡(
ªt
)

678 
	`IWL_ERR
(
¥iv
, "REPLY_CT_KILL_CONFIG_CMD failed\n");

680 
	`IWL_DEBUG_INFO
(
¥iv
, "REPLY_CT_KILL_CONFIG_CMD "

683 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
,

684 
¥iv
->
hw_∑øms
.
˘_kûl_exô_thªshﬁd
);

686 
cmd
.
¸ôiˇl_ãm≥øtuª_R
 =

687 
	`˝u_to_À32
(
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
);

689 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

690 
REPLY_CT_KILL_CONFIG_CMD
,

691 0, (
cmd
), &cmd);

692 i‡(
ªt
)

693 
	`IWL_ERR
(
¥iv
, "REPLY_CT_KILL_CONFIG_CMD failed\n");

695 
	`IWL_DEBUG_INFO
(
¥iv
, "REPLY_CT_KILL_CONFIG_CMD "

698 
¥iv
->
hw_∑øms
.
˘_kûl_thªshﬁd
);

700 
	}
}

702 
	$iwœgn_£nd_ˇlib_cfg_π
(
iwl_¥iv
 *
¥iv
, 
u32
 
cfg
)

704 
iwl_ˇlib_cfg_cmd
 
ˇlib_cfg_cmd
;

705 
iwl_ho°_cmd
 
cmd
 = {

706 .
id
 = 
CALIBRATION_CFG_CMD
,

707 .
Àn
 = { (
iwl_ˇlib_cfg_cmd
), },

708 .
d©a
 = { &
ˇlib_cfg_cmd
, },

711 
	`mem£t
(&
ˇlib_cfg_cmd
, 0, (calib_cfg_cmd));

712 
ˇlib_cfg_cmd
.
ucd_ˇlib_cfg
.
⁄˚
.
is_íabÀ
 = 
IWL_CALIB_RT_CFG_ALL
;

713 
ˇlib_cfg_cmd
.
ucd_ˇlib_cfg
.
⁄˚
.
°¨t
 = 
	`˝u_to_À32
(
cfg
);

715  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

716 
	}
}

719 
	$iwœgn_£nd_tx_™t_c⁄fig
(
iwl_¥iv
 *
¥iv
, 
u8
 
vÆid_tx_™t
)

721 
iwl_tx_™t_c⁄fig_cmd
 
tx_™t_cmd
 = {

722 .
vÆid
 = 
	`˝u_to_À32
(
vÆid_tx_™t
),

725 i‡(
	`IWL_UCODE_API
(
¥iv
->
fw
->
ucode_vî
) > 1) {

726 
	`IWL_DEBUG_HC
(
¥iv
, "£À˘ vÆidÅxá¡: %u\n", 
vÆid_tx_™t
);

727  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
TX_ANT_CONFIGURATION_CMD
, 0,

728 (
iwl_tx_™t_c⁄fig_cmd
),

729 &
tx_™t_cmd
);

731 
	`IWL_DEBUG_HC
(
¥iv
, "TX_ANT_CONFIGURATION_CMDÇot supported\n");

732  -
EOPNOTSUPP
;

734 
	}
}

736 
	$iwl_£nd_bt_c⁄fig
(
iwl_¥iv
 *
¥iv
)

738 
iwl_bt_cmd
 
bt_cmd
 = {

739 .
Àad_time
 = 
BT_LEAD_TIME_DEF
,

740 .
max_kûl
 = 
BT_MAX_KILL_DEF
,

741 .
kûl_ack_mask
 = 0,

742 .
kûl_˘s_mask
 = 0,

745 i‡(!
iwlwifi_mod_∑øms
.
bt_c€x_a˘ive
)

746 
bt_cmd
.
Êags
 = 
BT_COEX_DISABLE
;

748 
bt_cmd
.
Êags
 = 
BT_COEX_ENABLE
;

750 
¥iv
->
bt_íabÀ_Êag
 = 
bt_cmd
.
Êags
;

751 
	`IWL_DEBUG_INFO
(
¥iv
, "BT coex %s\n",

752 (
bt_cmd
.
Êags
 =
BT_COEX_DISABLE
) ? "disable" : "active");

754 i‡(
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_BT_CONFIG
,

755 0, (
iwl_bt_cmd
), &
bt_cmd
))

756 
	`IWL_ERR
(
¥iv
, "failedÅo send BT Coex Config\n");

757 
	}
}

764 
	$iwl_Æive_°¨t
(
iwl_¥iv
 *
¥iv
)

766 
ªt
 = 0;

767 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

769 
	`IWL_DEBUG_INFO
(
¥iv
, "Runtime AliveÑeceived.\n");

772 
	`£t_bô
(
STATUS_ALIVE
, &
¥iv
->
°©us
);

774 i‡(
	`iwl_is_rfkûl
(
¥iv
))

775  -
ERFKILL
;

777 i‡(
¥iv
->
evít_log
.
ucode_åa˚
) {

779 
	`mod_timî
(&
¥iv
->
ucode_åa˚
, 
jiffõs
);

783 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

784 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

786 i‡(
¥iv
->
lib
->
bt_∑øms
->
bt_sco_dißbÀ
)

787 
¥iv
->
bt_íabÀ_p•ﬁl
 = 
Ál£
;

789 
¥iv
->
bt_íabÀ_p•ﬁl
 = 
åue
;

791 
¥iv
->
bt_vÆid
 = 
IWLAGN_BT_ALL_VALID_MSK
;

792 
¥iv
->
kûl_ack_mask
 = 
IWLAGN_BT_KILL_ACK_MASK_DEFAULT
;

793 
¥iv
->
kûl_˘s_mask
 = 
IWLAGN_BT_KILL_CTS_MASK_DEFAULT
;

794 
	`iwœgn_£nd_adv™˚_bt_c⁄fig
(
¥iv
);

795 
¥iv
->
bt_vÆid
 = 
IWLAGN_BT_VALID_ENABLE_FLAGS
;

796 
¥iv
->
cur_rssi_˘x
 = 
NULL
;

798 
	`iwl_£nd_¥io_tbl
(
¥iv
);

801 
ªt
 = 
	`iwl_£nd_bt_ív
(
¥iv
, 
IWL_BT_COEX_ENV_OPEN
,

802 
BT_COEX_PRIO_TBL_EVT_INIT_CALIB2
);

803 i‡(
ªt
)

804  
ªt
;

805 
ªt
 = 
	`iwl_£nd_bt_ív
(
¥iv
, 
IWL_BT_COEX_ENV_CLOSE
,

806 
BT_COEX_PRIO_TBL_EVT_INIT_CALIB2
);

807 i‡(
ªt
)

808  
ªt
;

809 } i‡(
¥iv
->
lib
->
bt_∑øms
) {

813 
	`iwl_£nd_bt_c⁄fig
(
¥iv
);

819 
	`iwœgn_£nd_ˇlib_cfg_π
(
¥iv
, 
IWL_CALIB_CFG_DC_IDX
);

821 
	`õì80211_wake_queues
(
¥iv
->
hw
);

824 
	`iwœgn_£nd_tx_™t_c⁄fig
(
¥iv
,Öriv->
nvm_d©a
->
vÆid_tx_™t
);

826 i‡(
	`iwl_is_assocüãd_˘x
(
˘x
Ë&& !
¥iv
->
wowœn
) {

827 
iwl_rx⁄_cmd
 *
a˘ive_rx⁄
 =

828 (
iwl_rx⁄_cmd
 *)&
˘x
->
a˘ive
;

830 
˘x
->
°agög
.
fûãr_Êags
 |
RXON_FILTER_ASSOC_MSK
;

831 
a˘ive_rx⁄
->
fûãr_Êags
 &~
RXON_FILTER_ASSOC_MSK
;

833 
iwl_rx⁄_c⁄ãxt
 *
tmp
;

835 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
tmp
)

836 
	`iwl_c⁄√˘i⁄_öô_rx_c⁄fig
(
¥iv
, 
tmp
);

838 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

841 i‡(!
¥iv
->
wowœn
) {

843 
	`iwl_ª£t_run_time_ˇlib
(
¥iv
);

846 
	`£t_bô
(
STATUS_READY
, &
¥iv
->
°©us
);

849 
ªt
 = 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

850 i‡(
ªt
)

851  
ªt
;

854 
	`iwl_rf_kûl_˘_c⁄fig
(
¥iv
);

856 
	`IWL_DEBUG_INFO
(
¥iv
, "ALIVEÖrocessing complete.\n");

858  
	`iwl_powî_upd©e_mode
(
¥iv
, 
åue
);

859 
	}
}

870 
	$iwl_˛ór_drivî_°©i⁄s
(
iwl_¥iv
 *
¥iv
)

872 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

874 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

875 
	`mem£t
(
¥iv
->
°©i⁄s
, 0, (priv->stations));

876 
¥iv
->
num_°©i⁄s
 = 0;

878 
¥iv
->
ucode_key_èbÀ
 = 0;

880 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

888 
	`mem£t
(
˘x
->
wï_keys
, 0, (ctx->wep_keys));

889 
˘x
->
key_m≠pög_keys
 = 0;

892 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

893 
	}
}

895 
	$iwl_down
(
iwl_¥iv
 *
¥iv
)

897 
exô_≥ndög
;

899 
	`IWL_DEBUG_INFO
(
¥iv
, 
DRV_NAME
 " is going down\n");

901 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

903 
	`iwl_sˇn_ˇn˚l_timeout
(
¥iv
, 200);

905 
exô_≥ndög
 =

906 
	`ã°_™d_£t_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
);

908 
	`iwl_˛ór_ucode_°©i⁄s
(
¥iv
, 
NULL
);

909 
	`iwl_dóŒoc_bˇ°_°©i⁄s
(
¥iv
);

910 
	`iwl_˛ór_drivî_°©i⁄s
(
¥iv
);

913 
¥iv
->
bt_°©us
 = 0;

914 
¥iv
->
cur_rssi_˘x
 = 
NULL
;

915 
¥iv
->
bt_is_sco
 = 0;

916 i‡(
¥iv
->
lib
->
bt_∑øms
)

917 
¥iv
->
bt_åaffic_lﬂd
 =

918 
¥iv
->
lib
->
bt_∑øms
->
bt_öô_åaffic_lﬂd
;

920 
¥iv
->
bt_åaffic_lﬂd
 = 0;

921 
¥iv
->
bt_fuŒ_c⁄cuºít
 = 
Ál£
;

922 
¥iv
->
bt_ci_com∂ün˚
 = 0;

926 i‡(!
exô_≥ndög
)

927 
	`˛ór_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
);

929 i‡(
¥iv
->
mac80211_ªgi°îed
)

930 
	`õì80211_°›_queues
(
¥iv
->
hw
);

932 
¥iv
->
ucode_lﬂded
 = 
Ál£
;

933 
	`iwl_å™s_°›_devi˚
(
¥iv
->
å™s
);

936 
	`©omic_£t
(&
¥iv
->
num_aux_ö_Êight
, 0);

939 
¥iv
->
°©us
 &
	`ã°_bô
(
STATUS_RF_KILL_HW
, &priv->status) <<

940 
STATUS_RF_KILL_HW
 |

941 
	`ã°_bô
(
STATUS_FW_ERROR
, &
¥iv
->
°©us
) <<

942 
STATUS_FW_ERROR
 |

943 
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
) <<

944 
STATUS_EXIT_PENDING
;

946 
	`dev_k‰ì_skb
(
¥iv
->
bóc⁄_skb
);

947 
¥iv
->
bóc⁄_skb
 = 
NULL
;

948 
	}
}

956 
	$iwl_bg_run_time_ˇlib_w‹k
(
w‹k_°ru˘
 *
w‹k
)

958 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, iwl_priv,

959 
run_time_ˇlib_w‹k
);

961 
	`muãx_lock
(&
¥iv
->
muãx
);

963 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
) ||

964 
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
)) {

965 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

969 i‡(
¥iv
->
°¨t_ˇlib
) {

970 
	`iwl_chaö_noi£_ˇlibøti⁄
(
¥iv
);

971 
	`iwl_£nsôivôy_ˇlibøti⁄
(
¥iv
);

974 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

975 
	}
}

977 
	$iwœgn_¥ï¨e_ª°¨t
(
iwl_¥iv
 *
¥iv
)

979 
boﬁ
 
bt_fuŒ_c⁄cuºít
;

980 
u8
 
bt_ci_com∂ün˚
;

981 
u8
 
bt_lﬂd
;

982 
u8
 
bt_°©us
;

983 
boﬁ
 
bt_is_sco
;

984 
i
;

986 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

988 
¥iv
->
is_›í
 = 0;

999 
bt_fuŒ_c⁄cuºít
 = 
¥iv
->bt_full_concurrent;

1000 
bt_ci_com∂ün˚
 = 
¥iv
->bt_ci_compliance;

1001 
bt_lﬂd
 = 
¥iv
->
bt_åaffic_lﬂd
;

1002 
bt_°©us
 = 
¥iv
->bt_status;

1003 
bt_is_sco
 = 
¥iv
->bt_is_sco;

1005 
	`iwl_down
(
¥iv
);

1007 
¥iv
->
bt_fuŒ_c⁄cuºít
 = bt_full_concurrent;

1008 
¥iv
->
bt_ci_com∂ün˚
 = bt_ci_compliance;

1009 
¥iv
->
bt_åaffic_lﬂd
 = 
bt_lﬂd
;

1010 
¥iv
->
bt_°©us
 = bt_status;

1011 
¥iv
->
bt_is_sco
 = bt_is_sco;

1014 
i
 = 
IWLAGN_FIRST_AMPDU_QUEUE
; i < 
IWL_MAX_HW_QUEUES
; i++)

1015 
¥iv
->
queue_to_mac80211
[
i
] = 
IWL_INVALID_MAC80211_QUEUE
;

1017 
i
 = 0; i < 
IWL_MAX_HW_QUEUES
; i++)

1018 
	`©omic_£t
(&
¥iv
->
queue_°›_cou¡
[
i
], 0);

1020 
	`mem£t
(
¥iv
->
agg_q_Æloc
, 0, (priv->agg_q_alloc));

1021 
	}
}

1023 
	$iwl_bg_ª°¨t
(
w‹k_°ru˘
 *
d©a
)

1025 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
d©a
, iwl_¥iv, 
ª°¨t
);

1027 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

1030 i‡(
	`ã°_™d_˛ór_bô
(
STATUS_FW_ERROR
, &
¥iv
->
°©us
)) {

1031 
	`muãx_lock
(&
¥iv
->
muãx
);

1032 
	`iwœgn_¥ï¨e_ª°¨t
(
¥iv
);

1033 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1034 
	`iwl_ˇn˚l_de„ºed_w‹k
(
¥iv
);

1035 i‡(
¥iv
->
mac80211_ªgi°îed
)

1036 
	`õì80211_ª°¨t_hw
(
¥iv
->
hw
);

1038 
	`IWL_ERR
(
¥iv
,

1041 
	`WARN_ON
(1);

1043 
	}
}

1051 
	$iwl_£tup_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
)

1053 
¥iv
->
w‹kqueue
 = 
	`Æloc_‹dîed_w‹kqueue
(
DRV_NAME
, 0);

1055 
	`INIT_WORK
(&
¥iv
->
ª°¨t
, 
iwl_bg_ª°¨t
);

1056 
	`INIT_WORK
(&
¥iv
->
bóc⁄_upd©e
, 
iwl_bg_bóc⁄_upd©e
);

1057 
	`INIT_WORK
(&
¥iv
->
run_time_ˇlib_w‹k
, 
iwl_bg_run_time_ˇlib_w‹k
);

1058 
	`INIT_WORK
(&
¥iv
->
tx_Êush
, 
iwl_bg_tx_Êush
);

1059 
	`INIT_WORK
(&
¥iv
->
bt_fuŒ_c⁄cuºícy
, 
iwl_bg_bt_fuŒ_c⁄cuºícy
);

1060 
	`INIT_WORK
(&
¥iv
->
bt_ru¡ime_c⁄fig
, 
iwl_bg_bt_ru¡ime_c⁄fig
);

1062 
	`iwl_£tup_sˇn_de„ºed_w‹k
(
¥iv
);

1064 i‡(
¥iv
->
lib
->
bt_∑øms
)

1065 
	`iwœgn_bt_£tup_de„ºed_w‹k
(
¥iv
);

1067 
	`timî_£tup
(&
¥iv
->
°©i°ics_≥riodic
, 
iwl_bg_°©i°ics_≥riodic
, 0);

1069 
	`timî_£tup
(&
¥iv
->
ucode_åa˚
, 
iwl_bg_ucode_åa˚
, 0);

1070 
	}
}

1072 
	$iwl_ˇn˚l_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
)

1074 i‡(
¥iv
->
lib
->
bt_∑øms
)

1075 
	`iwœgn_bt_ˇn˚l_de„ºed_w‹k
(
¥iv
);

1077 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
run_time_ˇlib_w‹k
);

1078 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
bóc⁄_upd©e
);

1080 
	`iwl_ˇn˚l_sˇn_de„ºed_w‹k
(
¥iv
);

1082 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
bt_fuŒ_c⁄cuºícy
);

1083 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
bt_ru¡ime_c⁄fig
);

1085 
	`dñ_timî_sync
(&
¥iv
->
°©i°ics_≥riodic
);

1086 
	`dñ_timî_sync
(&
¥iv
->
ucode_åa˚
);

1087 
	}
}

1089 
	$iwl_öô_drv
(
iwl_¥iv
 *
¥iv
)

1091 
	`•ö_lock_öô
(&
¥iv
->
°a_lock
);

1093 
	`muãx_öô
(&
¥iv
->
muãx
);

1095 
	`INIT_LIST_HEAD
(&
¥iv
->
ˇlib_ªsu…s
);

1097 
¥iv
->
b™d
 = 
NL80211_BAND_2GHZ
;

1099 
¥iv
->
∂˝_dñè_thªshﬁd
 =Öriv->
lib
->plcp_delta_threshold;

1101 
¥iv
->
iw_mode
 = 
NL80211_IFTYPE_STATION
;

1102 
¥iv
->
cuºít_ht_c⁄fig
.
smps
 = 
IEEE80211_SMPS_STATIC
;

1103 
¥iv
->
mis£d_bóc⁄_thªshﬁd
 = 
IWL_MISSED_BEACON_THRESHOLD_DEF
;

1104 
¥iv
->
agg_tids_cou¡
 = 0;

1106 
¥iv
->
rx_°©i°ics_jiffõs
 = 
jiffõs
;

1109 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, &¥iv->
c⁄ãxts
[
IWL_RXON_CTX_BSS
]);

1111 
	`iwl_öô_sˇn_∑øms
(
¥iv
);

1114 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

1115 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

1116 
¥iv
->
kûl_ack_mask
 = 
IWLAGN_BT_KILL_ACK_MASK_DEFAULT
;

1117 
¥iv
->
kûl_˘s_mask
 = 
IWLAGN_BT_KILL_CTS_MASK_DEFAULT
;

1118 
¥iv
->
bt_vÆid
 = 
IWLAGN_BT_ALL_VALID_MSK
;

1119 
¥iv
->
bt_⁄_thªsh
 = 
BT_ON_THRESHOLD_DEF
;

1120 
¥iv
->
bt_duøti⁄
 = 
BT_DURATION_LIMIT_DEF
;

1121 
¥iv
->
dy«mic_‰ag_thªsh
 = 
BT_FRAG_THRESHOLD_DEF
;

1125 
	}
}

1127 
	$iwl_unöô_drv
(
iwl_¥iv
 *
¥iv
)

1129 
	`k‰ì
(
¥iv
->
sˇn_cmd
);

1130 
	`k‰ì
(
¥iv
->
bóc⁄_cmd
);

1131 
	`k‰ì
(
	`rcu_dîe„ªn˚_øw
(
¥iv
->
nﬂ_d©a
));

1132 
	`iwl_ˇlib_‰ì_ªsu…s
(
¥iv
);

1133 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1134 
	`k‰ì
(
¥iv
->
wowœn_§am
);

1136 
	}
}

1138 
	$iwl_£t_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

1140 i‡(
¥iv
->
cfg
->
ht_∑øms
)

1141 
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
 =

1142 
¥iv
->
cfg
->
ht_∑øms
->
u£_πs_f‹_aggªg©i⁄
;

1145 
¥iv
->
lib
->
	`£t_hw_∑øms
(priv);

1146 
	}
}

1151 
	$iwl_›ti⁄_c⁄fig
(
iwl_¥iv
 *
¥iv
)

1153 #ifde‡
CONFIG_IWLWIFI_DEBUG


1154 
	`IWL_INFO
(
¥iv
, "CONFIG_IWLWIFI_DEBUGÉnabled\n");

1156 
	`IWL_INFO
(
¥iv
, "CONFIG_IWLWIFI_DEBUG disabled\n");

1159 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1160 
	`IWL_INFO
(
¥iv
, "CONFIG_IWLWIFI_DEBUGFSÉnabled\n");

1162 
	`IWL_INFO
(
¥iv
, "CONFIG_IWLWIFI_DEBUGFS disabled\n");

1165 #ifde‡
CONFIG_IWLWIFI_DEVICE_TRACING


1166 
	`IWL_INFO
(
¥iv
, "CONFIG_IWLWIFI_DEVICE_TRACINGÉnabled\n");

1168 
	`IWL_INFO
(
¥iv
, "CONFIG_IWLWIFI_DEVICE_TRACING disabled\n");

1170 
	}
}

1172 
	$iwl_ì¥om_öô_hw_∑øms
(
iwl_¥iv
 *
¥iv
)

1174 
iwl_nvm_d©a
 *
d©a
 = 
¥iv
->
nvm_d©a
;

1176 i‡(
d©a
->
sku_ˇp_11n_íabÀ
 &&

1177 !
¥iv
->
cfg
->
ht_∑øms
) {

1178 
	`IWL_ERR
(
¥iv
, "Invalid 11n configuration\n");

1179  -
EINVAL
;

1182 i‡(!
d©a
->
sku_ˇp_11n_íabÀ
 && !d©a->
sku_ˇp_b™d_24ghz_íabÀ
 &&

1183 !
d©a
->
sku_ˇp_b™d_52ghz_íabÀ
) {

1184 
	`IWL_ERR
(
¥iv
, "Invalid device sku\n");

1185  -
EINVAL
;

1188 
	`IWL_DEBUG_INFO
(
¥iv
,

1190 
d©a
->
sku_ˇp_b™d_24ghz_íabÀ
 ? "" : "NOT", "enabled",

1191 
d©a
->
sku_ˇp_b™d_52ghz_íabÀ
 ? "" : "NOT", "enabled",

1192 
d©a
->
sku_ˇp_11n_íabÀ
 ? "" : "NOT", "enabled");

1194 
¥iv
->
hw_∑øms
.
tx_chaös_num
 =

1195 
	`num_of_™t
(
d©a
->
vÆid_tx_™t
);

1196 i‡(
¥iv
->
cfg
->
rx_wôh_siso_divîsôy
)

1197 
¥iv
->
hw_∑øms
.
rx_chaös_num
 = 1;

1199 
¥iv
->
hw_∑øms
.
rx_chaös_num
 =

1200 
	`num_of_™t
(
d©a
->
vÆid_rx_™t
);

1202 
	`IWL_DEBUG_INFO
(
¥iv
, "Valid Txánt: 0x%X, Valid Rxánt: 0x%X\n",

1203 
d©a
->
vÆid_tx_™t
,

1204 
d©a
->
vÆid_rx_™t
);

1207 
	}
}

1209 
	$iwl_nvm_check_vîsi⁄
(
iwl_nvm_d©a
 *
d©a
,

1210 
iwl_å™s
 *
å™s
)

1212 i‡(
d©a
->
nvm_vîsi⁄
 >
å™s
->
cfg
->
nvm_vî
 ||

1213 
d©a
->
ˇlib_vîsi⁄
 >
å™s
->
cfg
->
nvm_ˇlib_vî
) {

1214 
	`IWL_DEBUG_INFO
(
å™s
, "device EEPROM VER=0x%x, CALIB=0x%x\n",

1215 
d©a
->
nvm_vîsi⁄
, d©a->
ˇlib_vîsi⁄
);

1219 
	`IWL_ERR
(
å™s
,

1221 
d©a
->
nvm_vîsi⁄
, 
å™s
->
cfg
->
nvm_vî
,

1222 
d©a
->
ˇlib_vîsi⁄
, 
å™s
->
cfg
->
nvm_ˇlib_vî
);

1223  -
EINVAL
;

1224 
	}
}

1226 
iwl_›_mode
 *
	$iwl_›_mode_dvm_°¨t
(
iwl_å™s
 *
å™s
,

1227 c⁄° 
iwl_cfg
 *
cfg
,

1228 c⁄° 
iwl_fw
 *
fw
,

1229 
díåy
 *
dbgfs_dú
)

1231 
iwl_¥iv
 *
¥iv
;

1232 
õì80211_hw
 *
hw
;

1233 
iwl_›_mode
 *
›_mode
;

1234 
u16
 
num_mac
;

1235 
u32
 
ucode_Êags
;

1236 
iwl_å™s_c⁄fig
 
å™s_cfg
 = {};

1237 c⁄° 
u8
 
no_ª˛aim_cmds
[] = {

1238 
REPLY_RX_PHY_CMD
,

1239 
REPLY_RX_MPDU_CMD
,

1240 
REPLY_COMPRESSED_BA
,

1241 
STATISTICS_NOTIFICATION
,

1242 
REPLY_TX
,

1244 
i
;

1249 
hw
 = 
	`iwl_Æloc_Æl
();

1250 i‡(!
hw
) {

1251 
	`¥_îr
("%s: C™nŸáŒoˇãÇëw‹k devi˚\n", 
å™s
->
«me
);

1252 
out
;

1255 
›_mode
 = 
hw
->
¥iv
;

1256 
›_mode
->
›s
 = &
iwl_dvm_›s
;

1257 
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1258 
¥iv
->
å™s
 =Årans;

1259 
¥iv
->
dev
 = 
å™s
->dev;

1260 
¥iv
->
cfg
 = cfg;

1261 
¥iv
->
fw
 = fw;

1263 
¥iv
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
) {

1264 
IWL_DEVICE_FAMILY_1000
:

1265 
IWL_DEVICE_FAMILY_100
:

1266 
¥iv
->
lib
 = &
iwl_dvm_1000_cfg
;

1268 
IWL_DEVICE_FAMILY_2000
:

1269 
¥iv
->
lib
 = &
iwl_dvm_2000_cfg
;

1271 
IWL_DEVICE_FAMILY_105
:

1272 
¥iv
->
lib
 = &
iwl_dvm_105_cfg
;

1274 
IWL_DEVICE_FAMILY_2030
:

1275 
IWL_DEVICE_FAMILY_135
:

1276 
¥iv
->
lib
 = &
iwl_dvm_2030_cfg
;

1278 
IWL_DEVICE_FAMILY_5000
:

1279 
¥iv
->
lib
 = &
iwl_dvm_5000_cfg
;

1281 
IWL_DEVICE_FAMILY_5150
:

1282 
¥iv
->
lib
 = &
iwl_dvm_5150_cfg
;

1284 
IWL_DEVICE_FAMILY_6000
:

1285 
IWL_DEVICE_FAMILY_6000i
:

1286 
¥iv
->
lib
 = &
iwl_dvm_6000_cfg
;

1288 
IWL_DEVICE_FAMILY_6005
:

1289 
¥iv
->
lib
 = &
iwl_dvm_6005_cfg
;

1291 
IWL_DEVICE_FAMILY_6050
:

1292 
IWL_DEVICE_FAMILY_6150
:

1293 
¥iv
->
lib
 = &
iwl_dvm_6050_cfg
;

1295 
IWL_DEVICE_FAMILY_6030
:

1296 
¥iv
->
lib
 = &
iwl_dvm_6030_cfg
;

1302 i‡(
	`WARN_ON
(!
¥iv
->
lib
))

1303 
out_‰ì_hw
;

1309 
å™s_cfg
.
›_mode
 = op_mode;

1310 
å™s_cfg
.
no_ª˛aim_cmds
 =Ço_reclaim_cmds;

1311 
å™s_cfg
.
n_no_ª˛aim_cmds
 = 
	`ARRAY_SIZE
(
no_ª˛aim_cmds
);

1313 
iwlwifi_mod_∑øms
.
amsdu_size
) {

1314 
IWL_AMSDU_DEF
:

1315 
IWL_AMSDU_4K
:

1316 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_4K
;

1318 
IWL_AMSDU_8K
:

1319 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_8K
;

1321 
IWL_AMSDU_12K
:

1323 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_4K
;

1324 
	`¥_îr
("Unsupportedámsdu_size: %d\n",

1325 
iwlwifi_mod_∑øms
.
amsdu_size
);

1328 
å™s_cfg
.
cmd_q_wdg_timeout
 = 
IWL_WATCHDOG_DISABLED
;

1330 
å™s_cfg
.
comm™d_groups
 = 
iwl_dvm_groups
;

1331 
å™s_cfg
.
comm™d_groups_size
 = 
	`ARRAY_SIZE
(
iwl_dvm_groups
);

1333 
å™s_cfg
.
cmd_fifo
 = 
IWLAGN_CMD_FIFO_NUM
;

1334 
å™s_cfg
.
cb_d©a_offs
 = 
	`off£tof
(
õì80211_tx_öfo
,

1335 
drivî_d©a
[2]);

1337 
	`WARN_ON
((
¥iv
->
å™•‹t_queue_°›
Ë* 
BITS_PER_BYTE
 <

1338 
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
);

1340 
ucode_Êags
 = 
fw
->
ucode_ˇ∑
.
Êags
;

1342 i‡(
ucode_Êags
 & 
IWL_UCODE_TLV_FLAGS_PAN
) {

1343 
¥iv
->
°a_key_max_num
 = 
STA_KEY_MAX_NUM_PAN
;

1344 
å™s_cfg
.
cmd_queue
 = 
IWL_IPAN_CMD_QUEUE_NUM
;

1346 
¥iv
->
°a_key_max_num
 = 
STA_KEY_MAX_NUM
;

1347 
å™s_cfg
.
cmd_queue
 = 
IWL_DEFAULT_CMD_QUEUE_NUM
;

1351 
	`iwl_å™s_c⁄figuª
(
¥iv
->
å™s
, &
å™s_cfg
);

1353 
å™s
->
rx_mpdu_cmd
 = 
REPLY_RX_MPDU_CMD
;

1354 
å™s
->
rx_mpdu_cmd_hdr_size
 = (
iwl_rx_mpdu_ªs_°¨t
);

1355 
å™s
->
comm™d_groups
 = 
å™s_cfg
.command_groups;

1356 
å™s
->
comm™d_groups_size
 = 
å™s_cfg
.command_groups_size;

1360 
	`SET_IEEE80211_DEV
(
¥iv
->
hw
,Öriv->
å™s
->
dev
);

1362 
	`iwl_›ti⁄_c⁄fig
(
¥iv
);

1364 
	`IWL_DEBUG_INFO
(
¥iv
, "*** LOAD DRIVER ***\n");

1367 
¥iv
->
bt_ch_™noun˚
 = 
åue
;

1368 
	`IWL_DEBUG_INFO
(
¥iv
, "BT channel inhibition is %s\n",

1369 (
¥iv
->
bt_ch_™noun˚
) ? "On" : "Off");

1374 
	`•ö_lock_öô
(&
¥iv
->
°©i°ics
.
lock
);

1379 
	`IWL_INFO
(
¥iv
, "Detected %s, REV=0x%X\n",

1380 
¥iv
->
å™s
->
«me
,Öriv->å™s->
hw_ªv
);

1382 i‡(
	`iwl_å™s_°¨t_hw
(
¥iv
->
å™s
))

1383 
out_‰ì_hw
;

1386 i‡(
	`iwl_ªad_ì¥om
(
¥iv
->
å™s
, &¥iv->
ì¥om_blob
,

1387 &
¥iv
->
ì¥om_blob_size
)) {

1388 
	`IWL_ERR
(
¥iv
, "UnableÅo init EEPROM\n");

1389 
out_‰ì_hw
;

1393 
	`iwl_å™s_°›_devi˚
(
¥iv
->
å™s
);

1395 
¥iv
->
nvm_d©a
 = 
	`iwl_∑r£_ì¥om_d©a
’riv->
å™s
,Öriv->
cfg
,

1396 
¥iv
->
ì¥om_blob
,

1397 
¥iv
->
ì¥om_blob_size
);

1398 i‡(!
¥iv
->
nvm_d©a
)

1399 
out_‰ì_ì¥om_blob
;

1401 i‡(
	`iwl_nvm_check_vîsi⁄
(
¥iv
->
nvm_d©a
,Öriv->
å™s
))

1402 
out_‰ì_ì¥om
;

1404 i‡(
	`iwl_ì¥om_öô_hw_∑øms
(
¥iv
))

1405 
out_‰ì_ì¥om
;

1408 
	`mem˝y
(
¥iv
->
addªs£s
[0].
addr
,Öriv->
nvm_d©a
->
hw_addr
, 
ETH_ALEN
);

1409 
	`IWL_DEBUG_INFO
(
¥iv
, "MACáddªss: %pM\n",Öriv->
addªs£s
[0].
addr
);

1410 
¥iv
->
hw
->
wùhy
->
addªs£s
 =Öriv->addresses;

1411 
¥iv
->
hw
->
wùhy
->
n_addªs£s
 = 1;

1412 
num_mac
 = 
¥iv
->
nvm_d©a
->
n_hw_addrs
;

1413 i‡(
num_mac
 > 1) {

1414 
	`mem˝y
(
¥iv
->
addªs£s
[1].
addr
,Öriv->addresses[0].addr,

1415 
ETH_ALEN
);

1416 
¥iv
->
addªs£s
[1].
addr
[5]++;

1417 
¥iv
->
hw
->
wùhy
->
n_addªs£s
++;

1423 
	`iwl_£t_hw_∑øms
(
¥iv
);

1425 i‡(!(
¥iv
->
nvm_d©a
->
sku_ˇp_ù™_íabÀ
)) {

1426 
	`IWL_DEBUG_INFO
(
¥iv
, "Your EEPROM disabled PAN\n");

1427 
ucode_Êags
 &~
IWL_UCODE_TLV_FLAGS_PAN
;

1432 
¥iv
->
°a_key_max_num
 = 
STA_KEY_MAX_NUM
;

1433 
å™s_cfg
.
cmd_queue
 = 
IWL_DEFAULT_CMD_QUEUE_NUM
;

1436 
	`iwl_å™s_c⁄figuª
(
¥iv
->
å™s
, &
å™s_cfg
);

1442 
i
 = 0; i < 
IWL_MAX_HW_QUEUES
; i++) {

1443 
¥iv
->
queue_to_mac80211
[
i
] = 
IWL_INVALID_MAC80211_QUEUE
;

1444 i‡(
i
 < 
IWLAGN_FIRST_AMPDU_QUEUE
 &&

1445 
i
 !
IWL_DEFAULT_CMD_QUEUE_NUM
 &&

1446 
i
 !
IWL_IPAN_CMD_QUEUE_NUM
)

1447 
¥iv
->
queue_to_mac80211
[
i
] = i;

1448 
	`©omic_£t
(&
¥iv
->
queue_°›_cou¡
[
i
], 0);

1451 i‡(
	`iwl_öô_drv
(
¥iv
))

1452 
out_‰ì_ì¥om
;

1459 
	`iwl_£tup_de„ºed_w‹k
(
¥iv
);

1460 
	`iwl_£tup_rx_h™dÀrs
(
¥iv
);

1462 
	`iwl_powî_öôülize
(
¥iv
);

1463 
	`iwl_â_öôülize
(
¥iv
);

1465 
	`¢¥ötf
(
¥iv
->
hw
->
wùhy
->
fw_vîsi⁄
,

1466 (
¥iv
->
hw
->
wùhy
->
fw_vîsi⁄
),

1467 "%.31s", 
fw
->
fw_vîsi⁄
);

1469 
¥iv
->
√w_sˇn_thªshﬁd_behaviour
 =

1470 !!(
ucode_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEWSCAN
);

1472 
¥iv
->
phy_ˇlib_chaö_noi£_ª£t_cmd
 =

1473 
fw
->
ucode_ˇ∑
.
°™d¨d_phy_ˇlibøti⁄_size
;

1474 
¥iv
->
phy_ˇlib_chaö_noi£_gaö_cmd
 =

1475 
fw
->
ucode_ˇ∑
.
°™d¨d_phy_ˇlibøti⁄_size
 + 1;

1478 
	`iwl_öô_c⁄ãxt
(
¥iv
, 
ucode_Êags
);

1485 i‡(
	`iwœgn_mac_£tup_ªgi°î
(
¥iv
, &
fw
->
ucode_ˇ∑
))

1486 
out_de°roy_w‹kqueue
;

1488 
	`iwl_dbgfs_ªgi°î
(
¥iv
, 
dbgfs_dú
);

1490  
›_mode
;

1492 
out_de°roy_w‹kqueue
:

1493 
	`iwl_â_exô
(
¥iv
);

1494 
	`iwl_ˇn˚l_de„ºed_w‹k
(
¥iv
);

1495 
	`de°roy_w‹kqueue
(
¥iv
->
w‹kqueue
);

1496 
¥iv
->
w‹kqueue
 = 
NULL
;

1497 
	`iwl_unöô_drv
(
¥iv
);

1498 
out_‰ì_ì¥om_blob
:

1499 
	`k‰ì
(
¥iv
->
ì¥om_blob
);

1500 
out_‰ì_ì¥om
:

1501 
	`k‰ì
(
¥iv
->
nvm_d©a
);

1502 
out_‰ì_hw
:

1503 
	`õì80211_‰ì_hw
(
¥iv
->
hw
);

1504 
out
:

1505 
›_mode
 = 
NULL
;

1506  
›_mode
;

1507 
	}
}

1509 
	$iwl_›_mode_dvm_°›
(
iwl_›_mode
 *
›_mode
)

1511 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1513 
	`IWL_DEBUG_INFO
(
¥iv
, "*** UNLOAD DRIVER ***\n");

1515 
	`iwœgn_mac_uƒegi°î
(
¥iv
);

1517 
	`iwl_â_exô
(
¥iv
);

1519 
	`k‰ì
(
¥iv
->
ì¥om_blob
);

1520 
	`k‰ì
(
¥iv
->
nvm_d©a
);

1527 
	`de°roy_w‹kqueue
(
¥iv
->
w‹kqueue
);

1528 
¥iv
->
w‹kqueue
 = 
NULL
;

1530 
	`iwl_unöô_drv
(
¥iv
);

1532 
	`dev_k‰ì_skb
(
¥iv
->
bóc⁄_skb
);

1534 
	`iwl_å™s_›_mode_Àave
(
¥iv
->
å™s
);

1535 
	`õì80211_‰ì_hw
(
¥iv
->
hw
);

1536 
	}
}

1538 c⁄° * c⁄° 
	gdesc_lookup_ãxt
[] = {

1569 °ru˘ { *
	m«me
; 
u8
 
	mnum
; } 
	gadv™˚d_lookup
[] = {

1588 c⁄° *
	$desc_lookup
(
u32
 
num
)

1590 
i
;

1591 
max
 = 
	`ARRAY_SIZE
(
desc_lookup_ãxt
);

1593 i‡(
num
 < 
max
)

1594  
desc_lookup_ãxt
[
num
];

1596 
max
 = 
	`ARRAY_SIZE
(
adv™˚d_lookup
) - 1;

1597 
i
 = 0; i < 
max
; i++) {

1598 i‡(
adv™˚d_lookup
[
i
].
num
 ==Çum)

1601  
adv™˚d_lookup
[
i
].
«me
;

1602 
	}
}

1604 
	#ERROR_START_OFFSET
 (1 * (
u32
))

	)

1605 
	#ERROR_ELEM_SIZE
 (7 * (
u32
))

	)

1607 
	$iwl_dump_nic_îr‹_log
(
iwl_¥iv
 *
¥iv
)

1609 
iwl_å™s
 *
å™s
 = 
¥iv
->trans;

1610 
u32
 
ba£
;

1611 
iwl_îr‹_evít_èbÀ
 
èbÀ
;

1613 
ba£
 = 
¥iv
->
devi˚_poöãrs
.
îr‹_evít_èbÀ
;

1614 i‡(
¥iv
->
cur_ucode
 =
IWL_UCODE_INIT
) {

1615 i‡(!
ba£
)

1616 
ba£
 = 
¥iv
->
fw
->
öô_îæog_±r
;

1618 i‡(!
ba£
)

1619 
ba£
 = 
¥iv
->
fw
->
ö°_îæog_±r
;

1622 i‡(!
	`iwœgn_hw_vÆid_πc_d©a_addr
(
ba£
)) {

1623 
	`IWL_ERR
(
¥iv
,

1625 
ba£
,

1626 (
¥iv
->
cur_ucode
 =
IWL_UCODE_INIT
)

1632 
	`iwl_å™s_ªad_mem_byãs
(
å™s
, 
ba£
, &
èbÀ
, (table));

1634 i‡(
ERROR_START_OFFSET
 <
èbÀ
.
vÆid
 * 
ERROR_ELEM_SIZE
) {

1635 
	`IWL_ERR
(
å™s
, "Start IWL Error Log Dump:\n");

1636 
	`IWL_ERR
(
å™s
, "Status: 0x%08lX, count: %d\n",

1637 
¥iv
->
°©us
, 
èbÀ
.
vÆid
);

1640 
	`IWL_ERR
(
¥iv
, "0x%08X | %-28s\n", 
èbÀ
.
îr‹_id
,

1641 
	`desc_lookup
(
èbÀ
.
îr‹_id
));

1642 
	`IWL_ERR
(
¥iv
, "0x%08X | uPc\n", 
èbÀ
.
pc
);

1643 
	`IWL_ERR
(
¥iv
, "0x%08X | bønchlök1\n", 
èbÀ
.
blök1
);

1644 
	`IWL_ERR
(
¥iv
, "0x%08X | bønchlök2\n", 
èbÀ
.
blök2
);

1645 
	`IWL_ERR
(
¥iv
, "0x%08X | i¡îru±lök1\n", 
èbÀ
.
ûök1
);

1646 
	`IWL_ERR
(
¥iv
, "0x%08X | i¡îru±lök2\n", 
èbÀ
.
ûök2
);

1647 
	`IWL_ERR
(
¥iv
, "0x%08X | d©a1\n", 
èbÀ
.
d©a1
);

1648 
	`IWL_ERR
(
¥iv
, "0x%08X | d©a2\n", 
èbÀ
.
d©a2
);

1649 
	`IWL_ERR
(
¥iv
, "0x%08X |Üöe\n", 
èbÀ
.
löe
);

1650 
	`IWL_ERR
(
¥iv
, "0x%08X | bóc⁄Åime\n", 
èbÀ
.
bc⁄_time
);

1651 
	`IWL_ERR
(
¥iv
, "0x%08X |Ås‡low\n", 
èbÀ
.
tsf_low
);

1652 
	`IWL_ERR
(
¥iv
, "0x%08X |Ås‡hi\n", 
èbÀ
.
tsf_hi
);

1653 
	`IWL_ERR
(
¥iv
, "0x%08X |Åimêgp1\n", 
èbÀ
.
gp1
);

1654 
	`IWL_ERR
(
¥iv
, "0x%08X |Åimêgp2\n", 
èbÀ
.
gp2
);

1655 
	`IWL_ERR
(
¥iv
, "0x%08X |Åimêgp3\n", 
èbÀ
.
gp3
);

1656 
	`IWL_ERR
(
¥iv
, "0x%08X | uCodêvîsi⁄\n", 
èbÀ
.
ucode_vî
);

1657 
	`IWL_ERR
(
¥iv
, "0x%08X | hw vîsi⁄\n", 
èbÀ
.
hw_vî
);

1658 
	`IWL_ERR
(
¥iv
, "0x%08X | bﬂrd vîsi⁄\n", 
èbÀ
.
brd_vî
);

1659 
	`IWL_ERR
(
¥iv
, "0x%08X | hcmd\n", 
èbÀ
.
hcmd
);

1660 
	`IWL_ERR
(
¥iv
, "0x%08X | i§0\n", 
èbÀ
.
i§0
);

1661 
	`IWL_ERR
(
¥iv
, "0x%08X | i§1\n", 
èbÀ
.
i§1
);

1662 
	`IWL_ERR
(
¥iv
, "0x%08X | i§2\n", 
èbÀ
.
i§2
);

1663 
	`IWL_ERR
(
¥iv
, "0x%08X | i§3\n", 
èbÀ
.
i§3
);

1664 
	`IWL_ERR
(
¥iv
, "0x%08X | i§4\n", 
èbÀ
.
i§4
);

1665 
	`IWL_ERR
(
¥iv
, "0x%08X | i§_¥ef\n", 
èbÀ
.
i§_¥ef
);

1666 
	`IWL_ERR
(
¥iv
, "0x%08X | waô_evít\n", 
èbÀ
.
waô_evít
);

1667 
	`IWL_ERR
(
¥iv
, "0x%08X |Ü2p_c⁄åﬁ\n", 
èbÀ
.
l2p_c⁄åﬁ
);

1668 
	`IWL_ERR
(
¥iv
, "0x%08X |Ü2p_duøti⁄\n", 
èbÀ
.
l2p_duøti⁄
);

1669 
	`IWL_ERR
(
¥iv
, "0x%08X |Ü2p_mhvÆid\n", 
èbÀ
.
l2p_mhvÆid
);

1670 
	`IWL_ERR
(
¥iv
, "0x%08X |Ü2p_addr_m©ch\n", 
èbÀ
.
l2p_addr_m©ch
);

1671 
	`IWL_ERR
(
¥iv
, "0x%08X |Ümpm_pmg_£l\n", 
èbÀ
.
lmpm_pmg_£l
);

1672 
	`IWL_ERR
(
¥iv
, "0x%08X |Åime°amp\n", 
èbÀ
.
u_time°amp
);

1673 
	`IWL_ERR
(
¥iv
, "0x%08X | flow_h™dÀr\n", 
èbÀ
.
Êow_h™dÀr
);

1674 
	}
}

1676 
	#EVENT_START_OFFSET
 (4 * (
u32
))

	)

1681 
	$iwl_¥öt_evít_log
(
iwl_¥iv
 *
¥iv
, 
u32
 
°¨t_idx
,

1682 
u32
 
num_evíts
, u32 
mode
,

1683 
pos
, **
buf
, 
size_t
 
bufsz
)

1685 
u32
 
i
;

1686 
u32
 
ba£
;

1687 
u32
 
evít_size
;

1688 
u32
 
±r
;

1689 
u32
 
ev
, 
time
, 
d©a
;

1691 
iwl_å™s
 *
å™s
 = 
¥iv
->trans;

1693 i‡(
num_evíts
 == 0)

1694  
pos
;

1696 
ba£
 = 
¥iv
->
devi˚_poöãrs
.
log_evít_èbÀ
;

1697 i‡(
¥iv
->
cur_ucode
 =
IWL_UCODE_INIT
) {

1698 i‡(!
ba£
)

1699 
ba£
 = 
¥iv
->
fw
->
öô_evéog_±r
;

1701 i‡(!
ba£
)

1702 
ba£
 = 
¥iv
->
fw
->
ö°_evéog_±r
;

1705 i‡(
mode
 == 0)

1706 
evít_size
 = 2 * (
u32
);

1708 
evít_size
 = 3 * (
u32
);

1710 
±r
 = 
ba£
 + 
EVENT_START_OFFSET
 + (
°¨t_idx
 * 
evít_size
);

1713 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

1714  
pos
;

1717 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_MEM_RADDR
, 
±r
);

1721 
i
 = 0; i < 
num_evíts
; i++) {

1722 
ev
 = 
	`iwl_ªad32
(
å™s
, 
HBUS_TARG_MEM_RDAT
);

1723 
time
 = 
	`iwl_ªad32
(
å™s
, 
HBUS_TARG_MEM_RDAT
);

1724 i‡(
mode
 == 0) {

1726 i‡(
bufsz
) {

1727 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

1729 
time
, 
ev
);

1731 
	`åa˚_iwlwifi_dev_ucode_evít
(
å™s
->
dev
, 0,

1732 
time
, 
ev
);

1733 
	`IWL_ERR
(
¥iv
, "EVT_LOG:0x%08x:%04u\n",

1734 
time
, 
ev
);

1737 
d©a
 = 
	`iwl_ªad32
(
å™s
, 
HBUS_TARG_MEM_RDAT
);

1738 i‡(
bufsz
) {

1739 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

1741 
time
, 
d©a
, 
ev
);

1743 
	`IWL_ERR
(
¥iv
, "EVT_LOGT:%010u:0x%08x:%04u\n",

1744 
time
, 
d©a
, 
ev
);

1745 
	`åa˚_iwlwifi_dev_ucode_evít
(
å™s
->
dev
, 
time
,

1746 
d©a
, 
ev
);

1752 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

1753  
pos
;

1754 
	}
}

1759 
	$iwl_¥öt_œ°_evít_logs
(
iwl_¥iv
 *
¥iv
, 
u32
 
ˇ∑côy
,

1760 
u32
 
num_wøps
, u32 
√xt_íåy
,

1761 
u32
 
size
, u32 
mode
,

1762 
pos
, **
buf
, 
size_t
 
bufsz
)

1768 i‡(
num_wøps
) {

1769 i‡(
√xt_íåy
 < 
size
) {

1770 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
,

1771 
ˇ∑côy
 - (
size
 - 
√xt_íåy
),

1772 
size
 - 
√xt_íåy
, 
mode
,

1773 
pos
, 
buf
, 
bufsz
);

1774 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
, 0,

1775 
√xt_íåy
, 
mode
,

1776 
pos
, 
buf
, 
bufsz
);

1778 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
, 
√xt_íåy
 - 
size
,

1779 
size
, 
mode
, 
pos
, 
buf
, 
bufsz
);

1781 i‡(
√xt_íåy
 < 
size
) {

1782 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
, 0, 
√xt_íåy
,

1783 
mode
, 
pos
, 
buf
, 
bufsz
);

1785 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
, 
√xt_íåy
 - 
size
,

1786 
size
, 
mode
, 
pos
, 
buf
, 
bufsz
);

1789  
pos
;

1790 
	}
}

1792 
	#DEFAULT_DUMP_EVENT_LOG_ENTRIES
 (20)

	)

1794 
	$iwl_dump_nic_evít_log
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
fuŒ_log
,

1795 **
buf
)

1797 
u32
 
ba£
;

1798 
u32
 
ˇ∑côy
;

1799 
u32
 
mode
;

1800 
u32
 
num_wøps
;

1801 
u32
 
√xt_íåy
;

1802 
u32
 
size
;

1803 
u32
 
logsize
;

1804 
pos
 = 0;

1805 
size_t
 
bufsz
 = 0;

1806 
iwl_å™s
 *
å™s
 = 
¥iv
->trans;

1808 
ba£
 = 
¥iv
->
devi˚_poöãrs
.
log_evít_èbÀ
;

1809 i‡(
¥iv
->
cur_ucode
 =
IWL_UCODE_INIT
) {

1810 
logsize
 = 
¥iv
->
fw
->
öô_evéog_size
;

1811 i‡(!
ba£
)

1812 
ba£
 = 
¥iv
->
fw
->
öô_evéog_±r
;

1814 
logsize
 = 
¥iv
->
fw
->
ö°_evéog_size
;

1815 i‡(!
ba£
)

1816 
ba£
 = 
¥iv
->
fw
->
ö°_evéog_±r
;

1819 i‡(!
	`iwœgn_hw_vÆid_πc_d©a_addr
(
ba£
)) {

1820 
	`IWL_ERR
(
¥iv
,

1822 
ba£
,

1823 (
¥iv
->
cur_ucode
 =
IWL_UCODE_INIT
)

1825  -
EINVAL
;

1829 
ˇ∑côy
 = 
	`iwl_å™s_ªad_mem32
(
å™s
, 
ba£
);

1830 
mode
 = 
	`iwl_å™s_ªad_mem32
(
å™s
, 
ba£
 + (1 * (
u32
)));

1831 
num_wøps
 = 
	`iwl_å™s_ªad_mem32
(
å™s
, 
ba£
 + (2 * (
u32
)));

1832 
√xt_íåy
 = 
	`iwl_å™s_ªad_mem32
(
å™s
, 
ba£
 + (3 * (
u32
)));

1834 i‡(
ˇ∑côy
 > 
logsize
) {

1835 
	`IWL_ERR
(
¥iv
, "Log capacity %d is bogus,ÜimitÅo %d "

1836 "íåõs\n", 
ˇ∑côy
, 
logsize
);

1837 
ˇ∑côy
 = 
logsize
;

1840 i‡(
√xt_íåy
 > 
logsize
) {

1841 
	`IWL_ERR
(
¥iv
, "Log write index %d is bogus,ÜimitÅo %d\n",

1842 
√xt_íåy
, 
logsize
);

1843 
√xt_íåy
 = 
logsize
;

1846 
size
 = 
num_wøps
 ? 
ˇ∑côy
 : 
√xt_íåy
;

1849 i‡(
size
 == 0) {

1850 
	`IWL_ERR
(
å™s
, "Start IWL Event Log Dump:Çothing inÜog\n");

1851  
pos
;

1854 i‡(!(
	`iwl_have_debug_Àvñ
(
IWL_DL_FW
)Ë&& !
fuŒ_log
)

1855 
size
 = (sizê> 
DEFAULT_DUMP_EVENT_LOG_ENTRIES
)

1856 ? 
DEFAULT_DUMP_EVENT_LOG_ENTRIES
 : 
size
;

1857 
	`IWL_ERR
(
¥iv
, "Start IWL Event Log Dump: displayÜast %uÉntries\n",

1858 
size
);

1860 #ifde‡
CONFIG_IWLWIFI_DEBUG


1861 i‡(
buf
) {

1862 i‡(
fuŒ_log
)

1863 
bufsz
 = 
ˇ∑côy
 * 48;

1865 
bufsz
 = 
size
 * 48;

1866 *
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

1867 i‡(!*
buf
)

1868  -
ENOMEM
;

1870 i‡(
	`iwl_have_debug_Àvñ
(
IWL_DL_FW
Ë|| 
fuŒ_log
) {

1876 i‡(
num_wøps
)

1877 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
, 
√xt_íåy
,

1878 
ˇ∑côy
 - 
√xt_íåy
, 
mode
,

1879 
pos
, 
buf
, 
bufsz
);

1881 
pos
 = 
	`iwl_¥öt_evít_log
(
¥iv
, 0,

1882 
√xt_íåy
, 
mode
, 
pos
, 
buf
, 
bufsz
);

1884 
pos
 = 
	`iwl_¥öt_œ°_evít_logs
(
¥iv
, 
ˇ∑côy
, 
num_wøps
,

1885 
√xt_íåy
, 
size
, 
mode
,

1886 
pos
, 
buf
, 
bufsz
);

1888 
pos
 = 
	`iwl_¥öt_œ°_evít_logs
(
¥iv
, 
ˇ∑côy
, 
num_wøps
,

1889 
√xt_íåy
, 
size
, 
mode
,

1890 
pos
, 
buf
, 
bufsz
);

1892  
pos
;

1893 
	}
}

1895 
	$iwœgn_fw_îr‹
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
⁄dem™d
)

1897 
ªlﬂd_m£c
;

1898 
ªlﬂd_jiffõs
;

1900 i‡(
	`iwl_have_debug_Àvñ
(
IWL_DL_FW
))

1901 
	`iwl_¥öt_rx_c⁄fig_cmd
(
¥iv
, 
IWL_RXON_CTX_BSS
);

1904 
¥iv
->
ucode_lﬂded
 = 
Ál£
;

1907 
	`£t_bô
(
STATUS_FW_ERROR
, &
¥iv
->
°©us
);

1909 
	`iwl_ab‹t_nŸifiˇti⁄_waôs
(&
¥iv
->
nŸif_waô
);

1913 
	`˛ór_bô
(
STATUS_READY
, &
¥iv
->
°©us
);

1915 i‡(!
⁄dem™d
) {

1922 
ªlﬂd_jiffõs
 = 
jiffõs
;

1923 
ªlﬂd_m£c
 = 
	`jiffõs_to_m£cs
((Ë
ªlﬂd_jiffõs
 -

1924 (Ë
¥iv
->
ªlﬂd_jiffõs
);

1925 
¥iv
->
ªlﬂd_jiffõs
 =Ñeload_jiffies;

1926 i‡(
ªlﬂd_m£c
 <
IWL_MIN_RELOAD_DURATION
) {

1927 
¥iv
->
ªlﬂd_cou¡
++;

1928 i‡(
¥iv
->
ªlﬂd_cou¡
 >
IWL_MAX_CONTINUE_RELOAD_CNT
) {

1929 
	`IWL_ERR
(
¥iv
, "BUG_ON, StopÑestarting\n");

1933 
¥iv
->
ªlﬂd_cou¡
 = 0;

1936 i‡(!
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
)) {

1937 i‡(
iwlwifi_mod_∑øms
.
fw_ª°¨t
) {

1938 
	`IWL_DEBUG_FW
(
¥iv
,

1940 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
ª°¨t
);

1942 
	`IWL_DEBUG_FW
(
¥iv
,

1945 
	}
}

1947 
	$iwl_nic_îr‹
(
iwl_›_mode
 *
›_mode
, 
boﬁ
 
sync
)

1949 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1951 
	`IWL_ERR
(
¥iv
, "Loaded firmware version: %s\n",

1952 
¥iv
->
fw
->
fw_vîsi⁄
);

1954 
	`iwl_dump_nic_îr‹_log
(
¥iv
);

1955 
	`iwl_dump_nic_evít_log
(
¥iv
, 
Ál£
, 
NULL
);

1957 
	`iwœgn_fw_îr‹
(
¥iv
, 
Ál£
);

1958 
	}
}

1960 
	$iwl_cmd_queue_fuŒ
(
iwl_›_mode
 *
›_mode
)

1962 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1964 i‡(!
	`iwl_check_f‹_˘_kûl
(
¥iv
)) {

1965 
	`IWL_ERR
(
¥iv
, "Restartingádapter queue is full\n");

1966 
	`iwœgn_fw_îr‹
(
¥iv
, 
Ál£
);

1968 
	}
}

1970 
	#EEPROM_RF_CONFIG_TYPE_MAX
 0x3

	)

1972 
	$iwl_nic_c⁄fig
(
iwl_›_mode
 *
›_mode
)

1974 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1977 
	`iwl_å™s_£t_bôs_mask
(
¥iv
->
å™s
, 
CSR_HW_IF_CONFIG_REG
,

1978 
CSR_HW_IF_CONFIG_REG_MSK_MAC_STEP_DASH
,

1979 
	`CSR_HW_REV_STEP_DASH
(
¥iv
->
å™s
->
hw_ªv
));

1982 i‡(
¥iv
->
nvm_d©a
->
ødio_cfg_ty≥
 <
EEPROM_RF_CONFIG_TYPE_MAX
) {

1983 
u32
 
ªg_vÆ
 =

1984 
¥iv
->
nvm_d©a
->
ødio_cfg_ty≥
 <<

1985 
CSR_HW_IF_CONFIG_REG_POS_PHY_TYPE
 |

1986 
¥iv
->
nvm_d©a
->
ødio_cfg_°ï
 <<

1987 
CSR_HW_IF_CONFIG_REG_POS_PHY_STEP
 |

1988 
¥iv
->
nvm_d©a
->
ødio_cfg_dash
 <<

1989 
CSR_HW_IF_CONFIG_REG_POS_PHY_DASH
;

1991 
	`iwl_å™s_£t_bôs_mask
(
¥iv
->
å™s
, 
CSR_HW_IF_CONFIG_REG
,

1992 
CSR_HW_IF_CONFIG_REG_MSK_PHY_TYPE
 |

1993 
CSR_HW_IF_CONFIG_REG_MSK_PHY_STEP
 |

1994 
CSR_HW_IF_CONFIG_REG_MSK_PHY_DASH
,

1995 
ªg_vÆ
);

1997 
	`IWL_INFO
(
¥iv
, "RadioÅype=0x%x-0x%x-0x%x\n",

1998 
¥iv
->
nvm_d©a
->
ødio_cfg_ty≥
,

1999 
¥iv
->
nvm_d©a
->
ødio_cfg_°ï
,

2000 
¥iv
->
nvm_d©a
->
ødio_cfg_dash
);

2002 
	`WARN_ON
(1);

2006 
	`iwl_£t_bô
(
¥iv
->
å™s
, 
CSR_HW_IF_CONFIG_REG
,

2007 
CSR_HW_IF_CONFIG_REG_BIT_RADIO_SI
 |

2008 
CSR_HW_IF_CONFIG_REG_BIT_MAC_SI
);

2014 
	`iwl_£t_bôs_mask_¥ph
(
¥iv
->
å™s
, 
APMG_PS_CTRL_REG
,

2015 
APMG_PS_CTRL_EARLY_PWR_OFF_RESET_DIS
,

2016 ~
APMG_PS_CTRL_EARLY_PWR_OFF_RESET_DIS
);

2018 i‡(
¥iv
->
lib
->
nic_c⁄fig
)

2019 
¥iv
->
lib
->
	`nic_c⁄fig
(priv);

2020 
	}
}

2022 
	$iwl_wimax_a˘ive
(
iwl_›_mode
 *
›_mode
)

2024 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2026 
	`˛ór_bô
(
STATUS_READY
, &
¥iv
->
°©us
);

2027 
	`IWL_ERR
(
¥iv
, "RF is used by WiMAX\n");

2028 
	}
}

2030 
	$iwl_°›_sw_queue
(
iwl_›_mode
 *
›_mode
, 
queue
)

2032 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2033 
mq
 = 
¥iv
->
queue_to_mac80211
[
queue
];

2035 i‡(
	`WARN_ON_ONCE
(
mq
 =
IWL_INVALID_MAC80211_QUEUE
))

2038 i‡(
	`©omic_öc_ªtu∫
(&
¥iv
->
queue_°›_cou¡
[
mq
]) > 1) {

2039 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

2041 
queue
, 
mq
);

2045 
	`£t_bô
(
mq
, &
¥iv
->
å™•‹t_queue_°›
);

2046 
	`õì80211_°›_queue
(
¥iv
->
hw
, 
mq
);

2047 
	}
}

2049 
	$iwl_wake_sw_queue
(
iwl_›_mode
 *
›_mode
, 
queue
)

2051 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2052 
mq
 = 
¥iv
->
queue_to_mac80211
[
queue
];

2054 i‡(
	`WARN_ON_ONCE
(
mq
 =
IWL_INVALID_MAC80211_QUEUE
))

2057 i‡(
	`©omic_dec_ªtu∫
(&
¥iv
->
queue_°›_cou¡
[
mq
]) > 0) {

2058 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

2060 
queue
, 
mq
);

2064 
	`˛ór_bô
(
mq
, &
¥iv
->
å™•‹t_queue_°›
);

2066 i‡(!
¥iv
->
∑ssive_no_rx
)

2067 
	`õì80211_wake_queue
(
¥iv
->
hw
, 
mq
);

2068 
	}
}

2070 
	$iwœgn_li·_∑ssive_no_rx
(
iwl_¥iv
 *
¥iv
)

2072 
mq
;

2074 i‡(!
¥iv
->
∑ssive_no_rx
)

2077 
mq
 = 0; mq < 
IWLAGN_FIRST_AMPDU_QUEUE
; mq++) {

2078 i‡(!
	`ã°_bô
(
mq
, &
¥iv
->
å™•‹t_queue_°›
)) {

2079 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "Wakêqueuê%d\n", 
mq
);

2080 
	`õì80211_wake_queue
(
¥iv
->
hw
, 
mq
);

2082 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "D⁄'àwakêqueuê%d\n", 
mq
);

2086 
¥iv
->
∑ssive_no_rx
 = 
Ál£
;

2087 
	}
}

2089 
	$iwl_‰ì_skb
(
iwl_›_mode
 *
›_mode
, 
sk_buff
 *
skb
)

2091 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2092 
õì80211_tx_öfo
 *
öfo
;

2094 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2095 
	`iwl_å™s_‰ì_tx_cmd
(
¥iv
->
å™s
, 
öfo
->
drivî_d©a
[1]);

2096 
	`õì80211_‰ì_txskb
(
¥iv
->
hw
, 
skb
);

2097 
	}
}

2099 
boﬁ
 
	$iwl_£t_hw_rfkûl_°©e
(
iwl_›_mode
 *
›_mode
, 
boﬁ
 
°©e
)

2101 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2103 i‡(
°©e
)

2104 
	`£t_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
);

2106 
	`˛ór_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
);

2108 
	`wùhy_rfkûl_£t_hw_°©e
(
¥iv
->
hw
->
wùhy
, 
°©e
);

2110  
Ál£
;

2111 
	}
}

2113 c⁄° 
iwl_›_mode_›s
 
	giwl_dvm_›s
 = {

2114 .
°¨t
 = 
iwl_›_mode_dvm_°¨t
,

2115 .
	g°›
 = 
iwl_›_mode_dvm_°›
,

2116 .
	grx
 = 
iwl_rx_di•©ch
,

2117 .
	gqueue_fuŒ
 = 
iwl_°›_sw_queue
,

2118 .
	gqueue_nŸ_fuŒ
 = 
iwl_wake_sw_queue
,

2119 .
	ghw_rf_kûl
 = 
iwl_£t_hw_rfkûl_°©e
,

2120 .
	g‰ì_skb
 = 
iwl_‰ì_skb
,

2121 .
	gnic_îr‹
 = 
iwl_nic_îr‹
,

2122 .
	gcmd_queue_fuŒ
 = 
iwl_cmd_queue_fuŒ
,

2123 .
	gnic_c⁄fig
 = 
iwl_nic_c⁄fig
,

2124 .
	gwimax_a˘ive
 = 
iwl_wimax_a˘ive
,

2132 
__öô
 
	$iwl_öô
()

2135 
ªt
;

2137 
ªt
 = 
	`iwœgn_øã_c⁄åﬁ_ªgi°î
();

2138 i‡(
ªt
) {

2139 
	`¥_îr
("U«bÀÅÿªgi°îÑ©êc⁄åﬁálg‹ôhm: %d\n", 
ªt
);

2140  
ªt
;

2143 
ªt
 = 
	`iwl_›mode_ªgi°î
("iwldvm", &
iwl_dvm_›s
);

2144 i‡(
ªt
) {

2145 
	`¥_îr
("U«bÀÅÿªgi°î op_mode: %d\n", 
ªt
);

2146 
	`iwœgn_øã_c⁄åﬁ_uƒegi°î
();

2149  
ªt
;

2150 
	}
}

2151 
moduÀ_öô
(
iwl_öô
);

2153 
__exô
 
	$iwl_exô
()

2155 
	`iwl_›mode_dîegi°î
("iwldvm");

2156 
	`iwœgn_øã_c⁄åﬁ_uƒegi°î
();

2157 
	}
}

2158 
moduÀ_exô
(
iwl_exô
);

	@dvm/power.c

12 
	~<löux/kî√l.h
>

13 
	~<löux/moduÀ.h
>

14 
	~<löux/¶ab.h
>

15 
	~<√t/mac80211.h
>

16 
	~"iwl-io.h
"

17 
	~"iwl-debug.h
"

18 
	~"iwl-å™s.h
"

19 
	~"iwl-mod∑øms.h
"

20 
	~"dev.h
"

21 
	~"agn.h
"

22 
	~"comm™ds.h
"

23 
	~"powî.h
"

25 
boﬁ
 
	gf‹˚_ˇm
 = 
åue
;

26 
moduÀ_∑øm
(
f‹˚_ˇm
, 
boﬁ
, 0644);

27 
MODULE_PARM_DESC
(
f‹˚_ˇm
, "force continuouslyáware mode (noÖower savingátáll)");

42 
	siwl_powî_vec_íåy
 {

43 
iwl_powîèbÀ_cmd
 
	mcmd
;

44 
u8
 
	mno_dtim
;

47 
	#IWL_DTIM_RANGE_0_MAX
 2

	)

48 
	#IWL_DTIM_RANGE_1_MAX
 10

	)

50 
	#NOSLP
 
	`˝u_to_À16
(0), 0, 0

	)

51 
	#SLP
 
IWL_POWER_DRIVER_ALLOW_SLEEP_MSK
, 0, 0

	)

52 
	#ASLP
 (
IWL_POWER_POWER_SAVE_ENA_MSK
 | \

53 
IWL_POWER_POWER_MANAGEMENT_ENA_MSK
 | \

54 
IWL_POWER_ADVANCE_PM_ENA_MSK
)

	)

55 
	#ASLP_TOUT
(
T
Ë
	`˝u_to_À32
(T)

	)

56 
	#TU_TO_USEC
 1024

	)

57 
	#SLP_TOUT
(
T
Ë
	`˝u_to_À32
((TË* 
TU_TO_USEC
)

	)

58 
	#SLP_VEC
(
X0
, 
X1
, 
X2
, 
X3
, 
X4
Ë{
	`˝u_to_À32
(X0), \

59 
	`˝u_to_À32
(
X1
), \

60 
	`˝u_to_À32
(
X2
), \

61 
	`˝u_to_À32
(
X3
), \

62 
	`˝u_to_À32
(
X4
)}

	)

66 c⁄° 
iwl_powî_vec_íåy
 
	gønge_0
[
IWL_POWER_NUM
] = {

67 {{
SLP
, 
SLP_TOUT
(200), SLP_TOUT(500), 
SLP_VEC
(1, 1, 2, 2, 0xFF)}, 0},

68 {{
SLP
, 
SLP_TOUT
(200), SLP_TOUT(300), 
SLP_VEC
(1, 2, 2, 2, 0xFF)}, 0},

69 {{
SLP
, 
SLP_TOUT
(50), SLP_TOUT(100), 
SLP_VEC
(2, 2, 2, 2, 0xFF)}, 0},

70 {{
SLP
, 
SLP_TOUT
(50), SLP_TOUT(25), 
SLP_VEC
(2, 2, 4, 4, 0xFF)}, 1},

71 {{
SLP
, 
SLP_TOUT
(25), SLP_TOUT(25), 
SLP_VEC
(2, 2, 4, 6, 0xFF)}, 2}

77 c⁄° 
iwl_powî_vec_íåy
 
	gønge_1
[
IWL_POWER_NUM
] = {

78 {{
SLP
, 
SLP_TOUT
(200), SLP_TOUT(500), 
SLP_VEC
(1, 2, 3, 4, 4)}, 0},

79 {{
SLP
, 
SLP_TOUT
(200), SLP_TOUT(300), 
SLP_VEC
(1, 2, 3, 4, 7)}, 0},

80 {{
SLP
, 
SLP_TOUT
(50), SLP_TOUT(100), 
SLP_VEC
(2, 4, 6, 7, 9)}, 0},

81 {{
SLP
, 
SLP_TOUT
(50), SLP_TOUT(25), 
SLP_VEC
(2, 4, 6, 9, 10)}, 1},

82 {{
SLP
, 
SLP_TOUT
(25), SLP_TOUT(25), 
SLP_VEC
(2, 4, 6, 10, 10)}, 2}

87 c⁄° 
iwl_powî_vec_íåy
 
	gønge_2
[
IWL_POWER_NUM
] = {

88 {{
SLP
, 
SLP_TOUT
(200), SLP_TOUT(500), 
SLP_VEC
(1, 2, 3, 4, 0xFF)}, 0},

89 {{
SLP
, 
SLP_TOUT
(200), SLP_TOUT(300), 
SLP_VEC
(2, 4, 6, 7, 0xFF)}, 0},

90 {{
SLP
, 
SLP_TOUT
(50), SLP_TOUT(100), 
SLP_VEC
(2, 7, 9, 9, 0xFF)}, 0},

91 {{
SLP
, 
SLP_TOUT
(50), SLP_TOUT(25), 
SLP_VEC
(2, 7, 9, 9, 0xFF)}, 0},

92 {{
SLP
, 
SLP_TOUT
(25), SLP_TOUT(25), 
SLP_VEC
(4, 7, 10, 10, 0xFF)}, 0}

97 c⁄° 
iwl_powî_vec_íåy
 
	g≠m_ønge_0
[
IWL_POWER_NUM
] = {

98 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

99 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

100 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

101 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

102 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

103 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

104 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

105 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

106 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

107 
SLP_VEC
(1, 2, 6, 8, 0xFF), 
ASLP_TOUT
(2)}, 2}

113 c⁄° 
iwl_powî_vec_íåy
 
	g≠m_ønge_1
[
IWL_POWER_NUM
] = {

114 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

115 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

116 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

117 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

118 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

119 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

120 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

121 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

122 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

123 
SLP_VEC
(1, 2, 6, 8, 0xFF), 0}, 2}

128 c⁄° 
iwl_powî_vec_íåy
 
	g≠m_ønge_2
[
IWL_POWER_NUM
] = {

129 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

130 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

131 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

132 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

133 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

134 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

135 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

136 
SLP_VEC
(1, 2, 4, 6, 0xFF), 0}, 0},

137 {{
ASLP
, 0, 0, 
ASLP_TOUT
(50), ASLP_TOUT(50),

138 
SLP_VEC
(1, 2, 6, 8, 0xFF), 
ASLP_TOUT
(2)}, 2}

141 
	$iwl_°©ic_¶ìp_cmd
(
iwl_¥iv
 *
¥iv
,

142 
iwl_powîèbÀ_cmd
 *
cmd
,

143 
iwl_powî_Àvñ
 
lvl
, 
≥riod
)

145 c⁄° 
iwl_powî_vec_íåy
 *
èbÀ
;

146 
max_¶ìp
[
IWL_POWER_VEC_SIZE
] = { 0 };

147 
i
;

148 
u8
 
skù
;

149 
u32
 
¶p_ôrvl
;

151 i‡(
¥iv
->
lib
->
adv_pm
) {

152 
èbÀ
 = 
≠m_ønge_2
;

153 i‡(
≥riod
 <
IWL_DTIM_RANGE_1_MAX
)

154 
èbÀ
 = 
≠m_ønge_1
;

155 i‡(
≥riod
 <
IWL_DTIM_RANGE_0_MAX
)

156 
èbÀ
 = 
≠m_ønge_0
;

158 
èbÀ
 = 
ønge_2
;

159 i‡(
≥riod
 <
IWL_DTIM_RANGE_1_MAX
)

160 
èbÀ
 = 
ønge_1
;

161 i‡(
≥riod
 <
IWL_DTIM_RANGE_0_MAX
)

162 
èbÀ
 = 
ønge_0
;

165 i‡(
	`WARN_ON
(
lvl
 < 0 ||Üv»>
IWL_POWER_NUM
))

166 
	`mem£t
(
cmd
, 0, (*cmd));

168 *
cmd
 = 
èbÀ
[
lvl
].cmd;

170 i‡(
≥riod
 == 0) {

171 
skù
 = 0;

172 
≥riod
 = 1;

173 
i
 = 0; i < 
IWL_POWER_VEC_SIZE
; i++)

174 
max_¶ìp
[
i
] = 1;

177 
skù
 = 
èbÀ
[
lvl
].
no_dtim
;

178 
i
 = 0; i < 
IWL_POWER_VEC_SIZE
; i++)

179 
max_¶ìp
[
i
] = 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[i]);

180 
max_¶ìp
[
IWL_POWER_VEC_SIZE
 - 1] = 
skù
 + 1;

183 
¶p_ôrvl
 = 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
 - 1]);

185 i‡(
¶p_ôrvl
 == 0xFF)

186 
cmd
->
¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
 - 1] =

187 
	`˝u_to_À32
(
≥riod
 * (
skù
 + 1));

189 
¶p_ôrvl
 = 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
 - 1]);

190 i‡(
¶p_ôrvl
 > 
≥riod
)

191 
cmd
->
¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
 - 1] =

192 
	`˝u_to_À32
((
¶p_ôrvl
 / 
≥riod
) *Öeriod);

194 i‡(
skù
)

195 
cmd
->
Êags
 |
IWL_POWER_SLEEP_OVER_DTIM_MSK
;

197 
cmd
->
Êags
 &~
IWL_POWER_SLEEP_OVER_DTIM_MSK
;

199 i‡(
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
shadow_ªg_íabÀ
)

200 
cmd
->
Êags
 |
IWL_POWER_SHADOW_REG_ENA
;

202 
cmd
->
Êags
 &~
IWL_POWER_SHADOW_REG_ENA
;

204 i‡(
	`iwl_adv™˚d_bt_c€xi°
(
¥iv
)) {

205 i‡(!
¥iv
->
lib
->
bt_∑øms
->
bt_sco_dißbÀ
)

206 
cmd
->
Êags
 |
IWL_POWER_BT_SCO_ENA
;

208 
cmd
->
Êags
 &~
IWL_POWER_BT_SCO_ENA
;

212 
¶p_ôrvl
 = 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
 - 1]);

213 i‡(
¶p_ôrvl
 > 
IWL_CONN_MAX_LISTEN_INTERVAL
)

214 
cmd
->
¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
 - 1] =

215 
	`˝u_to_À32
(
IWL_CONN_MAX_LISTEN_INTERVAL
);

218 
i
 = 
IWL_POWER_VEC_SIZE
 - 1; i >= 0 ; i--) {

219 i‡(
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
i
]) >

220 (
max_¶ìp
[
i
] * 
≥riod
))

221 
cmd
->
¶ìp_öãrvÆ
[
i
] =

222 
	`˝u_to_À32
(
max_¶ìp
[
i
] * 
≥riod
);

223 i‡(
i
 !(
IWL_POWER_VEC_SIZE
 - 1)) {

224 i‡(
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
i
]) >

225 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[
i
+1]))

226 
cmd
->
¶ìp_öãrvÆ
[
i
] =

227 
cmd
->
¶ìp_öãrvÆ
[
i
+1];

231 i‡(
¥iv
->
powî_d©a
.
bus_pm
)

232 
cmd
->
Êags
 |
IWL_POWER_PCI_PM_MSK
;

234 
cmd
->
Êags
 &~
IWL_POWER_PCI_PM_MSK
;

236 
	`IWL_DEBUG_POWER
(
¥iv
, "numSkipDtim = %u, dtimPeriod = %d\n",

237 
skù
, 
≥riod
);

240 
	`IWL_DEBUG_POWER
(
¥iv
, "SÀï comm™d f‹ index %d\n", 
lvl
 + 1);

241 
	}
}

243 
	$iwl_powî_¶ìp_ˇm_cmd
(
iwl_¥iv
 *
¥iv
,

244 
iwl_powîèbÀ_cmd
 *
cmd
)

246 
	`mem£t
(
cmd
, 0, (*cmd));

248 i‡(
¥iv
->
powî_d©a
.
bus_pm
)

249 
cmd
->
Êags
 |
IWL_POWER_PCI_PM_MSK
;

251 
	`IWL_DEBUG_POWER
(
¥iv
, "Sleep command for CAM\n");

252 
	}
}

254 
	$iwl_£t_powî
(
iwl_¥iv
 *
¥iv
, 
iwl_powîèbÀ_cmd
 *
cmd
)

256 
	`IWL_DEBUG_POWER
(
¥iv
, "SendingÖower/sleep command\n");

257 
	`IWL_DEBUG_POWER
(
¥iv
, "Fœg†vÆuê0x%08X\n", 
cmd
->
Êags
);

258 
	`IWL_DEBUG_POWER
(
¥iv
, "TxÅimeouà%u\n", 
	`À32_to_˝u
(
cmd
->
tx_d©a_timeout
));

259 
	`IWL_DEBUG_POWER
(
¥iv
, "RxÅimeouà%u\n", 
	`À32_to_˝u
(
cmd
->
rx_d©a_timeout
));

260 
	`IWL_DEBUG_POWER
(
¥iv
, "Sleep interval vector = { %d , %d , %d , %d , %d }\n",

261 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[0]),

262 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[1]),

263 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[2]),

264 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[3]),

265 
	`À32_to_˝u
(
cmd
->
¶ìp_öãrvÆ
[4]));

267  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
POWER_TABLE_CMD
, 0,

268 (
iwl_powîèbÀ_cmd
), 
cmd
);

269 
	}
}

271 
	$iwl_powî_buûd_cmd
(
iwl_¥iv
 *
¥iv
,

272 
iwl_powîèbÀ_cmd
 *
cmd
)

274 
boﬁ
 
íabÀd
 = 
¥iv
->
hw
->
c⁄f
.
Êags
 & 
IEEE80211_CONF_PS
;

275 
dtim≥r
;

277 i‡(
f‹˚_ˇm
) {

278 
	`iwl_powî_¶ìp_ˇm_cmd
(
¥iv
, 
cmd
);

282 
dtim≥r
 = 
¥iv
->
hw
->
c⁄f
.
ps_dtim_≥riod
 ?: 1;

284 i‡(
¥iv
->
wowœn
)

285 
	`iwl_°©ic_¶ìp_cmd
(
¥iv
, 
cmd
, 
IWL_POWER_INDEX_5
, 
dtim≥r
);

286 i‡(!
¥iv
->
lib
->
no_idÀ_suµ‹t
 &&

287 
¥iv
->
hw
->
c⁄f
.
Êags
 & 
IEEE80211_CONF_IDLE
)

288 
	`iwl_°©ic_¶ìp_cmd
(
¥iv
, 
cmd
, 
IWL_POWER_INDEX_5
, 20);

289 i‡(
	`iwl_â_is_low_powî_°©e
(
¥iv
)) {

291 
	`iwl_°©ic_¶ìp_cmd
(
¥iv
, 
cmd
,

292 
	`iwl_â_cuºít_powî_mode
(
¥iv
), 
dtim≥r
);

293 } i‡(!
íabÀd
)

294 
	`iwl_powî_¶ìp_ˇm_cmd
(
¥iv
, 
cmd
);

295 i‡(
¥iv
->
powî_d©a
.
debug_¶ìp_Àvñ_ovîride
 >= 0)

296 
	`iwl_°©ic_¶ìp_cmd
(
¥iv
, 
cmd
,

297 
¥iv
->
powî_d©a
.
debug_¶ìp_Àvñ_ovîride
,

298 
dtim≥r
);

302 i‡(
iwlwifi_mod_∑øms
.
powî_Àvñ
 > 
IWL_POWER_INDEX_1
 &&

303 
iwlwifi_mod_∑øms
.
powî_Àvñ
 <
IWL_POWER_NUM
)

304 
	`iwl_°©ic_¶ìp_cmd
(
¥iv
, 
cmd
,

305 
iwlwifi_mod_∑øms
.
powî_Àvñ
 - 1, 
dtim≥r
);

307 
	`iwl_°©ic_¶ìp_cmd
(
¥iv
, 
cmd
,

308 
IWL_POWER_INDEX_1
, 
dtim≥r
);

310 
	}
}

312 
	$iwl_powî_£t_mode
(
iwl_¥iv
 *
¥iv
, 
iwl_powîèbÀ_cmd
 *
cmd
,

313 
boﬁ
 
f‹˚
)

315 
ªt
;

316 
boﬁ
 
upd©e_chaös
;

318 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

321 
upd©e_chaös
 = 
¥iv
->
chaö_noi£_d©a
.
°©e
 =
IWL_CHAIN_NOISE_DONE
 ||

322 
¥iv
->
chaö_noi£_d©a
.
°©e
 =
IWL_CHAIN_NOISE_ALIVE
;

324 i‡(!
	`memcmp
(&
¥iv
->
powî_d©a
.
¶ìp_cmd
, 
cmd
, (*cmd)Ë&& !
f‹˚
)

327 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

328  -
EIO
;

331 
	`mem˝y
(&
¥iv
->
powî_d©a
.
¶ìp_cmd_√xt
, 
cmd
, (*cmd));

332 i‡(
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
Ë&& !
f‹˚
) {

333 
	`IWL_DEBUG_INFO
(
¥iv
, "DeferÖower set mode while scanning\n");

337 i‡(
cmd
->
Êags
 & 
IWL_POWER_DRIVER_ALLOW_SLEEP_MSK
)

338 
	`iwl_dvm_£t_pmi
(
¥iv
, 
åue
);

340 
ªt
 = 
	`iwl_£t_powî
(
¥iv
, 
cmd
);

341 i‡(!
ªt
) {

342 i‡(!(
cmd
->
Êags
 & 
IWL_POWER_DRIVER_ALLOW_SLEEP_MSK
))

343 
	`iwl_dvm_£t_pmi
(
¥iv
, 
Ál£
);

345 i‡(
upd©e_chaös
)

346 
	`iwl_upd©e_chaö_Êags
(
¥iv
);

348 
	`IWL_DEBUG_POWER
(
¥iv
,

351 
¥iv
->
chaö_noi£_d©a
.
°©e
);

353 
	`mem˝y
(&
¥iv
->
powî_d©a
.
¶ìp_cmd
, 
cmd
, (*cmd));

355 
	`IWL_ERR
(
¥iv
, "£àpowî faû,Ñë = %d\n", 
ªt
);

357  
ªt
;

358 
	}
}

360 
	$iwl_powî_upd©e_mode
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
f‹˚
)

362 
iwl_powîèbÀ_cmd
 
cmd
;

364 
	`iwl_powî_buûd_cmd
(
¥iv
, &
cmd
);

365  
	`iwl_powî_£t_mode
(
¥iv
, &
cmd
, 
f‹˚
);

366 
	}
}

369 
	$iwl_powî_öôülize
(
iwl_¥iv
 *
¥iv
)

371 
¥iv
->
powî_d©a
.
bus_pm
 =Öriv->
å™s
->
pm_suµ‹t
;

373 
¥iv
->
powî_d©a
.
debug_¶ìp_Àvñ_ovîride
 = -1;

375 
	`mem£t
(&
¥iv
->
powî_d©a
.
¶ìp_cmd
, 0,

376 (
¥iv
->
powî_d©a
.
¶ìp_cmd
));

377 
	}
}

	@dvm/power.h

9 #i‚de‡
__iwl_powî_£âög_h__


10 
	#__iwl_powî_£âög_h__


	)

12 
	~"comm™ds.h
"

14 
	siwl_powî_mgr
 {

15 
iwl_powîèbÀ_cmd
 
	m¶ìp_cmd
;

16 
iwl_powîèbÀ_cmd
 
	m¶ìp_cmd_√xt
;

17 
	mdebug_¶ìp_Àvñ_ovîride
;

18 
boﬁ
 
	mbus_pm
;

21 
iwl_powî_£t_mode
(
iwl_¥iv
 *
¥iv
, 
iwl_powîèbÀ_cmd
 *
cmd
,

22 
boﬁ
 
f‹˚
);

23 
iwl_powî_upd©e_mode
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
f‹˚
);

24 
iwl_powî_öôülize
(
iwl_¥iv
 *
¥iv
);

26 
boﬁ
 
no_¶ìp_autﬂdju°
;

	@dvm/rs.c

7 
	~<löux/kî√l.h
>

8 
	~<löux/skbuff.h
>

9 
	~<löux/¶ab.h
>

10 
	~<√t/mac80211.h
>

12 
	~<löux/√tdevi˚.h
>

13 
	~<löux/ëhîdevi˚.h
>

14 
	~<löux/dñay.h
>

16 
	~<löux/w‹kqueue.h
>

18 
	~"dev.h
"

19 
	~"agn.h
"

21 
	#RS_NAME
 "iwl-agn-rs"

	)

23 
	#NUM_TRY_BEFORE_ANT_TOGGLE
 1

	)

24 
	#IWL_NUMBER_TRY
 1

	)

25 
	#IWL_HT_NUMBER_TRY
 3

	)

27 
	#IWL_RATE_MAX_WINDOW
 62

	)

28 
	#IWL_RATE_MIN_FAILURE_TH
 6

	)

29 
	#IWL_RATE_MIN_SUCCESS_TH
 8

	)

32 
	#IWL_MISSED_RATE_MAX
 15

	)

34 
	#IWL_RATE_SCALE_FLUSH_INTVL
 (3*
HZ
)

	)

36 
u8
 
	grs_ht_to_Àgacy
[] = {

37 
IWL_RATE_6M_INDEX
, IWL_RATE_6M_INDEX,

38 
IWL_RATE_6M_INDEX
, IWL_RATE_6M_INDEX,

39 
IWL_RATE_6M_INDEX
,

40 
IWL_RATE_6M_INDEX
, 
IWL_RATE_9M_INDEX
,

41 
IWL_RATE_12M_INDEX
, 
IWL_RATE_18M_INDEX
,

42 
IWL_RATE_24M_INDEX
, 
IWL_RATE_36M_INDEX
,

43 
IWL_RATE_48M_INDEX
, 
IWL_RATE_54M_INDEX


46 c⁄° 
u8
 
	g™t_toggÀ_lookup
[] = {

47  
ANT_NONE
,

48  
ANT_B
,

49  
ANT_C
,

50  
ANT_BC
,

51  
ANT_A
,

52  
ANT_AB
,

53  
ANT_AC
,

54  
ANT_ABC
,

57 
	#IWL_DECLARE_RATE_INFO
(
r
, 
s
, 
ù
, 
ö
, 
Ω
, 
∫
, 
µ
, 
≈
) \

58 [
IWL_RATE_
##
r
##
M_INDEX
] = { IWL_RATE_##r##
M_PLCP
, \

59 
IWL_RATE_SISO_
##
s
##
M_PLCP
, \

60 
IWL_RATE_MIMO2_
##
s
##
M_PLCP
,\

61 
IWL_RATE_MIMO3_
##
s
##
M_PLCP
,\

62 
IWL_RATE_
##
r
##
M_IEEE
, \

63 
IWL_RATE_
##
ù
##
M_INDEX
, \

64 
IWL_RATE_
##
ö
##
M_INDEX
, \

65 
IWL_RATE_
##
Ω
##
M_INDEX
, \

66 
IWL_RATE_
##
∫
##
M_INDEX
, \

67 
IWL_RATE_
##
µ
##
M_INDEX
, \

68 
IWL_RATE_
##
≈
##
M_INDEX
 }

	)

78 c⁄° 
iwl_øã_öfo
 
	giwl_øãs
[
IWL_RATE_COUNT
] = {

79 
IWL_DECLARE_RATE_INFO
(1, 
INV
, INV, 2, INV, 2, INV, 2),

80 
IWL_DECLARE_RATE_INFO
(2, 
INV
, 1, 5, 1, 5, 1, 5),

81 
IWL_DECLARE_RATE_INFO
(5, 
INV
, 2, 6, 2, 11, 2, 11),

82 
IWL_DECLARE_RATE_INFO
(11, 
INV
, 9, 12, 9, 12, 5, 18),

83 
IWL_DECLARE_RATE_INFO
(6, 6, 5, 9, 5, 11, 5, 11),

84 
IWL_DECLARE_RATE_INFO
(9, 6, 6, 11, 6, 11, 5, 11),

85 
IWL_DECLARE_RATE_INFO
(12, 12, 11, 18, 11, 18, 11, 18),

86 
IWL_DECLARE_RATE_INFO
(18, 18, 12, 24, 12, 24, 11, 24),

87 
IWL_DECLARE_RATE_INFO
(24, 24, 18, 36, 18, 36, 18, 36),

88 
IWL_DECLARE_RATE_INFO
(36, 36, 24, 48, 24, 48, 24, 48),

89 
IWL_DECLARE_RATE_INFO
(48, 48, 36, 54, 36, 54, 36, 54),

90 
IWL_DECLARE_RATE_INFO
(54, 54, 48, 
INV
, 48, INV, 48, INV),

91 
IWL_DECLARE_RATE_INFO
(60, 60, 48, 
INV
, 48, INV, 48, INV),

95 
ölöe
 
u8
 
	$rs_exåa˘_øã
(
u32
 
øã_n_Êags
)

97  (
u8
)(
øã_n_Êags
 & 
RATE_MCS_RATE_MSK
);

98 
	}
}

100 
	$iwl_hwøã_to_∂˝_idx
(
u32
 
øã_n_Êags
)

102 
idx
 = 0;

105 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK
) {

106 
idx
 = 
	`rs_exåa˘_øã
(
øã_n_Êags
);

108 i‡(
idx
 >
IWL_RATE_MIMO3_6M_PLCP
)

109 
idx
 = idx - 
IWL_RATE_MIMO3_6M_PLCP
;

110 i‡(
idx
 >
IWL_RATE_MIMO2_6M_PLCP
)

111 
idx
 = idx - 
IWL_RATE_MIMO2_6M_PLCP
;

113 
idx
 +
IWL_FIRST_OFDM_RATE
;

115 i‡(
idx
 >
IWL_RATE_9M_INDEX
)

116 
idx
 += 1;

117 i‡((
idx
 >
IWL_FIRST_OFDM_RATE
Ë&& (idx <
IWL_LAST_OFDM_RATE
))

118  
idx
;

122 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
iwl_øãs
); idx++)

123 i‡(
iwl_øãs
[
idx
].
∂˝
 ==

124 
	`rs_exåa˘_øã
(
øã_n_Êags
))

125  
idx
;

128  
IWL_RATE_INVALID
;

129 
	}
}

131 
rs_øã_sˇÀ_≥rf‹m
(
iwl_¥iv
 *
¥iv
,

132 
sk_buff
 *
skb
,

133 
õì80211_°a
 *
°a
,

134 
iwl_lq_°a
 *
lq_°a
);

135 
rs_fûl_lök_cmd
(
iwl_¥iv
 *
¥iv
,

136 
iwl_lq_°a
 *
lq_°a
, 
u32
 
øã_n_Êags
);

137 
rs_°ay_ö_èbÀ
(
iwl_lq_°a
 *
lq_°a
, 
boﬁ
 
f‹˚_£¨ch
);

140 #ifde‡
CONFIG_MAC80211_DEBUGFS


141 
rs_dbgfs_£t_mcs
(
iwl_lq_°a
 *
lq_°a
,

142 
u32
 *
øã_n_Êags
, 
ödex
);

144 
	$rs_dbgfs_£t_mcs
(
iwl_lq_°a
 *
lq_°a
,

145 
u32
 *
øã_n_Êags
, 
ödex
)

146 {
	}
}

160 c⁄° 
u16
 
	gex≥˘ed_çt_Àgacy
[
IWL_RATE_COUNT
] = {

164 c⁄° 
u16
 
	gex≥˘ed_çt_siso20MHz
[4][
IWL_RATE_COUNT
] = {

171 c⁄° 
u16
 
	gex≥˘ed_çt_siso40MHz
[4][
IWL_RATE_COUNT
] = {

178 c⁄° 
u16
 
	gex≥˘ed_çt_mimo2_20MHz
[4][
IWL_RATE_COUNT
] = {

185 c⁄° 
u16
 
	gex≥˘ed_çt_mimo2_40MHz
[4][
IWL_RATE_COUNT
] = {

192 c⁄° 
u16
 
	gex≥˘ed_çt_mimo3_20MHz
[4][
IWL_RATE_COUNT
] = {

199 c⁄° 
u16
 
	gex≥˘ed_çt_mimo3_40MHz
[4][
IWL_RATE_COUNT
] = {

206 
	#MCS_INDEX_PER_STREAM
 (8)

	)

208 
	$rs_øã_sˇÀ_˛ór_wödow
(
iwl_øã_sˇÀ_d©a
 *
wödow
)

210 
wödow
->
d©a
 = 0;

211 
wödow
->
suc˚ss_cou¡î
 = 0;

212 
wödow
->
suc˚ss_øtio
 = 
IWL_INVALID_VALUE
;

213 
wödow
->
cou¡î
 = 0;

214 
wödow
->
avîage_çt
 = 
IWL_INVALID_VALUE
;

215 
wödow
->
°amp
 = 0;

216 
	}
}

218 
ölöe
 
u8
 
	$rs_is_vÆid_™t
(
u8
 
vÆid_™ã¬a
, u8 
™t_ty≥
)

220  (
™t_ty≥
 & 
vÆid_™ã¬a
) ==ánt_type;

221 
	}
}

227 
	$rs_é_rm_ﬁd_°©s
(
iwl_åaffic_lﬂd
 *
é
, 
u32
 
cuº_time
)

230 
u32
 
ﬁde°_time
 = 
cuº_time
 - 
TID_MAX_TIME_DIFF
;

232 
é
->
queue_cou¡
 &&

233 (
é
->
time_°amp
 < 
ﬁde°_time
)) {

234 
é
->
tŸÆ
 -é->
∑ckë_cou¡
[é->
hód
];

235 
é
->
∑ckë_cou¡
[é->
hód
] = 0;

236 
é
->
time_°amp
 +
TID_QUEUE_CELL_SPACING
;

237 
é
->
queue_cou¡
--;

238 
é
->
hód
++;

239 i‡(
é
->
hód
 >
TID_QUEUE_MAX_SIZE
)

240 
é
->
hód
 = 0;

242 
	}
}

248 
u8
 
	$rs_é_add_∑ckë
(
iwl_lq_°a
 *
lq_d©a
,

249 
õì80211_hdr
 *
hdr
)

251 
u32
 
cuº_time
 = 
	`jiffõs_to_m£cs
(
jiffõs
);

252 
u32
 
time_diff
;

253 
s32
 
ödex
;

254 
iwl_åaffic_lﬂd
 *
é
 = 
NULL
;

255 
u8
 
tid
;

257 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
)) {

258 
u8
 *
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

259 
tid
 = 
qc
[0] & 0xf;

261  
IWL_MAX_TID_COUNT
;

263 i‡(
	`u∆ikñy
(
tid
 >
IWL_MAX_TID_COUNT
))

264  
IWL_MAX_TID_COUNT
;

266 
é
 = &
lq_d©a
->
lﬂd
[
tid
];

268 
cuº_time
 -cuº_timê% 
TID_ROUND_VALUE
;

271 i‡(!(
é
->
queue_cou¡
)) {

272 
é
->
tŸÆ
 = 1;

273 
é
->
time_°amp
 = 
cuº_time
;

274 
é
->
queue_cou¡
 = 1;

275 
é
->
hód
 = 0;

276 
é
->
∑ckë_cou¡
[0] = 1;

277  
IWL_MAX_TID_COUNT
;

280 
time_diff
 = 
	`TIME_WRAP_AROUND
(
é
->
time_°amp
, 
cuº_time
);

281 
ödex
 = 
time_diff
 / 
TID_QUEUE_CELL_SPACING
;

285 i‡(
ödex
 >
TID_QUEUE_MAX_SIZE
)

286 
	`rs_é_rm_ﬁd_°©s
(
é
, 
cuº_time
);

288 
ödex
 = (
é
->
hód
 + indexË% 
TID_QUEUE_MAX_SIZE
;

289 
é
->
∑ckë_cou¡
[
ödex
] =Ål->packet_count[index] + 1;

290 
é
->
tŸÆ
 =Ål->total + 1;

292 i‡((
ödex
 + 1Ë> 
é
->
queue_cou¡
)

293 
é
->
queue_cou¡
 = 
ödex
 + 1;

295  
tid
;

296 
	}
}

298 #ifde‡
CONFIG_MAC80211_DEBUGFS


305 
	$rs_¥ogøm_fix_øã
(
iwl_¥iv
 *
¥iv
,

306 
iwl_lq_°a
 *
lq_°a
)

308 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 =

309 
	`c⁄èöî_of
(
lq_°a
, 
iwl_°©i⁄_¥iv
,Üq_sta);

310 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
°a_¥iv
->ctx;

312 
lq_°a
->
a˘ive_Àgacy_øã
 = 0x0FFF;

313 
lq_°a
->
a˘ive_siso_øã
 = 0x1FD0;

314 
lq_°a
->
a˘ive_mimo2_øã
 = 0x1FD0;

315 
lq_°a
->
a˘ive_mimo3_øã
 = 0x1FD0;

317 
	`IWL_DEBUG_RATE
(
¥iv
, "sta_id %dÑate 0x%X\n",

318 
lq_°a
->
lq
.
°a_id
,Üq_°a->
dbg_fixed_øã
);

320 i‡(
lq_°a
->
dbg_fixed_øã
) {

321 
	`rs_fûl_lök_cmd
(
NULL
, 
lq_°a
,Üq_°a->
dbg_fixed_øã
);

322 
	`iwl_£nd_lq_cmd
(
lq_°a
->
drv
, 
˘x
, &lq_°a->
lq
, 
CMD_ASYNC
,

323 
Ál£
);

325 
	}
}

331 
	$rs_é_gë_lﬂd
(
iwl_lq_°a
 *
lq_d©a
, 
u8
 
tid
)

333 
u32
 
cuº_time
 = 
	`jiffõs_to_m£cs
(
jiffõs
);

334 
u32
 
time_diff
;

335 
s32
 
ödex
;

336 
iwl_åaffic_lﬂd
 *
é
 = 
NULL
;

338 i‡(
tid
 >
IWL_MAX_TID_COUNT
)

341 
é
 = &(
lq_d©a
->
lﬂd
[
tid
]);

343 
cuº_time
 -cuº_timê% 
TID_ROUND_VALUE
;

345 i‡(!(
é
->
queue_cou¡
))

348 
time_diff
 = 
	`TIME_WRAP_AROUND
(
é
->
time_°amp
, 
cuº_time
);

349 
ödex
 = 
time_diff
 / 
TID_QUEUE_CELL_SPACING
;

353 i‡(
ödex
 >
TID_QUEUE_MAX_SIZE
)

354 
	`rs_é_rm_ﬁd_°©s
(
é
, 
cuº_time
);

355 
	}
}

357 
	$rs_é_tu∫_⁄_agg_f‹_tid
(
iwl_¥iv
 *
¥iv
,

358 
iwl_lq_°a
 *
lq_d©a
, 
u8
 
tid
,

359 
õì80211_°a
 *
°a
)

361 
ªt
 = -
EAGAIN
;

367 i‡(
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
) {

368 
	`IWL_DEBUG_COEX
(
¥iv
,

370 
¥iv
->
bt_åaffic_lﬂd
);

371  
ªt
;

374 
	`rs_é_gë_lﬂd
(
lq_d©a
, 
tid
);

376 
	`IWL_DEBUG_HT
(
¥iv
, "Starting Txágg: STA: %pMÅid: %d\n",

377 
°a
->
addr
, 
tid
);

378 
ªt
 = 
	`õì80211_°¨t_tx_ba_£ssi⁄
(
°a
, 
tid
, 5000);

379 i‡(
ªt
 =-
EAGAIN
) {

385 
	`IWL_ERR
(
¥iv
, "Fail start Txágg onÅid: %d\n",

386 
tid
);

387 
	`õì80211_°›_tx_ba_£ssi⁄
(
°a
, 
tid
);

389  
ªt
;

390 
	}
}

392 
	$rs_é_tu∫_⁄_agg
(
iwl_¥iv
 *
¥iv
, 
u8
 
tid
,

393 
iwl_lq_°a
 *
lq_d©a
,

394 
õì80211_°a
 *
°a
)

396 i‡(
tid
 < 
IWL_MAX_TID_COUNT
)

397 
	`rs_é_tu∫_⁄_agg_f‹_tid
(
¥iv
, 
lq_d©a
, 
tid
, 
°a
);

399 
	`IWL_ERR
(
¥iv
, "tidÉxceeds max TID count: %d/%d\n",

400 
tid
, 
IWL_MAX_TID_COUNT
);

401 
	}
}

403 
ölöe
 
	$gë_num_of_™t_‰om_øã
(
u32
 
øã_n_Êags
)

405  !!(
øã_n_Êags
 & 
RATE_MCS_ANT_A_MSK
) +

406 !!(
øã_n_Êags
 & 
RATE_MCS_ANT_B_MSK
) +

407 !!(
øã_n_Êags
 & 
RATE_MCS_ANT_C_MSK
);

408 
	}
}

414 
s32
 
	$gë_ex≥˘ed_çt
(
iwl_sˇÀ_tbl_öfo
 *
tbl
, 
rs_ödex
)

416 i‡(
tbl
->
ex≥˘ed_çt
)

417  
tbl
->
ex≥˘ed_çt
[
rs_ödex
];

419 
	}
}

428 
	$rs_cﬁÀ˘_tx_d©a
(
iwl_sˇÀ_tbl_öfo
 *
tbl
,

429 
sˇÀ_ödex
, 
©ãm±s
, 
suc˚s£s
)

431 
iwl_øã_sˇÀ_d©a
 *
wödow
 = 
NULL
;

432 c⁄° 
u64
 
mask
 = (((u64)1Ë<< (
IWL_RATE_MAX_WINDOW
 - 1));

433 
s32
 
Áû_cou¡
, 
çt
;

435 i‡(
sˇÀ_ödex
 < 0 || sˇÀ_ödex >
IWL_RATE_COUNT
)

436  -
EINVAL
;

439 
wödow
 = &(
tbl
->
wö
[
sˇÀ_ödex
]);

442 
çt
 = 
	`gë_ex≥˘ed_çt
(
tbl
, 
sˇÀ_ödex
);

452 
©ãm±s
 > 0) {

453 i‡(
wödow
->
cou¡î
 >
IWL_RATE_MAX_WINDOW
) {

456 
wödow
->
cou¡î
 = 
IWL_RATE_MAX_WINDOW
 - 1;

458 i‡(
wödow
->
d©a
 & 
mask
) {

459 
wödow
->
d©a
 &~
mask
;

460 
wödow
->
suc˚ss_cou¡î
--;

465 
wödow
->
cou¡î
++;

468 
wödow
->
d©a
 <<= 1;

471 i‡(
suc˚s£s
 > 0) {

472 
wödow
->
suc˚ss_cou¡î
++;

473 
wödow
->
d©a
 |= 0x1;

474 
suc˚s£s
--;

477 
©ãm±s
--;

481 i‡(
wödow
->
cou¡î
 > 0)

482 
wödow
->
suc˚ss_øtio
 = 128 * (100 * wödow->
suc˚ss_cou¡î
)

483 / 
wödow
->
cou¡î
;

485 
wödow
->
suc˚ss_øtio
 = 
IWL_INVALID_VALUE
;

487 
Áû_cou¡
 = 
wödow
->
cou¡î
 - wödow->
suc˚ss_cou¡î
;

490 i‡((
Áû_cou¡
 >
IWL_RATE_MIN_FAILURE_TH
) ||

491 (
wödow
->
suc˚ss_cou¡î
 >
IWL_RATE_MIN_SUCCESS_TH
))

492 
wödow
->
avîage_çt
 = (wödow->
suc˚ss_øtio
 * 
çt
 + 64) / 128;

494 
wödow
->
avîage_çt
 = 
IWL_INVALID_VALUE
;

497 
wödow
->
°amp
 = 
jiffõs
;

500 
	}
}

506 
u32
 
	$øã_n_Êags_‰om_tbl
(
iwl_¥iv
 *
¥iv
,

507 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

508 
ödex
, 
u8
 
u£_gªí
)

510 
u32
 
øã_n_Êags
 = 0;

512 i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
)) {

513 
øã_n_Êags
 = 
iwl_øãs
[
ödex
].
∂˝
;

514 i‡(
ödex
 >
IWL_FIRST_CCK_RATE
 && index <
IWL_LAST_CCK_RATE
)

515 
øã_n_Êags
 |
RATE_MCS_CCK_MSK
;

517 } i‡(
	`is_Ht
(
tbl
->
lq_ty≥
)) {

518 i‡(
ödex
 > 
IWL_LAST_OFDM_RATE
) {

519 
	`IWL_ERR
(
¥iv
, "InvÆid HTÑ©êödex %d\n", 
ödex
);

520 
ödex
 = 
IWL_LAST_OFDM_RATE
;

522 
øã_n_Êags
 = 
RATE_MCS_HT_MSK
;

524 i‡(
	`is_siso
(
tbl
->
lq_ty≥
))

525 
øã_n_Êags
 |
iwl_øãs
[
ödex
].
∂˝_siso
;

526 i‡(
	`is_mimo2
(
tbl
->
lq_ty≥
))

527 
øã_n_Êags
 |
iwl_øãs
[
ödex
].
∂˝_mimo2
;

529 
øã_n_Êags
 |
iwl_øãs
[
ödex
].
∂˝_mimo3
;

531 
	`IWL_ERR
(
¥iv
, "InvÆidÅbl->lq_ty≥ %d\n", 
tbl
->
lq_ty≥
);

534 
øã_n_Êags
 |((
tbl
->
™t_ty≥
 << 
RATE_MCS_ANT_POS
) &

535 
RATE_MCS_ANT_ABC_MSK
);

537 i‡(
	`is_Ht
(
tbl
->
lq_ty≥
)) {

538 i‡(
tbl
->
is_ht40
) {

539 i‡(
tbl
->
is_dup
)

540 
øã_n_Êags
 |
RATE_MCS_DUP_MSK
;

542 
øã_n_Êags
 |
RATE_MCS_HT40_MSK
;

544 i‡(
tbl
->
is_SGI
)

545 
øã_n_Êags
 |
RATE_MCS_SGI_MSK
;

547 i‡(
u£_gªí
) {

548 
øã_n_Êags
 |
RATE_MCS_GF_MSK
;

549 i‡(
	`is_siso
(
tbl
->
lq_ty≥
Ë&&Åbl->
is_SGI
) {

550 
øã_n_Êags
 &~
RATE_MCS_SGI_MSK
;

551 
	`IWL_ERR
(
¥iv
, "GF was set with SGI:SISO\n");

555  
øã_n_Êags
;

556 
	}
}

562 
	$rs_gë_tbl_öfo_‰om_mcs
(c⁄° 
u32
 
øã_n_Êags
,

563 
∆80211_b™d
 
b™d
,

564 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

565 *
øã_idx
)

567 
u32
 
™t_msk
 = (
øã_n_Êags
 & 
RATE_MCS_ANT_ABC_MSK
);

568 
u8
 
num_of_™t
 = 
	`gë_num_of_™t_‰om_øã
(
øã_n_Êags
);

569 
u8
 
mcs
;

571 
	`mem£t
(
tbl
, 0, (
iwl_sˇÀ_tbl_öfo
));

572 *
øã_idx
 = 
	`iwl_hwøã_to_∂˝_idx
(
øã_n_Êags
);

574 i‡(*
øã_idx
 =
IWL_RATE_INVALID
) {

575 *
øã_idx
 = -1;

576  -
EINVAL
;

578 
tbl
->
is_SGI
 = 0;

579 
tbl
->
is_ht40
 = 0;

580 
tbl
->
is_dup
 = 0;

581 
tbl
->
™t_ty≥
 = (
™t_msk
 >> 
RATE_MCS_ANT_POS
);

582 
tbl
->
lq_ty≥
 = 
LQ_NONE
;

583 
tbl
->
max_£¨ch
 = 
IWL_MAX_SEARCH
;

586 i‡(!(
øã_n_Êags
 & 
RATE_MCS_HT_MSK
)) {

587 i‡(
num_of_™t
 == 1) {

588 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

589 
tbl
->
lq_ty≥
 = 
LQ_A
;

591 
tbl
->
lq_ty≥
 = 
LQ_G
;

595 i‡(
øã_n_Êags
 & 
RATE_MCS_SGI_MSK
)

596 
tbl
->
is_SGI
 = 1;

598 i‡((
øã_n_Êags
 & 
RATE_MCS_HT40_MSK
) ||

599 (
øã_n_Êags
 & 
RATE_MCS_DUP_MSK
))

600 
tbl
->
is_ht40
 = 1;

602 i‡(
øã_n_Êags
 & 
RATE_MCS_DUP_MSK
)

603 
tbl
->
is_dup
 = 1;

605 
mcs
 = 
	`rs_exåa˘_øã
(
øã_n_Êags
);

608 i‡(
mcs
 <
IWL_RATE_SISO_60M_PLCP
) {

609 i‡(
num_of_™t
 == 1)

610 
tbl
->
lq_ty≥
 = 
LQ_SISO
;

612 } i‡(
mcs
 <
IWL_RATE_MIMO2_60M_PLCP
) {

613 i‡(
num_of_™t
 == 2)

614 
tbl
->
lq_ty≥
 = 
LQ_MIMO2
;

617 i‡(
num_of_™t
 == 3) {

618 
tbl
->
max_£¨ch
 = 
IWL_MAX_11N_MIMO3_SEARCH
;

619 
tbl
->
lq_ty≥
 = 
LQ_MIMO3
;

624 
	}
}

628 
	$rs_toggÀ_™ã¬a
(
u32
 
vÆid_™t
, u32 *
øã_n_Êags
,

629 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

631 
u8
 
√w_™t_ty≥
;

633 i‡(!
tbl
->
™t_ty≥
 ||Åbl->™t_ty≥ > 
ANT_ABC
)

636 i‡(!
	`rs_is_vÆid_™t
(
vÆid_™t
, 
tbl
->
™t_ty≥
))

639 
√w_™t_ty≥
 = 
™t_toggÀ_lookup
[
tbl
->
™t_ty≥
];

641 (
√w_™t_ty≥
 !
tbl
->
™t_ty≥
) &&

642 !
	`rs_is_vÆid_™t
(
vÆid_™t
, 
√w_™t_ty≥
))

643 
√w_™t_ty≥
 = 
™t_toggÀ_lookup
[new_ant_type];

645 i‡(
√w_™t_ty≥
 =
tbl
->
™t_ty≥
)

648 
tbl
->
™t_ty≥
 = 
√w_™t_ty≥
;

649 *
øã_n_Êags
 &~
RATE_MCS_ANT_ABC_MSK
;

650 *
øã_n_Êags
 |
√w_™t_ty≥
 << 
RATE_MCS_ANT_POS
;

652 
	}
}

658 
boﬁ
 
	$rs_u£_gªí
(
õì80211_°a
 *
°a
)

667  
Ál£
;

668 
	}
}

677 
u16
 
	$rs_gë_suµ‹ãd_øãs
(
iwl_lq_°a
 *
lq_°a
,

678 
õì80211_hdr
 *
hdr
,

679 
iwl_èbÀ_ty≥
 
øã_ty≥
)

681 i‡(
	`is_Àgacy
(
øã_ty≥
)) {

682  
lq_°a
->
a˘ive_Àgacy_øã
;

684 i‡(
	`is_siso
(
øã_ty≥
))

685  
lq_°a
->
a˘ive_siso_øã
;

686 i‡(
	`is_mimo2
(
øã_ty≥
))

687  
lq_°a
->
a˘ive_mimo2_øã
;

689  
lq_°a
->
a˘ive_mimo3_øã
;

691 
	}
}

693 
u16
 
	$rs_gë_adja˚¡_øã
(
iwl_¥iv
 *
¥iv
, 
u8
 
ödex
, 
u16
 
øã_mask
,

694 
øã_ty≥
)

696 
u8
 
high
 = 
IWL_RATE_INVALID
;

697 
u8
 
low
 = 
IWL_RATE_INVALID
;

701 i‡(
	`is_a_b™d
(
øã_ty≥
Ë|| !
	`is_Àgacy
(rate_type)) {

702 
i
;

703 
u32
 
mask
;

706 
i
 = 
ödex
 - 1;

707 i‡(
i
 >= 0)

708 
mask
 = 
	`BIT
(
i
);

710 ; 
i
 >0; i--, 
mask
 >>= 1) {

711 i‡(
øã_mask
 & 
mask
) {

712 
low
 = 
i
;

718 
i
 = 
ödex
 + 1;

719 
mask
 = (1 << 
i
); i < 
IWL_RATE_COUNT
; i++, mask <<= 1) {

720 i‡(
øã_mask
 & 
mask
) {

721 
high
 = 
i
;

726  (
high
 << 8Ë| 
low
;

729 
low
 = 
ödex
;

730 
low
 !
IWL_RATE_INVALID
) {

731 
low
 = 
iwl_øãs
[low].
¥ev_rs
;

732 i‡(
low
 =
IWL_RATE_INVALID
)

734 i‡(
øã_mask
 & (1 << 
low
))

736 
	`IWL_DEBUG_RATE
(
¥iv
, "Skùpög maskedÜowîÑ©e: %d\n", 
low
);

739 
high
 = 
ödex
;

740 
high
 !
IWL_RATE_INVALID
) {

741 
high
 = 
iwl_øãs
[high].
√xt_rs
;

742 i‡(
high
 =
IWL_RATE_INVALID
)

744 i‡(
øã_mask
 & (1 << 
high
))

746 
	`IWL_DEBUG_RATE
(
¥iv
, "Skùpög masked highîÑ©e: %d\n", 
high
);

749  (
high
 << 8Ë| 
low
;

750 
	}
}

752 
u32
 
	$rs_gë_lowî_øã
(
iwl_lq_°a
 *
lq_°a
,

753 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

754 
u8
 
sˇÀ_ödex
, u8 
ht_possibÀ
)

756 
s32
 
low
;

757 
u16
 
øã_mask
;

758 
u16
 
high_low
;

759 
u8
 
swôch_to_Àgacy
 = 0;

760 
u8
 
is_gªí
 = 
lq_°a
->is_green;

761 
iwl_¥iv
 *
¥iv
 = 
lq_°a
->
drv
;

766 i‡(!
	`is_Àgacy
(
tbl
->
lq_ty≥
Ë&& (!
ht_possibÀ
 || !
sˇÀ_ödex
)) {

767 
swôch_to_Àgacy
 = 1;

768 
sˇÀ_ödex
 = 
rs_ht_to_Àgacy
[scale_index];

769 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
)

770 
tbl
->
lq_ty≥
 = 
LQ_A
;

772 
tbl
->
lq_ty≥
 = 
LQ_G
;

774 i‡(
	`num_of_™t
(
tbl
->
™t_ty≥
) > 1)

775 
tbl
->
™t_ty≥
 =

776 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

778 
tbl
->
is_ht40
 = 0;

779 
tbl
->
is_SGI
 = 0;

780 
tbl
->
max_£¨ch
 = 
IWL_MAX_SEARCH
;

783 
øã_mask
 = 
	`rs_gë_suµ‹ãd_øãs
(
lq_°a
, 
NULL
, 
tbl
->
lq_ty≥
);

786 i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
)) {

788 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
)

789 
øã_mask
 = (
u16
)(rate_mask &

790 (
lq_°a
->
suµ_øãs
 << 
IWL_FIRST_OFDM_RATE
));

792 
øã_mask
 = (
u16
)‘©e_mask & 
lq_°a
->
suµ_øãs
);

796 i‡(
swôch_to_Àgacy
 && (
øã_mask
 & (1 << 
sˇÀ_ödex
))) {

797 
low
 = 
sˇÀ_ödex
;

798 
out
;

801 
high_low
 = 
	`rs_gë_adja˚¡_øã
(
lq_°a
->
drv
, 
sˇÀ_ödex
, 
øã_mask
,

802 
tbl
->
lq_ty≥
);

803 
low
 = 
high_low
 & 0xff;

805 i‡(
low
 =
IWL_RATE_INVALID
)

806 
low
 = 
sˇÀ_ödex
;

808 
out
:

809  
	`øã_n_Êags_‰om_tbl
(
lq_°a
->
drv
, 
tbl
, 
low
, 
is_gªí
);

810 
	}
}

815 
boﬁ
 
	$èbÀ_ty≥_m©ches
(
iwl_sˇÀ_tbl_öfo
 *
a
,

816 
iwl_sˇÀ_tbl_öfo
 *
b
)

818  (
a
->
lq_ty≥
 =
b
->lq_ty≥Ë&& (a->
™t_ty≥
 == b->ant_type) &&

819 (
a
->
is_SGI
 =
b
->is_SGI);

820 
	}
}

822 
	$rs_bt_upd©e_lq
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

823 
iwl_lq_°a
 *
lq_°a
)

825 
iwl_sˇÀ_tbl_öfo
 *
tbl
;

826 
boﬁ
 
fuŒ_c⁄cuºít
 = 
¥iv
->
bt_fuŒ_c⁄cuºít
;

828 i‡((
¥iv
->
bt_åaffic_lﬂd
 !¥iv->
œ°_bt_åaffic_lﬂd
) ||

829 (
¥iv
->
bt_fuŒ_c⁄cuºít
 !
fuŒ_c⁄cuºít
)) {

830 
¥iv
->
bt_fuŒ_c⁄cuºít
 = 
fuŒ_c⁄cuºít
;

831 
¥iv
->
œ°_bt_åaffic_lﬂd
 =Öriv->
bt_åaffic_lﬂd
;

834 
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

835 
	`rs_fûl_lök_cmd
(
¥iv
, 
lq_°a
, 
tbl
->
cuºít_øã
);

836 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, &
lq_°a
->
lq
, 
CMD_ASYNC
, 
Ál£
);

838 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
bt_fuŒ_c⁄cuºícy
);

840 
	}
}

845 
	$rs_tx_°©us
(*
¥iv_r
, 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

846 
õì80211_°a
 *
°a
, *
¥iv_°a
,

847 
sk_buff
 *
skb
)

849 
Àgacy_suc˚ss
;

850 
ªåõs
;

851 
rs_ödex
, 
mac_ödex
, 
i
;

852 
iwl_lq_°a
 *
lq_°a
 = 
¥iv_°a
;

853 
iwl_lök_quÆôy_cmd
 *
èbÀ
;

854 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

855 
iwl_›_mode
 *
›_mode
 = (iwl_›_modê*)
¥iv_r
;

856 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

857 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

858 
mac80211_øã_c⁄åﬁ_Êags
 
mac_Êags
;

859 
u32
 
tx_øã
;

860 
iwl_sˇÀ_tbl_öfo
 
tbl_ty≥
;

861 
iwl_sˇÀ_tbl_öfo
 *
cuº_tbl
, *
Ÿhî_tbl
, *
tmp_tbl
;

862 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

863 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
°a_¥iv
->ctx;

865 
	`IWL_DEBUG_RATE_LIMIT
(
¥iv
, "get frameáckÑesponse, updateÑate scale window\n");

868 i‡(!
lq_°a
) {

869 
	`IWL_DEBUG_RATE
(
¥iv
, "StationÑate scalingÇot created yet.\n");

871 } i‡(!
lq_°a
->
drv
) {

872 
	`IWL_DEBUG_RATE
(
¥iv
, "Rate scalingÇot initialized yet.\n");

876 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) ||

877 
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
)

881 i‡((
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
) &&

882 !(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_AMPDU
))

893 
èbÀ
 = &
lq_°a
->
lq
;

894 
tx_øã
 = 
	`À32_to_˝u
(
èbÀ
->
rs_èbÀ
[0].
øã_n_Êags
);

895 
	`rs_gë_tbl_öfo_‰om_mcs
(
tx_øã
, 
¥iv
->
b™d
, &
tbl_ty≥
, &
rs_ödex
);

896 i‡(
¥iv
->
b™d
 =
NL80211_BAND_5GHZ
)

897 
rs_ödex
 -
IWL_FIRST_OFDM_RATE
;

898 
mac_Êags
 = 
öfo
->
°©us
.
øãs
[0].
Êags
;

899 
mac_ödex
 = 
öfo
->
°©us
.
øãs
[0].
idx
;

901 i‡(
mac_Êags
 & 
IEEE80211_TX_RC_MCS
) {

902 
mac_ödex
 &
RATE_MCS_CODE_MSK
;

903 i‡(
mac_ödex
 >(
IWL_RATE_9M_INDEX
 - 
IWL_FIRST_OFDM_RATE
))

904 
mac_ödex
++;

909 i‡(
¥iv
->
b™d
 =
NL80211_BAND_2GHZ
)

910 
mac_ödex
 +
IWL_FIRST_OFDM_RATE
;

913 i‡((
mac_ödex
 < 0) ||

914 (
tbl_ty≥
.
is_SGI
 !!!(
mac_Êags
 & 
IEEE80211_TX_RC_SHORT_GI
)) ||

915 (
tbl_ty≥
.
is_ht40
 !!!(
mac_Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)) ||

916 (
tbl_ty≥
.
is_dup
 !!!(
mac_Êags
 & 
IEEE80211_TX_RC_DUP_DATA
)) ||

917 (
tbl_ty≥
.
™t_ty≥
 !
öfo
->
°©us
.
™ã¬a
) ||

918 (!!(
tx_øã
 & 
RATE_MCS_HT_MSK
Ë!!!(
mac_Êags
 & 
IEEE80211_TX_RC_MCS
)) ||

919 (!!(
tx_øã
 & 
RATE_MCS_GF_MSK
Ë!!!(
mac_Êags
 & 
IEEE80211_TX_RC_GREEN_FIELD
)) ||

920 (
rs_ödex
 !
mac_ödex
)) {

921 
	`IWL_DEBUG_RATE
(
¥iv
, "öôü»øã %d d€†nŸ m©ch %d (0x%x)\n", 
mac_ödex
, 
rs_ödex
, 
tx_øã
);

927 
lq_°a
->
mis£d_øã_cou¡î
++;

928 i‡(
lq_°a
->
mis£d_øã_cou¡î
 > 
IWL_MISSED_RATE_MAX
) {

929 
lq_°a
->
mis£d_øã_cou¡î
 = 0;

930 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, &
lq_°a
->
lq
, 
CMD_ASYNC
, 
Ál£
);

936 
lq_°a
->
mis£d_øã_cou¡î
 = 0;

939 i‡(
	`èbÀ_ty≥_m©ches
(&
tbl_ty≥
,

940 &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]))) {

941 
cuº_tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

942 
Ÿhî_tbl
 = &(
lq_°a
->
lq_öfo
[1 -Üq_°a->
a˘ive_tbl
]);

943 } i‡(
	`èbÀ_ty≥_m©ches
(&
tbl_ty≥
,

944 &
lq_°a
->
lq_öfo
[1 -Üq_°a->
a˘ive_tbl
])) {

945 
cuº_tbl
 = &(
lq_°a
->
lq_öfo
[1 -Üq_°a->
a˘ive_tbl
]);

946 
Ÿhî_tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

948 
	`IWL_DEBUG_RATE
(
¥iv
, "NeitheráctiveÇor search matchesÅxÑate\n");

949 
tmp_tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

950 
	`IWL_DEBUG_RATE
(
¥iv
, "active-Üq:%x,ánt:%x, SGI:%d\n",

951 
tmp_tbl
->
lq_ty≥
,Åmp_tbl->
™t_ty≥
,Åmp_tbl->
is_SGI
);

952 
tmp_tbl
 = &(
lq_°a
->
lq_öfo
[1 -Üq_°a->
a˘ive_tbl
]);

953 
	`IWL_DEBUG_RATE
(
¥iv
, "search-Üq:%x,ánt:%x, SGI:%d\n",

954 
tmp_tbl
->
lq_ty≥
,Åmp_tbl->
™t_ty≥
,Åmp_tbl->
is_SGI
);

955 
	`IWL_DEBUG_RATE
(
¥iv
, "actual-Üq:%x,ánt:%x, SGI:%d\n",

956 
tbl_ty≥
.
lq_ty≥
,Åbl_ty≥.
™t_ty≥
,Åbl_ty≥.
is_SGI
);

961 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
åue
);

962 
d⁄e
;

972 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_AMPDU
) {

973 
tx_øã
 = 
	`À32_to_˝u
(
èbÀ
->
rs_èbÀ
[0].
øã_n_Êags
);

974 
	`rs_gë_tbl_öfo_‰om_mcs
(
tx_øã
, 
¥iv
->
b™d
, &
tbl_ty≥
,

975 &
rs_ödex
);

976 
	`rs_cﬁÀ˘_tx_d©a
(
cuº_tbl
, 
rs_ödex
,

977 
öfo
->
°©us
.
ampdu_Àn
,

978 
öfo
->
°©us
.
ampdu_ack_Àn
);

981 i‡(
lq_°a
->
°ay_ö_tbl
) {

982 
lq_°a
->
tŸÆ_suc˚ss
 +
öfo
->
°©us
.
ampdu_ack_Àn
;

983 
lq_°a
->
tŸÆ_Áûed
 +(
öfo
->
°©us
.
ampdu_Àn
 -

984 
öfo
->
°©us
.
ampdu_ack_Àn
);

990 
ªåõs
 = 
öfo
->
°©us
.
øãs
[0].
cou¡
 - 1;

992 
ªåõs
 = 
	`mö
(retries, 15);

995 
Àgacy_suc˚ss
 = !!(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_ACK
);

997 
i
 = 0; i <
ªåõs
; ++i) {

998 
tx_øã
 = 
	`À32_to_˝u
(
èbÀ
->
rs_èbÀ
[
i
].
øã_n_Êags
);

999 
	`rs_gë_tbl_öfo_‰om_mcs
(
tx_øã
, 
¥iv
->
b™d
,

1000 &
tbl_ty≥
, &
rs_ödex
);

1005 i‡(
	`èbÀ_ty≥_m©ches
(&
tbl_ty≥
, 
cuº_tbl
))

1006 
tmp_tbl
 = 
cuº_tbl
;

1007 i‡(
	`èbÀ_ty≥_m©ches
(&
tbl_ty≥
, 
Ÿhî_tbl
))

1008 
tmp_tbl
 = 
Ÿhî_tbl
;

1011 
	`rs_cﬁÀ˘_tx_d©a
(
tmp_tbl
, 
rs_ödex
, 1,

1012 
i
 < 
ªåõs
 ? 0 : 
Àgacy_suc˚ss
);

1016 i‡(
lq_°a
->
°ay_ö_tbl
) {

1017 
lq_°a
->
tŸÆ_suc˚ss
 +
Àgacy_suc˚ss
;

1018 
lq_°a
->
tŸÆ_Áûed
 +
ªåõs
 + (1 - 
Àgacy_suc˚ss
);

1022 
lq_°a
->
œ°_øã_n_Êags
 = 
tx_øã
;

1023 
d⁄e
:

1025 i‡(
°a
 && sè->
deÊök
.
suµ_øãs
[
sb™d
->
b™d
])

1026 
	`rs_øã_sˇÀ_≥rf‹m
(
¥iv
, 
skb
, 
°a
, 
lq_°a
);

1028 i‡(
¥iv
->
lib
->
bt_∑øms
 &&Öriv->lib->bt_∑øms->
adv™˚d_bt_c€xi°
)

1029 
	`rs_bt_upd©e_lq
(
¥iv
, 
˘x
, 
lq_°a
);

1030 
	}
}

1040 
	$rs_£t_°ay_ö_èbÀ
(
iwl_¥iv
 *
¥iv
, 
u8
 
is_Àgacy
,

1041 
iwl_lq_°a
 *
lq_°a
)

1043 
	`IWL_DEBUG_RATE
(
¥iv
, "weáre staying inÅhe sameÅable\n");

1044 
lq_°a
->
°ay_ö_tbl
 = 1;

1045 i‡(
is_Àgacy
) {

1046 
lq_°a
->
èbÀ_cou¡_limô
 = 
IWL_LEGACY_TABLE_COUNT
;

1047 
lq_°a
->
max_Áûuª_limô
 = 
IWL_LEGACY_FAILURE_LIMIT
;

1048 
lq_°a
->
max_suc˚ss_limô
 = 
IWL_LEGACY_SUCCESS_LIMIT
;

1050 
lq_°a
->
èbÀ_cou¡_limô
 = 
IWL_NONE_LEGACY_TABLE_COUNT
;

1051 
lq_°a
->
max_Áûuª_limô
 = 
IWL_NONE_LEGACY_FAILURE_LIMIT
;

1052 
lq_°a
->
max_suc˚ss_limô
 = 
IWL_NONE_LEGACY_SUCCESS_LIMIT
;

1054 
lq_°a
->
èbÀ_cou¡
 = 0;

1055 
lq_°a
->
tŸÆ_Áûed
 = 0;

1056 
lq_°a
->
tŸÆ_suc˚ss
 = 0;

1057 
lq_°a
->
Êush_timî
 = 
jiffõs
;

1058 
lq_°a
->
a˘i⁄_cou¡î
 = 0;

1059 
	}
}

1064 
	$rs_£t_ex≥˘ed_çt_èbÀ
(
iwl_lq_°a
 *
lq_°a
,

1065 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

1068 c⁄° 
	`u16
 (*
ht_tbl_poöãr
)[
IWL_RATE_COUNT
];

1071 i‡(
	`WARN_ON_ONCE
(!
	`is_Àgacy
(
tbl
->
lq_ty≥
Ë&& !
	`is_Ht
(tbl->lq_type))) {

1072 
tbl
->
ex≥˘ed_çt
 = 
ex≥˘ed_çt_Àgacy
;

1077 i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
)) {

1078 
tbl
->
ex≥˘ed_çt
 = 
ex≥˘ed_çt_Àgacy
;

1085 i‡(
	`is_siso
(
tbl
->
lq_ty≥
Ë&& (!tbl->
is_ht40
 || 
lq_°a
->
is_dup
))

1086 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_siso20MHz
;

1087 i‡(
	`is_siso
(
tbl
->
lq_ty≥
))

1088 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_siso40MHz
;

1089 i‡(
	`is_mimo2
(
tbl
->
lq_ty≥
Ë&& (!tbl->
is_ht40
 || 
lq_°a
->
is_dup
))

1090 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_20MHz
;

1091 i‡(
	`is_mimo2
(
tbl
->
lq_ty≥
))

1092 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_40MHz
;

1093 i‡(
	`is_mimo3
(
tbl
->
lq_ty≥
Ë&& (!tbl->
is_ht40
 || 
lq_°a
->
is_dup
))

1094 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo3_20MHz
;

1096 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo3_40MHz
;

1098 i‡(!
tbl
->
is_SGI
 && !
lq_°a
->
is_agg
)

1099 
tbl
->
ex≥˘ed_çt
 = 
ht_tbl_poöãr
[0];

1100 i‡(
tbl
->
is_SGI
 && !
lq_°a
->
is_agg
)

1101 
tbl
->
ex≥˘ed_çt
 = 
ht_tbl_poöãr
[1];

1102 i‡(!
tbl
->
is_SGI
 && 
lq_°a
->
is_agg
)

1103 
tbl
->
ex≥˘ed_çt
 = 
ht_tbl_poöãr
[2];

1105 
tbl
->
ex≥˘ed_çt
 = 
ht_tbl_poöãr
[3];

1106 
	}
}

1120 
s32
 
	$rs_gë_be°_øã
(
iwl_¥iv
 *
¥iv
,

1121 
iwl_lq_°a
 *
lq_°a
,

1122 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

1123 
u16
 
øã_mask
, 
s8
 
ödex
)

1126 
iwl_sˇÀ_tbl_öfo
 *
a˘ive_tbl
 =

1127 &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

1128 
s32
 
a˘ive_§
 = 
a˘ive_tbl
->
wö
[
ödex
].
suc˚ss_øtio
;

1129 
s32
 
a˘ive_çt
 = 
a˘ive_tbl
->
ex≥˘ed_çt
[
ödex
];

1131 c⁄° 
u16
 *
çt_tbl
 = 
tbl
->
ex≥˘ed_çt
;

1133 
s32
 
√w_øã
, 
high
, 
low
, 
°¨t_hi
;

1134 
u16
 
high_low
;

1135 
s8
 
øã
 = 
ödex
;

1137 
√w_øã
 = 
high
 = 
low
 = 
°¨t_hi
 = 
IWL_RATE_INVALID
;

1140 
high_low
 = 
	`rs_gë_adja˚¡_øã
(
¥iv
, 
øã
, 
øã_mask
,

1141 
tbl
->
lq_ty≥
);

1143 
low
 = 
high_low
 & 0xff;

1144 
high
 = (
high_low
 >> 8) & 0xff;

1161 i‡((((100 * 
çt_tbl
[
øã
]Ë> 
lq_°a
->
œ°_çt
) &&

1162 ((
a˘ive_§
 > 
IWL_RATE_DECREASE_TH
) &&

1163 (
a˘ive_§
 <
IWL_RATE_HIGH_TH
) &&

1164 (
çt_tbl
[
øã
] <
a˘ive_çt
))) ||

1165 ((
a˘ive_§
 >
IWL_RATE_SCALE_SWITCH
) &&

1166 (
çt_tbl
[
øã
] > 
a˘ive_çt
))) {

1171 i‡(
°¨t_hi
 !
IWL_RATE_INVALID
) {

1172 
√w_øã
 = 
°¨t_hi
;

1176 
√w_øã
 = 
øã
;

1179 i‡(
low
 !
IWL_RATE_INVALID
)

1180 
øã
 = 
low
;

1191 i‡(
√w_øã
 !
IWL_RATE_INVALID
)

1195 i‡(
high
 !
IWL_RATE_INVALID
) {

1196 
°¨t_hi
 = 
high
;

1197 
øã
 = 
high
;

1201 
√w_øã
 = 
øã
;

1207  
√w_øã
;

1208 
	}
}

1213 
	$rs_swôch_to_mimo2
(
iwl_¥iv
 *
¥iv
,

1214 
iwl_lq_°a
 *
lq_°a
,

1215 
õì80211_c⁄f
 *
c⁄f
,

1216 
õì80211_°a
 *
°a
,

1217 
iwl_sˇÀ_tbl_öfo
 *
tbl
, 
ödex
)

1219 
u16
 
øã_mask
;

1220 
s32
 
øã
;

1221 
s8
 
is_gªí
 = 
lq_°a
->is_green;

1222 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

1223 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
°a_¥iv
->ctx;

1225 i‡(!
	`c⁄f_is_ht
(
c⁄f
Ë|| !
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
)

1228 i‡(
°a
->
deÊök
.
smps_mode
 =
IEEE80211_SMPS_STATIC
)

1232 i‡(
¥iv
->
hw_∑øms
.
tx_chaös_num
 < 2)

1235 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ:ÅryÅo switchÅo MIMO2\n");

1237 
tbl
->
lq_ty≥
 = 
LQ_MIMO2
;

1238 
tbl
->
is_dup
 = 
lq_°a
->is_dup;

1239 
tbl
->
a˘i⁄
 = 0;

1240 
tbl
->
max_£¨ch
 = 
IWL_MAX_SEARCH
;

1241 
øã_mask
 = 
lq_°a
->
a˘ive_mimo2_øã
;

1243 i‡(
	`iwl_is_ht40_tx_Ælowed
(
¥iv
, 
˘x
, 
°a
))

1244 
tbl
->
is_ht40
 = 1;

1246 
tbl
->
is_ht40
 = 0;

1248 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

1250 
øã
 = 
	`rs_gë_be°_øã
(
¥iv
, 
lq_°a
, 
tbl
, 
øã_mask
, 
ödex
);

1252 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO2 be°Ñ©ê%d mask %X\n", 
øã
, 
øã_mask
);

1253 i‡((
øã
 =
IWL_RATE_INVALID
Ë|| !((1 <<Ñ©eË& 
øã_mask
)) {

1254 
	`IWL_DEBUG_RATE
(
¥iv
, "Can't switch with index %dÑate mask %x\n",

1255 
øã
, 
øã_mask
);

1258 
tbl
->
cuºít_øã
 = 
	`øã_n_Êags_‰om_tbl
(
¥iv
,Åbl, 
øã
, 
is_gªí
);

1260 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SwitchÅoÇew mcs %X index is green %X\n",

1261 
tbl
->
cuºít_øã
, 
is_gªí
);

1263 
	}
}

1268 
	$rs_swôch_to_mimo3
(
iwl_¥iv
 *
¥iv
,

1269 
iwl_lq_°a
 *
lq_°a
,

1270 
õì80211_c⁄f
 *
c⁄f
,

1271 
õì80211_°a
 *
°a
,

1272 
iwl_sˇÀ_tbl_öfo
 *
tbl
, 
ödex
)

1274 
u16
 
øã_mask
;

1275 
s32
 
øã
;

1276 
s8
 
is_gªí
 = 
lq_°a
->is_green;

1277 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

1278 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
°a_¥iv
->ctx;

1280 i‡(!
	`c⁄f_is_ht
(
c⁄f
Ë|| !
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
)

1283 i‡(
°a
->
deÊök
.
smps_mode
 =
IEEE80211_SMPS_STATIC
)

1287 i‡(
¥iv
->
hw_∑øms
.
tx_chaös_num
 < 3)

1290 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ:ÅryÅo switchÅo MIMO3\n");

1292 
tbl
->
lq_ty≥
 = 
LQ_MIMO3
;

1293 
tbl
->
is_dup
 = 
lq_°a
->is_dup;

1294 
tbl
->
a˘i⁄
 = 0;

1295 
tbl
->
max_£¨ch
 = 
IWL_MAX_11N_MIMO3_SEARCH
;

1296 
øã_mask
 = 
lq_°a
->
a˘ive_mimo3_øã
;

1298 i‡(
	`iwl_is_ht40_tx_Ælowed
(
¥iv
, 
˘x
, 
°a
))

1299 
tbl
->
is_ht40
 = 1;

1301 
tbl
->
is_ht40
 = 0;

1303 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

1305 
øã
 = 
	`rs_gë_be°_øã
(
¥iv
, 
lq_°a
, 
tbl
, 
øã_mask
, 
ödex
);

1307 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO3 bestÑate %d mask %X\n",

1308 
øã
, 
øã_mask
);

1309 i‡((
øã
 =
IWL_RATE_INVALID
Ë|| !((1 <<Ñ©eË& 
øã_mask
)) {

1310 
	`IWL_DEBUG_RATE
(
¥iv
, "Can't switch with index %dÑate mask %x\n",

1311 
øã
, 
øã_mask
);

1314 
tbl
->
cuºít_øã
 = 
	`øã_n_Êags_‰om_tbl
(
¥iv
,Åbl, 
øã
, 
is_gªí
);

1316 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SwitchÅoÇew mcs %X index is green %X\n",

1317 
tbl
->
cuºít_øã
, 
is_gªí
);

1319 
	}
}

1324 
	$rs_swôch_to_siso
(
iwl_¥iv
 *
¥iv
,

1325 
iwl_lq_°a
 *
lq_°a
,

1326 
õì80211_c⁄f
 *
c⁄f
,

1327 
õì80211_°a
 *
°a
,

1328 
iwl_sˇÀ_tbl_öfo
 *
tbl
, 
ödex
)

1330 
u16
 
øã_mask
;

1331 
u8
 
is_gªí
 = 
lq_°a
->is_green;

1332 
s32
 
øã
;

1333 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

1334 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
°a_¥iv
->ctx;

1336 i‡(!
	`c⁄f_is_ht
(
c⁄f
Ë|| !
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
)

1339 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ:ÅryÅo switchÅo SISO\n");

1341 
tbl
->
is_dup
 = 
lq_°a
->is_dup;

1342 
tbl
->
lq_ty≥
 = 
LQ_SISO
;

1343 
tbl
->
a˘i⁄
 = 0;

1344 
tbl
->
max_£¨ch
 = 
IWL_MAX_SEARCH
;

1345 
øã_mask
 = 
lq_°a
->
a˘ive_siso_øã
;

1347 i‡(
	`iwl_is_ht40_tx_Ælowed
(
¥iv
, 
˘x
, 
°a
))

1348 
tbl
->
is_ht40
 = 1;

1350 
tbl
->
is_ht40
 = 0;

1352 i‡(
is_gªí
)

1353 
tbl
->
is_SGI
 = 0;

1355 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

1356 
øã
 = 
	`rs_gë_be°_øã
(
¥iv
, 
lq_°a
, 
tbl
, 
øã_mask
, 
ödex
);

1358 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: gë be°Ñ©ê%d mask %X\n", 
øã
, 
øã_mask
);

1359 i‡((
øã
 =
IWL_RATE_INVALID
Ë|| !((1 <<Ñ©eË& 
øã_mask
)) {

1360 
	`IWL_DEBUG_RATE
(
¥iv
, "canÇot switch with index %dÑate mask %x\n",

1361 
øã
, 
øã_mask
);

1364 
tbl
->
cuºít_øã
 = 
	`øã_n_Êags_‰om_tbl
(
¥iv
,Åbl, 
øã
, 
is_gªí
);

1365 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SwitchÅoÇew mcs %X index is green %X\n",

1366 
tbl
->
cuºít_øã
, 
is_gªí
);

1368 
	}
}

1373 
	$rs_move_Àgacy_Ÿhî
(
iwl_¥iv
 *
¥iv
,

1374 
iwl_lq_°a
 *
lq_°a
,

1375 
õì80211_c⁄f
 *
c⁄f
,

1376 
õì80211_°a
 *
°a
,

1377 
ödex
)

1379 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

1380 
iwl_sˇÀ_tbl_öfo
 *
£¨ch_tbl
 =

1381 &(
lq_°a
->
lq_öfo
[(1 -Üq_°a->
a˘ive_tbl
)]);

1382 
iwl_øã_sˇÀ_d©a
 *
wödow
 = &(
tbl
->
wö
[
ödex
]);

1383 
u32
 
sz
 = ((
iwl_sˇÀ_tbl_öfo
) -

1384 ((
iwl_øã_sˇÀ_d©a
Ë* 
IWL_RATE_COUNT
));

1385 
u8
 
°¨t_a˘i⁄
;

1386 
u8
 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

1387 
u8
 
tx_chaös_num
 = 
¥iv
->
hw_∑øms
.tx_chains_num;

1388 
ªt
 = 0;

1389 
u8
 
upd©e_£¨ch_tbl_cou¡î
 = 0;

1391 
¥iv
->
bt_åaffic_lﬂd
) {

1392 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
:

1395 
IWL_BT_COEX_TRAFFIC_LOAD_LOW
:

1397 i‡(
tbl
->
a˘i⁄
 =
IWL_LEGACY_SWITCH_ANTENNA2
)

1398 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_SISO
;

1400 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
:

1401 
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
:

1403 
vÆid_tx_™t
 =

1404 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

1405 i‡(
tbl
->
a˘i⁄
 >
IWL_LEGACY_SWITCH_ANTENNA2
 &&

1406 
tbl
->
a˘i⁄
 !
IWL_LEGACY_SWITCH_SISO
)

1407 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_SISO
;

1410 
	`IWL_ERR
(
¥iv
, "InvÆid BTÜﬂd %d\n",Öriv->
bt_åaffic_lﬂd
);

1414 i‡(!
	`iwl_ht_íabÀd
(
¥iv
))

1416 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_ANTENNA1
;

1417 i‡(
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë=
IWL_ANT_OK_SINGLE
 &&

1418 
tbl
->
a˘i⁄
 > 
IWL_LEGACY_SWITCH_SISO
)

1419 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_SISO
;

1422 i‡(
¥iv
->
bt_fuŒ_c⁄cuºít
) {

1423 i‡(!
	`iwl_ht_íabÀd
(
¥iv
))

1424 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_ANTENNA1
;

1425 i‡(
tbl
->
a˘i⁄
 >
IWL_LEGACY_SWITCH_ANTENNA2
)

1426 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_SISO
;

1427 
vÆid_tx_™t
 =

1428 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

1431 
°¨t_a˘i⁄
 = 
tbl
->
a˘i⁄
;

1433 
lq_°a
->
a˘i⁄_cou¡î
++;

1434 
tbl
->
a˘i⁄
) {

1435 
IWL_LEGACY_SWITCH_ANTENNA1
:

1436 
IWL_LEGACY_SWITCH_ANTENNA2
:

1437 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: LegacyÅoggle Antenna\n");

1439 i‡((
tbl
->
a˘i⁄
 =
IWL_LEGACY_SWITCH_ANTENNA1
 &&

1440 
tx_chaös_num
 <= 1) ||

1441 (
tbl
->
a˘i⁄
 =
IWL_LEGACY_SWITCH_ANTENNA2
 &&

1442 
tx_chaös_num
 <= 2))

1446 i‡(
wödow
->
suc˚ss_øtio
 >
IWL_RS_GOOD_RATIO
 &&

1447 !
¥iv
->
bt_fuŒ_c⁄cuºít
 &&

1448 
¥iv
->
bt_åaffic_lﬂd
 ==

1449 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
)

1453 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1455 i‡(
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
,

1456 &
£¨ch_tbl
->
cuºít_øã
, search_tbl)) {

1457 
upd©e_£¨ch_tbl_cou¡î
 = 1;

1458 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
£¨ch_tbl
);

1459 
out
;

1462 
IWL_LEGACY_SWITCH_SISO
:

1463 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: Legacy switchÅo SISO\n");

1466 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1467 
£¨ch_tbl
->
is_SGI
 = 0;

1468 
ªt
 = 
	`rs_swôch_to_siso
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1469 
£¨ch_tbl
, 
ödex
);

1470 i‡(!
ªt
) {

1471 
lq_°a
->
a˘i⁄_cou¡î
 = 0;

1472 
out
;

1476 
IWL_LEGACY_SWITCH_MIMO2_AB
:

1477 
IWL_LEGACY_SWITCH_MIMO2_AC
:

1478 
IWL_LEGACY_SWITCH_MIMO2_BC
:

1479 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: Legacy switchÅo MIMO2\n");

1482 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1483 
£¨ch_tbl
->
is_SGI
 = 0;

1485 i‡(
tbl
->
a˘i⁄
 =
IWL_LEGACY_SWITCH_MIMO2_AB
)

1486 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_AB
;

1487 i‡(
tbl
->
a˘i⁄
 =
IWL_LEGACY_SWITCH_MIMO2_AC
)

1488 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_AC
;

1490 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_BC
;

1492 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1495 
ªt
 = 
	`rs_swôch_to_mimo2
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1496 
£¨ch_tbl
, 
ödex
);

1497 i‡(!
ªt
) {

1498 
lq_°a
->
a˘i⁄_cou¡î
 = 0;

1499 
out
;

1503 
IWL_LEGACY_SWITCH_MIMO3_ABC
:

1504 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: Legacy switchÅo MIMO3\n");

1507 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1508 
£¨ch_tbl
->
is_SGI
 = 0;

1510 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_ABC
;

1512 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1515 
ªt
 = 
	`rs_swôch_to_mimo3
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1516 
£¨ch_tbl
, 
ödex
);

1517 i‡(!
ªt
) {

1518 
lq_°a
->
a˘i⁄_cou¡î
 = 0;

1519 
out
;

1523 
tbl
->
a˘i⁄
++;

1524 i‡(
tbl
->
a˘i⁄
 > 
IWL_LEGACY_SWITCH_MIMO3_ABC
)

1525 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_ANTENNA1
;

1527 i‡(
tbl
->
a˘i⁄
 =
°¨t_a˘i⁄
)

1531 
£¨ch_tbl
->
lq_ty≥
 = 
LQ_NONE
;

1534 
out
:

1535 
lq_°a
->
£¨ch_bëãr_tbl
 = 1;

1536 
tbl
->
a˘i⁄
++;

1537 i‡(
tbl
->
a˘i⁄
 > 
IWL_LEGACY_SWITCH_MIMO3_ABC
)

1538 
tbl
->
a˘i⁄
 = 
IWL_LEGACY_SWITCH_ANTENNA1
;

1539 i‡(
upd©e_£¨ch_tbl_cou¡î
)

1540 
£¨ch_tbl
->
a˘i⁄
 = 
tbl
->action;

1541 
	}
}

1546 
	$rs_move_siso_to_Ÿhî
(
iwl_¥iv
 *
¥iv
,

1547 
iwl_lq_°a
 *
lq_°a
,

1548 
õì80211_c⁄f
 *
c⁄f
,

1549 
õì80211_°a
 *
°a
, 
ödex
)

1551 
u8
 
is_gªí
 = 
lq_°a
->is_green;

1552 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

1553 
iwl_sˇÀ_tbl_öfo
 *
£¨ch_tbl
 =

1554 &(
lq_°a
->
lq_öfo
[(1 -Üq_°a->
a˘ive_tbl
)]);

1555 
iwl_øã_sˇÀ_d©a
 *
wödow
 = &(
tbl
->
wö
[
ödex
]);

1556 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

1557 
u32
 
sz
 = ((
iwl_sˇÀ_tbl_öfo
) -

1558 ((
iwl_øã_sˇÀ_d©a
Ë* 
IWL_RATE_COUNT
));

1559 
u8
 
°¨t_a˘i⁄
;

1560 
u8
 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

1561 
u8
 
tx_chaös_num
 = 
¥iv
->
hw_∑øms
.tx_chains_num;

1562 
u8
 
upd©e_£¨ch_tbl_cou¡î
 = 0;

1563 
ªt
;

1565 
¥iv
->
bt_åaffic_lﬂd
) {

1566 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
:

1569 
IWL_BT_COEX_TRAFFIC_LOAD_LOW
:

1571 i‡(
tbl
->
a˘i⁄
 =
IWL_SISO_SWITCH_ANTENNA2
)

1572 
tbl
->
a˘i⁄
 = 
IWL_SISO_SWITCH_MIMO2_AB
;

1574 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
:

1575 
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
:

1577 
vÆid_tx_™t
 =

1578 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

1579 i‡(
tbl
->
a˘i⁄
 !
IWL_SISO_SWITCH_ANTENNA1
)

1580 
tbl
->
a˘i⁄
 = 
IWL_SISO_SWITCH_ANTENNA1
;

1583 
	`IWL_ERR
(
¥iv
, "InvÆid BTÜﬂd %d\n",Öriv->
bt_åaffic_lﬂd
);

1587 i‡(
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë=
IWL_ANT_OK_SINGLE
 &&

1588 
tbl
->
a˘i⁄
 > 
IWL_SISO_SWITCH_ANTENNA2
) {

1590 
tbl
->
a˘i⁄
 = 
IWL_SISO_SWITCH_ANTENNA1
;

1594 i‡(
¥iv
->
bt_fuŒ_c⁄cuºít
) {

1595 
vÆid_tx_™t
 =

1596 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

1597 i‡(
tbl
->
a˘i⁄
 >
IWL_LEGACY_SWITCH_ANTENNA2
)

1598 
tbl
->
a˘i⁄
 = 
IWL_SISO_SWITCH_ANTENNA1
;

1601 
°¨t_a˘i⁄
 = 
tbl
->
a˘i⁄
;

1603 
lq_°a
->
a˘i⁄_cou¡î
++;

1604 
tbl
->
a˘i⁄
) {

1605 
IWL_SISO_SWITCH_ANTENNA1
:

1606 
IWL_SISO_SWITCH_ANTENNA2
:

1607 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SISOÅoggle Antenna\n");

1608 i‡((
tbl
->
a˘i⁄
 =
IWL_SISO_SWITCH_ANTENNA1
 &&

1609 
tx_chaös_num
 <= 1) ||

1610 (
tbl
->
a˘i⁄
 =
IWL_SISO_SWITCH_ANTENNA2
 &&

1611 
tx_chaös_num
 <= 2))

1614 i‡(
wödow
->
suc˚ss_øtio
 >
IWL_RS_GOOD_RATIO
 &&

1615 !
¥iv
->
bt_fuŒ_c⁄cuºít
 &&

1616 
¥iv
->
bt_åaffic_lﬂd
 ==

1617 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
)

1620 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1621 i‡(
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
,

1622 &
£¨ch_tbl
->
cuºít_øã
, search_tbl)) {

1623 
upd©e_£¨ch_tbl_cou¡î
 = 1;

1624 
out
;

1627 
IWL_SISO_SWITCH_MIMO2_AB
:

1628 
IWL_SISO_SWITCH_MIMO2_AC
:

1629 
IWL_SISO_SWITCH_MIMO2_BC
:

1630 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SISO switchÅo MIMO2\n");

1631 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1632 
£¨ch_tbl
->
is_SGI
 = 0;

1634 i‡(
tbl
->
a˘i⁄
 =
IWL_SISO_SWITCH_MIMO2_AB
)

1635 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_AB
;

1636 i‡(
tbl
->
a˘i⁄
 =
IWL_SISO_SWITCH_MIMO2_AC
)

1637 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_AC
;

1639 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_BC
;

1641 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1644 
ªt
 = 
	`rs_swôch_to_mimo2
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1645 
£¨ch_tbl
, 
ödex
);

1646 i‡(!
ªt
)

1647 
out
;

1649 
IWL_SISO_SWITCH_GI
:

1650 i‡(!
tbl
->
is_ht40
 && !(
ht_ˇp
->
ˇp
 &

1651 
IEEE80211_HT_CAP_SGI_20
))

1653 i‡(
tbl
->
is_ht40
 && !(
ht_ˇp
->
ˇp
 &

1654 
IEEE80211_HT_CAP_SGI_40
))

1657 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SISOÅoggle SGI/NGI\n");

1659 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1660 i‡(
is_gªí
) {

1661 i‡(!
tbl
->
is_SGI
)

1664 
	`IWL_ERR
(
¥iv
,

1667 
£¨ch_tbl
->
is_SGI
 = !
tbl
->is_SGI;

1668 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
£¨ch_tbl
);

1669 i‡(
tbl
->
is_SGI
) {

1670 
s32
 
çt
 = 
lq_°a
->
œ°_çt
 / 100;

1671 i‡(
çt
 >
£¨ch_tbl
->
ex≥˘ed_çt
[
ödex
])

1674 
£¨ch_tbl
->
cuºít_øã
 =

1675 
	`øã_n_Êags_‰om_tbl
(
¥iv
, 
£¨ch_tbl
,

1676 
ödex
, 
is_gªí
);

1677 
upd©e_£¨ch_tbl_cou¡î
 = 1;

1678 
out
;

1679 
IWL_SISO_SWITCH_MIMO3_ABC
:

1680 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SISO switchÅo MIMO3\n");

1681 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1682 
£¨ch_tbl
->
is_SGI
 = 0;

1683 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_ABC
;

1685 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1688 
ªt
 = 
	`rs_swôch_to_mimo3
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1689 
£¨ch_tbl
, 
ödex
);

1690 i‡(!
ªt
)

1691 
out
;

1694 
tbl
->
a˘i⁄
++;

1695 i‡(
tbl
->
a˘i⁄
 > 
IWL_LEGACY_SWITCH_MIMO3_ABC
)

1696 
tbl
->
a˘i⁄
 = 
IWL_SISO_SWITCH_ANTENNA1
;

1698 i‡(
tbl
->
a˘i⁄
 =
°¨t_a˘i⁄
)

1701 
£¨ch_tbl
->
lq_ty≥
 = 
LQ_NONE
;

1704 
out
:

1705 
lq_°a
->
£¨ch_bëãr_tbl
 = 1;

1706 
tbl
->
a˘i⁄
++;

1707 i‡(
tbl
->
a˘i⁄
 > 
IWL_SISO_SWITCH_MIMO3_ABC
)

1708 
tbl
->
a˘i⁄
 = 
IWL_SISO_SWITCH_ANTENNA1
;

1709 i‡(
upd©e_£¨ch_tbl_cou¡î
)

1710 
£¨ch_tbl
->
a˘i⁄
 = 
tbl
->action;

1711 
	}
}

1716 
	$rs_move_mimo2_to_Ÿhî
(
iwl_¥iv
 *
¥iv
,

1717 
iwl_lq_°a
 *
lq_°a
,

1718 
õì80211_c⁄f
 *
c⁄f
,

1719 
õì80211_°a
 *
°a
, 
ödex
)

1721 
s8
 
is_gªí
 = 
lq_°a
->is_green;

1722 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

1723 
iwl_sˇÀ_tbl_öfo
 *
£¨ch_tbl
 =

1724 &(
lq_°a
->
lq_öfo
[(1 -Üq_°a->
a˘ive_tbl
)]);

1725 
iwl_øã_sˇÀ_d©a
 *
wödow
 = &(
tbl
->
wö
[
ödex
]);

1726 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

1727 
u32
 
sz
 = ((
iwl_sˇÀ_tbl_öfo
) -

1728 ((
iwl_øã_sˇÀ_d©a
Ë* 
IWL_RATE_COUNT
));

1729 
u8
 
°¨t_a˘i⁄
;

1730 
u8
 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

1731 
u8
 
tx_chaös_num
 = 
¥iv
->
hw_∑øms
.tx_chains_num;

1732 
u8
 
upd©e_£¨ch_tbl_cou¡î
 = 0;

1733 
ªt
;

1735 
¥iv
->
bt_åaffic_lﬂd
) {

1736 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
:

1739 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
:

1740 
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
:

1742 i‡(
tbl
->
a˘i⁄
 !
IWL_MIMO2_SWITCH_SISO_A
)

1743 
tbl
->
a˘i⁄
 = 
IWL_MIMO2_SWITCH_SISO_A
;

1745 
IWL_BT_COEX_TRAFFIC_LOAD_LOW
:

1747 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO2_SWITCH_SISO_B
 ||

1748 
tbl
->
a˘i⁄
 =
IWL_MIMO2_SWITCH_SISO_C
)

1749 
tbl
->
a˘i⁄
 = 
IWL_MIMO2_SWITCH_SISO_A
;

1752 
	`IWL_ERR
(
¥iv
, "InvÆid BTÜﬂd %d\n",Öriv->
bt_åaffic_lﬂd
);

1756 i‡((
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë=
IWL_ANT_OK_SINGLE
) &&

1757 (
tbl
->
a˘i⁄
 < 
IWL_MIMO2_SWITCH_SISO_A
 ||

1758 
tbl
->
a˘i⁄
 > 
IWL_MIMO2_SWITCH_SISO_C
)) {

1760 
tbl
->
a˘i⁄
 = 
IWL_MIMO2_SWITCH_SISO_A
;

1764 i‡(
¥iv
->
bt_fuŒ_c⁄cuºít
 &&

1765 (
tbl
->
a˘i⁄
 < 
IWL_MIMO2_SWITCH_SISO_A
 ||

1766 
tbl
->
a˘i⁄
 > 
IWL_MIMO2_SWITCH_SISO_C
))

1767 
tbl
->
a˘i⁄
 = 
IWL_MIMO2_SWITCH_SISO_A
;

1769 
°¨t_a˘i⁄
 = 
tbl
->
a˘i⁄
;

1771 
lq_°a
->
a˘i⁄_cou¡î
++;

1772 
tbl
->
a˘i⁄
) {

1773 
IWL_MIMO2_SWITCH_ANTENNA1
:

1774 
IWL_MIMO2_SWITCH_ANTENNA2
:

1775 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO2Åoggle Antennas\n");

1777 i‡(
tx_chaös_num
 <= 2)

1780 i‡(
wödow
->
suc˚ss_øtio
 >
IWL_RS_GOOD_RATIO
)

1783 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1784 i‡(
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
,

1785 &
£¨ch_tbl
->
cuºít_øã
, search_tbl)) {

1786 
upd©e_£¨ch_tbl_cou¡î
 = 1;

1787 
out
;

1790 
IWL_MIMO2_SWITCH_SISO_A
:

1791 
IWL_MIMO2_SWITCH_SISO_B
:

1792 
IWL_MIMO2_SWITCH_SISO_C
:

1793 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO2 switchÅo SISO\n");

1796 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1798 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO2_SWITCH_SISO_A
)

1799 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_A
;

1800 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO2_SWITCH_SISO_B
)

1801 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_B
;

1803 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_C
;

1805 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1808 
ªt
 = 
	`rs_swôch_to_siso
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1809 
£¨ch_tbl
, 
ödex
);

1810 i‡(!
ªt
)

1811 
out
;

1815 
IWL_MIMO2_SWITCH_GI
:

1816 i‡(!
tbl
->
is_ht40
 && !(
ht_ˇp
->
ˇp
 &

1817 
IEEE80211_HT_CAP_SGI_20
))

1819 i‡(
tbl
->
is_ht40
 && !(
ht_ˇp
->
ˇp
 &

1820 
IEEE80211_HT_CAP_SGI_40
))

1823 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO2Åoggle SGI/NGI\n");

1826 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1827 
£¨ch_tbl
->
is_SGI
 = !
tbl
->is_SGI;

1828 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
£¨ch_tbl
);

1835 i‡(
tbl
->
is_SGI
) {

1836 
s32
 
çt
 = 
lq_°a
->
œ°_çt
 / 100;

1837 i‡(
çt
 >
£¨ch_tbl
->
ex≥˘ed_çt
[
ödex
])

1840 
£¨ch_tbl
->
cuºít_øã
 =

1841 
	`øã_n_Êags_‰om_tbl
(
¥iv
, 
£¨ch_tbl
,

1842 
ödex
, 
is_gªí
);

1843 
upd©e_£¨ch_tbl_cou¡î
 = 1;

1844 
out
;

1846 
IWL_MIMO2_SWITCH_MIMO3_ABC
:

1847 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO2 switchÅo MIMO3\n");

1848 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1849 
£¨ch_tbl
->
is_SGI
 = 0;

1850 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_ABC
;

1852 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1855 
ªt
 = 
	`rs_swôch_to_mimo3
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1856 
£¨ch_tbl
, 
ödex
);

1857 i‡(!
ªt
)

1858 
out
;

1862 
tbl
->
a˘i⁄
++;

1863 i‡(
tbl
->
a˘i⁄
 > 
IWL_MIMO2_SWITCH_MIMO3_ABC
)

1864 
tbl
->
a˘i⁄
 = 
IWL_MIMO2_SWITCH_ANTENNA1
;

1866 i‡(
tbl
->
a˘i⁄
 =
°¨t_a˘i⁄
)

1869 
£¨ch_tbl
->
lq_ty≥
 = 
LQ_NONE
;

1871 
out
:

1872 
lq_°a
->
£¨ch_bëãr_tbl
 = 1;

1873 
tbl
->
a˘i⁄
++;

1874 i‡(
tbl
->
a˘i⁄
 > 
IWL_MIMO2_SWITCH_MIMO3_ABC
)

1875 
tbl
->
a˘i⁄
 = 
IWL_MIMO2_SWITCH_ANTENNA1
;

1876 i‡(
upd©e_£¨ch_tbl_cou¡î
)

1877 
£¨ch_tbl
->
a˘i⁄
 = 
tbl
->action;

1879 
	}
}

1884 
	$rs_move_mimo3_to_Ÿhî
(
iwl_¥iv
 *
¥iv
,

1885 
iwl_lq_°a
 *
lq_°a
,

1886 
õì80211_c⁄f
 *
c⁄f
,

1887 
õì80211_°a
 *
°a
, 
ödex
)

1889 
s8
 
is_gªí
 = 
lq_°a
->is_green;

1890 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

1891 
iwl_sˇÀ_tbl_öfo
 *
£¨ch_tbl
 =

1892 &(
lq_°a
->
lq_öfo
[(1 -Üq_°a->
a˘ive_tbl
)]);

1893 
iwl_øã_sˇÀ_d©a
 *
wödow
 = &(
tbl
->
wö
[
ödex
]);

1894 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

1895 
u32
 
sz
 = ((
iwl_sˇÀ_tbl_öfo
) -

1896 ((
iwl_øã_sˇÀ_d©a
Ë* 
IWL_RATE_COUNT
));

1897 
u8
 
°¨t_a˘i⁄
;

1898 
u8
 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

1899 
u8
 
tx_chaös_num
 = 
¥iv
->
hw_∑øms
.tx_chains_num;

1900 
ªt
;

1901 
u8
 
upd©e_£¨ch_tbl_cou¡î
 = 0;

1903 
¥iv
->
bt_åaffic_lﬂd
) {

1904 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
:

1907 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
:

1908 
IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS
:

1910 i‡(
tbl
->
a˘i⁄
 !
IWL_MIMO3_SWITCH_SISO_A
)

1911 
tbl
->
a˘i⁄
 = 
IWL_MIMO3_SWITCH_SISO_A
;

1913 
IWL_BT_COEX_TRAFFIC_LOAD_LOW
:

1915 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO3_SWITCH_SISO_B
 ||

1916 
tbl
->
a˘i⁄
 =
IWL_MIMO3_SWITCH_SISO_C
)

1917 
tbl
->
a˘i⁄
 = 
IWL_MIMO3_SWITCH_SISO_A
;

1920 
	`IWL_ERR
(
¥iv
, "InvÆid BTÜﬂd %d\n",Öriv->
bt_åaffic_lﬂd
);

1924 i‡((
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë=
IWL_ANT_OK_SINGLE
) &&

1925 (
tbl
->
a˘i⁄
 < 
IWL_MIMO3_SWITCH_SISO_A
 ||

1926 
tbl
->
a˘i⁄
 > 
IWL_MIMO3_SWITCH_SISO_C
)) {

1928 
tbl
->
a˘i⁄
 = 
IWL_MIMO3_SWITCH_SISO_A
;

1932 i‡(
¥iv
->
bt_fuŒ_c⁄cuºít
 &&

1933 (
tbl
->
a˘i⁄
 < 
IWL_MIMO3_SWITCH_SISO_A
 ||

1934 
tbl
->
a˘i⁄
 > 
IWL_MIMO3_SWITCH_SISO_C
))

1935 
tbl
->
a˘i⁄
 = 
IWL_MIMO3_SWITCH_SISO_A
;

1937 
°¨t_a˘i⁄
 = 
tbl
->
a˘i⁄
;

1939 
lq_°a
->
a˘i⁄_cou¡î
++;

1940 
tbl
->
a˘i⁄
) {

1941 
IWL_MIMO3_SWITCH_ANTENNA1
:

1942 
IWL_MIMO3_SWITCH_ANTENNA2
:

1943 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO3Åoggle Antennas\n");

1945 i‡(
tx_chaös_num
 <= 3)

1948 i‡(
wödow
->
suc˚ss_øtio
 >
IWL_RS_GOOD_RATIO
)

1951 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1952 i‡(
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
,

1953 &
£¨ch_tbl
->
cuºít_øã
, search_tbl))

1954 
out
;

1956 
IWL_MIMO3_SWITCH_SISO_A
:

1957 
IWL_MIMO3_SWITCH_SISO_B
:

1958 
IWL_MIMO3_SWITCH_SISO_C
:

1959 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO3 switchÅo SISO\n");

1962 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1964 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO3_SWITCH_SISO_A
)

1965 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_A
;

1966 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO3_SWITCH_SISO_B
)

1967 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_B
;

1969 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_C
;

1971 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1974 
ªt
 = 
	`rs_swôch_to_siso
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1975 
£¨ch_tbl
, 
ödex
);

1976 i‡(!
ªt
)

1977 
out
;

1981 
IWL_MIMO3_SWITCH_MIMO2_AB
:

1982 
IWL_MIMO3_SWITCH_MIMO2_AC
:

1983 
IWL_MIMO3_SWITCH_MIMO2_BC
:

1984 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO3 switchÅo MIMO2\n");

1986 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

1987 
£¨ch_tbl
->
is_SGI
 = 0;

1988 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO3_SWITCH_MIMO2_AB
)

1989 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_AB
;

1990 i‡(
tbl
->
a˘i⁄
 =
IWL_MIMO3_SWITCH_MIMO2_AC
)

1991 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_AC
;

1993 
£¨ch_tbl
->
™t_ty≥
 = 
ANT_BC
;

1995 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
£¨ch_tbl
->
™t_ty≥
))

1998 
ªt
 = 
	`rs_swôch_to_mimo2
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
,

1999 
£¨ch_tbl
, 
ödex
);

2000 i‡(!
ªt
)

2001 
out
;

2005 
IWL_MIMO3_SWITCH_GI
:

2006 i‡(!
tbl
->
is_ht40
 && !(
ht_ˇp
->
ˇp
 &

2007 
IEEE80211_HT_CAP_SGI_20
))

2009 i‡(
tbl
->
is_ht40
 && !(
ht_ˇp
->
ˇp
 &

2010 
IEEE80211_HT_CAP_SGI_40
))

2013 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: MIMO3Åoggle SGI/NGI\n");

2016 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
sz
);

2017 
£¨ch_tbl
->
is_SGI
 = !
tbl
->is_SGI;

2018 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
£¨ch_tbl
);

2025 i‡(
tbl
->
is_SGI
) {

2026 
s32
 
çt
 = 
lq_°a
->
œ°_çt
 / 100;

2027 i‡(
çt
 >
£¨ch_tbl
->
ex≥˘ed_çt
[
ödex
])

2030 
£¨ch_tbl
->
cuºít_øã
 =

2031 
	`øã_n_Êags_‰om_tbl
(
¥iv
, 
£¨ch_tbl
,

2032 
ödex
, 
is_gªí
);

2033 
upd©e_£¨ch_tbl_cou¡î
 = 1;

2034 
out
;

2036 
tbl
->
a˘i⁄
++;

2037 i‡(
tbl
->
a˘i⁄
 > 
IWL_MIMO3_SWITCH_GI
)

2038 
tbl
->
a˘i⁄
 = 
IWL_MIMO3_SWITCH_ANTENNA1
;

2040 i‡(
tbl
->
a˘i⁄
 =
°¨t_a˘i⁄
)

2043 
£¨ch_tbl
->
lq_ty≥
 = 
LQ_NONE
;

2045 
out
:

2046 
lq_°a
->
£¨ch_bëãr_tbl
 = 1;

2047 
tbl
->
a˘i⁄
++;

2048 i‡(
tbl
->
a˘i⁄
 > 
IWL_MIMO3_SWITCH_GI
)

2049 
tbl
->
a˘i⁄
 = 
IWL_MIMO3_SWITCH_ANTENNA1
;

2050 i‡(
upd©e_£¨ch_tbl_cou¡î
)

2051 
£¨ch_tbl
->
a˘i⁄
 = 
tbl
->action;

2052 
	}
}

2061 
	$rs_°ay_ö_èbÀ
(
iwl_lq_°a
 *
lq_°a
, 
boﬁ
 
f‹˚_£¨ch
)

2063 
iwl_sˇÀ_tbl_öfo
 *
tbl
;

2064 
i
;

2065 
a˘ive_tbl
;

2066 
Êush_öãrvÆ_∑s£d
 = 0;

2067 
iwl_¥iv
 *
¥iv
;

2069 
¥iv
 = 
lq_°a
->
drv
;

2070 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2072 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2075 i‡(
lq_°a
->
°ay_ö_tbl
) {

2078 i‡(
lq_°a
->
Êush_timî
)

2079 
Êush_öãrvÆ_∑s£d
 =

2080 
	`time_a·î
(
jiffõs
,

2081 ()(
lq_°a
->
Êush_timî
 +

2082 
IWL_RATE_SCALE_FLUSH_INTVL
));

2092 i‡(
f‹˚_£¨ch
 ||

2093 (
lq_°a
->
tŸÆ_Áûed
 >Üq_°a->
max_Áûuª_limô
) ||

2094 (
lq_°a
->
tŸÆ_suc˚ss
 >Üq_°a->
max_suc˚ss_limô
) ||

2095 ((!
lq_°a
->
£¨ch_bëãr_tbl
Ë&& (lq_°a->
Êush_timî
)

2096 && (
Êush_öãrvÆ_∑s£d
))) {

2097 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: stay isÉxpired %d %d %d\n",

2098 
lq_°a
->
tŸÆ_Áûed
,

2099 
lq_°a
->
tŸÆ_suc˚ss
,

2100 
Êush_öãrvÆ_∑s£d
);

2103 
lq_°a
->
°ay_ö_tbl
 = 0;

2104 
lq_°a
->
tŸÆ_Áûed
 = 0;

2105 
lq_°a
->
tŸÆ_suc˚ss
 = 0;

2106 
lq_°a
->
Êush_timî
 = 0;

2115 
lq_°a
->
èbÀ_cou¡
++;

2116 i‡(
lq_°a
->
èbÀ_cou¡
 >=

2117 
lq_°a
->
èbÀ_cou¡_limô
) {

2118 
lq_°a
->
èbÀ_cou¡
 = 0;

2120 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: stay inÅable clear win\n");

2121 
i
 = 0; i < 
IWL_RATE_COUNT
; i++)

2122 
	`rs_øã_sˇÀ_˛ór_wödow
(

2123 &(
tbl
->
wö
[
i
]));

2130 i‡(!
lq_°a
->
°ay_ö_tbl
) {

2131 
i
 = 0; i < 
IWL_RATE_COUNT
; i++)

2132 
	`rs_øã_sˇÀ_˛ór_wödow
(&(
tbl
->
wö
[
i
]));

2135 
	}
}

2140 
	$rs_upd©e_øã_tbl
(
iwl_¥iv
 *
¥iv
,

2141 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

2142 
iwl_lq_°a
 *
lq_°a
,

2143 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

2144 
ödex
, 
u8
 
is_gªí
)

2146 
u32
 
øã
;

2149 
øã
 = 
	`øã_n_Êags_‰om_tbl
(
¥iv
, 
tbl
, 
ödex
, 
is_gªí
);

2150 
	`rs_fûl_lök_cmd
(
¥iv
, 
lq_°a
, 
øã
);

2151 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, &
lq_°a
->
lq
, 
CMD_ASYNC
, 
Ál£
);

2152 
	}
}

2157 
	$rs_øã_sˇÀ_≥rf‹m
(
iwl_¥iv
 *
¥iv
,

2158 
sk_buff
 *
skb
,

2159 
õì80211_°a
 *
°a
,

2160 
iwl_lq_°a
 *
lq_°a
)

2162 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

2163 
õì80211_c⁄f
 *
c⁄f
 = &
hw
->conf;

2164 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2165 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

2166 
low
 = 
IWL_RATE_INVALID
;

2167 
high
 = 
IWL_RATE_INVALID
;

2168 
ödex
;

2169 
i
;

2170 
iwl_øã_sˇÀ_d©a
 *
wödow
 = 
NULL
;

2171 
cuºít_çt
 = 
IWL_INVALID_VALUE
;

2172 
low_çt
 = 
IWL_INVALID_VALUE
;

2173 
high_çt
 = 
IWL_INVALID_VALUE
;

2174 
u32
 
Áû_cou¡
;

2175 
s8
 
sˇÀ_a˘i⁄
 = 0;

2176 
u16
 
øã_mask
;

2177 
u8
 
upd©e_lq
 = 0;

2178 
iwl_sˇÀ_tbl_öfo
 *
tbl
, *
tbl1
;

2179 
u16
 
øã_sˇÀ_ödex_msk
 = 0;

2180 
u8
 
is_gªí
 = 0;

2181 
u8
 
a˘ive_tbl
 = 0;

2182 
u8
 
d⁄e_£¨ch
 = 0;

2183 
u16
 
high_low
;

2184 
s32
 
§
;

2185 
u8
 
tid
 = 
IWL_MAX_TID_COUNT
;

2186 
iwl_tid_d©a
 *
tid_d©a
;

2187 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

2188 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
°a_¥iv
->ctx;

2190 
	`IWL_DEBUG_RATE
(
¥iv
, "rate scale calculateÇewÑate for skb\n");

2194 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) ||

2195 
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
)

2198 
lq_°a
->
suµ_øãs
 = 
°a
->
deÊök
.suµ_øãs[lq_°a->
b™d
];

2200 
tid
 = 
	`rs_é_add_∑ckë
(
lq_°a
, 
hdr
);

2201 i‡((
tid
 !
IWL_MAX_TID_COUNT
) &&

2202 (
lq_°a
->
tx_agg_tid_í
 & (1 << 
tid
))) {

2203 
tid_d©a
 = &
¥iv
->tid_d©a[
lq_°a
->
lq
.
°a_id
][
tid
];

2204 i‡(
tid_d©a
->
agg
.
°©e
 =
IWL_AGG_OFF
)

2205 
lq_°a
->
is_agg
 = 0;

2207 
lq_°a
->
is_agg
 = 1;

2209 
lq_°a
->
is_agg
 = 0;

2216 i‡(!
lq_°a
->
£¨ch_bëãr_tbl
)

2217 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2219 
a˘ive_tbl
 = 1 - 
lq_°a
->active_tbl;

2221 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2222 i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
))

2223 
lq_°a
->
is_gªí
 = 0;

2225 
lq_°a
->
is_gªí
 = 
	`rs_u£_gªí
(
°a
);

2226 
is_gªí
 = 
lq_°a
->is_green;

2229 
ödex
 = 
lq_°a
->
œ°_txøã_idx
;

2231 
	`IWL_DEBUG_RATE
(
¥iv
, "R©êsˇÀ index %d f‹Åy≥ %d\n", 
ödex
,

2232 
tbl
->
lq_ty≥
);

2235 
øã_mask
 = 
	`rs_gë_suµ‹ãd_øãs
(
lq_°a
, 
hdr
, 
tbl
->
lq_ty≥
);

2237 
	`IWL_DEBUG_RATE
(
¥iv
, "mask 0x%04X\n", 
øã_mask
);

2240 i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
)) {

2241 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
)

2243 
øã_sˇÀ_ödex_msk
 = (
u16
Ë(
øã_mask
 &

2244 (
lq_°a
->
suµ_øãs
 << 
IWL_FIRST_OFDM_RATE
));

2246 
øã_sˇÀ_ödex_msk
 = (
u16
Ë(
øã_mask
 &

2247 
lq_°a
->
suµ_øãs
);

2250 
øã_sˇÀ_ödex_msk
 = 
øã_mask
;

2252 i‡(!
øã_sˇÀ_ödex_msk
)

2253 
øã_sˇÀ_ödex_msk
 = 
øã_mask
;

2255 i‡(!((1 << 
ödex
Ë& 
øã_sˇÀ_ödex_msk
)) {

2256 
	`IWL_ERR
(
¥iv
, "Current Rate isÇot valid\n");

2257 i‡(
lq_°a
->
£¨ch_bëãr_tbl
) {

2259 
tbl
->
lq_ty≥
 = 
LQ_NONE
;

2260 
lq_°a
->
£¨ch_bëãr_tbl
 = 0;

2261 
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

2263 
ödex
 = 
	`iwl_hwøã_to_∂˝_idx
(
tbl
->
cuºít_øã
);

2264 
	`rs_upd©e_øã_tbl
(
¥iv
, 
˘x
, 
lq_°a
, 
tbl
,

2265 
ödex
, 
is_gªí
);

2271 i‡(!
tbl
->
ex≥˘ed_çt
) {

2272 
	`IWL_ERR
(
¥iv
, "tbl->expected_tpt is NULL\n");

2277 i‡((
lq_°a
->
max_øã_idx
 != -1) &&

2278 (
lq_°a
->
max_øã_idx
 < 
ödex
)) {

2279 
ödex
 = 
lq_°a
->
max_øã_idx
;

2280 
upd©e_lq
 = 1;

2281 
wödow
 = &(
tbl
->
wö
[
ödex
]);

2282 
lq_upd©e
;

2285 
wödow
 = &(
tbl
->
wö
[
ödex
]);

2294 
Áû_cou¡
 = 
wödow
->
cou¡î
 - wödow->
suc˚ss_cou¡î
;

2295 i‡((
Áû_cou¡
 < 
IWL_RATE_MIN_FAILURE_TH
) &&

2296 (
wödow
->
suc˚ss_cou¡î
 < 
IWL_RATE_MIN_SUCCESS_TH
)) {

2297 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: still below TH. succ=%dÅotal=%d "

2299 
wödow
->
suc˚ss_cou¡î
, wödow->
cou¡î
, 
ödex
);

2302 
wödow
->
avîage_çt
 = 
IWL_INVALID_VALUE
;

2306 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
Ál£
);

2308 
out
;

2312 i‡(
wödow
->
avîage_çt
 !((wödow->
suc˚ss_øtio
 *

2313 
tbl
->
ex≥˘ed_çt
[
ödex
] + 64) / 128)) {

2314 
	`IWL_ERR
(
¥iv
, "expected_tpt should have been calculated byÇow\n");

2315 
wödow
->
avîage_çt
 = ((wödow->
suc˚ss_øtio
 *

2316 
tbl
->
ex≥˘ed_çt
[
ödex
] + 64) / 128);

2320 i‡(
lq_°a
->
£¨ch_bëãr_tbl
 &&

2321 (
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë=
IWL_ANT_OK_MULTI
)) {

2325 i‡(
wödow
->
avîage_çt
 > 
lq_°a
->
œ°_çt
) {

2327 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: SWITCHING TO NEW TABLE "

2329 
wödow
->
suc˚ss_øtio
,

2330 
wödow
->
avîage_çt
,

2331 
lq_°a
->
œ°_çt
);

2333 i‡(!
	`is_Àgacy
(
tbl
->
lq_ty≥
))

2334 
lq_°a
->
íabÀ_cou¡î
 = 1;

2337 
lq_°a
->
a˘ive_tbl
 =áctive_tbl;

2338 
cuºít_çt
 = 
wödow
->
avîage_çt
;

2343 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: GOING BACK TO THE OLD TABLE "

2345 
wödow
->
suc˚ss_øtio
,

2346 
wödow
->
avîage_çt
,

2347 
lq_°a
->
œ°_çt
);

2350 
tbl
->
lq_ty≥
 = 
LQ_NONE
;

2353 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2354 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2357 
ödex
 = 
	`iwl_hwøã_to_∂˝_idx
(
tbl
->
cuºít_øã
);

2358 
cuºít_çt
 = 
lq_°a
->
œ°_çt
;

2361 
upd©e_lq
 = 1;

2366 
lq_°a
->
£¨ch_bëãr_tbl
 = 0;

2367 
d⁄e_£¨ch
 = 1;

2368 
lq_upd©e
;

2373 
high_low
 = 
	`rs_gë_adja˚¡_øã
(
¥iv
, 
ödex
, 
øã_sˇÀ_ödex_msk
,

2374 
tbl
->
lq_ty≥
);

2375 
low
 = 
high_low
 & 0xff;

2376 
high
 = (
high_low
 >> 8) & 0xff;

2379 i‡((
lq_°a
->
max_øã_idx
 != -1) &&

2380 (
lq_°a
->
max_øã_idx
 < 
high
))

2381 
high
 = 
IWL_RATE_INVALID
;

2383 
§
 = 
wödow
->
suc˚ss_øtio
;

2386 
cuºít_çt
 = 
wödow
->
avîage_çt
;

2387 i‡(
low
 !
IWL_RATE_INVALID
)

2388 
low_çt
 = 
tbl
->
wö
[
low
].
avîage_çt
;

2389 i‡(
high
 !
IWL_RATE_INVALID
)

2390 
high_çt
 = 
tbl
->
wö
[
high
].
avîage_çt
;

2392 
sˇÀ_a˘i⁄
 = 0;

2395 i‡((
§
 <
IWL_RATE_DECREASE_TH
Ë|| (
cuºít_çt
 == 0)) {

2396 
	`IWL_DEBUG_RATE
(
¥iv
, "decreaseÑate because ofÜow success_ratio\n");

2397 
sˇÀ_a˘i⁄
 = -1;

2400 } i‡((
low_çt
 =
IWL_INVALID_VALUE
) &&

2401 (
high_çt
 =
IWL_INVALID_VALUE
)) {

2403 i‡(
high
 !
IWL_RATE_INVALID
 && 
§
 >
IWL_RATE_INCREASE_TH
)

2404 
sˇÀ_a˘i⁄
 = 1;

2405 i‡(
low
 !
IWL_RATE_INVALID
)

2406 
sˇÀ_a˘i⁄
 = 0;

2411 i‡((
low_çt
 !
IWL_INVALID_VALUE
) &&

2412 (
high_çt
 !
IWL_INVALID_VALUE
) &&

2413 (
low_çt
 < 
cuºít_çt
) &&

2414 (
high_çt
 < 
cuºít_çt
))

2415 
sˇÀ_a˘i⁄
 = 0;

2421 i‡(
high_çt
 !
IWL_INVALID_VALUE
) {

2423 i‡(
high_çt
 > 
cuºít_çt
 &&

2424 
§
 >
IWL_RATE_INCREASE_TH
) {

2425 
sˇÀ_a˘i⁄
 = 1;

2427 
sˇÀ_a˘i⁄
 = 0;

2431 } i‡(
low_çt
 !
IWL_INVALID_VALUE
) {

2433 i‡(
low_çt
 > 
cuºít_çt
) {

2434 
	`IWL_DEBUG_RATE
(
¥iv
,

2436 
sˇÀ_a˘i⁄
 = -1;

2437 } i‡(
§
 >
IWL_RATE_INCREASE_TH
) {

2438 
sˇÀ_a˘i⁄
 = 1;

2445 i‡((
sˇÀ_a˘i⁄
 =-1Ë&& (
low
 !
IWL_RATE_INVALID
) &&

2446 ((
§
 > 
IWL_RATE_HIGH_TH
) ||

2447 (
cuºít_çt
 > (100 * 
tbl
->
ex≥˘ed_çt
[
low
]))))

2448 
sˇÀ_a˘i⁄
 = 0;

2449 i‡(!
	`iwl_ht_íabÀd
(
¥iv
Ë&& !
	`is_Àgacy
(
tbl
->
lq_ty≥
))

2450 
sˇÀ_a˘i⁄
 = -1;

2451 i‡(
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë!
IWL_ANT_OK_MULTI
 &&

2452 (
	`is_mimo2
(
tbl
->
lq_ty≥
Ë|| 
	`is_mimo3
(tbl->lq_type)))

2453 
sˇÀ_a˘i⁄
 = -1;

2455 i‡((
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
) &&

2456 (
	`is_mimo2
(
tbl
->
lq_ty≥
Ë|| 
	`is_mimo3
(tbl->lq_type))) {

2457 i‡(
lq_°a
->
œ°_bt_åaffic
 > 
¥iv
->
bt_åaffic_lﬂd
) {

2463 } i‡(
lq_°a
->
œ°_bt_åaffic
 <
¥iv
->
bt_åaffic_lﬂd
) {

2464 
sˇÀ_a˘i⁄
 = -1;

2467 
lq_°a
->
œ°_bt_åaffic
 = 
¥iv
->
bt_åaffic_lﬂd
;

2469 i‡((
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
) &&

2470 (
	`is_mimo2
(
tbl
->
lq_ty≥
Ë|| 
	`is_mimo3
(tbl->lq_type))) {

2472 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
åue
);

2473 
lq_upd©e
;

2476 
sˇÀ_a˘i⁄
) {

2479 i‡(
low
 !
IWL_RATE_INVALID
) {

2480 
upd©e_lq
 = 1;

2481 
ödex
 = 
low
;

2487 i‡(
high
 !
IWL_RATE_INVALID
) {

2488 
upd©e_lq
 = 1;

2489 
ödex
 = 
high
;

2499 
	`IWL_DEBUG_RATE
(
¥iv
, "chooseÑate scale index %dáction %dÜow %d "

2501 
ödex
, 
sˇÀ_a˘i⁄
, 
low
, 
high
, 
tbl
->
lq_ty≥
);

2503 
lq_upd©e
:

2505 i‡(
upd©e_lq
)

2506 
	`rs_upd©e_øã_tbl
(
¥iv
, 
˘x
, 
lq_°a
, 
tbl
, 
ödex
, 
is_gªí
);

2508 i‡(
	`iwl_tx_™t_ª°ri˘i⁄
(
¥iv
Ë=
IWL_ANT_OK_MULTI
) {

2511 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
Ál£
);

2519 i‡(!
upd©e_lq
 && !
d⁄e_£¨ch
 && !
lq_°a
->
°ay_ö_tbl
 && 
wödow
->
cou¡î
) {

2521 
lq_°a
->
œ°_çt
 = 
cuºít_çt
;

2525 i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
))

2526 
	`rs_move_Àgacy_Ÿhî
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
, 
ödex
);

2527 i‡(
	`is_siso
(
tbl
->
lq_ty≥
))

2528 
	`rs_move_siso_to_Ÿhî
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
, 
ödex
);

2529 i‡(
	`is_mimo2
(
tbl
->
lq_ty≥
))

2530 
	`rs_move_mimo2_to_Ÿhî
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
, 
ödex
);

2532 
	`rs_move_mimo3_to_Ÿhî
(
¥iv
, 
lq_°a
, 
c⁄f
, 
°a
, 
ödex
);

2535 i‡(
lq_°a
->
£¨ch_bëãr_tbl
) {

2537 
tbl
 = &(
lq_°a
->
lq_öfo
[(1 -Üq_°a->
a˘ive_tbl
)]);

2538 
i
 = 0; i < 
IWL_RATE_COUNT
; i++)

2539 
	`rs_øã_sˇÀ_˛ór_wödow
(&(
tbl
->
wö
[
i
]));

2542 
ödex
 = 
	`iwl_hwøã_to_∂˝_idx
(
tbl
->
cuºít_øã
);

2544 
	`IWL_DEBUG_RATE
(
¥iv
, "Switch current mcs: %X index: %d\n",

2545 
tbl
->
cuºít_øã
, 
ödex
);

2546 
	`rs_fûl_lök_cmd
(
¥iv
, 
lq_°a
, 
tbl
->
cuºít_øã
);

2547 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, &
lq_°a
->
lq
, 
CMD_ASYNC
, 
Ál£
);

2549 
d⁄e_£¨ch
 = 1;

2552 i‡(
d⁄e_£¨ch
 && !
lq_°a
->
°ay_ö_tbl
) {

2558 
tbl1
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

2559 i‡(
	`is_Àgacy
(
tbl1
->
lq_ty≥
Ë&& !
	`c⁄f_is_ht
(
c⁄f
) &&

2560 
lq_°a
->
a˘i⁄_cou¡î
 > 
tbl1
->
max_£¨ch
) {

2561 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: STAY inÜegacyÅable\n");

2562 
	`rs_£t_°ay_ö_èbÀ
(
¥iv
, 1, 
lq_°a
);

2568 i‡(
lq_°a
->
íabÀ_cou¡î
 &&

2569 (
lq_°a
->
a˘i⁄_cou¡î
 >
tbl1
->
max_£¨ch
) &&

2570 
	`iwl_ht_íabÀd
(
¥iv
)) {

2571 i‡((
lq_°a
->
œ°_çt
 > 
IWL_AGG_TPT_THREHOLD
) &&

2572 (
lq_°a
->
tx_agg_tid_í
 & (1 << 
tid
)) &&

2573 (
tid
 !
IWL_MAX_TID_COUNT
)) {

2574 
u8
 
°a_id
 = 
lq_°a
->
lq
.sta_id;

2575 
tid_d©a
 = &
¥iv
->tid_d©a[
°a_id
][
tid
];

2576 i‡(
tid_d©a
->
agg
.
°©e
 =
IWL_AGG_OFF
) {

2577 
	`IWL_DEBUG_RATE
(
¥iv
,

2579 
tid
);

2580 
	`rs_é_tu∫_⁄_agg
(
¥iv
, 
tid
,

2581 
lq_°a
, 
°a
);

2584 
	`rs_£t_°ay_ö_èbÀ
(
¥iv
, 0, 
lq_°a
);

2588 
out
:

2589 
tbl
->
cuºít_øã
 = 
	`øã_n_Êags_‰om_tbl
(
¥iv
,Åbl, 
ödex
, 
is_gªí
);

2590 
lq_°a
->
œ°_txøã_idx
 = 
ödex
;

2591 
	}
}

2607 
	$rs_öôülize_lq
(
iwl_¥iv
 *
¥iv
,

2608 
õì80211_°a
 *
°a
,

2609 
iwl_lq_°a
 *
lq_°a
)

2611 
iwl_sˇÀ_tbl_öfo
 *
tbl
;

2612 
øã_idx
;

2613 
i
;

2614 
u32
 
øã
;

2615 
u8
 
u£_gªí
 = 
	`rs_u£_gªí
(
°a
);

2616 
u8
 
a˘ive_tbl
 = 0;

2617 
u8
 
vÆid_tx_™t
;

2618 
iwl_°©i⁄_¥iv
 *
°a_¥iv
;

2619 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

2621 i‡(!
°a
 || !
lq_°a
)

2624 
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

2625 
˘x
 = 
°a_¥iv
->ctx;

2627 
i
 = 
lq_°a
->
œ°_txøã_idx
;

2629 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

2631 i‡(!
lq_°a
->
£¨ch_bëãr_tbl
)

2632 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2634 
a˘ive_tbl
 = 1 - 
lq_°a
->active_tbl;

2636 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2638 i‡((
i
 < 0Ë|| (ò>
IWL_RATE_COUNT
))

2639 
i
 = 0;

2641 
øã
 = 
iwl_øãs
[
i
].
∂˝
;

2642 
tbl
->
™t_ty≥
 = 
	`fú°_™ã¬a
(
vÆid_tx_™t
);

2643 
øã
 |
tbl
->
™t_ty≥
 << 
RATE_MCS_ANT_POS
;

2645 i‡(
i
 >
IWL_FIRST_CCK_RATE
 && i <
IWL_LAST_CCK_RATE
)

2646 
øã
 |
RATE_MCS_CCK_MSK
;

2648 
	`rs_gë_tbl_öfo_‰om_mcs
(
øã
, 
¥iv
->
b™d
, 
tbl
, &
øã_idx
);

2649 i‡(!
	`rs_is_vÆid_™t
(
vÆid_tx_™t
, 
tbl
->
™t_ty≥
))

2650 
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
, &
øã
, 
tbl
);

2652 
øã
 = 
	`øã_n_Êags_‰om_tbl
(
¥iv
, 
tbl
, 
øã_idx
, 
u£_gªí
);

2653 
tbl
->
cuºít_øã
 = 
øã
;

2654 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

2655 
	`rs_fûl_lök_cmd
(
NULL
, 
lq_°a
, 
øã
);

2656 
¥iv
->
°©i⁄s
[
lq_°a
->
lq
.
°a_id
].lq = &lq_sta->lq;

2657 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, &
lq_°a
->
lq
, 0, 
åue
);

2658 
	}
}

2660 
	$rs_gë_øã
(*
¥iv_r
, 
õì80211_°a
 *
°a
, *
¥iv_°a
,

2661 
õì80211_tx_øã_c⁄åﬁ
 *
txrc
)

2664 
sk_buff
 *
skb
 = 
txrc
->skb;

2665 
õì80211_suµ‹ãd_b™d
 *
sb™d
 = 
txrc
->sband;

2666 
iwl_›_mode
 *
›_mode
 
__maybe_unu£d
 =

2667 (
iwl_›_mode
 *)
¥iv_r
;

2668 
iwl_¥iv
 *
¥iv
 
__maybe_unu£d
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2669 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2670 
iwl_lq_°a
 *
lq_°a
 = 
¥iv_°a
;

2671 
øã_idx
;

2673 
	`IWL_DEBUG_RATE_LIMIT
(
¥iv
, "rate scale calculateÇewÑate for skb\n");

2676 i‡(
lq_°a
) {

2677 
lq_°a
->
max_øã_idx
 = 
	`Ês
(
txrc
->
øã_idx_mask
) - 1;

2678 i‡((
sb™d
->
b™d
 =
NL80211_BAND_5GHZ
) &&

2679 (
lq_°a
->
max_øã_idx
 != -1))

2680 
lq_°a
->
max_øã_idx
 +
IWL_FIRST_OFDM_RATE
;

2681 i‡((
lq_°a
->
max_øã_idx
 < 0) ||

2682 (
lq_°a
->
max_øã_idx
 >
IWL_RATE_COUNT
))

2683 
lq_°a
->
max_øã_idx
 = -1;

2687 i‡(
lq_°a
 && !lq_°a->
drv
) {

2688 
	`IWL_DEBUG_RATE
(
¥iv
, "Rate scalingÇot initialized yet.\n");

2689 
¥iv_°a
 = 
NULL
;

2692 
øã_idx
 = 
lq_°a
->
œ°_txøã_idx
;

2694 i‡(
lq_°a
->
œ°_øã_n_Êags
 & 
RATE_MCS_HT_MSK
) {

2695 
øã_idx
 -
IWL_FIRST_OFDM_RATE
;

2697 
øã_idx
 = (rate_idx > 0) ? (rate_idx - 1) : 0;

2698 i‡(
	`rs_exåa˘_øã
(
lq_°a
->
œ°_øã_n_Êags
) >=

2699 
IWL_RATE_MIMO3_6M_PLCP
)

2700 
øã_idx
 =Ñ©e_idx + (2 * 
MCS_INDEX_PER_STREAM
);

2701 i‡(
	`rs_exåa˘_øã
(
lq_°a
->
œ°_øã_n_Êags
) >=

2702 
IWL_RATE_MIMO2_6M_PLCP
)

2703 
øã_idx
 =Ñ©e_idx + 
MCS_INDEX_PER_STREAM
;

2704 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 = 
IEEE80211_TX_RC_MCS
;

2705 i‡(
lq_°a
->
œ°_øã_n_Êags
 & 
RATE_MCS_SGI_MSK
)

2706 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 |
IEEE80211_TX_RC_SHORT_GI
;

2707 i‡(
lq_°a
->
œ°_øã_n_Êags
 & 
RATE_MCS_DUP_MSK
)

2708 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 |
IEEE80211_TX_RC_DUP_DATA
;

2709 i‡(
lq_°a
->
œ°_øã_n_Êags
 & 
RATE_MCS_HT40_MSK
)

2710 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 |
IEEE80211_TX_RC_40_MHZ_WIDTH
;

2711 i‡(
lq_°a
->
œ°_øã_n_Êags
 & 
RATE_MCS_GF_MSK
)

2712 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 |
IEEE80211_TX_RC_GREEN_FIELD
;

2715 i‡((
øã_idx
 < 0Ë|| (øã_idx >
IWL_RATE_COUNT_LEGACY
) ||

2716 ((
sb™d
->
b™d
 =
NL80211_BAND_5GHZ
) &&

2717 (
øã_idx
 < 
IWL_FIRST_OFDM_RATE
)))

2718 
øã_idx
 = 
	`øã_lowe°_ödex
(
sb™d
, 
°a
);

2720 i‡(
sb™d
->
b™d
 =
NL80211_BAND_5GHZ
)

2721 
øã_idx
 -
IWL_FIRST_OFDM_RATE
;

2722 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 = 0;

2724 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
 = 
øã_idx
;

2725 
öfo
->
c⁄åﬁ
.
øãs
[0].
cou¡
 = 1;

2726 
	}
}

2728 *
	$rs_Æloc_°a
(*
¥iv_øã
, 
õì80211_°a
 *
°a
,

2729 
gÂ_t
 
gÂ
)

2731 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (iwl_°©i⁄_¥iv *Ë
°a
->
drv_¥iv
;

2732 
iwl_›_mode
 *
›_mode
 
__maybe_unu£d
 =

2733 (
iwl_›_mode
 *)
¥iv_øã
;

2734 
iwl_¥iv
 *
¥iv
 
__maybe_unu£d
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

2736 
	`IWL_DEBUG_RATE
(
¥iv
, "create stationÑate scale window\n");

2738  &
°a_¥iv
->
lq_°a
;

2739 
	}
}

2744 
	$iwl_rs_øã_öô
(
iwl_¥iv
 *
¥iv
, 
õì80211_°a
 *
°a
, 
u8
 
°a_id
)

2746 
i
, 
j
;

2747 
õì80211_hw
 *
hw
 = 
¥iv
->hw;

2748 
õì80211_c⁄f
 *
c⁄f
 = &
¥iv
->
hw
->conf;

2749 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

2750 
iwl_°©i⁄_¥iv
 *
°a_¥iv
;

2751 
iwl_lq_°a
 *
lq_°a
;

2752 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

2753 
suµ
;

2755 
°a_¥iv
 = (
iwl_°©i⁄_¥iv
 *Ë
°a
->
drv_¥iv
;

2756 
lq_°a
 = &
°a_¥iv
->lq_sta;

2757 
sb™d
 = 
hw
->
wùhy
->
b™ds
[
c⁄f
->
ch™def
.
ch™
->
b™d
];

2760 
lq_°a
->
lq
.
°a_id
 = sta_id;

2762 
j
 = 0; j < 
LQ_SIZE
; j++)

2763 
i
 = 0; i < 
IWL_RATE_COUNT
; i++)

2764 
	`rs_øã_sˇÀ_˛ór_wödow
(&
lq_°a
->
lq_öfo
[
j
].
wö
[
i
]);

2766 
lq_°a
->
Êush_timî
 = 0;

2767 
lq_°a
->
suµ_øãs
 = 
°a
->
deÊök
.suµ_øãs[
sb™d
->
b™d
];

2769 
	`IWL_DEBUG_RATE
(
¥iv
, "LQ: ***Ñate scale station global init for station %d ***\n",

2770 
°a_id
);

2776 
lq_°a
->
is_dup
 = 0;

2777 
lq_°a
->
max_øã_idx
 = -1;

2778 
lq_°a
->
mis£d_øã_cou¡î
 = 
IWL_MISSED_RATE_MAX
;

2779 
lq_°a
->
is_gªí
 = 
	`rs_u£_gªí
(
°a
);

2780 
lq_°a
->
b™d
 = 
sb™d
->band;

2784 
suµ
 = 
°a
->
deÊök
.
suµ_øãs
[
sb™d
->
b™d
];

2785 
lq_°a
->
a˘ive_Àgacy_øã
 = 0;

2786 
	`f‹_óch_£t_bô
(
i
, &
suµ
, 
BITS_PER_LONG
)

2787 
lq_°a
->
a˘ive_Àgacy_øã
 |
	`BIT
(
sb™d
->
bôøãs
[
i
].
hw_vÆue
);

2793 
lq_°a
->
a˘ive_siso_øã
 = 
ht_ˇp
->
mcs
.
rx_mask
[0] << 1;

2794 
lq_°a
->
a˘ive_siso_øã
 |
ht_ˇp
->
mcs
.
rx_mask
[0] & 0x1;

2795 
lq_°a
->
a˘ive_siso_øã
 &~((
u16
)0x2);

2796 
lq_°a
->
a˘ive_siso_øã
 <<
IWL_FIRST_OFDM_RATE
;

2799 
lq_°a
->
a˘ive_mimo2_øã
 = 
ht_ˇp
->
mcs
.
rx_mask
[1] << 1;

2800 
lq_°a
->
a˘ive_mimo2_øã
 |
ht_ˇp
->
mcs
.
rx_mask
[1] & 0x1;

2801 
lq_°a
->
a˘ive_mimo2_øã
 &~((
u16
)0x2);

2802 
lq_°a
->
a˘ive_mimo2_øã
 <<
IWL_FIRST_OFDM_RATE
;

2804 
lq_°a
->
a˘ive_mimo3_øã
 = 
ht_ˇp
->
mcs
.
rx_mask
[2] << 1;

2805 
lq_°a
->
a˘ive_mimo3_øã
 |
ht_ˇp
->
mcs
.
rx_mask
[2] & 0x1;

2806 
lq_°a
->
a˘ive_mimo3_øã
 &~((
u16
)0x2);

2807 
lq_°a
->
a˘ive_mimo3_øã
 <<
IWL_FIRST_OFDM_RATE
;

2809 
	`IWL_DEBUG_RATE
(
¥iv
, "SISO-RATE=%X MIMO2-RATE=%X MIMO3-RATE=%X\n",

2810 
lq_°a
->
a˘ive_siso_øã
,

2811 
lq_°a
->
a˘ive_mimo2_øã
,

2812 
lq_°a
->
a˘ive_mimo3_øã
);

2815 
lq_°a
->
lq
.
gíîÆ_∑øms
.
sögÀ_°ªam_™t_msk
 =

2816 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

2817 
lq_°a
->
lq
.
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 =

2818 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 &

2819 ~
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

2820 i‡(!
lq_°a
->
lq
.
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
) {

2821 
lq_°a
->
lq
.
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 = 
ANT_AB
;

2822 } i‡(
	`num_of_™t
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
) == 2) {

2823 
lq_°a
->
lq
.
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 =

2824 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
;

2828 
lq_°a
->
tx_agg_tid_í
 = 
IWL_AGG_ALL_TID
;

2829 
lq_°a
->
drv
 = 
¥iv
;

2832 
lq_°a
->
œ°_txøã_idx
 = 
	`øã_lowe°_ödex
(
sb™d
, 
°a
);

2833 i‡(
sb™d
->
b™d
 =
NL80211_BAND_5GHZ
)

2834 
lq_°a
->
œ°_txøã_idx
 +
IWL_FIRST_OFDM_RATE
;

2835 
lq_°a
->
is_agg
 = 0;

2836 #ifde‡
CONFIG_MAC80211_DEBUGFS


2837 
lq_°a
->
dbg_fixed_øã
 = 0;

2840 
	`rs_öôülize_lq
(
¥iv
, 
°a
, 
lq_°a
);

2841 
	}
}

2843 
	$rs_fûl_lök_cmd
(
iwl_¥iv
 *
¥iv
,

2844 
iwl_lq_°a
 *
lq_°a
, 
u32
 
√w_øã
)

2846 
iwl_sˇÀ_tbl_öfo
 
tbl_ty≥
;

2847 
ödex
 = 0;

2848 
øã_idx
;

2849 
ª≥©_øã
 = 0;

2850 
u8
 
™t_toggÀ_˙t
 = 0;

2851 
u8
 
u£_ht_possibÀ
 = 1;

2852 
u8
 
vÆid_tx_™t
 = 0;

2853 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 =

2854 
	`c⁄èöî_of
(
lq_°a
, 
iwl_°©i⁄_¥iv
,Üq_sta);

2855 
iwl_lök_quÆôy_cmd
 *
lq_cmd
 = &
lq_°a
->
lq
;

2858 
	`rs_dbgfs_£t_mcs
(
lq_°a
, &
√w_øã
, 
ödex
);

2861 
	`rs_gë_tbl_öfo_‰om_mcs
(
√w_øã
, 
lq_°a
->
b™d
,

2862 &
tbl_ty≥
, &
øã_idx
);

2864 i‡(
¥iv
 &&Öriv->
bt_fuŒ_c⁄cuºít
) {

2866 
tbl_ty≥
.
™t_ty≥
 =

2867 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

2871 i‡(
	`is_Àgacy
(
tbl_ty≥
.
lq_ty≥
)) {

2872 
™t_toggÀ_˙t
 = 1;

2873 
ª≥©_øã
 = 
IWL_NUMBER_TRY
;

2875 
ª≥©_øã
 = 
	`mö
(
IWL_HT_NUMBER_TRY
,

2876 
LINK_QUAL_AGG_DISABLE_START_DEF
 - 1);

2879 
lq_cmd
->
gíîÆ_∑øms
.
mimo_dñimôî
 =

2880 
	`is_mimo
(
tbl_ty≥
.
lq_ty≥
) ? 1 : 0;

2883 
lq_cmd
->
rs_èbÀ
[
ödex
].
øã_n_Êags
 = 
	`˝u_to_À32
(
√w_øã
);

2885 i‡(
	`num_of_™t
(
tbl_ty≥
.
™t_ty≥
) == 1) {

2886 
lq_cmd
->
gíîÆ_∑øms
.
sögÀ_°ªam_™t_msk
 =

2887 
tbl_ty≥
.
™t_ty≥
;

2888 } i‡(
	`num_of_™t
(
tbl_ty≥
.
™t_ty≥
) == 2) {

2889 
lq_cmd
->
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 =

2890 
tbl_ty≥
.
™t_ty≥
;

2893 
ödex
++;

2894 
ª≥©_øã
--;

2895 i‡(
¥iv
) {

2896 i‡(
¥iv
->
bt_fuŒ_c⁄cuºít
)

2897 
vÆid_tx_™t
 = 
ANT_A
;

2899 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

2903 
ödex
 < 
LINK_QUAL_MAX_RETRY_NUM
) {

2907 
ª≥©_øã
 > 0 && (
ödex
 < 
LINK_QUAL_MAX_RETRY_NUM
)) {

2908 i‡(
	`is_Àgacy
(
tbl_ty≥
.
lq_ty≥
)) {

2909 i‡(
™t_toggÀ_˙t
 < 
NUM_TRY_BEFORE_ANT_TOGGLE
)

2910 
™t_toggÀ_˙t
++;

2911 i‡(
¥iv
 &&

2912 
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
,

2913 &
√w_øã
, &
tbl_ty≥
))

2914 
™t_toggÀ_˙t
 = 1;

2918 
	`rs_dbgfs_£t_mcs
(
lq_°a
, &
√w_øã
, 
ödex
);

2921 
lq_cmd
->
rs_èbÀ
[
ödex
].
øã_n_Êags
 =

2922 
	`˝u_to_À32
(
√w_øã
);

2923 
ª≥©_øã
--;

2924 
ödex
++;

2927 
	`rs_gë_tbl_öfo_‰om_mcs
(
√w_øã
, 
lq_°a
->
b™d
, &
tbl_ty≥
,

2928 &
øã_idx
);

2930 i‡(
¥iv
 &&Öriv->
bt_fuŒ_c⁄cuºít
) {

2932 
tbl_ty≥
.
™t_ty≥
 =

2933 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

2939 i‡(
	`is_mimo
(
tbl_ty≥
.
lq_ty≥
))

2940 
lq_cmd
->
gíîÆ_∑øms
.
mimo_dñimôî
 = 
ödex
;

2943 
√w_øã
 = 
	`rs_gë_lowî_øã
(
lq_°a
, &
tbl_ty≥
, 
øã_idx
,

2944 
u£_ht_possibÀ
);

2947 i‡(
	`is_Àgacy
(
tbl_ty≥
.
lq_ty≥
)) {

2948 i‡(
™t_toggÀ_˙t
 < 
NUM_TRY_BEFORE_ANT_TOGGLE
)

2949 
™t_toggÀ_˙t
++;

2950 i‡(
¥iv
 &&

2951 
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
,

2952 &
√w_øã
, &
tbl_ty≥
))

2953 
™t_toggÀ_˙t
 = 1;

2955 
ª≥©_øã
 = 
IWL_NUMBER_TRY
;

2957 
ª≥©_øã
 = 
IWL_HT_NUMBER_TRY
;

2962 
u£_ht_possibÀ
 = 0;

2965 
	`rs_dbgfs_£t_mcs
(
lq_°a
, &
√w_øã
, 
ödex
);

2968 
lq_cmd
->
rs_èbÀ
[
ödex
].
øã_n_Êags
 = 
	`˝u_to_À32
(
√w_øã
);

2970 
ödex
++;

2971 
ª≥©_øã
--;

2974 
lq_cmd
->
agg_∑øms
.
agg_‰ame_˙t_limô
 =

2975 
°a_¥iv
->
max_agg_bufsize
 ?: 
LINK_QUAL_AGG_FRAME_LIMIT_DEF
;

2976 
lq_cmd
->
agg_∑øms
.
agg_dis_°¨t_th
 = 
LINK_QUAL_AGG_DISABLE_START_DEF
;

2978 
lq_cmd
->
agg_∑øms
.
agg_time_limô
 =

2979 
	`˝u_to_À16
(
LINK_QUAL_AGG_TIME_LIMIT_DEF
);

2984 i‡(
¥iv
 &&Öriv->
lib
->
bt_∑øms
 &&

2985 
¥iv
->
lib
->
bt_∑øms
->
agg_time_limô
 &&

2986 
¥iv
->
bt_åaffic_lﬂd
 >
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
)

2987 
lq_cmd
->
agg_∑øms
.
agg_time_limô
 =

2988 
	`˝u_to_À16
(
¥iv
->
lib
->
bt_∑øms
->
agg_time_limô
);

2989 
	}
}

2991 *
	$rs_Æloc
(
õì80211_hw
 *
hw
)

2993  
hw
->
¥iv
;

2994 
	}
}

2996 
	$rs_‰ì
(*
¥iv_øã
)

2999 
	}
}

3001 
	$rs_‰ì_°a
(*
¥iv_r
, 
õì80211_°a
 *
°a
,

3002 *
¥iv_°a
)

3004 
iwl_›_mode
 *
›_mode
 
__maybe_unu£d
 = 
¥iv_r
;

3005 
iwl_¥iv
 *
¥iv
 
__maybe_unu£d
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

3007 
	`IWL_DEBUG_RATE
(
¥iv
, "enter\n");

3008 
	`IWL_DEBUG_RATE
(
¥iv
, "leave\n");

3009 
	}
}

3011 #ifde‡
CONFIG_MAC80211_DEBUGFS


3012 
	$rs_dbgfs_£t_mcs
(
iwl_lq_°a
 *
lq_°a
,

3013 
u32
 *
øã_n_Êags
, 
ödex
)

3015 
iwl_¥iv
 *
¥iv
;

3016 
u8
 
vÆid_tx_™t
;

3017 
u8
 
™t_£l_tx
;

3019 
¥iv
 = 
lq_°a
->
drv
;

3020 
vÆid_tx_™t
 = 
¥iv
->
nvm_d©a
->valid_tx_ant;

3021 i‡(
lq_°a
->
dbg_fixed_øã
) {

3022 
™t_£l_tx
 =

3023 ((
lq_°a
->
dbg_fixed_øã
 & 
RATE_MCS_ANT_ABC_MSK
)

3024 >> 
RATE_MCS_ANT_POS
);

3025 i‡((
vÆid_tx_™t
 & 
™t_£l_tx
) ==ánt_sel_tx) {

3026 *
øã_n_Êags
 = 
lq_°a
->
dbg_fixed_øã
;

3027 
	`IWL_DEBUG_RATE
(
¥iv
, "FixedÑate ON\n");

3029 
lq_°a
->
dbg_fixed_øã
 = 0;

3030 
	`IWL_ERR
(
¥iv
,

3032 
™t_£l_tx
, 
vÆid_tx_™t
);

3033 
	`IWL_DEBUG_RATE
(
¥iv
, "FixedÑate OFF\n");

3036 
	`IWL_DEBUG_RATE
(
¥iv
, "FixedÑate OFF\n");

3038 
	}
}

3040 
ssize_t
 
	$rs_°a_dbgfs_sˇÀ_èbÀ_wrôe
(
fûe
 *file,

3041 c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3043 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3044 
iwl_¥iv
 *
¥iv
;

3045 
buf
[64];

3046 
size_t
 
buf_size
;

3047 
u32
 
∑r£d_øã
;

3050 
¥iv
 = 
lq_°a
->
drv
;

3051 
	`mem£t
(
buf
, 0, (buf));

3052 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3053 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

3054  -
EFAULT
;

3056 i‡(
	`ssˇnf
(
buf
, "%x", &
∑r£d_øã
) == 1)

3057 
lq_°a
->
dbg_fixed_øã
 = 
∑r£d_øã
;

3059 
lq_°a
->
dbg_fixed_øã
 = 0;

3061 
	`rs_¥ogøm_fix_øã
(
¥iv
, 
lq_°a
);

3063  
cou¡
;

3064 
	}
}

3066 
ssize_t
 
	$rs_°a_dbgfs_sˇÀ_èbÀ_ªad
(
fûe
 *file,

3067 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3069 *
buff
;

3070 
desc
 = 0;

3071 
i
 = 0;

3072 
ödex
 = 0;

3073 
ssize_t
 
ªt
;

3076 c⁄° 
iwl_øã_mcs_öfo
 
iwl_øã_mcs
[
IWL_RATE_COUNT
] = {

3092 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3093 
iwl_¥iv
 *
¥iv
;

3094 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

3096 
¥iv
 = 
lq_°a
->
drv
;

3097 
buff
 = 
	`kmÆloc
(1024, 
GFP_KERNEL
);

3098 i‡(!
buff
)

3099  -
ENOMEM
;

3101 
desc
 +
	`•rötf
(
buff
+desc, "°a_id %d\n", 
lq_°a
->
lq
.
°a_id
);

3102 
desc
 +
	`•rötf
(
buff
+desc, "failed=%d success=%dÑate=0%X\n",

3103 
lq_°a
->
tŸÆ_Áûed
,Üq_°a->
tŸÆ_suc˚ss
,

3104 
lq_°a
->
a˘ive_Àgacy_øã
);

3105 
desc
 +
	`•rötf
(
buff
+desc, "fixedÑate 0x%X\n",

3106 
lq_°a
->
dbg_fixed_øã
);

3107 
desc
 +
	`•rötf
(
buff
+desc, "valid_tx_ant %s%s%s\n",

3108 (
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
ANT_A
) ? "ANT_A," : "",

3109 (
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
ANT_B
) ? "ANT_B," : "",

3110 (
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 & 
ANT_C
) ? "ANT_C" : "");

3111 
desc
 +
	`•rötf
(
buff
+desc, "lqÅype %s\n",

3112 (
	`is_Àgacy
(
tbl
->
lq_ty≥
)) ? "legacy" : "HT");

3113 i‡(
	`is_Ht
(
tbl
->
lq_ty≥
)) {

3114 
desc
 +
	`•rötf
(
buff
 + desc, " %s",

3115 (
	`is_siso
(
tbl
->
lq_ty≥
)) ? "SISO" :

3116 ((
	`is_mimo2
(
tbl
->
lq_ty≥
)) ? "MIMO2" : "MIMO3"));

3117 
desc
 +
	`•rötf
(
buff
 + desc, " %s",

3118 (
tbl
->
is_ht40
) ? "40MHz" : "20MHz");

3119 
desc
 +
	`•rötf
(
buff
 + desc, " %s %s %s\n",

3120 (
tbl
->
is_SGI
) ? "SGI" : "",

3121 (
lq_°a
->
is_gªí
) ? "GFÉnabled" : "",

3122 (
lq_°a
->
is_agg
) ? "AGG on" : "");

3124 
desc
 +
	`•rötf
(
buff
+desc, "lastÅxÑate=0x%X\n",

3125 
lq_°a
->
œ°_øã_n_Êags
);

3126 
desc
 +
	`•rötf
(
buff
+desc, "general:"

3128 
lq_°a
->
lq
.
gíîÆ_∑øms
.
Êags
,

3129 
lq_°a
->
lq
.
gíîÆ_∑øms
.
mimo_dñimôî
,

3130 
lq_°a
->
lq
.
gíîÆ_∑øms
.
sögÀ_°ªam_™t_msk
,

3131 
lq_°a
->
lq
.
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
);

3133 
desc
 +
	`•rötf
(
buff
+desc, "agg:"

3135 
	`À16_to_˝u
(
lq_°a
->
lq
.
agg_∑øms
.
agg_time_limô
),

3136 
lq_°a
->
lq
.
agg_∑øms
.
agg_dis_°¨t_th
,

3137 
lq_°a
->
lq
.
agg_∑øms
.
agg_‰ame_˙t_limô
);

3139 
desc
 +
	`•rötf
(
buff
+desc,

3141 
lq_°a
->
lq
.
gíîÆ_∑øms
.
°¨t_øã_ödex
[0],

3142 
lq_°a
->
lq
.
gíîÆ_∑øms
.
°¨t_øã_ödex
[1],

3143 
lq_°a
->
lq
.
gíîÆ_∑øms
.
°¨t_øã_ödex
[2],

3144 
lq_°a
->
lq
.
gíîÆ_∑øms
.
°¨t_øã_ödex
[3]);

3146 
i
 = 0; i < 
LINK_QUAL_MAX_RETRY_NUM
; i++) {

3147 
ödex
 = 
	`iwl_hwøã_to_∂˝_idx
(

3148 
	`À32_to_˝u
(
lq_°a
->
lq
.
rs_èbÀ
[
i
].
øã_n_Êags
));

3149 i‡(
ödex
 =
IWL_RATE_INVALID
) {

3150 
desc
 +
	`•rötf
(
buff
 + desc, "Ñate[%d] 0x%X invalidÑate\n",

3151 
i
, 
	`À32_to_˝u
(
lq_°a
->
lq
.
rs_èbÀ
[i].
øã_n_Êags
));

3152 } i‡(
	`is_Àgacy
(
tbl
->
lq_ty≥
)) {

3153 
desc
 +
	`•rötf
(
buff
+desc, "Ñate[%d] 0x%X %smbps\n",

3154 
i
, 
	`À32_to_˝u
(
lq_°a
->
lq
.
rs_èbÀ
[i].
øã_n_Êags
),

3155 
iwl_øã_mcs
[
ödex
].
mbps
);

3157 
desc
 +
	`•rötf
(
buff
+desc, "Ñate[%d] 0x%X %smbps (%s)\n",

3158 
i
, 
	`À32_to_˝u
(
lq_°a
->
lq
.
rs_èbÀ
[i].
øã_n_Êags
),

3159 
iwl_øã_mcs
[
ödex
].
mbps
, iwl_øã_mcs[ödex].
mcs
);

3163 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
desc
);

3164 
	`k‰ì
(
buff
);

3165  
ªt
;

3166 
	}
}

3168 c⁄° 
fûe_›î©i⁄s
 
	grs_°a_dbgfs_sˇÀ_èbÀ_›s
 = {

3169 .
wrôe
 = 
rs_°a_dbgfs_sˇÀ_èbÀ_wrôe
,

3170 .
	gªad
 = 
rs_°a_dbgfs_sˇÀ_èbÀ_ªad
,

3171 .
	g›í
 = 
sim∂e_›í
,

3172 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3174 
ssize_t
 
	$rs_°a_dbgfs_°©s_èbÀ_ªad
(
fûe
 *file,

3175 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3177 *
buff
;

3178 
desc
 = 0;

3179 
i
, 
j
;

3180 
ssize_t
 
ªt
;

3182 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3184 
buff
 = 
	`kmÆloc
(1024, 
GFP_KERNEL
);

3185 i‡(!
buff
)

3186  -
ENOMEM
;

3188 
i
 = 0; i < 
LQ_SIZE
; i++) {

3189 
desc
 +
	`•rötf
(
buff
+desc,

3192 
lq_°a
->
a˘ive_tbl
 =
i
 ? "*" : "x",

3193 
lq_°a
->
lq_öfo
[
i
].
lq_ty≥
,

3194 
lq_°a
->
lq_öfo
[
i
].
is_SGI
,

3195 
lq_°a
->
lq_öfo
[
i
].
is_ht40
,

3196 
lq_°a
->
lq_öfo
[
i
].
is_dup
,

3197 
lq_°a
->
is_gªí
,

3198 
lq_°a
->
lq_öfo
[
i
].
cuºít_øã
);

3199 
j
 = 0; j < 
IWL_RATE_COUNT
; j++) {

3200 
desc
 +
	`•rötf
(
buff
+desc,

3202 
lq_°a
->
lq_öfo
[
i
].
wö
[
j
].
cou¡î
,

3203 
lq_°a
->
lq_öfo
[
i
].
wö
[
j
].
suc˚ss_cou¡î
,

3204 
lq_°a
->
lq_öfo
[
i
].
wö
[
j
].
suc˚ss_øtio
);

3207 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
desc
);

3208 
	`k‰ì
(
buff
);

3209  
ªt
;

3210 
	}
}

3212 c⁄° 
fûe_›î©i⁄s
 
	grs_°a_dbgfs_°©s_èbÀ_›s
 = {

3213 .
ªad
 = 
rs_°a_dbgfs_°©s_èbÀ_ªad
,

3214 .
	g›í
 = 
sim∂e_›í
,

3215 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3218 
ssize_t
 
	$rs_°a_dbgfs_øã_sˇÀ_d©a_ªad
(
fûe
 *file,

3219 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3221 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3222 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
];

3223 
buff
[120];

3224 
desc
 = 0;

3226 i‡(
	`is_Ht
(
tbl
->
lq_ty≥
))

3227 
desc
 +
	`•rötf
(
buff
+desc,

3229 
tbl
->
ex≥˘ed_çt
[
lq_°a
->
œ°_txøã_idx
]);

3231 
desc
 +
	`•rötf
(
buff
+desc,

3233 
iwl_øãs
[
lq_°a
->
œ°_txøã_idx
].
õì
 >> 1);

3235  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
desc
);

3236 
	}
}

3238 c⁄° 
fûe_›î©i⁄s
 
	grs_°a_dbgfs_øã_sˇÀ_d©a_›s
 = {

3239 .
ªad
 = 
rs_°a_dbgfs_øã_sˇÀ_d©a_ªad
,

3240 .
	g›í
 = 
sim∂e_›í
,

3241 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3244 
	$rs_add_debugfs
(*
¥iv
, *
¥iv_°a
,

3245 
díåy
 *
dú
)

3247 
iwl_lq_°a
 *
lq_°a
 = 
¥iv_°a
;

3249 
	`debugfs_¸óã_fûe
("øã_sˇÀ_èbÀ", 0600, 
dú
, 
lq_°a
,

3250 &
rs_°a_dbgfs_sˇÀ_èbÀ_›s
);

3251 
	`debugfs_¸óã_fûe
("øã_°©s_èbÀ", 0400, 
dú
, 
lq_°a
,

3252 &
rs_°a_dbgfs_°©s_èbÀ_›s
);

3253 
	`debugfs_¸óã_fûe
("øã_sˇÀ_d©a", 0400, 
dú
, 
lq_°a
,

3254 &
rs_°a_dbgfs_øã_sˇÀ_d©a_›s
);

3255 
	`debugfs_¸óã_u8
("tx_agg_tid_íabÀ", 0600, 
dú
,

3256 &
lq_°a
->
tx_agg_tid_í
);

3258 
	}
}

3266 
	$rs_øã_öô_°ub
(*
¥iv_r
, 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

3267 
cfg80211_ch™_def
 *
ch™def
,

3268 
õì80211_°a
 *
°a
, *
¥iv_°a
)

3270 
	}
}

3272 c⁄° 
øã_c⁄åﬁ_›s
 
	grs_›s
 = {

3273 .
«me
 = 
RS_NAME
,

3274 .
	gtx_°©us
 = 
rs_tx_°©us
,

3275 .
	ggë_øã
 = 
rs_gë_øã
,

3276 .
	gøã_öô
 = 
rs_øã_öô_°ub
,

3277 .
	gÆloc
 = 
rs_Æloc
,

3278 .
	g‰ì
 = 
rs_‰ì
,

3279 .
	gÆloc_°a
 = 
rs_Æloc_°a
,

3280 .
	g‰ì_°a
 = 
rs_‰ì_°a
,

3281 #ifde‡
CONFIG_MAC80211_DEBUGFS


3282 .
	gadd_°a_debugfs
 = 
rs_add_debugfs
,

3286 
	$iwœgn_øã_c⁄åﬁ_ªgi°î
()

3288  
	`õì80211_øã_c⁄åﬁ_ªgi°î
(&
rs_›s
);

3289 
	}
}

3291 
	$iwœgn_øã_c⁄åﬁ_uƒegi°î
()

3293 
	`õì80211_øã_c⁄åﬁ_uƒegi°î
(&
rs_›s
);

3294 
	}
}

	@dvm/rs.h

7 #i‚de‡
__iwl_agn_rs_h__


8 
	#__iwl_agn_rs_h__


	)

10 
	~<√t/mac80211.h
>

12 
	~"iwl-c⁄fig.h
"

14 
	~"comm™ds.h
"

16 
	siwl_øã_öfo
 {

17 
u8
 
	m∂˝
;

18 
u8
 
	m∂˝_siso
;

19 
u8
 
	m∂˝_mimo2
;

20 
u8
 
	m∂˝_mimo3
;

21 
u8
 
	mõì
;

22 
u8
 
	m¥ev_õì
;

23 
u8
 
	m√xt_õì
;

24 
u8
 
	m¥ev_rs
;

25 
u8
 
	m√xt_rs
;

26 
u8
 
	m¥ev_rs_tgg
;

27 
u8
 
	m√xt_rs_tgg
;

35 
	mIWL_RATE_1M_INDEX
 = 0,

36 
	mIWL_RATE_2M_INDEX
,

37 
	mIWL_RATE_5M_INDEX
,

38 
	mIWL_RATE_11M_INDEX
,

39 
	mIWL_RATE_6M_INDEX
,

40 
	mIWL_RATE_9M_INDEX
,

41 
	mIWL_RATE_12M_INDEX
,

42 
	mIWL_RATE_18M_INDEX
,

43 
	mIWL_RATE_24M_INDEX
,

44 
	mIWL_RATE_36M_INDEX
,

45 
	mIWL_RATE_48M_INDEX
,

46 
	mIWL_RATE_54M_INDEX
,

47 
	mIWL_RATE_60M_INDEX
,

48 
	mIWL_RATE_COUNT
,

49 
	mIWL_RATE_COUNT_LEGACY
 = 
IWL_RATE_COUNT
 - 1,

50 
	mIWL_RATE_INVM_INDEX
 = 
IWL_RATE_COUNT
,

51 
	mIWL_RATE_INVALID
 = 
IWL_RATE_COUNT
,

55 
	mIWL_RATE_6M_INDEX_TABLE
 = 0,

56 
	mIWL_RATE_9M_INDEX_TABLE
,

57 
	mIWL_RATE_12M_INDEX_TABLE
,

58 
	mIWL_RATE_18M_INDEX_TABLE
,

59 
	mIWL_RATE_24M_INDEX_TABLE
,

60 
	mIWL_RATE_36M_INDEX_TABLE
,

61 
	mIWL_RATE_48M_INDEX_TABLE
,

62 
	mIWL_RATE_54M_INDEX_TABLE
,

63 
	mIWL_RATE_1M_INDEX_TABLE
,

64 
	mIWL_RATE_2M_INDEX_TABLE
,

65 
	mIWL_RATE_5M_INDEX_TABLE
,

66 
	mIWL_RATE_11M_INDEX_TABLE
,

67 
	mIWL_RATE_INVM_INDEX_TABLE
 = 
IWL_RATE_INVM_INDEX
 - 1,

71 
	mIWL_FIRST_OFDM_RATE
 = 
IWL_RATE_6M_INDEX
,

72 
	mIWL_LAST_OFDM_RATE
 = 
IWL_RATE_60M_INDEX
,

73 
	mIWL_FIRST_CCK_RATE
 = 
IWL_RATE_1M_INDEX
,

74 
	mIWL_LAST_CCK_RATE
 = 
IWL_RATE_11M_INDEX
,

78 
	#IWL_RATE_6M_MASK
 (1 << 
IWL_RATE_6M_INDEX
)

	)

79 
	#IWL_RATE_9M_MASK
 (1 << 
IWL_RATE_9M_INDEX
)

	)

80 
	#IWL_RATE_12M_MASK
 (1 << 
IWL_RATE_12M_INDEX
)

	)

81 
	#IWL_RATE_18M_MASK
 (1 << 
IWL_RATE_18M_INDEX
)

	)

82 
	#IWL_RATE_24M_MASK
 (1 << 
IWL_RATE_24M_INDEX
)

	)

83 
	#IWL_RATE_36M_MASK
 (1 << 
IWL_RATE_36M_INDEX
)

	)

84 
	#IWL_RATE_48M_MASK
 (1 << 
IWL_RATE_48M_INDEX
)

	)

85 
	#IWL_RATE_54M_MASK
 (1 << 
IWL_RATE_54M_INDEX
)

	)

86 
	#IWL_RATE_60M_MASK
 (1 << 
IWL_RATE_60M_INDEX
)

	)

87 
	#IWL_RATE_1M_MASK
 (1 << 
IWL_RATE_1M_INDEX
)

	)

88 
	#IWL_RATE_2M_MASK
 (1 << 
IWL_RATE_2M_INDEX
)

	)

89 
	#IWL_RATE_5M_MASK
 (1 << 
IWL_RATE_5M_INDEX
)

	)

90 
	#IWL_RATE_11M_MASK
 (1 << 
IWL_RATE_11M_INDEX
)

	)

94 
	mIWL_RATE_6M_PLCP
 = 13,

95 
	mIWL_RATE_9M_PLCP
 = 15,

96 
	mIWL_RATE_12M_PLCP
 = 5,

97 
	mIWL_RATE_18M_PLCP
 = 7,

98 
	mIWL_RATE_24M_PLCP
 = 9,

99 
	mIWL_RATE_36M_PLCP
 = 11,

100 
	mIWL_RATE_48M_PLCP
 = 1,

101 
	mIWL_RATE_54M_PLCP
 = 3,

102 
	mIWL_RATE_60M_PLCP
 = 3,

103 
	mIWL_RATE_1M_PLCP
 = 10,

104 
	mIWL_RATE_2M_PLCP
 = 20,

105 
	mIWL_RATE_5M_PLCP
 = 55,

106 
	mIWL_RATE_11M_PLCP
 = 110,

113 
	mIWL_RATE_SISO_6M_PLCP
 = 0,

114 
	mIWL_RATE_SISO_12M_PLCP
 = 1,

115 
	mIWL_RATE_SISO_18M_PLCP
 = 2,

116 
	mIWL_RATE_SISO_24M_PLCP
 = 3,

117 
	mIWL_RATE_SISO_36M_PLCP
 = 4,

118 
	mIWL_RATE_SISO_48M_PLCP
 = 5,

119 
	mIWL_RATE_SISO_54M_PLCP
 = 6,

120 
	mIWL_RATE_SISO_60M_PLCP
 = 7,

121 
	mIWL_RATE_MIMO2_6M_PLCP
 = 0x8,

122 
	mIWL_RATE_MIMO2_12M_PLCP
 = 0x9,

123 
	mIWL_RATE_MIMO2_18M_PLCP
 = 0xa,

124 
	mIWL_RATE_MIMO2_24M_PLCP
 = 0xb,

125 
	mIWL_RATE_MIMO2_36M_PLCP
 = 0xc,

126 
	mIWL_RATE_MIMO2_48M_PLCP
 = 0xd,

127 
	mIWL_RATE_MIMO2_54M_PLCP
 = 0xe,

128 
	mIWL_RATE_MIMO2_60M_PLCP
 = 0xf,

129 
	mIWL_RATE_MIMO3_6M_PLCP
 = 0x10,

130 
	mIWL_RATE_MIMO3_12M_PLCP
 = 0x11,

131 
	mIWL_RATE_MIMO3_18M_PLCP
 = 0x12,

132 
	mIWL_RATE_MIMO3_24M_PLCP
 = 0x13,

133 
	mIWL_RATE_MIMO3_36M_PLCP
 = 0x14,

134 
	mIWL_RATE_MIMO3_48M_PLCP
 = 0x15,

135 
	mIWL_RATE_MIMO3_54M_PLCP
 = 0x16,

136 
	mIWL_RATE_MIMO3_60M_PLCP
 = 0x17,

137 
	mIWL_RATE_SISO_INVM_PLCP
,

138 
	mIWL_RATE_MIMO2_INVM_PLCP
 = 
IWL_RATE_SISO_INVM_PLCP
,

139 
	mIWL_RATE_MIMO3_INVM_PLCP
 = 
IWL_RATE_SISO_INVM_PLCP
,

144 
	mIWL_RATE_6M_IEEE
 = 12,

145 
	mIWL_RATE_9M_IEEE
 = 18,

146 
	mIWL_RATE_12M_IEEE
 = 24,

147 
	mIWL_RATE_18M_IEEE
 = 36,

148 
	mIWL_RATE_24M_IEEE
 = 48,

149 
	mIWL_RATE_36M_IEEE
 = 72,

150 
	mIWL_RATE_48M_IEEE
 = 96,

151 
	mIWL_RATE_54M_IEEE
 = 108,

152 
	mIWL_RATE_60M_IEEE
 = 120,

153 
	mIWL_RATE_1M_IEEE
 = 2,

154 
	mIWL_RATE_2M_IEEE
 = 4,

155 
	mIWL_RATE_5M_IEEE
 = 11,

156 
	mIWL_RATE_11M_IEEE
 = 22,

159 
	#IWL_RATES_MASK
 ((1 << 
IWL_RATE_COUNT
Ë- 1)

	)

161 
	#IWL_INVALID_VALUE
 -1

	)

163 
	#IWL_MIN_RSSI_VAL
 -100

	)

164 
	#IWL_MAX_RSSI_VAL
 0

	)

168 
	#IWL_LEGACY_FAILURE_LIMIT
 160

	)

169 
	#IWL_LEGACY_SUCCESS_LIMIT
 480

	)

170 
	#IWL_LEGACY_TABLE_COUNT
 160

	)

172 
	#IWL_NONE_LEGACY_FAILURE_LIMIT
 400

	)

173 
	#IWL_NONE_LEGACY_SUCCESS_LIMIT
 4500

	)

174 
	#IWL_NONE_LEGACY_TABLE_COUNT
 1500

	)

177 
	#IWL_RS_GOOD_RATIO
 12800

	)

178 
	#IWL_RATE_SCALE_SWITCH
 10880

	)

179 
	#IWL_RATE_HIGH_TH
 10880

	)

180 
	#IWL_RATE_INCREASE_TH
 6400

	)

181 
	#IWL_RATE_DECREASE_TH
 1920

	)

184 
	#IWL_LEGACY_SWITCH_ANTENNA1
 0

	)

185 
	#IWL_LEGACY_SWITCH_ANTENNA2
 1

	)

186 
	#IWL_LEGACY_SWITCH_SISO
 2

	)

187 
	#IWL_LEGACY_SWITCH_MIMO2_AB
 3

	)

188 
	#IWL_LEGACY_SWITCH_MIMO2_AC
 4

	)

189 
	#IWL_LEGACY_SWITCH_MIMO2_BC
 5

	)

190 
	#IWL_LEGACY_SWITCH_MIMO3_ABC
 6

	)

193 
	#IWL_SISO_SWITCH_ANTENNA1
 0

	)

194 
	#IWL_SISO_SWITCH_ANTENNA2
 1

	)

195 
	#IWL_SISO_SWITCH_MIMO2_AB
 2

	)

196 
	#IWL_SISO_SWITCH_MIMO2_AC
 3

	)

197 
	#IWL_SISO_SWITCH_MIMO2_BC
 4

	)

198 
	#IWL_SISO_SWITCH_GI
 5

	)

199 
	#IWL_SISO_SWITCH_MIMO3_ABC
 6

	)

203 
	#IWL_MIMO2_SWITCH_ANTENNA1
 0

	)

204 
	#IWL_MIMO2_SWITCH_ANTENNA2
 1

	)

205 
	#IWL_MIMO2_SWITCH_SISO_A
 2

	)

206 
	#IWL_MIMO2_SWITCH_SISO_B
 3

	)

207 
	#IWL_MIMO2_SWITCH_SISO_C
 4

	)

208 
	#IWL_MIMO2_SWITCH_GI
 5

	)

209 
	#IWL_MIMO2_SWITCH_MIMO3_ABC
 6

	)

213 
	#IWL_MIMO3_SWITCH_ANTENNA1
 0

	)

214 
	#IWL_MIMO3_SWITCH_ANTENNA2
 1

	)

215 
	#IWL_MIMO3_SWITCH_SISO_A
 2

	)

216 
	#IWL_MIMO3_SWITCH_SISO_B
 3

	)

217 
	#IWL_MIMO3_SWITCH_SISO_C
 4

	)

218 
	#IWL_MIMO3_SWITCH_MIMO2_AB
 5

	)

219 
	#IWL_MIMO3_SWITCH_MIMO2_AC
 6

	)

220 
	#IWL_MIMO3_SWITCH_MIMO2_BC
 7

	)

221 
	#IWL_MIMO3_SWITCH_GI
 8

	)

224 
	#IWL_MAX_11N_MIMO3_SEARCH
 
IWL_MIMO3_SWITCH_GI


	)

225 
	#IWL_MAX_SEARCH
 
IWL_MIMO2_SWITCH_MIMO3_ABC


	)

229 
	#IWL_ACTION_LIMIT
 3

	)

231 
	#LQ_SIZE
 2

	)

234 
	#IWL_AGG_TPT_THREHOLD
 0

	)

235 
	#IWL_AGG_LOAD_THRESHOLD
 10

	)

236 
	#IWL_AGG_ALL_TID
 0xff

	)

237 
	#TID_QUEUE_CELL_SPACING
 50

	)

238 
	#TID_QUEUE_MAX_SIZE
 20

	)

239 
	#TID_ROUND_VALUE
 5

	)

241 
	#TID_MAX_TIME_DIFF
 ((
TID_QUEUE_MAX_SIZE
 - 1Ë* 
TID_QUEUE_CELL_SPACING
)

	)

242 
	#TIME_WRAP_AROUND
(
x
, 
y
Ë(((yË> (x)Ë? (yË- (xË: (0-(x)Ë+ (y))

	)

244 c⁄° 
iwl_øã_öfo
 
iwl_øãs
[
IWL_RATE_COUNT
];

246 
	eiwl_èbÀ_ty≥
 {

247 
	mLQ_NONE
,

248 
	mLQ_G
,

249 
	mLQ_A
,

250 
	mLQ_SISO
,

251 
	mLQ_MIMO2
,

252 
	mLQ_MIMO3
,

253 
	mLQ_MAX
,

256 
	#is_Àgacy
(
tbl
Ë((—blË=
LQ_G
Ë|| (—blË=
LQ_A
))

	)

257 
	#is_siso
(
tbl
Ë(—blË=
LQ_SISO
)

	)

258 
	#is_mimo2
(
tbl
Ë(—blË=
LQ_MIMO2
)

	)

259 
	#is_mimo3
(
tbl
Ë(—blË=
LQ_MIMO3
)

	)

260 
	#is_mimo
(
tbl
Ë(
	`is_mimo2
—blË|| 
	`is_mimo3
—bl))

	)

261 
	#is_Ht
(
tbl
Ë(
	`is_siso
—blË|| 
	`is_mimo
—bl))

	)

262 
	#is_a_b™d
(
tbl
Ë(—blË=
LQ_A
)

	)

263 
	#is_g_™d
(
tbl
Ë(—blË=
LQ_G
)

	)

265 
	#IWL_MAX_MCS_DISPLAY_SIZE
 12

	)

267 
	siwl_øã_mcs_öfo
 {

268 
	mmbps
[
IWL_MAX_MCS_DISPLAY_SIZE
];

269 
	mmcs
[
IWL_MAX_MCS_DISPLAY_SIZE
];

275 
	siwl_øã_sˇÀ_d©a
 {

276 
u64
 
	md©a
;

277 
s32
 
	msuc˚ss_cou¡î
;

278 
s32
 
	msuc˚ss_øtio
;

279 
s32
 
	mcou¡î
;

280 
s32
 
	mavîage_çt
;

281 
	m°amp
;

290 
	siwl_sˇÀ_tbl_öfo
 {

291 
iwl_èbÀ_ty≥
 
	mlq_ty≥
;

292 
u8
 
	m™t_ty≥
;

293 
u8
 
	mis_SGI
;

294 
u8
 
	mis_ht40
;

295 
u8
 
	mis_dup
;

296 
u8
 
	ma˘i⁄
;

297 
u8
 
	mmax_£¨ch
;

298 c⁄° 
u16
 *
	mex≥˘ed_çt
;

299 
u32
 
	mcuºít_øã
;

300 
iwl_øã_sˇÀ_d©a
 
	mwö
[
IWL_RATE_COUNT
];

303 
	siwl_åaffic_lﬂd
 {

304 
	mtime_°amp
;

305 
u32
 
	m∑ckë_cou¡
[
TID_QUEUE_MAX_SIZE
];

307 
u32
 
	mtŸÆ
;

309 
u8
 
	mqueue_cou¡
;

311 
u8
 
	mhód
;

319 
	siwl_lq_°a
 {

320 
u8
 
	ma˘ive_tbl
;

321 
u8
 
	míabÀ_cou¡î
;

322 
u8
 
	m°ay_ö_tbl
;

323 
u8
 
	m£¨ch_bëãr_tbl
;

324 
s32
 
	mœ°_çt
;

327 
u32
 
	mèbÀ_cou¡_limô
;

328 
u32
 
	mmax_Áûuª_limô
;

329 
u32
 
	mmax_suc˚ss_limô
;

330 
u32
 
	mèbÀ_cou¡
;

331 
u32
 
	mtŸÆ_Áûed
;

332 
u32
 
	mtŸÆ_suc˚ss
;

333 
u64
 
	mÊush_timî
;

335 
u8
 
	ma˘i⁄_cou¡î
;

336 
u8
 
	mis_gªí
;

337 
u8
 
	mis_dup
;

338 
∆80211_b™d
 
	mb™d
;

341 
u32
 
	msuµ_øãs
;

342 
u16
 
	ma˘ive_Àgacy_øã
;

343 
u16
 
	ma˘ive_siso_øã
;

344 
u16
 
	ma˘ive_mimo2_øã
;

345 
u16
 
	ma˘ive_mimo3_øã
;

346 
s8
 
	mmax_øã_idx
;

347 
u8
 
	mmis£d_øã_cou¡î
;

349 
iwl_lök_quÆôy_cmd
 
	mlq
;

350 
iwl_sˇÀ_tbl_öfo
 
	mlq_öfo
[
LQ_SIZE
];

351 
iwl_åaffic_lﬂd
 
	mlﬂd
[
IWL_MAX_TID_COUNT
];

352 
u8
 
	mtx_agg_tid_í
;

353 #ifde‡
CONFIG_MAC80211_DEBUGFS


354 
u32
 
	mdbg_fixed_øã
;

356 
iwl_¥iv
 *
	mdrv
;

359 
	mœ°_txøã_idx
;

361 
u32
 
	mœ°_øã_n_Êags
;

363 
u8
 
	mis_agg
;

365 
u8
 
	mœ°_bt_åaffic
;

368 
ölöe
 
u8
 
	$fú°_™ã¬a
(
u8
 
mask
)

370 i‡(
mask
 & 
ANT_A
)

371  
ANT_A
;

372 i‡(
mask
 & 
ANT_B
)

373  
ANT_B
;

374  
ANT_C
;

375 
	}
}

379 
iwl_rs_øã_öô
(
iwl_¥iv
 *
¥iv
, 
õì80211_°a
 *
°a
,

380 
u8
 
°a_id
);

392 
iwœgn_øã_c⁄åﬁ_ªgi°î
();

400 
iwœgn_øã_c⁄åﬁ_uƒegi°î
();

	@dvm/rx.c

12 
	~<löux/ëhîdevi˚.h
>

13 
	~<löux/¶ab.h
>

14 
	~<löux/sched.h
>

15 
	~<√t/mac80211.h
>

16 
	~<asm/u«lig√d.h
>

18 
	~"iwl-å™s.h
"

19 
	~"iwl-io.h
"

20 
	~"dev.h
"

21 
	~"ˇlib.h
"

22 
	~"agn.h
"

30 
	$iwœgn_rx_ª∂y_îr‹
(
iwl_¥iv
 *
¥iv
,

31 
iwl_rx_cmd_buf„r
 *
rxb
)

33 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

34 
iwl_îr‹_ª•
 *
îr_ª•
 = (*)
pkt
->
d©a
;

36 
	`IWL_ERR
(
¥iv
, "Error ReplyÅype 0x%08X cmd REPLY_ERROR (0x%02X) "

38 
	`À32_to_˝u
(
îr_ª•
->
îr‹_ty≥
),

39 
îr_ª•
->
cmd_id
,

40 
	`À16_to_˝u
(
îr_ª•
->
bad_cmd_£q_num
),

41 
	`À32_to_˝u
(
îr_ª•
->
îr‹_öfo
));

42 
	}
}

44 
	$iwœgn_rx_cß
(
iwl_¥iv
 *
¥iv
, 
iwl_rx_cmd_buf„r
 *
rxb
)

46 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

47 
iwl_cß_nŸifiˇti⁄
 *
cß
 = (*)
pkt
->
d©a
;

52 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

53 
iwl_rx⁄_cmd
 *
rx⁄
 = (*)&
˘x
->
a˘ive
;

55 i‡(!
	`ã°_bô
(
STATUS_CHANNEL_SWITCH_PENDING
, &
¥iv
->
°©us
))

58 i‡(!
	`À32_to_˝u
(
cß
->
°©us
Ë&& cß->
ch™√l
 =
¥iv
->
swôch_ch™√l
) {

59 
rx⁄
->
ch™√l
 = 
cß
->channel;

60 
˘x
->
°agög
.
ch™√l
 = 
cß
->channel;

61 
	`IWL_DEBUG_11H
(
¥iv
, "CSAÇotif: channel %d\n",

62 
	`À16_to_˝u
(
cß
->
ch™√l
));

63 
	`iwl_chswôch_d⁄e
(
¥iv
, 
åue
);

65 
	`IWL_ERR
(
¥iv
, "CSAÇotif (fail) : channel %d\n",

66 
	`À16_to_˝u
(
cß
->
ch™√l
));

67 
	`iwl_chswôch_d⁄e
(
¥iv
, 
Ál£
);

69 
	}
}

72 
	$iwœgn_rx_•e˘rum_mósuª_nŸif
(
iwl_¥iv
 *
¥iv
,

73 
iwl_rx_cmd_buf„r
 *
rxb
)

75 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

76 
iwl_•e˘rum_nŸifiˇti⁄
 *
ªp‹t
 = (*)
pkt
->
d©a
;

78 i‡(!
ªp‹t
->
°©e
) {

79 
	`IWL_DEBUG_11H
(
¥iv
,

84 
	`mem˝y
(&
¥iv
->
mósuª_ªp‹t
, 
ªp‹t
, (*report));

85 
¥iv
->
mósuªmít_°©us
 |
MEASUREMENT_READY
;

86 
	}
}

88 
	$iwœgn_rx_pm_¶ìp_nŸif
(
iwl_¥iv
 *
¥iv
,

89 
iwl_rx_cmd_buf„r
 *
rxb
)

91 #ifde‡
CONFIG_IWLWIFI_DEBUG


92 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

93 
iwl_¶ìp_nŸifiˇti⁄
 *
¶ìp
 = (*)
pkt
->
d©a
;

94 
	`IWL_DEBUG_RX
(
¥iv
, "sleep mode: %d, src: %d\n",

95 
¶ìp
->
pm_¶ìp_mode
, sÀï->
pm_wakeup_§c
);

97 
	}
}

99 
	$iwœgn_rx_pm_debug_°©i°ics_nŸif
(
iwl_¥iv
 *
¥iv
,

100 
iwl_rx_cmd_buf„r
 *
rxb
)

102 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

103 
u32
 
__maybe_unu£d
 
Àn
 = 
	`iwl_rx_∑ckë_Àn
(
pkt
);

104 
	`IWL_DEBUG_RADIO
(
¥iv
, "Dumping %d bytes of unhandled "

105 "nŸifiˇti⁄ f‹ PM_DEBUG_STATISTIC_NOTIFIC:\n", 
Àn
);

106 
	`iwl_¥öt_hex_dump
(
¥iv
, 
IWL_DL_RADIO
, 
pkt
->
d©a
, 
Àn
);

107 
	}
}

109 
	$iwœgn_rx_bóc⁄_nŸif
(
iwl_¥iv
 *
¥iv
,

110 
iwl_rx_cmd_buf„r
 *
rxb
)

112 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

113 
iwœgn_bóc⁄_nŸif
 *
bóc⁄
 = (*)
pkt
->
d©a
;

114 #ifde‡
CONFIG_IWLWIFI_DEBUG


115 
u16
 
°©us
 = 
	`À16_to_˝u
(
bóc⁄
->
bóc⁄_nŸify_hdr
.status.status);

116 
u8
 
øã
 = 
	`iwl_hw_gë_øã
(
bóc⁄
->
bóc⁄_nŸify_hdr
.
øã_n_Êags
);

118 
	`IWL_DEBUG_RX
(
¥iv
, "beacon status %#x,Ñetries:%d ibssmgr:%d "

120 
°©us
 & 
TX_STATUS_MSK
,

121 
bóc⁄
->
bóc⁄_nŸify_hdr
.
Áûuª_‰ame
,

122 
	`À32_to_˝u
(
bóc⁄
->
ibss_mgr_°©us
),

123 
	`À32_to_˝u
(
bóc⁄
->
high_tsf
),

124 
	`À32_to_˝u
(
bóc⁄
->
low_tsf
), 
øã
);

127 
¥iv
->
ibss_m™agî
 = 
	`À32_to_˝u
(
bóc⁄
->
ibss_mgr_°©us
);

128 
	}
}

136 
boﬁ
 
	$iwœgn_good_∂˝_hó…h
(
iwl_¥iv
 *
¥iv
,

137 
°©i°ics_rx_phy
 *
cur_ofdm
,

138 
°©i°ics_rx_ht_phy
 *
cur_ofdm_ht
,

139 
m£cs
)

141 
dñè
;

142 
thªshﬁd
 = 
¥iv
->
∂˝_dñè_thªshﬁd
;

144 i‡(
thªshﬁd
 =
IWL_MAX_PLCP_ERR_THRESHOLD_DISABLE
) {

145 
	`IWL_DEBUG_RADIO
(
¥iv
, "plcp_err check disabled\n");

146  
åue
;

149 
dñè
 = 
	`À32_to_˝u
(
cur_ofdm
->
∂˝_îr
) -

150 
	`À32_to_˝u
(
¥iv
->
°©i°ics
.
rx_ofdm
.
∂˝_îr
) +

151 
	`À32_to_˝u
(
cur_ofdm_ht
->
∂˝_îr
) -

152 
	`À32_to_˝u
(
¥iv
->
°©i°ics
.
rx_ofdm_ht
.
∂˝_îr
);

155 i‡(
dñè
 <= 0)

156  
åue
;

158 i‡((
dñè
 * 100 / 
m£cs
Ë> 
thªshﬁd
) {

159 
	`IWL_DEBUG_RADIO
(
¥iv
,

161 
thªshﬁd
, 
dñè
, 
m£cs
);

162  
Ál£
;

165  
åue
;

166 
	}
}

168 
	$iwl_f‹˚_rf_ª£t
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
exã∫Æ
)

170 
iwl_rf_ª£t
 *
rf_ª£t
;

172 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

173  -
EAGAIN
;

175 i‡(!
	`iwl_is_™y_assocüãd
(
¥iv
)) {

176 
	`IWL_DEBUG_SCAN
(
¥iv
, "forceÑesetÑejected:Çotássociated\n");

177  -
ENOLINK
;

180 
rf_ª£t
 = &
¥iv
->rf_reset;

181 
rf_ª£t
->
ª£t_ªque°_cou¡
++;

182 i‡(!
exã∫Æ
 && 
rf_ª£t
->
œ°_ª£t_jiffõs
 &&

183 
	`time_a·î
(
rf_ª£t
->
œ°_ª£t_jiffõs
 +

184 
IWL_DELAY_NEXT_FORCE_RF_RESET
, 
jiffõs
)) {

185 
	`IWL_DEBUG_INFO
(
¥iv
, "RFÑesetÑejected\n");

186 
rf_ª£t
->
ª£t_ªje˘_cou¡
++;

187  -
EAGAIN
;

189 
rf_ª£t
->
ª£t_suc˚ss_cou¡
++;

190 
rf_ª£t
->
œ°_ª£t_jiffõs
 = 
jiffõs
;

201 
	`IWL_DEBUG_INFO
(
¥iv
, "performÑadioÑeset.\n");

202 
	`iwl_öã∫Æ_sh‹t_hw_sˇn
(
¥iv
);

204 
	}
}

207 
	$iwœgn_ªcovî_‰om_°©i°ics
(
iwl_¥iv
 *
¥iv
,

208 
°©i°ics_rx_phy
 *
cur_ofdm
,

209 
°©i°ics_rx_ht_phy
 *
cur_ofdm_ht
,

210 
°©i°ics_tx
 *
tx
,

211 
°amp
)

213 
m£cs
;

215 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

218 
m£cs
 = 
	`jiffõs_to_m£cs
(
°amp
 - 
¥iv
->
rx_°©i°ics_jiffõs
);

221 i‡(!
	`iwl_is_™y_assocüãd
(
¥iv
))

225 i‡(
m£cs
 < 99)

228 i‡(!
	`iwœgn_good_∂˝_hó…h
(
¥iv
, 
cur_ofdm
, 
cur_ofdm_ht
, 
m£cs
))

229 
	`iwl_f‹˚_rf_ª£t
(
¥iv
, 
Ál£
);

230 
	}
}

235 
	$iwœgn_rx_ˇlc_noi£
(
iwl_¥iv
 *
¥iv
)

237 
°©i°ics_rx_n⁄_phy
 *
rx_öfo
;

238 
num_a˘ive_rx
 = 0;

239 
tŸÆ_sûí˚
 = 0;

240 
b˙_sûí˚_a
, 
b˙_sûí˚_b
, 
b˙_sûí˚_c
;

241 
œ°_rx_noi£
;

243 
rx_öfo
 = &
¥iv
->
°©i°ics
.
rx_n⁄_phy
;

245 
b˙_sûí˚_a
 =

246 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_a
Ë& 
IN_BAND_FILTER
;

247 
b˙_sûí˚_b
 =

248 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_b
Ë& 
IN_BAND_FILTER
;

249 
b˙_sûí˚_c
 =

250 
	`À32_to_˝u
(
rx_öfo
->
bóc⁄_sûí˚_rssi_c
Ë& 
IN_BAND_FILTER
;

252 i‡(
b˙_sûí˚_a
) {

253 
tŸÆ_sûí˚
 +
b˙_sûí˚_a
;

254 
num_a˘ive_rx
++;

256 i‡(
b˙_sûí˚_b
) {

257 
tŸÆ_sûí˚
 +
b˙_sûí˚_b
;

258 
num_a˘ive_rx
++;

260 i‡(
b˙_sûí˚_c
) {

261 
tŸÆ_sûí˚
 +
b˙_sûí˚_c
;

262 
num_a˘ive_rx
++;

266 i‡(
num_a˘ive_rx
)

267 
œ°_rx_noi£
 = (
tŸÆ_sûí˚
 / 
num_a˘ive_rx
) - 107;

269 
œ°_rx_noi£
 = 
IWL_NOISE_MEAS_NOT_AVAILABLE
;

271 
	`IWL_DEBUG_CALIB
(
¥iv
, "inband silenceá %u, b %u, c %u, dBm %d\n",

272 
b˙_sûí˚_a
, 
b˙_sûí˚_b
, 
b˙_sûí˚_c
,

273 
œ°_rx_noi£
);

274 
	}
}

276 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


282 
	$accum_°©s
(
__À32
 *
¥ev
, __À32 *
cur
, __À32 *
dñè
,

283 
__À32
 *
max_dñè
, __À32 *
accum
, 
size
)

285 
i
;

287 
i
 = 0;

288 
i
 < 
size
 / (
__À32
);

289 
i
++, 
¥ev
++, 
cur
++, 
dñè
++, 
max_dñè
++, 
accum
++) {

290 i‡(
	`À32_to_˝u
(*
cur
Ë>Üe32_to_˝u(*
¥ev
)) {

291 *
dñè
 = 
	`˝u_to_À32
(

292 
	`À32_to_˝u
(*
cur
Ë-Üe32_to_˝u(*
¥ev
));

293 
	`À32_add_˝u
(
accum
, 
	`À32_to_˝u
(*
dñè
));

294 i‡(
	`À32_to_˝u
(*
dñè
Ë>Üe32_to_˝u(*
max_dñè
))

295 *
max_dñè
 = *
dñè
;

298 
	}
}

301 
	$iwœgn_accumuœtive_°©i°ics
(
iwl_¥iv
 *
¥iv
,

302 
°©i°ics_gíîÆ_comm⁄
 *
comm⁄
,

303 
°©i°ics_rx_n⁄_phy
 *
rx_n⁄_phy
,

304 
°©i°ics_rx_phy
 *
rx_ofdm
,

305 
°©i°ics_rx_ht_phy
 *
rx_ofdm_ht
,

306 
°©i°ics_rx_phy
 *
rx_cck
,

307 
°©i°ics_tx
 *
tx
,

308 
°©i°ics_bt_a˘ivôy
 *
bt_a˘ivôy
)

310 
	#ACCUM
(
_«me
) \

311 
	`accum_°©s
((
__À32
 *)&
¥iv
->
°©i°ics
.
_«me
, \

312 (
__À32
 *)
_«me
, \

313 (
__À32
 *)&
¥iv
->
dñè_°©s
.
_«me
, \

314 (
__À32
 *)&
¥iv
->
max_dñè_°©s
.
_«me
, \

315 (
__À32
 *)&
¥iv
->
accum_°©s
.
_«me
, \

316 (*
_«me
))

	)

318 
	`ACCUM
(
comm⁄
);

319 
	`ACCUM
(
rx_n⁄_phy
);

320 
	`ACCUM
(
rx_ofdm
);

321 
	`ACCUM
(
rx_ofdm_ht
);

322 
	`ACCUM
(
rx_cck
);

323 
	`ACCUM
(
tx
);

324 i‡(
bt_a˘ivôy
)

325 
	`ACCUM
(
bt_a˘ivôy
);

326 #unde‡
ACCUM


327 
	}
}

329 
ölöe
 

330 
	$iwœgn_accumuœtive_°©i°ics
(
iwl_¥iv
 *
¥iv
,

331 
°©i°ics_gíîÆ_comm⁄
 *
comm⁄
,

332 
°©i°ics_rx_n⁄_phy
 *
rx_n⁄_phy
,

333 
°©i°ics_rx_phy
 *
rx_ofdm
,

334 
°©i°ics_rx_ht_phy
 *
rx_ofdm_ht
,

335 
°©i°ics_rx_phy
 *
rx_cck
,

336 
°©i°ics_tx
 *
tx
,

337 
°©i°ics_bt_a˘ivôy
 *
bt_a˘ivôy
)

339 
	}
}

342 
	$iwœgn_rx_°©i°ics
(
iwl_¥iv
 *
¥iv
,

343 
iwl_rx_cmd_buf„r
 *
rxb
)

345 
°amp
 = 
jiffõs
;

346 c⁄° 
ªg_ªˇlib_≥riod
 = 60;

347 
ch™ge
;

348 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

349 
u32
 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

350 
__À32
 *
Êag
;

351 
°©i°ics_gíîÆ_comm⁄
 *
comm⁄
;

352 
°©i°ics_rx_n⁄_phy
 *
rx_n⁄_phy
;

353 
°©i°ics_rx_phy
 *
rx_ofdm
;

354 
°©i°ics_rx_ht_phy
 *
rx_ofdm_ht
;

355 
°©i°ics_rx_phy
 *
rx_cck
;

356 
°©i°ics_tx
 *
tx
;

357 
°©i°ics_bt_a˘ivôy
 *
bt_a˘ivôy
;

359 
	`IWL_DEBUG_RX
(
¥iv
, "StatisticsÇotificationÑeceived (%d bytes).\n",

360 
Àn
);

362 
	`•ö_lock
(&
¥iv
->
°©i°ics
.
lock
);

364 i‡(
Àn
 =(
iwl_bt_nŸif_°©i°ics
)) {

365 
iwl_bt_nŸif_°©i°ics
 *
°©s
;

366 
°©s
 = (*)&
pkt
->
d©a
;

367 
Êag
 = &
°©s
->flag;

368 
comm⁄
 = &
°©s
->
gíîÆ
.common;

369 
rx_n⁄_phy
 = &
°©s
->
rx
.
gíîÆ
.
comm⁄
;

370 
rx_ofdm
 = &
°©s
->
rx
.
ofdm
;

371 
rx_ofdm_ht
 = &
°©s
->
rx
.
ofdm_ht
;

372 
rx_cck
 = &
°©s
->
rx
.
cck
;

373 
tx
 = &
°©s
->tx;

374 
bt_a˘ivôy
 = &
°©s
->
gíîÆ
.
a˘ivôy
;

376 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


378 
¥iv
->
°©i°ics
.
num_bt_kûls
 = 
°©s
->
rx
.
gíîÆ
.num_bt_kills;

379 
	`À32_add_˝u
(&
¥iv
->
°©i°ics
.
accum_num_bt_kûls
,

380 
	`À32_to_˝u
(
°©s
->
rx
.
gíîÆ
.
num_bt_kûls
));

382 } i‡(
Àn
 =(
iwl_nŸif_°©i°ics
)) {

383 
iwl_nŸif_°©i°ics
 *
°©s
;

384 
°©s
 = (*)&
pkt
->
d©a
;

385 
Êag
 = &
°©s
->flag;

386 
comm⁄
 = &
°©s
->
gíîÆ
.common;

387 
rx_n⁄_phy
 = &
°©s
->
rx
.
gíîÆ
;

388 
rx_ofdm
 = &
°©s
->
rx
.
ofdm
;

389 
rx_ofdm_ht
 = &
°©s
->
rx
.
ofdm_ht
;

390 
rx_cck
 = &
°©s
->
rx
.
cck
;

391 
tx
 = &
°©s
->tx;

392 
bt_a˘ivôy
 = 
NULL
;

394 
	`WARN_ONCE
(1, "len %d doesn't match BT (%zu) orÇormal (%zu)\n",

395 
Àn
, (
iwl_bt_nŸif_°©i°ics
),

396 (
iwl_nŸif_°©i°ics
));

397 
	`•ö_u∆ock
(&
¥iv
->
°©i°ics
.
lock
);

401 
ch™ge
 = 
comm⁄
->
ãm≥øtuª
 !
¥iv
->
°©i°ics
.common.temperature ||

402 (*
Êag
 & 
STATISTICS_REPLY_FLG_HT40_MODE_MSK
) !=

403 (
¥iv
->
°©i°ics
.
Êag
 & 
STATISTICS_REPLY_FLG_HT40_MODE_MSK
);

405 
	`iwœgn_accumuœtive_°©i°ics
(
¥iv
, 
comm⁄
, 
rx_n⁄_phy
, 
rx_ofdm
,

406 
rx_ofdm_ht
, 
rx_cck
, 
tx
, 
bt_a˘ivôy
);

408 
	`iwœgn_ªcovî_‰om_°©i°ics
(
¥iv
, 
rx_ofdm
, 
rx_ofdm_ht
, 
tx
, 
°amp
);

410 
¥iv
->
°©i°ics
.
Êag
 = *flag;

411 
	`mem˝y
(&
¥iv
->
°©i°ics
.
comm⁄
, common, (*common));

412 
	`mem˝y
(&
¥iv
->
°©i°ics
.
rx_n⁄_phy
,Ñx_non_phy, (*rx_non_phy));

413 
	`mem˝y
(&
¥iv
->
°©i°ics
.
rx_ofdm
,Ñx_ofdm, (*rx_ofdm));

414 
	`mem˝y
(&
¥iv
->
°©i°ics
.
rx_ofdm_ht
,Ñx_ofdm_ht, (*rx_ofdm_ht));

415 
	`mem˝y
(&
¥iv
->
°©i°ics
.
rx_cck
,Ñx_cck, (*rx_cck));

416 
	`mem˝y
(&
¥iv
->
°©i°ics
.
tx
,Åx, (*tx));

417 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


418 i‡(
bt_a˘ivôy
)

419 
	`mem˝y
(&
¥iv
->
°©i°ics
.
bt_a˘ivôy
, bt_activity,

420 (*
bt_a˘ivôy
));

423 
¥iv
->
rx_°©i°ics_jiffõs
 = 
°amp
;

425 
	`£t_bô
(
STATUS_STATISTICS
, &
¥iv
->
°©us
);

431 
	`mod_timî
(&
¥iv
->
°©i°ics_≥riodic
, 
jiffõs
 +

432 
	`m£cs_to_jiffõs
(
ªg_ªˇlib_≥riod
 * 1000));

434 i‡(
	`u∆ikñy
(!
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
)) &&

435 (
pkt
->
hdr
.
cmd
 =
STATISTICS_NOTIFICATION
)) {

436 
	`iwœgn_rx_ˇlc_noi£
(
¥iv
);

437 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
run_time_ˇlib_w‹k
);

439 i‡(
¥iv
->
lib
->
ãm≥øtuª
 && 
ch™ge
)

440 
¥iv
->
lib
->
	`ãm≥øtuª
(priv);

442 
	`•ö_u∆ock
(&
¥iv
->
°©i°ics
.
lock
);

443 
	}
}

445 
	$iwœgn_rx_ª∂y_°©i°ics
(
iwl_¥iv
 *
¥iv
,

446 
iwl_rx_cmd_buf„r
 *
rxb
)

448 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

449 
iwl_nŸif_°©i°ics
 *
°©s
 = (*)
pkt
->
d©a
;

451 i‡(
	`À32_to_˝u
(
°©s
->
Êag
Ë& 
UCODE_STATISTICS_CLEAR_MSK
) {

452 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


453 
	`mem£t
(&
¥iv
->
accum_°©s
, 0,

454 (
¥iv
->
accum_°©s
));

455 
	`mem£t
(&
¥iv
->
dñè_°©s
, 0,

456 (
¥iv
->
dñè_°©s
));

457 
	`mem£t
(&
¥iv
->
max_dñè_°©s
, 0,

458 (
¥iv
->
max_dñè_°©s
));

460 
	`IWL_DEBUG_RX
(
¥iv
, "Statistics have been cleared\n");

463 
	`iwœgn_rx_°©i°ics
(
¥iv
, 
rxb
);

464 
	}
}

468 
	$iwœgn_rx_ˇrd_°©e_nŸif
(
iwl_¥iv
 *
¥iv
,

469 
iwl_rx_cmd_buf„r
 *
rxb
)

471 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

472 
iwl_ˇrd_°©e_nŸif
 *
ˇrd_°©e_nŸif
 = (*)
pkt
->
d©a
;

473 
u32
 
Êags
 = 
	`À32_to_˝u
(
ˇrd_°©e_nŸif
->flags);

474 
°©us
 = 
¥iv
->status;

476 
	`IWL_DEBUG_RF_KILL
(
¥iv
, "Card stateÑeceived: HW:%s SW:%s CT:%s\n",

477 (
Êags
 & 
HW_CARD_DISABLED
) ? "Kill" : "On",

478 (
Êags
 & 
SW_CARD_DISABLED
) ? "Kill" : "On",

479 (
Êags
 & 
CT_CARD_DISABLED
) ?

482 i‡(
Êags
 & (
SW_CARD_DISABLED
 | 
HW_CARD_DISABLED
 |

483 
CT_CARD_DISABLED
)) {

485 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_SET
,

486 
CSR_UCODE_DRV_GP1_BIT_CMD_BLOCKED
);

488 
	`iwl_wrôe_dúe˘32
(
¥iv
->
å™s
, 
HBUS_TARG_MBX_C
,

489 
HBUS_TARG_MBX_C_REG_BIT_CMD_BLOCKED
);

491 i‡(!(
Êags
 & 
RXON_CARD_DISABLED
)) {

492 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_CLR
,

493 
CSR_UCODE_DRV_GP1_BIT_CMD_BLOCKED
);

494 
	`iwl_wrôe_dúe˘32
(
¥iv
->
å™s
, 
HBUS_TARG_MBX_C
,

495 
HBUS_TARG_MBX_C_REG_BIT_CMD_BLOCKED
);

497 i‡(
Êags
 & 
CT_CARD_DISABLED
)

498 
	`iwl_â_íãr_˘_kûl
(
¥iv
);

500 i‡(!(
Êags
 & 
CT_CARD_DISABLED
))

501 
	`iwl_â_exô_˘_kûl
(
¥iv
);

503 i‡(
Êags
 & 
HW_CARD_DISABLED
)

504 
	`£t_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
);

506 
	`˛ór_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
);

509 i‡(!(
Êags
 & 
RXON_CARD_DISABLED
))

510 
	`iwl_sˇn_ˇn˚l
(
¥iv
);

512 i‡((
	`ã°_bô
(
STATUS_RF_KILL_HW
, &
°©us
) !=

513 
	`ã°_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
)))

514 
	`wùhy_rfkûl_£t_hw_°©e
(
¥iv
->
hw
->
wùhy
,

515 
	`ã°_bô
(
STATUS_RF_KILL_HW
, &
¥iv
->
°©us
));

516 
	}
}

518 
	$iwœgn_rx_mis£d_bóc⁄_nŸif
(
iwl_¥iv
 *
¥iv
,

519 
iwl_rx_cmd_buf„r
 *
rxb
)

522 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

523 
iwl_mis£d_bóc⁄_nŸif
 *
mis£d_bóc⁄
 = (*)
pkt
->
d©a
;

525 i‡(
	`À32_to_˝u
(
mis£d_bóc⁄
->
c⁄£cutive_mis£d_bóc⁄s
) >

526 
¥iv
->
mis£d_bóc⁄_thªshﬁd
) {

527 
	`IWL_DEBUG_CALIB
(
¥iv
,

529 
	`À32_to_˝u
(
mis£d_bóc⁄
->
c⁄£cutive_mis£d_bóc⁄s
),

530 
	`À32_to_˝u
(
mis£d_bóc⁄
->
tŸÆ_mis£d_bec⁄s
),

531 
	`À32_to_˝u
(
mis£d_bóc⁄
->
num_ªcvd_bóc⁄s
),

532 
	`À32_to_˝u
(
mis£d_bóc⁄
->
num_ex≥˘ed_bóc⁄s
));

533 i‡(!
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
))

534 
	`iwl_öô_£nsôivôy
(
¥iv
);

536 
	}
}

540 
	$iwœgn_rx_ª∂y_rx_phy
(
iwl_¥iv
 *
¥iv
,

541 
iwl_rx_cmd_buf„r
 *
rxb
)

543 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

545 
¥iv
->
œ°_phy_ªs_vÆid
 = 
åue
;

546 
¥iv
->
ampdu_ªf
++;

547 
	`mem˝y
(&
¥iv
->
œ°_phy_ªs
, 
pkt
->
d©a
,

548 (
iwl_rx_phy_ªs
));

549 
	}
}

554 
	$iwœgn_£t_de¸y±ed_Êag
(
iwl_¥iv
 *
¥iv
,

555 
õì80211_hdr
 *
hdr
,

556 
u32
 
de¸y±_ªs
,

557 
õì80211_rx_°©us
 *
°©s
)

559 
u16
 
fc
 = 
	`À16_to_˝u
(
hdr
->
‰ame_c⁄åﬁ
);

565 i‡(
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
a˘ive
.
fûãr_Êags
 &

566 
RXON_FILTER_DIS_DECRYPT_MSK
)

569 i‡(!(
fc
 & 
IEEE80211_FCTL_PROTECTED
))

572 
	`IWL_DEBUG_RX
(
¥iv
, "de¸y±_ªs:0x%x\n", 
de¸y±_ªs
);

573 
de¸y±_ªs
 & 
RX_RES_STATUS_SEC_TYPE_MSK
) {

574 
RX_RES_STATUS_SEC_TYPE_TKIP
:

577 i‡((
de¸y±_ªs
 & 
RX_RES_STATUS_DECRYPT_TYPE_MSK
) ==

578 
RX_RES_STATUS_BAD_KEY_TTAK
)

580 
ÁŒthrough
;

581 
RX_RES_STATUS_SEC_TYPE_WEP
:

582 i‡((
de¸y±_ªs
 & 
RX_RES_STATUS_DECRYPT_TYPE_MSK
) ==

583 
RX_RES_STATUS_BAD_ICV_MIC
) {

586 
	`IWL_DEBUG_RX
(
¥iv
, "Packet destroyed\n");

589 
ÁŒthrough
;

590 
RX_RES_STATUS_SEC_TYPE_CCMP
:

591 i‡((
de¸y±_ªs
 & 
RX_RES_STATUS_DECRYPT_TYPE_MSK
) ==

592 
RX_RES_STATUS_DECRYPT_OK
) {

593 
	`IWL_DEBUG_RX
(
¥iv
, "hw decrypt successfully!!!\n");

594 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

602 
	}
}

604 
	$iwœgn_∑ss_∑ckë_to_mac80211
(
iwl_¥iv
 *
¥iv
,

605 
õì80211_hdr
 *
hdr
,

606 
u16
 
Àn
,

607 
u32
 
ampdu_°©us
,

608 
iwl_rx_cmd_buf„r
 *
rxb
,

609 
õì80211_rx_°©us
 *
°©s
)

611 
sk_buff
 *
skb
;

612 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

613 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

614 
hdæí
, 
‰agÀn
;

617 i‡(
	`u∆ikñy
(!
¥iv
->
is_›í
)) {

618 
	`IWL_DEBUG_DROP_LIMIT
(
¥iv
,

624 i‡(!
iwlwifi_mod_∑øms
.
sw¸y±o
 &&

625 
	`iwœgn_£t_de¸y±ed_Êag
(
¥iv
, 
hdr
, 
ampdu_°©us
, 
°©s
))

631 
skb
 = 
	`Æloc_skb
(128, 
GFP_ATOMIC
);

632 i‡(!
skb
) {

633 
	`IWL_ERR
(
¥iv
, "alloc_skb failed\n");

640 
hdæí
 = (
Àn
 <
	`skb_èûroom
(
skb
)Ë?Üí : (*
hdr
);

642 
	`skb_put_d©a
(
skb
, 
hdr
, 
hdæí
);

643 
‰agÀn
 = 
Àn
 - 
hdæí
;

645 i‡(
‰agÀn
) {

646 
off£t
 = (*)
hdr
 + 
hdæí
 -

647 
	`rxb_addr
(
rxb
Ë+ 
	`rxb_off£t
(rxb);

649 
	`skb_add_rx_‰ag
(
skb
, 0, 
	`rxb_°ól_∑ge
(
rxb
), 
off£t
,

650 
‰agÀn
, 
rxb
->
åuesize
);

660 i‡(
	`u∆ikñy
(
	`õì80211_is_bóc⁄
(
fc
Ë&& 
¥iv
->
∑ssive_no_rx
)) {

661 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

662 i‡(!
	`ëhî_addr_equÆ
(
hdr
->
addr3
,

663 
˘x
->
a˘ive
.
bssid_addr
))

665 
	`iwœgn_li·_∑ssive_no_rx
(
¥iv
);

669 
	`mem˝y
(
	`IEEE80211_SKB_RXCB
(
skb
), 
°©s
, (*stats));

671 
	`õì80211_rx_«pi
(
¥iv
->
hw
, 
NULL
, 
skb
,Öriv->
«pi
);

672 
	}
}

674 
u32
 
	$iwœgn_å™¶©e_rx_°©us
(
iwl_¥iv
 *
¥iv
, 
u32
 
de¸y±_ö
)

676 
u32
 
de¸y±_out
 = 0;

678 i‡((
de¸y±_ö
 & 
RX_RES_STATUS_STATION_FOUND
) ==

679 
RX_RES_STATUS_STATION_FOUND
)

680 
de¸y±_out
 |(
RX_RES_STATUS_STATION_FOUND
 |

681 
RX_RES_STATUS_NO_STATION_INFO_MISMATCH
);

683 
de¸y±_out
 |(
de¸y±_ö
 & 
RX_RES_STATUS_SEC_TYPE_MSK
);

686 i‡((
de¸y±_ö
 & 
RX_RES_STATUS_SEC_TYPE_MSK
) ==

687 
RX_RES_STATUS_SEC_TYPE_NONE
)

688  
de¸y±_out
;

691 i‡((
de¸y±_ö
 & 
RX_RES_STATUS_SEC_TYPE_MSK
) ==

692 
RX_RES_STATUS_SEC_TYPE_ERR
)

693  
de¸y±_out
;

696 i‡((
de¸y±_ö
 & 
RX_MPDU_RES_STATUS_DEC_DONE_MSK
) !=

697 
RX_MPDU_RES_STATUS_DEC_DONE_MSK
)

698  
de¸y±_out
;

700 
de¸y±_ö
 & 
RX_RES_STATUS_SEC_TYPE_MSK
) {

702 
RX_RES_STATUS_SEC_TYPE_CCMP
:

704 i‡(!(
de¸y±_ö
 & 
RX_MPDU_RES_STATUS_MIC_OK
))

706 
de¸y±_out
 |
RX_RES_STATUS_BAD_ICV_MIC
;

708 
de¸y±_out
 |
RX_RES_STATUS_DECRYPT_OK
;

712 
RX_RES_STATUS_SEC_TYPE_TKIP
:

713 i‡(!(
de¸y±_ö
 & 
RX_MPDU_RES_STATUS_TTAK_OK
)) {

715 
de¸y±_out
 |
RX_RES_STATUS_BAD_KEY_TTAK
;

718 
ÁŒthrough
;

720 i‡(!(
de¸y±_ö
 & 
RX_MPDU_RES_STATUS_ICV_OK
))

721 
de¸y±_out
 |
RX_RES_STATUS_BAD_ICV_MIC
;

723 
de¸y±_out
 |
RX_RES_STATUS_DECRYPT_OK
;

727 
	`IWL_DEBUG_RX
(
¥iv
, "decrypt_in:0x%x decrypt_out = 0x%x\n",

728 
de¸y±_ö
, 
de¸y±_out
);

730  
de¸y±_out
;

731 
	}
}

734 
	$iwœgn_ˇlc_rssi
(
iwl_¥iv
 *
¥iv
,

735 
iwl_rx_phy_ªs
 *
rx_ª•
)

740 
iwœgn_n⁄_cfg_phy
 *
n˝hy
 =

741 (
iwœgn_n⁄_cfg_phy
 *)
rx_ª•
->
n⁄_cfg_phy_buf
;

742 
u32
 
vÆ
, 
rssi_a
, 
rssi_b
, 
rssi_c
, 
max_rssi
;

743 
u8
 
agc
;

745 
vÆ
 = 
	`À32_to_˝u
(
n˝hy
->
n⁄_cfg_phy
[
IWLAGN_RX_RES_AGC_IDX
]);

746 
agc
 = (
vÆ
 & 
IWLAGN_OFDM_AGC_MSK
Ë>> 
IWLAGN_OFDM_AGC_BIT_POS
;

754 
vÆ
 = 
	`À32_to_˝u
(
n˝hy
->
n⁄_cfg_phy
[
IWLAGN_RX_RES_RSSI_AB_IDX
]);

755 
rssi_a
 = (
vÆ
 & 
IWLAGN_OFDM_RSSI_INBAND_A_BITMSK
) >>

756 
IWLAGN_OFDM_RSSI_A_BIT_POS
;

757 
rssi_b
 = (
vÆ
 & 
IWLAGN_OFDM_RSSI_INBAND_B_BITMSK
) >>

758 
IWLAGN_OFDM_RSSI_B_BIT_POS
;

759 
vÆ
 = 
	`À32_to_˝u
(
n˝hy
->
n⁄_cfg_phy
[
IWLAGN_RX_RES_RSSI_C_IDX
]);

760 
rssi_c
 = (
vÆ
 & 
IWLAGN_OFDM_RSSI_INBAND_C_BITMSK
) >>

761 
IWLAGN_OFDM_RSSI_C_BIT_POS
;

763 
max_rssi
 = 
	`max_t
(
u32
, 
rssi_a
, 
rssi_b
);

764 
max_rssi
 = 
	`max_t
(
u32
, max_rssi, 
rssi_c
);

766 
	`IWL_DEBUG_STATS
(
¥iv
, "Rssi In A %d B %d C %d Max %d AGC dB %d\n",

767 
rssi_a
, 
rssi_b
, 
rssi_c
, 
max_rssi
, 
agc
);

771  
max_rssi
 - 
agc
 - 
IWLAGN_RSSI_OFFSET
;

772 
	}
}

775 
	$iwœgn_rx_ª∂y_rx
(
iwl_¥iv
 *
¥iv
,

776 
iwl_rx_cmd_buf„r
 *
rxb
)

778 
õì80211_hdr
 *
hódî
;

779 
õì80211_rx_°©us
 
rx_°©us
 = {};

780 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

781 
iwl_rx_phy_ªs
 *
phy_ªs
;

782 
__À32
 
rx_pkt_°©us
;

783 
iwl_rx_mpdu_ªs_°¨t
 *
amsdu
;

784 
u32
 
Àn
, 
pkt_Àn
 = 
	`iwl_rx_∑ckë_Àn
(
pkt
);

785 
u32
 
ampdu_°©us
;

786 
u32
 
øã_n_Êags
;

788 i‡(!
¥iv
->
œ°_phy_ªs_vÆid
) {

789 
	`IWL_ERR
(
¥iv
, "MPDU frame without cached PHY data\n");

793 i‡(
	`u∆ikñy
(
pkt_Àn
 < (*
amsdu
))) {

794 
	`IWL_DEBUG_DROP
(
¥iv
, "Bad REPLY_RX_MPDU_CMD size\n");

798 
phy_ªs
 = &
¥iv
->
œ°_phy_ªs
;

799 
amsdu
 = (
iwl_rx_mpdu_ªs_°¨t
 *)
pkt
->
d©a
;

800 
hódî
 = (
õì80211_hdr
 *)(
pkt
->
d©a
 + (*
amsdu
));

801 
Àn
 = 
	`À16_to_˝u
(
amsdu
->
byã_cou¡
);

803 i‡(
	`u∆ikñy
(
Àn
 + (*
amsdu
Ë+ (
__À32
Ë> 
pkt_Àn
)) {

804 
	`IWL_DEBUG_DROP
(
¥iv
, "FWÜiedáboutÖacketÜen\n");

808 
rx_pkt_°©us
 = *(
__À32
 *)(
pkt
->
d©a
 + (*
amsdu
Ë+ 
Àn
);

809 
ampdu_°©us
 = 
	`iwœgn_å™¶©e_rx_°©us
(
¥iv
,

810 
	`À32_to_˝u
(
rx_pkt_°©us
));

812 i‡((
	`u∆ikñy
(
phy_ªs
->
cfg_phy_˙t
 > 20))) {

813 
	`IWL_DEBUG_DROP
(
¥iv
, "dsp size out ofÑange [0,20]: %d\n",

814 
phy_ªs
->
cfg_phy_˙t
);

818 i‡(!(
rx_pkt_°©us
 & 
RX_RES_STATUS_NO_CRC32_ERROR
) ||

819 !(
rx_pkt_°©us
 & 
RX_RES_STATUS_NO_RXE_OVERFLOW
)) {

820 
	`IWL_DEBUG_RX
(
¥iv
, "Bad CRC or FIFO: 0x%08X.\n",

821 
	`À32_to_˝u
(
rx_pkt_°©us
));

826 
øã_n_Êags
 = 
	`À32_to_˝u
(
phy_ªs
->rate_n_flags);

829 
rx_°©us
.
ma˘ime
 = 
	`À64_to_˝u
(
phy_ªs
->
time°amp
);

830 
rx_°©us
.
b™d
 = (
phy_ªs
->
phy_Êags
 & 
RX_RES_PHY_FLAGS_BAND_24_MSK
) ?

831 
NL80211_BAND_2GHZ
 : 
NL80211_BAND_5GHZ
;

832 
rx_°©us
.
‰eq
 =

833 
	`õì80211_ch™√l_to_‰equícy
(
	`À16_to_˝u
(
phy_ªs
->
ch™√l
),

834 
rx_°©us
.
b™d
);

835 
rx_°©us
.
øã_idx
 =

836 
	`iwœgn_hwøã_to_mac80211_idx
(
øã_n_Êags
, 
rx_°©us
.
b™d
);

837 
rx_°©us
.
Êag
 = 0;

843 
¥iv
->
ucode_bóc⁄_time
 = 
	`À32_to_˝u
(
phy_ªs
->
bóc⁄_time_°amp
);

846 
rx_°©us
.
sig«l
 = 
	`iwœgn_ˇlc_rssi
(
¥iv
, 
phy_ªs
);

848 
	`IWL_DEBUG_STATS_LIMIT
(
¥iv
, "Rssi %d, TSF %llu\n",

849 
rx_°©us
.
sig«l
, (Ïx_°©us.
ma˘ime
);

864 
rx_°©us
.
™ã¬a
 =

865 (
	`À16_to_˝u
(
phy_ªs
->
phy_Êags
Ë& 
RX_RES_PHY_FLAGS_ANTENNA_MSK
)

866 >> 
RX_RES_PHY_FLAGS_ANTENNA_POS
;

869 i‡(
phy_ªs
->
phy_Êags
 & 
RX_RES_PHY_FLAGS_SHORT_PREAMBLE_MSK
)

870 
rx_°©us
.
íc_Êags
 |
RX_ENC_FLAG_SHORTPRE
;

872 i‡(
phy_ªs
->
phy_Êags
 & 
RX_RES_PHY_FLAGS_AGG_MSK
) {

878 
rx_°©us
.
Êag
 |
RX_FLAG_AMPDU_DETAILS
;

879 
rx_°©us
.
ampdu_ª„ªn˚
 = 
¥iv
->
ampdu_ªf
;

883 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK
)

884 
rx_°©us
.
ícodög
 = 
RX_ENC_HT
;

885 i‡(
øã_n_Êags
 & 
RATE_MCS_HT40_MSK
)

886 
rx_°©us
.
bw
 = 
RATE_INFO_BW_40
;

888 
rx_°©us
.
bw
 = 
RATE_INFO_BW_20
;

889 i‡(
øã_n_Êags
 & 
RATE_MCS_SGI_MSK
)

890 
rx_°©us
.
íc_Êags
 |
RX_ENC_FLAG_SHORT_GI
;

891 i‡(
øã_n_Êags
 & 
RATE_MCS_GF_MSK
)

892 
rx_°©us
.
íc_Êags
 |
RX_ENC_FLAG_HT_GF
;

894 
	`iwœgn_∑ss_∑ckë_to_mac80211
(
¥iv
, 
hódî
, 
Àn
, 
ampdu_°©us
,

895 
rxb
, &
rx_°©us
);

896 
	}
}

898 
	$iwœgn_rx_nﬂ_nŸifiˇti⁄
(
iwl_¥iv
 *
¥iv
,

899 
iwl_rx_cmd_buf„r
 *
rxb
)

901 
iwl_wù™_nﬂ_d©a
 *
√w_d©a
, *
ﬁd_d©a
;

902 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

903 
iwl_wù™_nﬂ_nŸifiˇti⁄
 *
nﬂ_nŸif
 = (*)
pkt
->
d©a
;

906 
ﬁd_d©a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
¥iv
->
nﬂ_d©a
, 
åue
);

908 i‡(
nﬂ_nŸif
->
nﬂ_a˘ive
) {

909 
u32
 
Àn
 = 
	`À16_to_˝u
(
nﬂ_nŸif
->
nﬂ_©åibuã
.
Àngth
);

910 
u32
 
c›yÀn
 = 
Àn
;

913 
Àn
 += 1 + 1 + 3 + 1;

915 
Àn
 += 1 + 2;

916 
c›yÀn
 += 1 + 2;

918 
√w_d©a
 = 
	`kmÆloc
(
	`°ru˘_size
“ew_d©a, 
d©a
, 
Àn
), 
GFP_ATOMIC
);

919 i‡(
√w_d©a
) {

920 
√w_d©a
->
Àngth
 = 
Àn
;

921 
√w_d©a
->
d©a
[0] = 
WLAN_EID_VENDOR_SPECIFIC
;

922 
√w_d©a
->
d©a
[1] = 
Àn
 - 2;

923 
√w_d©a
->
d©a
[2] = (
WLAN_OUI_WFA
 >> 16) & 0xff;

924 
√w_d©a
->
d©a
[3] = (
WLAN_OUI_WFA
 >> 8) & 0xff;

925 
√w_d©a
->
d©a
[4] = (
WLAN_OUI_WFA
 >> 0) & 0xff;

926 
√w_d©a
->
d©a
[5] = 
WLAN_OUI_TYPE_WFA_P2P
;

927 
	`mem˝y
(&
√w_d©a
->
d©a
[6], &
nﬂ_nŸif
->
nﬂ_©åibuã
,

928 
c›yÀn
);

931 
√w_d©a
 = 
NULL
;

933 
	`rcu_assign_poöãr
(
¥iv
->
nﬂ_d©a
, 
√w_d©a
);

935 i‡(
ﬁd_d©a
)

936 
	`k‰ì_rcu
(
ﬁd_d©a
, 
rcu_hód
);

937 
	}
}

945 
	$iwl_£tup_rx_h™dÀrs
(
iwl_¥iv
 *
¥iv
)

947 (**
h™dÀrs
)(
iwl_¥iv
 *
¥iv
, 
iwl_rx_cmd_buf„r
 *
rxb
);

949 
h™dÀrs
 = 
¥iv
->
rx_h™dÀrs
;

951 
h™dÀrs
[
REPLY_ERROR
] = 
iwœgn_rx_ª∂y_îr‹
;

952 
h™dÀrs
[
CHANNEL_SWITCH_NOTIFICATION
] = 
iwœgn_rx_cß
;

953 
h™dÀrs
[
SPECTRUM_MEASURE_NOTIFICATION
] =

954 
iwœgn_rx_•e˘rum_mósuª_nŸif
;

955 
h™dÀrs
[
PM_SLEEP_NOTIFICATION
] = 
iwœgn_rx_pm_¶ìp_nŸif
;

956 
h™dÀrs
[
PM_DEBUG_STATISTIC_NOTIFIC
] =

957 
iwœgn_rx_pm_debug_°©i°ics_nŸif
;

958 
h™dÀrs
[
BEACON_NOTIFICATION
] = 
iwœgn_rx_bóc⁄_nŸif
;

959 
h™dÀrs
[
REPLY_ADD_STA
] = 
iwl_add_°a_ˇŒback
;

961 
h™dÀrs
[
REPLY_WIPAN_NOA_NOTIFICATION
] = 
iwœgn_rx_nﬂ_nŸifiˇti⁄
;

968 
h™dÀrs
[
REPLY_STATISTICS_CMD
] = 
iwœgn_rx_ª∂y_°©i°ics
;

969 
h™dÀrs
[
STATISTICS_NOTIFICATION
] = 
iwœgn_rx_°©i°ics
;

971 
	`iwl_£tup_rx_sˇn_h™dÀrs
(
¥iv
);

973 
h™dÀrs
[
CARD_STATE_NOTIFICATION
] = 
iwœgn_rx_ˇrd_°©e_nŸif
;

974 
h™dÀrs
[
MISSED_BEACONS_NOTIFICATION
] =

975 
iwœgn_rx_mis£d_bóc⁄_nŸif
;

978 
h™dÀrs
[
REPLY_RX_PHY_CMD
] = 
iwœgn_rx_ª∂y_rx_phy
;

979 
h™dÀrs
[
REPLY_RX_MPDU_CMD
] = 
iwœgn_rx_ª∂y_rx
;

982 
h™dÀrs
[
REPLY_COMPRESSED_BA
] =

983 
iwœgn_rx_ª∂y_com¥es£d_ba
;

985 
¥iv
->
rx_h™dÀrs
[
REPLY_TX
] = 
iwœgn_rx_ª∂y_tx
;

988 
	`iwl_nŸifiˇti⁄_waô_öô
(&
¥iv
->
nŸif_waô
);

991 i‡(
¥iv
->
lib
->
bt_∑øms
)

992 
	`iwœgn_bt_rx_h™dÀr_£tup
(
¥iv
);

993 
	}
}

995 
	$iwl_rx_di•©ch
(
iwl_›_mode
 *
›_mode
, 
«pi_°ru˘
 *
«pi
,

996 
iwl_rx_cmd_buf„r
 *
rxb
)

998 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

999 
iwl_¥iv
 *
¥iv
 = 
	`IWL_OP_MODE_GET_DVM
(
›_mode
);

1006 
	`iwl_nŸifiˇti⁄_waô_nŸify
(&
¥iv
->
nŸif_waô
, 
pkt
);

1011 i‡(
¥iv
->
rx_h™dÀrs
[
pkt
->
hdr
.
cmd
]) {

1012 
¥iv
->
rx_h™dÀrs_°©s
[
pkt
->
hdr
.
cmd
]++;

1013 
¥iv
->
rx_h™dÀrs
[
pkt
->
hdr
.
cmd
]’riv, 
rxb
);

1016 
	`IWL_DEBUG_RX
(
¥iv
, "No handlerÇeeded for %s, 0x%02x\n",

1017 
	`iwl_gë_cmd_°rög
(
¥iv
->
å™s
,

1018 
	`WIDE_ID
(0, 
pkt
->
hdr
.
cmd
)),

1019 
pkt
->
hdr
.
cmd
);

1021 
	}
}

	@dvm/rxon.c

8 
	~<löux/ëhîdevi˚.h
>

9 
	~"iwl-å™s.h
"

10 
	~"iwl-mod∑øms.h
"

11 
	~"dev.h
"

12 
	~"agn.h
"

13 
	~"ˇlib.h
"

18 
	$iwl_c⁄√˘i⁄_öô_rx_c⁄fig
(
iwl_¥iv
 *
¥iv
,

19 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

21 
	`mem£t
(&
˘x
->
°agög
, 0, (ctx->staging));

23 i‡(!
˘x
->
vif
) {

24 
˘x
->
°agög
.
dev_ty≥
 = ctx->
unu£d_devty≥
;

26 
˘x
->
vif
->
ty≥
) {

27 
NL80211_IFTYPE_AP
:

28 
˘x
->
°agög
.
dev_ty≥
 = ctx->
≠_devty≥
;

31 
NL80211_IFTYPE_STATION
:

32 
˘x
->
°agög
.
dev_ty≥
 = ctx->
°©i⁄_devty≥
;

33 
˘x
->
°agög
.
fûãr_Êags
 = 
RXON_FILTER_ACCEPT_GRP_MSK
;

36 
NL80211_IFTYPE_ADHOC
:

37 
˘x
->
°agög
.
dev_ty≥
 = ctx->
ibss_devty≥
;

38 
˘x
->
°agög
.
Êags
 = 
RXON_FLG_SHORT_PREAMBLE_MSK
;

39 
˘x
->
°agög
.
fûãr_Êags
 = 
RXON_FILTER_BCON_AWARE_MSK
 |

40 
RXON_FILTER_ACCEPT_GRP_MSK
;

43 
NL80211_IFTYPE_MONITOR
:

44 
˘x
->
°agög
.
dev_ty≥
 = 
RXON_DEV_TYPE_SNIFFER
;

48 
	`IWL_ERR
(
¥iv
, "Unsupported interfaceÅype %d\n",

49 
˘x
->
vif
->
ty≥
);

56 i‡(!
	`hw_to_loˇl
(
¥iv
->
hw
)->
sh‹t_¥ómbÀ
)

57 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_SHORT_PREAMBLE_MSK
;

59 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SHORT_PREAMBLE_MSK
;

62 
˘x
->
°agög
.
ch™√l
 =

63 
	`˝u_to_À16
(
¥iv
->
hw
->
c⁄f
.
ch™def
.
ch™
->
hw_vÆue
);

64 
¥iv
->
b™d
 =Öriv->
hw
->
c⁄f
.
ch™def
.
ch™
->band;

66 
	`iwl_£t_Êags_f‹_b™d
(
¥iv
, 
˘x
,Öriv->
b™d
, ctx->
vif
);

69 
˘x
->
°agög
.
Êags
 &~(
RXON_FLG_CHANNEL_MODE_MIXED
 |

70 
RXON_FLG_CHANNEL_MODE_PURE_40
);

71 i‡(
˘x
->
vif
)

72 
	`mem˝y
(
˘x
->
°agög
.
node_addr
, ctx->
vif
->
addr
, 
ETH_ALEN
);

74 
˘x
->
°agög
.
ofdm_ht_sögÀ_°ªam_basic_øãs
 = 0xff;

75 
˘x
->
°agög
.
ofdm_ht_duÆ_°ªam_basic_øãs
 = 0xff;

76 
˘x
->
°agög
.
ofdm_ht_åùÀ_°ªam_basic_øãs
 = 0xff;

77 
	}
}

79 
	$iwœgn_dißbÀ_bss
(
iwl_¥iv
 *
¥iv
,

80 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

81 
iwl_rx⁄_cmd
 *
£nd
)

83 
__À32
 
ﬁd_fûãr
 = 
£nd
->
fûãr_Êags
;

84 
ªt
;

86 
£nd
->
fûãr_Êags
 &~
RXON_FILTER_ASSOC_MSK
;

87 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
rx⁄_cmd
,

88 0, (*
£nd
), send);

90 
£nd
->
fûãr_Êags
 = 
ﬁd_fûãr
;

92 i‡(
ªt
)

93 
	`IWL_DEBUG_QUIET_RFKILL
(
¥iv
,

94 "Eº‹ cÀ¨ög ASSOC_MSK o¿BSS (%d)\n", 
ªt
);

96  
ªt
;

97 
	}
}

99 
	$iwœgn_dißbÀ_∑n
(
iwl_¥iv
 *
¥iv
,

100 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

101 
iwl_rx⁄_cmd
 *
£nd
)

103 
iwl_nŸifiˇti⁄_waô
 
dißbÀ_waô
;

104 
__À32
 
ﬁd_fûãr
 = 
£nd
->
fûãr_Êags
;

105 
u8
 
ﬁd_dev_ty≥
 = 
£nd
->
dev_ty≥
;

106 
ªt
;

107 c⁄° 
u16
 
dó˘iv©e_cmd
[] = {

108 
REPLY_WIPAN_DEACTIVATION_COMPLETE


111 
	`iwl_öô_nŸifiˇti⁄_waô
(&
¥iv
->
nŸif_waô
, &
dißbÀ_waô
,

112 
dó˘iv©e_cmd
, 
	`ARRAY_SIZE
(deactivate_cmd),

113 
NULL
, NULL);

115 
£nd
->
fûãr_Êags
 &~
RXON_FILTER_ASSOC_MSK
;

116 
£nd
->
dev_ty≥
 = 
RXON_DEV_TYPE_P2P
;

117 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
rx⁄_cmd
,

118 0, (*
£nd
), send);

120 
£nd
->
fûãr_Êags
 = 
ﬁd_fûãr
;

121 
£nd
->
dev_ty≥
 = 
ﬁd_dev_ty≥
;

123 i‡(
ªt
) {

124 
	`IWL_ERR
(
¥iv
, "Eº‹ dißblög PAN (%d)\n", 
ªt
);

125 
	`iwl_ªmove_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
, &
dißbÀ_waô
);

127 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
,

128 &
dißbÀ_waô
, 
HZ
);

129 i‡(
ªt
)

130 
	`IWL_ERR
(
¥iv
, "Timed out waiting for PAN disable\n");

133  
ªt
;

134 
	}
}

136 
	$iwœgn_disc⁄n_∑n
(
iwl_¥iv
 *
¥iv
,

137 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

138 
iwl_rx⁄_cmd
 *
£nd
)

140 
__À32
 
ﬁd_fûãr
 = 
£nd
->
fûãr_Êags
;

141 
ªt
;

143 
£nd
->
fûãr_Êags
 &~
RXON_FILTER_ASSOC_MSK
;

144 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
rx⁄_cmd
, 0,

145 (*
£nd
), send);

147 
£nd
->
fûãr_Êags
 = 
ﬁd_fûãr
;

149  
ªt
;

150 
	}
}

152 
	$iwœgn_upd©e_qos
(
iwl_¥iv
 *
¥iv
,

153 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

155 
ªt
;

157 i‡(!
˘x
->
is_a˘ive
)

160 
˘x
->
qos_d©a
.
def_qos_∑rm
.
qos_Êags
 = 0;

162 i‡(
˘x
->
qos_d©a
.
qos_a˘ive
)

163 
˘x
->
qos_d©a
.
def_qos_∑rm
.
qos_Êags
 |=

164 
QOS_PARAM_FLG_UPDATE_EDCA_MSK
;

166 i‡(
˘x
->
ht
.
íabÀd
)

167 
˘x
->
qos_d©a
.
def_qos_∑rm
.
qos_Êags
 |
QOS_PARAM_FLG_TGN_MSK
;

169 
	`IWL_DEBUG_INFO
(
¥iv
, "send QoS cmd with Qosáctive=%d FLAGS=0x%X\n",

170 
˘x
->
qos_d©a
.
qos_a˘ive
,

171 
˘x
->
qos_d©a
.
def_qos_∑rm
.
qos_Êags
);

173 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
qos_cmd
, 0,

174 (
iwl_qo•¨am_cmd
),

175 &
˘x
->
qos_d©a
.
def_qos_∑rm
);

176 i‡(
ªt
)

177 
	`IWL_DEBUG_QUIET_RFKILL
(
¥iv
, "FailedÅo update QoS\n");

178 
	}
}

180 
	$iwœgn_upd©e_bóc⁄
(
iwl_¥iv
 *
¥iv
,

181 
õì80211_vif
 *
vif
)

183 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

185 
	`dev_k‰ì_skb
(
¥iv
->
bóc⁄_skb
);

186 
¥iv
->
bóc⁄_skb
 = 
	`õì80211_bóc⁄_gë
’riv->
hw
, 
vif
, 0);

187 i‡(!
¥iv
->
bóc⁄_skb
)

188  -
ENOMEM
;

189  
	`iwœgn_£nd_bóc⁄_cmd
(
¥iv
);

190 
	}
}

192 
	$iwœgn_£nd_rx⁄_assoc
(
iwl_¥iv
 *
¥iv
,

193 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

195 
ªt
 = 0;

196 
iwl_rx⁄_assoc_cmd
 
rx⁄_assoc
;

197 c⁄° 
iwl_rx⁄_cmd
 *
rx⁄1
 = &
˘x
->
°agög
;

198 c⁄° 
iwl_rx⁄_cmd
 *
rx⁄2
 = &
˘x
->
a˘ive
;

200 i‡((
rx⁄1
->
Êags
 =
rx⁄2
->flags) &&

201 (
rx⁄1
->
fûãr_Êags
 =
rx⁄2
->filter_flags) &&

202 (
rx⁄1
->
cck_basic_øãs
 =
rx⁄2
->cck_basic_rates) &&

203 (
rx⁄1
->
ofdm_ht_sögÀ_°ªam_basic_øãs
 ==

204 
rx⁄2
->
ofdm_ht_sögÀ_°ªam_basic_øãs
) &&

205 (
rx⁄1
->
ofdm_ht_duÆ_°ªam_basic_øãs
 ==

206 
rx⁄2
->
ofdm_ht_duÆ_°ªam_basic_øãs
) &&

207 (
rx⁄1
->
ofdm_ht_åùÀ_°ªam_basic_øãs
 ==

208 
rx⁄2
->
ofdm_ht_åùÀ_°ªam_basic_øãs
) &&

209 (
rx⁄1
->
acquisôi⁄_d©a
 =
rx⁄2
->acquisition_data) &&

210 (
rx⁄1
->
rx_chaö
 =
rx⁄2
->rx_chain) &&

211 (
rx⁄1
->
ofdm_basic_øãs
 =
rx⁄2
->ofdm_basic_rates)) {

212 
	`IWL_DEBUG_INFO
(
¥iv
, "Using current RXON_ASSOC. NotÑesending.\n");

216 
rx⁄_assoc
.
Êags
 = 
˘x
->
°agög
.flags;

217 
rx⁄_assoc
.
fûãr_Êags
 = 
˘x
->
°agög
.filter_flags;

218 
rx⁄_assoc
.
ofdm_basic_øãs
 = 
˘x
->
°agög
.ofdm_basic_rates;

219 
rx⁄_assoc
.
cck_basic_øãs
 = 
˘x
->
°agög
.cck_basic_rates;

220 
rx⁄_assoc
.
ª£rved1
 = 0;

221 
rx⁄_assoc
.
ª£rved2
 = 0;

222 
rx⁄_assoc
.
ª£rved3
 = 0;

223 
rx⁄_assoc
.
ofdm_ht_sögÀ_°ªam_basic_øãs
 =

224 
˘x
->
°agög
.
ofdm_ht_sögÀ_°ªam_basic_øãs
;

225 
rx⁄_assoc
.
ofdm_ht_duÆ_°ªam_basic_øãs
 =

226 
˘x
->
°agög
.
ofdm_ht_duÆ_°ªam_basic_øãs
;

227 
rx⁄_assoc
.
rx_chaö_£À˘_Êags
 = 
˘x
->
°agög
.
rx_chaö
;

228 
rx⁄_assoc
.
ofdm_ht_åùÀ_°ªam_basic_øãs
 =

229 
˘x
->
°agög
.
ofdm_ht_åùÀ_°ªam_basic_øãs
;

230 
rx⁄_assoc
.
acquisôi⁄_d©a
 = 
˘x
->
°agög
.acquisition_data;

232 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
rx⁄_assoc_cmd
,

233 
CMD_ASYNC
, (
rx⁄_assoc
), &rxon_assoc);

234  
ªt
;

235 
	}
}

237 
u16
 
	$iwl_adju°_bóc⁄_öãrvÆ
(
u16
 
bóc⁄_vÆ
, u16 
max_bóc⁄_vÆ
)

239 
u16
 
√w_vÆ
;

240 
u16
 
bóc⁄_Á˘‹
;

248 i‡(!
bóc⁄_vÆ
)

249  
DEFAULT_BEACON_INTERVAL
;

263 
bóc⁄_Á˘‹
 = (
bóc⁄_vÆ
 + 
max_bóc⁄_vÆ
) / max_beacon_val;

264 
√w_vÆ
 = 
bóc⁄_vÆ
 / 
bóc⁄_Á˘‹
;

266 i‡(!
√w_vÆ
)

267 
√w_vÆ
 = 
max_bóc⁄_vÆ
;

269  
√w_vÆ
;

270 
	}
}

272 
	$iwl_£nd_rx⁄_timög
(
iwl_¥iv
 *
¥iv
,

273 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

275 
u64
 
tsf
;

276 
s32
 
öãrvÆ_tm
, 
ªm
;

277 
õì80211_c⁄f
 *
c⁄f
 = 
NULL
;

278 
u16
 
bóc⁄_öt
;

279 
õì80211_vif
 *
vif
 = 
˘x
->vif;

281 
c⁄f
 = &
¥iv
->
hw
->conf;

283 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

285 
	`mem£t
(&
˘x
->
timög
, 0, (
iwl_rx⁄_time_cmd
));

287 
˘x
->
timög
.
time°amp
 = 
	`˝u_to_À64
(
¥iv
->timestamp);

288 
˘x
->
timög
.
li°í_öãrvÆ
 = 
	`˝u_to_À16
(
c⁄f
->listen_interval);

290 
bóc⁄_öt
 = 
vif
 ? vif->
bss_c⁄f
.beacon_int : 0;

296 
˘x
->
timög
.
©im_wödow
 = 0;

298 i‡(
˘x
->
˘xid
 =
IWL_RXON_CTX_PAN
 &&

299 (!
˘x
->
vif
 || ctx->vif->
ty≥
 !
NL80211_IFTYPE_STATION
) &&

300 
	`iwl_is_assocüãd
(
¥iv
, 
IWL_RXON_CTX_BSS
) &&

301 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
vif
 &&

302 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
vif
->
bss_c⁄f
.
bóc⁄_öt
) {

303 
˘x
->
timög
.
bóc⁄_öãrvÆ
 =

304 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
timög
.
bóc⁄_öãrvÆ
;

305 
bóc⁄_öt
 = 
	`À16_to_˝u
(
˘x
->
timög
.
bóc⁄_öãrvÆ
);

306 } i‡(
˘x
->
˘xid
 =
IWL_RXON_CTX_BSS
 &&

307 
	`iwl_is_assocüãd
(
¥iv
, 
IWL_RXON_CTX_PAN
) &&

308 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
vif
 &&

309 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
vif
->
bss_c⁄f
.
bóc⁄_öt
 &&

310 (!
	`iwl_is_assocüãd_˘x
(
˘x
Ë|| !˘x->
vif
 ||

311 !
˘x
->
vif
->
bss_c⁄f
.
bóc⁄_öt
)) {

312 
˘x
->
timög
.
bóc⁄_öãrvÆ
 =

313 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
].
timög
.
bóc⁄_öãrvÆ
;

314 
bóc⁄_öt
 = 
	`À16_to_˝u
(
˘x
->
timög
.
bóc⁄_öãrvÆ
);

316 
bóc⁄_öt
 = 
	`iwl_adju°_bóc⁄_öãrvÆ
(beacon_int,

317 
IWL_MAX_UCODE_BEACON_INTERVAL
 * 
TIME_UNIT
);

318 
˘x
->
timög
.
bóc⁄_öãrvÆ
 = 
	`˝u_to_À16
(
bóc⁄_öt
);

321 
˘x
->
bóc⁄_öt
 = beacon_int;

323 
tsf
 = 
¥iv
->
time°amp
;

324 
öãrvÆ_tm
 = 
bóc⁄_öt
 * 
TIME_UNIT
;

325 
ªm
 = 
	`do_div
(
tsf
, 
öãrvÆ_tm
);

326 
˘x
->
timög
.
bóc⁄_öô_vÆ
 = 
	`˝u_to_À32
(
öãrvÆ_tm
 - 
ªm
);

328 
˘x
->
timög
.
dtim_≥riod
 = 
vif
 ? (vif->
bss_c⁄f
.dtim_period ?: 1) : 1;

330 
	`IWL_DEBUG_ASSOC
(
¥iv
,

332 
	`À16_to_˝u
(
˘x
->
timög
.
bóc⁄_öãrvÆ
),

333 
	`À32_to_˝u
(
˘x
->
timög
.
bóc⁄_öô_vÆ
),

334 
	`À16_to_˝u
(
˘x
->
timög
.
©im_wödow
));

336  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
rx⁄_timög_cmd
,

337 0, (
˘x
->
timög
), &ctx->timing);

338 
	}
}

340 
	$iwœgn_rx⁄_disc⁄n
(
iwl_¥iv
 *
¥iv
,

341 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

343 
ªt
;

344 
iwl_rx⁄_cmd
 *
a˘ive
 = (*)&
˘x
->active;

346 i‡(
˘x
->
˘xid
 =
IWL_RXON_CTX_BSS
) {

347 
ªt
 = 
	`iwœgn_dißbÀ_bss
(
¥iv
, 
˘x
, &˘x->
°agög
);

349 
ªt
 = 
	`iwœgn_dißbÀ_∑n
(
¥iv
, 
˘x
, &˘x->
°agög
);

350 i‡(
ªt
)

351  
ªt
;

352 i‡(
˘x
->
vif
) {

353 
ªt
 = 
	`iwl_£nd_rx⁄_timög
(
¥iv
, 
˘x
);

354 i‡(
ªt
) {

355 
	`IWL_ERR
(
¥iv
, "FaûedÅÿ£ndÅimög (%d)!\n", 
ªt
);

356  
ªt
;

358 
ªt
 = 
	`iwœgn_disc⁄n_∑n
(
¥iv
, 
˘x
, &˘x->
°agög
);

361 i‡(
ªt
)

362  
ªt
;

368 
	`iwl_˛ór_ucode_°©i⁄s
(
¥iv
, 
˘x
);

370 
	`iwl_upd©e_bˇ°_°©i⁄
(
¥iv
, 
˘x
);

371 
	`iwl_ª°‹e_°©i⁄s
(
¥iv
, 
˘x
);

372 
ªt
 = 
	`iwl_ª°‹e_deÁu…_wï_keys
(
¥iv
, 
˘x
);

373 i‡(
ªt
) {

374 
	`IWL_ERR
(
¥iv
, "FaûedÅÿª°‹êWEP key†(%d)\n", 
ªt
);

375  
ªt
;

378 
	`mem˝y
(
a˘ive
, &
˘x
->
°agög
, (*active));

380 
	}
}

382 
	$iwl_£t_tx_powî
(
iwl_¥iv
 *
¥iv
, 
s8
 
tx_powî
, 
boﬁ
 
f‹˚
)

384 
ªt
;

385 
s8
 
¥ev_tx_powî
;

386 
boﬁ
 
de„r
;

387 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

389 i‡(
¥iv
->
ˇlib_dißbÀd
 & 
IWL_TX_POWER_CALIB_DISABLED
)

392 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

394 i‡(
¥iv
->
tx_powî_u£r_lmt
 =
tx_powî
 && !
f‹˚
)

397 i‡(
tx_powî
 < 
IWLAGN_TX_POWER_TARGET_POWER_MIN
) {

398 
	`IWL_WARN
(
¥iv
,

400 
tx_powî
,

401 
IWLAGN_TX_POWER_TARGET_POWER_MIN
);

402  -
EINVAL
;

405 i‡(
tx_powî
 > 
	`DIV_ROUND_UP
(
¥iv
->
nvm_d©a
->
max_tx_pwr_hÆf_dbm
, 2)) {

406 
	`IWL_WARN
(
¥iv
,

408 
tx_powî
, 
¥iv
->
nvm_d©a
->
max_tx_pwr_hÆf_dbm
);

409  -
EINVAL
;

412 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

413  -
EIO
;

417 
¥iv
->
tx_powî_√xt
 = 
tx_powî
;

420 
de„r
 = 
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
) ||

421 
	`memcmp
(&
˘x
->
a˘ive
, &˘x->
°agög
, (ctx->staging));

422 i‡(
de„r
 && !
f‹˚
) {

423 
	`IWL_DEBUG_INFO
(
¥iv
, "DeferringÅxÖower set\n");

427 
¥ev_tx_powî
 = 
¥iv
->
tx_powî_u£r_lmt
;

428 
¥iv
->
tx_powî_u£r_lmt
 = 
tx_powî
;

430 
ªt
 = 
	`iwœgn_£nd_tx_powî
(
¥iv
);

433 i‡(
ªt
) {

434 
¥iv
->
tx_powî_u£r_lmt
 = 
¥ev_tx_powî
;

435 
¥iv
->
tx_powî_√xt
 = 
¥ev_tx_powî
;

437  
ªt
;

438 
	}
}

440 
	$iwœgn_rx⁄_c⁄√˘
(
iwl_¥iv
 *
¥iv
,

441 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

443 
ªt
;

444 
iwl_rx⁄_cmd
 *
a˘ive
 = (*)&
˘x
->active;

447 i‡(
˘x
->
˘xid
 =
IWL_RXON_CTX_BSS
) {

448 
ªt
 = 
	`iwl_£nd_rx⁄_timög
(
¥iv
, 
˘x
);

449 i‡(
ªt
) {

450 
	`IWL_ERR
(
¥iv
, "FaûedÅÿ£ndÅimög (%d)!\n", 
ªt
);

451  
ªt
;

455 
	`iwœgn_upd©e_qos
(
¥iv
, 
˘x
);

462 i‡(
˘x
->
vif
 && (˘x->vif->
ty≥
 =
NL80211_IFTYPE_AP
)) {

463 
ªt
 = 
	`iwœgn_upd©e_bóc⁄
(
¥iv
, 
˘x
->
vif
);

464 i‡(
ªt
) {

465 
	`IWL_ERR
(
¥iv
,

467 
ªt
);

468  
ªt
;

472 
¥iv
->
°¨t_ˇlib
 = 0;

479 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
˘x
->
rx⁄_cmd
, 0,

480 (
iwl_rx⁄_cmd
), &
˘x
->
°agög
);

481 i‡(
ªt
) {

482 
	`IWL_ERR
(
¥iv
, "Eº‹ sëtögÇew RXON (%d)\n", 
ªt
);

483  
ªt
;

485 
	`mem˝y
(
a˘ive
, &
˘x
->
°agög
, (*active));

488 i‡(
˘x
->
vif
 && (˘x->vif->
ty≥
 =
NL80211_IFTYPE_ADHOC
))

489 i‡(
	`iwœgn_upd©e_bóc⁄
(
¥iv
, 
˘x
->
vif
))

490 
	`IWL_ERR
(
¥iv
, "Error sending IBSS beacon\n");

491 
	`iwl_öô_£nsôivôy
(
¥iv
);

500 
ªt
 = 
	`iwl_£t_tx_powî
(
¥iv
,Öriv->
tx_powî_√xt
, 
åue
);

501 i‡(
ªt
) {

502 
	`IWL_ERR
(
¥iv
, "Eº‹ sídög TXÖowî (%d)\n", 
ªt
);

503  
ªt
;

507 
	}
}

509 
	$iwœgn_£t_∑n_∑øms
(
iwl_¥iv
 *
¥iv
)

511 
iwl_wù™_∑øms_cmd
 
cmd
;

512 
iwl_rx⁄_c⁄ãxt
 *
˘x_bss
, *
˘x_∑n
;

513 
¶Ÿ0
 = 300, 
¶Ÿ1
 = 0;

514 
ªt
;

516 i‡(
¥iv
->
vÆid_c⁄ãxts
 =
	`BIT
(
IWL_RXON_CTX_BSS
))

519 
	`BUILD_BUG_ON
(
NUM_IWL_RXON_CTX
 != 2);

521 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

523 
˘x_bss
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

524 
˘x_∑n
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_PAN
];

532 i‡(!
˘x_∑n
->
is_a˘ive
)

535 
	`mem£t
(&
cmd
, 0, (cmd));

538 
cmd
.
num_¶Ÿs
 = 2;

540 
cmd
.
¶Ÿs
[0].
ty≥
 = 0;

541 
cmd
.
¶Ÿs
[1].
ty≥
 = 1;

543 i‡(
˘x_bss
->
vif
 && 
˘x_∑n
->vif) {

544 
b˙öt
 = 
˘x_∑n
->
bóc⁄_öt
;

545 
dtim
 = 
˘x_∑n
->
vif
->
bss_c⁄f
.
dtim_≥riod
 ?: 1;

548 
cmd
.
Êags
 |
	`˝u_to_À16
(
IWL_WIPAN_PARAMS_FLG_SLOTTED_MODE
);

550 i‡(
˘x_∑n
->
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 &&

551 
b˙öt
 &&

552 
b˙öt
 !
˘x_bss
->
bóc⁄_öt
) {

553 
	`IWL_ERR
(
¥iv
,

555 
˘x_bss
->
bóc⁄_öt
, 
˘x_∑n
->beacon_int);

557 
b˙öt
 = 
	`max_t
(, bcnint,

558 
˘x_bss
->
bóc⁄_öt
);

559 i‡(!
b˙öt
)

560 
b˙öt
 = 
DEFAULT_BEACON_INTERVAL
;

561 
¶Ÿ0
 = 
b˙öt
 / 2;

562 
¶Ÿ1
 = 
b˙öt
 - 
¶Ÿ0
;

564 i‡(
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
) ||

565 (!
˘x_bss
->
vif
->
cfg
.
idÀ
 &&

566 !
˘x_bss
->
vif
->
cfg
.
assoc
)) {

567 
¶Ÿ0
 = 
dtim
 * 
b˙öt
 * 3 - 
IWL_MIN_SLOT_TIME
;

568 
¶Ÿ1
 = 
IWL_MIN_SLOT_TIME
;

569 } i‡(!
˘x_∑n
->
vif
->
cfg
.
idÀ
 &&

570 !
˘x_∑n
->
vif
->
cfg
.
assoc
) {

571 
¶Ÿ1
 = 
dtim
 * 
b˙öt
 * 3 - 
IWL_MIN_SLOT_TIME
;

572 
¶Ÿ0
 = 
IWL_MIN_SLOT_TIME
;

574 } i‡(
˘x_∑n
->
vif
) {

575 
¶Ÿ0
 = 0;

576 
¶Ÿ1
 = 
	`max_t
(, 1, 
˘x_∑n
->
vif
->
bss_c⁄f
.
dtim_≥riod
) *

577 
˘x_∑n
->
bóc⁄_öt
;

578 
¶Ÿ1
 = 
	`max_t
(, 
DEFAULT_BEACON_INTERVAL
, slot1);

580 i‡(
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
)) {

581 
¶Ÿ0
 = 
¶Ÿ1
 * 3 - 
IWL_MIN_SLOT_TIME
;

582 
¶Ÿ1
 = 
IWL_MIN_SLOT_TIME
;

586 
cmd
.
¶Ÿs
[0].
width
 = 
	`˝u_to_À16
(
¶Ÿ0
);

587 
cmd
.
¶Ÿs
[1].
width
 = 
	`˝u_to_À16
(
¶Ÿ1
);

589 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
, 
REPLY_WIPAN_PARAMS
, 0,

590 (
cmd
), &cmd);

591 i‡(
ªt
)

592 
	`IWL_ERR
(
¥iv
, "Eº‹ sëtög PANÖ¨amëî†(%d)\n", 
ªt
);

594  
ªt
;

595 
	}
}

597 
	$_iwl_£t_rx⁄_ht
(
iwl_¥iv
 *
¥iv
,

598 
iwl_ht_c⁄fig
 *
ht_c⁄f
,

599 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

601 
iwl_rx⁄_cmd
 *
rx⁄
 = &
˘x
->
°agög
;

603 i‡(!
˘x
->
ht
.
íabÀd
) {

604 
rx⁄
->
Êags
 &~(
RXON_FLG_CHANNEL_MODE_MSK
 |

605 
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
 |

606 
RXON_FLG_HT40_PROT_MSK
 |

607 
RXON_FLG_HT_PROT_MSK
);

614 
rx⁄
->
Êags
 |
	`˝u_to_À32
(
˘x
->
ht
.
¥Ÿe˘i⁄
 <<

615 
RXON_FLG_HT_OPERATING_MODE_POS
);

620 
rx⁄
->
Êags
 &~(
RXON_FLG_CHANNEL_MODE_MSK
 |

621 
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
);

622 i‡(
	`iwl_is_ht40_tx_Ælowed
(
¥iv
, 
˘x
, 
NULL
)) {

624 i‡(
˘x
->
ht
.
¥Ÿe˘i⁄
 ==

625 
IEEE80211_HT_OP_MODE_PROTECTION_20MHZ
) {

626 
rx⁄
->
Êags
 |
RXON_FLG_CHANNEL_MODE_PURE_40
;

631 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
) {

632 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
:

633 
rx⁄
->
Êags
 &=

634 ~
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
;

636 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
:

637 
rx⁄
->
Êags
 |=

638 
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
;

646 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
) {

647 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
:

648 
rx⁄
->
Êags
 &=

649 ~(
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
);

650 
rx⁄
->
Êags
 |
RXON_FLG_CHANNEL_MODE_MIXED
;

652 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
:

653 
rx⁄
->
Êags
 |
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
;

654 
rx⁄
->
Êags
 |
RXON_FLG_CHANNEL_MODE_MIXED
;

656 
IEEE80211_HT_PARAM_CHA_SEC_NONE
:

662 
	`IWL_ERR
(
¥iv
,

668 
rx⁄
->
Êags
 |
RXON_FLG_CHANNEL_MODE_LEGACY
;

671 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

673 
	`IWL_DEBUG_ASSOC
(
¥iv
, "rxon flags 0x%X operation mode :0x%X "

675 
	`À32_to_˝u
(
rx⁄
->
Êags
), 
˘x
->
ht
.
¥Ÿe˘i⁄
,

676 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
);

677 
	}
}

679 
	$iwl_£t_rx⁄_ht
(
iwl_¥iv
 *
¥iv
, 
iwl_ht_c⁄fig
 *
ht_c⁄f
)

681 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

683 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
)

684 
	`_iwl_£t_rx⁄_ht
(
¥iv
, 
ht_c⁄f
, 
˘x
);

685 
	}
}

694 
	$iwl_£t_rx⁄_ch™√l
(
iwl_¥iv
 *
¥iv
, 
õì80211_ch™√l
 *
ch
,

695 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

697 
∆80211_b™d
 
b™d
 = 
ch
->band;

698 
u16
 
ch™√l
 = 
ch
->
hw_vÆue
;

700 i‡((
	`À16_to_˝u
(
˘x
->
°agög
.
ch™√l
) == channel) &&

701 (
¥iv
->
b™d
 == band))

704 
˘x
->
°agög
.
ch™√l
 = 
	`˝u_to_À16
(channel);

705 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

706 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_BAND_24G_MSK
;

708 
˘x
->
°agög
.
Êags
 |
RXON_FLG_BAND_24G_MSK
;

710 
¥iv
->
b™d
 = band;

712 
	`IWL_DEBUG_INFO
(
¥iv
, "Sègög ch™√»£àtÿ%d [%d]\n", 
ch™√l
, 
b™d
);

714 
	}
}

716 
	$iwl_£t_Êags_f‹_b™d
(
iwl_¥iv
 *
¥iv
,

717 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

718 
∆80211_b™d
 
b™d
,

719 
õì80211_vif
 *
vif
)

721 i‡(
b™d
 =
NL80211_BAND_5GHZ
) {

722 
˘x
->
°agög
.
Êags
 &=

723 ~(
RXON_FLG_BAND_24G_MSK
 | 
RXON_FLG_AUTO_DETECT_MSK


724 | 
RXON_FLG_CCK_MSK
);

725 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SHORT_SLOT_MSK
;

728 i‡(
vif
 && vif->
bss_c⁄f
.
u£_sh‹t_¶Ÿ
)

729 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SHORT_SLOT_MSK
;

731 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_SHORT_SLOT_MSK
;

733 
˘x
->
°agög
.
Êags
 |
RXON_FLG_BAND_24G_MSK
;

734 
˘x
->
°agög
.
Êags
 |
RXON_FLG_AUTO_DETECT_MSK
;

735 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_CCK_MSK
;

737 
	}
}

739 
	$iwl_£t_rx⁄_hw¸y±o
(
iwl_¥iv
 *
¥iv
,

740 
iwl_rx⁄_c⁄ãxt
 *
˘x
, 
hw_de¸y±
)

742 
iwl_rx⁄_cmd
 *
rx⁄
 = &
˘x
->
°agög
;

744 i‡(
hw_de¸y±
)

745 
rx⁄
->
fûãr_Êags
 &~
RXON_FILTER_DIS_DECRYPT_MSK
;

747 
rx⁄
->
fûãr_Êags
 |
RXON_FILTER_DIS_DECRYPT_MSK
;

749 
	}
}

752 
	$iwl_check_rx⁄_cmd
(
iwl_¥iv
 *
¥iv
,

753 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

755 
iwl_rx⁄_cmd
 *
rx⁄
 = &
˘x
->
°agög
;

756 
u32
 
îr‹s
 = 0;

758 i‡(
rx⁄
->
Êags
 & 
RXON_FLG_BAND_24G_MSK
) {

759 i‡(
rx⁄
->
Êags
 & 
RXON_FLG_TGJ_NARROW_BAND_MSK
) {

760 
	`IWL_WARN
(
¥iv
, "check 2.4G: wrongÇarrow\n");

761 
îr‹s
 |
	`BIT
(0);

763 i‡(
rx⁄
->
Êags
 & 
RXON_FLG_RADAR_DETECT_MSK
) {

764 
	`IWL_WARN
(
¥iv
, "check 2.4G: wrongÑadar\n");

765 
îr‹s
 |
	`BIT
(1);

768 i‡(!(
rx⁄
->
Êags
 & 
RXON_FLG_SHORT_SLOT_MSK
)) {

769 
	`IWL_WARN
(
¥iv
, "check 5.2G:Çot short slot!\n");

770 
îr‹s
 |
	`BIT
(2);

772 i‡(
rx⁄
->
Êags
 & 
RXON_FLG_CCK_MSK
) {

773 
	`IWL_WARN
(
¥iv
, "check 5.2G: CCK!\n");

774 
îr‹s
 |
	`BIT
(3);

777 i‡((
rx⁄
->
node_addr
[0] |Ñx⁄->
bssid_addr
[0]) & 0x1) {

778 
	`IWL_WARN
(
¥iv
, "mac/bssid mcast!\n");

779 
îr‹s
 |
	`BIT
(4);

783 i‡((
rx⁄
->
ofdm_basic_øãs
 & 
IWL_RATE_6M_MASK
) == 0 &&

784 (
rx⁄
->
cck_basic_øãs
 & 
IWL_RATE_1M_MASK
) == 0) {

785 
	`IWL_WARN
(
¥iv
, "neither 1Çor 6áre basic\n");

786 
îr‹s
 |
	`BIT
(5);

789 i‡(
	`À16_to_˝u
(
rx⁄
->
assoc_id
) > 2007) {

790 
	`IWL_WARN
(
¥iv
, "aid > 2007\n");

791 
îr‹s
 |
	`BIT
(6);

794 i‡((
rx⁄
->
Êags
 & (
RXON_FLG_CCK_MSK
 | 
RXON_FLG_SHORT_SLOT_MSK
))

795 =(
RXON_FLG_CCK_MSK
 | 
RXON_FLG_SHORT_SLOT_MSK
)) {

796 
	`IWL_WARN
(
¥iv
, "CCKánd short slot\n");

797 
îr‹s
 |
	`BIT
(7);

800 i‡((
rx⁄
->
Êags
 & (
RXON_FLG_CCK_MSK
 | 
RXON_FLG_AUTO_DETECT_MSK
))

801 =(
RXON_FLG_CCK_MSK
 | 
RXON_FLG_AUTO_DETECT_MSK
)) {

802 
	`IWL_WARN
(
¥iv
, "CCKándáuto detect\n");

803 
îr‹s
 |
	`BIT
(8);

806 i‡((
rx⁄
->
Êags
 & (
RXON_FLG_AUTO_DETECT_MSK
 |

807 
RXON_FLG_TGG_PROTECT_MSK
)) ==

808 
RXON_FLG_TGG_PROTECT_MSK
) {

809 
	`IWL_WARN
(
¥iv
, "TGg butÇoáuto-detect\n");

810 
îr‹s
 |
	`BIT
(9);

813 i‡(
rx⁄
->
ch™√l
 == 0) {

814 
	`IWL_WARN
(
¥iv
, "zero channel is invalid\n");

815 
îr‹s
 |
	`BIT
(10);

818 
	`WARN
(
îr‹s
, "Invalid RXON (%#x), channel %d",

819 
îr‹s
, 
	`À16_to_˝u
(
rx⁄
->
ch™√l
));

821  
îr‹s
 ? -
EINVAL
 : 0;

822 
	}
}

832 
	$iwl_fuŒ_rx⁄_ªquúed
(
iwl_¥iv
 *
¥iv
,

833 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

835 c⁄° 
iwl_rx⁄_cmd
 *
°agög
 = &
˘x
->staging;

836 c⁄° 
iwl_rx⁄_cmd
 *
a˘ive
 = &
˘x
->active;

838 
	#CHK
(
c⁄d
) \

839 i‡((
c⁄d
)) { \

840 
	`IWL_DEBUG_INFO
(
¥iv
, "need full RXON - " #cond "\n"); \

842 }

	)

844 
	#CHK_NEQ
(
c1
, 
c2
) \

845 i‡((
c1
Ë!(
c2
)) { \

846 
	`IWL_DEBUG_INFO
(
¥iv
, "need full RXON - " \

848 (
c1
), (
c2
)); \

850 }

	)

853 
	`CHK
(!
	`iwl_is_assocüãd_˘x
(
˘x
));

854 
	`CHK
(!
	`ëhî_addr_equÆ
(
°agög
->
bssid_addr
, 
a˘ive
->bssid_addr));

855 
	`CHK
(!
	`ëhî_addr_equÆ
(
°agög
->
node_addr
, 
a˘ive
->node_addr));

856 
	`CHK
(!
	`ëhî_addr_equÆ
(
°agög
->
wœp_bssid_addr
,

857 
a˘ive
->
wœp_bssid_addr
));

858 
	`CHK_NEQ
(
°agög
->
dev_ty≥
, 
a˘ive
->dev_type);

859 
	`CHK_NEQ
(
°agög
->
ch™√l
, 
a˘ive
->channel);

860 
	`CHK_NEQ
(
°agög
->
aú_¥›ag©i⁄
, 
a˘ive
->air_propagation);

861 
	`CHK_NEQ
(
°agög
->
ofdm_ht_sögÀ_°ªam_basic_øãs
,

862 
a˘ive
->
ofdm_ht_sögÀ_°ªam_basic_øãs
);

863 
	`CHK_NEQ
(
°agög
->
ofdm_ht_duÆ_°ªam_basic_øãs
,

864 
a˘ive
->
ofdm_ht_duÆ_°ªam_basic_øãs
);

865 
	`CHK_NEQ
(
°agög
->
ofdm_ht_åùÀ_°ªam_basic_øãs
,

866 
a˘ive
->
ofdm_ht_åùÀ_°ªam_basic_øãs
);

867 
	`CHK_NEQ
(
°agög
->
assoc_id
, 
a˘ive
->assoc_id);

874 
	`CHK_NEQ
(
°agög
->
Êags
 & 
RXON_FLG_BAND_24G_MSK
,

875 
a˘ive
->
Êags
 & 
RXON_FLG_BAND_24G_MSK
);

878 
	`CHK_NEQ
(
°agög
->
fûãr_Êags
 & 
RXON_FILTER_ASSOC_MSK
,

879 
a˘ive
->
fûãr_Êags
 & 
RXON_FILTER_ASSOC_MSK
);

881 #unde‡
CHK


882 #unde‡
CHK_NEQ


885 
	}
}

887 #ifde‡
CONFIG_IWLWIFI_DEBUG


888 
	$iwl_¥öt_rx_c⁄fig_cmd
(
iwl_¥iv
 *
¥iv
,

889 
iwl_rx⁄_c⁄ãxt_id
 
˘xid
)

891 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
˘xid
];

892 
iwl_rx⁄_cmd
 *
rx⁄
 = &
˘x
->
°agög
;

894 
	`IWL_DEBUG_RADIO
(
¥iv
, "RX CONFIG:\n");

895 
	`iwl_¥öt_hex_dump
(
¥iv
, 
IWL_DL_RADIO
, (
u8
 *Ë
rx⁄
, (*rxon));

896 
	`IWL_DEBUG_RADIO
(
¥iv
, "u16 channel: 0x%x\n",

897 
	`À16_to_˝u
(
rx⁄
->
ch™√l
));

898 
	`IWL_DEBUG_RADIO
(
¥iv
, "u32 flags: 0x%08X\n",

899 
	`À32_to_˝u
(
rx⁄
->
Êags
));

900 
	`IWL_DEBUG_RADIO
(
¥iv
, "u32 filter_flags: 0x%08x\n",

901 
	`À32_to_˝u
(
rx⁄
->
fûãr_Êags
));

902 
	`IWL_DEBUG_RADIO
(
¥iv
, "u8 dev_ty≥: 0x%x\n", 
rx⁄
->
dev_ty≥
);

903 
	`IWL_DEBUG_RADIO
(
¥iv
, "u8 ofdm_basic_rates: 0x%02x\n",

904 
rx⁄
->
ofdm_basic_øãs
);

905 
	`IWL_DEBUG_RADIO
(
¥iv
, "u8 cck_basic_rates: 0x%02x\n",

906 
rx⁄
->
cck_basic_øãs
);

907 
	`IWL_DEBUG_RADIO
(
¥iv
, "u8[6]Çode_addr: %pM\n", 
rx⁄
->
node_addr
);

908 
	`IWL_DEBUG_RADIO
(
¥iv
, "u8[6] bssid_addr: %pM\n", 
rx⁄
->
bssid_addr
);

909 
	`IWL_DEBUG_RADIO
(
¥iv
, "u16ássoc_id: 0x%x\n",

910 
	`À16_to_˝u
(
rx⁄
->
assoc_id
));

911 
	}
}

914 
	$iwl_ˇlc_basic_øãs
(
iwl_¥iv
 *
¥iv
,

915 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

917 
lowe°_¥e£¡_ofdm
 = 100;

918 
lowe°_¥e£¡_cck
 = 100;

919 
u8
 
cck
 = 0;

920 
u8
 
ofdm
 = 0;

922 i‡(
˘x
->
vif
) {

923 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

924 
basic
 = 
˘x
->
vif
->
bss_c⁄f
.
basic_øãs
;

925 
i
;

927 
sb™d
 = 
¥iv
->
hw
->
wùhy
->
b™ds
[¥iv->hw->
c⁄f
.
ch™def
.
ch™
->
b™d
];

929 
	`f‹_óch_£t_bô
(
i
, &
basic
, 
BITS_PER_LONG
) {

930 
hw
 = 
sb™d
->
bôøãs
[
i
].
hw_vÆue
;

931 i‡(
hw
 >
IWL_FIRST_OFDM_RATE
) {

932 
ofdm
 |
	`BIT
(
hw
 - 
IWL_FIRST_OFDM_RATE
);

933 i‡(
lowe°_¥e£¡_ofdm
 > 
hw
)

934 
lowe°_¥e£¡_ofdm
 = 
hw
;

936 
	`BUILD_BUG_ON
(
IWL_FIRST_CCK_RATE
 != 0);

938 
cck
 |
	`BIT
(
hw
);

939 i‡(
lowe°_¥e£¡_cck
 > 
hw
)

940 
lowe°_¥e£¡_cck
 = 
hw
;

968 i‡(
IWL_RATE_24M_INDEX
 < 
lowe°_¥e£¡_ofdm
)

969 
ofdm
 |
IWL_RATE_24M_MASK
 >> 
IWL_FIRST_OFDM_RATE
;

970 i‡(
IWL_RATE_12M_INDEX
 < 
lowe°_¥e£¡_ofdm
)

971 
ofdm
 |
IWL_RATE_12M_MASK
 >> 
IWL_FIRST_OFDM_RATE
;

973 
ofdm
 |
IWL_RATE_6M_MASK
 >> 
IWL_FIRST_OFDM_RATE
;

988 i‡(
IWL_RATE_11M_INDEX
 < 
lowe°_¥e£¡_cck
)

989 
cck
 |
IWL_RATE_11M_MASK
 >> 
IWL_FIRST_CCK_RATE
;

990 i‡(
IWL_RATE_5M_INDEX
 < 
lowe°_¥e£¡_cck
)

991 
cck
 |
IWL_RATE_5M_MASK
 >> 
IWL_FIRST_CCK_RATE
;

992 i‡(
IWL_RATE_2M_INDEX
 < 
lowe°_¥e£¡_cck
)

993 
cck
 |
IWL_RATE_2M_MASK
 >> 
IWL_FIRST_CCK_RATE
;

995 
cck
 |
IWL_RATE_1M_MASK
 >> 
IWL_FIRST_CCK_RATE
;

997 
	`IWL_DEBUG_RATE
(
¥iv
, "Set basicÑates cck:0x%.2x ofdm:0x%.2x\n",

998 
cck
, 
ofdm
);

1001 
˘x
->
°agög
.
cck_basic_øãs
 = 
cck
;

1002 
˘x
->
°agög
.
ofdm_basic_øãs
 = 
ofdm
;

1003 
	}
}

1023 
	$iwœgn_commô_rx⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

1026 
iwl_rx⁄_cmd
 *
a˘ive
 = (*)&
˘x
->active;

1027 
boﬁ
 
√w_assoc
 = !!(
˘x
->
°agög
.
fûãr_Êags
 & 
RXON_FILTER_ASSOC_MSK
);

1028 
ªt
;

1030 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1032 i‡(!
	`iwl_is_Æive
(
¥iv
))

1033  -
EBUSY
;

1036 
	`BUILD_BUG_ON
(
NUM_IWL_RXON_CTX
 != 2);

1038 i‡(!
˘x
->
is_a˘ive
)

1042 
˘x
->
°agög
.
Êags
 |
RXON_FLG_TSF2HOST_MSK
;

1045 
	`iwl_ˇlc_basic_øãs
(
¥iv
, 
˘x
);

1051 i‡(!
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
)

1052 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SELF_CTS_EN
;

1054 i‡((
˘x
->
vif
 && ctx->vif->
bss_c⁄f
.
u£_sh‹t_¶Ÿ
) ||

1055 !(
˘x
->
°agög
.
Êags
 & 
RXON_FLG_BAND_24G_MSK
))

1056 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SHORT_SLOT_MSK
;

1058 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_SHORT_SLOT_MSK
;

1060 
	`iwl_¥öt_rx_c⁄fig_cmd
(
¥iv
, 
˘x
->
˘xid
);

1061 
ªt
 = 
	`iwl_check_rx⁄_cmd
(
¥iv
, 
˘x
);

1062 i‡(
ªt
) {

1063 
	`IWL_ERR
(
¥iv
, "Invalid RXON configuration. Not committing.\n");

1064  -
EINVAL
;

1071 i‡(
	`ã°_bô
(
STATUS_CHANNEL_SWITCH_PENDING
, &
¥iv
->
°©us
) &&

1072 (
¥iv
->
swôch_ch™√l
 !
˘x
->
°agög
.
ch™√l
)) {

1073 
	`IWL_DEBUG_11H
(
¥iv
, "abort channel switch on %d\n",

1074 
	`À16_to_˝u
(
¥iv
->
swôch_ch™√l
));

1075 
	`iwl_chswôch_d⁄e
(
¥iv
, 
Ál£
);

1083 i‡(!
	`iwl_fuŒ_rx⁄_ªquúed
(
¥iv
, 
˘x
)) {

1084 
ªt
 = 
	`iwœgn_£nd_rx⁄_assoc
(
¥iv
, 
˘x
);

1085 i‡(
ªt
) {

1086 
	`IWL_ERR
(
¥iv
, "Eº‹ sëtög RXON_ASSOC (%d)\n", 
ªt
);

1087  
ªt
;

1090 
	`mem˝y
(
a˘ive
, &
˘x
->
°agög
, (*active));

1095 
	`iwl_£t_tx_powî
(
¥iv
,Öriv->
tx_powî_√xt
, 
Ál£
);

1098 
	`iwl_powî_upd©e_mode
(
¥iv
, 
åue
);

1103 
	`iwl_£t_rx⁄_hw¸y±o
(
¥iv
, 
˘x
, !
iwlwifi_mod_∑øms
.
sw¸y±o
);

1105 
	`IWL_DEBUG_INFO
(
¥iv
,

1110 (
√w_assoc
 ? "" : "out"),

1111 
	`À16_to_˝u
(
˘x
->
°agög
.
ch™√l
),

1112 
˘x
->
°agög
.
bssid_addr
);

1120 
ªt
 = 
	`iwœgn_rx⁄_disc⁄n
(
¥iv
, 
˘x
);

1121 i‡(
ªt
)

1122  
ªt
;

1124 
ªt
 = 
	`iwœgn_£t_∑n_∑øms
(
¥iv
);

1125 i‡(
ªt
)

1126  
ªt
;

1128 i‡(
√w_assoc
)

1129  
	`iwœgn_rx⁄_c⁄√˘
(
¥iv
, 
˘x
);

1132 
	}
}

1134 
	$iwœgn_c⁄fig_ht40
(
õì80211_c⁄f
 *
c⁄f
,

1135 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

1137 i‡(
	`c⁄f_is_ht40_möus
(
c⁄f
)) {

1138 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
 =

1139 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
;

1140 
˘x
->
ht
.
is_40mhz
 = 
åue
;

1141 } i‡(
	`c⁄f_is_ht40_∂us
(
c⁄f
)) {

1142 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
 =

1143 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
;

1144 
˘x
->
ht
.
is_40mhz
 = 
åue
;

1146 
˘x
->
ht
.
exãnsi⁄_ch™_off£t
 =

1147 
IEEE80211_HT_PARAM_CHA_SEC_NONE
;

1148 
˘x
->
ht
.
is_40mhz
 = 
Ál£
;

1150 
	}
}

1152 
	$iwœgn_mac_c⁄fig
(
õì80211_hw
 *
hw
, 
u32
 
ch™ged
)

1154 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1155 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

1156 
õì80211_c⁄f
 *
c⁄f
 = &
hw
->conf;

1157 
õì80211_ch™√l
 *
ch™√l
 = 
c⁄f
->
ch™def
.
ch™
;

1158 
ªt
 = 0;

1160 
	`IWL_DEBUG_MAC80211
(
¥iv
, "íãr: ch™ged %#x\n", 
ch™ged
);

1162 
	`muãx_lock
(&
¥iv
->
muãx
);

1164 i‡(
	`u∆ikñy
(
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
))) {

1165 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave - scanning\n");

1166 
out
;

1169 i‡(!
	`iwl_is_ªady
(
¥iv
)) {

1170 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave -ÇotÑeady\n");

1171 
out
;

1174 i‡(
ch™ged
 & (
IEEE80211_CONF_CHANGE_SMPS
 |

1175 
IEEE80211_CONF_CHANGE_CHANNEL
)) {

1177 
¥iv
->
cuºít_ht_c⁄fig
.
smps
 = 
c⁄f
->
smps_mode
;

1186 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
)

1187 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

1190 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_CHANNEL
) {

1191 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

1193 i‡(
˘x
->
ht
.
íabÀd
 !
	`c⁄f_is_ht
(
c⁄f
))

1194 
˘x
->
ht
.
íabÀd
 = 
	`c⁄f_is_ht
(
c⁄f
);

1196 i‡(
˘x
->
ht
.
íabÀd
) {

1199 i‡(!
˘x
->
ht
.
is_40mhz
 ||

1200 !
	`iwl_is_assocüãd_˘x
(
˘x
))

1201 
	`iwœgn_c⁄fig_ht40
(
c⁄f
, 
˘x
);

1203 
˘x
->
ht
.
is_40mhz
 = 
Ál£
;

1209 
˘x
->
ht
.
¥Ÿe˘i⁄
 = 
IEEE80211_HT_OP_MODE_PROTECTION_NONE
;

1214 i‡(
	`À16_to_˝u
(
˘x
->
°agög
.
ch™√l
) !=

1215 
ch™√l
->
hw_vÆue
)

1216 
˘x
->
°agög
.
Êags
 = 0;

1218 
	`iwl_£t_rx⁄_ch™√l
(
¥iv
, 
ch™√l
, 
˘x
);

1219 
	`iwl_£t_rx⁄_ht
(
¥iv
, &¥iv->
cuºít_ht_c⁄fig
);

1221 
	`iwl_£t_Êags_f‹_b™d
(
¥iv
, 
˘x
, 
ch™√l
->
b™d
,

1222 
˘x
->
vif
);

1225 
	`iwl_upd©e_bˇ°_°©i⁄s
(
¥iv
);

1228 i‡(
ch™ged
 & (
IEEE80211_CONF_CHANGE_PS
 |

1229 
IEEE80211_CONF_CHANGE_IDLE
)) {

1230 
ªt
 = 
	`iwl_powî_upd©e_mode
(
¥iv
, 
Ál£
);

1231 i‡(
ªt
)

1232 
	`IWL_DEBUG_MAC80211
(
¥iv
, "Error setting sleepÜevel\n");

1235 i‡(
ch™ged
 & 
IEEE80211_CONF_CHANGE_POWER
) {

1236 
	`IWL_DEBUG_MAC80211
(
¥iv
, "TX Power old=%dÇew=%d\n",

1237 
¥iv
->
tx_powî_u£r_lmt
, 
c⁄f
->
powî_Àvñ
);

1239 
	`iwl_£t_tx_powî
(
¥iv
, 
c⁄f
->
powî_Àvñ
, 
Ál£
);

1242 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

1243 i‡(!
	`memcmp
(&
˘x
->
°agög
, &˘x->
a˘ive
, (ctx->staging)))

1245 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

1247 
out
:

1248 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1249 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave\n");

1251  
ªt
;

1252 
	}
}

1254 
	$iwœgn_check_√eded_chaös
(
iwl_¥iv
 *
¥iv
,

1255 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

1256 
õì80211_bss_c⁄f
 *
bss_c⁄f
)

1258 
õì80211_vif
 *
vif
 = 
˘x
->vif;

1259 
iwl_rx⁄_c⁄ãxt
 *
tmp
;

1260 
õì80211_°a
 *
°a
;

1261 
iwl_ht_c⁄fig
 *
ht_c⁄f
 = &
¥iv
->
cuºít_ht_c⁄fig
;

1262 
õì80211_°a_ht_ˇp
 *
ht_ˇp
;

1263 
boﬁ
 
√ed_mu…ùÀ
;

1265 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1267 
vif
->
ty≥
) {

1268 
NL80211_IFTYPE_STATION
:

1269 
	`rcu_ªad_lock
();

1270 
°a
 = 
	`õì80211_föd_°a
(
vif
, 
bss_c⁄f
->
bssid
);

1271 i‡(!
°a
) {

1278 
√ed_mu…ùÀ
 = 
Ál£
;

1279 
	`rcu_ªad_u∆ock
();

1283 
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

1285 
√ed_mu…ùÀ
 = 
åue
;

1291 i‡(
ht_ˇp
->
mcs
.
rx_mask
[1] == 0 &&

1292 
ht_ˇp
->
mcs
.
rx_mask
[2] == 0) {

1293 
√ed_mu…ùÀ
 = 
Ál£
;

1294 } i‡(!(
ht_ˇp
->
mcs
.
tx_∑øms
 &

1295 
IEEE80211_HT_MCS_TX_DEFINED
)) {

1297 
√ed_mu…ùÀ
 = 
Ál£
;

1298 } i‡(
ht_ˇp
->
mcs
.
tx_∑øms
 &

1299 
IEEE80211_HT_MCS_TX_RX_DIFF
) {

1300 
max°ªams
;

1309 
max°ªams
 = (
ht_ˇp
->
mcs
.
tx_∑øms
 &

1310 
IEEE80211_HT_MCS_TX_MAX_STREAMS_MASK
);

1311 
max°ªams
 >>=

1312 
IEEE80211_HT_MCS_TX_MAX_STREAMS_SHIFT
;

1313 
max°ªams
 += 1;

1315 i‡(
max°ªams
 <= 1)

1316 
√ed_mu…ùÀ
 = 
Ál£
;

1319 
	`rcu_ªad_u∆ock
();

1321 
NL80211_IFTYPE_ADHOC
:

1323 
√ed_mu…ùÀ
 = 
Ál£
;

1327 
√ed_mu…ùÀ
 = 
åue
;

1331 
˘x
->
ht_√ed_mu…ùÀ_chaös
 = 
√ed_mu…ùÀ
;

1333 i‡(!
√ed_mu…ùÀ
) {

1335 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
tmp
) {

1336 i‡(!
tmp
->
vif
)

1338 i‡(
tmp
->
ht_√ed_mu…ùÀ_chaös
) {

1339 
√ed_mu…ùÀ
 = 
åue
;

1345 
ht_c⁄f
->
sögÀ_chaö_sufficõ¡
 = !
√ed_mu…ùÀ
;

1346 
	}
}

1348 
	$iwœgn_chaö_noi£_ª£t
(
iwl_¥iv
 *
¥iv
)

1350 
iwl_chaö_noi£_d©a
 *
d©a
 = &
¥iv
->
chaö_noi£_d©a
;

1351 
ªt
;

1353 i‡(
¥iv
->
ˇlib_dißbÀd
 & 
IWL_CHAIN_NOISE_CALIB_DISABLED
)

1356 i‡((
d©a
->
°©e
 =
IWL_CHAIN_NOISE_ALIVE
) &&

1357 
	`iwl_is_™y_assocüãd
(
¥iv
)) {

1358 
iwl_ˇlib_chaö_noi£_ª£t_cmd
 
cmd
;

1361 
d©a
->
chaö_noi£_a
 = 0;

1362 
d©a
->
chaö_noi£_b
 = 0;

1363 
d©a
->
chaö_noi£_c
 = 0;

1364 
d©a
->
chaö_sig«l_a
 = 0;

1365 
d©a
->
chaö_sig«l_b
 = 0;

1366 
d©a
->
chaö_sig«l_c
 = 0;

1367 
d©a
->
bóc⁄_cou¡
 = 0;

1369 
	`mem£t
(&
cmd
, 0, (cmd));

1370 
	`iwl_£t_ˇlib_hdr
(&
cmd
.
hdr
,

1371 
¥iv
->
phy_ˇlib_chaö_noi£_ª£t_cmd
);

1372 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

1373 
REPLY_PHY_CALIBRATION_CMD
,

1374 0, (
cmd
), &cmd);

1375 i‡(
ªt
)

1376 
	`IWL_ERR
(
¥iv
,

1378 
d©a
->
°©e
 = 
IWL_CHAIN_NOISE_ACCUMULATE
;

1379 
	`IWL_DEBUG_CALIB
(
¥iv
, "Run chain_noise_calibrate\n");

1381 
	}
}

1383 
	$iwœgn_bss_öfo_ch™ged
(
õì80211_hw
 *
hw
,

1384 
õì80211_vif
 *
vif
,

1385 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

1386 
u64
 
ch™ges
)

1388 
iwl_¥iv
 *
¥iv
 = 
	`IWL_MAC80211_GET_DVM
(
hw
);

1389 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

1390 
ªt
;

1391 
boﬁ
 
f‹˚
 = 
Ál£
;

1393 
	`muãx_lock
(&
¥iv
->
muãx
);

1395 i‡(
ch™ges
 & 
BSS_CHANGED_IDLE
 && 
vif
->
cfg
.
idÀ
) {

1400 
	`iwœgn_li·_∑ssive_no_rx
(
¥iv
);

1403 i‡(
	`u∆ikñy
(!
	`iwl_is_ªady
(
¥iv
))) {

1404 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave -ÇotÑeady\n");

1405 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1409 i‡(
	`u∆ikñy
(!
˘x
->
vif
)) {

1410 
	`IWL_DEBUG_MAC80211
(
¥iv
, "leave - vif is NULL\n");

1411 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1415 i‡(
ch™ges
 & 
BSS_CHANGED_BEACON_INT
)

1416 
f‹˚
 = 
åue
;

1418 i‡(
ch™ges
 & 
BSS_CHANGED_QOS
) {

1419 
˘x
->
qos_d©a
.
qos_a˘ive
 = 
bss_c⁄f
->
qos
;

1420 
	`iwœgn_upd©e_qos
(
¥iv
, 
˘x
);

1423 
˘x
->
°agög
.
assoc_id
 = 
	`˝u_to_À16
(
vif
->
cfg
.
aid
);

1424 i‡(
vif
->
bss_c⁄f
.
u£_sh‹t_¥ómbÀ
)

1425 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SHORT_PREAMBLE_MSK
;

1427 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_SHORT_PREAMBLE_MSK
;

1429 i‡(
ch™ges
 & 
BSS_CHANGED_ASSOC
) {

1430 i‡(
vif
->
cfg
.
assoc
) {

1431 
¥iv
->
time°amp
 = 
bss_c⁄f
->
sync_tsf
;

1432 
˘x
->
°agög
.
fûãr_Êags
 |
RXON_FILTER_ASSOC_MSK
;

1434 
˘x
->
°agög
.
fûãr_Êags
 &~
RXON_FILTER_ASSOC_MSK
;

1436 i‡(
˘x
->
˘xid
 =
IWL_RXON_CTX_BSS
)

1437 
¥iv
->
have_ªkey_d©a
 = 
Ál£
;

1440 
	`iwœgn_bt_c€x_rssi_m⁄ô‹
(
¥iv
);

1443 i‡(
˘x
->
ht
.
íabÀd
) {

1444 
˘x
->
ht
.
¥Ÿe˘i⁄
 = 
bss_c⁄f
->
ht_›î©i⁄_mode
 &

1445 
IEEE80211_HT_OP_MODE_PROTECTION
;

1446 
˘x
->
ht
.
n⁄_gf_°a_¥e£¡
 = !!(
bss_c⁄f
->
ht_›î©i⁄_mode
 &

1447 
IEEE80211_HT_OP_MODE_NON_GF_STA_PRSNT
);

1448 
	`iwœgn_check_√eded_chaös
(
¥iv
, 
˘x
, 
bss_c⁄f
);

1449 
	`iwl_£t_rx⁄_ht
(
¥iv
, &¥iv->
cuºít_ht_c⁄fig
);

1452 
	`iwœgn_£t_rx⁄_chaö
(
¥iv
, 
˘x
);

1454 i‡(
bss_c⁄f
->
u£_˘s_¥Ÿ
 && (
¥iv
->
b™d
 !
NL80211_BAND_5GHZ
))

1455 
˘x
->
°agög
.
Êags
 |
RXON_FLG_TGG_PROTECT_MSK
;

1457 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_TGG_PROTECT_MSK
;

1459 i‡(
bss_c⁄f
->
u£_˘s_¥Ÿ
)

1460 
˘x
->
°agög
.
Êags
 |
RXON_FLG_SELF_CTS_EN
;

1462 
˘x
->
°agög
.
Êags
 &~
RXON_FLG_SELF_CTS_EN
;

1464 
	`mem˝y
(
˘x
->
°agög
.
bssid_addr
, 
bss_c⁄f
->
bssid
, 
ETH_ALEN
);

1466 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1467 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

1468 i‡(
vif
->
bss_c⁄f
.
íabÀ_bóc⁄
) {

1469 
˘x
->
°agög
.
fûãr_Êags
 |
RXON_FILTER_ASSOC_MSK
;

1470 
¥iv
->
bóc⁄_˘x
 = 
˘x
;

1472 
˘x
->
°agög
.
fûãr_Êags
 &~
RXON_FILTER_ASSOC_MSK
;

1473 
¥iv
->
bóc⁄_˘x
 = 
NULL
;

1485 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

1486 i‡(!
vif
->
cfg
.
assoc
)

1487 
˘x
->
°agög
.
fûãr_Êags
 |
RXON_FILTER_BCON_AWARE_MSK
;

1489 
˘x
->
°agög
.
fûãr_Êags
 &=

1490 ~
RXON_FILTER_BCON_AWARE_MSK
;

1493 i‡(
f‹˚
 || 
	`memcmp
(&
˘x
->
°agög
, &˘x->
a˘ive
, (ctx->staging)))

1494 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

1496 i‡(
ch™ges
 & 
BSS_CHANGED_ASSOC
 && 
vif
->
cfg
.
assoc
) {

1502 i‡(
¥iv
->
chaö_noi£_d©a
.
°©e
 =
IWL_CHAIN_NOISE_DONE
)

1503 
	`iwl_powî_upd©e_mode
(
¥iv
, 
Ál£
);

1506 
	`iwœgn_chaö_noi£_ª£t
(
¥iv
);

1507 
¥iv
->
°¨t_ˇlib
 = 1;

1510 i‡(
ch™ges
 & 
BSS_CHANGED_IBSS
) {

1511 
ªt
 = 
	`iwœgn_m™age_ibss_°©i⁄
(
¥iv
, 
vif
,

1512 
vif
->
cfg
.
ibss_joöed
);

1513 i‡(
ªt
)

1514 
	`IWL_ERR
(
¥iv
, "failedÅo %s IBSS station %pM\n",

1515 
vif
->
cfg
.
ibss_joöed
 ? "add" : "remove",

1516 
bss_c⁄f
->
bssid
);

1519 i‡(
ch™ges
 & 
BSS_CHANGED_BEACON
 && 
¥iv
->
bóc⁄_˘x
 =
˘x
) {

1520 i‡(
	`iwœgn_upd©e_bóc⁄
(
¥iv
, 
vif
))

1521 
	`IWL_ERR
(
¥iv
, "Error updating beacon\n");

1524 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1525 
	}
}

1527 
	$iwœgn_po°_sˇn
(
iwl_¥iv
 *
¥iv
)

1529 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

1535 
	`iwl_powî_£t_mode
(
¥iv
, &¥iv->
powî_d©a
.
¶ìp_cmd_√xt
, 
Ál£
);

1536 
	`iwl_£t_tx_powî
(
¥iv
,Öriv->
tx_powî_√xt
, 
Ál£
);

1542 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
)

1543 i‡(
	`memcmp
(&
˘x
->
°agög
, &˘x->
a˘ive
, (ctx->staging)))

1544 
	`iwœgn_commô_rx⁄
(
¥iv
, 
˘x
);

1546 
	`iwœgn_£t_∑n_∑øms
(
¥iv
);

1547 
	}
}

	@dvm/scan.c

7 
	~<löux/¶ab.h
>

8 
	~<löux/ty≥s.h
>

9 
	~<löux/ëhîdevi˚.h
>

10 
	~<√t/mac80211.h
>

12 
	~"dev.h
"

13 
	~"agn.h
"

18 
	#IWL_ACTIVE_DWELL_TIME_24
 (30Ë

	)

19 
	#IWL_ACTIVE_DWELL_TIME_52
 (20)

	)

21 
	#IWL_ACTIVE_DWELL_FACTOR_24GHZ
 (3)

	)

22 
	#IWL_ACTIVE_DWELL_FACTOR_52GHZ
 (2)

	)

27 
	#IWL_PASSIVE_DWELL_TIME_24
 (20Ë

	)

28 
	#IWL_PASSIVE_DWELL_TIME_52
 (10)

	)

29 
	#IWL_PASSIVE_DWELL_BASE
 (100)

	)

30 
	#IWL_CHANNEL_TUNE_TIME
 5

	)

31 
	#MAX_SCAN_CHANNEL
 50

	)

34 
	#IWL_RADIO_RESET_DWELL_TIME
 5

	)

36 
	$iwl_£nd_sˇn_ab‹t
(
iwl_¥iv
 *
¥iv
)

38 
ªt
;

39 
iwl_ho°_cmd
 
cmd
 = {

40 .
id
 = 
REPLY_SCAN_ABORT_CMD
,

41 .
Êags
 = 
CMD_WANT_SKB
,

43 
__À32
 *
°©us
;

48 i‡(!
	`ã°_bô
(
STATUS_READY
, &
¥iv
->
°©us
) ||

49 !
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
) ||

50 
	`ã°_bô
(
STATUS_FW_ERROR
, &
¥iv
->
°©us
))

51  -
EIO
;

53 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

54 i‡(
ªt
)

55  
ªt
;

57 
°©us
 = (*)
cmd
.
ª•_pkt
->
d©a
;

58 i‡(*
°©us
 !
CAN_ABORT_STATUS
) {

65 
	`IWL_DEBUG_SCAN
(
¥iv
, "SCAN_ABORTÑet %d.\n",

66 
	`À32_to_˝u
(*
°©us
));

67 
ªt
 = -
EIO
;

70 
	`iwl_‰ì_ª•
(&
cmd
);

71  
ªt
;

72 
	}
}

74 
	$iwl_com∂ëe_sˇn
(
iwl_¥iv
 *
¥iv
, 
boﬁ
 
ab‹ãd
)

76 
cfg80211_sˇn_öfo
 
öfo
 = {

77 .
ab‹ãd
 =áborted,

81 i‡(
¥iv
->
sˇn_ªque°
) {

82 
	`IWL_DEBUG_SCAN
(
¥iv
, "Complete scan in mac80211\n");

83 
	`õì80211_sˇn_com∂ëed
(
¥iv
->
hw
, &
öfo
);

86 
¥iv
->
sˇn_ty≥
 = 
IWL_SCAN_NORMAL
;

87 
¥iv
->
sˇn_vif
 = 
NULL
;

88 
¥iv
->
sˇn_ªque°
 = 
NULL
;

89 
	}
}

91 
	$iwl_¥o˚ss_sˇn_com∂ëe
(
iwl_¥iv
 *
¥iv
)

93 
boﬁ
 
ab‹ãd
;

95 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

97 i‡(!
	`ã°_™d_˛ór_bô
(
STATUS_SCAN_COMPLETE
, &
¥iv
->
°©us
))

100 
	`IWL_DEBUG_SCAN
(
¥iv
, "Completed scan.\n");

102 
	`ˇn˚l_dñayed_w‹k
(&
¥iv
->
sˇn_check
);

104 
ab‹ãd
 = 
	`ã°_™d_˛ór_bô
(
STATUS_SCAN_ABORTING
, &
¥iv
->
°©us
);

105 i‡(
ab‹ãd
)

106 
	`IWL_DEBUG_SCAN
(
¥iv
, "Aborted scan completed.\n");

108 i‡(!
	`ã°_™d_˛ór_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
)) {

109 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scanálready completed.\n");

110 
out_£âögs
;

113 i‡(
¥iv
->
sˇn_ty≥
 !
IWL_SCAN_NORMAL
 && !
ab‹ãd
) {

114 
îr
;

117 i‡(
¥iv
->
sˇn_ªque°
 =
NULL
)

118 
out_com∂ëe
;

121 
îr
 = 
	`iwl_sˇn_öôüã
(
¥iv
,Öriv->
sˇn_vif
, 
IWL_SCAN_NORMAL
,

122 
¥iv
->
sˇn_ªque°
->
ch™√ls
[0]->
b™d
);

123 i‡(
îr
) {

124 
	`IWL_DEBUG_SCAN
(
¥iv
,

125 "ÁûedÅÿöôüãÖídög sˇn: %d\n", 
îr
);

126 
ab‹ãd
 = 
åue
;

127 
out_com∂ëe
;

133 
out_com∂ëe
:

134 
	`iwl_com∂ëe_sˇn
(
¥iv
, 
ab‹ãd
);

136 
out_£âögs
:

138 i‡(!
	`iwl_is_ªady_rf
(
¥iv
))

141 
	`iwœgn_po°_sˇn
(
¥iv
);

142 
	}
}

144 
	$iwl_f‹˚_sˇn_íd
(
iwl_¥iv
 *
¥iv
)

146 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

148 i‡(!
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
)) {

149 
	`IWL_DEBUG_SCAN
(
¥iv
, "Forcing scanÉnd whileÇot scanning\n");

153 
	`IWL_DEBUG_SCAN
(
¥iv
, "Forcing scanÉnd\n");

154 
	`˛ór_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
);

155 
	`˛ór_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
);

156 
	`˛ór_bô
(
STATUS_SCAN_ABORTING
, &
¥iv
->
°©us
);

157 
	`˛ór_bô
(
STATUS_SCAN_COMPLETE
, &
¥iv
->
°©us
);

158 
	`iwl_com∂ëe_sˇn
(
¥iv
, 
åue
);

159 
	}
}

161 
	$iwl_do_sˇn_ab‹t
(
iwl_¥iv
 *
¥iv
)

163 
ªt
;

165 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

167 i‡(!
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
)) {

168 
	`IWL_DEBUG_SCAN
(
¥iv
, "NotÖerforming scanÅoábort\n");

172 i‡(
	`ã°_™d_£t_bô
(
STATUS_SCAN_ABORTING
, &
¥iv
->
°©us
)) {

173 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scanábort inÖrogress\n");

177 
ªt
 = 
	`iwl_£nd_sˇn_ab‹t
(
¥iv
);

178 i‡(
ªt
) {

179 
	`IWL_DEBUG_SCAN
(
¥iv
, "Síd sˇ¿ab‹àÁûed %d\n", 
ªt
);

180 
	`iwl_f‹˚_sˇn_íd
(
¥iv
);

182 
	`IWL_DEBUG_SCAN
(
¥iv
, "Successfully send scanábort\n");

183 
	}
}

188 
	$iwl_sˇn_ˇn˚l
(
iwl_¥iv
 *
¥iv
)

190 
	`IWL_DEBUG_SCAN
(
¥iv
, "Queuingábort scan\n");

191 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
ab‹t_sˇn
);

193 
	}
}

199 
	$iwl_sˇn_ˇn˚l_timeout
(
iwl_¥iv
 *
¥iv
, 
ms
)

201 
timeout
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ms
);

203 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

205 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scan cancelÅimeout\n");

207 
	`iwl_do_sˇn_ab‹t
(
¥iv
);

209 
	`time_bef‹e_eq
(
jiffõs
, 
timeout
)) {

210 i‡(!
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
))

211 
föished
;

212 
	`m¶ìp
(20);

217 
föished
:

228 
	`iwl_¥o˚ss_sˇn_com∂ëe
(
¥iv
);

229 
	}
}

232 
	$iwl_rx_ª∂y_sˇn
(
iwl_¥iv
 *
¥iv
,

233 
iwl_rx_cmd_buf„r
 *
rxb
)

235 #ifde‡
CONFIG_IWLWIFI_DEBUG


236 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

237 
iwl_sˇƒeq_nŸifiˇti⁄
 *
nŸif
 = (*)
pkt
->
d©a
;

239 
	`IWL_DEBUG_SCAN
(
¥iv
, "Sˇ¿ªque° sètu†0x%x\n", 
nŸif
->
°©us
);

241 
	}
}

244 
	$iwl_rx_sˇn_°¨t_nŸif
(
iwl_¥iv
 *
¥iv
,

245 
iwl_rx_cmd_buf„r
 *
rxb
)

247 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

248 
iwl_sˇn°¨t_nŸifiˇti⁄
 *
nŸif
 = (*)
pkt
->
d©a
;

250 
¥iv
->
sˇn_°¨t_tsf
 = 
	`À32_to_˝u
(
nŸif
->
tsf_low
);

251 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scan start: "

254 
nŸif
->
ch™√l
,

255 
nŸif
->
b™d
 ? "bg" : "a",

256 
	`À32_to_˝u
(
nŸif
->
tsf_high
),

257 
	`À32_to_˝u
(
nŸif
->
tsf_low
),

258 
nŸif
->
°©us
,ÇŸif->
bóc⁄_timî
);

259 
	}
}

262 
	$iwl_rx_sˇn_ªsu…s_nŸif
(
iwl_¥iv
 *
¥iv
,

263 
iwl_rx_cmd_buf„r
 *
rxb
)

265 #ifde‡
CONFIG_IWLWIFI_DEBUG


266 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

267 
iwl_sˇƒesu…s_nŸifiˇti⁄
 *
nŸif
 = (*)
pkt
->
d©a
;

269 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scan ch.res: "

274 
nŸif
->
ch™√l
,

275 
nŸif
->
b™d
 ? "bg" : "a",

276 
nŸif
->
¥obe_°©us
,ÇŸif->
num_¥obe_nŸ_£¡
,

277 
	`À32_to_˝u
(
nŸif
->
tsf_high
),

278 
	`À32_to_˝u
(
nŸif
->
tsf_low
),

279 
	`À32_to_˝u
(
nŸif
->
°©i°ics
[0]),

280 
	`À32_to_˝u
(
nŸif
->
tsf_low
Ë- 
¥iv
->
sˇn_°¨t_tsf
);

282 
	}
}

285 
	$iwl_rx_sˇn_com∂ëe_nŸif
(
iwl_¥iv
 *
¥iv
,

286 
iwl_rx_cmd_buf„r
 *
rxb
)

288 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

289 
iwl_sˇncom∂ëe_nŸifiˇti⁄
 *
sˇn_nŸif
 = (*)
pkt
->
d©a
;

291 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scan complete: %d channels (TSF 0x%08X:%08X) - %d\n",

292 
sˇn_nŸif
->
sˇ¬ed_ch™√ls
,

293 
sˇn_nŸif
->
tsf_low
,

294 
sˇn_nŸif
->
tsf_high
, sˇn_nŸif->
°©us
);

296 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scan on %sGHzÅook %dms\n",

297 (
¥iv
->
sˇn_b™d
 =
NL80211_BAND_2GHZ
) ? "2.4" : "5.2",

298 
	`jiffõs_to_m£cs
(
jiffõs
 - 
¥iv
->
sˇn_°¨t
));

308 
	`£t_bô
(
STATUS_SCAN_COMPLETE
, &
¥iv
->
°©us
);

309 
	`˛ór_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
);

310 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
sˇn_com∂ëed
);

312 i‡(
¥iv
->
iw_mode
 !
NL80211_IFTYPE_ADHOC
 &&

313 
	`iwl_adv™˚d_bt_c€xi°
(
¥iv
) &&

314 
¥iv
->
bt_°©us
 !
sˇn_nŸif
->bt_status) {

315 i‡(
sˇn_nŸif
->
bt_°©us
) {

317 i‡(!
¥iv
->
bt_ch_™noun˚
)

318 
¥iv
->
bt_åaffic_lﬂd
 =

319 
IWL_BT_COEX_TRAFFIC_LOAD_HIGH
;

326 
¥iv
->
bt_åaffic_lﬂd
 =

327 
IWL_BT_COEX_TRAFFIC_LOAD_NONE
;

329 
¥iv
->
bt_°©us
 = 
sˇn_nŸif
->bt_status;

330 
	`queue_w‹k
(
¥iv
->
w‹kqueue
,

331 &
¥iv
->
bt_åaffic_ch™ge_w‹k
);

333 
	}
}

335 
	$iwl_£tup_rx_sˇn_h™dÀrs
(
iwl_¥iv
 *
¥iv
)

338 
¥iv
->
rx_h™dÀrs
[
REPLY_SCAN_CMD
] = 
iwl_rx_ª∂y_sˇn
;

339 
¥iv
->
rx_h™dÀrs
[
SCAN_START_NOTIFICATION
] = 
iwl_rx_sˇn_°¨t_nŸif
;

340 
¥iv
->
rx_h™dÀrs
[
SCAN_RESULTS_NOTIFICATION
] =

341 
iwl_rx_sˇn_ªsu…s_nŸif
;

342 
¥iv
->
rx_h™dÀrs
[
SCAN_COMPLETE_NOTIFICATION
] =

343 
iwl_rx_sˇn_com∂ëe_nŸif
;

344 
	}
}

346 
u16
 
	$iwl_gë_a˘ive_dwñl_time
(
iwl_¥iv
 *
¥iv
,

347 
∆80211_b™d
 
b™d
, 
u8
 
n_¥obes
)

349 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

350  
IWL_ACTIVE_DWELL_TIME_52
 +

351 
IWL_ACTIVE_DWELL_FACTOR_52GHZ
 * (
n_¥obes
 + 1);

353  
IWL_ACTIVE_DWELL_TIME_24
 +

354 
IWL_ACTIVE_DWELL_FACTOR_24GHZ
 * (
n_¥obes
 + 1);

355 
	}
}

357 
u16
 
	$iwl_limô_dwñl
(
iwl_¥iv
 *
¥iv
, 
u16
 
dwñl_time
)

359 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

360 
limôs
[
NUM_IWL_RXON_CTX
] = {};

361 
n_a˘ive
 = 0;

362 
u16
 
limô
;

364 
	`BUILD_BUG_ON
(
NUM_IWL_RXON_CTX
 != 2);

374 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

375 
˘x
->
°agög
.
dev_ty≥
) {

376 
RXON_DEV_TYPE_P2P
:

379 
RXON_DEV_TYPE_ESS
:

382 i‡(!
	`iwl_is_assocüãd_˘x
(
˘x
))

385 
RXON_DEV_TYPE_CP
:

386 
RXON_DEV_TYPE_2STA
:

394 
limôs
[
n_a˘ive
++] = 
˘x
->
bóc⁄_öt
 ?: 
IWL_PASSIVE_DWELL_BASE
;

397 
n_a˘ive
) {

399  
dwñl_time
;

401 
limô
 = (
limôs
[1] * 98Ë/ 100 - 
IWL_CHANNEL_TUNE_TIME
 * 2;

402 
limô
 /= 2;

403 
dwñl_time
 = 
	`mö
(
limô
, dwell_time);

404 
ÁŒthrough
;

406 
limô
 = (
limôs
[0] * 98Ë/ 100 - 
IWL_CHANNEL_TUNE_TIME
 * 2;

407 
limô
 /
n_a˘ive
;

408  
	`mö
(
limô
, 
dwñl_time
);

410 
	`WARN_ON_ONCE
(1);

411  
dwñl_time
;

413 
	}
}

415 
u16
 
	$iwl_gë_∑ssive_dwñl_time
(
iwl_¥iv
 *
¥iv
,

416 
∆80211_b™d
 
b™d
)

418 
u16
 
∑ssive
 = (
b™d
 =
NL80211_BAND_2GHZ
) ?

419 
IWL_PASSIVE_DWELL_BASE
 + 
IWL_PASSIVE_DWELL_TIME_24
 :

420 
IWL_PASSIVE_DWELL_BASE
 + 
IWL_PASSIVE_DWELL_TIME_52
;

422  
	`iwl_limô_dwñl
(
¥iv
, 
∑ssive
);

423 
	}
}

426 
u8
 
	$iwl_gë_sögÀ_ch™√l_numbî
(
iwl_¥iv
 *
¥iv
,

427 
∆80211_b™d
 
b™d
)

429 
õì80211_suµ‹ãd_b™d
 *
sb™d
 = 
¥iv
->
hw
->
wùhy
->
b™ds
[
b™d
];

430 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

431 
i
;

433 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

434 
boﬁ
 
busy
 = 
Ál£
;

436 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

437 
busy
 = 
sb™d
->
ch™√ls
[
i
].
hw_vÆue
 ==

438 
	`À16_to_˝u
(
˘x
->
°agög
.
ch™√l
);

439 i‡(
busy
)

443 i‡(
busy
)

446 i‡(!(
sb™d
->
ch™√ls
[
i
].
Êags
 & 
IEEE80211_CHAN_DISABLED
))

447  
sb™d
->
ch™√ls
[
i
].
hw_vÆue
;

451 
	}
}

453 
	$iwl_gë_ch™√l_f‹_ª£t_sˇn
(
iwl_¥iv
 *
¥iv
,

454 
õì80211_vif
 *
vif
,

455 
∆80211_b™d
 
b™d
,

456 
iwl_sˇn_ch™√l
 *
sˇn_ch
)

458 c⁄° 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

459 
u16
 
ch™√l
;

461 
sb™d
 = 
	`iwl_gë_hw_mode
(
¥iv
, 
b™d
);

462 i‡(!
sb™d
) {

463 
	`IWL_ERR
(
¥iv
, "invalid band\n");

467 
ch™√l
 = 
	`iwl_gë_sögÀ_ch™√l_numbî
(
¥iv
, 
b™d
);

468 i‡(
ch™√l
) {

469 
sˇn_ch
->
ch™√l
 = 
	`˝u_to_À16
(channel);

470 
sˇn_ch
->
ty≥
 = 
SCAN_CHANNEL_TYPE_PASSIVE
;

471 
sˇn_ch
->
a˘ive_dwñl
 =

472 
	`˝u_to_À16
(
IWL_RADIO_RESET_DWELL_TIME
);

473 
sˇn_ch
->
∑ssive_dwñl
 =

474 
	`˝u_to_À16
(
IWL_RADIO_RESET_DWELL_TIME
);

476 
sˇn_ch
->
d•_©ãn
 = 110;

477 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

478 
sˇn_ch
->
tx_gaö
 = ((1 << 5) | (3 << 3)) | 3;

480 
sˇn_ch
->
tx_gaö
 = ((1 << 5) | (5 << 3));

484 
	`IWL_ERR
(
¥iv
, "no valid channel found\n");

486 
	}
}

488 
	$iwl_gë_ch™√ls_f‹_sˇn
(
iwl_¥iv
 *
¥iv
,

489 
õì80211_vif
 *
vif
,

490 
∆80211_b™d
 
b™d
,

491 
u8
 
is_a˘ive
, u8 
n_¥obes
,

492 
iwl_sˇn_ch™√l
 *
sˇn_ch
)

494 
õì80211_ch™√l
 *
ch™
;

495 c⁄° 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

496 
u16
 
∑ssive_dwñl
 = 0;

497 
u16
 
a˘ive_dwñl
 = 0;

498 
added
, 
i
;

499 
u16
 
ch™√l
;

501 
sb™d
 = 
	`iwl_gë_hw_mode
(
¥iv
, 
b™d
);

502 i‡(!
sb™d
)

505 
a˘ive_dwñl
 = 
	`iwl_gë_a˘ive_dwñl_time
(
¥iv
, 
b™d
, 
n_¥obes
);

506 
∑ssive_dwñl
 = 
	`iwl_gë_∑ssive_dwñl_time
(
¥iv
, 
b™d
);

508 i‡(
∑ssive_dwñl
 <
a˘ive_dwñl
)

509 
∑ssive_dwñl
 = 
a˘ive_dwñl
 + 1;

511 
i
 = 0, 
added
 = 0; i < 
¥iv
->
sˇn_ªque°
->
n_ch™√ls
; i++) {

512 
ch™
 = 
¥iv
->
sˇn_ªque°
->
ch™√ls
[
i
];

514 i‡(
ch™
->
b™d
 != band)

517 
ch™√l
 = 
ch™
->
hw_vÆue
;

518 
sˇn_ch
->
ch™√l
 = 
	`˝u_to_À16
(channel);

520 i‡(!
is_a˘ive
 || (
ch™
->
Êags
 & 
IEEE80211_CHAN_NO_IR
))

521 
sˇn_ch
->
ty≥
 = 
SCAN_CHANNEL_TYPE_PASSIVE
;

523 
sˇn_ch
->
ty≥
 = 
SCAN_CHANNEL_TYPE_ACTIVE
;

525 i‡(
n_¥obes
)

526 
sˇn_ch
->
ty≥
 |
	`IWL_SCAN_PROBE_MASK
(
n_¥obes
);

528 
sˇn_ch
->
a˘ive_dwñl
 = 
	`˝u_to_À16
(active_dwell);

529 
sˇn_ch
->
∑ssive_dwñl
 = 
	`˝u_to_À16
(passive_dwell);

532 
sˇn_ch
->
d•_©ãn
 = 110;

538 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

539 
sˇn_ch
->
tx_gaö
 = ((1 << 5) | (3 << 3)) | 3;

541 
sˇn_ch
->
tx_gaö
 = ((1 << 5) | (5 << 3));

543 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scanning ch=%dÖrob=0x%X [%s %d]\n",

544 
ch™√l
, 
	`À32_to_˝u
(
sˇn_ch
->
ty≥
),

545 (
sˇn_ch
->
ty≥
 & 
SCAN_CHANNEL_TYPE_ACTIVE
) ?

547 (
sˇn_ch
->
ty≥
 & 
SCAN_CHANNEL_TYPE_ACTIVE
) ?

548 
a˘ive_dwñl
 : 
∑ssive_dwñl
);

550 
sˇn_ch
++;

551 
added
++;

554 
	`IWL_DEBUG_SCAN
(
¥iv
, "tŸÆ ch™√l†tÿsˇ¿%d\n", 
added
);

555  
added
;

556 
	}
}

561 
u16
 
	$iwl_fûl_¥obe_ªq
(
õì80211_mgmt
 *
‰ame
, c⁄° 
u8
 *
è
,

562 c⁄° 
u8
 *
õs
, 
õ_Àn
, c⁄° u8 *
ssid
,

563 
u8
 
ssid_Àn
, 
À·
)

565 
Àn
 = 0;

566 
u8
 *
pos
 = 
NULL
;

570 
À·
 -= 24;

571 i‡(
À·
 < 0)

574 
‰ame
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_STYPE_PROBE_REQ
);

575 
	`ëh_brﬂdˇ°_addr
(
‰ame
->
da
);

576 
	`mem˝y
(
‰ame
->
ß
, 
è
, 
ETH_ALEN
);

577 
	`ëh_brﬂdˇ°_addr
(
‰ame
->
bssid
);

578 
‰ame
->
£q_˘æ
 = 0;

580 
Àn
 += 24;

583 
pos
 = &
‰ame
->
u
.
¥obe_ªq
.
v¨übÀ
[0];

586 
À·
 -
ssid_Àn
 + 2;

587 i‡(
À·
 < 0)

589 *
pos
++ = 
WLAN_EID_SSID
;

590 *
pos
++ = 
ssid_Àn
;

591 i‡(
ssid
 && 
ssid_Àn
) {

592 
	`mem˝y
(
pos
, 
ssid
, 
ssid_Àn
);

593 
pos
 +
ssid_Àn
;

596 
Àn
 +
ssid_Àn
 + 2;

598 i‡(
	`WARN_ON
(
À·
 < 
õ_Àn
))

599  
Àn
;

601 i‡(
õs
 && 
õ_Àn
) {

602 
	`mem˝y
(
pos
, 
õs
, 
õ_Àn
);

603 
Àn
 +
õ_Àn
;

606  (
u16
)
Àn
;

607 
	}
}

609 
	$iwœgn_ªque°_sˇn
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
)

611 
iwl_ho°_cmd
 
cmd
 = {

612 .
id
 = 
REPLY_SCAN_CMD
,

613 .
Àn
 = { (
iwl_sˇn_cmd
), },

615 
iwl_sˇn_cmd
 *
sˇn
;

616 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

617 
u32
 
øã_Êags
 = 0;

618 
u16
 
cmd_Àn
 = 0;

619 
u16
 
rx_chaö
 = 0;

620 
∆80211_b™d
 
b™d
;

621 
u8
 
n_¥obes
 = 0;

622 
u8
 
rx_™t
 = 
¥iv
->
nvm_d©a
->
vÆid_rx_™t
;

623 
u8
 
øã
;

624 
boﬁ
 
is_a˘ive
 = 
Ál£
;

625 
ch™_mod
;

626 
u8
 
a˘ive_chaös
;

627 
u8
 
sˇn_tx_™ã¬as
 = 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
;

628 
ªt
;

629 
size_t
 
sˇn_cmd_size
 = (
iwl_sˇn_cmd
) +

630 
MAX_SCAN_CHANNEL
 * (
iwl_sˇn_ch™√l
) +

631 
¥iv
->
fw
->
ucode_ˇ∑
.
max_¥obe_Àngth
;

632 c⁄° 
u8
 *
ssid
 = 
NULL
;

633 
u8
 
ssid_Àn
 = 0;

635 i‡(
	`WARN_ON
(
¥iv
->
sˇn_ty≥
 =
IWL_SCAN_NORMAL
 &&

636 (!
¥iv
->
sˇn_ªque°
 ||

637 
¥iv
->
sˇn_ªque°
->
n_ch™√ls
 > 
MAX_SCAN_CHANNEL
)))

638  -
EINVAL
;

640 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

642 i‡(
vif
)

643 
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

645 i‡(!
¥iv
->
sˇn_cmd
) {

646 
¥iv
->
sˇn_cmd
 = 
	`kmÆloc
(
sˇn_cmd_size
, 
GFP_KERNEL
);

647 i‡(!
¥iv
->
sˇn_cmd
) {

648 
	`IWL_DEBUG_SCAN
(
¥iv
,

650  -
ENOMEM
;

652 
¥iv
->
sˇn_cmd_size
 = scan_cmd_size;

654 i‡(
¥iv
->
sˇn_cmd_size
 < scan_cmd_size) {

655 
	`IWL_DEBUG_SCAN
(
¥iv
,

657  -
ENOMEM
;

659 
sˇn
 = 
¥iv
->
sˇn_cmd
;

660 
	`mem£t
(
sˇn
, 0, 
¥iv
->
sˇn_cmd_size
);

662 
sˇn
->
quõt_∂˝_th
 = 
IWL_PLCP_QUIET_THRESH
;

663 
sˇn
->
quõt_time
 = 
IWL_ACTIVE_QUIET_TIME
;

665 i‡(
	`iwl_is_™y_assocüãd
(
¥iv
)) {

666 
u16
 
öãrvÆ
 = 0;

667 
u32
 
exåa
;

668 
u32
 
su•íd_time
 = 100;

669 
u32
 
sˇn_su•íd_time
 = 100;

671 
	`IWL_DEBUG_INFO
(
¥iv
, "Scanning whileássociated...\n");

672 
¥iv
->
sˇn_ty≥
) {

673 
IWL_SCAN_RADIO_RESET
:

674 
öãrvÆ
 = 0;

676 
IWL_SCAN_NORMAL
:

677 
öãrvÆ
 = 
vif
->
bss_c⁄f
.
bóc⁄_öt
;

681 
sˇn
->
su•íd_time
 = 0;

682 
sˇn
->
max_out_time
 = 
	`˝u_to_À32
(200 * 1024);

683 i‡(!
öãrvÆ
)

684 
öãrvÆ
 = 
su•íd_time
;

686 
exåa
 = (
su•íd_time
 / 
öãrvÆ
) << 22;

687 
sˇn_su•íd_time
 = (
exåa
 |

688 ((
su•íd_time
 % 
öãrvÆ
) * 1024));

689 
sˇn
->
su•íd_time
 = 
	`˝u_to_À32
(
sˇn_su•íd_time
);

690 
	`IWL_DEBUG_SCAN
(
¥iv
, "suspend_time 0x%X beacon interval %d\n",

691 
sˇn_su•íd_time
, 
öãrvÆ
);

694 
¥iv
->
sˇn_ty≥
) {

695 
IWL_SCAN_RADIO_RESET
:

696 
	`IWL_DEBUG_SCAN
(
¥iv
, "Start internalÖassive scan.\n");

702 
sˇn
->
quõt_time
 = 
	`˝u_to_À16
(
IWL_RADIO_RESET_DWELL_TIME
);

704 
IWL_SCAN_NORMAL
:

705 i‡(
¥iv
->
sˇn_ªque°
->
n_ssids
) {

706 
i
, 
p
 = 0;

707 
	`IWL_DEBUG_SCAN
(
¥iv
, "Kicking offáctive scan\n");

712 
ssid_Àn
 = 
¥iv
->
sˇn_ªque°
->
ssids
[0].ssid_len;

713 
ssid
 = 
¥iv
->
sˇn_ªque°
->
ssids
[0].ssid;

719 
i
 = 
¥iv
->
sˇn_ªque°
->
n_ssids
 - 1; i >= 1; i--) {

720 
sˇn
->
dúe˘_sˇn
[
p
].
id
 = 
WLAN_EID_SSID
;

721 
sˇn
->
dúe˘_sˇn
[
p
].
Àn
 =

722 
¥iv
->
sˇn_ªque°
->
ssids
[
i
].
ssid_Àn
;

723 
	`mem˝y
(
sˇn
->
dúe˘_sˇn
[
p
].
ssid
,

724 
¥iv
->
sˇn_ªque°
->
ssids
[
i
].
ssid
,

725 
¥iv
->
sˇn_ªque°
->
ssids
[
i
].
ssid_Àn
);

726 
n_¥obes
++;

727 
p
++;

729 
is_a˘ive
 = 
åue
;

731 
	`IWL_DEBUG_SCAN
(
¥iv
, "StartÖassive scan.\n");

735 
sˇn
->
tx_cmd
.
tx_Êags
 = 
TX_CMD_FLG_SEQ_CTL_MSK
;

736 
sˇn
->
tx_cmd
.
°a_id
 = 
˘x
->
bˇ°_°a_id
;

737 
sˇn
->
tx_cmd
.
°›_time
.
li„_time
 = 
TX_CMD_LIFE_TIME_INFINITE
;

739 
¥iv
->
sˇn_b™d
) {

740 
NL80211_BAND_2GHZ
:

741 
sˇn
->
Êags
 = 
RXON_FLG_BAND_24G_MSK
 | 
RXON_FLG_AUTO_DETECT_MSK
;

742 
ch™_mod
 = 
	`À32_to_˝u
(

743 
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
].
a˘ive
.
Êags
 &

744 
RXON_FLG_CHANNEL_MODE_MSK
)

745 >> 
RXON_FLG_CHANNEL_MODE_POS
;

746 i‡((
¥iv
->
sˇn_ªque°
 &&Öriv->sˇn_ªque°->
no_cck
) ||

747 
ch™_mod
 =
CHANNEL_MODE_PURE_40
) {

748 
øã
 = 
IWL_RATE_6M_PLCP
;

750 
øã
 = 
IWL_RATE_1M_PLCP
;

751 
øã_Êags
 = 
RATE_MCS_CCK_MSK
;

757 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

758 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
)

759 
sˇn
->
tx_cmd
.
tx_Êags
 |
TX_CMD_FLG_IGNORE_BT
;

761 
NL80211_BAND_5GHZ
:

762 
øã
 = 
IWL_RATE_6M_PLCP
;

765 
	`IWL_WARN
(
¥iv
, "Invalid scan band\n");

766  -
EIO
;

790 i‡(
¥iv
->
√w_sˇn_thªshﬁd_behaviour
)

791 
sˇn
->
good_CRC_th
 = 
is_a˘ive
 ? 
IWL_GOOD_CRC_TH_DEFAULT
 :

792 
IWL_GOOD_CRC_TH_DISABLED
;

794 
sˇn
->
good_CRC_th
 = 
is_a˘ive
 ? 
IWL_GOOD_CRC_TH_DEFAULT
 :

795 
IWL_GOOD_CRC_TH_NEVER
;

797 
b™d
 = 
¥iv
->
sˇn_b™d
;

799 i‡(
b™d
 =
NL80211_BAND_2GHZ
 &&

800 
¥iv
->
lib
->
bt_∑øms
 &&

801 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

803 
sˇn_tx_™ã¬as
 = 
	`fú°_™ã¬a
(scan_tx_antennas);

806 
¥iv
->
sˇn_tx_™t
[
b™d
] = 
	`iwl_toggÀ_tx_™t
(priv,

807 
¥iv
->
sˇn_tx_™t
[
b™d
],

808 
sˇn_tx_™ã¬as
);

809 
øã_Êags
 |
	`iwl_™t_idx_to_Êags
(
¥iv
->
sˇn_tx_™t
[
b™d
]);

810 
sˇn
->
tx_cmd
.
øã_n_Êags
 = 
	`iwl_hw_£t_øã_n_Êags
(
øã
, 
øã_Êags
);

816 i‡(
	`ã°_bô
(
STATUS_POWER_PMI
, &
¥iv
->
°©us
) &&

817 !(
¥iv
->
hw
->
c⁄f
.
Êags
 & 
IEEE80211_CONF_IDLE
)) {

819 
a˘ive_chaös
 = 
rx_™t
 &

820 ((
u8
)(
¥iv
->
chaö_noi£_d©a
.
a˘ive_chaös
));

821 i‡(!
a˘ive_chaös
)

822 
a˘ive_chaös
 = 
rx_™t
;

824 
	`IWL_DEBUG_SCAN
(
¥iv
, "chain_noise_data.active_chains: %u\n",

825 
¥iv
->
chaö_noi£_d©a
.
a˘ive_chaös
);

827 
rx_™t
 = 
	`fú°_™ã¬a
(
a˘ive_chaös
);

829 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

830 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
 &&

831 
¥iv
->
bt_fuŒ_c⁄cuºít
) {

833 
rx_™t
 = 
	`fú°_™ã¬a
(rx_ant);

837 
rx_chaö
 |=

838 
¥iv
->
nvm_d©a
->
vÆid_rx_™t
 << 
RXON_RX_CHAIN_VALID_POS
;

839 
rx_chaö
 |
rx_™t
 << 
RXON_RX_CHAIN_FORCE_MIMO_SEL_POS
;

840 
rx_chaö
 |
rx_™t
 << 
RXON_RX_CHAIN_FORCE_SEL_POS
;

841 
rx_chaö
 |0x1 << 
RXON_RX_CHAIN_DRIVER_FORCE_POS
;

842 
sˇn
->
rx_chaö
 = 
	`˝u_to_À16
(rx_chain);

843 
¥iv
->
sˇn_ty≥
) {

844 
IWL_SCAN_NORMAL
:

845 
cmd_Àn
 = 
	`iwl_fûl_¥obe_ªq
(

846 (
õì80211_mgmt
 *)
sˇn
->
d©a
,

847 
vif
->
addr
,

848 
¥iv
->
sˇn_ªque°
->
õ
,

849 
¥iv
->
sˇn_ªque°
->
õ_Àn
,

850 
ssid
, 
ssid_Àn
,

851 
sˇn_cmd_size
 - (*
sˇn
));

853 
IWL_SCAN_RADIO_RESET
:

855 
cmd_Àn
 = 
	`iwl_fûl_¥obe_ªq
(

856 (
õì80211_mgmt
 *)
sˇn
->
d©a
,

857 
iwl_bˇ°_addr
, 
NULL
, 0,

858 
NULL
, 0,

859 
sˇn_cmd_size
 - (*
sˇn
));

862 
	`BUG
();

864 
sˇn
->
tx_cmd
.
Àn
 = 
	`˝u_to_À16
(
cmd_Àn
);

866 
sˇn
->
fûãr_Êags
 |(
RXON_FILTER_ACCEPT_GRP_MSK
 |

867 
RXON_FILTER_BCON_AWARE_MSK
);

869 
¥iv
->
sˇn_ty≥
) {

870 
IWL_SCAN_RADIO_RESET
:

871 
sˇn
->
ch™√l_cou¡
 =

872 
	`iwl_gë_ch™√l_f‹_ª£t_sˇn
(
¥iv
, 
vif
, 
b™d
,

873 (*)&
sˇn
->
d©a
[
cmd_Àn
]);

875 
IWL_SCAN_NORMAL
:

876 
sˇn
->
ch™√l_cou¡
 =

877 
	`iwl_gë_ch™√ls_f‹_sˇn
(
¥iv
, 
vif
, 
b™d
,

878 
is_a˘ive
, 
n_¥obes
,

879 (*)&
sˇn
->
d©a
[
cmd_Àn
]);

883 i‡(
sˇn
->
ch™√l_cou¡
 == 0) {

884 
	`IWL_DEBUG_SCAN
(
¥iv
, "ch™√»cou¡ %d\n", 
sˇn
->
ch™√l_cou¡
);

885  -
EIO
;

888 
cmd
.
Àn
[0] +
	`À16_to_˝u
(
sˇn
->
tx_cmd
.len) +

889 
sˇn
->
ch™√l_cou¡
 * (
iwl_sˇn_ch™√l
);

890 
cmd
.
d©a
[0] = 
sˇn
;

891 
cmd
.
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
;

892 
sˇn
->
Àn
 = 
	`˝u_to_À16
(
cmd
.len[0]);

895 
	`£t_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
);

897 
ªt
 = 
	`iwœgn_£t_∑n_∑øms
(
¥iv
);

898 i‡(
ªt
) {

899 
	`˛ór_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
);

900  
ªt
;

903 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

904 i‡(
ªt
) {

905 
	`˛ór_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
);

906 
	`iwœgn_£t_∑n_∑øms
(
¥iv
);

909  
ªt
;

910 
	}
}

912 
	$iwl_öô_sˇn_∑øms
(
iwl_¥iv
 *
¥iv
)

914 
u8
 
™t_idx
 = 
	`Ês
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
) - 1;

915 i‡(!
¥iv
->
sˇn_tx_™t
[
NL80211_BAND_5GHZ
])

916 
¥iv
->
sˇn_tx_™t
[
NL80211_BAND_5GHZ
] = 
™t_idx
;

917 i‡(!
¥iv
->
sˇn_tx_™t
[
NL80211_BAND_2GHZ
])

918 
¥iv
->
sˇn_tx_™t
[
NL80211_BAND_2GHZ
] = 
™t_idx
;

919 
	}
}

921 
__mu°_check
 
	$iwl_sˇn_öôüã
(
iwl_¥iv
 *
¥iv
,

922 
õì80211_vif
 *
vif
,

923 
iwl_sˇn_ty≥
 
sˇn_ty≥
,

924 
∆80211_b™d
 
b™d
)

926 
ªt
;

928 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

930 
	`ˇn˚l_dñayed_w‹k
(&
¥iv
->
sˇn_check
);

932 i‡(!
	`iwl_is_ªady_rf
(
¥iv
)) {

933 
	`IWL_WARN
(
¥iv
, "Request scan called when driverÇotÑeady.\n");

934  -
EIO
;

937 i‡(
	`ã°_bô
(
STATUS_SCAN_HW
, &
¥iv
->
°©us
)) {

938 
	`IWL_DEBUG_SCAN
(
¥iv
,

940  -
EBUSY
;

943 i‡(
	`ã°_bô
(
STATUS_SCAN_ABORTING
, &
¥iv
->
°©us
)) {

944 
	`IWL_DEBUG_SCAN
(
¥iv
, "ScanÑequest whileábortÖending.\n");

945  -
EBUSY
;

948 
	`IWL_DEBUG_SCAN
(
¥iv
, "Starting %sscan...\n",

949 
sˇn_ty≥
 =
IWL_SCAN_NORMAL
 ? "" :

952 
	`£t_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
);

953 
¥iv
->
sˇn_ty≥
 = scan_type;

954 
¥iv
->
sˇn_°¨t
 = 
jiffõs
;

955 
¥iv
->
sˇn_b™d
 = 
b™d
;

957 
ªt
 = 
	`iwœgn_ªque°_sˇn
(
¥iv
, 
vif
);

958 i‡(
ªt
) {

959 
	`˛ór_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
);

960 
¥iv
->
sˇn_ty≥
 = 
IWL_SCAN_NORMAL
;

961  
ªt
;

964 
	`queue_dñayed_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
sˇn_check
,

965 
IWL_SCAN_CHECK_WATCHDOG
);

968 
	}
}

975 
	$iwl_öã∫Æ_sh‹t_hw_sˇn
(
iwl_¥iv
 *
¥iv
)

977 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
°¨t_öã∫Æ_sˇn
);

978 
	}
}

980 
	$iwl_bg_°¨t_öã∫Æ_sˇn
(
w‹k_°ru˘
 *
w‹k
)

982 
iwl_¥iv
 *
¥iv
 =

983 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
°¨t_öã∫Æ_sˇn
);

985 
	`IWL_DEBUG_SCAN
(
¥iv
, "Start internal scan\n");

987 
	`muãx_lock
(&
¥iv
->
muãx
);

989 i‡(
¥iv
->
sˇn_ty≥
 =
IWL_SCAN_RADIO_RESET
) {

990 
	`IWL_DEBUG_SCAN
(
¥iv
, "Internal scanálready inÖrogress\n");

991 
u∆ock
;

994 i‡(
	`ã°_bô
(
STATUS_SCANNING
, &
¥iv
->
°©us
)) {

995 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scanálready inÖrogress.\n");

996 
u∆ock
;

999 i‡(
	`iwl_sˇn_öôüã
(
¥iv
, 
NULL
, 
IWL_SCAN_RADIO_RESET
,Öriv->
b™d
))

1000 
	`IWL_DEBUG_SCAN
(
¥iv
, "failedÅo start internal short scan\n");

1001 
u∆ock
:

1002 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1003 
	}
}

1005 
	$iwl_bg_sˇn_check
(
w‹k_°ru˘
 *
d©a
)

1007 
iwl_¥iv
 *
¥iv
 =

1008 
	`c⁄èöî_of
(
d©a
, 
iwl_¥iv
, 
sˇn_check
.
w‹k
);

1010 
	`IWL_DEBUG_SCAN
(
¥iv
, "Scan check work\n");

1015 
	`muãx_lock
(&
¥iv
->
muãx
);

1016 
	`iwl_f‹˚_sˇn_íd
(
¥iv
);

1017 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1018 
	}
}

1020 
	$iwl_bg_ab‹t_sˇn
(
w‹k_°ru˘
 *
w‹k
)

1022 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, iwl_¥iv, 
ab‹t_sˇn
);

1024 
	`IWL_DEBUG_SCAN
(
¥iv
, "Abort scan work\n");

1028 
	`muãx_lock
(&
¥iv
->
muãx
);

1029 
	`iwl_sˇn_ˇn˚l_timeout
(
¥iv
, 200);

1030 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1031 
	}
}

1033 
	$iwl_bg_sˇn_com∂ëed
(
w‹k_°ru˘
 *
w‹k
)

1035 
iwl_¥iv
 *
¥iv
 =

1036 
	`c⁄èöî_of
(
w‹k
, 
iwl_¥iv
, 
sˇn_com∂ëed
);

1038 
	`muãx_lock
(&
¥iv
->
muãx
);

1039 
	`iwl_¥o˚ss_sˇn_com∂ëe
(
¥iv
);

1040 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1041 
	}
}

1043 
	$iwl_£tup_sˇn_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
)

1045 
	`INIT_WORK
(&
¥iv
->
sˇn_com∂ëed
, 
iwl_bg_sˇn_com∂ëed
);

1046 
	`INIT_WORK
(&
¥iv
->
ab‹t_sˇn
, 
iwl_bg_ab‹t_sˇn
);

1047 
	`INIT_WORK
(&
¥iv
->
°¨t_öã∫Æ_sˇn
, 
iwl_bg_°¨t_öã∫Æ_sˇn
);

1048 
	`INIT_DELAYED_WORK
(&
¥iv
->
sˇn_check
, 
iwl_bg_sˇn_check
);

1049 
	}
}

1051 
	$iwl_ˇn˚l_sˇn_de„ºed_w‹k
(
iwl_¥iv
 *
¥iv
)

1053 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
°¨t_öã∫Æ_sˇn
);

1054 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
ab‹t_sˇn
);

1055 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
sˇn_com∂ëed
);

1057 i‡(
	`ˇn˚l_dñayed_w‹k_sync
(&
¥iv
->
sˇn_check
)) {

1058 
	`muãx_lock
(&
¥iv
->
muãx
);

1059 
	`iwl_f‹˚_sˇn_íd
(
¥iv
);

1060 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

1062 
	}
}

	@dvm/sta.c

9 
	~<löux/ëhîdevi˚.h
>

10 
	~<√t/mac80211.h
>

11 
	~"iwl-å™s.h
"

12 
	~"dev.h
"

13 
	~"agn.h
"

15 c⁄° 
u8
 
	giwl_bˇ°_addr
[
ETH_ALEN
] = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF };

17 
	$iwl_°a_ucode_a˘iv©e
(
iwl_¥iv
 *
¥iv
, 
u8
 
°a_id
)

19 
	`lockdï_as£π_hñd
(&
¥iv
->
°a_lock
);

21 i‡(
°a_id
 >
IWLAGN_STATION_COUNT
) {

22 
	`IWL_ERR
(
¥iv
, "övÆid sè_id %u\n", 
°a_id
);

23  -
EINVAL
;

25 i‡(!(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
))

26 
	`IWL_ERR
(
¥iv
, "ACTIVATEáÇon DRIVERáctive station id %u "

28 
°a_id
, 
¥iv
->
°©i⁄s
[°a_id].
°a
.°a.
addr
);

30 i‡(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
) {

31 
	`IWL_DEBUG_ASSOC
(
¥iv
,

34 
°a_id
, 
¥iv
->
°©i⁄s
[°a_id].
°a
.°a.
addr
);

36 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 |
IWL_STA_UCODE_ACTIVE
;

37 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Added STA id %uáddr %pMÅo uCode\n",

38 
°a_id
, 
¥iv
->
°©i⁄s
[°a_id].
°a
.°a.
addr
);

41 
	}
}

43 
	$iwl_¥o˚ss_add_°a_ª•
(
iwl_¥iv
 *
¥iv
,

44 
iwl_rx_∑ckë
 *
pkt
)

46 
iwl_add_°a_ª•
 *
add_°a_ª•
 = (*)
pkt
->
d©a
;

48 
	`IWL_DEBUG_INFO
(
¥iv
, "ProcessingÑesponse forádding station\n");

50 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

52 
add_°a_ª•
->
°©us
) {

53 
ADD_STA_SUCCESS_MSK
:

54 
	`IWL_DEBUG_INFO
(
¥iv
, "REPLY_ADD_STA PASSED\n");

56 
ADD_STA_NO_ROOM_IN_TABLE
:

57 
	`IWL_ERR
(
¥iv
, "Adding station failed,ÇoÑoom inÅable.\n");

59 
ADD_STA_NO_BLOCK_ACK_RESOURCE
:

60 
	`IWL_ERR
(
¥iv
,

63 
ADD_STA_MODIFY_NON_EXIST_STA
:

64 
	`IWL_ERR
(
¥iv
, "AttemptingÅo modifyÇon-existing station\n");

67 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Received REPLY_ADD_STA:(0x%08X)\n",

68 
add_°a_ª•
->
°©us
);

72 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

73 
	}
}

75 
	$iwl_add_°a_ˇŒback
(
iwl_¥iv
 *
¥iv
, 
iwl_rx_cmd_buf„r
 *
rxb
)

77 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

79 
	`iwl_¥o˚ss_add_°a_ª•
(
¥iv
, 
pkt
);

80 
	}
}

82 
	$iwl_£nd_add_°a
(
iwl_¥iv
 *
¥iv
,

83 
iwl_add°a_cmd
 *
°a
, 
u8
 
Êags
)

85 
ªt
 = 0;

86 
iwl_ho°_cmd
 
cmd
 = {

87 .
id
 = 
REPLY_ADD_STA
,

88 .
Êags
 = flags,

89 .
d©a
 = { 
°a
, },

90 .
Àn
 = { (*
°a
), },

92 
u8
 
°a_id
 
__maybe_unu£d
 = 
°a
->sta.sta_id;

93 
iwl_rx_∑ckë
 *
pkt
;

94 
iwl_add_°a_ª•
 *
add_°a_ª•
;

96 
	`IWL_DEBUG_INFO
(
¥iv
, "Adding sta %u (%pM) %ssynchronously\n",

97 
°a_id
, 
°a
->°a.
addr
, 
Êags
 & 
CMD_ASYNC
 ? "a" : "");

99 i‡(!(
Êags
 & 
CMD_ASYNC
)) {

100 
cmd
.
Êags
 |
CMD_WANT_SKB
;

101 
	`might_¶ìp
();

104 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

106 i‡(
ªt
 || (
Êags
 & 
CMD_ASYNC
))

107  
ªt
;

109 
pkt
 = 
cmd
.
ª•_pkt
;

110 
add_°a_ª•
 = (*)
pkt
->
d©a
;

113 i‡(
add_°a_ª•
->
°©us
 =
ADD_STA_SUCCESS_MSK
) {

114 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

115 
ªt
 = 
	`iwl_°a_ucode_a˘iv©e
(
¥iv
, 
°a_id
);

116 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

118 
ªt
 = -
EIO
;

121 
	`iwl_‰ì_ª•
(&
cmd
);

123  
ªt
;

124 
	}
}

126 
boﬁ
 
	$iwl_is_ht40_tx_Ælowed
(
iwl_¥iv
 *
¥iv
,

127 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

128 
õì80211_°a
 *
°a
)

130 i‡(!
˘x
->
ht
.
íabÀd
 || !˘x->ht.
is_40mhz
)

131  
Ál£
;

133 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


134 i‡(
¥iv
->
dißbÀ_ht40
)

135  
Ál£
;

139 i‡(!
°a
)

140  
åue
;

142  
°a
->
deÊök
.
b™dwidth
 >
IEEE80211_STA_RX_BW_40
;

143 
	}
}

145 
	$iwl_°a_ˇlc_ht_Êags
(
iwl_¥iv
 *
¥iv
,

146 
õì80211_°a
 *
°a
,

147 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

148 
__À32
 *
Êags
, __À32 *
mask
)

150 
õì80211_°a_ht_ˇp
 *
°a_ht_öf
 = &
°a
->
deÊök
.
ht_ˇp
;

152 *
mask
 = 
STA_FLG_RTS_MIMO_PROT_MSK
 |

153 
STA_FLG_MIMO_DIS_MSK
 |

154 
STA_FLG_HT40_EN_MSK
 |

155 
STA_FLG_MAX_AGG_SIZE_MSK
 |

156 
STA_FLG_AGG_MPDU_DENSITY_MSK
;

157 *
Êags
 = 0;

159 i‡(!
°a
 || !
°a_ht_öf
->
ht_suµ‹ãd
)

162 
	`IWL_DEBUG_INFO
(
¥iv
, "STA %pM SM PS mode: %s\n",

163 
°a
->
addr
,

164 (
°a
->
deÊök
.
smps_mode
 =
IEEE80211_SMPS_STATIC
) ?

166 (
°a
->
deÊök
.
smps_mode
 =
IEEE80211_SMPS_DYNAMIC
) ?

169 
°a
->
deÊök
.
smps_mode
) {

170 
IEEE80211_SMPS_STATIC
:

171 *
Êags
 |
STA_FLG_MIMO_DIS_MSK
;

173 
IEEE80211_SMPS_DYNAMIC
:

174 *
Êags
 |
STA_FLG_RTS_MIMO_PROT_MSK
;

176 
IEEE80211_SMPS_OFF
:

179 
	`IWL_WARN
(
¥iv
, "InvÆid MIMO PS modê%d\n", 
°a
->
deÊök
.
smps_mode
);

183 *
Êags
 |
	`˝u_to_À32
(

184 (
u32
)
°a_ht_öf
->
ampdu_Á˘‹
 << 
STA_FLG_MAX_AGG_SIZE_POS
);

186 *
Êags
 |
	`˝u_to_À32
(

187 (
u32
)
°a_ht_öf
->
ampdu_dísôy
 << 
STA_FLG_AGG_MPDU_DENSITY_POS
);

189 i‡(
	`iwl_is_ht40_tx_Ælowed
(
¥iv
, 
˘x
, 
°a
))

190 *
Êags
 |
STA_FLG_HT40_EN_MSK
;

191 
	}
}

193 
	$iwl_°a_upd©e_ht
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

194 
õì80211_°a
 *
°a
)

196 
u8
 
°a_id
 = 
	`iwl_°a_id
(
°a
);

197 
__À32
 
Êags
, 
mask
;

198 
iwl_add°a_cmd
 
cmd
;

200 i‡(
	`WARN_ON_ONCE
(
°a_id
 =
IWL_INVALID_STATION
))

201  -
EINVAL
;

203 
	`iwl_°a_ˇlc_ht_Êags
(
¥iv
, 
°a
, 
˘x
, &
Êags
, &
mask
);

205 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

206 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
°©i⁄_Êags
 &~
mask
;

207 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
°©i⁄_Êags
 |
Êags
;

208 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

210 
	`mem£t
(&
cmd
, 0, (cmd));

211 
cmd
.
mode
 = 
STA_CONTROL_MODIFY_MSK
;

212 
cmd
.
°©i⁄_Êags_msk
 = 
mask
;

213 
cmd
.
°©i⁄_Êags
 = 
Êags
;

214 
cmd
.
°a
.
°a_id
 = sta_id;

216  
	`iwl_£nd_add_°a
(
¥iv
, &
cmd
, 0);

217 
	}
}

219 
	$iwl_£t_ht_add_°©i⁄
(
iwl_¥iv
 *
¥iv
, 
u8
 
ödex
,

220 
õì80211_°a
 *
°a
,

221 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

223 
__À32
 
Êags
, 
mask
;

225 
	`iwl_°a_ˇlc_ht_Êags
(
¥iv
, 
°a
, 
˘x
, &
Êags
, &
mask
);

227 
	`lockdï_as£π_hñd
(&
¥iv
->
°a_lock
);

228 
¥iv
->
°©i⁄s
[
ödex
].
°a
.
°©i⁄_Êags
 &~
mask
;

229 
¥iv
->
°©i⁄s
[
ödex
].
°a
.
°©i⁄_Êags
 |
Êags
;

230 
	}
}

237 
u8
 
	$iwl_¥ï_°©i⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

238 c⁄° 
u8
 *
addr
, 
boﬁ
 
is_≠
, 
õì80211_°a
 *
°a
)

240 
iwl_°©i⁄_íåy
 *
°©i⁄
;

241 
i
;

242 
u8
 
°a_id
 = 
IWL_INVALID_STATION
;

244 i‡(
is_≠
)

245 
°a_id
 = 
˘x
->
≠_°a_id
;

246 i‡(
	`is_brﬂdˇ°_ëhî_addr
(
addr
))

247 
°a_id
 = 
˘x
->
bˇ°_°a_id
;

249 
i
 = 
IWL_STA_ID
; i < 
IWLAGN_STATION_COUNT
; i++) {

250 i‡(
	`ëhî_addr_equÆ
(
¥iv
->
°©i⁄s
[
i
].
°a
.°a.
addr
,

251 
addr
)) {

252 
°a_id
 = 
i
;

256 i‡(!
¥iv
->
°©i⁄s
[
i
].
u£d
 &&

257 
°a_id
 =
IWL_INVALID_STATION
)

258 
°a_id
 = 
i
;

265 i‡(
	`u∆ikñy
(
°a_id
 =
IWL_INVALID_STATION
))

266  
°a_id
;

273 i‡(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_INPROGRESS
) {

274 
	`IWL_DEBUG_INFO
(
¥iv
, "STA %dálready inÖrocess of being "

275 "added.\n", 
°a_id
);

276  
°a_id
;

279 i‡((
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
) &&

280 (
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
) &&

281 
	`ëhî_addr_equÆ
(
¥iv
->
°©i⁄s
[
°a_id
].
°a
.°a.
addr
,áddr)) {

282 
	`IWL_DEBUG_ASSOC
(
¥iv
, "STA %d (%pM)álreadyádded,Çot "

283 "addögágaö.\n", 
°a_id
, 
addr
);

284  
°a_id
;

287 
°©i⁄
 = &
¥iv
->
°©i⁄s
[
°a_id
];

288 
°©i⁄
->
u£d
 = 
IWL_STA_DRIVER_ACTIVE
;

289 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Add STAÅo driver ID %d: %pM\n",

290 
°a_id
, 
addr
);

291 
¥iv
->
num_°©i⁄s
++;

294 
	`mem£t
(&
°©i⁄
->
°a
, 0, (
iwl_add°a_cmd
));

295 
	`mem˝y
(
°©i⁄
->
°a
.°a.
addr
,áddr, 
ETH_ALEN
);

296 
°©i⁄
->
°a
.
mode
 = 0;

297 
°©i⁄
->
°a
.°a.
°a_id
 = sta_id;

298 
°©i⁄
->
°a
.
°©i⁄_Êags
 = 
˘x
->station_flags;

299 
°©i⁄
->
˘xid
 = 
˘x
->ctxid;

301 i‡(
°a
) {

302 
iwl_°©i⁄_¥iv
 *
°a_¥iv
;

304 
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

305 
°a_¥iv
->
˘x
 = ctx;

313 
	`iwl_£t_ht_add_°©i⁄
(
¥iv
, 
°a_id
, 
°a
, 
˘x
);

315  
°a_id
;

317 
	}
}

319 
	#STA_WAIT_TIMEOUT
 (
HZ
/2)

	)

324 
	$iwl_add_°©i⁄_comm⁄
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

325 c⁄° 
u8
 *
addr
, 
boﬁ
 
is_≠
,

326 
õì80211_°a
 *
°a
, 
u8
 *
°a_id_r
)

328 
ªt
 = 0;

329 
u8
 
°a_id
;

330 
iwl_add°a_cmd
 
°a_cmd
;

332 *
°a_id_r
 = 0;

333 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

334 
°a_id
 = 
	`iwl_¥ï_°©i⁄
(
¥iv
, 
˘x
, 
addr
, 
is_≠
, 
°a
);

335 i‡(
°a_id
 =
IWL_INVALID_STATION
) {

336 
	`IWL_ERR
(
¥iv
, "UnableÅoÖrepare station %pM foráddition\n",

337 
addr
);

338 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

339  -
EINVAL
;

347 i‡(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_INPROGRESS
) {

348 
	`IWL_DEBUG_INFO
(
¥iv
, "STA %dálready inÖrocess of being "

349 "added.\n", 
°a_id
);

350 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

351  -
EEXIST
;

354 i‡((
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
) &&

355 (
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
)) {

356 
	`IWL_DEBUG_ASSOC
(
¥iv
, "STA %d (%pM)álreadyádded,Çot "

357 "addögágaö.\n", 
°a_id
, 
addr
);

358 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

359  -
EEXIST
;

362 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 |
IWL_STA_UCODE_INPROGRESS
;

363 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
°a_id
].
°a
,

364 (
iwl_add°a_cmd
));

365 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

368 
ªt
 = 
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 0);

369 i‡(
ªt
) {

370 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

371 
	`IWL_ERR
(
¥iv
, "Adding station %pM failed.\n",

372 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.°a.
addr
);

373 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &~
IWL_STA_DRIVER_ACTIVE
;

374 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &~
IWL_STA_UCODE_INPROGRESS
;

375 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

377 *
°a_id_r
 = 
°a_id
;

378  
ªt
;

379 
	}
}

384 
	$iwl_°a_ucode_dó˘iv©e
(
iwl_¥iv
 *
¥iv
, 
u8
 
°a_id
)

386 
	`lockdï_as£π_hñd
(&
¥iv
->
°a_lock
);

389 i‡((
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &

390 (
IWL_STA_UCODE_ACTIVE
 | 
IWL_STA_DRIVER_ACTIVE
)) !=

391 
IWL_STA_UCODE_ACTIVE
)

392 
	`IWL_ERR
(
¥iv
, "ªmovedÇ⁄á˘ivêSTA %u\n", 
°a_id
);

394 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &~
IWL_STA_UCODE_ACTIVE
;

396 
	`mem£t
(&
¥iv
->
°©i⁄s
[
°a_id
], 0, (
iwl_°©i⁄_íåy
));

397 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Removed STA %u\n", 
°a_id
);

398 
	}
}

400 
	$iwl_£nd_ªmove_°©i⁄
(
iwl_¥iv
 *
¥iv
,

401 c⁄° 
u8
 *
addr
, 
°a_id
,

402 
boﬁ
 
ãmp‹¨y
)

404 
iwl_rx_∑ckë
 *
pkt
;

405 
ªt
;

406 
iwl_ªm_°a_cmd
 
rm_°a_cmd
;

407 
iwl_ªm_°a_ª•
 *
ªm_°a_ª•
;

409 
iwl_ho°_cmd
 
cmd
 = {

410 .
id
 = 
REPLY_REMOVE_STA
,

411 .
Àn
 = { (
iwl_ªm_°a_cmd
), },

412 .
d©a
 = { &
rm_°a_cmd
, },

415 
	`mem£t
(&
rm_°a_cmd
, 0, (rm_sta_cmd));

416 
rm_°a_cmd
.
num_°a
 = 1;

417 
	`mem˝y
(&
rm_°a_cmd
.
addr
,áddr, 
ETH_ALEN
);

419 
cmd
.
Êags
 |
CMD_WANT_SKB
;

421 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

423 i‡(
ªt
)

424  
ªt
;

426 
pkt
 = 
cmd
.
ª•_pkt
;

427 
ªm_°a_ª•
 = (*)
pkt
->
d©a
;

429 
ªm_°a_ª•
->
°©us
) {

430 
REM_STA_SUCCESS_MSK
:

431 i‡(!
ãmp‹¨y
) {

432 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

433 
	`iwl_°a_ucode_dó˘iv©e
(
¥iv
, 
°a_id
);

434 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

436 
	`IWL_DEBUG_ASSOC
(
¥iv
, "REPLY_REMOVE_STA PASSED\n");

439 
ªt
 = -
EIO
;

440 
	`IWL_ERR
(
¥iv
, "REPLY_REMOVE_STA failed\n");

444 
	`iwl_‰ì_ª•
(&
cmd
);

446  
ªt
;

447 
	}
}

452 
	$iwl_ªmove_°©i⁄
(
iwl_¥iv
 *
¥iv
, c⁄° 
u8
 
°a_id
,

453 c⁄° 
u8
 *
addr
)

455 
u8
 
tid
;

457 i‡(!
	`iwl_is_ªady
(
¥iv
)) {

458 
	`IWL_DEBUG_INFO
(
¥iv
,

460 
addr
);

469 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Removing STA from driver:%d %pM\n",

470 
°a_id
, 
addr
);

472 i‡(
	`WARN_ON
(
°a_id
 =
IWL_INVALID_STATION
))

473  -
EINVAL
;

475 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

477 i‡(!(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
)) {

478 
	`IWL_DEBUG_INFO
(
¥iv
, "Removing %pM butÇon DRIVERáctive\n",

479 
addr
);

480 
out_îr
;

483 i‡(!(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
)) {

484 
	`IWL_DEBUG_INFO
(
¥iv
, "Removing %pM butÇon UCODEáctive\n",

485 
addr
);

486 
out_îr
;

489 i‡(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_LOCAL
) {

490 
	`k‰ì
(
¥iv
->
°©i⁄s
[
°a_id
].
lq
);

491 
¥iv
->
°©i⁄s
[
°a_id
].
lq
 = 
NULL
;

494 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++)

495 
	`mem£t
(&
¥iv
->
tid_d©a
[
°a_id
][
tid
], 0,

496 (
¥iv
->
tid_d©a
[
°a_id
][
tid
]));

498 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &~
IWL_STA_DRIVER_ACTIVE
;

500 
¥iv
->
num_°©i⁄s
--;

502 i‡(
	`WARN_ON
(
¥iv
->
num_°©i⁄s
 < 0))

503 
¥iv
->
num_°©i⁄s
 = 0;

505 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

507  
	`iwl_£nd_ªmove_°©i⁄
(
¥iv
, 
addr
, 
°a_id
, 
Ál£
);

508 
out_îr
:

509 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

510  -
EINVAL
;

511 
	}
}

513 
	$iwl_dó˘iv©e_°©i⁄
(
iwl_¥iv
 *
¥iv
, c⁄° 
u8
 
°a_id
,

514 c⁄° 
u8
 *
addr
)

516 
u8
 
tid
;

518 i‡(!
	`iwl_is_ªady
(
¥iv
)) {

519 
	`IWL_DEBUG_INFO
(
¥iv
,

521 
addr
);

525 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Dó˘iv©ög STA: %pM (%d)\n", 
addr
, 
°a_id
);

527 i‡(
	`WARN_ON_ONCE
(
°a_id
 =
IWL_INVALID_STATION
))

530 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

532 
	`WARN_ON_ONCE
(!(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
));

534 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++)

535 
	`mem£t
(&
¥iv
->
tid_d©a
[
°a_id
][
tid
], 0,

536 (
¥iv
->
tid_d©a
[
°a_id
][
tid
]));

538 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &~
IWL_STA_DRIVER_ACTIVE
;

539 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 &~
IWL_STA_UCODE_INPROGRESS
;

541 
¥iv
->
num_°©i⁄s
--;

543 i‡(
	`WARN_ON_ONCE
(
¥iv
->
num_°©i⁄s
 < 0))

544 
¥iv
->
num_°©i⁄s
 = 0;

546 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

547 
	}
}

549 
	$iwl_°a_fûl_lq
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

550 
u8
 
°a_id
, 
iwl_lök_quÆôy_cmd
 *
lök_cmd
)

552 
i
, 
r
;

553 
u32
 
øã_Êags
 = 0;

554 
__À32
 
øã_n_Êags
;

556 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

558 
	`mem£t
(
lök_cmd
, 0, (*link_cmd));

562 i‡(
¥iv
->
b™d
 =
NL80211_BAND_5GHZ
)

563 
r
 = 
IWL_RATE_6M_INDEX
;

564 i‡(
˘x
 && ctx->
vif
 && ctx->vif->
p2p
)

565 
r
 = 
IWL_RATE_6M_INDEX
;

567 
r
 = 
IWL_RATE_1M_INDEX
;

569 i‡(
r
 >
IWL_FIRST_CCK_RATE
 &&Ñ <
IWL_LAST_CCK_RATE
)

570 
øã_Êags
 |
RATE_MCS_CCK_MSK
;

572 
øã_Êags
 |
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
) <<

573 
RATE_MCS_ANT_POS
;

574 
øã_n_Êags
 = 
	`iwl_hw_£t_øã_n_Êags
(
iwl_øãs
[
r
].
∂˝
, 
øã_Êags
);

575 
i
 = 0; i < 
LINK_QUAL_MAX_RETRY_NUM
; i++)

576 
lök_cmd
->
rs_èbÀ
[
i
].
øã_n_Êags
 =Ñate_n_flags;

578 
lök_cmd
->
gíîÆ_∑øms
.
sögÀ_°ªam_™t_msk
 =

579 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

581 
lök_cmd
->
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 =

582 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
 &

583 ~
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

584 i‡(!
lök_cmd
->
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
) {

585 
lök_cmd
->
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 = 
ANT_AB
;

586 } i‡(
	`num_of_™t
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
) == 2) {

587 
lök_cmd
->
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
 =

588 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
;

591 
lök_cmd
->
agg_∑øms
.
agg_dis_°¨t_th
 =

592 
LINK_QUAL_AGG_DISABLE_START_DEF
;

593 
lök_cmd
->
agg_∑øms
.
agg_time_limô
 =

594 
	`˝u_to_À16
(
LINK_QUAL_AGG_TIME_LIMIT_DEF
);

596 
lök_cmd
->
°a_id
 = sta_id;

597 
	}
}

607 
	$iwl_˛ór_ucode_°©i⁄s
(
iwl_¥iv
 *
¥iv
,

608 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

610 
i
;

611 
boﬁ
 
˛óªd
 = 
Ál£
;

613 
	`IWL_DEBUG_INFO
(
¥iv
, "Clearing ucode stations in driver\n");

615 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

616 
i
 = 0; i < 
IWLAGN_STATION_COUNT
; i++) {

617 i‡(
˘x
 && ctx->
˘xid
 !
¥iv
->
°©i⁄s
[
i
].ctxid)

620 i‡(
¥iv
->
°©i⁄s
[
i
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
) {

621 
	`IWL_DEBUG_INFO
(
¥iv
,

622 "CÀ¨ög ucodêa˘ivêf‹ sèti⁄ %d\n", 
i
);

623 
¥iv
->
°©i⁄s
[
i
].
u£d
 &~
IWL_STA_UCODE_ACTIVE
;

624 
˛óªd
 = 
åue
;

627 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

629 i‡(!
˛óªd
)

630 
	`IWL_DEBUG_INFO
(
¥iv
,

632 
	}
}

642 
	$iwl_ª°‹e_°©i⁄s
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

644 
iwl_add°a_cmd
 
°a_cmd
;

645 c⁄° 
iwl_lök_quÆôy_cmd
 
zîo_lq
 = {};

646 
iwl_lök_quÆôy_cmd
 
lq
;

647 
i
;

648 
boﬁ
 
found
 = 
Ál£
;

649 
ªt
;

650 
boﬁ
 
£nd_lq
;

652 i‡(!
	`iwl_is_ªady
(
¥iv
)) {

653 
	`IWL_DEBUG_INFO
(
¥iv
,

658 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Restoringáll known stations ... start.\n");

659 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

660 
i
 = 0; i < 
IWLAGN_STATION_COUNT
; i++) {

661 i‡(
˘x
->
˘xid
 !
¥iv
->
°©i⁄s
[
i
].ctxid)

663 i‡((
¥iv
->
°©i⁄s
[
i
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
) &&

664 !(
¥iv
->
°©i⁄s
[
i
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
)) {

665 
	`IWL_DEBUG_ASSOC
(
¥iv
, "Restoring sta %pM\n",

666 
¥iv
->
°©i⁄s
[
i
].
°a
.°a.
addr
);

667 
¥iv
->
°©i⁄s
[
i
].
°a
.
mode
 = 0;

668 
¥iv
->
°©i⁄s
[
i
].
u£d
 |
IWL_STA_UCODE_INPROGRESS
;

669 
found
 = 
åue
;

673 
i
 = 0; i < 
IWLAGN_STATION_COUNT
; i++) {

674 i‡((
¥iv
->
°©i⁄s
[
i
].
u£d
 & 
IWL_STA_UCODE_INPROGRESS
)) {

675 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
i
].
°a
,

676 (
iwl_add°a_cmd
));

677 
£nd_lq
 = 
Ál£
;

678 i‡(
¥iv
->
°©i⁄s
[
i
].
lq
) {

679 i‡(
¥iv
->
wowœn
)

680 
	`iwl_°a_fûl_lq
(
¥iv
, 
˘x
, 
i
, &
lq
);

682 
	`mem˝y
(&
lq
, 
¥iv
->
°©i⁄s
[
i
].lq,

683 (
iwl_lök_quÆôy_cmd
));

685 i‡(
	`memcmp
(&
lq
, &
zîo_lq
, (lq)))

686 
£nd_lq
 = 
åue
;

688 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

689 
ªt
 = 
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 0);

690 i‡(
ªt
) {

691 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

692 
	`IWL_ERR
(
¥iv
, "Adding station %pM failed.\n",

693 
¥iv
->
°©i⁄s
[
i
].
°a
.°a.
addr
);

694 
¥iv
->
°©i⁄s
[
i
].
u£d
 &=

695 ~
IWL_STA_DRIVER_ACTIVE
;

696 
¥iv
->
°©i⁄s
[
i
].
u£d
 &=

697 ~
IWL_STA_UCODE_INPROGRESS
;

704 i‡(
£nd_lq
)

705 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, &
lq
, 0, 
åue
);

706 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

707 
¥iv
->
°©i⁄s
[
i
].
u£d
 &~
IWL_STA_UCODE_INPROGRESS
;

711 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

712 i‡(!
found
)

713 
	`IWL_DEBUG_INFO
(
¥iv
, "Restoringáll known stations .... "

716 
	`IWL_DEBUG_INFO
(
¥iv
, "Restoringáll known stations .... "

718 
	}
}

720 
	$iwl_gë_‰ì_ucode_key_off£t
(
iwl_¥iv
 *
¥iv
)

722 
i
;

724 
i
 = 0; i < 
¥iv
->
°a_key_max_num
; i++)

725 i‡(!
	`ã°_™d_£t_bô
(
i
, &
¥iv
->
ucode_key_èbÀ
))

726  
i
;

728  
WEP_INVALID_OFFSET
;

729 
	}
}

731 
	$iwl_dóŒoc_bˇ°_°©i⁄s
(
iwl_¥iv
 *
¥iv
)

733 
i
;

735 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

736 
i
 = 0; i < 
IWLAGN_STATION_COUNT
; i++) {

737 i‡(!(
¥iv
->
°©i⁄s
[
i
].
u£d
 & 
IWL_STA_BCAST
))

740 
¥iv
->
°©i⁄s
[
i
].
u£d
 &~
IWL_STA_UCODE_ACTIVE
;

741 
¥iv
->
num_°©i⁄s
--;

742 i‡(
	`WARN_ON
(
¥iv
->
num_°©i⁄s
 < 0))

743 
¥iv
->
num_°©i⁄s
 = 0;

744 
	`k‰ì
(
¥iv
->
°©i⁄s
[
i
].
lq
);

745 
¥iv
->
°©i⁄s
[
i
].
lq
 = 
NULL
;

747 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

748 
	}
}

750 #ifde‡
CONFIG_IWLWIFI_DEBUG


751 
	$iwl_dump_lq_cmd
(
iwl_¥iv
 *
¥iv
,

752 
iwl_lök_quÆôy_cmd
 *
lq
)

754 
i
;

755 
	`IWL_DEBUG_RATE
(
¥iv
, "lq sèti⁄ id 0x%x\n", 
lq
->
°a_id
);

756 
	`IWL_DEBUG_RATE
(
¥iv
, "lqánt 0x%X 0x%X\n",

757 
lq
->
gíîÆ_∑øms
.
sögÀ_°ªam_™t_msk
,

758 
lq
->
gíîÆ_∑øms
.
duÆ_°ªam_™t_msk
);

760 
i
 = 0; i < 
LINK_QUAL_MAX_RETRY_NUM
; i++)

761 
	`IWL_DEBUG_RATE
(
¥iv
, "lq index %d 0x%X\n",

762 
i
, 
lq
->
rs_èbÀ
[i].
øã_n_Êags
);

763 
	}
}

765 
ölöe
 
	$iwl_dump_lq_cmd
(
iwl_¥iv
 *
¥iv
,

766 
iwl_lök_quÆôy_cmd
 *
lq
)

768 
	}
}

782 
boﬁ
 
	$is_lq_èbÀ_vÆid
(
iwl_¥iv
 *
¥iv
,

783 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

784 
iwl_lök_quÆôy_cmd
 *
lq
)

786 
i
;

788 i‡(
˘x
->
ht
.
íabÀd
)

789  
åue
;

791 
	`IWL_DEBUG_INFO
(
¥iv
, "Channel %u isÇotán HT channel\n",

792 
˘x
->
a˘ive
.
ch™√l
);

793 
i
 = 0; i < 
LINK_QUAL_MAX_RETRY_NUM
; i++) {

794 i‡(
	`À32_to_˝u
(
lq
->
rs_èbÀ
[
i
].
øã_n_Êags
) &

795 
RATE_MCS_HT_MSK
) {

796 
	`IWL_DEBUG_INFO
(
¥iv
,

798 
i
);

799  
Ál£
;

802  
åue
;

803 
	}
}

815 
	$iwl_£nd_lq_cmd
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

816 
iwl_lök_quÆôy_cmd
 *
lq
, 
u8
 
Êags
, 
boﬁ
 
öô
)

818 
ªt
 = 0;

819 
iwl_ho°_cmd
 
cmd
 = {

820 .
id
 = 
REPLY_TX_LINK_QUALITY_CMD
,

821 .
Àn
 = { (
iwl_lök_quÆôy_cmd
), },

822 .
Êags
 = flags,

823 .
d©a
 = { 
lq
, },

826 i‡(
	`WARN_ON
(
lq
->
°a_id
 =
IWL_INVALID_STATION
))

827  -
EINVAL
;

830 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

831 i‡(!(
¥iv
->
°©i⁄s
[
lq
->
°a_id
].
u£d
 & 
IWL_STA_DRIVER_ACTIVE
)) {

832 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

833  -
EINVAL
;

835 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

837 
	`iwl_dump_lq_cmd
(
¥iv
, 
lq
);

838 i‡(
	`WARN_ON
(
öô
 && (
cmd
.
Êags
 & 
CMD_ASYNC
)))

839  -
EINVAL
;

841 i‡(
	`is_lq_èbÀ_vÆid
(
¥iv
, 
˘x
, 
lq
))

842 
ªt
 = 
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

844 
ªt
 = -
EINVAL
;

846 i‡(
cmd
.
Êags
 & 
CMD_ASYNC
)

847  
ªt
;

849 i‡(
öô
) {

850 
	`IWL_DEBUG_INFO
(
¥iv
, "init LQ command complete, "

852 
lq
->
°a_id
);

853 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

854 
¥iv
->
°©i⁄s
[
lq
->
°a_id
].
u£d
 &~
IWL_STA_UCODE_INPROGRESS
;

855 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

857  
ªt
;

858 
	}
}

861 
iwl_lök_quÆôy_cmd
 *

862 
	$iwl_°a_Æloc_lq
(
iwl_¥iv
 *
¥iv
, 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

863 
u8
 
°a_id
)

865 
iwl_lök_quÆôy_cmd
 *
lök_cmd
;

867 
lök_cmd
 = 
	`kzÆloc
((
iwl_lök_quÆôy_cmd
), 
GFP_KERNEL
);

868 i‡(!
lök_cmd
) {

869 
	`IWL_ERR
(
¥iv
, "UnableÅoállocate memory for LQ cmd.\n");

870  
NULL
;

873 
	`iwl_°a_fûl_lq
(
¥iv
, 
˘x
, 
°a_id
, 
lök_cmd
);

875  
lök_cmd
;

876 
	}
}

883 
	$iwœgn_add_bssid_°©i⁄
(
iwl_¥iv
 *
¥iv
,

884 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

885 c⁄° 
u8
 *
addr
, u8 *
°a_id_r
)

887 
ªt
;

888 
u8
 
°a_id
;

889 
iwl_lök_quÆôy_cmd
 *
lök_cmd
;

891 i‡(
°a_id_r
)

892 *
°a_id_r
 = 
IWL_INVALID_STATION
;

894 
ªt
 = 
	`iwl_add_°©i⁄_comm⁄
(
¥iv
, 
˘x
, 
addr
, 0, 
NULL
, &
°a_id
);

895 i‡(
ªt
) {

896 
	`IWL_ERR
(
¥iv
, "U«bÀÅÿadd sèti⁄ %pM\n", 
addr
);

897  
ªt
;

900 i‡(
°a_id_r
)

901 *
°a_id_r
 = 
°a_id
;

903 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

904 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 |
IWL_STA_LOCAL
;

905 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

908 
lök_cmd
 = 
	`iwl_°a_Æloc_lq
(
¥iv
, 
˘x
, 
°a_id
);

909 i‡(!
lök_cmd
) {

910 
	`IWL_ERR
(
¥iv
,

912 
addr
);

913  -
ENOMEM
;

916 
ªt
 = 
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
, 
lök_cmd
, 0, 
åue
);

917 i‡(
ªt
)

918 
	`IWL_ERR
(
¥iv
, "Lök quÆôy comm™d faûed (%d)\n", 
ªt
);

920 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

921 
¥iv
->
°©i⁄s
[
°a_id
].
lq
 = 
lök_cmd
;

922 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

925 
	}
}

935 
	$iwl_£nd_°©ic_wïkey_cmd
(
iwl_¥iv
 *
¥iv
,

936 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

937 
boﬁ
 
£nd_if_em±y
)

939 
i
, 
nŸ_em±y
 = 0;

940 
u8
 
buff
[(
iwl_wï_cmd
) +

941 (
iwl_wï_key
Ë* 
WEP_KEYS_MAX
];

942 
iwl_wï_cmd
 *
wï_cmd
 = (iwl_wï_cmd *)
buff
;

943 
size_t
 
cmd_size
 = (
iwl_wï_cmd
);

944 
iwl_ho°_cmd
 
cmd
 = {

945 .
id
 = 
˘x
->
wï_key_cmd
,

946 .
d©a
 = { 
wï_cmd
, },

949 
	`might_¶ìp
();

951 
	`mem£t
(
wï_cmd
, 0, 
cmd_size
 +

952 ((
iwl_wï_key
Ë* 
WEP_KEYS_MAX
));

954 
i
 = 0; i < 
WEP_KEYS_MAX
 ; i++) {

955 
wï_cmd
->
key
[
i
].
key_ödex
 = i;

956 i‡(
˘x
->
wï_keys
[
i
].
key_size
) {

957 
wï_cmd
->
key
[
i
].
key_off£t
 = i;

958 
nŸ_em±y
 = 1;

960 
wï_cmd
->
key
[
i
].
key_off£t
 = 
WEP_INVALID_OFFSET
;

963 
wï_cmd
->
key
[
i
].
key_size
 = 
˘x
->
wï_keys
[i].key_size;

964 
	`mem˝y
(&
wï_cmd
->
key
[
i
].key[3], 
˘x
->
wï_keys
[i].key,

965 
˘x
->
wï_keys
[
i
].
key_size
);

968 
wï_cmd
->
globÆ_key_ty≥
 = 
WEP_KEY_WEP_TYPE
;

969 
wï_cmd
->
num_keys
 = 
WEP_KEYS_MAX
;

971 
cmd_size
 +(
iwl_wï_key
Ë* 
WEP_KEYS_MAX
;

973 
cmd
.
Àn
[0] = 
cmd_size
;

975 i‡(
nŸ_em±y
 || 
£nd_if_em±y
)

976  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

979 
	}
}

981 
	$iwl_ª°‹e_deÁu…_wï_keys
(
iwl_¥iv
 *
¥iv
,

982 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

984 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

986  
	`iwl_£nd_°©ic_wïkey_cmd
(
¥iv
, 
˘x
, 
Ál£
);

987 
	}
}

989 
	$iwl_ªmove_deÁu…_wï_key
(
iwl_¥iv
 *
¥iv
,

990 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

991 
õì80211_key_c⁄f
 *
keyc⁄f
)

993 
ªt
;

995 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

997 
	`IWL_DEBUG_WEP
(
¥iv
, "Removing default WEP key: idx=%d\n",

998 
keyc⁄f
->
keyidx
);

1000 
	`mem£t
(&
˘x
->
wï_keys
[
keyc⁄f
->
keyidx
], 0, (ctx->wep_keys[0]));

1001 i‡(
	`iwl_is_rfkûl
(
¥iv
)) {

1002 
	`IWL_DEBUG_WEP
(
¥iv
,

1007 
ªt
 = 
	`iwl_£nd_°©ic_wïkey_cmd
(
¥iv
, 
˘x
, 1);

1008 
	`IWL_DEBUG_WEP
(
¥iv
, "Remove default WEP key: idx=%dÑet=%d\n",

1009 
keyc⁄f
->
keyidx
, 
ªt
);

1011  
ªt
;

1012 
	}
}

1014 
	$iwl_£t_deÁu…_wï_key
(
iwl_¥iv
 *
¥iv
,

1015 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

1016 
õì80211_key_c⁄f
 *
keyc⁄f
)

1018 
ªt
;

1020 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1022 i‡(
keyc⁄f
->
keyÀn
 !
WEP_KEY_LEN_128
 &&

1023 
keyc⁄f
->
keyÀn
 !
WEP_KEY_LEN_64
) {

1024 
	`IWL_DEBUG_WEP
(
¥iv
,

1025 "Bad WEP keyÜígth %d\n", 
keyc⁄f
->
keyÀn
);

1026  -
EINVAL
;

1029 
keyc⁄f
->
hw_key_idx
 = 
IWLAGN_HW_KEY_DEFAULT
;

1031 
˘x
->
wï_keys
[
keyc⁄f
->
keyidx
].
key_size
 = keyc⁄f->
keyÀn
;

1032 
	`mem˝y
(&
˘x
->
wï_keys
[
keyc⁄f
->
keyidx
].
key
, &keyconf->key,

1033 
keyc⁄f
->
keyÀn
);

1035 
ªt
 = 
	`iwl_£nd_°©ic_wïkey_cmd
(
¥iv
, 
˘x
, 
Ál£
);

1036 
	`IWL_DEBUG_WEP
(
¥iv
, "Set default WEP key:Üen=%d idx=%dÑet=%d\n",

1037 
keyc⁄f
->
keyÀn
, keyc⁄f->
keyidx
, 
ªt
);

1039  
ªt
;

1040 
	}
}

1057 
u8
 
	$iwœgn_key_°a_id
(
iwl_¥iv
 *
¥iv
,

1058 
õì80211_vif
 *
vif
,

1059 
õì80211_°a
 *
°a
)

1061 
iwl_vif_¥iv
 *
vif_¥iv
 = (*)
vif
->
drv_¥iv
;

1063 i‡(
°a
)

1064  
	`iwl_°a_id
(
°a
);

1071 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && 
vif_¥iv
->
˘x
)

1072  
vif_¥iv
->
˘x
->
≠_°a_id
;

1074  
IWL_INVALID_STATION
;

1075 
	}
}

1077 
	$iwœgn_£nd_°a_key
(
iwl_¥iv
 *
¥iv
,

1078 
õì80211_key_c⁄f
 *
keyc⁄f
,

1079 
u8
 
°a_id
, 
u32
 
tkù_iv32
, 
u16
 *
tkù_p1k
,

1080 
u32
 
cmd_Êags
)

1082 
__À16
 
key_Êags
;

1083 
iwl_add°a_cmd
 
°a_cmd
;

1084 
size_t
 
to_c›y
;

1085 
i
;

1087 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1088 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
°a_id
].
°a
, (sta_cmd));

1089 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1091 
key_Êags
 = 
	`˝u_to_À16
(
keyc⁄f
->
keyidx
 << 
STA_KEY_FLG_KEYID_POS
);

1092 
key_Êags
 |
STA_KEY_FLG_MAP_KEY_MSK
;

1094 
keyc⁄f
->
cùhî
) {

1095 
WLAN_CIPHER_SUITE_CCMP
:

1096 
key_Êags
 |
STA_KEY_FLG_CCMP
;

1097 
	`mem˝y
(
°a_cmd
.
key
.key, 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

1099 
WLAN_CIPHER_SUITE_TKIP
:

1100 
key_Êags
 |
STA_KEY_FLG_TKIP
;

1101 
°a_cmd
.
key
.
tkù_rx_tsc_byã2
 = 
tkù_iv32
;

1102 
i
 = 0; i < 5; i++)

1103 
°a_cmd
.
key
.
tkù_rx_âak
[
i
] = 
	`˝u_to_À16
(
tkù_p1k
[i]);

1105 
to_c›y
 = 
	`mö_t
(
size_t
, (
°a_cmd
.
key
.key), 
keyc⁄f
->
keyÀn
);

1106 
	`mem˝y
(
°a_cmd
.
key
.key, 
keyc⁄f
->key, 
to_c›y
);

1108 
WLAN_CIPHER_SUITE_WEP104
:

1109 
key_Êags
 |
STA_KEY_FLG_KEY_SIZE_MSK
;

1110 
ÁŒthrough
;

1111 
WLAN_CIPHER_SUITE_WEP40
:

1112 
key_Êags
 |
STA_KEY_FLG_WEP
;

1113 
	`mem˝y
(&
°a_cmd
.
key
.key[3], 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

1116 
	`WARN_ON
(1);

1117  -
EINVAL
;

1120 i‡(!(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
))

1121 
key_Êags
 |
STA_KEY_MULTICAST_MSK
;

1124 
°a_cmd
.
key
.
key_off£t
 = 
keyc⁄f
->
hw_key_idx
;

1126 
°a_cmd
.
key
.
key_Êags
 = key_flags;

1127 
°a_cmd
.
mode
 = 
STA_CONTROL_MODIFY_MSK
;

1128 
°a_cmd
.
°a
.
modify_mask
 = 
STA_MODIFY_KEY_MASK
;

1130  
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 
cmd_Êags
);

1131 
	}
}

1133 
	$iwl_upd©e_tkù_key
(
iwl_¥iv
 *
¥iv
,

1134 
õì80211_vif
 *
vif
,

1135 
õì80211_key_c⁄f
 *
keyc⁄f
,

1136 
õì80211_°a
 *
°a
, 
u32
 
iv32
, 
u16
 *
pha£1key
)

1138 
u8
 
°a_id
 = 
	`iwœgn_key_°a_id
(
¥iv
, 
vif
, 
°a
);

1140 i‡(
°a_id
 =
IWL_INVALID_STATION
)

1143 i‡(
	`iwl_sˇn_ˇn˚l
(
¥iv
)) {

1149 
	`iwœgn_£nd_°a_key
(
¥iv
, 
keyc⁄f
, 
°a_id
,

1150 
iv32
, 
pha£1key
, 
CMD_ASYNC
);

1151 
	}
}

1153 
	$iwl_ªmove_dy«mic_key
(
iwl_¥iv
 *
¥iv
,

1154 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

1155 
õì80211_key_c⁄f
 *
keyc⁄f
,

1156 
õì80211_°a
 *
°a
)

1158 
iwl_add°a_cmd
 
°a_cmd
;

1159 
u8
 
°a_id
 = 
	`iwœgn_key_°a_id
(
¥iv
, 
˘x
->
vif
, 
°a
);

1160 
__À16
 
key_Êags
;

1163 i‡(
°a_id
 =
IWL_INVALID_STATION
)

1164  -
ENOENT
;

1166 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1167 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
°a_id
].
°a
, (sta_cmd));

1168 i‡(!(
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 & 
IWL_STA_UCODE_ACTIVE
))

1169 
°a_id
 = 
IWL_INVALID_STATION
;

1170 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1172 i‡(
°a_id
 =
IWL_INVALID_STATION
)

1175 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1177 
˘x
->
key_m≠pög_keys
--;

1179 
	`IWL_DEBUG_WEP
(
¥iv
, "Remove dynamic key: idx=%d sta=%d\n",

1180 
keyc⁄f
->
keyidx
, 
°a_id
);

1182 i‡(!
	`ã°_™d_˛ór_bô
(
keyc⁄f
->
hw_key_idx
, &
¥iv
->
ucode_key_èbÀ
))

1183 
	`IWL_ERR
(
¥iv
, "offset %dÇot used in uCode keyÅable.\n",

1184 
keyc⁄f
->
hw_key_idx
);

1186 
key_Êags
 = 
	`˝u_to_À16
(
keyc⁄f
->
keyidx
 << 
STA_KEY_FLG_KEYID_POS
);

1187 
key_Êags
 |
STA_KEY_FLG_MAP_KEY_MSK
 | 
STA_KEY_FLG_NO_ENC
 |

1188 
STA_KEY_FLG_INVALID
;

1190 i‡(!(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
))

1191 
key_Êags
 |
STA_KEY_MULTICAST_MSK
;

1193 
°a_cmd
.
key
.
key_Êags
 = key_flags;

1194 
°a_cmd
.
key
.
key_off£t
 = 
keyc⁄f
->
hw_key_idx
;

1195 
°a_cmd
.
°a
.
modify_mask
 = 
STA_MODIFY_KEY_MASK
;

1196 
°a_cmd
.
mode
 = 
STA_CONTROL_MODIFY_MSK
;

1198  
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 0);

1199 
	}
}

1201 
	$iwl_£t_dy«mic_key
(
iwl_¥iv
 *
¥iv
,

1202 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

1203 
õì80211_key_c⁄f
 *
keyc⁄f
,

1204 
õì80211_°a
 *
°a
)

1206 
õì80211_key_£q
 
£q
;

1207 
u16
 
p1k
[5];

1208 
ªt
;

1209 
u8
 
°a_id
 = 
	`iwœgn_key_°a_id
(
¥iv
, 
˘x
->
vif
, 
°a
);

1210 c⁄° 
u8
 *
addr
;

1212 i‡(
°a_id
 =
IWL_INVALID_STATION
)

1213  -
EINVAL
;

1215 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1217 
keyc⁄f
->
hw_key_idx
 = 
	`iwl_gë_‰ì_ucode_key_off£t
(
¥iv
);

1218 i‡(
keyc⁄f
->
hw_key_idx
 =
WEP_INVALID_OFFSET
)

1219  -
ENOSPC
;

1221 
˘x
->
key_m≠pög_keys
++;

1223 
keyc⁄f
->
cùhî
) {

1224 
WLAN_CIPHER_SUITE_TKIP
:

1225 i‡(
°a
)

1226 
addr
 = 
°a
->addr;

1228 
addr
 = 
˘x
->
a˘ive
.
bssid_addr
;

1231 
	`õì80211_gë_key_rx_£q
(
keyc⁄f
, 0, &
£q
);

1232 
	`õì80211_gë_tkù_rx_p1k
(
keyc⁄f
, 
addr
, 
£q
.
tkù
.
iv32
, 
p1k
);

1233 
ªt
 = 
	`iwœgn_£nd_°a_key
(
¥iv
, 
keyc⁄f
, 
°a_id
,

1234 
£q
.
tkù
.
iv32
, 
p1k
, 0);

1236 
WLAN_CIPHER_SUITE_CCMP
:

1237 
WLAN_CIPHER_SUITE_WEP40
:

1238 
WLAN_CIPHER_SUITE_WEP104
:

1239 
ªt
 = 
	`iwœgn_£nd_°a_key
(
¥iv
, 
keyc⁄f
, 
°a_id
,

1240 0, 
NULL
, 0);

1243 
	`IWL_ERR
(
¥iv
, "Unknow¿cùhî %x\n", 
keyc⁄f
->
cùhî
);

1244 
ªt
 = -
EINVAL
;

1247 i‡(
ªt
) {

1248 
˘x
->
key_m≠pög_keys
--;

1249 
	`˛ór_bô
(
keyc⁄f
->
hw_key_idx
, &
¥iv
->
ucode_key_èbÀ
);

1252 
	`IWL_DEBUG_WEP
(
¥iv
, "Set dynamic key: cipher=%xÜen=%d idx=%d sta=%pMÑet=%d\n",

1253 
keyc⁄f
->
cùhî
, keyc⁄f->
keyÀn
, keyc⁄f->
keyidx
,

1254 
°a
 ? sè->
addr
 : 
NULL
, 
ªt
);

1256  
ªt
;

1257 
	}
}

1266 
	$iwœgn_Æloc_bˇ°_°©i⁄
(
iwl_¥iv
 *
¥iv
,

1267 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

1269 
iwl_lök_quÆôy_cmd
 *
lök_cmd
;

1270 
u8
 
°a_id
;

1272 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1273 
°a_id
 = 
	`iwl_¥ï_°©i⁄
(
¥iv
, 
˘x
, 
iwl_bˇ°_addr
, 
Ál£
, 
NULL
);

1274 i‡(
°a_id
 =
IWL_INVALID_STATION
) {

1275 
	`IWL_ERR
(
¥iv
, "UnableÅoÖrepare broadcast station\n");

1276 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1278  -
EINVAL
;

1281 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 |
IWL_STA_DRIVER_ACTIVE
;

1282 
¥iv
->
°©i⁄s
[
°a_id
].
u£d
 |
IWL_STA_BCAST
;

1283 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1285 
lök_cmd
 = 
	`iwl_°a_Æloc_lq
(
¥iv
, 
˘x
, 
°a_id
);

1286 i‡(!
lök_cmd
) {

1287 
	`IWL_ERR
(
¥iv
,

1289  -
ENOMEM
;

1292 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1293 
¥iv
->
°©i⁄s
[
°a_id
].
lq
 = 
lök_cmd
;

1294 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1297 
	}
}

1305 
	$iwl_upd©e_bˇ°_°©i⁄
(
iwl_¥iv
 *
¥iv
,

1306 
iwl_rx⁄_c⁄ãxt
 *
˘x
)

1308 
iwl_lök_quÆôy_cmd
 *
lök_cmd
;

1309 
u8
 
°a_id
 = 
˘x
->
bˇ°_°a_id
;

1311 
lök_cmd
 = 
	`iwl_°a_Æloc_lq
(
¥iv
, 
˘x
, 
°a_id
);

1312 i‡(!
lök_cmd
) {

1313 
	`IWL_ERR
(
¥iv
, "UnableÅo initializeÑate scaling for bcast station.\n");

1314  -
ENOMEM
;

1317 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1318 i‡(
¥iv
->
°©i⁄s
[
°a_id
].
lq
)

1319 
	`k‰ì
(
¥iv
->
°©i⁄s
[
°a_id
].
lq
);

1321 
	`IWL_DEBUG_INFO
(
¥iv
, "Bcast stationÑate scaling hasÇot been initialized yet.\n");

1322 
¥iv
->
°©i⁄s
[
°a_id
].
lq
 = 
lök_cmd
;

1323 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1326 
	}
}

1328 
	$iwl_upd©e_bˇ°_°©i⁄s
(
iwl_¥iv
 *
¥iv
)

1330 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

1331 
ªt
 = 0;

1333 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

1334 
ªt
 = 
	`iwl_upd©e_bˇ°_°©i⁄
(
¥iv
, 
˘x
);

1335 i‡(
ªt
)

1339  
ªt
;

1340 
	}
}

1345 
	$iwl_°a_tx_modify_íabÀ_tid
(
iwl_¥iv
 *
¥iv
, 
°a_id
, 
tid
)

1347 
iwl_add°a_cmd
 
°a_cmd
;

1349 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1352 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1353 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.°a.
modify_mask
 = 
STA_MODIFY_TID_DISABLE_TX
;

1354 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
tid_dißbÀ_tx
 &
	`˝u_to_À16
(~(1 << 
tid
));

1355 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
mode
 = 
STA_CONTROL_MODIFY_MSK
;

1356 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
°a_id
].
°a
, (
iwl_add°a_cmd
));

1357 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1359  
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 0);

1360 
	}
}

1362 
	$iwl_°a_rx_agg_°¨t
(
iwl_¥iv
 *
¥iv
, 
õì80211_°a
 *
°a
,

1363 
tid
, 
u16
 
s¢
)

1365 
°a_id
;

1366 
iwl_add°a_cmd
 
°a_cmd
;

1368 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1370 
°a_id
 = 
	`iwl_°a_id
(
°a
);

1371 i‡(
°a_id
 =
IWL_INVALID_STATION
)

1372  -
ENXIO
;

1374 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1375 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
°©i⁄_Êags_msk
 = 0;

1376 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.°a.
modify_mask
 = 
STA_MODIFY_ADDBA_TID_MSK
;

1377 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
add_immedüã_ba_tid
 = (
u8
)
tid
;

1378 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
add_immedüã_ba_s¢
 = 
	`˝u_to_À16
(
s¢
);

1379 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
mode
 = 
STA_CONTROL_MODIFY_MSK
;

1380 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
°a_id
].
°a
, (
iwl_add°a_cmd
));

1381 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1383  
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 0);

1384 
	}
}

1386 
	$iwl_°a_rx_agg_°›
(
iwl_¥iv
 *
¥iv
, 
õì80211_°a
 *
°a
,

1387 
tid
)

1389 
°a_id
;

1390 
iwl_add°a_cmd
 
°a_cmd
;

1392 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

1394 
°a_id
 = 
	`iwl_°a_id
(
°a
);

1395 i‡(
°a_id
 =
IWL_INVALID_STATION
) {

1396 
	`IWL_ERR
(
¥iv
, "InvÆid sèti⁄ f‹ AGGÅid %d\n", 
tid
);

1397  -
ENXIO
;

1400 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1401 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
°©i⁄_Êags_msk
 = 0;

1402 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.°a.
modify_mask
 = 
STA_MODIFY_DELBA_TID_MSK
;

1403 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
ªmove_immedüã_ba_tid
 = (
u8
)
tid
;

1404 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.
mode
 = 
STA_CONTROL_MODIFY_MSK
;

1405 
	`mem˝y
(&
°a_cmd
, &
¥iv
->
°©i⁄s
[
°a_id
].
°a
, (
iwl_add°a_cmd
));

1406 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1408  
	`iwl_£nd_add_°a
(
¥iv
, &
°a_cmd
, 0);

1409 
	}
}

1413 
	$iwl_°a_modify_¶ìp_tx_cou¡
(
iwl_¥iv
 *
¥iv
, 
°a_id
, 
˙t
)

1415 
iwl_add°a_cmd
 
cmd
 = {

1416 .
mode
 = 
STA_CONTROL_MODIFY_MSK
,

1417 .
°©i⁄_Êags
 = 
STA_FLG_PWR_SAVE_MSK
,

1418 .
°©i⁄_Êags_msk
 = 
STA_FLG_PWR_SAVE_MSK
,

1419 .
°a
.
°a_id
 = sta_id,

1420 .
°a
.
modify_mask
 = 
STA_MODIFY_SLEEP_TX_COUNT_MSK
,

1421 .
¶ìp_tx_cou¡
 = 
	`˝u_to_À16
(
˙t
),

1424 
	`iwl_£nd_add_°a
(
¥iv
, &
cmd
, 
CMD_ASYNC
);

1425 
	}
}

	@dvm/tt.c

12 
	~<löux/kî√l.h
>

13 
	~<löux/moduÀ.h
>

14 
	~<löux/¶ab.h
>

15 
	~<√t/mac80211.h
>

16 
	~"iwl-io.h
"

17 
	~"iwl-mod∑øms.h
"

18 
	~"iwl-debug.h
"

19 
	~"agn.h
"

20 
	~"dev.h
"

21 
	~"comm™ds.h
"

22 
	~"â.h
"

35 c⁄° 
iwl_â_å™s
 
	gâ_ønge_0
[
IWL_TI_STATE_MAX
 - 1] = {

36 {
IWL_TI_0
, 
IWL_ABSOLUTE_ZERO
, 104},

37 {
IWL_TI_1
, 105, 
CT_KILL_THRESHOLD
 - 1},

38 {
IWL_TI_CT_KILL
, 
CT_KILL_THRESHOLD
, 
IWL_ABSOLUTE_MAX
}

40 c⁄° 
iwl_â_å™s
 
	gâ_ønge_1
[
IWL_TI_STATE_MAX
 - 1] = {

41 {
IWL_TI_0
, 
IWL_ABSOLUTE_ZERO
, 95},

42 {
IWL_TI_2
, 110, 
CT_KILL_THRESHOLD
 - 1},

43 {
IWL_TI_CT_KILL
, 
CT_KILL_THRESHOLD
, 
IWL_ABSOLUTE_MAX
}

45 c⁄° 
iwl_â_å™s
 
	gâ_ønge_2
[
IWL_TI_STATE_MAX
 - 1] = {

46 {
IWL_TI_1
, 
IWL_ABSOLUTE_ZERO
, 100},

47 {
IWL_TI_CT_KILL
, 
CT_KILL_THRESHOLD
, 
IWL_ABSOLUTE_MAX
},

48 {
IWL_TI_CT_KILL
, 
CT_KILL_THRESHOLD
, 
IWL_ABSOLUTE_MAX
}

50 c⁄° 
iwl_â_å™s
 
	gâ_ønge_3
[
IWL_TI_STATE_MAX
 - 1] = {

51 {
IWL_TI_0
, 
IWL_ABSOLUTE_ZERO
, 
CT_KILL_EXIT_THRESHOLD
},

52 {
IWL_TI_CT_KILL
, 
CT_KILL_EXIT_THRESHOLD
 + 1, 
IWL_ABSOLUTE_MAX
},

53 {
IWL_TI_CT_KILL
, 
CT_KILL_EXIT_THRESHOLD
 + 1, 
IWL_ABSOLUTE_MAX
}

57 c⁄° 
iwl_â_ª°ri˘i⁄
 
	gª°ri˘i⁄_ønge
[
IWL_TI_STATE_MAX
] = {

58 {
IWL_ANT_OK_MULTI
, IWL_ANT_OK_MULTI, 
åue
 },

59 {
IWL_ANT_OK_SINGLE
, 
IWL_ANT_OK_MULTI
, 
åue
 },

60 {
IWL_ANT_OK_SINGLE
, IWL_ANT_OK_SINGLE, 
Ál£
 },

61 {
IWL_ANT_OK_NONE
, IWL_ANT_OK_NONE, 
Ál£
 }

64 
boﬁ
 
	$iwl_â_is_low_powî_°©e
(
iwl_¥iv
 *
¥iv
)

66 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

68 i‡(
â
->
°©e
 >
IWL_TI_1
)

69  
åue
;

70  
Ál£
;

71 
	}
}

73 
u8
 
	$iwl_â_cuºít_powî_mode
(
iwl_¥iv
 *
¥iv
)

75 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

77  
â
->
â_powî_mode
;

78 
	}
}

80 
boﬁ
 
	$iwl_ht_íabÀd
(
iwl_¥iv
 *
¥iv
)

82 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

83 
iwl_â_ª°ri˘i⁄
 *
ª°ri˘i⁄
;

85 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

86  
åue
;

87 
ª°ri˘i⁄
 = 
â
->ª°ri˘i⁄ +Åt->
°©e
;

88  
ª°ri˘i⁄
->
is_ht
;

89 
	}
}

91 
boﬁ
 
	$iwl_wôhö_˘_kûl_m¨gö
(
iwl_¥iv
 *
¥iv
)

93 
s32
 
ãmp
 = 
¥iv
->
ãm≥øtuª
;

94 
boﬁ
 
wôhö_m¨gö
 = 
Ál£
;

96 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

97 
wôhö_m¨gö
 = ((
ãmp
 + 
IWL_TT_CT_KILL_MARGIN
) >=

98 
CT_KILL_THRESHOLD_LEGACY
Ë? 
åue
 : 
Ál£
;

100 
wôhö_m¨gö
 = ((
ãmp
 + 
IWL_TT_CT_KILL_MARGIN
) >=

101 
CT_KILL_THRESHOLD
Ë? 
åue
 : 
Ál£
;

102  
wôhö_m¨gö
;

103 
	}
}

105 
boﬁ
 
	$iwl_check_f‹_˘_kûl
(
iwl_¥iv
 *
¥iv
)

107 
boﬁ
 
is_˘_kûl
 = 
Ál£
;

109 i‡(
	`iwl_wôhö_˘_kûl_m¨gö
(
¥iv
)) {

110 
	`iwl_â_íãr_˘_kûl
(
¥iv
);

111 
is_˘_kûl
 = 
åue
;

113  
is_˘_kûl
;

114 
	}
}

116 
iwl_™ã¬a_ok
 
	$iwl_tx_™t_ª°ri˘i⁄
(
iwl_¥iv
 *
¥iv
)

118 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

119 
iwl_â_ª°ri˘i⁄
 *
ª°ri˘i⁄
;

121 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

122  
IWL_ANT_OK_MULTI
;

123 
ª°ri˘i⁄
 = 
â
->ª°ri˘i⁄ +Åt->
°©e
;

124  
ª°ri˘i⁄
->
tx_°ªam
;

125 
	}
}

127 
iwl_™ã¬a_ok
 
	$iwl_rx_™t_ª°ri˘i⁄
(
iwl_¥iv
 *
¥iv
)

129 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

130 
iwl_â_ª°ri˘i⁄
 *
ª°ri˘i⁄
;

132 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

133  
IWL_ANT_OK_MULTI
;

134 
ª°ri˘i⁄
 = 
â
->ª°ri˘i⁄ +Åt->
°©e
;

135  
ª°ri˘i⁄
->
rx_°ªam
;

136 
	}
}

138 
	#CT_KILL_EXIT_DURATION
 (5Ë

	)

139 
	#CT_KILL_WAITING_DURATION
 (300Ë

	)

149 
	$iwl_â_check_exô_˘_kûl
(
timî_li°
 *
t
)

151 
iwl_¥iv
 *
¥iv
 = 
	`‰om_timî
’riv, 
t
,

152 
thîmÆ_thrŸée
.
˘_kûl_exô_tm
);

153 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

155 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

158 i‡(
â
->
°©e
 =
IWL_TI_CT_KILL
) {

159 i‡(
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_toggÀ
) {

160 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_CLR
,

161 
CSR_UCODE_DRV_GP1_REG_BIT_CT_KILL_EXIT
);

162 
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_toggÀ
 = 
Ál£
;

164 
	`iwl_wrôe32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1_SET
,

165 
CSR_UCODE_DRV_GP1_REG_BIT_CT_KILL_EXIT
);

166 
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_toggÀ
 = 
åue
;

168 
	`iwl_ªad32
(
¥iv
->
å™s
, 
CSR_UCODE_DRV_GP1
);

169 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
¥iv
->
å™s
))

170 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
¥iv
->
å™s
);

175 
	`IWL_DEBUG_TEMP
(
¥iv
, "schedule ct_killÉxitÅimer\n");

176 
	`mod_timî
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_exô_tm
,

177 
jiffõs
 + 
CT_KILL_EXIT_DURATION
 * 
HZ
);

179 
	}
}

181 
	$iwl_≥rf‹m_˘_kûl_èsk
(
iwl_¥iv
 *
¥iv
,

182 
boﬁ
 
°›
)

184 i‡(
°›
) {

185 
	`IWL_DEBUG_TEMP
(
¥iv
, "Stopáll queues\n");

186 i‡(
¥iv
->
mac80211_ªgi°îed
)

187 
	`õì80211_°›_queues
(
¥iv
->
hw
);

188 
	`IWL_DEBUG_TEMP
(
¥iv
,

190 
	`mod_timî
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_exô_tm
,

191 
jiffõs
 + 
CT_KILL_EXIT_DURATION
 * 
HZ
);

193 
	`IWL_DEBUG_TEMP
(
¥iv
, "Wakeáll queues\n");

194 i‡(
¥iv
->
mac80211_ªgi°îed
)

195 
	`õì80211_wake_queues
(
¥iv
->
hw
);

197 
	}
}

199 
	$iwl_â_ªady_f‹_˘_kûl
(
timî_li°
 *
t
)

201 
iwl_¥iv
 *
¥iv
 = 
	`‰om_timî
’riv, 
t
,

202 
thîmÆ_thrŸée
.
˘_kûl_waôög_tm
);

203 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

205 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

209 i‡(
â
->
°©e
 !
IWL_TI_CT_KILL
) {

210 
	`IWL_DEBUG_TEMP
(
¥iv
, "entering CT_KILL state when "

212 
â
->
°©e
 = 
IWL_TI_CT_KILL
;

213 
	`£t_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

214 
	`iwl_≥rf‹m_˘_kûl_èsk
(
¥iv
, 
åue
);

216 
	}
}

218 
	$iwl_¥ï¨e_˘_kûl_èsk
(
iwl_¥iv
 *
¥iv
)

220 
	`IWL_DEBUG_TEMP
(
¥iv
, "PrepareÅoÉnter IWL_TI_CT_KILL\n");

222 
	`iwl_£nd_°©i°ics_ªque°
(
¥iv
, 0, 
Ál£
);

224 
	`mod_timî
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_waôög_tm
,

225 
jiffõs
 + 
	`m£cs_to_jiffõs
(
CT_KILL_WAITING_DURATION
));

226 
	}
}

228 
	#IWL_MINIMAL_POWER_THRESHOLD
 (
CT_KILL_THRESHOLD_LEGACY
)

	)

229 
	#IWL_REDUCED_PERFORMANCE_THRESHOLD_2
 (100)

	)

230 
	#IWL_REDUCED_PERFORMANCE_THRESHOLD_1
 (90)

	)

241 
	$iwl_Àgacy_â_h™dÀr
(
iwl_¥iv
 *
¥iv
, 
s32
 
ãmp
, 
boﬁ
 
f‹˚
)

243 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

244 
iwl_â_°©e
 
ﬁd_°©e
;

246 #ifde‡
CONFIG_IWLWIFI_DEBUG


247 i‡((
â
->
â_¥evious_ãmp
) &&

248 (
ãmp
 > 
â
->
â_¥evious_ãmp
) &&

249 ((
ãmp
 - 
â
->
â_¥evious_ãmp
) >

250 
IWL_TT_INCREASE_MARGIN
)) {

251 
	`IWL_DEBUG_TEMP
(
¥iv
,

253 (
ãmp
 - 
â
->
â_¥evious_ãmp
));

256 
ﬁd_°©e
 = 
â
->
°©e
;

258 i‡(
ãmp
 >
IWL_MINIMAL_POWER_THRESHOLD
)

259 
â
->
°©e
 = 
IWL_TI_CT_KILL
;

260 i‡(
ãmp
 >
IWL_REDUCED_PERFORMANCE_THRESHOLD_2
)

261 
â
->
°©e
 = 
IWL_TI_2
;

262 i‡(
ãmp
 >
IWL_REDUCED_PERFORMANCE_THRESHOLD_1
)

263 
â
->
°©e
 = 
IWL_TI_1
;

265 
â
->
°©e
 = 
IWL_TI_0
;

267 #ifde‡
CONFIG_IWLWIFI_DEBUG


268 
â
->
â_¥evious_ãmp
 = 
ãmp
;

271 
	`dñ_timî_sync
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_waôög_tm
);

272 i‡(
â
->
°©e
 !
ﬁd_°©e
) {

273 
â
->
°©e
) {

274 
IWL_TI_0
:

281 
IWL_TI_1
:

282 
â
->
â_powî_mode
 = 
IWL_POWER_INDEX_3
;

284 
IWL_TI_2
:

285 
â
->
â_powî_mode
 = 
IWL_POWER_INDEX_4
;

288 
â
->
â_powî_mode
 = 
IWL_POWER_INDEX_5
;

291 
	`muãx_lock
(&
¥iv
->
muãx
);

292 i‡(
ﬁd_°©e
 =
IWL_TI_CT_KILL
)

293 
	`˛ór_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

294 i‡(
â
->
°©e
 !
IWL_TI_CT_KILL
 &&

295 
	`iwl_powî_upd©e_mode
(
¥iv
, 
åue
)) {

299 i‡(
ﬁd_°©e
 =
IWL_TI_CT_KILL
)

300 
	`£t_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

301 
â
->
°©e
 = 
ﬁd_°©e
;

302 
	`IWL_ERR
(
¥iv
, "Cannot updateÖower mode, "

305 i‡(
â
->
°©e
 =
IWL_TI_CT_KILL
) {

306 i‡(
f‹˚
) {

307 
	`£t_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

308 
	`iwl_≥rf‹m_˘_kûl_èsk
(
¥iv
, 
åue
);

310 
	`iwl_¥ï¨e_˘_kûl_èsk
(
¥iv
);

311 
â
->
°©e
 = 
ﬁd_°©e
;

313 } i‡(
ﬁd_°©e
 =
IWL_TI_CT_KILL
) {

314 
	`iwl_≥rf‹m_˘_kûl_èsk
(
¥iv
, 
Ál£
);

316 
	`IWL_DEBUG_TEMP
(
¥iv
, "Temperature state changed %u\n",

317 
â
->
°©e
);

318 
	`IWL_DEBUG_TEMP
(
¥iv
, "Power Index changeÅo %u\n",

319 
â
->
â_powî_mode
);

321 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

323 
	}
}

346 
	$iwl_adv™˚_â_h™dÀr
(
iwl_¥iv
 *
¥iv
, 
s32
 
ãmp
, 
boﬁ
 
f‹˚
)

348 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

349 
i
;

350 
boﬁ
 
ch™ged
 = 
Ál£
;

351 
iwl_â_°©e
 
ﬁd_°©e
;

352 
iwl_â_å™s
 *
å™ß˘i⁄
;

354 
ﬁd_°©e
 = 
â
->
°©e
;

355 
i
 = 0; i < 
IWL_TI_STATE_MAX
 - 1; i++) {

366 
å™ß˘i⁄
 = 
â
->transaction +

367 ((
ﬁd_°©e
 * (
IWL_TI_STATE_MAX
 - 1)Ë+ 
i
);

368 i‡(
ãmp
 >
å™ß˘i⁄
->
â_low
 &&

369 
ãmp
 <
å™ß˘i⁄
->
â_high
) {

370 #ifde‡
CONFIG_IWLWIFI_DEBUG


371 i‡((
â
->
â_¥evious_ãmp
) &&

372 (
ãmp
 > 
â
->
â_¥evious_ãmp
) &&

373 ((
ãmp
 - 
â
->
â_¥evious_ãmp
) >

374 
IWL_TT_INCREASE_MARGIN
)) {

375 
	`IWL_DEBUG_TEMP
(
¥iv
,

378 (
ãmp
 - 
â
->
â_¥evious_ãmp
));

380 
â
->
â_¥evious_ãmp
 = 
ãmp
;

382 i‡(
ﬁd_°©e
 !=

383 
å™ß˘i⁄
->
√xt_°©e
) {

384 
ch™ged
 = 
åue
;

385 
â
->
°©e
 =

386 
å™ß˘i⁄
->
√xt_°©e
;

392 
	`dñ_timî_sync
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_waôög_tm
);

393 i‡(
ch™ged
) {

394 i‡(
â
->
°©e
 >
IWL_TI_1
) {

396 
â
->
â_powî_mode
 = 
IWL_POWER_INDEX_5
;

398 i‡(!
	`iwl_ht_íabÀd
(
¥iv
)) {

399 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

401 
	`f‹_óch_c⁄ãxt
(
¥iv
, 
˘x
) {

402 
iwl_rx⁄_cmd
 *
rx⁄
;

404 
rx⁄
 = &
˘x
->
°agög
;

407 
rx⁄
->
Êags
 &= ~(

408 
RXON_FLG_CHANNEL_MODE_MSK
 |

409 
RXON_FLG_CTRL_CHANNEL_LOC_HI_MSK
 |

410 
RXON_FLG_HT40_PROT_MSK
 |

411 
RXON_FLG_HT_PROT_MSK
);

417 
	`iwl_£t_rx⁄_ht
(
¥iv
, &¥iv->
cuºít_ht_c⁄fig
);

429 
	`iwl_£t_rx⁄_ht
(
¥iv
, &¥iv->
cuºít_ht_c⁄fig
);

431 
	`muãx_lock
(&
¥iv
->
muãx
);

432 i‡(
ﬁd_°©e
 =
IWL_TI_CT_KILL
)

433 
	`˛ór_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

434 i‡(
â
->
°©e
 !
IWL_TI_CT_KILL
 &&

435 
	`iwl_powî_upd©e_mode
(
¥iv
, 
åue
)) {

439 
	`IWL_ERR
(
¥iv
, "Cannot updateÖower mode, "

441 i‡(
ﬁd_°©e
 =
IWL_TI_CT_KILL
)

442 
	`£t_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

443 
â
->
°©e
 = 
ﬁd_°©e
;

445 
	`IWL_DEBUG_TEMP
(
¥iv
,

447 
â
->
°©e
);

448 i‡(
ﬁd_°©e
 !
IWL_TI_CT_KILL
 &&

449 
â
->
°©e
 =
IWL_TI_CT_KILL
) {

450 i‡(
f‹˚
) {

451 
	`IWL_DEBUG_TEMP
(
¥iv
,

453 
	`£t_bô
(
STATUS_CT_KILL
, &
¥iv
->
°©us
);

454 
	`iwl_≥rf‹m_˘_kûl_èsk
(
¥iv
, 
åue
);

456 
â
->
°©e
 = 
ﬁd_°©e
;

457 
	`iwl_¥ï¨e_˘_kûl_èsk
(
¥iv
);

459 } i‡(
ﬁd_°©e
 =
IWL_TI_CT_KILL
 &&

460 
â
->
°©e
 !
IWL_TI_CT_KILL
) {

461 
	`IWL_DEBUG_TEMP
(
¥iv
, "Exit IWL_TI_CT_KILL\n");

462 
	`iwl_≥rf‹m_˘_kûl_èsk
(
¥iv
, 
Ál£
);

465 
	`muãx_u∆ock
(&
¥iv
->
muãx
);

467 
	}
}

479 
	$iwl_bg_˘_íãr
(
w‹k_°ru˘
 *
w‹k
)

481 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, iwl_¥iv, 
˘_íãr
);

482 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

484 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

487 i‡(!
	`iwl_is_ªady
(
¥iv
))

490 i‡(
â
->
°©e
 !
IWL_TI_CT_KILL
) {

491 
	`IWL_ERR
(
¥iv
, "DeviceÑeached criticalÅemperature "

493 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

494 
	`iwl_Àgacy_â_h™dÀr
(
¥iv
,

495 
IWL_MINIMAL_POWER_THRESHOLD
,

496 
åue
);

498 
	`iwl_adv™˚_â_h™dÀr
(
¥iv
,

499 
CT_KILL_THRESHOLD
 + 1, 
åue
);

501 
	}
}

508 
	$iwl_bg_˘_exô
(
w‹k_°ru˘
 *
w‹k
)

510 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, iwl_¥iv, 
˘_exô
);

511 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

513 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

516 i‡(!
	`iwl_is_ªady
(
¥iv
))

520 
	`dñ_timî_sync
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_exô_tm
);

522 i‡(
â
->
°©e
 =
IWL_TI_CT_KILL
) {

523 
	`IWL_ERR
(
¥iv
,

530 
¥iv
->
ãm≥øtuª
 = 0;

531 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

532 
	`iwl_Àgacy_â_h™dÀr
(
¥iv
,

533 
IWL_REDUCED_PERFORMANCE_THRESHOLD_2
,

534 
åue
);

536 
	`iwl_adv™˚_â_h™dÀr
(
¥iv
, 
CT_KILL_EXIT_THRESHOLD
,

537 
åue
);

539 
	}
}

541 
	$iwl_â_íãr_˘_kûl
(
iwl_¥iv
 *
¥iv
)

543 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

546 
	`IWL_DEBUG_TEMP
(
¥iv
, "Queueing criticalÅemperatureÉnter.\n");

547 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
˘_íãr
);

548 
	}
}

550 
	$iwl_â_exô_˘_kûl
(
iwl_¥iv
 *
¥iv
)

552 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

555 
	`IWL_DEBUG_TEMP
(
¥iv
, "Queueing criticalÅemperatureÉxit.\n");

556 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
˘_exô
);

557 
	}
}

559 
	$iwl_bg_â_w‹k
(
w‹k_°ru˘
 *
w‹k
)

561 
iwl_¥iv
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, iwl_¥iv, 
â_w‹k
);

562 
s32
 
ãmp
 = 
¥iv
->
ãm≥øtuª
;

564 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

567 i‡(!
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
)

568 
	`iwl_Àgacy_â_h™dÀr
(
¥iv
, 
ãmp
, 
Ál£
);

570 
	`iwl_adv™˚_â_h™dÀr
(
¥iv
, 
ãmp
, 
Ál£
);

571 
	}
}

573 
	$iwl_â_h™dÀr
(
iwl_¥iv
 *
¥iv
)

575 i‡(
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

578 
	`IWL_DEBUG_TEMP
(
¥iv
, "QueueingÅhermalÅhrottling work.\n");

579 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
â_w‹k
);

580 
	}
}

587 
	$iwl_â_öôülize
(
iwl_¥iv
 *
¥iv
)

589 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

590 
size
 = (
iwl_â_å™s
Ë* (
IWL_TI_STATE_MAX
 - 1);

591 
iwl_â_å™s
 *
å™ß˘i⁄
;

593 
	`IWL_DEBUG_TEMP
(
¥iv
, "Initialize Thermal Throttling\n");

595 
	`mem£t
(
â
, 0, (
iwl_â_mgmt
));

597 
â
->
°©e
 = 
IWL_TI_0
;

598 
	`timî_£tup
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_exô_tm
,

599 
iwl_â_check_exô_˘_kûl
, 0);

600 
	`timî_£tup
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_waôög_tm
,

601 
iwl_â_ªady_f‹_˘_kûl
, 0);

603 
	`INIT_WORK
(&
¥iv
->
â_w‹k
, 
iwl_bg_â_w‹k
);

604 
	`INIT_WORK
(&
¥iv
->
˘_íãr
, 
iwl_bg_˘_íãr
);

605 
	`INIT_WORK
(&
¥iv
->
˘_exô
, 
iwl_bg_˘_exô
);

607 i‡(
¥iv
->
lib
->
adv_thîmÆ_thrŸée
) {

608 
	`IWL_DEBUG_TEMP
(
¥iv
, "Advanced Thermal Throttling\n");

609 
â
->
ª°ri˘i⁄
 = 
	`kˇŒoc
(
IWL_TI_STATE_MAX
,

610 (
iwl_â_ª°ri˘i⁄
),

611 
GFP_KERNEL
);

612 
â
->
å™ß˘i⁄
 = 
	`kˇŒoc
(
IWL_TI_STATE_MAX
 *

613 (
IWL_TI_STATE_MAX
 - 1),

614 (
iwl_â_å™s
),

615 
GFP_KERNEL
);

616 i‡(!
â
->
ª°ri˘i⁄
 || !â->
å™ß˘i⁄
) {

617 
	`IWL_ERR
(
¥iv
, "FallbackÅo Legacy Throttling\n");

618 
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
 = 
Ál£
;

619 
	`k‰ì
(
â
->
ª°ri˘i⁄
);

620 
â
->
ª°ri˘i⁄
 = 
NULL
;

621 
	`k‰ì
(
â
->
å™ß˘i⁄
);

622 
â
->
å™ß˘i⁄
 = 
NULL
;

624 
å™ß˘i⁄
 = 
â
->transaction +

625 (
IWL_TI_0
 * (
IWL_TI_STATE_MAX
 - 1));

626 
	`mem˝y
(
å™ß˘i⁄
, &
â_ønge_0
[0], 
size
);

627 
å™ß˘i⁄
 = 
â
->transaction +

628 (
IWL_TI_1
 * (
IWL_TI_STATE_MAX
 - 1));

629 
	`mem˝y
(
å™ß˘i⁄
, &
â_ønge_1
[0], 
size
);

630 
å™ß˘i⁄
 = 
â
->transaction +

631 (
IWL_TI_2
 * (
IWL_TI_STATE_MAX
 - 1));

632 
	`mem˝y
(
å™ß˘i⁄
, &
â_ønge_2
[0], 
size
);

633 
å™ß˘i⁄
 = 
â
->transaction +

634 (
IWL_TI_CT_KILL
 * (
IWL_TI_STATE_MAX
 - 1));

635 
	`mem˝y
(
å™ß˘i⁄
, &
â_ønge_3
[0], 
size
);

636 
size
 = (
iwl_â_ª°ri˘i⁄
) *

637 
IWL_TI_STATE_MAX
;

638 
	`mem˝y
(
â
->
ª°ri˘i⁄
,

639 &
ª°ri˘i⁄_ønge
[0], 
size
);

640 
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
 = 
åue
;

643 
	`IWL_DEBUG_TEMP
(
¥iv
, "Legacy Thermal Throttling\n");

644 
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
 = 
Ál£
;

646 
	}
}

649 
	$iwl_â_exô
(
iwl_¥iv
 *
¥iv
)

651 
iwl_â_mgmt
 *
â
 = &
¥iv
->
thîmÆ_thrŸée
;

654 
	`dñ_timî_sync
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_exô_tm
);

656 
	`dñ_timî_sync
(&
¥iv
->
thîmÆ_thrŸée
.
˘_kûl_waôög_tm
);

657 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
â_w‹k
);

658 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
˘_íãr
);

659 
	`ˇn˚l_w‹k_sync
(&
¥iv
->
˘_exô
);

661 i‡(
¥iv
->
thîmÆ_thrŸée
.
adv™˚d_â
) {

663 
	`k‰ì
(
â
->
ª°ri˘i⁄
);

664 
â
->
ª°ri˘i⁄
 = 
NULL
;

665 
	`k‰ì
(
â
->
å™ß˘i⁄
);

666 
â
->
å™ß˘i⁄
 = 
NULL
;

668 
	}
}

	@dvm/tt.h

9 #i‚de‡
__iwl_â_£âög_h__


10 
	#__iwl_â_£âög_h__


	)

12 
	~"comm™ds.h
"

14 
	#IWL_ABSOLUTE_ZERO
 0

	)

15 
	#IWL_ABSOLUTE_MAX
 0xFFFFFFFF

	)

16 
	#IWL_TT_INCREASE_MARGIN
 5

	)

17 
	#IWL_TT_CT_KILL_MARGIN
 3

	)

19 
	eiwl_™ã¬a_ok
 {

20 
	mIWL_ANT_OK_NONE
,

21 
	mIWL_ANT_OK_SINGLE
,

22 
	mIWL_ANT_OK_MULTI
,

26 
	eiwl_â_°©e
 {

27 
	mIWL_TI_0
,

28 
	mIWL_TI_1
,

29 
	mIWL_TI_2
,

30 
	mIWL_TI_CT_KILL
,

31 
	mIWL_TI_STATE_MAX


44 
	siwl_â_ª°ri˘i⁄
 {

45 
iwl_™ã¬a_ok
 
	mtx_°ªam
;

46 
iwl_™ã¬a_ok
 
	mrx_°ªam
;

47 
boﬁ
 
	mis_ht
;

60 
	siwl_â_å™s
 {

61 
iwl_â_°©e
 
	m√xt_°©e
;

62 
u32
 
	mâ_low
;

63 
u32
 
	mâ_high
;

85 
	siwl_â_mgmt
 {

86 
iwl_â_°©e
 
	m°©e
;

87 
boﬁ
 
	madv™˚d_â
;

88 
u8
 
	mâ_powî_mode
;

89 
boﬁ
 
	m˘_kûl_toggÀ
;

90 #ifde‡
CONFIG_IWLWIFI_DEBUG


91 
s32
 
	mâ_¥evious_ãmp
;

93 
iwl_â_ª°ri˘i⁄
 *
	mª°ri˘i⁄
;

94 
iwl_â_å™s
 *
	må™ß˘i⁄
;

95 
timî_li°
 
	m˘_kûl_exô_tm
;

96 
timî_li°
 
	m˘_kûl_waôög_tm
;

99 
u8
 
iwl_â_cuºít_powî_mode
(
iwl_¥iv
 *
¥iv
);

100 
boﬁ
 
iwl_â_is_low_powî_°©e
(
iwl_¥iv
 *
¥iv
);

101 
boﬁ
 
iwl_ht_íabÀd
(
iwl_¥iv
 *
¥iv
);

102 
iwl_™ã¬a_ok
 
iwl_tx_™t_ª°ri˘i⁄
(
iwl_¥iv
 *
¥iv
);

103 
iwl_™ã¬a_ok
 
iwl_rx_™t_ª°ri˘i⁄
(
iwl_¥iv
 *
¥iv
);

104 
iwl_â_íãr_˘_kûl
(
iwl_¥iv
 *
¥iv
);

105 
iwl_â_exô_˘_kûl
(
iwl_¥iv
 *
¥iv
);

106 
iwl_â_h™dÀr
(
iwl_¥iv
 *
¥iv
);

107 
iwl_â_öôülize
(
iwl_¥iv
 *
¥iv
);

108 
iwl_â_exô
(
iwl_¥iv
 *
¥iv
);

	@dvm/tx.c

9 
	~<löux/kî√l.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/sched.h
>

12 
	~<löux/õì80211.h
>

13 
	~"iwl-io.h
"

14 
	~"iwl-å™s.h
"

15 
	~"iwl-agn-hw.h
"

16 
	~"dev.h
"

17 
	~"agn.h
"

19 c⁄° 
u8
 
	gtid_to_ac
[] = {

20 
IEEE80211_AC_BE
,

21 
IEEE80211_AC_BK
,

22 
IEEE80211_AC_BK
,

23 
IEEE80211_AC_BE
,

24 
IEEE80211_AC_VI
,

25 
IEEE80211_AC_VI
,

26 
IEEE80211_AC_VO
,

27 
IEEE80211_AC_VO
,

30 
	$iwœgn_tx_cmd_¥Ÿe˘i⁄
(
iwl_¥iv
 *
¥iv
,

31 
õì80211_tx_öfo
 *
öfo
,

32 
__À16
 
fc
, 
__À32
 *
tx_Êags
)

34 i‡(
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 & 
IEEE80211_TX_RC_USE_RTS_CTS
 ||

35 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 & 
IEEE80211_TX_RC_USE_CTS_PROTECT
 ||

36 
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)

37 *
tx_Êags
 |
TX_CMD_FLG_PROT_REQUIRE_MSK
;

38 
	}
}

43 
	$iwœgn_tx_cmd_buûd_basic
(
iwl_¥iv
 *
¥iv
,

44 
sk_buff
 *
skb
,

45 
iwl_tx_cmd
 *
tx_cmd
,

46 
õì80211_tx_öfo
 *
öfo
,

47 
õì80211_hdr
 *
hdr
, 
u8
 
°a_id
)

49 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

50 
__À32
 
tx_Êags
 = 
tx_cmd
->tx_flags;

52 
tx_cmd
->
°›_time
.
li„_time
 = 
TX_CMD_LIFE_TIME_INFINITE
;

54 i‡(!(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
))

55 
tx_Êags
 |
TX_CMD_FLG_ACK_MSK
;

57 
tx_Êags
 &~
TX_CMD_FLG_ACK_MSK
;

59 i‡(
	`õì80211_is_¥obe_ª•
(
fc
))

60 
tx_Êags
 |
TX_CMD_FLG_TSF_MSK
;

61 i‡(
	`õì80211_is_back_ªq
(
fc
))

62 
tx_Êags
 |
TX_CMD_FLG_ACK_MSK
 | 
TX_CMD_FLG_IMM_BA_RSP_MASK
;

63 i‡(
öfo
->
b™d
 =
NL80211_BAND_2GHZ
 &&

64 
¥iv
->
lib
->
bt_∑øms
 &&

65 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
 &&

66 (
	`õì80211_is_auth
(
fc
Ë|| 
	`õì80211_is_assoc_ªq
(fc) ||

67 
	`õì80211_is_ªassoc_ªq
(
fc
) ||

68 
öfo
->
c⁄åﬁ
.
Êags
 & 
IEEE80211_TX_CTRL_PORT_CTRL_PROTO
))

69 
tx_Êags
 |
TX_CMD_FLG_IGNORE_BT
;

72 
tx_cmd
->
°a_id
 = sta_id;

73 i‡(
	`õì80211_has_m‹e‰ags
(
fc
))

74 
tx_Êags
 |
TX_CMD_FLG_MORE_FRAG_MSK
;

76 i‡(
	`õì80211_is_d©a_qos
(
fc
)) {

77 
u8
 *
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

78 
tx_cmd
->
tid_t•ec
 = 
qc
[0] & 0xf;

79 
tx_Êags
 &~
TX_CMD_FLG_SEQ_CTL_MSK
;

81 
tx_cmd
->
tid_t•ec
 = 
IWL_TID_NON_QOS
;

82 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_ASSIGN_SEQ
)

83 
tx_Êags
 |
TX_CMD_FLG_SEQ_CTL_MSK
;

85 
tx_Êags
 &~
TX_CMD_FLG_SEQ_CTL_MSK
;

88 
	`iwœgn_tx_cmd_¥Ÿe˘i⁄
(
¥iv
, 
öfo
, 
fc
, &
tx_Êags
);

90 
tx_Êags
 &~(
TX_CMD_FLG_ANT_SEL_MSK
);

91 i‡(
	`õì80211_is_mgmt
(
fc
)) {

92 i‡(
	`õì80211_is_assoc_ªq
(
fc
Ë|| 
	`õì80211_is_ªassoc_ªq
(fc))

93 
tx_cmd
->
timeout
.
pm_‰ame_timeout
 = 
	`˝u_to_À16
(3);

95 
tx_cmd
->
timeout
.
pm_‰ame_timeout
 = 
	`˝u_to_À16
(2);

97 
tx_cmd
->
timeout
.
pm_‰ame_timeout
 = 0;

100 
tx_cmd
->
drivî_tx›
 = 0;

101 
tx_cmd
->
tx_Êags
 =Åx_flags;

102 
tx_cmd
->
√xt_‰ame_Àn
 = 0;

103 
	}
}

105 
	$iwœgn_tx_cmd_buûd_øã
(
iwl_¥iv
 *
¥iv
,

106 
iwl_tx_cmd
 *
tx_cmd
,

107 
õì80211_tx_öfo
 *
öfo
,

108 
õì80211_°a
 *
°a
,

109 
__À16
 
fc
)

111 
u32
 
øã_Êags
;

112 
øã_idx
;

113 
u8
 
πs_ªåy_limô
;

114 
u8
 
d©a_ªåy_limô
;

115 
u8
 
øã_∂˝
;

117 i‡(
¥iv
->
wowœn
) {

118 
πs_ªåy_limô
 = 
IWLAGN_LOW_RETRY_LIMIT
;

119 
d©a_ªåy_limô
 = 
IWLAGN_LOW_RETRY_LIMIT
;

122 
πs_ªåy_limô
 = 
IWLAGN_RTS_DFAULT_RETRY_LIMIT
;

125 i‡(
	`õì80211_is_¥obe_ª•
(
fc
)) {

126 
d©a_ªåy_limô
 = 
IWLAGN_MGMT_DFAULT_RETRY_LIMIT
;

127 
πs_ªåy_limô
 =

128 
	`mö
(
d©a_ªåy_limô
, 
πs_ªåy_limô
);

129 } i‡(
	`õì80211_is_back_ªq
(
fc
))

130 
d©a_ªåy_limô
 = 
IWLAGN_BAR_DFAULT_RETRY_LIMIT
;

132 
d©a_ªåy_limô
 = 
IWLAGN_DEFAULT_TX_RETRY
;

135 
tx_cmd
->
d©a_ªåy_limô
 = data_retry_limit;

136 
tx_cmd
->
πs_ªåy_limô
 =Ñts_retry_limit;

140 i‡(
	`õì80211_is_d©a
(
fc
)) {

141 
tx_cmd
->
öôül_øã_ödex
 = 0;

142 
tx_cmd
->
tx_Êags
 |
TX_CMD_FLG_STA_RATE_MSK
;

144 } i‡(
	`õì80211_is_back_ªq
(
fc
))

145 
tx_cmd
->
tx_Êags
 |
TX_CMD_FLG_STA_RATE_MSK
;

153 
øã_idx
 = 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
;

154 i‡(
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 & 
IEEE80211_TX_RC_MCS
 ||

155 (
øã_idx
 < 0Ë|| (øã_idx > 
IWL_RATE_COUNT_LEGACY
))

156 
øã_idx
 = 
	`øã_lowe°_ödex
(

157 &
¥iv
->
nvm_d©a
->
b™ds
[
öfo
->
b™d
], 
°a
);

159 i‡(
öfo
->
b™d
 =
NL80211_BAND_5GHZ
)

160 
øã_idx
 +
IWL_FIRST_OFDM_RATE
;

162 
øã_∂˝
 = 
iwl_øãs
[
øã_idx
].
∂˝
;

164 
øã_Êags
 = 0;

167 i‡((
øã_idx
 >
IWL_FIRST_CCK_RATE
Ë&& (øã_idx <
IWL_LAST_CCK_RATE
))

168 
øã_Êags
 |
RATE_MCS_CCK_MSK
;

171 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

172 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
 &&

173 
¥iv
->
bt_fuŒ_c⁄cuºít
) {

175 
¥iv
->
mgmt_tx_™t
 = 
	`iwl_toggÀ_tx_™t
(priv,Öriv->mgmt_tx_ant,

176 
	`fú°_™ã¬a
(
¥iv
->
nvm_d©a
->
vÆid_tx_™t
));

178 
¥iv
->
mgmt_tx_™t
 = 
	`iwl_toggÀ_tx_™t
(

179 
¥iv
,Öriv->
mgmt_tx_™t
,

180 
¥iv
->
nvm_d©a
->
vÆid_tx_™t
);

181 
øã_Êags
 |
	`iwl_™t_idx_to_Êags
(
¥iv
->
mgmt_tx_™t
);

184 
tx_cmd
->
øã_n_Êags
 = 
	`iwl_hw_£t_øã_n_Êags
(
øã_∂˝
, 
øã_Êags
);

185 
	}
}

187 
	$iwœgn_tx_cmd_buûd_hw¸y±o
(
iwl_¥iv
 *
¥iv
,

188 
õì80211_tx_öfo
 *
öfo
,

189 
iwl_tx_cmd
 *
tx_cmd
,

190 
sk_buff
 *
skb_‰ag
)

192 
õì80211_key_c⁄f
 *
keyc⁄f
 = 
öfo
->
c⁄åﬁ
.
hw_key
;

194 
keyc⁄f
->
cùhî
) {

195 
WLAN_CIPHER_SUITE_CCMP
:

196 
tx_cmd
->
£c_˘l
 = 
TX_CMD_SEC_CCM
;

197 
	`mem˝y
(
tx_cmd
->
key
, 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

198 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)

199 
tx_cmd
->
tx_Êags
 |
TX_CMD_FLG_AGG_CCMP_MSK
;

202 
WLAN_CIPHER_SUITE_TKIP
:

203 
tx_cmd
->
£c_˘l
 = 
TX_CMD_SEC_TKIP
;

204 
	`õì80211_gë_tkù_p2k
(
keyc⁄f
, 
skb_‰ag
, 
tx_cmd
->
key
);

207 
WLAN_CIPHER_SUITE_WEP104
:

208 
tx_cmd
->
£c_˘l
 |
TX_CMD_SEC_KEY128
;

209 
ÁŒthrough
;

210 
WLAN_CIPHER_SUITE_WEP40
:

211 
tx_cmd
->
£c_˘l
 |(
TX_CMD_SEC_WEP
 |

212 (
keyc⁄f
->
keyidx
 & 
TX_CMD_SEC_MSK
Ë<< 
TX_CMD_SEC_SHIFT
);

214 
	`mem˝y
(&
tx_cmd
->
key
[3], 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

216 
	`IWL_DEBUG_TX
(
¥iv
, "ConfiguringÖacket for WEPÉncryption "

217 "wôh key %d\n", 
keyc⁄f
->
keyidx
);

221 
	`IWL_ERR
(
¥iv
, "Unknow¿ícodêcùhî %x\n", 
keyc⁄f
->
cùhî
);

224 
	}
}

236 
	$iwl_°a_id_‹_brﬂdˇ°
(
iwl_rx⁄_c⁄ãxt
 *
c⁄ãxt
,

237 
õì80211_°a
 *
°a
)

239 
°a_id
;

241 i‡(!
°a
)

242  
c⁄ãxt
->
bˇ°_°a_id
;

244 
°a_id
 = 
	`iwl_°a_id
(
°a
);

250 
	`WARN_ON
(
°a_id
 =
IWL_INVALID_STATION
);

252  
°a_id
;

253 
	}
}

258 
	$iwœgn_tx_skb
(
iwl_¥iv
 *
¥iv
,

259 
õì80211_°a
 *
°a
,

260 
sk_buff
 *
skb
)

262 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

263 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

264 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = 
NULL
;

265 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = &
¥iv
->
c⁄ãxts
[
IWL_RXON_CTX_BSS
];

266 
iwl_devi˚_tx_cmd
 *
dev_cmd
;

267 
iwl_tx_cmd
 *
tx_cmd
;

268 
__À16
 
fc
;

269 
u8
 
hdr_Àn
;

270 
u16
 
Àn
, 
£q_numbî
 = 0;

271 
u8
 
°a_id
, 
tid
 = 
IWL_MAX_TID_COUNT
;

272 
boﬁ
 
is_agg
 = 
Ál£
, 
is_d©a_qos
 = false;

273 
txq_id
;

275 i‡(
öfo
->
c⁄åﬁ
.
vif
)

276 
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
öfo
->
c⁄åﬁ
.
vif
);

278 i‡(
	`iwl_is_rfkûl
(
¥iv
)) {

279 
	`IWL_DEBUG_DROP
(
¥iv
, "Dropping - RF KILL\n");

280 
dr›_u∆ock_¥iv
;

283 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

285 #ifde‡
CONFIG_IWLWIFI_DEBUG


286 i‡(
	`õì80211_is_auth
(
fc
))

287 
	`IWL_DEBUG_TX
(
¥iv
, "Sending AUTH frame\n");

288 i‡(
	`õì80211_is_assoc_ªq
(
fc
))

289 
	`IWL_DEBUG_TX
(
¥iv
, "Sending ASSOC frame\n");

290 i‡(
	`õì80211_is_ªassoc_ªq
(
fc
))

291 
	`IWL_DEBUG_TX
(
¥iv
, "Sending REASSOC frame\n");

294 i‡(
	`u∆ikñy
(
	`õì80211_is_¥obe_ª•
(
fc
))) {

295 
iwl_wù™_nﬂ_d©a
 *
nﬂ_d©a
 =

296 
	`rcu_dîe„ªn˚
(
¥iv
->
nﬂ_d©a
);

298 i‡(
nﬂ_d©a
 &&

299 
	`pskb_ex∑nd_hód
(
skb
, 0, 
nﬂ_d©a
->
Àngth
,

300 
GFP_ATOMIC
) == 0) {

301 
	`skb_put_d©a
(
skb
, 
nﬂ_d©a
->
d©a
,Çﬂ_d©a->
Àngth
);

302 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

306 
hdr_Àn
 = 
	`õì80211_hdæí
(
fc
);

309 i‡(!
	`õì80211_is_d©a
(
fc
))

310 
°a_id
 = 
˘x
->
bˇ°_°a_id
;

313 
°a_id
 = 
	`iwl_°a_id_‹_brﬂdˇ°
(
˘x
, 
°a
);

314 i‡(
°a_id
 =
IWL_INVALID_STATION
) {

315 
	`IWL_DEBUG_DROP
(
¥iv
, "Dropping - INVALID STATION: %pM\n",

316 
hdr
->
addr1
);

317 
dr›_u∆ock_¥iv
;

321 i‡(
°a
)

322 
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

324 i‡(
°a_¥iv
 && sè_¥iv->
a¶ìp
 &&

325 (
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_PS_BUFFER
)) {

339 
	`iwl_°a_modify_¶ìp_tx_cou¡
(
¥iv
, 
°a_id
, 1);

342 
dev_cmd
 = 
	`iwl_å™s_Æloc_tx_cmd
(
¥iv
->
å™s
);

344 i‡(
	`u∆ikñy
(!
dev_cmd
))

345 
dr›_u∆ock_¥iv
;

347 
dev_cmd
->
hdr
.
cmd
 = 
REPLY_TX
;

348 
tx_cmd
 = (
iwl_tx_cmd
 *Ë
dev_cmd
->
∑ylﬂd
;

351 
Àn
 = (
u16
)
skb
->len;

352 
tx_cmd
->
Àn
 = 
	`˝u_to_À16
(len);

354 i‡(
öfo
->
c⁄åﬁ
.
hw_key
)

355 
	`iwœgn_tx_cmd_buûd_hw¸y±o
(
¥iv
, 
öfo
, 
tx_cmd
, 
skb
);

358 
	`iwœgn_tx_cmd_buûd_basic
(
¥iv
, 
skb
, 
tx_cmd
, 
öfo
, 
hdr
, 
°a_id
);

360 
	`iwœgn_tx_cmd_buûd_øã
(
¥iv
, 
tx_cmd
, 
öfo
, 
°a
, 
fc
);

362 
	`mem£t
(&
öfo
->
°©us
, 0, (info->status));

363 
	`mem£t
(
öfo
->
drivî_d©a
, 0, (info->driver_data));

365 
öfo
->
drivî_d©a
[0] = 
˘x
;

366 
öfo
->
drivî_d©a
[1] = 
dev_cmd
;

369 
	`•ö_lock
(&
¥iv
->
°a_lock
);

371 i‡(
	`õì80211_is_d©a_qos
(
fc
Ë&& !
	`õì80211_is_qos_nuŒfunc
(fc)) {

372 
u8
 *
qc
 = 
NULL
;

373 
iwl_tid_d©a
 *
tid_d©a
;

374 
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

375 
tid
 = 
qc
[0] & 
IEEE80211_QOS_CTL_TID_MASK
;

376 i‡(
	`WARN_ON_ONCE
(
tid
 >
IWL_MAX_TID_COUNT
))

377 
dr›_u∆ock_°a
;

378 
tid_d©a
 = &
¥iv
->tid_d©a[
°a_id
][
tid
];

381 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
 &&

382 
tid_d©a
->
agg
.
°©e
 !
IWL_AGG_ON
) {

383 
	`IWL_ERR
(
¥iv
,

385 
öfo
->
Êags
, 
tid_d©a
->
agg
.
°©e
);

386 
	`IWL_ERR
(
¥iv
, "sta_id = %d,Åid = %d seq_num = %d\n",

387 
°a_id
, 
tid
,

388 
	`IEEE80211_SEQ_TO_SN
(
tid_d©a
->
£q_numbî
));

389 
dr›_u∆ock_°a
;

395 i‡(
	`WARN_ONCE
(
tid_d©a
->
agg
.
°©e
 !
IWL_AGG_ON
 &&

396 
tid_d©a
->
agg
.
°©e
 !
IWL_AGG_OFF
,

397 "Tx whûêagg.°©ê%d\n", 
tid_d©a
->
agg
.
°©e
))

398 
dr›_u∆ock_°a
;

400 
£q_numbî
 = 
tid_d©a
->seq_number;

401 
£q_numbî
 &
IEEE80211_SCTL_SEQ
;

402 
hdr
->
£q_˘æ
 &
	`˝u_to_À16
(
IEEE80211_SCTL_FRAG
);

403 
hdr
->
£q_˘æ
 |
	`˝u_to_À16
(
£q_numbî
);

404 
£q_numbî
 += 0x10;

406 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
)

407 
is_agg
 = 
åue
;

408 
is_d©a_qos
 = 
åue
;

412 
	`mem˝y
(
tx_cmd
->
hdr
, hdr, 
hdr_Àn
);

414 
txq_id
 = 
öfo
->
hw_queue
;

416 i‡(
is_agg
)

417 
txq_id
 = 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
agg
.txq_id;

418 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_SEND_AFTER_DTIM
) {

423 
hdr
->
‰ame_c⁄åﬁ
 |=

424 
	`˝u_to_À16
(
IEEE80211_FCTL_MOREDATA
);

427 
	`WARN_ON_ONCE
(
is_agg
 &&

428 
¥iv
->
queue_to_mac80211
[
txq_id
] !
öfo
->
hw_queue
);

430 
	`IWL_DEBUG_TX
(
¥iv
, "TXÅÿ[%d|%d] Q:%d - seq: 0x%x\n", 
°a_id
, 
tid
,

431 
txq_id
, 
£q_numbî
);

433 i‡(
	`iwl_å™s_tx
(
¥iv
->
å™s
, 
skb
, 
dev_cmd
, 
txq_id
))

434 
dr›_u∆ock_°a
;

436 i‡(
is_d©a_qos
 && !
	`õì80211_has_m‹e‰ags
(
fc
))

437 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
£q_numbî
 = seq_number;

439 
	`•ö_u∆ock
(&
¥iv
->
°a_lock
);

448 i‡(
°a_¥iv
 && sè_¥iv->
˛õ¡
 && !
is_agg
)

449 
	`©omic_öc
(&
°a_¥iv
->
≥ndög_‰ames
);

453 
dr›_u∆ock_°a
:

454 i‡(
dev_cmd
)

455 
	`iwl_å™s_‰ì_tx_cmd
(
¥iv
->
å™s
, 
dev_cmd
);

456 
	`•ö_u∆ock
(&
¥iv
->
°a_lock
);

457 
dr›_u∆ock_¥iv
:

459 
	}
}

461 
	$iwœgn_Æloc_agg_txq
(
iwl_¥iv
 *
¥iv
, 
mq
)

463 
q
;

465 
q
 = 
IWLAGN_FIRST_AMPDU_QUEUE
;

466 
q
 < 
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
; q++) {

467 i‡(!
	`ã°_™d_£t_bô
(
q
, 
¥iv
->
agg_q_Æloc
)) {

468 
¥iv
->
queue_to_mac80211
[
q
] = 
mq
;

469  
q
;

473  -
ENOSPC
;

474 
	}
}

476 
	$iwœgn_dóŒoc_agg_txq
(
iwl_¥iv
 *
¥iv
, 
q
)

478 
	`˛ór_bô
(
q
, 
¥iv
->
agg_q_Æloc
);

479 
¥iv
->
queue_to_mac80211
[
q
] = 
IWL_INVALID_MAC80211_QUEUE
;

480 
	}
}

482 
	$iwœgn_tx_agg_°›
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

483 
õì80211_°a
 *
°a
, 
u16
 
tid
)

485 
iwl_tid_d©a
 *
tid_d©a
;

486 
°a_id
, 
txq_id
;

487 
iwl_agg_°©e
 
agg_°©e
;

489 
°a_id
 = 
	`iwl_°a_id
(
°a
);

491 i‡(
°a_id
 =
IWL_INVALID_STATION
) {

492 
	`IWL_ERR
(
¥iv
, "InvÆid sèti⁄ f‹ AGGÅid %d\n", 
tid
);

493  -
ENXIO
;

496 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

498 
tid_d©a
 = &
¥iv
->tid_d©a[
°a_id
][
tid
];

499 
txq_id
 = 
tid_d©a
->
agg
.txq_id;

501 
tid_d©a
->
agg
.
°©e
) {

502 
IWL_EMPTYING_HW_QUEUE_ADDBA
:

509 
	`IWL_DEBUG_HT
(
¥iv
, "AGG stop before setup done\n");

510 
tu∫_off
;

511 
IWL_AGG_STARTING
:

516 
	`IWL_DEBUG_HT
(
¥iv
, "AGG stop before AGG became operational\n");

517 
tu∫_off
;

518 
IWL_AGG_ON
:

521 
	`IWL_WARN
(
¥iv
,

523 
°a_id
, 
tid
, 
tid_d©a
->
agg
.
°©e
);

524 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

528 
tid_d©a
->
agg
.
s¢
 = 
	`IEEE80211_SEQ_TO_SN
—id_d©a->
£q_numbî
);

531 i‡(!
	`ã°_bô
(
txq_id
, 
¥iv
->
agg_q_Æloc
)) {

532 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

534 
°a_id
, 
tid
, 
txq_id
);

535 } i‡(
tid_d©a
->
agg
.
s¢
 !tid_d©a->
√xt_ª˛aimed
) {

536 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

538 
tid_d©a
->
agg
.
s¢
,

539 
tid_d©a
->
√xt_ª˛aimed
);

540 
tid_d©a
->
agg
.
°©e
 = 
IWL_EMPTYING_HW_QUEUE_DELBA
;

541 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

545 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "CanÖroceed: ssn =Çext_recl = %d\n",

546 
tid_d©a
->
agg
.
s¢
);

547 
tu∫_off
:

548 
agg_°©e
 = 
tid_d©a
->
agg
.
°©e
;

549 
tid_d©a
->
agg
.
°©e
 = 
IWL_AGG_OFF
;

551 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

553 i‡(
	`ã°_bô
(
txq_id
, 
¥iv
->
agg_q_Æloc
)) {

560 i‡(
agg_°©e
 =
IWL_AGG_ON
)

561 
	`iwl_å™s_txq_dißbÀ
(
¥iv
->
å™s
, 
txq_id
, 
åue
);

563 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "Don't disableÅxágg: %d\n",

564 
agg_°©e
);

565 
	`iwœgn_dóŒoc_agg_txq
(
¥iv
, 
txq_id
);

568 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

571 
	}
}

573 
	$iwœgn_tx_agg_°¨t
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

574 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 *
s¢
)

576 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

577 
iwl_tid_d©a
 *
tid_d©a
;

578 
°a_id
, 
txq_id
, 
ªt
;

580 
	`IWL_DEBUG_HT
(
¥iv
, "TX AGGÑequest onÑa = %pMÅid = %d\n",

581 
°a
->
addr
, 
tid
);

583 
°a_id
 = 
	`iwl_°a_id
(
°a
);

584 i‡(
°a_id
 =
IWL_INVALID_STATION
) {

585 
	`IWL_ERR
(
¥iv
, "Start AGG on invalid station\n");

586  -
ENXIO
;

588 i‡(
	`u∆ikñy
(
tid
 >
IWL_MAX_TID_COUNT
))

589  -
EINVAL
;

591 i‡(
¥iv
->
tid_d©a
[
°a_id
][
tid
].
agg
.
°©e
 !
IWL_AGG_OFF
) {

592 
	`IWL_ERR
(
¥iv
, "Start AGG when state isÇot IWL_AGG_OFF !\n");

593  -
ENXIO
;

596 
txq_id
 = 
	`iwœgn_Æloc_agg_txq
(
¥iv
, 
˘x
->
ac_to_queue
[
tid_to_ac
[
tid
]]);

597 i‡(
txq_id
 < 0) {

598 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

600 
°a
->
addr
, 
tid
);

601  
txq_id
;

604 
ªt
 = 
	`iwl_°a_tx_modify_íabÀ_tid
(
¥iv
, 
°a_id
, 
tid
);

605 i‡(
ªt
)

606  
ªt
;

608 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

609 
tid_d©a
 = &
¥iv
->tid_d©a[
°a_id
][
tid
];

610 
tid_d©a
->
agg
.
s¢
 = 
	`IEEE80211_SEQ_TO_SN
—id_d©a->
£q_numbî
);

611 
tid_d©a
->
agg
.
txq_id
 =Åxq_id;

613 *
s¢
 = 
tid_d©a
->
agg
.ssn;

615 i‡(*
s¢
 =
tid_d©a
->
√xt_ª˛aimed
) {

616 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "CanÖroceed: ssn =Çext_recl = %d\n",

617 
tid_d©a
->
agg
.
s¢
);

618 
tid_d©a
->
agg
.
°©e
 = 
IWL_AGG_STARTING
;

619 
ªt
 = 
IEEE80211_AMPDU_TX_START_IMMEDIATE
;

621 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "Can'tÖroceed: ssn %d, "

623 
tid_d©a
->
agg
.
s¢
,

624 
tid_d©a
->
√xt_ª˛aimed
);

625 
tid_d©a
->
agg
.
°©e
 = 
IWL_EMPTYING_HW_QUEUE_ADDBA
;

627 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

629  
ªt
;

630 
	}
}

632 
	$iwœgn_tx_agg_Êush
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

633 
õì80211_°a
 *
°a
, 
u16
 
tid
)

635 
iwl_tid_d©a
 *
tid_d©a
;

636 
iwl_agg_°©e
 
agg_°©e
;

637 
°a_id
, 
txq_id
;

638 
°a_id
 = 
	`iwl_°a_id
(
°a
);

644 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

646 
tid_d©a
 = &
¥iv
->tid_d©a[
°a_id
][
tid
];

647 
txq_id
 = 
tid_d©a
->
agg
.txq_id;

648 
agg_°©e
 = 
tid_d©a
->
agg
.
°©e
;

649 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "Flush AGG: sta %dÅid %d q %d state %d\n",

650 
°a_id
, 
tid
, 
txq_id
, 
tid_d©a
->
agg
.
°©e
);

652 
tid_d©a
->
agg
.
°©e
 = 
IWL_AGG_OFF
;

654 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

656 i‡(
	`iwœgn_txfifo_Êush
(
¥iv
, 
	`BIT
(
txq_id
)))

657 
	`IWL_ERR
(
¥iv
, "Couldn't flushÅhe AGG queue\n");

659 i‡(
	`ã°_bô
(
txq_id
, 
¥iv
->
agg_q_Æloc
)) {

666 i‡(
agg_°©e
 =
IWL_AGG_ON
)

667 
	`iwl_å™s_txq_dißbÀ
(
¥iv
->
å™s
, 
txq_id
, 
åue
);

669 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
, "Don't disableÅxágg: %d\n",

670 
agg_°©e
);

671 
	`iwœgn_dóŒoc_agg_txq
(
¥iv
, 
txq_id
);

675 
	}
}

677 
	$iwœgn_tx_agg_›î
(
iwl_¥iv
 *
¥iv
, 
õì80211_vif
 *
vif
,

678 
õì80211_°a
 *
°a
, 
u16
 
tid
, 
u8
 
buf_size
)

680 
iwl_°©i⁄_¥iv
 *
°a_¥iv
 = (*Ë
°a
->
drv_¥iv
;

681 
iwl_rx⁄_c⁄ãxt
 *
˘x
 = 
	`iwl_rx⁄_˘x_‰om_vif
(
vif
);

682 
q
, 
fifo
;

683 
u16
 
s¢
;

685 
buf_size
 = 
	`mö_t
(, buf_size, 
LINK_QUAL_AGG_FRAME_LIMIT_DEF
);

687 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

688 
s¢
 = 
¥iv
->
tid_d©a
[
°a_¥iv
->
°a_id
][
tid
].
agg
.ssn;

689 
q
 = 
¥iv
->
tid_d©a
[
°a_¥iv
->
°a_id
][
tid
].
agg
.
txq_id
;

690 
¥iv
->
tid_d©a
[
°a_¥iv
->
°a_id
][
tid
].
agg
.
°©e
 = 
IWL_AGG_ON
;

691 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

693 
fifo
 = 
˘x
->
ac_to_fifo
[
tid_to_ac
[
tid
]];

695 
	`iwl_å™s_txq_íabÀ
(
¥iv
->
å™s
, 
q
, 
fifo
, 
°a_¥iv
->
°a_id
, 
tid
,

696 
buf_size
, 
s¢
, 0);

704 i‡(
°a_¥iv
->
max_agg_bufsize
 == 0)

705 
°a_¥iv
->
max_agg_bufsize
 =

706 
LINK_QUAL_AGG_FRAME_LIMIT_DEF
;

715 
°a_¥iv
->
max_agg_bufsize
 =

716 
	`mö
(
°a_¥iv
->
max_agg_bufsize
, 
buf_size
);

718 i‡(
¥iv
->
hw_∑øms
.
u£_πs_f‹_aggªg©i⁄
) {

724 
°a_¥iv
->
lq_°a
.
lq
.
gíîÆ_∑øms
.
Êags
 |=

725 
LINK_QUAL_FLAGS_SET_STA_TLC_RTS_MSK
;

727 
¥iv
->
agg_tids_cou¡
++;

728 
	`IWL_DEBUG_HT
(
¥iv
, "priv->agg_tids_count = %u\n",

729 
¥iv
->
agg_tids_cou¡
);

731 
°a_¥iv
->
lq_°a
.
lq
.
agg_∑øms
.
agg_‰ame_˙t_limô
 =

732 
°a_¥iv
->
max_agg_bufsize
;

734 
	`IWL_DEBUG_HT
(
¥iv
, "TxággregationÉnabled onÑa = %pMÅid = %d\n",

735 
°a
->
addr
, 
tid
);

737  
	`iwl_£nd_lq_cmd
(
¥iv
, 
˘x
,

738 &
°a_¥iv
->
lq_°a
.
lq
, 
CMD_ASYNC
, 
Ál£
);

739 
	}
}

741 
	$iwœgn_check_øtid_em±y
(
iwl_¥iv
 *
¥iv
, 
°a_id
, 
u8
 
tid
)

743 
iwl_tid_d©a
 *
tid_d©a
 = &
¥iv
->tid_d©a[
°a_id
][
tid
];

744 
iwl_rx⁄_c⁄ãxt_id
 
˘x
;

745 
õì80211_vif
 *
vif
;

746 
u8
 *
addr
;

748 
	`lockdï_as£π_hñd
(&
¥iv
->
°a_lock
);

750 
addr
 = 
¥iv
->
°©i⁄s
[
°a_id
].
°a
.sta.addr;

751 
˘x
 = 
¥iv
->
°©i⁄s
[
°a_id
].
˘xid
;

752 
vif
 = 
¥iv
->
c⁄ãxts
[
˘x
].vif;

754 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
agg
.
°©e
) {

755 
IWL_EMPTYING_HW_QUEUE_DELBA
:

757 i‡(
tid_d©a
->
agg
.
s¢
 =tid_d©a->
√xt_ª˛aimed
) {

758 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

760 
tid_d©a
->
√xt_ª˛aimed
);

761 
	`iwl_å™s_txq_dißbÀ
(
¥iv
->
å™s
,

762 
tid_d©a
->
agg
.
txq_id
, 
åue
);

763 
	`iwœgn_dóŒoc_agg_txq
(
¥iv
, 
tid_d©a
->
agg
.
txq_id
);

764 
tid_d©a
->
agg
.
°©e
 = 
IWL_AGG_OFF
;

765 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
addr
, 
tid
);

768 
IWL_EMPTYING_HW_QUEUE_ADDBA
:

770 i‡(
tid_d©a
->
agg
.
s¢
 =tid_d©a->
√xt_ª˛aimed
) {

771 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

773 
tid_d©a
->
√xt_ª˛aimed
);

774 
tid_d©a
->
agg
.
°©e
 = 
IWL_AGG_STARTING
;

775 
	`õì80211_°¨t_tx_ba_cb_úqß„
(
vif
, 
addr
, 
tid
);

781 
	}
}

783 
	$iwœgn_n⁄_agg_tx_°©us
(
iwl_¥iv
 *
¥iv
,

784 
iwl_rx⁄_c⁄ãxt
 *
˘x
,

785 c⁄° 
u8
 *
addr1
)

787 
õì80211_°a
 *
°a
;

788 
iwl_°©i⁄_¥iv
 *
°a_¥iv
;

790 
	`rcu_ªad_lock
();

791 
°a
 = 
	`õì80211_föd_°a
(
˘x
->
vif
, 
addr1
);

792 i‡(
°a
) {

793 
°a_¥iv
 = (*)
°a
->
drv_¥iv
;

795 i‡(
°a_¥iv
->
˛õ¡
 &&

796 
	`©omic_dec_ªtu∫
(&
°a_¥iv
->
≥ndög_‰ames
) == 0)

797 
	`õì80211_°a_block_awake
(
¥iv
->
hw
, 
°a
, 
Ál£
);

799 
	`rcu_ªad_u∆ock
();

800 
	}
}

805 
	$iwœgn_hwøã_to_tx_c⁄åﬁ
(
iwl_¥iv
 *
¥iv
, 
u32
 
øã_n_Êags
,

806 
õì80211_tx_öfo
 *
öfo
)

808 
õì80211_tx_øã
 *
r
 = &
öfo
->
°©us
.
øãs
[0];

810 
öfo
->
°©us
.
™ã¬a
 =

811 ((
øã_n_Êags
 & 
RATE_MCS_ANT_ABC_MSK
Ë>> 
RATE_MCS_ANT_POS
);

812 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK
)

813 
r
->
Êags
 |
IEEE80211_TX_RC_MCS
;

814 i‡(
øã_n_Êags
 & 
RATE_MCS_GF_MSK
)

815 
r
->
Êags
 |
IEEE80211_TX_RC_GREEN_FIELD
;

816 i‡(
øã_n_Êags
 & 
RATE_MCS_HT40_MSK
)

817 
r
->
Êags
 |
IEEE80211_TX_RC_40_MHZ_WIDTH
;

818 i‡(
øã_n_Êags
 & 
RATE_MCS_DUP_MSK
)

819 
r
->
Êags
 |
IEEE80211_TX_RC_DUP_DATA
;

820 i‡(
øã_n_Êags
 & 
RATE_MCS_SGI_MSK
)

821 
r
->
Êags
 |
IEEE80211_TX_RC_SHORT_GI
;

822 
r
->
idx
 = 
	`iwœgn_hwøã_to_mac80211_idx
(
øã_n_Êags
, 
öfo
->
b™d
);

823 
	}
}

825 #ifde‡
CONFIG_IWLWIFI_DEBUG


826 c⁄° *
	$iwl_gë_tx_Áû_ªas⁄
(
u32
 
°©us
)

828 
	#TX_STATUS_FAIL
(
x
Ë
TX_STATUS_FAIL_
 ## x:  #x

	)

829 
	#TX_STATUS_POSTPONE
(
x
Ë
TX_STATUS_POSTPONE_
 ## x:  #x

	)

831 
°©us
 & 
TX_STATUS_MSK
) {

832 
TX_STATUS_SUCCESS
:

834 
	`TX_STATUS_POSTPONE
(
DELAY
);

835 
	`TX_STATUS_POSTPONE
(
FEW_BYTES
);

836 
	`TX_STATUS_POSTPONE
(
BT_PRIO
);

837 
	`TX_STATUS_POSTPONE
(
QUIET_PERIOD
);

838 
	`TX_STATUS_POSTPONE
(
CALC_TTAK
);

839 
	`TX_STATUS_FAIL
(
INTERNAL_CROSSED_RETRY
);

840 
	`TX_STATUS_FAIL
(
SHORT_LIMIT
);

841 
	`TX_STATUS_FAIL
(
LONG_LIMIT
);

842 
	`TX_STATUS_FAIL
(
FIFO_UNDERRUN
);

843 
	`TX_STATUS_FAIL
(
DRAIN_FLOW
);

844 
	`TX_STATUS_FAIL
(
RFKILL_FLUSH
);

845 
	`TX_STATUS_FAIL
(
LIFE_EXPIRE
);

846 
	`TX_STATUS_FAIL
(
DEST_PS
);

847 
	`TX_STATUS_FAIL
(
HOST_ABORTED
);

848 
	`TX_STATUS_FAIL
(
BT_RETRY
);

849 
	`TX_STATUS_FAIL
(
STA_INVALID
);

850 
	`TX_STATUS_FAIL
(
FRAG_DROPPED
);

851 
	`TX_STATUS_FAIL
(
TID_DISABLE
);

852 
	`TX_STATUS_FAIL
(
FIFO_FLUSHED
);

853 
	`TX_STATUS_FAIL
(
INSUFFICIENT_CF_POLL
);

854 
	`TX_STATUS_FAIL
(
PASSIVE_NO_RX
);

855 
	`TX_STATUS_FAIL
(
NO_BEACON_ON_RADAR
);

860 #unde‡
TX_STATUS_FAIL


861 #unde‡
TX_STATUS_POSTPONE


862 
	}
}

865 
	$iwœgn_cou¡_agg_tx_îr_°©us
(
iwl_¥iv
 *
¥iv
, 
u16
 
°©us
)

867 
°©us
 &
AGG_TX_STATUS_MSK
;

869 
°©us
) {

870 
AGG_TX_STATE_UNDERRUN_MSK
:

871 
¥iv
->
ª∂y_agg_tx_°©s
.
undîrun
++;

873 
AGG_TX_STATE_BT_PRIO_MSK
:

874 
¥iv
->
ª∂y_agg_tx_°©s
.
bt_¥io
++;

876 
AGG_TX_STATE_FEW_BYTES_MSK
:

877 
¥iv
->
ª∂y_agg_tx_°©s
.
„w_byãs
++;

879 
AGG_TX_STATE_ABORT_MSK
:

880 
¥iv
->
ª∂y_agg_tx_°©s
.
ab‹t
++;

882 
AGG_TX_STATE_LAST_SENT_TTL_MSK
:

883 
¥iv
->
ª∂y_agg_tx_°©s
.
œ°_£¡_âl
++;

885 
AGG_TX_STATE_LAST_SENT_TRY_CNT_MSK
:

886 
¥iv
->
ª∂y_agg_tx_°©s
.
œ°_£¡_åy
++;

888 
AGG_TX_STATE_LAST_SENT_BT_KILL_MSK
:

889 
¥iv
->
ª∂y_agg_tx_°©s
.
œ°_£¡_bt_kûl
++;

891 
AGG_TX_STATE_SCD_QUERY_MSK
:

892 
¥iv
->
ª∂y_agg_tx_°©s
.
scd_quîy
++;

894 
AGG_TX_STATE_TEST_BAD_CRC32_MSK
:

895 
¥iv
->
ª∂y_agg_tx_°©s
.
bad_¸c32
++;

897 
AGG_TX_STATE_RESPONSE_MSK
:

898 
¥iv
->
ª∂y_agg_tx_°©s
.
ª•⁄£
++;

900 
AGG_TX_STATE_DUMP_TX_MSK
:

901 
¥iv
->
ª∂y_agg_tx_°©s
.
dump_tx
++;

903 
AGG_TX_STATE_DELAY_TX_MSK
:

904 
¥iv
->
ª∂y_agg_tx_°©s
.
dñay_tx
++;

907 
¥iv
->
ª∂y_agg_tx_°©s
.
unknown
++;

910 
	}
}

912 
ölöe
 
u32
 
	$iwœgn_gë_scd_s¢
(
iwœgn_tx_ª•
 *
tx_ª•
)

914  
	`À32_to_˝up
((
__À32
 *)&
tx_ª•
->
°©us
 +

915 
tx_ª•
->
‰ame_cou¡
Ë& 
IEEE80211_MAX_SN
;

916 
	}
}

918 
	$iwl_rx_ª∂y_tx_agg
(
iwl_¥iv
 *
¥iv
,

919 
iwœgn_tx_ª•
 *
tx_ª•
)

921 
agg_tx_°©us
 *
‰ame_°©us
 = &
tx_ª•
->
°©us
;

922 
tid
 = (
tx_ª•
->
ø_tid
 & 
IWLAGN_TX_RES_TID_MSK
) >>

923 
IWLAGN_TX_RES_TID_POS
;

924 
°a_id
 = (
tx_ª•
->
ø_tid
 & 
IWLAGN_TX_RES_RA_MSK
) >>

925 
IWLAGN_TX_RES_RA_POS
;

926 
iwl_ht_agg
 *
agg
 = &
¥iv
->
tid_d©a
[
°a_id
][
tid
].agg;

927 
u32
 
°©us
 = 
	`À16_to_˝u
(
tx_ª•
->status.status);

928 
i
;

930 
	`WARN_ON
(
tid
 =
IWL_TID_NON_QOS
);

932 i‡(
agg
->
waô_f‹_ba
)

933 
	`IWL_DEBUG_TX_REPLY
(
¥iv
,

936 
agg
->
øã_n_Êags
 = 
	`À32_to_˝u
(
tx_ª•
->rate_n_flags);

937 
agg
->
waô_f‹_ba
 = (
tx_ª•
->
‰ame_cou¡
 > 1);

943 i‡(
tx_ª•
->
bt_kûl_cou¡
 &&Åx_ª•->
‰ame_cou¡
 == 1 &&

944 
¥iv
->
lib
->
bt_∑øms
 &&

945 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

946 
	`IWL_DEBUG_COEX
(
¥iv
, "receiveÑeplyÅx w/ bt_kill\n");

949 i‡(
tx_ª•
->
‰ame_cou¡
 == 1)

952 
	`IWL_DEBUG_TX_REPLY
(
¥iv
, "TXQ %d initial_rate 0x%x ssn %d frm_cnt %d\n",

953 
agg
->
txq_id
,

954 
	`À32_to_˝u
(
tx_ª•
->
øã_n_Êags
),

955 
	`iwœgn_gë_scd_s¢
(
tx_ª•
),Åx_ª•->
‰ame_cou¡
);

958 
i
 = 0; i < 
tx_ª•
->
‰ame_cou¡
; i++) {

959 
u16
 
f°©us
 = 
	`À16_to_˝u
(
‰ame_°©us
[
i
].
°©us
);

960 
u8
 
ªåy_˙t
 = (
f°©us
 & 
AGG_TX_TRY_MSK
Ë>> 
AGG_TX_TRY_POS
;

962 i‡(
°©us
 & 
AGG_TX_STATUS_MSK
)

963 
	`iwœgn_cou¡_agg_tx_îr_°©us
(
¥iv
, 
f°©us
);

965 i‡(
°©us
 & (
AGG_TX_STATE_FEW_BYTES_MSK
 |

966 
AGG_TX_STATE_ABORT_MSK
))

969 i‡(
°©us
 & 
AGG_TX_STATUS_MSK
 || 
ªåy_˙t
 > 1)

970 
	`IWL_DEBUG_TX_REPLY
(
¥iv
,

972 
i
,

973 
	`iwl_gë_agg_tx_Áû_ªas⁄
(
f°©us
),

974 
f°©us
 & 
AGG_TX_STATUS_MSK
,

975 
ªåy_˙t
);

977 
	}
}

979 #ifde‡
CONFIG_IWLWIFI_DEBUG


980 
	#AGG_TX_STATE_FAIL
(
x
Ë
AGG_TX_STATE_
 ## x:  #x

	)

982 c⁄° *
	$iwl_gë_agg_tx_Áû_ªas⁄
(
u16
 
°©us
)

984 
°©us
 &
AGG_TX_STATUS_MSK
;

985 
°©us
) {

986 
AGG_TX_STATE_TRANSMITTED
:

988 
	`AGG_TX_STATE_FAIL
(
UNDERRUN_MSK
);

989 
	`AGG_TX_STATE_FAIL
(
BT_PRIO_MSK
);

990 
	`AGG_TX_STATE_FAIL
(
FEW_BYTES_MSK
);

991 
	`AGG_TX_STATE_FAIL
(
ABORT_MSK
);

992 
	`AGG_TX_STATE_FAIL
(
LAST_SENT_TTL_MSK
);

993 
	`AGG_TX_STATE_FAIL
(
LAST_SENT_TRY_CNT_MSK
);

994 
	`AGG_TX_STATE_FAIL
(
LAST_SENT_BT_KILL_MSK
);

995 
	`AGG_TX_STATE_FAIL
(
SCD_QUERY_MSK
);

996 
	`AGG_TX_STATE_FAIL
(
TEST_BAD_CRC32_MSK
);

997 
	`AGG_TX_STATE_FAIL
(
RESPONSE_MSK
);

998 
	`AGG_TX_STATE_FAIL
(
DUMP_TX_MSK
);

999 
	`AGG_TX_STATE_FAIL
(
DELAY_TX_MSK
);

1003 
	}
}

1006 
	$iwœgn_cou¡_tx_îr_°©us
(
iwl_¥iv
 *
¥iv
, 
u16
 
°©us
)

1008 
°©us
 &
TX_STATUS_MSK
;

1010 
°©us
) {

1011 
TX_STATUS_POSTPONE_DELAY
:

1012 
¥iv
->
ª∂y_tx_°©s
.
µ_dñay
++;

1014 
TX_STATUS_POSTPONE_FEW_BYTES
:

1015 
¥iv
->
ª∂y_tx_°©s
.
µ_„w_byãs
++;

1017 
TX_STATUS_POSTPONE_BT_PRIO
:

1018 
¥iv
->
ª∂y_tx_°©s
.
µ_bt_¥io
++;

1020 
TX_STATUS_POSTPONE_QUIET_PERIOD
:

1021 
¥iv
->
ª∂y_tx_°©s
.
µ_quõt_≥riod
++;

1023 
TX_STATUS_POSTPONE_CALC_TTAK
:

1024 
¥iv
->
ª∂y_tx_°©s
.
µ_ˇlc_âak
++;

1026 
TX_STATUS_FAIL_INTERNAL_CROSSED_RETRY
:

1027 
¥iv
->
ª∂y_tx_°©s
.
öt_¸os£d_ªåy
++;

1029 
TX_STATUS_FAIL_SHORT_LIMIT
:

1030 
¥iv
->
ª∂y_tx_°©s
.
sh‹t_limô
++;

1032 
TX_STATUS_FAIL_LONG_LIMIT
:

1033 
¥iv
->
ª∂y_tx_°©s
.
l⁄g_limô
++;

1035 
TX_STATUS_FAIL_FIFO_UNDERRUN
:

1036 
¥iv
->
ª∂y_tx_°©s
.
fifo_undîrun
++;

1038 
TX_STATUS_FAIL_DRAIN_FLOW
:

1039 
¥iv
->
ª∂y_tx_°©s
.
døö_Êow
++;

1041 
TX_STATUS_FAIL_RFKILL_FLUSH
:

1042 
¥iv
->
ª∂y_tx_°©s
.
rfkûl_Êush
++;

1044 
TX_STATUS_FAIL_LIFE_EXPIRE
:

1045 
¥iv
->
ª∂y_tx_°©s
.
li„_expúe
++;

1047 
TX_STATUS_FAIL_DEST_PS
:

1048 
¥iv
->
ª∂y_tx_°©s
.
de°_ps
++;

1050 
TX_STATUS_FAIL_HOST_ABORTED
:

1051 
¥iv
->
ª∂y_tx_°©s
.
ho°_ab‹t
++;

1053 
TX_STATUS_FAIL_BT_RETRY
:

1054 
¥iv
->
ª∂y_tx_°©s
.
bt_ªåy
++;

1056 
TX_STATUS_FAIL_STA_INVALID
:

1057 
¥iv
->
ª∂y_tx_°©s
.
°a_övÆid
++;

1059 
TX_STATUS_FAIL_FRAG_DROPPED
:

1060 
¥iv
->
ª∂y_tx_°©s
.
‰ag_dr›
++;

1062 
TX_STATUS_FAIL_TID_DISABLE
:

1063 
¥iv
->
ª∂y_tx_°©s
.
tid_dißbÀ
++;

1065 
TX_STATUS_FAIL_FIFO_FLUSHED
:

1066 
¥iv
->
ª∂y_tx_°©s
.
fifo_Êush
++;

1068 
TX_STATUS_FAIL_INSUFFICIENT_CF_POLL
:

1069 
¥iv
->
ª∂y_tx_°©s
.
ösuff_cf_pﬁl
++;

1071 
TX_STATUS_FAIL_PASSIVE_NO_RX
:

1072 
¥iv
->
ª∂y_tx_°©s
.
Áû_hw_dr›
++;

1074 
TX_STATUS_FAIL_NO_BEACON_ON_RADAR
:

1075 
¥iv
->
ª∂y_tx_°©s
.
°a_cﬁ‹_mism©ch
++;

1078 
¥iv
->
ª∂y_tx_°©s
.
unknown
++;

1081 
	}
}

1083 
	$iwœgn_£t_tx_°©us
(
iwl_¥iv
 *
¥iv
,

1084 
õì80211_tx_öfo
 *
öfo
,

1085 
iwœgn_tx_ª•
 *
tx_ª•
)

1087 
u16
 
°©us
 = 
	`À16_to_˝u
(
tx_ª•
->status.status);

1089 
öfo
->
Êags
 &~
IEEE80211_TX_CTL_AMPDU
;

1091 
öfo
->
°©us
.
øãs
[0].
cou¡
 = 
tx_ª•
->
Áûuª_‰ame
 + 1;

1092 
öfo
->
Êags
 |
	`iwl_tx_°©us_to_mac80211
(
°©us
);

1093 
	`iwœgn_hwøã_to_tx_c⁄åﬁ
(
¥iv
, 
	`À32_to_˝u
(
tx_ª•
->
øã_n_Êags
),

1094 
öfo
);

1095 i‡(!
	`iwl_is_tx_suc˚ss
(
°©us
))

1096 
	`iwœgn_cou¡_tx_îr_°©us
(
¥iv
, 
°©us
);

1097 
	}
}

1099 
	$iwl_check_ab‹t_°©us
(
iwl_¥iv
 *
¥iv
,

1100 
u8
 
‰ame_cou¡
, 
u32
 
°©us
)

1102 i‡(
‰ame_cou¡
 =1 && 
°©us
 =
TX_STATUS_FAIL_RFKILL_FLUSH
) {

1103 
	`IWL_ERR
(
¥iv
, "Tx flush commandÅo flush outáll frames\n");

1104 i‡(!
	`ã°_bô
(
STATUS_EXIT_PENDING
, &
¥iv
->
°©us
))

1105 
	`queue_w‹k
(
¥iv
->
w‹kqueue
, &¥iv->
tx_Êush
);

1107 
	}
}

1109 
	$iwœgn_rx_ª∂y_tx
(
iwl_¥iv
 *
¥iv
, 
iwl_rx_cmd_buf„r
 *
rxb
)

1111 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1112 
u16
 
£quí˚
 = 
	`À16_to_˝u
(
pkt
->
hdr
.sequence);

1113 
txq_id
 = 
	`SEQ_TO_QUEUE
(
£quí˚
);

1114 
cmd_ödex
 
__maybe_unu£d
 = 
	`SEQ_TO_INDEX
(
£quí˚
);

1115 
iwœgn_tx_ª•
 *
tx_ª•
 = (*)
pkt
->
d©a
;

1116 
õì80211_hdr
 *
hdr
;

1117 
u32
 
°©us
 = 
	`À16_to_˝u
(
tx_ª•
->status.status);

1118 
u16
 
s¢
 = 
	`iwœgn_gë_scd_s¢
(
tx_ª•
);

1119 
tid
;

1120 
°a_id
;

1121 
‰ìd
;

1122 
õì80211_tx_öfo
 *
öfo
;

1123 
sk_buff_hód
 
skbs
;

1124 
sk_buff
 *
skb
;

1125 
iwl_rx⁄_c⁄ãxt
 *
˘x
;

1126 
boﬁ
 
is_agg
 = (
txq_id
 >
IWLAGN_FIRST_AMPDU_QUEUE
);

1128 
tid
 = (
tx_ª•
->
ø_tid
 & 
IWLAGN_TX_RES_TID_MSK
) >>

1129 
IWLAGN_TX_RES_TID_POS
;

1130 
°a_id
 = (
tx_ª•
->
ø_tid
 & 
IWLAGN_TX_RES_RA_MSK
) >>

1131 
IWLAGN_TX_RES_RA_POS
;

1133 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1135 i‡(
is_agg
) {

1136 
	`WARN_ON_ONCE
(
°a_id
 >
IWLAGN_STATION_COUNT
 ||

1137 
tid
 >
IWL_MAX_TID_COUNT
);

1138 i‡(
txq_id
 !
¥iv
->
tid_d©a
[
°a_id
][
tid
].
agg
.txq_id)

1139 
	`IWL_ERR
(
¥iv
, "txq_id mism©ch: %d %d\n", 
txq_id
,

1140 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
agg
.
txq_id
);

1141 
	`iwl_rx_ª∂y_tx_agg
(
¥iv
, 
tx_ª•
);

1144 
	`__skb_queue_hód_öô
(&
skbs
);

1146 i‡(
tx_ª•
->
‰ame_cou¡
 == 1) {

1147 
u16
 
√xt_ª˛aimed
 = 
	`À16_to_˝u
(
tx_ª•
->
£q_˘l
);

1148 
√xt_ª˛aimed
 = 
	`IEEE80211_SEQ_TO_SN
(next_reclaimed + 0x10);

1150 i‡(
is_agg
) {

1162 
√xt_ª˛aimed
 = 
s¢
;

1165 i‡(
tid
 !
IWL_TID_NON_QOS
) {

1166 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
√xt_ª˛aimed
 =

1167 
√xt_ª˛aimed
;

1168 
	`IWL_DEBUG_TX_REPLY
(
¥iv
, "NextÑeclaimedÖacket:%d\n",

1169 
√xt_ª˛aimed
);

1170 
	`iwœgn_check_øtid_em±y
(
¥iv
, 
°a_id
, 
tid
);

1173 
	`iwl_å™s_ª˛aim
(
¥iv
->
å™s
, 
txq_id
, 
s¢
, &
skbs
, 
Ál£
);

1175 
‰ìd
 = 0;

1178 
	`skb_queue_wÆk
(&
skbs
, 
skb
) {

1179 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

1181 i‡(!
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
))

1182 
¥iv
->
œ°_£q_˘l
 = 
tx_ª•
->
£q_˘l
;

1184 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1185 
˘x
 = 
öfo
->
drivî_d©a
[0];

1186 
	`iwl_å™s_‰ì_tx_cmd
(
¥iv
->
å™s
,

1187 
öfo
->
drivî_d©a
[1]);

1189 
	`mem£t
(&
öfo
->
°©us
, 0, (info->status));

1191 i‡(
°©us
 =
TX_STATUS_FAIL_PASSIVE_NO_RX
 &&

1192 
˘x
->
vif
 &&

1193 
˘x
->
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

1195 
¥iv
->
∑ssive_no_rx
 = 
åue
;

1196 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

1198 
	`õì80211_°›_queues
(
¥iv
->
hw
);

1200 
	`IWL_DEBUG_TX_REPLY
(
¥iv
,

1203 
txq_id
,

1204 
	`iwl_gë_tx_Áû_ªas⁄
(
°©us
),

1205 
°©us
,

1206 
	`À32_to_˝u
(
tx_ª•
->
øã_n_Êags
),

1207 
tx_ª•
->
Áûuª_‰ame
);

1209 
	`IWL_DEBUG_TX_REPLY
(
¥iv
,

1211 
tx_ª•
->
‰ame_cou¡
, 
cmd_ödex
);

1215 i‡(
is_agg
 && !
	`iwl_is_tx_suc˚ss
(
°©us
))

1216 
öfo
->
Êags
 |
IEEE80211_TX_STAT_AMPDU_NO_BACK
;

1217 
	`iwœgn_£t_tx_°©us
(
¥iv
, 
	`IEEE80211_SKB_CB
(
skb
),

1218 
tx_ª•
);

1219 i‡(!
is_agg
)

1220 
	`iwœgn_n⁄_agg_tx_°©us
(
¥iv
, 
˘x
, 
hdr
->
addr1
);

1222 
‰ìd
++;

1225 i‡(
tid
 !
IWL_TID_NON_QOS
) {

1226 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
√xt_ª˛aimed
 =

1227 
√xt_ª˛aimed
;

1228 
	`IWL_DEBUG_TX_REPLY
(
¥iv
, "NextÑeclaimedÖacket:%d\n",

1229 
√xt_ª˛aimed
);

1232 i‡(!
is_agg
 && 
‰ìd
 != 1)

1233 
	`IWL_ERR
(
¥iv
, "Q: %d, fªed %d\n", 
txq_id
, 
‰ìd
);

1235 
	`IWL_DEBUG_TX_REPLY
(
¥iv
, "TXQ %d sètu†%†(0x%08x)\n", 
txq_id
,

1236 
	`iwl_gë_tx_Áû_ªas⁄
(
°©us
), status);

1238 
	`IWL_DEBUG_TX_REPLY
(
¥iv
,

1240 
	`À32_to_˝u
(
tx_ª•
->
øã_n_Êags
),

1241 
tx_ª•
->
Áûuª_‰ame
,

1242 
	`SEQ_TO_INDEX
(
£quí˚
), 
s¢
,

1243 
	`À16_to_˝u
(
tx_ª•
->
£q_˘l
));

1246 
	`iwl_check_ab‹t_°©us
(
¥iv
, 
tx_ª•
->
‰ame_cou¡
, 
°©us
);

1247 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1249 !
	`skb_queue_em±y
(&
skbs
)) {

1250 
skb
 = 
	`__skb_dequeue
(&
skbs
);

1251 
	`õì80211_tx_°©us_skb
(
¥iv
->
hw
, 
skb
);

1253 
	}
}

1261 
	$iwœgn_rx_ª∂y_com¥es£d_ba
(
iwl_¥iv
 *
¥iv
,

1262 
iwl_rx_cmd_buf„r
 *
rxb
)

1264 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1265 
iwl_com¥es£d_ba_ª•
 *
ba_ª•
 = (*)
pkt
->
d©a
;

1266 
iwl_ht_agg
 *
agg
;

1267 
sk_buff_hód
 
ª˛aimed_skbs
;

1268 
sk_buff
 *
skb
;

1269 
°a_id
;

1270 
tid
;

1271 
‰ìd
;

1274 
u16
 
scd_Êow
 = 
	`À16_to_˝u
(
ba_ª•
->scd_flow);

1278 
u16
 
ba_ª•_scd_s¢
 = 
	`À16_to_˝u
(
ba_ª•
->
scd_s¢
);

1280 i‡(
scd_Êow
 >
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
) {

1281 
	`IWL_ERR
(
¥iv
,

1286 
°a_id
 = 
ba_ª•
->sta_id;

1287 
tid
 = 
ba_ª•
->tid;

1288 
agg
 = &
¥iv
->
tid_d©a
[
°a_id
][
tid
].agg;

1290 
	`•ö_lock_bh
(&
¥iv
->
°a_lock
);

1292 i‡(
	`u∆ikñy
(!
agg
->
waô_f‹_ba
)) {

1293 i‡(
	`u∆ikñy
(
ba_ª•
->
bôm≠
))

1294 
	`IWL_ERR
(
¥iv
, "Received BA whenÇotÉxpected\n");

1295 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1299 i‡(
	`u∆ikñy
(
scd_Êow
 !
agg
->
txq_id
)) {

1306 
	`IWL_DEBUG_TX_QUEUES
(
¥iv
,

1308 
scd_Êow
, 
°a_id
, 
tid
, 
agg
->
txq_id
);

1309 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1313 
	`__skb_queue_hód_öô
(&
ª˛aimed_skbs
);

1318 
	`iwl_å™s_ª˛aim
(
¥iv
->
å™s
, 
scd_Êow
, 
ba_ª•_scd_s¢
,

1319 &
ª˛aimed_skbs
, 
Ál£
);

1321 
	`IWL_DEBUG_TX_REPLY
(
¥iv
, "REPLY_COMPRESSED_BA [%d] Received from %pM, "

1323 
agg
->
waô_f‹_ba
,

1324 (
u8
 *Ë&
ba_ª•
->
°a_addr_lo32
,

1325 
ba_ª•
->
°a_id
);

1326 
	`IWL_DEBUG_TX_REPLY
(
¥iv
, "TID = %d, SeqCtl = %d, bitmap = 0x%llx, "

1328 
ba_ª•
->
tid
, 
	`À16_to_˝u
(ba_ª•->
£q_˘l
),

1329 ()
	`À64_to_˝u
(
ba_ª•
->
bôm≠
),

1330 
scd_Êow
, 
ba_ª•_scd_s¢
, 
ba_ª•
->
txed
,

1331 
ba_ª•
->
txed_2_d⁄e
);

1334 
agg
->
waô_f‹_ba
 = 
Ál£
;

1337 i‡(
ba_ª•
->
txed_2_d⁄e
 > ba_ª•->
txed
) {

1338 
	`IWL_DEBUG_TX_REPLY
(
¥iv
,

1340 
ba_ª•
->
txed
, ba_ª•->
txed_2_d⁄e
);

1345 
ba_ª•
->
txed
 = ba_ª•->
txed_2_d⁄e
;

1348 
¥iv
->
tid_d©a
[
°a_id
][
tid
].
√xt_ª˛aimed
 = 
ba_ª•_scd_s¢
;

1350 
	`iwœgn_check_øtid_em±y
(
¥iv
, 
°a_id
, 
tid
);

1351 
‰ìd
 = 0;

1353 
	`skb_queue_wÆk
(&
ª˛aimed_skbs
, 
skb
) {

1354 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

1355 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1357 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
))

1358 
‰ìd
++;

1360 
	`WARN_ON_ONCE
(1);

1362 
	`iwl_å™s_‰ì_tx_cmd
(
¥iv
->
å™s
, 
öfo
->
drivî_d©a
[1]);

1364 
	`mem£t
(&
öfo
->
°©us
, 0, (info->status));

1369 
öfo
->
Êags
 |
IEEE80211_TX_STAT_ACK
;

1371 i‡(
‰ìd
 == 1) {

1374 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1375 
	`mem£t
(&
öfo
->
°©us
, 0, (info->status));

1376 
öfo
->
Êags
 |
IEEE80211_TX_STAT_AMPDU
;

1377 
öfo
->
°©us
.
ampdu_ack_Àn
 = 
ba_ª•
->
txed_2_d⁄e
;

1378 
öfo
->
°©us
.
ampdu_Àn
 = 
ba_ª•
->
txed
;

1379 
	`iwœgn_hwøã_to_tx_c⁄åﬁ
(
¥iv
, 
agg
->
øã_n_Êags
,

1380 
öfo
);

1384 
	`•ö_u∆ock_bh
(&
¥iv
->
°a_lock
);

1386 !
	`skb_queue_em±y
(&
ª˛aimed_skbs
)) {

1387 
skb
 = 
	`__skb_dequeue
(&
ª˛aimed_skbs
);

1388 
	`õì80211_tx_°©us_skb
(
¥iv
->
hw
, 
skb
);

1390 
	}
}

	@dvm/ucode.c

8 
	~<löux/kî√l.h
>

10 
	~"iwl-io.h
"

11 
	~"iwl-agn-hw.h
"

12 
	~"iwl-å™s.h
"

13 
	~"iwl-fh.h
"

14 
	~"iwl-›-mode.h
"

16 
	~"dev.h
"

17 
	~"agn.h
"

18 
	~"ˇlib.h
"

29 
	$iwl_£t_Xèl_ˇlib
(
iwl_¥iv
 *
¥iv
)

31 
iwl_ˇlib_xèl_‰eq_cmd
 
cmd
;

32 
__À16
 *
xèl_ˇlib
 = 
¥iv
->
nvm_d©a
->xtal_calib;

34 
	`iwl_£t_ˇlib_hdr
(&
cmd
.
hdr
, 
IWL_PHY_CALIBRATE_CRYSTAL_FRQ_CMD
);

35 
cmd
.
ˇp_pö1
 = 
	`À16_to_˝u
(
xèl_ˇlib
[0]);

36 
cmd
.
ˇp_pö2
 = 
	`À16_to_˝u
(
xèl_ˇlib
[1]);

37  
	`iwl_ˇlib_£t
(
¥iv
, (*)&
cmd
, (cmd));

38 
	}
}

40 
	$iwl_£t_ãm≥øtuª_off£t_ˇlib
(
iwl_¥iv
 *
¥iv
)

42 
iwl_ˇlib_ãm≥øtuª_off£t_cmd
 
cmd
;

44 
	`mem£t
(&
cmd
, 0, (cmd));

45 
	`iwl_£t_ˇlib_hdr
(&
cmd
.
hdr
, 
IWL_PHY_CALIBRATE_TEMP_OFFSET_CMD
);

46 
cmd
.
ødio_£ns‹_off£t
 = 
¥iv
->
nvm_d©a
->
øw_ãm≥øtuª
;

47 i‡(!(
cmd
.
ødio_£ns‹_off£t
))

48 
cmd
.
ødio_£ns‹_off£t
 = 
DEFAULT_RADIO_SENSOR_OFFSET
;

50 
	`IWL_DEBUG_CALIB
(
¥iv
, "Radio sensor offset: %d\n",

51 
	`À16_to_˝u
(
cmd
.
ødio_£ns‹_off£t
));

52  
	`iwl_ˇlib_£t
(
¥iv
, (*)&
cmd
, (cmd));

53 
	}
}

55 
	$iwl_£t_ãm≥øtuª_off£t_ˇlib_v2
(
iwl_¥iv
 *
¥iv
)

57 
iwl_ˇlib_ãm≥øtuª_off£t_v2_cmd
 
cmd
;

59 
	`mem£t
(&
cmd
, 0, (cmd));

60 
	`iwl_£t_ˇlib_hdr
(&
cmd
.
hdr
, 
IWL_PHY_CALIBRATE_TEMP_OFFSET_CMD
);

61 
cmd
.
ødio_£ns‹_off£t_high
 = 
¥iv
->
nvm_d©a
->
kñvö_ãm≥øtuª
;

62 
cmd
.
ødio_£ns‹_off£t_low
 = 
¥iv
->
nvm_d©a
->
øw_ãm≥øtuª
;

63 i‡(!
cmd
.
ødio_£ns‹_off£t_low
) {

64 
	`IWL_DEBUG_CALIB
(
¥iv
, "no info in EEPROM, use default\n");

65 
cmd
.
ødio_£ns‹_off£t_low
 = 
DEFAULT_RADIO_SENSOR_OFFSET
;

66 
cmd
.
ødio_£ns‹_off£t_high
 = 
DEFAULT_RADIO_SENSOR_OFFSET
;

68 
cmd
.
bu∫tVﬁègeRef
 = 
¥iv
->
nvm_d©a
->
ˇlib_vﬁège
;

70 
	`IWL_DEBUG_CALIB
(
¥iv
, "Radio sensor offset high: %d\n",

71 
	`À16_to_˝u
(
cmd
.
ødio_£ns‹_off£t_high
));

72 
	`IWL_DEBUG_CALIB
(
¥iv
, "Radio sensor offsetÜow: %d\n",

73 
	`À16_to_˝u
(
cmd
.
ødio_£ns‹_off£t_low
));

74 
	`IWL_DEBUG_CALIB
(
¥iv
, "Voltage Ref: %d\n",

75 
	`À16_to_˝u
(
cmd
.
bu∫tVﬁègeRef
));

77  
	`iwl_ˇlib_£t
(
¥iv
, (*)&
cmd
, (cmd));

78 
	}
}

80 
	$iwl_£nd_ˇlib_cfg
(
iwl_¥iv
 *
¥iv
)

82 
iwl_ˇlib_cfg_cmd
 
ˇlib_cfg_cmd
;

83 
iwl_ho°_cmd
 
cmd
 = {

84 .
id
 = 
CALIBRATION_CFG_CMD
,

85 .
Àn
 = { (
iwl_ˇlib_cfg_cmd
), },

86 .
d©a
 = { &
ˇlib_cfg_cmd
, },

89 
	`mem£t
(&
ˇlib_cfg_cmd
, 0, (calib_cfg_cmd));

90 
ˇlib_cfg_cmd
.
ucd_ˇlib_cfg
.
⁄˚
.
is_íabÀ
 = 
IWL_CALIB_INIT_CFG_ALL
;

91 
ˇlib_cfg_cmd
.
ucd_ˇlib_cfg
.
⁄˚
.
°¨t
 = 
IWL_CALIB_INIT_CFG_ALL
;

92 
ˇlib_cfg_cmd
.
ucd_ˇlib_cfg
.
⁄˚
.
£nd_ªs
 = 
IWL_CALIB_INIT_CFG_ALL
;

93 
ˇlib_cfg_cmd
.
ucd_ˇlib_cfg
.
Êags
 =

94 
IWL_CALIB_CFG_FLAG_SEND_COMPLETE_NTFY_MSK
;

96  
	`iwl_dvm_£nd_cmd
(
¥iv
, &
cmd
);

97 
	}
}

99 
	$iwl_öô_Æive_°¨t
(
iwl_¥iv
 *
¥iv
)

101 
ªt
;

103 i‡(
¥iv
->
lib
->
bt_∑øms
 &&

104 
¥iv
->
lib
->
bt_∑øms
->
adv™˚d_bt_c€xi°
) {

111 
ªt
 = 
	`iwl_£nd_bt_ív
(
¥iv
, 
IWL_BT_COEX_ENV_OPEN
,

112 
BT_COEX_PRIO_TBL_EVT_INIT_CALIB2
);

113 i‡(
ªt
)

114  
ªt
;

118 
ªt
 = 
	`iwl_£nd_ˇlib_cfg
(
¥iv
);

119 i‡(
ªt
)

120  
ªt
;

126 i‡(
¥iv
->
lib
->
√ed_ãmp_off£t_ˇlib
) {

127 i‡(
¥iv
->
lib
->
ãmp_off£t_v2
)

128  
	`iwl_£t_ãm≥øtuª_off£t_ˇlib_v2
(
¥iv
);

130  
	`iwl_£t_ãm≥øtuª_off£t_ˇlib
(
¥iv
);

134 
	}
}

136 
	$iwl_£nd_wimax_c€x
(
iwl_¥iv
 *
¥iv
)

138 
iwl_wimax_c€x_cmd
 
c€x_cmd
;

141 
	`mem£t
(&
c€x_cmd
, 0, (coex_cmd));

143  
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

144 
COEX_PRIORITY_TABLE_CMD
, 0,

145 (
c€x_cmd
), &coex_cmd);

146 
	}
}

148 c⁄° 
u8
 
	giwl_bt_¥io_tbl
[
BT_COEX_PRIO_TBL_EVT_MAX
] = {

149 ((
BT_COEX_PRIO_TBL_PRIO_BYPASS
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

150 (0 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

151 ((
BT_COEX_PRIO_TBL_PRIO_BYPASS
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

152 (1 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

153 ((
BT_COEX_PRIO_TBL_PRIO_LOW
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

154 (0 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

155 ((
BT_COEX_PRIO_TBL_PRIO_LOW
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

156 (1 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

157 ((
BT_COEX_PRIO_TBL_PRIO_HIGH
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

158 (0 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

159 ((
BT_COEX_PRIO_TBL_PRIO_HIGH
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

160 (1 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

161 ((
BT_COEX_PRIO_TBL_PRIO_BYPASS
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

162 (0 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

163 ((
BT_COEX_PRIO_TBL_PRIO_COEX_OFF
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

164 (0 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

165 ((
BT_COEX_PRIO_TBL_PRIO_COEX_ON
 << 
IWL_BT_COEX_PRIO_TBL_PRIO_POS
) |

166 (0 << 
IWL_BT_COEX_PRIO_TBL_SHARED_ANTENNA_POS
)),

170 
	$iwl_£nd_¥io_tbl
(
iwl_¥iv
 *
¥iv
)

172 
iwl_bt_c€x_¥io_èbÀ_cmd
 
¥io_tbl_cmd
;

174 
	`mem˝y
(
¥io_tbl_cmd
.
¥io_tbl
, 
iwl_bt_¥io_tbl
,

175 (
iwl_bt_¥io_tbl
));

176 i‡(
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

177 
REPLY_BT_COEX_PRIO_TABLE
, 0,

178 (
¥io_tbl_cmd
), &prio_tbl_cmd))

179 
	`IWL_ERR
(
¥iv
, "failedÅo send BTÖrioÅbl command\n");

180 
	}
}

182 
	$iwl_£nd_bt_ív
(
iwl_¥iv
 *
¥iv
, 
u8
 
a˘i⁄
, u8 
ty≥
)

184 
iwl_bt_c€x_¥Ÿ_ív_cmd
 
ív_cmd
;

185 
ªt
;

187 
ív_cmd
.
a˘i⁄
 =áction;

188 
ív_cmd
.
ty≥
 =Åype;

189 
ªt
 = 
	`iwl_dvm_£nd_cmd_pdu
(
¥iv
,

190 
REPLY_BT_COEX_PROT_ENV
, 0,

191 (
ív_cmd
), &env_cmd);

192 i‡(
ªt
)

193 
	`IWL_ERR
(
¥iv
, "failedÅo send BTÉnv command\n");

194  
ªt
;

195 
	}
}

197 c⁄° 
u8
 
	giwœgn_deÁu…_queue_to_tx_fifo
[] = {

198 
IWL_TX_FIFO_VO
,

199 
IWL_TX_FIFO_VI
,

200 
IWL_TX_FIFO_BE
,

201 
IWL_TX_FIFO_BK
,

204 c⁄° 
u8
 
	giwœgn_ù™_queue_to_tx_fifo
[] = {

205 
IWL_TX_FIFO_VO
,

206 
IWL_TX_FIFO_VI
,

207 
IWL_TX_FIFO_BE
,

208 
IWL_TX_FIFO_BK
,

209 
IWL_TX_FIFO_BK_IPAN
,

210 
IWL_TX_FIFO_BE_IPAN
,

211 
IWL_TX_FIFO_VI_IPAN
,

212 
IWL_TX_FIFO_VO_IPAN
,

213 
IWL_TX_FIFO_BE_IPAN
,

214 
IWL_TX_FIFO_UNUSED
,

215 
IWL_TX_FIFO_AUX
,

218 
	$iwl_Æive_nŸify
(
iwl_¥iv
 *
¥iv
)

220 c⁄° 
u8
 *
queue_to_txf
;

221 
u8
 
n_queues
;

222 
ªt
;

223 
i
;

225 
	`iwl_å™s_fw_Æive
(
¥iv
->
å™s
, 0);

227 i‡(
¥iv
->
fw
->
ucode_ˇ∑
.
Êags
 & 
IWL_UCODE_TLV_FLAGS_PAN
 &&

228 
¥iv
->
nvm_d©a
->
sku_ˇp_ù™_íabÀ
) {

229 
n_queues
 = 
	`ARRAY_SIZE
(
iwœgn_ù™_queue_to_tx_fifo
);

230 
queue_to_txf
 = 
iwœgn_ù™_queue_to_tx_fifo
;

232 
n_queues
 = 
	`ARRAY_SIZE
(
iwœgn_deÁu…_queue_to_tx_fifo
);

233 
queue_to_txf
 = 
iwœgn_deÁu…_queue_to_tx_fifo
;

236 
i
 = 0; i < 
n_queues
; i++)

237 i‡(
queue_to_txf
[
i
] !
IWL_TX_FIFO_UNUSED
)

238 
	`iwl_å™s_ac_txq_íabÀ
(
¥iv
->
å™s
, 
i
,

239 
queue_to_txf
[
i
], 0);

241 
¥iv
->
∑ssive_no_rx
 = 
Ál£
;

242 
¥iv
->
å™•‹t_queue_°›
 = 0;

244 
ªt
 = 
	`iwl_£nd_wimax_c€x
(
¥iv
);

245 i‡(
ªt
)

246  
ªt
;

248 i‡(!
¥iv
->
lib
->
no_xèl_ˇlib
) {

249 
ªt
 = 
	`iwl_£t_Xèl_ˇlib
(
¥iv
);

250 i‡(
ªt
)

251  
ªt
;

254  
	`iwl_£nd_ˇlib_ªsu…s
(
¥iv
);

255 
	}
}

257 
	siwl_Æive_d©a
 {

258 
boﬁ
 
	mvÆid
;

259 
u8
 
	msubty≥
;

262 
boﬁ
 
	$iwl_Æive_‚
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

263 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

265 
iwl_¥iv
 *
¥iv
 =

266 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_¥iv
,Çotif_wait);

267 
iwl_Æive_d©a
 *
Æive_d©a
 = 
d©a
;

268 
iwl_Æive_ª•
 *
∑live
;

270 
∑live
 = (*)
pkt
->
d©a
;

272 
	`IWL_DEBUG_FW
(
¥iv
, "Alive ucode status 0x%08XÑevision "

274 
∑live
->
is_vÆid
,ÖÆive->
vî_ty≥
,

275 
∑live
->
vî_subty≥
);

277 
¥iv
->
devi˚_poöãrs
.
îr‹_evít_èbÀ
 =

278 
	`À32_to_˝u
(
∑live
->
îr‹_evít_èbÀ_±r
);

279 
¥iv
->
devi˚_poöãrs
.
log_evít_èbÀ
 =

280 
	`À32_to_˝u
(
∑live
->
log_evít_èbÀ_±r
);

282 
Æive_d©a
->
subty≥
 = 
∑live
->
vî_subty≥
;

283 
Æive_d©a
->
vÆid
 = 
∑live
->
is_vÆid
 =
UCODE_VALID_OK
;

285  
åue
;

286 
	}
}

288 
	#UCODE_ALIVE_TIMEOUT
 
HZ


	)

289 
	#UCODE_CALIB_TIMEOUT
 (2*
HZ
)

	)

291 
	$iwl_lﬂd_ucode_waô_Æive
(
iwl_¥iv
 *
¥iv
,

292 
iwl_ucode_ty≥
 
ucode_ty≥
)

294 
iwl_nŸifiˇti⁄_waô
 
Æive_waô
;

295 
iwl_Æive_d©a
 
Æive_d©a
;

296 c⁄° 
fw_img
 *
fw
;

297 
ªt
;

298 
iwl_ucode_ty≥
 
ﬁd_ty≥
;

299 c⁄° 
u16
 
Æive_cmd
[] = { 
REPLY_ALIVE
 };

301 
fw
 = 
	`iwl_gë_ucode_image
(
¥iv
->fw, 
ucode_ty≥
);

302 i‡(
	`WARN_ON
(!
fw
))

303  -
EINVAL
;

305 
ﬁd_ty≥
 = 
¥iv
->
cur_ucode
;

306 
¥iv
->
cur_ucode
 = 
ucode_ty≥
;

307 
¥iv
->
ucode_lﬂded
 = 
Ál£
;

309 
	`iwl_öô_nŸifiˇti⁄_waô
(&
¥iv
->
nŸif_waô
, &
Æive_waô
,

310 
Æive_cmd
, 
	`ARRAY_SIZE
(alive_cmd),

311 
iwl_Æive_‚
, &
Æive_d©a
);

313 
ªt
 = 
	`iwl_å™s_°¨t_fw
(
¥iv
->
å™s
, 
fw
, 
Ál£
);

314 i‡(
ªt
) {

315 
¥iv
->
cur_ucode
 = 
ﬁd_ty≥
;

316 
	`iwl_ªmove_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
, &
Æive_waô
);

317  
ªt
;

324 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
, &
Æive_waô
,

325 
UCODE_ALIVE_TIMEOUT
);

326 i‡(
ªt
) {

327 
¥iv
->
cur_ucode
 = 
ﬁd_ty≥
;

328  
ªt
;

331 i‡(!
Æive_d©a
.
vÆid
) {

332 
	`IWL_ERR
(
¥iv
, "Loaded ucode isÇot valid!\n");

333 
¥iv
->
cur_ucode
 = 
ﬁd_ty≥
;

334  -
EIO
;

337 
¥iv
->
ucode_lﬂded
 = 
åue
;

339 i‡(
ucode_ty≥
 !
IWL_UCODE_WOWLAN
) {

341 
	`m¶ìp
(5);

344 
ªt
 = 
	`iwl_Æive_nŸify
(
¥iv
);

345 i‡(
ªt
) {

346 
	`IWL_WARN
(
¥iv
,

347 "CouldÇŸ com∂ëêALIVEÅønsôi⁄: %d\n", 
ªt
);

348 
¥iv
->
cur_ucode
 = 
ﬁd_ty≥
;

349  
ªt
;

353 
	}
}

355 
boﬁ
 
	$iwœgn_waô_ˇlib
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

356 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

358 
iwl_¥iv
 *
¥iv
 = 
d©a
;

359 
iwl_ˇlib_cmd
 *
cmd
;

361 i‡(
pkt
->
hdr
.
cmd
 !
CALIBRATION_RES_NOTIFICATION
) {

362 
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
CALIBRATION_COMPLETE_NOTIFICATION
);

363  
åue
;

366 
cmd
 = (
iwl_ˇlib_cmd
 *)
pkt
->
d©a
;

368 i‡(
	`iwl_ˇlib_£t
(
¥iv
, 
cmd
, 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
)))

369 
	`IWL_ERR
(
¥iv
, "FailedÅoÑecord calibration data %d\n",

370 
cmd
->
hdr
.
›_code
);

372  
Ál£
;

373 
	}
}

375 
	$iwl_run_öô_ucode
(
iwl_¥iv
 *
¥iv
)

377 
iwl_nŸifiˇti⁄_waô
 
ˇlib_waô
;

378 c⁄° 
u16
 
ˇlib_com∂ëe
[] = {

379 
CALIBRATION_RES_NOTIFICATION
,

380 
CALIBRATION_COMPLETE_NOTIFICATION


382 
ªt
;

384 
	`lockdï_as£π_hñd
(&
¥iv
->
muãx
);

387 i‡(!
¥iv
->
fw
->
img
[
IWL_UCODE_INIT
].
num_£c
)

390 
	`iwl_öô_nŸifiˇti⁄_waô
(&
¥iv
->
nŸif_waô
, &
ˇlib_waô
,

391 
ˇlib_com∂ëe
, 
	`ARRAY_SIZE
(calib_complete),

392 
iwœgn_waô_ˇlib
, 
¥iv
);

395 
ªt
 = 
	`iwl_lﬂd_ucode_waô_Æive
(
¥iv
, 
IWL_UCODE_INIT
);

396 i‡(
ªt
)

397 
îr‹
;

399 
ªt
 = 
	`iwl_öô_Æive_°¨t
(
¥iv
);

400 i‡(
ªt
)

401 
îr‹
;

407 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
, &
ˇlib_waô
,

408 
UCODE_CALIB_TIMEOUT
);

410 
out
;

412 
îr‹
:

413 
	`iwl_ªmove_nŸifiˇti⁄
(&
¥iv
->
nŸif_waô
, &
ˇlib_waô
);

414 
out
:

416 
	`iwl_å™s_°›_devi˚
(
¥iv
->
å™s
);

417 
¥iv
->
ucode_lﬂded
 = 
Ál£
;

419  
ªt
;

420 
	}
}

	@fw/acpi.c

6 
	~<löux/uuid.h
>

7 
	~"iwl-drv.h
"

8 
	~"iwl-debug.h
"

9 
	~"a˝i.h
"

10 
	~"fw/ru¡ime.h
"

12 c⁄° 
guid_t
 
	giwl_guid
 = 
GUID_INIT
(0xF21202BF, 0x8F78, 0x4DC6,

16 c⁄° 
size_t
 
	ga˝i_dsm_size
[
DSM_FUNC_NUM_FUNCS
] = {

17 [
DSM_FUNC_QUERY
] = (
u32
),

18 [
DSM_FUNC_DISABLE_SRD
] = (
u8
),

19 [
DSM_FUNC_ENABLE_INDONESIA_5G2
] = (
u8
),

20 [
DSM_FUNC_ENABLE_6E
] = (
u32
),

21 [
DSM_FUNC_REGULATORY_CONFIG
] = (
u32
),

23 [5] = (
size_t
)0,

24 [
DSM_FUNC_11AX_ENABLEMENT
] = (
u32
),

25 [
DSM_FUNC_ENABLE_UNII4_CHAN
] = (
u32
),

26 [
DSM_FUNC_ACTIVATE_CHANNEL
] = (
u32
),

27 [
DSM_FUNC_FORCE_DISABLE_CHANNELS
] = (
u32
),

28 [
DSM_FUNC_ENERGY_DETECTION_THRESHOLD
] = (
u32
),

29 [
DSM_FUNC_RFI_CONFIG
] = (
u32
),

32 
	$iwl_a˝i_gë_h™dÀ
(
devi˚
 *
dev
, 
a˝i_°rög
 
mëhod
,

33 
a˝i_h™dÀ
 *
ªt_h™dÀ
)

35 
a˝i_h™dÀ
 
roŸ_h™dÀ
;

36 
a˝i_°©us
 
°©us
;

38 
roŸ_h™dÀ
 = 
	`ACPI_HANDLE
(
dev
);

39 i‡(!
roŸ_h™dÀ
) {

40 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

42  -
ENOENT
;

45 
°©us
 = 
	`a˝i_gë_h™dÀ
(
roŸ_h™dÀ
, 
mëhod
, 
ªt_h™dÀ
);

46 i‡(
	`ACPI_FAILURE
(
°©us
)) {

47 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

48 "ACPI: %†mëhodÇŸ found\n", 
mëhod
);

49  -
ENOENT
;

52 
	}
}

54 *
	$iwl_a˝i_gë_obje˘
(
devi˚
 *
dev
, 
a˝i_°rög
 
mëhod
)

56 
a˝i_buf„r
 
buf
 = {
ACPI_ALLOCATE_BUFFER
, 
NULL
};

57 
a˝i_h™dÀ
 
h™dÀ
;

58 
a˝i_°©us
 
°©us
;

59 
ªt
;

61 
ªt
 = 
	`iwl_a˝i_gë_h™dÀ
(
dev
, 
mëhod
, &
h™dÀ
);

62 i‡(
ªt
)

63  
	`ERR_PTR
(-
ENOENT
);

66 
°©us
 = 
	`a˝i_evÆu©e_obje˘
(
h™dÀ
, 
NULL
, NULL, &
buf
);

67 i‡(
	`ACPI_FAILURE
(
°©us
)) {

68 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

70 
mëhod
, 
°©us
);

71  
	`ERR_PTR
(-
ENOENT
);

73  
buf
.
poöãr
;

74 
	}
}

81 *
	$iwl_a˝i_gë_dsm_obje˘
(
devi˚
 *
dev
, 
ªv
, 
func
,

82 
a˝i_obje˘
 *
¨gs
,

83 c⁄° 
guid_t
 *
guid
)

85 
a˝i_obje˘
 *
obj
;

87 
obj
 = 
	`a˝i_evÆu©e_dsm
(
	`ACPI_HANDLE
(
dev
), 
guid
, 
ªv
, 
func
,

88 
¨gs
);

89 i‡(!
obj
) {

90 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

92 
ªv
, 
func
);

93  
	`ERR_PTR
(-
ENOENT
);

95  
obj
;

96 
	}
}

105 
	$iwl_a˝i_gë_dsm_öãgî
(
devi˚
 *
dev
, 
ªv
, 
func
,

106 c⁄° 
guid_t
 *
guid
, 
u64
 *
vÆue
,

107 
size_t
 
ex≥˘ed_size
)

109 
a˝i_obje˘
 *
obj
;

110 
ªt
 = 0;

112 
obj
 = 
	`iwl_a˝i_gë_dsm_obje˘
(
dev
, 
ªv
, 
func
, 
NULL
, 
guid
);

113 i‡(
	`IS_ERR
(
obj
)) {

114 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

116 
func
);

117  -
ENOENT
;

120 i‡(
obj
->
ty≥
 =
ACPI_TYPE_INTEGER
) {

121 *
vÆue
 = 
obj
->
öãgî
.value;

122 } i‡(
obj
->
ty≥
 =
ACPI_TYPE_BUFFER
) {

123 
__À64
 
À_vÆue
 = 0;

125 i‡(
	`WARN_ON_ONCE
(
ex≥˘ed_size
 > (
À_vÆue
)))

126  -
EINVAL
;

129 i‡(
obj
->
buf„r
.
Àngth
 !
ex≥˘ed_size
)

130 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

132 
obj
->
buf„r
.
Àngth
);

135 
	`mem˝y
(&
À_vÆue
, 
obj
->
buf„r
.
poöãr
,

136 
	`mö_t
(
size_t
, 
ex≥˘ed_size
, (size_t)
obj
->
buf„r
.
Àngth
));

137 *
vÆue
 = 
	`À64_to_˝u
(
À_vÆue
);

139 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

141 
obj
->
ty≥
);

142 
ªt
 = -
EINVAL
;

143 
out
;

146 
	`IWL_DEBUG_DEV_RADIO
(
dev
,

148 
func
, 
ªt
);

149 
out
:

150 
	`ACPI_FREE
(
obj
);

151  
ªt
;

152 
	}
}

159 
	$iwl_a˝i_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
,

160 
iwl_dsm_funcs
 
func
, 
u32
 *
vÆue
)

162 
size_t
 
ex≥˘ed_size
;

163 
u64
 
tmp
;

164 
ªt
;

166 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
a˝i_dsm_size
Ë!
DSM_FUNC_NUM_FUNCS
);

168 i‡(
	`WARN_ON
(
func
 >
	`ARRAY_SIZE
(
a˝i_dsm_size
)))

169  -
EINVAL
;

171 
ex≥˘ed_size
 = 
a˝i_dsm_size
[
func
];

174 i‡(
ex≥˘ed_size
 !(
u8
Ë&&Éx≥˘ed_sizê!(
u32
))

175  -
EOPNOTSUPP
;

177 
ªt
 = 
	`iwl_a˝i_gë_dsm_öãgî
(
fwπ
->
dev
, 
ACPI_DSM_REV
, 
func
,

178 &
iwl_guid
, &
tmp
, 
ex≥˘ed_size
);

179 i‡(
ªt
)

180  
ªt
;

182 i‡((
ex≥˘ed_size
 =(
u8
Ë&& 
tmp
 != (u8)tmp) ||

183 (
ex≥˘ed_size
 =(
u32
Ë&& 
tmp
 != (u32)tmp))

184 
	`IWL_DEBUG_RADIO
(
fwπ
,

186 *
vÆue
 = (
u32
)
tmp
;

189 
	}
}

191 
a˝i_obje˘
 *

192 
	$iwl_a˝i_gë_wifi_pkg_ønge
(
devi˚
 *
dev
,

193 
a˝i_obje˘
 *
d©a
,

194 
mö_d©a_size
,

195 
max_d©a_size
,

196 *
tbl_ªv
)

198 
i
;

199 
a˝i_obje˘
 *
wifi_pkg
;

206 i‡(
	`WARN_ON_ONCE
(
mö_d©a_size
 < 2 || mö_d©a_sizê> 
max_d©a_size
))

207  
	`ERR_PTR
(-
EINVAL
);

215 i‡(
d©a
->
ty≥
 !
ACPI_TYPE_PACKAGE
 ||

216 
d©a
->
∑ckage
.
cou¡
 < 2 ||

217 
d©a
->
∑ckage
.
ñemíts
[0].
ty≥
 !
ACPI_TYPE_INTEGER
) {

218 
	`IWL_DEBUG_DEV_RADIO
(
dev
, "InvalidÖackages structure\n");

219  
	`ERR_PTR
(-
EINVAL
);

222 *
tbl_ªv
 = 
d©a
->
∑ckage
.
ñemíts
[0].
öãgî
.
vÆue
;

225 
i
 = 1; i < 
d©a
->
∑ckage
.
cou¡
; i++) {

226 
a˝i_obje˘
 *
domaö
;

228 
wifi_pkg
 = &
d©a
->
∑ckage
.
ñemíts
[
i
];

231 i‡(
wifi_pkg
->
ty≥
 !
ACPI_TYPE_PACKAGE
 ||

232 
wifi_pkg
->
∑ckage
.
cou¡
 < 
mö_d©a_size
 ||

233 
wifi_pkg
->
∑ckage
.
cou¡
 > 
max_d©a_size
)

236 
domaö
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[0];

237 i‡(
domaö
->
ty≥
 =
ACPI_TYPE_INTEGER
 &&

238 
domaö
->
öãgî
.
vÆue
 =
ACPI_WIFI_DOMAIN
)

239 
found
;

242  
	`ERR_PTR
(-
ENOENT
);

244 
found
:

245  
wifi_pkg
;

246 
	}
}

248 
a˝i_obje˘
 *

249 
	$iwl_a˝i_gë_wifi_pkg
(
devi˚
 *
dev
,

250 
a˝i_obje˘
 *
d©a
,

251 
d©a_size
, *
tbl_ªv
)

253  
	`iwl_a˝i_gë_wifi_pkg_ønge
(
dev
, 
d©a
, 
d©a_size
, data_size,

254 
tbl_ªv
);

255 
	}
}

257 
	$iwl_a˝i_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

258 
iwl_ès_d©a
 *
ès_d©a
)

260 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

261 
ªt
, 
tbl_ªv
, 
i
, 
block_li°_size
, 
íabÀd
;

263 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_WTAS_METHOD
);

264 i‡(
	`IS_ERR
(
d©a
))

265  
	`PTR_ERR
(
d©a
);

268 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

269 
ACPI_WTAS_WIFI_DATA_SIZE
,

270 &
tbl_ªv
);

271 i‡(
	`IS_ERR
(
wifi_pkg
)) {

272 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

273 
out_‰ì
;

276 i‡(
tbl_ªv
 =1 && 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 ==

277 
ACPI_TYPE_INTEGER
) {

278 
u32
 
ès_£À˘i⁄
 =

279 (
u32
)
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

281 
íabÀd
 = 
	`iwl_∑r£_ès_£À˘i⁄
(
fwπ
, 
ès_d©a
,

282 
ès_£À˘i⁄
);

284 } i‡(
tbl_ªv
 == 0 &&

285 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 =
ACPI_TYPE_INTEGER
) {

286 
íabÀd
 = !!
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

288 
ªt
 = -
EINVAL
;

289 
out_‰ì
;

292 i‡(!
íabÀd
) {

293 
	`IWL_DEBUG_RADIO
(
fwπ
, "TASÇotÉnabled\n");

294 
ªt
 = 0;

295 
out_‰ì
;

298 
	`IWL_DEBUG_RADIO
(
fwπ
, "Ródög TASÅabÀÑevisi⁄ %d\n", 
tbl_ªv
);

299 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[2].
ty≥
 !
ACPI_TYPE_INTEGER
 ||

300 
wifi_pkg
->
∑ckage
.
ñemíts
[2].
öãgî
.
vÆue
 >

301 
IWL_WTAS_BLACK_LIST_MAX
) {

302 
	`IWL_DEBUG_RADIO
(
fwπ
, "TAS invalidárray size %llu\n",

303 
wifi_pkg
->
∑ckage
.
ñemíts
[2].
öãgî
.
vÆue
);

304 
ªt
 = -
EINVAL
;

305 
out_‰ì
;

307 
block_li°_size
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[2].
öãgî
.
vÆue
;

308 
ès_d©a
->
block_li°_size
 = 
	`˝u_to_À32
(block_list_size);

310 
	`IWL_DEBUG_RADIO
(
fwπ
, "TASáºay sizê%u\n", 
block_li°_size
);

312 
i
 = 0; i < 
block_li°_size
; i++) {

313 
u32
 
cou¡ry
;

315 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[3 + 
i
].
ty≥
 !=

316 
ACPI_TYPE_INTEGER
) {

317 
	`IWL_DEBUG_RADIO
(
fwπ
,

318 "TAS invÆidáºayÉÀm %d\n", 3 + 
i
);

319 
ªt
 = -
EINVAL
;

320 
out_‰ì
;

323 
cou¡ry
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[3 + 
i
].
öãgî
.
vÆue
;

324 
ès_d©a
->
block_li°_¨øy
[
i
] = 
	`˝u_to_À32
(
cou¡ry
);

325 
	`IWL_DEBUG_RADIO
(
fwπ
, "TAS blockÜi° cou¡ry %d\n", 
cou¡ry
);

328 
ªt
 = 1;

329 
out_‰ì
:

330 
	`k‰ì
(
d©a
);

331  
ªt
;

332 
	}
}

334 
	$iwl_a˝i_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
)

336 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

337 
u32
 
mcc_vÆ
;

338 
ªt
, 
tbl_ªv
;

340 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_WRDD_METHOD
);

341 i‡(
	`IS_ERR
(
d©a
))

342  
	`PTR_ERR
(
d©a
);

344 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

345 
ACPI_WRDD_WIFI_DATA_SIZE
,

346 &
tbl_ªv
);

347 i‡(
	`IS_ERR
(
wifi_pkg
)) {

348 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

349 
out_‰ì
;

352 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 !
ACPI_TYPE_INTEGER
 ||

353 
tbl_ªv
 != 0) {

354 
ªt
 = -
EINVAL
;

355 
out_‰ì
;

358 
mcc_vÆ
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

360 
mcc
[0] = (
mcc_vÆ
 >> 8) & 0xff;

361 
mcc
[1] = 
mcc_vÆ
 & 0xff;

362 
mcc
[2] = '\0';

364 
ªt
 = 0;

365 
out_‰ì
:

366 
	`k‰ì
(
d©a
);

367  
ªt
;

368 
	}
}

370 
	$iwl_a˝i_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
, 
u64
 *
dÊt_pwr_limô
)

372 
a˝i_obje˘
 *
d©a
, *
wifi_pkg
;

373 
tbl_ªv
, 
ªt
 = -
EINVAL
;

375 *
dÊt_pwr_limô
 = 0;

376 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_SPLC_METHOD
);

377 i‡(
	`IS_ERR
(
d©a
))

378 
out
;

380 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

381 
ACPI_SPLC_WIFI_DATA_SIZE
, &
tbl_ªv
);

382 i‡(
	`IS_ERR
(
wifi_pkg
Ë|| 
tbl_ªv
 != 0 ||

383 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
 !
ACPI_TYPE_INTEGER
)

384 
out_‰ì
;

386 *
dÊt_pwr_limô
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

387 
ªt
 = 0;

388 
out_‰ì
:

389 
	`k‰ì
(
d©a
);

390 
out
:

391  
ªt
;

392 
	}
}

394 
	$iwl_a˝i_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
exé_˛k
)

396 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

397 
ªt
, 
tbl_ªv
;

399 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_ECKV_METHOD
);

400 i‡(
	`IS_ERR
(
d©a
))

401  
	`PTR_ERR
(
d©a
);

403 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

404 
ACPI_ECKV_WIFI_DATA_SIZE
,

405 &
tbl_ªv
);

406 i‡(
	`IS_ERR
(
wifi_pkg
)) {

407 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

408 
out_‰ì
;

411 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 !
ACPI_TYPE_INTEGER
 ||

412 
tbl_ªv
 != 0) {

413 
ªt
 = -
EINVAL
;

414 
out_‰ì
;

417 *
exé_˛k
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

419 
ªt
 = 0;

421 
out_‰ì
:

422 
	`k‰ì
(
d©a
);

423  
ªt
;

424 
	}
}

426 
	$iwl_a˝i_ßr_£t_¥ofûe
(
a˝i_obje˘
 *
èbÀ
,

427 
iwl_ßr_¥ofûe
 *
¥ofûe
,

428 
boﬁ
 
íabÀd
, 
u8
 
num_chaös
,

429 
u8
 
num_sub_b™ds
)

431 
i
, 
j
, 
idx
 = 0;

437 
i
 = 0; i < 
BIOS_SAR_MAX_CHAINS_PER_PROFILE
; i++) {

438 
j
 = 0; j < 
BIOS_SAR_MAX_SUB_BANDS_NUM
; j++) {

440 i‡(
i
 >
num_chaös
 || 
j
 >
num_sub_b™ds
) {

441 
¥ofûe
->
chaös
[
i
].
subb™ds
[
j
] = 0;

443 i‡(
èbÀ
[
idx
].
ty≥
 !
ACPI_TYPE_INTEGER
 ||

444 
èbÀ
[
idx
].
öãgî
.
vÆue
 > 
U8_MAX
)

445  -
EINVAL
;

447 
¥ofûe
->
chaös
[
i
].
subb™ds
[
j
] =

448 
èbÀ
[
idx
].
öãgî
.
vÆue
;

450 
idx
++;

456 
¥ofûe
->
íabÀd
 =Énabled;

459 
	}
}

461 
	$iwl_a˝i_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

463 
a˝i_obje˘
 *
wifi_pkg
, *
èbÀ
, *
d©a
;

464 
ªt
, 
tbl_ªv
;

465 
u32
 
Êags
;

466 
u8
 
num_chaös
, 
num_sub_b™ds
;

468 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_WRDS_METHOD
);

469 i‡(
	`IS_ERR
(
d©a
))

470  
	`PTR_ERR
(
d©a
);

473 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

474 
ACPI_WRDS_WIFI_DATA_SIZE_REV2
,

475 &
tbl_ªv
);

476 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

477 i‡(
tbl_ªv
 != 2) {

478 
ªt
 = -
EINVAL
;

479 
out_‰ì
;

482 
num_chaös
 = 
ACPI_SAR_NUM_CHAINS_REV2
;

483 
num_sub_b™ds
 = 
ACPI_SAR_NUM_SUB_BANDS_REV2
;

485 
ªad_èbÀ
;

489 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

490 
ACPI_WRDS_WIFI_DATA_SIZE_REV1
,

491 &
tbl_ªv
);

492 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

493 i‡(
tbl_ªv
 != 1) {

494 
ªt
 = -
EINVAL
;

495 
out_‰ì
;

498 
num_chaös
 = 
ACPI_SAR_NUM_CHAINS_REV1
;

499 
num_sub_b™ds
 = 
ACPI_SAR_NUM_SUB_BANDS_REV1
;

501 
ªad_èbÀ
;

505 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

506 
ACPI_WRDS_WIFI_DATA_SIZE_REV0
,

507 &
tbl_ªv
);

508 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

509 i‡(
tbl_ªv
 != 0) {

510 
ªt
 = -
EINVAL
;

511 
out_‰ì
;

514 
num_chaös
 = 
ACPI_SAR_NUM_CHAINS_REV0
;

515 
num_sub_b™ds
 = 
ACPI_SAR_NUM_SUB_BANDS_REV0
;

517 
ªad_èbÀ
;

520 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

521 
out_‰ì
;

523 
ªad_èbÀ
:

524 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 !
ACPI_TYPE_INTEGER
) {

525 
ªt
 = -
EINVAL
;

526 
out_‰ì
;

529 
	`IWL_DEBUG_RADIO
(
fwπ
, "Ródög WRDSÅbl_ªv=%d\n", 
tbl_ªv
);

531 
Êags
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

532 
fwπ
->
ªdu˚d_powî_Êags
 = 
Êags
 >> 
IWL_REDUCE_POWER_FLAGS_POS
;

535 
èbÀ
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[2];

540 
ªt
 = 
	`iwl_a˝i_ßr_£t_¥ofûe
(
èbÀ
, &
fwπ
->
ßr_¥ofûes
[0],

541 
Êags
 & 
IWL_SAR_ENABLE_MSK
,

542 
num_chaös
, 
num_sub_b™ds
);

543 
out_‰ì
:

544 
	`k‰ì
(
d©a
);

545  
ªt
;

546 
	}
}

548 
	$iwl_a˝i_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

550 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

551 
boﬁ
 
íabÀd
;

552 
i
, 
n_¥ofûes
, 
tbl_ªv
, 
pos
;

553 
ªt
 = 0;

554 
u8
 
num_chaös
, 
num_sub_b™ds
;

556 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_EWRD_METHOD
);

557 i‡(
	`IS_ERR
(
d©a
))

558  
	`PTR_ERR
(
d©a
);

561 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

562 
ACPI_EWRD_WIFI_DATA_SIZE_REV2
,

563 &
tbl_ªv
);

564 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

565 i‡(
tbl_ªv
 != 2) {

566 
ªt
 = -
EINVAL
;

567 
out_‰ì
;

570 
num_chaös
 = 
ACPI_SAR_NUM_CHAINS_REV2
;

571 
num_sub_b™ds
 = 
ACPI_SAR_NUM_SUB_BANDS_REV2
;

573 
ªad_èbÀ
;

577 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

578 
ACPI_EWRD_WIFI_DATA_SIZE_REV1
,

579 &
tbl_ªv
);

580 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

581 i‡(
tbl_ªv
 != 1) {

582 
ªt
 = -
EINVAL
;

583 
out_‰ì
;

586 
num_chaös
 = 
ACPI_SAR_NUM_CHAINS_REV1
;

587 
num_sub_b™ds
 = 
ACPI_SAR_NUM_SUB_BANDS_REV1
;

589 
ªad_èbÀ
;

593 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

594 
ACPI_EWRD_WIFI_DATA_SIZE_REV0
,

595 &
tbl_ªv
);

596 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

597 i‡(
tbl_ªv
 != 0) {

598 
ªt
 = -
EINVAL
;

599 
out_‰ì
;

602 
num_chaös
 = 
ACPI_SAR_NUM_CHAINS_REV0
;

603 
num_sub_b™ds
 = 
ACPI_SAR_NUM_SUB_BANDS_REV0
;

605 
ªad_èbÀ
;

608 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

609 
out_‰ì
;

611 
ªad_èbÀ
:

612 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 !
ACPI_TYPE_INTEGER
 ||

613 
wifi_pkg
->
∑ckage
.
ñemíts
[2].
ty≥
 !
ACPI_TYPE_INTEGER
) {

614 
ªt
 = -
EINVAL
;

615 
out_‰ì
;

618 
íabÀd
 = !!(
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
);

619 
n_¥ofûes
 = 
wifi_pkg
->
∑ckage
.
ñemíts
[2].
öãgî
.
vÆue
;

626 i‡(
n_¥ofûes
 >
BIOS_SAR_MAX_PROFILE_NUM
) {

627 
ªt
 = -
EINVAL
;

628 
out_‰ì
;

632 
pos
 = 3;

634 
i
 = 0; i < 
n_¥ofûes
; i++) {

635 
a˝i_obje˘
 *
èbÀ
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[
pos
];

640 
ªt
 = 
	`iwl_a˝i_ßr_£t_¥ofûe
(
èbÀ
,

641 &
fwπ
->
ßr_¥ofûes
[
i
 + 1],

642 
íabÀd
, 
num_chaös
,

643 
num_sub_b™ds
);

644 i‡(
ªt
 < 0)

648 
pos
 +
num_chaös
 * 
num_sub_b™ds
;

651 
out_‰ì
:

652 
	`k‰ì
(
d©a
);

653  
ªt
;

654 
	}
}

656 
	$iwl_a˝i_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

658 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

659 
i
, 
j
, 
k
, 
ªt
, 
tbl_ªv
;

660 
u8
 
num_b™ds
, 
num_¥ofûes
;

662 
u8
 
ªvisi⁄s
;

663 
u8
 
b™ds
;

664 
u8
 
¥ofûes
;

665 
u8
 
mö_¥ofûes
;

666 } 
ªv_d©a
[] = {

668 .
ªvisi⁄s
 = 
	`BIT
(3),

669 .
b™ds
 = 
ACPI_GEO_NUM_BANDS_REV2
,

670 .
¥ofûes
 = 
ACPI_NUM_GEO_PROFILES_REV3
,

671 .
mö_¥ofûes
 = 
BIOS_GEO_MIN_PROFILE_NUM
,

674 .
ªvisi⁄s
 = 
	`BIT
(2),

675 .
b™ds
 = 
ACPI_GEO_NUM_BANDS_REV2
,

676 .
¥ofûes
 = 
ACPI_NUM_GEO_PROFILES
,

679 .
ªvisi⁄s
 = 
	`BIT
(0) | BIT(1),

680 .
b™ds
 = 
ACPI_GEO_NUM_BANDS_REV0
,

681 .
¥ofûes
 = 
ACPI_NUM_GEO_PROFILES
,

684 
idx
;

686 
íåy_idx
 = 1;

688 
	`BUILD_BUG_ON
(
ACPI_NUM_GEO_PROFILES_REV3
 !
IWL_NUM_GEO_PROFILES_V3
);

689 
	`BUILD_BUG_ON
(
ACPI_NUM_GEO_PROFILES
 !
IWL_NUM_GEO_PROFILES
);

691 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_WGDS_METHOD
);

692 i‡(
	`IS_ERR
(
d©a
))

693  
	`PTR_ERR
(
d©a
);

696 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
ªv_d©a
); idx++) {

698 
u32
 
hdr_size
 = 1 + !!
ªv_d©a
[
idx
].
mö_¥ofûes
;

699 
u32
 
¥ofûe_size
 = 
ACPI_GEO_PER_CHAIN_SIZE
 *

700 
ªv_d©a
[
idx
].
b™ds
;

701 
u32
 
max_size
 = 
hdr_size
 + 
¥ofûe_size
 * 
ªv_d©a
[
idx
].
¥ofûes
;

702 
u32
 
mö_size
;

704 i‡(!
ªv_d©a
[
idx
].
mö_¥ofûes
)

705 
mö_size
 = 
max_size
;

707 
mö_size
 = 
hdr_size
 +

708 
¥ofûe_size
 * 
ªv_d©a
[
idx
].
mö_¥ofûes
;

710 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg_ønge
(
fwπ
->
dev
, 
d©a
,

711 
mö_size
, 
max_size
,

712 &
tbl_ªv
);

713 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

714 i‡(!(
	`BIT
(
tbl_ªv
Ë& 
ªv_d©a
[
idx
].
ªvisi⁄s
))

717 
num_b™ds
 = 
ªv_d©a
[
idx
].
b™ds
;

718 
num_¥ofûes
 = 
ªv_d©a
[
idx
].
¥ofûes
;

720 i‡(
ªv_d©a
[
idx
].
mö_¥ofûes
) {

722 
a˝i_obje˘
 *
íåy
;

724 
íåy
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[
íåy_idx
];

725 
íåy_idx
++;

726 i‡(
íåy
->
ty≥
 !
ACPI_TYPE_INTEGER
 ||

727 
íåy
->
öãgî
.
vÆue
 > 
num_¥ofûes
) {

728 
ªt
 = -
EINVAL
;

729 
out_‰ì
;

731 
num_¥ofûes
 = 
íåy
->
öãgî
.
vÆue
;

738 i‡(
wifi_pkg
->
∑ckage
.
cou¡
 !=

739 
hdr_size
 + 
¥ofûe_size
 * 
num_¥ofûes
) {

740 
ªt
 = -
EINVAL
;

741 
out_‰ì
;

744 
ªad_èbÀ
;

748 i‡(
idx
 < 
	`ARRAY_SIZE
(
ªv_d©a
))

749 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

751 
ªt
 = -
ENOENT
;

752 
out_‰ì
;

754 
ªad_èbÀ
:

755 
fwπ
->
geo_ªv
 = 
tbl_ªv
;

756 
i
 = 0; i < 
num_¥ofûes
; i++) {

757 
j
 = 0; j < 
BIOS_GEO_MAX_NUM_BANDS
; j++) {

758 
a˝i_obje˘
 *
íåy
;

765 i‡(
j
 >
num_b™ds
) {

766 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
max
 =

767 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[1].
max
;

769 
íåy
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[
íåy_idx
];

770 
íåy_idx
++;

771 i‡(
íåy
->
ty≥
 !
ACPI_TYPE_INTEGER
 ||

772 
íåy
->
öãgî
.
vÆue
 > 
U8_MAX
) {

773 
ªt
 = -
EINVAL
;

774 
out_‰ì
;

777 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
max
 =

778 
íåy
->
öãgî
.
vÆue
;

781 
k
 = 0; k < 
BIOS_GEO_NUM_CHAINS
; k++) {

783 i‡(
j
 >
num_b™ds
) {

784 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
chaös
[
k
] =

785 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[1].
chaös
[
k
];

787 
íåy
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[
íåy_idx
];

788 
íåy_idx
++;

789 i‡(
íåy
->
ty≥
 !
ACPI_TYPE_INTEGER
 ||

790 
íåy
->
öãgî
.
vÆue
 > 
U8_MAX
) {

791 
ªt
 = -
EINVAL
;

792 
out_‰ì
;

795 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
chaös
[
k
] =

796 
íåy
->
öãgî
.
vÆue
;

802 
fwπ
->
geo_num_¥ofûes
 = 
num_¥ofûes
;

803 
fwπ
->
geo_íabÀd
 = 
åue
;

804 
ªt
 = 0;

805 
out_‰ì
:

806 
	`k‰ì
(
d©a
);

807  
ªt
;

808 
	}
}

810 
	$iwl_a˝i_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

812 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
, *
Êags
;

813 
i
, 
j
, 
ªt
, 
tbl_ªv
, 
num_sub_b™ds
 = 0;

814 
idx
 = 2;

816 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_PPAG_METHOD
);

817 i‡(
	`IS_ERR
(
d©a
))

818  
	`PTR_ERR
(
d©a
);

821 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

822 
ACPI_PPAG_WIFI_DATA_SIZE_V2
, &
tbl_ªv
);

824 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

825 i‡(
tbl_ªv
 >= 1 &&Åbl_rev <= 3) {

826 
num_sub_b™ds
 = 
IWL_NUM_SUB_BANDS_V2
;

827 
	`IWL_DEBUG_RADIO
(
fwπ
,

829 
tbl_ªv
);

830 
ªad_èbÀ
;

832 
ªt
 = -
EINVAL
;

833 
out_‰ì
;

838 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

839 
ACPI_PPAG_WIFI_DATA_SIZE_V1
, &
tbl_ªv
);

841 i‡(!
	`IS_ERR
(
wifi_pkg
)) {

842 i‡(
tbl_ªv
 != 0) {

843 
ªt
 = -
EINVAL
;

844 
out_‰ì
;

846 
num_sub_b™ds
 = 
IWL_NUM_SUB_BANDS_V1
;

847 
	`IWL_DEBUG_RADIO
(
fwπ
, "Reading PPAGÅable v1 (tbl_rev=0)\n");

848 
ªad_èbÀ
;

851 
ªt
 = 
	`PTR_ERR
(
wifi_pkg
);

852 
out_‰ì
;

854 
ªad_èbÀ
:

855 
fwπ
->
µag_vî
 = 
tbl_ªv
;

856 
Êags
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[1];

858 i‡(
Êags
->
ty≥
 !
ACPI_TYPE_INTEGER
) {

859 
ªt
 = -
EINVAL
;

860 
out_‰ì
;

863 
fwπ
->
µag_Êags
 = 
	`iwl_bios_gë_µag_Êags
(
Êags
->
öãgî
.
vÆue
,

864 
fwπ
->
µag_vî
);

871 
i
 = 0; i < 
IWL_NUM_CHAIN_LIMITS
; i++) {

872 
j
 = 0; j < 
num_sub_b™ds
; j++) {

873 
a˝i_obje˘
 *
ít
;

875 
ít
 = &
wifi_pkg
->
∑ckage
.
ñemíts
[
idx
++];

876 i‡(
ít
->
ty≥
 !
ACPI_TYPE_INTEGER
) {

877 
ªt
 = -
EINVAL
;

878 
out_‰ì
;

881 
fwπ
->
µag_chaös
[
i
].
subb™ds
[
j
] = 
ít
->
öãgî
.
vÆue
;

885 
ªt
 = 0;

887 
out_‰ì
:

888 
	`k‰ì
(
d©a
);

889  
ªt
;

890 
	}
}

892 
	$iwl_a˝i_gë_phy_fûãrs
(
iwl_fw_ru¡ime
 *
fwπ
,

893 
iwl_phy_•ecific_cfg
 *
fûãrs
)

895 
iwl_phy_•ecific_cfg
 
tmp
 = {};

896 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

897 
tbl_ªv
, 
i
;

899 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_WPFC_METHOD
);

900 i‡(
	`IS_ERR
(
d©a
))

903 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

904 
ACPI_WPFC_WIFI_DATA_SIZE
,

905 &
tbl_ªv
);

906 i‡(
	`IS_ERR
(
wifi_pkg
))

907 
out_‰ì
;

909 i‡(
tbl_ªv
 != 0)

910 
out_‰ì
;

912 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
fûãrs
->
fûãr_cfg_chaös
) !=

913 
ACPI_WPFC_WIFI_DATA_SIZE
 - 1);

915 
i
 = 0; i < 
	`ARRAY_SIZE
(
fûãrs
->
fûãr_cfg_chaös
); i++) {

916 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[
i
 + 1].
ty≥
 !
ACPI_TYPE_INTEGER
)

917 
out_‰ì
;

918 
tmp
.
fûãr_cfg_chaös
[
i
] =

919 
	`˝u_to_À32
(
wifi_pkg
->
∑ckage
.
ñemíts
[
i
 + 1].
öãgî
.
vÆue
);

922 
	`IWL_DEBUG_RADIO
(
fwπ
, "Loaded WPFC filter config from ACPI\n");

923 *
fûãrs
 = 
tmp
;

924 
out_‰ì
:

925 
	`k‰ì
(
d©a
);

926 
	}
}

927 
IWL_EXPORT_SYMBOL
(
iwl_a˝i_gë_phy_fûãrs
);

929 
	$iwl_a˝i_gë_guid_lock_°©us
(
iwl_fw_ru¡ime
 *
fwπ
)

931 
a˝i_obje˘
 *
wifi_pkg
, *
d©a
;

932 
tbl_ªv
;

934 
d©a
 = 
	`iwl_a˝i_gë_obje˘
(
fwπ
->
dev
, 
ACPI_GLAI_METHOD
);

935 i‡(
	`IS_ERR
(
d©a
))

938 
wifi_pkg
 = 
	`iwl_a˝i_gë_wifi_pkg
(
fwπ
->
dev
, 
d©a
,

939 
ACPI_GLAI_WIFI_DATA_SIZE
,

940 &
tbl_ªv
);

941 i‡(
	`IS_ERR
(
wifi_pkg
))

942 
out_‰ì
;

944 i‡(
tbl_ªv
 != 0) {

945 
	`IWL_DEBUG_RADIO
(
fwπ
, "InvÆid GLAIÑevisi⁄: %d\n", 
tbl_ªv
);

946 
out_‰ì
;

949 i‡(
wifi_pkg
->
∑ckage
.
ñemíts
[1].
ty≥
 !
ACPI_TYPE_INTEGER
 ||

950 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
 > 
ACPI_GLAI_MAX_STATUS
)

951 
out_‰ì
;

953 
fwπ
->
uefi_èbÀs_lock_°©us
 =

954 
wifi_pkg
->
∑ckage
.
ñemíts
[1].
öãgî
.
vÆue
;

956 
	`IWL_DEBUG_RADIO
(
fwπ
,

958 
fwπ
->
uefi_èbÀs_lock_°©us
);

959 
out_‰ì
:

960 
	`k‰ì
(
d©a
);

961 
	}
}

962 
IWL_EXPORT_SYMBOL
(
iwl_a˝i_gë_guid_lock_°©us
);

	@fw/acpi.h

6 #i‚de‡
__iwl_fw_a˝i__


7 
	#__iwl_fw_a˝i__


	)

9 
	~<löux/a˝i.h
>

10 
	~"fw/ªguœt‹y.h
"

11 
	~"fw/≠i/comm™ds.h
"

12 
	~"fw/≠i/powî.h
"

13 
	~"fw/≠i/phy.h
"

14 
	~"fw/≠i/nvm-ªg.h
"

15 
	~"fw/≠i/c⁄fig.h
"

16 
	~"fw/img.h
"

17 
	~"iwl-å™s.h
"

20 
	#ACPI_WRDS_METHOD
 "WRDS"

	)

21 
	#ACPI_EWRD_METHOD
 "EWRD"

	)

22 
	#ACPI_WGDS_METHOD
 "WGDS"

	)

23 
	#ACPI_WRDD_METHOD
 "WRDD"

	)

24 
	#ACPI_SPLC_METHOD
 "SPLC"

	)

25 
	#ACPI_ECKV_METHOD
 "ECKV"

	)

26 
	#ACPI_PPAG_METHOD
 "PPAG"

	)

27 
	#ACPI_WTAS_METHOD
 "WTAS"

	)

28 
	#ACPI_WPFC_METHOD
 "WPFC"

	)

29 
	#ACPI_GLAI_METHOD
 "GLAI"

	)

31 
	#ACPI_WIFI_DOMAIN
 (0x07)

	)

33 
	#ACPI_SAR_PROFILE_NUM
 4

	)

35 
	#ACPI_NUM_GEO_PROFILES
 3

	)

36 
	#ACPI_NUM_GEO_PROFILES_REV3
 8

	)

37 
	#ACPI_GEO_PER_CHAIN_SIZE
 3

	)

39 
	#ACPI_SAR_NUM_CHAINS_REV0
 2

	)

40 
	#ACPI_SAR_NUM_CHAINS_REV1
 2

	)

41 
	#ACPI_SAR_NUM_CHAINS_REV2
 4

	)

42 
	#ACPI_SAR_NUM_SUB_BANDS_REV0
 5

	)

43 
	#ACPI_SAR_NUM_SUB_BANDS_REV1
 11

	)

44 
	#ACPI_SAR_NUM_SUB_BANDS_REV2
 11

	)

46 
	#ACPI_WRDS_WIFI_DATA_SIZE_REV0
 (
ACPI_SAR_NUM_CHAINS_REV0
 * \

47 
ACPI_SAR_NUM_SUB_BANDS_REV0
 + 2)

	)

48 
	#ACPI_WRDS_WIFI_DATA_SIZE_REV1
 (
ACPI_SAR_NUM_CHAINS_REV1
 * \

49 
ACPI_SAR_NUM_SUB_BANDS_REV1
 + 2)

	)

50 
	#ACPI_WRDS_WIFI_DATA_SIZE_REV2
 (
ACPI_SAR_NUM_CHAINS_REV2
 * \

51 
ACPI_SAR_NUM_SUB_BANDS_REV2
 + 2)

	)

52 
	#ACPI_EWRD_WIFI_DATA_SIZE_REV0
 ((
ACPI_SAR_PROFILE_NUM
 - 1) * \

53 
ACPI_SAR_NUM_CHAINS_REV0
 * \

54 
ACPI_SAR_NUM_SUB_BANDS_REV0
 + 3)

	)

55 
	#ACPI_EWRD_WIFI_DATA_SIZE_REV1
 ((
ACPI_SAR_PROFILE_NUM
 - 1) * \

56 
ACPI_SAR_NUM_CHAINS_REV1
 * \

57 
ACPI_SAR_NUM_SUB_BANDS_REV1
 + 3)

	)

58 
	#ACPI_EWRD_WIFI_DATA_SIZE_REV2
 ((
ACPI_SAR_PROFILE_NUM
 - 1) * \

59 
ACPI_SAR_NUM_CHAINS_REV2
 * \

60 
ACPI_SAR_NUM_SUB_BANDS_REV2
 + 3)

	)

61 
	#ACPI_WPFC_WIFI_DATA_SIZE
 5

	)

64 
	#ACPI_GEO_NUM_BANDS_REV0
 2

	)

65 
	#ACPI_GEO_NUM_BANDS_REV2
 3

	)

67 
	#ACPI_WRDD_WIFI_DATA_SIZE
 2

	)

68 
	#ACPI_SPLC_WIFI_DATA_SIZE
 2

	)

69 
	#ACPI_ECKV_WIFI_DATA_SIZE
 2

	)

74 
	#ACPI_GLAI_WIFI_DATA_SIZE
 2

	)

75 
	#ACPI_GLAI_MAX_STATUS
 2

	)

82 
	#ACPI_WTAS_WIFI_DATA_SIZE
 (3 + 
IWL_WTAS_BLACK_LIST_MAX
)

	)

84 
	#ACPI_PPAG_WIFI_DATA_SIZE_V1
 ((
IWL_NUM_CHAIN_LIMITS
 * \

85 
IWL_NUM_SUB_BANDS_V1
Ë+ 2)

	)

86 
	#ACPI_PPAG_WIFI_DATA_SIZE_V2
 ((
IWL_NUM_CHAIN_LIMITS
 * \

87 
IWL_NUM_SUB_BANDS_V2
Ë+ 2)

	)

89 
	#IWL_SAR_ENABLE_MSK
 
	`BIT
(0)

	)

90 
	#IWL_REDUCE_POWER_FLAGS_POS
 1

	)

93 
	#UEFI_WIFI_GUID_UNLOCKED
 0

	)

95 
	#ACPI_DSM_REV
 0

	)

97 #ifde‡
CONFIG_ACPI


99 
	giwl_fw_ru¡ime
;

101 c⁄° 
guid_t
 
iwl_guid
;

111 
iwl_a˝i_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
);

113 
iwl_a˝i_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
, 
u64
 *
dÊt_pwr_limô
);

124 
iwl_a˝i_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
exé_˛k
);

126 
iwl_a˝i_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

128 
iwl_a˝i_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

130 
iwl_a˝i_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

132 
iwl_a˝i_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

133 
iwl_ès_d©a
 *
d©a
);

135 
iwl_a˝i_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

137 
iwl_a˝i_gë_phy_fûãrs
(
iwl_fw_ru¡ime
 *
fwπ
,

138 
iwl_phy_•ecific_cfg
 *
fûãrs
);

140 
iwl_a˝i_gë_guid_lock_°©us
(
iwl_fw_ru¡ime
 *
fwπ
);

142 
iwl_a˝i_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
,

143 
iwl_dsm_funcs
 
func
, 
u32
 *
vÆue
);

147 
ölöe
 *
	$iwl_a˝i_gë_dsm_obje˘
(
devi˚
 *
dev
, 
ªv
,

148 
func
, 
a˝i_obje˘
 *
¨gs
)

150  
	`ERR_PTR
(-
ENOENT
);

151 
	}
}

153 
ölöe
 
	$iwl_a˝i_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
)

155  -
ENOENT
;

156 
	}
}

158 
ölöe
 
	$iwl_a˝i_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
,

159 
u64
 *
dÊt_pwr_limô
)

161 *
dÊt_pwr_limô
 = 0;

163 
	}
}

165 
ölöe
 
	$iwl_a˝i_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
exé_˛k
)

167  -
ENOENT
;

168 
	}
}

170 
ölöe
 
	$iwl_a˝i_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

172  -
ENOENT
;

173 
	}
}

175 
ölöe
 
	$iwl_a˝i_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

177  -
ENOENT
;

178 
	}
}

180 
ölöe
 
	$iwl_a˝i_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

183 
	}
}

185 
ölöe
 
	$iwl_a˝i_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

186 
iwl_ès_d©a
 *
d©a
)

188  -
ENOENT
;

189 
	}
}

191 
ölöe
 
	$iwl_a˝i_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

193  -
ENOENT
;

194 
	}
}

197 
	#iwl_a˝i_gë_phy_fûãrs
(
fwπ
, 
fûãrs
Ëdÿ{ } 0)

	)

199 
ölöe
 
	$iwl_a˝i_gë_guid_lock_°©us
(
iwl_fw_ru¡ime
 *
fwπ
)

201 
	}
}

203 
ölöe
 
	$iwl_a˝i_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
,

204 
iwl_dsm_funcs
 
func
, 
u32
 *
vÆue
)

206  -
ENOENT
;

207 
	}
}

	@fw/api/alive.h

7 #i‚de‡
__iwl_fw_≠i_Æive_h__


8 
	#__iwl_fw_≠i_Æive_h__


	)

11 
	#ALIVE_RESP_UCODE_OK
 
	`BIT
(0)

	)

12 
	#ALIVE_RESP_RFKILL
 
	`BIT
(1)

	)

16 
	mFW_TYPE_HW
 = 0,

17 
	mFW_TYPE_PROT
 = 1,

18 
	mFW_TYPE_AP
 = 2,

19 
	mFW_TYPE_WOWLAN
 = 3,

20 
	mFW_TYPE_TIMING
 = 4,

21 
	mFW_TYPE_WIPAN
 = 5

26 
	mFW_SUBTYPE_FULL_FEATURE
 = 0,

27 
	mFW_SUBTYPE_BOOTSRAP
 = 1,

28 
	mFW_SUBTYPE_REDUCED
 = 2,

29 
	mFW_SUBTYPE_ALIVE_ONLY
 = 3,

30 
	mFW_SUBTYPE_WOWLAN
 = 4,

31 
	mFW_SUBTYPE_AP_SUBTYPE
 = 5,

32 
	mFW_SUBTYPE_WIPAN
 = 6,

33 
	mFW_SUBTYPE_INITIALIZE
 = 9

36 
	#IWL_ALIVE_STATUS_ERR
 0xDEAD

	)

37 
	#IWL_ALIVE_STATUS_OK
 0xCAFE

	)

39 
	#IWL_ALIVE_FLG_RFKILL
 
	`BIT
(0)

	)

41 
	siwl_lmac_debug_addrs
 {

42 
__À32
 
	mîr‹_evít_èbÀ_±r
;

43 
__À32
 
	mlog_evít_èbÀ_±r
;

44 
__À32
 
	m˝u_ªgi°î_±r
;

45 
__À32
 
	mdbgm_c⁄fig_±r
;

46 
__À32
 
	mÆive_cou¡î_±r
;

47 
__À32
 
	mscd_ba£_±r
;

48 
__À32
 
	m°_fwrd_addr
;

49 
__À32
 
	m°_fwrd_size
;

50 } 
	g__∑cked
;

52 
	siwl_lmac_Æive
 {

53 
__À32
 
	mucode_maj‹
;

54 
__À32
 
	mucode_mö‹
;

55 
u8
 
	mvî_subty≥
;

56 
u8
 
	mvî_ty≥
;

57 
u8
 
	mmac
;

58 
u8
 
	m›t
;

59 
__À32
 
	mtime°amp
;

60 
iwl_lmac_debug_addrs
 
	mdbg_±rs
;

61 } 
	g__∑cked
;

63 
	siwl_umac_debug_addrs
 {

64 
__À32
 
	mîr‹_öfo_addr
;

65 
__À32
 
	mdbg_¥öt_buff_addr
;

66 } 
	g__∑cked
;

68 
	siwl_umac_Æive
 {

69 
__À32
 
	mumac_maj‹
;

70 
__À32
 
	mumac_mö‹
;

71 
iwl_umac_debug_addrs
 
	mdbg_±rs
;

72 } 
	g__∑cked
;

74 
	siwl_sku_id
 {

75 
__À32
 
	md©a
[3];

76 } 
	g__∑cked
;

78 
	siwl_Æive_¡f_v3
 {

79 
__À16
 
	m°©us
;

80 
__À16
 
	mÊags
;

81 
iwl_lmac_Æive
 
	mlmac_d©a
;

82 
iwl_umac_Æive
 
	mumac_d©a
;

83 } 
	g__∑cked
;

85 
	siwl_Æive_¡f_v4
 {

86 
__À16
 
	m°©us
;

87 
__À16
 
	mÊags
;

88 
iwl_lmac_Æive
 
	mlmac_d©a
[2];

89 
iwl_umac_Æive
 
	mumac_d©a
;

90 } 
	g__∑cked
;

92 
	siwl_Æive_¡f_v5
 {

93 
__À16
 
	m°©us
;

94 
__À16
 
	mÊags
;

95 
iwl_lmac_Æive
 
	mlmac_d©a
[2];

96 
iwl_umac_Æive
 
	mumac_d©a
;

97 
iwl_sku_id
 
	msku_id
;

98 } 
	g__∑cked
;

100 
	siwl_imr_Æive_öfo
 {

101 
__À64
 
	mba£_addr
;

102 
__À32
 
	msize
;

103 
__À32
 
	míabÀd
;

104 } 
	g__∑cked
;

106 
	siwl_Æive_¡f_v6
 {

107 
__À16
 
	m°©us
;

108 
__À16
 
	mÊags
;

109 
iwl_lmac_Æive
 
	mlmac_d©a
[2];

110 
iwl_umac_Æive
 
	mumac_d©a
;

111 
iwl_sku_id
 
	msku_id
;

112 
iwl_imr_Æive_öfo
 
	mimr
;

113 } 
	g__∑cked
;

122 
	eiwl_exãnded_cfg_Êags
 {

123 
	mIWL_INIT_DEBUG_CFG
,

124 
	mIWL_INIT_NVM
,

125 
	mIWL_INIT_PHY
,

133 
	siwl_öô_exãnded_cfg_cmd
 {

134 
__À32
 
	möô_Êags
;

135 } 
	g__∑cked
;

144 
	siwl_ødio_vîsi⁄_nŸif
 {

145 
__À32
 
	mødio_Êav‹
;

146 
__À32
 
	mødio_°ï
;

147 
__À32
 
	mødio_dash
;

148 } 
	g__∑cked
;

150 
	eiwl_ˇrd_°©e_Êags
 {

151 
	mCARD_ENABLED
 = 0x00,

152 
	mHW_CARD_DISABLED
 = 0x01,

153 
	mSW_CARD_DISABLED
 = 0x02,

154 
	mCT_KILL_CARD_DISABLED
 = 0x04,

155 
	mHALT_CARD_DISABLED
 = 0x08,

156 
	mCARD_DISABLED_MSK
 = 0x0f,

157 
	mCARD_IS_RX_ON
 = 0x10,

165 
	eiwl_îr‹_ªcovîy_Êags
 {

166 
	mERROR_RECOVERY_UPDATE_DB
 = 
BIT
(0),

167 
	mERROR_RECOVERY_END_OF_RECOVERY
 = 
BIT
(1),

175 
	siwl_fw_îr‹_ªcovîy_cmd
 {

176 
__À32
 
	mÊags
;

177 
__À32
 
	mbuf_size
;

178 } 
	g__∑cked
;

	@fw/api/binding.h

7 #i‚de‡
__iwl_fw_≠i_bödög_h__


8 
	#__iwl_fw_≠i_bödög_h__


	)

10 
	~<fw/fûe.h
>

11 
	~<fw/img.h
>

13 
	#MAX_MACS_IN_BINDING
 (3)

	)

14 
	#MAX_BINDINGS
 (4)

	)

27 
	siwl_bödög_cmd_v1
 {

29 
__À32
 
	mid_™d_cﬁ‹
;

30 
__À32
 
	ma˘i⁄
;

32 
__À32
 
	mmacs
[
MAX_MACS_IN_BINDING
];

33 
__À32
 
	mphy
;

34 } 
	g__∑cked
;

48 
	siwl_bödög_cmd
 {

50 
__À32
 
	mid_™d_cﬁ‹
;

51 
__À32
 
	ma˘i⁄
;

53 
__À32
 
	mmacs
[
MAX_MACS_IN_BINDING
];

54 
__À32
 
	mphy
;

55 
__À32
 
	mlmac_id
;

56 } 
	g__∑cked
;

58 
	#IWL_BINDING_CMD_SIZE_V1
 (
iwl_bödög_cmd_v1
)

	)

59 
	#IWL_LMAC_24G_INDEX
 0

	)

60 
	#IWL_LMAC_5G_INDEX
 1

	)

63 
	#IWL_MVM_MAX_QUOTA
 128

	)

73 
	siwl_time_quŸa_d©a_v1
 {

74 
__À32
 
	mid_™d_cﬁ‹
;

75 
__À32
 
	mquŸa
;

76 
__À32
 
	mmax_duøti⁄
;

77 } 
	g__∑cked
;

87 
	siwl_time_quŸa_cmd_v1
 {

88 
iwl_time_quŸa_d©a_v1
 
	mquŸas
[
MAX_BINDINGS
];

89 } 
	g__∑cked
;

91 
	eiwl_quŸa_low_œãncy
 {

92 
	mIWL_QUOTA_LOW_LATENCY_NONE
 = 0,

93 
	mIWL_QUOTA_LOW_LATENCY_TX
 = 
BIT
(0),

94 
	mIWL_QUOTA_LOW_LATENCY_RX
 = 
BIT
(1),

95 
	mIWL_QUOTA_LOW_LATENCY_TX_RX
 =

96 
IWL_QUOTA_LOW_LATENCY_TX
 | 
IWL_QUOTA_LOW_LATENCY_RX
,

107 
	siwl_time_quŸa_d©a
 {

108 
__À32
 
	mid_™d_cﬁ‹
;

109 
__À32
 
	mquŸa
;

110 
__À32
 
	mmax_duøti⁄
;

111 
__À32
 
	mlow_œãncy
;

112 } 
	g__∑cked
;

122 
	siwl_time_quŸa_cmd
 {

123 
iwl_time_quŸa_d©a
 
	mquŸas
[
MAX_BINDINGS
];

124 } 
	g__∑cked
;

	@fw/api/cmdhdr.h

7 #i‚de‡
__iwl_fw_≠i_cmdhdr_h__


8 
	#__iwl_fw_≠i_cmdhdr_h__


	)

18 
	#SEQ_TO_QUEUE
(
s
Ë(((sË>> 8Ë& 0x1f)

	)

19 
	#QUEUE_TO_SEQ
(
q
Ë(((qË& 0x1fË<< 8)

	)

20 
	#SEQ_TO_INDEX
(
s
Ë((sË& 0xff)

	)

21 
	#INDEX_TO_SEQ
(
i
Ë((iË& 0xff)

	)

22 
	#SEQ_RX_FRAME
 
	`˝u_to_À16
(0x8000)

	)

30 
ölöe
 
u8
 
	$iwl_cmd_›code
(
u32
 
cmdid
)

32  
cmdid
 & 0xFF;

33 
	}
}

35 
ölöe
 
u8
 
	$iwl_cmd_groupid
(
u32
 
cmdid
)

37  ((
cmdid
 & 0xFF00) >> 8);

38 
	}
}

40 
ölöe
 
u8
 
	$iwl_cmd_vîsi⁄
(
u32
 
cmdid
)

42  ((
cmdid
 & 0xFF0000) >> 16);

43 
	}
}

45 
ölöe
 
u32
 
	$iwl_cmd_id
(
u8
 
›code
, u8 
groupid
, u8 
vîsi⁄
)

47  
›code
 + (
groupid
 << 8Ë+ (
vîsi⁄
 << 16);

48 
	}
}

51 
	#WIDE_ID
(
gΩ
, 
›code
Ë(((gΩË<< 8Ë| (›code))

	)

52 
	#DEF_ID
(
›code
Ë((1 << 8Ë| (›code))

	)

57 
	#IWL_ALWAYS_LONG_GROUP
 1

	)

65 
	siwl_cmd_hódî
 {

69 
u8
 
	mcmd
;

73 
u8
 
	mgroup_id
;

97 
__À16
 
	m£quí˚
;

98 } 
	g__∑cked
;

115 
	siwl_cmd_hódî_wide
 {

116 
u8
 
	mcmd
;

117 
u8
 
	mgroup_id
;

118 
__À16
 
	m£quí˚
;

119 
__À16
 
	mÀngth
;

120 
u8
 
	mª£rved
;

121 
u8
 
	mvîsi⁄
;

122 } 
	g__∑cked
;

130 
	siwl_ˇlib_ªs_nŸif_phy_db
 {

131 
__À16
 
	mty≥
;

132 
__À16
 
	mÀngth
;

133 
u8
 
	md©a
[];

134 } 
	g__∑cked
;

142 
	siwl_phy_db_cmd
 {

143 
__À16
 
	mty≥
;

144 
__À16
 
	mÀngth
;

145 
u8
 
	md©a
[];

146 } 
	g__∑cked
;

152 
	siwl_cmd_ª•⁄£
 {

153 
__À32
 
	m°©us
;

	@fw/api/coex.h

8 #i‚de‡
__iwl_fw_≠i_c€x_h__


9 
	#__iwl_fw_≠i_c€x_h__


	)

11 
	~<löux/ty≥s.h
>

12 
	~<löux/bô›s.h
>

14 
	#BITS
(
nb
Ë(
	`BIT
“bË- 1)

	)

16 
	eiwl_bt_c€x_lut_ty≥
 {

17 
	mBT_COEX_TIGHT_LUT
 = 0,

18 
	mBT_COEX_LOOSE_LUT
,

19 
	mBT_COEX_TX_DIS_LUT
,

21 
	mBT_COEX_MAX_LUT
,

22 
	mBT_COEX_INVALID_LUT
 = 0xff,

25 
	#BT_REDUCED_TX_POWER_BIT
 
	`BIT
(7)

	)

27 
	eiwl_bt_c€x_mode
 {

28 
	mBT_COEX_DISABLE
 = 0x0,

29 
	mBT_COEX_NW
 = 0x1,

30 
	mBT_COEX_BT
 = 0x2,

31 
	mBT_COEX_WIFI
 = 0x3,

34 
	eiwl_bt_c€x_íabÀd_moduÀs
 {

35 
	mBT_COEX_MPLUT_ENABLED
 = 
BIT
(0),

36 
	mBT_COEX_MPLUT_BOOST_ENABLED
 = 
BIT
(1),

37 
	mBT_COEX_SYNC2SCO_ENABLED
 = 
BIT
(2),

38 
	mBT_COEX_CORUN_ENABLED
 = 
BIT
(3),

39 
	mBT_COEX_HIGH_BAND_RET
 = 
BIT
(4),

49 
	siwl_bt_c€x_cmd
 {

50 
__À32
 
	mmode
;

51 
__À32
 
	míabÀd_moduÀs
;

52 } 
	g__∑cked
;

59 
	siwl_bt_c€x_ªdu˚d_txp_upd©e_cmd
 {

60 
__À32
 
	mªdu˚d_txp
;

61 } 
	g__∑cked
;

72 
	siwl_bt_c€x_ci_cmd
 {

73 
__À64
 
	mbt_¥im¨y_ci
;

74 
__À32
 
	m¥im¨y_ch_phy_id
;

76 
__À64
 
	mbt_£c⁄d¨y_ci
;

77 
__À32
 
	m£c⁄d¨y_ch_phy_id
;

78 } 
	g__∑cked
;

80 
	#BT_MBOX
(
n_dw
, 
_msg
, 
_pos
, 
_nbôs
) \

81 
BT_MBOX
##
n_dw
##
_
##
_msg
##
_POS
 = (
_pos
), \

82 
BT_MBOX
##
n_dw
##
_
##
_msg
 = 
	`BITS
(
_nbôs
Ë<< BT_MBOX##n_dw##_##_msg##
_POS


	)

84 
	eiwl_bt_mxbox_dw0
 {

85 
BT_MBOX
(0, 
LE_SLAVE_LAT
, 0, 3),

86 
BT_MBOX
(0, 
LE_PROF1
, 3, 1),

87 
BT_MBOX
(0, 
LE_PROF2
, 4, 1),

88 
BT_MBOX
(0, 
LE_PROF_OTHER
, 5, 1),

89 
BT_MBOX
(0, 
CHL_SEQ_N
, 8, 4),

90 
BT_MBOX
(0, 
INBAND_S
, 13, 1),

91 
BT_MBOX
(0, 
LE_MIN_RSSI
, 16, 4),

92 
BT_MBOX
(0, 
LE_SCAN
, 20, 1),

93 
BT_MBOX
(0, 
LE_ADV
, 21, 1),

94 
BT_MBOX
(0, 
LE_MAX_TX_POWER
, 24, 4),

95 
BT_MBOX
(0, 
OPEN_CON_1
, 28, 2),

98 
	eiwl_bt_mxbox_dw1
 {

99 
BT_MBOX
(1, 
BR_MAX_TX_POWER
, 0, 4),

100 
BT_MBOX
(1, 
IP_SR
, 4, 1),

101 
BT_MBOX
(1, 
LE_MSTR
, 5, 1),

102 
BT_MBOX
(1, 
AGGR_TRFC_LD
, 8, 6),

103 
BT_MBOX
(1, 
MSG_TYPE
, 16, 3),

104 
BT_MBOX
(1, 
SSN
, 19, 2),

107 
	eiwl_bt_mxbox_dw2
 {

108 
BT_MBOX
(2, 
SNIFF_ACT
, 0, 3),

109 
BT_MBOX
(2, 
PAG
, 3, 1),

110 
BT_MBOX
(2, 
INQUIRY
, 4, 1),

111 
BT_MBOX
(2, 
CONN
, 5, 1),

112 
BT_MBOX
(2, 
SNIFF_INTERVAL
, 8, 5),

113 
BT_MBOX
(2, 
DISC
, 13, 1),

114 
BT_MBOX
(2, 
SCO_TX_ACT
, 16, 2),

115 
BT_MBOX
(2, 
SCO_RX_ACT
, 18, 2),

116 
BT_MBOX
(2, 
ESCO_RE_TX
, 20, 2),

117 
BT_MBOX
(2, 
SCO_DURATION
, 24, 6),

120 
	eiwl_bt_mxbox_dw3
 {

121 
BT_MBOX
(3, 
SCO_STATE
, 0, 1),

122 
BT_MBOX
(3, 
SNIFF_STATE
, 1, 1),

123 
BT_MBOX
(3, 
A2DP_STATE
, 2, 1),

124 
BT_MBOX
(3, 
ACL_STATE
, 3, 1),

125 
BT_MBOX
(3, 
MSTR_STATE
, 4, 1),

126 
BT_MBOX
(3, 
OBX_STATE
, 5, 1),

127 
BT_MBOX
(3, 
A2DP_SRC
, 6, 1),

128 
BT_MBOX
(3, 
OPEN_CON_2
, 8, 2),

129 
BT_MBOX
(3, 
TRAFFIC_LOAD
, 10, 2),

130 
BT_MBOX
(3, 
CHL_SEQN_LSB
, 12, 1),

131 
BT_MBOX
(3, 
INBAND_P
, 13, 1),

132 
BT_MBOX
(3, 
MSG_TYPE_2
, 16, 3),

133 
BT_MBOX
(3, 
SSN_2
, 19, 2),

134 
BT_MBOX
(3, 
UPDATE_REQUEST
, 21, 1),

137 
	#BT_MBOX_MSG
(
_nŸif
, 
_num
, 
_fõld
) \

138 ((
	`À32_to_˝u
((
_nŸif
)->
mbox_msg
[(
_num
)]Ë& 
BT_MBOX
##_num##
_
##
_fõld
)\

139 >> 
BT_MBOX
##
_num
##
_
##
_fõld
##
_POS
)

	)

141 
	#BT_MBOX_PRINT
(
_num
, 
_fõld
, 
_íd
) \

142 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, \

145 
	`BT_MBOX_MSG
(
nŸif
, 
_num
, 
_fõld
), \

146 
åue
 ? "\n" : ", ")

	)

147 
	eiwl_bt_a˘ivôy_gødög
 {

148 
	mBT_OFF
 = 0,

149 
	mBT_ON_NO_CONNECTION
 = 1,

150 
	mBT_LOW_TRAFFIC
 = 2,

151 
	mBT_HIGH_TRAFFIC
 = 3,

152 
	mBT_VERY_HIGH_TRAFFIC
 = 4,

154 
	mBT_MAX_AG
,

157 
	eiwl_bt_ci_com∂ün˚
 {

158 
	mBT_CI_COMPLIANCE_NONE
 = 0,

159 
	mBT_CI_COMPLIANCE_PRIMARY
 = 1,

160 
	mBT_CI_COMPLIANCE_SECONDARY
 = 2,

161 
	mBT_CI_COMPLIANCE_BOTH
 = 3,

180 
	siwl_bt_c€x_¥ofûe_nŸif
 {

181 
__À32
 
	mmbox_msg
[4];

182 
__À32
 
	mmsg_idx
;

183 
__À32
 
	mbt_ci_com∂ün˚
;

185 
__À32
 
	m¥im¨y_ch_lut
;

186 
__À32
 
	m£c⁄d¨y_ch_lut
;

187 
__À32
 
	mbt_a˘ivôy_gødög
;

188 
u8
 
	mâc_°©us
;

189 
u8
 
	mºc_°©us
;

190 
u8
 
	mwifi_loss_low_rssi
;

191 
u8
 
	mwifi_loss_mid_high_rssi
;

192 } 
	g__∑cked
;

	@fw/api/commands.h

7 #i‚de‡
__iwl_fw_≠i_comm™ds_h__


8 
	#__iwl_fw_≠i_comm™ds_h__


	)

36 
	eiwl_mvm_comm™d_groups
 {

37 
	mLEGACY_GROUP
 = 0x0,

38 
	mLONG_GROUP
 = 0x1,

39 
	mSYSTEM_GROUP
 = 0x2,

40 
	mMAC_CONF_GROUP
 = 0x3,

41 
	mPHY_OPS_GROUP
 = 0x4,

42 
	mDATA_PATH_GROUP
 = 0x5,

43 
	mSCAN_GROUP
 = 0x6,

44 
	mNAN_GROUP
 = 0x7,

45 
	mLOCATION_GROUP
 = 0x8,

46 
	mPROT_OFFLOAD_GROUP
 = 0xb,

47 
	mREGULATORY_AND_NVM_GROUP
 = 0xc,

48 
	mDEBUG_GROUP
 = 0xf,

49 
	mSTATISTICS_GROUP
 = 0x10,

55 
	eiwl_Àgacy_cmds
 {

62 
	mUCODE_ALIVE_NTFY
 = 0x1,

67 
	mREPLY_ERROR
 = 0x2,

72 
	mECHO_CMD
 = 0x3,

77 
	mINIT_COMPLETE_NOTIF
 = 0x4,

84 
	mPHY_CONTEXT_CMD
 = 0x8,

89 
	mDBG_CFG
 = 0x9,

96 
	mSCAN_ITERATION_COMPLETE_UMAC
 = 0xb5,

103 
	mSCAN_CFG_CMD
 = 0xc,

108 
	mSCAN_REQ_UMAC
 = 0xd,

113 
	mSCAN_ABORT_UMAC
 = 0xe,

118 
	mSCAN_COMPLETE_UMAC
 = 0xf,

124 
	mBA_WINDOW_STATUS_NOTIFICATION_ID
 = 0x13,

131 
	mADD_STA_KEY
 = 0x17,

137 
	mADD_STA
 = 0x18,

142 
	mREMOVE_STA
 = 0x19,

150 
	mTX_CMD
 = 0x1c,

156 
	mTXPATH_FLUSH
 = 0x1e,

163 
	mMGMT_MCAST_KEY
 = 0x1f,

171 
	mSCD_QUEUE_CFG
 = 0x1d,

176 
	mWEP_KEY
 = 0x20,

183 
	mSHARED_MEM_CFG
 = 0x25,

188 
	mTDLS_CHANNEL_SWITCH_CMD
 = 0x27,

194 
	mTDLS_CHANNEL_SWITCH_NOTIFICATION
 = 0xaa,

200 
	mTDLS_CONFIG_CMD
 = 0xa7,

205 
	mMAC_CONTEXT_CMD
 = 0x28,

211 
	mTIME_EVENT_CMD
 = 0x29,

216 
	mTIME_EVENT_NOTIFICATION
 = 0x2a,

222 
	mBINDING_CONTEXT_CMD
 = 0x2b,

227 
	mTIME_QUOTA_CMD
 = 0x2c,

233 
	mNON_QOS_TX_COUNTER_CMD
 = 0x2d,

238 
	mLEDS_CMD
 = 0x48,

243 
	mLQ_CMD
 = 0x4e,

249 
	mFW_PAGING_BLOCK_CMD
 = 0x4f,

254 
	mSCAN_OFFLOAD_REQUEST_CMD
 = 0x51,

259 
	mSCAN_OFFLOAD_ABORT_CMD
 = 0x52,

264 
	mHOT_SPOT_CMD
 = 0x53,

273 
	mWNM_80211V_TIMING_MEASUREMENT_NOTIFICATION
 = 0x67,

282 
	mWNM_80211V_TIMING_MEASUREMENT_CONFIRM_NOTIFICATION
 = 0x68,

288 
	mSCAN_OFFLOAD_COMPLETE
 = 0x6D,

294 
	mSCAN_OFFLOAD_UPDATE_PROFILES_CMD
 = 0x6E,

299 
	mMATCH_FOUND_NOTIFICATION
 = 0xd9,

305 
	mSCAN_ITERATION_COMPLETE
 = 0xe7,

311 
	mPHY_CONFIGURATION_CMD
 = 0x6a,

316 
	mCALIB_RES_NOTIF_PHY_DB
 = 0x6b,

321 
	mPHY_DB_CMD
 = 0x6c,

326 
	mPOWER_TABLE_CMD
 = 0x77,

332 
	mPSM_UAPSD_AP_MISBEHAVING_NOTIFICATION
 = 0x78,

337 
	mLTR_CONFIG
 = 0xee,

343 
	mREPLY_THERMAL_MNG_BACKOFF
 = 0x7e,

348 
	mNVM_ACCESS_CMD
 = 0x88,

353 
	mBEACON_NOTIFICATION
 = 0x90,

361 
	mBEACON_TEMPLATE_CMD
 = 0x91,

365 
	mTX_ANT_CONFIGURATION_CMD
 = 0x98,

375 
	mSTATISTICS_CMD
 = 0x9c,

385 
	mSTATISTICS_NOTIFICATION
 = 0x9d,

392 
	mEOSP_NOTIFICATION
 = 0x9e,

398 
	mREDUCE_TX_POWER_CMD
 = 0x9f,

403 
	mMISSED_BEACONS_NOTIFICATION
 = 0xa2,

408 
	mMAC_PM_POWER_TABLE
 = 0xa9,

413 
	mMFUART_LOAD_NOTIFICATION
 = 0xb1,

418 
	mRSS_CONFIG_CMD
 = 0xb3,

423 
	mREPLY_RX_PHY_CMD
 = 0xc0,

429 
	mREPLY_RX_MPDU_CMD
 = 0xc1,

436 
	mBAR_FRAME_RELEASE
 = 0xc2,

443 
	mFRAME_RELEASE
 = 0xc3,

450 
	mBA_NOTIF
 = 0xc5,

456 
	mMCC_UPDATE_CMD
 = 0xc8,

461 
	mMCC_CHUB_UPDATE_CMD
 = 0xc9,

467 
	mMARKER_CMD
 = 0xcb,

472 
	mBT_PROFILE_NOTIFICATION
 = 0xce,

477 
	mBT_CONFIG
 = 0x9b,

483 
	mBT_COEX_UPDATE_REDUCED_TXP
 = 0x5c,

488 
	mBT_COEX_CI
 = 0x5d,

493 
	mREPLY_SF_CFG_CMD
 = 0xd1,

497 
	mREPLY_BEACON_FILTERING_CMD
 = 0xd2,

504 
	mDTS_MEASUREMENT_NOTIFICATION
 = 0xdd,

509 
	mLDBG_CONFIG_CMD
 = 0xf6,

514 
	mDEBUG_LOG_MSG
 = 0xf7,

519 
	mMCAST_FILTER_CMD
 = 0xd0,

524 
	mD3_CONFIG_CMD
 = 0xd3,

532 
	mPROT_OFFLOAD_CONFIG_CMD
 = 0xd4,

537 
	mD0I3_END_CMD
 = 0xed,

542 
	mWOWLAN_PATTERNS
 = 0xe0,

547 
	mWOWLAN_CONFIGURATION
 = 0xe1,

553 
	mWOWLAN_TSC_RSC_PARAM
 = 0xe2,

558 
	mWOWLAN_TKIP_PARAM
 = 0xe3,

565 
	mWOWLAN_KEK_KCK_MATERIAL
 = 0xe4,

572 
	mWOWLAN_GET_STATUSES
 = 0xe5,

578 
	mSCAN_OFFLOAD_PROFILES_QUERY_CMD
 = 0x56,

584 
	eiwl_sy°em_subcmd_ids
 {

590 
	mSHARED_MEM_CFG_CMD
 = 0x0,

595 
	mSOC_CONFIGURATION_CMD
 = 0x01,

600 
	mINIT_EXTENDED_CFG_CMD
 = 0x03,

605 
	mFW_ERROR_RECOVERY_CMD
 = 0x7,

610 
	mRFI_CONFIG_CMD
 = 0xb,

615 
	mRFI_GET_FREQ_TABLE_CMD
 = 0xc,

620 
	mSYSTEM_FEATURES_CONTROL_CMD
 = 0xd,

625 
	mSYSTEM_STATISTICS_CMD
 = 0xf,

630 
	mSYSTEM_STATISTICS_END_NOTIF
 = 0xfd,

635 
	mRFI_DEACTIVATE_NOTIF
 = 0xff,

641 
	eiwl_°©i°ics_subcmd_ids
 {

646 
	mSTATISTICS_OPER_NOTIF
 = 0x0,

652 
	mSTATISTICS_OPER_PART1_NOTIF
 = 0x1,

	@fw/api/config.h

7 #i‚de‡
__iwl_fw_≠i_c⁄fig_h__


8 
	#__iwl_fw_≠i_c⁄fig_h__


	)

14 
	siwl_dqa_íabÀ_cmd
 {

15 
__À32
 
	mcmd_queue
;

16 } 
	g__∑cked
;

22 
	siwl_tx_™t_cfg_cmd
 {

23 
__À32
 
	mvÆid
;

24 } 
	g__∑cked
;

34 
	siwl_ˇlib_˘æ
 {

35 
__À32
 
	mÊow_åiggî
;

36 
__À32
 
	mevít_åiggî
;

37 } 
	g__∑cked
;

42 
	eiwl_ˇlib_cfg
 {

43 
	mIWL_CALIB_CFG_XTAL_IDX
 = 
BIT
(0),

44 
	mIWL_CALIB_CFG_TEMPERATURE_IDX
 = 
BIT
(1),

45 
	mIWL_CALIB_CFG_VOLTAGE_READ_IDX
 = 
BIT
(2),

46 
	mIWL_CALIB_CFG_PAPD_IDX
 = 
BIT
(3),

47 
	mIWL_CALIB_CFG_TX_PWR_IDX
 = 
BIT
(4),

48 
	mIWL_CALIB_CFG_DC_IDX
 = 
BIT
(5),

49 
	mIWL_CALIB_CFG_BB_FILTER_IDX
 = 
BIT
(6),

50 
	mIWL_CALIB_CFG_LO_LEAKAGE_IDX
 = 
BIT
(7),

51 
	mIWL_CALIB_CFG_TX_IQ_IDX
 = 
BIT
(8),

52 
	mIWL_CALIB_CFG_TX_IQ_SKEW_IDX
 = 
BIT
(9),

53 
	mIWL_CALIB_CFG_RX_IQ_IDX
 = 
BIT
(10),

54 
	mIWL_CALIB_CFG_RX_IQ_SKEW_IDX
 = 
BIT
(11),

55 
	mIWL_CALIB_CFG_SENSITIVITY_IDX
 = 
BIT
(12),

56 
	mIWL_CALIB_CFG_CHAIN_NOISE_IDX
 = 
BIT
(13),

57 
	mIWL_CALIB_CFG_DISCONNECTED_ANT_IDX
 = 
BIT
(14),

58 
	mIWL_CALIB_CFG_ANT_COUPLING_IDX
 = 
BIT
(15),

59 
	mIWL_CALIB_CFG_DAC_IDX
 = 
BIT
(16),

60 
	mIWL_CALIB_CFG_ABS_IDX
 = 
BIT
(17),

61 
	mIWL_CALIB_CFG_AGC_IDX
 = 
BIT
(18),

74 
	siwl_phy_•ecific_cfg
 {

75 
__À32
 
	mfûãr_cfg_chaös
[4];

76 } 
	g__∑cked
;

84 
	siwl_phy_cfg_cmd_v1
 {

85 
__À32
 
	mphy_cfg
;

86 
iwl_ˇlib_˘æ
 
	mˇlib_c⁄åﬁ
;

87 } 
	g__∑cked
;

96 
	siwl_phy_cfg_cmd_v3
 {

97 
__À32
 
	mphy_cfg
;

98 
iwl_ˇlib_˘æ
 
	mˇlib_c⁄åﬁ
;

99 
iwl_phy_•ecific_cfg
 
	mphy_•ecific_cfg
;

100 } 
	g__∑cked
;

107 
	eiwl_dc2dc_c⁄fig_id
 {

108 
	mDCDC_LOW_POWER_MODE_MSK_SET
 = 0x1,

109 
	mDCDC_FREQ_TUNE_SET
 = 0x2,

	@fw/api/context.h

7 #i‚de‡
__iwl_fw_≠i_c⁄ãxt_h__


8 
	#__iwl_fw_≠i_c⁄ãxt_h__


	)

18 
	eiwl_˘xt_id_™d_cﬁ‹
 {

19 
	mFW_CTXT_ID_POS
 = 0,

20 
	mFW_CTXT_ID_MSK
 = 0xf‡<< 
FW_CTXT_ID_POS
,

21 
	mFW_CTXT_COLOR_POS
 = 8,

22 
	mFW_CTXT_COLOR_MSK
 = 0xf‡<< 
FW_CTXT_COLOR_POS
,

23 
	mFW_CTXT_INVALID
 = 0xffffffff,

26 
	#FW_CMD_ID_AND_COLOR
(
_id
, 
_cﬁ‹
Ë(((_idË<< 
FW_CTXT_ID_POS
) |\

27 ((
_cﬁ‹
Ë<< 
FW_CTXT_COLOR_POS
))

	)

36 
	eiwl_˘xt_a˘i⁄
 {

37 
	mFW_CTXT_ACTION_INVALID
 = 0,

38 
	mFW_CTXT_ACTION_ADD
,

39 
	mFW_CTXT_ACTION_MODIFY
,

40 
	mFW_CTXT_ACTION_REMOVE
,

	@fw/api/d3.h

7 #i‚de‡
__iwl_fw_≠i_d3_h__


8 
	#__iwl_fw_≠i_d3_h__


	)

9 
	~<iwl-å™s.h
>

15 
	eiwl_d0i3_Êags
 {

16 
	mIWL_D0I3_RESET_REQUIRE
 = 
BIT
(0),

23 
	eiwl_d3_wakeup_Êags
 {

24 
	mIWL_WAKEUP_D3_CONFIG_FW_ERROR
 = 
BIT
(0),

35 
	siwl_d3_m™agî_c⁄fig
 {

36 
__À32
 
	mmö_¶ìp_time
;

37 
__À32
 
	mwakeup_Êags
;

38 
__À32
 
	mwakeup_ho°_timî
;

39 } 
	g__∑cked
;

52 
	eiwl_¥Ÿo_ofÊﬂds
 {

53 
	mIWL_D3_PROTO_OFFLOAD_ARP
 = 
BIT
(0),

54 
	mIWL_D3_PROTO_OFFLOAD_NS
 = 
BIT
(1),

55 
	mIWL_D3_PROTO_IPV4_VALID
 = 
BIT
(2),

56 
	mIWL_D3_PROTO_IPV6_VALID
 = 
BIT
(3),

57 
	mIWL_D3_PROTO_OFFLOAD_BTM
 = 
BIT
(4),

60 
	#IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V1
 2

	)

61 
	#IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V2
 6

	)

62 
	#IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3L
 12

	)

63 
	#IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3S
 4

	)

64 
	#IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_MAX
 12

	)

66 
	#IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3L
 4

	)

67 
	#IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3S
 2

	)

77 
	siwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 {

78 
__À32
 
	míabÀd
;

79 
__be32
 
	mªmŸe_ùv4_addr
;

80 
__be32
 
	mho°_ùv4_addr
;

81 
u8
 
	m¨p_mac_addr
[
ETH_ALEN
];

82 
__À16
 
	mª£rved
;

83 } 
	g__∑cked
;

95 
	siwl_¥Ÿo_ofÊﬂd_cmd_v1
 {

96 
iwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 
	mcomm⁄
;

97 
u8
 
	mªmŸe_ùv6_addr
[16];

98 
u8
 
	msﬁicôed_node_ùv6_addr
[16];

99 
u8
 
	mèrgë_ùv6_addr
[
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V1
][16];

100 
u8
 
	mndp_mac_addr
[
ETH_ALEN
];

101 
__À16
 
	mª£rved2
;

102 } 
	g__∑cked
;

115 
	siwl_¥Ÿo_ofÊﬂd_cmd_v2
 {

116 
iwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 
	mcomm⁄
;

117 
u8
 
	mªmŸe_ùv6_addr
[16];

118 
u8
 
	msﬁicôed_node_ùv6_addr
[16];

119 
u8
 
	mèrgë_ùv6_addr
[
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V2
][16];

120 
u8
 
	mndp_mac_addr
[
ETH_ALEN
];

121 
u8
 
	mnum_vÆid_ùv6_addrs
;

122 
u8
 
	mª£rved2
[3];

123 } 
	g__∑cked
;

125 
	siwl_ns_c⁄fig
 {

126 
ö6_addr
 
	msour˚_ùv6_addr
;

127 
ö6_addr
 
	mde°_ùv6_addr
;

128 
u8
 
	mèrgë_mac_addr
[
ETH_ALEN
];

129 
__À16
 
	mª£rved
;

130 } 
	g__∑cked
;

132 
	siwl_èrg_addr
 {

133 
ö6_addr
 
	maddr
;

134 
__À32
 
	mc⁄fig_num
;

135 } 
	g__∑cked
;

144 
	siwl_¥Ÿo_ofÊﬂd_cmd_v3_smÆl
 {

145 
iwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 
	mcomm⁄
;

146 
__À32
 
	mnum_vÆid_ùv6_addrs
;

147 
iwl_èrg_addr
 
	mèrg_addrs
[
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3S
];

148 
iwl_ns_c⁄fig
 
	mns_c⁄fig
[
IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3S
];

149 } 
	g__∑cked
;

158 
	siwl_¥Ÿo_ofÊﬂd_cmd_v3_œrge
 {

159 
iwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 
	mcomm⁄
;

160 
__À32
 
	mnum_vÆid_ùv6_addrs
;

161 
iwl_èrg_addr
 
	mèrg_addrs
[
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3L
];

162 
iwl_ns_c⁄fig
 
	mns_c⁄fig
[
IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3L
];

163 } 
	g__∑cked
;

173 
	siwl_¥Ÿo_ofÊﬂd_cmd_v4
 {

174 
__À32
 
	m°a_id
;

175 
iwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 
	mcomm⁄
;

176 
__À32
 
	mnum_vÆid_ùv6_addrs
;

177 
iwl_èrg_addr
 
	mèrg_addrs
[
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3L
];

178 
iwl_ns_c⁄fig
 
	mns_c⁄fig
[
IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3L
];

179 } 
	g__∑cked
;

184 
	#IWL_WOWLAN_MIN_PATTERN_LEN
 16

	)

185 
	#IWL_WOWLAN_MAX_PATTERN_LEN
 128

	)

187 
	siwl_wowœn_∑âîn_v1
 {

188 
u8
 
	mmask
[
IWL_WOWLAN_MAX_PATTERN_LEN
 / 8];

189 
u8
 
	m∑âîn
[
IWL_WOWLAN_MAX_PATTERN_LEN
];

190 
u8
 
	mmask_size
;

191 
u8
 
	m∑âîn_size
;

192 
__À16
 
	mª£rved
;

193 } 
	g__∑cked
;

195 
	#IWL_WOWLAN_MAX_PATTERNS
 20

	)

200 
	siwl_wowœn_∑âîns_cmd_v1
 {

204 
__À32
 
	mn_∑âîns
;

209 
iwl_wowœn_∑âîn_v1
 
	m∑âîns
[];

210 } 
	g__∑cked
;

212 
	#IPV4_ADDR_SIZE
 4

	)

213 
	#IPV6_ADDR_SIZE
 16

	)

215 
	eiwl_wowœn_∑âîn_ty≥
 {

216 
	mWOWLAN_PATTERN_TYPE_BITMASK
,

217 
	mWOWLAN_PATTERN_TYPE_IPV4_TCP_SYN
,

218 
	mWOWLAN_PATTERN_TYPE_IPV6_TCP_SYN
,

219 
	mWOWLAN_PATTERN_TYPE_IPV4_TCP_SYN_WILDCARD
,

220 
	mWOWLAN_PATTERN_TYPE_IPV6_TCP_SYN_WILDCARD
,

226 
	siwl_wowœn_ùv4_t˝_syn
 {

230 
u8
 
	m§c_addr
[
IPV4_ADDR_SIZE
];

235 
u8
 
	md°_addr
[
IPV4_ADDR_SIZE
];

240 
__À16
 
	m§c_p‹t
;

245 
__À16
 
	md°_p‹t
;

246 } 
	g__∑cked
;

251 
	siwl_wowœn_ùv6_t˝_syn
 {

255 
u8
 
	m§c_addr
[
IPV6_ADDR_SIZE
];

260 
u8
 
	md°_addr
[
IPV6_ADDR_SIZE
];

265 
__À16
 
	m§c_p‹t
;

270 
__À16
 
	md°_p‹t
;

271 } 
	g__∑cked
;

279 
	uiwl_wowœn_∑âîn_d©a
 {

283 
iwl_wowœn_∑âîn_v1
 
	mbômask
;

288 
iwl_wowœn_ùv4_t˝_syn
 
	mùv4_t˝_syn
;

293 
iwl_wowœn_ùv6_t˝_syn
 
	mùv6_t˝_syn
;

299 
	siwl_wowœn_∑âîn_v2
 {

303 
u8
 
	m∑âîn_ty≥
;

308 
u8
 
	mª£rved
[3];

314 
iwl_wowœn_∑âîn_d©a
 
	mu
;

315 } 
	g__∑cked
;

320 
	siwl_wowœn_∑âîns_cmd
 {

324 
u8
 
	mn_∑âîns
;

329 
u8
 
	m°a_id
;

334 
__À16
 
	mª£rved
;

339 
iwl_wowœn_∑âîn_v2
 
	m∑âîns
[];

340 } 
	g__∑cked
;

342 
	eiwl_wowœn_wakeup_fûãrs
 {

343 
	mIWL_WOWLAN_WAKEUP_MAGIC_PACKET
 = 
BIT
(0),

344 
	mIWL_WOWLAN_WAKEUP_PATTERN_MATCH
 = 
BIT
(1),

345 
	mIWL_WOWLAN_WAKEUP_BEACON_MISS
 = 
BIT
(2),

346 
	mIWL_WOWLAN_WAKEUP_LINK_CHANGE
 = 
BIT
(3),

347 
	mIWL_WOWLAN_WAKEUP_GTK_REKEY_FAIL
 = 
BIT
(4),

348 
	mIWL_WOWLAN_WAKEUP_EAP_IDENT_REQ
 = 
BIT
(5),

349 
	mIWL_WOWLAN_WAKEUP_4WAY_HANDSHAKE
 = 
BIT
(6),

350 
	mIWL_WOWLAN_WAKEUP_ENABLE_NET_DETECT
 = 
BIT
(7),

351 
	mIWL_WOWLAN_WAKEUP_RF_KILL_DEASSERT
 = 
BIT
(8),

352 
	mIWL_WOWLAN_WAKEUP_REMOTE_LINK_LOSS
 = 
BIT
(9),

353 
	mIWL_WOWLAN_WAKEUP_REMOTE_SIGNATURE_TABLE
 = 
BIT
(10),

354 
	mIWL_WOWLAN_WAKEUP_REMOTE_TCP_EXTERNAL
 = 
BIT
(11),

355 
	mIWL_WOWLAN_WAKEUP_REMOTE_WAKEUP_PACKET
 = 
BIT
(12),

356 
	mIWL_WOWLAN_WAKEUP_IOAC_MAGIC_PACKET
 = 
BIT
(13),

357 
	mIWL_WOWLAN_WAKEUP_HOST_TIMER
 = 
BIT
(14),

358 
	mIWL_WOWLAN_WAKEUP_RX_FRAME
 = 
BIT
(15),

359 
	mIWL_WOWLAN_WAKEUP_BCN_FILTERING
 = 
BIT
(16),

362 
	eiwl_wowœn_Êags
 {

363 
	mIS_11W_ASSOC
 = 
BIT
(0),

364 
	mENABLE_L3_FILTERING
 = 
BIT
(1),

365 
	mENABLE_NBNS_FILTERING
 = 
BIT
(2),

366 
	mENABLE_DHCP_FILTERING
 = 
BIT
(3),

367 
	mENABLE_STORE_BEACON
 = 
BIT
(4),

383 
	siwl_wowœn_c⁄fig_cmd
 {

384 
__À32
 
	mwakeup_fûãr
;

385 
__À16
 
	mn⁄_qos_£q
;

386 
__À16
 
	mqos_£q
[8];

387 
u8
 
	mwowœn_ba_ã¨down_tids
;

388 
u8
 
	mis_11n_c⁄√˘i⁄
;

389 
u8
 
	mofÊﬂdög_tid
;

390 
u8
 
	mÊags
;

391 
u8
 
	m°a_id
;

392 
u8
 
	mª£rved
;

393 } 
	g__∑cked
;

395 
	#IWL_NUM_RSC
 16

	)

396 
	#WOWLAN_KEY_MAX_SIZE
 32

	)

397 
	#WOWLAN_GTK_KEYS_NUM
 2

	)

398 
	#WOWLAN_IGTK_KEYS_NUM
 2

	)

399 
	#WOWLAN_IGTK_MIN_INDEX
 4

	)

400 
	#WOWLAN_BIGTK_KEYS_NUM
 2

	)

401 
	#WOWLAN_BIGTK_MIN_INDEX
 6

	)

406 
	stkù_sc
 {

407 
__À16
 
	miv16
;

408 
__À16
 
	m∑d
;

409 
__À32
 
	miv32
;

410 } 
	g__∑cked
;

412 
	siwl_tkù_rsc_tsc
 {

413 
tkù_sc
 
	muniˇ°_rsc
[
IWL_NUM_RSC
];

414 
tkù_sc
 
	mmu…iˇ°_rsc
[
IWL_NUM_RSC
];

415 
tkù_sc
 
	mtsc
;

416 } 
	g__∑cked
;

418 
	s´s_sc
 {

419 
__À64
 
	m≤
;

420 } 
	g__∑cked
;

422 
	siwl_´s_rsc_tsc
 {

423 
´s_sc
 
	muniˇ°_rsc
[
IWL_NUM_RSC
];

424 
´s_sc
 
	mmu…iˇ°_rsc
[
IWL_NUM_RSC
];

425 
´s_sc
 
	mtsc
;

426 } 
	g__∑cked
;

428 
	uiwl_Æl_tsc_rsc
 {

429 
iwl_tkù_rsc_tsc
 
	mtkù
;

430 
iwl_´s_rsc_tsc
 
	m´s
;

433 
	siwl_wowœn_rsc_tsc_∑øms_cmd_vî_2
 {

434 
iwl_Æl_tsc_rsc
 
	mÆl_tsc_rsc
;

435 } 
	g__∑cked
;

437 
	siwl_wowœn_rsc_tsc_∑øms_cmd_v4
 {

438 
iwl_wowœn_rsc_tsc_∑øms_cmd_vî_2
 
	m∑øms
;

439 
__À32
 
	m°a_id
;

440 } 
	g__∑cked
;

442 
	siwl_wowœn_rsc_tsc_∑øms_cmd
 {

443 
__À64
 
	muˇ°_rsc
[
IWL_MAX_TID_COUNT
];

444 
__À64
 
	mmˇ°_rsc
[
WOWLAN_GTK_KEYS_NUM
][
IWL_MAX_TID_COUNT
];

445 
__À32
 
	m°a_id
;

446 
	#IWL_MCAST_KEY_MAP_INVALID
 0xff

	)

447 
u8
 
	mmˇ°_key_id_m≠
[4];

448 } 
	g__∑cked
;

450 
	#IWL_MIC_KEY_SIZE
 8

	)

451 
	siwl_mic_keys
 {

452 
u8
 
	mtx
[
IWL_MIC_KEY_SIZE
];

453 
u8
 
	mrx_uniˇ°
[
IWL_MIC_KEY_SIZE
];

454 
u8
 
	mrx_mˇ°
[
IWL_MIC_KEY_SIZE
];

455 } 
	g__∑cked
;

457 
	#IWL_P1K_SIZE
 5

	)

458 
	siwl_p1k_ˇche
 {

459 
__À16
 
	mp1k
[
IWL_P1K_SIZE
];

460 } 
	g__∑cked
;

462 
	#IWL_NUM_RX_P1K_CACHE
 2

	)

464 
	siwl_wowœn_tkù_∑øms_cmd_vî_1
 {

465 
iwl_mic_keys
 
	mmic_keys
;

466 
iwl_p1k_ˇche
 
	mtx
;

467 
iwl_p1k_ˇche
 
	mrx_uni
[
IWL_NUM_RX_P1K_CACHE
];

468 
iwl_p1k_ˇche
 
	mrx_mu…i
[
IWL_NUM_RX_P1K_CACHE
];

469 } 
	g__∑cked
;

471 
	siwl_wowœn_tkù_∑øms_cmd
 {

472 
iwl_mic_keys
 
	mmic_keys
;

473 
iwl_p1k_ˇche
 
	mtx
;

474 
iwl_p1k_ˇche
 
	mrx_uni
[
IWL_NUM_RX_P1K_CACHE
];

475 
iwl_p1k_ˇche
 
	mrx_mu…i
[
IWL_NUM_RX_P1K_CACHE
];

476 
u8
 
	mªvî£d
[2];

477 
__À32
 
	m°a_id
;

478 } 
	g__∑cked
;

480 
	#IWL_KCK_MAX_SIZE
 32

	)

481 
	#IWL_KEK_MAX_SIZE
 32

	)

483 
	siwl_wowœn_kek_kck_m©îül_cmd_v2
 {

484 
u8
 
	mkck
[
IWL_KCK_MAX_SIZE
];

485 
u8
 
	mkek
[
IWL_KEK_MAX_SIZE
];

486 
__À16
 
	mkck_Àn
;

487 
__À16
 
	mkek_Àn
;

488 
__À64
 
	mª∂ay_˘r
;

489 } 
	g__∑cked
;

491 
	siwl_wowœn_kek_kck_m©îül_cmd_v3
 {

492 
u8
 
	mkck
[
IWL_KCK_MAX_SIZE
];

493 
u8
 
	mkek
[
IWL_KEK_MAX_SIZE
];

494 
__À16
 
	mkck_Àn
;

495 
__À16
 
	mkek_Àn
;

496 
__À64
 
	mª∂ay_˘r
;

497 
__À32
 
	makm
;

498 
__À32
 
	mgtk_cùhî
;

499 
__À32
 
	migtk_cùhî
;

500 
__À32
 
	mbigtk_cùhî
;

501 } 
	g__∑cked
;

503 
	siwl_wowœn_kek_kck_m©îül_cmd_v4
 {

504 
__À32
 
	m°a_id
;

505 
u8
 
	mkck
[
IWL_KCK_MAX_SIZE
];

506 
u8
 
	mkek
[
IWL_KEK_MAX_SIZE
];

507 
__À16
 
	mkck_Àn
;

508 
__À16
 
	mkek_Àn
;

509 
__À64
 
	mª∂ay_˘r
;

510 
__À32
 
	makm
;

511 
__À32
 
	mgtk_cùhî
;

512 
__À32
 
	migtk_cùhî
;

513 
__À32
 
	mbigtk_cùhî
;

514 } 
	g__∑cked
;

516 
	siwl_wowœn_gë_°©us_cmd
 {

517 
__À32
 
	m°a_id
;

518 } 
	g__∑cked
;

520 
	#RF_KILL_INDICATOR_FOR_WOWLAN
 0x87

	)

522 
	eiwl_wowœn_ªkey_°©us
 {

523 
	mIWL_WOWLAN_REKEY_POST_REKEY
 = 0,

524 
	mIWL_WOWLAN_REKEY_WHILE_REKEY
 = 1,

527 
	eiwl_wowœn_wakeup_ªas⁄
 {

528 
	mIWL_WOWLAN_WAKEUP_BY_NON_WIRELESS
 = 0,

529 
	mIWL_WOWLAN_WAKEUP_BY_MAGIC_PACKET
 = 
BIT
(0),

530 
	mIWL_WOWLAN_WAKEUP_BY_PATTERN
 = 
BIT
(1),

531 
	mIWL_WOWLAN_WAKEUP_BY_DISCONNECTION_ON_MISSED_BEACON
 = 
BIT
(2),

532 
	mIWL_WOWLAN_WAKEUP_BY_DISCONNECTION_ON_DEAUTH
 = 
BIT
(3),

533 
	mIWL_WOWLAN_WAKEUP_BY_GTK_REKEY_FAILURE
 = 
BIT
(4),

534 
	mIWL_WOWLAN_WAKEUP_BY_RFKILL_DEASSERTED
 = 
BIT
(5),

535 
	mIWL_WOWLAN_WAKEUP_BY_UCODE_ERROR
 = 
BIT
(6),

536 
	mIWL_WOWLAN_WAKEUP_BY_EAPOL_REQUEST
 = 
BIT
(7),

537 
	mIWL_WOWLAN_WAKEUP_BY_FOUR_WAY_HANDSHAKE
 = 
BIT
(8),

538 
	mIWL_WOWLAN_WAKEUP_BY_REM_WAKE_LINK_LOSS
 = 
BIT
(9),

539 
	mIWL_WOWLAN_WAKEUP_BY_REM_WAKE_SIGNATURE_TABLE
 = 
BIT
(10),

540 
	mIWL_WOWLAN_WAKEUP_BY_REM_WAKE_TCP_EXTERNAL
 = 
BIT
(11),

541 
	mIWL_WOWLAN_WAKEUP_BY_REM_WAKE_WAKEUP_PACKET
 = 
BIT
(12),

542 
	mIWL_WOWLAN_WAKEUP_BY_IOAC_MAGIC_PACKET
 = 
BIT
(13),

543 
	mIWL_WOWLAN_WAKEUP_BY_D3_WAKEUP_HOST_TIMER
 = 
BIT
(14),

544 
	mIWL_WOWLAN_WAKEUP_BY_RXFRAME_FILTERED_IN
 = 
BIT
(15),

545 
	mIWL_WOWLAN_WAKEUP_BY_BEACON_FILTERED_IN
 = 
BIT
(16),

546 
	mIWL_WAKEUP_BY_11W_UNPROTECTED_DEAUTH_OR_DISASSOC
 = 
BIT
(17),

547 
	mIWL_WAKEUP_BY_PATTERN_IPV4_TCP_SYN
 = 
BIT
(18),

548 
	mIWL_WAKEUP_BY_PATTERN_IPV4_TCP_SYN_WILDCARD
 = 
BIT
(19),

549 
	mIWL_WAKEUP_BY_PATTERN_IPV6_TCP_SYN
 = 
BIT
(20),

550 
	mIWL_WAKEUP_BY_PATTERN_IPV6_TCP_SYN_WILDCARD
 = 
BIT
(21),

553 
	siwl_wowœn_gtk_°©us_v1
 {

554 
u8
 
	mkey_ödex
;

555 
u8
 
	mª£rved
[3];

556 
u8
 
	mde¸y±_key
[16];

557 
u8
 
	mtkù_mic_key
[8];

558 
iwl_wowœn_rsc_tsc_∑øms_cmd_vî_2
 
	mrsc
;

559 } 
	g__∑cked
;

573 
	siwl_wowœn_gtk_°©us_v2
 {

574 
u8
 
	mkey
[
WOWLAN_KEY_MAX_SIZE
];

575 
u8
 
	mkey_Àn
;

576 
u8
 
	mkey_Êags
;

577 
u8
 
	mª£rved
[2];

578 
u8
 
	mtkù_mic_key
[8];

579 
iwl_wowœn_rsc_tsc_∑øms_cmd_vî_2
 
	mrsc
;

580 } 
	g__∑cked
;

589 
	siwl_wowœn_Æl_rsc_tsc_v5
 {

590 
__À64
 
	muˇ°_rsc
[
IWL_MAX_TID_COUNT
];

591 
__À64
 
	mmˇ°_rsc
[2][
IWL_MAX_TID_COUNT
];

592 
__À32
 
	m°a_id
;

593 
u8
 
	mmˇ°_key_id_m≠
[4];

594 } 
	g__∑cked
;

608 
	siwl_wowœn_gtk_°©us_v3
 {

609 
u8
 
	mkey
[
WOWLAN_KEY_MAX_SIZE
];

610 
u8
 
	mkey_Àn
;

611 
u8
 
	mkey_Êags
;

612 
u8
 
	mª£rved
[2];

613 
u8
 
	mtkù_mic_key
[
IWL_MIC_KEY_SIZE
];

614 
iwl_wowœn_Æl_rsc_tsc_v5
 
	msc
;

615 } 
	g__∑cked
;

617 
	#IWL_WOWLAN_GTK_IDX_MASK
 (
	`BIT
(0Ë| BIT(1))

	)

618 
	#IWL_WOWLAN_IGTK_BIGTK_IDX_MASK
 (
	`BIT
(0))

	)

631 
	siwl_wowœn_igtk_°©us
 {

632 
u8
 
	mkey
[
WOWLAN_KEY_MAX_SIZE
];

633 
u8
 
	mùn
[6];

634 
u8
 
	mkey_Àn
;

635 
u8
 
	mkey_Êags
;

636 } 
	g__∑cked
;

653 
	siwl_wowœn_°©us_v6
 {

654 
iwl_wowœn_gtk_°©us_v1
 
	mgtk
;

655 
__À64
 
	mª∂ay_˘r
;

656 
__À16
 
	m∑âîn_numbî
;

657 
__À16
 
	mn⁄_qos_£q_˘r
;

658 
__À16
 
	mqos_£q_˘r
[8];

659 
__À32
 
	mwakeup_ªas⁄s
;

660 
__À32
 
	mnum_of_gtk_ªkeys
;

661 
__À32
 
	må™smôãd_ndps
;

662 
__À32
 
	mª˚ived_bóc⁄s
;

663 
__À32
 
	mwake_∑ckë_Àngth
;

664 
__À32
 
	mwake_∑ckë_bufsize
;

665 
u8
 
	mwake_∑ckë
[];

666 } 
	g__∑cked
;

684 
	siwl_wowœn_°©us_v7
 {

685 
iwl_wowœn_gtk_°©us_v2
 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

686 
iwl_wowœn_igtk_°©us
 
	migtk
[
WOWLAN_IGTK_KEYS_NUM
];

687 
__À64
 
	mª∂ay_˘r
;

688 
__À16
 
	m∑âîn_numbî
;

689 
__À16
 
	mn⁄_qos_£q_˘r
;

690 
__À16
 
	mqos_£q_˘r
[8];

691 
__À32
 
	mwakeup_ªas⁄s
;

692 
__À32
 
	mnum_of_gtk_ªkeys
;

693 
__À32
 
	må™smôãd_ndps
;

694 
__À32
 
	mª˚ived_bóc⁄s
;

695 
__À32
 
	mwake_∑ckë_Àngth
;

696 
__À32
 
	mwake_∑ckë_bufsize
;

697 
u8
 
	mwake_∑ckë
[];

698 } 
	g__∑cked
;

720 
	siwl_wowœn_°©us_v9
 {

721 
iwl_wowœn_gtk_°©us_v2
 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

722 
iwl_wowœn_igtk_°©us
 
	migtk
[
WOWLAN_IGTK_KEYS_NUM
];

723 
__À64
 
	mª∂ay_˘r
;

724 
__À16
 
	m∑âîn_numbî
;

725 
__À16
 
	mn⁄_qos_£q_˘r
;

726 
__À16
 
	mqos_£q_˘r
[8];

727 
__À32
 
	mwakeup_ªas⁄s
;

728 
__À32
 
	mnum_of_gtk_ªkeys
;

729 
__À32
 
	må™smôãd_ndps
;

730 
__À32
 
	mª˚ived_bóc⁄s
;

731 
__À32
 
	mwake_∑ckë_Àngth
;

732 
__À32
 
	mwake_∑ckë_bufsize
;

733 
u8
 
	mtid_ã¨_down
;

734 
u8
 
	mª£rved
[3];

735 
u8
 
	mwake_∑ckë
[];

736 } 
	g__∑cked
;

758 
	siwl_wowœn_°©us_v12
 {

759 
iwl_wowœn_gtk_°©us_v3
 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

760 
iwl_wowœn_igtk_°©us
 
	migtk
[
WOWLAN_IGTK_KEYS_NUM
];

761 
__À64
 
	mª∂ay_˘r
;

762 
__À16
 
	m∑âîn_numbî
;

763 
__À16
 
	mn⁄_qos_£q_˘r
;

764 
__À16
 
	mqos_£q_˘r
[8];

765 
__À32
 
	mwakeup_ªas⁄s
;

766 
__À32
 
	mnum_of_gtk_ªkeys
;

767 
__À32
 
	må™smôãd_ndps
;

768 
__À32
 
	mª˚ived_bóc⁄s
;

769 
__À32
 
	mwake_∑ckë_Àngth
;

770 
__À32
 
	mwake_∑ckë_bufsize
;

771 
u8
 
	mtid_ã¨_down
;

772 
u8
 
	mª£rved
[3];

773 
u8
 
	mwake_∑ckë
[];

774 } 
	g__∑cked
;

795 
	siwl_wowœn_öfo_nŸif_v1
 {

796 
iwl_wowœn_gtk_°©us_v3
 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

797 
iwl_wowœn_igtk_°©us
 
	migtk
[
WOWLAN_IGTK_KEYS_NUM
];

798 
__À64
 
	mª∂ay_˘r
;

799 
__À16
 
	m∑âîn_numbî
;

800 
__À16
 
	mª£rved1
;

801 
__À16
 
	mqos_£q_˘r
[8];

802 
__À32
 
	mwakeup_ªas⁄s
;

803 
__À32
 
	mnum_of_gtk_ªkeys
;

804 
__À32
 
	må™smôãd_ndps
;

805 
__À32
 
	mª˚ived_bóc⁄s
;

806 
__À32
 
	mwake_∑ckë_Àngth
;

807 
__À32
 
	mwake_∑ckë_bufsize
;

808 
u8
 
	mtid_ã¨_down
;

809 
u8
 
	m°©i⁄_id
;

810 
u8
 
	mª£rved2
[2];

811 } 
	g__∑cked
;

830 
	siwl_wowœn_öfo_nŸif_v2
 {

831 
iwl_wowœn_gtk_°©us_v3
 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

832 
iwl_wowœn_igtk_°©us
 
	migtk
[
WOWLAN_IGTK_KEYS_NUM
];

833 
__À64
 
	mª∂ay_˘r
;

834 
__À16
 
	m∑âîn_numbî
;

835 
__À16
 
	mª£rved1
;

836 
__À16
 
	mqos_£q_˘r
[8];

837 
__À32
 
	mwakeup_ªas⁄s
;

838 
__À32
 
	mnum_of_gtk_ªkeys
;

839 
__À32
 
	må™smôãd_ndps
;

840 
__À32
 
	mª˚ived_bóc⁄s
;

841 
u8
 
	mtid_ã¨_down
;

842 
u8
 
	m°©i⁄_id
;

843 
u8
 
	mª£rved2
[2];

844 } 
	g__∑cked
;

864 
	siwl_wowœn_öfo_nŸif
 {

865 
iwl_wowœn_gtk_°©us_v3
 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

866 
iwl_wowœn_igtk_°©us
 
	migtk
[
WOWLAN_IGTK_KEYS_NUM
];

867 
iwl_wowœn_igtk_°©us
 
	mbigtk
[
WOWLAN_BIGTK_KEYS_NUM
];

868 
__À64
 
	mª∂ay_˘r
;

869 
__À16
 
	m∑âîn_numbî
;

870 
__À16
 
	mª£rved1
;

871 
__À16
 
	mqos_£q_˘r
[8];

872 
__À32
 
	mwakeup_ªas⁄s
;

873 
__À32
 
	mnum_of_gtk_ªkeys
;

874 
__À32
 
	må™smôãd_ndps
;

875 
__À32
 
	mª˚ived_bóc⁄s
;

876 
u8
 
	mtid_ã¨_down
;

877 
u8
 
	m°©i⁄_id
;

878 
u8
 
	mª£rved2
[2];

879 } 
	g__∑cked
;

888 
	siwl_wowœn_wake_pkt_nŸif
 {

889 
__À32
 
	mwake_∑ckë_Àngth
;

890 
u8
 
	m°©i⁄_id
;

891 
u8
 
	mª£rved
[3];

892 
u8
 
	mwake_∑ckë
[1];

893 } 
	g__∑cked
;

899 
	siwl_mvm_d3_íd_nŸif
 {

900 
__À32
 
	mÊags
;

901 } 
	g__∑cked
;

	@fw/api/datapath.h

7 #i‚de‡
__iwl_fw_≠i_d©≠©h_h__


8 
	#__iwl_fw_≠i_d©≠©h_h__


	)

13 
	eiwl_d©a_∑th_subcmd_ids
 {

17 
	mDQA_ENABLE_CMD
 = 0x0,

22 
	mUPDATE_MU_GROUPS_CMD
 = 0x1,

27 
	mTRIGGER_RX_QUEUES_NOTIF_CMD
 = 0x2,

32 
	mWNM_PLATFORM_PTM_REQUEST_CMD
 = 0x3,

38 
	mWNM_80211V_TIMING_MEASUREMENT_CONFIG_CMD
 = 0x4,

45 
	mSTA_HE_CTXT_CMD
 = 0x7,

50 
	mRLC_CONFIG_CMD
 = 0x8,

55 
	mRFH_QUEUE_CONFIG_CMD
 = 0xD,

60 
	mTLC_MNG_CONFIG_CMD
 = 0xF,

65 
	mHE_AIR_SNIFFER_CONFIG_CMD
 = 0x13,

71 
	mCHEST_COLLECTOR_FILTER_CONFIG_CMD
 = 0x14,

78 
	mRX_BAID_ALLOCATION_CONFIG_CMD
 = 0x16,

85 
	mSCD_QUEUE_CONFIG_CMD
 = 0x17,

90 
	mSEC_KEY_CMD
 = 0x18,

96 
	mMONITOR_NOTIF
 = 0xF4,

101 
	mRX_NO_DATA_NOTIF
 = 0xF5,

107 
	mTHERMAL_DUAL_CHAIN_REQUEST
 = 0xF6,

112 
	mTLC_MNG_UPDATE_NOTIF
 = 0xF7,

117 
	mSTA_PM_NOTIF
 = 0xFD,

122 
	mMU_GROUP_MGMT_NOTIF
 = 0xFE,

127 
	mRX_QUEUES_NOTIFICATION
 = 0xFF,

138 
	siwl_mu_group_mgmt_cmd
 {

139 
__À32
 
	mª£rved
;

140 
__À32
 
	mmembîshù_°©us
[2];

141 
__À32
 
	mu£r_posôi⁄
[4];

142 } 
	g__∑cked
;

151 
	siwl_mu_group_mgmt_nŸif
 {

152 
__À32
 
	mmembîshù_°©us
[2];

153 
__À32
 
	mu£r_posôi⁄
[4];

154 } 
	g__∑cked
;

156 
	eiwl_ch™√l_e°im©i⁄_Êags
 {

157 
	mIWL_CHANNEL_ESTIMATION_ENABLE
 = 
BIT
(0),

158 
	mIWL_CHANNEL_ESTIMATION_TIMER
 = 
BIT
(1),

159 
	mIWL_CHANNEL_ESTIMATION_COUNTER
 = 
BIT
(2),

162 
	eiwl_time_sync_¥Ÿocﬁ_ty≥
 {

163 
	mIWL_TIME_SYNC_PROTOCOL_TM
 = 
BIT
(0),

164 
	mIWL_TIME_SYNC_PROTOCOL_FTM
 = 
BIT
(1),

175 
	siwl_time_sync_cfg_cmd
 {

176 
__À32
 
	m¥Ÿocﬁs
;

177 
u8
 
	m≥î_addr
[
ETH_ALEN
];

178 
u8
 
	mª£rved
[2];

179 } 
	g__∑cked
;

189 
	eiwl_syn˚d_time_›î©i⁄
 {

190 
	mIWL_SYNCED_TIME_OPERATION_READ_ARTB
 = 1,

191 
	mIWL_SYNCED_TIME_OPERATION_READ_GP2
,

192 
	mIWL_SYNCED_TIME_OPERATION_READ_BOTH
,

200 
	siwl_syn˚d_time_cmd
 {

201 
__À32
 
	m›î©i⁄
;

202 } 
	g__∑cked
;

215 
	siwl_syn˚d_time_r•
 {

216 
__À32
 
	m›î©i⁄
;

217 
__À32
 
	m∂©f‹m_time°amp_hi
;

218 
__À32
 
	m∂©f‹m_time°amp_lo
;

219 
__À32
 
	mgp2_time°amp_hi
;

220 
__À32
 
	mgp2_time°amp_lo
;

221 } 
	g__∑cked
;

224 
	#PTP_CTX_MAX_DATA_SIZE
 128

	)

235 
	siwl_time_msmt_±p_˘x
 {

239 
u8
 
	mñemít_id
;

240 
u8
 
	mÀngth
;

241 
__À16
 
	mª£rved
;

242 
u8
 
	md©a
[
PTP_CTX_MAX_DATA_SIZE
];

243 } 
	m·m
;

245 
u8
 
	mñemít_id
;

246 
u8
 
	mÀngth
;

247 
u8
 
	md©a
[
PTP_CTX_MAX_DATA_SIZE
];

248 } 
	mtm
;

250 } 
	g__∑cked
 ;

282 
	siwl_time_msmt_nŸify
 {

283 
u8
 
	m≥î_addr
[
ETH_ALEN
];

284 
u8
 
	mª£rved
[2];

285 
__À32
 
	mdülog_tokí
;

286 
__À32
 
	mfﬁlowup_dülog_tokí
;

287 
__À32
 
	mt1_hi
;

288 
__À32
 
	mt1_lo
;

289 
__À32
 
	mt1_max_îr
;

290 
__À32
 
	mt4_hi
;

291 
__À32
 
	mt4_lo
;

292 
__À32
 
	mt4_max_îr
;

293 
__À32
 
	mt2_hi
;

294 
__À32
 
	mt2_lo
;

295 
__À32
 
	mt2_max_îr
;

296 
__À32
 
	mt3_hi
;

297 
__À32
 
	mt3_lo
;

298 
__À32
 
	mt3_max_îr
;

299 
iwl_time_msmt_±p_˘x
 
	m±p
;

300 } 
	g__∑cked
;

321 
	siwl_time_msmt_cfm_nŸify
 {

322 
u8
 
	m≥î_addr
[
ETH_ALEN
];

323 
u8
 
	mª£rved
[2];

324 
__À32
 
	mdülog_tokí
;

325 
__À32
 
	mt1_hi
;

326 
__À32
 
	mt1_lo
;

327 
__À32
 
	mt1_max_îr
;

328 
__À32
 
	mt4_hi
;

329 
__À32
 
	mt4_lo
;

330 
__À32
 
	mt4_max_îr
;

331 } 
	g__∑cked
;

336 
	siwl_ch™√l_e°im©i⁄_cfg
 {

340 
__À32
 
	mÊags
;

345 
__À32
 
	mtimî
;

350 
__À32
 
	mcou¡
;

357 
__À32
 
	møã_n_Êags_mask
;

361 
__À32
 
	møã_n_Êags_vÆ
;

365 
__À32
 
	mª£rved
;

373 
__À64
 
	m‰ame_ty≥s
;

374 } 
	g__∑cked
;

376 
	eiwl_d©≠©h_m⁄ô‹_nŸif_ty≥
 {

377 
	mIWL_DP_MON_NOTIF_TYPE_EXT_CCA
,

380 
	siwl_d©≠©h_m⁄ô‹_nŸif
 {

381 
__À32
 
	mty≥
;

382 
u8
 
	mmac_id
;

383 
u8
 
	mª£rved
[3];

384 } 
	g__∑cked
;

393 
	eiwl_thîmÆ_duÆ_chaö_ªq_evíts
 {

394 
	mTHERMAL_DUAL_CHAIN_REQ_ENABLE
,

395 
	mTHERMAL_DUAL_CHAIN_REQ_DISABLE
,

402 
	siwl_thîmÆ_duÆ_chaö_ªque°
 {

403 
__À32
 
	mevít
;

404 } 
	g__∑cked
;

406 
	eiwl_æc_chaö_öfo
 {

407 
	mIWL_RLC_CHAIN_INFO_DRIVER_FORCE
 = 
BIT
(0),

408 
	mIWL_RLC_CHAIN_INFO_VALID
 = 0x000e,

409 
	mIWL_RLC_CHAIN_INFO_FORCE
 = 0x0070,

410 
	mIWL_RLC_CHAIN_INFO_FORCE_MIMO
 = 0x0380,

411 
	mIWL_RLC_CHAIN_INFO_COUNT
 = 0x0c00,

412 
	mIWL_RLC_CHAIN_INFO_MIMO_COUNT
 = 0x3000,

420 
	siwl_æc_¥›îtõs
 {

421 
__À32
 
	mrx_chaö_öfo
;

422 
__À32
 
	mª£rved
;

423 } 
	g__∑cked
;

425 
	eiwl_ßd_mode
 {

426 
	mIWL_SAD_MODE_ENABLED
 = 
BIT
(0),

427 
	mIWL_SAD_MODE_DEFAULT_ANT_MSK
 = 0x6,

428 
	mIWL_SAD_MODE_DEFAULT_ANT_FW
 = 0x0,

429 
	mIWL_SAD_MODE_DEFAULT_ANT_A
 = 0x2,

430 
	mIWL_SAD_MODE_DEFAULT_ANT_B
 = 0x4,

440 
	siwl_ßd_¥›îtõs
 {

441 
__À32
 
	mchaö_a_ßd_mode
;

442 
__À32
 
	mchaö_b_ßd_mode
;

443 
__À32
 
	mmac_id
;

444 
__À32
 
	mª£rved
;

445 } 
	g__∑cked
;

455 
	siwl_æc_c⁄fig_cmd
 {

456 
__À32
 
	mphy_id
;

457 
iwl_æc_¥›îtõs
 
	mæc
;

458 
iwl_ßd_¥›îtõs
 
	mßd
;

459 
u8
 
	mÊags
;

460 
u8
 
	mª£rved
[3];

461 } 
	g__∑cked
;

463 
	#IWL_MAX_BAID_OLD
 16

	)

464 
	#IWL_MAX_BAID
 32

	)

472 
	eiwl_rx_baid_a˘i⁄
 {

473 
	mIWL_RX_BAID_ACTION_ADD
,

474 
	mIWL_RX_BAID_ACTION_MODIFY
,

475 
	mIWL_RX_BAID_ACTION_REMOVE
,

486 
	siwl_rx_baid_cfg_cmd_Æloc
 {

487 
__À32
 
	m°a_id_mask
;

488 
u8
 
	mtid
;

489 
u8
 
	mª£rved
[3];

490 
__À16
 
	ms¢
;

491 
__À16
 
	mwö_size
;

492 } 
	g__∑cked
;

500 
	siwl_rx_baid_cfg_cmd_modify
 {

501 
__À32
 
	mﬁd_°a_id_mask
;

502 
__À32
 
	m√w_°a_id_mask
;

503 
__À32
 
	mtid
;

504 } 
	g__∑cked
;

510 
	siwl_rx_baid_cfg_cmd_ªmove_v1
 {

511 
__À32
 
	mbaid
;

512 } 
	g__∑cked
;

519 
	siwl_rx_baid_cfg_cmd_ªmove
 {

520 
__À32
 
	m°a_id_mask
;

521 
__À32
 
	mtid
;

522 } 
	g__∑cked
;

528 
	siwl_rx_baid_cfg_cmd
 {

529 
__À32
 
	ma˘i⁄
;

531 
iwl_rx_baid_cfg_cmd_Æloc
 
	mÆloc
;

532 
iwl_rx_baid_cfg_cmd_modify
 
	mmodify
;

533 
iwl_rx_baid_cfg_cmd_ªmove_v1
 
	mªmove_v1
;

534 
iwl_rx_baid_cfg_cmd_ªmove
 
	mªmove
;

536 } 
	g__∑cked
;

542 
	siwl_rx_baid_cfg_ª•
 {

543 
__À32
 
	mbaid
;

552 
	eiwl_scd_queue_cfg_›î©i⁄
 {

553 
	mIWL_SCD_QUEUE_ADD
 = 0,

554 
	mIWL_SCD_QUEUE_REMOVE
 = 1,

555 
	mIWL_SCD_QUEUE_MODIFY
 = 2,

575 
	siwl_scd_queue_cfg_cmd
 {

576 
__À32
 
	m›î©i⁄
;

579 
__À32
 
	m°a_mask
;

580 
u8
 
	mtid
;

581 
u8
 
	mª£rved
[3];

582 
__À32
 
	mÊags
;

583 
__À32
 
	mcb_size
;

584 
__À64
 
	mbc_døm_addr
;

585 
__À64
 
	mtfdq_døm_addr
;

586 } 
__∑cked
 
	madd
;

588 
__À32
 
	m°a_mask
;

589 
__À32
 
	mtid
;

590 } 
__∑cked
 
	mªmove
;

592 
__À32
 
	mﬁd_°a_mask
;

593 
__À32
 
	mtid
;

594 
__À32
 
	m√w_°a_mask
;

595 } 
__∑cked
 
	mmodify
;

596 } 
__∑cked
 
	mu
;

597 } 
	g__∑cked
;

612 
	eiwl_£c_key_Êags
 {

613 
	mIWL_SEC_KEY_FLAG_CIPHER_MASK
 = 0x07,

614 
	mIWL_SEC_KEY_FLAG_CIPHER_WEP
 = 0x01,

615 
	mIWL_SEC_KEY_FLAG_CIPHER_CCMP
 = 0x02,

616 
	mIWL_SEC_KEY_FLAG_CIPHER_TKIP
 = 0x03,

617 
	mIWL_SEC_KEY_FLAG_CIPHER_GCMP
 = 0x05,

618 
	mIWL_SEC_KEY_FLAG_NO_TX
 = 0x08,

619 
	mIWL_SEC_KEY_FLAG_KEY_SIZE
 = 0x10,

620 
	mIWL_SEC_KEY_FLAG_MFP
 = 0x20,

621 
	mIWL_SEC_KEY_FLAG_MCAST_KEY
 = 0x40,

622 
	mIWL_SEC_KEY_FLAG_SPP_AMSDU
 = 0x80,

625 
	#IWL_SEC_WEP_KEY_OFFSET
 3

	)

646 
	siwl_£c_key_cmd
 {

647 
__À32
 
	ma˘i⁄
;

650 
__À32
 
	m°a_mask
;

651 
__À32
 
	mkey_id
;

652 
__À32
 
	mkey_Êags
;

653 
u8
 
	mkey
[32];

654 
u8
 
	mtkù_mic_rx_key
[8];

655 
u8
 
	mtkù_mic_tx_key
[8];

656 
__À64
 
	mrx_£q
;

657 
__À64
 
	mtx_£q
;

658 } 
__∑cked
 
	madd
;

660 
__À32
 
	mﬁd_°a_mask
;

661 
__À32
 
	m√w_°a_mask
;

662 
__À32
 
	mkey_id
;

663 
__À32
 
	mkey_Êags
;

664 } 
__∑cked
 
	mmodify
;

666 
__À32
 
	m°a_mask
;

667 
__À32
 
	mkey_id
;

668 
__À32
 
	mkey_Êags
;

669 } 
__∑cked
 
	mªmove
;

670 } 
__∑cked
 
	mu
;

671 } 
	g__∑cked
;

	@fw/api/dbg-tlv.h

5 #i‚de‡
__iwl_fw_dbg_év_h__


6 
	#__iwl_fw_dbg_év_h__


	)

8 
	~<löux/bô›s.h
>

10 
	#IWL_FW_INI_MAX_REGION_ID
 64

	)

11 
	#IWL_FW_INI_MAX_NAME
 32

	)

12 
	#IWL_FW_INI_MAX_CFG_NAME
 64

	)

13 
	#IWL_FW_INI_DOMAIN_ALWAYS_ON
 0

	)

14 
	#IWL_FW_INI_REGION_ID_MASK
 
	`GENMASK
(15, 0)

	)

15 
	#IWL_FW_INI_REGION_DUMP_POLICY_MASK
 
	`GENMASK
(31, 16)

	)

16 
	#IWL_FW_INI_PRESET_DISABLE
 0xff

	)

26 
	siwl_fw_öi_hcmd
 {

27 
u8
 
	mid
;

28 
u8
 
	mgroup
;

29 
__À16
 
	mª£rved
;

30 
u8
 
	md©a
[];

31 } 
	g__∑cked
;

39 
	siwl_fw_öi_hódî
 {

40 
__À32
 
	mvîsi⁄
;

41 
__À32
 
	mdomaö
;

43 } 
	g__∑cked
;

52 
	siwl_fw_öi_addr_size
 {

53 
__À32
 
	maddr
;

54 
__À32
 
	msize
;

55 } 
	g__∑cked
;

65 
	siwl_fw_öi_ªgi⁄_dev_addr_ønge
 {

66 
__À32
 
	moff£t
;

67 } 
	g__∑cked
;

75 
	siwl_fw_öi_ªgi⁄_dev_addr
 {

76 
__À32
 
	msize
;

77 
__À32
 
	moff£t
;

78 } 
	g__∑cked
;

87 
	siwl_fw_öi_ªgi⁄_fifos
 {

88 
__À32
 
	mfid
[2];

89 
__À32
 
	mhdr_⁄ly
;

90 
__À32
 
	moff£t
;

91 } 
	g__∑cked
;

103 
	siwl_fw_öi_ªgi⁄_îr_èbÀ
 {

104 
__À32
 
	mvîsi⁄
;

105 
__À32
 
	mba£_addr
;

106 
__À32
 
	msize
;

107 
__À32
 
	moff£t
;

108 } 
	g__∑cked
;

121 
	siwl_fw_öi_ªgi⁄_•ecül_devi˚_mem‹y
 {

122 
__À16
 
	mty≥
;

123 
__À16
 
	mvîsi⁄
;

124 
__À32
 
	mba£_addr
;

125 
__À32
 
	msize
;

126 
__À32
 
	moff£t
;

127 } 
	g__∑cked
;

138 
	siwl_fw_öi_ªgi⁄_öã∫Æ_buf„r
 {

139 
__À32
 
	mÆloc_id
;

140 
__À32
 
	mba£_addr
;

141 
__À32
 
	msize
;

142 } 
	g__∑cked
;

178 
	siwl_fw_öi_ªgi⁄_év
 {

179 
iwl_fw_öi_hódî
 
	mhdr
;

180 
__À32
 
	mid
;

181 
u8
 
	mty≥
;

182 
u8
 
	msub_ty≥
;

183 
u8
 
	msub_ty≥_vî
;

184 
u8
 
	mª£rved
;

185 
u8
 
	m«me
[
IWL_FW_INI_MAX_NAME
];

187 
iwl_fw_öi_ªgi⁄_dev_addr
 
	mdev_addr
;

188 
iwl_fw_öi_ªgi⁄_dev_addr_ønge
 
	mdev_addr_ønge
;

189 
iwl_fw_öi_ªgi⁄_fifos
 
	mfifos
;

190 
iwl_fw_öi_ªgi⁄_îr_èbÀ
 
	mîr_èbÀ
;

191 
iwl_fw_öi_ªgi⁄_öã∫Æ_buf„r
 
	möã∫Æ_buf„r
;

192 
iwl_fw_öi_ªgi⁄_•ecül_devi˚_mem‹y
 
	m•ecül_mem
;

193 
__À32
 
	mdøm_Æloc_id
;

194 
__À32
 
	mév_mask
;

196 
__À32
 
	maddrs
[];

197 } 
	g__∑cked
;

208 
	siwl_fw_öi_debug_öfo_év
 {

209 
iwl_fw_öi_hódî
 
	mhdr
;

210 
__À32
 
	mimage_ty≥
;

211 
u8
 
	mdebug_cfg_«me
[
IWL_FW_INI_MAX_CFG_NAME
];

212 } 
	g__∑cked
;

224 
	siwl_fw_öi_Æloˇti⁄_év
 {

225 
iwl_fw_öi_hódî
 
	mhdr
;

226 
__À32
 
	mÆloc_id
;

227 
__À32
 
	mbuf_loˇti⁄
;

228 
__À32
 
	mªq_size
;

229 
__À32
 
	mmax_‰ags_num
;

230 
__À32
 
	mmö_size
;

231 } 
	g__∑cked
;

251 
	siwl_fw_öi_åiggî_év
 {

252 
iwl_fw_öi_hódî
 
	mhdr
;

253 
__À32
 
	mtime_poöt
;

254 
__À32
 
	måiggî_ªas⁄
;

255 
__À32
 
	m≠∂y_pﬁicy
;

256 
__À32
 
	mdump_dñay
;

257 
__À32
 
	moccuºí˚s
;

258 
__À32
 
	mª£rved
;

259 
__À32
 
	mign‹e_c⁄£c
;

260 
__À32
 
	mª£t_fw
;

261 
__À32
 
	mmu…i_dut
;

262 
__À64
 
	mªgi⁄s_mask
;

263 
__À32
 
	md©a
[];

264 } 
	g__∑cked
;

275 
	siwl_fw_öi_hcmd_év
 {

276 
iwl_fw_öi_hódî
 
	mhdr
;

277 
__À32
 
	mtime_poöt
;

278 
__À32
 
	m≥riod_m£c
;

279 
iwl_fw_öi_hcmd
 
	mhcmd
;

280 } 
	g__∑cked
;

288 
	siwl_fw_öi_addr_vÆ
 {

289 
__À32
 
	maddªss
;

290 
__À32
 
	mvÆue
;

291 } 
	g__∑cked
;

303 
	siwl_fw_öi_c⁄f_£t_év
 {

304 
iwl_fw_öi_hódî
 
	mhdr
;

305 
__À32
 
	mtime_poöt
;

306 
__À32
 
	m£t_ty≥
;

307 
__À32
 
	maddr_off£t
;

308 
iwl_fw_öi_addr_vÆ
 
	maddr_vÆ
[];

309 } 
	g__∑cked
;

325 
	eiwl_fw_öi_c⁄fig_£t_ty≥
 {

326 
	mIWL_FW_INI_CONFIG_SET_TYPE_INVALID
 = 0,

327 
	mIWL_FW_INI_CONFIG_SET_TYPE_DEVICE_PERIPHERY_MAC
,

328 
	mIWL_FW_INI_CONFIG_SET_TYPE_DEVICE_PERIPHERY_PHY
,

329 
	mIWL_FW_INI_CONFIG_SET_TYPE_DEVICE_PERIPHERY_AUX
,

330 
	mIWL_FW_INI_CONFIG_SET_TYPE_DEVICE_MEMORY
,

331 
	mIWL_FW_INI_CONFIG_SET_TYPE_CSR
,

332 
	mIWL_FW_INI_CONFIG_SET_TYPE_DBGC_DRAM_ADDR
,

333 
	mIWL_FW_INI_CONFIG_SET_TYPE_PERIPH_SCRATCH_HWM
,

334 
	mIWL_FW_INI_CONFIG_SET_TYPE_MAX_NUM
,

335 } 
	g__∑cked
;

347 
	eiwl_fw_öi_Æloˇti⁄_id
 {

348 
	mIWL_FW_INI_ALLOCATION_INVALID
,

349 
	mIWL_FW_INI_ALLOCATION_ID_DBGC1
,

350 
	mIWL_FW_INI_ALLOCATION_ID_DBGC2
,

351 
	mIWL_FW_INI_ALLOCATION_ID_DBGC3
,

352 
	mIWL_FW_INI_ALLOCATION_ID_DBGC4
,

353 
	mIWL_FW_INI_ALLOCATION_NUM
,

365 
	eiwl_fw_öi_buf„r_loˇti⁄
 {

366 
	mIWL_FW_INI_LOCATION_INVALID
,

367 
	mIWL_FW_INI_LOCATION_SRAM_PATH
,

368 
	mIWL_FW_INI_LOCATION_DRAM_PATH
,

369 
	mIWL_FW_INI_LOCATION_NPK_PATH
,

370 
	mIWL_FW_INI_LOCATION_NUM
,

400 
	eiwl_fw_öi_ªgi⁄_ty≥
 {

401 
	mIWL_FW_INI_REGION_INVALID
,

402 
	mIWL_FW_INI_REGION_TLV
,

403 
	mIWL_FW_INI_REGION_INTERNAL_BUFFER
,

404 
	mIWL_FW_INI_REGION_DRAM_BUFFER
,

405 
	mIWL_FW_INI_REGION_TXF
,

406 
	mIWL_FW_INI_REGION_RXF
,

407 
	mIWL_FW_INI_REGION_LMAC_ERROR_TABLE
,

408 
	mIWL_FW_INI_REGION_UMAC_ERROR_TABLE
,

409 
	mIWL_FW_INI_REGION_RSP_OR_NOTIF
,

410 
	mIWL_FW_INI_REGION_DEVICE_MEMORY
,

411 
	mIWL_FW_INI_REGION_PERIPHERY_MAC
,

412 
	mIWL_FW_INI_REGION_PERIPHERY_PHY
,

413 
	mIWL_FW_INI_REGION_PERIPHERY_AUX
,

414 
	mIWL_FW_INI_REGION_PAGING
,

415 
	mIWL_FW_INI_REGION_CSR
,

416 
	mIWL_FW_INI_REGION_DRAM_IMR
,

417 
	mIWL_FW_INI_REGION_PCI_IOSF_CONFIG
,

418 
	mIWL_FW_INI_REGION_SPECIAL_DEVICE_MEMORY
,

419 
	mIWL_FW_INI_REGION_DBGI_SRAM
,

420 
	mIWL_FW_INI_REGION_PERIPHERY_MAC_RANGE
,

421 
	mIWL_FW_INI_REGION_PERIPHERY_PHY_RANGE
,

422 
	mIWL_FW_INI_REGION_PERIPHERY_SNPS_DPHYIP
,

423 
	mIWL_FW_INI_REGION_NUM


426 
	eiwl_fw_öi_ªgi⁄_devi˚_mem‹y_subty≥
 {

427 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_HW_SMEM
 = 1,

428 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_UMAC_ERROR_TABLE
 = 5,

429 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_LMAC_1_ERROR_TABLE
 = 7,

430 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_LMAC_2_ERROR_TABLE
 = 10,

431 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_TCM_1_ERROR_TABLE
 = 14,

432 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_TCM_2_ERROR_TABLE
 = 16,

433 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_RCM_1_ERROR_TABLE
 = 18,

434 
	mIWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_RCM_2_ERROR_TABLE
 = 20,

475 
	eiwl_fw_öi_time_poöt
 {

476 
	mIWL_FW_INI_TIME_POINT_INVALID
,

477 
	mIWL_FW_INI_TIME_POINT_EARLY
,

478 
	mIWL_FW_INI_TIME_POINT_AFTER_ALIVE
,

479 
	mIWL_FW_INI_TIME_POINT_POST_INIT
,

480 
	mIWL_FW_INI_TIME_POINT_FW_ASSERT
,

481 
	mIWL_FW_INI_TIME_POINT_FW_HW_ERROR
,

482 
	mIWL_FW_INI_TIME_POINT_FW_TFD_Q_HANG
,

483 
	mIWL_FW_INI_TIME_POINT_FW_DHC_NOTIFICATION
,

484 
	mIWL_FW_INI_TIME_POINT_FW_RSP_OR_NOTIF
,

485 
	mIWL_FW_INI_TIME_POINT_USER_TRIGGER
,

486 
	mIWL_FW_INI_TIME_POINT_PERIODIC
,

487 
	mIWL_FW_INI_TIME_POINT_RESERVED
,

488 
	mIWL_FW_INI_TIME_POINT_HOST_ASSERT
,

489 
	mIWL_FW_INI_TIME_POINT_HOST_ALIVE_TIMEOUT
,

490 
	mIWL_FW_INI_TIME_POINT_HOST_DEVICE_ENABLE
,

491 
	mIWL_FW_INI_TIME_POINT_HOST_DEVICE_DISABLE
,

492 
	mIWL_FW_INI_TIME_POINT_HOST_D3_START
,

493 
	mIWL_FW_INI_TIME_POINT_HOST_D3_END
,

494 
	mIWL_FW_INI_TIME_POINT_MISSED_BEACONS
,

495 
	mIWL_FW_INI_TIME_POINT_ASSOC_FAILED
,

496 
	mIWL_FW_INI_TIME_POINT_TX_FAILED
,

497 
	mIWL_FW_INI_TIME_POINT_TX_WFD_ACTION_FRAME_FAILED
,

498 
	mIWL_FW_INI_TIME_POINT_TX_LATENCY_THRESHOLD
,

499 
	mIWL_FW_INI_TIME_POINT_HANG_OCCURRED
,

500 
	mIWL_FW_INI_TIME_POINT_EAPOL_FAILED
,

501 
	mIWL_FW_INI_TIME_POINT_FAKE_TX
,

502 
	mIWL_FW_INI_TIME_POINT_DEASSOC
,

503 
	mIWL_FW_INI_TIME_POINT_NUM
,

518 
	eiwl_fw_öi_åiggî_≠∂y_pﬁicy
 {

519 
	mIWL_FW_INI_APPLY_POLICY_MATCH_TIME_POINT
 = 
BIT
(0),

520 
	mIWL_FW_INI_APPLY_POLICY_MATCH_DATA
 = 
BIT
(1),

521 
	mIWL_FW_INI_APPLY_POLICY_OVERRIDE_REGIONS
 = 
BIT
(8),

522 
	mIWL_FW_INI_APPLY_POLICY_OVERRIDE_CFG
 = 
BIT
(9),

523 
	mIWL_FW_INI_APPLY_POLICY_OVERRIDE_DATA
 = 
BIT
(10),

524 
	mIWL_FW_INI_APPLY_POLICY_DUMP_COMPLETE_CMD
 = 
BIT
(16),

534 
	eiwl_fw_öi_åiggî_ª£t_fw_pﬁicy
 {

535 
	mIWL_FW_INI_RESET_FW_MODE_NOTHING
 = 0,

536 
	mIWL_FW_INI_RESET_FW_MODE_STOP_FW_ONLY
,

537 
	mIWL_FW_INI_RESET_FW_MODE_STOP_AND_RELOAD_FW


547 
	eiwl_fw_öi_dump_pﬁicy
 {

548 
	mIWL_FW_INI_DEBUG_DUMP_POLICY_NO_LIMIT
 = 
BIT
(0),

549 
	mIWL_FW_INI_DEBUG_DUMP_POLICY_MAX_LIMIT_600KB
 = 
BIT
(1),

550 
	mIWL_FW_IWL_DEBUG_DUMP_POLICY_MAX_LIMIT_5MB
 = 
BIT
(2),

561 
	eiwl_fw_öi_dump_ty≥
 {

562 
	mIWL_FW_INI_DUMP_BRIEF
,

563 
	mIWL_FW_INI_DUMP_MEDIUM
,

564 
	mIWL_FW_INI_DUMP_VERBOSE
,

	@fw/api/debug.h

7 #i‚de‡
__iwl_fw_≠i_debug_h__


8 
	#__iwl_fw_≠i_debug_h__


	)

13 
	eiwl_debug_cmds
 {

19 
	mLMAC_RD_WR
 = 0x0,

25 
	mUMAC_RD_WR
 = 0x1,

31 
	mHOST_EVENT_CFG
 = 0x3,

36 
	mINVALID_WR_PTR_CMD
 = 0x6,

43 
	mDBGC_SUSPEND_RESUME
 = 0x7,

49 
	mBUFFER_ALLOCATION
 = 0x8,

55 
	mGET_TAS_STATUS
 = 0xA,

61 
	mFW_DUMP_COMPLETE_CMD
 = 0xB,

67 
	mFW_CLEAR_BUFFER
 = 0xD,

72 
	mMFU_ASSERT_DUMP_NTF
 = 0xFE,

77 
	mFW_ERR_UNKNOWN_CMD
 = 0x0,

78 
	mFW_ERR_INVALID_CMD_PARAM
 = 0x1,

79 
	mFW_ERR_SERVICE
 = 0x2,

80 
	mFW_ERR_ARC_MEMORY
 = 0x3,

81 
	mFW_ERR_ARC_CODE
 = 0x4,

82 
	mFW_ERR_WATCH_DOG
 = 0x5,

83 
	mFW_ERR_WEP_GRP_KEY_INDX
 = 0x10,

84 
	mFW_ERR_WEP_KEY_SIZE
 = 0x11,

85 
	mFW_ERR_OBSOLETE_FUNC
 = 0x12,

86 
	mFW_ERR_UNEXPECTED
 = 0xFE,

87 
	mFW_ERR_FATAL
 = 0xFF

95 
	eiwl_dbg_su•íd_ªsume_cmds
 {

96 
	mDBGC_RESUME_CMD
,

97 
	mDBGC_SUSPEND_CMD
,

111 
	siwl_îr‹_ª•
 {

112 
__À32
 
	mîr‹_ty≥
;

113 
u8
 
	mcmd_id
;

114 
u8
 
	mª£rved1
;

115 
__À16
 
	mbad_cmd_£q_num
;

116 
__À32
 
	mîr‹_£rvi˚
;

117 
__À64
 
	mtime°amp
;

118 } 
	g__∑cked
;

120 
	#TX_FIFO_MAX_NUM_9000
 8

	)

121 
	#TX_FIFO_MAX_NUM
 15

	)

122 
	#RX_FIFO_MAX_NUM
 2

	)

123 
	#TX_FIFO_INTERNAL_MAX_NUM
 6

	)

148 
	siwl_sh¨ed_mem_cfg_v2
 {

149 
__À32
 
	msh¨ed_mem_addr
;

150 
__À32
 
	msh¨ed_mem_size
;

151 
__À32
 
	mßm∂e_buff_addr
;

152 
__À32
 
	mßm∂e_buff_size
;

153 
__À32
 
	mtxfifo_addr
;

154 
__À32
 
	mtxfifo_size
[
TX_FIFO_MAX_NUM_9000
];

155 
__À32
 
	mrxfifo_size
[
RX_FIFO_MAX_NUM
];

156 
__À32
 
	m∑ge_buff_addr
;

157 
__À32
 
	m∑ge_buff_size
;

158 
__À32
 
	mrxfifo_addr
;

159 
__À32
 
	möã∫Æ_txfifo_addr
;

160 
__À32
 
	möã∫Æ_txfifo_size
[
TX_FIFO_INTERNAL_MAX_NUM
];

161 } 
	g__∑cked
;

171 
	siwl_sh¨ed_mem_lmac_cfg
 {

172 
__À32
 
	mtxfifo_addr
;

173 
__À32
 
	mtxfifo_size
[
TX_FIFO_MAX_NUM
];

174 
__À32
 
	mrxfifo1_addr
;

175 
__À32
 
	mrxfifo1_size
;

177 } 
	g__∑cked
;

196 
	siwl_sh¨ed_mem_cfg
 {

197 
__À32
 
	msh¨ed_mem_addr
;

198 
__À32
 
	msh¨ed_mem_size
;

199 
__À32
 
	mßm∂e_buff_addr
;

200 
__À32
 
	mßm∂e_buff_size
;

201 
__À32
 
	mrxfifo2_addr
;

202 
__À32
 
	mrxfifo2_size
;

203 
__À32
 
	m∑ge_buff_addr
;

204 
__À32
 
	m∑ge_buff_size
;

205 
__À32
 
	mlmac_num
;

206 
iwl_sh¨ed_mem_lmac_cfg
 
	mlmac_smem
[3];

207 
__À32
 
	mrxfifo2_c⁄åﬁ_addr
;

208 
__À32
 
	mrxfifo2_c⁄åﬁ_size
;

209 } 
	g__∑cked
;

219 
	siwl_mfu¨t_lﬂd_nŸif_v1
 {

220 
__À32
 
	mö°ÆÀd_vî
;

221 
__À32
 
	mexã∫Æ_vî
;

222 
__À32
 
	m°©us
;

223 
__À32
 
	mduøti⁄
;

224 } 
	g__∑cked
;

235 
	siwl_mfu¨t_lﬂd_nŸif
 {

236 
__À32
 
	mö°ÆÀd_vî
;

237 
__À32
 
	mexã∫Æ_vî
;

238 
__À32
 
	m°©us
;

239 
__À32
 
	mduøti⁄
;

241 
__À32
 
	mimage_size
;

242 } 
	g__∑cked
;

254 
	siwl_mfu_as£π_dump_nŸif
 {

255 
__À32
 
	mas£π_id
;

256 
__À32
 
	mcuº_ª£t_num
;

257 
__À16
 
	mödex_num
;

258 
__À16
 
	m∑πs_num
;

259 
__À32
 
	md©a_size
;

260 
__À32
 
	md©a
[];

261 } 
	g__∑cked
;

271 
	eiwl_mvm_m¨kî_id
 {

272 
	mMARKER_ID_TX_FRAME_LATENCY
 = 1,

273 
	mMARKER_ID_SYNC_CLOCK
 = 2,

291 
	siwl_mvm_m¨kî
 {

292 
u8
 
	mdw_Àn
;

293 
u8
 
	mm¨kî_id
;

294 
__À16
 
	mª£rved
;

295 
__À64
 
	mtime°amp
;

296 
__À32
 
	mmëad©a
[];

297 } 
	g__∑cked
;

304 
	siwl_mvm_m¨kî_r•
 {

305 
__À32
 
	mgp2
;

306 } 
	g__∑cked
;

310 
	mDEBUG_MEM_OP_READ
 = 0,

311 
	mDEBUG_MEM_OP_WRITE
 = 1,

312 
	mDEBUG_MEM_OP_WRITE_BYTES
 = 2,

315 
	#DEBUG_MEM_MAX_SIZE_DWORDS
 32

	)

324 
	siwl_dbg_mem_ac˚ss_cmd
 {

325 
__À32
 
	m›
;

326 
__À32
 
	maddr
;

327 
__À32
 
	mÀn
;

328 
__À32
 
	md©a
[];

329 } 
	g__∑cked
;

333 
	mDEBUG_MEM_STATUS_SUCCESS
 = 0x0,

334 
	mDEBUG_MEM_STATUS_FAILED
 = 0x1,

335 
	mDEBUG_MEM_STATUS_LOCKED
 = 0x2,

336 
	mDEBUG_MEM_STATUS_HIDDEN
 = 0x3,

337 
	mDEBUG_MEM_STATUS_LENGTH
 = 0x4,

346 
	siwl_dbg_mem_ac˚ss_r•
 {

347 
__À32
 
	m°©us
;

348 
__À32
 
	mÀn
;

349 
__À32
 
	md©a
[];

350 } 
	g__∑cked
;

357 
	siwl_dbg_su•íd_ªsume_cmd
 {

358 
__À32
 
	m›î©i⁄
;

359 } 
	g__∑cked
;

361 
	#BUF_ALLOC_MAX_NUM_FRAGS
 16

	)

368 
	siwl_buf_Æloc_‰ag
 {

369 
__À64
 
	maddr
;

370 
__À32
 
	msize
;

371 } 
	g__∑cked
;

380 
	siwl_buf_Æloc_cmd
 {

381 
__À32
 
	mÆloc_id
;

382 
__À32
 
	mbuf_loˇti⁄
;

383 
__À32
 
	mnum_‰ags
;

384 
iwl_buf_Æloc_‰ag
 
	m‰ags
[
BUF_ALLOC_MAX_NUM_FRAGS
];

385 } 
	g__∑cked
;

387 
	#DRAM_INFO_FIRST_MAGIC_WORD
 0x76543210

	)

388 
	#DRAM_INFO_SECOND_MAGIC_WORD
 0x89ABCDEF

	)

399 
	siwl_døm_öfo
 {

400 
__À32
 
	mfú°_w‹d
;

401 
__À32
 
	m£c⁄d_w‹d
;

402 
iwl_buf_Æloc_cmd
 
	mdøm_‰ags
[
IWL_FW_INI_ALLOCATION_NUM
 - 1];

403 } 
	g__∑cked
;

415 
	siwl_dbgc1_öfo
 {

416 
__À32
 
	mfú°_w‹d
;

417 
__À32
 
	mdbgc1_add_lsb
;

418 
__À32
 
	mdbgc1_add_msb
;

419 
__À32
 
	mdbgc1_size
;

420 } 
	g__∑cked
;

426 
	siwl_dbg_ho°_evít_cfg_cmd
 {

427 
__À32
 
	míabÀd_£vîôõs
;

428 } 
	g__∑cked
;

436 
	siwl_dbg_dump_com∂ëe_cmd
 {

437 
__À32
 
	mç
;

438 
__À32
 
	mç_d©a
;

439 } 
	g__∑cked
;

441 
	#TAS_LMAC_BAND_HB
 0

	)

442 
	#TAS_LMAC_BAND_LB
 1

	)

443 
	#TAS_LMAC_BAND_UHB
 2

	)

444 
	#TAS_LMAC_BAND_INVALID
 3

	)

459 
	siwl_mvm_ès_°©us_≥r_mac
 {

460 
u8
 
	m°©ic_°©us
;

461 
u8
 
	m°©ic_dis_ªas⁄
;

462 
u8
 
	mdy«mic_°©us
;

463 
u8
 
	m√¨_disc⁄√˘i⁄
;

464 
__À16
 
	mmax_ªg_pwr_limô
;

465 
__À16
 
	mßr_limô
;

466 
u8
 
	mb™d
;

467 
u8
 
	mª£rved
[3];

468 } 
	g__∑cked
;

481 
	siwl_mvm_ès_°©us_ª•
 {

482 
u8
 
	mès_fw_vîsi⁄
;

483 
u8
 
	mis_uhb_f‹_uß_íabÀ
;

484 
__À16
 
	mcuº_mcc
;

485 
__À16
 
	mblock_li°
[16];

486 
iwl_mvm_ès_°©us_≥r_mac
 
	mès_°©us_mac
[2];

487 
u8
 
	mö_duÆ_ødio
;

488 
u8
 
	mª£rved
[3];

489 } 
	g__∑cked
;

505 
	eiwl_mvm_ès_dy«_°©us
 {

506 
	mTAS_DYNA_INACTIVE
,

507 
	mTAS_DYNA_INACTIVE_MVM_MODE
,

508 
	mTAS_DYNA_INACTIVE_TRIGGER_MODE
,

509 
	mTAS_DYNA_INACTIVE_BLOCK_LISTED
,

510 
	mTAS_DYNA_INACTIVE_UHB_NON_US
,

511 
	mTAS_DYNA_ACTIVE
,

513 
	mTAS_DYNA_STATUS_MAX
,

523 
	eiwl_mvm_ès_°©iˇŒy_dißbÀd_ªas⁄
 {

524 
	mTAS_DISABLED_DUE_TO_BIOS
,

525 
	mTAS_DISABLED_DUE_TO_SAR_6DBM
,

526 
	mTAS_DISABLED_REASON_INVALID
,

528 
	mTAS_DISABLED_REASON_MAX
,

535 
	eiwl_fw_dbg_c⁄fig_cmd_ty≥
 {

536 
	mDEBUG_TOKEN_CONFIG_TYPE
 = 0x2B,

540 
	#IWL_FW_DBG_CONFIG_TOKEN
 0x00010001

	)

548 
	siwl_fw_dbg_c⁄fig_cmd
 {

549 
__À32
 
	mty≥
;

550 
__À32
 
	mc⁄f
;

551 } 
	g__∑cked
;

	@fw/api/filter.h

7 #i‚de‡
__iwl_fw_≠i_fûãr_h__


8 
	#__iwl_fw_≠i_fûãr_h__


	)

10 
	~"fw/≠i/mac.h
"

12 
	#MAX_PORT_ID_NUM
 2

	)

13 
	#MAX_MCAST_FILTERING_ADDRESSES
 256

	)

29 
	siwl_mˇ°_fûãr_cmd
 {

30 
u8
 
	mfûãr_own
;

31 
u8
 
	mp‹t_id
;

32 
u8
 
	mcou¡
;

33 
u8
 
	m∑ss_Æl
;

34 
u8
 
	mbssid
[6];

35 
u8
 
	mª£rved
[2];

36 
u8
 
	maddr_li°
[];

37 } 
	g__∑cked
;

	@fw/api/led.h

5 #i‚de‡
__iwl_fw_≠i_Àd_h__


6 
	#__iwl_fw_≠i_Àd_h__


	)

13 
	siwl_Àd_cmd
 {

14 
__À32
 
	m°©us
;

15 } 
	g__∑cked
;

	@fw/api/location.h

6 #i‚de‡
__iwl_fw_≠i_loˇti⁄_h__


7 
	#__iwl_fw_≠i_loˇti⁄_h__


	)

12 
	eiwl_loˇti⁄_subcmd_ids
 {

22 
	mTOF_RANGE_REQ_CMD
 = 0x0,

26 
	mTOF_CONFIG_CMD
 = 0x1,

31 
	mTOF_RANGE_ABORT_CMD
 = 0x2,

36 
	mTOF_RANGE_REQ_EXT_CMD
 = 0x3,

44 
	mTOF_RESPONDER_CONFIG_CMD
 = 0x4,

49 
	mTOF_RESPONDER_DYN_CONFIG_CMD
 = 0x5,

53 
	mCSI_HEADER_NOTIFICATION
 = 0xFA,

58 
	mCSI_CHUNKS_NOTIFICATION
 = 0xFB,

63 
	mTOF_LC_NOTIF
 = 0xFC,

68 
	mTOF_RESPONDER_STATS
 = 0xFD,

73 
	mTOF_MCSI_DEBUG_NOTIF
 = 0xFE,

81 
	mTOF_RANGE_RESPONSE_NOTIF
 = 0xFF,

91 
	siwl_tof_c⁄fig_cmd
 {

92 
u8
 
	mtof_dißbÀd
;

93 
u8
 
	m⁄e_sided_dißbÀd
;

94 
u8
 
	mis_debug_mode
;

95 
u8
 
	mis_buf_ªquúed
;

96 } 
	g__∑cked
;

107 
	eiwl_tof_b™dwidth
 {

108 
	mIWL_TOF_BW_20_LEGACY
,

109 
	mIWL_TOF_BW_20_HT
,

110 
	mIWL_TOF_BW_40
,

111 
	mIWL_TOF_BW_80
,

112 
	mIWL_TOF_BW_160
,

113 
	mIWL_TOF_BW_NUM
,

119 
	eiwl_tof_Ægo_ty≥
 {

120 
	mIWL_TOF_ALGO_TYPE_MAX_LIKE
 = 0,

121 
	mIWL_TOF_ALGO_TYPE_LINEAR_REG
 = 1,

122 
	mIWL_TOF_ALGO_TYPE_FFT
 = 2,

125 
	mIWL_TOF_ALGO_TYPE_INVALID
,

131 
	eiwl_tof_mcsi_íabÀ
 {

132 
	mIWL_TOF_MCSI_DISABLED
 = 0,

133 
	mIWL_TOF_MCSI_ENABLED
 = 1,

165 
	eiwl_tof_ª•⁄dî_cmd_vÆid_fõld
 {

166 
	mIWL_TOF_RESPONDER_CMD_VALID_CHAN_INFO
 = 
BIT
(0),

167 
	mIWL_TOF_RESPONDER_CMD_VALID_TOA_OFFSET
 = 
BIT
(1),

168 
	mIWL_TOF_RESPONDER_CMD_VALID_COMMON_CALIB
 = 
BIT
(2),

169 
	mIWL_TOF_RESPONDER_CMD_VALID_SPECIFIC_CALIB
 = 
BIT
(3),

170 
	mIWL_TOF_RESPONDER_CMD_VALID_BSSID
 = 
BIT
(4),

171 
	mIWL_TOF_RESPONDER_CMD_VALID_TX_ANT
 = 
BIT
(5),

172 
	mIWL_TOF_RESPONDER_CMD_VALID_ALGO_TYPE
 = 
BIT
(6),

173 
	mIWL_TOF_RESPONDER_CMD_VALID_NON_ASAP_SUPPORT
 = 
BIT
(7),

174 
	mIWL_TOF_RESPONDER_CMD_VALID_STATISTICS_REPORT_SUPPORT
 = 
BIT
(8),

175 
	mIWL_TOF_RESPONDER_CMD_VALID_MCSI_NOTIF_SUPPORT
 = 
BIT
(9),

176 
	mIWL_TOF_RESPONDER_CMD_VALID_FAST_ALGO_SUPPORT
 = 
BIT
(10),

177 
	mIWL_TOF_RESPONDER_CMD_VALID_RETRY_ON_ALGO_FAIL
 = 
BIT
(11),

178 
	mIWL_TOF_RESPONDER_CMD_VALID_STA_ID
 = 
BIT
(12),

179 
	mIWL_TOF_RESPONDER_CMD_VALID_NDP_SUPPORT
 = 
BIT
(22),

180 
	mIWL_TOF_RESPONDER_CMD_VALID_NDP_PARAMS
 = 
BIT
(23),

181 
	mIWL_TOF_RESPONDER_CMD_VALID_LMR_FEEDBACK
 = 
BIT
(24),

182 
	mIWL_TOF_RESPONDER_CMD_VALID_SESSION_ID
 = 
BIT
(25),

183 
	mIWL_TOF_RESPONDER_CMD_VALID_BSS_COLOR
 = 
BIT
(26),

184 
	mIWL_TOF_RESPONDER_CMD_VALID_MIN_MAX_TIME_BETWEEN_MSR
 = 
BIT
(27),

205 
	eiwl_tof_ª•⁄dî_cfg_Êags
 {

206 
	mIWL_TOF_RESPONDER_FLAGS_NON_ASAP_SUPPORT
 = 
BIT
(0),

207 
	mIWL_TOF_RESPONDER_FLAGS_REPORT_STATISTICS
 = 
BIT
(1),

208 
	mIWL_TOF_RESPONDER_FLAGS_REPORT_MCSI
 = 
BIT
(2),

209 
	mIWL_TOF_RESPONDER_FLAGS_ALGO_TYPE
 = 
BIT
(3) | BIT(4) | BIT(5),

210 
	mIWL_TOF_RESPONDER_FLAGS_TOA_OFFSET_MODE
 = 
BIT
(6),

211 
	mIWL_TOF_RESPONDER_FLAGS_COMMON_CALIB_MODE
 = 
BIT
(7),

212 
	mIWL_TOF_RESPONDER_FLAGS_SPECIFIC_CALIB_MODE
 = 
BIT
(8),

213 
	mIWL_TOF_RESPONDER_FLAGS_FAST_ALGO_SUPPORT
 = 
BIT
(9),

214 
	mIWL_TOF_RESPONDER_FLAGS_RETRY_ON_ALGO_FAIL
 = 
BIT
(10),

215 
	mIWL_TOF_RESPONDER_FLAGS_FTM_TX_ANT
 = 
RATE_MCS_ANT_AB_MSK
,

216 
	mIWL_TOF_RESPONDER_FLAGS_NDP_SUPPORT
 = 
BIT
(24),

217 
	mIWL_TOF_RESPONDER_FLAGS_LMR_FEEDBACK
 = 
BIT
(25),

218 
	mIWL_TOF_RESPONDER_FLAGS_SESSION_ID
 = 
BIT
(27),

240 
	siwl_tof_ª•⁄dî_c⁄fig_cmd_v6
 {

241 
__À32
 
	mcmd_vÆid_fõlds
;

242 
__À32
 
	mª•⁄dî_cfg_Êags
;

243 
u8
 
	mb™dwidth
;

244 
u8
 
	møã
;

245 
u8
 
	mch™√l_num
;

246 
u8
 
	m˘æ_ch_posôi⁄
;

247 
u8
 
	m°a_id
;

248 
u8
 
	mª£rved1
;

249 
__À16
 
	mtﬂ_off£t
;

250 
__À16
 
	mcomm⁄_ˇlib
;

251 
__À16
 
	m•ecific_ˇlib
;

252 
u8
 
	mbssid
[
ETH_ALEN
];

253 
__À16
 
	mª£rved2
;

254 } 
	g__∑cked
;

276 
	siwl_tof_ª•⁄dî_c⁄fig_cmd_v7
 {

277 
__À32
 
	mcmd_vÆid_fõlds
;

278 
__À32
 
	mª•⁄dî_cfg_Êags
;

279 
u8
 
	mf‹m©_bw
;

280 
u8
 
	møã
;

281 
u8
 
	mch™√l_num
;

282 
u8
 
	m˘æ_ch_posôi⁄
;

283 
u8
 
	m°a_id
;

284 
u8
 
	mª£rved1
;

285 
__À16
 
	mtﬂ_off£t
;

286 
__À16
 
	mcomm⁄_ˇlib
;

287 
__À16
 
	m•ecific_ˇlib
;

288 
u8
 
	mbssid
[
ETH_ALEN
];

289 
__À16
 
	mª£rved2
;

290 } 
	g__∑cked
;

292 
	#IWL_RESPONDER_STS_POS
 3

	)

293 
	#IWL_RESPONDER_TOTAL_LTF_POS
 6

	)

324 
	siwl_tof_ª•⁄dî_c⁄fig_cmd_v8
 {

325 
__À32
 
	mcmd_vÆid_fõlds
;

326 
__À32
 
	mª•⁄dî_cfg_Êags
;

327 
u8
 
	mf‹m©_bw
;

328 
u8
 
	møã
;

329 
u8
 
	mch™√l_num
;

330 
u8
 
	m˘æ_ch_posôi⁄
;

331 
u8
 
	m°a_id
;

332 
u8
 
	mª£rved1
;

333 
__À16
 
	mtﬂ_off£t
;

334 
__À16
 
	mcomm⁄_ˇlib
;

335 
__À16
 
	m•ecific_ˇlib
;

336 
u8
 
	mbssid
[
ETH_ALEN
];

337 
u8
 
	mr2i_ndp_∑øms
;

338 
u8
 
	mi2r_ndp_∑øms
;

339 } 
	g__∑cked
;

374 
	siwl_tof_ª•⁄dî_c⁄fig_cmd_v9
 {

375 
__À32
 
	mcmd_vÆid_fõlds
;

376 
__À32
 
	mª•⁄dî_cfg_Êags
;

377 
u8
 
	mf‹m©_bw
;

378 
u8
 
	mbss_cﬁ‹
;

379 
u8
 
	mch™√l_num
;

380 
u8
 
	m˘æ_ch_posôi⁄
;

381 
u8
 
	m°a_id
;

382 
u8
 
	mª£rved1
;

383 
__À16
 
	mtﬂ_off£t
;

384 
__À16
 
	mcomm⁄_ˇlib
;

385 
__À16
 
	m•ecific_ˇlib
;

386 
u8
 
	mbssid
[
ETH_ALEN
];

387 
u8
 
	mr2i_ndp_∑øms
;

388 
u8
 
	mi2r_ndp_∑øms
;

389 
__À16
 
	mmö_time_bëwìn_m§
;

390 
__À16
 
	mmax_time_bëwìn_m§
;

391 } 
	g__∑cked
;

393 
	#IWL_LCI_CIVIC_IE_MAX_SIZE
 400

	)

404 
	siwl_tof_ª•⁄dî_dyn_c⁄fig_cmd_v2
 {

405 
__À32
 
	mlci_Àn
;

406 
__À32
 
	mcivic_Àn
;

407 
u8
 
	mlci_civic
[];

408 } 
	g__∑cked
;

410 
	#IWL_LCI_MAX_SIZE
 160

	)

411 
	#IWL_CIVIC_MAX_SIZE
 160

	)

412 
	#HLTK_11AZ_LEN
 32

	)

421 
	eiwl_ª•⁄dî_dyn_cfg_vÆid_Êags
 {

422 
	mIWL_RESPONDER_DYN_CFG_VALID_LCI
 = 
BIT
(0),

423 
	mIWL_RESPONDER_DYN_CFG_VALID_CIVIC
 = 
BIT
(1),

424 
	mIWL_RESPONDER_DYN_CFG_VALID_PASN_STA
 = 
BIT
(2),

440 
	siwl_tof_ª•⁄dî_dyn_c⁄fig_cmd
 {

441 
u8
 
	mcùhî
;

442 
u8
 
	mvÆid_Êags
;

443 
u8
 
	mlci_Àn
;

444 
u8
 
	mcivic_Àn
;

445 
u8
 
	mlci_buf
[
IWL_LCI_MAX_SIZE
];

446 
u8
 
	mcivic_buf
[
IWL_LCI_MAX_SIZE
];

447 
u8
 
	mh…k_buf
[
HLTK_11AZ_LEN
];

448 
u8
 
	maddr
[
ETH_ALEN
];

449 
u8
 
	mª£rved
[2];

450 } 
	g__∑cked
;

465 
	siwl_tof_ønge_ªq_ext_cmd
 {

466 
__À16
 
	mtsf_timî_off£t_m£c
;

467 
__À16
 
	mª£rved
;

468 
u8
 
	mmö_dñè_·m
;

469 
u8
 
	m·m_f‹m©_™d_bw20M
;

470 
u8
 
	m·m_f‹m©_™d_bw40M
;

471 
u8
 
	m·m_f‹m©_™d_bw80M
;

472 } 
	g__∑cked
;

479 
	eiwl_tof_loˇti⁄_quîy
 {

480 
	mIWL_TOF_LOC_LCI
 = 0x01,

481 
	mIWL_TOF_LOC_CIVIC
 = 0x02,

518 
	siwl_tof_ønge_ªq_≠_íåy_v2
 {

519 
u8
 
	mch™√l_num
;

520 
u8
 
	mb™dwidth
;

521 
u8
 
	mtsf_dñè_dúe˘i⁄
;

522 
u8
 
	m˘æ_ch_posôi⁄
;

523 
u8
 
	mbssid
[
ETH_ALEN
];

524 
u8
 
	mmósuª_ty≥
;

525 
u8
 
	mnum_of_bur°s
;

526 
__À16
 
	mbur°_≥riod
;

527 
u8
 
	mßm∂es_≥r_bur°
;

528 
u8
 
	mªåõs_≥r_ßm∂e
;

529 
__À32
 
	mtsf_dñè
;

530 
u8
 
	mloˇti⁄_ªq
;

531 
u8
 
	maßp_mode
;

532 
u8
 
	míabÀ_dyn_ack
;

533 
s8
 
	mrssi
;

534 
u8
 
	mÆgo_ty≥
;

535 
u8
 
	mnŸify_mcsi
;

536 
__À16
 
	mª£rved
;

537 } 
	g__∑cked
;

565 
	eiwl_öôüt‹_≠_Êags
 {

566 
	mIWL_INITIATOR_AP_FLAGS_ASAP
 = 
BIT
(1),

567 
	mIWL_INITIATOR_AP_FLAGS_LCI_REQUEST
 = 
BIT
(2),

568 
	mIWL_INITIATOR_AP_FLAGS_CIVIC_REQUEST
 = 
BIT
(3),

569 
	mIWL_INITIATOR_AP_FLAGS_DYN_ACK
 = 
BIT
(4),

570 
	mIWL_INITIATOR_AP_FLAGS_ALGO_LR
 = 
BIT
(5),

571 
	mIWL_INITIATOR_AP_FLAGS_ALGO_FFT
 = 
BIT
(6),

572 
	mIWL_INITIATOR_AP_FLAGS_MCSI_REPORT
 = 
BIT
(8),

573 
	mIWL_INITIATOR_AP_FLAGS_NON_TB
 = 
BIT
(9),

574 
	mIWL_INITIATOR_AP_FLAGS_TB
 = 
BIT
(10),

575 
	mIWL_INITIATOR_AP_FLAGS_SECURED
 = 
BIT
(11),

576 
	mIWL_INITIATOR_AP_FLAGS_LMR_FEEDBACK
 = 
BIT
(12),

577 
	mIWL_INITIATOR_AP_FLAGS_USE_CALIB
 = 
BIT
(13),

578 
	mIWL_INITIATOR_AP_FLAGS_PMF
 = 
BIT
(14),

579 
	mIWL_INITIATOR_AP_FLAGS_TERMINATE_ON_LMR_FEEDBACK
 = 
BIT
(15),

600 
	siwl_tof_ønge_ªq_≠_íåy_v3
 {

601 
__À32
 
	möôüt‹_≠_Êags
;

602 
u8
 
	mch™√l_num
;

603 
u8
 
	mb™dwidth
;

604 
u8
 
	m˘æ_ch_posôi⁄
;

605 
u8
 
	m·mr_max_ªåõs
;

606 
u8
 
	mbssid
[
ETH_ALEN
];

607 
__À16
 
	mbur°_≥riod
;

608 
u8
 
	mßm∂es_≥r_bur°
;

609 
u8
 
	mnum_of_bur°s
;

610 
__À16
 
	mª£rved
;

611 
__À32
 
	mtsf_dñè
;

612 } 
	g__∑cked
;

621 
	eiwl_loˇti⁄_‰ame_f‹m©
 {

622 
	mIWL_LOCATION_FRAME_FORMAT_LEGACY
,

623 
	mIWL_LOCATION_FRAME_FORMAT_HT
,

624 
	mIWL_LOCATION_FRAME_FORMAT_VHT
,

625 
	mIWL_LOCATION_FRAME_FORMAT_HE
,

635 
	eiwl_loˇti⁄_bw
 {

636 
	mIWL_LOCATION_BW_20MHZ
,

637 
	mIWL_LOCATION_BW_40MHZ
,

638 
	mIWL_LOCATION_BW_80MHZ
,

639 
	mIWL_LOCATION_BW_160MHZ
,

642 
	#TK_11AZ_LEN
 32

	)

644 
	#LOCATION_BW_POS
 4

	)

666 
	siwl_tof_ønge_ªq_≠_íåy_v4
 {

667 
__À32
 
	möôüt‹_≠_Êags
;

668 
u8
 
	mch™√l_num
;

669 
u8
 
	mf‹m©_bw
;

670 
u8
 
	m˘æ_ch_posôi⁄
;

671 
u8
 
	m·mr_max_ªåõs
;

672 
u8
 
	mbssid
[
ETH_ALEN
];

673 
__À16
 
	mbur°_≥riod
;

674 
u8
 
	mßm∂es_≥r_bur°
;

675 
u8
 
	mnum_of_bur°s
;

676 
__À16
 
	mª£rved
;

677 
u8
 
	mh…k
[
HLTK_11AZ_LEN
];

678 
u8
 
	mtk
[
TK_11AZ_LEN
];

679 } 
	g__∑cked
;

689 
	eiwl_loˇti⁄_cùhî
 {

690 
	mIWL_LOCATION_CIPHER_CCMP_128
,

691 
	mIWL_LOCATION_CIPHER_GCMP_128
,

692 
	mIWL_LOCATION_CIPHER_GCMP_256
,

693 
	mIWL_LOCATION_CIPHER_INVALID
,

694 
	mIWL_LOCATION_CIPHER_MAX
,

726 
	siwl_tof_ønge_ªq_≠_íåy_v6
 {

727 
__À32
 
	möôüt‹_≠_Êags
;

728 
u8
 
	mch™√l_num
;

729 
u8
 
	mf‹m©_bw
;

730 
u8
 
	m˘æ_ch_posôi⁄
;

731 
u8
 
	m·mr_max_ªåõs
;

732 
u8
 
	mbssid
[
ETH_ALEN
];

733 
__À16
 
	mbur°_≥riod
;

734 
u8
 
	mßm∂es_≥r_bur°
;

735 
u8
 
	mnum_of_bur°s
;

736 
u8
 
	m°a_id
;

737 
u8
 
	mcùhî
;

738 
u8
 
	mh…k
[
HLTK_11AZ_LEN
];

739 
u8
 
	mtk
[
TK_11AZ_LEN
];

740 
__À16
 
	mˇlib
[
IWL_TOF_BW_NUM
];

741 
__À16
 
	mbóc⁄_öãrvÆ
;

742 } 
	g__∑cked
;

779 
	siwl_tof_ønge_ªq_≠_íåy_v7
 {

780 
__À32
 
	möôüt‹_≠_Êags
;

781 
u8
 
	mch™√l_num
;

782 
u8
 
	mf‹m©_bw
;

783 
u8
 
	m˘æ_ch_posôi⁄
;

784 
u8
 
	m·mr_max_ªåõs
;

785 
u8
 
	mbssid
[
ETH_ALEN
];

786 
__À16
 
	mbur°_≥riod
;

787 
u8
 
	mßm∂es_≥r_bur°
;

788 
u8
 
	mnum_of_bur°s
;

789 
u8
 
	m°a_id
;

790 
u8
 
	mcùhî
;

791 
u8
 
	mh…k
[
HLTK_11AZ_LEN
];

792 
u8
 
	mtk
[
TK_11AZ_LEN
];

793 
__À16
 
	mˇlib
[
IWL_TOF_BW_NUM
];

794 
__À16
 
	mbóc⁄_öãrvÆ
;

795 
u8
 
	mrx_≤
[
IEEE80211_CCMP_PN_LEN
];

796 
u8
 
	mtx_≤
[
IEEE80211_CCMP_PN_LEN
];

797 } 
	g__∑cked
;

799 
	#IWL_LOCATION_MAX_STS_POS
 3

	)

848 
	siwl_tof_ønge_ªq_≠_íåy_v8
 {

849 
__À32
 
	möôüt‹_≠_Êags
;

850 
u8
 
	mch™√l_num
;

851 
u8
 
	mf‹m©_bw
;

852 
u8
 
	m˘æ_ch_posôi⁄
;

853 
u8
 
	m·mr_max_ªåõs
;

854 
u8
 
	mbssid
[
ETH_ALEN
];

855 
__À16
 
	mbur°_≥riod
;

856 
u8
 
	mßm∂es_≥r_bur°
;

857 
u8
 
	mnum_of_bur°s
;

858 
u8
 
	m°a_id
;

859 
u8
 
	mcùhî
;

860 
u8
 
	mh…k
[
HLTK_11AZ_LEN
];

861 
u8
 
	mtk
[
TK_11AZ_LEN
];

862 
__À16
 
	mˇlib
[
IWL_TOF_BW_NUM
];

863 
__À16
 
	mbóc⁄_öãrvÆ
;

864 
u8
 
	mrx_≤
[
IEEE80211_CCMP_PN_LEN
];

865 
u8
 
	mtx_≤
[
IEEE80211_CCMP_PN_LEN
];

866 
u8
 
	mr2i_ndp_∑øms
;

867 
u8
 
	mi2r_ndp_∑øms
;

868 
u8
 
	mr2i_max_tŸÆ_…f
;

869 
u8
 
	mi2r_max_tŸÆ_…f
;

870 } 
	g__∑cked
;

929 
	siwl_tof_ønge_ªq_≠_íåy_v9
 {

930 
__À32
 
	möôüt‹_≠_Êags
;

931 
u8
 
	mch™√l_num
;

932 
u8
 
	mf‹m©_bw
;

933 
u8
 
	m˘æ_ch_posôi⁄
;

934 
u8
 
	m·mr_max_ªåõs
;

935 
u8
 
	mbssid
[
ETH_ALEN
];

936 
__À16
 
	mbur°_≥riod
;

937 
u8
 
	mßm∂es_≥r_bur°
;

938 
u8
 
	mnum_of_bur°s
;

939 
u8
 
	m°a_id
;

940 
u8
 
	mcùhî
;

941 
u8
 
	mh…k
[
HLTK_11AZ_LEN
];

942 
u8
 
	mtk
[
TK_11AZ_LEN
];

943 
__À16
 
	mˇlib
[
IWL_TOF_BW_NUM
];

944 
u16
 
	mbóc⁄_öãrvÆ
;

945 
u8
 
	mrx_≤
[
IEEE80211_CCMP_PN_LEN
];

946 
u8
 
	mtx_≤
[
IEEE80211_CCMP_PN_LEN
];

947 
u8
 
	mr2i_ndp_∑øms
;

948 
u8
 
	mi2r_ndp_∑øms
;

949 
u8
 
	mr2i_max_tŸÆ_…f
;

950 
u8
 
	mi2r_max_tŸÆ_…f
;

951 
u8
 
	mbss_cﬁ‹
;

952 
u8
 
	mb™d
;

953 
__À16
 
	mmö_time_bëwìn_m§
;

954 } 
	g__∑cked
;

966 
	eiwl_tof_ª•⁄£_mode
 {

967 
	mIWL_MVM_TOF_RESPONSE_ASAP
,

968 
	mIWL_MVM_TOF_RESPONSE_TIMEOUT
,

969 
	mIWL_MVM_TOF_RESPONSE_COMPLETE
,

990 
	eiwl_tof_öôüt‹_Êags
 {

991 
	mIWL_TOF_INITIATOR_FLAGS_FAST_ALGO_DISABLED
 = 
BIT
(0),

992 
	mIWL_TOF_INITIATOR_FLAGS_RX_CHAIN_SEL_A
 = 
BIT
(1),

993 
	mIWL_TOF_INITIATOR_FLAGS_RX_CHAIN_SEL_B
 = 
BIT
(2),

994 
	mIWL_TOF_INITIATOR_FLAGS_RX_CHAIN_SEL_C
 = 
BIT
(3),

995 
	mIWL_TOF_INITIATOR_FLAGS_TX_CHAIN_SEL_A
 = 
BIT
(4),

996 
	mIWL_TOF_INITIATOR_FLAGS_TX_CHAIN_SEL_B
 = 
BIT
(5),

997 
	mIWL_TOF_INITIATOR_FLAGS_TX_CHAIN_SEL_C
 = 
BIT
(6),

998 
	mIWL_TOF_INITIATOR_FLAGS_MACADDR_RANDOM
 = 
BIT
(7),

999 
	mIWL_TOF_INITIATOR_FLAGS_SPECIFIC_CALIB
 = 
BIT
(15),

1000 
	mIWL_TOF_INITIATOR_FLAGS_COMMON_CALIB
 = 
BIT
(16),

1001 
	mIWL_TOF_INITIATOR_FLAGS_NON_ASAP_SUPPORT
 = 
BIT
(20),

1004 
	#IWL_MVM_TOF_MAX_APS
 5

	)

1005 
	#IWL_MVM_TOF_MAX_TWO_SIDED_APS
 5

	)

1036 
	siwl_tof_ønge_ªq_cmd_v5
 {

1037 
__À32
 
	möôüt‹_Êags
;

1038 
u8
 
	mªque°_id
;

1039 
u8
 
	möôüt‹
;

1040 
u8
 
	m⁄e_sided_los_dißbÀ
;

1041 
u8
 
	mªq_timeout
;

1042 
u8
 
	mªp‹t_pﬁicy
;

1043 
u8
 
	mª£rved0
;

1044 
u8
 
	mnum_of_≠
;

1045 
u8
 
	mmaˇddr_øndom
;

1046 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1047 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1048 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1049 
u8
 
	m·m_rx_chaös
;

1050 
u8
 
	m·m_tx_chaös
;

1051 
__À16
 
	mcomm⁄_ˇlib
;

1052 
__À16
 
	m•ecific_ˇlib
;

1053 
iwl_tof_ønge_ªq_≠_íåy_v2
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1054 } 
	g__∑cked
;

1075 
	siwl_tof_ønge_ªq_cmd_v7
 {

1076 
__À32
 
	möôüt‹_Êags
;

1077 
u8
 
	mªque°_id
;

1078 
u8
 
	mnum_of_≠
;

1079 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1080 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1081 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1082 
__À32
 
	mªq_timeout_ms
;

1083 
__À32
 
	mtsf_mac_id
;

1084 
__À16
 
	mcomm⁄_ˇlib
;

1085 
__À16
 
	m•ecific_ˇlib
;

1086 
iwl_tof_ønge_ªq_≠_íåy_v3
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1087 } 
	g__∑cked
;

1107 
	siwl_tof_ønge_ªq_cmd_v8
 {

1108 
__À32
 
	möôüt‹_Êags
;

1109 
u8
 
	mªque°_id
;

1110 
u8
 
	mnum_of_≠
;

1111 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1112 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1113 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1114 
__À32
 
	mªq_timeout_ms
;

1115 
__À32
 
	mtsf_mac_id
;

1116 
__À16
 
	mcomm⁄_ˇlib
;

1117 
__À16
 
	m•ecific_ˇlib
;

1118 
iwl_tof_ønge_ªq_≠_íåy_v4
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1119 } 
	g__∑cked
;

1137 
	siwl_tof_ønge_ªq_cmd_v9
 {

1138 
__À32
 
	möôüt‹_Êags
;

1139 
u8
 
	mªque°_id
;

1140 
u8
 
	mnum_of_≠
;

1141 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1142 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1143 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1144 
__À32
 
	mªq_timeout_ms
;

1145 
__À32
 
	mtsf_mac_id
;

1146 
iwl_tof_ønge_ªq_≠_íåy_v6
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1147 } 
	g__∑cked
;

1165 
	siwl_tof_ønge_ªq_cmd_v11
 {

1166 
__À32
 
	möôüt‹_Êags
;

1167 
u8
 
	mªque°_id
;

1168 
u8
 
	mnum_of_≠
;

1169 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1170 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1171 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1172 
__À32
 
	mªq_timeout_ms
;

1173 
__À32
 
	mtsf_mac_id
;

1174 
iwl_tof_ønge_ªq_≠_íåy_v7
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1175 } 
	g__∑cked
;

1193 
	siwl_tof_ønge_ªq_cmd_v12
 {

1194 
__À32
 
	möôüt‹_Êags
;

1195 
u8
 
	mªque°_id
;

1196 
u8
 
	mnum_of_≠
;

1197 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1198 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1199 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1200 
__À32
 
	mªq_timeout_ms
;

1201 
__À32
 
	mtsf_mac_id
;

1202 
iwl_tof_ønge_ªq_≠_íåy_v8
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1203 } 
	g__∑cked
;

1221 
	siwl_tof_ønge_ªq_cmd_v13
 {

1222 
__À32
 
	möôüt‹_Êags
;

1223 
u8
 
	mªque°_id
;

1224 
u8
 
	mnum_of_≠
;

1225 
u8
 
	mønge_ªq_bssid
[
ETH_ALEN
];

1226 
u8
 
	mmaˇddr_mask
[
ETH_ALEN
];

1227 
u8
 
	mmaˇddr_ãm∂©e
[
ETH_ALEN
];

1228 
__À32
 
	mªq_timeout_ms
;

1229 
__À32
 
	mtsf_mac_id
;

1230 
iwl_tof_ønge_ªq_≠_íåy_v9
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1231 } 
	g__∑cked
;

1240 
	eiwl_tof_ønge_ªque°_°©us
 {

1241 
	mIWL_TOF_RANGE_REQUEST_STATUS_SUCCESS
,

1242 
	mIWL_TOF_RANGE_REQUEST_STATUS_BUSY
,

1272 
	eiwl_tof_íåy_°©us
 {

1273 
	mIWL_TOF_ENTRY_SUCCESS
 = 0,

1274 
	mIWL_TOF_ENTRY_GENERAL_FAILURE
 = 1,

1275 
	mIWL_TOF_ENTRY_NO_RESPONSE
 = 2,

1276 
	mIWL_TOF_ENTRY_REQUEST_REJECTED
 = 3,

1277 
	mIWL_TOF_ENTRY_NOT_SCHEDULED
 = 4,

1278 
	mIWL_TOF_ENTRY_TIMING_MEASURE_TIMEOUT
 = 5,

1279 
	mIWL_TOF_ENTRY_TARGET_DIFF_CH_CANNOT_CHANGE
 = 6,

1280 
	mIWL_TOF_ENTRY_RANGE_NOT_SUPPORTED
 = 7,

1281 
	mIWL_TOF_ENTRY_REQUEST_ABORT_UNKNOWN_REASON
 = 8,

1282 
	mIWL_TOF_ENTRY_LOCATION_INVALID_T1_T4_TIME_STAMP
 = 9,

1283 
	mIWL_TOF_ENTRY_11MC_PROTOCOL_FAILURE
 = 10,

1284 
	mIWL_TOF_ENTRY_REQUEST_CANNOT_SCHED
 = 11,

1285 
	mIWL_TOF_ENTRY_RESPONDER_CANNOT_COLABORATE
 = 12,

1286 
	mIWL_TOF_ENTRY_BAD_REQUEST_ARGS
 = 13,

1287 
	mIWL_TOF_ENTRY_WIFI_NOT_ENABLED
 = 14,

1288 
	mIWL_TOF_ENTRY_RESPONDER_OVERRIDE_PARAMS
 = 15,

1319 
	siwl_tof_ønge_r•_≠_íåy_¡fy_v3
 {

1320 
u8
 
	mbssid
[
ETH_ALEN
];

1321 
u8
 
	mmósuª_°©us
;

1322 
u8
 
	mmósuª_bw
;

1323 
__À32
 
	mπt
;

1324 
__À32
 
	mπt_v¨ün˚
;

1325 
__À32
 
	mπt_•ªad
;

1326 
s8
 
	mrssi
;

1327 
u8
 
	mrssi_•ªad
;

1328 
u8
 
	mª£rved
;

1329 
u8
 
	mªfußl_≥riod
;

1330 
__À32
 
	mønge
;

1331 
__À32
 
	mønge_v¨ün˚
;

1332 
__À32
 
	mtime°amp
;

1333 
__À32
 
	mt2t3_öôüt‹
;

1334 
__À32
 
	mt1t4_ª•⁄dî
;

1335 
__À16
 
	mcomm⁄_ˇlib
;

1336 
__À16
 
	m•ecific_ˇlib
;

1337 
__À32
 
	m∑pd_ˇlib_ouçut
;

1338 } 
	g__∑cked
;

1371 
	siwl_tof_ønge_r•_≠_íåy_¡fy_v4
 {

1372 
u8
 
	mbssid
[
ETH_ALEN
];

1373 
u8
 
	mmósuª_°©us
;

1374 
u8
 
	mmósuª_bw
;

1375 
__À32
 
	mπt
;

1376 
__À32
 
	mπt_v¨ün˚
;

1377 
__À32
 
	mπt_•ªad
;

1378 
s8
 
	mrssi
;

1379 
u8
 
	mrssi_•ªad
;

1380 
u8
 
	mœ°_bur°
;

1381 
u8
 
	mªfußl_≥riod
;

1382 
__À32
 
	mtime°amp
;

1383 
__À32
 
	m°¨t_tsf
;

1384 
__À32
 
	mrx_øã_n_Êags
;

1385 
__À32
 
	mtx_øã_n_Êags
;

1386 
__À32
 
	mt2t3_öôüt‹
;

1387 
__À32
 
	mt1t4_ª•⁄dî
;

1388 
__À16
 
	mcomm⁄_ˇlib
;

1389 
__À16
 
	m•ecific_ˇlib
;

1390 
__À32
 
	m∑pd_ˇlib_ouçut
;

1391 } 
	g__∑cked
;

1426 
	siwl_tof_ønge_r•_≠_íåy_¡fy_v5
 {

1427 
u8
 
	mbssid
[
ETH_ALEN
];

1428 
u8
 
	mmósuª_°©us
;

1429 
u8
 
	mmósuª_bw
;

1430 
__À32
 
	mπt
;

1431 
__À32
 
	mπt_v¨ün˚
;

1432 
__À32
 
	mπt_•ªad
;

1433 
s8
 
	mrssi
;

1434 
u8
 
	mrssi_•ªad
;

1435 
u8
 
	mœ°_bur°
;

1436 
u8
 
	mªfußl_≥riod
;

1437 
__À32
 
	mtime°amp
;

1438 
__À32
 
	m°¨t_tsf
;

1439 
__À32
 
	mrx_øã_n_Êags
;

1440 
__À32
 
	mtx_øã_n_Êags
;

1441 
__À32
 
	mt2t3_öôüt‹
;

1442 
__À32
 
	mt1t4_ª•⁄dî
;

1443 
__À16
 
	mcomm⁄_ˇlib
;

1444 
__À16
 
	m•ecific_ˇlib
;

1445 
__À32
 
	m∑pd_ˇlib_ouçut
;

1446 
u8
 
	mπtC⁄fidí˚
;

1447 
u8
 
	mª£rved
[3];

1448 } 
	g__∑cked
;

1487 
	siwl_tof_ønge_r•_≠_íåy_¡fy_v6
 {

1488 
u8
 
	mbssid
[
ETH_ALEN
];

1489 
u8
 
	mmósuª_°©us
;

1490 
u8
 
	mmósuª_bw
;

1491 
__À32
 
	mπt
;

1492 
__À32
 
	mπt_v¨ün˚
;

1493 
__À32
 
	mπt_•ªad
;

1494 
s8
 
	mrssi
;

1495 
u8
 
	mrssi_•ªad
;

1496 
u8
 
	mœ°_bur°
;

1497 
u8
 
	mªfußl_≥riod
;

1498 
__À32
 
	mtime°amp
;

1499 
__À32
 
	m°¨t_tsf
;

1500 
__À32
 
	mrx_øã_n_Êags
;

1501 
__À32
 
	mtx_øã_n_Êags
;

1502 
__À32
 
	mt2t3_öôüt‹
;

1503 
__À32
 
	mt1t4_ª•⁄dî
;

1504 
__À16
 
	mcomm⁄_ˇlib
;

1505 
__À16
 
	m•ecific_ˇlib
;

1506 
__À32
 
	m∑pd_ˇlib_ouçut
;

1507 
u8
 
	mπtC⁄fidí˚
;

1508 
u8
 
	mª£rved
[3];

1509 
u8
 
	mrx_≤
[
IEEE80211_CCMP_PN_LEN
];

1510 
u8
 
	mtx_≤
[
IEEE80211_CCMP_PN_LEN
];

1511 } 
	g__∑cked
;

1524 
	eiwl_tof_ª•⁄£_°©us
 {

1525 
	mIWL_TOF_RESPONSE_SUCCESS
 = 0,

1526 
	mIWL_TOF_RESPONSE_TIMEOUT
 = 1,

1527 
	mIWL_TOF_RESPONSE_ABORTED
 = 4,

1528 
	mIWL_TOF_RESPONSE_FAILED
 = 5,

1540 
	siwl_tof_ønge_r•_¡fy_v5
 {

1541 
u8
 
	mªque°_id
;

1542 
u8
 
	mªque°_°©us
;

1543 
u8
 
	mœ°_ö_b©ch
;

1544 
u8
 
	mnum_of_≠s
;

1545 
iwl_tof_ønge_r•_≠_íåy_¡fy_v3
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1546 } 
	g__∑cked
;

1556 
	siwl_tof_ønge_r•_¡fy_v6
 {

1557 
u8
 
	mªque°_id
;

1558 
u8
 
	mnum_of_≠s
;

1559 
u8
 
	mœ°_ªp‹t
;

1560 
u8
 
	mª£rved
;

1561 
iwl_tof_ønge_r•_≠_íåy_¡fy_v4
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1562 } 
	g__∑cked
;

1572 
	siwl_tof_ønge_r•_¡fy_v7
 {

1573 
u8
 
	mªque°_id
;

1574 
u8
 
	mnum_of_≠s
;

1575 
u8
 
	mœ°_ªp‹t
;

1576 
u8
 
	mª£rved
;

1577 
iwl_tof_ønge_r•_≠_íåy_¡fy_v5
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1578 } 
	g__∑cked
;

1588 
	siwl_tof_ønge_r•_¡fy_v8
 {

1589 
u8
 
	mªque°_id
;

1590 
u8
 
	mnum_of_≠s
;

1591 
u8
 
	mœ°_ªp‹t
;

1592 
u8
 
	mª£rved
;

1593 
iwl_tof_ønge_r•_≠_íåy_¡fy_v6
 
	m≠
[
IWL_MVM_TOF_MAX_APS
];

1594 } 
	g__∑cked
;

1597 
	#IWL_MVM_TOF_MCSI_BUF_SIZE
 (245)

	)

1607 
	siwl_tof_mcsi_nŸif
 {

1608 
u8
 
	mtokí
;

1609 
u8
 
	mrﬁe
;

1610 
__À16
 
	mª£rved
;

1611 
u8
 
	möôüt‹_bssid
[
ETH_ALEN
];

1612 
u8
 
	mª•⁄dî_bssid
[
ETH_ALEN
];

1613 
u8
 
	mmcsi_buf„r
[
IWL_MVM_TOF_MCSI_BUF_SIZE
 * 4];

1614 } 
	g__∑cked
;

1621 
	siwl_tof_ønge_ab‹t_cmd
 {

1622 
u8
 
	mªque°_id
;

1623 
u8
 
	mª£rved
[3];

1624 } 
	g__∑cked
;

1626 
	e·m_ª•⁄dî_°©s_Êags
 {

1627 
	mFTM_RESP_STAT_NON_ASAP_STARTED
 = 
BIT
(0),

1628 
	mFTM_RESP_STAT_NON_ASAP_IN_WIN
 = 
BIT
(1),

1629 
	mFTM_RESP_STAT_NON_ASAP_OUT_WIN
 = 
BIT
(2),

1630 
	mFTM_RESP_STAT_TRIGGER_DUP
 = 
BIT
(3),

1631 
	mFTM_RESP_STAT_DUP
 = 
BIT
(4),

1632 
	mFTM_RESP_STAT_DUP_IN_WIN
 = 
BIT
(5),

1633 
	mFTM_RESP_STAT_DUP_OUT_WIN
 = 
BIT
(6),

1634 
	mFTM_RESP_STAT_SCHED_SUCCESS
 = 
BIT
(7),

1635 
	mFTM_RESP_STAT_ASAP_REQ
 = 
BIT
(8),

1636 
	mFTM_RESP_STAT_NON_ASAP_REQ
 = 
BIT
(9),

1637 
	mFTM_RESP_STAT_ASAP_RESP
 = 
BIT
(10),

1638 
	mFTM_RESP_STAT_NON_ASAP_RESP
 = 
BIT
(11),

1639 
	mFTM_RESP_STAT_FAIL_INITIATOR_INACTIVE
 = 
BIT
(12),

1640 
	mFTM_RESP_STAT_FAIL_INITIATOR_OUT_WIN
 = 
BIT
(13),

1641 
	mFTM_RESP_STAT_FAIL_INITIATOR_RETRY_LIM
 = 
BIT
(14),

1642 
	mFTM_RESP_STAT_FAIL_NEXT_SERVED
 = 
BIT
(15),

1643 
	mFTM_RESP_STAT_FAIL_TRIGGER_ERR
 = 
BIT
(16),

1644 
	mFTM_RESP_STAT_FAIL_GC
 = 
BIT
(17),

1645 
	mFTM_RESP_STAT_SUCCESS
 = 
BIT
(18),

1646 
	mFTM_RESP_STAT_INTEL_IE
 = 
BIT
(19),

1647 
	mFTM_RESP_STAT_INITIATOR_ACTIVE
 = 
BIT
(20),

1648 
	mFTM_RESP_STAT_MEASUREMENTS_AVAILABLE
 = 
BIT
(21),

1649 
	mFTM_RESP_STAT_TRIGGER_UNKNOWN
 = 
BIT
(22),

1650 
	mFTM_RESP_STAT_PROCESS_FAIL
 = 
BIT
(23),

1651 
	mFTM_RESP_STAT_ACK
 = 
BIT
(24),

1652 
	mFTM_RESP_STAT_NACK
 = 
BIT
(25),

1653 
	mFTM_RESP_STAT_INVALID_INITIATOR_ID
 = 
BIT
(26),

1654 
	mFTM_RESP_STAT_TIMER_MIN_DELTA
 = 
BIT
(27),

1655 
	mFTM_RESP_STAT_INITIATOR_REMOVED
 = 
BIT
(28),

1656 
	mFTM_RESP_STAT_INITIATOR_ADDED
 = 
BIT
(29),

1657 
	mFTM_RESP_STAT_ERR_LIST_FULL
 = 
BIT
(30),

1658 
	mFTM_RESP_STAT_INITIATOR_SCHED_NOW
 = 
BIT
(31),

1673 
	siwl_·m_ª•⁄dî_°©s
 {

1674 
u8
 
	maddr
[
ETH_ALEN
];

1675 
u8
 
	msuc˚ss_·m
;

1676 
u8
 
	m·m_≥r_bur°
;

1677 
__À32
 
	mÊags
;

1678 
__À32
 
	mduøti⁄
;

1679 
__À32
 
	mÆloˇãd_duøti⁄
;

1680 
u8
 
	mbw
;

1681 
u8
 
	møã
;

1682 
__À16
 
	mª£rved
;

1683 } 
	g__∑cked
;

1685 
	#IWL_CSI_MAX_EXPECTED_CHUNKS
 16

	)

1687 
	#IWL_CSI_CHUNK_CTL_NUM_MASK_VER_1
 0x0003

	)

1688 
	#IWL_CSI_CHUNK_CTL_IDX_MASK_VER_1
 0x000c

	)

1690 
	#IWL_CSI_CHUNK_CTL_NUM_MASK_VER_2
 0x00ff

	)

1691 
	#IWL_CSI_CHUNK_CTL_IDX_MASK_VER_2
 0xff00

	)

1693 
	siwl_csi_chunk_nŸifiˇti⁄
 {

1694 
__À32
 
	mtokí
;

1695 
__À16
 
	m£q
;

1696 
__À16
 
	m˘l
;

1697 
__À32
 
	msize
;

1698 
u8
 
	md©a
[];

1699 } 
	g__∑cked
;

	@fw/api/mac-cfg.h

7 #i‚de‡
__iwl_fw_≠i_mac_cfg_h__


8 
	#__iwl_fw_≠i_mac_cfg_h__


	)

10 
	~"mac.h
"

15 
	eiwl_mac_c⁄f_subcmd_ids
 {

19 
	mLOW_LATENCY_CMD
 = 0x3,

23 
	mCHANNEL_SWITCH_TIME_EVENT_CMD
 = 0x4,

27 
	mMISSED_VAP_NOTIF
 = 0xFA,

31 
	mSESSION_PROTECTION_CMD
 = 0x5,

35 
	mCANCEL_CHANNEL_SWITCH_CMD
 = 0x6,

39 
	mMAC_CONFIG_CMD
 = 0x8,

43 
	mLINK_CONFIG_CMD
 = 0x9,

47 
	mSTA_CONFIG_CMD
 = 0xA,

51 
	mAUX_STA_CMD
 = 0xB,

55 
	mSTA_REMOVE_CMD
 = 0xC,

59 
	mSTA_DISABLE_TX_CMD
 = 0xD,

63 
	mROC_CMD
 = 0xE,

67 
	mROC_NOTIF
 = 0xF8,

71 
	mSESSION_PROTECTION_NOTIF
 = 0xFB,

76 
	mPROBE_RESPONSE_DATA_NOTIF
 = 0xFC,

81 
	mCHANNEL_SWITCH_START_NOTIF
 = 0xFF,

86 
	mCHANNEL_SWITCH_ERROR_NOTIF
 = 0xF9,

89 
	#IWL_P2P_NOA_DESC_COUNT
 (2)

	)

102 
	siwl_p2p_nﬂ_©å
 {

103 
u8
 
	mid
;

104 
u8
 
	mÀn_low
;

105 
u8
 
	mÀn_high
;

106 
u8
 
	midx
;

107 
u8
 
	m˘wö
;

108 
õì80211_p2p_nﬂ_desc
 
	mdesc
[
IWL_P2P_NOA_DESC_COUNT
];

109 
u8
 
	mª£rved
;

110 } 
	g__∑cked
;

112 
	#IWL_PROBE_RESP_DATA_NO_CSA
 (0xff)

	)

123 
	siwl_¥obe_ª•_d©a_nŸif
 {

124 
__À32
 
	mmac_id
;

125 
__À32
 
	mnﬂ_a˘ive
;

126 
iwl_p2p_nﬂ_©å
 
	mnﬂ_©å
;

127 
u8
 
	mcß_cou¡î
;

128 
u8
 
	mª£rved
[3];

129 } 
	g__∑cked
;

139 
	siwl_mis£d_v≠_nŸif
 {

140 
__À32
 
	mmac_id
;

141 
u8
 
	mnum_bóc⁄_öãrvÆs_ñ≠£d
;

142 
u8
 
	m¥ofûe_≥riodicôy
;

143 
u8
 
	mª£rved
[2];

144 } 
	g__∑cked
;

151 
	siwl_ch™√l_swôch_°¨t_nŸif_v1
 {

152 
__À32
 
	mid_™d_cﬁ‹
;

153 } 
	g__∑cked
;

160 
	siwl_ch™√l_swôch_°¨t_nŸif
 {

161 
__À32
 
	mlök_id
;

162 } 
	g__∑cked
;

164 
	#CS_ERR_COUNT_ERROR
 
	`BIT
(0)

	)

165 
	#CS_ERR_LONG_DELAY_AFTER_CS
 
	`BIT
(1)

	)

166 
	#CS_ERR_LONG_TX_BLOCK
 
	`BIT
(2)

	)

167 
	#CS_ERR_TX_BLOCK_TIMER_EXPIRED
 
	`BIT
(3)

	)

175 
	siwl_ch™√l_swôch_îr‹_nŸif_v1
 {

176 
__À32
 
	mmac_id
;

177 
__À32
 
	mcß_îr_mask
;

178 } 
	g__∑cked
;

186 
	siwl_ch™√l_swôch_îr‹_nŸif
 {

187 
__À32
 
	mlök_id
;

188 
__À32
 
	mcß_îr_mask
;

189 } 
	g__∑cked
;

196 
	siwl_ˇn˚l_ch™√l_swôch_cmd
 {

197 
__À32
 
	mid
;

198 } 
	g__∑cked
;

213 
	siwl_ch™_swôch_ã_cmd
 {

214 
__À32
 
	mmac_id
;

215 
__À32
 
	ma˘i⁄
;

216 
__À32
 
	mtsf
;

217 
u8
 
	mcs_cou¡
;

218 
u8
 
	mcs_dñayed_b˙_cou¡
;

219 
u8
 
	mcs_mode
;

220 
u8
 
	mª£rved
;

221 } 
	g__∑cked
;

231 
	siwl_mac_low_œãncy_cmd
 {

232 
__À32
 
	mmac_id
;

233 
u8
 
	mlow_œãncy_rx
;

234 
u8
 
	mlow_œãncy_tx
;

235 
__À16
 
	mª£rved
;

236 } 
	g__∑cked
;

255 
	siwl_mac_˛õ¡_d©a
 {

256 
u8
 
	mis_assoc
;

257 
u8
 
	me§_å™sôi⁄_timeout
;

258 
__À16
 
	mmedium_sync_dñay
;

260 
__À16
 
	massoc_id
;

261 
__À16
 
	mª£rved1
;

262 
__À16
 
	md©a_pﬁicy
;

263 
__À16
 
	mª£rved2
;

264 
__À32
 
	m˘wö
;

265 } 
	g__∑cked
;

277 
	siwl_mac_p2p_dev_d©a
 {

278 
__À32
 
	mis_disc_exãnded
;

279 } 
	g__∑cked
;

292 
	eiwl_mac_c⁄fig_fûãr_Êags
 {

293 
	mMAC_CFG_FILTER_PROMISC
 = 
BIT
(0),

294 
	mMAC_CFG_FILTER_ACCEPT_CONTROL_AND_MGMT
 = 
BIT
(1),

295 
	mMAC_CFG_FILTER_ACCEPT_GRP
 = 
BIT
(2),

296 
	mMAC_CFG_FILTER_ACCEPT_BEACON
 = 
BIT
(3),

297 
	mMAC_CFG_FILTER_ACCEPT_BCAST_PROBE_RESP
 = 
BIT
(4),

298 
	mMAC_CFG_FILTER_ACCEPT_PROBE_REQ
 = 
BIT
(5),

322 
	siwl_mac_c⁄fig_cmd
 {

324 
__À32
 
	mid_™d_cﬁ‹
;

325 
__À32
 
	ma˘i⁄
;

327 
__À32
 
	mmac_ty≥
;

328 
u8
 
	mloˇl_mld_addr
[6];

329 
__À16
 
	mª£rved_f‹_loˇl_mld_addr
;

330 
__À32
 
	mfûãr_Êags
;

331 
__À16
 
	mhe_suµ‹t
;

332 
__À16
 
	mhe_≠_suµ‹t
;

333 
__À32
 
	meht_suµ‹t
;

334 
__À32
 
	mnic_nŸ_ack_íabÀd
;

337 
iwl_mac_˛õ¡_d©a
 
	m˛õ¡
;

338 
iwl_mac_p2p_dev_d©a
 
	mp2p_dev
;

340 } 
	g__∑cked
;

379 
	eiwl_lök_˘x_modify_Êags
 {

380 
	mLINK_CONTEXT_MODIFY_ACTIVE
 = 
BIT
(0),

381 
	mLINK_CONTEXT_MODIFY_RATES_INFO
 = 
BIT
(1),

382 
	mLINK_CONTEXT_MODIFY_PROTECT_FLAGS
 = 
BIT
(2),

383 
	mLINK_CONTEXT_MODIFY_QOS_PARAMS
 = 
BIT
(3),

384 
	mLINK_CONTEXT_MODIFY_BEACON_TIMING
 = 
BIT
(4),

385 
	mLINK_CONTEXT_MODIFY_HE_PARAMS
 = 
BIT
(5),

386 
	mLINK_CONTEXT_MODIFY_BSS_COLOR_DISABLE
 = 
BIT
(6),

387 
	mLINK_CONTEXT_MODIFY_EHT_PARAMS
 = 
BIT
(7),

388 
	mLINK_CONTEXT_MODIFY_ALL
 = 0xff,

400 
	eiwl_lök_˘x_¥Ÿe˘i⁄_Êags
 {

401 
	mLINK_PROT_FLG_TGG_PROTECT
 = 
BIT
(0),

402 
	mLINK_PROT_FLG_HT_PROT
 = 
BIT
(1),

403 
	mLINK_PROT_FLG_FAT_PROT
 = 
BIT
(2),

404 
	mLINK_PROT_FLG_SELF_CTS_EN
 = 
BIT
(3),

421 
	eiwl_lök_˘x_Êags
 {

422 
	mLINK_FLG_BSS_COLOR_DIS
 = 
BIT
(0),

423 
	mLINK_FLG_MU_EDCA_CW
 = 
BIT
(1),

424 
	mLINK_FLG_RU_2MHZ_BLOCK
 = 
BIT
(2),

425 
	mLINK_FLG_NDP_FEEDBACK_ENABLED
 = 
BIT
(3),

480 
	siwl_lök_c⁄fig_cmd
 {

481 
__À32
 
	ma˘i⁄
;

482 
__À32
 
	mlök_id
;

483 
__À32
 
	mmac_id
;

484 
__À32
 
	mphy_id
;

485 
u8
 
	mloˇl_lök_addr
[6];

486 
__À16
 
	mª£rved_f‹_loˇl_lök_addr
;

487 
__À32
 
	mmodify_mask
;

488 
__À32
 
	ma˘ive
;

490 
__À32
 
	mli°í_lmac
;

491 
__À32
 
	mª£rved1
;

493 
__À32
 
	mcck_øãs
;

494 
__À32
 
	mofdm_øãs
;

495 
__À32
 
	mcck_sh‹t_¥ómbÀ
;

496 
__À32
 
	msh‹t_¶Ÿ
;

497 
__À32
 
	m¥Ÿe˘i⁄_Êags
;

499 
__À32
 
	mqos_Êags
;

500 
iwl_ac_qos
 
	mac
[
AC_NUM
 + 1];

501 
u8
 
	mhtc_åig_ba£d_pkt_ext
;

502 
u8
 
	mønd_Æloc_ecwmö
;

503 
u8
 
	mønd_Æloc_ecwmax
;

504 
u8
 
	mndp_fdbk_buff_th_exp
;

505 
iwl_he_backoff_c⁄f
 
	måig_ba£d_txf
[
AC_NUM
];

506 
__À32
 
	mbi
;

507 
__À32
 
	mdtim_öãrvÆ
;

508 
__À16
 
	mpun˘uª_mask
;

509 
__À16
 
	m‰ame_time_πs_th
;

510 
__À32
 
	mÊags
;

511 
__À32
 
	mÊags_mask
;

513 
u8
 
	mªf_bssid_addr
[6];

514 
__À16
 
	mª£rved_f‹_ªf_bssid_addr
;

515 
u8
 
	mbssid_ödex
;

516 
u8
 
	mbss_cﬁ‹
;

517 
u8
 
	m•ec_lök_id
;

518 
u8
 
	mª£rved2
;

519 
u8
 
	mibss_bssid_addr
[6];

520 
__À16
 
	mª£rved_f‹_ibss_bssid_addr
;

521 
__À32
 
	mª£rved3
[8];

522 } 
	g__∑cked
;

527 
	#IWL_MVM_FW_MAX_ACTIVE_LINKS_NUM
 2

	)

528 
	#IWL_MVM_FW_MAX_LINK_ID
 3

	)

542 
	eiwl_fw_°a_ty≥
 {

543 
	mSTATION_TYPE_PEER
,

544 
	mSTATION_TYPE_BCAST_MGMT
,

545 
	mSTATION_TYPE_MCAST
,

546 
	mSTATION_TYPE_AUX
,

582 
	siwl_mvm_°a_cfg_cmd
 {

583 
__À32
 
	m°a_id
;

584 
__À32
 
	mlök_id
;

585 
u8
 
	m≥î_mld_addªss
[
ETH_ALEN
];

586 
__À16
 
	mª£rved_f‹_≥î_mld_addªss
;

587 
u8
 
	m≥î_lök_addªss
[
ETH_ALEN
];

588 
__À16
 
	mª£rved_f‹_≥î_lök_addªss
;

589 
__À32
 
	m°©i⁄_ty≥
;

590 
__À32
 
	massoc_id
;

591 
__À32
 
	mbómf‹m_Êags
;

592 
__À32
 
	mmÂ
;

593 
__À32
 
	mmimo
;

594 
__À32
 
	mmimo_¥Ÿe˘i⁄
;

595 
__À32
 
	mack_íabÀd
;

596 
__À32
 
	måig_∫d_Æloc
;

597 
__À32
 
	mtx_ampdu_•acög
;

598 
__À32
 
	mtx_ampdu_max_size
;

599 
__À32
 
	m•_Àngth
;

600 
__À32
 
	mu≠sd_acs
;

601 
iwl_he_pkt_ext_v2
 
	mpkt_ext
;

602 
__À32
 
	mhtc_Êags
;

603 } 
	g__∑cked
;

614 
	siwl_mvm_aux_°a_cmd
 {

615 
__À32
 
	m°a_id
;

616 
__À32
 
	mlmac_id
;

617 
u8
 
	mmac_addr
[
ETH_ALEN
];

618 
__À16
 
	mª£rved_f‹_mac_addr
;

620 } 
	g__∑cked
;

629 
	siwl_mvm_ªmove_°a_cmd
 {

630 
__À32
 
	m°a_id
;

631 } 
	g__∑cked
;

640 
	siwl_mvm_°a_dißbÀ_tx_cmd
 {

641 
__À32
 
	m°a_id
;

642 
__À32
 
	mdißbÀ
;

643 } 
	g__∑cked
;

	@fw/api/mac.h

6 #i‚de‡
__iwl_fw_≠i_mac_h__


7 
	#__iwl_fw_≠i_mac_h__


	)

13 
	#MAC_INDEX_AUX
 4

	)

14 
	#MAC_INDEX_MIN_DRIVER
 0

	)

15 
	#NUM_MAC_INDEX_DRIVER
 
MAC_INDEX_AUX


	)

16 
	#NUM_MAC_INDEX
 (
NUM_MAC_INDEX_DRIVER
 + 1)

	)

17 
	#NUM_MAC_INDEX_CDB
 (
NUM_MAC_INDEX_DRIVER
 + 2)

	)

19 
	#IWL_MVM_STATION_COUNT_MAX
 16

	)

20 
	#IWL_MVM_INVALID_STA
 0xFF

	)

22 
	eiwl_ac
 {

23 
	mAC_BK
,

24 
	mAC_BE
,

25 
	mAC_VI
,

26 
	mAC_VO
,

27 
	mAC_NUM
,

39 
	eiwl_mac_¥Ÿe˘i⁄_Êags
 {

40 
	mMAC_PROT_FLG_TGG_PROTECT
 = 
BIT
(3),

41 
	mMAC_PROT_FLG_HT_PROT
 = 
BIT
(23),

42 
	mMAC_PROT_FLG_FAT_PROT
 = 
BIT
(24),

43 
	mMAC_PROT_FLG_SELF_CTS_EN
 = 
BIT
(30),

46 
	#MAC_FLG_SHORT_SLOT
 
	`BIT
(4)

	)

47 
	#MAC_FLG_SHORT_PREAMBLE
 
	`BIT
(5)

	)

63 
	eiwl_mac_ty≥s
 {

64 
	mFW_MAC_TYPE_FIRST
 = 1,

65 
	mFW_MAC_TYPE_AUX
 = 
FW_MAC_TYPE_FIRST
,

66 
	mFW_MAC_TYPE_LISTENER
,

67 
	mFW_MAC_TYPE_PIBSS
,

68 
	mFW_MAC_TYPE_IBSS
,

69 
	mFW_MAC_TYPE_BSS_STA
,

70 
	mFW_MAC_TYPE_P2P_DEVICE
,

71 
	mFW_MAC_TYPE_P2P_STA
,

72 
	mFW_MAC_TYPE_GO
,

73 
	mFW_MAC_TYPE_TEST
,

74 
	mFW_MAC_TYPE_MAX
 = 
FW_MAC_TYPE_TEST


85 
	eiwl_tsf_id
 {

86 
	mTSF_ID_A
 = 0,

87 
	mTSF_ID_B
 = 1,

88 
	mTSF_ID_C
 = 2,

89 
	mTSF_ID_D
 = 3,

90 
	mNUM_TSF_IDS
 = 4,

105 
	siwl_mac_d©a_≠
 {

106 
__À32
 
	mbóc⁄_time
;

107 
__À64
 
	mbóc⁄_tsf
;

108 
__À32
 
	mbi
;

109 
__À32
 
	mª£rved1
;

110 
__À32
 
	mdtim_öãrvÆ
;

111 
__À32
 
	mª£rved2
;

112 
__À32
 
	mmˇ°_qid
;

113 
__À32
 
	mbóc⁄_ãm∂©e
;

114 } 
	g__∑cked
;

124 
	siwl_mac_d©a_ibss
 {

125 
__À32
 
	mbóc⁄_time
;

126 
__À64
 
	mbóc⁄_tsf
;

127 
__À32
 
	mbi
;

128 
__À32
 
	mª£rved
;

129 
__À32
 
	mbóc⁄_ãm∂©e
;

130 } 
	g__∑cked
;

144 
	eiwl_mac_d©a_pﬁicy
 {

145 
	mTWT_SUPPORTED
 = 
BIT
(0),

146 
	mMORE_DATA_ACK_SUPPORTED
 = 
BIT
(1),

147 
	mFLEXIBLE_TWT_SUPPORTED
 = 
BIT
(2),

148 
	mPROTECTED_TWT_SUPPORTED
 = 
BIT
(3),

149 
	mBROADCAST_TWT_SUPPORTED
 = 
BIT
(4),

150 
	mCOEX_HIGH_PRIORITY_ENABLE
 = 
BIT
(5),

166 
	siwl_mac_d©a_°a
 {

167 
__À32
 
	mis_assoc
;

168 
__À32
 
	mdtim_time
;

169 
__À64
 
	mdtim_tsf
;

170 
__À32
 
	mbi
;

171 
__À32
 
	mª£rved1
;

172 
__À32
 
	mdtim_öãrvÆ
;

173 
__À32
 
	md©a_pﬁicy
;

174 
__À32
 
	mli°í_öãrvÆ
;

175 
__À32
 
	massoc_id
;

176 
__À32
 
	massoc_bóc⁄_¨rive_time
;

177 } 
	g__∑cked
;

186 
	siwl_mac_d©a_go
 {

187 
iwl_mac_d©a_≠
 
	m≠
;

188 
__À32
 
	m˘wö
;

189 
__À32
 
	m›p_ps_íabÀd
;

190 } 
	g__∑cked
;

198 
	siwl_mac_d©a_p2p_°a
 {

199 
iwl_mac_d©a_°a
 
	m°a
;

200 
__À32
 
	m˘wö
;

201 } 
	g__∑cked
;

207 
	siwl_mac_d©a_pibss
 {

208 
__À32
 
	m°©s_öãrvÆ
;

209 } 
	g__∑cked
;

221 
	siwl_mac_d©a_p2p_dev
 {

222 
__À32
 
	mis_disc_exãnded
;

223 } 
	g__∑cked
;

239 
	eiwl_mac_fûãr_Êags
 {

240 
	mMAC_FILTER_IN_PROMISC
 = 
BIT
(0),

241 
	mMAC_FILTER_IN_CONTROL_AND_MGMT
 = 
BIT
(1),

242 
	mMAC_FILTER_ACCEPT_GRP
 = 
BIT
(2),

243 
	mMAC_FILTER_DIS_DECRYPT
 = 
BIT
(3),

244 
	mMAC_FILTER_DIS_GRP_DECRYPT
 = 
BIT
(4),

245 
	mMAC_FILTER_IN_BEACON
 = 
BIT
(6),

246 
	mMAC_FILTER_OUT_BCAST
 = 
BIT
(8),

247 
	mMAC_FILTER_IN_CRC32
 = 
BIT
(11),

248 
	mMAC_FILTER_IN_PROBE_REQUEST
 = 
BIT
(12),

252 
	mMAC_FILTER_IN_11AX
 = 
BIT
(14),

262 
	eiwl_mac_qos_Êags
 {

263 
	mMAC_QOS_FLG_UPDATE_EDCA
 = 
BIT
(0),

264 
	mMAC_QOS_FLG_TGN
 = 
BIT
(1),

265 
	mMAC_QOS_FLG_TXOP_TYPE
 = 
BIT
(4),

286 
	siwl_ac_qos
 {

287 
__À16
 
	mcw_mö
;

288 
__À16
 
	mcw_max
;

289 
u8
 
	maif¢
;

290 
u8
 
	mfifos_mask
;

291 
__À16
 
	medˇ_tx›
;

292 } 
	g__∑cked
;

314 
	siwl_mac_˘x_cmd
 {

316 
__À32
 
	mid_™d_cﬁ‹
;

317 
__À32
 
	ma˘i⁄
;

319 
__À32
 
	mmac_ty≥
;

320 
__À32
 
	mtsf_id
;

321 
u8
 
	mnode_addr
[6];

322 
__À16
 
	mª£rved_f‹_node_addr
;

323 
u8
 
	mbssid_addr
[6];

324 
__À16
 
	mª£rved_f‹_bssid_addr
;

325 
__À32
 
	mcck_øãs
;

326 
__À32
 
	mofdm_øãs
;

327 
__À32
 
	m¥Ÿe˘i⁄_Êags
;

328 
__À32
 
	mcck_sh‹t_¥ómbÀ
;

329 
__À32
 
	msh‹t_¶Ÿ
;

330 
__À32
 
	mfûãr_Êags
;

332 
__À32
 
	mqos_Êags
;

333 
iwl_ac_qos
 
	mac
[
AC_NUM
+1];

336 
iwl_mac_d©a_≠
 
	m≠
;

337 
iwl_mac_d©a_go
 
	mgo
;

338 
iwl_mac_d©a_°a
 
	m°a
;

339 
iwl_mac_d©a_p2p_°a
 
	mp2p_°a
;

340 
iwl_mac_d©a_p2p_dev
 
	mp2p_dev
;

341 
iwl_mac_d©a_pibss
 
	mpibss
;

342 
iwl_mac_d©a_ibss
 
	mibss
;

344 } 
	g__∑cked
;

346 
	#IWL_NONQOS_SEQ_GET
 0x1

	)

347 
	#IWL_NONQOS_SEQ_SET
 0x2

	)

348 
	siwl_n⁄qos_£q_quîy_cmd
 {

349 
__À32
 
	mgë_£t_Êag
;

350 
__À32
 
	mmac_id_n_cﬁ‹
;

351 
__À16
 
	mvÆue
;

352 
__À16
 
	mª£rved
;

353 } 
	g__∑cked
;

365 
	siwl_mis£d_bóc⁄s_nŸif_vî_3
 {

366 
__À32
 
	mmac_id
;

367 
__À32
 
	mc⁄£c_mis£d_bóc⁄s_sö˚_œ°_rx
;

368 
__À32
 
	mc⁄£c_mis£d_bóc⁄s
;

369 
__À32
 
	mnum_ex≥˘ed_bóc⁄s
;

370 
__À32
 
	mnum_ªcvd_bóc⁄s
;

371 } 
	g__∑cked
;

383 
	siwl_mis£d_bóc⁄s_nŸif
 {

384 
__À32
 
	mlök_id
;

385 
__À32
 
	mc⁄£c_mis£d_bóc⁄s_sö˚_œ°_rx
;

386 
__À32
 
	mc⁄£c_mis£d_bóc⁄s
;

387 
__À32
 
	mnum_ex≥˘ed_bóc⁄s
;

388 
__À32
 
	mnum_ªcvd_bóc⁄s
;

389 } 
	g__∑cked
;

404 
	siwl_he_backoff_c⁄f
 {

405 
__À16
 
	mcwmö
;

406 
__À16
 
	mcwmax
;

407 
__À16
 
	maif¢
;

408 
__À16
 
	mmu_time
;

409 } 
	g__∑cked
;

422 
	eiwl_he_pkt_ext_c⁄°ñœti⁄s
 {

423 
	mIWL_HE_PKT_EXT_BPSK
 = 0,

424 
	mIWL_HE_PKT_EXT_QPSK
,

425 
	mIWL_HE_PKT_EXT_16QAM
,

426 
	mIWL_HE_PKT_EXT_64QAM
,

427 
	mIWL_HE_PKT_EXT_256QAM
,

428 
	mIWL_HE_PKT_EXT_1024QAM
,

429 
	mIWL_HE_PKT_EXT_4096QAM
,

430 
	mIWL_HE_PKT_EXT_NONE
,

433 
	#MAX_HE_SUPP_NSS
 2

	)

434 
	#MAX_CHANNEL_BW_INDX_API_D_VER_1
 4

	)

435 
	#MAX_CHANNEL_BW_INDX_API_D_VER_2
 5

	)

457 
	siwl_he_pkt_ext_v1
 {

458 
u8
 
	mpkt_ext_qam_th
[
MAX_HE_SUPP_NSS
][
MAX_CHANNEL_BW_INDX_API_D_VER_1
][2];

459 } 
	g__∑cked
;

482 
	siwl_he_pkt_ext_v2
 {

483 
u8
 
	mpkt_ext_qam_th
[
MAX_HE_SUPP_NSS
][
MAX_CHANNEL_BW_INDX_API_D_VER_2
][2];

484 } 
	g__∑cked
;

517 
	eiwl_he_°a_˘xt_Êags
 {

518 
	mSTA_CTXT_HE_REF_BSSID_VALID
 = 
BIT
(4),

519 
	mSTA_CTXT_HE_BSS_COLOR_DIS
 = 
BIT
(5),

520 
	mSTA_CTXT_HE_PARTIAL_BSS_COLOR
 = 
BIT
(6),

521 
	mSTA_CTXT_HE_32BIT_BA_BITMAP
 = 
BIT
(7),

522 
	mSTA_CTXT_HE_PACKET_EXT
 = 
BIT
(8),

523 
	mSTA_CTXT_HE_TRIG_RND_ALLOC
 = 
BIT
(9),

524 
	mSTA_CTXT_HE_CONST_TRIG_RND_ALLOC
 = 
BIT
(10),

525 
	mSTA_CTXT_HE_ACK_ENABLED
 = 
BIT
(11),

526 
	mSTA_CTXT_HE_MU_EDCA_CW
 = 
BIT
(12),

527 
	mSTA_CTXT_HE_NIC_NOT_ACK_ENABLED
 = 
BIT
(13),

528 
	mSTA_CTXT_HE_RU_2MHZ_BLOCK
 = 
BIT
(14),

529 
	mSTA_CTXT_HE_NDP_FEEDBACK_ENABLED
 = 
BIT
(15),

530 
	mSTA_CTXT_EHT_PUNCTURE_MASK_VALID
 = 
BIT
(16),

531 
	mSTA_CTXT_EHT_LONG_PPE_ENABLED
 = 
BIT
(17),

543 
	eiwl_he_htc_Êags
 {

544 
	mIWL_HE_HTC_SUPPORT
 = 
BIT
(0),

545 
	mIWL_HE_HTC_UL_MU_RESP_SCHED
 = 
BIT
(3),

546 
	mIWL_HE_HTC_BSR_SUPP
 = 
BIT
(4),

547 
	mIWL_HE_HTC_OMI_SUPP
 = 
BIT
(5),

548 
	mIWL_HE_HTC_BQR_SUPP
 = 
BIT
(6),

557 
	#IWL_HE_HTC_LINK_ADAP_POS
 (1)

	)

558 
	#IWL_HE_HTC_LINK_ADAP_NO_FEEDBACK
 (0)

	)

559 
	#IWL_HE_HTC_LINK_ADAP_UNSOLICITED
 (2 << 
IWL_HE_HTC_LINK_ADAP_POS
)

	)

560 
	#IWL_HE_HTC_LINK_ADAP_BOTH
 (3 << 
IWL_HE_HTC_LINK_ADAP_POS
)

	)

586 
	siwl_he_°a_c⁄ãxt_cmd_v1
 {

587 
u8
 
	m°a_id
;

588 
u8
 
	mtid_limô
;

589 
u8
 
	mª£rved1
;

590 
u8
 
	mª£rved2
;

591 
__À32
 
	mÊags
;

594 
u8
 
	mªf_bssid_addr
[6];

595 
__À16
 
	mª£rved0
;

598 
__À32
 
	mhtc_Êags
;

600 
u8
 
	m‰ag_Êags
;

601 
u8
 
	m‰ag_Àvñ
;

602 
u8
 
	m‰ag_max_num
;

603 
u8
 
	m‰ag_mö_size
;

606 
iwl_he_pkt_ext_v1
 
	mpkt_ext
;

609 
u8
 
	mbss_cﬁ‹
;

610 
u8
 
	mhtc_åig_ba£d_pkt_ext
;

611 
__À16
 
	m‰ame_time_πs_th
;

614 
u8
 
	mønd_Æloc_ecwmö
;

615 
u8
 
	mønd_Æloc_ecwmax
;

616 
__À16
 
	mª£rved3
;

619 
iwl_he_backoff_c⁄f
 
	måig_ba£d_txf
[
AC_NUM
];

620 } 
	g__∑cked
;

654 
	siwl_he_°a_c⁄ãxt_cmd_v2
 {

655 
u8
 
	m°a_id
;

656 
u8
 
	mtid_limô
;

657 
u8
 
	mª£rved1
;

658 
u8
 
	mª£rved2
;

659 
__À32
 
	mÊags
;

662 
u8
 
	mªf_bssid_addr
[6];

663 
__À16
 
	mª£rved0
;

666 
__À32
 
	mhtc_Êags
;

668 
u8
 
	m‰ag_Êags
;

669 
u8
 
	m‰ag_Àvñ
;

670 
u8
 
	m‰ag_max_num
;

671 
u8
 
	m‰ag_mö_size
;

674 
iwl_he_pkt_ext_v1
 
	mpkt_ext
;

677 
u8
 
	mbss_cﬁ‹
;

678 
u8
 
	mhtc_åig_ba£d_pkt_ext
;

679 
__À16
 
	m‰ame_time_πs_th
;

682 
u8
 
	mønd_Æloc_ecwmö
;

683 
u8
 
	mønd_Æloc_ecwmax
;

684 
__À16
 
	mª£rved3
;

687 
iwl_he_backoff_c⁄f
 
	måig_ba£d_txf
[
AC_NUM
];

689 
u8
 
	mmax_bssid_ödiˇt‹
;

690 
u8
 
	mbssid_ödex
;

691 
u8
 
	mema_≠
;

692 
u8
 
	m¥ofûe_≥riodicôy
;

693 
u8
 
	mbssid_cou¡
;

694 
u8
 
	mª£rved4
[3];

695 } 
	g__∑cked
;

729 
	siwl_he_°a_c⁄ãxt_cmd_v3
 {

730 
u8
 
	m°a_id
;

731 
u8
 
	mtid_limô
;

732 
u8
 
	mª£rved1
;

733 
u8
 
	mª£rved2
;

734 
__À32
 
	mÊags
;

737 
u8
 
	mªf_bssid_addr
[6];

738 
__À16
 
	mª£rved0
;

741 
__À32
 
	mhtc_Êags
;

743 
u8
 
	m‰ag_Êags
;

744 
u8
 
	m‰ag_Àvñ
;

745 
u8
 
	m‰ag_max_num
;

746 
u8
 
	m‰ag_mö_size
;

749 
iwl_he_pkt_ext_v2
 
	mpkt_ext
;

752 
u8
 
	mbss_cﬁ‹
;

753 
u8
 
	mhtc_åig_ba£d_pkt_ext
;

754 
__À16
 
	m‰ame_time_πs_th
;

757 
u8
 
	mønd_Æloc_ecwmö
;

758 
u8
 
	mønd_Æloc_ecwmax
;

759 
__À16
 
	mpun˘uª_mask
;

762 
iwl_he_backoff_c⁄f
 
	måig_ba£d_txf
[
AC_NUM
];

764 
u8
 
	mmax_bssid_ödiˇt‹
;

765 
u8
 
	mbssid_ödex
;

766 
u8
 
	mema_≠
;

767 
u8
 
	m¥ofûe_≥riodicôy
;

768 
u8
 
	mbssid_cou¡
;

769 
u8
 
	mª£rved4
[3];

770 } 
	g__∑cked
;

779 
	siwl_he_m⁄ô‹_cmd
 {

780 
u8
 
	mbssid
[6];

781 
__À16
 
	mª£rved1
;

782 
__À16
 
	maid
;

783 
u8
 
	mª£rved2
[6];

784 } 
	g__∑cked
;

	@fw/api/nvm-reg.h

7 #i‚de‡
__iwl_fw_≠i_nvm_ªg_h__


8 
	#__iwl_fw_≠i_nvm_ªg_h__


	)

10 
	~"fw/ªguœt‹y.h
"

14 
	eiwl_ªguœt‹y_™d_nvm_subcmd_ids
 {

18 
	mNVM_ACCESS_COMPLETE
 = 0x0,

29 
	mLARI_CONFIG_CHANGE
 = 0x1,

36 
	mNVM_GET_INFO
 = 0x2,

41 
	mTAS_CONFIG
 = 0x3,

46 
	mSAR_OFFSET_MAPPING_TABLE_CMD
 = 0x4,

51 
	mUATS_TABLE_CMD
 = 0x5,

56 
	mPNVM_INIT_COMPLETE_NTFY
 = 0xFE,

64 
	eiwl_nvm_ac˚ss_›
 {

65 
	mIWL_NVM_READ
 = 0,

66 
	mIWL_NVM_WRITE
 = 1,

75 
	eiwl_nvm_ac˚ss_èrgë
 {

76 
	mNVM_ACCESS_TARGET_CACHE
 = 0,

77 
	mNVM_ACCESS_TARGET_OTP
 = 1,

78 
	mNVM_ACCESS_TARGET_EEPROM
 = 2,

92 
	eiwl_nvm_£˘i⁄_ty≥
 {

93 
	mNVM_SECTION_TYPE_SW
 = 1,

94 
	mNVM_SECTION_TYPE_REGULATORY
 = 3,

95 
	mNVM_SECTION_TYPE_CALIBRATION
 = 4,

96 
	mNVM_SECTION_TYPE_PRODUCTION
 = 5,

97 
	mNVM_SECTION_TYPE_REGULATORY_SDP
 = 8,

98 
	mNVM_SECTION_TYPE_MAC_OVERRIDE
 = 11,

99 
	mNVM_SECTION_TYPE_PHY_SKU
 = 12,

100 
	mNVM_MAX_NUM_SECTIONS
 = 13,

112 
	siwl_nvm_ac˚ss_cmd
 {

113 
u8
 
	m›_code
;

114 
u8
 
	mèrgë
;

115 
__À16
 
	mty≥
;

116 
__À16
 
	moff£t
;

117 
__À16
 
	mÀngth
;

118 
u8
 
	md©a
[];

119 } 
	g__∑cked
;

129 
	siwl_nvm_ac˚ss_ª•
 {

130 
__À16
 
	moff£t
;

131 
__À16
 
	mÀngth
;

132 
__À16
 
	mty≥
;

133 
__À16
 
	m°©us
;

134 
u8
 
	md©a
[];

135 } 
	g__∑cked
;

140 
	siwl_nvm_gë_öfo
 {

141 
__À32
 
	mª£rved
;

142 } 
	g__∑cked
;

148 
	eiwl_nvm_öfo_gíîÆ_Êags
 {

149 
	mNVM_GENERAL_FLAGS_EMPTY_OTP
 = 
BIT
(0),

159 
	siwl_nvm_gë_öfo_gíîÆ
 {

160 
__À32
 
	mÊags
;

161 
__À16
 
	mnvm_vîsi⁄
;

162 
u8
 
	mbﬂrd_ty≥
;

163 
u8
 
	mn_hw_addrs
;

164 } 
	g__∑cked
;

177 
	eiwl_nvm_mac_sku_Êags
 {

178 
	mNVM_MAC_SKU_FLAGS_BAND_2_4_ENABLED
 = 
BIT
(0),

179 
	mNVM_MAC_SKU_FLAGS_BAND_5_2_ENABLED
 = 
BIT
(1),

180 
	mNVM_MAC_SKU_FLAGS_802_11N_ENABLED
 = 
BIT
(2),

181 
	mNVM_MAC_SKU_FLAGS_802_11AC_ENABLED
 = 
BIT
(3),

185 
	mNVM_MAC_SKU_FLAGS_802_11AX_ENABLED
 = 
BIT
(4),

186 
	mNVM_MAC_SKU_FLAGS_MIMO_DISABLED
 = 
BIT
(5),

187 
	mNVM_MAC_SKU_FLAGS_WAPI_ENABLED
 = 
BIT
(8),

188 
	mNVM_MAC_SKU_FLAGS_REG_CHECK_ENABLED
 = 
BIT
(14),

189 
	mNVM_MAC_SKU_FLAGS_API_LOCK_ENABLED
 = 
BIT
(15),

196 
	siwl_nvm_gë_öfo_sku
 {

197 
__À32
 
	mmac_sku_Êags
;

198 } 
	g__∑cked
;

205 
	siwl_nvm_gë_öfo_phy
 {

206 
__À32
 
	mtx_chaös
;

207 
__À32
 
	mrx_chaös
;

208 } 
	g__∑cked
;

210 
	#IWL_NUM_CHANNELS_V1
 51

	)

211 
	#IWL_NUM_CHANNELS
 110

	)

219 
	siwl_nvm_gë_öfo_ªguœt‹y_v1
 {

220 
__À32
 
	mœr_íabÀd
;

221 
__À16
 
	mch™√l_¥ofûe
[
IWL_NUM_CHANNELS_V1
];

222 
__À16
 
	mª£rved
;

223 } 
	g__∑cked
;

231 
	siwl_nvm_gë_öfo_ªguœt‹y
 {

232 
__À32
 
	mœr_íabÀd
;

233 
__À32
 
	mn_ch™√ls
;

234 
__À32
 
	mch™√l_¥ofûe
[
IWL_NUM_CHANNELS
];

235 } 
	g__∑cked
;

244 
	siwl_nvm_gë_öfo_r•_v3
 {

245 
iwl_nvm_gë_öfo_gíîÆ
 
	mgíîÆ
;

246 
iwl_nvm_gë_öfo_sku
 
	mmac_sku
;

247 
iwl_nvm_gë_öfo_phy
 
	mphy_sku
;

248 
iwl_nvm_gë_öfo_ªguœt‹y_v1
 
	mªguœt‹y
;

249 } 
	g__∑cked
;

258 
	siwl_nvm_gë_öfo_r•
 {

259 
iwl_nvm_gë_öfo_gíîÆ
 
	mgíîÆ
;

260 
iwl_nvm_gë_öfo_sku
 
	mmac_sku
;

261 
iwl_nvm_gë_öfo_phy
 
	mphy_sku
;

262 
iwl_nvm_gë_öfo_ªguœt‹y
 
	mªguœt‹y
;

263 } 
	g__∑cked
;

269 
	siwl_nvm_ac˚ss_com∂ëe_cmd
 {

270 
__À32
 
	mª£rved
;

271 } 
	g__∑cked
;

273 
	#IWL_MCC_US
 0x5553

	)

274 
	#IWL_MCC_CANADA
 0x4341

	)

288 
	siwl_mcc_upd©e_cmd
 {

289 
__À16
 
	mmcc
;

290 
u8
 
	msour˚_id
;

291 
u8
 
	mª£rved
;

292 
__À32
 
	mkey
;

293 
u8
 
	mª£rved2
[20];

294 } 
	g__∑cked
;

302 
	eiwl_geo_öf‹m©i⁄
 {

303 
	mGEO_NO_INFO
 = 0,

304 
	mGEO_WMM_ETSI_5GHZ_INFO
 = 
BIT
(0),

323 
	siwl_mcc_upd©e_ª•_v3
 {

324 
__À32
 
	m°©us
;

325 
__À16
 
	mmcc
;

326 
u8
 
	mˇp
;

327 
u8
 
	msour˚_id
;

328 
__À16
 
	mtime
;

329 
__À16
 
	mgeo_öfo
;

330 
__À32
 
	mn_ch™√ls
;

331 
__À32
 
	mch™√ls
[];

332 } 
	g__∑cked
;

351 
	siwl_mcc_upd©e_ª•_v4
 {

352 
__À32
 
	m°©us
;

353 
__À16
 
	mmcc
;

354 
__À16
 
	mˇp
;

355 
__À16
 
	mtime
;

356 
__À16
 
	mgeo_öfo
;

357 
u8
 
	msour˚_id
;

358 
u8
 
	mª£rved
[3];

359 
__À32
 
	mn_ch™√ls
;

360 
__À32
 
	mch™√ls
[];

361 } 
	g__∑cked
;

381 
	siwl_mcc_upd©e_ª•_v8
 {

382 
__À32
 
	m°©us
;

383 
__À16
 
	mmcc
;

384 
u8
 
	m∑ddög
[2];

385 
__À32
 
	mˇp
;

386 
__À16
 
	mtime
;

387 
__À16
 
	mgeo_öfo
;

388 
u8
 
	msour˚_id
;

389 
u8
 
	mª£rved
[3];

390 
__À32
 
	mn_ch™√ls
;

391 
__À32
 
	mch™√ls
[];

392 } 
	g__∑cked
;

409 
	siwl_mcc_chub_nŸif
 {

410 
__À16
 
	mmcc
;

411 
u8
 
	msour˚_id
;

412 
u8
 
	mª£rved1
;

413 } 
	g__∑cked
;

415 
	eiwl_mcc_upd©e_°©us
 {

416 
	mMCC_RESP_NEW_CHAN_PROFILE
,

417 
	mMCC_RESP_SAME_CHAN_PROFILE
,

418 
	mMCC_RESP_INVALID
,

419 
	mMCC_RESP_NVM_DISABLED
,

420 
	mMCC_RESP_ILLEGAL
,

421 
	mMCC_RESP_LOW_PRIORITY
,

422 
	mMCC_RESP_TEST_MODE_ACTIVE
,

423 
	mMCC_RESP_TEST_MODE_NOT_ACTIVE
,

424 
	mMCC_RESP_TEST_MODE_DENIAL_OF_SERVICE
,

427 
	eiwl_mcc_sour˚
 {

428 
	mMCC_SOURCE_OLD_FW
 = 0,

429 
	mMCC_SOURCE_ME
 = 1,

430 
	mMCC_SOURCE_BIOS
 = 2,

431 
	mMCC_SOURCE_3G_LTE_HOST
 = 3,

432 
	mMCC_SOURCE_3G_LTE_DEVICE
 = 4,

433 
	mMCC_SOURCE_WIFI
 = 5,

434 
	mMCC_SOURCE_RESERVED
 = 6,

435 
	mMCC_SOURCE_DEFAULT
 = 7,

436 
	mMCC_SOURCE_UNINITIALIZED
 = 8,

437 
	mMCC_SOURCE_MCC_API
 = 9,

438 
	mMCC_SOURCE_GET_CURRENT
 = 0x10,

439 
	mMCC_SOURCE_GETTING_MCC_TEST_MODE
 = 0x11,

448 
	siwl_ès_c⁄fig_cmd_comm⁄
 {

449 
__À32
 
	mblock_li°_size
;

450 
__À32
 
	mblock_li°_¨øy
[
IWL_WTAS_BLACK_LIST_MAX
];

451 } 
	g__∑cked
;

459 
	siwl_ès_c⁄fig_cmd_v3
 {

460 
__À16
 
	movîride_ès_õc
;

461 
__À16
 
	míabÀ_ès_õc
;

462 } 
	g__∑cked
;

472 
	siwl_ès_c⁄fig_cmd_v4
 {

473 
u8
 
	movîride_ès_õc
;

474 
u8
 
	míabÀ_ès_õc
;

475 
u8
 
	muß_ès_uhb_Ælowed
;

476 
u8
 
	mª£rved
;

477 } 
	g__∑cked
;

479 
	siwl_ès_c⁄fig_cmd
 {

480 
iwl_ès_c⁄fig_cmd_comm⁄
 
	mcomm⁄
;

482 
iwl_ès_c⁄fig_cmd_v3
 
	mv3
;

483 
iwl_ès_c⁄fig_cmd_v4
 
	mv4
;

496 
	eiwl_œri_c⁄fig_masks
 {

497 
	mLARI_CONFIG_DISABLE_11AC_UKRAINE_MSK
 = 
BIT
(0),

498 
	mLARI_CONFIG_CHANGE_ETSI_TO_PASSIVE_MSK
 = 
BIT
(1),

499 
	mLARI_CONFIG_CHANGE_ETSI_TO_DISABLED_MSK
 = 
BIT
(2),

500 
	mLARI_CONFIG_ENABLE_5G2_IN_INDONESIA_MSK
 = 
BIT
(3),

501 
	mLARI_CONFIG_ENABLE_CHINA_22_REG_SUPPORT_MSK
 = 
BIT
(7),

504 
	#IWL_11AX_UKRAINE_MASK
 3

	)

505 
	#IWL_11AX_UKRAINE_SHIFT
 8

	)

512 
	siwl_œri_c⁄fig_ch™ge_cmd_v1
 {

513 
__À32
 
	mc⁄fig_bôm≠
;

514 } 
	g__∑cked
;

522 
	siwl_œri_c⁄fig_ch™ge_cmd_v2
 {

523 
__À32
 
	mc⁄fig_bôm≠
;

524 
__À32
 
	m€m_uhb_Ælow_bôm≠
;

525 } 
	g__∑cked
;

536 
	siwl_œri_c⁄fig_ch™ge_cmd_v3
 {

537 
__À32
 
	mc⁄fig_bôm≠
;

538 
__À32
 
	m€m_uhb_Ælow_bôm≠
;

539 
__À32
 
	m€m_11ax_Ælow_bôm≠
;

540 } 
	g__∑cked
;

554 
	siwl_œri_c⁄fig_ch™ge_cmd_v4
 {

555 
__À32
 
	mc⁄fig_bôm≠
;

556 
__À32
 
	m€m_uhb_Ælow_bôm≠
;

557 
__À32
 
	m€m_11ax_Ælow_bôm≠
;

558 
__À32
 
	m€m_unii4_Ælow_bôm≠
;

559 } 
	g__∑cked
;

576 
	siwl_œri_c⁄fig_ch™ge_cmd_v5
 {

577 
__À32
 
	mc⁄fig_bôm≠
;

578 
__À32
 
	m€m_uhb_Ælow_bôm≠
;

579 
__À32
 
	m€m_11ax_Ælow_bôm≠
;

580 
__À32
 
	m€m_unii4_Ælow_bôm≠
;

581 
__À32
 
	mch™_°©e_a˘ive_bôm≠
;

582 } 
	g__∑cked
;

601 
	siwl_œri_c⁄fig_ch™ge_cmd_v6
 {

602 
__À32
 
	mc⁄fig_bôm≠
;

603 
__À32
 
	m€m_uhb_Ælow_bôm≠
;

604 
__À32
 
	m€m_11ax_Ælow_bôm≠
;

605 
__À32
 
	m€m_unii4_Ælow_bôm≠
;

606 
__À32
 
	mch™_°©e_a˘ive_bôm≠
;

607 
__À32
 
	mf‹˚_dißbÀ_ch™√ls_bôm≠
;

608 } 
	g__∑cked
;

634 
	siwl_œri_c⁄fig_ch™ge_cmd_v7
 {

635 
__À32
 
	mc⁄fig_bôm≠
;

636 
__À32
 
	m€m_uhb_Ælow_bôm≠
;

637 
__À32
 
	m€m_11ax_Ælow_bôm≠
;

638 
__À32
 
	m€m_unii4_Ælow_bôm≠
;

639 
__À32
 
	mch™_°©e_a˘ive_bôm≠
;

640 
__À32
 
	mf‹˚_dißbÀ_ch™√ls_bôm≠
;

641 
__À32
 
	medt_bôm≠
;

642 } 
	g__∑cked
;

647 
	#ACTIVATE_5G2_IN_WW_MASK
 
	`BIT
(4)

	)

653 
	siwl_≤vm_öô_com∂ëe_¡fy
 {

654 
__À32
 
	m°©us
;

655 } 
	g__∑cked
;

657 
	#UATS_TABLE_ROW_SIZE
 26

	)

658 
	#UATS_TABLE_COL_SIZE
 13

	)

665 
	siwl_u©s_èbÀ_cmd
 {

666 
u8
 
	moff£t_m≠
[
UATS_TABLE_ROW_SIZE
][
UATS_TABLE_COL_SIZE
];

667 
__À16
 
	mª£rved
;

668 } 
	g__∑cked
;

	@fw/api/offload.h

8 #i‚de‡
__iwl_fw_≠i_ofÊﬂd_h__


9 
	#__iwl_fw_≠i_ofÊﬂd_h__


	)

14 
	eiwl_¥Ÿ_ofÊﬂd_subcmd_ids
 {

18 
	mWOWLAN_WAKE_PKT_NOTIFICATION
 = 0xFC,

25 
	mWOWLAN_INFO_NOTIFICATION
 = 0xFD,

30 
	mD3_END_NOTIFICATION
 = 0xFE,

36 
	mSTORED_BEACON_NTF
 = 0xFF,

39 
	#MAX_STORED_BEACON_SIZE
 600

	)

52 
	siwl_°‹ed_bóc⁄_nŸif_comm⁄
 {

53 
__À32
 
	msy°em_time
;

54 
__À64
 
	mtsf
;

55 
__À32
 
	mbóc⁄_time°amp
;

56 
__À16
 
	mb™d
;

57 
__À16
 
	mch™√l
;

58 
__À32
 
	møãs
;

59 
__À32
 
	mbyã_cou¡
;

60 } 
	g__∑cked
;

68 
	siwl_°‹ed_bóc⁄_nŸif_v2
 {

69 
iwl_°‹ed_bóc⁄_nŸif_comm⁄
 
	mcomm⁄
;

70 
u8
 
	md©a
[
MAX_STORED_BEACON_SIZE
];

71 } 
	g__∑cked
;

81 
	siwl_°‹ed_bóc⁄_nŸif_v3
 {

82 
iwl_°‹ed_bóc⁄_nŸif_comm⁄
 
	mcomm⁄
;

83 
u8
 
	m°a_id
;

84 
u8
 
	mª£rved
[3];

85 
u8
 
	md©a
[
MAX_STORED_BEACON_SIZE
];

86 } 
	g__∑cked
;

	@fw/api/paging.h

7 #i‚de‡
__iwl_fw_≠i_∑gög_h__


8 
	#__iwl_fw_≠i_∑gög_h__


	)

10 
	#NUM_OF_FW_PAGING_BLOCKS
 33

	)

22 
	siwl_fw_∑gög_cmd
 {

23 
__À32
 
	mÊags
;

24 
__À32
 
	mblock_size
;

25 
__À32
 
	mblock_num
;

26 
__À32
 
	mdevi˚_phy_addr
[
NUM_OF_FW_PAGING_BLOCKS
];

27 } 
	g__∑cked
;

	@fw/api/phy-ctxt.h

7 #i‚de‡
__iwl_fw_≠i_phy_˘xt_h__


8 
	#__iwl_fw_≠i_phy_˘xt_h__


	)

11 
	#PHY_BAND_5
 (0)

	)

12 
	#PHY_BAND_24
 (1)

	)

13 
	#PHY_BAND_6
 (2)

	)

16 
	#IWL_PHY_CHANNEL_MODE20
 0x0

	)

17 
	#IWL_PHY_CHANNEL_MODE40
 0x1

	)

18 
	#IWL_PHY_CHANNEL_MODE80
 0x2

	)

19 
	#IWL_PHY_CHANNEL_MODE160
 0x3

	)

21 
	#IWL_PHY_CHANNEL_MODE320
 0x4

	)

37 
	#IWL_PHY_CTRL_POS_ABOVE
 0x4

	)

38 
	#IWL_PHY_CTRL_POS_OFFS_EXT
 0x8

	)

39 
	#IWL_PHY_CTRL_POS_OFFS_MSK
 0x3

	)

49 
	siwl_fw_ch™√l_öfo_v1
 {

50 
u8
 
	mb™d
;

51 
u8
 
	mch™√l
;

52 
u8
 
	mwidth
;

53 
u8
 
	m˘æ_pos
;

54 } 
	g__∑cked
;

65 
	siwl_fw_ch™√l_öfo
 {

66 
__À32
 
	mch™√l
;

67 
u8
 
	mb™d
;

68 
u8
 
	mwidth
;

69 
u8
 
	m˘æ_pos
;

70 
u8
 
	mª£rved
;

71 } 
	g__∑cked
;

73 
	#PHY_RX_CHAIN_DRIVER_FORCE_POS
 (0)

	)

74 
	#PHY_RX_CHAIN_DRIVER_FORCE_MSK
 \

75 (0x1 << 
PHY_RX_CHAIN_DRIVER_FORCE_POS
)

	)

76 
	#PHY_RX_CHAIN_VALID_POS
 (1)

	)

77 
	#PHY_RX_CHAIN_VALID_MSK
 \

78 (0x7 << 
PHY_RX_CHAIN_VALID_POS
)

	)

79 
	#PHY_RX_CHAIN_FORCE_SEL_POS
 (4)

	)

80 
	#PHY_RX_CHAIN_FORCE_SEL_MSK
 \

81 (0x7 << 
PHY_RX_CHAIN_FORCE_SEL_POS
)

	)

82 
	#PHY_RX_CHAIN_FORCE_MIMO_SEL_POS
 (7)

	)

83 
	#PHY_RX_CHAIN_FORCE_MIMO_SEL_MSK
 \

84 (0x7 << 
PHY_RX_CHAIN_FORCE_MIMO_SEL_POS
)

	)

85 
	#PHY_RX_CHAIN_CNT_POS
 (10)

	)

86 
	#PHY_RX_CHAIN_CNT_MSK
 \

87 (0x3 << 
PHY_RX_CHAIN_CNT_POS
)

	)

88 
	#PHY_RX_CHAIN_MIMO_CNT_POS
 (12)

	)

89 
	#PHY_RX_CHAIN_MIMO_CNT_MSK
 \

90 (0x3 << 
PHY_RX_CHAIN_MIMO_CNT_POS
)

	)

91 
	#PHY_RX_CHAIN_MIMO_FORCE_POS
 (14)

	)

92 
	#PHY_RX_CHAIN_MIMO_FORCE_MSK
 \

93 (0x1 << 
PHY_RX_CHAIN_MIMO_FORCE_POS
)

	)

96 
	#NUM_PHY_CTX
 3

	)

108 
	siwl_phy_c⁄ãxt_cmd_èû
 {

109 
__À32
 
	mtxchaö_öfo
;

110 
__À32
 
	mrxchaö_öfo
;

111 
__À32
 
	macquisôi⁄_d©a
;

112 
__À32
 
	md•_cfg_Êags
;

113 } 
	g__∑cked
;

126 
	siwl_phy_c⁄ãxt_cmd_v1
 {

128 
__À32
 
	mid_™d_cﬁ‹
;

129 
__À32
 
	ma˘i⁄
;

131 
__À32
 
	m≠∂y_time
;

132 
__À32
 
	mtx_∑øm_cﬁ‹
;

133 
iwl_fw_ch™√l_öfo
 
	mci
;

134 
iwl_phy_c⁄ãxt_cmd_èû
 
	mèû
;

135 } 
	g__∑cked
;

150 
	siwl_phy_c⁄ãxt_cmd
 {

152 
__À32
 
	mid_™d_cﬁ‹
;

153 
__À32
 
	ma˘i⁄
;

155 
iwl_fw_ch™√l_öfo
 
	mci
;

156 
__À32
 
	mlmac_id
;

158 
__À32
 
	mrxchaö_öfo
;

160 
u8
 
	msbb_b™dwidth
;

161 
u8
 
	msbb_˘æ_ch™√l_loc
;

162 
__À16
 
	mpun˘uª_mask
;

165 
__À32
 
	md•_cfg_Êags
;

166 
__À32
 
	mª£rved
;

167 } 
	g__∑cked
;

	@fw/api/phy.h

7 #i‚de‡
__iwl_fw_≠i_phy_h__


8 
	#__iwl_fw_≠i_phy_h__


	)

13 
	eiwl_phy_›s_subcmd_ids
 {

19 
	mCMD_DTS_MEASUREMENT_TRIGGER_WIDE
 = 0x0,

24 
	mCTDP_CONFIG_CMD
 = 0x03,

29 
	mTEMP_REPORTING_THRESHOLDS_CMD
 = 0x04,

38 
	mPER_CHAIN_LIMIT_OFFSET_CMD
 = 0x05,

43 
	mPER_PLATFORM_ANT_GAIN_CMD
 = 0x07,

48 
	mCT_KILL_NOTIFICATION
 = 0xFE,

55 
	mDTS_MEASUREMENT_NOTIF_WIDE
 = 0xFF,

60 
	eiwl_dts_mósuªmít_Êags
 {

61 
	mDTS_TRIGGER_CMD_FLAGS_TEMP
 = 
BIT
(0),

62 
	mDTS_TRIGGER_CMD_FLAGS_VOLT
 = 
BIT
(1),

71 
	siwl_dts_mósuªmít_cmd
 {

72 
__À32
 
	mÊags
;

73 } 
	g__∑cked
;

87 
	eiwl_dts_c⁄åﬁ_mósuªmít_mode
 {

88 
	mDTS_AUTOMATIC
 = 0,

89 
	mDTS_REQUEST_READ
 = 1,

90 
	mDTS_OVER_WRITE
 = 2,

91 
	mDTS_DIRECT_WITHOUT_MEASURE
 = 3,

102 
	eiwl_dts_u£d
 {

103 
	mDTS_USE_TOP
 = 0,

104 
	mDTS_USE_CHAIN_A
 = 1,

105 
	mDTS_USE_CHAIN_B
 = 2,

106 
	mDTS_USE_CHAIN_C
 = 3,

107 
	mXTAL_TEMPERATURE
 = 4,

115 
	eiwl_dts_bô_mode
 {

116 
	mDTS_BIT6_MODE
 = 0,

117 
	mDTS_BIT8_MODE
 = 1,

129 
	siwl_ext_dts_mósuªmít_cmd
 {

130 
__À32
 
	mc⁄åﬁ_mode
;

131 
__À32
 
	mãm≥øtuª
;

132 
__À32
 
	m£ns‹
;

133 
__À32
 
	mavg_Á˘‹
;

134 
__À32
 
	mbô_mode
;

135 
__À32
 
	m°ï_duøti⁄
;

136 } 
	g__∑cked
;

144 
	siwl_dts_mósuªmít_nŸif_v1
 {

145 
__À32
 
	mãmp
;

146 
__À32
 
	mvﬁège
;

147 } 
	g__∑cked
;

156 
	siwl_dts_mósuªmít_nŸif_v2
 {

157 
__À32
 
	mãmp
;

158 
__À32
 
	mvﬁège
;

159 
__À32
 
	mthªshﬁd_idx
;

160 } 
	g__∑cked
;

167 
	siwl_dts_mósuªmít_ª•
 {

168 
__À32
 
	mãmp
;

169 } 
	g__∑cked
;

186 
	s˘_kûl_nŸif
 {

187 
__À16
 
	mãm≥øtuª
;

188 
u8
 
	mdts
;

189 
u8
 
	mscheme
;

190 } 
	g__∑cked
;

198 
	eiwl_mvm_˘dp_cmd_›î©i⁄
 {

199 
	mCTDP_CMD_OPERATION_START
 = 0x1,

200 
	mCTDP_CMD_OPERATION_STOP
 = 0x2,

201 
	mCTDP_CMD_OPERATION_REPORT
 = 0x4,

211 
	siwl_mvm_˘dp_cmd
 {

212 
__À32
 
	m›î©i⁄
;

213 
__À32
 
	mbudgë
;

214 
__À32
 
	mwödow_size
;

215 } 
	g__∑cked
;

217 
	#IWL_MAX_DTS_TRIPS
 8

	)

225 
	sãmp_ªp‹t_ths_cmd
 {

226 
__À32
 
	mnum_ãmps
;

227 
__À16
 
	mthªshﬁds
[
IWL_MAX_DTS_TRIPS
];

228 } 
	g__∑cked
;

	@fw/api/power.h

7 #i‚de‡
__iwl_fw_≠i_powî_h__


8 
	#__iwl_fw_≠i_powî_h__


	)

27 
	eiwl_…r_c⁄fig_Êags
 {

28 
	mLTR_CFG_FLAG_FEATURE_ENABLE
 = 
BIT
(0),

29 
	mLTR_CFG_FLAG_HW_DIS_ON_SHADOW_REG_ACCESS
 = 
BIT
(1),

30 
	mLTR_CFG_FLAG_HW_EN_SHRT_WR_THROUGH
 = 
BIT
(2),

31 
	mLTR_CFG_FLAG_HW_DIS_ON_D0_2_D3
 = 
BIT
(3),

32 
	mLTR_CFG_FLAG_SW_SET_SHORT
 = 
BIT
(4),

33 
	mLTR_CFG_FLAG_SW_SET_LONG
 = 
BIT
(5),

34 
	mLTR_CFG_FLAG_DENIE_C10_ON_PD
 = 
BIT
(6),

35 
	mLTR_CFG_FLAG_UPDATE_VALUES
 = 
BIT
(7),

44 
	siwl_…r_c⁄fig_cmd_v1
 {

45 
__À32
 
	mÊags
;

46 
__À32
 
	m°©ic_l⁄g
;

47 
__À32
 
	m°©ic_sh‹t
;

48 } 
	g__∑cked
;

50 
	#LTR_VALID_STATES_NUM
 4

	)

63 
	siwl_…r_c⁄fig_cmd
 {

64 
__À32
 
	mÊags
;

65 
__À32
 
	m°©ic_l⁄g
;

66 
__À32
 
	m°©ic_sh‹t
;

67 
__À32
 
	m…r_cfg_vÆues
[
LTR_VALID_STATES_NUM
];

68 
__À32
 
	m…r_sh‹t_idÀ_timeout
;

69 } 
	g__∑cked
;

72 
	#POWER_LPRX_RSSI_THRESHOLD
 75

	)

73 
	#POWER_LPRX_RSSI_THRESHOLD_MAX
 94

	)

74 
	#POWER_LPRX_RSSI_THRESHOLD_MIN
 30

	)

93 
	eiwl_powî_Êags
 {

94 
	mPOWER_FLAGS_POWER_SAVE_ENA_MSK
 = 
BIT
(0),

95 
	mPOWER_FLAGS_POWER_MANAGEMENT_ENA_MSK
 = 
BIT
(1),

96 
	mPOWER_FLAGS_SKIP_OVER_DTIM_MSK
 = 
BIT
(2),

97 
	mPOWER_FLAGS_SNOOZE_ENA_MSK
 = 
BIT
(5),

98 
	mPOWER_FLAGS_BT_SCO_ENA
 = 
BIT
(8),

99 
	mPOWER_FLAGS_ADVANCE_PM_ENA_MSK
 = 
BIT
(9),

100 
	mPOWER_FLAGS_LPRX_ENA_MSK
 = 
BIT
(11),

101 
	mPOWER_FLAGS_UAPSD_MISBEHAVING_ENA_MSK
 = 
BIT
(12),

104 
	#IWL_POWER_VEC_SIZE
 5

	)

128 
	siwl_powîèbÀ_cmd
 {

130 
__À16
 
	mÊags
;

131 
u8
 
	mkìp_Æive_£c⁄ds
;

132 
u8
 
	mdebug_Êags
;

133 
__À32
 
	mrx_d©a_timeout
;

134 
__À32
 
	mtx_d©a_timeout
;

135 
__À32
 
	m¶ìp_öãrvÆ
[
IWL_POWER_VEC_SIZE
];

136 
__À32
 
	mskù_dtim_≥riods
;

137 
__À32
 
	mÕrx_rssi_thªshﬁd
;

138 } 
	g__∑cked
;

153 
	eiwl_devi˚_powî_Êags
 {

154 
	mDEVICE_POWER_FLAGS_POWER_SAVE_ENA_MSK
 = 
BIT
(0),

155 
	mDEVICE_POWER_FLAGS_ALLOW_MEM_RETENTION_MSK
 = 
BIT
(1),

156 
	mDEVICE_POWER_FLAGS_NO_SLEEP_TILL_D3_MSK
 = 
BIT
(7),

157 
	mDEVICE_POWER_FLAGS_32K_CLK_VALID_MSK
 = 
BIT
(12),

167 
	siwl_devi˚_powî_cmd
 {

169 
__À16
 
	mÊags
;

170 
__À16
 
	mª£rved
;

171 } 
	g__∑cked
;

215 
	siwl_mac_powî_cmd
 {

217 
__À32
 
	mid_™d_cﬁ‹
;

220 
__À16
 
	mÊags
;

221 
__À16
 
	mkìp_Æive_£c⁄ds
;

222 
__À32
 
	mrx_d©a_timeout
;

223 
__À32
 
	mtx_d©a_timeout
;

224 
__À32
 
	mrx_d©a_timeout_u≠sd
;

225 
__À32
 
	mtx_d©a_timeout_u≠sd
;

226 
u8
 
	mÕrx_rssi_thªshﬁd
;

227 
u8
 
	mskù_dtim_≥riods
;

228 
__À16
 
	m¢ooze_öãrvÆ
;

229 
__À16
 
	m¢ooze_wödow
;

230 
u8
 
	m¢ooze_°ï
;

231 
u8
 
	mqndp_tid
;

232 
u8
 
	mu≠sd_ac_Êags
;

233 
u8
 
	mu≠sd_max_•
;

234 
u8
 
	mhóvy_tx_thld_∑ckës
;

235 
u8
 
	mhóvy_rx_thld_∑ckës
;

236 
u8
 
	mhóvy_tx_thld_≥r˚¡age
;

237 
u8
 
	mhóvy_rx_thld_≥r˚¡age
;

238 
u8
 
	mlimôed_ps_thªshﬁd
;

239 
u8
 
	mª£rved
;

240 } 
	g__∑cked
;

249 
	siwl_u≠sd_misbehavög_≠_nŸif
 {

250 
__À32
 
	m°a_id
;

251 
u8
 
	mmac_id
;

252 
u8
 
	mª£rved
[3];

253 } 
	g__∑cked
;

262 
	siwl_ªdu˚_tx_powî_cmd
 {

263 
u8
 
	mÊags
;

264 
u8
 
	mmac_c⁄ãxt_id
;

265 
__À16
 
	mpwr_ª°ri˘i⁄
;

266 } 
	g__∑cked
;

268 
	eiwl_dev_tx_powî_cmd_mode
 {

269 
	mIWL_TX_POWER_MODE_SET_MAC
 = 0,

270 
	mIWL_TX_POWER_MODE_SET_DEVICE
 = 1,

271 
	mIWL_TX_POWER_MODE_SET_CHAINS
 = 2,

272 
	mIWL_TX_POWER_MODE_SET_ACK
 = 3,

273 
	mIWL_TX_POWER_MODE_SET_SAR_TIMER
 = 4,

274 
	mIWL_TX_POWER_MODE_SET_SAR_TIMER_DEFAULT_TABLE
 = 5,

277 
	#IWL_NUM_CHAIN_TABLES
 1

	)

278 
	#IWL_NUM_CHAIN_TABLES_V2
 2

	)

279 
	#IWL_NUM_CHAIN_LIMITS
 2

	)

280 
	#IWL_NUM_SUB_BANDS_V1
 5

	)

281 
	#IWL_NUM_SUB_BANDS_V2
 11

	)

292 
	siwl_dev_tx_powî_comm⁄
 {

293 
__À32
 
	m£t_mode
;

294 
__À32
 
	mmac_c⁄ãxt_id
;

295 
__À16
 
	mpwr_ª°ri˘i⁄
;

296 
__À16
 
	mdev_24
;

297 
__À16
 
	mdev_52_low
;

298 
__À16
 
	mdev_52_high
;

305 
	siwl_dev_tx_powî_cmd_v3
 {

306 
__À16
 
	m≥r_chaö
[
IWL_NUM_CHAIN_TABLES
][
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V1
];

307 } 
	g__∑cked
;

309 
	#IWL_DEV_MAX_TX_POWER
 0x7FFF

	)

318 
	siwl_dev_tx_powî_cmd_v4
 {

319 
__À16
 
	m≥r_chaö
[
IWL_NUM_CHAIN_TABLES
][
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V1
];

320 
u8
 
	míabÀ_ack_ªdu˘i⁄
;

321 
u8
 
	mª£rved
[3];

322 } 
	g__∑cked
;

337 
	siwl_dev_tx_powî_cmd_v5
 {

338 
__À16
 
	m≥r_chaö
[
IWL_NUM_CHAIN_TABLES
][
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V1
];

339 
u8
 
	míabÀ_ack_ªdu˘i⁄
;

340 
u8
 
	m≥r_chaö_ª°ri˘i⁄_ch™ged
;

341 
u8
 
	mª£rved
[2];

342 
__À32
 
	mtimî_≥riod
;

343 } 
	g__∑cked
;

358 
	siwl_dev_tx_powî_cmd_v6
 {

359 
__À16
 
	m≥r_chaö
[
IWL_NUM_CHAIN_TABLES_V2
][
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V2
];

360 
u8
 
	míabÀ_ack_ªdu˘i⁄
;

361 
u8
 
	m≥r_chaö_ª°ri˘i⁄_ch™ged
;

362 
u8
 
	mª£rved
[2];

363 
__À32
 
	mtimî_≥riod
;

364 } 
	g__∑cked
;

380 
	siwl_dev_tx_powî_cmd_v7
 {

381 
__À16
 
	m≥r_chaö
[
IWL_NUM_CHAIN_TABLES_V2
][
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V2
];

382 
u8
 
	míabÀ_ack_ªdu˘i⁄
;

383 
u8
 
	m≥r_chaö_ª°ri˘i⁄_ch™ged
;

384 
u8
 
	mª£rved
[2];

385 
__À32
 
	mtimî_≥riod
;

386 
__À32
 
	mÊags
;

387 } 
	g__∑cked
;

396 
	siwl_dev_tx_powî_cmd
 {

397 
iwl_dev_tx_powî_comm⁄
 
	mcomm⁄
;

399 
iwl_dev_tx_powî_cmd_v3
 
	mv3
;

400 
iwl_dev_tx_powî_cmd_v4
 
	mv4
;

401 
iwl_dev_tx_powî_cmd_v5
 
	mv5
;

402 
iwl_dev_tx_powî_cmd_v6
 
	mv6
;

403 
iwl_dev_tx_powî_cmd_v7
 
	mv7
;

407 
	#IWL_NUM_GEO_PROFILES
 3

	)

408 
	#IWL_NUM_GEO_PROFILES_V3
 8

	)

409 
	#IWL_NUM_BANDS_PER_CHAIN_V1
 2

	)

410 
	#IWL_NUM_BANDS_PER_CHAIN_V2
 3

	)

417 
	eiwl_geo_≥r_chaö_off£t_›î©i⁄
 {

418 
	mIWL_PER_CHAIN_OFFSET_SET_TABLES
,

419 
	mIWL_PER_CHAIN_OFFSET_GET_CURRENT_TABLE
,

428 
	siwl_≥r_chaö_off£t
 {

429 
__À16
 
	mmax_tx_powî
;

430 
u8
 
	mchaö_a
;

431 
u8
 
	mchaö_b
;

432 } 
	g__∑cked
;

439 
	siwl_geo_tx_powî_¥ofûes_cmd_v1
 {

440 
__À32
 
	m›s
;

441 
iwl_≥r_chaö_off£t
 
	mèbÀ
[
IWL_NUM_GEO_PROFILES
][
IWL_NUM_BANDS_PER_CHAIN_V1
];

442 } 
	g__∑cked
;

450 
	siwl_geo_tx_powî_¥ofûes_cmd_v2
 {

451 
__À32
 
	m›s
;

452 
iwl_≥r_chaö_off£t
 
	mèbÀ
[
IWL_NUM_GEO_PROFILES
][
IWL_NUM_BANDS_PER_CHAIN_V1
];

453 
__À32
 
	mèbÀ_ªvisi⁄
;

454 } 
	g__∑cked
;

462 
	siwl_geo_tx_powî_¥ofûes_cmd_v3
 {

463 
__À32
 
	m›s
;

464 
iwl_≥r_chaö_off£t
 
	mèbÀ
[
IWL_NUM_GEO_PROFILES
][
IWL_NUM_BANDS_PER_CHAIN_V2
];

465 
__À32
 
	mèbÀ_ªvisi⁄
;

466 } 
	g__∑cked
;

474 
	siwl_geo_tx_powî_¥ofûes_cmd_v4
 {

475 
__À32
 
	m›s
;

476 
iwl_≥r_chaö_off£t
 
	mèbÀ
[
IWL_NUM_GEO_PROFILES_V3
][
IWL_NUM_BANDS_PER_CHAIN_V1
];

477 
__À32
 
	mèbÀ_ªvisi⁄
;

478 } 
	g__∑cked
;

486 
	siwl_geo_tx_powî_¥ofûes_cmd_v5
 {

487 
__À32
 
	m›s
;

488 
iwl_≥r_chaö_off£t
 
	mèbÀ
[
IWL_NUM_GEO_PROFILES_V3
][
IWL_NUM_BANDS_PER_CHAIN_V2
];

489 
__À32
 
	mèbÀ_ªvisi⁄
;

490 } 
	g__∑cked
;

492 
	uiwl_geo_tx_powî_¥ofûes_cmd
 {

493 
iwl_geo_tx_powî_¥ofûes_cmd_v1
 
	mv1
;

494 
iwl_geo_tx_powî_¥ofûes_cmd_v2
 
	mv2
;

495 
iwl_geo_tx_powî_¥ofûes_cmd_v3
 
	mv3
;

496 
iwl_geo_tx_powî_¥ofûes_cmd_v4
 
	mv4
;

497 
iwl_geo_tx_powî_¥ofûes_cmd_v5
 
	mv5
;

504 
	siwl_geo_tx_powî_¥ofûes_ª•
 {

505 
__À32
 
	m¥ofûe_idx
;

506 } 
	g__∑cked
;

522 
	eiwl_µag_Êags
 {

523 
	mIWL_PPAG_ETSI_MASK
 = 
BIT
(0),

524 
	mIWL_PPAG_CHINA_MASK
 = 
BIT
(1),

525 
	mIWL_PPAG_ETSI_LPI_UHB_MASK
 = 
BIT
(2),

526 
	mIWL_PPAG_ETSI_VLP_UHB_MASK
 = 
BIT
(3),

527 
	mIWL_PPAG_ETSI_SP_UHB_MASK
 = 
BIT
(4),

528 
	mIWL_PPAG_USA_LPI_UHB_MASK
 = 
BIT
(5),

529 
	mIWL_PPAG_USA_VLP_UHB_MASK
 = 
BIT
(6),

530 
	mIWL_PPAG_USA_SP_UHB_MASK
 = 
BIT
(7),

531 
	mIWL_PPAG_CANADA_LPI_UHB_MASK
 = 
BIT
(8),

532 
	mIWL_PPAG_CANADA_VLP_UHB_MASK
 = 
BIT
(9),

533 
	mIWL_PPAG_CANADA_SP_UHB_MASK
 = 
BIT
(10),

546 
	uiwl_µag_èbÀ_cmd
 {

548 
__À32
 
	mÊags
;

549 
s8
 
	mgaö
[
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V1
];

550 
s8
 
	mª£rved
[2];

551 } 
	mv1
;

553 
__À32
 
	mÊags
;

554 
s8
 
	mgaö
[
IWL_NUM_CHAIN_LIMITS
][
IWL_NUM_SUB_BANDS_V2
];

555 
s8
 
	mª£rved
[2];

556 } 
	mv2
;

557 } 
	g__∑cked
;

559 
	#IWL_PPAG_CMD_V4_MASK
 (
IWL_PPAG_ETSI_MASK
 | 
IWL_PPAG_CHINA_MASK
)

	)

560 
	#IWL_PPAG_CMD_V5_MASK
 (
IWL_PPAG_CMD_V4_MASK
 | \

561 
IWL_PPAG_ETSI_LPI_UHB_MASK
 | \

562 
IWL_PPAG_USA_LPI_UHB_MASK
)

	)

564 
	#MCC_TO_SAR_OFFSET_TABLE_ROW_SIZE
 26

	)

565 
	#MCC_TO_SAR_OFFSET_TABLE_COL_SIZE
 13

	)

572 
	siwl_ßr_off£t_m≠pög_cmd
 {

573 
u8
 
	moff£t_m≠
[
MCC_TO_SAR_OFFSET_TABLE_ROW_SIZE
]

574 [
MCC_TO_SAR_OFFSET_TABLE_COL_SIZE
];

575 
__À16
 
	mª£rved
;

576 } 
	g__∑cked
;

626 
	siwl_bóc⁄_fûãr_cmd
 {

627 
__À32
 
	mbf_íîgy_dñè
;

628 
__À32
 
	mbf_rﬂmög_íîgy_dñè
;

629 
__À32
 
	mbf_rﬂmög_°©e
;

630 
__À32
 
	mbf_ãmp_thªshﬁd
;

631 
__À32
 
	mbf_ãmp_Á°_fûãr
;

632 
__À32
 
	mbf_ãmp_¶ow_fûãr
;

633 
__À32
 
	mbf_íabÀ_bóc⁄_fûãr
;

634 
__À32
 
	mbf_debug_Êag
;

635 
__À32
 
	mbf_esˇ≥_timî
;

636 
__À32
 
	mba_esˇ≥_timî
;

637 
__À32
 
	mba_íabÀ_bóc⁄_ab‹t
;

638 
__À32
 
	mbf_thªshﬁd_absﬁuã_low
[2];

639 
__À32
 
	mbf_thªshﬁd_absﬁuã_high
[2];

640 } 
	g__∑cked
;

643 
	#IWL_BF_ENERGY_DELTA_DEFAULT
 5

	)

644 
	#IWL_BF_ENERGY_DELTA_D0I3
 20

	)

645 
	#IWL_BF_ENERGY_DELTA_MAX
 255

	)

646 
	#IWL_BF_ENERGY_DELTA_MIN
 0

	)

648 
	#IWL_BF_ROAMING_ENERGY_DELTA_DEFAULT
 1

	)

649 
	#IWL_BF_ROAMING_ENERGY_DELTA_D0I3
 20

	)

650 
	#IWL_BF_ROAMING_ENERGY_DELTA_MAX
 255

	)

651 
	#IWL_BF_ROAMING_ENERGY_DELTA_MIN
 0

	)

653 
	#IWL_BF_ROAMING_STATE_DEFAULT
 72

	)

654 
	#IWL_BF_ROAMING_STATE_D0I3
 72

	)

655 
	#IWL_BF_ROAMING_STATE_MAX
 255

	)

656 
	#IWL_BF_ROAMING_STATE_MIN
 0

	)

658 
	#IWL_BF_TEMP_THRESHOLD_DEFAULT
 112

	)

659 
	#IWL_BF_TEMP_THRESHOLD_D0I3
 112

	)

660 
	#IWL_BF_TEMP_THRESHOLD_MAX
 255

	)

661 
	#IWL_BF_TEMP_THRESHOLD_MIN
 0

	)

663 
	#IWL_BF_TEMP_FAST_FILTER_DEFAULT
 1

	)

664 
	#IWL_BF_TEMP_FAST_FILTER_D0I3
 1

	)

665 
	#IWL_BF_TEMP_FAST_FILTER_MAX
 255

	)

666 
	#IWL_BF_TEMP_FAST_FILTER_MIN
 0

	)

668 
	#IWL_BF_TEMP_SLOW_FILTER_DEFAULT
 5

	)

669 
	#IWL_BF_TEMP_SLOW_FILTER_D0I3
 20

	)

670 
	#IWL_BF_TEMP_SLOW_FILTER_MAX
 255

	)

671 
	#IWL_BF_TEMP_SLOW_FILTER_MIN
 0

	)

673 
	#IWL_BF_ENABLE_BEACON_FILTER_DEFAULT
 1

	)

675 
	#IWL_BF_DEBUG_FLAG_DEFAULT
 0

	)

676 
	#IWL_BF_DEBUG_FLAG_D0I3
 0

	)

678 
	#IWL_BF_ESCAPE_TIMER_DEFAULT
 0

	)

679 
	#IWL_BF_ESCAPE_TIMER_D0I3
 0

	)

680 
	#IWL_BF_ESCAPE_TIMER_MAX
 1024

	)

681 
	#IWL_BF_ESCAPE_TIMER_MIN
 0

	)

683 
	#IWL_BA_ESCAPE_TIMER_DEFAULT
 6

	)

684 
	#IWL_BA_ESCAPE_TIMER_D0I3
 6

	)

685 
	#IWL_BA_ESCAPE_TIMER_D3
 9

	)

686 
	#IWL_BA_ESCAPE_TIMER_MAX
 1024

	)

687 
	#IWL_BA_ESCAPE_TIMER_MIN
 0

	)

689 
	#IWL_BA_ENABLE_BEACON_ABORT_DEFAULT
 1

	)

691 
	#IWL_BF_CMD_CONFIG
(
mode
) \

692 .
bf_íîgy_dñè
 = 
	`˝u_to_À32
(
IWL_BF_ENERGY_DELTA
 ## 
mode
), \

693 .
bf_rﬂmög_íîgy_dñè
 = \

694 
	`˝u_to_À32
(
IWL_BF_ROAMING_ENERGY_DELTA
 ## 
mode
), \

695 .
bf_rﬂmög_°©e
 = 
	`˝u_to_À32
(
IWL_BF_ROAMING_STATE
 ## 
mode
), \

696 .
bf_ãmp_thªshﬁd
 = 
	`˝u_to_À32
(
IWL_BF_TEMP_THRESHOLD
 ## 
mode
), \

697 .
bf_ãmp_Á°_fûãr
 = 
	`˝u_to_À32
(
IWL_BF_TEMP_FAST_FILTER
 ## 
mode
), \

698 .
bf_ãmp_¶ow_fûãr
 = 
	`˝u_to_À32
(
IWL_BF_TEMP_SLOW_FILTER
 ## 
mode
), \

699 .
bf_debug_Êag
 = 
	`˝u_to_À32
(
IWL_BF_DEBUG_FLAG
 ## 
mode
), \

700 .
bf_esˇ≥_timî
 = 
	`˝u_to_À32
(
IWL_BF_ESCAPE_TIMER
 ## 
mode
), \

701 .
ba_esˇ≥_timî
 = 
	`˝u_to_À32
(
IWL_BA_ESCAPE_TIMER
 ## 
mode
)

	)

703 
	#IWL_BF_CMD_CONFIG_DEFAULTS
 
	`IWL_BF_CMD_CONFIG
(
_DEFAULT
)

	)

704 
	#IWL_BF_CMD_CONFIG_D0I3
 
	`IWL_BF_CMD_CONFIG
(
_D0I3
)

	)

	@fw/api/rfi.h

5 #i‚de‡
__iwl_fw_≠i_rfi_h__


6 
	#__iwl_fw_≠i_rfi_h__


	)

8 
	#IWL_RFI_LUT_ENTRY_CHANNELS_NUM
 15

	)

9 
	#IWL_RFI_LUT_SIZE
 24

	)

10 
	#IWL_RFI_LUT_INSTALLED_SIZE
 4

	)

19 
	siwl_rfi_lut_íåy
 {

20 
__À16
 
	m‰eq
;

21 
u8
 
	mch™√ls
[
IWL_RFI_LUT_ENTRY_CHANNELS_NUM
];

22 
u8
 
	mb™ds
[
IWL_RFI_LUT_ENTRY_CHANNELS_NUM
];

23 } 
	g__∑cked
;

32 
	siwl_rfi_c⁄fig_cmd
 {

33 
iwl_rfi_lut_íåy
 
	mèbÀ
[
IWL_RFI_LUT_SIZE
];

34 
u8
 
	m€m
;

35 
u8
 
	mª£rved
[3];

36 } 
	g__∑cked
;

44 
	eiwl_rfi_‰eq_èbÀ_°©us
 {

45 
	mRFI_FREQ_TABLE_OK
,

46 
	mRFI_FREQ_TABLE_DVFS_NOT_READY
,

47 
	mRFI_FREQ_TABLE_DISABLED
,

56 
	siwl_rfi_‰eq_èbÀ_ª•_cmd
 {

57 
iwl_rfi_lut_íåy
 
	mèbÀ
[
IWL_RFI_LUT_INSTALLED_SIZE
];

58 
__À32
 
	m°©us
;

59 } 
	g__∑cked
;

66 
	siwl_rfi_dó˘iv©e_nŸif
 {

67 
__À32
 
	mªas⁄
;

68 } 
	g__∑cked
;

	@fw/api/rs.h

6 #i‚de‡
__iwl_fw_≠i_rs_h__


7 
	#__iwl_fw_≠i_rs_h__


	)

9 
	~"mac.h
"

26 
	eiwl_éc_mng_cfg_Êags
 {

27 
	mIWL_TLC_MNG_CFG_FLAGS_STBC_MSK
 = 
BIT
(0),

28 
	mIWL_TLC_MNG_CFG_FLAGS_LDPC_MSK
 = 
BIT
(1),

29 
	mIWL_TLC_MNG_CFG_FLAGS_HE_STBC_160MHZ_MSK
 = 
BIT
(2),

30 
	mIWL_TLC_MNG_CFG_FLAGS_HE_DCM_NSS_1_MSK
 = 
BIT
(3),

31 
	mIWL_TLC_MNG_CFG_FLAGS_HE_DCM_NSS_2_MSK
 = 
BIT
(4),

32 
	mIWL_TLC_MNG_CFG_FLAGS_EHT_EXTRA_LTF_MSK
 = 
BIT
(6),

43 
	eiwl_éc_mng_cfg_cw
 {

44 
	mIWL_TLC_MNG_CH_WIDTH_20MHZ
,

45 
	mIWL_TLC_MNG_CH_WIDTH_40MHZ
,

46 
	mIWL_TLC_MNG_CH_WIDTH_80MHZ
,

47 
	mIWL_TLC_MNG_CH_WIDTH_160MHZ
,

48 
	mIWL_TLC_MNG_CH_WIDTH_320MHZ
,

56 
	eiwl_éc_mng_cfg_chaös
 {

57 
	mIWL_TLC_MNG_CHAIN_A_MSK
 = 
BIT
(0),

58 
	mIWL_TLC_MNG_CHAIN_B_MSK
 = 
BIT
(1),

71 
	eiwl_éc_mng_cfg_mode
 {

72 
	mIWL_TLC_MNG_MODE_CCK
 = 0,

73 
	mIWL_TLC_MNG_MODE_OFDM_NON_HT
 = 
IWL_TLC_MNG_MODE_CCK
,

74 
	mIWL_TLC_MNG_MODE_NON_HT
 = 
IWL_TLC_MNG_MODE_CCK
,

75 
	mIWL_TLC_MNG_MODE_HT
,

76 
	mIWL_TLC_MNG_MODE_VHT
,

77 
	mIWL_TLC_MNG_MODE_HE
,

78 
	mIWL_TLC_MNG_MODE_EHT
,

97 
	eiwl_éc_mng_ht_øãs
 {

98 
	mIWL_TLC_MNG_HT_RATE_MCS0
 = 0,

99 
	mIWL_TLC_MNG_HT_RATE_MCS1
,

100 
	mIWL_TLC_MNG_HT_RATE_MCS2
,

101 
	mIWL_TLC_MNG_HT_RATE_MCS3
,

102 
	mIWL_TLC_MNG_HT_RATE_MCS4
,

103 
	mIWL_TLC_MNG_HT_RATE_MCS5
,

104 
	mIWL_TLC_MNG_HT_RATE_MCS6
,

105 
	mIWL_TLC_MNG_HT_RATE_MCS7
,

106 
	mIWL_TLC_MNG_HT_RATE_MCS8
,

107 
	mIWL_TLC_MNG_HT_RATE_MCS9
,

108 
	mIWL_TLC_MNG_HT_RATE_MCS10
,

109 
	mIWL_TLC_MNG_HT_RATE_MCS11
,

110 
	mIWL_TLC_MNG_HT_RATE_MAX
 = 
IWL_TLC_MNG_HT_RATE_MCS11
,

113 
	eIWL_TLC_MNG_NSS
 {

114 
	mIWL_TLC_NSS_1
,

115 
	mIWL_TLC_NSS_2
,

116 
	mIWL_TLC_NSS_MAX


127 
	eIWL_TLC_MCS_PER_BW
 {

128 
	mIWL_TLC_MCS_PER_BW_80
,

129 
	mIWL_TLC_MCS_PER_BW_160
,

130 
	mIWL_TLC_MCS_PER_BW_320
,

131 
	mIWL_TLC_MCS_PER_BW_NUM_V3
 = 
IWL_TLC_MCS_PER_BW_160
 + 1,

132 
	mIWL_TLC_MCS_PER_BW_NUM_V4
 = 
IWL_TLC_MCS_PER_BW_320
 + 1,

154 
	siwl_éc_c⁄fig_cmd_v3
 {

155 
u8
 
	m°a_id
;

156 
u8
 
	mª£rved1
[3];

157 
u8
 
	mmax_ch_width
;

158 
u8
 
	mmode
;

159 
u8
 
	mchaös
;

160 
u8
 
	mamsdu
;

161 
__À16
 
	mÊags
;

162 
__À16
 
	mn⁄_ht_øãs
;

163 
__À16
 
	mht_øãs
[
IWL_TLC_NSS_MAX
][
IWL_TLC_MCS_PER_BW_NUM_V3
];

164 
__À16
 
	mmax_mpdu_Àn
;

165 
u8
 
	msgi_ch_width_suµ
;

166 
u8
 
	mª£rved2
;

167 
__À32
 
	mmax_tx_›
;

168 } 
	g__∑cked
;

187 
	siwl_éc_c⁄fig_cmd_v4
 {

188 
u8
 
	m°a_id
;

189 
u8
 
	mª£rved1
[3];

190 
u8
 
	mmax_ch_width
;

191 
u8
 
	mmode
;

192 
u8
 
	mchaös
;

193 
u8
 
	msgi_ch_width_suµ
;

194 
__À16
 
	mÊags
;

195 
__À16
 
	mn⁄_ht_øãs
;

196 
__À16
 
	mht_øãs
[
IWL_TLC_NSS_MAX
][
IWL_TLC_MCS_PER_BW_NUM_V4
];

197 
__À16
 
	mmax_mpdu_Àn
;

198 
__À16
 
	mmax_tx_›
;

199 } 
	g__∑cked
;

206 
	eiwl_éc_upd©e_Êags
 {

207 
	mIWL_TLC_NOTIF_FLAG_RATE
 = 
BIT
(0),

208 
	mIWL_TLC_NOTIF_FLAG_AMSDU
 = 
BIT
(1),

220 
	siwl_éc_upd©e_nŸif
 {

221 
u8
 
	m°a_id
;

222 
u8
 
	mª£rved
[3];

223 
__À32
 
	mÊags
;

224 
__À32
 
	møã
;

225 
__À32
 
	mamsdu_size
;

226 
__À32
 
	mamsdu_íabÀd
;

227 } 
	g__∑cked
;

230 
	#IWL_MAX_MCS_DISPLAY_SIZE
 12

	)

232 
	siwl_øã_mcs_öfo
 {

233 
	mmbps
[
IWL_MAX_MCS_DISPLAY_SIZE
];

234 
	mmcs
[
IWL_MAX_MCS_DISPLAY_SIZE
];

243 
	mIWL_RATE_1M_INDEX
 = 0,

244 
	mIWL_FIRST_CCK_RATE
 = 
IWL_RATE_1M_INDEX
,

245 
	mIWL_RATE_2M_INDEX
,

246 
	mIWL_RATE_5M_INDEX
,

247 
	mIWL_RATE_11M_INDEX
,

248 
	mIWL_LAST_CCK_RATE
 = 
IWL_RATE_11M_INDEX
,

249 
	mIWL_RATE_6M_INDEX
,

250 
	mIWL_FIRST_OFDM_RATE
 = 
IWL_RATE_6M_INDEX
,

251 
	mIWL_RATE_MCS_0_INDEX
 = 
IWL_RATE_6M_INDEX
,

252 
	mIWL_FIRST_HT_RATE
 = 
IWL_RATE_MCS_0_INDEX
,

253 
	mIWL_FIRST_VHT_RATE
 = 
IWL_RATE_MCS_0_INDEX
,

254 
	mIWL_RATE_9M_INDEX
,

255 
	mIWL_RATE_12M_INDEX
,

256 
	mIWL_RATE_MCS_1_INDEX
 = 
IWL_RATE_12M_INDEX
,

257 
	mIWL_RATE_18M_INDEX
,

258 
	mIWL_RATE_MCS_2_INDEX
 = 
IWL_RATE_18M_INDEX
,

259 
	mIWL_RATE_24M_INDEX
,

260 
	mIWL_RATE_MCS_3_INDEX
 = 
IWL_RATE_24M_INDEX
,

261 
	mIWL_RATE_36M_INDEX
,

262 
	mIWL_RATE_MCS_4_INDEX
 = 
IWL_RATE_36M_INDEX
,

263 
	mIWL_RATE_48M_INDEX
,

264 
	mIWL_RATE_MCS_5_INDEX
 = 
IWL_RATE_48M_INDEX
,

265 
	mIWL_RATE_54M_INDEX
,

266 
	mIWL_RATE_MCS_6_INDEX
 = 
IWL_RATE_54M_INDEX
,

267 
	mIWL_LAST_NON_HT_RATE
 = 
IWL_RATE_54M_INDEX
,

268 
	mIWL_RATE_60M_INDEX
,

269 
	mIWL_RATE_MCS_7_INDEX
 = 
IWL_RATE_60M_INDEX
,

270 
	mIWL_LAST_HT_RATE
 = 
IWL_RATE_MCS_7_INDEX
,

271 
	mIWL_RATE_MCS_8_INDEX
,

272 
	mIWL_RATE_MCS_9_INDEX
,

273 
	mIWL_LAST_VHT_RATE
 = 
IWL_RATE_MCS_9_INDEX
,

274 
	mIWL_RATE_MCS_10_INDEX
,

275 
	mIWL_RATE_MCS_11_INDEX
,

276 
	mIWL_LAST_HE_RATE
 = 
IWL_RATE_MCS_11_INDEX
,

277 
	mIWL_RATE_COUNT_LEGACY
 = 
IWL_LAST_NON_HT_RATE
 + 1,

278 
	mIWL_RATE_COUNT
 = 
IWL_LAST_HE_RATE
 + 1,

279 
	mIWL_RATE_INVM_INDEX
 = 
IWL_RATE_COUNT
,

280 
	mIWL_RATE_INVALID
 = 
IWL_RATE_COUNT
,

283 
	#IWL_RATE_BIT_MSK
(
r
Ë
	`BIT
(
IWL_RATE_
##r##
M_INDEX
)

	)

287 
	mIWL_RATE_6M_PLCP
 = 13,

288 
	mIWL_RATE_9M_PLCP
 = 15,

289 
	mIWL_RATE_12M_PLCP
 = 5,

290 
	mIWL_RATE_18M_PLCP
 = 7,

291 
	mIWL_RATE_24M_PLCP
 = 9,

292 
	mIWL_RATE_36M_PLCP
 = 11,

293 
	mIWL_RATE_48M_PLCP
 = 1,

294 
	mIWL_RATE_54M_PLCP
 = 3,

295 
	mIWL_RATE_1M_PLCP
 = 10,

296 
	mIWL_RATE_2M_PLCP
 = 20,

297 
	mIWL_RATE_5M_PLCP
 = 55,

298 
	mIWL_RATE_11M_PLCP
 = 110,

299 
	mIWL_RATE_INVM_PLCP
 = -1,

320 
	#RATE_MCS_HT_POS
 8

	)

321 
	#RATE_MCS_HT_MSK_V1
 
	`BIT
(
RATE_MCS_HT_POS
)

	)

324 
	#RATE_MCS_CCK_POS_V1
 9

	)

325 
	#RATE_MCS_CCK_MSK_V1
 
	`BIT
(
RATE_MCS_CCK_POS_V1
)

	)

328 
	#RATE_MCS_VHT_POS_V1
 26

	)

329 
	#RATE_MCS_VHT_MSK_V1
 
	`BIT
(
RATE_MCS_VHT_POS_V1
)

	)

355 
	#RATE_HT_MCS_RATE_CODE_MSK_V1
 0x7

	)

356 
	#RATE_HT_MCS_NSS_POS_V1
 3

	)

357 
	#RATE_HT_MCS_NSS_MSK_V1
 (3 << 
RATE_HT_MCS_NSS_POS_V1
)

	)

358 
	#RATE_HT_MCS_MIMO2_MSK
 
	`BIT
(
RATE_HT_MCS_NSS_POS_V1
)

	)

361 
	#RATE_HT_MCS_GF_POS
 10

	)

362 
	#RATE_HT_MCS_GF_MSK
 (1 << 
RATE_HT_MCS_GF_POS
)

	)

364 
	#RATE_HT_MCS_INDEX_MSK_V1
 0x3f

	)

377 
	#RATE_VHT_MCS_RATE_CODE_MSK
 0xf

	)

401 
	#RATE_LEGACY_RATE_MSK_V1
 0xff

	)

404 
	#RATE_MCS_HE_POS_V1
 10

	)

405 
	#RATE_MCS_HE_MSK_V1
 
	`BIT
(
RATE_MCS_HE_POS_V1
)

	)

411 
	#RATE_MCS_CHAN_WIDTH_POS
 11

	)

412 
	#RATE_MCS_CHAN_WIDTH_MSK_V1
 (3 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

415 
	#RATE_MCS_SGI_POS_V1
 13

	)

416 
	#RATE_MCS_SGI_MSK_V1
 
	`BIT
(
RATE_MCS_SGI_POS_V1
)

	)

419 
	#RATE_MCS_ANT_POS
 14

	)

420 
	#RATE_MCS_ANT_A_MSK
 (1 << 
RATE_MCS_ANT_POS
)

	)

421 
	#RATE_MCS_ANT_B_MSK
 (2 << 
RATE_MCS_ANT_POS
)

	)

422 
	#RATE_MCS_ANT_AB_MSK
 (
RATE_MCS_ANT_A_MSK
 | \

423 
RATE_MCS_ANT_B_MSK
)

	)

424 
	#RATE_MCS_ANT_MSK
 
RATE_MCS_ANT_AB_MSK


	)

427 
	#RATE_MCS_STBC_POS
 17

	)

428 
	#RATE_MCS_STBC_MSK
 
	`BIT
(
RATE_MCS_STBC_POS
)

	)

431 
	#RATE_HE_DUAL_CARRIER_MODE
 18

	)

432 
	#RATE_HE_DUAL_CARRIER_MODE_MSK
 
	`BIT
(
RATE_HE_DUAL_CARRIER_MODE
)

	)

435 
	#RATE_MCS_BF_POS
 19

	)

436 
	#RATE_MCS_BF_MSK
 (1 << 
RATE_MCS_BF_POS
)

	)

462 
	#RATE_MCS_HE_GI_LTF_POS
 20

	)

463 
	#RATE_MCS_HE_GI_LTF_MSK_V1
 (3 << 
RATE_MCS_HE_GI_LTF_POS
)

	)

466 
	#RATE_MCS_HE_TYPE_POS_V1
 22

	)

467 
	#RATE_MCS_HE_TYPE_SU_V1
 (0 << 
RATE_MCS_HE_TYPE_POS_V1
)

	)

468 
	#RATE_MCS_HE_TYPE_EXT_SU_V1
 
	`BIT
(
RATE_MCS_HE_TYPE_POS_V1
)

	)

469 
	#RATE_MCS_HE_TYPE_MU_V1
 (2 << 
RATE_MCS_HE_TYPE_POS_V1
)

	)

470 
	#RATE_MCS_HE_TYPE_TRIG_V1
 (3 << 
RATE_MCS_HE_TYPE_POS_V1
)

	)

471 
	#RATE_MCS_HE_TYPE_MSK_V1
 (3 << 
RATE_MCS_HE_TYPE_POS_V1
)

	)

474 
	#RATE_MCS_DUP_POS_V1
 24

	)

475 
	#RATE_MCS_DUP_MSK_V1
 (3 << 
RATE_MCS_DUP_POS_V1
)

	)

478 
	#RATE_MCS_LDPC_POS_V1
 27

	)

479 
	#RATE_MCS_LDPC_MSK_V1
 
	`BIT
(
RATE_MCS_LDPC_POS_V1
)

	)

482 
	#RATE_MCS_HE_106T_POS_V1
 28

	)

483 
	#RATE_MCS_HE_106T_MSK_V1
 
	`BIT
(
RATE_MCS_HE_106T_POS_V1
)

	)

486 
	#RATE_MCS_RTS_REQUIRED_POS
 (30)

	)

487 
	#RATE_MCS_RTS_REQUIRED_MSK
 (0x1 << 
RATE_MCS_RTS_REQUIRED_POS
)

	)

489 
	#RATE_MCS_CTS_REQUIRED_POS
 (31)

	)

490 
	#RATE_MCS_CTS_REQUIRED_MSK
 (0x1 << 
RATE_MCS_CTS_REQUIRED_POS
)

	)

505 
	#RATE_MCS_MOD_TYPE_POS
 8

	)

506 
	#RATE_MCS_MOD_TYPE_MSK
 (0x7 << 
RATE_MCS_MOD_TYPE_POS
)

	)

507 
	#RATE_MCS_CCK_MSK
 (0 << 
RATE_MCS_MOD_TYPE_POS
)

	)

508 
	#RATE_MCS_LEGACY_OFDM_MSK
 (1 << 
RATE_MCS_MOD_TYPE_POS
)

	)

509 
	#RATE_MCS_HT_MSK
 (2 << 
RATE_MCS_MOD_TYPE_POS
)

	)

510 
	#RATE_MCS_VHT_MSK
 (3 << 
RATE_MCS_MOD_TYPE_POS
)

	)

511 
	#RATE_MCS_HE_MSK
 (4 << 
RATE_MCS_MOD_TYPE_POS
)

	)

512 
	#RATE_MCS_EHT_MSK
 (5 << 
RATE_MCS_MOD_TYPE_POS
)

	)

534 
	#RATE_LEGACY_RATE_MSK
 0x7

	)

541 
	#RATE_HT_MCS_CODE_MSK
 0x7

	)

542 
	#RATE_MCS_NSS_POS
 4

	)

543 
	#RATE_MCS_NSS_MSK
 (1 << 
RATE_MCS_NSS_POS
)

	)

544 
	#RATE_MCS_CODE_MSK
 0xf

	)

545 
	#RATE_HT_MCS_INDEX
(
r
Ë(((‘Ë& 
RATE_MCS_NSS_MSK
) >> 1) | \

546 ((
r
Ë& 
RATE_HT_MCS_CODE_MSK
))

	)

553 
	#RATE_MCS_CHAN_WIDTH_MSK
 (0x7 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

554 
	#RATE_MCS_CHAN_WIDTH_20_VAL
 0

	)

555 
	#RATE_MCS_CHAN_WIDTH_20
 (
RATE_MCS_CHAN_WIDTH_20_VAL
 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

556 
	#RATE_MCS_CHAN_WIDTH_40_VAL
 1

	)

557 
	#RATE_MCS_CHAN_WIDTH_40
 (
RATE_MCS_CHAN_WIDTH_40_VAL
 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

558 
	#RATE_MCS_CHAN_WIDTH_80_VAL
 2

	)

559 
	#RATE_MCS_CHAN_WIDTH_80
 (
RATE_MCS_CHAN_WIDTH_80_VAL
 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

560 
	#RATE_MCS_CHAN_WIDTH_160_VAL
 3

	)

561 
	#RATE_MCS_CHAN_WIDTH_160
 (
RATE_MCS_CHAN_WIDTH_160_VAL
 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

562 
	#RATE_MCS_CHAN_WIDTH_320_VAL
 4

	)

563 
	#RATE_MCS_CHAN_WIDTH_320
 (
RATE_MCS_CHAN_WIDTH_320_VAL
 << 
RATE_MCS_CHAN_WIDTH_POS
)

	)

573 
	#RATE_MCS_LDPC_POS
 16

	)

574 
	#RATE_MCS_LDPC_MSK
 (1 << 
RATE_MCS_LDPC_POS
)

	)

606 
	#RATE_MCS_HE_GI_LTF_MSK
 (0x7 << 
RATE_MCS_HE_GI_LTF_POS
)

	)

607 
	#RATE_MCS_SGI_POS
 
RATE_MCS_HE_GI_LTF_POS


	)

608 
	#RATE_MCS_SGI_MSK
 (1 << 
RATE_MCS_SGI_POS
)

	)

609 
	#RATE_MCS_HE_SU_4_LTF
 3

	)

610 
	#RATE_MCS_HE_SU_4_LTF_08_GI
 4

	)

613 
	#RATE_MCS_HE_TYPE_POS
 23

	)

614 
	#RATE_MCS_HE_TYPE_SU
 (0 << 
RATE_MCS_HE_TYPE_POS
)

	)

615 
	#RATE_MCS_HE_TYPE_EXT_SU
 (1 << 
RATE_MCS_HE_TYPE_POS
)

	)

616 
	#RATE_MCS_HE_TYPE_MU
 (2 << 
RATE_MCS_HE_TYPE_POS
)

	)

617 
	#RATE_MCS_HE_TYPE_TRIG
 (3 << 
RATE_MCS_HE_TYPE_POS
)

	)

618 
	#RATE_MCS_HE_TYPE_MSK
 (3 << 
RATE_MCS_HE_TYPE_POS
)

	)

628 
	#RATE_MCS_DUP_POS
 25

	)

629 
	#RATE_MCS_DUP_MSK
 (1 << 
RATE_MCS_DUP_POS
)

	)

632 
	#RATE_MCS_HE_106T_POS
 26

	)

633 
	#RATE_MCS_HE_106T_MSK
 (1 << 
RATE_MCS_HE_106T_POS
)

	)

638 
	#RATE_MCS_EHT_EXTRA_LTF_POS
 27

	)

639 
	#RATE_MCS_EHT_EXTRA_LTF_MSK
 (1 << 
RATE_MCS_EHT_EXTRA_LTF_POS
)

	)

646 
	#LQ_MAX_RETRY_NUM
 16

	)

651 
	#LQ_FLAG_USE_RTS_POS
 0

	)

652 
	#LQ_FLAG_USE_RTS_MSK
 (1 << 
LQ_FLAG_USE_RTS_POS
)

	)

655 
	#LQ_FLAG_COLOR_POS
 1

	)

656 
	#LQ_FLAG_COLOR_MSK
 (7 << 
LQ_FLAG_COLOR_POS
)

	)

657 
	#LQ_FLAG_COLOR_GET
(
_f
Ë(((_fË& 
LQ_FLAG_COLOR_MSK
) >>\

658 
LQ_FLAG_COLOR_POS
)

	)

659 
	#LQ_FLAGS_COLOR_INC
(
_c
Ë((((_cË+ 1Ë<< 
LQ_FLAG_COLOR_POS
) &\

660 
LQ_FLAG_COLOR_MSK
)

	)

661 
	#LQ_FLAG_COLOR_SET
(
_f
, 
_c
Ë((_cË| ((_fË& ~
LQ_FLAG_COLOR_MSK
))

	)

668 
	#LQ_FLAG_RTS_BW_SIG_POS
 4

	)

669 
	#LQ_FLAG_RTS_BW_SIG_NONE
 (0 << 
LQ_FLAG_RTS_BW_SIG_POS
)

	)

670 
	#LQ_FLAG_RTS_BW_SIG_STATIC
 (1 << 
LQ_FLAG_RTS_BW_SIG_POS
)

	)

671 
	#LQ_FLAG_RTS_BW_SIG_DYNAMIC
 (2 << 
LQ_FLAG_RTS_BW_SIG_POS
)

	)

676 
	#LQ_FLAG_DYNAMIC_BW_POS
 6

	)

677 
	#LQ_FLAG_DYNAMIC_BW_MSK
 (1 << 
LQ_FLAG_DYNAMIC_BW_POS
)

	)

691 
	#LQ_SS_STBC_ALLOWED_POS
 0

	)

692 
	#LQ_SS_STBC_ALLOWED_MSK
 (3 << 
LQ_SS_STBC_ALLOWED_MSK
)

	)

695 
	#LQ_SS_STBC_1SS_ALLOWED
 (1 << 
LQ_SS_STBC_ALLOWED_POS
)

	)

698 
	#LQ_SS_BFER_ALLOWED_POS
 2

	)

699 
	#LQ_SS_BFER_ALLOWED
 (1 << 
LQ_SS_BFER_ALLOWED_POS
)

	)

706 
	#LQ_SS_FORCE_POS
 3

	)

707 
	#LQ_SS_FORCE
 (1 << 
LQ_SS_FORCE_POS
)

	)

712 
	#LQ_SS_PARAMS_VALID_POS
 31

	)

713 
	#LQ_SS_PARAMS_VALID
 (1 << 
LQ_SS_PARAMS_VALID_POS
)

	)

741 
	siwl_lq_cmd
 {

742 
u8
 
	m°a_id
;

743 
u8
 
	mªdu˚d_çc
;

744 
__À16
 
	mc⁄åﬁ
;

746 
u8
 
	mÊags
;

747 
u8
 
	mmimo_dñim
;

748 
u8
 
	msögÀ_°ªam_™t_msk
;

749 
u8
 
	mduÆ_°ªam_™t_msk
;

750 
u8
 
	möôül_øã_ödex
[
AC_NUM
];

752 
__À16
 
	magg_time_limô
;

753 
u8
 
	magg_dißbÀ_°¨t_th
;

754 
u8
 
	magg_‰ame_˙t_limô
;

755 
__À32
 
	mª£rved2
;

756 
__À32
 
	mrs_èbÀ
[
LQ_MAX_RETRY_NUM
];

757 
__À32
 
	mss_∑øms
;

760 
u8
 
iwl_fw_øã_idx_to_∂˝
(
idx
);

761 
u32
 
iwl_√w_øã_‰om_v1
(u32 
øã_v1
);

762 c⁄° 
iwl_øã_mcs_öfo
 *
iwl_øã_mcs
(
idx
);

763 c⁄° *
iwl_rs_¥ëty_™t
(
u8
 
™t
);

764 c⁄° *
iwl_rs_¥ëty_bw
(
bw
);

765 
rs_¥ëty_¥öt_øã
(*
buf
, 
bufsz
, c⁄° 
u32
 
øã
);

766 
boﬁ
 
iwl_he_is_sgi
(
u32
 
øã_n_Êags
);

	@fw/api/rx.h

7 #i‚de‡
__iwl_fw_≠i_rx_h__


8 
	#__iwl_fw_≠i_rx_h__


	)

12 
	#IWL_RX_INFO_PHY_CNT
 8

	)

13 
	#IWL_RX_INFO_ENERGY_ANT_ABC_IDX
 1

	)

14 
	#IWL_RX_INFO_ENERGY_ANT_A_MSK
 0x000000ff

	)

15 
	#IWL_RX_INFO_ENERGY_ANT_B_MSK
 0x0000ff00

	)

16 
	#IWL_RX_INFO_ENERGY_ANT_A_POS
 0

	)

17 
	#IWL_RX_INFO_ENERGY_ANT_B_POS
 8

	)

18 
	#IWL_RX_INFO_ENERGY_ANT_C_POS
 16

	)

20 
	eiwl_mac_c⁄ãxt_öfo
 {

21 
	mMAC_CONTEXT_INFO_NONE
,

22 
	mMAC_CONTEXT_INFO_GSCAN
,

49 
	siwl_rx_phy_öfo
 {

50 
u8
 
	mn⁄_cfg_phy_˙t
;

51 
u8
 
	mcfg_phy_˙t
;

52 
u8
 
	m°©_id
;

53 
u8
 
	mª£rved1
;

54 
__À32
 
	msy°em_time°amp
;

55 
__À64
 
	mtime°amp
;

56 
__À32
 
	mbóc⁄_time_°amp
;

57 
__À16
 
	mphy_Êags
;

58 
__À16
 
	mch™√l
;

59 
__À32
 
	mn⁄_cfg_phy
[
IWL_RX_INFO_PHY_CNT
];

60 
__À32
 
	møã_n_Êags
;

61 
__À32
 
	mbyã_cou¡
;

62 
u8
 
	mmac_a˘ive_msk
;

63 
u8
 
	mmac_c⁄ãxt_öfo
;

64 
__À16
 
	m‰ame_time
;

65 } 
	g__∑cked
;

77 
	eiwl_csum_rx_assi°_öfo
 {

78 
	mCSUM_RXA_RESERVED_MASK
 = 0x000f,

79 
	mCSUM_RXA_MICSIZE_MASK
 = 0x00f0,

80 
	mCSUM_RXA_HEADERLEN_MASK
 = 0x1f00,

81 
	mCSUM_RXA_PADD
 = 
BIT
(13),

82 
	mCSUM_RXA_AMSDU
 = 
BIT
(14),

83 
	mCSUM_RXA_ENA
 = 
BIT
(15)

91 
	siwl_rx_mpdu_ªs_°¨t
 {

92 
__À16
 
	mbyã_cou¡
;

93 
__À16
 
	massi°
;

94 } 
	g__∑cked
;

109 
	eiwl_rx_phy_Êags
 {

110 
	mRX_RES_PHY_FLAGS_BAND_24
 = 
BIT
(0),

111 
	mRX_RES_PHY_FLAGS_MOD_CCK
 = 
BIT
(1),

112 
	mRX_RES_PHY_FLAGS_SHORT_PREAMBLE
 = 
BIT
(2),

113 
	mRX_RES_PHY_FLAGS_NARROW_BAND
 = 
BIT
(3),

114 
	mRX_RES_PHY_FLAGS_ANTENNA
 = (0x7 << 4),

115 
	mRX_RES_PHY_FLAGS_ANTENNA_POS
 = 4,

116 
	mRX_RES_PHY_FLAGS_AGG
 = 
BIT
(7),

117 
	mRX_RES_PHY_FLAGS_OFDM_HT
 = 
BIT
(8),

118 
	mRX_RES_PHY_FLAGS_OFDM_GF
 = 
BIT
(9),

119 
	mRX_RES_PHY_FLAGS_OFDM_VHT
 = 
BIT
(10),

150 
	eiwl_mvm_rx_°©us
 {

151 
	mRX_MPDU_RES_STATUS_CRC_OK
 = 
BIT
(0),

152 
	mRX_MPDU_RES_STATUS_OVERRUN_OK
 = 
BIT
(1),

153 
	mRX_MPDU_RES_STATUS_SRC_STA_FOUND
 = 
BIT
(2),

154 
	mRX_MPDU_RES_STATUS_KEY_VALID
 = 
BIT
(3),

155 
	mRX_MPDU_RES_STATUS_ICV_OK
 = 
BIT
(5),

156 
	mRX_MPDU_RES_STATUS_MIC_OK
 = 
BIT
(6),

157 
	mRX_MPDU_RES_STATUS_TTAK_OK
 = 
BIT
(7),

158 
	mRX_MPDU_RES_STATUS_MNG_FRAME_REPLAY_ERR
 = 
BIT
(7),

159 
	mRX_MPDU_RES_STATUS_SEC_NO_ENC
 = (0 << 8),

160 
	mRX_MPDU_RES_STATUS_SEC_WEP_ENC
 = (1 << 8),

161 
	mRX_MPDU_RES_STATUS_SEC_CCM_ENC
 = (2 << 8),

162 
	mRX_MPDU_RES_STATUS_SEC_TKIP_ENC
 = (3 << 8),

163 
	mRX_MPDU_RES_STATUS_SEC_EXT_ENC
 = (4 << 8),

164 
	mRX_MPDU_RES_STATUS_SEC_CMAC_GMAC_ENC
 = (6 << 8),

165 
	mRX_MPDU_RES_STATUS_SEC_ENC_ERR
 = (7 << 8),

166 
	mRX_MPDU_RES_STATUS_SEC_ENC_MSK
 = (7 << 8),

167 
	mRX_MPDU_RES_STATUS_DEC_DONE
 = 
BIT
(11),

168 
	mRX_MPDU_RES_STATUS_CSUM_DONE
 = 
BIT
(16),

169 
	mRX_MPDU_RES_STATUS_CSUM_OK
 = 
BIT
(17),

170 
	mRX_MDPU_RES_STATUS_STA_ID_SHIFT
 = 24,

171 
	mRX_MPDU_RES_STATUS_STA_ID_MSK
 = 0x1‡<< 
RX_MDPU_RES_STATUS_STA_ID_SHIFT
,

175 
	eiwl_rx_mpdu_mac_Êags1
 {

176 
	mIWL_RX_MDPU_MFLG1_ADDRTYPE_MASK
 = 0x03,

177 
	mIWL_RX_MPDU_MFLG1_MIC_CRC_LEN_MASK
 = 0xf0,

181 
	mIWL_RX_MPDU_MFLG1_MIC_CRC_LEN_SHIFT
 = 3,

184 
	eiwl_rx_mpdu_mac_Êags2
 {

186 
	mIWL_RX_MPDU_MFLG2_HDR_LEN_MASK
 = 0x1f,

187 
	mIWL_RX_MPDU_MFLG2_PAD
 = 0x20,

188 
	mIWL_RX_MPDU_MFLG2_AMSDU
 = 0x40,

191 
	eiwl_rx_mpdu_amsdu_öfo
 {

192 
	mIWL_RX_MPDU_AMSDU_SUBFRAME_IDX_MASK
 = 0x7f,

193 
	mIWL_RX_MPDU_AMSDU_LAST_SUBFRAME
 = 0x80,

196 
	#RX_MPDU_BAND_POS
 6

	)

197 
	#RX_MPDU_BAND_MASK
 0xC0

	)

198 
	#BAND_IN_RX_STATUS
(
_vÆ
) \

199 (((
_vÆ
Ë& 
RX_MPDU_BAND_MASK
Ë>> 
RX_MPDU_BAND_POS
)

	)

201 
	eiwl_rx_l3_¥Ÿo_vÆues
 {

202 
	mIWL_RX_L3_TYPE_NONE
,

203 
	mIWL_RX_L3_TYPE_IPV4
,

204 
	mIWL_RX_L3_TYPE_IPV4_FRAG
,

205 
	mIWL_RX_L3_TYPE_IPV6_FRAG
,

206 
	mIWL_RX_L3_TYPE_IPV6
,

207 
	mIWL_RX_L3_TYPE_IPV6_IN_IPV4
,

208 
	mIWL_RX_L3_TYPE_ARP
,

209 
	mIWL_RX_L3_TYPE_EAPOL
,

212 
	#IWL_RX_L3_PROTO_POS
 4

	)

214 
	eiwl_rx_l3l4_Êags
 {

215 
	mIWL_RX_L3L4_IP_HDR_CSUM_OK
 = 
BIT
(0),

216 
	mIWL_RX_L3L4_TCP_UDP_CSUM_OK
 = 
BIT
(1),

217 
	mIWL_RX_L3L4_TCP_FIN_SYN_RST_PSH
 = 
BIT
(2),

218 
	mIWL_RX_L3L4_TCP_ACK
 = 
BIT
(3),

219 
	mIWL_RX_L3L4_L3_PROTO_MASK
 = 0x‡<< 
IWL_RX_L3_PROTO_POS
,

220 
	mIWL_RX_L3L4_L4_PROTO_MASK
 = 0xf << 8,

221 
	mIWL_RX_L3L4_RSS_HASH_MASK
 = 0xf << 12,

224 
	eiwl_rx_mpdu_°©us
 {

225 
	mIWL_RX_MPDU_STATUS_CRC_OK
 = 
BIT
(0),

226 
	mIWL_RX_MPDU_STATUS_OVERRUN_OK
 = 
BIT
(1),

227 
	mIWL_RX_MPDU_STATUS_SRC_STA_FOUND
 = 
BIT
(2),

228 
	mIWL_RX_MPDU_STATUS_KEY_VALID
 = 
BIT
(3),

229 
	mIWL_RX_MPDU_STATUS_ICV_OK
 = 
BIT
(5),

230 
	mIWL_RX_MPDU_STATUS_MIC_OK
 = 
BIT
(6),

231 
	mIWL_RX_MPDU_RES_STATUS_TTAK_OK
 = 
BIT
(7),

233 
	mIWL_RX_MPDU_STATUS_REPLAY_ERROR
 = 
BIT
(7),

234 
	mIWL_RX_MPDU_STATUS_SEC_MASK
 = 0x7 << 8,

235 
	mIWL_RX_MPDU_STATUS_SEC_UNKNOWN
 = 
IWL_RX_MPDU_STATUS_SEC_MASK
,

236 
	mIWL_RX_MPDU_STATUS_SEC_NONE
 = 0x0 << 8,

237 
	mIWL_RX_MPDU_STATUS_SEC_WEP
 = 0x1 << 8,

238 
	mIWL_RX_MPDU_STATUS_SEC_CCM
 = 0x2 << 8,

239 
	mIWL_RX_MPDU_STATUS_SEC_TKIP
 = 0x3 << 8,

240 
	mIWL_RX_MPDU_STATUS_SEC_EXT_ENC
 = 0x4 << 8,

241 
	mIWL_RX_MPDU_STATUS_SEC_GCM
 = 0x5 << 8,

242 
	mIWL_RX_MPDU_STATUS_DECRYPTED
 = 
BIT
(11),

243 
	mIWL_RX_MPDU_STATUS_ROBUST_MNG_FRAME
 = 
BIT
(15),

245 
	mIWL_RX_MPDU_STATUS_DUPLICATE
 = 
BIT
(22),

247 
	mIWL_RX_MPDU_STATUS_STA_ID
 = 0x1f000000,

250 
	#IWL_RX_REORDER_DATA_INVALID_BAID
 0x7f

	)

252 
	eiwl_rx_mpdu_ª‹dî_d©a
 {

253 
	mIWL_RX_MPDU_REORDER_NSSN_MASK
 = 0x00000fff,

254 
	mIWL_RX_MPDU_REORDER_SN_MASK
 = 0x00fff000,

255 
	mIWL_RX_MPDU_REORDER_SN_SHIFT
 = 12,

256 
	mIWL_RX_MPDU_REORDER_BAID_MASK
 = 0x7f000000,

257 
	mIWL_RX_MPDU_REORDER_BAID_SHIFT
 = 24,

258 
	mIWL_RX_MPDU_REORDER_BA_OLD_SN
 = 0x80000000,

261 
	eiwl_rx_mpdu_phy_öfo
 {

262 
	mIWL_RX_MPDU_PHY_AMPDU
 = 
BIT
(5),

263 
	mIWL_RX_MPDU_PHY_AMPDU_TOGGLE
 = 
BIT
(6),

264 
	mIWL_RX_MPDU_PHY_SHORT_PREAMBLE
 = 
BIT
(7),

266 
	mIWL_RX_MPDU_PHY_NCCK_ADDTL_NTFY
 = 
BIT
(7),

267 
	mIWL_RX_MPDU_PHY_TSF_OVERLOAD
 = 
BIT
(8),

270 
	eiwl_rx_mpdu_mac_öfo
 {

271 
	mIWL_RX_MPDU_PHY_MAC_INDEX_MASK
 = 0x0f,

272 
	mIWL_RX_MPDU_PHY_PHY_INDEX_MASK
 = 0xf0,

276 
	eiwl_rx_phy_he_d©a0
 {

278 
	mIWL_RX_PHY_DATA0_HE_BEAM_CHNG
 = 0x00000001,

279 
	mIWL_RX_PHY_DATA0_HE_UPLINK
 = 0x00000002,

280 
	mIWL_RX_PHY_DATA0_HE_BSS_COLOR_MASK
 = 0x000000fc,

281 
	mIWL_RX_PHY_DATA0_HE_SPATIAL_REUSE_MASK
 = 0x00000f00,

283 
	mIWL_RX_PHY_DATA0_HE_TXOP_DUR_MASK
 = 0x000fe000,

284 
	mIWL_RX_PHY_DATA0_HE_LDPC_EXT_SYM
 = 0x00100000,

285 
	mIWL_RX_PHY_DATA0_HE_PRE_FEC_PAD_MASK
 = 0x00600000,

286 
	mIWL_RX_PHY_DATA0_HE_PE_DISAMBIG
 = 0x00800000,

287 
	mIWL_RX_PHY_DATA0_HE_DOPPLER
 = 0x01000000,

289 
	mIWL_RX_PHY_DATA0_HE_DELIM_EOF
 = 0x80000000,

293 
	eiwl_rx_phy_eht_d©a0
 {

295 
	mIWL_RX_PHY_DATA0_EHT_VALIDATE
 = 
BIT
(0),

296 
	mIWL_RX_PHY_DATA0_EHT_UPLINK
 = 
BIT
(1),

297 
	mIWL_RX_PHY_DATA0_EHT_BSS_COLOR_MASK
 = 0x000000fc,

298 
	mIWL_RX_PHY_DATA0_ETH_SPATIAL_REUSE_MASK
 = 0x00000f00,

299 
	mIWL_RX_PHY_DATA0_EHT_PS160
 = 
BIT
(12),

300 
	mIWL_RX_PHY_DATA0_EHT_TXOP_DUR_MASK
 = 0x000fe000,

301 
	mIWL_RX_PHY_DATA0_EHT_LDPC_EXT_SYM
 = 
BIT
(20),

302 
	mIWL_RX_PHY_DATA0_EHT_PRE_FEC_PAD_MASK
 = 0x00600000,

303 
	mIWL_RX_PHY_DATA0_EHT_PE_DISAMBIG
 = 
BIT
(23),

304 
	mIWL_RX_PHY_DATA0_EHT_BW320_SLOT
 = 
BIT
(24),

305 
	mIWL_RX_PHY_DATA0_EHT_SIGA_CRC_OK
 = 
BIT
(25),

306 
	mIWL_RX_PHY_DATA0_EHT_PHY_VER
 = 0x1c000000,

308 
	mIWL_RX_PHY_DATA0_EHT_DELIM_EOF
 = 
BIT
(31),

311 
	eiwl_rx_phy_öfo_ty≥
 {

312 
	mIWL_RX_PHY_INFO_TYPE_NONE
 = 0,

313 
	mIWL_RX_PHY_INFO_TYPE_CCK
 = 1,

314 
	mIWL_RX_PHY_INFO_TYPE_OFDM_LGCY
 = 2,

315 
	mIWL_RX_PHY_INFO_TYPE_HT
 = 3,

316 
	mIWL_RX_PHY_INFO_TYPE_VHT_SU
 = 4,

317 
	mIWL_RX_PHY_INFO_TYPE_VHT_MU
 = 5,

318 
	mIWL_RX_PHY_INFO_TYPE_HE_SU
 = 6,

319 
	mIWL_RX_PHY_INFO_TYPE_HE_MU
 = 7,

320 
	mIWL_RX_PHY_INFO_TYPE_HE_TB
 = 8,

321 
	mIWL_RX_PHY_INFO_TYPE_HE_MU_EXT
 = 9,

322 
	mIWL_RX_PHY_INFO_TYPE_HE_TB_EXT
 = 10,

323 
	mIWL_RX_PHY_INFO_TYPE_EHT_MU
 = 11,

324 
	mIWL_RX_PHY_INFO_TYPE_EHT_TB
 = 12,

325 
	mIWL_RX_PHY_INFO_TYPE_EHT_MU_EXT
 = 13,

326 
	mIWL_RX_PHY_INFO_TYPE_EHT_TB_EXT
 = 14,

330 
	eiwl_rx_phy_comm⁄_d©a1
 {

335 
	mIWL_RX_PHY_DATA1_INFO_TYPE_MASK
 = 0xf0000000,

338 
	mIWL_RX_PHY_DATA1_LSIG_LEN_MASK
 = 0x0fff0000,

342 
	eiwl_rx_phy_he_d©a1
 {

344 
	mIWL_RX_PHY_DATA1_HE_MU_SIGB_COMPRESSION
 = 0x00000001,

345 
	mIWL_RX_PHY_DATA1_HE_MU_SIBG_SYM_OR_USER_NUM_MASK
 = 0x0000001e,

348 
	mIWL_RX_PHY_DATA1_HE_LTF_NUM_MASK
 = 0x000000e0,

349 
	mIWL_RX_PHY_DATA1_HE_RU_ALLOC_SEC80
 = 0x00000100,

351 
	mIWL_RX_PHY_DATA1_HE_RU_ALLOC_MASK
 = 0x0000fe00,

354 
	mIWL_RX_PHY_DATA1_HE_TB_PILOT_TYPE
 = 0x00000001,

355 
	mIWL_RX_PHY_DATA1_HE_TB_LOW_SS_MASK
 = 0x0000000e,

359 
	eiwl_rx_phy_eht_d©a1
 {

361 
	mIWL_RX_PHY_DATA1_EHT_MU_NUM_SIG_SYM_USIGA2
 = 0x0000001f,

363 
	mIWL_RX_PHY_DATA1_EHT_TB_PILOT_TYPE
 = 
BIT
(0),

364 
	mIWL_RX_PHY_DATA1_EHT_TB_LOW_SS
 = 0x0000001e,

369 
	mIWL_RX_PHY_DATA1_EHT_SIG_LTF_NUM
 = 0x000000e0,

370 
	mIWL_RX_PHY_DATA1_EHT_RU_ALLOC_B0
 = 0x00000100,

371 
	mIWL_RX_PHY_DATA1_EHT_RU_ALLOC_B1_B7
 = 0x0000fe00,

375 
	eiwl_rx_phy_he_d©a2
 {

378 
	mIWL_RX_PHY_DATA2_HE_MU_EXT_CH1_RU0
 = 0x000000ff,

379 
	mIWL_RX_PHY_DATA2_HE_MU_EXT_CH1_RU2
 = 0x0000ff00,

380 
	mIWL_RX_PHY_DATA2_HE_MU_EXT_CH2_RU0
 = 0x00ff0000,

381 
	mIWL_RX_PHY_DATA2_HE_MU_EXT_CH2_RU2
 = 0xff000000,

384 
	mIWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE1
 = 0x0000000f,

385 
	mIWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE2
 = 0x000000f0,

386 
	mIWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE3
 = 0x00000f00,

387 
	mIWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE4
 = 0x0000f000,

391 
	eiwl_rx_phy_he_d©a3
 {

393 
	mIWL_RX_PHY_DATA3_HE_MU_EXT_CH1_RU1
 = 0x000000ff,

394 
	mIWL_RX_PHY_DATA3_HE_MU_EXT_CH1_RU3
 = 0x0000ff00,

395 
	mIWL_RX_PHY_DATA3_HE_MU_EXT_CH2_RU1
 = 0x00ff0000,

396 
	mIWL_RX_PHY_DATA3_HE_MU_EXT_CH2_RU3
 = 0xff000000,

400 
	eiwl_rx_phy_he_he_d©a4
 {

402 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_CH1_CTR_RU
 = 0x0001,

403 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_CH2_CTR_RU
 = 0x0002,

404 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_CH1_CRC_OK
 = 0x0004,

405 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_CH2_CRC_OK
 = 0x0008,

406 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_SIGB_MCS_MASK
 = 0x00f0,

407 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_SIGB_DCM
 = 0x0100,

408 
	mIWL_RX_PHY_DATA4_HE_MU_EXT_PREAMBLE_PUNC_TYPE_MASK
 = 0x0600,

412 
	eiwl_rx_phy_eht_d©a2
 {

414 
	mIWL_RX_PHY_DATA2_EHT_MU_EXT_RU_ALLOC_A1
 = 0x000001ff,

415 
	mIWL_RX_PHY_DATA2_EHT_MU_EXT_RU_ALLOC_A2
 = 0x0003fe00,

416 
	mIWL_RX_PHY_DATA2_EHT_MU_EXT_RU_ALLOC_B1
 = 0x07fc0000,

419 
	mIWL_RX_PHY_DATA2_EHT_TB_EXT_TRIG_SIGA1
 = 0xffffffff,

423 
	eiwl_rx_phy_eht_d©a3
 {

426 
	mIWL_RX_PHY_DATA3_EHT_MU_EXT_RU_ALLOC_C1
 = 0x0003fe00,

427 
	mIWL_RX_PHY_DATA3_EHT_MU_EXT_RU_ALLOC_C2
 = 0x07fc0000,

431 
	eiwl_rx_phy_eht_d©a4
 {

433 
	mIWL_RX_PHY_DATA4_EHT_MU_EXT_RU_ALLOC_D1
 = 0x000001ff,

434 
	mIWL_RX_PHY_DATA4_EHT_MU_EXT_RU_ALLOC_D2
 = 0x0003fe00,

435 
	mIWL_RX_PHY_DATA4_EHT_MU_EXT_SIGB_MCS
 = 0x000c0000,

436 
	mIWL_RX_PHY_DATA4_EHT_MU_EXT_RU_ALLOC_B2
 = 0x1ff00000,

440 
	eiwl_rx_phy_d©a5
 {

442 
	mIWL_RX_PHY_DATA5_EHT_TYPE_AND_COMP
 = 0x00000003,

444 
	mIWL_RX_PHY_DATA5_EHT_TB_SPATIAL_REUSE1
 = 0x0000003c,

445 
	mIWL_RX_PHY_DATA5_EHT_TB_SPATIAL_REUSE2
 = 0x000003c0,

447 
	mIWL_RX_PHY_DATA5_EHT_MU_PUNC_CH_CODE
 = 0x0000007c,

448 
	mIWL_RX_PHY_DATA5_EHT_MU_STA_ID_USR
 = 0x0003ff80,

449 
	mIWL_RX_PHY_DATA5_EHT_MU_NUM_USR_NON_OFDMA
 = 0x001c0000,

450 
	mIWL_RX_PHY_DATA5_EHT_MU_SPATIAL_CONF_USR_FIELD
 = 0x0fe00000,

456 
	siwl_rx_mpdu_desc_v1
 {

462 
__À32
 
	mrss_hash
;

467 
__À32
 
	mphy_d©a2
;

475 
__À32
 
	mfûãr_m©ch
;

480 
__À32
 
	mphy_d©a3
;

487 
__À32
 
	møã_n_Êags
;

492 
u8
 
	míîgy_a
;

496 
u8
 
	míîgy_b
;

500 
u8
 
	mch™√l
;

504 
u8
 
	mmac_c⁄ãxt
;

509 
__À32
 
	mgp2_⁄_aú_ri£
;

517 
__À64
 
	mtsf_⁄_aú_ri£
;

523 
__À32
 
	mphy_d©a0
;

531 
__À32
 
	mphy_d©a1
;

534 } 
	g__∑cked
;

539 
	siwl_rx_mpdu_desc_v3
 {

545 
__À32
 
	mfûãr_m©ch
;

550 
__À32
 
	mphy_d©a3
;

558 
__À32
 
	mrss_hash
;

563 
__À32
 
	mphy_d©a2
;

570 
__À32
 
	m∑πül_hash
;

575 
__be16
 
	møw_xsum
;

579 
__À16
 
	mª£rved_xsum
;

584 
__À32
 
	møã_n_Êags
;

589 
u8
 
	míîgy_a
;

593 
u8
 
	míîgy_b
;

597 
u8
 
	mch™√l
;

601 
u8
 
	mmac_c⁄ãxt
;

606 
__À32
 
	mgp2_⁄_aú_ri£
;

614 
__À64
 
	mtsf_⁄_aú_ri£
;

620 
__À32
 
	mphy_d©a0
;

626 
__À32
 
	mphy_d©a1
;

635 
__À32
 
	mphy_d©a5
;

640 
__À32
 
	mª£rved
[1];

641 } 
	g__∑cked
;

647 
	siwl_rx_mpdu_desc
 {

652 
__À16
 
	mmpdu_Àn
;

656 
u8
 
	mmac_Êags1
;

660 
u8
 
	mmac_Êags2
;

665 
u8
 
	mamsdu_öfo
;

669 
__À16
 
	mphy_öfo
;

673 
u8
 
	mmac_phy_idx
;

681 
__À16
 
	møw_csum
;

687 
__À16
 
	ml3l4_Êags
;

692 
__À16
 
	mphy_d©a4
;

698 
__À32
 
	mphy_eht_d©a4
;

704 
__À32
 
	m°©us
;

710 
__À32
 
	mª‹dî_d©a
;

713 
iwl_rx_mpdu_desc_v1
 
	mv1
;

714 
iwl_rx_mpdu_desc_v3
 
	mv3
;

716 } 
	g__∑cked
;

720 
	#IWL_RX_DESC_SIZE_V1
 
	`off£to„nd
(
iwl_rx_mpdu_desc
, 
v1
)

	)

722 
	#RX_NO_DATA_CHAIN_A_POS
 0

	)

723 
	#RX_NO_DATA_CHAIN_A_MSK
 (0xf‡<< 
RX_NO_DATA_CHAIN_A_POS
)

	)

724 
	#RX_NO_DATA_CHAIN_B_POS
 8

	)

725 
	#RX_NO_DATA_CHAIN_B_MSK
 (0xf‡<< 
RX_NO_DATA_CHAIN_B_POS
)

	)

726 
	#RX_NO_DATA_CHANNEL_POS
 16

	)

727 
	#RX_NO_DATA_CHANNEL_MSK
 (0xf‡<< 
RX_NO_DATA_CHANNEL_POS
)

	)

729 
	#RX_NO_DATA_INFO_TYPE_POS
 0

	)

730 
	#RX_NO_DATA_INFO_TYPE_MSK
 (0xf‡<< 
RX_NO_DATA_INFO_TYPE_POS
)

	)

731 
	#RX_NO_DATA_INFO_TYPE_NONE
 0

	)

732 
	#RX_NO_DATA_INFO_TYPE_RX_ERR
 1

	)

733 
	#RX_NO_DATA_INFO_TYPE_NDP
 2

	)

734 
	#RX_NO_DATA_INFO_TYPE_MU_UNMATCHED
 3

	)

735 
	#RX_NO_DATA_INFO_TYPE_TB_UNMATCHED
 4

	)

737 
	#RX_NO_DATA_INFO_ERR_POS
 8

	)

738 
	#RX_NO_DATA_INFO_ERR_MSK
 (0xf‡<< 
RX_NO_DATA_INFO_ERR_POS
)

	)

739 
	#RX_NO_DATA_INFO_ERR_NONE
 0

	)

740 
	#RX_NO_DATA_INFO_ERR_BAD_PLCP
 1

	)

741 
	#RX_NO_DATA_INFO_ERR_UNSUPPORTED_RATE
 2

	)

742 
	#RX_NO_DATA_INFO_ERR_NO_DELIM
 3

	)

743 
	#RX_NO_DATA_INFO_ERR_BAD_MAC_HDR
 4

	)

744 
	#RX_NO_DATA_INFO_LOW_ENERGY
 5

	)

746 
	#RX_NO_DATA_FRAME_TIME_POS
 0

	)

747 
	#RX_NO_DATA_FRAME_TIME_MSK
 (0xffff‡<< 
RX_NO_DATA_FRAME_TIME_POS
)

	)

749 
	#RX_NO_DATA_RX_VEC0_HE_NSTS_MSK
 0x03800000

	)

750 
	#RX_NO_DATA_RX_VEC0_VHT_NSTS_MSK
 0x38000000

	)

751 
	#RX_NO_DATA_RX_VEC2_EHT_NSTS_MSK
 0x00f00000

	)

754 
	eiwl_rx_usig_a1
 {

755 
	mIWL_RX_USIG_A1_ENHANCED_WIFI_VER_ID
 = 0x00000007,

756 
	mIWL_RX_USIG_A1_BANDWIDTH
 = 0x00000038,

757 
	mIWL_RX_USIG_A1_UL_FLAG
 = 0x00000040,

758 
	mIWL_RX_USIG_A1_BSS_COLOR
 = 0x00001f80,

759 
	mIWL_RX_USIG_A1_TXOP_DURATION
 = 0x000fe000,

760 
	mIWL_RX_USIG_A1_DISREGARD
 = 0x01f00000,

761 
	mIWL_RX_USIG_A1_VALIDATE
 = 0x02000000,

762 
	mIWL_RX_USIG_A1_EHT_BW320_SLOT
 = 0x04000000,

763 
	mIWL_RX_USIG_A1_EHT_TYPE
 = 0x18000000,

764 
	mIWL_RX_USIG_A1_RDY
 = 0x80000000,

768 
	eiwl_rx_usig_a2_eht
 {

769 
	mIWL_RX_USIG_A2_EHT_PPDU_TYPE
 = 0x00000003,

770 
	mIWL_RX_USIG_A2_EHT_USIG2_VALIDATE_B2
 = 0x00000004,

771 
	mIWL_RX_USIG_A2_EHT_PUNC_CHANNEL
 = 0x000000f8,

772 
	mIWL_RX_USIG_A2_EHT_USIG2_VALIDATE_B8
 = 0x00000100,

773 
	mIWL_RX_USIG_A2_EHT_SIG_MCS
 = 0x00000600,

774 
	mIWL_RX_USIG_A2_EHT_SIG_SYM_NUM
 = 0x0000f800,

775 
	mIWL_RX_USIG_A2_EHT_TRIG_SPATIAL_REUSE_1
 = 0x000f0000,

776 
	mIWL_RX_USIG_A2_EHT_TRIG_SPATIAL_REUSE_2
 = 0x00f00000,

777 
	mIWL_RX_USIG_A2_EHT_TRIG_USIG2_DISREGARD
 = 0x1f000000,

778 
	mIWL_RX_USIG_A2_EHT_CRC_OK
 = 0x40000000,

779 
	mIWL_RX_USIG_A2_EHT_RDY
 = 0x80000000,

796 
	siwl_rx_no_d©a
 {

797 
__À32
 
	möfo
;

798 
__À32
 
	mrssi
;

799 
__À32
 
	m⁄_aú_ri£_time
;

800 
__À32
 
	m‰_time
;

801 
__À32
 
	møã
;

802 
__À32
 
	mphy_öfo
[2];

803 
__À32
 
	mrx_vec
[2];

804 } 
	g__∑cked
;

822 
	siwl_rx_no_d©a_vî_3
 {

823 
__À32
 
	möfo
;

824 
__À32
 
	mrssi
;

825 
__À32
 
	m⁄_aú_ri£_time
;

826 
__À32
 
	m‰_time
;

827 
__À32
 
	møã
;

828 
__À32
 
	mphy_öfo
[2];

829 
__À32
 
	mrx_vec
[4];

830 } 
	g__∑cked
;

834 
	siwl_‰ame_ªÀa£
 {

835 
u8
 
	mbaid
;

836 
u8
 
	mª£rved
;

837 
__À16
 
	mns¢
;

845 
	eiwl_b¨_‰ame_ªÀa£_°a_tid
 {

846 
	mIWL_BAR_FRAME_RELEASE_TID_MASK
 = 0x0000000f,

847 
	mIWL_BAR_FRAME_RELEASE_STA_MASK
 = 0x000001f0,

856 
	eiwl_b¨_‰ame_ªÀa£_ba_öfo
 {

857 
	mIWL_BAR_FRAME_RELEASE_NSSN_MASK
 = 0x00000fff,

858 
	mIWL_BAR_FRAME_RELEASE_SN_MASK
 = 0x00fff000,

859 
	mIWL_BAR_FRAME_RELEASE_BAID_MASK
 = 0x3f000000,

867 
	siwl_b¨_‰ame_ªÀa£
 {

868 
__À32
 
	m°a_tid
;

869 
__À32
 
	mba_öfo
;

870 } 
	g__∑cked
;

872 
	eiwl_rss_hash_func_í
 {

873 
	mIWL_RSS_HASH_TYPE_IPV4_TCP
,

874 
	mIWL_RSS_HASH_TYPE_IPV4_UDP
,

875 
	mIWL_RSS_HASH_TYPE_IPV4_PAYLOAD
,

876 
	mIWL_RSS_HASH_TYPE_IPV6_TCP
,

877 
	mIWL_RSS_HASH_TYPE_IPV6_UDP
,

878 
	mIWL_RSS_HASH_TYPE_IPV6_PAYLOAD
,

881 
	#IWL_RSS_HASH_KEY_CNT
 10

	)

882 
	#IWL_RSS_INDIRECTION_TABLE_SIZE
 128

	)

883 
	#IWL_RSS_ENABLE
 1

	)

894 
	siwl_rss_c⁄fig_cmd
 {

895 
__À32
 
	mÊags
;

896 
u8
 
	mhash_mask
;

897 
u8
 
	mª£rved
[3];

898 
__À32
 
	m£¸ë_key
[
IWL_RSS_HASH_KEY_CNT
];

899 
u8
 
	mödúe˘i⁄_èbÀ
[
IWL_RSS_INDIRECTION_TABLE_SIZE
];

900 } 
	g__∑cked
;

902 
	#IWL_MULTI_QUEUE_SYNC_SENDER_POS
 0

	)

903 
	#IWL_MULTI_QUEUE_SYNC_SENDER_MSK
 0xf

	)

913 
	siwl_rxq_sync_cmd
 {

914 
__À32
 
	mÊags
;

915 
__À32
 
	mrxq_mask
;

916 
__À32
 
	mcou¡
;

917 
u8
 
	m∑ylﬂd
[];

918 } 
	g__∑cked
;

927 
	siwl_rxq_sync_nŸifiˇti⁄
 {

928 
__À32
 
	mcou¡
;

929 
u8
 
	m∑ylﬂd
[];

930 } 
	g__∑cked
;

939 
	eiwl_mvm_pm_evít
 {

940 
	mIWL_MVM_PM_EVENT_AWAKE
,

941 
	mIWL_MVM_PM_EVENT_ASLEEP
,

942 
	mIWL_MVM_PM_EVENT_UAPSD
,

943 
	mIWL_MVM_PM_EVENT_PS_POLL
,

951 
	siwl_mvm_pm_°©e_nŸifiˇti⁄
 {

952 
u8
 
	m°a_id
;

953 
u8
 
	mty≥
;

955 
__À16
 
	mª£rved
;

956 } 
	g__∑cked
;

958 
	#BA_WINDOW_STREAMS_MAX
 16

	)

959 
	#BA_WINDOW_STATUS_TID_MSK
 0x000F

	)

960 
	#BA_WINDOW_STATUS_STA_ID_POS
 4

	)

961 
	#BA_WINDOW_STATUS_STA_ID_MSK
 0x01F0

	)

962 
	#BA_WINDOW_STATUS_VALID_MSK
 
	`BIT
(9)

	)

971 
	siwl_ba_wödow_°©us_nŸif
 {

972 
__À64
 
	mbôm≠
[
BA_WINDOW_STREAMS_MAX
];

973 
__À16
 
	mø_tid
[
BA_WINDOW_STREAMS_MAX
];

974 
__À32
 
	m°¨t_£q_num
[
BA_WINDOW_STREAMS_MAX
];

975 
__À16
 
	mmpdu_rx_cou¡
[
BA_WINDOW_STREAMS_MAX
];

976 } 
	g__∑cked
;

988 
	siwl_rfh_queue_d©a
 {

989 
u8
 
	mq_num
;

990 
u8
 
	míabÀ
;

991 
__À16
 
	mª£rved
;

992 
__À64
 
	murbd_°ts_wΩå
;

993 
__À64
 
	m‰_bd_cb
;

994 
__À64
 
	mur_bd_cb
;

995 
__À32
 
	m‰_bd_wid
;

996 } 
	g__∑cked
;

1004 
	siwl_rfh_queue_c⁄fig
 {

1005 
u8
 
	mnum_queues
;

1006 
u8
 
	mª£rved
[3];

1007 
iwl_rfh_queue_d©a
 
	md©a
[];

1008 } 
	g__∑cked
;

	@fw/api/scan.h

7 #i‚de‡
__iwl_fw_≠i_sˇn_h__


8 
	#__iwl_fw_≠i_sˇn_h__


	)

15 
	eiwl_sˇn_subcmd_ids
 {

19 
	mOFFLOAD_MATCH_INFO_NOTIF
 = 0xFC,

23 
	#PROBE_OPTION_MAX
 20

	)

25 
	#SCAN_SHORT_SSID_MAX_SIZE
 8

	)

26 
	#SCAN_BSSID_MAX_SIZE
 16

	)

40 
	siwl_ssid_õ
 {

41 
u8
 
	mid
;

42 
u8
 
	mÀn
;

43 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

44 } 
	g__∑cked
;

47 
	#IWL_SCAN_MAX_BLACKLIST_LEN
 64

	)

48 
	#IWL_SCAN_SHORT_BLACKLIST_LEN
 16

	)

49 
	#IWL_SCAN_MAX_PROFILES
 11

	)

50 
	#IWL_SCAN_MAX_PROFILES_V2
 8

	)

51 
	#SCAN_OFFLOAD_PROBE_REQ_SIZE
 512

	)

52 
	#SCAN_NUM_BAND_PROBE_DATA_V_1
 2

	)

53 
	#SCAN_NUM_BAND_PROBE_DATA_V_2
 3

	)

56 
	#IWL_SCHED_SCAN_WATCHDOG
 
	`˝u_to_À16
(15000)

	)

58 
	#IWL_GOOD_CRC_TH_DEFAULT
 
	`˝u_to_À16
(1)

	)

59 
	#CAN_ABORT_STATUS
 1

	)

61 
	#IWL_FULL_SCAN_MULTIPLIER
 5

	)

62 
	#IWL_FAST_SCHED_SCAN_ITERATIONS
 3

	)

63 
	#IWL_MAX_SCHED_SCAN_PLANS
 2

	)

65 
	esˇn_‰amew‹k_˛õ¡
 {

66 
	mSCAN_CLIENT_SCHED_SCAN
 = 
BIT
(0),

67 
	mSCAN_CLIENT_NETDETECT
 = 
BIT
(1),

68 
	mSCAN_CLIENT_ASSET_TRACKING
 = 
BIT
(2),

77 
	siwl_sˇn_ofÊﬂd_blockli°
 {

78 
u8
 
	mssid
[
ETH_ALEN
];

79 
u8
 
	mªp‹ãd_rssi
;

80 
u8
 
	m˛õ¡_bôm≠
;

81 } 
	g__∑cked
;

83 
	eiwl_sˇn_ofÊﬂd_√tw‹k_ty≥
 {

84 
	mIWL_NETWORK_TYPE_BSS
 = 1,

85 
	mIWL_NETWORK_TYPE_IBSS
 = 2,

86 
	mIWL_NETWORK_TYPE_ANY
 = 3,

89 
	eiwl_sˇn_ofÊﬂd_b™d_£À˘i⁄
 {

90 
	mIWL_SCAN_OFFLOAD_SELECT_2_4
 = 0x4,

91 
	mIWL_SCAN_OFFLOAD_SELECT_5_2
 = 0x8,

92 
	mIWL_SCAN_OFFLOAD_SELECT_ANY
 = 0xc,

95 
	eiwl_sˇn_ofÊﬂd_auth_Æg
 {

96 
	mIWL_AUTH_ALGO_UNSUPPORTED
 = 0x00,

97 
	mIWL_AUTH_ALGO_NONE
 = 0x01,

98 
	mIWL_AUTH_ALGO_PSK
 = 0x02,

99 
	mIWL_AUTH_ALGO_8021X
 = 0x04,

100 
	mIWL_AUTH_ALGO_SAE
 = 0x08,

101 
	mIWL_AUTH_ALGO_8021X_SHA384
 = 0x10,

102 
	mIWL_AUTH_ALGO_OWE
 = 0x20,

115 
	siwl_sˇn_ofÊﬂd_¥ofûe
 {

116 
u8
 
	mssid_ödex
;

117 
u8
 
	muniˇ°_cùhî
;

118 
u8
 
	mauth_Æg
;

119 
u8
 
	m√tw‹k_ty≥
;

120 
u8
 
	mb™d_£À˘i⁄
;

121 
u8
 
	m˛õ¡_bôm≠
;

122 
u8
 
	mª£rved
[2];

123 } 
	g__∑cked
;

135 
	siwl_sˇn_ofÊﬂd_¥ofûe_cfg_d©a
 {

136 
u8
 
	mblockli°_Àn
;

137 
u8
 
	mnum_¥ofûes
;

138 
u8
 
	mm©ch_nŸify
;

139 
u8
 
	m∑ss_m©ch
;

140 
u8
 
	ma˘ive_˛õ¡s
;

141 
u8
 
	m™y_bóc⁄_nŸify
;

142 
u8
 
	mª£rved
[2];

143 } 
	g__∑cked
;

150 
	siwl_sˇn_ofÊﬂd_¥ofûe_cfg_v1
 {

151 
iwl_sˇn_ofÊﬂd_¥ofûe
 
	m¥ofûes
[
IWL_SCAN_MAX_PROFILES
];

152 
iwl_sˇn_ofÊﬂd_¥ofûe_cfg_d©a
 
	md©a
;

153 } 
	g__∑cked
;

160 
	siwl_sˇn_ofÊﬂd_¥ofûe_cfg
 {

161 
iwl_sˇn_ofÊﬂd_¥ofûe
 
	m¥ofûes
[
IWL_SCAN_MAX_PROFILES_V2
];

162 
iwl_sˇn_ofÊﬂd_¥ofûe_cfg_d©a
 
	md©a
;

163 } 
	g__∑cked
;

171 
	siwl_sˇn_scheduÀ_lmac
 {

172 
__À16
 
	mdñay
;

173 
u8
 
	môî©i⁄s
;

174 
u8
 
	mfuŒ_sˇn_mul
;

175 } 
	g__∑cked
;

177 
	eiwl_sˇn_ofÊﬂd_com∂ëe_°©us
 {

178 
	mIWL_SCAN_OFFLOAD_COMPLETED
 = 1,

179 
	mIWL_SCAN_OFFLOAD_ABORTED
 = 2,

182 
	eiwl_sˇn_ebs_°©us
 {

183 
	mIWL_SCAN_EBS_SUCCESS
,

184 
	mIWL_SCAN_EBS_FAILED
,

185 
	mIWL_SCAN_EBS_CHAN_NOT_FOUND
,

186 
	mIWL_SCAN_EBS_INACTIVE
,

197 
	siwl_sˇn_ªq_tx_cmd
 {

198 
__À32
 
	mtx_Êags
;

199 
__À32
 
	møã_n_Êags
;

200 
u8
 
	m°a_id
;

201 
u8
 
	mª£rved
[3];

202 } 
	g__∑cked
;

204 
	eiwl_sˇn_ch™√l_Êags_lmac
 {

205 
	mIWL_UNIFIED_SCAN_CHANNEL_FULL
 = 
BIT
(27),

206 
	mIWL_UNIFIED_SCAN_CHANNEL_PARTIAL
 = 
BIT
(28),

217 
	siwl_sˇn_ch™√l_cfg_lmac
 {

218 
__À32
 
	mÊags
;

219 
__À16
 
	mch™√l_num
;

220 
__À16
 
	môî_cou¡
;

221 
__À32
 
	môî_öãrvÆ
;

222 } 
	g__∑cked
;

229 
	siwl_sˇn_¥obe_£gmít
 {

230 
__À16
 
	moff£t
;

231 
__À16
 
	mÀn
;

232 } 
	g__∑cked
;

241 
	siwl_sˇn_¥obe_ªq_v1
 {

242 
iwl_sˇn_¥obe_£gmít
 
	mmac_hódî
;

243 
iwl_sˇn_¥obe_£gmít
 
	mb™d_d©a
[
SCAN_NUM_BAND_PROBE_DATA_V_1
];

244 
iwl_sˇn_¥obe_£gmít
 
	mcomm⁄_d©a
;

245 
u8
 
	mbuf
[
SCAN_OFFLOAD_PROBE_REQ_SIZE
];

246 } 
	g__∑cked
;

255 
	siwl_sˇn_¥obe_ªq
 {

256 
iwl_sˇn_¥obe_£gmít
 
	mmac_hódî
;

257 
iwl_sˇn_¥obe_£gmít
 
	mb™d_d©a
[
SCAN_NUM_BAND_PROBE_DATA_V_2
];

258 
iwl_sˇn_¥obe_£gmít
 
	mcomm⁄_d©a
;

259 
u8
 
	mbuf
[
SCAN_OFFLOAD_PROBE_REQ_SIZE
];

260 } 
	g__∑cked
;

262 
	eiwl_sˇn_ch™√l_Êags
 {

263 
	mIWL_SCAN_CHANNEL_FLAG_EBS
 = 
BIT
(0),

264 
	mIWL_SCAN_CHANNEL_FLAG_EBS_ACCURATE
 = 
BIT
(1),

265 
	mIWL_SCAN_CHANNEL_FLAG_CACHE_ADD
 = 
BIT
(2),

266 
	mIWL_SCAN_CHANNEL_FLAG_EBS_FRAG
 = 
BIT
(3),

267 
	mIWL_SCAN_CHANNEL_FLAG_FORCE_EBS
 = 
BIT
(4),

268 
	mIWL_SCAN_CHANNEL_FLAG_ENABLE_CHAN_ORDER
 = 
BIT
(5),

269 
	mIWL_SCAN_CHANNEL_FLAG_6G_PSC_NO_FILTER
 = 
BIT
(6),

280 
	siwl_sˇn_ch™√l_›t
 {

281 
__À16
 
	mÊags
;

282 
__À16
 
	mn⁄_ebs_øtio
;

283 } 
	g__∑cked
;

300 
	eiwl_mvm_lmac_sˇn_Êags
 {

301 
	mIWL_MVM_LMAC_SCAN_FLAG_PASS_ALL
 = 
BIT
(0),

302 
	mIWL_MVM_LMAC_SCAN_FLAG_PASSIVE
 = 
BIT
(1),

303 
	mIWL_MVM_LMAC_SCAN_FLAG_PRE_CONNECTION
 = 
BIT
(2),

304 
	mIWL_MVM_LMAC_SCAN_FLAG_ITER_COMPLETE
 = 
BIT
(3),

305 
	mIWL_MVM_LMAC_SCAN_FLAG_MULTIPLE_SSIDS
 = 
BIT
(4),

306 
	mIWL_MVM_LMAC_SCAN_FLAG_FRAGMENTED
 = 
BIT
(5),

307 
	mIWL_MVM_LMAC_SCAN_FLAGS_RRM_ENABLED
 = 
BIT
(6),

308 
	mIWL_MVM_LMAC_SCAN_FLAG_EXTENDED_DWELL
 = 
BIT
(7),

309 
	mIWL_MVM_LMAC_SCAN_FLAG_MATCH
 = 
BIT
(9),

312 
	eiwl_sˇn_¥i‹ôy
 {

313 
	mIWL_SCAN_PRIORITY_LOW
,

314 
	mIWL_SCAN_PRIORITY_MEDIUM
,

315 
	mIWL_SCAN_PRIORITY_HIGH
,

318 
	eiwl_sˇn_¥i‹ôy_ext
 {

319 
	mIWL_SCAN_PRIORITY_EXT_0_LOWEST
,

320 
	mIWL_SCAN_PRIORITY_EXT_1
,

321 
	mIWL_SCAN_PRIORITY_EXT_2
,

322 
	mIWL_SCAN_PRIORITY_EXT_3
,

323 
	mIWL_SCAN_PRIORITY_EXT_4
,

324 
	mIWL_SCAN_PRIORITY_EXT_5
,

325 
	mIWL_SCAN_PRIORITY_EXT_6
,

326 
	mIWL_SCAN_PRIORITY_EXT_7_HIGHEST
,

354 
	siwl_sˇn_ªq_lmac
 {

356 
__À32
 
	mª£rved1
;

357 
u8
 
	mn_ch™√ls
;

358 
u8
 
	ma˘ive_dwñl
;

359 
u8
 
	m∑ssive_dwñl
;

360 
u8
 
	m‰agmíãd_dwñl
;

361 
u8
 
	mexãnded_dwñl
;

362 
u8
 
	mª£rved2
;

363 
__À16
 
	mrx_chaö_£À˘
;

364 
__À32
 
	msˇn_Êags
;

365 
__À32
 
	mmax_out_time
;

366 
__À32
 
	msu•íd_time
;

368 
__À32
 
	mÊags
;

369 
__À32
 
	mfûãr_Êags
;

370 
iwl_sˇn_ªq_tx_cmd
 
	mtx_cmd
[2];

371 
iwl_ssid_õ
 
	mdúe˘_sˇn
[
PROBE_OPTION_MAX
];

372 
__À32
 
	msˇn_¥io
;

374 
__À32
 
	môî_num
;

375 
__À32
 
	mdñay
;

376 
iwl_sˇn_scheduÀ_lmac
 
	mscheduÀ
[
IWL_MAX_SCHED_SCAN_PLANS
];

377 
iwl_sˇn_ch™√l_›t
 
	mch™√l_›t
[2];

378 
u8
 
	md©a
[];

379 } 
	g__∑cked
;

390 
	siwl_sˇn_ªsu…s_nŸif
 {

391 
u8
 
	mch™√l
;

392 
u8
 
	mb™d
;

393 
u8
 
	m¥obe_°©us
;

394 
u8
 
	mnum_¥obe_nŸ_£¡
;

395 
__À32
 
	mduøti⁄
;

396 } 
	g__∑cked
;

409 
	siwl_lmac_sˇn_com∂ëe_nŸif
 {

410 
u8
 
	msˇ¬ed_ch™√ls
;

411 
u8
 
	m°©us
;

412 
u8
 
	mbt_°©us
;

413 
u8
 
	mœ°_ch™√l
;

414 
__À32
 
	mtsf_low
;

415 
__À32
 
	mtsf_high
;

416 
iwl_sˇn_ªsu…s_nŸif
 
	mªsu…s
[];

417 } 
	g__∑cked
;

428 
	siwl_≥riodic_sˇn_com∂ëe
 {

429 
u8
 
	mœ°_scheduÀ_löe
;

430 
u8
 
	mœ°_scheduÀ_ôî©i⁄
;

431 
u8
 
	m°©us
;

432 
u8
 
	mebs_°©us
;

433 
__À32
 
	mtime_a·î_œ°_ôî
;

434 
__À32
 
	mª£rved
;

435 } 
	g__∑cked
;

442 
	#IWL_MVM_MAX_UMAC_SCANS
 4

	)

443 
	#IWL_MVM_MAX_LMAC_SCANS
 1

	)

445 
	esˇn_c⁄fig_Êags
 {

446 
	mSCAN_CONFIG_FLAG_ACTIVATE
 = 
BIT
(0),

447 
	mSCAN_CONFIG_FLAG_DEACTIVATE
 = 
BIT
(1),

448 
	mSCAN_CONFIG_FLAG_FORBID_CHUB_REQS
 = 
BIT
(2),

449 
	mSCAN_CONFIG_FLAG_ALLOW_CHUB_REQS
 = 
BIT
(3),

450 
	mSCAN_CONFIG_FLAG_SET_TX_CHAINS
 = 
BIT
(8),

451 
	mSCAN_CONFIG_FLAG_SET_RX_CHAINS
 = 
BIT
(9),

452 
	mSCAN_CONFIG_FLAG_SET_AUX_STA_ID
 = 
BIT
(10),

453 
	mSCAN_CONFIG_FLAG_SET_ALL_TIMES
 = 
BIT
(11),

454 
	mSCAN_CONFIG_FLAG_SET_EFFECTIVE_TIMES
 = 
BIT
(12),

455 
	mSCAN_CONFIG_FLAG_SET_CHANNEL_FLAGS
 = 
BIT
(13),

456 
	mSCAN_CONFIG_FLAG_SET_LEGACY_RATES
 = 
BIT
(14),

457 
	mSCAN_CONFIG_FLAG_SET_MAC_ADDR
 = 
BIT
(15),

458 
	mSCAN_CONFIG_FLAG_SET_FRAGMENTED
 = 
BIT
(16),

459 
	mSCAN_CONFIG_FLAG_CLEAR_FRAGMENTED
 = 
BIT
(17),

460 
	mSCAN_CONFIG_FLAG_SET_CAM_MODE
 = 
BIT
(18),

461 
	mSCAN_CONFIG_FLAG_CLEAR_CAM_MODE
 = 
BIT
(19),

462 
	mSCAN_CONFIG_FLAG_SET_PROMISC_MODE
 = 
BIT
(20),

463 
	mSCAN_CONFIG_FLAG_CLEAR_PROMISC_MODE
 = 
BIT
(21),

464 
	mSCAN_CONFIG_FLAG_SET_LMAC2_FRAGMENTED
 = 
BIT
(22),

465 
	mSCAN_CONFIG_FLAG_CLEAR_LMAC2_FRAGMENTED
 = 
BIT
(23),

468 
	#SCAN_CONFIG_N_CHANNELS
(
n
Ë(“Ë<< 26)

	)

471 
	esˇn_c⁄fig_øãs
 {

473 
	mSCAN_CONFIG_RATE_6M
 = 
BIT
(0),

474 
	mSCAN_CONFIG_RATE_9M
 = 
BIT
(1),

475 
	mSCAN_CONFIG_RATE_12M
 = 
BIT
(2),

476 
	mSCAN_CONFIG_RATE_18M
 = 
BIT
(3),

477 
	mSCAN_CONFIG_RATE_24M
 = 
BIT
(4),

478 
	mSCAN_CONFIG_RATE_36M
 = 
BIT
(5),

479 
	mSCAN_CONFIG_RATE_48M
 = 
BIT
(6),

480 
	mSCAN_CONFIG_RATE_54M
 = 
BIT
(7),

482 
	mSCAN_CONFIG_RATE_1M
 = 
BIT
(8),

483 
	mSCAN_CONFIG_RATE_2M
 = 
BIT
(9),

484 
	mSCAN_CONFIG_RATE_5M
 = 
BIT
(10),

485 
	mSCAN_CONFIG_RATE_11M
 = 
BIT
(11),

488 
	#SCAN_CONFIG_SUPPORTED_RATE
(
øã
Ë(‘©eË<< 16)

	)

491 
	eiwl_ch™√l_Êags
 {

492 
	mIWL_CHANNEL_FLAG_EBS
 = 
BIT
(0),

493 
	mIWL_CHANNEL_FLAG_ACCURATE_EBS
 = 
BIT
(1),

494 
	mIWL_CHANNEL_FLAG_EBS_ADD
 = 
BIT
(2),

495 
	mIWL_CHANNEL_FLAG_PRE_SCAN_PASSIVE2ACTIVE
 = 
BIT
(3),

498 
	eiwl_uhb_ch™_cfg_Êags
 {

499 
	mIWL_UHB_CHAN_CFG_FLAG_UNSOLICITED_PROBE_RES
 = 
BIT
(24),

500 
	mIWL_UHB_CHAN_CFG_FLAG_PSC_CHAN_NO_LISTEN
 = 
BIT
(25),

501 
	mIWL_UHB_CHAN_CFG_FLAG_FORCE_PASSIVE
 = 
BIT
(26),

510 
	siwl_sˇn_dwñl
 {

511 
u8
 
	ma˘ive
;

512 
u8
 
	m∑ssive
;

513 
u8
 
	m‰agmíãd
;

514 
u8
 
	mexãnded
;

515 } 
	g__∑cked
;

532 
	siwl_sˇn_c⁄fig_v1
 {

533 
__À32
 
	mÊags
;

534 
__À32
 
	mtx_chaös
;

535 
__À32
 
	mrx_chaös
;

536 
__À32
 
	mÀgacy_øãs
;

537 
__À32
 
	mout_of_ch™√l_time
;

538 
__À32
 
	msu•íd_time
;

539 
iwl_sˇn_dwñl
 
	mdwñl
;

540 
u8
 
	mmac_addr
[
ETH_ALEN
];

541 
u8
 
	mbˇ°_°a_id
;

542 
u8
 
	mch™√l_Êags
;

543 
u8
 
	mch™√l_¨øy
[];

544 } 
	g__∑cked
;

546 
	#SCAN_TWO_LMACS
 2

	)

547 
	#SCAN_LB_LMAC_IDX
 0

	)

548 
	#SCAN_HB_LMAC_IDX
 1

	)

565 
	siwl_sˇn_c⁄fig_v2
 {

566 
__À32
 
	mÊags
;

567 
__À32
 
	mtx_chaös
;

568 
__À32
 
	mrx_chaös
;

569 
__À32
 
	mÀgacy_øãs
;

570 
__À32
 
	mout_of_ch™√l_time
[
SCAN_TWO_LMACS
];

571 
__À32
 
	msu•íd_time
[
SCAN_TWO_LMACS
];

572 
iwl_sˇn_dwñl
 
	mdwñl
;

573 
u8
 
	mmac_addr
[
ETH_ALEN
];

574 
u8
 
	mbˇ°_°a_id
;

575 
u8
 
	mch™√l_Êags
;

576 
u8
 
	mch™√l_¨øy
[];

577 } 
	g__∑cked
;

589 
	siwl_sˇn_c⁄fig
 {

590 
u8
 
	míabÀ_ˇm_mode
;

591 
u8
 
	míabÀ_¥omiscouos_mode
;

592 
u8
 
	mbˇ°_°a_id
;

593 
u8
 
	mª£rved
;

594 
__À32
 
	mtx_chaös
;

595 
__À32
 
	mrx_chaös
;

596 } 
	g__∑cked
;

607 
	eiwl_umac_sˇn_Êags
 {

608 
	mIWL_UMAC_SCAN_FLAG_PREEMPTIVE
 = 
BIT
(0),

609 
	mIWL_UMAC_SCAN_FLAG_START_NOTIF
 = 
BIT
(1),

612 
	eiwl_umac_sˇn_uid_off£ts
 {

613 
	mIWL_UMAC_SCAN_UID_TYPE_OFFSET
 = 0,

614 
	mIWL_UMAC_SCAN_UID_SEQ_OFFSET
 = 8,

617 
	eiwl_umac_sˇn_gíîÆ_Êags
 {

618 
	mIWL_UMAC_SCAN_GEN_FLAGS_PERIODIC
 = 
BIT
(0),

619 
	mIWL_UMAC_SCAN_GEN_FLAGS_OVER_BT
 = 
BIT
(1),

620 
	mIWL_UMAC_SCAN_GEN_FLAGS_PASS_ALL
 = 
BIT
(2),

621 
	mIWL_UMAC_SCAN_GEN_FLAGS_PASSIVE
 = 
BIT
(3),

622 
	mIWL_UMAC_SCAN_GEN_FLAGS_PRE_CONNECT
 = 
BIT
(4),

623 
	mIWL_UMAC_SCAN_GEN_FLAGS_ITER_COMPLETE
 = 
BIT
(5),

624 
	mIWL_UMAC_SCAN_GEN_FLAGS_MULTIPLE_SSID
 = 
BIT
(6),

625 
	mIWL_UMAC_SCAN_GEN_FLAGS_FRAGMENTED
 = 
BIT
(7),

626 
	mIWL_UMAC_SCAN_GEN_FLAGS_RRM_ENABLED
 = 
BIT
(8),

627 
	mIWL_UMAC_SCAN_GEN_FLAGS_MATCH
 = 
BIT
(9),

628 
	mIWL_UMAC_SCAN_GEN_FLAGS_EXTENDED_DWELL
 = 
BIT
(10),

632 
	mIWL_UMAC_SCAN_GEN_FLAGS_PROB_REQ_DEFER_SUPP
 = 
BIT
(10),

633 
	mIWL_UMAC_SCAN_GEN_FLAGS_LMAC2_FRAGMENTED
 = 
BIT
(11),

634 
	mIWL_UMAC_SCAN_GEN_FLAGS_ADAPTIVE_DWELL
 = 
BIT
(13),

635 
	mIWL_UMAC_SCAN_GEN_FLAGS_MAX_CHNL_TIME
 = 
BIT
(14),

636 
	mIWL_UMAC_SCAN_GEN_FLAGS_PROB_REQ_HIGH_TX_RATE
 = 
BIT
(15),

646 
	eiwl_umac_sˇn_gíîÆ_Êags2
 {

647 
	mIWL_UMAC_SCAN_GEN_FLAGS2_NOTIF_PER_CHNL
 = 
BIT
(0),

648 
	mIWL_UMAC_SCAN_GEN_FLAGS2_ALLOW_CHNL_REORDER
 = 
BIT
(1),

686 
	eiwl_umac_sˇn_gíîÆ_Êags_v2
 {

687 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_PERIODIC
 = 
BIT
(0),

688 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_PASS_ALL
 = 
BIT
(1),

689 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_NTFY_ITER_COMPLETE
 = 
BIT
(2),

690 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_FRAGMENTED_LMAC1
 = 
BIT
(3),

691 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_FRAGMENTED_LMAC2
 = 
BIT
(4),

692 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_MATCH
 = 
BIT
(5),

693 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_USE_ALL_RX_CHAINS
 = 
BIT
(6),

694 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_ADAPTIVE_DWELL
 = 
BIT
(7),

695 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_PREEMPTIVE
 = 
BIT
(8),

696 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_NTF_START
 = 
BIT
(9),

697 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_MULTI_SSID
 = 
BIT
(10),

698 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_FORCE_PASSIVE
 = 
BIT
(11),

699 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_TRIGGER_UHB_SCAN
 = 
BIT
(12),

700 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_6GHZ_PASSIVE_SCAN
 = 
BIT
(13),

701 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_6GHZ_PASSIVE_SCAN_FILTER_IN
 = 
BIT
(14),

702 
	mIWL_UMAC_SCAN_GEN_FLAGS_V2_OCE
 = 
BIT
(15),

715 
	eiwl_umac_sˇn_gíîÆ_∑øms_Êags2
 {

716 
	mIWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_RESPECT_P2P_GO_LB
 = 
BIT
(0),

717 
	mIWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_RESPECT_P2P_GO_HB
 = 
BIT
(1),

718 
	mIWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_DONT_TOGGLE_ANT
 = 
BIT
(2),

729 
	siwl_sˇn_ch™√l_cfg_umac
 {

730 
	#IWL_CHAN_CFG_FLAGS_BAND_POS
 30

	)

731 
__À32
 
	mÊags
;

738 
u8
 
	mch™√l_num
;

739 
u8
 
	môî_cou¡
;

740 
__À16
 
	môî_öãrvÆ
;

741 } 
	mv1
;

743 
u8
 
	mch™√l_num
;

744 
u8
 
	mb™d
;

745 
u8
 
	môî_cou¡
;

746 
u8
 
	môî_öãrvÆ
;

747 } 
	mv2
;

752 
u8
 
	mch™√l_num
;

753 
u8
 
	mpsd_20
;

754 
u8
 
	môî_cou¡
;

755 
u8
 
	môî_öãrvÆ
;

756 } 
	mv5
;

758 } 
	g__∑cked
;

766 
	siwl_sˇn_umac_scheduÀ
 {

767 
__À16
 
	möãrvÆ
;

768 
u8
 
	môî_cou¡
;

769 
u8
 
	mª£rved
;

770 } 
	g__∑cked
;

772 
	siwl_sˇn_ªq_umac_èû_v1
 {

774 
iwl_sˇn_umac_scheduÀ
 
	mscheduÀ
[
IWL_MAX_SCHED_SCAN_PLANS
];

775 
__À16
 
	mdñay
;

776 
__À16
 
	mª£rved
;

778 
iwl_sˇn_¥obe_ªq_v1
 
	m¥eq
;

779 
iwl_ssid_õ
 
	mdúe˘_sˇn
[
PROBE_OPTION_MAX
];

780 } 
	g__∑cked
;

791 
	siwl_sˇn_ªq_umac_èû_v2
 {

793 
iwl_sˇn_umac_scheduÀ
 
	mscheduÀ
[
IWL_MAX_SCHED_SCAN_PLANS
];

794 
__À16
 
	mdñay
;

795 
__À16
 
	mª£rved
;

797 
iwl_sˇn_¥obe_ªq
 
	m¥eq
;

798 
iwl_ssid_õ
 
	mdúe˘_sˇn
[
PROBE_OPTION_MAX
];

799 } 
	g__∑cked
;

807 
	siwl_sˇn_umac_ch™_∑øm
 {

808 
u8
 
	mÊags
;

809 
u8
 
	mcou¡
;

810 
__À16
 
	mª£rved
;

811 } 
	g__∑cked
;

843 
	siwl_sˇn_ªq_umac
 {

844 
__À32
 
	mÊags
;

845 
__À32
 
	muid
;

846 
__À32
 
	mooc_¥i‹ôy
;

847 
__À16
 
	mgíîÆ_Êags
;

848 
u8
 
	mª£rved
;

849 
u8
 
	msˇn_°¨t_mac_id
;

852 
u8
 
	mexãnded_dwñl
;

853 
u8
 
	ma˘ive_dwñl
;

854 
u8
 
	m∑ssive_dwñl
;

855 
u8
 
	m‰agmíãd_dwñl
;

856 
__À32
 
	mmax_out_time
;

857 
__À32
 
	msu•íd_time
;

858 
__À32
 
	msˇn_¥i‹ôy
;

859 
iwl_sˇn_umac_ch™_∑øm
 
	mch™√l
;

860 
u8
 
	md©a
[];

861 } 
	mv1
;

863 
u8
 
	mexãnded_dwñl
;

864 
u8
 
	ma˘ive_dwñl
;

865 
u8
 
	m∑ssive_dwñl
;

866 
u8
 
	m‰agmíãd_dwñl
;

867 
__À32
 
	mmax_out_time
[
SCAN_TWO_LMACS
];

868 
__À32
 
	msu•íd_time
[
SCAN_TWO_LMACS
];

869 
__À32
 
	msˇn_¥i‹ôy
;

870 
iwl_sˇn_umac_ch™_∑øm
 
	mch™√l
;

871 
u8
 
	md©a
[];

872 } 
	mv6
;

874 
u8
 
	ma˘ive_dwñl
;

875 
u8
 
	m∑ssive_dwñl
;

876 
u8
 
	m‰agmíãd_dwñl
;

877 
u8
 
	madwñl_deÁu…_n_≠s
;

878 
u8
 
	madwñl_deÁu…_n_≠s_socül
;

879 
u8
 
	mª£rved3
;

880 
__À16
 
	madwñl_max_budgë
;

881 
__À32
 
	mmax_out_time
[
SCAN_TWO_LMACS
];

882 
__À32
 
	msu•íd_time
[
SCAN_TWO_LMACS
];

883 
__À32
 
	msˇn_¥i‹ôy
;

884 
iwl_sˇn_umac_ch™_∑øm
 
	mch™√l
;

885 
u8
 
	md©a
[];

886 } 
	mv7
;

888 
u8
 
	ma˘ive_dwñl
[
SCAN_TWO_LMACS
];

889 
u8
 
	mª£rved2
;

890 
u8
 
	madwñl_deÁu…_n_≠s
;

891 
u8
 
	madwñl_deÁu…_n_≠s_socül
;

892 
u8
 
	mgíîÆ_Êags2
;

893 
__À16
 
	madwñl_max_budgë
;

894 
__À32
 
	mmax_out_time
[
SCAN_TWO_LMACS
];

895 
__À32
 
	msu•íd_time
[
SCAN_TWO_LMACS
];

896 
__À32
 
	msˇn_¥i‹ôy
;

897 
u8
 
	m∑ssive_dwñl
[
SCAN_TWO_LMACS
];

898 
u8
 
	mnum_of_‰agmíts
[
SCAN_TWO_LMACS
];

899 
iwl_sˇn_umac_ch™_∑øm
 
	mch™√l
;

900 
u8
 
	md©a
[];

901 } 
	mv8
;

903 
u8
 
	ma˘ive_dwñl
[
SCAN_TWO_LMACS
];

904 
u8
 
	madwñl_deÁu…_hb_n_≠s
;

905 
u8
 
	madwñl_deÁu…_lb_n_≠s
;

906 
u8
 
	madwñl_deÁu…_n_≠s_socül
;

907 
u8
 
	mgíîÆ_Êags2
;

908 
__À16
 
	madwñl_max_budgë
;

909 
__À32
 
	mmax_out_time
[
SCAN_TWO_LMACS
];

910 
__À32
 
	msu•íd_time
[
SCAN_TWO_LMACS
];

911 
__À32
 
	msˇn_¥i‹ôy
;

912 
u8
 
	m∑ssive_dwñl
[
SCAN_TWO_LMACS
];

913 
u8
 
	mnum_of_‰agmíts
[
SCAN_TWO_LMACS
];

914 
iwl_sˇn_umac_ch™_∑øm
 
	mch™√l
;

915 
u8
 
	md©a
[];

916 } 
	mv9
;

918 } 
	g__∑cked
;

920 
	#IWL_SCAN_REQ_UMAC_SIZE_V8
 (
iwl_sˇn_ªq_umac
)

	)

921 
	#IWL_SCAN_REQ_UMAC_SIZE_V7
 48

	)

922 
	#IWL_SCAN_REQ_UMAC_SIZE_V6
 44

	)

923 
	#IWL_SCAN_REQ_UMAC_SIZE_V1
 36

	)

936 
	siwl_sˇn_¥obe_∑øms_v3
 {

937 
iwl_sˇn_¥obe_ªq
 
	m¥eq
;

938 
u8
 
	mssid_num
;

939 
u8
 
	msh‹t_ssid_num
;

940 
u8
 
	mbssid_num
;

941 
u8
 
	mª£rved
;

942 
iwl_ssid_õ
 
	mdúe˘_sˇn
[
PROBE_OPTION_MAX
];

943 
__À32
 
	msh‹t_ssid
[
SCAN_SHORT_SSID_MAX_SIZE
];

944 
u8
 
	mbssid_¨øy
[
SCAN_BSSID_MAX_SIZE
][
ETH_ALEN
];

945 } 
	g__∑cked
;

957 
	siwl_sˇn_¥obe_∑øms_v4
 {

958 
iwl_sˇn_¥obe_ªq
 
	m¥eq
;

959 
u8
 
	msh‹t_ssid_num
;

960 
u8
 
	mbssid_num
;

961 
__À16
 
	mª£rved
;

962 
iwl_ssid_õ
 
	mdúe˘_sˇn
[
PROBE_OPTION_MAX
];

963 
__À32
 
	msh‹t_ssid
[
SCAN_SHORT_SSID_MAX_SIZE
];

964 
u8
 
	mbssid_¨øy
[
SCAN_BSSID_MAX_SIZE
][
ETH_ALEN
];

965 } 
	g__∑cked
;

967 
	#SCAN_MAX_NUM_CHANS_V3
 67

	)

982 
	siwl_sˇn_ch™√l_∑øms_v4
 {

983 
u8
 
	mÊags
;

984 
u8
 
	mcou¡
;

985 
u8
 
	mnum_of_≠s_ovîride
;

986 
u8
 
	mª£rved
;

987 
iwl_sˇn_ch™√l_cfg_umac
 
	mch™√l_c⁄fig
[
SCAN_MAX_NUM_CHANS_V3
];

988 
u8
 
	madwñl_ch_ovîride_bôm≠
[16];

989 } 
	g__∑cked
;

1003 
	siwl_sˇn_ch™√l_∑øms_v7
 {

1004 
u8
 
	mÊags
;

1005 
u8
 
	mcou¡
;

1006 
u8
 
	mn_≠s_ovîride
[2];

1007 
iwl_sˇn_ch™√l_cfg_umac
 
	mch™√l_c⁄fig
[
SCAN_MAX_NUM_CHANS_V3
];

1008 } 
	g__∑cked
;

1035 
	siwl_sˇn_gíîÆ_∑øms_v11
 {

1036 
__À16
 
	mÊags
;

1037 
u8
 
	mª£rved
;

1038 
u8
 
	msˇn_°¨t_mac_‹_lök_id
;

1039 
u8
 
	ma˘ive_dwñl
[
SCAN_TWO_LMACS
];

1040 
u8
 
	madwñl_deÁu…_2g
;

1041 
u8
 
	madwñl_deÁu…_5g
;

1042 
u8
 
	madwñl_deÁu…_socül_chn
;

1043 
u8
 
	mÊags2
;

1044 
__À16
 
	madwñl_max_budgë
;

1045 
__À32
 
	mmax_out_of_time
[
SCAN_TWO_LMACS
];

1046 
__À32
 
	msu•íd_time
[
SCAN_TWO_LMACS
];

1047 
__À32
 
	msˇn_¥i‹ôy
;

1048 
u8
 
	m∑ssive_dwñl
[
SCAN_TWO_LMACS
];

1049 
u8
 
	mnum_of_‰agmíts
[
SCAN_TWO_LMACS
];

1050 } 
	g__∑cked
;

1058 
	siwl_sˇn_≥riodic_∑rms_v1
 {

1059 
iwl_sˇn_umac_scheduÀ
 
	mscheduÀ
[
IWL_MAX_SCHED_SCAN_PLANS
];

1060 
__À16
 
	mdñay
;

1061 
__À16
 
	mª£rved
;

1062 } 
	g__∑cked
;

1071 
	siwl_sˇn_ªq_∑øms_v12
 {

1072 
iwl_sˇn_gíîÆ_∑øms_v11
 
	mgíîÆ_∑øms
;

1073 
iwl_sˇn_ch™√l_∑øms_v4
 
	mch™√l_∑øms
;

1074 
iwl_sˇn_≥riodic_∑rms_v1
 
	m≥riodic_∑øms
;

1075 
iwl_sˇn_¥obe_∑øms_v3
 
	m¥obe_∑øms
;

1076 } 
	g__∑cked
;

1085 
	siwl_sˇn_ªq_∑øms_v17
 {

1086 
iwl_sˇn_gíîÆ_∑øms_v11
 
	mgíîÆ_∑øms
;

1087 
iwl_sˇn_ch™√l_∑øms_v7
 
	mch™√l_∑øms
;

1088 
iwl_sˇn_≥riodic_∑rms_v1
 
	m≥riodic_∑øms
;

1089 
iwl_sˇn_¥obe_∑øms_v4
 
	m¥obe_∑øms
;

1090 } 
	g__∑cked
;

1098 
	siwl_sˇn_ªq_umac_v12
 {

1099 
__À32
 
	muid
;

1100 
__À32
 
	mooc_¥i‹ôy
;

1101 
iwl_sˇn_ªq_∑øms_v12
 
	msˇn_∑øms
;

1102 } 
	g__∑cked
;

1110 
	siwl_sˇn_ªq_umac_v17
 {

1111 
__À32
 
	muid
;

1112 
__À32
 
	mooc_¥i‹ôy
;

1113 
iwl_sˇn_ªq_∑øms_v17
 
	msˇn_∑øms
;

1114 } 
	g__∑cked
;

1121 
	siwl_umac_sˇn_ab‹t
 {

1122 
__À32
 
	muid
;

1123 
__À32
 
	mÊags
;

1124 } 
	g__∑cked
;

1136 
	siwl_umac_sˇn_com∂ëe
 {

1137 
__À32
 
	muid
;

1138 
u8
 
	mœ°_scheduÀ
;

1139 
u8
 
	mœ°_ôî
;

1140 
u8
 
	m°©us
;

1141 
u8
 
	mebs_°©us
;

1142 
__À32
 
	mtime_‰om_œ°_ôî
;

1143 
__À32
 
	mª£rved
;

1144 } 
	g__∑cked
;

1146 
	#SCAN_OFFLOAD_MATCHING_CHANNELS_LEN_V1
 5

	)

1147 
	#SCAN_OFFLOAD_MATCHING_CHANNELS_LEN
 7

	)

1159 
	siwl_sˇn_ofÊﬂd_¥ofûe_m©ch_v1
 {

1160 
u8
 
	mbssid
[
ETH_ALEN
];

1161 
__À16
 
	mª£rved
;

1162 
u8
 
	mch™√l
;

1163 
u8
 
	míîgy
;

1164 
u8
 
	mm©chög_„©uª
;

1165 
u8
 
	mm©chög_ch™√ls
[
SCAN_OFFLOAD_MATCHING_CHANNELS_LEN_V1
];

1166 } 
	g__∑cked
;

1181 
	siwl_sˇn_ofÊﬂd_¥ofûes_quîy_v1
 {

1182 
__À32
 
	mm©ched_¥ofûes
;

1183 
__À32
 
	mœ°_sˇn_age
;

1184 
__À32
 
	mn_sˇns_d⁄e
;

1185 
__À32
 
	mgp2_d0u
;

1186 
__À32
 
	mgp2_övoked
;

1187 
u8
 
	mªsume_whûe_sˇ¬ög
;

1188 
u8
 
	m£lf_ªcovîy
;

1189 
__À16
 
	mª£rved
;

1190 
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch_v1
 
	mm©ches
[];

1191 } 
	g__∑cked
;

1203 
	siwl_sˇn_ofÊﬂd_¥ofûe_m©ch
 {

1204 
u8
 
	mbssid
[
ETH_ALEN
];

1205 
__À16
 
	mª£rved
;

1206 
u8
 
	mch™√l
;

1207 
u8
 
	míîgy
;

1208 
u8
 
	mm©chög_„©uª
;

1209 
u8
 
	mm©chög_ch™√ls
[
SCAN_OFFLOAD_MATCHING_CHANNELS_LEN
];

1210 } 
	g__∑cked
;

1225 
	siwl_sˇn_ofÊﬂd_m©ch_öfo
 {

1226 
__À32
 
	mm©ched_¥ofûes
;

1227 
__À32
 
	mœ°_sˇn_age
;

1228 
__À32
 
	mn_sˇns_d⁄e
;

1229 
__À32
 
	mgp2_d0u
;

1230 
__À32
 
	mgp2_övoked
;

1231 
u8
 
	mªsume_whûe_sˇ¬ög
;

1232 
u8
 
	m£lf_ªcovîy
;

1233 
__À16
 
	mª£rved
;

1234 
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch
 
	mm©ches
[];

1235 } 
	g__∑cked
;

1251 
	siwl_umac_sˇn_ôî_com∂ëe_nŸif
 {

1252 
__À32
 
	muid
;

1253 
u8
 
	msˇ¬ed_ch™√ls
;

1254 
u8
 
	m°©us
;

1255 
u8
 
	mbt_°©us
;

1256 
u8
 
	mœ°_ch™√l
;

1257 
__À64
 
	m°¨t_tsf
;

1258 
iwl_sˇn_ªsu…s_nŸif
 
	mªsu…s
[];

1259 } 
	g__∑cked
;

	@fw/api/sf.h

7 #i‚de‡
__iwl_fw_≠i_sf_h__


8 
	#__iwl_fw_≠i_sf_h__


	)

11 
	eiwl_sf_°©e
 {

12 
	mSF_LONG_DELAY_ON
 = 0,

13 
	mSF_FULL_ON
,

14 
	mSF_UNINIT
,

15 
	mSF_INIT_OFF
,

16 
	mSF_HW_NUM_STATES


20 
	eiwl_sf_s˚«rio
 {

21 
	mSF_SCENARIO_SINGLE_UNICAST
,

22 
	mSF_SCENARIO_AGG_UNICAST
,

23 
	mSF_SCENARIO_MULTICAST
,

24 
	mSF_SCENARIO_BA_RESP
,

25 
	mSF_SCENARIO_TX_RESP
,

26 
	mSF_NUM_SCENARIO


29 
	#SF_TRANSIENT_STATES_NUMBER
 2

	)

30 
	#SF_NUM_TIMEOUT_TYPES
 2

	)

33 
	#SF_W_MARK_SISO
 6144

	)

34 
	#SF_W_MARK_MIMO2
 8192

	)

35 
	#SF_W_MARK_MIMO3
 6144

	)

36 
	#SF_W_MARK_LEGACY
 4096

	)

37 
	#SF_W_MARK_SCAN
 4096

	)

40 
	#SF_SINGLE_UNICAST_IDLE_TIMER_DEF
 160

	)

41 
	#SF_SINGLE_UNICAST_AGING_TIMER_DEF
 400

	)

42 
	#SF_AGG_UNICAST_IDLE_TIMER_DEF
 160

	)

43 
	#SF_AGG_UNICAST_AGING_TIMER_DEF
 400

	)

44 
	#SF_MCAST_IDLE_TIMER_DEF
 160

	)

45 
	#SF_MCAST_AGING_TIMER_DEF
 400

	)

46 
	#SF_BA_IDLE_TIMER_DEF
 160

	)

47 
	#SF_BA_AGING_TIMER_DEF
 400

	)

48 
	#SF_TX_RE_IDLE_TIMER_DEF
 160

	)

49 
	#SF_TX_RE_AGING_TIMER_DEF
 400

	)

52 
	#SF_SINGLE_UNICAST_IDLE_TIMER
 320

	)

53 
	#SF_SINGLE_UNICAST_AGING_TIMER
 2016

	)

54 
	#SF_AGG_UNICAST_IDLE_TIMER
 320

	)

55 
	#SF_AGG_UNICAST_AGING_TIMER
 2016

	)

56 
	#SF_MCAST_IDLE_TIMER
 2016

	)

57 
	#SF_MCAST_AGING_TIMER
 10016

	)

58 
	#SF_BA_IDLE_TIMER
 320

	)

59 
	#SF_BA_AGING_TIMER
 2016

	)

60 
	#SF_TX_RE_IDLE_TIMER
 320

	)

61 
	#SF_TX_RE_AGING_TIMER
 2016

	)

63 
	#SF_LONG_DELAY_AGING_TIMER
 1000000

	)

65 
	#SF_CFG_DUMMY_NOTIF_OFF
 
	`BIT
(16)

	)

75 
	siwl_sf_cfg_cmd
 {

76 
__À32
 
	m°©e
;

77 
__À32
 
	mw©îm¨k
[
SF_TRANSIENT_STATES_NUMBER
];

78 
__À32
 
	ml⁄g_dñay_timeouts
[
SF_NUM_SCENARIO
][
SF_NUM_TIMEOUT_TYPES
];

79 
__À32
 
	mfuŒ_⁄_timeouts
[
SF_NUM_SCENARIO
][
SF_NUM_TIMEOUT_TYPES
];

80 } 
	g__∑cked
;

	@fw/api/sta.h

7 #i‚de‡
__iwl_fw_≠i_°a_h__


8 
	#__iwl_fw_≠i_°a_h__


	)

54 
	eiwl_°a_Êags
 {

55 
	mSTA_FLG_REDUCED_TX_PWR_CTRL
 = 
BIT
(3),

56 
	mSTA_FLG_REDUCED_TX_PWR_DATA
 = 
BIT
(6),

58 
	mSTA_FLG_DISABLE_TX
 = 
BIT
(4),

60 
	mSTA_FLG_PS
 = 
BIT
(8),

61 
	mSTA_FLG_DRAIN_FLOW
 = 
BIT
(12),

62 
	mSTA_FLG_PAN
 = 
BIT
(13),

63 
	mSTA_FLG_CLASS_AUTH
 = 
BIT
(14),

64 
	mSTA_FLG_CLASS_ASSOC
 = 
BIT
(15),

65 
	mSTA_FLG_RTS_MIMO_PROT
 = 
BIT
(17),

67 
	mSTA_FLG_MAX_AGG_SIZE_SHIFT
 = 19,

68 
	mSTA_FLG_MAX_AGG_SIZE_8K
 = (0 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

69 
	mSTA_FLG_MAX_AGG_SIZE_16K
 = (1 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

70 
	mSTA_FLG_MAX_AGG_SIZE_32K
 = (2 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

71 
	mSTA_FLG_MAX_AGG_SIZE_64K
 = (3 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

72 
	mSTA_FLG_MAX_AGG_SIZE_128K
 = (4 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

73 
	mSTA_FLG_MAX_AGG_SIZE_256K
 = (5 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

74 
	mSTA_FLG_MAX_AGG_SIZE_512K
 = (6 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

75 
	mSTA_FLG_MAX_AGG_SIZE_1024K
 = (7 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

76 
	mSTA_FLG_MAX_AGG_SIZE_2M
 = (8 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

77 
	mSTA_FLG_MAX_AGG_SIZE_4M
 = (9 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

78 
	mSTA_FLG_MAX_AGG_SIZE_MSK
 = (0x‡<< 
STA_FLG_MAX_AGG_SIZE_SHIFT
),

80 
	mSTA_FLG_AGG_MPDU_DENS_SHIFT
 = 23,

81 
	mSTA_FLG_AGG_MPDU_DENS_2US
 = (4 << 
STA_FLG_AGG_MPDU_DENS_SHIFT
),

82 
	mSTA_FLG_AGG_MPDU_DENS_4US
 = (5 << 
STA_FLG_AGG_MPDU_DENS_SHIFT
),

83 
	mSTA_FLG_AGG_MPDU_DENS_8US
 = (6 << 
STA_FLG_AGG_MPDU_DENS_SHIFT
),

84 
	mSTA_FLG_AGG_MPDU_DENS_16US
 = (7 << 
STA_FLG_AGG_MPDU_DENS_SHIFT
),

85 
	mSTA_FLG_AGG_MPDU_DENS_MSK
 = (7 << 
STA_FLG_AGG_MPDU_DENS_SHIFT
),

87 
	mSTA_FLG_FAT_EN_20MHZ
 = (0 << 26),

88 
	mSTA_FLG_FAT_EN_40MHZ
 = (1 << 26),

89 
	mSTA_FLG_FAT_EN_80MHZ
 = (2 << 26),

90 
	mSTA_FLG_FAT_EN_160MHZ
 = (3 << 26),

91 
	mSTA_FLG_FAT_EN_MSK
 = (3 << 26),

93 
	mSTA_FLG_MIMO_EN_SISO
 = (0 << 28),

94 
	mSTA_FLG_MIMO_EN_MIMO2
 = (1 << 28),

95 
	mSTA_FLG_MIMO_EN_MIMO3
 = (2 << 28),

96 
	mSTA_FLG_MIMO_EN_MSK
 = (3 << 28),

121 
	eiwl_°a_key_Êag
 {

122 
	mSTA_KEY_FLG_NO_ENC
 = (0 << 0),

123 
	mSTA_KEY_FLG_WEP
 = (1 << 0),

124 
	mSTA_KEY_FLG_CCM
 = (2 << 0),

125 
	mSTA_KEY_FLG_TKIP
 = (3 << 0),

126 
	mSTA_KEY_FLG_EXT
 = (4 << 0),

127 
	mSTA_KEY_FLG_GCMP
 = (5 << 0),

128 
	mSTA_KEY_FLG_CMAC
 = (6 << 0),

129 
	mSTA_KEY_FLG_ENC_UNKNOWN
 = (7 << 0),

130 
	mSTA_KEY_FLG_EN_MSK
 = (7 << 0),

132 
	mSTA_KEY_FLG_WEP_KEY_MAP
 = 
BIT
(3),

133 
	mSTA_KEY_FLG_AMSDU_SPP
 = 
BIT
(7),

134 
	mSTA_KEY_FLG_KEYID_POS
 = 8,

135 
	mSTA_KEY_FLG_KEYID_MSK
 = (3 << 
STA_KEY_FLG_KEYID_POS
),

136 
	mSTA_KEY_NOT_VALID
 = 
BIT
(11),

137 
	mSTA_KEY_FLG_WEP_13BYTES
 = 
BIT
(12),

138 
	mSTA_KEY_FLG_KEY_32BYTES
 = 
BIT
(12),

139 
	mSTA_KEY_MULTICAST
 = 
BIT
(14),

140 
	mSTA_KEY_MFP
 = 
BIT
(15),

154 
	eiwl_°a_modify_Êag
 {

155 
	mSTA_MODIFY_QUEUE_REMOVAL
 = 
BIT
(0),

156 
	mSTA_MODIFY_TID_DISABLE_TX
 = 
BIT
(1),

157 
	mSTA_MODIFY_UAPSD_ACS
 = 
BIT
(2),

158 
	mSTA_MODIFY_ADD_BA_TID
 = 
BIT
(3),

159 
	mSTA_MODIFY_REMOVE_BA_TID
 = 
BIT
(4),

160 
	mSTA_MODIFY_SLEEPING_STA_TX_COUNT
 = 
BIT
(5),

161 
	mSTA_MODIFY_PROT_TH
 = 
BIT
(6),

162 
	mSTA_MODIFY_QUEUES
 = 
BIT
(7),

170 
	eiwl_°a_mode
 {

171 
	mSTA_MODE_ADD
 = 0,

172 
	mSTA_MODE_MODIFY
 = 1,

183 
	eiwl_°a_¶ìp_Êag
 {

184 
	mSTA_SLEEP_STATE_AWAKE
 = 0,

185 
	mSTA_SLEEP_STATE_PS_POLL
 = 
BIT
(0),

186 
	mSTA_SLEEP_STATE_UAPSD
 = 
BIT
(1),

187 
	mSTA_SLEEP_STATE_MOREDATA
 = 
BIT
(2),

190 
	#STA_KEY_MAX_NUM
 (16)

	)

191 
	#STA_KEY_IDX_INVALID
 (0xff)

	)

192 
	#STA_KEY_MAX_DATA_KEY_NUM
 (4)

	)

193 
	#IWL_MAX_GLOBAL_KEYS
 (4)

	)

194 
	#STA_KEY_LEN_WEP40
 (5)

	)

195 
	#STA_KEY_LEN_WEP104
 (13)

	)

197 
	#IWL_ADD_STA_STATUS_MASK
 0xFF

	)

198 
	#IWL_ADD_STA_BAID_VALID_MASK
 0x8000

	)

199 
	#IWL_ADD_STA_BAID_MASK
 0x7F00

	)

200 
	#IWL_ADD_STA_BAID_SHIFT
 8

	)

242 
	siwl_mvm_add_°a_cmd_v7
 {

243 
u8
 
	madd_modify
;

244 
u8
 
	mawake_acs
;

245 
__À16
 
	mtid_dißbÀ_tx
;

246 
__À32
 
	mmac_id_n_cﬁ‹
;

247 
u8
 
	maddr
[
ETH_ALEN
];

248 
__À16
 
	mª£rved2
;

249 
u8
 
	m°a_id
;

250 
u8
 
	mmodify_mask
;

251 
__À16
 
	mª£rved3
;

252 
__À32
 
	m°©i⁄_Êags
;

253 
__À32
 
	m°©i⁄_Êags_msk
;

254 
u8
 
	madd_immedüã_ba_tid
;

255 
u8
 
	mªmove_immedüã_ba_tid
;

256 
__À16
 
	madd_immedüã_ba_s¢
;

257 
__À16
 
	m¶ìp_tx_cou¡
;

258 
__À16
 
	m¶ìp_°©e_Êags
;

259 
__À16
 
	massoc_id
;

260 
__À16
 
	mbómf‹m_Êags
;

261 
__À32
 
	mtfd_queue_msk
;

262 } 
	g__∑cked
;

274 
	eiwl_°a_ty≥
 {

275 
	mIWL_STA_LINK
,

276 
	mIWL_STA_GENERAL_PURPOSE
,

277 
	mIWL_STA_MULTICAST
,

278 
	mIWL_STA_TDLS_LINK
,

279 
	mIWL_STA_AUX_ACTIVITY
,

328 
	siwl_mvm_add_°a_cmd
 {

329 
u8
 
	madd_modify
;

330 
u8
 
	mawake_acs
;

331 
__À16
 
	mtid_dißbÀ_tx
;

332 
__À32
 
	mmac_id_n_cﬁ‹
;

333 
u8
 
	maddr
[
ETH_ALEN
];

334 
__À16
 
	mª£rved2
;

335 
u8
 
	m°a_id
;

336 
u8
 
	mmodify_mask
;

337 
__À16
 
	mª£rved3
;

338 
__À32
 
	m°©i⁄_Êags
;

339 
__À32
 
	m°©i⁄_Êags_msk
;

340 
u8
 
	madd_immedüã_ba_tid
;

341 
u8
 
	mªmove_immedüã_ba_tid
;

342 
__À16
 
	madd_immedüã_ba_s¢
;

343 
__À16
 
	m¶ìp_tx_cou¡
;

344 
u8
 
	m¶ìp_°©e_Êags
;

345 
u8
 
	m°©i⁄_ty≥
;

346 
__À16
 
	massoc_id
;

347 
__À16
 
	mbómf‹m_Êags
;

348 
__À32
 
	mtfd_queue_msk
;

349 
__À16
 
	mrx_ba_wödow
;

350 
u8
 
	m•_Àngth
;

351 
u8
 
	mu≠sd_acs
;

352 } 
	g__∑cked
;

363 
	siwl_mvm_add_°a_key_comm⁄
 {

364 
u8
 
	m°a_id
;

365 
u8
 
	mkey_off£t
;

366 
__À16
 
	mkey_Êags
;

367 
u8
 
	mkey
[32];

368 
u8
 
	mrx_£cur_£q_˙t
[16];

369 } 
	g__∑cked
;

378 
	siwl_mvm_add_°a_key_cmd_v1
 {

379 
iwl_mvm_add_°a_key_comm⁄
 
	mcomm⁄
;

380 
u8
 
	mtkù_rx_tsc_byã2
;

381 
u8
 
	mª£rved
;

382 
__À16
 
	mtkù_rx_âak
[5];

383 } 
	g__∑cked
;

396 
	siwl_mvm_add_°a_key_cmd
 {

397 
iwl_mvm_add_°a_key_comm⁄
 
	mcomm⁄
;

398 
__À64
 
	mrx_mic_key
;

399 
__À64
 
	mtx_mic_key
;

400 
__À64
 
	må™smô_£q_˙t
;

401 } 
	g__∑cked
;

411 
	eiwl_mvm_add_°a_r•_°©us
 {

412 
	mADD_STA_SUCCESS
 = 0x1,

413 
	mADD_STA_STATIONS_OVERLOAD
 = 0x2,

414 
	mADD_STA_IMMEDIATE_BA_FAILURE
 = 0x4,

415 
	mADD_STA_MODIFY_NON_EXISTING_STA
 = 0x8,

424 
	siwl_mvm_rm_°a_cmd
 {

425 
u8
 
	m°a_id
;

426 
u8
 
	mª£rved
[3];

427 } 
	g__∑cked
;

440 
	siwl_mvm_mgmt_mˇ°_key_cmd_v1
 {

441 
__À32
 
	m˘æ_Êags
;

442 
u8
 
	migtk
[16];

443 
u8
 
	mk1
[16];

444 
u8
 
	mk2
[16];

445 
__À32
 
	mkey_id
;

446 
__À32
 
	m°a_id
;

447 
__À64
 
	mª˚ive_£q_˙t
;

448 } 
	g__∑cked
;

459 
	siwl_mvm_mgmt_mˇ°_key_cmd
 {

460 
__À32
 
	m˘æ_Êags
;

461 
u8
 
	migtk
[32];

462 
__À32
 
	mkey_id
;

463 
__À32
 
	m°a_id
;

464 
__À64
 
	mª˚ive_£q_˙t
;

465 } 
	g__∑cked
;

467 
	siwl_mvm_wï_key
 {

468 
u8
 
	mkey_ödex
;

469 
u8
 
	mkey_off£t
;

470 
__À16
 
	mª£rved1
;

471 
u8
 
	mkey_size
;

472 
u8
 
	mª£rved2
[3];

473 
u8
 
	mkey
[16];

474 } 
	g__∑cked
;

476 
	siwl_mvm_wï_key_cmd
 {

477 
__À32
 
	mmac_id_n_cﬁ‹
;

478 
u8
 
	mnum_keys
;

479 
u8
 
	mde¸y±i⁄_ty≥
;

480 
u8
 
	mÊags
;

481 
u8
 
	mª£rved
;

482 
iwl_mvm_wï_key
 
	mwï_key
[];

483 } 
	g__∑cked
;

491 
	siwl_mvm_eo•_nŸifiˇti⁄
 {

492 
__À32
 
	mªmaö_‰ame_cou¡
;

493 
__À32
 
	m°a_id
;

494 } 
	g__∑cked
;

	@fw/api/stats.h

7 #i‚de‡
__iwl_fw_≠i_°©s_h__


8 
	#__iwl_fw_≠i_°©s_h__


	)

9 
	~"mac.h
"

10 
	~"mac-cfg.h
"

12 
	smvm_°©i°ics_dbg
 {

13 
__À32
 
	mbur°_check
;

14 
__À32
 
	mbur°_cou¡
;

15 
__À32
 
	mwaô_f‹_sûí˚_timeout_˙t
;

16 
u8
 
	mª£rved
[12];

17 } 
	g__∑cked
;

19 
	smvm_°©i°ics_div
 {

20 
__À32
 
	mtx_⁄_a
;

21 
__À32
 
	mtx_⁄_b
;

22 
__À32
 
	mexec_time
;

23 
__À32
 
	m¥obe_time
;

24 
__À32
 
	mrssi_™t
;

25 
__À32
 
	mª£rved2
;

26 } 
	g__∑cked
;

53 
	smvm_°©i°ics_rx_n⁄_phy
 {

54 
__À32
 
	mbogus_˘s
;

55 
__À32
 
	mbogus_ack
;

56 
__À32
 
	mn⁄_ch™√l_bóc⁄s
;

57 
__À32
 
	mch™√l_bóc⁄s
;

58 
__À32
 
	mnum_mis£d_bc⁄
;

59 
__À32
 
	madc_rx_ßtuøti⁄_time
;

60 
__À32
 
	möa_dëe˘i⁄_£¨ch_time
;

61 
__À32
 
	mbóc⁄_sûí˚_rssi_a
;

62 
__À32
 
	mbóc⁄_sûí˚_rssi_b
;

63 
__À32
 
	mbóc⁄_sûí˚_rssi_c
;

64 
__À32
 
	möãr„ªn˚_d©a_Êag
;

65 
__À32
 
	mch™√l_lﬂd
;

66 
__À32
 
	mbóc⁄_rssi_a
;

67 
__À32
 
	mbóc⁄_rssi_b
;

68 
__À32
 
	mbóc⁄_rssi_c
;

69 
__À32
 
	mbóc⁄_íîgy_a
;

70 
__À32
 
	mbóc⁄_íîgy_b
;

71 
__À32
 
	mbóc⁄_íîgy_c
;

72 
__À32
 
	mnum_bt_kûls
;

73 
__À32
 
	mmac_id
;

74 } 
	g__∑cked
;

76 
	smvm_°©i°ics_rx_n⁄_phy_v3
 {

77 
__À32
 
	mbogus_˘s
;

78 
__À32
 
	mbogus_ack
;

79 
__À32
 
	mn⁄_bssid_‰ames
;

81 
__À32
 
	mfûãªd_‰ames
;

83 
__À32
 
	mn⁄_ch™√l_bóc⁄s
;

85 
__À32
 
	mch™√l_bóc⁄s
;

87 
__À32
 
	mnum_mis£d_bc⁄
;

88 
__À32
 
	madc_rx_ßtuøti⁄_time
;

90 
__À32
 
	möa_dëe˘i⁄_£¨ch_time
;

92 
__À32
 
	mbóc⁄_sûí˚_rssi_a
;

93 
__À32
 
	mbóc⁄_sûí˚_rssi_b
;

94 
__À32
 
	mbóc⁄_sûí˚_rssi_c
;

95 
__À32
 
	möãr„ªn˚_d©a_Êag
;

98 
__À32
 
	mch™√l_lﬂd
;

99 
__À32
 
	md•_Ál£_Æ¨ms
;

101 
__À32
 
	mbóc⁄_rssi_a
;

102 
__À32
 
	mbóc⁄_rssi_b
;

103 
__À32
 
	mbóc⁄_rssi_c
;

104 
__À32
 
	mbóc⁄_íîgy_a
;

105 
__À32
 
	mbóc⁄_íîgy_b
;

106 
__À32
 
	mbóc⁄_íîgy_c
;

107 
__À32
 
	mnum_bt_kûls
;

108 
__À32
 
	mmac_id
;

109 
__À32
 
	mdúe˘ed_d©a_mpdu
;

110 } 
	g__∑cked
;

112 
	smvm_°©i°ics_rx_phy
 {

113 
__À32
 
	muƒe•⁄ded_πs
;

114 
__À32
 
	mrxe_‰ame_lmt_ovîrun
;

115 
__À32
 
	m£¡_ba_r•_˙t
;

116 
__À32
 
	md•_£lf_kûl
;

117 
__À32
 
	mª£rved
;

118 } 
	g__∑cked
;

120 
	smvm_°©i°ics_rx_phy_v2
 {

121 
__À32
 
	möa_˙t
;

122 
__À32
 
	mföa_˙t
;

123 
__À32
 
	m∂˝_îr
;

124 
__À32
 
	m¸c32_îr
;

125 
__À32
 
	movîrun_îr
;

126 
__À32
 
	móæy_ovîrun_îr
;

127 
__À32
 
	m¸c32_good
;

128 
__À32
 
	mÁl£_Æ¨m_˙t
;

129 
__À32
 
	mföa_sync_îr_˙t
;

130 
__À32
 
	msfd_timeout
;

131 
__À32
 
	mföa_timeout
;

132 
__À32
 
	muƒe•⁄ded_πs
;

133 
__À32
 
	mrxe_‰ame_lmt_ovîrun
;

134 
__À32
 
	m£¡_ack_˙t
;

135 
__À32
 
	m£¡_˘s_˙t
;

136 
__À32
 
	m£¡_ba_r•_˙t
;

137 
__À32
 
	md•_£lf_kûl
;

138 
__À32
 
	mmh_f‹m©_îr
;

139 
__À32
 
	mª_acq_maö_rssi_sum
;

140 
__À32
 
	mª£rved
;

141 } 
	g__∑cked
;

143 
	smvm_°©i°ics_rx_ht_phy_v1
 {

144 
__À32
 
	m∂˝_îr
;

145 
__À32
 
	movîrun_îr
;

146 
__À32
 
	móæy_ovîrun_îr
;

147 
__À32
 
	m¸c32_good
;

148 
__À32
 
	m¸c32_îr
;

149 
__À32
 
	mmh_f‹m©_îr
;

150 
__À32
 
	magg_¸c32_good
;

151 
__À32
 
	magg_mpdu_˙t
;

152 
__À32
 
	magg_˙t
;

153 
__À32
 
	munsuµ‹t_mcs
;

154 } 
	g__∑cked
;

156 
	smvm_°©i°ics_rx_ht_phy
 {

157 
__À32
 
	mmh_f‹m©_îr
;

158 
__À32
 
	magg_mpdu_˙t
;

159 
__À32
 
	magg_˙t
;

160 
__À32
 
	munsuµ‹t_mcs
;

161 } 
	g__∑cked
;

163 
	smvm_°©i°ics_tx_n⁄_phy_v3
 {

164 
__À32
 
	m¥ómbÀ_˙t
;

165 
__À32
 
	mrx_dëe˘ed_˙t
;

166 
__À32
 
	mbt_¥io_de„r_˙t
;

167 
__À32
 
	mbt_¥io_kûl_˙t
;

168 
__À32
 
	m„w_byãs_˙t
;

169 
__À32
 
	m˘s_timeout
;

170 
__À32
 
	mack_timeout
;

171 
__À32
 
	mex≥˘ed_ack_˙t
;

172 
__À32
 
	ma˘uÆ_ack_˙t
;

173 
__À32
 
	mdump_msdu_˙t
;

174 
__À32
 
	mbur°_ab‹t_√xt_‰ame_mism©ch_˙t
;

175 
__À32
 
	mbur°_ab‹t_missög_√xt_‰ame_˙t
;

176 
__À32
 
	m˘s_timeout_cﬁlisi⁄
;

177 
__À32
 
	mack_‹_ba_timeout_cﬁlisi⁄
;

178 } 
	g__∑cked
;

180 
	smvm_°©i°ics_tx_n⁄_phy
 {

181 
__À32
 
	mbt_¥io_de„r_˙t
;

182 
__À32
 
	mbt_¥io_kûl_˙t
;

183 
__À32
 
	m„w_byãs_˙t
;

184 
__À32
 
	m˘s_timeout
;

185 
__À32
 
	mack_timeout
;

186 
__À32
 
	mdump_msdu_˙t
;

187 
__À32
 
	mbur°_ab‹t_√xt_‰ame_mism©ch_˙t
;

188 
__À32
 
	mbur°_ab‹t_missög_√xt_‰ame_˙t
;

189 
__À32
 
	m˘s_timeout_cﬁlisi⁄
;

190 
__À32
 
	mack_‹_ba_timeout_cﬁlisi⁄
;

191 } 
	g__∑cked
;

193 
	#MAX_CHAINS
 3

	)

195 
	smvm_°©i°ics_tx_n⁄_phy_agg
 {

196 
__À32
 
	mba_timeout
;

197 
__À32
 
	mba_ªscheduÀ_‰ames
;

198 
__À32
 
	mscd_quîy_agg_‰ame_˙t
;

199 
__À32
 
	mscd_quîy_no_agg
;

200 
__À32
 
	mscd_quîy_agg
;

201 
__À32
 
	mscd_quîy_mism©ch
;

202 
__À32
 
	m‰ame_nŸ_ªady
;

203 
__À32
 
	mundîrun
;

204 
__À32
 
	mbt_¥io_kûl
;

205 
__À32
 
	mrx_ba_r•_˙t
;

206 
__s8
 
	mtxpowî
[
MAX_CHAINS
];

207 
__s8
 
	mª£rved
;

208 
__À32
 
	mª£rved2
;

209 } 
	g__∑cked
;

211 
	smvm_°©i°ics_tx_ch™√l_width
 {

212 
__À32
 
	mext_cˇ_«ºow_ch20
[1];

213 
__À32
 
	mext_cˇ_«ºow_ch40
[2];

214 
__À32
 
	mext_cˇ_«ºow_ch80
[3];

215 
__À32
 
	mext_cˇ_«ºow_ch160
[4];

216 
__À32
 
	mœ°_tx_ch_width_ödx
;

217 
__À32
 
	mrx_dëe˘ed_≥r_ch_width
[4];

218 
__À32
 
	msuc˚ss_≥r_ch_width
[4];

219 
__À32
 
	mÁû_≥r_ch_width
[4];

222 
	smvm_°©i°ics_tx_v4
 {

223 
mvm_°©i°ics_tx_n⁄_phy_v3
 
	mgíîÆ
;

224 
mvm_°©i°ics_tx_n⁄_phy_agg
 
	magg
;

225 
mvm_°©i°ics_tx_ch™√l_width
 
	mch™√l_width
;

226 } 
	g__∑cked
;

228 
	smvm_°©i°ics_tx
 {

229 
mvm_°©i°ics_tx_n⁄_phy
 
	mgíîÆ
;

230 
mvm_°©i°ics_tx_n⁄_phy_agg
 
	magg
;

231 
mvm_°©i°ics_tx_ch™√l_width
 
	mch™√l_width
;

232 } 
	g__∑cked
;

235 
	smvm_°©i°ics_bt_a˘ivôy
 {

236 
__À32
 
	mhi_¥i‹ôy_tx_ªq_˙t
;

237 
__À32
 
	mhi_¥i‹ôy_tx_díõd_˙t
;

238 
__À32
 
	mlo_¥i‹ôy_tx_ªq_˙t
;

239 
__À32
 
	mlo_¥i‹ôy_tx_díõd_˙t
;

240 
__À32
 
	mhi_¥i‹ôy_rx_ªq_˙t
;

241 
__À32
 
	mhi_¥i‹ôy_rx_díõd_˙t
;

242 
__À32
 
	mlo_¥i‹ôy_rx_ªq_˙t
;

243 
__À32
 
	mlo_¥i‹ôy_rx_díõd_˙t
;

244 } 
	g__∑cked
;

246 
	smvm_°©i°ics_gíîÆ_comm⁄_v19
 {

247 
__À32
 
	mødio_ãm≥øtuª
;

248 
__À32
 
	mødio_vﬁège
;

249 
mvm_°©i°ics_dbg
 
	mdbg
;

250 
__À32
 
	m¶ìp_time
;

251 
__À32
 
	m¶Ÿs_out
;

252 
__À32
 
	m¶Ÿs_idÀ
;

253 
__À32
 
	mâl_time°amp
;

254 
mvm_°©i°ics_div
 
	m¶ow_div
;

255 
__À32
 
	mrx_íabÀ_cou¡î
;

261 
__À32
 
	mnum_of_sos_°©es
;

262 
__À32
 
	mbóc⁄_fûãªd
;

263 
__À32
 
	mmis£d_bóc⁄s
;

264 
u8
 
	mbóc⁄_fûãr_avîage_íîgy
;

265 
u8
 
	mbóc⁄_fûãr_ªas⁄
;

266 
u8
 
	mbóc⁄_fûãr_cuºít_íîgy
;

267 
u8
 
	mbóc⁄_fûãr_ª£rved
;

268 
__À32
 
	mbóc⁄_fûãr_dñè_time
;

269 
mvm_°©i°ics_bt_a˘ivôy
 
	mbt_a˘ivôy
;

270 
__À64
 
	mrx_time
;

271 
__À64
 
	m⁄_time_rf
;

272 
__À64
 
	m⁄_time_sˇn
;

273 
__À64
 
	mtx_time
;

274 } 
	g__∑cked
;

276 
	smvm_°©i°ics_gíîÆ_comm⁄
 {

277 
__À32
 
	mødio_ãm≥øtuª
;

278 
mvm_°©i°ics_dbg
 
	mdbg
;

279 
__À32
 
	m¶ìp_time
;

280 
__À32
 
	m¶Ÿs_out
;

281 
__À32
 
	m¶Ÿs_idÀ
;

282 
__À32
 
	mâl_time°amp
;

283 
mvm_°©i°ics_div
 
	m¶ow_div
;

284 
__À32
 
	mrx_íabÀ_cou¡î
;

290 
__À32
 
	mnum_of_sos_°©es
;

291 
__À32
 
	mbóc⁄_fûãªd
;

292 
__À32
 
	mmis£d_bóc⁄s
;

293 
u8
 
	mbóc⁄_fûãr_avîage_íîgy
;

294 
u8
 
	mbóc⁄_fûãr_ªas⁄
;

295 
u8
 
	mbóc⁄_fûãr_cuºít_íîgy
;

296 
u8
 
	mbóc⁄_fûãr_ª£rved
;

297 
__À32
 
	mbóc⁄_fûãr_dñè_time
;

298 
mvm_°©i°ics_bt_a˘ivôy
 
	mbt_a˘ivôy
;

299 
__À64
 
	mrx_time
;

300 
__À64
 
	m⁄_time_rf
;

301 
__À64
 
	m⁄_time_sˇn
;

302 
__À64
 
	mtx_time
;

303 } 
	g__∑cked
;

305 
	smvm_°©i°ics_gíîÆ_v8
 {

306 
mvm_°©i°ics_gíîÆ_comm⁄_v19
 
	mcomm⁄
;

307 
__À32
 
	mbóc⁄_cou¡î
[
NUM_MAC_INDEX
];

308 
u8
 
	mbóc⁄_avîage_íîgy
[
NUM_MAC_INDEX
];

309 
u8
 
	mª£rved
[4 - (
NUM_MAC_INDEX
 % 4)];

310 } 
	g__∑cked
;

312 
	smvm_°©i°ics_gíîÆ
 {

313 
mvm_°©i°ics_gíîÆ_comm⁄
 
	mcomm⁄
;

314 
__À32
 
	mbóc⁄_cou¡î
[
MAC_INDEX_AUX
];

315 
u8
 
	mbóc⁄_avîage_íîgy
[
MAC_INDEX_AUX
];

316 
u8
 
	mª£rved
[8 - 
MAC_INDEX_AUX
];

317 } 
	g__∑cked
;

326 
	smvm_°©i°ics_lﬂd
 {

327 
__À32
 
	maú_time
[
MAC_INDEX_AUX
];

328 
__À32
 
	mbyã_cou¡
[
MAC_INDEX_AUX
];

329 
__À32
 
	mpkt_cou¡
[
MAC_INDEX_AUX
];

330 
u8
 
	mavg_íîgy
[
IWL_MVM_STATION_COUNT_MAX
];

331 } 
	g__∑cked
;

333 
	smvm_°©i°ics_lﬂd_v1
 {

334 
__À32
 
	maú_time
[
NUM_MAC_INDEX
];

335 
__À32
 
	mbyã_cou¡
[
NUM_MAC_INDEX
];

336 
__À32
 
	mpkt_cou¡
[
NUM_MAC_INDEX
];

337 
u8
 
	mavg_íîgy
[
IWL_MVM_STATION_COUNT_MAX
];

338 } 
	g__∑cked
;

340 
	smvm_°©i°ics_rx
 {

341 
mvm_°©i°ics_rx_phy
 
	mofdm
;

342 
mvm_°©i°ics_rx_phy
 
	mcck
;

343 
mvm_°©i°ics_rx_n⁄_phy
 
	mgíîÆ
;

344 
mvm_°©i°ics_rx_ht_phy
 
	mofdm_ht
;

345 } 
	g__∑cked
;

347 
	smvm_°©i°ics_rx_v3
 {

348 
mvm_°©i°ics_rx_phy_v2
 
	mofdm
;

349 
mvm_°©i°ics_rx_phy_v2
 
	mcck
;

350 
mvm_°©i°ics_rx_n⁄_phy_v3
 
	mgíîÆ
;

351 
mvm_°©i°ics_rx_ht_phy_v1
 
	mofdm_ht
;

352 } 
	g__∑cked
;

362 
	siwl_nŸif_°©i°ics_v10
 {

363 
__À32
 
	mÊag
;

364 
mvm_°©i°ics_rx_v3
 
	mrx
;

365 
mvm_°©i°ics_tx_v4
 
	mtx
;

366 
mvm_°©i°ics_gíîÆ_v8
 
	mgíîÆ
;

367 } 
	g__∑cked
;

369 
	siwl_nŸif_°©i°ics_v11
 {

370 
__À32
 
	mÊag
;

371 
mvm_°©i°ics_rx_v3
 
	mrx
;

372 
mvm_°©i°ics_tx_v4
 
	mtx
;

373 
mvm_°©i°ics_gíîÆ_v8
 
	mgíîÆ
;

374 
mvm_°©i°ics_lﬂd_v1
 
	mlﬂd_°©s
;

375 } 
	g__∑cked
;

377 
	siwl_nŸif_°©i°ics
 {

378 
__À32
 
	mÊag
;

379 
mvm_°©i°ics_rx
 
	mrx
;

380 
mvm_°©i°ics_tx
 
	mtx
;

381 
mvm_°©i°ics_gíîÆ
 
	mgíîÆ
;

382 
mvm_°©i°ics_lﬂd
 
	mlﬂd_°©s
;

383 } 
	g__∑cked
;

389 
	eiwl_°©i°ics_nŸif_Êags
 {

390 
	mIWL_STATISTICS_REPLY_FLG_CLEAR
 = 0x1,

400 
	eiwl_°©i°ics_cmd_Êags
 {

401 
	mIWL_STATISTICS_FLG_CLEAR
 = 0x1,

402 
	mIWL_STATISTICS_FLG_DISABLE_NOTIF
 = 0x2,

409 
	siwl_°©i°ics_cmd
 {

410 
__À32
 
	mÊags
;

411 } 
	g__∑cked
;

413 
	#MAX_BCAST_FILTER_NUM
 8

	)

424 
	eiwl_°©i°ics_nŸify_ty≥_id
 {

425 
	mIWL_STATS_NTFY_TYPE_ID_OPER
 = 
BIT
(0),

426 
	mIWL_STATS_NTFY_TYPE_ID_OPER_PART1
 = 
BIT
(1),

427 
	mIWL_STATS_NTFY_TYPE_ID_OPER_PART2
 = 
BIT
(2),

428 
	mIWL_STATS_NTFY_TYPE_ID_OPER_PART3
 = 
BIT
(3),

429 
	mIWL_STATS_NTFY_TYPE_ID_OPER_PART4
 = 
BIT
(4),

440 
	eiwl_°©i°ics_cfg_Êags
 {

441 
	mIWL_STATS_CFG_FLG_DISABLE_NTFY_MSK
 = 
BIT
(0),

442 
	mIWL_STATS_CFG_FLG_ON_DEMAND_NTFY_MSK
 = 
BIT
(1),

443 
	mIWL_STATS_CFG_FLG_RESET_MSK
 = 
BIT
(2),

452 
	siwl_sy°em_°©i°ics_cmd
 {

453 
__À32
 
	mcfg_mask
;

454 
__À32
 
	mc⁄fig_time_£c
;

455 
__À32
 
	mty≥_id_mask
;

456 } 
	g__∑cked
;

469 
	eiwl_fw_°©i°ics_ty≥
 {

470 
	mFW_STATISTICS_OPERATIONAL
,

471 
	mFW_STATISTICS_PHY
,

472 
	mFW_STATISTICS_MAC
,

473 
	mFW_STATISTICS_RX
,

474 
	mFW_STATISTICS_TX
,

475 
	mFW_STATISTICS_DURATION
,

476 
	mFW_STATISTICS_HE
,

479 
	#IWL_STATISTICS_TYPE_MSK
 0x7f

	)

487 
	siwl_°©i°ics_¡fy_hdr
 {

488 
u8
 
	mty≥
;

489 
u8
 
	mvîsi⁄
;

490 
__À16
 
	msize
;

506 
	siwl_°©s_¡fy_≥r_lök
 {

507 
__À32
 
	mbóc⁄_fûãr_avîage_íîgy
;

508 
__À32
 
	maú_time
;

509 
__À32
 
	mbóc⁄_cou¡î
;

510 
__À32
 
	mbóc⁄_avîage_íîgy
;

511 
__À32
 
	mbóc⁄_rssi_a
;

512 
__À32
 
	mbóc⁄_rssi_b
;

513 
__À32
 
	mrx_byãs
;

514 } 
	g__∑cked
;

526 
	siwl_°©s_¡fy_∑π1_≥r_lök
 {

527 
__À64
 
	mrx_time
;

528 
__À64
 
	mtx_time
;

529 
__À32
 
	mrx_a˘i⁄
;

530 
__À32
 
	mtx_a˘i⁄
;

531 
__À32
 
	mcˇ_de„rs
;

532 
__À32
 
	mbóc⁄_fûãªd
;

533 } 
	g__∑cked
;

548 
	siwl_°©s_¡fy_≥r_mac
 {

549 
__À32
 
	mbóc⁄_fûãr_avîage_íîgy
;

550 
__À32
 
	maú_time
;

551 
__À32
 
	mbóc⁄_cou¡î
;

552 
__À32
 
	mbóc⁄_avîage_íîgy
;

553 
__À32
 
	mbóc⁄_rssi_a
;

554 
__À32
 
	mbóc⁄_rssi_b
;

555 
__À32
 
	mrx_byãs
;

556 } 
	g__∑cked
;

558 
	#IWL_STATS_MAX_BW_INDEX
 5

	)

574 
	siwl_°©s_¡fy_≥r_phy
 {

575 
__À32
 
	mch™√l_lﬂd
;

576 
__À32
 
	mch™√l_lﬂd_by_us
;

577 
__À32
 
	mch™√l_lﬂd_nŸ_by_us
;

578 
__À32
 
	m˛t
;

579 
__À32
 
	ma˘
;

580 
__À32
 
	mñp
;

581 
__À32
 
	mrx_dëe˘ed_≥r_ch_width
[
IWL_STATS_MAX_BW_INDEX
];

582 
__À32
 
	msuc˚ss_≥r_ch_width
[
IWL_STATS_MAX_BW_INDEX
];

583 
__À32
 
	mÁû_≥r_ch_width
[
IWL_STATS_MAX_BW_INDEX
];

584 
__À32
 
	mœ°_tx_ch_width_ödx
;

585 } 
	g__∑cked
;

592 
	siwl_°©s_¡fy_≥r_°a
 {

593 
__À32
 
	mavîage_íîgy
;

594 } 
	g__∑cked
;

596 
	#IWL_STATS_MAX_PHY_OPERATIONAL
 3

	)

597 
	#IWL_STATS_MAX_FW_LINKS
 (
IWL_MVM_FW_MAX_LINK_ID
 + 1)

	)

607 
	siwl_sy°em_°©i°ics_nŸif_›î
 {

608 
__À32
 
	mtime_°amp
;

609 
iwl_°©s_¡fy_≥r_lök
 
	m≥r_lök
[
IWL_STATS_MAX_FW_LINKS
];

610 
iwl_°©s_¡fy_≥r_phy
 
	m≥r_phy
[
IWL_STATS_MAX_PHY_OPERATIONAL
];

611 
iwl_°©s_¡fy_≥r_°a
 
	m≥r_°a
[
IWL_MVM_STATION_COUNT_MAX
];

612 } 
	g__∑cked
;

621 
	siwl_sy°em_°©i°ics_∑π1_nŸif_›î
 {

622 
__À32
 
	mtime_°amp
;

623 
iwl_°©s_¡fy_∑π1_≥r_lök
 
	m≥r_lök
[
IWL_STATS_MAX_FW_LINKS
];

624 
__À32
 
	m≥r_phy_¸c_îr‹_°©s
[
IWL_STATS_MAX_PHY_OPERATIONAL
];

625 } 
	g__∑cked
;

632 
	siwl_sy°em_°©i°ics_íd_nŸif
 {

633 
__À32
 
	mtime_°amp
;

634 } 
	g__∑cked
;

649 
	siwl_°©i°ics_›î©i⁄Æ_¡fy
 {

650 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

651 
__À32
 
	mÊags
;

652 
iwl_°©s_¡fy_≥r_mac
 
	m≥r_mac
[
MAC_INDEX_AUX
];

653 
iwl_°©s_¡fy_≥r_phy
 
	m≥r_phy
[
IWL_STATS_MAX_PHY_OPERATIONAL
];

654 
iwl_°©s_¡fy_≥r_°a
 
	m≥r_°a
[
IWL_MVM_STATION_COUNT_MAX
];

655 
__À64
 
	mrx_time
;

656 
__À64
 
	mtx_time
;

657 
__À64
 
	m⁄_time_rf
;

658 
__À64
 
	m⁄_time_sˇn
;

659 } 
	g__∑cked
;

685 
	siwl_°©i°ics_›î©i⁄Æ_¡fy_vî_14
 {

686 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

687 
__À32
 
	mÊags
;

688 
__À32
 
	mmac_id
;

689 
__À32
 
	mbóc⁄_fûãr_avîage_íîgy
;

690 
__À32
 
	mbóc⁄_fûãr_ªas⁄
;

691 
__À32
 
	mødio_ãm≥øtuª
;

692 
__À32
 
	maú_time
[
MAC_INDEX_AUX
];

693 
__À32
 
	mbóc⁄_cou¡î
[
MAC_INDEX_AUX
];

694 
__À32
 
	mbóc⁄_avîage_íîgy
[
MAC_INDEX_AUX
];

695 
__À32
 
	mbóc⁄_rssi_a
;

696 
__À32
 
	mbóc⁄_rssi_b
;

697 
__À32
 
	mrx_byãs
[
MAC_INDEX_AUX
];

698 
__À64
 
	mrx_time
;

699 
__À64
 
	mtx_time
;

700 
__À64
 
	m⁄_time_rf
;

701 
__À64
 
	m⁄_time_sˇn
;

702 
__À32
 
	mavîage_íîgy
[
IWL_MVM_STATION_COUNT_MAX
];

703 
__À32
 
	mª£rved
;

704 } 
	g__∑cked
;

767 
	siwl_°©i°ics_phy_¡fy
 {

768 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

769 
__À32
 
	míîgy_™d_c⁄fig
;

770 
__À32
 
	mrssi_b™d
;

771 
__À32
 
	magc_w‹d
;

772 
__À32
 
	magc_gaö
;

773 
__À32
 
	md„_gaö
;

774 
__À32
 
	m¢r_ˇlc_maö
;

775 
__À32
 
	míîgy_ˇlc_maö
;

776 
__À32
 
	m¢r_ˇlc_aux
;

777 
__À32
 
	md•_dc_e°im_a
;

778 
__À32
 
	md•_dc_e°im_b
;

779 
__À32
 
	möa_dëec_ty≥_™d_ofdm_c‹r_comb
;

780 
__À32
 
	mcw_c‹r_comb
;

781 
__À32
 
	mrssi_comb
;

782 
__À32
 
	mauto_c‹r_cck
;

783 
__À32
 
	mofdm_föe_‰eq_™d_pöa_‰eq_îr
;

784 
__À32
 
	m¢rm_evm_maö
;

785 
__À32
 
	m¢rm_evm_aux
;

786 
__À32
 
	mrx_øã
;

787 
__À32
 
	m≥r_chaö_íums_™d_d•_©ãn_a
;

788 
__À32
 
	mèrgë_powî_™d_powî_mós_a
;

789 
__À32
 
	mtx_c⁄fig_as_i_™d_ac_a
;

790 
__À32
 
	m¥edi°_dcq_™d_dci_a
;

791 
__À32
 
	m≥r_chaö_íums_™d_d•_©ãn_b
;

792 
__À32
 
	mèrgë_powî_™d_powî_mós_b
;

793 
__À32
 
	mtx_c⁄fig_as_i_™d_ac_b
;

794 
__À32
 
	m¥edi°_dcq_™d_dci_b
;

795 
__À32
 
	mtx_øã
;

796 
__À32
 
	méc_backoff
;

797 
__À32
 
	mm∑pd_ˇlib_mode_m∑pd_ˇlib_ty≥_a
;

798 
__À32
 
	mpßt_™d_phy_powî_limô_a
;

799 
__À32
 
	mßr_™d_ªguœt‹y_powî_limô_a
;

800 
__À32
 
	mm∑pd_ˇlib_mode_m∑pd_ˇlib_ty≥_b
;

801 
__À32
 
	mpßt_™d_phy_powî_limô_b
;

802 
__À32
 
	mßr_™d_ªguœt‹y_powî_limô_b
;

803 
__À32
 
	m§d_™d_drivî_powî_limôs
;

804 
__À32
 
	mª£rved
;

805 } 
	g__∑cked
;

817 
	siwl_°©i°ics_mac_¡fy
 {

818 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

819 
__À32
 
	mbˇ°_fûãr_∑s£d_≥r_mac
[
NUM_MAC_INDEX_CDB
];

820 
__À32
 
	mbˇ°_fûãr_dr›≥d_≥r_mac
[
NUM_MAC_INDEX_CDB
];

821 
__À32
 
	mbˇ°_fûãr_∑s£d_≥r_fûãr
[
MAX_BCAST_FILTER_NUM
];

822 
__À32
 
	mbˇ°_fûãr_dr›≥d_≥r_fûãr
[
MAX_BCAST_FILTER_NUM
];

823 
__À32
 
	mª£rved
;

824 } 
	g__∑cked
;

848 
	siwl_°©i°ics_rx_¡fy
 {

849 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

850 
__À32
 
	mrx_agg_mpdu_˙t
;

851 
__À32
 
	mrx_agg_˙t
;

852 
__À32
 
	munsuµ‹ãd_mcs
;

853 
__À32
 
	mbogus_˘s
;

854 
__À32
 
	mbogus_ack
;

855 
__À32
 
	mrx_byã_cou¡
[
MAC_INDEX_AUX
];

856 
__À32
 
	mrx_∑ckë_cou¡
[
MAC_INDEX_AUX
];

857 
__À32
 
	mmis£d_bóc⁄s
;

858 
__À32
 
	muƒe•⁄ded_πs
;

859 
__À32
 
	mrxe_‰ame_limô_ovîrun
;

860 
__À32
 
	m£¡_ba_r•_˙t
;

861 
__À32
 
	mœã_rx_h™dÀ
;

862 
__À32
 
	mnum_bt_kûls
;

863 
__À32
 
	mª£rved
;

864 } 
	g__∑cked
;

936 
	siwl_°©i°ics_tx_¡fy
 {

937 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

938 
__À32
 
	m˘s_timeout
;

939 
__À32
 
	mack_timeout
;

940 
__À32
 
	mdump_msdu_˙t
;

941 
__À32
 
	mbur°_ab‹t_missög_√xt_‰ame_˙t
;

942 
__À32
 
	m˘s_timeout_cﬁlisi⁄
;

943 
__À32
 
	mack_‹_ba_timeout_cﬁlisi⁄
;

944 
__À32
 
	mba_timeout
;

945 
__À32
 
	mba_ªscheduÀ_‰ames
;

946 
__À32
 
	mscd_quîy_agg_‰ame_˙t
;

947 
__À32
 
	mscd_quîy_no_agg
;

948 
__À32
 
	mscd_quîy_agg
;

949 
__À32
 
	mscd_quîy_mism©ch
;

950 
__À32
 
	magg_ãrmö©ed_undîrun
;

951 
__À32
 
	magg_ãrmö©ed_bt_¥io_kûl
;

952 
__À32
 
	mtx_kûl_⁄_l⁄g_ªåy
;

953 
__À32
 
	mtx_kûl_⁄_sh‹t_ªåy
;

954 
__À32
 
	mtx_def„r_cou¡î
;

955 
__À32
 
	mtx_def„r_ba£_time
;

956 
__À32
 
	mtx_undîrun
;

957 
__À32
 
	mbt_de„r
;

958 
__À32
 
	mtx_kûl_⁄_d•_timeout
;

959 
__À32
 
	mtx_kûl_⁄_immedüã_quõt
;

960 
__À32
 
	mkûl_ba_˙t
;

961 
__À32
 
	mkûl_ack_˙t
;

962 
__À32
 
	mkûl_˘s_˙t
;

963 
__À32
 
	mbur°_ãrmö©ed
;

964 
__À32
 
	mœã_tx_vec_wr_˙t
;

965 
__À32
 
	mœã_rx2_tx_˙t
;

966 
__À32
 
	mscd_quîy_˙t
;

967 
__À32
 
	mtx_‰ames_acked_ö_agg
;

968 
__À32
 
	mœ°_tx_ch_width_ödx
;

969 
__À32
 
	mrx_dëe˘ed_≥r_ch_width
[4];

970 
__À32
 
	msuc˚ss_≥r_ch_width
[4];

971 
__À32
 
	mÁû_≥r_ch_width
[4];

972 
__À32
 
	mª£rved
;

973 } 
	g__∑cked
;

986 
	siwl_°©i°ics_duøti⁄_¡fy
 {

987 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

988 
__À32
 
	mc⁄t_bur°_chk_˙t
;

989 
__À32
 
	mc⁄t_bur°_˙t
;

990 
__À32
 
	mwaô_f‹_sûí˚_timeout_˙t
;

991 
__À32
 
	mª£rved
;

992 } 
	g__∑cked
;

1046 
	siwl_°©i°ics_he_¡fy
 {

1047 
iwl_°©i°ics_¡fy_hdr
 
	mhdr
;

1048 
__À32
 
	mrx_siga_vÆid_˙t
;

1049 
__À32
 
	mrx_siga_övÆid_˙t
;

1050 
__À32
 
	mrx_åig_ba£d_‰ame_˙t
;

1051 
__À32
 
	mrx_su_‰ame_˙t
;

1052 
__À32
 
	mrx_sigb_övÆid_˙t
;

1053 
__À32
 
	mrx_our_bss_cﬁ‹_˙t
;

1054 
__À32
 
	mrx_Ÿhî_bss_cﬁ‹_˙t
;

1055 
__À32
 
	mrx_zîo_bss_cﬁ‹_˙t
;

1056 
__À32
 
	mrx_mu_f‹_us_˙t
;

1057 
__À32
 
	mrx_mu_nŸ_f‹_us_˙t
;

1058 
__À32
 
	mrx_mu_nss_¨
[2];

1059 
__À32
 
	mrx_mu_mimo_˙t
;

1060 
__À32
 
	mrx_mu_ru_bw_¨
[7];

1061 
__À32
 
	mrx_åig_f‹_us_˙t
;

1062 
__À32
 
	mrx_åig_nŸ_f‹_us_˙t
;

1063 
__À32
 
	mrx_åig_wôh_cs_ªq_˙t
;

1064 
__À32
 
	mrx_åig_ty≥_¨
[8 + 1];

1065 
__À32
 
	mrx_åig_ö_agg_˙t
;

1066 
__À32
 
	mrx_basic_åig_Æloc_nss_¨
[2];

1067 
__À32
 
	mrx_basic_åig_Æloc_mu_mimo_˙t
;

1068 
__À32
 
	mrx_basic_åig_Æloc_ru_bw_¨
[7];

1069 
__À32
 
	mrx_basic_åig_tŸÆ_byã_˙t
;

1070 
__À32
 
	mtx_åig_ba£d_cs_ªq_Áû_˙t
;

1071 
__À32
 
	mtx_åig_ba£d_sifs_ok_˙t
;

1072 
__À32
 
	mtx_åig_ba£d_sifs_Áû_˙t
;

1073 
__À32
 
	mtx_åig_ba£d_byã_˙t
;

1074 
__À32
 
	mtx_åig_ba£d_∑d_byã_˙t
;

1075 
__À32
 
	mtx_åig_ba£d_‰ame_˙t
;

1076 
__À32
 
	mtx_åig_ba£d_acked_‰ame_˙t
;

1077 
__À32
 
	mtx_åig_ba£d_ack_timeout_˙t
;

1078 
__À32
 
	mtx_su_‰ame_˙t
;

1079 
__À32
 
	mtx_edˇ_to_mu_edˇ_˙t
;

1080 
__À32
 
	mtx_mu_edˇ_to_edˇ_by_timeout_˙t
;

1081 
__À32
 
	mtx_mu_edˇ_to_edˇ_by_ack_Áû_˙t
;

1082 
__À32
 
	mtx_mu_edˇ_to_edˇ_by_smÆl_Æloc_˙t
;

1083 
__À32
 
	mª£rved
;

1084 } 
	g__∑cked
;

	@fw/api/system.h

7 #i‚de‡
__iwl_fw_≠i_sy°em_h__


8 
	#__iwl_fw_≠i_sy°em_h__


	)

10 
	#SOC_CONFIG_CMD_FLAGS_DISCRETE
 
	`BIT
(0)

	)

11 
	#SOC_CONFIG_CMD_FLAGS_LOW_LATENCY
 
	`BIT
(1)

	)

13 
	#SOC_FLAGS_LTR_APPLY_DELAY_MASK
 0xc

	)

14 
	#SOC_FLAGS_LTR_APPLY_DELAY_NONE
 0

	)

15 
	#SOC_FLAGS_LTR_APPLY_DELAY_200
 1

	)

16 
	#SOC_FLAGS_LTR_APPLY_DELAY_2500
 2

	)

17 
	#SOC_FLAGS_LTR_APPLY_DELAY_1820
 3

	)

27 
	siwl_soc_c⁄figuøti⁄_cmd
 {

28 
__À32
 
	mÊags
;

29 
__À32
 
	mœãncy
;

30 } 
	g__∑cked
;

39 
	siwl_sy°em_„©uªs_c⁄åﬁ_cmd
 {

40 
__À32
 
	m„©uªs
[4];

41 } 
	g__∑cked
;

	@fw/api/tdls.h

7 #i‚de‡
__iwl_fw_≠i_tdls_h__


8 
	#__iwl_fw_≠i_tdls_h__


	)

10 
	~"fw/≠i/tx.h
"

11 
	~"fw/≠i/phy-˘xt.h
"

13 
	#IWL_MVM_TDLS_STA_COUNT
 4

	)

16 
	eiwl_tdls_ch™√l_swôch_ty≥
 {

17 
	mTDLS_SEND_CHAN_SW_REQ
 = 0,

18 
	mTDLS_SEND_CHAN_SW_RESP_AND_MOVE_CH
,

19 
	mTDLS_MOVE_CH
,

33 
	siwl_tdls_ch™√l_swôch_timög
 {

34 
__À32
 
	m‰ame_time°amp
;

35 
__À32
 
	mmax_offch™_duøti⁄
;

36 
__À32
 
	mswôch_time
;

37 
__À32
 
	mswôch_timeout
;

38 } 
	g__∑cked
;

40 
	#IWL_TDLS_CH_SW_FRAME_MAX_SIZE
 200

	)

51 
	siwl_tdls_ch™√l_swôch_‰ame
 {

52 
__À32
 
	mswôch_time_off£t
;

53 
iwl_tx_cmd
 
	mtx_cmd
;

54 
u8
 
	md©a
[
IWL_TDLS_CH_SW_FRAME_MAX_SIZE
];

55 } 
	g__∑cked
;

63 
	siwl_tdls_ch™√l_swôch_cmd_èû
 {

64 
iwl_tdls_ch™√l_swôch_timög
 
	mtimög
;

65 
iwl_tdls_ch™√l_swôch_‰ame
 
	m‰ame
;

66 } 
	g__∑cked
;

79 
	siwl_tdls_ch™√l_swôch_cmd
 {

80 
u8
 
	mswôch_ty≥
;

81 
__À32
 
	m≥î_°a_id
;

82 
iwl_fw_ch™√l_öfo
 
	mci
;

83 
iwl_tdls_ch™√l_swôch_cmd_èû
 
	mèû
;

84 } 
	g__∑cked
;

93 
	siwl_tdls_ch™√l_swôch_nŸif
 {

94 
__À32
 
	m°©us
;

95 
__À32
 
	moffch™√l_duøti⁄
;

96 
__À32
 
	m°a_id
;

97 } 
	g__∑cked
;

107 
	siwl_tdls_°a_öfo
 {

108 
u8
 
	m°a_id
;

109 
u8
 
	mtx_to_≥î_tid
;

110 
__À16
 
	mtx_to_≥î_s¢
;

111 
__À32
 
	mis_öôüt‹
;

112 } 
	g__∑cked
;

126 
	siwl_tdls_c⁄fig_cmd
 {

127 
__À32
 
	mid_™d_cﬁ‹
;

128 
u8
 
	mtdls_≥î_cou¡
;

129 
u8
 
	mtx_to_≠_tid
;

130 
__À16
 
	mtx_to_≠_s¢
;

131 
iwl_tdls_°a_öfo
 
	m°a_öfo
[
IWL_MVM_TDLS_STA_COUNT
];

133 
__À32
 
	m±i_ªq_d©a_off£t
;

134 
iwl_tx_cmd
 
	m±i_ªq_tx_cmd
;

135 
u8
 
	m±i_ªq_ãm∂©e
[];

136 } 
	g__∑cked
;

145 
	siwl_tdls_c⁄fig_°a_öfo_ªs
 {

146 
__À16
 
	m°a_id
;

147 
__À16
 
	mtx_to_≥î_œ°_£q
;

148 } 
	g__∑cked
;

156 
	siwl_tdls_c⁄fig_ªs
 {

157 
__À32
 
	mtx_to_≠_œ°_£q
;

158 
iwl_tdls_c⁄fig_°a_öfo_ªs
 
	m°a_öfo
[
IWL_MVM_TDLS_STA_COUNT
];

159 } 
	g__∑cked
;

	@fw/api/time-event.h

7 #i‚de‡
__iwl_fw_≠i_time_evít_h__


8 
	#__iwl_fw_≠i_time_evít_h__


	)

10 
	~"fw/≠i/phy-˘xt.h
"

13 
	eiwl_time_evít_ty≥
 {

15 
	mTE_BSS_STA_AGGRESSIVE_ASSOC
,

16 
	mTE_BSS_STA_ASSOC
,

17 
	mTE_BSS_EAP_DHCP_PROT
,

18 
	mTE_BSS_QUIET_PERIOD
,

21 
	mTE_P2P_DEVICE_DISCOVERABLE
,

22 
	mTE_P2P_DEVICE_LISTEN
,

23 
	mTE_P2P_DEVICE_ACTION_SCAN
,

24 
	mTE_P2P_DEVICE_FULL_SCAN
,

27 
	mTE_P2P_CLIENT_AGGRESSIVE_ASSOC
,

28 
	mTE_P2P_CLIENT_ASSOC
,

29 
	mTE_P2P_CLIENT_QUIET_PERIOD
,

32 
	mTE_P2P_GO_ASSOC_PROT
,

33 
	mTE_P2P_GO_REPETITIVET_NOA
,

34 
	mTE_P2P_GO_CT_WINDOW
,

37 
	mTE_WIDI_TX_SYNC
,

40 
	mTE_CHANNEL_SWITCH_PERIOD
,

42 
	mTE_MAX


61 
	mTE_V1_FRAG_NONE
 = 0,

62 
	mTE_V1_FRAG_SINGLE
 = 1,

63 
	mTE_V1_FRAG_DUAL
 = 2,

64 
	mTE_V1_FRAG_ENDLESS
 = 0xffffffff

68 
	#TE_V1_FRAG_MAX_MSK
 0x0fffffff

	)

70 
	#TE_V1_REPEAT_ENDLESS
 0xffffffff

	)

72 
	#TE_V1_REPEAT_MAX_MSK_V1
 0x0fffffff

	)

76 
	mTE_V1_INDEPENDENT
 = 0,

77 
	mTE_V1_DEP_OTHER
 = 
BIT
(0),

78 
	mTE_V1_DEP_TSF
 = 
BIT
(1),

79 
	mTE_V1_EVENT_SOCIOPATHIC
 = 
BIT
(2),

100 
	mTE_V1_NOTIF_NONE
 = 0,

101 
	mTE_V1_NOTIF_HOST_EVENT_START
 = 
BIT
(0),

102 
	mTE_V1_NOTIF_HOST_EVENT_END
 = 
BIT
(1),

103 
	mTE_V1_NOTIF_INTERNAL_EVENT_START
 = 
BIT
(2),

104 
	mTE_V1_NOTIF_INTERNAL_EVENT_END
 = 
BIT
(3),

105 
	mTE_V1_NOTIF_HOST_FRAG_START
 = 
BIT
(4),

106 
	mTE_V1_NOTIF_HOST_FRAG_END
 = 
BIT
(5),

107 
	mTE_V1_NOTIF_INTERNAL_FRAG_START
 = 
BIT
(6),

108 
	mTE_V1_NOTIF_INTERNAL_FRAG_END
 = 
BIT
(7),

127 
	mTE_V2_FRAG_NONE
 = 0,

128 
	mTE_V2_FRAG_SINGLE
 = 1,

129 
	mTE_V2_FRAG_DUAL
 = 2,

130 
	mTE_V2_FRAG_MAX
 = 0xfe,

131 
	mTE_V2_FRAG_ENDLESS
 = 0xff

135 
	#TE_V2_REPEAT_ENDLESS
 0xff

	)

137 
	#TE_V2_REPEAT_MAX
 0x„

	)

139 
	#TE_V2_PLACEMENT_POS
 12

	)

140 
	#TE_V2_ABSENCE_POS
 15

	)

164 
	eiwl_time_evít_pﬁicy
 {

165 
	mTE_V2_DEFAULT_POLICY
 = 0x0,

168 
	mTE_V2_NOTIF_HOST_EVENT_START
 = 
BIT
(0),

169 
	mTE_V2_NOTIF_HOST_EVENT_END
 = 
BIT
(1),

170 
	mTE_V2_NOTIF_INTERNAL_EVENT_START
 = 
BIT
(2),

171 
	mTE_V2_NOTIF_INTERNAL_EVENT_END
 = 
BIT
(3),

173 
	mTE_V2_NOTIF_HOST_FRAG_START
 = 
BIT
(4),

174 
	mTE_V2_NOTIF_HOST_FRAG_END
 = 
BIT
(5),

175 
	mTE_V2_NOTIF_INTERNAL_FRAG_START
 = 
BIT
(6),

176 
	mTE_V2_NOTIF_INTERNAL_FRAG_END
 = 
BIT
(7),

177 
	mTE_V2_START_IMMEDIATELY
 = 
BIT
(11),

180 
	mTE_V2_DEP_OTHER
 = 
BIT
(
TE_V2_PLACEMENT_POS
),

181 
	mTE_V2_DEP_TSF
 = 
BIT
(
TE_V2_PLACEMENT_POS
 + 1),

182 
	mTE_V2_EVENT_SOCIOPATHIC
 = 
BIT
(
TE_V2_PLACEMENT_POS
 + 2),

185 
	mTE_V2_ABSENCE
 = 
BIT
(
TE_V2_ABSENCE_POS
),

214 
	siwl_time_evít_cmd
 {

216 
__À32
 
	mid_™d_cﬁ‹
;

217 
__À32
 
	ma˘i⁄
;

218 
__À32
 
	mid
;

220 
__À32
 
	m≠∂y_time
;

221 
__À32
 
	mmax_dñay
;

222 
__À32
 
	mdïíds_⁄
;

223 
__À32
 
	möãrvÆ
;

224 
__À32
 
	mduøti⁄
;

225 
u8
 
	mª≥©
;

226 
u8
 
	mmax_‰ags
;

227 
__À16
 
	mpﬁicy
;

228 } 
	g__∑cked
;

238 
	siwl_time_evít_ª•
 {

239 
__À32
 
	m°©us
;

240 
__À32
 
	mid
;

241 
__À32
 
	munique_id
;

242 
__À32
 
	mid_™d_cﬁ‹
;

243 } 
	g__∑cked
;

255 
	siwl_time_evít_nŸif
 {

256 
__À32
 
	mtime°amp
;

257 
__À32
 
	m£ssi⁄_id
;

258 
__À32
 
	munique_id
;

259 
__À32
 
	mid_™d_cﬁ‹
;

260 
__À32
 
	ma˘i⁄
;

261 
__À32
 
	m°©us
;

262 } 
	g__∑cked
;

275 
	siwl_hs20_roc_ªq_èû
 {

276 
u8
 
	mnode_addr
[
ETH_ALEN
];

277 
__À16
 
	mª£rved
;

278 
__À32
 
	m≠∂y_time
;

279 
__À32
 
	m≠∂y_time_max_dñay
;

280 
__À32
 
	mduøti⁄
;

281 } 
	g__∑cked
;

303 
	siwl_hs20_roc_ªq
 {

305 
__À32
 
	mid_™d_cﬁ‹
;

306 
__À32
 
	ma˘i⁄
;

307 
__À32
 
	mevít_unique_id
;

308 
__À32
 
	m°a_id_™d_cﬁ‹
;

309 
iwl_fw_ch™√l_öfo
 
	mch™√l_öfo
;

310 
iwl_hs20_roc_ªq_èû
 
	mèû
;

311 } 
	g__∑cked
;

316 
	eiwl_mvm_hŸ_•Ÿ
 {

317 
	mHOT_SPOT_RSP_STATUS_OK
,

318 
	mHOT_SPOT_RSP_STATUS_TOO_MANY_EVENTS
,

319 
	mHOT_SPOT_MAX_NUM_OF_SESSIONS
,

333 
	siwl_hs20_roc_ªs
 {

334 
__À32
 
	mevít_unique_id
;

335 
__À32
 
	m°©us
;

336 } 
	g__∑cked
;

344 
	eiwl_roc_a˘ivôy
 {

345 
	mROC_ACTIVITY_HOTSPOT
,

346 
	mROC_ACTIVITY_P2P_DISC
,

347 
	mROC_ACTIVITY_P2P_TXRX
,

348 
	mROC_NUM_ACTIVITIES


367 
	siwl_roc_ªq
 {

368 
__À32
 
	ma˘i⁄
;

369 
__À32
 
	ma˘ivôy
;

370 
__À32
 
	m°a_id
;

371 
iwl_fw_ch™√l_öfo
 
	mch™√l_öfo
;

372 
u8
 
	mnode_addr
[
ETH_ALEN
];

373 
__À16
 
	mª£rved
;

374 
__À32
 
	mmax_dñay
;

375 
__À32
 
	mduøti⁄
;

376 } 
	g__∑cked
;

389 
	siwl_roc_nŸif
 {

390 
__À32
 
	msuc˚ss
;

391 
__À32
 
	m°¨ãd
;

392 
__À32
 
	ma˘ivôy
;

393 } 
	g__∑cked
;

425 
	eiwl_mvm_£ssi⁄_¥Ÿ_c⁄f_id
 {

426 
	mSESSION_PROTECT_CONF_ASSOC
,

427 
	mSESSION_PROTECT_CONF_GO_CLIENT_ASSOC
,

428 
	mSESSION_PROTECT_CONF_P2P_DEVICE_DISCOV
,

429 
	mSESSION_PROTECT_CONF_P2P_GO_NEGOTIATION
,

430 
	mSESSION_PROTECT_CONF_MAX_ID
,

449 
	siwl_mvm_£ssi⁄_¥Ÿ_cmd
 {

451 
__À32
 
	mid_™d_cﬁ‹
;

452 
__À32
 
	ma˘i⁄
;

453 
__À32
 
	mc⁄f_id
;

454 
__À32
 
	mduøti⁄_tu
;

455 
__À32
 
	mª≥tôi⁄_cou¡
;

456 
__À32
 
	möãrvÆ
;

457 } 
	g__∑cked
;

473 
	siwl_mvm_£ssi⁄_¥Ÿ_nŸif
 {

474 
__À32
 
	mmac_lök_id
;

475 
__À32
 
	m°©us
;

476 
__À32
 
	m°¨t
;

477 
__À32
 
	mc⁄f_id
;

478 } 
	g__∑cked
;

	@fw/api/tx.h

6 #i‚de‡
__iwl_fw_≠i_tx_h__


7 
	#__iwl_fw_≠i_tx_h__


	)

8 
	~<löux/õì80211.h
>

44 
	eiwl_tx_Êags
 {

45 
	mTX_CMD_FLG_PROT_REQUIRE
 = 
BIT
(0),

46 
	mTX_CMD_FLG_WRITE_TX_POWER
 = 
BIT
(1),

47 
	mTX_CMD_FLG_ACK
 = 
BIT
(3),

48 
	mTX_CMD_FLG_STA_RATE
 = 
BIT
(4),

49 
	mTX_CMD_FLG_BAR
 = 
BIT
(6),

50 
	mTX_CMD_FLG_TXOP_PROT
 = 
BIT
(7),

51 
	mTX_CMD_FLG_VHT_NDPA
 = 
BIT
(8),

52 
	mTX_CMD_FLG_HT_NDPA
 = 
BIT
(9),

53 
	mTX_CMD_FLG_CSI_FDBK2HOST
 = 
BIT
(10),

54 
	mTX_CMD_FLG_BT_PRIO_POS
 = 11,

55 
	mTX_CMD_FLG_BT_PRIO_MASK
 = 
BIT
(11) | BIT(12),

56 
	mTX_CMD_FLG_BT_DIS
 = 
BIT
(12),

57 
	mTX_CMD_FLG_SEQ_CTL
 = 
BIT
(13),

58 
	mTX_CMD_FLG_MORE_FRAG
 = 
BIT
(14),

59 
	mTX_CMD_FLG_TSF
 = 
BIT
(16),

60 
	mTX_CMD_FLG_CALIB
 = 
BIT
(17),

61 
	mTX_CMD_FLG_KEEP_SEQ_CTL
 = 
BIT
(18),

62 
	mTX_CMD_FLG_MH_PAD
 = 
BIT
(20),

63 
	mTX_CMD_FLG_RESP_TO_DRV
 = 
BIT
(21),

64 
	mTX_CMD_FLG_TKIP_MIC_DONE
 = 
BIT
(23),

65 
	mTX_CMD_FLG_DUR
 = 
BIT
(25),

66 
	mTX_CMD_FLG_FW_DROP
 = 
BIT
(26),

67 
	mTX_CMD_FLG_EXEC_PAPD
 = 
BIT
(27),

68 
	mTX_CMD_FLG_PAPD_TYPE
 = 
BIT
(28),

69 
	mTX_CMD_FLG_HCCA_CHUNK
 = 
BIT
(31)

82 
	eiwl_tx_cmd_Êags
 {

83 
	mIWL_TX_FLAGS_CMD_RATE
 = 
BIT
(0),

84 
	mIWL_TX_FLAGS_ENCRYPT_DIS
 = 
BIT
(1),

85 
	mIWL_TX_FLAGS_HIGH_PRI
 = 
BIT
(2),

88 
	mIWL_TX_FLAGS_RTS
 = 
BIT
(3),

89 
	mIWL_TX_FLAGS_CTS
 = 
BIT
(4),

98 
	eiwl_tx_pm_timeouts
 {

99 
	mPM_FRAME_NONE
 = 0,

100 
	mPM_FRAME_MGMT
 = 2,

101 
	mPM_FRAME_ASSOC
 = 3,

104 
	#TX_CMD_SEC_MSK
 0x07

	)

105 
	#TX_CMD_SEC_WEP_KEY_IDX_POS
 6

	)

106 
	#TX_CMD_SEC_WEP_KEY_IDX_MSK
 0xc0

	)

121 
	eiwl_tx_cmd_£c_˘æ
 {

122 
	mTX_CMD_SEC_WEP
 = 0x01,

123 
	mTX_CMD_SEC_CCM
 = 0x02,

124 
	mTX_CMD_SEC_TKIP
 = 0x03,

125 
	mTX_CMD_SEC_EXT
 = 0x04,

126 
	mTX_CMD_SEC_GCMP
 = 0x05,

127 
	mTX_CMD_SEC_KEY128
 = 0x08,

128 
	mTX_CMD_SEC_KEY_FROM_TABLE
 = 0x10,

134 
	#TX_CMD_LIFE_TIME_INFINITE
 0xFFFFFFFF

	)

135 
	#TX_CMD_LIFE_TIME_DEFAULT
 2000000

	)

136 
	#TX_CMD_LIFE_TIME_PROBE_RESP
 40000

	)

137 
	#TX_CMD_LIFE_TIME_EXPIRED_FRAME
 0

	)

142 
	#IWL_TID_NON_QOS
 0

	)

147 
	#IWL_DEFAULT_TX_RETRY
 15

	)

148 
	#IWL_MGMT_DFAULT_RETRY_LIMIT
 3

	)

149 
	#IWL_RTS_DFAULT_RETRY_LIMIT
 60

	)

150 
	#IWL_BAR_DFAULT_RETRY_LIMIT
 60

	)

151 
	#IWL_LOW_RETRY_LIMIT
 7

	)

170 
	eiwl_tx_ofÊﬂd_assi°_Êags_pos
 {

171 
	mTX_CMD_OFFLD_IP_HDR
 = 0,

172 
	mTX_CMD_OFFLD_L4_EN
 = 6,

173 
	mTX_CMD_OFFLD_L3_EN
 = 7,

174 
	mTX_CMD_OFFLD_MH_SIZE
 = 8,

175 
	mTX_CMD_OFFLD_PAD
 = 13,

176 
	mTX_CMD_OFFLD_AMSDU
 = 14,

179 
	#IWL_TX_CMD_OFFLD_MH_MASK
 0x1f

	)

180 
	#IWL_TX_CMD_OFFLD_IP_HDR_MASK
 0x3f

	)

224 
	siwl_tx_cmd
 {

225 
__À16
 
	mÀn
;

226 
__À16
 
	mofÊﬂd_assi°
;

227 
__À32
 
	mtx_Êags
;

229 
u8
 
	måy_˙t
;

230 
u8
 
	mbtkûl_˙t
;

231 
__À16
 
	mª£rved
;

232 } 
	ms¸©ch
;

233 
__À32
 
	møã_n_Êags
;

234 
u8
 
	m°a_id
;

235 
u8
 
	m£c_˘l
;

236 
u8
 
	möôül_øã_ödex
;

237 
u8
 
	mª£rved2
;

238 
u8
 
	mkey
[16];

239 
__À32
 
	mª£rved3
;

240 
__À32
 
	mli„_time
;

241 
__À32
 
	mdøm_lsb_±r
;

242 
u8
 
	mdøm_msb_±r
;

243 
u8
 
	mπs_ªåy_limô
;

244 
u8
 
	md©a_ªåy_limô
;

245 
u8
 
	mtid_t•ec
;

246 
__À16
 
	mpm_‰ame_timeout
;

247 
__À16
 
	mª£rved4
;

249 
DECLARE_FLEX_ARRAY
(
u8
, 
∑ylﬂd
);

250 
DECLARE_FLEX_ARRAY
(
õì80211_hdr
, 
hdr
);

252 } 
	g__∑cked
;

254 
	siwl_døm_£c_öfo
 {

255 
__À32
 
	m≤_low
;

256 
__À16
 
	m≤_high
;

257 
__À16
 
	maux_öfo
;

258 } 
	g__∑cked
;

271 
	siwl_tx_cmd_gí2
 {

272 
__À16
 
	mÀn
;

273 
__À16
 
	mofÊﬂd_assi°
;

274 
__À32
 
	mÊags
;

275 
iwl_døm_£c_öfo
 
	mdøm_öfo
;

276 
__À32
 
	møã_n_Êags
;

277 
õì80211_hdr
 
	mhdr
[];

278 } 
	g__∑cked
;

293 
	siwl_tx_cmd_gí3
 {

294 
__À16
 
	mÀn
;

295 
__À16
 
	mÊags
;

296 
__À32
 
	mofÊﬂd_assi°
;

297 
iwl_døm_£c_öfo
 
	mdøm_öfo
;

298 
__À32
 
	møã_n_Êags
;

299 
u8
 
	mª£rved
[8];

300 
õì80211_hdr
 
	mhdr
[];

301 } 
	g__∑cked
;

345 
	eiwl_tx_°©us
 {

346 
	mTX_STATUS_MSK
 = 0x000000ff,

347 
	mTX_STATUS_SUCCESS
 = 0x01,

348 
	mTX_STATUS_DIRECT_DONE
 = 0x02,

350 
	mTX_STATUS_POSTPONE_DELAY
 = 0x40,

351 
	mTX_STATUS_POSTPONE_FEW_BYTES
 = 0x41,

352 
	mTX_STATUS_POSTPONE_BT_PRIO
 = 0x42,

353 
	mTX_STATUS_POSTPONE_QUIET_PERIOD
 = 0x43,

354 
	mTX_STATUS_POSTPONE_CALC_TTAK
 = 0x44,

356 
	mTX_STATUS_FAIL_INTERNAL_CROSSED_RETRY
 = 0x81,

357 
	mTX_STATUS_FAIL_SHORT_LIMIT
 = 0x82,

358 
	mTX_STATUS_FAIL_LONG_LIMIT
 = 0x83,

359 
	mTX_STATUS_FAIL_UNDERRUN
 = 0x84,

360 
	mTX_STATUS_FAIL_DRAIN_FLOW
 = 0x85,

361 
	mTX_STATUS_FAIL_RFKILL_FLUSH
 = 0x86,

362 
	mTX_STATUS_FAIL_LIFE_EXPIRE
 = 0x87,

363 
	mTX_STATUS_FAIL_DEST_PS
 = 0x88,

364 
	mTX_STATUS_FAIL_HOST_ABORTED
 = 0x89,

365 
	mTX_STATUS_FAIL_BT_RETRY
 = 0x8a,

366 
	mTX_STATUS_FAIL_STA_INVALID
 = 0x8b,

367 
	mTX_STATUS_FAIL_FRAG_DROPPED
 = 0x8c,

368 
	mTX_STATUS_FAIL_TID_DISABLE
 = 0x8d,

369 
	mTX_STATUS_FAIL_FIFO_FLUSHED
 = 0x8e,

370 
	mTX_STATUS_FAIL_SMALL_CF_POLL
 = 0x8f,

371 
	mTX_STATUS_FAIL_FW_DROP
 = 0x90,

372 
	mTX_STATUS_FAIL_STA_COLOR_MISMATCH
 = 0x91,

373 
	mTX_STATUS_INTERNAL_ABORT
 = 0x92,

374 
	mTX_MODE_MSK
 = 0x00000f00,

375 
	mTX_MODE_NO_BURST
 = 0x00000000,

376 
	mTX_MODE_IN_BURST_SEQ
 = 0x00000100,

377 
	mTX_MODE_FIRST_IN_BURST
 = 0x00000200,

378 
	mTX_QUEUE_NUM_MSK
 = 0x0001f000,

379 
	mTX_NARROW_BW_MSK
 = 0x00060000,

380 
	mTX_NARROW_BW_1DIV2
 = 0x00020000,

381 
	mTX_NARROW_BW_1DIV4
 = 0x00040000,

382 
	mTX_NARROW_BW_1DIV8
 = 0x00060000,

411 
	eiwl_tx_agg_°©us
 {

412 
	mAGG_TX_STATE_STATUS_MSK
 = 0x00fff,

413 
	mAGG_TX_STATE_TRANSMITTED
 = 0x000,

414 
	mAGG_TX_STATE_UNDERRUN
 = 0x001,

415 
	mAGG_TX_STATE_BT_PRIO
 = 0x002,

416 
	mAGG_TX_STATE_FEW_BYTES
 = 0x004,

417 
	mAGG_TX_STATE_ABORT
 = 0x008,

418 
	mAGG_TX_STATE_TX_ON_AIR_DROP
 = 0x010,

419 
	mAGG_TX_STATE_LAST_SENT_TRY_CNT
 = 0x020,

420 
	mAGG_TX_STATE_LAST_SENT_BT_KILL
 = 0x040,

421 
	mAGG_TX_STATE_SCD_QUERY
 = 0x080,

422 
	mAGG_TX_STATE_TEST_BAD_CRC32
 = 0x0100,

423 
	mAGG_TX_STATE_RESPONSE
 = 0x1ff,

424 
	mAGG_TX_STATE_DUMP_TX
 = 0x200,

425 
	mAGG_TX_STATE_DELAY_TX
 = 0x400,

426 
	mAGG_TX_STATE_TRY_CNT_POS
 = 12,

427 
	mAGG_TX_STATE_TRY_CNT_MSK
 = 0x‡<< 
AGG_TX_STATE_TRY_CNT_POS
,

435 
	#AGG_TX_STAT_FRAME_NOT_SENT
 (
AGG_TX_STATE_FEW_BYTES
 | \

436 
AGG_TX_STATE_ABORT
 | \

437 
AGG_TX_STATE_SCD_QUERY
)

	)

467 
	sagg_tx_°©us
 {

468 
__À16
 
	m°©us
;

469 
__À16
 
	m£quí˚
;

470 } 
	g__∑cked
;

478 
	#TX_RES_INIT_RATE_INDEX_MSK
 0x0f

	)

479 
	#TX_RES_RATE_TABLE_COLOR_POS
 4

	)

480 
	#TX_RES_RATE_TABLE_COLOR_MSK
 0x70

	)

481 
	#TX_RES_INV_RATE_INDEX_MSK
 0x80

	)

482 
	#TX_RES_RATE_TABLE_COL_GET
(
_f
Ë(((_fË& 
TX_RES_RATE_TABLE_COLOR_MSK
) >>\

483 
TX_RES_RATE_TABLE_COLOR_POS
)

	)

485 
	#IWL_MVM_TX_RES_GET_TID
(
_ø_tid
Ë((_ø_tidË& 0x0f)

	)

486 
	#IWL_MVM_TX_RES_GET_RA
(
_ø_tid
Ë((_ø_tidË>> 4)

	)

520 
	siwl_mvm_tx_ª•_v3
 {

521 
u8
 
	m‰ame_cou¡
;

522 
u8
 
	mbt_kûl_cou¡
;

523 
u8
 
	mÁûuª_πs
;

524 
u8
 
	mÁûuª_‰ame
;

525 
__À32
 
	möôül_øã
;

526 
__À16
 
	mwúñess_medü_time
;

528 
u8
 
	m∑_°©us
;

529 
u8
 
	m∑_öãg_ªs_a
[3];

530 
u8
 
	m∑_öãg_ªs_b
[3];

531 
u8
 
	m∑_öãg_ªs_c
[3];

532 
__À16
 
	mmósuªmít_ªq_id
;

533 
u8
 
	mªdu˚d_çc
;

534 
u8
 
	mª£rved
;

536 
__À32
 
	mtfd_öfo
;

537 
__À16
 
	m£q_˘l
;

538 
__À16
 
	mbyã_˙t
;

539 
u8
 
	méc_öfo
;

540 
u8
 
	mø_tid
;

541 
__À16
 
	m‰ame_˘æ
;

542 
agg_tx_°©us
 
	m°©us
[];

543 } 
	g__∑cked
;

578 
	siwl_mvm_tx_ª•
 {

579 
u8
 
	m‰ame_cou¡
;

580 
u8
 
	mbt_kûl_cou¡
;

581 
u8
 
	mÁûuª_πs
;

582 
u8
 
	mÁûuª_‰ame
;

583 
__À32
 
	möôül_øã
;

584 
__À16
 
	mwúñess_medü_time
;

586 
u8
 
	m∑_°©us
;

587 
u8
 
	m∑_öãg_ªs_a
[3];

588 
u8
 
	m∑_öãg_ªs_b
[3];

589 
u8
 
	m∑_öãg_ªs_c
[3];

590 
__À16
 
	mmósuªmít_ªq_id
;

591 
u8
 
	mªdu˚d_çc
;

592 
u8
 
	mª£rved
;

594 
__À32
 
	mtfd_öfo
;

595 
__À16
 
	m£q_˘l
;

596 
__À16
 
	mbyã_˙t
;

597 
u8
 
	méc_öfo
;

598 
u8
 
	mø_tid
;

599 
__À16
 
	m‰ame_˘æ
;

600 
__À16
 
	mtx_queue
;

601 
__À16
 
	mª£rved2
;

602 
agg_tx_°©us
 
	m°©us
;

603 } 
	g__∑cked
;

624 
	siwl_mvm_ba_nŸif
 {

625 
u8
 
	m°a_addr
[
ETH_ALEN
];

626 
__À16
 
	mª£rved
;

628 
u8
 
	m°a_id
;

629 
u8
 
	mtid
;

630 
__À16
 
	m£q_˘l
;

631 
__À64
 
	mbôm≠
;

632 
__À16
 
	mscd_Êow
;

633 
__À16
 
	mscd_s¢
;

634 
u8
 
	mtxed
;

635 
u8
 
	mtxed_2_d⁄e
;

636 
u8
 
	mªdu˚d_txp
;

637 
u8
 
	mª£rved1
;

638 } 
	g__∑cked
;

648 
	siwl_mvm_com¥es£d_ba_tfd
 {

649 
__À16
 
	mq_num
;

650 
__À16
 
	mtfd_ödex
;

651 
u8
 
	mscd_queue
;

652 
u8
 
	mtid
;

653 
u8
 
	mª£rved
[2];

654 } 
	g__∑cked
;

662 
	siwl_mvm_com¥es£d_ba_øtid
 {

663 
u8
 
	mq_num
;

664 
u8
 
	mtid
;

665 
__À16
 
	ms¢
;

666 } 
	g__∑cked
;

678 
	eiwl_mvm_ba_ª•_Êags
 {

679 
	mIWL_MVM_BA_RESP_TX_AGG
,

680 
	mIWL_MVM_BA_RESP_TX_BAR
,

681 
	mIWL_MVM_BA_RESP_TX_AGG_FAIL
,

682 
	mIWL_MVM_BA_RESP_TX_UNDERRUN
,

683 
	mIWL_MVM_BA_RESP_TX_BT_KILL
,

684 
	mIWL_MVM_BA_RESP_TX_DSP_TIMEOUT


711 
	siwl_mvm_com¥es£d_ba_nŸif
 {

712 
__À32
 
	mÊags
;

713 
u8
 
	m°a_id
;

714 
u8
 
	mªdu˚d_txp
;

715 
u8
 
	méc_øã_öfo
;

716 
u8
 
	mªåy_˙t
;

717 
__À32
 
	mquîy_byã_˙t
;

718 
__À16
 
	mquîy_‰ame_˙t
;

719 
__À16
 
	mtxed
;

720 
__À16
 
	md⁄e
;

721 
__À16
 
	mª£rved
;

722 
__À32
 
	mwúñess_time
;

723 
__À32
 
	mtx_øã
;

724 
__À16
 
	mtfd_˙t
;

725 
__À16
 
	mø_tid_˙t
;

727 
DECLARE_FLEX_ARRAY
(
iwl_mvm_com¥es£d_ba_øtid
, 
ø_tid
);

728 
DECLARE_FLEX_ARRAY
(
iwl_mvm_com¥es£d_ba_tfd
, 
tfd
);

730 } 
	g__∑cked
;

742 
	siwl_mac_bóc⁄_cmd_v6
 {

743 
iwl_tx_cmd
 
	mtx
;

744 
__À32
 
	mãm∂©e_id
;

745 
__À32
 
	mtim_idx
;

746 
__À32
 
	mtim_size
;

747 
õì80211_hdr
 
	m‰ame
[];

748 } 
	g__∑cked
;

761 
	siwl_mac_bóc⁄_cmd_v7
 {

762 
iwl_tx_cmd
 
	mtx
;

763 
__À32
 
	mãm∂©e_id
;

764 
__À32
 
	mtim_idx
;

765 
__À32
 
	mtim_size
;

766 
__À32
 
	mecß_off£t
;

767 
__À32
 
	mcß_off£t
;

768 
õì80211_hdr
 
	m‰ame
[];

769 } 
	g__∑cked
;

772 
	eiwl_mac_bóc⁄_Êags_v1
 {

773 
	mIWL_MAC_BEACON_CCK_V1
 = 
BIT
(8),

774 
	mIWL_MAC_BEACON_ANT_A_V1
 = 
BIT
(9),

775 
	mIWL_MAC_BEACON_ANT_B_V1
 = 
BIT
(10),

776 
	mIWL_MAC_BEACON_FILS_V1
 = 
BIT
(12),

780 
	eiwl_mac_bóc⁄_Êags
 {

781 
	mIWL_MAC_BEACON_CCK
 = 
BIT
(5),

782 
	mIWL_MAC_BEACON_ANT_A
 = 
BIT
(6),

783 
	mIWL_MAC_BEACON_ANT_B
 = 
BIT
(7),

784 
	mIWL_MAC_BEACON_FILS
 = 
BIT
(8),

801 
	siwl_mac_bóc⁄_cmd
 {

802 
__À16
 
	mbyã_˙t
;

803 
__À16
 
	mÊags
;

804 
__À32
 
	msh‹t_ssid
;

805 
__À32
 
	mª£rved
;

806 
__À32
 
	mlök_id
;

807 
__À32
 
	mtim_idx
;

808 
__À32
 
	mtim_size
;

809 
__À32
 
	mecß_off£t
;

810 
__À32
 
	mcß_off£t
;

811 
õì80211_hdr
 
	m‰ame
[];

812 } 
	g__∑cked
;

818 
	siwl_bóc⁄_nŸif
 {

819 
iwl_mvm_tx_ª•
 
	mbóc⁄_nŸify_hdr
;

820 
__À64
 
	mtsf
;

821 
__À32
 
	mibss_mgr_°©us
;

822 } 
	g__∑cked
;

831 
	siwl_exãnded_bóc⁄_nŸif_v5
 {

832 
iwl_mvm_tx_ª•
 
	mbóc⁄_nŸify_hdr
;

833 
__À64
 
	mtsf
;

834 
__À32
 
	mibss_mgr_°©us
;

835 
__À32
 
	mgp2
;

836 } 
	g__∑cked
;

845 
	siwl_exãnded_bóc⁄_nŸif
 {

846 
__À32
 
	m°©us
;

847 
__À64
 
	mtsf
;

848 
__À32
 
	mibss_mgr_°©us
;

849 
__À32
 
	mgp2
;

850 } 
	g__∑cked
;

857 
	eiwl_dump_c⁄åﬁ
 {

858 
	mDUMP_TX_FIFO_FLUSH
 = 
BIT
(1),

867 
	siwl_tx_∑th_Êush_cmd_v1
 {

868 
__À32
 
	mqueues_˘l
;

869 
__À16
 
	mÊush_˘l
;

870 
__À16
 
	mª£rved
;

871 } 
	g__∑cked
;

879 
	siwl_tx_∑th_Êush_cmd
 {

880 
__À32
 
	m°a_id
;

881 
__À16
 
	mtid_mask
;

882 
__À16
 
	mª£rved
;

883 } 
	g__∑cked
;

885 
	#IWL_TX_FLUSH_QUEUE_RSP
 16

	)

894 
	siwl_Êush_queue_öfo
 {

895 
__À16
 
	mtid
;

896 
__À16
 
	mqueue_num
;

897 
__À16
 
	mªad_bef‹e_Êush
;

898 
__À16
 
	mªad_a·î_Êush
;

899 } 
	g__∑cked
;

907 
	siwl_tx_∑th_Êush_cmd_r•
 {

908 
__À16
 
	m°a_id
;

909 
__À16
 
	mnum_Êushed_queues
;

910 
iwl_Êush_queue_öfo
 
	mqueues
[
IWL_TX_FLUSH_QUEUE_RSP
];

911 } 
	g__∑cked
;

914 
	eiwl_scd_cfg_a˘i⁄s
 {

915 
	mSCD_CFG_DISABLE_QUEUE
 = 0x0,

916 
	mSCD_CFG_ENABLE_QUEUE
 = 0x1,

917 
	mSCD_CFG_UPDATE_QUEUE_TID
 = 0x2,

934 
	siwl_scd_txq_cfg_cmd
 {

935 
u8
 
	mtokí
;

936 
u8
 
	m°a_id
;

937 
u8
 
	mtid
;

938 
u8
 
	mscd_queue
;

939 
u8
 
	ma˘i⁄
;

940 
u8
 
	maggªg©e
;

941 
u8
 
	mtx_fifo
;

942 
u8
 
	mwödow
;

943 
__À16
 
	ms¢
;

944 
__À16
 
	mª£rved
;

945 } 
	g__∑cked
;

954 
	siwl_scd_txq_cfg_r•
 {

955 
u8
 
	mtokí
;

956 
u8
 
	m°a_id
;

957 
u8
 
	mtid
;

958 
u8
 
	mscd_queue
;

959 } 
	g__∑cked
;

	@fw/api/txq.h

7 #i‚de‡
__iwl_fw_≠i_txq_h__


8 
	#__iwl_fw_≠i_txq_h__


	)

34 
	eiwl_mvm_dqa_txq
 {

35 
	mIWL_MVM_DQA_CMD_QUEUE
 = 0,

36 
	mIWL_MVM_DQA_AUX_QUEUE
 = 1,

37 
	mIWL_MVM_DQA_P2P_DEVICE_QUEUE
 = 2,

38 
	mIWL_MVM_DQA_INJECT_MONITOR_QUEUE
 = 2,

39 
	mIWL_MVM_DQA_GCAST_QUEUE
 = 3,

40 
	mIWL_MVM_DQA_BSS_CLIENT_QUEUE
 = 4,

41 
	mIWL_MVM_DQA_MIN_MGMT_QUEUE
 = 5,

42 
	mIWL_MVM_DQA_MAX_MGMT_QUEUE
 = 8,

43 
	mIWL_MVM_DQA_AP_PROBE_RESP_QUEUE
 = 9,

44 
	mIWL_MVM_DQA_MIN_DATA_QUEUE
 = 10,

45 
	mIWL_MVM_DQA_MAX_DATA_QUEUE
 = 30,

48 
	eiwl_mvm_tx_fifo
 {

49 
	mIWL_MVM_TX_FIFO_BK
 = 0,

50 
	mIWL_MVM_TX_FIFO_BE
,

51 
	mIWL_MVM_TX_FIFO_VI
,

52 
	mIWL_MVM_TX_FIFO_VO
,

53 
	mIWL_MVM_TX_FIFO_MCAST
 = 5,

54 
	mIWL_MVM_TX_FIFO_CMD
 = 7,

57 
	eiwl_gí2_tx_fifo
 {

58 
	mIWL_GEN2_TX_FIFO_CMD
 = 0,

59 
	mIWL_GEN2_EDCA_TX_FIFO_BK
,

60 
	mIWL_GEN2_EDCA_TX_FIFO_BE
,

61 
	mIWL_GEN2_EDCA_TX_FIFO_VI
,

62 
	mIWL_GEN2_EDCA_TX_FIFO_VO
,

63 
	mIWL_GEN2_TRIG_TX_FIFO_BK
,

64 
	mIWL_GEN2_TRIG_TX_FIFO_BE
,

65 
	mIWL_GEN2_TRIG_TX_FIFO_VI
,

66 
	mIWL_GEN2_TRIG_TX_FIFO_VO
,

69 
	eiwl_bz_tx_fifo
 {

70 
	mIWL_BZ_EDCA_TX_FIFO_BK
,

71 
	mIWL_BZ_EDCA_TX_FIFO_BE
,

72 
	mIWL_BZ_EDCA_TX_FIFO_VI
,

73 
	mIWL_BZ_EDCA_TX_FIFO_VO
,

74 
	mIWL_BZ_TRIG_TX_FIFO_BK
,

75 
	mIWL_BZ_TRIG_TX_FIFO_BE
,

76 
	mIWL_BZ_TRIG_TX_FIFO_VI
,

77 
	mIWL_BZ_TRIG_TX_FIFO_VO
,

84 
	eiwl_tx_queue_cfg_a˘i⁄s
 {

85 
	mTX_QUEUE_CFG_ENABLE_QUEUE
 = 
BIT
(0),

86 
	mTX_QUEUE_CFG_TFD_SHORT_FORMAT
 = 
BIT
(1),

89 
	#IWL_DEFAULT_QUEUE_SIZE_EHT
 (512 * 4)

	)

90 
	#IWL_DEFAULT_QUEUE_SIZE_HE
 1024

	)

91 
	#IWL_DEFAULT_QUEUE_SIZE
 256

	)

92 
	#IWL_MGMT_QUEUE_SIZE
 16

	)

93 
	#IWL_CMD_QUEUE_SIZE
 32

	)

104 
	siwl_tx_queue_cfg_cmd
 {

105 
u8
 
	m°a_id
;

106 
u8
 
	mtid
;

107 
__À16
 
	mÊags
;

108 
__À32
 
	mcb_size
;

109 
__À64
 
	mbyã_˙t_addr
;

110 
__À64
 
	mtfdq_addr
;

111 } 
	g__∑cked
;

120 
	siwl_tx_queue_cfg_r•
 {

121 
__À16
 
	mqueue_numbî
;

122 
__À16
 
	mÊags
;

123 
__À16
 
	mwrôe_poöãr
;

124 
__À16
 
	mª£rved
;

125 } 
	g__∑cked
;

	@fw/dbg.c

7 
	~<löux/devc‹edump.h
>

8 
	~"iwl-drv.h
"

9 
	~"ru¡ime.h
"

10 
	~"dbg.h
"

11 
	~"debugfs.h
"

12 
	~"iwl-io.h
"

13 
	~"iwl-¥ph.h
"

14 
	~"iwl-c§.h
"

15 
	~"iwl-fh.h
"

24 
	siwl_fw_dump_±rs
 {

25 
iwl_å™s_dump_d©a
 *
	må™s_±r
;

26 *
	mfwπ_±r
;

27 
u32
 
	mfwπ_Àn
;

30 
	#RADIO_REG_MAX_READ
 0x2ad

	)

31 
	$iwl_ªad_ødio_ªgs
(
iwl_fw_ru¡ime
 *
fwπ
,

32 
iwl_fw_îr‹_dump_d©a
 **
dump_d©a
)

34 
u8
 *
pos
 = (*)(*
dump_d©a
)->
d©a
;

35 
i
;

37 
	`IWL_DEBUG_INFO
(
fwπ
, "WRTÑadioÑegisters dump\n");

39 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

42 (*
dump_d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_RADIO_REG
);

43 (*
dump_d©a
)->
Àn
 = 
	`˝u_to_À32
(
RADIO_REG_MAX_READ
);

45 
i
 = 0; i < 
RADIO_REG_MAX_READ
; i++) {

46 
u32
 
rd_cmd
 = 
RADIO_RSP_RD_CMD
;

48 
rd_cmd
 |
i
 << 
RADIO_RSP_ADDR_POS
;

49 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
RSP_RADIO_CMD
, 
rd_cmd
);

50 *
pos
 = (
u8
)
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
, 
RSP_RADIO_RDDAT
);

52 
pos
++;

55 *
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*dump_data);

57 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

58 
	}
}

60 
	$iwl_fwπ_dump_rxf
(
iwl_fw_ru¡ime
 *
fwπ
,

61 
iwl_fw_îr‹_dump_d©a
 **
dump_d©a
,

62 
size
, 
u32
 
off£t
, 
fifo_num
)

64 
iwl_fw_îr‹_dump_fifo
 *
fifo_hdr
;

65 
u32
 *
fifo_d©a
;

66 
u32
 
fifo_Àn
;

67 
i
;

69 
fifo_hdr
 = (*)(*
dump_d©a
)->
d©a
;

70 
fifo_d©a
 = (*)
fifo_hdr
->
d©a
;

71 
fifo_Àn
 = 
size
;

74 i‡(
fifo_Àn
 == 0)

78 (*
dump_d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_RXF
);

79 (*
dump_d©a
)->
Àn
 = 
	`˝u_to_À32
(
fifo_Àn
 + (*
fifo_hdr
));

81 
fifo_hdr
->
fifo_num
 = 
	`˝u_to_À32
(fifo_num);

82 
fifo_hdr
->
avaûabÀ_byãs
 =

83 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

84 
RXF_RD_D_SPACE
 + 
off£t
));

85 
fifo_hdr
->
wr_±r
 =

86 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

87 
RXF_RD_WR_PTR
 + 
off£t
));

88 
fifo_hdr
->
rd_±r
 =

89 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

90 
RXF_RD_RD_PTR
 + 
off£t
));

91 
fifo_hdr
->
„n˚_±r
 =

92 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

93 
RXF_RD_FENCE_PTR
 + 
off£t
));

94 
fifo_hdr
->
„n˚_mode
 =

95 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

96 
RXF_SET_FENCE_MODE
 + 
off£t
));

99 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
, 
RXF_SET_FENCE_MODE
 + 
off£t
, 0x1);

101 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
, 
RXF_LD_WR2FENCE
 + 
off£t
, 0x1);

103 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
,

104 
RXF_LD_FENCE_OFFSET_ADDR
 + 
off£t
, 0x0);

107 
fifo_Àn
 /(
u32
);

108 
i
 = 0; i < 
fifo_Àn
; i++)

109 
fifo_d©a
[
i
] = 
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

110 
RXF_FIFO_RD_FENCE_INC
 +

111 
off£t
);

112 *
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*dump_data);

113 
	}
}

115 
	$iwl_fwπ_dump_txf
(
iwl_fw_ru¡ime
 *
fwπ
,

116 
iwl_fw_îr‹_dump_d©a
 **
dump_d©a
,

117 
size
, 
u32
 
off£t
, 
fifo_num
)

119 
iwl_fw_îr‹_dump_fifo
 *
fifo_hdr
;

120 
u32
 *
fifo_d©a
;

121 
u32
 
fifo_Àn
;

122 
i
;

124 
fifo_hdr
 = (*)(*
dump_d©a
)->
d©a
;

125 
fifo_d©a
 = (*)
fifo_hdr
->
d©a
;

126 
fifo_Àn
 = 
size
;

129 i‡(
fifo_Àn
 == 0)

133 (*
dump_d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_TXF
);

134 (*
dump_d©a
)->
Àn
 = 
	`˝u_to_À32
(
fifo_Àn
 + (*
fifo_hdr
));

136 
fifo_hdr
->
fifo_num
 = 
	`˝u_to_À32
(fifo_num);

137 
fifo_hdr
->
avaûabÀ_byãs
 =

138 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

139 
TXF_FIFO_ITEM_CNT
 + 
off£t
));

140 
fifo_hdr
->
wr_±r
 =

141 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

142 
TXF_WR_PTR
 + 
off£t
));

143 
fifo_hdr
->
rd_±r
 =

144 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

145 
TXF_RD_PTR
 + 
off£t
));

146 
fifo_hdr
->
„n˚_±r
 =

147 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

148 
TXF_FENCE_PTR
 + 
off£t
));

149 
fifo_hdr
->
„n˚_mode
 =

150 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

151 
TXF_LOCK_FENCE
 + 
off£t
));

154 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
, 
TXF_READ_MODIFY_ADDR
 + 
off£t
,

155 
TXF_WR_PTR
 + 
off£t
);

158 
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
, 
TXF_READ_MODIFY_DATA
 + 
off£t
);

161 
i
 = 0; i < 
fifo_Àn
 / (
u32
); i++)

162 
fifo_d©a
[
i
] = 
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

163 
TXF_READ_MODIFY_DATA
 +

164 
off£t
);

166 i‡(
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_txf
)

167 
fwπ
->
ßnôize_›s
->
	`‰ob_txf
(fwπ->
ßnôize_˘x
,

168 
fifo_d©a
, 
fifo_Àn
);

170 *
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*dump_data);

171 
	}
}

173 
	$iwl_fw_dump_rxf
(
iwl_fw_ru¡ime
 *
fwπ
,

174 
iwl_fw_îr‹_dump_d©a
 **
dump_d©a
)

176 
iwl_fwπ_sh¨ed_mem_cfg
 *
cfg
 = &
fwπ
->
smem_cfg
;

178 
	`IWL_DEBUG_INFO
(
fwπ
, "WRT RX FIFO dump\n");

180 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

183 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_RXF
)) {

185 
	`iwl_fwπ_dump_rxf
(
fwπ
, 
dump_d©a
,

186 
cfg
->
lmac
[0].
rxfifo1_size
, 0, 0);

188 
	`iwl_fwπ_dump_rxf
(
fwπ
, 
dump_d©a
, 
cfg
->
rxfifo2_size
,

189 
RXF_DIFF_FROM_PREV
 +

190 
fwπ
->
å™s
->
å™s_cfg
->
umac_¥ph_off£t
, 1);

192 i‡(
fwπ
->
smem_cfg
.
num_lmacs
 > 1)

193 
	`iwl_fwπ_dump_rxf
(
fwπ
, 
dump_d©a
,

194 
cfg
->
lmac
[1].
rxfifo1_size
,

195 
LMAC2_PRPH_OFFSET
, 2);

198 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

199 
	}
}

201 
	$iwl_fw_dump_txf
(
iwl_fw_ru¡ime
 *
fwπ
,

202 
iwl_fw_îr‹_dump_d©a
 **
dump_d©a
)

204 
iwl_fw_îr‹_dump_fifo
 *
fifo_hdr
;

205 
iwl_fwπ_sh¨ed_mem_cfg
 *
cfg
 = &
fwπ
->
smem_cfg
;

206 
u32
 *
fifo_d©a
;

207 
u32
 
fifo_Àn
;

208 
i
, 
j
;

210 
	`IWL_DEBUG_INFO
(
fwπ
, "WRT TX FIFO dump\n");

212 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

215 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_TXF
)) {

217 
i
 = 0; i < 
fwπ
->
smem_cfg
.
num_txfifo_íåõs
; i++) {

219 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
, 
TXF_LARC_NUM
, 
i
);

220 
	`iwl_fwπ_dump_txf
(
fwπ
, 
dump_d©a
,

221 
cfg
->
lmac
[0].
txfifo_size
[
i
], 0, i);

225 i‡(
fwπ
->
smem_cfg
.
num_lmacs
 > 1) {

226 
i
 = 0; i < 
fwπ
->
smem_cfg
.
num_txfifo_íåõs
;

227 
i
++) {

229 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
,

230 
TXF_LARC_NUM
 +

231 
LMAC2_PRPH_OFFSET
, 
i
);

232 
	`iwl_fwπ_dump_txf
(
fwπ
, 
dump_d©a
,

233 
cfg
->
lmac
[1].
txfifo_size
[
i
],

234 
LMAC2_PRPH_OFFSET
,

235 
i
 + 
cfg
->
num_txfifo_íåõs
);

240 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_INTERNAL_TXF
) &&

241 
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

242 
IWL_UCODE_TLV_CAPA_EXTEND_SHARED_MEM_CFG
)) {

244 
i
 = 0;

245 
i
 < 
	`ARRAY_SIZE
(
fwπ
->
smem_cfg
.
öã∫Æ_txfifo_size
);

246 
i
++) {

247 
fifo_hdr
 = (*)(*
dump_d©a
)->
d©a
;

248 
fifo_d©a
 = (*)
fifo_hdr
->
d©a
;

249 
fifo_Àn
 = 
fwπ
->
smem_cfg
.
öã∫Æ_txfifo_size
[
i
];

252 i‡(
fifo_Àn
 == 0)

256 (*
dump_d©a
)->
ty≥
 =

257 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_INTERNAL_TXF
);

258 (*
dump_d©a
)->
Àn
 =

259 
	`˝u_to_À32
(
fifo_Àn
 + (*
fifo_hdr
));

261 
fifo_hdr
->
fifo_num
 = 
	`˝u_to_À32
(
i
);

264 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
, 
TXF_CPU2_NUM
, 
i
 +

265 
fwπ
->
smem_cfg
.
num_txfifo_íåõs
);

267 
fifo_hdr
->
avaûabÀ_byãs
 =

268 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

269 
TXF_CPU2_FIFO_ITEM_CNT
));

270 
fifo_hdr
->
wr_±r
 =

271 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

272 
TXF_CPU2_WR_PTR
));

273 
fifo_hdr
->
rd_±r
 =

274 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

275 
TXF_CPU2_RD_PTR
));

276 
fifo_hdr
->
„n˚_±r
 =

277 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

278 
TXF_CPU2_FENCE_PTR
));

279 
fifo_hdr
->
„n˚_mode
 =

280 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

281 
TXF_CPU2_LOCK_FENCE
));

284 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
,

285 
TXF_CPU2_READ_MODIFY_ADDR
,

286 
TXF_CPU2_WR_PTR
);

289 
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

290 
TXF_CPU2_READ_MODIFY_DATA
);

293 
fifo_Àn
 /(
u32
);

294 
j
 = 0; j < 
fifo_Àn
; j++)

295 
fifo_d©a
[
j
] =

296 
	`iwl_å™s_ªad_¥ph
(
fwπ
->
å™s
,

297 
TXF_CPU2_READ_MODIFY_DATA
);

298 *
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*dump_data);

302 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

303 
	}
}

305 
	siwl_¥ph_ønge
 {

306 
u32
 
	m°¨t
, 
	míd
;

309 c⁄° 
iwl_¥ph_ønge
 
	giwl_¥ph_dump_addr_comm
[] = {

310 { .
°¨t
 = 0x00a00000, .
	gíd
 = 0x00a00000 },

311 { .
	g°¨t
 = 0x00a0000c, .
	gíd
 = 0x00a00024 },

312 { .
	g°¨t
 = 0x00a0002c, .
	gíd
 = 0x00a0003c },

313 { .
	g°¨t
 = 0x00a00410, .
	gíd
 = 0x00a00418 },

314 { .
	g°¨t
 = 0x00a00420, .
	gíd
 = 0x00a00420 },

315 { .
	g°¨t
 = 0x00a00428, .
	gíd
 = 0x00a00428 },

316 { .
	g°¨t
 = 0x00a00430, .
	gíd
 = 0x00a0043c },

317 { .
	g°¨t
 = 0x00a00444, .
	gíd
 = 0x00a00444 },

318 { .
	g°¨t
 = 0x00a004c0, .
	gíd
 = 0x00a004cc },

319 { .
	g°¨t
 = 0x00a004d8, .
	gíd
 = 0x00a004d8 },

320 { .
	g°¨t
 = 0x00a004e0, .
	gíd
 = 0x00a004f0 },

321 { .
	g°¨t
 = 0x00a00840, .
	gíd
 = 0x00a00840 },

322 { .
	g°¨t
 = 0x00a00850, .
	gíd
 = 0x00a00858 },

323 { .
	g°¨t
 = 0x00a01004, .
	gíd
 = 0x00a01008 },

324 { .
	g°¨t
 = 0x00a01010, .
	gíd
 = 0x00a01010 },

325 { .
	g°¨t
 = 0x00a01018, .
	gíd
 = 0x00a01018 },

326 { .
	g°¨t
 = 0x00a01024, .
	gíd
 = 0x00a01024 },

327 { .
	g°¨t
 = 0x00a0102c, .
	gíd
 = 0x00a01034 },

328 { .
	g°¨t
 = 0x00a0103c, .
	gíd
 = 0x00a01040 },

329 { .
	g°¨t
 = 0x00a01048, .
	gíd
 = 0x00a01094 },

330 { .
	g°¨t
 = 0x00a01c00, .
	gíd
 = 0x00a01c20 },

331 { .
	g°¨t
 = 0x00a01c58, .
	gíd
 = 0x00a01c58 },

332 { .
	g°¨t
 = 0x00a01c7c, .
	gíd
 = 0x00a01c7c },

333 { .
	g°¨t
 = 0x00a01c28, .
	gíd
 = 0x00a01c54 },

334 { .
	g°¨t
 = 0x00a01c5c, .
	gíd
 = 0x00a01c5c },

335 { .
	g°¨t
 = 0x00a01c60, .
	gíd
 = 0x00a01cdc },

336 { .
	g°¨t
 = 0x00a01˚0, .
	gíd
 = 0x00a01d0c },

337 { .
	g°¨t
 = 0x00a01d18, .
	gíd
 = 0x00a01d20 },

338 { .
	g°¨t
 = 0x00a01d2c, .
	gíd
 = 0x00a01d30 },

339 { .
	g°¨t
 = 0x00a01d40, .
	gíd
 = 0x00a01d5c },

340 { .
	g°¨t
 = 0x00a01d80, .
	gíd
 = 0x00a01d80 },

341 { .
	g°¨t
 = 0x00a01d98, .
	gíd
 = 0x00a01d9c },

342 { .
	g°¨t
 = 0x00a01da8, .
	gíd
 = 0x00a01da8 },

343 { .
	g°¨t
 = 0x00a01db8, .
	gíd
 = 0x00a01df4 },

344 { .
	g°¨t
 = 0x00a01dc0, .
	gíd
 = 0x00a01dfc },

345 { .
	g°¨t
 = 0x00a01e00, .
	gíd
 = 0x00a01e2c },

346 { .
	g°¨t
 = 0x00a01e40, .
	gíd
 = 0x00a01e60 },

347 { .
	g°¨t
 = 0x00a01e68, .
	gíd
 = 0x00a01e6c },

348 { .
	g°¨t
 = 0x00a01e74, .
	gíd
 = 0x00a01e74 },

349 { .
	g°¨t
 = 0x00a01e84, .
	gíd
 = 0x00a01e90 },

350 { .
	g°¨t
 = 0x00a01e9c, .
	gíd
 = 0x00a01ec4 },

351 { .
	g°¨t
 = 0x00a01ed0, .
	gíd
 = 0x00a01ee0 },

352 { .
	g°¨t
 = 0x00a01f00, .
	gíd
 = 0x00a01f1c },

353 { .
	g°¨t
 = 0x00a01f44, .
	gíd
 = 0x00a01ffc },

354 { .
	g°¨t
 = 0x00a02000, .
	gíd
 = 0x00a02048 },

355 { .
	g°¨t
 = 0x00a02068, .
	gíd
 = 0x00a020f0 },

356 { .
	g°¨t
 = 0x00a02100, .
	gíd
 = 0x00a02118 },

357 { .
	g°¨t
 = 0x00a02140, .
	gíd
 = 0x00a0214c },

358 { .
	g°¨t
 = 0x00a02168, .
	gíd
 = 0x00a0218c },

359 { .
	g°¨t
 = 0x00a021c0, .
	gíd
 = 0x00a021c0 },

360 { .
	g°¨t
 = 0x00a02400, .
	gíd
 = 0x00a02410 },

361 { .
	g°¨t
 = 0x00a02418, .
	gíd
 = 0x00a02420 },

362 { .
	g°¨t
 = 0x00a02428, .
	gíd
 = 0x00a0242c },

363 { .
	g°¨t
 = 0x00a02434, .
	gíd
 = 0x00a02434 },

364 { .
	g°¨t
 = 0x00a02440, .
	gíd
 = 0x00a02460 },

365 { .
	g°¨t
 = 0x00a02468, .
	gíd
 = 0x00a024b0 },

366 { .
	g°¨t
 = 0x00a024c8, .
	gíd
 = 0x00a024cc },

367 { .
	g°¨t
 = 0x00a02500, .
	gíd
 = 0x00a02504 },

368 { .
	g°¨t
 = 0x00a0250c, .
	gíd
 = 0x00a02510 },

369 { .
	g°¨t
 = 0x00a02540, .
	gíd
 = 0x00a02554 },

370 { .
	g°¨t
 = 0x00a02580, .
	gíd
 = 0x00a025f4 },

371 { .
	g°¨t
 = 0x00a02600, .
	gíd
 = 0x00a0260c },

372 { .
	g°¨t
 = 0x00a02648, .
	gíd
 = 0x00a02650 },

373 { .
	g°¨t
 = 0x00a02680, .
	gíd
 = 0x00a02680 },

374 { .
	g°¨t
 = 0x00a026c0, .
	gíd
 = 0x00a026d0 },

375 { .
	g°¨t
 = 0x00a02700, .
	gíd
 = 0x00a0270c },

376 { .
	g°¨t
 = 0x00a02804, .
	gíd
 = 0x00a02804 },

377 { .
	g°¨t
 = 0x00a02818, .
	gíd
 = 0x00a0281c },

378 { .
	g°¨t
 = 0x00a02c00, .
	gíd
 = 0x00a02db4 },

379 { .
	g°¨t
 = 0x00a02df4, .
	gíd
 = 0x00a02fb0 },

380 { .
	g°¨t
 = 0x00a03000, .
	gíd
 = 0x00a03014 },

381 { .
	g°¨t
 = 0x00a0301c, .
	gíd
 = 0x00a0302c },

382 { .
	g°¨t
 = 0x00a03034, .
	gíd
 = 0x00a03038 },

383 { .
	g°¨t
 = 0x00a03040, .
	gíd
 = 0x00a03048 },

384 { .
	g°¨t
 = 0x00a03060, .
	gíd
 = 0x00a03068 },

385 { .
	g°¨t
 = 0x00a03070, .
	gíd
 = 0x00a03074 },

386 { .
	g°¨t
 = 0x00a0307c, .
	gíd
 = 0x00a0307c },

387 { .
	g°¨t
 = 0x00a03080, .
	gíd
 = 0x00a03084 },

388 { .
	g°¨t
 = 0x00a0308c, .
	gíd
 = 0x00a03090 },

389 { .
	g°¨t
 = 0x00a03098, .
	gíd
 = 0x00a03098 },

390 { .
	g°¨t
 = 0x00a030a0, .
	gíd
 = 0x00a030a0 },

391 { .
	g°¨t
 = 0x00a030a8, .
	gíd
 = 0x00a030b4 },

392 { .
	g°¨t
 = 0x00a030bc, .
	gíd
 = 0x00a030bc },

393 { .
	g°¨t
 = 0x00a030c0, .
	gíd
 = 0x00a0312c },

394 { .
	g°¨t
 = 0x00a03c00, .
	gíd
 = 0x00a03c5c },

395 { .
	g°¨t
 = 0x00a04400, .
	gíd
 = 0x00a04454 },

396 { .
	g°¨t
 = 0x00a04460, .
	gíd
 = 0x00a04474 },

397 { .
	g°¨t
 = 0x00a044c0, .
	gíd
 = 0x00a044ec },

398 { .
	g°¨t
 = 0x00a04500, .
	gíd
 = 0x00a04504 },

399 { .
	g°¨t
 = 0x00a04510, .
	gíd
 = 0x00a04538 },

400 { .
	g°¨t
 = 0x00a04540, .
	gíd
 = 0x00a04548 },

401 { .
	g°¨t
 = 0x00a04560, .
	gíd
 = 0x00a0457c },

402 { .
	g°¨t
 = 0x00a04590, .
	gíd
 = 0x00a04598 },

403 { .
	g°¨t
 = 0x00a045c0, .
	gíd
 = 0x00a045f4 },

406 c⁄° 
iwl_¥ph_ønge
 
	giwl_¥ph_dump_addr_9000
[] = {

407 { .
°¨t
 = 0x00a05c00, .
	gíd
 = 0x00a05c18 },

408 { .
	g°¨t
 = 0x00a05400, .
	gíd
 = 0x00a056e8 },

409 { .
	g°¨t
 = 0x00a08000, .
	gíd
 = 0x00a098bc },

410 { .
	g°¨t
 = 0x00a02400, .
	gíd
 = 0x00a02758 },

411 { .
	g°¨t
 = 0x00a04764, .
	gíd
 = 0x00a0476c },

412 { .
	g°¨t
 = 0x00a04770, .
	gíd
 = 0x00a04774 },

413 { .
	g°¨t
 = 0x00a04620, .
	gíd
 = 0x00a04624 },

416 c⁄° 
iwl_¥ph_ønge
 
	giwl_¥ph_dump_addr_22000
[] = {

417 { .
°¨t
 = 0x00a00000, .
	gíd
 = 0x00a00000 },

418 { .
	g°¨t
 = 0x00a0000c, .
	gíd
 = 0x00a00024 },

419 { .
	g°¨t
 = 0x00a0002c, .
	gíd
 = 0x00a00034 },

420 { .
	g°¨t
 = 0x00a0003c, .
	gíd
 = 0x00a0003c },

421 { .
	g°¨t
 = 0x00a00410, .
	gíd
 = 0x00a00418 },

422 { .
	g°¨t
 = 0x00a00420, .
	gíd
 = 0x00a00420 },

423 { .
	g°¨t
 = 0x00a00428, .
	gíd
 = 0x00a00428 },

424 { .
	g°¨t
 = 0x00a00430, .
	gíd
 = 0x00a0043c },

425 { .
	g°¨t
 = 0x00a00444, .
	gíd
 = 0x00a00444 },

426 { .
	g°¨t
 = 0x00a00840, .
	gíd
 = 0x00a00840 },

427 { .
	g°¨t
 = 0x00a00850, .
	gíd
 = 0x00a00858 },

428 { .
	g°¨t
 = 0x00a01004, .
	gíd
 = 0x00a01008 },

429 { .
	g°¨t
 = 0x00a01010, .
	gíd
 = 0x00a01010 },

430 { .
	g°¨t
 = 0x00a01018, .
	gíd
 = 0x00a01018 },

431 { .
	g°¨t
 = 0x00a01024, .
	gíd
 = 0x00a01024 },

432 { .
	g°¨t
 = 0x00a0102c, .
	gíd
 = 0x00a01034 },

433 { .
	g°¨t
 = 0x00a0103c, .
	gíd
 = 0x00a01040 },

434 { .
	g°¨t
 = 0x00a01048, .
	gíd
 = 0x00a01050 },

435 { .
	g°¨t
 = 0x00a01058, .
	gíd
 = 0x00a01058 },

436 { .
	g°¨t
 = 0x00a01060, .
	gíd
 = 0x00a01070 },

437 { .
	g°¨t
 = 0x00a0108c, .
	gíd
 = 0x00a0108c },

438 { .
	g°¨t
 = 0x00a01c20, .
	gíd
 = 0x00a01c28 },

439 { .
	g°¨t
 = 0x00a01d10, .
	gíd
 = 0x00a01d10 },

440 { .
	g°¨t
 = 0x00a01e28, .
	gíd
 = 0x00a01e2c },

441 { .
	g°¨t
 = 0x00a01e60, .
	gíd
 = 0x00a01e60 },

442 { .
	g°¨t
 = 0x00a01e80, .
	gíd
 = 0x00a01e80 },

443 { .
	g°¨t
 = 0x00a01ó0, .
	gíd
 = 0x00a01ea0 },

444 { .
	g°¨t
 = 0x00a02000, .
	gíd
 = 0x00a0201c },

445 { .
	g°¨t
 = 0x00a02024, .
	gíd
 = 0x00a02024 },

446 { .
	g°¨t
 = 0x00a02040, .
	gíd
 = 0x00a02048 },

447 { .
	g°¨t
 = 0x00a020c0, .
	gíd
 = 0x00a020e0 },

448 { .
	g°¨t
 = 0x00a02400, .
	gíd
 = 0x00a02404 },

449 { .
	g°¨t
 = 0x00a0240c, .
	gíd
 = 0x00a02414 },

450 { .
	g°¨t
 = 0x00a0241c, .
	gíd
 = 0x00a0243c },

451 { .
	g°¨t
 = 0x00a02448, .
	gíd
 = 0x00a024bc },

452 { .
	g°¨t
 = 0x00a024c4, .
	gíd
 = 0x00a024cc },

453 { .
	g°¨t
 = 0x00a02508, .
	gíd
 = 0x00a02508 },

454 { .
	g°¨t
 = 0x00a02510, .
	gíd
 = 0x00a02514 },

455 { .
	g°¨t
 = 0x00a0251c, .
	gíd
 = 0x00a0251c },

456 { .
	g°¨t
 = 0x00a0252c, .
	gíd
 = 0x00a0255c },

457 { .
	g°¨t
 = 0x00a02564, .
	gíd
 = 0x00a025a0 },

458 { .
	g°¨t
 = 0x00a025a8, .
	gíd
 = 0x00a025b4 },

459 { .
	g°¨t
 = 0x00a025c0, .
	gíd
 = 0x00a025c0 },

460 { .
	g°¨t
 = 0x00a025e8, .
	gíd
 = 0x00a025f4 },

461 { .
	g°¨t
 = 0x00a02c08, .
	gíd
 = 0x00a02c18 },

462 { .
	g°¨t
 = 0x00a02c2c, .
	gíd
 = 0x00a02c38 },

463 { .
	g°¨t
 = 0x00a02c68, .
	gíd
 = 0x00a02c78 },

464 { .
	g°¨t
 = 0x00a03000, .
	gíd
 = 0x00a03000 },

465 { .
	g°¨t
 = 0x00a03010, .
	gíd
 = 0x00a03014 },

466 { .
	g°¨t
 = 0x00a0301c, .
	gíd
 = 0x00a0302c },

467 { .
	g°¨t
 = 0x00a03034, .
	gíd
 = 0x00a03038 },

468 { .
	g°¨t
 = 0x00a03040, .
	gíd
 = 0x00a03044 },

469 { .
	g°¨t
 = 0x00a03060, .
	gíd
 = 0x00a03068 },

470 { .
	g°¨t
 = 0x00a03070, .
	gíd
 = 0x00a03070 },

471 { .
	g°¨t
 = 0x00a0307c, .
	gíd
 = 0x00a03084 },

472 { .
	g°¨t
 = 0x00a0308c, .
	gíd
 = 0x00a03090 },

473 { .
	g°¨t
 = 0x00a03098, .
	gíd
 = 0x00a03098 },

474 { .
	g°¨t
 = 0x00a030a0, .
	gíd
 = 0x00a030a0 },

475 { .
	g°¨t
 = 0x00a030a8, .
	gíd
 = 0x00a030b4 },

476 { .
	g°¨t
 = 0x00a030bc, .
	gíd
 = 0x00a030c0 },

477 { .
	g°¨t
 = 0x00a030c8, .
	gíd
 = 0x00a030f4 },

478 { .
	g°¨t
 = 0x00a03100, .
	gíd
 = 0x00a0312c },

479 { .
	g°¨t
 = 0x00a03c00, .
	gíd
 = 0x00a03c5c },

480 { .
	g°¨t
 = 0x00a04400, .
	gíd
 = 0x00a04454 },

481 { .
	g°¨t
 = 0x00a04460, .
	gíd
 = 0x00a04474 },

482 { .
	g°¨t
 = 0x00a044c0, .
	gíd
 = 0x00a044ec },

483 { .
	g°¨t
 = 0x00a04500, .
	gíd
 = 0x00a04504 },

484 { .
	g°¨t
 = 0x00a04510, .
	gíd
 = 0x00a04538 },

485 { .
	g°¨t
 = 0x00a04540, .
	gíd
 = 0x00a04548 },

486 { .
	g°¨t
 = 0x00a04560, .
	gíd
 = 0x00a04560 },

487 { .
	g°¨t
 = 0x00a04570, .
	gíd
 = 0x00a0457c },

488 { .
	g°¨t
 = 0x00a04590, .
	gíd
 = 0x00a04590 },

489 { .
	g°¨t
 = 0x00a04598, .
	gíd
 = 0x00a04598 },

490 { .
	g°¨t
 = 0x00a045c0, .
	gíd
 = 0x00a045f4 },

491 { .
	g°¨t
 = 0x00a05c18, .
	gíd
 = 0x00a05c1c },

492 { .
	g°¨t
 = 0x00a0c000, .
	gíd
 = 0x00a0c018 },

493 { .
	g°¨t
 = 0x00a0c020, .
	gíd
 = 0x00a0c028 },

494 { .
	g°¨t
 = 0x00a0c038, .
	gíd
 = 0x00a0c094 },

495 { .
	g°¨t
 = 0x00a0c0c0, .
	gíd
 = 0x00a0c104 },

496 { .
	g°¨t
 = 0x00a0c10c, .
	gíd
 = 0x00a0c118 },

497 { .
	g°¨t
 = 0x00a0c150, .
	gíd
 = 0x00a0c174 },

498 { .
	g°¨t
 = 0x00a0c17c, .
	gíd
 = 0x00a0c188 },

499 { .
	g°¨t
 = 0x00a0c190, .
	gíd
 = 0x00a0c198 },

500 { .
	g°¨t
 = 0x00a0c1a0, .
	gíd
 = 0x00a0c1a8 },

501 { .
	g°¨t
 = 0x00a0c1b0, .
	gíd
 = 0x00a0c1b8 },

504 c⁄° 
iwl_¥ph_ønge
 
	giwl_¥ph_dump_addr_ax210
[] = {

505 { .
°¨t
 = 0x00d03c00, .
	gíd
 = 0x00d03c64 },

506 { .
	g°¨t
 = 0x00d05c18, .
	gíd
 = 0x00d05c1c },

507 { .
	g°¨t
 = 0x00d0c000, .
	gíd
 = 0x00d0c174 },

510 
	$iwl_ªad_¥ph_block
(
iwl_å™s
 *
å™s
, 
u32
 
°¨t
,

511 
u32
 
Àn_byãs
, 
__À32
 *
d©a
)

513 
u32
 
i
;

515 
i
 = 0; i < 
Àn_byãs
; i += 4)

516 *
d©a
++ = 
	`˝u_to_À32
(
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
°¨t
 + 
i
));

517 
	}
}

519 
	$iwl_dump_¥ph
(
iwl_fw_ru¡ime
 *
fwπ
,

520 c⁄° 
iwl_¥ph_ønge
 *
iwl_¥ph_dump_addr
,

521 
u32
 
ønge_Àn
, *
±r
)

523 
iwl_fw_îr‹_dump_¥ph
 *
¥ph
;

524 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

525 
iwl_fw_îr‹_dump_d©a
 **
d©a
 =

526 (
iwl_fw_îr‹_dump_d©a
 **)
±r
;

527 
u32
 
i
;

529 i‡(!
d©a
)

532 
	`IWL_DEBUG_INFO
(
å™s
, "WRT PRPH dump\n");

534 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

537 
i
 = 0; i < 
ønge_Àn
; i++) {

539 
num_byãs_ö_chunk
 = 
iwl_¥ph_dump_addr
[
i
].
íd
 -

540 
iwl_¥ph_dump_addr
[
i
].
°¨t
 + 4;

542 (*
d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_PRPH
);

543 (*
d©a
)->
Àn
 = 
	`˝u_to_À32
((*
¥ph
) +

544 
num_byãs_ö_chunk
);

545 
¥ph
 = (*)(*
d©a
)->data;

546 
¥ph
->
¥ph_°¨t
 = 
	`˝u_to_À32
(
iwl_¥ph_dump_addr
[
i
].
°¨t
);

548 
	`iwl_ªad_¥ph_block
(
å™s
, 
iwl_¥ph_dump_addr
[
i
].
°¨t
,

550 
iwl_¥ph_dump_addr
[
i
].
íd
 -

551 
iwl_¥ph_dump_addr
[
i
].
°¨t
 + 4,

552 (*)
¥ph
->
d©a
);

554 *
d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*data);

557 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

558 
	}
}

565 
sˇâîli°
 *
	$Æloc_sgèbÀ
(
size
)

567 
Æloc_size
, 
√¡s
, 
i
;

568 
∑ge
 *
√w_∑ge
;

569 
sˇâîli°
 *
ôî
;

570 
sˇâîli°
 *
èbÀ
;

572 
√¡s
 = 
	`DIV_ROUND_UP
(
size
, 
PAGE_SIZE
);

573 
èbÀ
 = 
	`kˇŒoc
(
√¡s
, (*èbÀ), 
GFP_KERNEL
);

574 i‡(!
èbÀ
)

575  
NULL
;

576 
	`sg_öô_èbÀ
(
èbÀ
, 
√¡s
);

577 
ôî
 = 
èbÀ
;

578 
	`f‹_óch_sg
(
èbÀ
, 
ôî
, 
	`sg_√¡s
—abÀ), 
i
) {

579 
√w_∑ge
 = 
	`Æloc_∑ge
(
GFP_KERNEL
);

580 i‡(!
√w_∑ge
) {

582 
ôî
 = 
èbÀ
;

583 
	`f‹_óch_sg
(
èbÀ
, 
ôî
, 
	`sg_√¡s
—abÀ), 
i
) {

584 
√w_∑ge
 = 
	`sg_∑ge
(
ôî
);

585 i‡(
√w_∑ge
)

586 
	`__‰ì_∑ge
(
√w_∑ge
);

588 
	`k‰ì
(
èbÀ
);

589  
NULL
;

591 
Æloc_size
 = 
	`mö_t
(, 
size
, 
PAGE_SIZE
);

592 
size
 -
PAGE_SIZE
;

593 
	`sg_£t_∑ge
(
ôî
, 
√w_∑ge
, 
Æloc_size
, 0);

595  
èbÀ
;

596 
	}
}

598 
	$iwl_fw_gë_¥ph_Àn
(
iwl_fw_ru¡ime
 *
fwπ
,

599 c⁄° 
iwl_¥ph_ønge
 *
iwl_¥ph_dump_addr
,

600 
u32
 
ønge_Àn
, *
±r
)

602 
u32
 *
¥ph_Àn
 = (u32 *)
±r
;

603 
i
, 
num_byãs_ö_chunk
;

605 i‡(!
¥ph_Àn
)

608 
i
 = 0; i < 
ønge_Àn
; i++) {

610 
num_byãs_ö_chunk
 =

611 
iwl_¥ph_dump_addr
[
i
].
íd
 -

612 
iwl_¥ph_dump_addr
[
i
].
°¨t
 + 4;

614 *
¥ph_Àn
 +(
iwl_fw_îr‹_dump_d©a
) +

615 (
iwl_fw_îr‹_dump_¥ph
) +

616 
num_byãs_ö_chunk
;

618 
	}
}

620 
	$iwl_fw_¥ph_h™dÀr
(
iwl_fw_ru¡ime
 *
fwπ
, *
±r
,

621 (*
h™dÀr
)(
iwl_fw_ru¡ime
 *,

622 c⁄° 
iwl_¥ph_ønge
 *,

623 
u32
, *))

625 
u32
 
ønge_Àn
;

627 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

628 
ønge_Àn
 = 
	`ARRAY_SIZE
(
iwl_¥ph_dump_addr_ax210
);

629 
	`h™dÀr
(
fwπ
, 
iwl_¥ph_dump_addr_ax210
, 
ønge_Àn
, 
±r
);

630 } i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

631 
IWL_DEVICE_FAMILY_22000
) {

632 
ønge_Àn
 = 
	`ARRAY_SIZE
(
iwl_¥ph_dump_addr_22000
);

633 
	`h™dÀr
(
fwπ
, 
iwl_¥ph_dump_addr_22000
, 
ønge_Àn
, 
±r
);

635 
ønge_Àn
 = 
	`ARRAY_SIZE
(
iwl_¥ph_dump_addr_comm
);

636 
	`h™dÀr
(
fwπ
, 
iwl_¥ph_dump_addr_comm
, 
ønge_Àn
, 
±r
);

638 i‡(
fwπ
->
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
) {

639 
ønge_Àn
 = 
	`ARRAY_SIZE
(
iwl_¥ph_dump_addr_9000
);

640 
	`h™dÀr
(
fwπ
, 
iwl_¥ph_dump_addr_9000
, 
ønge_Àn
, 
±r
);

643 
	}
}

645 
	$iwl_fw_dump_mem
(
iwl_fw_ru¡ime
 *
fwπ
,

646 
iwl_fw_îr‹_dump_d©a
 **
dump_d©a
,

647 
u32
 
Àn
, u32 
ofs
, u32 
ty≥
)

649 
iwl_fw_îr‹_dump_mem
 *
dump_mem
;

651 i‡(!
Àn
)

654 (*
dump_d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_MEM
);

655 (*
dump_d©a
)->
Àn
 = 
	`˝u_to_À32
÷í + (*
dump_mem
));

656 
dump_mem
 = (*)(*
dump_d©a
)->
d©a
;

657 
dump_mem
->
ty≥
 = 
	`˝u_to_À32
(type);

658 
dump_mem
->
off£t
 = 
	`˝u_to_À32
(
ofs
);

659 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
ofs
, 
dump_mem
->
d©a
, 
Àn
);

660 *
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*dump_data);

662 i‡(
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_mem
)

663 
fwπ
->
ßnôize_›s
->
	`‰ob_mem
(fwπ->
ßnôize_˘x
, 
ofs
,

664 
dump_mem
->
d©a
, 
Àn
);

666 
	`IWL_DEBUG_INFO
(
fwπ
, "WRT mem‹y dump. Ty≥=%u\n", 
dump_mem
->
ty≥
);

667 
	}
}

669 
	#ADD_LEN
(
Àn
, 
ôem_Àn
, 
c⁄°_Àn
) \

670 dÿ{
size_t
 
ôem
 = 
ôem_Àn
; 
Àn
 +(!!ôemË* 
c⁄°_Àn
 + item; } \

671 0)

	)

673 
	$iwl_fw_rxf_Àn
(
iwl_fw_ru¡ime
 *
fwπ
,

674 
iwl_fwπ_sh¨ed_mem_cfg
 *
mem_cfg
)

676 
size_t
 
hdr_Àn
 = (
iwl_fw_îr‹_dump_d©a
) +

677 (
iwl_fw_îr‹_dump_fifo
);

678 
u32
 
fifo_Àn
 = 0;

679 
i
;

681 i‡(!
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_RXF
))

685 
	`ADD_LEN
(
fifo_Àn
, 
mem_cfg
->
rxfifo2_size
, 
hdr_Àn
);

688 i‡(
	`WARN_ON
(
mem_cfg
->
num_lmacs
 > 
MAX_NUM_LMAC
))

689 
mem_cfg
->
num_lmacs
 = 
MAX_NUM_LMAC
;

691 
i
 = 0; i < 
mem_cfg
->
num_lmacs
; i++)

692 
	`ADD_LEN
(
fifo_Àn
, 
mem_cfg
->
lmac
[
i
].
rxfifo1_size
, 
hdr_Àn
);

694  
fifo_Àn
;

695 
	}
}

697 
	$iwl_fw_txf_Àn
(
iwl_fw_ru¡ime
 *
fwπ
,

698 
iwl_fwπ_sh¨ed_mem_cfg
 *
mem_cfg
)

700 
size_t
 
hdr_Àn
 = (
iwl_fw_îr‹_dump_d©a
) +

701 (
iwl_fw_îr‹_dump_fifo
);

702 
u32
 
fifo_Àn
 = 0;

703 
i
;

705 i‡(!
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_TXF
))

706 
dump_öã∫Æ_txf
;

709 i‡(
	`WARN_ON
(
mem_cfg
->
num_lmacs
 > 
MAX_NUM_LMAC
))

710 
mem_cfg
->
num_lmacs
 = 
MAX_NUM_LMAC
;

712 
i
 = 0; i < 
mem_cfg
->
num_lmacs
; i++) {

713 
j
;

715 
j
 = 0; j < 
mem_cfg
->
num_txfifo_íåõs
; j++)

716 
	`ADD_LEN
(
fifo_Àn
, 
mem_cfg
->
lmac
[
i
].
txfifo_size
[
j
],

717 
hdr_Àn
);

720 
dump_öã∫Æ_txf
:

721 i‡(!(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_INTERNAL_TXF
) &&

722 
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

723 
IWL_UCODE_TLV_CAPA_EXTEND_SHARED_MEM_CFG
)))

724 
out
;

726 
i
 = 0; i < 
	`ARRAY_SIZE
(
mem_cfg
->
öã∫Æ_txfifo_size
); i++)

727 
	`ADD_LEN
(
fifo_Àn
, 
mem_cfg
->
öã∫Æ_txfifo_size
[
i
], 
hdr_Àn
);

729 
out
:

730  
fifo_Àn
;

731 
	}
}

733 
	$iwl_dump_∑gög
(
iwl_fw_ru¡ime
 *
fwπ
,

734 
iwl_fw_îr‹_dump_d©a
 **
d©a
)

736 
i
;

738 
	`IWL_DEBUG_INFO
(
fwπ
, "WRTÖaging dump\n");

739 
i
 = 1; i < 
fwπ
->
num_of_∑gög_blk
 + 1; i++) {

740 
iwl_fw_îr‹_dump_∑gög
 *
∑gög
;

741 
∑ge
 *
∑ges
 =

742 
fwπ
->
fw_∑gög_db
[
i
].
fw_∑gög_block
;

743 
dma_addr_t
 
addr
 = 
fwπ
->
fw_∑gög_db
[
i
].
fw_∑gög_phys
;

745 (*
d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_PAGING
);

746 (*
d©a
)->
Àn
 = 
	`˝u_to_À32
((*
∑gög
) +

747 
PAGING_BLOCK_SIZE
);

748 
∑gög
 = (*)(*
d©a
)->data;

749 
∑gög
->
ödex
 = 
	`˝u_to_À32
(
i
);

750 
	`dma_sync_sögÀ_f‹_˝u
(
fwπ
->
å™s
->
dev
, 
addr
,

751 
PAGING_BLOCK_SIZE
,

752 
DMA_BIDIRECTIONAL
);

753 
	`mem˝y
(
∑gög
->
d©a
, 
	`∑ge_addªss
(
∑ges
),

754 
PAGING_BLOCK_SIZE
);

755 
	`dma_sync_sögÀ_f‹_devi˚
(
fwπ
->
å™s
->
dev
, 
addr
,

756 
PAGING_BLOCK_SIZE
,

757 
DMA_BIDIRECTIONAL
);

758 (*
d©a
Ë
	`iwl_fw_îr‹_√xt_d©a
(*data);

760 i‡(
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_mem
)

761 
fwπ
->
ßnôize_›s
->
	`‰ob_mem
(fwπ->
ßnôize_˘x
,

762 
fwπ
->
fw_∑gög_db
[
i
].
fw_offs
,

763 
∑gög
->
d©a
,

764 
PAGING_BLOCK_SIZE
);

766 
	}
}

768 
iwl_fw_îr‹_dump_fûe
 *

769 
	$iwl_fw_îr‹_dump_fûe
(
iwl_fw_ru¡ime
 *
fwπ
,

770 
iwl_fw_dump_±rs
 *
fw_îr‹_dump
,

771 
iwl_fwπ_dump_d©a
 *
d©a
)

773 
iwl_fw_îr‹_dump_fûe
 *
dump_fûe
;

774 
iwl_fw_îr‹_dump_d©a
 *
dump_d©a
;

775 
iwl_fw_îr‹_dump_öfo
 *
dump_öfo
;

776 
iwl_fw_îr‹_dump_smem_cfg
 *
dump_smem_cfg
;

777 
iwl_fw_îr‹_dump_åiggî_desc
 *
dump_åig
;

778 
u32
 
§am_Àn
, 
§am_ofs
;

779 c⁄° 
iwl_fw_dbg_mem_£g_év
 *
fw_mem
 = 
fwπ
->
fw
->
dbg
.
mem_év
;

780 
iwl_fwπ_sh¨ed_mem_cfg
 *
mem_cfg
 = &
fwπ
->
smem_cfg
;

781 
u32
 
fûe_Àn
, 
fifo_Àn
 = 0, 
¥ph_Àn
 = 0, 
ødio_Àn
 = 0;

782 
u32
 
smem_Àn
 = 
fwπ
->
fw
->
dbg
.
n_mem_év
 ? 0 : fwπ->
å™s
->
cfg
->smem_len;

783 
u32
 
§am2_Àn
 = 
fwπ
->
fw
->
dbg
.
n_mem_év
 ?

784 0 : 
fwπ
->
å™s
->
cfg
->
dccm2_Àn
;

785 
i
;

788 i‡(!
fwπ
->
å™s
->
cfg
->
dccm_off£t
 || !fwπ->å™s->cfg->
dccm_Àn
) {

789 c⁄° 
fw_img
 *
img
;

791 i‡(
fwπ
->
cur_fw_img
 >
IWL_UCODE_TYPE_MAX
)

792  
NULL
;

793 
img
 = &
fwπ
->
fw
->img[fwπ->
cur_fw_img
];

794 
§am_ofs
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
off£t
;

795 
§am_Àn
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
Àn
;

797 
§am_ofs
 = 
fwπ
->
å™s
->
cfg
->
dccm_off£t
;

798 
§am_Àn
 = 
fwπ
->
å™s
->
cfg
->
dccm_Àn
;

802 i‡(
	`ã°_bô
(
STATUS_FW_ERROR
, &
fwπ
->
å™s
->
°©us
)) {

803 
fifo_Àn
 = 
	`iwl_fw_rxf_Àn
(
fwπ
, 
mem_cfg
);

804 
fifo_Àn
 +
	`iwl_fw_txf_Àn
(
fwπ
, 
mem_cfg
);

807 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_PRPH
))

808 
	`iwl_fw_¥ph_h™dÀr
(
fwπ
, &
¥ph_Àn
,

809 
iwl_fw_gë_¥ph_Àn
);

811 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 ==

812 
IWL_DEVICE_FAMILY_7000
 &&

813 
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_RADIO_REG
))

814 
ødio_Àn
 = (*
dump_d©a
Ë+ 
RADIO_REG_MAX_READ
;

817 
fûe_Àn
 = (*
dump_fûe
Ë+ 
fifo_Àn
 + 
¥ph_Àn
 + 
ødio_Àn
;

819 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_DEV_FW_INFO
))

820 
fûe_Àn
 +(*
dump_d©a
Ë+ (*
dump_öfo
);

821 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_MEM_CFG
))

822 
fûe_Àn
 +(*
dump_d©a
Ë+ (*
dump_smem_cfg
);

824 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_MEM
)) {

825 
size_t
 
hdr_Àn
 = (*
dump_d©a
) +

826 (
iwl_fw_îr‹_dump_mem
);

829 i‡(!
fwπ
->
fw
->
dbg
.
n_mem_év
)

830 
	`ADD_LEN
(
fûe_Àn
, 
§am_Àn
, 
hdr_Àn
);

833 
	`ADD_LEN
(
fûe_Àn
, 
smem_Àn
, 
hdr_Àn
);

834 
	`ADD_LEN
(
fûe_Àn
, 
§am2_Àn
, 
hdr_Àn
);

836 
i
 = 0; i < 
fwπ
->
fw
->
dbg
.
n_mem_év
; i++)

837 
	`ADD_LEN
(
fûe_Àn
, 
	`À32_to_˝u
(
fw_mem
[
i
].
Àn
), 
hdr_Àn
);

841 i‡(
	`iwl_fw_dbg_is_∑gög_íabÀd
(
fwπ
))

842 
fûe_Àn
 +
fwπ
->
num_of_∑gög_blk
 *

843 ((*
dump_d©a
) +

844 (
iwl_fw_îr‹_dump_∑gög
) +

845 
PAGING_BLOCK_SIZE
);

847 i‡(
	`iwl_fw_dbg_is_d3_debug_íabÀd
(
fwπ
Ë&& fwπ->
dump
.
d3_debug_d©a
) {

848 
fûe_Àn
 +(*
dump_d©a
) +

849 
fwπ
->
å™s
->
cfg
->
d3_debug_d©a_Àngth
 * 2;

853 i‡(
d©a
->
m⁄ô‹_⁄ly
) {

854 
fûe_Àn
 = (*
dump_fûe
Ë+ (*
dump_d©a
) * 2 +

855 (*
dump_öfo
Ë+ (*
dump_smem_cfg
);

858 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_ERROR_INFO
) &&

859 
d©a
->
desc
)

860 
fûe_Àn
 +(*
dump_d©a
Ë+ (*
dump_åig
) +

861 
d©a
->
desc
->
Àn
;

863 
dump_fûe
 = 
	`vzÆloc
(
fûe_Àn
);

864 i‡(!
dump_fûe
)

865  
NULL
;

867 
fw_îr‹_dump
->
fwπ_±r
 = 
dump_fûe
;

869 
dump_fûe
->
b¨kî
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_BARKER
);

870 
dump_d©a
 = (*)
dump_fûe
->
d©a
;

872 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_DEV_FW_INFO
)) {

873 
dump_d©a
->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_DEV_FW_INFO
);

874 
dump_d©a
->
Àn
 = 
	`˝u_to_À32
((*
dump_öfo
));

875 
dump_öfo
 = (*)
dump_d©a
->
d©a
;

876 
dump_öfo
->
hw_ty≥
 =

877 
	`˝u_to_À32
(
	`CSR_HW_REV_TYPE
(
fwπ
->
å™s
->
hw_ªv
));

878 
dump_öfo
->
hw_°ï
 =

879 
	`˝u_to_À32
(
fwπ
->
å™s
->
hw_ªv_°ï
);

880 
	`mem˝y
(
dump_öfo
->
fw_hum™_ªadabÀ
, 
fwπ
->
fw
->
hum™_ªadabÀ
,

881 (
dump_öfo
->
fw_hum™_ªadabÀ
));

882 
	`°rs˝y_∑d
(
dump_öfo
->
dev_hum™_ªadabÀ
, 
fwπ
->
å™s
->
«me
,

883 (
dump_öfo
->
dev_hum™_ªadabÀ
));

884 
	`°rs˝y_∑d
(
dump_öfo
->
bus_hum™_ªadabÀ
, 
fwπ
->
dev
->
bus
->
«me
,

885 (
dump_öfo
->
bus_hum™_ªadabÀ
));

886 
dump_öfo
->
num_of_lmacs
 = 
fwπ
->
smem_cfg
.
num_lmacs
;

887 
dump_öfo
->
lmac_îr_id
[0] =

888 
	`˝u_to_À32
(
fwπ
->
dump
.
lmac_îr_id
[0]);

889 i‡(
fwπ
->
smem_cfg
.
num_lmacs
 > 1)

890 
dump_öfo
->
lmac_îr_id
[1] =

891 
	`˝u_to_À32
(
fwπ
->
dump
.
lmac_îr_id
[1]);

892 
dump_öfo
->
umac_îr_id
 = 
	`˝u_to_À32
(
fwπ
->
dump
.umac_err_id);

894 
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(dump_data);

897 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_MEM_CFG
)) {

899 
dump_d©a
->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_MEM_CFG
);

900 
dump_d©a
->
Àn
 = 
	`˝u_to_À32
((*
dump_smem_cfg
));

901 
dump_smem_cfg
 = (*)
dump_d©a
->
d©a
;

902 
dump_smem_cfg
->
num_lmacs
 = 
	`˝u_to_À32
(
mem_cfg
->num_lmacs);

903 
dump_smem_cfg
->
num_txfifo_íåõs
 =

904 
	`˝u_to_À32
(
mem_cfg
->
num_txfifo_íåõs
);

905 
i
 = 0; i < 
MAX_NUM_LMAC
; i++) {

906 
j
;

907 
u32
 *
txf_size
 = 
mem_cfg
->
lmac
[
i
].
txfifo_size
;

909 
j
 = 0; j < 
TX_FIFO_MAX_NUM
; j++)

910 
dump_smem_cfg
->
lmac
[
i
].
txfifo_size
[
j
] =

911 
	`˝u_to_À32
(
txf_size
[
j
]);

912 
dump_smem_cfg
->
lmac
[
i
].
rxfifo1_size
 =

913 
	`˝u_to_À32
(
mem_cfg
->
lmac
[
i
].
rxfifo1_size
);

915 
dump_smem_cfg
->
rxfifo2_size
 =

916 
	`˝u_to_À32
(
mem_cfg
->
rxfifo2_size
);

917 
dump_smem_cfg
->
öã∫Æ_txfifo_addr
 =

918 
	`˝u_to_À32
(
mem_cfg
->
öã∫Æ_txfifo_addr
);

919 
i
 = 0; i < 
TX_FIFO_INTERNAL_MAX_NUM
; i++) {

920 
dump_smem_cfg
->
öã∫Æ_txfifo_size
[
i
] =

921 
	`˝u_to_À32
(
mem_cfg
->
öã∫Æ_txfifo_size
[
i
]);

924 
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(dump_data);

928 i‡(
fifo_Àn
) {

929 
	`iwl_fw_dump_rxf
(
fwπ
, &
dump_d©a
);

930 
	`iwl_fw_dump_txf
(
fwπ
, &
dump_d©a
);

933 i‡(
ødio_Àn
)

934 
	`iwl_ªad_ødio_ªgs
(
fwπ
, &
dump_d©a
);

936 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_ERROR_INFO
) &&

937 
d©a
->
desc
) {

938 
dump_d©a
->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_ERROR_INFO
);

939 
dump_d©a
->
Àn
 = 
	`˝u_to_À32
((*
dump_åig
) +

940 
d©a
->
desc
->
Àn
);

941 
dump_åig
 = (*)
dump_d©a
->
d©a
;

942 
	`mem˝y
(
dump_åig
, &
d©a
->
desc
->
åig_desc
,

943 (*
dump_åig
Ë+ 
d©a
->
desc
->
Àn
);

945 
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(dump_data);

949 i‡(
d©a
->
m⁄ô‹_⁄ly
)

950 
out
;

952 i‡(
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_MEM
)) {

953 c⁄° 
iwl_fw_dbg_mem_£g_év
 *
fw_dbg_mem
 =

954 
fwπ
->
fw
->
dbg
.
mem_év
;

956 i‡(!
fwπ
->
fw
->
dbg
.
n_mem_év
)

957 
	`iwl_fw_dump_mem
(
fwπ
, &
dump_d©a
, 
§am_Àn
, 
§am_ofs
,

958 
IWL_FW_ERROR_DUMP_MEM_SRAM
);

960 
i
 = 0; i < 
fwπ
->
fw
->
dbg
.
n_mem_év
; i++) {

961 
u32
 
Àn
 = 
	`À32_to_˝u
(
fw_dbg_mem
[
i
].len);

962 
u32
 
ofs
 = 
	`À32_to_˝u
(
fw_dbg_mem
[
i
].ofs);

964 
	`iwl_fw_dump_mem
(
fwπ
, &
dump_d©a
, 
Àn
, 
ofs
,

965 
	`À32_to_˝u
(
fw_dbg_mem
[
i
].
d©a_ty≥
));

968 
	`iwl_fw_dump_mem
(
fwπ
, &
dump_d©a
, 
smem_Àn
,

969 
fwπ
->
å™s
->
cfg
->
smem_off£t
,

970 
IWL_FW_ERROR_DUMP_MEM_SMEM
);

972 
	`iwl_fw_dump_mem
(
fwπ
, &
dump_d©a
, 
§am2_Àn
,

973 
fwπ
->
å™s
->
cfg
->
dccm2_off£t
,

974 
IWL_FW_ERROR_DUMP_MEM_SRAM
);

977 i‡(
	`iwl_fw_dbg_is_d3_debug_íabÀd
(
fwπ
Ë&& fwπ->
dump
.
d3_debug_d©a
) {

978 
u32
 
addr
 = 
fwπ
->
å™s
->
cfg
->
d3_debug_d©a_ba£_addr
;

979 
size_t
 
d©a_size
 = 
fwπ
->
å™s
->
cfg
->
d3_debug_d©a_Àngth
;

981 
dump_d©a
->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_D3_DEBUG_DATA
);

982 
dump_d©a
->
Àn
 = 
	`˝u_to_À32
(
d©a_size
 * 2);

984 
	`mem˝y
(
dump_d©a
->
d©a
, 
fwπ
->
dump
.
d3_debug_d©a
, 
d©a_size
);

986 
	`k‰ì
(
fwπ
->
dump
.
d3_debug_d©a
);

987 
fwπ
->
dump
.
d3_debug_d©a
 = 
NULL
;

989 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
addr
,

990 
dump_d©a
->
d©a
 + 
d©a_size
,

991 
d©a_size
);

993 i‡(
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_mem
)

994 
fwπ
->
ßnôize_›s
->
	`‰ob_mem
(fwπ->
ßnôize_˘x
, 
addr
,

995 
dump_d©a
->
d©a
 + 
d©a_size
,

996 
d©a_size
);

998 
dump_d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(dump_data);

1002 i‡(
	`iwl_fw_dbg_is_∑gög_íabÀd
(
fwπ
))

1003 
	`iwl_dump_∑gög
(
fwπ
, &
dump_d©a
);

1005 i‡(
¥ph_Àn
)

1006 
	`iwl_fw_¥ph_h™dÀr
(
fwπ
, &
dump_d©a
, 
iwl_dump_¥ph
);

1008 
out
:

1009 
dump_fûe
->
fûe_Àn
 = 
	`˝u_to_À32
(file_len);

1010  
dump_fûe
;

1011 
	}
}

1018 
	siwl_dump_öi_ªgi⁄_d©a
 {

1019 
iwl_ucode_év
 *
	mªg_év
;

1020 
iwl_fwπ_dump_d©a
 *
	mdump_d©a
;

1023 
	$iwl_dump_öi_¥ph_mac_ôî_comm⁄
(
iwl_fw_ru¡ime
 *
fwπ
,

1024 *
ønge_±r
, 
u32
 
addr
,

1025 
__À32
 
size
)

1027 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1028 
__À32
 *
vÆ
 = 
ønge
->
d©a
;

1029 
u32
 
¥ph_vÆ
;

1030 
i
;

1032 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1033 
ønge
->
ønge_d©a_size
 = 
size
;

1034 
i
 = 0; i < 
	`À32_to_˝u
(
size
); i += 4) {

1035 
¥ph_vÆ
 = 
	`iwl_ªad_¥ph
(
fwπ
->
å™s
, 
addr
 + 
i
);

1036 i‡(
	`iwl_å™s_is_hw_îr‹_vÆue
(
¥ph_vÆ
))

1037  -
EBUSY
;

1038 *
vÆ
++ = 
	`˝u_to_À32
(
¥ph_vÆ
);

1041  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1042 
	}
}

1045 
	$iwl_dump_öi_¥ph_mac_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1046 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1047 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1049 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1050 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
idx
]) +

1051 
	`À32_to_˝u
(
ªg
->
dev_addr
.
off£t
);

1053  
	`iwl_dump_öi_¥ph_mac_ôî_comm⁄
(
fwπ
, 
ønge_±r
, 
addr
,

1054 
ªg
->
dev_addr
.
size
);

1055 
	}
}

1058 
	$iwl_dump_öi_¥ph_mac_block_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1059 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1060 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1062 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1063 
iwl_fw_öi_addr_size
 *
∑ús
 = (*)
ªg
->
addrs
;

1064 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
dev_addr_ønge
.
off£t
) +

1065 
	`À32_to_˝u
(
∑ús
[
idx
].
addr
);

1067  
	`iwl_dump_öi_¥ph_mac_ôî_comm⁄
(
fwπ
, 
ønge_±r
, 
addr
,

1068 
∑ús
[
idx
].
size
);

1069 
	}
}

1071 
	$iwl_dump_öi_¥ph_phy_ôî_comm⁄
(
iwl_fw_ru¡ime
 *
fwπ
,

1072 *
ønge_±r
, 
u32
 
addr
,

1073 
__À32
 
size
, __À32 
off£t
)

1075 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1076 
__À32
 *
vÆ
 = 
ønge
->
d©a
;

1077 
u32
 
ödúe˘_wr_addr
 = 
WMAL_INDRCT_RD_CMD1
;

1078 
u32
 
ödúe˘_rd_addr
 = 
WMAL_MRSPF_1
;

1079 
u32
 
¥ph_vÆ
;

1080 
u32
 
dphy_°©e
;

1081 
u32
 
dphy_addr
;

1082 
i
;

1084 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1085 
ønge
->
ønge_d©a_size
 = 
size
;

1087 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

1088 
ödúe˘_wr_addr
 = 
WMAL_INDRCT_CMD1
;

1090 
ödúe˘_wr_addr
 +
	`À32_to_˝u
(
off£t
);

1091 
ödúe˘_rd_addr
 +
	`À32_to_˝u
(
off£t
);

1093 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

1094  -
EBUSY
;

1096 
dphy_addr
 = (
off£t
Ë? 
WFPM_LMAC2_PS_CTL_RW
 : 
WFPM_LMAC1_PS_CTL_RW
;

1097 
dphy_°©e
 = 
	`iwl_ªad_umac_¥ph_no_gøb
(
fwπ
->
å™s
, 
dphy_addr
);

1099 
i
 = 0; i < 
	`À32_to_˝u
(
size
); i += 4) {

1100 i‡(
dphy_°©e
 =
HBUS_TIMEOUT
 ||

1101 (
dphy_°©e
 & 
WFPM_PS_CTL_RW_PHYRF_PD_FSM_CURSTATE_MSK
) !=

1102 
WFPM_PHYRF_STATE_ON
) {

1103 *
vÆ
++ = 
	`˝u_to_À32
(
WFPM_DPHY_OFF
);

1107 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
ödúe˘_wr_addr
,

1108 
	`WMAL_INDRCT_CMD
(
addr
 + 
i
));

1109 
¥ph_vÆ
 = 
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
,

1110 
ödúe˘_rd_addr
);

1111 *
vÆ
++ = 
	`˝u_to_À32
(
¥ph_vÆ
);

1114 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1115  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1116 
	}
}

1119 
	$iwl_dump_öi_¥ph_phy_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1120 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1121 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1123 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1124 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
idx
]);

1126  
	`iwl_dump_öi_¥ph_phy_ôî_comm⁄
(
fwπ
, 
ønge_±r
, 
addr
,

1127 
ªg
->
dev_addr
.
size
,

1128 
ªg
->
dev_addr
.
off£t
);

1129 
	}
}

1132 
	$iwl_dump_öi_¥ph_phy_block_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1133 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1134 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1136 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1137 
iwl_fw_öi_addr_size
 *
∑ús
 = (*)
ªg
->
addrs
;

1138 
u32
 
addr
 = 
	`À32_to_˝u
(
∑ús
[
idx
].addr);

1140  
	`iwl_dump_öi_¥ph_phy_ôî_comm⁄
(
fwπ
, 
ønge_±r
, 
addr
,

1141 
∑ús
[
idx
].
size
,

1142 
ªg
->
dev_addr_ønge
.
off£t
);

1143 
	}
}

1145 
	$iwl_dump_öi_c§_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1146 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1147 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1149 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1150 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1151 
__À32
 *
vÆ
 = 
ønge
->
d©a
;

1152 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
idx
]) +

1153 
	`À32_to_˝u
(
ªg
->
dev_addr
.
off£t
);

1154 
i
;

1156 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1157 
ønge
->
ønge_d©a_size
 = 
ªg
->
dev_addr
.
size
;

1158 
i
 = 0; i < 
	`À32_to_˝u
(
ªg
->
dev_addr
.
size
); i += 4)

1159 *
vÆ
++ = 
	`˝u_to_À32
(
	`iwl_å™s_ªad32
(
fwπ
->
å™s
, 
addr
 + 
i
));

1161  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1162 
	}
}

1164 
	$iwl_dump_öi_c⁄fig_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1165 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1166 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1168 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

1169 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1170 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1171 
__À32
 *
vÆ
 = 
ønge
->
d©a
;

1172 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
idx
]) +

1173 
	`À32_to_˝u
(
ªg
->
dev_addr
.
off£t
);

1174 
i
;

1177 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›s
->
ªad_c⁄fig32
))

1178  -
EOPNOTSUPP
;

1180 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1181 
ønge
->
ønge_d©a_size
 = 
ªg
->
dev_addr
.
size
;

1182 
i
 = 0; i < 
	`À32_to_˝u
(
ªg
->
dev_addr
.
size
); i += 4) {

1183 
ªt
;

1184 
u32
 
tmp
;

1186 
ªt
 = 
å™s
->
›s
->
	`ªad_c⁄fig32
—øns, 
addr
 + 
i
, &
tmp
);

1187 i‡(
ªt
 < 0)

1188  
ªt
;

1190 *
vÆ
++ = 
	`˝u_to_À32
(
tmp
);

1193  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1194 
	}
}

1196 
	$iwl_dump_öi_dev_mem_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1197 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1198 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1200 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1201 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1202 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
idx
]) +

1203 
	`À32_to_˝u
(
ªg
->
dev_addr
.
off£t
);

1205 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1206 
ønge
->
ønge_d©a_size
 = 
ªg
->
dev_addr
.
size
;

1207 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
addr
, 
ønge
->
d©a
,

1208 
	`À32_to_˝u
(
ªg
->
dev_addr
.
size
));

1210 i‡(
ªg
->
sub_ty≥
 =
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_HW_SMEM
 &&

1211 
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_txf
)

1212 
fwπ
->
ßnôize_›s
->
	`‰ob_txf
(fwπ->
ßnôize_˘x
,

1213 
ønge
->
d©a
,

1214 
	`À32_to_˝u
(
ªg
->
dev_addr
.
size
));

1216  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1217 
	}
}

1219 
	$_iwl_dump_öi_∑gög_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1220 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1222 
∑ge
 *∑gê
fwπ
->
fw_∑gög_db
[
idx
].
fw_∑gög_block
;

1223 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1224 
dma_addr_t
 
addr
 = 
fwπ
->
fw_∑gög_db
[
idx
].
fw_∑gög_phys
;

1225 
u32
 
∑ge_size
 = 
fwπ
->
fw_∑gög_db
[
idx
].
fw_∑gög_size
;

1227 
ønge
->
∑ge_num
 = 
	`˝u_to_À32
(
idx
);

1228 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
∑ge_size
);

1229 
	`dma_sync_sögÀ_f‹_˝u
(
fwπ
->
å™s
->
dev
, 
addr
, 
∑ge_size
,

1230 
DMA_BIDIRECTIONAL
);

1231 
	`mem˝y
(
ønge
->
d©a
, 
	`∑ge_addªss
(
∑ge
), 
∑ge_size
);

1232 
	`dma_sync_sögÀ_f‹_devi˚
(
fwπ
->
å™s
->
dev
, 
addr
, 
∑ge_size
,

1233 
DMA_BIDIRECTIONAL
);

1235  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1236 
	}
}

1238 
	$iwl_dump_öi_∑gög_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1239 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1240 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1242 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
;

1243 
u32
 
∑ge_size
;

1246 
idx
++;

1248 i‡(!
fwπ
->
å™s
->
å™s_cfg
->
gí2
)

1249  
	`_iwl_dump_öi_∑gög_ôî
(
fwπ
, 
ønge_±r
, 
ønge_Àn
, 
idx
);

1251 
ønge
 = 
ønge_±r
;

1252 
∑ge_size
 = 
fwπ
->
å™s
->
öô_døm
.
∑gög
[
idx
].
size
;

1254 
ønge
->
∑ge_num
 = 
	`˝u_to_À32
(
idx
);

1255 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
∑ge_size
);

1256 
	`mem˝y
(
ønge
->
d©a
, 
fwπ
->
å™s
->
öô_døm
.
∑gög
[
idx
].
block
,

1257 
∑ge_size
);

1259  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1260 
	}
}

1263 
	$iwl_dump_öi_m⁄_døm_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1264 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1265 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1267 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1268 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1269 
iwl_døm_d©a
 *
‰ag
;

1270 
u32
 
Æloc_id
 = 
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
);

1272 
‰ag
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
].
‰ags
[
idx
];

1274 
ønge
->
døm_ba£_addr
 = 
	`˝u_to_À64
(
‰ag
->
physiˇl
);

1275 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
‰ag
->
size
);

1277 
	`mem˝y
(
ønge
->
d©a
, 
‰ag
->
block
, føg->
size
);

1279  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1280 
	}
}

1282 
	$iwl_dump_öi_m⁄_smem_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1283 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1284 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1286 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1287 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1288 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
öã∫Æ_buf„r
.
ba£_addr
);

1290 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1291 
ønge
->
ønge_d©a_size
 = 
ªg
->
öã∫Æ_buf„r
.
size
;

1292 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
addr
, 
ønge
->
d©a
,

1293 
	`À32_to_˝u
(
ªg
->
öã∫Æ_buf„r
.
size
));

1295  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1296 
	}
}

1298 
boﬁ
 
	$iwl_öi_txf_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1299 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
, 
idx
)

1301 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1302 
iwl_txf_ôî_d©a
 *
ôî
 = &
fwπ
->
dump
.
txf_ôî_d©a
;

1303 
iwl_fwπ_sh¨ed_mem_cfg
 *
cfg
 = &
fwπ
->
smem_cfg
;

1304 
txf_num
 = 
cfg
->
num_txfifo_íåõs
;

1305 
öt_txf_num
 = 
	`ARRAY_SIZE
(
cfg
->
öã∫Æ_txfifo_size
);

1306 
u32
 
lmac_bôm≠
 = 
	`À32_to_˝u
(
ªg
->
fifos
.
fid
[0]);

1308 i‡(!
idx
) {

1309 i‡(
	`À32_to_˝u
(
ªg
->
fifos
.
off£t
Ë&& 
cfg
->
num_lmacs
 == 1) {

1310 
	`IWL_ERR
(
fwπ
, "WRT: InvalidÜmac offset 0x%x\n",

1311 
	`À32_to_˝u
(
ªg
->
fifos
.
off£t
));

1312  
Ál£
;

1315 
ôî
->
öã∫Æ_txf
 = 0;

1316 
ôî
->
fifo_size
 = 0;

1317 
ôî
->
fifo
 = -1;

1318 i‡(
	`À32_to_˝u
(
ªg
->
fifos
.
off£t
))

1319 
ôî
->
lmac
 = 1;

1321 
ôî
->
lmac
 = 0;

1324 i‡(!
ôî
->
öã∫Æ_txf
) {

1325 
ôî
->
fifo
++; iãr->fifÿ< 
txf_num
; iter->fifo++) {

1326 
ôî
->
fifo_size
 =

1327 
cfg
->
lmac
[
ôî
->lmac].
txfifo_size
[ôî->
fifo
];

1328 i‡(
ôî
->
fifo_size
 && (
lmac_bôm≠
 & 
	`BIT
(ôî->
fifo
)))

1329  
åue
;

1331 
ôî
->
fifo
--;

1334 
ôî
->
öã∫Æ_txf
 = 1;

1336 i‡(!
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

1337 
IWL_UCODE_TLV_CAPA_EXTEND_SHARED_MEM_CFG
))

1338  
Ál£
;

1340 
ôî
->
fifo
++; iãr->fifÿ< 
öt_txf_num
 + 
txf_num
; iter->fifo++) {

1341 
ôî
->
fifo_size
 =

1342 
cfg
->
öã∫Æ_txfifo_size
[
ôî
->
fifo
 - 
txf_num
];

1343 i‡(
ôî
->
fifo_size
 && (
lmac_bôm≠
 & 
	`BIT
(ôî->
fifo
)))

1344  
åue
;

1347  
Ál£
;

1348 
	}
}

1350 
	$iwl_dump_öi_txf_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1351 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1352 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1354 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1355 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1356 
iwl_txf_ôî_d©a
 *
ôî
 = &
fwπ
->
dump
.
txf_ôî_d©a
;

1357 
iwl_fw_öi_îr‹_dump_ªgi°î
 *
ªg_dump
 = (*)
ønge
->
d©a
;

1358 
u32
 
offs
 = 
	`À32_to_˝u
(
ªg
->
fifos
.
off£t
), 
addr
;

1359 
u32
 
ªgi°îs_num
 = 
	`iwl_év_¨øy_Àn
(
ªg_d©a
->
ªg_év
, 
ªg
, 
addrs
);

1360 
u32
 
ªgi°îs_size
 = 
ªgi°îs_num
 * (*
ªg_dump
);

1361 
__À32
 *
d©a
;

1362 
i
;

1364 i‡(!
	`iwl_öi_txf_ôî
(
fwπ
, 
ªg_d©a
, 
idx
))

1365  -
EIO
;

1367 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

1368  -
EBUSY
;

1370 
ønge
->
fifo_hdr
.
fifo_num
 = 
	`˝u_to_À32
(
ôî
->
fifo
);

1371 
ønge
->
fifo_hdr
.
num_of_ªgi°îs
 = 
	`˝u_to_À32
(
ªgi°îs_num
);

1372 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
ôî
->
fifo_size
 + 
ªgi°îs_size
);

1374 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
TXF_LARC_NUM
 + 
offs
, 
ôî
->
fifo
);

1380 
i
 = 0; i < 
ªgi°îs_num
; i++) {

1381 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
i
]Ë+ 
offs
;

1383 
ªg_dump
->
addr
 = 
	`˝u_to_À32
(addr);

1384 
ªg_dump
->
d©a
 = 
	`˝u_to_À32
(
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
,

1385 
addr
));

1387 
ªg_dump
++;

1390 i‡(
ªg
->
fifos
.
hdr_⁄ly
) {

1391 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
ªgi°îs_size
);

1392 
out
;

1396 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
TXF_READ_MODIFY_ADDR
 + 
offs
,

1397 
TXF_WR_PTR
 + 
offs
);

1400 
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
, 
TXF_READ_MODIFY_DATA
 + 
offs
);

1403 
addr
 = 
TXF_READ_MODIFY_DATA
 + 
offs
;

1404 
d©a
 = (*)
ªg_dump
;

1405 
i
 = 0; i < 
ôî
->
fifo_size
; i +(*
d©a
))

1406 *
d©a
++ = 
	`˝u_to_À32
(
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
, 
addr
));

1408 i‡(
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_txf
)

1409 
fwπ
->
ßnôize_›s
->
	`‰ob_txf
(fwπ->
ßnôize_˘x
,

1410 
ªg_dump
, 
ôî
->
fifo_size
);

1412 
out
:

1413 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1415  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1416 
	}
}

1419 
	$iwl_dump_öi_¥ph_¢ps_dphyù_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1420 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1421 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1423 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1424 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1425 
__À32
 *
vÆ
 = 
ønge
->
d©a
;

1426 
__À32
 
off£t
 = 
ªg
->
dev_addr
.offset;

1427 
u32
 
ödúe˘_rd_wr_addr
 = 
DPHYIP_INDIRECT
;

1428 
u32
 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
idx
]);

1429 
u32
 
dphy_°©e
, 
dphy_addr
, 
¥ph_vÆ
;

1430 
i
;

1432 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1433 
ønge
->
ønge_d©a_size
 = 
ªg
->
dev_addr
.
size
;

1435 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

1436  -
EBUSY
;

1438 
ödúe˘_rd_wr_addr
 +
	`À32_to_˝u
(
off£t
);

1440 
dphy_addr
 = 
off£t
 ? 
WFPM_LMAC2_PS_CTL_RW
 : 
WFPM_LMAC1_PS_CTL_RW
;

1441 
dphy_°©e
 = 
	`iwl_ªad_umac_¥ph_no_gøb
(
fwπ
->
å™s
, 
dphy_addr
);

1443 
i
 = 0; i < 
	`À32_to_˝u
(
ªg
->
dev_addr
.
size
); i += 4) {

1444 i‡(
dphy_°©e
 =
HBUS_TIMEOUT
 ||

1445 (
dphy_°©e
 & 
WFPM_PS_CTL_RW_PHYRF_PD_FSM_CURSTATE_MSK
) !=

1446 
WFPM_PHYRF_STATE_ON
) {

1447 *
vÆ
++ = 
	`˝u_to_À32
(
WFPM_DPHY_OFF
);

1451 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
ödúe˘_rd_wr_addr
,

1452 
addr
 + 
i
);

1454 
	`udñay
(1);

1455 
¥ph_vÆ
 = 
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
,

1456 
ödúe˘_rd_wr_addr
);

1457 *
vÆ
++ = 
	`˝u_to_À32
((
¥ph_vÆ
 & 
DPHYIP_INDIRECT_RD_MSK
) >>

1458 
DPHYIP_INDIRECT_RD_SHIFT
);

1461 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1462  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1463 
	}
}

1465 
	siwl_öi_rxf_d©a
 {

1466 
u32
 
	mfifo_num
;

1467 
u32
 
	msize
;

1468 
u32
 
	moff£t
;

1471 
	$iwl_öi_gë_rxf_d©a
(
iwl_fw_ru¡ime
 *
fwπ
,

1472 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1473 
iwl_öi_rxf_d©a
 *
d©a
)

1475 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1476 
u32
 
fid1
 = 
	`À32_to_˝u
(
ªg
->
fifos
.
fid
[0]);

1477 
u32
 
fid2
 = 
	`À32_to_˝u
(
ªg
->
fifos
.
fid
[1]);

1478 
u8
 
fifo_idx
;

1480 i‡(!
d©a
)

1483 
	`mem£t
(
d©a
, 0, (*data));

1486 i‡(
	`WARN_ONCE
(
	`hweight_l⁄g
(
fid1
Ë+ hweight_l⁄g(
fid2
) != 1,

1487 "fid1=%x, fid2=%x\n", 
fid1
, 
fid2
))

1490 i‡(
fid1
) {

1491 
fifo_idx
 = 
	`ffs
(
fid1
) - 1;

1492 i‡(
	`WARN_ONCE
(
fifo_idx
 >
MAX_NUM_LMAC
, "fifo_idx=%d\n",

1493 
fifo_idx
))

1496 
d©a
->
size
 = 
fwπ
->
smem_cfg
.
lmac
[
fifo_idx
].
rxfifo1_size
;

1497 
d©a
->
fifo_num
 = 
fifo_idx
;

1499 
u8
 
max_idx
;

1501 
fifo_idx
 = 
	`ffs
(
fid2
) - 1;

1502 i‡(
	`iwl_fw_lookup_nŸif_vî
(
fwπ
->
fw
, 
SYSTEM_GROUP
,

1503 
SHARED_MEM_CFG_CMD
, 0) <= 3)

1504 
max_idx
 = 0;

1506 
max_idx
 = 1;

1508 i‡(
	`WARN_ONCE
(
fifo_idx
 > 
max_idx
,

1509 "övÆid uma¯fifÿidx %d", 
fifo_idx
))

1515 
d©a
->
fifo_num
 = 
fifo_idx
 | 
IWL_RXF_UMAC_BIT
;

1517 
fifo_idx
) {

1519 
d©a
->
size
 = 
fwπ
->
smem_cfg
.
rxfifo2_size
;

1520 
d©a
->
off£t
 = 
	`iwl_umac_¥ph
(
fwπ
->
å™s
,

1521 
RXF_DIFF_FROM_PREV
);

1524 
d©a
->
size
 = 
fwπ
->
smem_cfg
.
rxfifo2_c⁄åﬁ_size
;

1525 
d©a
->
off£t
 = 
	`iwl_umac_¥ph
(
fwπ
->
å™s
,

1526 
RXF2C_DIFF_FROM_PREV
);

1530 
	}
}

1532 
	$iwl_dump_öi_rxf_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1533 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1534 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1536 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1537 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1538 
iwl_öi_rxf_d©a
 
rxf_d©a
;

1539 
iwl_fw_öi_îr‹_dump_ªgi°î
 *
ªg_dump
 = (*)
ønge
->
d©a
;

1540 
u32
 
offs
 = 
	`À32_to_˝u
(
ªg
->
fifos
.
off£t
), 
addr
;

1541 
u32
 
ªgi°îs_num
 = 
	`iwl_év_¨øy_Àn
(
ªg_d©a
->
ªg_év
, 
ªg
, 
addrs
);

1542 
u32
 
ªgi°îs_size
 = 
ªgi°îs_num
 * (*
ªg_dump
);

1543 
__À32
 *
d©a
;

1544 
i
;

1546 
	`iwl_öi_gë_rxf_d©a
(
fwπ
, 
ªg_d©a
, &
rxf_d©a
);

1547 i‡(!
rxf_d©a
.
size
)

1548  -
EIO
;

1550 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

1551  -
EBUSY
;

1553 
ønge
->
fifo_hdr
.
fifo_num
 = 
	`˝u_to_À32
(
rxf_d©a
.fifo_num);

1554 
ønge
->
fifo_hdr
.
num_of_ªgi°îs
 = 
	`˝u_to_À32
(
ªgi°îs_num
);

1555 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
rxf_d©a
.
size
 + 
ªgi°îs_size
);

1561 
i
 = 0; i < 
ªgi°îs_num
; i++) {

1562 
addr
 = 
	`À32_to_˝u
(
ªg
->
addrs
[
i
]Ë+ 
offs
;

1564 
ªg_dump
->
addr
 = 
	`˝u_to_À32
(addr);

1565 
ªg_dump
->
d©a
 = 
	`˝u_to_À32
(
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
,

1566 
addr
));

1568 
ªg_dump
++;

1571 i‡(
ªg
->
fifos
.
hdr_⁄ly
) {

1572 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
ªgi°îs_size
);

1573 
out
;

1576 
offs
 = 
rxf_d©a
.
off£t
;

1579 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
RXF_SET_FENCE_MODE
 + 
offs
, 0x1);

1581 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
RXF_LD_WR2FENCE
 + 
offs
, 0x1);

1583 
	`iwl_wrôe_¥ph_no_gøb
(
fwπ
->
å™s
, 
RXF_LD_FENCE_OFFSET_ADDR
 + 
offs
,

1587 
addr
 = 
RXF_FIFO_RD_FENCE_INC
 + 
offs
;

1588 
d©a
 = (*)
ªg_dump
;

1589 
i
 = 0; i < 
rxf_d©a
.
size
; i +(*
d©a
))

1590 *
d©a
++ = 
	`˝u_to_À32
(
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
, 
addr
));

1592 
out
:

1593 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1595  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1596 
	}
}

1599 
	$iwl_dump_öi_îr_èbÀ_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1600 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1601 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1603 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1604 
iwl_fw_öi_ªgi⁄_îr_èbÀ
 *
îr_èbÀ
 = &
ªg
->err_table;

1605 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1606 
u32
 
addr
 = 
	`À32_to_˝u
(
îr_èbÀ
->
ba£_addr
) +

1607 
	`À32_to_˝u
(
îr_èbÀ
->
off£t
);

1609 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1610 
ønge
->
ønge_d©a_size
 = 
îr_èbÀ
->
size
;

1611 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
addr
, 
ønge
->
d©a
,

1612 
	`À32_to_˝u
(
îr_èbÀ
->
size
));

1614  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1615 
	}
}

1618 
	$iwl_dump_öi_•ecül_mem_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1619 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1620 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1622 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1623 
iwl_fw_öi_ªgi⁄_•ecül_devi˚_mem‹y
 *
•ecül_mem
 =

1624 &
ªg
->
•ecül_mem
;

1626 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1627 
u32
 
addr
 = 
	`À32_to_˝u
(
•ecül_mem
->
ba£_addr
) +

1628 
	`À32_to_˝u
(
•ecül_mem
->
off£t
);

1630 
ønge
->
öã∫Æ_ba£_addr
 = 
	`˝u_to_À32
(
addr
);

1631 
ønge
->
ønge_d©a_size
 = 
•ecül_mem
->
size
;

1632 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
addr
, 
ønge
->
d©a
,

1633 
	`À32_to_˝u
(
•ecül_mem
->
size
));

1635  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1636 
	}
}

1639 
	$iwl_dump_öi_dbgi_§am_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1640 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1641 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1643 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1644 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1645 
__À32
 *
vÆ
 = 
ønge
->
d©a
;

1646 
u32
 
¥ph_d©a
;

1647 
i
;

1649 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

1650  -
EBUSY
;

1652 
ønge
->
ønge_d©a_size
 = 
ªg
->
dev_addr
.
size
;

1653 
i
 = 0; i < (
	`À32_to_˝u
(
ªg
->
dev_addr
.
size
) / 4); i++) {

1654 
¥ph_d©a
 = 
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
, (
i
 % 2) ?

1655 
DBGI_SRAM_TARGET_ACCESS_RDATA_MSB
 :

1656 
DBGI_SRAM_TARGET_ACCESS_RDATA_LSB
);

1657 i‡(
	`iwl_å™s_is_hw_îr‹_vÆue
(
¥ph_d©a
)) {

1658 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1659  -
EBUSY
;

1661 *
vÆ
++ = 
	`˝u_to_À32
(
¥ph_d©a
);

1663 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1664  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1665 
	}
}

1667 
	$iwl_dump_öi_fw_pkt_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1668 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1669 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1671 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1672 
iwl_rx_∑ckë
 *
pkt
 = 
ªg_d©a
->
dump_d©a
->
fw_pkt
;

1673 
u32
 
pkt_Àn
;

1675 i‡(!
pkt
)

1676  -
EIO
;

1678 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1680 
	`mem˝y
(&
ønge
->
fw_pkt_hdr
, &
pkt
->
hdr
, (range->fw_pkt_hdr));

1681 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
pkt_Àn
);

1683 
	`mem˝y
(
ønge
->
d©a
, 
pkt
->d©a, 
pkt_Àn
);

1685  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1686 
	}
}

1688 
	$iwl_dump_öi_imr_ôî
(
iwl_fw_ru¡ime
 *
fwπ
,

1689 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1690 *
ønge_±r
, 
u32
 
ønge_Àn
, 
idx
)

1693 
iwl_fw_öi_îr‹_dump_ønge
 *
ønge
 = 
ønge_±r
;

1694 
u64
 
imr_cuº_addr
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.imr_curr_addr;

1695 
u32
 
imr_ªm_byãs
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.
imr2§am_ªmaöbyã
;

1696 
u32
 
§am_addr
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.sram_addr;

1697 
u32
 
§am_size
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.sram_size;

1698 
u32
 
size_to_dump
 = (
imr_ªm_byãs
 > 
§am_size
) ? sram_size : imr_rem_bytes;

1700 
ønge
->
ønge_d©a_size
 = 
	`˝u_to_À32
(
size_to_dump
);

1701 i‡(
	`iwl_å™s_wrôe_imr_mem
(
fwπ
->
å™s
, 
§am_addr
,

1702 
imr_cuº_addr
, 
size_to_dump
)) {

1703 
	`IWL_ERR
(
fwπ
, "WRT_DEBUG: IMR MemoryÅransfer failed\n");

1707 
fwπ
->
å™s
->
dbg
.
imr_d©a
.
imr_cuº_addr
 = imr_cuº_add∏+ 
size_to_dump
;

1708 
fwπ
->
å™s
->
dbg
.
imr_d©a
.
imr2§am_ªmaöbyã
 -
size_to_dump
;

1710 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
§am_addr
, 
ønge
->
d©a
,

1711 
size_to_dump
);

1712  (*
ønge
Ë+ 
	`À32_to_˝u
‘™ge->
ønge_d©a_size
);

1713 
	}
}

1716 
	$iwl_dump_öi_mem_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1717 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1718 *
d©a
, 
u32
 
d©a_Àn
)

1720 
iwl_fw_öi_îr‹_dump
 *
dump
 = 
d©a
;

1722 
dump
->
hódî
.
vîsi⁄
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_VER
);

1724  
dump
->
d©a
;

1725 
	}
}

1737 
u32
 
	$mask_≠∂y_™d_n‹mÆize
(
u32
 
vÆ
, u32 
mask
)

1739  (
vÆ
 & 
mask
Ë>> (
	`ffs
(mask) - 1);

1740 
	}
}

1742 
__À32
 
	$iwl_gë_m⁄_ªg
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 
Æloc_id
,

1743 c⁄° 
iwl_fw_m⁄_ªg
 *
ªg_öfo
)

1745 
u32
 
vÆ
, 
offs
;

1750 
offs
 = (
Æloc_id
 - 
IWL_FW_INI_ALLOCATION_ID_DBGC1
) * 0x100;

1752 i‡(!
ªg_öfo
 || !ªg_öfo->
addr
 || !ªg_öfo->
mask
)

1755 
vÆ
 = 
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
, 
ªg_öfo
->
addr
 + 
offs
);

1757  
	`˝u_to_À32
(
	`mask_≠∂y_™d_n‹mÆize
(
vÆ
, 
ªg_öfo
->
mask
));

1758 
	}
}

1761 
	$iwl_dump_öi_m⁄_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 
Æloc_id
,

1762 
iwl_fw_öi_m⁄ô‹_dump
 *
d©a
,

1763 c⁄° 
iwl_fw_m⁄_ªgs
 *
addrs
)

1765 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
)) {

1766 
	`IWL_ERR
(
fwπ
, "FailedÅo get monitor header\n");

1767  
NULL
;

1770 
d©a
->
wrôe_±r
 = 
	`iwl_gë_m⁄_ªg
(
fwπ
, 
Æloc_id
,

1771 &
addrs
->
wrôe_±r
);

1772 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

1773 
u32
 
wπ_±r
 = 
	`À32_to_˝u
(
d©a
->
wrôe_±r
);

1775 
d©a
->
wrôe_±r
 = 
	`˝u_to_À32
(
wπ_±r
 >> 2);

1777 
d©a
->
cy˛e_˙t
 = 
	`iwl_gë_m⁄_ªg
(
fwπ
, 
Æloc_id
,

1778 &
addrs
->
cy˛e_˙t
);

1779 
d©a
->
cur_‰ag
 = 
	`iwl_gë_m⁄_ªg
(
fwπ
, 
Æloc_id
,

1780 &
addrs
->
cur_‰ag
);

1782 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

1784 
d©a
->
hódî
.
vîsi⁄
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_VER
);

1786  
d©a
->data;

1787 
	}
}

1790 
	$iwl_dump_öi_m⁄_døm_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1791 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1792 *
d©a
, 
u32
 
d©a_Àn
)

1794 
iwl_fw_öi_m⁄ô‹_dump
 *
m⁄_dump
 = (*)
d©a
;

1795 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1796 
u32
 
Æloc_id
 = 
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
);

1798  
	`iwl_dump_öi_m⁄_fûl_hódî
(
fwπ
, 
Æloc_id
, 
m⁄_dump
,

1799 &
fwπ
->
å™s
->
cfg
->
m⁄_døm_ªgs
);

1800 
	}
}

1803 
	$iwl_dump_öi_m⁄_smem_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1804 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1805 *
d©a
, 
u32
 
d©a_Àn
)

1807 
iwl_fw_öi_m⁄ô‹_dump
 *
m⁄_dump
 = (*)
d©a
;

1808 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1809 
u32
 
Æloc_id
 = 
	`À32_to_˝u
(
ªg
->
öã∫Æ_buf„r
.alloc_id);

1811  
	`iwl_dump_öi_m⁄_fûl_hódî
(
fwπ
, 
Æloc_id
, 
m⁄_dump
,

1812 &
fwπ
->
å™s
->
cfg
->
m⁄_smem_ªgs
);

1813 
	}
}

1816 
	$iwl_dump_öi_m⁄_dbgi_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1817 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1818 *
d©a
, 
u32
 
d©a_Àn
)

1820 
iwl_fw_öi_m⁄ô‹_dump
 *
m⁄_dump
 = (*)
d©a
;

1822  
	`iwl_dump_öi_m⁄_fûl_hódî
(
fwπ
,

1824 
IWL_FW_INI_ALLOCATION_ID_DBGC1
,

1825 
m⁄_dump
,

1826 &
fwπ
->
å™s
->
cfg
->
m⁄_dbgi_ªgs
);

1827 
	}
}

1830 
	$iwl_dump_öi_îr_èbÀ_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1831 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1832 *
d©a
, 
u32
 
d©a_Àn
)

1834 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1835 
iwl_fw_öi_îr_èbÀ_dump
 *
dump
 = 
d©a
;

1837 
dump
->
hódî
.
vîsi⁄
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_VER
);

1838 
dump
->
vîsi⁄
 = 
ªg
->
îr_èbÀ
.version;

1840  
dump
->
d©a
;

1841 
	}
}

1844 
	$iwl_dump_öi_•ecül_mem_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1845 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1846 *
d©a
, 
u32
 
d©a_Àn
)

1848 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1849 
iwl_fw_öi_•ecül_devi˚_mem‹y
 *
dump
 = 
d©a
;

1851 
dump
->
hódî
.
vîsi⁄
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_VER
);

1852 
dump
->
ty≥
 = 
ªg
->
•ecül_mem
.type;

1853 
dump
->
vîsi⁄
 = 
ªg
->
•ecül_mem
.version;

1855  
dump
->
d©a
;

1856 
	}
}

1859 
	$iwl_dump_öi_imr_fûl_hódî
(
iwl_fw_ru¡ime
 *
fwπ
,

1860 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

1861 *
d©a
, 
u32
 
d©a_Àn
)

1863 
iwl_fw_öi_îr‹_dump
 *
dump
 = 
d©a
;

1865 
dump
->
hódî
.
vîsi⁄
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_VER
);

1867  
dump
->
d©a
;

1868 
	}
}

1870 
u32
 
	$iwl_dump_öi_mem_ønges
(
iwl_fw_ru¡ime
 *
fwπ
,

1871 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1873 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1875  
	`iwl_év_¨øy_Àn
(
ªg_d©a
->
ªg_év
, 
ªg
, 
addrs
);

1876 
	}
}

1878 
u32


1879 
	$iwl_dump_öi_mem_block_ønges
(
iwl_fw_ru¡ime
 *
fwπ
,

1880 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1882 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1883 
size_t
 
size
 = (
iwl_fw_öi_addr_size
);

1885  
	`iwl_év_¨øy_Àn_wôh_size
(
ªg_d©a
->
ªg_év
, 
ªg
, 
size
);

1886 
	}
}

1888 
u32
 
	$iwl_dump_öi_∑gög_ønges
(
iwl_fw_ru¡ime
 *
fwπ
,

1889 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1891 i‡(
fwπ
->
å™s
->
å™s_cfg
->
gí2
) {

1892 i‡(
fwπ
->
å™s
->
öô_døm
.
∑gög_˙t
)

1893  
fwπ
->
å™s
->
öô_døm
.
∑gög_˙t
 - 1;

1898  
fwπ
->
num_of_∑gög_blk
;

1899 
	}
}

1901 
u32


1902 
	$iwl_dump_öi_m⁄_døm_ønges
(
iwl_fw_ru¡ime
 *
fwπ
,

1903 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1905 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1906 
iwl_fw_m⁄
 *
fw_m⁄
;

1907 
u32
 
ønges
 = 0, 
Æloc_id
 = 
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
);

1908 
i
;

1910 
fw_m⁄
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
];

1912 
i
 = 0; i < 
fw_m⁄
->
num_‰ags
; i++) {

1913 i‡(!
fw_m⁄
->
‰ags
[
i
].
size
)

1916 
ønges
++;

1919  
ønges
;

1920 
	}
}

1922 
u32
 
	$iwl_dump_öi_txf_ønges
(
iwl_fw_ru¡ime
 *
fwπ
,

1923 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1925 
u32
 
num_of_fifos
 = 0;

1927 
	`iwl_öi_txf_ôî
(
fwπ
, 
ªg_d©a
, 
num_of_fifos
))

1928 
num_of_fifos
++;

1930  
num_of_fifos
;

1931 
	}
}

1933 
u32
 
	$iwl_dump_öi_sögÀ_ønge
(
iwl_fw_ru¡ime
 *
fwπ
,

1934 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1937 
	}
}

1939 
u32
 
	$iwl_dump_öi_imr_ønges
(
iwl_fw_ru¡ime
 *
fwπ
,

1940 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1945 
u32
 
imr_íabÀ
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.imr_enable;

1946 
u32
 
imr_size
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.imr_size;

1947 
u32
 
§am_size
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.sram_size;

1949 i‡(
imr_íabÀ
 =0 || 
imr_size
 =0 || 
§am_size
 == 0) {

1950 
	`IWL_DEBUG_INFO
(
fwπ
,

1952 
imr_íabÀ
, 
imr_size
, 
§am_size
);

1956 ((
imr_size
 % 
§am_size
) ? (imr_size / sram_size + 1) : (imr_size / sram_size));

1957 
	}
}

1959 
u32
 
	$iwl_dump_öi_mem_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

1960 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1962 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1963 
u32
 
size
 = 
	`À32_to_˝u
(
ªg
->
dev_addr
.size);

1964 
u32
 
ønges
 = 
	`iwl_dump_öi_mem_ønges
(
fwπ
, 
ªg_d©a
);

1966 i‡(!
size
 || !
ønges
)

1969  (
iwl_fw_öi_îr‹_dump
Ë+ 
ønges
 *

1970 (
size
 + (
iwl_fw_öi_îr‹_dump_ønge
));

1971 
	}
}

1973 
u32


1974 
	$iwl_dump_öi_mem_block_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

1975 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1977 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

1978 
iwl_fw_öi_addr_size
 *
∑ús
 = (*)
ªg
->
addrs
;

1979 
u32
 
ønges
 = 
	`iwl_dump_öi_mem_block_ønges
(
fwπ
, 
ªg_d©a
);

1980 
u32
 
size
 = (
iwl_fw_öi_îr‹_dump
);

1981 
ønge
;

1983 i‡(!
ønges
)

1986 
ønge
 = 0;Ñ™gê< 
ønges
;Ñange++)

1987 
size
 +
	`À32_to_˝u
(
∑ús
[
ønge
].size);

1989  
size
 + 
ønges
 * (
iwl_fw_öi_îr‹_dump_ønge
);

1990 
	}
}

1992 
u32


1993 
	$iwl_dump_öi_∑gög_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

1994 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

1996 
i
;

1997 
u32
 
ønge_hódî_Àn
 = (
iwl_fw_öi_îr‹_dump_ønge
);

1998 
u32
 
size
 = (
iwl_fw_öi_îr‹_dump
);

2001 
i
 = 1; i <
	`iwl_dump_öi_∑gög_ønges
(
fwπ
, 
ªg_d©a
); i++) {

2002 
size
 +
ønge_hódî_Àn
;

2003 i‡(
fwπ
->
å™s
->
å™s_cfg
->
gí2
)

2004 
size
 +
fwπ
->
å™s
->
öô_døm
.
∑gög
[
i
].size;

2006 
size
 +
fwπ
->
fw_∑gög_db
[
i
].
fw_∑gög_size
;

2009  
size
;

2010 
	}
}

2012 
u32


2013 
	$iwl_dump_öi_m⁄_døm_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2014 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2016 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2017 
iwl_fw_m⁄
 *
fw_m⁄
;

2018 
u32
 
size
 = 0, 
Æloc_id
 = 
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
);

2019 
i
;

2021 
fw_m⁄
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
];

2023 
i
 = 0; i < 
fw_m⁄
->
num_‰ags
; i++) {

2024 
iwl_døm_d©a
 *
‰ag
 = &
fw_m⁄
->
‰ags
[
i
];

2026 i‡(!
‰ag
->
size
)

2029 
size
 +(
iwl_fw_öi_îr‹_dump_ønge
Ë+ 
‰ag
->size;

2032 i‡(
size
)

2033 
size
 +(
iwl_fw_öi_m⁄ô‹_dump
);

2035  
size
;

2036 
	}
}

2038 
u32


2039 
	$iwl_dump_öi_m⁄_smem_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2040 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2042 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2043 
u32
 
size
;

2045 
size
 = 
	`À32_to_˝u
(
ªg
->
öã∫Æ_buf„r
.size);

2046 i‡(!
size
)

2049 
size
 +(
iwl_fw_öi_m⁄ô‹_dump
) +

2050 (
iwl_fw_öi_îr‹_dump_ønge
);

2052  
size
;

2053 
	}
}

2055 
u32
 
	$iwl_dump_öi_m⁄_dbgi_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2056 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2058 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2059 
u32
 
size
 = 
	`À32_to_˝u
(
ªg
->
dev_addr
.size);

2060 
u32
 
ønges
 = 
	`iwl_dump_öi_mem_ønges
(
fwπ
, 
ªg_d©a
);

2062 i‡(!
size
 || !
ønges
)

2065  (
iwl_fw_öi_m⁄ô‹_dump
Ë+ 
ønges
 *

2066 (
size
 + (
iwl_fw_öi_îr‹_dump_ønge
));

2067 
	}
}

2069 
u32
 
	$iwl_dump_öi_txf_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2070 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2072 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2073 
iwl_txf_ôî_d©a
 *
ôî
 = &
fwπ
->
dump
.
txf_ôî_d©a
;

2074 
u32
 
ªgi°îs_num
 = 
	`iwl_év_¨øy_Àn
(
ªg_d©a
->
ªg_év
, 
ªg
, 
addrs
);

2075 
u32
 
size
 = 0;

2076 
u32
 
fifo_hdr
 = (
iwl_fw_öi_îr‹_dump_ønge
) +

2077 
ªgi°îs_num
 *

2078 (
iwl_fw_öi_îr‹_dump_ªgi°î
);

2080 
	`iwl_öi_txf_ôî
(
fwπ
, 
ªg_d©a
, 
size
)) {

2081 
size
 +
fifo_hdr
;

2082 i‡(!
ªg
->
fifos
.
hdr_⁄ly
)

2083 
size
 +
ôî
->
fifo_size
;

2086 i‡(!
size
)

2089  
size
 + (
iwl_fw_öi_îr‹_dump
);

2090 
	}
}

2092 
u32
 
	$iwl_dump_öi_rxf_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2093 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2095 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2096 
iwl_öi_rxf_d©a
 
rx_d©a
;

2097 
u32
 
ªgi°îs_num
 = 
	`iwl_év_¨øy_Àn
(
ªg_d©a
->
ªg_év
, 
ªg
, 
addrs
);

2098 
u32
 
size
 = (
iwl_fw_öi_îr‹_dump
) +

2099 (
iwl_fw_öi_îr‹_dump_ønge
) +

2100 
ªgi°îs_num
 * (
iwl_fw_öi_îr‹_dump_ªgi°î
);

2102 i‡(
ªg
->
fifos
.
hdr_⁄ly
)

2103  
size
;

2105 
	`iwl_öi_gë_rxf_d©a
(
fwπ
, 
ªg_d©a
, &
rx_d©a
);

2106 
size
 +
rx_d©a
.size;

2108  
size
;

2109 
	}
}

2111 
u32


2112 
	$iwl_dump_öi_îr_èbÀ_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2113 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2115 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2116 
u32
 
size
 = 
	`À32_to_˝u
(
ªg
->
îr_èbÀ
.size);

2118 i‡(
size
)

2119 
size
 +(
iwl_fw_öi_îr_èbÀ_dump
) +

2120 (
iwl_fw_öi_îr‹_dump_ønge
);

2122  
size
;

2123 
	}
}

2125 
u32


2126 
	$iwl_dump_öi_•ecül_mem_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2127 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2129 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2130 
u32
 
size
 = 
	`À32_to_˝u
(
ªg
->
•ecül_mem
.size);

2132 i‡(
size
)

2133 
size
 +(
iwl_fw_öi_•ecül_devi˚_mem‹y
) +

2134 (
iwl_fw_öi_îr‹_dump_ønge
);

2136  
size
;

2137 
	}
}

2139 
u32


2140 
	$iwl_dump_öi_fw_pkt_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2141 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2143 
u32
 
size
 = 0;

2145 i‡(!
ªg_d©a
->
dump_d©a
->
fw_pkt
)

2148 
size
 +
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
ªg_d©a
->
dump_d©a
->
fw_pkt
);

2149 i‡(
size
)

2150 
size
 +(
iwl_fw_öi_îr‹_dump
) +

2151 (
iwl_fw_öi_îr‹_dump_ønge
);

2153  
size
;

2154 
	}
}

2156 
u32


2157 
	$iwl_dump_öi_imr_gë_size
(
iwl_fw_ru¡ime
 *
fwπ
,

2158 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
)

2160 
u32
 
ønges
 = 0;

2161 
u32
 
imr_íabÀ
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.imr_enable;

2162 
u32
 
imr_size
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.imr_size;

2163 
u32
 
§am_size
 = 
fwπ
->
å™s
->
dbg
.
imr_d©a
.sram_size;

2165 i‡(
imr_íabÀ
 =0 || 
imr_size
 =0 || 
§am_size
 == 0) {

2166 
	`IWL_DEBUG_INFO
(
fwπ
,

2168 
imr_íabÀ
, 
imr_size
, 
§am_size
);

2171 
ønges
 = 
	`iwl_dump_öi_imr_ønges
(
fwπ
, 
ªg_d©a
);

2172 i‡(!
ønges
) {

2173 
	`IWL_ERR
(
fwπ
, "WRT:Ñ™ge†:=%d\n", 
ønges
);

2176 
imr_size
 +(
iwl_fw_öi_îr‹_dump
) +

2177 
ønges
 * (
iwl_fw_öi_îr‹_dump_ønge
);

2178  
imr_size
;

2179 
	}
}

2190 
	siwl_dump_öi_mem_›s
 {

2191 
u32
 (*
gë_num_of_ønges
)(
iwl_fw_ru¡ime
 *
	mfwπ
,

2192 
iwl_dump_öi_ªgi⁄_d©a
 *
	mªg_d©a
);

2193 
u32
 (*
gë_size
)(
iwl_fw_ru¡ime
 *
	mfwπ
,

2194 
iwl_dump_öi_ªgi⁄_d©a
 *
	mªg_d©a
);

2195 *(*
	mfûl_mem_hdr
)(
iwl_fw_ru¡ime
 *
	mfwπ
,

2196 
iwl_dump_öi_ªgi⁄_d©a
 *
	mªg_d©a
,

2197 *
	md©a
, 
u32
 
	md©a_Àn
);

2198 (*
	mfûl_ønge
)(
iwl_fw_ru¡ime
 *
	mfwπ
,

2199 
iwl_dump_öi_ªgi⁄_d©a
 *
	mªg_d©a
,

2200 *
	mønge
, 
u32
 
	mønge_Àn
, 
	midx
);

2215 
u32
 
	$iwl_dump_öi_mem
(
iwl_fw_ru¡ime
 *
fwπ
, 
li°_hód
 *
li°
,

2216 
iwl_dump_öi_ªgi⁄_d©a
 *
ªg_d©a
,

2217 c⁄° 
iwl_dump_öi_mem_›s
 *
›s
)

2219 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (*)
ªg_d©a
->
ªg_év
->
d©a
;

2220 
iwl_fw_öi_dump_íåy
 *
íåy
;

2221 
iwl_fw_öi_îr‹_dump_d©a
 *
év
;

2222 
iwl_fw_öi_îr‹_dump_hódî
 *
hódî
;

2223 
u32
 
ty≥
 = 
ªg
->type;

2224 
u32
 
id
 = 
	`À32_gë_bôs
(
ªg
->id, 
IWL_FW_INI_REGION_ID_MASK
);

2225 
u32
 
num_of_ønges
, 
i
, 
size
;

2226 
u8
 *
ønge
;

2227 
u32
 
‰ì_size
;

2228 
u64
 
hódî_size
;

2229 
u32
 
dump_pﬁicy
 = 
IWL_FW_INI_DUMP_VERBOSE
;

2231 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: CollectingÑegion: dumpÅype=%d, id=%d,Åype=%d\n",

2232 
dump_pﬁicy
, 
id
, 
ty≥
);

2234 i‡(
	`À32_to_˝u
(
ªg
->
hdr
.
vîsi⁄
) >= 2) {

2235 
u32
 
dp
 = 
	`À32_gë_bôs
(
ªg
->
id
,

2236 
IWL_FW_INI_REGION_DUMP_POLICY_MASK
);

2238 i‡(
dump_pﬁicy
 =
IWL_FW_INI_DUMP_VERBOSE
 &&

2239 !(
dp
 & 
IWL_FW_INI_DEBUG_DUMP_POLICY_NO_LIMIT
)) {

2240 
	`IWL_DEBUG_FW
(
fwπ
,

2242 
dump_pﬁicy
, 
dp
);

2244 } i‡(
dump_pﬁicy
 =
IWL_FW_INI_DUMP_MEDIUM
 &&

2245 !(
dp
 & 
IWL_FW_IWL_DEBUG_DUMP_POLICY_MAX_LIMIT_5MB
)) {

2246 
	`IWL_DEBUG_FW
(
fwπ
,

2248 
dump_pﬁicy
, 
dp
);

2250 } i‡(
dump_pﬁicy
 =
IWL_FW_INI_DUMP_BRIEF
 &&

2251 !(
dp
 & 
IWL_FW_INI_DEBUG_DUMP_POLICY_MAX_LIMIT_600KB
)) {

2252 
	`IWL_DEBUG_FW
(
fwπ
,

2254 
dump_pﬁicy
, 
dp
);

2259 i‡(!
›s
->
gë_num_of_ønges
 || !›s->
gë_size
 || !›s->
fûl_mem_hdr
 ||

2260 !
›s
->
fûl_ønge
) {

2261 
	`IWL_DEBUG_FW
(
fwπ
, "WRT:Ço ops for collecting data\n");

2265 
size
 = 
›s
->
	`gë_size
(
fwπ
, 
ªg_d©a
);

2267 i‡(
size
 < (*
hódî
)) {

2268 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: size didn't include space for header\n");

2272 
íåy
 = 
	`vzÆloc
((*íåyË+ (*
év
Ë+ 
size
);

2273 i‡(!
íåy
)

2276 
íåy
->
size
 = (*
év
) + size;

2278 
év
 = (*)
íåy
->
d©a
;

2279 
év
->
ty≥
 = 
ªg
->type;

2280 
év
->
sub_ty≥
 = 
ªg
->sub_type;

2281 
év
->
sub_ty≥_vî
 = 
ªg
->sub_type_ver;

2282 
év
->
ª£rved
 = 
ªg
->reserved;

2283 
év
->
Àn
 = 
	`˝u_to_À32
(
size
);

2285 
num_of_ønges
 = 
›s
->
	`gë_num_of_ønges
(
fwπ
, 
ªg_d©a
);

2287 
hódî
 = (*)
év
->
d©a
;

2288 
hódî
->
ªgi⁄_id
 = 
	`˝u_to_À32
(
id
);

2289 
hódî
->
num_of_ønges
 = 
	`˝u_to_À32
(num_of_ranges);

2290 
hódî
->
«me_Àn
 = 
	`˝u_to_À32
(
IWL_FW_INI_MAX_NAME
);

2291 
	`mem˝y
(
hódî
->
«me
, 
ªg
->«me, 
IWL_FW_INI_MAX_NAME
);

2293 
‰ì_size
 = 
size
;

2294 
ønge
 = 
›s
->
	`fûl_mem_hdr
(
fwπ
, 
ªg_d©a
, 
hódî
, 
‰ì_size
);

2295 i‡(!
ønge
) {

2296 
	`IWL_ERR
(
fwπ
,

2298 
id
, 
ty≥
);

2299 
out_îr
;

2302 
hódî_size
 = 
ønge
 - (
u8
 *)
hódî
;

2304 i‡(
	`WARN
(
hódî_size
 > 
‰ì_size
,

2306 
hódî_size
, 
‰ì_size
)) {

2307 
	`IWL_ERR
(
fwπ
,

2309 
out_îr
;

2312 
‰ì_size
 -
hódî_size
;

2314 
i
 = 0; i < 
num_of_ønges
; i++) {

2315 
ønge_size
 = 
›s
->
	`fûl_ønge
(
fwπ
, 
ªg_d©a
, 
ønge
,

2316 
‰ì_size
, 
i
);

2318 i‡(
ønge_size
 < 0) {

2319 
	`IWL_ERR
(
fwπ
,

2321 
id
, 
ty≥
);

2322 
out_îr
;

2325 i‡(
	`WARN
(
ønge_size
 > 
‰ì_size
, "range_size %d > free_size %d",

2326 
ønge_size
, 
‰ì_size
)) {

2327 
	`IWL_ERR
(
fwπ
,

2329 
out_îr
;

2332 
‰ì_size
 -
ønge_size
;

2333 
ønge
 =Ñ™gê+ 
ønge_size
;

2336 
	`li°_add_èû
(&
íåy
->
li°
,Üist);

2338  
íåy
->
size
;

2340 
out_îr
:

2341 
	`v‰ì
(
íåy
);

2344 
	}
}

2346 
u32
 
	$iwl_dump_öi_öfo
(
iwl_fw_ru¡ime
 *
fwπ
,

2347 
iwl_fw_öi_åiggî_év
 *
åiggî
,

2348 
li°_hód
 *
li°
)

2350 
iwl_fw_öi_dump_íåy
 *
íåy
;

2351 
iwl_fw_îr‹_dump_d©a
 *
év
;

2352 
iwl_fw_öi_dump_öfo
 *
dump
;

2353 
iwl_dbg_év_node
 *
node
;

2354 
iwl_fw_öi_dump_cfg_«me
 *
cfg_«me
;

2355 
u32
 
size
 = (*
év
Ë+ (*
dump
);

2356 
u32
 
num_of_cfg_«mes
 = 0;

2357 
u32
 
hw_ty≥
;

2359 
	`li°_f‹_óch_íåy
(
node
, &
fwπ
->
å™s
->
dbg
.
debug_öfo_év_li°
, 
li°
) {

2360 
size
 +(*
cfg_«me
);

2361 
num_of_cfg_«mes
++;

2364 
íåy
 = 
	`vzÆloc
((*íåyË+ 
size
);

2365 i‡(!
íåy
)

2368 
íåy
->
size
 = size;

2370 
év
 = (*)
íåy
->
d©a
;

2371 
év
->
ty≥
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_INFO_TYPE
);

2372 
év
->
Àn
 = 
	`˝u_to_À32
(
size
 - (*tlv));

2374 
dump
 = (*)
év
->
d©a
;

2376 
dump
->
vîsi⁄
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_VER
);

2377 
dump
->
time_poöt
 = 
åiggî
->time_point;

2378 
dump
->
åiggî_ªas⁄
 = 
åiggî
->trigger_reason;

2379 
dump
->
exã∫Æ_cfg_°©e
 =

2380 
	`˝u_to_À32
(
fwπ
->
å™s
->
dbg
.
exã∫Æ_öi_cfg
);

2382 
dump
->
vî_ty≥
 = 
	`˝u_to_À32
(
fwπ
->dump.
fw_vî
.
ty≥
);

2383 
dump
->
vî_subty≥
 = 
	`˝u_to_À32
(
fwπ
->dump.
fw_vî
.
subty≥
);

2385 
dump
->
hw_°ï
 = 
	`˝u_to_À32
(
fwπ
->
å™s
->
hw_ªv_°ï
);

2391 
hw_ty≥
 = 
	`CSR_HW_REV_TYPE
(
fwπ
->
å™s
->
hw_ªv
);

2392 i‡(
hw_ty≥
 =
IWL_AX210_HW_TYPE
) {

2393 
u32
 
¥ph_vÆ
 = 
	`iwl_ªad_umac_¥ph
(
fwπ
->
å™s
, 
WFPM_OTP_CFG1_ADDR
);

2394 
u32
 
is_jackë
 = !!(
¥ph_vÆ
 & 
WFPM_OTP_CFG1_IS_JACKET_BIT
);

2395 
u32
 
is_cdb
 = !!(
¥ph_vÆ
 & 
WFPM_OTP_CFG1_IS_CDB_BIT
);

2396 
u32
 
masked_bôs
 = 
is_jackë
 | (
is_cdb
 << 1);

2403 
hw_ty≥
 |
masked_bôs
 << 
IWL_AX210_HW_TYPE_ADDITION_SHIFT
;

2405 
dump
->
hw_ty≥
 = 
	`˝u_to_À32
(hw_type);

2407 
dump
->
rf_id_Êav‹
 =

2408 
	`˝u_to_À32
(
	`CSR_HW_RFID_FLAVOR
(
fwπ
->
å™s
->
hw_rf_id
));

2409 
dump
->
rf_id_dash
 = 
	`˝u_to_À32
(
	`CSR_HW_RFID_DASH
(
fwπ
->
å™s
->
hw_rf_id
));

2410 
dump
->
rf_id_°ï
 = 
	`˝u_to_À32
(
	`CSR_HW_RFID_STEP
(
fwπ
->
å™s
->
hw_rf_id
));

2411 
dump
->
rf_id_ty≥
 = 
	`˝u_to_À32
(
	`CSR_HW_RFID_TYPE
(
fwπ
->
å™s
->
hw_rf_id
));

2413 
dump
->
lmac_maj‹
 = 
	`˝u_to_À32
(
fwπ
->dump.
fw_vî
.lmac_major);

2414 
dump
->
lmac_mö‹
 = 
	`˝u_to_À32
(
fwπ
->dump.
fw_vî
.lmac_minor);

2415 
dump
->
umac_maj‹
 = 
	`˝u_to_À32
(
fwπ
->dump.
fw_vî
.umac_major);

2416 
dump
->
umac_mö‹
 = 
	`˝u_to_À32
(
fwπ
->dump.
fw_vî
.umac_minor);

2418 
dump
->
fw_m⁄_mode
 = 
	`˝u_to_À32
(
fwπ
->
å™s
->
dbg
.
öi_de°
);

2419 
dump
->
ªgi⁄s_mask
 = 
åiggî
->regions_mask &

2420 ~
	`˝u_to_À64
(
fwπ
->
å™s
->
dbg
.
unsuµ‹ãd_ªgi⁄_msk
);

2422 
dump
->
buûd_èg_Àn
 = 
	`˝u_to_À32
((dump->
buûd_èg
));

2423 
	`mem˝y
(
dump
->
buûd_èg
, 
fwπ
->
fw
->
hum™_ªadabÀ
,

2424 (
dump
->
buûd_èg
));

2426 
cfg_«me
 = 
dump
->
cfg_«mes
;

2427 
dump
->
num_of_cfg_«mes
 = 
	`˝u_to_À32
(num_of_cfg_names);

2428 
	`li°_f‹_óch_íåy
(
node
, &
fwπ
->
å™s
->
dbg
.
debug_öfo_év_li°
, 
li°
) {

2429 
iwl_fw_öi_debug_öfo_év
 *
debug_öfo
 =

2430 (*)
node
->
év
.
d©a
;

2432 
	`BUILD_BUG_ON
((
cfg_«me
->cfg_name) !=

2433 (
debug_öfo
->
debug_cfg_«me
));

2435 
cfg_«me
->
image_ty≥
 = 
debug_öfo
->image_type;

2436 
cfg_«me
->
cfg_«me_Àn
 =

2437 
	`˝u_to_À32
((
cfg_«me
->cfg_name));

2438 
	`mem˝y
(
cfg_«me
->cfg_«me, 
debug_öfo
->
debug_cfg_«me
,

2439 (
cfg_«me
->cfg_name));

2440 
cfg_«me
++;

2446 
	`li°_add
(&
íåy
->
li°
,Üist);

2448  
íåy
->
size
;

2449 
	}
}

2451 
u32
 
	$iwl_dump_öi_fûe_«me_öfo
(
iwl_fw_ru¡ime
 *
fwπ
,

2452 
li°_hód
 *
li°
)

2454 
iwl_fw_öi_dump_íåy
 *
íåy
;

2455 
iwl_dump_fûe_«me_öfo
 *
év
;

2456 
u32
 
Àn
 = 
	`°∫Àn
(
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext
,

2457 
IWL_FW_INI_MAX_NAME
);

2459 i‡(!
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
)

2462 
íåy
 = 
	`vzÆloc
((*íåyË+ (*
év
Ë+ 
Àn
);

2463 i‡(!
íåy
)

2466 
íåy
->
size
 = (*
év
Ë+ 
Àn
;

2468 
év
 = (*)
íåy
->
d©a
;

2469 
év
->
ty≥
 = 
	`˝u_to_À32
(
IWL_INI_DUMP_NAME_TYPE
);

2470 
év
->
Àn
 = 
	`˝u_to_À32
(len);

2471 
	`mem˝y
(
év
->
d©a
, 
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext
, 
Àn
);

2474 
	`li°_add_èû
(&
íåy
->
li°
,Üist);

2476 
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
 = 
Ál£
;

2478  
íåy
->
size
;

2479 
	}
}

2481 c⁄° 
iwl_dump_öi_mem_›s
 
	giwl_dump_öi_ªgi⁄_›s
[] = {

2482 [
IWL_FW_INI_REGION_INVALID
] = {},

2483 [
IWL_FW_INI_REGION_INTERNAL_BUFFER
] = {

2484 .
gë_num_of_ønges
 = 
iwl_dump_öi_sögÀ_ønge
,

2485 .
	ggë_size
 = 
iwl_dump_öi_m⁄_smem_gë_size
,

2486 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_m⁄_smem_fûl_hódî
,

2487 .
	gfûl_ønge
 = 
iwl_dump_öi_m⁄_smem_ôî
,

2489 [
IWL_FW_INI_REGION_DRAM_BUFFER
] = {

2490 .
gë_num_of_ønges
 = 
iwl_dump_öi_m⁄_døm_ønges
,

2491 .
	ggë_size
 = 
iwl_dump_öi_m⁄_døm_gë_size
,

2492 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_m⁄_døm_fûl_hódî
,

2493 .
	gfûl_ønge
 = 
iwl_dump_öi_m⁄_døm_ôî
,

2495 [
IWL_FW_INI_REGION_TXF
] = {

2496 .
gë_num_of_ønges
 = 
iwl_dump_öi_txf_ønges
,

2497 .
	ggë_size
 = 
iwl_dump_öi_txf_gë_size
,

2498 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2499 .
	gfûl_ønge
 = 
iwl_dump_öi_txf_ôî
,

2501 [
IWL_FW_INI_REGION_RXF
] = {

2502 .
gë_num_of_ønges
 = 
iwl_dump_öi_sögÀ_ønge
,

2503 .
	ggë_size
 = 
iwl_dump_öi_rxf_gë_size
,

2504 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2505 .
	gfûl_ønge
 = 
iwl_dump_öi_rxf_ôî
,

2507 [
IWL_FW_INI_REGION_LMAC_ERROR_TABLE
] = {

2508 .
gë_num_of_ønges
 = 
iwl_dump_öi_sögÀ_ønge
,

2509 .
	ggë_size
 = 
iwl_dump_öi_îr_èbÀ_gë_size
,

2510 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_îr_èbÀ_fûl_hódî
,

2511 .
	gfûl_ønge
 = 
iwl_dump_öi_îr_èbÀ_ôî
,

2513 [
IWL_FW_INI_REGION_UMAC_ERROR_TABLE
] = {

2514 .
gë_num_of_ønges
 = 
iwl_dump_öi_sögÀ_ønge
,

2515 .
	ggë_size
 = 
iwl_dump_öi_îr_èbÀ_gë_size
,

2516 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_îr_èbÀ_fûl_hódî
,

2517 .
	gfûl_ønge
 = 
iwl_dump_öi_îr_èbÀ_ôî
,

2519 [
IWL_FW_INI_REGION_RSP_OR_NOTIF
] = {

2520 .
gë_num_of_ønges
 = 
iwl_dump_öi_sögÀ_ønge
,

2521 .
	ggë_size
 = 
iwl_dump_öi_fw_pkt_gë_size
,

2522 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2523 .
	gfûl_ønge
 = 
iwl_dump_öi_fw_pkt_ôî
,

2525 [
IWL_FW_INI_REGION_DEVICE_MEMORY
] = {

2526 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2527 .
	ggë_size
 = 
iwl_dump_öi_mem_gë_size
,

2528 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2529 .
	gfûl_ønge
 = 
iwl_dump_öi_dev_mem_ôî
,

2531 [
IWL_FW_INI_REGION_PERIPHERY_MAC
] = {

2532 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2533 .
	ggë_size
 = 
iwl_dump_öi_mem_gë_size
,

2534 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2535 .
	gfûl_ønge
 = 
iwl_dump_öi_¥ph_mac_ôî
,

2537 [
IWL_FW_INI_REGION_PERIPHERY_PHY
] = {

2538 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2539 .
	ggë_size
 = 
iwl_dump_öi_mem_gë_size
,

2540 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2541 .
	gfûl_ønge
 = 
iwl_dump_öi_¥ph_phy_ôî
,

2543 [
IWL_FW_INI_REGION_PERIPHERY_MAC_RANGE
] = {

2544 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_block_ønges
,

2545 .
	ggë_size
 = 
iwl_dump_öi_mem_block_gë_size
,

2546 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2547 .
	gfûl_ønge
 = 
iwl_dump_öi_¥ph_mac_block_ôî
,

2549 [
IWL_FW_INI_REGION_PERIPHERY_PHY_RANGE
] = {

2550 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_block_ønges
,

2551 .
	ggë_size
 = 
iwl_dump_öi_mem_block_gë_size
,

2552 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2553 .
	gfûl_ønge
 = 
iwl_dump_öi_¥ph_phy_block_ôî
,

2555 [
IWL_FW_INI_REGION_PERIPHERY_AUX
] = {},

2556 [
IWL_FW_INI_REGION_PAGING
] = {

2557 .
fûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2558 .
	ggë_num_of_ønges
 = 
iwl_dump_öi_∑gög_ønges
,

2559 .
	ggë_size
 = 
iwl_dump_öi_∑gög_gë_size
,

2560 .
	gfûl_ønge
 = 
iwl_dump_öi_∑gög_ôî
,

2562 [
IWL_FW_INI_REGION_CSR
] = {

2563 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2564 .
	ggë_size
 = 
iwl_dump_öi_mem_gë_size
,

2565 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2566 .
	gfûl_ønge
 = 
iwl_dump_öi_c§_ôî
,

2568 [
IWL_FW_INI_REGION_DRAM_IMR
] = {

2569 .
gë_num_of_ønges
 = 
iwl_dump_öi_imr_ønges
,

2570 .
	ggë_size
 = 
iwl_dump_öi_imr_gë_size
,

2571 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_imr_fûl_hódî
,

2572 .
	gfûl_ønge
 = 
iwl_dump_öi_imr_ôî
,

2574 [
IWL_FW_INI_REGION_PCI_IOSF_CONFIG
] = {

2575 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2576 .
	ggë_size
 = 
iwl_dump_öi_mem_gë_size
,

2577 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2578 .
	gfûl_ønge
 = 
iwl_dump_öi_c⁄fig_ôî
,

2580 [
IWL_FW_INI_REGION_SPECIAL_DEVICE_MEMORY
] = {

2581 .
gë_num_of_ønges
 = 
iwl_dump_öi_sögÀ_ønge
,

2582 .
	ggë_size
 = 
iwl_dump_öi_•ecül_mem_gë_size
,

2583 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_•ecül_mem_fûl_hódî
,

2584 .
	gfûl_ønge
 = 
iwl_dump_öi_•ecül_mem_ôî
,

2586 [
IWL_FW_INI_REGION_DBGI_SRAM
] = {

2587 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2588 .
	ggë_size
 = 
iwl_dump_öi_m⁄_dbgi_gë_size
,

2589 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_m⁄_dbgi_fûl_hódî
,

2590 .
	gfûl_ønge
 = 
iwl_dump_öi_dbgi_§am_ôî
,

2592 [
IWL_FW_INI_REGION_PERIPHERY_SNPS_DPHYIP
] = {

2593 .
gë_num_of_ønges
 = 
iwl_dump_öi_mem_ønges
,

2594 .
	ggë_size
 = 
iwl_dump_öi_mem_gë_size
,

2595 .
	gfûl_mem_hdr
 = 
iwl_dump_öi_mem_fûl_hódî
,

2596 .
	gfûl_ønge
 = 
iwl_dump_öi_¥ph_¢ps_dphyù_ôî
,

2600 
u32
 
	$iwl_dump_öi_åiggî
(
iwl_fw_ru¡ime
 *
fwπ
,

2601 
iwl_fwπ_dump_d©a
 *
dump_d©a
,

2602 
li°_hód
 *
li°
)

2604 
iwl_fw_öi_åiggî_év
 *
åiggî
 = 
dump_d©a
->
åig
;

2605 
iwl_fw_öi_time_poöt
 
ç_id
 = 
	`À32_to_˝u
(
åiggî
->
time_poöt
);

2606 
iwl_dump_öi_ªgi⁄_d©a
 
ªg_d©a
 = {

2607 .
dump_d©a
 = dump_data,

2609 
iwl_dump_öi_ªgi⁄_d©a
 
imr_ªg_d©a
 = {

2610 .
dump_d©a
 = dump_data,

2612 
i
;

2613 
u32
 
size
 = 0;

2614 
u64
 
ªgi⁄s_mask
 = 
	`À64_to_˝u
(
åiggî
->regions_mask) &

2615 ~(
fwπ
->
å™s
->
dbg
.
unsuµ‹ãd_ªgi⁄_msk
);

2617 
	`BUILD_BUG_ON
((
åiggî
->
ªgi⁄s_mask
) != (regions_mask));

2618 
	`BUILD_BUG_ON
(((
åiggî
->
ªgi⁄s_mask
Ë* 
BITS_PER_BYTE
) <

2619 
	`ARRAY_SIZE
(
fwπ
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
));

2621 
i
 = 0; i < 
	`ARRAY_SIZE
(
fwπ
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
); i++) {

2622 
u32
 
ªg_ty≥
;

2623 
iwl_fw_öi_ªgi⁄_év
 *
ªg
;

2625 i‡(!(
	`BIT_ULL
(
i
Ë& 
ªgi⁄s_mask
))

2628 
ªg_d©a
.
ªg_év
 = 
fwπ
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
[
i
];

2629 i‡(!
ªg_d©a
.
ªg_év
) {

2630 
	`IWL_WARN
(
fwπ
,

2631 "WRT: U«ssig√dÑegi⁄ id %d, skùpög\n", 
i
);

2635 
ªg
 = (*)
ªg_d©a
.
ªg_év
->
d©a
;

2636 
ªg_ty≥
 = 
ªg
->
ty≥
;

2637 i‡(
ªg_ty≥
 >
	`ARRAY_SIZE
(
iwl_dump_öi_ªgi⁄_›s
))

2640 i‡((
ªg_ty≥
 =
IWL_FW_INI_REGION_PERIPHERY_PHY
 ||

2641 
ªg_ty≥
 =
IWL_FW_INI_REGION_PERIPHERY_PHY_RANGE
 ||

2642 
ªg_ty≥
 =
IWL_FW_INI_REGION_PERIPHERY_SNPS_DPHYIP
) &&

2643 
ç_id
 !
IWL_FW_INI_TIME_POINT_FW_ASSERT
) {

2644 
	`IWL_WARN
(
fwπ
,

2646 
ç_id
);

2655 i‡(
ªg_ty≥
 =
IWL_FW_INI_REGION_DRAM_IMR
) {

2656 i‡(
ç_id
 =
IWL_FW_INI_TIME_POINT_FW_ASSERT
 ||

2657 
ç_id
 =
IWL_FW_INI_TIME_POINT_FW_HW_ERROR
)

2658 
imr_ªg_d©a
.
ªg_év
 = 
fwπ
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
[
i
];

2660 
	`IWL_INFO
(
fwπ
,

2662 
ç_id
);

2668 
size
 +
	`iwl_dump_öi_mem
(
fwπ
, 
li°
, &
ªg_d©a
,

2669 &
iwl_dump_öi_ªgi⁄_›s
[
ªg_ty≥
]);

2672 i‡(
imr_ªg_d©a
.
ªg_év
)

2673 
size
 +
	`iwl_dump_öi_mem
(
fwπ
, 
li°
, &
ªg_d©a
,

2674 &
iwl_dump_öi_ªgi⁄_›s
[
IWL_FW_INI_REGION_DRAM_IMR
]);

2676 i‡(
size
) {

2677 
size
 +
	`iwl_dump_öi_fûe_«me_öfo
(
fwπ
, 
li°
);

2678 
size
 +
	`iwl_dump_öi_öfo
(
fwπ
, 
åiggî
, 
li°
);

2681  
size
;

2682 
	}
}

2684 
boﬁ
 
	$iwl_fw_öi_åiggî_⁄
(
iwl_fw_ru¡ime
 *
fwπ
,

2685 
iwl_fw_öi_åiggî_év
 *
åig
)

2687 
iwl_fw_öi_time_poöt
 
ç_id
 = 
	`À32_to_˝u
(
åig
->
time_poöt
);

2688 
u32
 
u£c
 = 
	`À32_to_˝u
(
åig
->
ign‹e_c⁄£c
);

2690 i‡(!
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
) ||

2691 
ç_id
 =
IWL_FW_INI_TIME_POINT_INVALID
 ||

2692 
ç_id
 >
IWL_FW_INI_TIME_POINT_NUM
 ||

2693 
	`iwl_fw_dbg_no_åig_wödow
(
fwπ
, 
ç_id
, 
u£c
))

2694  
Ál£
;

2696  
åue
;

2697 
	}
}

2699 
u32
 
	$iwl_dump_öi_fûe_gí
(
iwl_fw_ru¡ime
 *
fwπ
,

2700 
iwl_fwπ_dump_d©a
 *
dump_d©a
,

2701 
li°_hód
 *
li°
)

2703 
iwl_fw_öi_åiggî_év
 *
åiggî
 = 
dump_d©a
->
åig
;

2704 
iwl_fw_öi_dump_íåy
 *
íåy
;

2705 
iwl_fw_öi_dump_fûe_hdr
 *
hdr
;

2706 
u32
 
size
;

2708 i‡(!
åiggî
 || !
	`iwl_fw_öi_åiggî_⁄
(
fwπ
,Årigger) ||

2709 !
	`À64_to_˝u
(
åiggî
->
ªgi⁄s_mask
))

2712 
íåy
 = 
	`vzÆloc
((*íåyË+ (*
hdr
));

2713 i‡(!
íåy
)

2716 
íåy
->
size
 = (*
hdr
);

2718 
size
 = 
	`iwl_dump_öi_åiggî
(
fwπ
, 
dump_d©a
, 
li°
);

2719 i‡(!
size
) {

2720 
	`v‰ì
(
íåy
);

2724 
hdr
 = (*)
íåy
->
d©a
;

2725 
hdr
->
b¨kî
 = 
	`˝u_to_À32
(
IWL_FW_INI_ERROR_DUMP_BARKER
);

2726 
hdr
->
fûe_Àn
 = 
	`˝u_to_À32
(
size
 + 
íåy
->size);

2728 
	`li°_add
(&
íåy
->
li°
,Üist);

2730  
	`À32_to_˝u
(
hdr
->
fûe_Àn
);

2731 
	}
}

2733 
ölöe
 
	$iwl_fw_‰ì_dump_desc
(
iwl_fw_ru¡ime
 *
fwπ
,

2734 c⁄° 
iwl_fw_dump_desc
 *
desc
)

2736 i‡(
desc
 && des¯!&
iwl_dump_desc_as£π
)

2737 
	`k‰ì
(
desc
);

2739 
fwπ
->
dump
.
lmac_îr_id
[0] = 0;

2740 i‡(
fwπ
->
smem_cfg
.
num_lmacs
 > 1)

2741 
fwπ
->
dump
.
lmac_îr_id
[1] = 0;

2742 
fwπ
->
dump
.
umac_îr_id
 = 0;

2743 
	}
}

2745 
	$iwl_fw_îr‹_dump
(
iwl_fw_ru¡ime
 *
fwπ
,

2746 
iwl_fwπ_dump_d©a
 *
dump_d©a
)

2748 
iwl_fw_dump_±rs
 
fw_îr‹_dump
 = {};

2749 
iwl_fw_îr‹_dump_fûe
 *
dump_fûe
;

2750 
sˇâîli°
 *
sg_dump_d©a
;

2751 
u32
 
fûe_Àn
;

2752 
u32
 
dump_mask
 = 
fwπ
->
fw
->
dbg
.dump_mask;

2754 
dump_fûe
 = 
	`iwl_fw_îr‹_dump_fûe
(
fwπ
, &
fw_îr‹_dump
, 
dump_d©a
);

2755 i‡(!
dump_fûe
)

2758 i‡(
dump_d©a
->
m⁄ô‹_⁄ly
)

2759 
dump_mask
 &
	`BIT
(
IWL_FW_ERROR_DUMP_FW_MONITOR
);

2761 
fw_îr‹_dump
.
å™s_±r
 = 
	`iwl_å™s_dump_d©a
(
fwπ
->
å™s
, 
dump_mask
,

2762 
fwπ
->
ßnôize_›s
,

2763 
fwπ
->
ßnôize_˘x
);

2764 
fûe_Àn
 = 
	`À32_to_˝u
(
dump_fûe
->file_len);

2765 
fw_îr‹_dump
.
fwπ_Àn
 = 
fûe_Àn
;

2767 i‡(
fw_îr‹_dump
.
å™s_±r
) {

2768 
fûe_Àn
 +
fw_îr‹_dump
.
å™s_±r
->
Àn
;

2769 
dump_fûe
->
fûe_Àn
 = 
	`˝u_to_À32
(file_len);

2772 
sg_dump_d©a
 = 
	`Æloc_sgèbÀ
(
fûe_Àn
);

2773 i‡(
sg_dump_d©a
) {

2774 
	`sg_pc›y_‰om_buf„r
(
sg_dump_d©a
,

2775 
	`sg_√¡s
(
sg_dump_d©a
),

2776 
fw_îr‹_dump
.
fwπ_±r
,

2777 
fw_îr‹_dump
.
fwπ_Àn
, 0);

2778 i‡(
fw_îr‹_dump
.
å™s_±r
)

2779 
	`sg_pc›y_‰om_buf„r
(
sg_dump_d©a
,

2780 
	`sg_√¡s
(
sg_dump_d©a
),

2781 
fw_îr‹_dump
.
å™s_±r
->
d©a
,

2782 
fw_îr‹_dump
.
å™s_±r
->
Àn
,

2783 
fw_îr‹_dump
.
fwπ_Àn
);

2784 
	`dev_c‹edumpsg
(
fwπ
->
å™s
->
dev
, 
sg_dump_d©a
, 
fûe_Àn
,

2785 
GFP_KERNEL
);

2787 
	`v‰ì
(
fw_îr‹_dump
.
fwπ_±r
);

2788 
	`v‰ì
(
fw_îr‹_dump
.
å™s_±r
);

2789 
	}
}

2791 
	$iwl_dump_öi_li°_‰ì
(
li°_hód
 *
li°
)

2793 !
	`li°_em±y
(
li°
)) {

2794 
iwl_fw_öi_dump_íåy
 *
íåy
 =

2795 
	`li°_íåy
(
li°
->
√xt
, 
	`ty≥of
(*
íåy
),Üist);

2797 
	`li°_dñ
(&
íåy
->
li°
);

2798 
	`v‰ì
(
íåy
);

2800 
	}
}

2802 
	$iwl_fw_îr‹_dump_d©a_‰ì
(
iwl_fwπ_dump_d©a
 *
dump_d©a
)

2804 
dump_d©a
->
åig
 = 
NULL
;

2805 
	`k‰ì
(
dump_d©a
->
fw_pkt
);

2806 
dump_d©a
->
fw_pkt
 = 
NULL
;

2807 
	}
}

2809 
	$iwl_fw_îr‹_öi_dump
(
iwl_fw_ru¡ime
 *
fwπ
,

2810 
iwl_fwπ_dump_d©a
 *
dump_d©a
)

2812 
	`LIST_HEAD
(
dump_li°
);

2813 
sˇâîli°
 *
sg_dump_d©a
;

2814 
u32
 
fûe_Àn
 = 
	`iwl_dump_öi_fûe_gí
(
fwπ
, 
dump_d©a
, &
dump_li°
);

2816 i‡(!
fûe_Àn
)

2819 
sg_dump_d©a
 = 
	`Æloc_sgèbÀ
(
fûe_Àn
);

2820 i‡(
sg_dump_d©a
) {

2821 
iwl_fw_öi_dump_íåy
 *
íåy
;

2822 
sg_íåõs
 = 
	`sg_√¡s
(
sg_dump_d©a
);

2823 
u32
 
offs
 = 0;

2825 
	`li°_f‹_óch_íåy
(
íåy
, &
dump_li°
, 
li°
) {

2826 
	`sg_pc›y_‰om_buf„r
(
sg_dump_d©a
, 
sg_íåõs
,

2827 
íåy
->
d©a
,É¡ry->
size
, 
offs
);

2828 
offs
 +
íåy
->
size
;

2830 
	`dev_c‹edumpsg
(
fwπ
->
å™s
->
dev
, 
sg_dump_d©a
, 
fûe_Àn
,

2831 
GFP_KERNEL
);

2833 
	`iwl_dump_öi_li°_‰ì
(&
dump_li°
);

2834 
	}
}

2836 c⁄° 
iwl_fw_dump_desc
 
	giwl_dump_desc_as£π
 = {

2837 .
åig_desc
 = {

2838 .
ty≥
 = 
˝u_to_À32
(
FW_DBG_TRIGGER_FW_ASSERT
),

2841 
IWL_EXPORT_SYMBOL
(
iwl_dump_desc_as£π
);

2843 
	$iwl_fw_dbg_cﬁÀ˘_desc
(
iwl_fw_ru¡ime
 *
fwπ
,

2844 c⁄° 
iwl_fw_dump_desc
 *
desc
,

2845 
boﬁ
 
m⁄ô‹_⁄ly
,

2846 
dñay
)

2848 
iwl_fwπ_wk_d©a
 *
wk_d©a
;

2849 
idx
;

2851 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
)) {

2852 
	`iwl_fw_‰ì_dump_desc
(
fwπ
, 
desc
);

2861 i‡(
fwπ
->
dump
.
a˘ive_wks
 == ~0UL)

2862  -
EBUSY
;

2864 
idx
 = 
	`ffz
(
fwπ
->
dump
.
a˘ive_wks
);

2866 i‡(
idx
 >
IWL_FW_RUNTIME_DUMP_WK_NUM
 ||

2867 
	`ã°_™d_£t_bô
(
fwπ
->
dump
.
wks
[
idx
].idx, &fwπ->dump.
a˘ive_wks
))

2868  -
EBUSY
;

2870 
wk_d©a
 = &
fwπ
->
dump
.
wks
[
idx
];

2872 i‡(
	`WARN_ON
(
wk_d©a
->
dump_d©a
.
desc
))

2873 
	`iwl_fw_‰ì_dump_desc
(
fwπ
, 
wk_d©a
->
dump_d©a
.
desc
);

2875 
wk_d©a
->
dump_d©a
.
desc
 = desc;

2876 
wk_d©a
->
dump_d©a
.
m⁄ô‹_⁄ly
 = monitor_only;

2878 
	`IWL_WARN
(
fwπ
, "Collecting data:Årigger %d fired.\n",

2879 
	`À32_to_˝u
(
desc
->
åig_desc
.
ty≥
));

2881 
	`queue_dñayed_w‹k
(
sy°em_unbound_wq
, &
wk_d©a
->
wk
,

2882 
	`u£cs_to_jiffõs
(
dñay
));

2885 
	}
}

2886 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_cﬁÀ˘_desc
);

2888 
	$iwl_fw_dbg_îr‹_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
,

2889 
iwl_fw_dbg_åiggî
 
åig_ty≥
)

2891 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
fwπ
->
å™s
->
°©us
))

2892  -
EIO
;

2894 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
)) {

2895 i‡(
åig_ty≥
 !
FW_DBG_TRIGGER_ALIVE_TIMEOUT
 &&

2896 
åig_ty≥
 !
FW_DBG_TRIGGER_DRIVER
)

2897  -
EIO
;

2899 
	`iwl_dbg_év_time_poöt
(
fwπ
,

2900 
IWL_FW_INI_TIME_POINT_HOST_ALIVE_TIMEOUT
,

2901 
NULL
);

2903 
iwl_fw_dump_desc
 *
iwl_dump_îr‹_desc
;

2904 
ªt
;

2906 
iwl_dump_îr‹_desc
 =

2907 
	`kmÆloc
((*
iwl_dump_îr‹_desc
), 
GFP_KERNEL
);

2909 i‡(!
iwl_dump_îr‹_desc
)

2910  -
ENOMEM
;

2912 
iwl_dump_îr‹_desc
->
åig_desc
.
ty≥
 = 
	`˝u_to_À32
(
åig_ty≥
);

2913 
iwl_dump_îr‹_desc
->
Àn
 = 0;

2915 
ªt
 = 
	`iwl_fw_dbg_cﬁÀ˘_desc
(
fwπ
, 
iwl_dump_îr‹_desc
,

2916 
Ál£
, 0);

2917 i‡(
ªt
) {

2918 
	`k‰ì
(
iwl_dump_îr‹_desc
);

2919  
ªt
;

2923 
	`iwl_å™s_sync_nmi
(
fwπ
->
å™s
);

2926 
	}
}

2927 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_îr‹_cﬁÀ˘
);

2929 
	$iwl_fw_dbg_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
,

2930 
iwl_fw_dbg_åiggî
 
åig
,

2931 c⁄° *
°r
, 
size_t
 
Àn
,

2932 
iwl_fw_dbg_åiggî_év
 *
åiggî
)

2934 
iwl_fw_dump_desc
 *
desc
;

2935 
dñay
 = 0;

2936 
boﬁ
 
m⁄ô‹_⁄ly
 = 
Ál£
;

2938 i‡(
åiggî
) {

2939 
u16
 
occuºí˚s
 = 
	`À16_to_˝u
(
åiggî
->occurrences) - 1;

2941 i‡(!
	`À16_to_˝u
(
åiggî
->
occuºí˚s
))

2944 i‡(
åiggî
->
Êags
 & 
IWL_FW_DBG_FORCE_RESTART
) {

2945 
	`IWL_WARN
(
fwπ
, "ForceÑestart:Årigger %d fired.\n",

2946 
åig
);

2947 
	`iwl_f‹˚_nmi
(
fwπ
->
å™s
);

2951 
åiggî
->
occuºí˚s
 = 
	`˝u_to_À16
(occurrences);

2952 
m⁄ô‹_⁄ly
 = 
åiggî
->
mode
 & 
IWL_FW_DBG_TRIGGER_MONITOR_ONLY
;

2955 
dñay
 = 
	`À32_to_˝u
(
åiggî
->
°›_dñay
Ë* 
USEC_PER_MSEC
;

2958 
desc
 = 
	`kzÆloc
(
	`°ru˘_size
(desc, 
åig_desc
.
d©a
, 
Àn
), 
GFP_ATOMIC
);

2959 i‡(!
desc
)

2960  -
ENOMEM
;

2963 
desc
->
Àn
 =Üen;

2964 
desc
->
åig_desc
.
ty≥
 = 
	`˝u_to_À32
(
åig
);

2965 
	`mem˝y
(
desc
->
åig_desc
.
d©a
, 
°r
, 
Àn
);

2967  
	`iwl_fw_dbg_cﬁÀ˘_desc
(
fwπ
, 
desc
, 
m⁄ô‹_⁄ly
, 
dñay
);

2968 
	}
}

2969 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_cﬁÀ˘
);

2971 
	$iwl_fw_dbg_cﬁÀ˘_åig
(
iwl_fw_ru¡ime
 *
fwπ
,

2972 
iwl_fw_dbg_åiggî_év
 *
åiggî
,

2973 c⁄° *
fmt
, ...)

2975 
ªt
, 
Àn
 = 0;

2976 
buf
[64];

2978 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
))

2981 i‡(
fmt
) {

2982 
va_li°
 
≠
;

2984 
buf
[(buf) - 1] = '\0';

2986 
	`va_°¨t
(
≠
, 
fmt
);

2987 
	`v¢¥ötf
(
buf
, (buf), 
fmt
, 
≠
);

2988 
	`va_íd
(
≠
);

2991 i‡(
	`WARN_ON_ONCE
(
buf
[(buf) - 1]))

2992 
buf
[(buf) - 1] = '\0';

2994 
Àn
 = 
	`°æí
(
buf
) + 1;

2997 
ªt
 = 
	`iwl_fw_dbg_cﬁÀ˘
(
fwπ
, 
	`À32_to_˝u
(
åiggî
->
id
), 
buf
, 
Àn
,

2998 
åiggî
);

3000 i‡(
ªt
)

3001  
ªt
;

3004 
	}
}

3005 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_cﬁÀ˘_åig
);

3007 
	$iwl_fw_°¨t_dbg_c⁄f
(
iwl_fw_ru¡ime
 *
fwπ
, 
u8
 
c⁄f_id
)

3009 
u8
 *
±r
;

3010 
ªt
;

3011 
i
;

3013 i‡(
	`WARN_ONCE
(
c⁄f_id
 >
	`ARRAY_SIZE
(
fwπ
->
fw
->
dbg
.
c⁄f_év
),

3014 "InvÆid c⁄figuøti⁄ %d\n", 
c⁄f_id
))

3015  -
EINVAL
;

3018 i‡((!
fwπ
->
fw
->
dbg
.
c⁄f_év
[
c⁄f_id
] ||

3019 !
fwπ
->
fw
->
dbg
.
c⁄f_év
[
c⁄f_id
]->
num_of_hcmds
) &&

3020 
c⁄f_id
 =
FW_DBG_START_FROM_ALIVE
)

3023 i‡(!
fwπ
->
fw
->
dbg
.
c⁄f_év
[
c⁄f_id
])

3024  -
EINVAL
;

3026 i‡(
fwπ
->
dump
.
c⁄f
 !
FW_DBG_INVALID
)

3027 
	`IWL_INFO
(
fwπ
, "FWálready configured (%d) -Ñe-configuring\n",

3028 
fwπ
->
dump
.
c⁄f
);

3031 
±r
 = (*)&
fwπ
->
fw
->
dbg
.
c⁄f_év
[
c⁄f_id
]->
hcmd
;

3032 
i
 = 0; i < 
fwπ
->
fw
->
dbg
.
c⁄f_év
[
c⁄f_id
]->
num_of_hcmds
; i++) {

3033 
iwl_fw_dbg_c⁄f_hcmd
 *
cmd
 = (*)
±r
;

3034 
iwl_ho°_cmd
 
hcmd
 = {

3035 .
id
 = 
cmd
->id,

3036 .
Àn
 = { 
	`À16_to_˝u
(
cmd
->len), },

3037 .
d©a
 = { 
cmd
->data, },

3040 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

3041 i‡(
ªt
)

3042  
ªt
;

3044 
±r
 +(*
cmd
);

3045 
±r
 +
	`À16_to_˝u
(
cmd
->
Àn
);

3048 
fwπ
->
dump
.
c⁄f
 = 
c⁄f_id
;

3051 
	}
}

3052 
IWL_EXPORT_SYMBOL
(
iwl_fw_°¨t_dbg_c⁄f
);

3054 
	$iwl_£nd_dbg_dump_com∂ëe_cmd
(
iwl_fw_ru¡ime
 *
fwπ
,

3055 
u32
 
timïoöt
,

3056 
u32
 
timïoöt_d©a
)

3058 
iwl_dbg_dump_com∂ëe_cmd
 
hcmd_d©a
;

3059 
iwl_ho°_cmd
 
hcmd
 = {

3060 .
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, 
FW_DUMP_COMPLETE_CMD
),

3061 .
d©a
[0] = &
hcmd_d©a
,

3062 .
Àn
[0] = (
hcmd_d©a
),

3065 i‡(
	`ã°_bô
(
STATUS_FW_ERROR
, &
fwπ
->
å™s
->
°©us
))

3068 i‡(
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

3069 
IWL_UCODE_TLV_CAPA_DUMP_COMPLETE_SUPPORT
)) {

3070 
hcmd_d©a
.
ç
 = 
	`˝u_to_À32
(
timïoöt
);

3071 
hcmd_d©a
.
ç_d©a
 = 
	`˝u_to_À32
(
timïoöt_d©a
);

3072 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

3074 
	}
}

3079 
	$iwl_fw_dbg_cﬁÀ˘_sync
(
iwl_fw_ru¡ime
 *
fwπ
, 
u8
 
wk_idx
)

3081 
iwl_fw_dbg_∑øms
 
∑øms
 = {0};

3082 
iwl_fwπ_dump_d©a
 *
dump_d©a
 =

3083 &
fwπ
->
dump
.
wks
[
wk_idx
].
dump_d©a
;

3084 i‡(!
	`ã°_bô
(
wk_idx
, &
fwπ
->
dump
.
a˘ive_wks
))

3087 i‡(!
dump_d©a
->
åig
) {

3088 
	`IWL_ERR
(
fwπ
, "dumpÅrigger data isÇot set\n");

3089 
out
;

3092 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
fwπ
->
å™s
->
°©us
)) {

3093 
	`IWL_ERR
(
fwπ
, "Device isÇotÉnabled - cannot dumpÉrror\n");

3094 
out
;

3098 i‡(
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
fwπ
->
å™s
->
°©us
)) {

3099 
	`IWL_ERR
(
fwπ
, "Skip fwÉrror dump since bus is dead\n");

3100 
out
;

3103 
	`iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(
fwπ
, &
∑øms
, 
åue
);

3105 
	`IWL_DEBUG_FW_INFO
(
fwπ
, "WRT: Data collection start\n");

3106 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
))

3107 
	`iwl_fw_îr‹_öi_dump
(
fwπ
, &fwπ->
dump
.
wks
[
wk_idx
].
dump_d©a
);

3109 
	`iwl_fw_îr‹_dump
(
fwπ
, &fwπ->
dump
.
wks
[
wk_idx
].
dump_d©a
);

3110 
	`IWL_DEBUG_FW_INFO
(
fwπ
, "WRT: Data collection done\n");

3112 
	`iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(
fwπ
, &
∑øms
, 
Ál£
);

3114 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
)) {

3115 
u32
 
pﬁicy
 = 
	`À32_to_˝u
(
dump_d©a
->
åig
->
≠∂y_pﬁicy
);

3116 
u32
 
time_poöt
 = 
	`À32_to_˝u
(
dump_d©a
->
åig
->time_point);

3118 i‡(
pﬁicy
 & 
IWL_FW_INI_APPLY_POLICY_DUMP_COMPLETE_CMD
) {

3119 
	`IWL_DEBUG_FW_INFO
(
fwπ
, "WRT: sending dump complete\n");

3120 
	`iwl_£nd_dbg_dump_com∂ëe_cmd
(
fwπ
, 
time_poöt
, 0);

3124 i‡(
fwπ
->
å™s
->
dbg
.
œ°_ç_ª£tfw
 =
IWL_FW_INI_RESET_FW_MODE_STOP_FW_ONLY
)

3125 
	`iwl_f‹˚_nmi
(
fwπ
->
å™s
);

3127 
out
:

3128 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
)) {

3129 
	`iwl_fw_îr‹_dump_d©a_‰ì
(
dump_d©a
);

3131 
	`iwl_fw_‰ì_dump_desc
(
fwπ
, 
dump_d©a
->
desc
);

3132 
dump_d©a
->
desc
 = 
NULL
;

3135 
	`˛ór_bô
(
wk_idx
, &
fwπ
->
dump
.
a˘ive_wks
);

3136 
	}
}

3138 
	$iwl_fw_dbg_öi_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
,

3139 
iwl_fwπ_dump_d©a
 *
dump_d©a
,

3140 
boﬁ
 
sync
)

3142 
iwl_fw_öi_åiggî_év
 *
åig
 = 
dump_d©a
->trig;

3143 
iwl_fw_öi_time_poöt
 
ç_id
 = 
	`À32_to_˝u
(
åig
->
time_poöt
);

3144 
u32
 
occur
, 
dñay
;

3145 
idx
;

3147 i‡(!
	`iwl_fw_öi_åiggî_⁄
(
fwπ
, 
åig
)) {

3148 
	`IWL_WARN
(
fwπ
, "WRT: Trigger %d isÇotáctive,áborting dump\n",

3149 
ç_id
);

3150  -
EINVAL
;

3153 
dñay
 = 
	`À32_to_˝u
(
åig
->
dump_dñay
);

3154 
occur
 = 
	`À32_to_˝u
(
åig
->
occuºí˚s
);

3155 i‡(!
occur
)

3158 
åig
->
occuºí˚s
 = 
	`˝u_to_À32
(--
occur
);

3164 i‡(
fwπ
->
dump
.
a˘ive_wks
 == ~0UL)

3165  -
EBUSY
;

3167 
idx
 = 
	`ffz
(
fwπ
->
dump
.
a˘ive_wks
);

3169 i‡(
idx
 >
IWL_FW_RUNTIME_DUMP_WK_NUM
 ||

3170 
	`ã°_™d_£t_bô
(
fwπ
->
dump
.
wks
[
idx
].idx, &fwπ->dump.
a˘ive_wks
))

3171  -
EBUSY
;

3173 
fwπ
->
dump
.
wks
[
idx
].
dump_d©a
 = *dump_data;

3175 i‡(
sync
)

3176 
dñay
 = 0;

3178 
	`IWL_WARN
(
fwπ
,

3180 
ç_id
, (
u32
)(
dñay
 / 
USEC_PER_MSEC
));

3182 i‡(
sync
)

3183 
	`iwl_fw_dbg_cﬁÀ˘_sync
(
fwπ
, 
idx
);

3185 
	`queue_dñayed_w‹k
(
sy°em_unbound_wq
,

3186 &
fwπ
->
dump
.
wks
[
idx
].
wk
,

3187 
	`u£cs_to_jiffõs
(
dñay
));

3190 
	}
}

3192 
	$iwl_fw_îr‹_dump_wk
(
w‹k_°ru˘
 *
w‹k
)

3194 
iwl_fwπ_wk_d©a
 *
wks
 =

3195 
	`c⁄èöî_of
(
w‹k
, 
	`ty≥of
(*
wks
), 
wk
.work);

3196 
iwl_fw_ru¡ime
 *
fwπ
 =

3197 
	`c⁄èöî_of
(
wks
, 
	`ty≥of
(*
fwπ
), 
dump
.wks[wks->
idx
]);

3202 i‡(
fwπ
->
›s
 && fwπ->›s->
dump_°¨t
)

3203 
fwπ
->
›s
->
	`dump_°¨t
(fwπ->
›s_˘x
);

3205 
	`iwl_fw_dbg_cﬁÀ˘_sync
(
fwπ
, 
wks
->
idx
);

3207 i‡(
fwπ
->
›s
 && fwπ->›s->
dump_íd
)

3208 
fwπ
->
›s
->
	`dump_íd
(fwπ->
›s_˘x
);

3209 
	}
}

3211 
	$iwl_fw_dbg_ªad_d3_debug_d©a
(
iwl_fw_ru¡ime
 *
fwπ
)

3213 c⁄° 
iwl_cfg
 *
cfg
 = 
fwπ
->
å™s
->cfg;

3215 i‡(!
	`iwl_fw_dbg_is_d3_debug_íabÀd
(
fwπ
))

3218 i‡(!
fwπ
->
dump
.
d3_debug_d©a
) {

3219 
fwπ
->
dump
.
d3_debug_d©a
 = 
	`kmÆloc
(
cfg
->
d3_debug_d©a_Àngth
,

3220 
GFP_KERNEL
);

3221 i‡(!
fwπ
->
dump
.
d3_debug_d©a
) {

3222 
	`IWL_ERR
(
fwπ
,

3229 
	`iwl_å™s_ªad_mem_byãs
(
fwπ
->
å™s
, 
cfg
->
d3_debug_d©a_ba£_addr
,

3230 
fwπ
->
dump
.
d3_debug_d©a
,

3231 
cfg
->
d3_debug_d©a_Àngth
);

3233 i‡(
fwπ
->
ßnôize_›s
 && fwπ->ßnôize_›s->
‰ob_mem
)

3234 
fwπ
->
ßnôize_›s
->
	`‰ob_mem
(fwπ->
ßnôize_˘x
,

3235 
cfg
->
d3_debug_d©a_ba£_addr
,

3236 
fwπ
->
dump
.
d3_debug_d©a
,

3237 
cfg
->
d3_debug_d©a_Àngth
);

3238 
	}
}

3239 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_ªad_d3_debug_d©a
);

3241 
	$iwl_fw_dbg_°›_sync
(
iwl_fw_ru¡ime
 *
fwπ
)

3243 
i
;

3245 
	`iwl_dbg_év_dñ_timîs
(
fwπ
->
å™s
);

3246 
i
 = 0; i < 
IWL_FW_RUNTIME_DUMP_WK_NUM
; i++)

3247 
	`iwl_fw_dbg_cﬁÀ˘_sync
(
fwπ
, 
i
);

3249 
	`iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(
fwπ
, 
NULL
, 
åue
);

3250 
	}
}

3251 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_°›_sync
);

3253 
	$iwl_fw_dbg_su•íd_ªsume_hcmd
(
iwl_å™s
 *
å™s
, 
boﬁ
 
su•íd
)

3255 
iwl_dbg_su•íd_ªsume_cmd
 
cmd
 = {

3256 .
›î©i⁄
 = 
su•íd
 ?

3257 
	`˝u_to_À32
(
DBGC_SUSPEND_CMD
) :

3258 
	`˝u_to_À32
(
DBGC_RESUME_CMD
),

3260 
iwl_ho°_cmd
 
hcmd
 = {

3261 .
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, 
DBGC_SUSPEND_RESUME
),

3262 .
d©a
[0] = &
cmd
,

3263 .
Àn
[0] = (
cmd
),

3266  
	`iwl_å™s_£nd_cmd
(
å™s
, &
hcmd
);

3267 
	}
}

3269 
	$iwl_fw_dbg_°›_ªc‹dög
(
iwl_å™s
 *
å™s
,

3270 
iwl_fw_dbg_∑øms
 *
∑øms
)

3272 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_7000
) {

3273 
	`iwl_£t_bôs_¥ph
(
å™s
, 
MON_BUFF_SAMPLE_CTL
, 0x100);

3277 i‡(
∑øms
) {

3278 
∑øms
->
ö_ßm∂e
 = 
	`iwl_ªad_umac_¥ph
(
å™s
, 
DBGC_IN_SAMPLE
);

3279 
∑øms
->
out_˘æ
 = 
	`iwl_ªad_umac_¥ph
(
å™s
, 
DBGC_OUT_CTRL
);

3282 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
DBGC_IN_SAMPLE
, 0);

3286 
	`u¶ìp_ønge
(700, 1000);

3287 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
DBGC_OUT_CTRL
, 0);

3288 
	}
}

3290 
	$iwl_fw_dbg_ª°¨t_ªc‹dög
(
iwl_å™s
 *
å™s
,

3291 
iwl_fw_dbg_∑øms
 *
∑øms
)

3293 i‡(!
∑øms
)

3294  -
EIO
;

3296 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_7000
) {

3297 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
MON_BUFF_SAMPLE_CTL
, 0x100);

3298 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
MON_BUFF_SAMPLE_CTL
, 0x1);

3299 
	`iwl_£t_bôs_¥ph
(
å™s
, 
MON_BUFF_SAMPLE_CTL
, 0x1);

3301 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
DBGC_IN_SAMPLE
, 
∑øms
->
ö_ßm∂e
);

3302 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
DBGC_OUT_CTRL
, 
∑øms
->
out_˘æ
);

3306 
	}
}

3308 
	$iwl_fw_£nd_time°amp_m¨kî_cmd
(
iwl_fw_ru¡ime
 *
fwπ
)

3310 
iwl_mvm_m¨kî
 
m¨kî
 = {

3311 .
dw_Àn
 = (
iwl_mvm_m¨kî
) / 4,

3312 .
m¨kî_id
 = 
MARKER_ID_SYNC_CLOCK
,

3314 
iwl_ho°_cmd
 
hcmd
 = {

3315 .
Êags
 = 
CMD_ASYNC
,

3316 .
id
 = 
	`WIDE_ID
(
LONG_GROUP
, 
MARKER_CMD
),

3317 .
d©aÊags
 = {},

3319 
iwl_mvm_m¨kî_r•
 *
ª•
;

3320 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
fwπ
->
fw
,

3321 
	`WIDE_ID
(
LONG_GROUP
, 
MARKER_CMD
),

3322 
IWL_FW_CMD_VER_UNKNOWN
);

3323 
ªt
;

3325 i‡(
cmd_vî
 == 1) {

3329 
m¨kî
.
time°amp
 = 
	`˝u_to_À64
(
fwπ
->time°amp.
£q
++);

3330 } i‡(
cmd_vî
 == 2) {

3331 
m¨kî
.
time°amp
 = 
	`˝u_to_À64
(
	`ktime_gë_boŸtime_ns
());

3333 
	`IWL_DEBUG_INFO
(
fwπ
,

3335 
cmd_vî
);

3336  -
EINVAL
;

3339 
hcmd
.
d©a
[0] = &
m¨kî
;

3340 
hcmd
.
Àn
[0] = (
m¨kî
);

3342 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

3344 i‡(
cmd_vî
 > 1 && 
hcmd
.
ª•_pkt
) {

3345 
ª•
 = (*)
hcmd
.
ª•_pkt
->
d©a
;

3346 
	`IWL_DEBUG_INFO
(
fwπ
, "FW GP2Åime: %u\n",

3347 
	`À32_to_˝u
(
ª•
->
gp2
));

3350  
ªt
;

3351 
	}
}

3353 
	$iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(
iwl_fw_ru¡ime
 *
fwπ
,

3354 
iwl_fw_dbg_∑øms
 *
∑øms
,

3355 
boﬁ
 
°›
)

3357 
ªt
 
__maybe_unu£d
 = 0;

3359 i‡(
	`ã°_bô
(
STATUS_FW_ERROR
, &
fwπ
->
å™s
->
°©us
))

3362 i‡(
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

3363 
IWL_UCODE_TLV_CAPA_DBG_SUSPEND_RESUME_CMD_SUPP
)) {

3364 i‡(
°›
)

3365 
	`iwl_fw_£nd_time°amp_m¨kî_cmd
(
fwπ
);

3366 
ªt
 = 
	`iwl_fw_dbg_su•íd_ªsume_hcmd
(
fwπ
->
å™s
, 
°›
);

3367 } i‡(
°›
) {

3368 
	`iwl_fw_dbg_°›_ªc‹dög
(
fwπ
->
å™s
, 
∑øms
);

3370 
ªt
 = 
	`iwl_fw_dbg_ª°¨t_ªc‹dög
(
fwπ
->
å™s
, 
∑øms
);

3372 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3373 i‡(!
ªt
) {

3374 i‡(
°›
)

3375 
fwπ
->
å™s
->
dbg
.
ªc_⁄
 = 
Ál£
;

3377 
	`iwl_fw_£t_dbg_ªc_⁄
(
fwπ
);

3380 
	}
}

3381 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_°›_ª°¨t_ªc‹dög
);

3383 
	$iwl_fw_dißbÀ_dbg_as£πs
(
iwl_fw_ru¡ime
 *
fwπ
)

3385 
iwl_fw_dbg_c⁄fig_cmd
 
cmd
 = {

3386 .
ty≥
 = 
	`˝u_to_À32
(
DEBUG_TOKEN_CONFIG_TYPE
),

3387 .
c⁄f
 = 
	`˝u_to_À32
(
IWL_FW_DBG_CONFIG_TOKEN
),

3389 
iwl_ho°_cmd
 
hcmd
 = {

3390 .
id
 = 
	`WIDE_ID
(
LONG_GROUP
, 
LDBG_CONFIG_CMD
),

3391 .
d©a
[0] = &
cmd
,

3392 .
Àn
[0] = (
cmd
),

3394 
u32
 
¥e£t
 = 
	`u32_gë_bôs
(
fwπ
->
å™s
->
dbg
.
domaös_bôm≠
,

3395 
	`GENMASK
(31, 
IWL_FW_DBG_DOMAIN_POS
 + 1));

3398 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_9000
)

3401 i‡(
fwπ
->
å™s
->
dbg
.
yoyo_bö_lﬂded
 || (
¥e£t
 &&Öreset != 1))

3404 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

3405 
	}
}

3406 
IWL_EXPORT_SYMBOL
(
iwl_fw_dißbÀ_dbg_as£πs
);

3408 
	$iwl_fw_dbg_˛ór_m⁄ô‹_buf
(
iwl_fw_ru¡ime
 *
fwπ
)

3410 
iwl_fw_dbg_∑øms
 
∑øms
 = {0};

3412 
	`iwl_fw_dbg_°›_sync
(
fwπ
);

3414 i‡(
	`fw_has_≠i
(&
fwπ
->
fw
->
ucode_ˇ∑
,

3415 
IWL_UCODE_TLV_API_INT_DBG_BUF_CLEAR
)) {

3416 
iwl_ho°_cmd
 
hcmd
 = {

3417 .
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, 
FW_CLEAR_BUFFER
),

3419 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

3422 
	`iwl_dbg_év_öô_cfg
(
fwπ
);

3423 
	`iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(
fwπ
, &
∑øms
, 
Ál£
);

3424 
	}
}

3425 
IWL_EXPORT_SYMBOL
(
iwl_fw_dbg_˛ór_m⁄ô‹_buf
);

	@fw/dbg.h

7 #i‚de‡
__iwl_fw_dbg_h__


8 
	#__iwl_fw_dbg_h__


	)

9 
	~<löux/w‹kqueue.h
>

10 
	~<√t/cfg80211.h
>

11 
	~"ru¡ime.h
"

12 
	~"iwl-¥ph.h
"

13 
	~"iwl-io.h
"

14 
	~"fûe.h
"

15 
	~"îr‹-dump.h
"

16 
	~"≠i/comm™ds.h
"

17 
	~"≠i/dbg-év.h
"

18 
	~"≠i/Æive.h
"

25 
	siwl_fw_dump_desc
 {

26 
size_t
 
	mÀn
;

28 
iwl_fw_îr‹_dump_åiggî_desc
 
	måig_desc
;

36 
	siwl_fw_dbg_∑øms
 {

37 
u32
 
	mö_ßm∂e
;

38 
u32
 
	mout_˘æ
;

41 c⁄° 
iwl_fw_dump_desc
 
iwl_dump_desc_as£π
;

43 
iwl_fw_dbg_cﬁÀ˘_desc
(
iwl_fw_ru¡ime
 *
fwπ
,

44 c⁄° 
iwl_fw_dump_desc
 *
desc
,

45 
boﬁ
 
m⁄ô‹_⁄ly
, 
dñay
);

46 
iwl_fw_dbg_îr‹_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
,

47 
iwl_fw_dbg_åiggî
 
åig_ty≥
);

48 
iwl_fw_dbg_öi_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
,

49 
iwl_fwπ_dump_d©a
 *
dump_d©a
,

50 
boﬁ
 
sync
);

51 
iwl_fw_dbg_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
,

52 
iwl_fw_dbg_åiggî
 
åig
, c⁄° *
°r
,

53 
size_t
 
Àn
, 
iwl_fw_dbg_åiggî_év
 *
åiggî
);

54 
	$iwl_fw_dbg_cﬁÀ˘_åig
(
iwl_fw_ru¡ime
 *
fwπ
,

55 
iwl_fw_dbg_åiggî_év
 *
åiggî
,

56 c⁄° *
fmt
, ...Ë
	`__¥ötf
(3, 4);

57 
	`iwl_fw_°¨t_dbg_c⁄f
(
iwl_fw_ru¡ime
 *
fwπ
, 
u8
 
id
);

59 
	#iwl_fw_dbg_åiggî_íabÀd
(
fw
, 
id
) ({ \

60 *
__dbg_åiggî
 = (
fw
)->
dbg
.
åiggî_év
[(
id
)]; \

61 
	`u∆ikñy
(
__dbg_åiggî
); \

62 
	}
})

	)

64 
ölöe
 
iwl_fw_dbg_åiggî_év
*

65 
	$_iwl_fw_dbg_gë_åiggî
(c⁄° 
iwl_fw
 *
fw
, 
iwl_fw_dbg_åiggî
 
id
)

67  
fw
->
dbg
.
åiggî_év
[
id
];

68 
	}
}

70 
	#iwl_fw_dbg_gë_åiggî
(
fw
, 
id
) ({ \

71 
	`BUILD_BUG_ON
(!
	`__buûtö_c⁄°™t_p
(
id
)); \

72 
	`BUILD_BUG_ON
((
id
Ë>
FW_DBG_TRIGGER_MAX
); \

73 
	`_iwl_fw_dbg_gë_åiggî
((
fw
), (
id
)); \

74 })

	)

76 
ölöe
 
boﬁ


77 
	$iwl_fw_dbg_åiggî_vif_m©ch
(
iwl_fw_dbg_åiggî_év
 *
åig
,

78 
wúñess_dev
 *
wdev
)

80 
u32
 
åig_vif
 = 
	`À32_to_˝u
(
åig
->
vif_ty≥
);

82  
åig_vif
 =
IWL_FW_DBG_CONF_VIF_ANY
 ||

83 
wdev
->
i·y≥
 =
åig_vif
;

84 
	}
}

86 
ölöe
 
boﬁ


87 
	$iwl_fw_dbg_åiggî_°›_c⁄f_m©ch
(
iwl_fw_ru¡ime
 *
fwπ
,

88 
iwl_fw_dbg_åiggî_év
 *
åig
)

90  ((
åig
->
mode
 & 
IWL_FW_DBG_TRIGGER_STOP
) &&

91 (
fwπ
->
dump
.
c⁄f
 =
FW_DBG_INVALID
 ||

92 (
	`BIT
(
fwπ
->
dump
.
c⁄f
Ë& 
	`À32_to_˝u
(
åig
->
°›_c⁄f_ids
))));

93 
	}
}

95 
ölöe
 
boﬁ


96 
	$iwl_fw_dbg_no_åig_wödow
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 
id
, u32 
dis_u£c
)

98 
wöd_jiff
 = 
	`u£cs_to_jiffõs
(
dis_u£c
);

101 i‡(
fwπ
->
dump
.
n⁄_cﬁÀ˘_ts_°¨t
[
id
] &&

102 (
	`time_a·î
(
fwπ
->
dump
.
n⁄_cﬁÀ˘_ts_°¨t
[
id
] + 
wöd_jiff
,

103 
jiffõs
)))

104  
åue
;

106 
fwπ
->
dump
.
n⁄_cﬁÀ˘_ts_°¨t
[
id
] = 
jiffõs
;

107  
Ál£
;

108 
	}
}

110 
ölöe
 
boﬁ


111 
	$iwl_fw_dbg_åiggî_check_°›
(
iwl_fw_ru¡ime
 *
fwπ
,

112 
wúñess_dev
 *
wdev
,

113 
iwl_fw_dbg_åiggî_év
 *
åig
)

115 
u32
 
u£c
 = 
	`À16_to_˝u
(
åig
->
åig_dis_ms
Ë* 
USEC_PER_MSEC
;

117 i‡(
wdev
 && !
	`iwl_fw_dbg_åiggî_vif_m©ch
(
åig
, wdev))

118  
Ál£
;

120 i‡(
	`iwl_fw_dbg_no_åig_wödow
(
fwπ
, 
	`À32_to_˝u
(
åig
->
id
), 
u£c
)) {

121 
	`IWL_WARN
(
fwπ
, "Trigger %d occurred whileÇo-collect window.\n",

122 
åig
->
id
);

123  
Ál£
;

126  
	`iwl_fw_dbg_åiggî_°›_c⁄f_m©ch
(
fwπ
, 
åig
);

127 
	}
}

129 
ölöe
 
iwl_fw_dbg_åiggî_év
*

130 
	$_iwl_fw_dbg_åiggî_⁄
(
iwl_fw_ru¡ime
 *
fwπ
,

131 
wúñess_dev
 *
wdev
,

132 c⁄° 
iwl_fw_dbg_åiggî
 
id
)

134 
iwl_fw_dbg_åiggî_év
 *
åig
;

136 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
))

137  
NULL
;

139 i‡(!
	`iwl_fw_dbg_åiggî_íabÀd
(
fwπ
->
fw
, 
id
))

140  
NULL
;

142 
åig
 = 
	`_iwl_fw_dbg_gë_åiggî
(
fwπ
->
fw
, 
id
);

144 i‡(!
	`iwl_fw_dbg_åiggî_check_°›
(
fwπ
, 
wdev
, 
åig
))

145  
NULL
;

147  
åig
;

148 
	}
}

150 
	#iwl_fw_dbg_åiggî_⁄
(
fwπ
, 
wdev
, 
id
) ({ \

151 
	`BUILD_BUG_ON
(!
	`__buûtö_c⁄°™t_p
(
id
)); \

152 
	`BUILD_BUG_ON
((
id
Ë>
FW_DBG_TRIGGER_MAX
); \

153 
	`_iwl_fw_dbg_åiggî_⁄
((
fwπ
), (
wdev
), (
id
)); \

154 })

	)

156 
ölöe
 

157 
	$_iwl_fw_dbg_åiggî_sim∂e_°›
(
iwl_fw_ru¡ime
 *
fwπ
,

158 
wúñess_dev
 *
wdev
,

159 
iwl_fw_dbg_åiggî_év
 *
åiggî
)

161 i‡(!
åiggî
)

164 i‡(!
	`iwl_fw_dbg_åiggî_check_°›
(
fwπ
, 
wdev
, 
åiggî
))

167 
	`iwl_fw_dbg_cﬁÀ˘_åig
(
fwπ
, 
åiggî
, 
NULL
);

168 
	}
}

170 
	#iwl_fw_dbg_åiggî_sim∂e_°›
(
fwπ
, 
wdev
, 
åig
) \

171 
	`_iwl_fw_dbg_åiggî_sim∂e_°›
((
fwπ
), (
wdev
), \

172 
	`iwl_fw_dbg_gë_åiggî
((
fwπ
)->
fw
,\

173 (
åig
)))

	)

174 
iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(
iwl_fw_ru¡ime
 *
fwπ
,

175 
iwl_fw_dbg_∑øms
 *
∑øms
,

176 
boﬁ
 
°›
);

178 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


179 
ölöe
 
	$iwl_fw_£t_dbg_ªc_⁄
(
iwl_fw_ru¡ime
 *
fwπ
)

181 i‡(
fwπ
->
cur_fw_img
 =
IWL_UCODE_REGULAR
 &&

182 (
fwπ
->
fw
->
dbg
.
de°_év
 ||

183 
fwπ
->
å™s
->
dbg
.
öi_de°
 !
IWL_FW_INI_LOCATION_INVALID
))

184 
fwπ
->
å™s
->
dbg
.
ªc_⁄
 = 
åue
;

185 
	}
}

188 
ölöe
 
	$iwl_fw_dump_c⁄f_˛ór
(
iwl_fw_ru¡ime
 *
fwπ
)

190 
fwπ
->
dump
.
c⁄f
 = 
FW_DBG_INVALID
;

191 
	}
}

193 
iwl_fw_îr‹_dump_wk
(
w‹k_°ru˘
 *
w‹k
);

195 
ölöe
 
boﬁ
 
	$iwl_fw_dbg_ty≥_⁄
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 
ty≥
)

197  (
fwπ
->
fw
->
dbg
.
dump_mask
 & 
	`BIT
(
ty≥
));

198 
	}
}

200 
ölöe
 
boﬁ
 
	$iwl_fw_dbg_is_d3_debug_íabÀd
(
iwl_fw_ru¡ime
 *
fwπ
)

202  
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

203 
IWL_UCODE_TLV_CAPA_D3_DEBUG
) &&

204 
fwπ
->
å™s
->
cfg
->
d3_debug_d©a_Àngth
 && fwπ->
›s
 &&

205 
fwπ
->
›s
->
d3_debug_íabÀ
 &&

206 
fwπ
->
›s
->
	`d3_debug_íabÀ
(fwπ->
›s_˘x
) &&

207 
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_D3_DEBUG_DATA
);

208 
	}
}

210 
ölöe
 
boﬁ
 
	$iwl_fw_dbg_is_∑gög_íabÀd
(
iwl_fw_ru¡ime
 *
fwπ
)

212  
	`iwl_fw_dbg_ty≥_⁄
(
fwπ
, 
IWL_FW_ERROR_DUMP_PAGING
) &&

213 !
fwπ
->
å™s
->
å™s_cfg
->
gí2
 &&

214 
fwπ
->
cur_fw_img
 < 
IWL_UCODE_TYPE_MAX
 &&

215 
fwπ
->
fw
->
img
[fwπ->
cur_fw_img
].
∑gög_mem_size
 &&

216 
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_block
;

217 
	}
}

219 
iwl_fw_dbg_ªad_d3_debug_d©a
(
iwl_fw_ru¡ime
 *
fwπ
);

221 
ölöe
 
	$iwl_fw_Êush_dumps
(
iwl_fw_ru¡ime
 *
fwπ
)

223 
i
;

225 
	`iwl_dbg_év_dñ_timîs
(
fwπ
->
å™s
);

226 
i
 = 0; i < 
IWL_FW_RUNTIME_DUMP_WK_NUM
; i++)

227 
	`Êush_dñayed_w‹k
(&
fwπ
->
dump
.
wks
[
i
].
wk
);

228 
	}
}

230 
iwl_fw_£nd_time°amp_m¨kî_cmd
(
iwl_fw_ru¡ime
 *
fwπ
);

232 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


233 
ölöe
 
	$iwl_fw_ˇn˚l_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
)

235 
fwπ
->
time°amp
.
dñay
 = 0;

236 
	`ˇn˚l_dñayed_w‹k_sync
(&
fwπ
->
time°amp
.
wk
);

237 
	}
}

239 
iwl_fw_åiggî_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 
dñay
);

241 
ölöe
 
	$iwl_fw_su•íd_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
)

243 
	`ˇn˚l_dñayed_w‹k_sync
(&
fwπ
->
time°amp
.
wk
);

244 
	}
}

246 
ölöe
 
	$iwl_fw_ªsume_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
)

248 i‡(!
fwπ
->
time°amp
.
dñay
)

251 
	`scheduÀ_dñayed_w‹k
(&
fwπ
->
time°amp
.
wk
,

252 
	`round_jiffõs_ªœtive
(
fwπ
->
time°amp
.
dñay
));

253 
	}
}

257 
ölöe
 
	$iwl_fw_ˇn˚l_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
Ë{
	}
}

259 
ölöe
 
	$iwl_fw_åiggî_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
,

260 
u32
 
dñay
Ë{
	}
}

262 
ölöe
 
	$iwl_fw_su•íd_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
Ë{
	}
}

264 
ölöe
 
	$iwl_fw_ªsume_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
Ë{
	}
}

268 
iwl_fw_dbg_°›_sync
(
iwl_fw_ru¡ime
 *
fwπ
);

270 
ölöe
 
	$iwl_fw_lmac1_£t_Æive_îr_èbÀ
(
iwl_å™s
 *
å™s
,

271 
u32
 
lmac_îr‹_evít_èbÀ
)

273 i‡(!(
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 &

274 
IWL_ERROR_EVENT_TABLE_LMAC1
) ||

275 
	`WARN_ON
(
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[0] !=

276 
lmac_îr‹_evít_èbÀ
))

277 
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[0] =Ümac_error_event_table;

278 
	}
}

280 
ölöe
 
	$iwl_fw_umac_£t_Æive_îr_èbÀ
(
iwl_å™s
 *
å™s
,

281 
u32
 
umac_îr‹_evít_èbÀ
)

283 i‡(!(
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 &

284 
IWL_ERROR_EVENT_TABLE_UMAC
) ||

285 
	`WARN_ON
(
å™s
->
dbg
.
umac_îr‹_evít_èbÀ
 !=

286 
umac_îr‹_evít_èbÀ
))

287 
å™s
->
dbg
.
umac_îr‹_evít_èbÀ
 = umac_error_event_table;

288 
	}
}

290 
ölöe
 
	$iwl_fw_îr‹_cﬁÀ˘
(
iwl_fw_ru¡ime
 *
fwπ
, 
boﬁ
 
sync
)

292 
iwl_fw_öi_time_poöt
 
ç_id
;

294 i‡(!
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
)) {

295 
	`iwl_fw_dbg_cﬁÀ˘_desc
(
fwπ
, &
iwl_dump_desc_as£π
, 
Ál£
, 0);

299 i‡(
fwπ
->
å™s
->
dbg
.
hw_îr‹
) {

300 
ç_id
 = 
IWL_FW_INI_TIME_POINT_FW_HW_ERROR
;

301 
fwπ
->
å™s
->
dbg
.
hw_îr‹
 = 
Ál£
;

303 
ç_id
 = 
IWL_FW_INI_TIME_POINT_FW_ASSERT
;

306 
	`_iwl_dbg_év_time_poöt
(
fwπ
, 
ç_id
, 
NULL
, 
sync
);

307 
	}
}

309 
ölöe
 
	$iwl_fwπ_upd©e_fw_vîsi⁄s
(
iwl_fw_ru¡ime
 *
fwπ
,

310 
iwl_lmac_Æive
 *
lmac
,

311 
iwl_umac_Æive
 *
umac
)

313 i‡(
lmac
) {

314 
fwπ
->
dump
.
fw_vî
.
ty≥
 = 
lmac
->
vî_ty≥
;

315 
fwπ
->
dump
.
fw_vî
.
subty≥
 = 
lmac
->
vî_subty≥
;

316 
fwπ
->
dump
.
fw_vî
.
lmac_maj‹
 = 
	`À32_to_˝u
(
lmac
->
ucode_maj‹
);

317 
fwπ
->
dump
.
fw_vî
.
lmac_mö‹
 = 
	`À32_to_˝u
(
lmac
->
ucode_mö‹
);

320 i‡(
umac
) {

321 
fwπ
->
dump
.
fw_vî
.
umac_maj‹
 = 
	`À32_to_˝u
(
umac
->umac_major);

322 
fwπ
->
dump
.
fw_vî
.
umac_mö‹
 = 
	`À32_to_˝u
(
umac
->umac_minor);

324 
	}
}

326 
iwl_fwπ_dump_îr‹_logs
(
iwl_fw_ru¡ime
 *
fwπ
);

327 
iwl_£nd_dbg_dump_com∂ëe_cmd
(
iwl_fw_ru¡ime
 *
fwπ
,

328 
u32
 
timïoöt
,

329 
u32
 
timïoöt_d©a
);

330 
iwl_fw_dißbÀ_dbg_as£πs
(
iwl_fw_ru¡ime
 *
fwπ
);

331 
iwl_fw_dbg_˛ór_m⁄ô‹_buf
(
iwl_fw_ru¡ime
 *
fwπ
);

333 
	#IWL_FW_CHECK_FAILED
(
_obj
, 
_fmt
, ...) \

334 
	`IWL_ERR_LIMIT
(
_obj
, 
_fmt
, 
__VA_ARGS__
)

	)

336 
	#IWL_FW_CHECK
(
_obj
, 
_c⁄d
, 
_fmt
, ...) \

338 
boﬁ
 
__c⁄d
 = (
_c⁄d
); \

340 i‡(
	`u∆ikñy
(
__c⁄d
)) \

341 
	`IWL_FW_CHECK_FAILED
(
_obj
, 
_fmt
, 
__VA_ARGS__
); \

343 
	`u∆ikñy
(
__c⁄d
); \

344 })

	)

	@fw/debugfs.c

7 
	~"≠i/comm™ds.h
"

8 
	~"debugfs.h
"

9 
	~"dbg.h
"

10 
	~<löux/£q_fûe.h
>

12 
	#FWRT_DEBUGFS_OPEN_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

13 
dbgfs_
##
«me
##
_d©a
 { \

14 
¨gty≥
 *
¨g
; \

15 
boﬁ
 
ªad_d⁄e
; \

16 
ssize_t
 
æí
; \

17 
rbuf
[
buÊí
]; \

19 
_iwl_dbgfs_
##
«me
##
	`_›í
(
öode
 *inode, \

20 
fûe
 *file) \

22 
dbgfs_
##
«me
##
_d©a
 *
d©a
; \

24 
d©a
 = 
	`kzÆloc
((*d©a), 
GFP_KERNEL
); \

25 i‡(!
d©a
) \

26  -
ENOMEM
; \

28 
d©a
->
ªad_d⁄e
 = 
Ál£
; \

29 
d©a
->
¨g
 = 
öode
->
i_¥iv©e
; \

30 
fûe
->
¥iv©e_d©a
 = 
d©a
; \

33 }

	)

35 
	#FWRT_DEBUGFS_READ_WRAPPER
(
«me
) \

36 
ssize_t
 
_iwl_dbgfs_
##
«me
##
	`_ªad
(
fûe
 *file, \

37 
__u£r
 *
u£r_buf
, \

38 
size_t
 
cou¡
, 
loff_t
 *
µos
) \

40 
dbgfs_
##
«me
##
_d©a
 *
d©a
 = 
fûe
->
¥iv©e_d©a
; \

42 i‡(!
d©a
->
ªad_d⁄e
) { \

43 
d©a
->
ªad_d⁄e
 = 
åue
; \

44 
d©a
->
æí
 = 
iwl_dbgfs_
##
«me
##
	`_ªad
(d©a->
¨g
, \

45 (
d©a
->
rbuf
),\

46 
d©a
->
rbuf
); \

49 i‡(
d©a
->
æí
 < 0) \

50  
d©a
->
æí
; \

51  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, \

52 
d©a
->
rbuf
, d©a->
æí
); \

53 }

	)

55 
	$_iwl_dbgfs_ªÀa£
(
öode
 *öode, 
fûe
 *file)

57 
	`k‰ì
(
fûe
->
¥iv©e_d©a
);

60 
	}
}

62 
	#_FWRT_DEBUGFS_READ_FILE_OPS
(
«me
, 
buÊí
, 
¨gty≥
) \

63 
	`FWRT_DEBUGFS_OPEN_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

64 
	`FWRT_DEBUGFS_READ_WRAPPER
(
«me
) \

65 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

66 .
ªad
 = 
_iwl_dbgfs_
##
«me
##
_ªad
, \

67 .
›í
 = 
_iwl_dbgfs_
##
«me
##
_›í
, \

68 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

69 .
ªÀa£
 = 
_iwl_dbgfs_ªÀa£
, \

70 }

	)

72 
	#FWRT_DEBUGFS_WRITE_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

73 
ssize_t
 
_iwl_dbgfs_
##
«me
##
	`_wrôe
(
fûe
 *file, \

74 c⁄° 
__u£r
 *
u£r_buf
, \

75 
size_t
 
cou¡
, 
loff_t
 *
µos
) \

77 
¨gty≥
 *
¨g
 = \

78 ((
dbgfs_
##
«me
##
_d©a
 *)
fûe
->
¥iv©e_d©a
)->
¨g
;\

79 
buf
[
buÊí
] = {}; \

80 
size_t
 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1); \

82 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
)) \

83  -
EFAULT
; \

85  
iwl_dbgfs_
##
«me
##
	`_wrôe
(
¨g
, 
buf
, 
buf_size
); \

86 }

	)

88 
	#_FWRT_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
buÊí
, 
¨gty≥
) \

89 
	`FWRT_DEBUGFS_OPEN_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

90 
	`FWRT_DEBUGFS_WRITE_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

91 
	`FWRT_DEBUGFS_READ_WRAPPER
(
«me
) \

92 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

93 .
wrôe
 = 
_iwl_dbgfs_
##
«me
##
_wrôe
, \

94 .
ªad
 = 
_iwl_dbgfs_
##
«me
##
_ªad
, \

95 .
›í
 = 
_iwl_dbgfs_
##
«me
##
_›í
, \

96 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

97 .
ªÀa£
 = 
_iwl_dbgfs_ªÀa£
, \

98 }

	)

100 
	#_FWRT_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
buÊí
, 
¨gty≥
) \

101 
	`FWRT_DEBUGFS_OPEN_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

102 
	`FWRT_DEBUGFS_WRITE_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

103 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

104 .
wrôe
 = 
_iwl_dbgfs_
##
«me
##
_wrôe
, \

105 .
›í
 = 
_iwl_dbgfs_
##
«me
##
_›í
, \

106 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

107 .
ªÀa£
 = 
_iwl_dbgfs_ªÀa£
, \

108 }

	)

110 
	#FWRT_DEBUGFS_READ_FILE_OPS
(
«me
, 
bufsz
) \

111 
	`_FWRT_DEBUGFS_READ_FILE_OPS
(
«me
, 
bufsz
, 
iwl_fw_ru¡ime
)

	)

113 
	#FWRT_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

114 
	`_FWRT_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
iwl_fw_ru¡ime
)

	)

116 
	#FWRT_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

117 
	`_FWRT_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
iwl_fw_ru¡ime
)

	)

119 
	#FWRT_DEBUGFS_ADD_FILE_ALIAS
(
Æüs
, 
«me
, 
∑ª¡
, 
mode
) do { \

120 
	`debugfs_¸óã_fûe
(
Æüs
, 
mode
, 
∑ª¡
, 
fwπ
, \

121 &
iwl_dbgfs_
##
«me
##
_›s
); \

122 } 0)

	)

123 
	#FWRT_DEBUGFS_ADD_FILE
(
«me
, 
∑ª¡
, 
mode
) \

124 
	`FWRT_DEBUGFS_ADD_FILE_ALIAS
(#«me, 
«me
, 
∑ª¡
, 
mode
)

	)

126 
	$iwl_dbgfs_íabÀd_£vîôõs_wrôe
(
iwl_fw_ru¡ime
 *
fwπ
,

127 *
buf
, 
size_t
 
cou¡
)

129 
iwl_dbg_ho°_evít_cfg_cmd
 
evít_cfg
;

130 
iwl_ho°_cmd
 
hcmd
 = {

131 .
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, 
HOST_EVENT_CFG
),

132 .
Êags
 = 
CMD_ASYNC
,

133 .
d©a
[0] = &
evít_cfg
,

134 .
Àn
[0] = (
evít_cfg
),

136 
u32
 
íabÀd_£vîôõs
;

137 
ªt
 = 
	`k°πou32
(
buf
, 10, &
íabÀd_£vîôõs
);

139 i‡(
ªt
 < 0)

140  
ªt
;

142 
evít_cfg
.
íabÀd_£vîôõs
 = 
	`˝u_to_À32
(enabled_severities);

144 i‡(
fwπ
->
›s
 && fwπ->›s->
£nd_hcmd
)

145 
ªt
 = 
fwπ
->
›s
->
	`£nd_hcmd
(fwπ->
›s_˘x
, &
hcmd
);

147 
ªt
 = -
EPERM
;

149 
	`IWL_INFO
(
fwπ
,

151 
íabÀd_£vîôõs
, 
ªt
);

153  
ªt
 ?: 
cou¡
;

154 
	}
}

156 
FWRT_DEBUGFS_WRITE_FILE_OPS
(
íabÀd_£vîôõs
, 16);

158 
	$iwl_fw_time°amp_m¨kî_wk
(
w‹k_°ru˘
 *
w‹k
)

160 
ªt
;

161 
iwl_fw_ru¡ime
 *
fwπ
 =

162 
	`c⁄èöî_of
(
w‹k
, 
iwl_fw_ru¡ime
, 
time°amp
.
wk
.work);

163 
dñay
 = 
fwπ
->
time°amp
.delay;

165 
ªt
 = 
	`iwl_fw_£nd_time°amp_m¨kî_cmd
(
fwπ
);

166 i‡(!
ªt
 && 
dñay
)

167 
	`scheduÀ_dñayed_w‹k
(&
fwπ
->
time°amp
.
wk
,

168 
	`round_jiffõs_ªœtive
(
dñay
));

170 
	`IWL_INFO
(
fwπ
,

172 
ªt
, 
	`jiffõs_to_m£cs
(
dñay
) / 1000);

173 
	}
}

175 
	$iwl_fw_åiggî_time°amp
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 
dñay
)

177 
	`IWL_INFO
(
fwπ
,

179 
dñay
);

181 
	`iwl_fw_ˇn˚l_time°amp
(
fwπ
);

183 
fwπ
->
time°amp
.
dñay
 = 
	`m£cs_to_jiffõs
(delay * 1000);

185 
	`scheduÀ_dñayed_w‹k
(&
fwπ
->
time°amp
.
wk
,

186 
	`round_jiffõs_ªœtive
(
fwπ
->
time°amp
.
dñay
));

187 
	}
}

189 
ssize_t
 
	$iwl_dbgfs_time°amp_m¨kî_wrôe
(
iwl_fw_ru¡ime
 *
fwπ
,

190 *
buf
, 
size_t
 
cou¡
)

192 
ªt
;

193 
u32
 
dñay
;

195 
ªt
 = 
	`k°πou32
(
buf
, 10, &
dñay
);

196 i‡(
ªt
 < 0)

197  
ªt
;

199 
	`iwl_fw_åiggî_time°amp
(
fwπ
, 
dñay
);

201  
cou¡
;

202 
	}
}

204 
ssize_t
 
	$iwl_dbgfs_time°amp_m¨kî_ªad
(
iwl_fw_ru¡ime
 *
fwπ
,

205 
size_t
 
size
, *
buf
)

207 
u32
 
dñay_£cs
 = 
	`jiffõs_to_m£cs
(
fwπ
->
time°amp
.
dñay
) / 1000;

209  
	`s˙¥ötf
(
buf
, 
size
, "%d\n", 
dñay_£cs
);

210 
	}
}

212 
FWRT_DEBUGFS_READ_WRITE_FILE_OPS
(
time°amp_m¨kî
, 16);

214 
	shcmd_wrôe_d©a
 {

215 
__be32
 
	mcmd_id
;

216 
__be32
 
	mÊags
;

217 
__be16
 
	mÀngth
;

218 
u8
 
	md©a
[];

219 } 
	g__∑cked
;

221 
ssize_t
 
	$iwl_dbgfs_£nd_hcmd_wrôe
(
iwl_fw_ru¡ime
 *
fwπ
, *
buf
,

222 
size_t
 
cou¡
)

224 
size_t
 
hódî_size
 = ((
u32
Ë* 2 + (
u16
)) * 2;

225 
size_t
 
d©a_size
 = (
cou¡
 - 1) / 2;

226 
ªt
;

227 
hcmd_wrôe_d©a
 *
d©a
;

228 
iwl_ho°_cmd
 
hcmd
 = {

229 .
Àn
 = { 0, },

230 .
d©a
 = { 
NULL
, },

233 i‡(
fwπ
->
›s
 && fwπ->›s->
fw_ru¬ög
 &&

234 !
fwπ
->
›s
->
	`fw_ru¬ög
(fwπ->
›s_˘x
))

235  -
EIO
;

237 i‡(
cou¡
 < 
hódî_size
 + 1 || count > 1024 * 4)

238  -
EINVAL
;

240 
d©a
 = 
	`kmÆloc
(
d©a_size
, 
GFP_KERNEL
);

241 i‡(!
d©a
)

242  -
ENOMEM
;

244 
ªt
 = 
	`hex2bö
((
u8
 *)
d©a
, 
buf
, 
d©a_size
);

245 i‡(
ªt
)

246 
out
;

248 
hcmd
.
id
 = 
	`be32_to_˝u
(
d©a
->
cmd_id
);

249 
hcmd
.
Êags
 = 
	`be32_to_˝u
(
d©a
->flags);

250 
hcmd
.
Àn
[0] = 
	`be16_to_˝u
(
d©a
->
Àngth
);

251 
hcmd
.
d©a
[0] = data->data;

253 i‡(
cou¡
 !
hódî_size
 + 
hcmd
.
Àn
[0] * 2 + 1) {

254 
	`IWL_ERR
(
fwπ
,

256 
ªt
 = -
EINVAL
;

257 
out
;

260 i‡(
fwπ
->
›s
 && fwπ->›s->
£nd_hcmd
)

261 
ªt
 = 
fwπ
->
›s
->
	`£nd_hcmd
(fwπ->
›s_˘x
, &
hcmd
);

263 
ªt
 = -
EPERM
;

265 i‡(
ªt
 < 0)

266 
out
;

268 i‡(
hcmd
.
Êags
 & 
CMD_WANT_SKB
)

269 
	`iwl_‰ì_ª•
(&
hcmd
);

270 
out
:

271 
	`k‰ì
(
d©a
);

272  
ªt
 ?: 
cou¡
;

273 
	}
}

275 
FWRT_DEBUGFS_WRITE_FILE_OPS
(
£nd_hcmd
, 512);

277 
ssize_t
 
	$iwl_dbgfs_fw_dbg_domaö_ªad
(
iwl_fw_ru¡ime
 *
fwπ
,

278 
size_t
 
size
, *
buf
)

280  
	`s˙¥ötf
(
buf
, 
size
, "0x%08x\n",

281 
fwπ
->
å™s
->
dbg
.
domaös_bôm≠
);

282 
	}
}

284 
FWRT_DEBUGFS_READ_FILE_OPS
(
fw_dbg_domaö
, 20);

286 
	siwl_dbgfs_fw_öfo_¥iv
 {

287 
iwl_fw_ru¡ime
 *
	mfwπ
;

290 
	siwl_dbgfs_fw_öfo_°©e
 {

291 
loff_t
 
	mpos
;

294 *
	$iwl_dbgfs_fw_öfo_£q_√xt
(
£q_fûe
 *
£q
,

295 *
v
, 
loff_t
 *
pos
)

297 
iwl_dbgfs_fw_öfo_°©e
 *
°©e
 = 
v
;

298 
iwl_dbgfs_fw_öfo_¥iv
 *
¥iv
 = 
£q
->
¥iv©e
;

299 c⁄° 
iwl_fw
 *
fw
 = 
¥iv
->
fwπ
->fw;

301 *
pos
 = ++
°©e
->pos;

302 i‡(*
pos
 >
fw
->
ucode_ˇ∑
.
n_cmd_vîsi⁄s
) {

303 
	`k‰ì
(
°©e
);

304  
NULL
;

307  
°©e
;

308 
	}
}

310 
	$iwl_dbgfs_fw_öfo_£q_°›
(
£q_fûe
 *
£q
,

311 *
v
)

313 
	`k‰ì
(
v
);

314 
	}
}

316 *
	$iwl_dbgfs_fw_öfo_£q_°¨t
(
£q_fûe
 *
£q
, 
loff_t
 *
pos
)

318 
iwl_dbgfs_fw_öfo_¥iv
 *
¥iv
 = 
£q
->
¥iv©e
;

319 c⁄° 
iwl_fw
 *
fw
 = 
¥iv
->
fwπ
->fw;

320 
iwl_dbgfs_fw_öfo_°©e
 *
°©e
;

322 i‡(*
pos
 >
fw
->
ucode_ˇ∑
.
n_cmd_vîsi⁄s
)

323  
NULL
;

325 
°©e
 = 
	`kzÆloc
((*°©e), 
GFP_KERNEL
);

326 i‡(!
°©e
)

327  
NULL
;

328 
°©e
->
pos
 = *pos;

329  
°©e
;

330 
	}
};

332 
	$iwl_dbgfs_fw_öfo_£q_show
(
£q_fûe
 *
£q
, *
v
)

334 
iwl_dbgfs_fw_öfo_°©e
 *
°©e
 = 
v
;

335 
iwl_dbgfs_fw_öfo_¥iv
 *
¥iv
 = 
£q
->
¥iv©e
;

336 c⁄° 
iwl_fw
 *
fw
 = 
¥iv
->
fwπ
->fw;

337 c⁄° 
iwl_fw_cmd_vîsi⁄
 *
vî
;

338 
u32
 
cmd_id
;

339 
has_ˇ∑
;

341 i‡(!
°©e
->
pos
) {

342 
	`£q_puts
(
£q
, "fw_capa:\n");

343 
has_ˇ∑
 = 
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
,

344 
IWL_UCODE_TLV_CAPA_PPAG_CHINA_BIOS_SUPPORT
) ? 1 : 0;

345 
	`£q_¥ötf
(
£q
,

347 
IWL_UCODE_TLV_CAPA_PPAG_CHINA_BIOS_SUPPORT
,

348 
has_ˇ∑
);

349 
has_ˇ∑
 = 
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
,

350 
IWL_UCODE_TLV_CAPA_CHINA_22_REG_SUPPORT
) ? 1 : 0;

351 
	`£q_¥ötf
(
£q
,

353 
IWL_UCODE_TLV_CAPA_CHINA_22_REG_SUPPORT
,

354 
has_ˇ∑
);

355 
	`£q_puts
(
£q
, "fw_api_ver:\n");

358 
vî
 = &
fw
->
ucode_ˇ∑
.
cmd_vîsi⁄s
[
°©e
->
pos
];

360 
cmd_id
 = 
	`WIDE_ID
(
vî
->
group
, vî->
cmd
);

362 
	`£q_¥ötf
(
£q
, " 0x%04x:\n", 
cmd_id
);

363 
	`£q_¥ötf
(
£q
, "Çame: %s\n",

364 
	`iwl_gë_cmd_°rög
(
¥iv
->
fwπ
->
å™s
, 
cmd_id
));

365 
	`£q_¥ötf
(
£q
, " cmd_vî: %d\n", 
vî
->
cmd_vî
);

366 
	`£q_¥ötf
(
£q
, "ÇŸif_vî: %d\n", 
vî
->
nŸif_vî
);

368 
	}
}

370 c⁄° 
£q_›î©i⁄s
 
	giwl_dbgfs_öfo_£q_›s
 = {

371 .
°¨t
 = 
iwl_dbgfs_fw_öfo_£q_°¨t
,

372 .
	g√xt
 = 
iwl_dbgfs_fw_öfo_£q_√xt
,

373 .
	g°›
 = 
iwl_dbgfs_fw_öfo_£q_°›
,

374 .
	gshow
 = 
iwl_dbgfs_fw_öfo_£q_show
,

377 
	$iwl_dbgfs_fw_öfo_›í
(
öode
 *öode, 
fûe
 *
fûp
)

379 
iwl_dbgfs_fw_öfo_¥iv
 *
¥iv
;

381 
¥iv
 = 
	`__£q_›í_¥iv©e
(
fûp
, &
iwl_dbgfs_öfo_£q_›s
,

382 (*
¥iv
));

384 i‡(!
¥iv
)

385  -
ENOMEM
;

387 
¥iv
->
fwπ
 = 
öode
->
i_¥iv©e
;

389 
	}
}

391 c⁄° 
fûe_›î©i⁄s
 
	giwl_dbgfs_fw_öfo_›s
 = {

392 .
ow√r
 = 
THIS_MODULE
,

393 .
	g›í
 = 
iwl_dbgfs_fw_öfo_›í
,

394 .
	gªad
 = 
£q_ªad
,

395 .
	gŒ£ek
 = 
£q_l£ek
,

396 .
	gªÀa£
 = 
£q_ªÀa£_¥iv©e
,

399 
	$iwl_fwπ_dbgfs_ªgi°î
(
iwl_fw_ru¡ime
 *
fwπ
,

400 
díåy
 *
dbgfs_dú
)

402 
	`INIT_DELAYED_WORK
(&
fwπ
->
time°amp
.
wk
, 
iwl_fw_time°amp_m¨kî_wk
);

403 
	`FWRT_DEBUGFS_ADD_FILE
(
time°amp_m¨kî
, 
dbgfs_dú
, 0200);

404 
	`FWRT_DEBUGFS_ADD_FILE
(
fw_öfo
, 
dbgfs_dú
, 0200);

405 
	`FWRT_DEBUGFS_ADD_FILE
(
£nd_hcmd
, 
dbgfs_dú
, 0200);

406 
	`FWRT_DEBUGFS_ADD_FILE
(
íabÀd_£vîôõs
, 
dbgfs_dú
, 0200);

407 
	`FWRT_DEBUGFS_ADD_FILE
(
fw_dbg_domaö
, 
dbgfs_dú
, 0400);

408 
	}
}

	@fw/debugfs.h

7 
	~"ru¡ime.h
"

9 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


10 
iwl_fwπ_dbgfs_ªgi°î
(
iwl_fw_ru¡ime
 *
fwπ
,

11 
díåy
 *
dbgfs_dú
);

14 
ölöe
 
	$iwl_fwπ_dbgfs_ªgi°î
(
iwl_fw_ru¡ime
 *
fwπ
,

15 
díåy
 *
dbgfs_dú
Ë{ 
	}
}

	@fw/dump.c

7 
	~<löux/devc‹edump.h
>

8 
	~"iwl-drv.h
"

9 
	~"ru¡ime.h
"

10 
	~"dbg.h
"

11 
	~"debugfs.h
"

12 
	~"iwl-io.h
"

13 
	~"iwl-¥ph.h
"

14 
	~"iwl-c§.h
"

15 
	~"≤vm.h
"

17 
	#FW_ASSERT_LMAC_FATAL
 0x70

	)

18 
	#FW_ASSERT_LMAC2_FATAL
 0x72

	)

19 
	#FW_ASSERT_UMAC_FATAL
 0x71

	)

20 
	#UMAC_RT_NMI_LMAC2_FATAL
 0x72

	)

21 
	#RT_NMI_INTERRUPT_OTHER_LMAC_FATAL
 0x73

	)

22 
	#FW_ASSERT_NMI_UNKNOWN
 0x84

	)

30 
	siwl_îr‹_evít_èbÀ
 {

31 
u32
 
	mvÆid
;

32 
u32
 
	mîr‹_id
;

33 
u32
 
	måm_hw_°©us0
;

34 
u32
 
	måm_hw_°©us1
;

35 
u32
 
	mblök2
;

36 
u32
 
	mûök1
;

37 
u32
 
	mûök2
;

38 
u32
 
	md©a1
;

39 
u32
 
	md©a2
;

40 
u32
 
	md©a3
;

41 
u32
 
	mbc⁄_time
;

42 
u32
 
	mtsf_low
;

43 
u32
 
	mtsf_hi
;

44 
u32
 
	mgp1
;

45 
u32
 
	mgp2
;

46 
u32
 
	mfw_ªv_ty≥
;

47 
u32
 
	mmaj‹
;

48 
u32
 
	mmö‹
;

49 
u32
 
	mhw_vî
;

50 
u32
 
	mbrd_vî
;

51 
u32
 
	mlog_pc
;

52 
u32
 
	m‰ame_±r
;

53 
u32
 
	m°ack_±r
;

54 
u32
 
	mhcmd
;

55 
u32
 
	mi§0
;

57 
u32
 
	mi§1
;

59 
u32
 
	mi§2
;

61 
u32
 
	mi§3
;

63 
u32
 
	mi§4
;

65 
u32
 
	mœ°_cmd_id
;

66 
u32
 
	mwaô_evít
;

67 
u32
 
	ml2p_c⁄åﬁ
;

68 
u32
 
	ml2p_duøti⁄
;

69 
u32
 
	ml2p_mhvÆid
;

70 
u32
 
	ml2p_addr_m©ch
;

71 
u32
 
	mlmpm_pmg_£l
;

73 
u32
 
	mu_time°amp
;

75 
u32
 
	mÊow_h™dÀr
;

76 } 
	g__∑cked
 ;

85 
	siwl_umac_îr‹_evít_èbÀ
 {

86 
u32
 
	mvÆid
;

87 
u32
 
	mîr‹_id
;

88 
u32
 
	mblök1
;

89 
u32
 
	mblök2
;

90 
u32
 
	mûök1
;

91 
u32
 
	mûök2
;

92 
u32
 
	md©a1
;

93 
u32
 
	md©a2
;

94 
u32
 
	md©a3
;

95 
u32
 
	mumac_maj‹
;

96 
u32
 
	mumac_mö‹
;

97 
u32
 
	m‰ame_poöãr
;

98 
u32
 
	m°ack_poöãr
;

99 
u32
 
	mcmd_hódî
;

100 
u32
 
	mnic_i§_¥ef
;

101 } 
	g__∑cked
;

103 
	#ERROR_START_OFFSET
 (1 * (
u32
))

	)

104 
	#ERROR_ELEM_SIZE
 (7 * (
u32
))

	)

106 
boﬁ
 
	$iwl_fwπ_if_îr‹id_Ÿhî_˝u
(
u32
 
îr_id
)

108 
îr_id
 &= 0xFF;

110 i‡((
îr_id
 >
FW_ASSERT_LMAC_FATAL
 &&

111 
îr_id
 <
RT_NMI_INTERRUPT_OTHER_LMAC_FATAL
) ||

112 
îr_id
 =
FW_ASSERT_NMI_UNKNOWN
)

113  
åue
;

114  
Ál£
;

115 
	}
}

117 
	$iwl_fwπ_dump_umac_îr‹_log
(
iwl_fw_ru¡ime
 *
fwπ
)

119 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

120 
iwl_umac_îr‹_evít_èbÀ
 
èbÀ
 = {};

121 
u32
 
ba£
 = 
fwπ
->
å™s
->
dbg
.
umac_îr‹_evít_èbÀ
;

122 
≤vm_«me
[
MAX_PNVM_NAME
];

124 i‡(!
ba£
 &&

125 !(
fwπ
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 &

126 
IWL_ERROR_EVENT_TABLE_UMAC
))

129 
	`iwl_å™s_ªad_mem_byãs
(
å™s
, 
ba£
, &
èbÀ
, (table));

131 i‡(
èbÀ
.
vÆid
)

132 
fwπ
->
dump
.
umac_îr_id
 = 
èbÀ
.
îr‹_id
;

134 i‡(!
	`iwl_fwπ_if_îr‹id_Ÿhî_˝u
(
fwπ
->
dump
.
umac_îr_id
) &&

135 !
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
) {

136 
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
 = 
åue
;

137 
	`¢¥ötf
(
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext
, 
IWL_FW_INI_MAX_NAME
,

138 "0x%x", 
fwπ
->
dump
.
umac_îr_id
);

141 i‡(
ERROR_START_OFFSET
 <
èbÀ
.
vÆid
 * 
ERROR_ELEM_SIZE
) {

142 
	`IWL_ERR
(
å™s
, "Start IWL Error Log Dump:\n");

143 
	`IWL_ERR
(
å™s
, "Transport status: 0x%08lX, valid: %d\n",

144 
fwπ
->
å™s
->
°©us
, 
èbÀ
.
vÆid
);

147 i‡((
èbÀ
.
îr‹_id
 & ~
FW_SYSASSERT_CPU_MASK
) ==

148 
FW_SYSASSERT_PNVM_MISSING
) {

149 
	`iwl_≤vm_gë_fs_«me
(
å™s
, 
≤vm_«me
, (pnvm_name));

150 
	`IWL_ERR
(
fwπ
, "PNVM data is missing,Ölease install %s\n",

151 
≤vm_«me
);

154 
	`IWL_ERR
(
fwπ
, "0x%08X | %s\n", 
èbÀ
.
îr‹_id
,

155 
	`iwl_fw_lookup_as£π_desc
(
èbÀ
.
îr‹_id
));

156 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯bønchlök1\n", 
èbÀ
.
blök1
);

157 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯bønchlök2\n", 
èbÀ
.
blök2
);

158 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯öãºu±lök1\n", 
èbÀ
.
ûök1
);

159 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯öãºu±lök2\n", 
èbÀ
.
ûök2
);

160 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯d©a1\n", 
èbÀ
.
d©a1
);

161 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯d©a2\n", 
èbÀ
.
d©a2
);

162 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯d©a3\n", 
èbÀ
.
d©a3
);

163 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯maj‹\n", 
èbÀ
.
umac_maj‹
);

164 
	`IWL_ERR
(
fwπ
, "0x%08X | uma¯mö‹\n", 
èbÀ
.
umac_mö‹
);

165 
	`IWL_ERR
(
fwπ
, "0x%08X | fømêpoöãr\n", 
èbÀ
.
‰ame_poöãr
);

166 
	`IWL_ERR
(
fwπ
, "0x%08X | sèckÖoöãr\n", 
èbÀ
.
°ack_poöãr
);

167 
	`IWL_ERR
(
fwπ
, "0x%08X |Üa° ho° cmd\n", 
èbÀ
.
cmd_hódî
);

168 
	`IWL_ERR
(
fwπ
, "0x%08X | i§ sètu†ªg\n", 
èbÀ
.
nic_i§_¥ef
);

169 
	}
}

171 
	$iwl_fwπ_dump_lmac_îr‹_log
(
iwl_fw_ru¡ime
 *
fwπ
, 
u8
 
lmac_num
)

173 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

174 
iwl_îr‹_evít_èbÀ
 
èbÀ
 = {};

175 
u32
 
vÆ
, 
ba£
 = 
fwπ
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[
lmac_num
];

177 i‡(
fwπ
->
cur_fw_img
 =
IWL_UCODE_INIT
) {

178 i‡(!
ba£
)

179 
ba£
 = 
fwπ
->
fw
->
öô_îæog_±r
;

181 i‡(!
ba£
)

182 
ba£
 = 
fwπ
->
fw
->
ö°_îæog_±r
;

185 i‡(!
ba£
) {

186 
	`IWL_ERR
(
fwπ
,

188 
ba£
,

189 (
fwπ
->
cur_fw_img
 =
IWL_UCODE_INIT
)

195 
vÆ
 = 
	`iwl_å™s_ªad_mem32
(
å™s
, 
ba£
);

196 i‡(
	`iwl_å™s_is_hw_îr‹_vÆue
(
vÆ
)) {

197 
îr
;

199 
	`IWL_ERR
(
å™s
, "HWÉrror,Ñesetting beforeÑeading\n");

202 
îr
 = 
	`iwl_å™s_sw_ª£t
(
å™s
, 
åue
);

203 i‡(
îr
)

206 
îr
 = 
	`iwl_föish_nic_öô
(
å™s
);

207 i‡(
îr
)

211 
	`iwl_å™s_ªad_mem_byãs
(
å™s
, 
ba£
, &
èbÀ
, (table));

213 i‡(
èbÀ
.
vÆid
)

214 
fwπ
->
dump
.
lmac_îr_id
[
lmac_num
] = 
èbÀ
.
îr‹_id
;

216 i‡(!
	`iwl_fwπ_if_îr‹id_Ÿhî_˝u
(
fwπ
->
dump
.
lmac_îr_id
[
lmac_num
]) &&

217 !
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
) {

218 
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
 = 
åue
;

219 
	`¢¥ötf
(
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext
, 
IWL_FW_INI_MAX_NAME
,

220 "0x%x", 
fwπ
->
dump
.
lmac_îr_id
[
lmac_num
]);

223 i‡(
ERROR_START_OFFSET
 <
èbÀ
.
vÆid
 * 
ERROR_ELEM_SIZE
) {

224 
	`IWL_ERR
(
å™s
, "Start IWL Error Log Dump:\n");

225 
	`IWL_ERR
(
å™s
, "Transport status: 0x%08lX, valid: %d\n",

226 
fwπ
->
å™s
->
°©us
, 
èbÀ
.
vÆid
);

231 
	`IWL_ERR
(
fwπ
, "Lﬂded fúmw¨êvîsi⁄: %s\n", fwπ->
fw
->
fw_vîsi⁄
);

233 
	`IWL_ERR
(
fwπ
, "0x%08X | %-28s\n", 
èbÀ
.
îr‹_id
,

234 
	`iwl_fw_lookup_as£π_desc
(
èbÀ
.
îr‹_id
));

235 
	`IWL_ERR
(
fwπ
, "0x%08X |Årm_hw_°©us0\n", 
èbÀ
.
åm_hw_°©us0
);

236 
	`IWL_ERR
(
fwπ
, "0x%08X |Årm_hw_°©us1\n", 
èbÀ
.
åm_hw_°©us1
);

237 
	`IWL_ERR
(
fwπ
, "0x%08X | bønchlök2\n", 
èbÀ
.
blök2
);

238 
	`IWL_ERR
(
fwπ
, "0x%08X | i¡îru±lök1\n", 
èbÀ
.
ûök1
);

239 
	`IWL_ERR
(
fwπ
, "0x%08X | i¡îru±lök2\n", 
èbÀ
.
ûök2
);

240 
	`IWL_ERR
(
fwπ
, "0x%08X | d©a1\n", 
èbÀ
.
d©a1
);

241 
	`IWL_ERR
(
fwπ
, "0x%08X | d©a2\n", 
èbÀ
.
d©a2
);

242 
	`IWL_ERR
(
fwπ
, "0x%08X | d©a3\n", 
èbÀ
.
d©a3
);

243 
	`IWL_ERR
(
fwπ
, "0x%08X | bóc⁄Åime\n", 
èbÀ
.
bc⁄_time
);

244 
	`IWL_ERR
(
fwπ
, "0x%08X |Ås‡low\n", 
èbÀ
.
tsf_low
);

245 
	`IWL_ERR
(
fwπ
, "0x%08X |Ås‡hi\n", 
èbÀ
.
tsf_hi
);

246 
	`IWL_ERR
(
fwπ
, "0x%08X |Åimêgp1\n", 
èbÀ
.
gp1
);

247 
	`IWL_ERR
(
fwπ
, "0x%08X |Åimêgp2\n", 
èbÀ
.
gp2
);

248 
	`IWL_ERR
(
fwπ
, "0x%08X | uCodêªvisi⁄Åy≥\n", 
èbÀ
.
fw_ªv_ty≥
);

249 
	`IWL_ERR
(
fwπ
, "0x%08X | uCodêvîsi⁄ maj‹\n", 
èbÀ
.
maj‹
);

250 
	`IWL_ERR
(
fwπ
, "0x%08X | uCodêvîsi⁄ mö‹\n", 
èbÀ
.
mö‹
);

251 
	`IWL_ERR
(
fwπ
, "0x%08X | hw vîsi⁄\n", 
èbÀ
.
hw_vî
);

252 
	`IWL_ERR
(
fwπ
, "0x%08X | bﬂrd vîsi⁄\n", 
èbÀ
.
brd_vî
);

253 
	`IWL_ERR
(
fwπ
, "0x%08X | hcmd\n", 
èbÀ
.
hcmd
);

254 
	`IWL_ERR
(
fwπ
, "0x%08X | i§0\n", 
èbÀ
.
i§0
);

255 
	`IWL_ERR
(
fwπ
, "0x%08X | i§1\n", 
èbÀ
.
i§1
);

256 
	`IWL_ERR
(
fwπ
, "0x%08X | i§2\n", 
èbÀ
.
i§2
);

257 
	`IWL_ERR
(
fwπ
, "0x%08X | i§3\n", 
èbÀ
.
i§3
);

258 
	`IWL_ERR
(
fwπ
, "0x%08X | i§4\n", 
èbÀ
.
i§4
);

259 
	`IWL_ERR
(
fwπ
, "0x%08X |Üa° cmd Id\n", 
èbÀ
.
œ°_cmd_id
);

260 
	`IWL_ERR
(
fwπ
, "0x%08X | waô_evít\n", 
èbÀ
.
waô_evít
);

261 
	`IWL_ERR
(
fwπ
, "0x%08X |Ü2p_c⁄åﬁ\n", 
èbÀ
.
l2p_c⁄åﬁ
);

262 
	`IWL_ERR
(
fwπ
, "0x%08X |Ü2p_duøti⁄\n", 
èbÀ
.
l2p_duøti⁄
);

263 
	`IWL_ERR
(
fwπ
, "0x%08X |Ü2p_mhvÆid\n", 
èbÀ
.
l2p_mhvÆid
);

264 
	`IWL_ERR
(
fwπ
, "0x%08X |Ü2p_addr_m©ch\n", 
èbÀ
.
l2p_addr_m©ch
);

265 
	`IWL_ERR
(
fwπ
, "0x%08X |Ümpm_pmg_£l\n", 
èbÀ
.
lmpm_pmg_£l
);

266 
	`IWL_ERR
(
fwπ
, "0x%08X |Åime°amp\n", 
èbÀ
.
u_time°amp
);

267 
	`IWL_ERR
(
fwπ
, "0x%08X | flow_h™dÀr\n", 
èbÀ
.
Êow_h™dÀr
);

268 
	}
}

277 
	siwl_tcm_îr‹_evít_èbÀ
 {

278 
u32
 
	mvÆid
;

279 
u32
 
	mîr‹_id
;

280 
u32
 
	mblök2
;

281 
u32
 
	mûök1
;

282 
u32
 
	mûök2
;

283 
u32
 
	md©a1
, 
	md©a2
, 
	md©a3
;

284 
u32
 
	mlogpc
;

285 
u32
 
	m‰ame_poöãr
;

286 
u32
 
	m°ack_poöãr
;

287 
u32
 
	mmsgid
;

288 
u32
 
	mi§
;

289 
u32
 
	mhw_°©us
[5];

290 
u32
 
	msw_°©us
[1];

291 
u32
 
	mª£rved
[4];

292 } 
	g__∑cked
;

294 
	$iwl_fwπ_dump_tcm_îr‹_log
(
iwl_fw_ru¡ime
 *
fwπ
, 
idx
)

296 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

297 
iwl_tcm_îr‹_evít_èbÀ
 
èbÀ
 = {};

298 
u32
 
ba£
 = 
fwπ
->
å™s
->
dbg
.
tcm_îr‹_evít_èbÀ
[
idx
];

299 
i
;

300 
u32
 
Êag
 = 
idx
 ? 
IWL_ERROR_EVENT_TABLE_TCM2
 :

301 
IWL_ERROR_EVENT_TABLE_TCM1
;

303 i‡(!
ba£
 || !(
fwπ
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 & 
Êag
))

306 
	`iwl_å™s_ªad_mem_byãs
(
å™s
, 
ba£
, &
èbÀ
, (table));

308 i‡(
èbÀ
.
vÆid
)

309 
fwπ
->
dump
.
tcm_îr_id
[
idx
] = 
èbÀ
.
îr‹_id
;

311 i‡(!
	`iwl_fwπ_if_îr‹id_Ÿhî_˝u
(
fwπ
->
dump
.
tcm_îr_id
[
idx
]) &&

312 !
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
) {

313 
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
 = 
åue
;

314 
	`¢¥ötf
(
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext
, 
IWL_FW_INI_MAX_NAME
,

315 "0x%x", 
fwπ
->
dump
.
tcm_îr_id
[
idx
]);

318 
	`IWL_ERR
(
fwπ
, "TCM%d sètus:\n", 
idx
 + 1);

319 
	`IWL_ERR
(
fwπ
, "0x%08X |Éº‹ ID\n", 
èbÀ
.
îr‹_id
);

320 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm bønchlök2\n", 
èbÀ
.
blök2
);

321 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm i¡îru±lök1\n", 
èbÀ
.
ûök1
);

322 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm i¡îru±lök2\n", 
èbÀ
.
ûök2
);

323 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm d©a1\n", 
èbÀ
.
d©a1
);

324 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm d©a2\n", 
èbÀ
.
d©a2
);

325 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm d©a3\n", 
èbÀ
.
d©a3
);

326 
	`IWL_ERR
(
fwπ
, "0x%08X |ÅcmÜog PC\n", 
èbÀ
.
logpc
);

327 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm fømêpoöãr\n", 
èbÀ
.
‰ame_poöãr
);

328 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm sèckÖoöãr\n", 
èbÀ
.
°ack_poöãr
);

329 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm msg ID\n", 
èbÀ
.
msgid
);

330 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm ISR sètus\n", 
èbÀ
.
i§
);

331 
i
 = 0; i < 
	`ARRAY_SIZE
(
èbÀ
.
hw_°©us
); i++)

332 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm HW status[%d]\n",

333 
èbÀ
.
hw_°©us
[
i
], i);

334 
i
 = 0; i < 
	`ARRAY_SIZE
(
èbÀ
.
sw_°©us
); i++)

335 
	`IWL_ERR
(
fwπ
, "0x%08X |Åcm SW status[%d]\n",

336 
èbÀ
.
sw_°©us
[
i
], i);

337 
	}
}

346 
	siwl_rcm_îr‹_evít_èbÀ
 {

347 
u32
 
	mvÆid
;

348 
u32
 
	mîr‹_id
;

349 
u32
 
	mblök2
;

350 
u32
 
	mûök1
;

351 
u32
 
	mûök2
;

352 
u32
 
	md©a1
, 
	md©a2
, 
	md©a3
;

353 
u32
 
	mlogpc
;

354 
u32
 
	m‰ame_poöãr
;

355 
u32
 
	m°ack_poöãr
;

356 
u32
 
	mmsgid
;

357 
u32
 
	mi§
;

358 
u32
 
	m‰ame_hw_°©us
;

359 
u32
 
	mmbx_lmac_to_rcm_ªq
;

360 
u32
 
	mmbx_rcm_to_lmac_ªq
;

361 
u32
 
	mmh_˘l
;

362 
u32
 
	mmh_addr1_lo
;

363 
u32
 
	mmh_öfo
;

364 
u32
 
	mmh_îr
;

365 
u32
 
	mª£rved
[3];

366 } 
	g__∑cked
;

368 
	$iwl_fwπ_dump_rcm_îr‹_log
(
iwl_fw_ru¡ime
 *
fwπ
, 
idx
)

370 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

371 
iwl_rcm_îr‹_evít_èbÀ
 
èbÀ
 = {};

372 
u32
 
ba£
 = 
fwπ
->
å™s
->
dbg
.
rcm_îr‹_evít_èbÀ
[
idx
];

373 
u32
 
Êag
 = 
idx
 ? 
IWL_ERROR_EVENT_TABLE_RCM2
 :

374 
IWL_ERROR_EVENT_TABLE_RCM1
;

376 i‡(!
ba£
 || !(
fwπ
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 & 
Êag
))

379 
	`iwl_å™s_ªad_mem_byãs
(
å™s
, 
ba£
, &
èbÀ
, (table));

381 i‡(
èbÀ
.
vÆid
)

382 
fwπ
->
dump
.
rcm_îr_id
[
idx
] = 
èbÀ
.
îr‹_id
;

384 i‡(!
	`iwl_fwπ_if_îr‹id_Ÿhî_˝u
(
fwπ
->
dump
.
rcm_îr_id
[
idx
]) &&

385 !
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
) {

386 
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
 = 
åue
;

387 
	`¢¥ötf
(
fwπ
->
å™s
->
dbg
.
dump_fûe_«me_ext
, 
IWL_FW_INI_MAX_NAME
,

388 "0x%x", 
fwπ
->
dump
.
rcm_îr_id
[
idx
]);

391 
	`IWL_ERR
(
fwπ
, "RCM%d sètus:\n", 
idx
 + 1);

392 
	`IWL_ERR
(
fwπ
, "0x%08X |Éº‹ ID\n", 
èbÀ
.
îr‹_id
);

393 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm bønchlök2\n", 
èbÀ
.
blök2
);

394 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm i¡îru±lök1\n", 
èbÀ
.
ûök1
);

395 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm i¡îru±lök2\n", 
èbÀ
.
ûök2
);

396 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm d©a1\n", 
èbÀ
.
d©a1
);

397 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm d©a2\n", 
èbÀ
.
d©a2
);

398 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm d©a3\n", 
èbÀ
.
d©a3
);

399 
	`IWL_ERR
(
fwπ
, "0x%08X |ÑcmÜog PC\n", 
èbÀ
.
logpc
);

400 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm fømêpoöãr\n", 
èbÀ
.
‰ame_poöãr
);

401 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm sèckÖoöãr\n", 
èbÀ
.
°ack_poöãr
);

402 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm msg ID\n", 
èbÀ
.
msgid
);

403 
	`IWL_ERR
(
fwπ
, "0x%08X |Ñcm ISR sètus\n", 
èbÀ
.
i§
);

404 
	`IWL_ERR
(
fwπ
, "0x%08X | fømêHW sètus\n", 
èbÀ
.
‰ame_hw_°©us
);

405 
	`IWL_ERR
(
fwπ
, "0x%08X | LMAC-to-RCMÑequest mbox\n",

406 
èbÀ
.
mbx_lmac_to_rcm_ªq
);

407 
	`IWL_ERR
(
fwπ
, "0x%08X | RCM-to-LMACÑequest mbox\n",

408 
èbÀ
.
mbx_rcm_to_lmac_ªq
);

409 
	`IWL_ERR
(
fwπ
, "0x%08X | MAC hódî c⁄åﬁ\n", 
èbÀ
.
mh_˘l
);

410 
	`IWL_ERR
(
fwπ
, "0x%08X | MAC hódîáddr1Üow\n", 
èbÀ
.
mh_addr1_lo
);

411 
	`IWL_ERR
(
fwπ
, "0x%08X | MAC hódî info\n", 
èbÀ
.
mh_öfo
);

412 
	`IWL_ERR
(
fwπ
, "0x%08X | MAC hódîÉº‹\n", 
èbÀ
.
mh_îr
);

413 
	}
}

415 
	$iwl_fwπ_dump_iml_îr‹_log
(
iwl_fw_ru¡ime
 *
fwπ
)

417 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

418 
u32
 
îr‹
, 
d©a1
;

420 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
) {

421 
îr‹
 = 
UMAG_SB_CPU_2_STATUS
;

422 
d©a1
 = 
UMAG_SB_CPU_1_STATUS
;

423 } i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

424 
IWL_DEVICE_FAMILY_8000
) {

425 
îr‹
 = 
SB_CPU_2_STATUS
;

426 
d©a1
 = 
SB_CPU_1_STATUS
;

431 
îr‹
 = 
	`iwl_ªad_umac_¥ph
(
å™s
,Érror);

433 
	`IWL_ERR
(
å™s
, "IML/ROM dump:\n");

435 i‡(
îr‹
 & 0xFFFF0000)

436 
	`IWL_ERR
(
å™s
, "0x%04X | IML/ROM SYSASSERT\n", 
îr‹
 >> 16);

438 
	`IWL_ERR
(
fwπ
, "0x%08X | IML/ROMÉº‹/°©e\n", 
îr‹
);

439 
	`IWL_ERR
(
fwπ
, "0x%08X | IML/ROM data1\n",

440 
	`iwl_ªad_umac_¥ph
(
å™s
, 
d©a1
));

442 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
)

443 
	`IWL_ERR
(
fwπ
, "0x%08X | IML/ROM WFPM_AUTH_KEY_0\n",

444 
	`iwl_ªad_umac_¥ph
(
å™s
, 
SB_MODIFY_CFG_FLAG
));

445 
	}
}

447 
	#FSEQ_REG
(
x
Ë{ .
addr
 = (x), .
°r
 = #x, }

	)

449 
	$iwl_fwπ_dump_f£q_ªgs
(
iwl_fw_ru¡ime
 *
fwπ
)

451 
iwl_å™s
 *
å™s
 = 
fwπ
->trans;

452 
i
;

454 
u32
 
addr
;

455 c⁄° *
°r
;

456 } 
f£q_ªgs
[] = {

457 
	`FSEQ_REG
(
FSEQ_ERROR_CODE
),

458 
	`FSEQ_REG
(
FSEQ_TOP_INIT_VERSION
),

459 
	`FSEQ_REG
(
FSEQ_CNVIO_INIT_VERSION
),

460 
	`FSEQ_REG
(
FSEQ_OTP_VERSION
),

461 
	`FSEQ_REG
(
FSEQ_TOP_CONTENT_VERSION
),

462 
	`FSEQ_REG
(
FSEQ_ALIVE_TOKEN
),

463 
	`FSEQ_REG
(
FSEQ_CNVI_ID
),

464 
	`FSEQ_REG
(
FSEQ_CNVR_ID
),

465 
	`FSEQ_REG
(
CNVI_AUX_MISC_CHIP
),

466 
	`FSEQ_REG
(
CNVR_AUX_MISC_CHIP
),

467 
	`FSEQ_REG
(
CNVR_SCU_SD_REGS_SD_REG_DIG_DCDC_VTRIM
),

468 
	`FSEQ_REG
(
CNVR_SCU_SD_REGS_SD_REG_ACTIVE_VDIG_MIRROR
),

469 
	`FSEQ_REG
(
FSEQ_PREV_CNVIO_INIT_VERSION
),

470 
	`FSEQ_REG
(
FSEQ_WIFI_FSEQ_VERSION
),

471 
	`FSEQ_REG
(
FSEQ_BT_FSEQ_VERSION
),

472 
	`FSEQ_REG
(
FSEQ_CLASS_TP_VERSION
),

475 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

478 
	`IWL_ERR
(
fwπ
, "Fseq Registers:\n");

480 
i
 = 0; i < 
	`ARRAY_SIZE
(
f£q_ªgs
); i++)

481 
	`IWL_ERR
(
fwπ
, "0x%08X | %s\n",

482 
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
f£q_ªgs
[
i
].
addr
),

483 
f£q_ªgs
[
i
].
°r
);

485 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

486 
	}
}

488 
	$iwl_fwπ_dump_îr‹_logs
(
iwl_fw_ru¡ime
 *
fwπ
)

490 
iwl_pc_d©a
 *
pc_d©a
;

491 
u8
 
cou¡
;

493 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
fwπ
->
å™s
->
°©us
)) {

494 
	`IWL_ERR
(
fwπ
,

499 
	`iwl_fwπ_dump_lmac_îr‹_log
(
fwπ
, 0);

500 i‡(
fwπ
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[1])

501 
	`iwl_fwπ_dump_lmac_îr‹_log
(
fwπ
, 1);

502 
	`iwl_fwπ_dump_umac_îr‹_log
(
fwπ
);

503 
	`iwl_fwπ_dump_tcm_îr‹_log
(
fwπ
, 0);

504 
	`iwl_fwπ_dump_rcm_îr‹_log
(
fwπ
, 0);

505 i‡(
fwπ
->
å™s
->
dbg
.
tcm_îr‹_evít_èbÀ
[1])

506 
	`iwl_fwπ_dump_tcm_îr‹_log
(
fwπ
, 1);

507 i‡(
fwπ
->
å™s
->
dbg
.
rcm_îr‹_evít_èbÀ
[1])

508 
	`iwl_fwπ_dump_rcm_îr‹_log
(
fwπ
, 1);

509 
	`iwl_fwπ_dump_iml_îr‹_log
(
fwπ
);

510 
	`iwl_fwπ_dump_f£q_ªgs
(
fwπ
);

511 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
) {

512 
pc_d©a
 = 
fwπ
->
å™s
->
dbg
.pc_data;

514 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
))

516 
cou¡
 = 0; cou¡ < 
fwπ
->
å™s
->
dbg
.
num_pc
;

517 
cou¡
++, 
pc_d©a
++)

518 
	`IWL_ERR
(
fwπ
, "%s: 0x%x\n",

519 
pc_d©a
->
pc_«me
,

520 
	`iwl_ªad_¥ph_no_gøb
(
fwπ
->
å™s
,

521 
pc_d©a
->
pc_addªss
));

522 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

525 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

526 
u32
 
s¸©ch
 = 
	`iwl_ªad32
(
fwπ
->
å™s
, 
CSR_FUNC_SCRATCH
);

528 
	`IWL_ERR
(
fwπ
, "Function Scratch status:\n");

529 
	`IWL_ERR
(
fwπ
, "0x%08X | Fun¯S¸©ch\n", 
s¸©ch
);

531 
	}
}

532 
IWL_EXPORT_SYMBOL
(
iwl_fwπ_dump_îr‹_logs
);

	@fw/error-dump.h

7 #i‚de‡
__fw_îr‹_dump_h__


8 
	#__fw_îr‹_dump_h__


	)

10 
	~<löux/ty≥s.h
>

11 
	~"fw/≠i/cmdhdr.h
"

13 
	#IWL_FW_ERROR_DUMP_BARKER
 0x14789632

	)

14 
	#IWL_FW_INI_ERROR_DUMP_BARKER
 0x14789633

	)

46 
	eiwl_fw_îr‹_dump_ty≥
 {

48 
	mIWL_FW_ERROR_DUMP_CSR
 = 1,

49 
	mIWL_FW_ERROR_DUMP_RXF
 = 2,

50 
	mIWL_FW_ERROR_DUMP_TXCMD
 = 3,

51 
	mIWL_FW_ERROR_DUMP_DEV_FW_INFO
 = 4,

52 
	mIWL_FW_ERROR_DUMP_FW_MONITOR
 = 5,

53 
	mIWL_FW_ERROR_DUMP_PRPH
 = 6,

54 
	mIWL_FW_ERROR_DUMP_TXF
 = 7,

55 
	mIWL_FW_ERROR_DUMP_FH_REGS
 = 8,

56 
	mIWL_FW_ERROR_DUMP_MEM
 = 9,

57 
	mIWL_FW_ERROR_DUMP_ERROR_INFO
 = 10,

58 
	mIWL_FW_ERROR_DUMP_RB
 = 11,

59 
	mIWL_FW_ERROR_DUMP_PAGING
 = 12,

60 
	mIWL_FW_ERROR_DUMP_RADIO_REG
 = 13,

61 
	mIWL_FW_ERROR_DUMP_INTERNAL_TXF
 = 14,

62 
	mIWL_FW_ERROR_DUMP_EXTERNAL
 = 15,

63 
	mIWL_FW_ERROR_DUMP_MEM_CFG
 = 16,

64 
	mIWL_FW_ERROR_DUMP_D3_DEBUG_DATA
 = 17,

73 
	siwl_fw_îr‹_dump_d©a
 {

74 
__À32
 
	mty≥
;

75 
__À32
 
	mÀn
;

76 
__u8
 
	md©a
[];

77 } 
	g__∑cked
;

85 
	siwl_dump_fûe_«me_öfo
 {

86 
__À32
 
	mty≥
;

87 
__À32
 
	mÀn
;

88 
__u8
 
	md©a
[];

89 } 
	g__∑cked
;

97 
	siwl_fw_îr‹_dump_fûe
 {

98 
__À32
 
	mb¨kî
;

99 
__À32
 
	mfûe_Àn
;

100 
u8
 
	md©a
[];

101 } 
	g__∑cked
;

109 
	siwl_fw_îr‹_dump_txcmd
 {

110 
__À32
 
	mcmdÀn
;

111 
__À32
 
	mˇ∂í
;

112 
u8
 
	md©a
[];

113 } 
	g__∑cked
;

126 
	siwl_fw_îr‹_dump_fifo
 {

127 
__À32
 
	mfifo_num
;

128 
__À32
 
	mavaûabÀ_byãs
;

129 
__À32
 
	mwr_±r
;

130 
__À32
 
	mrd_±r
;

131 
__À32
 
	m„n˚_±r
;

132 
__À32
 
	m„n˚_mode
;

133 
u8
 
	md©a
[];

134 } 
	g__∑cked
;

136 
	eiwl_fw_îr‹_dump_Ámûy
 {

137 
	mIWL_FW_ERROR_DUMP_FAMILY_7
 = 7,

138 
	mIWL_FW_ERROR_DUMP_FAMILY_8
 = 8,

141 
	#MAX_NUM_LMAC
 2

	)

156 
	siwl_fw_îr‹_dump_öfo
 {

157 
__À32
 
	mhw_ty≥
;

158 
__À32
 
	mhw_°ï
;

159 
u8
 
	mfw_hum™_ªadabÀ
[
FW_VER_HUMAN_READABLE_SZ
];

160 
u8
 
	mdev_hum™_ªadabÀ
[64];

161 
u8
 
	mbus_hum™_ªadabÀ
[8];

162 
u8
 
	mnum_of_lmacs
;

163 
__À32
 
	mumac_îr_id
;

164 
__À32
 
	mlmac_îr_id
[
MAX_NUM_LMAC
];

165 } 
	g__∑cked
;

178 
	siwl_fw_îr‹_dump_fw_m⁄
 {

179 
__À32
 
	mfw_m⁄_wr_±r
;

180 
__À32
 
	mfw_m⁄_ba£_±r
;

181 
__À32
 
	mfw_m⁄_cy˛e_˙t
;

182 
__À32
 
	mfw_m⁄_ba£_high_±r
;

183 
__À32
 
	mª£rved
[2];

184 
u8
 
	md©a
[];

185 } 
	g__∑cked
;

187 
	#MAX_NUM_LMAC
 2

	)

188 
	#TX_FIFO_INTERNAL_MAX_NUM
 6

	)

189 
	#TX_FIFO_MAX_NUM
 15

	)

200 
	siwl_fw_îr‹_dump_smem_cfg
 {

201 
__À32
 
	mnum_lmacs
;

202 
__À32
 
	mnum_txfifo_íåõs
;

204 
__À32
 
	mtxfifo_size
[
TX_FIFO_MAX_NUM
];

205 
__À32
 
	mrxfifo1_size
;

206 } 
	mlmac
[
MAX_NUM_LMAC
];

207 
__À32
 
	mrxfifo2_size
;

208 
__À32
 
	möã∫Æ_txfifo_addr
;

209 
__À32
 
	möã∫Æ_txfifo_size
[
TX_FIFO_INTERNAL_MAX_NUM
];

210 } 
	g__∑cked
;

216 
	siwl_fw_îr‹_dump_¥ph
 {

217 
__À32
 
	m¥ph_°¨t
;

218 
__À32
 
	md©a
[];

221 
	eiwl_fw_îr‹_dump_mem_ty≥
 {

222 
	mIWL_FW_ERROR_DUMP_MEM_SRAM
,

223 
	mIWL_FW_ERROR_DUMP_MEM_SMEM
,

224 
	mIWL_FW_ERROR_DUMP_MEM_NAMED_MEM
 = 10,

233 
	siwl_fw_îr‹_dump_mem
 {

234 
__À32
 
	mty≥
;

235 
__À32
 
	moff£t
;

236 
u8
 
	md©a
[];

242 
	#IWL_INI_DUMP_VER
 1

	)

245 
	#IWL_INI_DUMP_INFO_TYPE
 
	`BIT
(31)

	)

248 
	#IWL_INI_DUMP_NAME_TYPE
 (
	`BIT
(31Ë| BIT(24))

	)

259 
	siwl_fw_öi_îr‹_dump_d©a
 {

260 
u8
 
	mty≥
;

261 
u8
 
	msub_ty≥
;

262 
u8
 
	msub_ty≥_vî
;

263 
u8
 
	mª£rved
;

264 
__À32
 
	mÀn
;

265 
__u8
 
	md©a
[];

266 } 
	g__∑cked
;

274 
	siwl_fw_öi_dump_íåy
 {

275 
li°_hód
 
	mli°
;

276 
u32
 
	msize
;

277 
u8
 
	md©a
[];

278 } 
	g__∑cked
;

285 
	siwl_fw_öi_dump_fûe_hdr
 {

286 
__À32
 
	mb¨kî
;

287 
__À32
 
	mfûe_Àn
;

288 } 
	g__∑cked
;

296 
	siwl_fw_öi_fifo_hdr
 {

297 
__À32
 
	mfifo_num
;

298 
__À32
 
	mnum_of_ªgi°îs
;

299 } 
	g__∑cked
;

311 
	siwl_fw_öi_îr‹_dump_ønge
 {

312 
__À32
 
	mønge_d©a_size
;

314 
__À32
 
öã∫Æ_ba£_addr
 
	m__∑cked
;

315 
__À64
 
døm_ba£_addr
 
	m__∑cked
;

316 
__À32
 
∑ge_num
 
	m__∑cked
;

317 
iwl_fw_öi_fifo_hdr
 
	mfifo_hdr
;

318 
iwl_cmd_hódî
 
	mfw_pkt_hdr
;

320 
__À32
 
	md©a
[];

321 } 
	g__∑cked
;

331 
	siwl_fw_öi_îr‹_dump_hódî
 {

332 
__À32
 
	mvîsi⁄
;

333 
__À32
 
	mªgi⁄_id
;

334 
__À32
 
	mnum_of_ønges
;

335 
__À32
 
	m«me_Àn
;

336 
u8
 
	m«me
[
IWL_FW_INI_MAX_NAME
];

345 
	siwl_fw_öi_îr‹_dump
 {

346 
iwl_fw_öi_îr‹_dump_hódî
 
	mhódî
;

347 
u8
 
	md©a
[];

348 } 
	g__∑cked
;

351 
	#IWL_RXF_UMAC_BIT
 
	`BIT
(31)

	)

358 
	siwl_fw_öi_îr‹_dump_ªgi°î
 {

359 
__À32
 
	maddr
;

360 
__À32
 
	md©a
;

361 } 
	g__∑cked
;

369 
	siwl_fw_öi_dump_cfg_«me
 {

370 
__À32
 
	mimage_ty≥
;

371 
__À32
 
	mcfg_«me_Àn
;

372 
u8
 
	mcfg_«me
[
IWL_FW_INI_MAX_CFG_NAME
];

373 } 
	g__∑cked
;

376 
	#IWL_AX210_HW_TYPE
 0x42

	)

378 
	#IWL_AX210_HW_TYPE_ADDITION_SHIFT
 12

	)

404 
	siwl_fw_öi_dump_öfo
 {

405 
__À32
 
	mvîsi⁄
;

406 
__À32
 
	mtime_poöt
;

407 
__À32
 
	måiggî_ªas⁄
;

408 
__À32
 
	mexã∫Æ_cfg_°©e
;

409 
__À32
 
	mvî_ty≥
;

410 
__À32
 
	mvî_subty≥
;

411 
__À32
 
	mhw_°ï
;

412 
__À32
 
	mhw_ty≥
;

413 
__À32
 
	mrf_id_Êav‹
;

414 
__À32
 
	mrf_id_dash
;

415 
__À32
 
	mrf_id_°ï
;

416 
__À32
 
	mrf_id_ty≥
;

417 
__À32
 
	mlmac_maj‹
;

418 
__À32
 
	mlmac_mö‹
;

419 
__À32
 
	mumac_maj‹
;

420 
__À32
 
	mumac_mö‹
;

421 
__À32
 
	mfw_m⁄_mode
;

422 
__À64
 
	mªgi⁄s_mask
;

423 
__À32
 
	mbuûd_èg_Àn
;

424 
u8
 
	mbuûd_èg
[
FW_VER_HUMAN_READABLE_SZ
];

425 
__À32
 
	mnum_of_cfg_«mes
;

426 
iwl_fw_öi_dump_cfg_«me
 
	mcfg_«mes
[];

427 } 
	g__∑cked
;

436 
	siwl_fw_öi_îr_èbÀ_dump
 {

437 
iwl_fw_öi_îr‹_dump_hódî
 
	mhódî
;

438 
__À32
 
	mvîsi⁄
;

439 
u8
 
	md©a
[];

440 } 
	g__∑cked
;

449 
	siwl_fw_îr‹_dump_rb
 {

450 
__À32
 
	mödex
;

451 
__À32
 
	mrxq
;

452 
__À32
 
	mª£rved
;

453 
u8
 
	md©a
[];

465 
	siwl_fw_öi_m⁄ô‹_dump
 {

466 
iwl_fw_öi_îr‹_dump_hódî
 
	mhódî
;

467 
__À32
 
	mwrôe_±r
;

468 
__À32
 
	mcy˛e_˙t
;

469 
__À32
 
	mcur_‰ag
;

470 
u8
 
	md©a
[];

471 } 
	g__∑cked
;

481 
	siwl_fw_öi_•ecül_devi˚_mem‹y
 {

482 
iwl_fw_öi_îr‹_dump_hódî
 
	mhódî
;

483 
__À16
 
	mty≥
;

484 
__À16
 
	mvîsi⁄
;

485 
u8
 
	md©a
[];

486 } 
	g__∑cked
;

495 
	siwl_fw_îr‹_dump_∑gög
 {

496 
__À32
 
	mödex
;

497 
__À32
 
	mª£rved
;

498 
u8
 
	md©a
[];

506 
ölöe
 
iwl_fw_îr‹_dump_d©a
 *

507 
	$iwl_fw_îr‹_√xt_d©a
(
iwl_fw_îr‹_dump_d©a
 *
d©a
)

509  (*)(
d©a
->d©®+ 
	`À32_to_˝u
(d©a->
Àn
));

510 
	}
}

545 
	eiwl_fw_dbg_åiggî
 {

546 
	mFW_DBG_TRIGGER_INVALID
 = 0,

547 
	mFW_DBG_TRIGGER_USER
,

548 
	mFW_DBG_TRIGGER_FW_ASSERT
,

549 
	mFW_DBG_TRIGGER_MISSED_BEACONS
,

550 
	mFW_DBG_TRIGGER_CHANNEL_SWITCH
,

551 
	mFW_DBG_TRIGGER_FW_NOTIF
,

552 
	mFW_DBG_TRIGGER_MLME
,

553 
	mFW_DBG_TRIGGER_STATS
,

554 
	mFW_DBG_TRIGGER_RSSI
,

555 
	mFW_DBG_TRIGGER_TXQ_TIMERS
,

556 
	mFW_DBG_TRIGGER_TIME_EVENT
,

557 
	mFW_DBG_TRIGGER_BA
,

558 
	mFW_DBG_TRIGGER_TX_LATENCY
,

559 
	mFW_DBG_TRIGGER_TDLS
,

560 
	mFW_DBG_TRIGGER_TX_STATUS
,

561 
	mFW_DBG_TRIGGER_ALIVE_TIMEOUT
,

562 
	mFW_DBG_TRIGGER_DRIVER
,

565 
	mFW_DBG_TRIGGER_MAX
,

573 
	siwl_fw_îr‹_dump_åiggî_desc
 {

574 
__À32
 
	mty≥
;

575 
u8
 
	md©a
[];

	@fw/file.h

7 #i‚de‡
__iwl_fw_fûe_h__


8 
	#__iwl_fw_fûe_h__


	)

10 
	~<löux/√tdevi˚.h
>

11 
	~<löux/∆80211.h
>

14 
	siwl_ucode_hódî
 {

15 
__À32
 
	mvî
;

18 
__À32
 
	mö°_size
;

19 
__À32
 
	md©a_size
;

20 
__À32
 
	möô_size
;

21 
__À32
 
	möô_d©a_size
;

22 
__À32
 
	mboŸ_size
;

23 
u8
 
	md©a
[];

24 } 
	mv1
;

26 
__À32
 
	mbuûd
;

27 
__À32
 
	mö°_size
;

28 
__À32
 
	md©a_size
;

29 
__À32
 
	möô_size
;

30 
__À32
 
	möô_d©a_size
;

31 
__À32
 
	mboŸ_size
;

32 
u8
 
	md©a
[];

33 } 
	mv2
;

34 } 
	mu
;

37 
	#IWL_UCODE_TLV_DEBUG_BASE
 0x1000005

	)

38 
	#IWL_UCODE_TLV_CONST_BASE
 0x100

	)

47 
	eiwl_ucode_év_ty≥
 {

48 
	mIWL_UCODE_TLV_INVALID
 = 0,

49 
	mIWL_UCODE_TLV_INST
 = 1,

50 
	mIWL_UCODE_TLV_DATA
 = 2,

51 
	mIWL_UCODE_TLV_INIT
 = 3,

52 
	mIWL_UCODE_TLV_INIT_DATA
 = 4,

53 
	mIWL_UCODE_TLV_BOOT
 = 5,

54 
	mIWL_UCODE_TLV_PROBE_MAX_LEN
 = 6,

55 
	mIWL_UCODE_TLV_PAN
 = 7,

56 
	mIWL_UCODE_TLV_MEM_DESC
 = 7,

57 
	mIWL_UCODE_TLV_RUNT_EVTLOG_PTR
 = 8,

58 
	mIWL_UCODE_TLV_RUNT_EVTLOG_SIZE
 = 9,

59 
	mIWL_UCODE_TLV_RUNT_ERRLOG_PTR
 = 10,

60 
	mIWL_UCODE_TLV_INIT_EVTLOG_PTR
 = 11,

61 
	mIWL_UCODE_TLV_INIT_EVTLOG_SIZE
 = 12,

62 
	mIWL_UCODE_TLV_INIT_ERRLOG_PTR
 = 13,

63 
	mIWL_UCODE_TLV_ENHANCE_SENS_TBL
 = 14,

64 
	mIWL_UCODE_TLV_PHY_CALIBRATION_SIZE
 = 15,

65 
	mIWL_UCODE_TLV_WOWLAN_INST
 = 16,

66 
	mIWL_UCODE_TLV_WOWLAN_DATA
 = 17,

67 
	mIWL_UCODE_TLV_FLAGS
 = 18,

68 
	mIWL_UCODE_TLV_SEC_RT
 = 19,

69 
	mIWL_UCODE_TLV_SEC_INIT
 = 20,

70 
	mIWL_UCODE_TLV_SEC_WOWLAN
 = 21,

71 
	mIWL_UCODE_TLV_DEF_CALIB
 = 22,

72 
	mIWL_UCODE_TLV_PHY_SKU
 = 23,

73 
	mIWL_UCODE_TLV_SECURE_SEC_RT
 = 24,

74 
	mIWL_UCODE_TLV_SECURE_SEC_INIT
 = 25,

75 
	mIWL_UCODE_TLV_SECURE_SEC_WOWLAN
 = 26,

76 
	mIWL_UCODE_TLV_NUM_OF_CPU
 = 27,

77 
	mIWL_UCODE_TLV_CSCHEME
 = 28,

78 
	mIWL_UCODE_TLV_API_CHANGES_SET
 = 29,

79 
	mIWL_UCODE_TLV_ENABLED_CAPABILITIES
 = 30,

80 
	mIWL_UCODE_TLV_N_SCAN_CHANNELS
 = 31,

81 
	mIWL_UCODE_TLV_PAGING
 = 32,

82 
	mIWL_UCODE_TLV_SEC_RT_USNIFFER
 = 34,

84 
	mIWL_UCODE_TLV_FW_VERSION
 = 36,

85 
	mIWL_UCODE_TLV_FW_DBG_DEST
 = 38,

86 
	mIWL_UCODE_TLV_FW_DBG_CONF
 = 39,

87 
	mIWL_UCODE_TLV_FW_DBG_TRIGGER
 = 40,

88 
	mIWL_UCODE_TLV_CMD_VERSIONS
 = 48,

89 
	mIWL_UCODE_TLV_FW_GSCAN_CAPA
 = 50,

90 
	mIWL_UCODE_TLV_FW_MEM_SEG
 = 51,

91 
	mIWL_UCODE_TLV_IML
 = 52,

92 
	mIWL_UCODE_TLV_UMAC_DEBUG_ADDRS
 = 54,

93 
	mIWL_UCODE_TLV_LMAC_DEBUG_ADDRS
 = 55,

94 
	mIWL_UCODE_TLV_FW_RECOVERY_INFO
 = 57,

95 
	mIWL_UCODE_TLV_HW_TYPE
 = 58,

96 
	mIWL_UCODE_TLV_FW_FSEQ_VERSION
 = 60,

97 
	mIWL_UCODE_TLV_PHY_INTEGRATION_VERSION
 = 61,

99 
	mIWL_UCODE_TLV_PNVM_VERSION
 = 62,

100 
	mIWL_UCODE_TLV_PNVM_SKU
 = 64,

102 
	mIWL_UCODE_TLV_SEC_TABLE_ADDR
 = 66,

103 
	mIWL_UCODE_TLV_D3_KEK_KCK_ADDR
 = 67,

104 
	mIWL_UCODE_TLV_CURRENT_PC
 = 68,

106 
	mIWL_UCODE_TLV_FW_NUM_STATIONS
 = 
IWL_UCODE_TLV_CONST_BASE
 + 0,

107 
	mIWL_UCODE_TLV_FW_NUM_BEACONS
 = 
IWL_UCODE_TLV_CONST_BASE
 + 2,

109 
	mIWL_UCODE_TLV_TYPE_DEBUG_INFO
 = 
IWL_UCODE_TLV_DEBUG_BASE
 + 0,

110 
	mIWL_UCODE_TLV_TYPE_BUFFER_ALLOCATION
 = 
IWL_UCODE_TLV_DEBUG_BASE
 + 1,

111 
	mIWL_UCODE_TLV_TYPE_HCMD
 = 
IWL_UCODE_TLV_DEBUG_BASE
 + 2,

112 
	mIWL_UCODE_TLV_TYPE_REGIONS
 = 
IWL_UCODE_TLV_DEBUG_BASE
 + 3,

113 
	mIWL_UCODE_TLV_TYPE_TRIGGERS
 = 
IWL_UCODE_TLV_DEBUG_BASE
 + 4,

114 
	mIWL_UCODE_TLV_TYPE_CONF_SET
 = 
IWL_UCODE_TLV_DEBUG_BASE
 + 5,

115 
	mIWL_UCODE_TLV_DEBUG_MAX
 = 
IWL_UCODE_TLV_TYPE_TRIGGERS
,

118 
	mIWL_UCODE_TLV_FW_DBG_DUMP_LST
 = 0x1000,

121 
	siwl_ucode_év
 {

122 
__À32
 
	mty≥
;

123 
__À32
 
	mÀngth
;

124 
u8
 
	md©a
[];

127 
	#IWL_TLV_UCODE_MAGIC
 0x0a4c5749

	)

128 
	#FW_VER_HUMAN_READABLE_SZ
 64

	)

130 
	siwl_év_ucode_hódî
 {

137 
__À32
 
	mzîo
;

138 
__À32
 
	mmagic
;

139 
u8
 
	mhum™_ªadabÀ
[
FW_VER_HUMAN_READABLE_SZ
];

141 
__À32
 
	mvî
;

142 
__À32
 
	mbuûd
;

143 
__À64
 
	mign‹e
;

150 
u8
 
	md©a
[];

158 
	siwl_ucode_≠i
 {

159 
__À32
 
	m≠i_ödex
;

160 
__À32
 
	m≠i_Êags
;

161 } 
	g__∑cked
;

163 
	siwl_ucode_ˇ∑
 {

164 
__À32
 
	m≠i_ödex
;

165 
__À32
 
	m≠i_ˇ∑
;

166 } 
	g__∑cked
;

188 
	eiwl_ucode_év_Êag
 {

189 
	mIWL_UCODE_TLV_FLAGS_PAN
 = 
BIT
(0),

190 
	mIWL_UCODE_TLV_FLAGS_NEWSCAN
 = 
BIT
(1),

191 
	mIWL_UCODE_TLV_FLAGS_MFP
 = 
BIT
(2),

192 
	mIWL_UCODE_TLV_FLAGS_SHORT_BL
 = 
BIT
(7),

193 
	mIWL_UCODE_TLV_FLAGS_D3_6_IPV6_ADDRS
 = 
BIT
(10),

194 
	mIWL_UCODE_TLV_FLAGS_NO_BASIC_SSID
 = 
BIT
(12),

195 
	mIWL_UCODE_TLV_FLAGS_NEW_NSOFFL_SMALL
 = 
BIT
(15),

196 
	mIWL_UCODE_TLV_FLAGS_NEW_NSOFFL_LARGE
 = 
BIT
(16),

197 
	mIWL_UCODE_TLV_FLAGS_UAPSD_SUPPORT
 = 
BIT
(24),

198 
	mIWL_UCODE_TLV_FLAGS_EBS_SUPPORT
 = 
BIT
(25),

199 
	mIWL_UCODE_TLV_FLAGS_P2P_PS_UAPSD
 = 
BIT
(26),

202 
	t__bôwi£
 
	tiwl_ucode_év_≠i_t
;

261 
	eiwl_ucode_év_≠i
 {

263 
	mIWL_UCODE_TLV_API_FRAGMENTED_SCAN
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)8,

264 
	mIWL_UCODE_TLV_API_WIFI_MCC_UPDATE
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)9,

265 
	mIWL_UCODE_TLV_API_LQ_SS_PARAMS
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)18,

266 
	mIWL_UCODE_TLV_API_NEW_VERSION
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)20,

267 
	mIWL_UCODE_TLV_API_SCAN_TSF_REPORT
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)28,

268 
	mIWL_UCODE_TLV_API_TKIP_MIC_KEYS
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)29,

269 
	mIWL_UCODE_TLV_API_STA_TYPE
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)30,

270 
	mIWL_UCODE_TLV_API_NAN2_VER2
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)31,

272 
	mIWL_UCODE_TLV_API_ADAPTIVE_DWELL
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)32,

273 
	mIWL_UCODE_TLV_API_OCE
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)33,

274 
	mIWL_UCODE_TLV_API_NEW_BEACON_TEMPLATE
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)34,

275 
	mIWL_UCODE_TLV_API_NEW_RX_STATS
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)35,

276 
	mIWL_UCODE_TLV_API_WOWLAN_KEY_MATERIAL
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)36,

277 
	mIWL_UCODE_TLV_API_QUOTA_LOW_LATENCY
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)38,

278 
	mIWL_UCODE_TLV_API_DEPRECATE_TTAK
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)41,

279 
	mIWL_UCODE_TLV_API_ADAPTIVE_DWELL_V2
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)42,

280 
	mIWL_UCODE_TLV_API_FRAG_EBS
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)44,

281 
	mIWL_UCODE_TLV_API_REDUCE_TX_POWER
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)45,

282 
	mIWL_UCODE_TLV_API_SHORT_BEACON_NOTIF
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)46,

283 
	mIWL_UCODE_TLV_API_BEACON_FILTER_V4
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)47,

284 
	mIWL_UCODE_TLV_API_REGULATORY_NVM_INFO
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)48,

285 
	mIWL_UCODE_TLV_API_FTM_NEW_RANGE_REQ
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)49,

286 
	mIWL_UCODE_TLV_API_SCAN_OFFLOAD_CHANS
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)50,

287 
	mIWL_UCODE_TLV_API_MBSSID_HE
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)52,

288 
	mIWL_UCODE_TLV_API_WOWLAN_TCP_SYN_WAKE
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)53,

289 
	mIWL_UCODE_TLV_API_FTM_RTT_ACCURACY
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)54,

290 
	mIWL_UCODE_TLV_API_SAR_TABLE_VER
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)55,

291 
	mIWL_UCODE_TLV_API_REDUCED_SCAN_CONFIG
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)56,

292 
	mIWL_UCODE_TLV_API_ADWELL_HB_DEF_N_AP
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)57,

293 
	mIWL_UCODE_TLV_API_SCAN_EXT_CHAN_VER
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)58,

294 
	mIWL_UCODE_TLV_API_BAND_IN_RX_DATA
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)59,

296 
	mIWL_UCODE_TLV_API_NO_HOST_DISABLE_TX
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)66,

297 
	mIWL_UCODE_TLV_API_INT_DBG_BUF_CLEAR
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)67,

298 
	mIWL_UCODE_TLV_API_SMART_FIFO_OFFLOAD
 = (
__f‹˚
 
iwl_ucode_év_≠i_t
)68,

300 
	mNUM_IWL_UCODE_TLV_API


306 #ifde‡
__CHECKER__


307 
	#__CHECKER_NUM_IWL_UCODE_TLV_API
 128

	)

308 (
__f‹˚
 
iwl_ucode_év_≠i_t
)
__CHECKER_NUM_IWL_UCODE_TLV_API
,

309 
	#NUM_IWL_UCODE_TLV_API
 
__CHECKER_NUM_IWL_UCODE_TLV_API


	)

313 
	t__bôwi£
 
	tiwl_ucode_év_ˇ∑_t
;

401 
	eiwl_ucode_év_ˇ∑
 {

403 
	mIWL_UCODE_TLV_CAPA_D0I3_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)0,

404 
	mIWL_UCODE_TLV_CAPA_LAR_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)1,

405 
	mIWL_UCODE_TLV_CAPA_UMAC_SCAN
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)2,

406 
	mIWL_UCODE_TLV_CAPA_BEAMFORMER
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)3,

407 
	mIWL_UCODE_TLV_CAPA_TDLS_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)6,

408 
	mIWL_UCODE_TLV_CAPA_TXPOWER_INSERTION_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)8,

409 
	mIWL_UCODE_TLV_CAPA_DS_PARAM_SET_IE_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)9,

410 
	mIWL_UCODE_TLV_CAPA_WFA_TPC_REP_IE_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)10,

411 
	mIWL_UCODE_TLV_CAPA_QUIET_PERIOD_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)11,

412 
	mIWL_UCODE_TLV_CAPA_DQA_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)12,

413 
	mIWL_UCODE_TLV_CAPA_TDLS_CHANNEL_SWITCH
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)13,

414 
	mIWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)17,

415 
	mIWL_UCODE_TLV_CAPA_HOTSPOT_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)18,

416 
	mIWL_UCODE_TLV_CAPA_CSUM_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)21,

417 
	mIWL_UCODE_TLV_CAPA_RADIO_BEACON_STATS
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)22,

418 
	mIWL_UCODE_TLV_CAPA_P2P_SCM_UAPSD
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)26,

419 
	mIWL_UCODE_TLV_CAPA_BT_COEX_PLCR
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)28,

420 
	mIWL_UCODE_TLV_CAPA_LAR_MULTI_MCC
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)29,

421 
	mIWL_UCODE_TLV_CAPA_BT_COEX_RRC
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)30,

422 
	mIWL_UCODE_TLV_CAPA_GSCAN_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)31,

425 
	mIWL_UCODE_TLV_CAPA_FRAGMENTED_PNVM_IMG
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)32,

426 
	mIWL_UCODE_TLV_CAPA_SOC_LATENCY_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)37,

427 
	mIWL_UCODE_TLV_CAPA_STA_PM_NOTIF
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)38,

428 
	mIWL_UCODE_TLV_CAPA_BINDING_CDB_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)39,

429 
	mIWL_UCODE_TLV_CAPA_CDB_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)40,

430 
	mIWL_UCODE_TLV_CAPA_D0I3_END_FIRST
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)41,

431 
	mIWL_UCODE_TLV_CAPA_TLC_OFFLOAD
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)43,

432 
	mIWL_UCODE_TLV_CAPA_DYNAMIC_QUOTA
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)44,

433 
	mIWL_UCODE_TLV_CAPA_COEX_SCHEMA_2
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)45,

434 
	mIWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)46,

435 
	mIWL_UCODE_TLV_CAPA_FTM_CALIBRATED
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)47,

436 
	mIWL_UCODE_TLV_CAPA_ULTRA_HB_CHANNELS
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)48,

437 
	mIWL_UCODE_TLV_CAPA_CS_MODIFY
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)49,

438 
	mIWL_UCODE_TLV_CAPA_SET_LTR_GEN2
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)50,

439 
	mIWL_UCODE_TLV_CAPA_SET_PPAG
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)52,

440 
	mIWL_UCODE_TLV_CAPA_TAS_CFG
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)53,

441 
	mIWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)54,

442 
	mIWL_UCODE_TLV_CAPA_PROTECTED_TWT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)56,

443 
	mIWL_UCODE_TLV_CAPA_FW_RESET_HANDSHAKE
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)57,

444 
	mIWL_UCODE_TLV_CAPA_PASSIVE_6GHZ_SCAN
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)58,

445 
	mIWL_UCODE_TLV_CAPA_HIDDEN_6GHZ_SCAN
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)59,

446 
	mIWL_UCODE_TLV_CAPA_BROADCAST_TWT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)60,

447 
	mIWL_UCODE_TLV_CAPA_COEX_HIGH_PRIO
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)61,

448 
	mIWL_UCODE_TLV_CAPA_RFIM_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)62,

449 
	mIWL_UCODE_TLV_CAPA_BAID_ML_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)63,

452 
	mIWL_UCODE_TLV_CAPA_EXTENDED_DTS_MEASURE
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)64,

453 
	mIWL_UCODE_TLV_CAPA_SHORT_PM_TIMEOUTS
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)65,

454 
	mIWL_UCODE_TLV_CAPA_BT_MPLUT_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)67,

455 
	mIWL_UCODE_TLV_CAPA_MULTI_QUEUE_RX_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)68,

456 
	mIWL_UCODE_TLV_CAPA_CSA_AND_TBTT_OFFLOAD
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)70,

457 
	mIWL_UCODE_TLV_CAPA_BEACON_ANT_SELECTION
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)71,

458 
	mIWL_UCODE_TLV_CAPA_BEACON_STORING
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)72,

459 
	mIWL_UCODE_TLV_CAPA_LAR_SUPPORT_V3
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)73,

460 
	mIWL_UCODE_TLV_CAPA_CT_KILL_BY_FW
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)74,

461 
	mIWL_UCODE_TLV_CAPA_TEMP_THS_REPORT_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)75,

462 
	mIWL_UCODE_TLV_CAPA_CTDP_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)76,

463 
	mIWL_UCODE_TLV_CAPA_USNIFFER_UNIFIED
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)77,

464 
	mIWL_UCODE_TLV_CAPA_EXTEND_SHARED_MEM_CFG
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)80,

465 
	mIWL_UCODE_TLV_CAPA_LQM_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)81,

466 
	mIWL_UCODE_TLV_CAPA_TX_POWER_ACK
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)84,

467 
	mIWL_UCODE_TLV_CAPA_D3_DEBUG
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)87,

468 
	mIWL_UCODE_TLV_CAPA_LED_CMD_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)88,

469 
	mIWL_UCODE_TLV_CAPA_MCC_UPDATE_11AX_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)89,

470 
	mIWL_UCODE_TLV_CAPA_CSI_REPORTING
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)90,

471 
	mIWL_UCODE_TLV_CAPA_DBG_SUSPEND_RESUME_CMD_SUPP
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)92,

472 
	mIWL_UCODE_TLV_CAPA_DBG_BUF_ALLOC_CMD_SUPP
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)93,

475 
	mIWL_UCODE_TLV_CAPA_MLME_OFFLOAD
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)96,

480 
	mIWL_UCODE_TLV_CAPA_PSC_CHAN_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)98,

482 
	mIWL_UCODE_TLV_CAPA_BIGTK_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)100,

483 
	mIWL_UCODE_TLV_CAPA_SPP_AMSDU_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)103,

484 
	mIWL_UCODE_TLV_CAPA_DRAM_FRAG_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)104,

485 
	mIWL_UCODE_TLV_CAPA_DUMP_COMPLETE_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)105,

486 
	mIWL_UCODE_TLV_CAPA_SYNCED_TIME
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)106,

487 
	mIWL_UCODE_TLV_CAPA_TIME_SYNC_BOTH_FTM_TM
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)108,

488 
	mIWL_UCODE_TLV_CAPA_BIGTK_TX_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)109,

489 
	mIWL_UCODE_TLV_CAPA_MLD_API_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)110,

490 
	mIWL_UCODE_TLV_CAPA_SCAN_DONT_TOGGLE_ANT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)111,

491 
	mIWL_UCODE_TLV_CAPA_PPAG_CHINA_BIOS_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)112,

492 
	mIWL_UCODE_TLV_CAPA_OFFLOAD_BTM_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)113,

493 
	mIWL_UCODE_TLV_CAPA_STA_EXP_MFP_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)114,

494 
	mIWL_UCODE_TLV_CAPA_SNIFF_VALIDATE_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)116,

495 
	mIWL_UCODE_TLV_CAPA_CHINA_22_REG_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)117,

496 
	mIWL_UCODE_TLV_CAPA_SECURE_LTF_SUPPORT
 = (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)121,

497 
	mNUM_IWL_UCODE_TLV_CAPA


503 #ifde‡
__CHECKER__


504 
	#__CHECKER_NUM_IWL_UCODE_TLV_CAPA
 128

	)

505 (
__f‹˚
 
iwl_ucode_év_ˇ∑_t
)
__CHECKER_NUM_IWL_UCODE_TLV_CAPA
,

506 
	#NUM_IWL_UCODE_TLV_CAPA
 
__CHECKER_NUM_IWL_UCODE_TLV_CAPA


	)

511 
	#IWL_DEFAULT_STANDARD_PHY_CALIBRATE_TBL_SIZE
 18

	)

512 
	#IWL_MAX_STANDARD_PHY_CALIBRATE_TBL_SIZE
 19

	)

513 
	#IWL_MAX_PHY_CALIBRATE_TBL_SIZE
 253

	)

516 
	#IWL_DEFAULT_MAX_PROBE_LENGTH
 200

	)

522 
	#CPU1_CPU2_SEPARATOR_SECTION
 0xFFFFCCCC

	)

523 
	#PAGING_SEPARATOR_SECTION
 0xAAAABBBB

	)

526 
	#IWL_UCODE_MAJOR
(
vî
Ë(((vîË& 0xFF000000Ë>> 24)

	)

527 
	#IWL_UCODE_MINOR
(
vî
Ë(((vîË& 0x00FF0000Ë>> 16)

	)

528 
	#IWL_UCODE_API
(
vî
Ë(((vîË& 0x0000FF00Ë>> 8)

	)

529 
	#IWL_UCODE_SERIAL
(
vî
Ë((vîË& 0x000000FF)

	)

539 
	siwl_év_ˇlib_˘æ
 {

540 
__À32
 
	mÊow_åiggî
;

541 
__À32
 
	mevít_åiggî
;

542 } 
	g__∑cked
;

544 
	eiwl_fw_phy_cfg
 {

545 
	mFW_PHY_CFG_RADIO_TYPE_POS
 = 0,

546 
	mFW_PHY_CFG_RADIO_TYPE
 = 0x3 << 
FW_PHY_CFG_RADIO_TYPE_POS
,

547 
	mFW_PHY_CFG_RADIO_STEP_POS
 = 2,

548 
	mFW_PHY_CFG_RADIO_STEP
 = 0x3 << 
FW_PHY_CFG_RADIO_STEP_POS
,

549 
	mFW_PHY_CFG_RADIO_DASH_POS
 = 4,

550 
	mFW_PHY_CFG_RADIO_DASH
 = 0x3 << 
FW_PHY_CFG_RADIO_DASH_POS
,

551 
	mFW_PHY_CFG_TX_CHAIN_POS
 = 16,

552 
	mFW_PHY_CFG_TX_CHAIN
 = 0x‡<< 
FW_PHY_CFG_TX_CHAIN_POS
,

553 
	mFW_PHY_CFG_RX_CHAIN_POS
 = 20,

554 
	mFW_PHY_CFG_RX_CHAIN
 = 0x‡<< 
FW_PHY_CFG_RX_CHAIN_POS
,

555 
	mFW_PHY_CFG_CHAIN_SAD_POS
 = 23,

556 
	mFW_PHY_CFG_CHAIN_SAD_ENABLED
 = 0x1 << 
FW_PHY_CFG_CHAIN_SAD_POS
,

557 
	mFW_PHY_CFG_CHAIN_SAD_ANT_A
 = 0x2 << 
FW_PHY_CFG_CHAIN_SAD_POS
,

558 
	mFW_PHY_CFG_CHAIN_SAD_ANT_B
 = 0x4 << 
FW_PHY_CFG_CHAIN_SAD_POS
,

559 
	mFW_PHY_CFG_SHARED_CLK
 = 
BIT
(31),

562 
	eiwl_fw_dbg_ªg_›î©‹
 {

563 
	mCSR_ASSIGN
,

564 
	mCSR_SETBIT
,

565 
	mCSR_CLEARBIT
,

567 
	mPRPH_ASSIGN
,

568 
	mPRPH_SETBIT
,

569 
	mPRPH_CLEARBIT
,

571 
	mINDIRECT_ASSIGN
,

572 
	mINDIRECT_SETBIT
,

573 
	mINDIRECT_CLEARBIT
,

575 
	mPRPH_BLOCKBIT
,

586 
	siwl_fw_dbg_ªg_›
 {

587 
u8
 
	m›
;

588 
u8
 
	mª£rved
[3];

589 
__À32
 
	maddr
;

590 
__À32
 
	mvÆ
;

591 } 
	g__∑cked
;

601 
	eiwl_fw_dbg_m⁄ô‹_mode
 {

602 
	mSMEM_MODE
 = 0,

603 
	mEXTERNAL_MODE
 = 1,

604 
	mMARBH_MODE
 = 2,

605 
	mMIPI_MODE
 = 3,

617 
	siwl_fw_dbg_mem_£g_év
 {

618 
__À32
 
	md©a_ty≥
;

619 
__À32
 
	mofs
;

620 
__À32
 
	mÀn
;

621 } 
	g__∑cked
;

640 
	siwl_fw_dbg_de°_év_v1
 {

641 
u8
 
	mvîsi⁄
;

642 
u8
 
	mm⁄ô‹_mode
;

643 
u8
 
	msize_powî
;

644 
u8
 
	mª£rved
;

645 
__À32
 
	mba£_ªg
;

646 
__À32
 
	míd_ªg
;

647 
__À32
 
	mwrôe_±r_ªg
;

648 
__À32
 
	mwøp_cou¡
;

649 
u8
 
	mba£_shi·
;

650 
u8
 
	míd_shi·
;

651 
iwl_fw_dbg_ªg_›
 
	mªg_›s
[];

652 } 
	g__∑cked
;

655 
	#IWL_LDBG_M2S_BUF_SIZE_MSK
 0x0fff0000

	)

657 
	#IWL_LDBG_M2S_BUF_BA_MSK
 0x00000fff

	)

659 
	#IWL_M2S_UNIT_SIZE
 0x100

	)

661 
	siwl_fw_dbg_de°_év
 {

662 
u8
 
	mvîsi⁄
;

663 
u8
 
	mm⁄ô‹_mode
;

664 
u8
 
	msize_powî
;

665 
u8
 
	mª£rved
;

666 
__À32
 
	mcfg_ªg
;

667 
__À32
 
	mwrôe_±r_ªg
;

668 
__À32
 
	mwøp_cou¡
;

669 
u8
 
	mba£_shi·
;

670 
u8
 
	msize_shi·
;

671 
iwl_fw_dbg_ªg_›
 
	mªg_›s
[];

672 } 
	g__∑cked
;

674 
	siwl_fw_dbg_c⁄f_hcmd
 {

675 
u8
 
	mid
;

676 
u8
 
	mª£rved
;

677 
__À16
 
	mÀn
;

678 
u8
 
	md©a
[];

679 } 
	g__∑cked
;

689 
	eiwl_fw_dbg_åiggî_mode
 {

690 
	mIWL_FW_DBG_TRIGGER_START
 = 
BIT
(0),

691 
	mIWL_FW_DBG_TRIGGER_STOP
 = 
BIT
(1),

692 
	mIWL_FW_DBG_TRIGGER_MONITOR_ONLY
 = 
BIT
(2),

699 
	eiwl_fw_dbg_åiggî_Êags
 {

700 
	mIWL_FW_DBG_FORCE_RESTART
 = 
BIT
(0),

713 
	eiwl_fw_dbg_åiggî_vif_ty≥
 {

714 
	mIWL_FW_DBG_CONF_VIF_ANY
 = 
NL80211_IFTYPE_UNSPECIFIED
,

715 
	mIWL_FW_DBG_CONF_VIF_IBSS
 = 
NL80211_IFTYPE_ADHOC
,

716 
	mIWL_FW_DBG_CONF_VIF_STATION
 = 
NL80211_IFTYPE_STATION
,

717 
	mIWL_FW_DBG_CONF_VIF_AP
 = 
NL80211_IFTYPE_AP
,

718 
	mIWL_FW_DBG_CONF_VIF_P2P_CLIENT
 = 
NL80211_IFTYPE_P2P_CLIENT
,

719 
	mIWL_FW_DBG_CONF_VIF_P2P_GO
 = 
NL80211_IFTYPE_P2P_GO
,

720 
	mIWL_FW_DBG_CONF_VIF_P2P_DEVICE
 = 
NL80211_IFTYPE_P2P_DEVICE
,

743 
	siwl_fw_dbg_åiggî_év
 {

744 
__À32
 
	mid
;

745 
__À32
 
	mvif_ty≥
;

746 
__À32
 
	m°›_c⁄f_ids
;

747 
__À32
 
	m°›_dñay
;

748 
u8
 
	mmode
;

749 
u8
 
	m°¨t_c⁄f_id
;

750 
__À16
 
	moccuºí˚s
;

751 
__À16
 
	måig_dis_ms
;

752 
u8
 
	mÊags
;

753 
u8
 
	mª£rved
[5];

755 
u8
 
	md©a
[];

756 } 
	g__∑cked
;

758 
	#FW_DBG_START_FROM_ALIVE
 0

	)

759 
	#FW_DBG_CONF_MAX
 32

	)

760 
	#FW_DBG_INVALID
 0xff

	)

771 
	siwl_fw_dbg_åiggî_mis£d_bc⁄
 {

772 
__À32
 
	m°›_c⁄£c_mis£d_bc⁄
;

773 
__À32
 
	m°›_c⁄£c_mis£d_bc⁄_sö˚_rx
;

774 
__À32
 
	mª£rved2
[2];

775 
__À32
 
	m°¨t_c⁄£c_mis£d_bc⁄
;

776 
__À32
 
	m°¨t_c⁄£c_mis£d_bc⁄_sö˚_rx
;

777 
__À32
 
	mª£rved1
[2];

778 } 
	g__∑cked
;

784 
	siwl_fw_dbg_åiggî_cmd
 {

785 
	scmd
 {

786 
u8
 
	mcmd_id
;

787 
u8
 
	mgroup_id
;

788 } 
__∑cked
 
	mcmds
[16];

789 } 
	g__∑cked
;

798 
	siwl_fw_dbg_åiggî_°©s
 {

799 
__À32
 
	m°›_off£t
;

800 
__À32
 
	m°›_thªshﬁd
;

801 
__À32
 
	m°¨t_off£t
;

802 
__À32
 
	m°¨t_thªshﬁd
;

803 } 
	g__∑cked
;

809 
	siwl_fw_dbg_åiggî_low_rssi
 {

810 
__À32
 
	mrssi
;

811 } 
	g__∑cked
;

830 
	siwl_fw_dbg_åiggî_mlme
 {

831 
u8
 
	m°›_auth_díõd
;

832 
u8
 
	m°›_auth_timeout
;

833 
u8
 
	m°›_rx_dóuth
;

834 
u8
 
	m°›_tx_dóuth
;

836 
u8
 
	m°›_assoc_díõd
;

837 
u8
 
	m°›_assoc_timeout
;

838 
u8
 
	m°›_c⁄√˘i⁄_loss
;

839 
u8
 
	mª£rved
;

841 
u8
 
	m°¨t_auth_díõd
;

842 
u8
 
	m°¨t_auth_timeout
;

843 
u8
 
	m°¨t_rx_dóuth
;

844 
u8
 
	m°¨t_tx_dóuth
;

846 
u8
 
	m°¨t_assoc_díõd
;

847 
u8
 
	m°¨t_assoc_timeout
;

848 
u8
 
	m°¨t_c⁄√˘i⁄_loss
;

849 
u8
 
	mª£rved2
;

850 } 
	g__∑cked
;

863 
	siwl_fw_dbg_åiggî_txq_timî
 {

864 
__À32
 
	mcomm™d_queue
;

865 
__À32
 
	mbss
;

866 
__À32
 
	mso·≠
;

867 
__À32
 
	mp2p_go
;

868 
__À32
 
	mp2p_˛õ¡
;

869 
__À32
 
	mp2p_devi˚
;

870 
__À32
 
	mibss
;

871 
__À32
 
	mtdls
;

872 
__À32
 
	mª£rved
[4];

873 } 
	g__∑cked
;

883 
	siwl_fw_dbg_åiggî_time_evít
 {

885 
__À32
 
	mid
;

886 
__À32
 
	ma˘i⁄_bôm≠
;

887 
__À32
 
	m°©us_bôm≠
;

888 } 
__∑cked
 
	mtime_evíts
[16];

889 } 
	g__∑cked
;

908 
	siwl_fw_dbg_åiggî_ba
 {

909 
__À16
 
	mrx_ba_°¨t
;

910 
__À16
 
	mrx_ba_°›
;

911 
__À16
 
	mtx_ba_°¨t
;

912 
__À16
 
	mtx_ba_°›
;

913 
__À16
 
	mrx_b¨
;

914 
__À16
 
	mtx_b¨
;

915 
__À16
 
	m‰ame_timeout
;

916 } 
	g__∑cked
;

924 
	siwl_fw_dbg_åiggî_tdls
 {

925 
u8
 
	ma˘i⁄_bôm≠
;

926 
u8
 
	m≥î_mode
;

927 
u8
 
	m≥î
[
ETH_ALEN
];

928 
u8
 
	mª£rved
[4];

929 } 
	g__∑cked
;

936 
	siwl_fw_dbg_åiggî_tx_°©us
 {

937 
	stx_°©us
 {

938 
u8
 
	m°©us
;

939 
u8
 
	mª£rved
[3];

940 } 
__∑cked
 
	m°©u£s
[16];

941 
__À32
 
	mª£rved
[2];

942 } 
	g__∑cked
;

955 
	siwl_fw_dbg_c⁄f_év
 {

956 
u8
 
	mid
;

957 
u8
 
	mu¢if„r
;

958 
u8
 
	mª£rved
;

959 
u8
 
	mnum_of_hcmds
;

960 
iwl_fw_dbg_c⁄f_hcmd
 
	mhcmd
;

961 } 
	g__∑cked
;

963 
	#IWL_FW_CMD_VER_UNKNOWN
 99

	)

972 
	siwl_fw_cmd_vîsi⁄
 {

973 
u8
 
	mcmd
;

974 
u8
 
	mgroup
;

975 
u8
 
	mcmd_vî
;

976 
u8
 
	mnŸif_vî
;

977 } 
	g__∑cked
;

979 
	siwl_fw_tcm_îr‹_addr
 {

980 
__À32
 
	maddr
;

983 
	siwl_fw_dump_ex˛ude
 {

984 
__À32
 
	maddr
, 
	msize
;

987 
ölöe
 
size_t
 
	$_iwl_év_¨øy_Àn
(c⁄° 
iwl_ucode_év
 *
év
,

988 
size_t
 
fixed_size
, size_à
v¨_size
)

990 
size_t
 
v¨_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
Ë- 
fixed_size
;

992 i‡(
	`WARN_ON
(
v¨_Àn
 % 
v¨_size
))

995  
v¨_Àn
 / 
v¨_size
;

996 
	}
}

998 
	#iwl_év_¨øy_Àn
(
_év_±r
, 
_°ru˘_±r
, 
_memb
) \

999 
	`_iwl_év_¨øy_Àn
((
_év_±r
), (*(
_°ru˘_±r
)), \

1000 (
_°ru˘_±r
->
_memb
[0]))

	)

1002 
	#iwl_év_¨øy_Àn_wôh_size
(
_év_±r
, 
_°ru˘_±r
, 
_size
) \

1003 
	`_iwl_év_¨øy_Àn
((
_év_±r
), (*(
_°ru˘_±r
)), 
_size
)

	)

	@fw/img.c

5 
	~<fw/≠i/comm™ds.h
>

6 
	~"img.h
"

8 
u8
 
	$iwl_fw_lookup_cmd_vî
(c⁄° 
iwl_fw
 *
fw
, 
u32
 
cmd_id
, 
u8
 
def
)

10 c⁄° 
iwl_fw_cmd_vîsi⁄
 *
íåy
;

11 
i
;

13 
u8
 
gΩ
 = 
	`iwl_cmd_groupid
(
cmd_id
Ë?: 
LONG_GROUP
;

14 
u8
 
cmd
 = 
	`iwl_cmd_›code
(
cmd_id
);

16 i‡(!
fw
->
ucode_ˇ∑
.
cmd_vîsi⁄s
 ||

17 !
fw
->
ucode_ˇ∑
.
n_cmd_vîsi⁄s
)

18  
def
;

20 
íåy
 = 
fw
->
ucode_ˇ∑
.
cmd_vîsi⁄s
;

21 
i
 = 0; i < 
fw
->
ucode_ˇ∑
.
n_cmd_vîsi⁄s
; i++, 
íåy
++) {

22 i‡(
íåy
->
group
 =
gΩ
 &&É¡ry->
cmd
 == cmd) {

23 i‡(
íåy
->
cmd_vî
 =
IWL_FW_CMD_VER_UNKNOWN
)

24  
def
;

25  
íåy
->
cmd_vî
;

29  
def
;

30 
	}
}

31 
EXPORT_SYMBOL_GPL
(
iwl_fw_lookup_cmd_vî
);

33 
u8
 
	$iwl_fw_lookup_nŸif_vî
(c⁄° 
iwl_fw
 *
fw
, 
u8
 
gΩ
, u8 
cmd
, u8 
def
)

35 c⁄° 
iwl_fw_cmd_vîsi⁄
 *
íåy
;

36 
i
;

38 i‡(!
fw
->
ucode_ˇ∑
.
cmd_vîsi⁄s
 ||

39 !
fw
->
ucode_ˇ∑
.
n_cmd_vîsi⁄s
)

40  
def
;

42 
íåy
 = 
fw
->
ucode_ˇ∑
.
cmd_vîsi⁄s
;

43 
i
 = 0; i < 
fw
->
ucode_ˇ∑
.
n_cmd_vîsi⁄s
; i++, 
íåy
++) {

44 i‡(
íåy
->
group
 =
gΩ
 &&É¡ry->
cmd
 == cmd) {

45 i‡(
íåy
->
nŸif_vî
 =
IWL_FW_CMD_VER_UNKNOWN
)

46  
def
;

47  
íåy
->
nŸif_vî
;

51  
def
;

52 
	}
}

53 
EXPORT_SYMBOL_GPL
(
iwl_fw_lookup_nŸif_vî
);

56 c⁄° *
	m«me
;

57 
u32
 
	mnum
;

58 } 
	gadv™˚d_lookup
[] = {

78 { "PNVM_MISSING", 
FW_SYSASSERT_PNVM_MISSING
 },

82 c⁄° *
	$iwl_fw_lookup_as£π_desc
(
u32
 
num
)

84 
i
;

86 
i
 = 0; i < 
	`ARRAY_SIZE
(
adv™˚d_lookup
) - 1; i++)

87 i‡(
adv™˚d_lookup
[
i
].
num
 =“um & ~
FW_SYSASSERT_CPU_MASK
))

88  
adv™˚d_lookup
[
i
].
«me
;

91  
adv™˚d_lookup
[
i
].
«me
;

92 
	}
}

93 
EXPORT_SYMBOL_GPL
(
iwl_fw_lookup_as£π_desc
);

	@fw/img.h

7 #i‚de‡
__iwl_fw_img_h__


8 
	#__iwl_fw_img_h__


	)

9 
	~<löux/ty≥s.h
>

11 
	~"≠i/dbg-év.h
"

13 
	~"fûe.h
"

14 
	~"îr‹-dump.h
"

26 
	eiwl_ucode_ty≥
 {

27 
	mIWL_UCODE_REGULAR
,

28 
	mIWL_UCODE_INIT
,

29 
	mIWL_UCODE_WOWLAN
,

30 
	mIWL_UCODE_REGULAR_USNIFFER
,

31 
	mIWL_UCODE_TYPE_MAX
,

41 
	eiwl_ucode_£c
 {

42 
	mIWL_UCODE_SECTION_DATA
,

43 
	mIWL_UCODE_SECTION_INST
,

46 
	siwl_ucode_ˇ∑bûôõs
 {

47 
u32
 
	mmax_¥obe_Àngth
;

48 
u32
 
	mn_sˇn_ch™√ls
;

49 
u32
 
	m°™d¨d_phy_ˇlibøti⁄_size
;

50 
u32
 
	mÊags
;

51 
u32
 
	mîr‹_log_addr
;

52 
u32
 
	mîr‹_log_size
;

53 
u32
 
	mnum_°©i⁄s
;

54 
u32
 
	mnum_bóc⁄s
;

55 
	m_≠i
[
BITS_TO_LONGS
(
NUM_IWL_UCODE_TLV_API
)];

56 
	m_ˇ∑
[
BITS_TO_LONGS
(
NUM_IWL_UCODE_TLV_CAPA
)];

58 c⁄° 
iwl_fw_cmd_vîsi⁄
 *
	mcmd_vîsi⁄s
;

59 
u32
 
	mn_cmd_vîsi⁄s
;

62 
ölöe
 
boﬁ


63 
	$fw_has_≠i
(c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑bûôõs
,

64 
iwl_ucode_év_≠i_t
 
≠i
)

66  
	`ã°_bô
((
__f‹˚
 )
≠i
, 
ˇ∑bûôõs
->
_≠i
);

67 
	}
}

69 
ölöe
 
boﬁ


70 
	$fw_has_ˇ∑
(c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑bûôõs
,

71 
iwl_ucode_év_ˇ∑_t
 
ˇ∑
)

73  
	`ã°_bô
((
__f‹˚
 )
ˇ∑
, 
ˇ∑bûôõs
->
_ˇ∑
);

74 
	}
}

77 
	sfw_desc
 {

78 c⁄° *
	md©a
;

79 
u32
 
	mÀn
;

80 
u32
 
	moff£t
;

83 
	sfw_img
 {

84 
fw_desc
 *
	m£c
;

85 
	mnum_£c
;

86 
boﬁ
 
	mis_duÆ_˝us
;

87 
u32
 
	m∑gög_mem_size
;

93 
	#PAGE_2_EXP_SIZE
 12

	)

94 
	#FW_PAGING_SIZE
 
	`BIT
(
PAGE_2_EXP_SIZE
Ë

	)

95 
	#PAGE_PER_GROUP_2_EXP_SIZE
 3

	)

97 
	#NUM_OF_PAGE_PER_GROUP
 
	`BIT
(
PAGE_PER_GROUP_2_EXP_SIZE
)

	)

99 
	#PAGING_BLOCK_SIZE
 (
NUM_OF_PAGE_PER_GROUP
 * 
FW_PAGING_SIZE
)

	)

101 
	#BLOCK_2_EXP_SIZE
 (
PAGE_2_EXP_SIZE
 + 
PAGE_PER_GROUP_2_EXP_SIZE
)

	)

106 
	#BLOCK_PER_IMAGE_2_EXP_SIZE
 5

	)

108 
	#NUM_OF_BLOCK_PER_IMAGE
 
	`BIT
(
BLOCK_PER_IMAGE_2_EXP_SIZE
)

	)

110 
	#MAX_PAGING_IMAGE_SIZE
 (
NUM_OF_BLOCK_PER_IMAGE
 * 
PAGING_BLOCK_SIZE
)

	)

113 
	#PAGING_ADDR_SIG
 0xAA000000

	)

115 
	#PAGING_CMD_IS_SECURED
 
	`BIT
(9)

	)

116 
	#PAGING_CMD_IS_ENABLED
 
	`BIT
(8)

	)

117 
	#PAGING_CMD_NUM_OF_PAGES_IN_LAST_GRP_POS
 0

	)

118 
	#PAGING_TLV_SECURE_MASK
 1

	)

121 
	#FW_ADDR_CACHE_CONTROL
 0xC0000000UL

	)

130 
	siwl_fw_∑gög
 {

131 
dma_addr_t
 
	mfw_∑gög_phys
;

132 
∑ge
 *
	mfw_∑gög_block
;

133 
u32
 
	mfw_∑gög_size
;

134 
u32
 
	mfw_offs
;

142 
	eiwl_fw_ty≥
 {

143 
	mIWL_FW_DVM
,

144 
	mIWL_FW_MVM
,

159 
	siwl_fw_dbg
 {

160 
iwl_fw_dbg_de°_év_v1
 *
	mde°_év
;

161 
u8
 
	mn_de°_ªg
;

162 
iwl_fw_dbg_c⁄f_év
 *
	mc⁄f_év
[
FW_DBG_CONF_MAX
];

163 
iwl_fw_dbg_åiggî_év
 *
	måiggî_év
[
FW_DBG_TRIGGER_MAX
];

164 
size_t
 
	måiggî_év_Àn
[
FW_DBG_TRIGGER_MAX
];

165 
iwl_fw_dbg_mem_£g_év
 *
	mmem_év
;

166 
size_t
 
	mn_mem_év
;

167 
u32
 
	mdump_mask
;

170 
	siwl_dump_ex˛ude
 {

171 
u32
 
	maddr
, 
	msize
;

198 
	siwl_fw
 {

199 
u32
 
	mucode_vî
;

201 
	mfw_vîsi⁄
[128];

204 
fw_img
 
	mimg
[
IWL_UCODE_TYPE_MAX
];

205 
size_t
 
	miml_Àn
;

206 
u8
 *
	miml
;

208 
iwl_ucode_ˇ∑bûôõs
 
	mucode_ˇ∑
;

209 
boﬁ
 
	míh™˚_£nsôivôy_èbÀ
;

211 
u32
 
	möô_evéog_±r
, 
	möô_evéog_size
, 
	möô_îæog_±r
;

212 
u32
 
	mö°_evéog_±r
, 
	mö°_evéog_size
, 
	mö°_îæog_±r
;

214 
iwl_év_ˇlib_˘æ
 
	mdeÁu…_ˇlib
[
IWL_UCODE_TYPE_MAX
];

215 
u32
 
	mphy_c⁄fig
;

216 
u8
 
	mvÆid_tx_™t
;

217 
u8
 
	mvÆid_rx_™t
;

219 
iwl_fw_ty≥
 
	mty≥
;

221 
u8
 
	mhum™_ªadabÀ
[
FW_VER_HUMAN_READABLE_SZ
];

223 
iwl_fw_dbg
 
	mdbg
;

225 
u8
 *
	mphy_öãgøti⁄_vî
;

226 
u32
 
	mphy_öãgøti⁄_vî_Àn
;

228 
iwl_dump_ex˛ude
 
	mdump_ex˛
[2], 
	mdump_ex˛_wowœn
[2];

231 
ölöe
 c⁄° *
	$gë_fw_dbg_mode_°rög
(
mode
)

233 
mode
) {

234 
SMEM_MODE
:

236 
EXTERNAL_MODE
:

238 
MARBH_MODE
:

240 
MIPI_MODE
:

245 
	}
}

247 
ölöe
 
boﬁ


248 
	$iwl_fw_dbg_c⁄f_u¢if„r
(c⁄° 
iwl_fw
 *
fw
, 
u8
 
id
)

250 c⁄° 
iwl_fw_dbg_c⁄f_év
 *
c⁄f_év
 = 
fw
->
dbg
.c⁄f_év[
id
];

252 i‡(!
c⁄f_év
)

253  
Ál£
;

255  
c⁄f_év
->
u¢if„r
;

256 
	}
}

258 
ölöe
 c⁄° 
fw_img
 *

259 
	$iwl_gë_ucode_image
(c⁄° 
iwl_fw
 *
fw
, 
iwl_ucode_ty≥
 
ucode_ty≥
)

261 i‡(
ucode_ty≥
 >
IWL_UCODE_TYPE_MAX
)

262  
NULL
;

264  &
fw
->
img
[
ucode_ty≥
];

265 
	}
}

267 
u8
 
iwl_fw_lookup_cmd_vî
(c⁄° 
iwl_fw
 *
fw
, 
u32
 
cmd_id
, u8 
def
);

269 
u8
 
iwl_fw_lookup_nŸif_vî
(c⁄° 
iwl_fw
 *
fw
, u8 
gΩ
, u8 
cmd
, u8 
def
);

270 c⁄° *
iwl_fw_lookup_as£π_desc
(
u32
 
num
);

272 
	#FW_SYSASSERT_CPU_MASK
 0xf0000000

	)

273 
	#FW_SYSASSERT_PNVM_MISSING
 0x0010070d

	)

	@fw/init.c

6 
	~"iwl-drv.h
"

7 
	~"ru¡ime.h
"

8 
	~"dbg.h
"

9 
	~"debugfs.h
"

11 
	~"fw/≠i/sy°em.h
"

12 
	~"fw/≠i/comm™ds.h
"

13 
	~"fw/≠i/rx.h
"

14 
	~"fw/≠i/d©≠©h.h
"

16 
	$iwl_fw_ru¡ime_öô
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_å™s
 *
å™s
,

17 c⁄° 
iwl_fw
 *
fw
,

18 c⁄° 
iwl_fw_ru¡ime_›s
 *
›s
, *
›s_˘x
,

19 c⁄° 
iwl_dump_ßnôize_›s
 *
ßnôize_›s
,

20 *
ßnôize_˘x
,

21 
díåy
 *
dbgfs_dú
)

23 
i
;

25 
	`mem£t
(
fwπ
, 0, (*fwrt));

26 
fwπ
->
å™s
 =Årans;

27 
fwπ
->
fw
 = fw;

28 
fwπ
->
dev
 = 
å™s
->dev;

29 
fwπ
->
dump
.
c⁄f
 = 
FW_DBG_INVALID
;

30 
fwπ
->
›s
 = ops;

31 
fwπ
->
ßnôize_›s
 = sanitize_ops;

32 
fwπ
->
ßnôize_˘x
 = sanitize_ctx;

33 
fwπ
->
›s_˘x
 = ops_ctx;

34 
i
 = 0; i < 
IWL_FW_RUNTIME_DUMP_WK_NUM
; i++) {

35 
fwπ
->
dump
.
wks
[
i
].
idx
 = i;

36 
	`INIT_DELAYED_WORK
(&
fwπ
->
dump
.
wks
[
i
].
wk
, 
iwl_fw_îr‹_dump_wk
);

38 
	`iwl_fwπ_dbgfs_ªgi°î
(
fwπ
, 
dbgfs_dú
);

39 
	}
}

40 
IWL_EXPORT_SYMBOL
(
iwl_fw_ru¡ime_öô
);

42 
	$iwl_fw_ru¡ime_su•íd
(
iwl_fw_ru¡ime
 *
fwπ
)

44 
	`iwl_fw_su•íd_time°amp
(
fwπ
);

45 
	`iwl_dbg_év_time_poöt
(
fwπ
, 
IWL_FW_INI_TIME_POINT_HOST_D3_START
, 
NULL
);

46 
	}
}

47 
IWL_EXPORT_SYMBOL
(
iwl_fw_ru¡ime_su•íd
);

49 
	$iwl_fw_ru¡ime_ªsume
(
iwl_fw_ru¡ime
 *
fwπ
)

51 
	`iwl_dbg_év_time_poöt
(
fwπ
, 
IWL_FW_INI_TIME_POINT_HOST_D3_END
, 
NULL
);

52 
	`iwl_fw_ªsume_time°amp
(
fwπ
);

53 
	}
}

54 
IWL_EXPORT_SYMBOL
(
iwl_fw_ru¡ime_ªsume
);

57 
	$iwl_£t_soc_œãncy
(
iwl_fw_ru¡ime
 *
fwπ
)

59 
iwl_soc_c⁄figuøti⁄_cmd
 
cmd
 = {};

60 
iwl_ho°_cmd
 
hcmd
 = {

61 .
id
 = 
	`WIDE_ID
(
SYSTEM_GROUP
, 
SOC_CONFIGURATION_CMD
),

62 .
d©a
[0] = &
cmd
,

63 .
Àn
[0] = (
cmd
),

65 
ªt
;

73 i‡(!
fwπ
->
å™s
->
å™s_cfg
->
öãgøãd
)

74 
cmd
.
Êags
 = 
	`˝u_to_À32
(
SOC_CONFIG_CMD_FLAGS_DISCRETE
);

76 
	`BUILD_BUG_ON
(
IWL_CFG_TRANS_LTR_DELAY_NONE
 !=

77 
SOC_FLAGS_LTR_APPLY_DELAY_NONE
);

78 
	`BUILD_BUG_ON
(
IWL_CFG_TRANS_LTR_DELAY_200US
 !=

79 
SOC_FLAGS_LTR_APPLY_DELAY_200
);

80 
	`BUILD_BUG_ON
(
IWL_CFG_TRANS_LTR_DELAY_2500US
 !=

81 
SOC_FLAGS_LTR_APPLY_DELAY_2500
);

82 
	`BUILD_BUG_ON
(
IWL_CFG_TRANS_LTR_DELAY_1820US
 !=

83 
SOC_FLAGS_LTR_APPLY_DELAY_1820
);

85 i‡(
fwπ
->
å™s
->
å™s_cfg
->
…r_dñay
 !
IWL_CFG_TRANS_LTR_DELAY_NONE
 &&

86 !
	`WARN_ON
(!
fwπ
->
å™s
->
å™s_cfg
->
öãgøãd
))

87 
cmd
.
Êags
 |
	`À32_ícode_bôs
(
fwπ
->
å™s
->
å™s_cfg
->
…r_dñay
,

88 
SOC_FLAGS_LTR_APPLY_DELAY_MASK
);

90 i‡(
	`iwl_fw_lookup_cmd_vî
(
fwπ
->
fw
, 
SCAN_REQ_UMAC
,

91 
IWL_FW_CMD_VER_UNKNOWN
) >= 2 &&

92 
fwπ
->
å™s
->
å™s_cfg
->
low_œãncy_xèl
)

93 
cmd
.
Êags
 |
	`˝u_to_À32
(
SOC_CONFIG_CMD_FLAGS_LOW_LATENCY
);

95 
cmd
.
œãncy
 = 
	`˝u_to_À32
(
fwπ
->
å™s
->
å™s_cfg
->
xèl_œãncy
);

97 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

98 i‡(
ªt
)

99 
	`IWL_ERR
(
fwπ
, "FaûedÅÿ£àso¯œãncy: %d\n", 
ªt
);

100  
ªt
;

101 
	}
}

102 
IWL_EXPORT_SYMBOL
(
iwl_£t_soc_œãncy
);

104 
	$iwl_c⁄figuª_rxq
(
iwl_fw_ru¡ime
 *
fwπ
)

106 
i
, 
num_queues
, 
size
, 
ªt
;

107 
iwl_rfh_queue_c⁄fig
 *
cmd
;

108 
iwl_ho°_cmd
 
hcmd
 = {

109 .
id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
RFH_QUEUE_CONFIG_CMD
),

110 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

117 i‡(
fwπ
->
å™s
->
num_rx_queues
 == 1)

120 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_22000
)

124 
num_queues
 = 
fwπ
->
å™s
->
num_rx_queues
 - 1;

126 
size
 = 
	`°ru˘_size
(
cmd
, 
d©a
, 
num_queues
);

128 
cmd
 = 
	`kzÆloc
(
size
, 
GFP_KERNEL
);

129 i‡(!
cmd
)

130  -
ENOMEM
;

132 
cmd
->
num_queues
 =Çum_queues;

134 
i
 = 0; i < 
num_queues
; i++) {

135 
iwl_å™s_rxq_dma_d©a
 
d©a
;

137 
cmd
->
d©a
[
i
].
q_num
 = i + 1;

138 
	`iwl_å™s_gë_rxq_dma_d©a
(
fwπ
->
å™s
, 
i
 + 1, &
d©a
);

140 
cmd
->
d©a
[
i
].
‰_bd_cb
 = 
	`˝u_to_À64
(data.fr_bd_cb);

141 
cmd
->
d©a
[
i
].
urbd_°ts_wΩå
 =

142 
	`˝u_to_À64
(
d©a
.
urbd_°ts_wΩå
);

143 
cmd
->
d©a
[
i
].
ur_bd_cb
 = 
	`˝u_to_À64
(data.ur_bd_cb);

144 
cmd
->
d©a
[
i
].
‰_bd_wid
 = 
	`˝u_to_À32
(data.fr_bd_wid);

147 
hcmd
.
d©a
[0] = 
cmd
;

148 
hcmd
.
Àn
[0] = 
size
;

150 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

152 
	`k‰ì
(
cmd
);

154 i‡(
ªt
)

155 
	`IWL_ERR
(
fwπ
, "FaûedÅÿc⁄figuª RX queues: %d\n", 
ªt
);

157  
ªt
;

158 
	}
}

159 
IWL_EXPORT_SYMBOL
(
iwl_c⁄figuª_rxq
);

	@fw/notif-wait.c

6 
	~<löux/sched.h
>

7 
	~<löux/exp‹t.h
>

9 
	~"iwl-drv.h
"

10 
	~"nŸif-waô.h
"

13 
	$iwl_nŸifiˇti⁄_waô_öô
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
)

15 
	`•ö_lock_öô
(&
nŸif_waô
->
nŸif_waô_lock
);

16 
	`INIT_LIST_HEAD
(&
nŸif_waô
->
nŸif_waôs
);

17 
	`öô_waôqueue_hód
(&
nŸif_waô
->
nŸif_waôq
);

18 
	}
}

19 
IWL_EXPORT_SYMBOL
(
iwl_nŸifiˇti⁄_waô_öô
);

21 
boﬁ
 
	$iwl_nŸifiˇti⁄_waô
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

22 
iwl_rx_∑ckë
 *
pkt
)

24 
boﬁ
 
åiggîed
 = 
Ál£
;

26 i‡(!
	`li°_em±y
(&
nŸif_waô
->
nŸif_waôs
)) {

27 
iwl_nŸifiˇti⁄_waô
 *
w
;

29 
	`•ö_lock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

30 
	`li°_f‹_óch_íåy
(
w
, &
nŸif_waô
->
nŸif_waôs
, 
li°
) {

31 
i
;

32 
boﬁ
 
found
 = 
Ál£
;

40 i‡(
w
->
åiggîed
 || w->
ab‹ãd
)

43 
i
 = 0; i < 
w
->
n_cmds
; i++) {

44 
u16
 
ªc_id
 = 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,

45 
pkt
->
hdr
.
cmd
);

47 i‡(
w
->
cmds
[
i
] =
ªc_id
 ||

48 (!
	`iwl_cmd_groupid
(
w
->
cmds
[
i
]) &&

49 
	`DEF_ID
(
w
->
cmds
[
i
]Ë=
ªc_id
)) {

50 
found
 = 
åue
;

54 i‡(!
found
)

57 i‡(!
w
->
‚
 || w->
	`‚
(
nŸif_waô
, 
pkt
, w->
‚_d©a
)) {

58 
w
->
åiggîed
 = 
åue
;

59 
åiggîed
 = 
åue
;

62 
	`•ö_u∆ock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

65  
åiggîed
;

66 
	}
}

67 
IWL_EXPORT_SYMBOL
(
iwl_nŸifiˇti⁄_waô
);

69 
	$iwl_ab‹t_nŸifiˇti⁄_waôs
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
)

71 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
;

73 
	`•ö_lock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

74 
	`li°_f‹_óch_íåy
(
waô_íåy
, &
nŸif_waô
->
nŸif_waôs
, 
li°
)

75 
waô_íåy
->
ab‹ãd
 = 
åue
;

76 
	`•ö_u∆ock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

78 
	`wake_up_Æl
(&
nŸif_waô
->
nŸif_waôq
);

79 
	}
}

80 
IWL_EXPORT_SYMBOL
(
iwl_ab‹t_nŸifiˇti⁄_waôs
);

83 
	$iwl_öô_nŸifiˇti⁄_waô
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

84 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
,

85 c⁄° 
u16
 *
cmds
, 
n_cmds
,

86 
	$boﬁ
 (*
‚
)(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

87 
iwl_rx_∑ckë
 *
pkt
, *
d©a
),

88 *
‚_d©a
)

90 i‡(
	`WARN_ON
(
n_cmds
 > 
MAX_NOTIF_CMDS
))

91 
n_cmds
 = 
MAX_NOTIF_CMDS
;

93 
waô_íåy
->
‚
 = fn;

94 
waô_íåy
->
‚_d©a
 = fn_data;

95 
waô_íåy
->
n_cmds
 =Ç_cmds;

96 
	`mem˝y
(
waô_íåy
->
cmds
, cmds, 
n_cmds
 * (
u16
));

97 
waô_íåy
->
åiggîed
 = 
Ál£
;

98 
waô_íåy
->
ab‹ãd
 = 
Ál£
;

100 
	`•ö_lock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

101 
	`li°_add
(&
waô_íåy
->
li°
, &
nŸif_waô
->
nŸif_waôs
);

102 
	`•ö_u∆ock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

103 
	}
}

104 
IWL_EXPORT_SYMBOL
(
iwl_öô_nŸifiˇti⁄_waô
);

106 
	$iwl_ªmove_nŸifiˇti⁄
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

107 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
)

109 
	`•ö_lock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

110 
	`li°_dñ
(&
waô_íåy
->
li°
);

111 
	`•ö_u∆ock_bh
(&
nŸif_waô
->
nŸif_waô_lock
);

112 
	}
}

113 
IWL_EXPORT_SYMBOL
(
iwl_ªmove_nŸifiˇti⁄
);

115 
	$iwl_waô_nŸifiˇti⁄
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

116 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
,

117 
timeout
)

119 
ªt
;

121 
ªt
 = 
	`waô_evít_timeout
(
nŸif_waô
->
nŸif_waôq
,

122 
waô_íåy
->
åiggîed
 || waô_íåy->
ab‹ãd
,

123 
timeout
);

125 
	`iwl_ªmove_nŸifiˇti⁄
(
nŸif_waô
, 
waô_íåy
);

127 i‡(
waô_íåy
->
ab‹ãd
)

128  -
EIO
;

131 i‡(
ªt
 <= 0)

132  -
ETIMEDOUT
;

134 
	}
}

135 
IWL_EXPORT_SYMBOL
(
iwl_waô_nŸifiˇti⁄
);

	@fw/notif-wait.h

6 #i‚de‡
__iwl_nŸif_waô_h__


7 
	#__iwl_nŸif_waô_h__


	)

9 
	~<löux/waô.h
>

11 
	~"iwl-å™s.h
"

13 
	siwl_nŸif_waô_d©a
 {

14 
li°_hód
 
	mnŸif_waôs
;

15 
•ölock_t
 
	mnŸif_waô_lock
;

16 
waô_queue_hód_t
 
	mnŸif_waôq
;

19 
	#MAX_NOTIF_CMDS
 5

	)

46 
	siwl_nŸifiˇti⁄_waô
 {

47 
li°_hód
 
	mli°
;

49 
boﬁ
 (*
‚
)(
iwl_nŸif_waô_d©a
 *
	mnŸif_d©a
,

50 
iwl_rx_∑ckë
 *
	mpkt
, *
	md©a
);

51 *
	m‚_d©a
;

53 
u16
 
	mcmds
[
MAX_NOTIF_CMDS
];

54 
u8
 
	mn_cmds
;

55 
boﬁ
 
	måiggîed
, 
	mab‹ãd
;

60 
iwl_nŸifiˇti⁄_waô_öô
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
);

61 
boﬁ
 
iwl_nŸifiˇti⁄_waô
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

62 
iwl_rx_∑ckë
 *
pkt
);

63 
iwl_ab‹t_nŸifiˇti⁄_waôs
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
);

65 
ölöe
 

66 
	$iwl_nŸifiˇti⁄_nŸify
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
)

68 
	`wake_up_Æl
(&
nŸif_d©a
->
nŸif_waôq
);

69 
	}
}

71 
ölöe
 

72 
	$iwl_nŸifiˇti⁄_waô_nŸify
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

73 
iwl_rx_∑ckë
 *
pkt
)

75 i‡(
	`iwl_nŸifiˇti⁄_waô
(
nŸif_d©a
, 
pkt
))

76 
	`iwl_nŸifiˇti⁄_nŸify
(
nŸif_d©a
);

77 
	}
}

80 
	$__acquúes
(
waô_íåy
)

81 
	`iwl_öô_nŸifiˇti⁄_waô
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

82 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
,

83 c⁄° 
u16
 *
cmds
, 
n_cmds
,

84 
	$boﬁ
 (*
‚
)(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

85 
iwl_rx_∑ckë
 *
pkt
, *
d©a
),

86 *
‚_d©a
);

88 
__mu°_check
 
	$__ªÀa£s
(
waô_íåy
)

89 
	`iwl_waô_nŸifiˇti⁄
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

90 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
,

91 
timeout
);

93 
	$__ªÀa£s
(
waô_íåy
)

94 
	`iwl_ªmove_nŸifiˇti⁄
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

95 
iwl_nŸifiˇti⁄_waô
 *
waô_íåy
);

	@fw/paging.c

7 
	~"iwl-drv.h
"

8 
	~"ru¡ime.h
"

9 
	~"fw/≠i/comm™ds.h
"

11 
	$iwl_‰ì_fw_∑gög
(
iwl_fw_ru¡ime
 *
fwπ
)

13 
i
;

15 i‡(!
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_block
)

18 
i
 = 0; i < 
NUM_OF_FW_PAGING_BLOCKS
; i++) {

19 
iwl_fw_∑gög
 *
∑gög
 = &
fwπ
->
fw_∑gög_db
[
i
];

21 i‡(!
∑gög
->
fw_∑gög_block
) {

22 
	`IWL_DEBUG_FW
(
fwπ
,

24 
i
);

28 
	`dma_unm≠_∑ge
(
fwπ
->
å™s
->
dev
, 
∑gög
->
fw_∑gög_phys
,

29 
∑gög
->
fw_∑gög_size
, 
DMA_BIDIRECTIONAL
);

31 
	`__‰ì_∑ges
(
∑gög
->
fw_∑gög_block
,

32 
	`gë_‹dî
(
∑gög
->
fw_∑gög_size
));

33 
∑gög
->
fw_∑gög_block
 = 
NULL
;

36 
	`mem£t
(
fwπ
->
fw_∑gög_db
, 0, (fwrt->fw_paging_db));

37 
	}
}

38 
IWL_EXPORT_SYMBOL
(
iwl_‰ì_fw_∑gög
);

40 
	$iwl_Æloc_fw_∑gög_mem
(
iwl_fw_ru¡ime
 *
fwπ
,

41 c⁄° 
fw_img
 *
image
)

43 
∑ge
 *
block
;

44 
dma_addr_t
 
phys
 = 0;

45 
blk_idx
, 
‹dî
, 
num_of_∑ges
, 
size
;

47 i‡(
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_block
)

51 
	`BUILD_BUG_ON
(
	`BIT
(
BLOCK_2_EXP_SIZE
Ë!
PAGING_BLOCK_SIZE
);

53 
num_of_∑ges
 = 
image
->
∑gög_mem_size
 / 
FW_PAGING_SIZE
;

54 
fwπ
->
num_of_∑gög_blk
 =

55 
	`DIV_ROUND_UP
(
num_of_∑ges
, 
NUM_OF_PAGE_PER_GROUP
);

56 
fwπ
->
num_of_∑ges_ö_œ°_blk
 =

57 
num_of_∑ges
 -

58 
NUM_OF_PAGE_PER_GROUP
 * (
fwπ
->
num_of_∑gög_blk
 - 1);

60 
	`IWL_DEBUG_FW
(
fwπ
,

62 
fwπ
->
num_of_∑gög_blk
,

63 
fwπ
->
num_of_∑ges_ö_œ°_blk
);

68 
blk_idx
 = 0; blk_idx < 
fwπ
->
num_of_∑gög_blk
 + 1; blk_idx++) {

70 
size
 = 
blk_idx
 ? 
PAGING_BLOCK_SIZE
 : 
FW_PAGING_SIZE
;

71 
‹dî
 = 
	`gë_‹dî
(
size
);

72 
block
 = 
	`Æloc_∑ges
(
GFP_KERNEL
, 
‹dî
);

73 i‡(!
block
) {

75 
	`iwl_‰ì_fw_∑gög
(
fwπ
);

76  -
ENOMEM
;

79 
fwπ
->
fw_∑gög_db
[
blk_idx
].
fw_∑gög_block
 = 
block
;

80 
fwπ
->
fw_∑gög_db
[
blk_idx
].
fw_∑gög_size
 = 
size
;

82 
phys
 = 
	`dma_m≠_∑ge
(
fwπ
->
å™s
->
dev
, 
block
, 0,

83 
PAGE_SIZE
 << 
‹dî
,

84 
DMA_BIDIRECTIONAL
);

85 i‡(
	`dma_m≠pög_îr‹
(
fwπ
->
å™s
->
dev
, 
phys
)) {

90 
	`iwl_‰ì_fw_∑gög
(
fwπ
);

91  -
ENOMEM
;

93 
fwπ
->
fw_∑gög_db
[
blk_idx
].
fw_∑gög_phys
 = 
phys
;

95 i‡(!
blk_idx
)

96 
	`IWL_DEBUG_FW
(
fwπ
,

98 
‹dî
);

100 
	`IWL_DEBUG_FW
(
fwπ
,

102 
‹dî
);

106 
	}
}

108 
	$iwl_fûl_∑gög_mem
(
iwl_fw_ru¡ime
 *
fwπ
,

109 c⁄° 
fw_img
 *
image
)

111 
£c_idx
, 
idx
, 
ªt
;

112 
u32
 
off£t
 = 0;

125 
£c_idx
 = 0; sec_idx < 
image
->
num_£c
; sec_idx++) {

126 i‡(
image
->
£c
[
£c_idx
].
off£t
 =
PAGING_SEPARATOR_SECTION
) {

127 
£c_idx
++;

136 i‡(
£c_idx
 >
image
->
num_£c
 - 1) {

137 
	`IWL_ERR
(
fwπ
, "Paging: Missing CSSánd/orÖaging sections\n");

138 
ªt
 = -
EINVAL
;

139 
îr
;

143 
	`IWL_DEBUG_FW
(
fwπ
, "Paging:ÜoadÖaging CSSÅo FW, sec = %d\n",

144 
£c_idx
);

146 i‡(
image
->
£c
[
£c_idx
].
Àn
 > 
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_size
) {

147 
	`IWL_ERR
(
fwπ
, "CSS block isÜargerÅhanÖaging size\n");

148 
ªt
 = -
EINVAL
;

149 
îr
;

152 
	`mem˝y
(
	`∑ge_addªss
(
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_block
),

153 
image
->
£c
[
£c_idx
].
d©a
,

154 
image
->
£c
[
£c_idx
].
Àn
);

155 
fwπ
->
fw_∑gög_db
[0].
fw_offs
 = 
image
->
£c
[
£c_idx
].
off£t
;

156 
	`dma_sync_sögÀ_f‹_devi˚
(
fwπ
->
å™s
->
dev
,

157 
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_phys
,

158 
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_size
,

159 
DMA_BIDIRECTIONAL
);

161 
	`IWL_DEBUG_FW
(
fwπ
,

163 
fwπ
->
fw_∑gög_db
[0].
fw_∑gög_size
);

165 
£c_idx
++;

172 
idx
 = 1; idx < 
fwπ
->
num_of_∑gög_blk
 + 1; idx++) {

173 
iwl_fw_∑gög
 *
block
 = &
fwπ
->
fw_∑gög_db
[
idx
];

174 
ªmaöög
 = 
image
->
£c
[
£c_idx
].
Àn
 - 
off£t
;

175 
Àn
 = 
block
->
fw_∑gög_size
;

181 i‡(
idx
 =
fwπ
->
num_of_∑gög_blk
) {

182 
Àn
 = 
ªmaöög
;

183 i‡(
ªmaöög
 !=

184 
fwπ
->
num_of_∑ges_ö_œ°_blk
 * 
FW_PAGING_SIZE
) {

185 
	`IWL_ERR
(
fwπ
,

187 
ªmaöög
);

188 
ªt
 = -
EINVAL
;

189 
îr
;

191 } i‡(
block
->
fw_∑gög_size
 > 
ªmaöög
) {

192 
	`IWL_ERR
(
fwπ
,

194 
idx
, 
ªmaöög
);

195 
ªt
 = -
EINVAL
;

196 
îr
;

199 
	`mem˝y
(
	`∑ge_addªss
(
block
->
fw_∑gög_block
),

200 (c⁄° 
u8
 *)
image
->
£c
[
£c_idx
].
d©a
 + 
off£t
, 
Àn
);

201 
block
->
fw_offs
 = 
image
->
£c
[
£c_idx
].
off£t
 + offset;

202 
	`dma_sync_sögÀ_f‹_devi˚
(
fwπ
->
å™s
->
dev
,

203 
block
->
fw_∑gög_phys
,

204 
block
->
fw_∑gög_size
,

205 
DMA_BIDIRECTIONAL
);

207 
	`IWL_DEBUG_FW
(
fwπ
,

209 
Àn
, 
idx
);

211 
off£t
 +
block
->
fw_∑gög_size
;

216 
îr
:

217 
	`iwl_‰ì_fw_∑gög
(
fwπ
);

218  
ªt
;

219 
	}
}

221 
	$iwl_ßve_fw_∑gög
(
iwl_fw_ru¡ime
 *
fwπ
,

222 c⁄° 
fw_img
 *
fw
)

224 
ªt
;

226 
ªt
 = 
	`iwl_Æloc_fw_∑gög_mem
(
fwπ
, 
fw
);

227 i‡(
ªt
)

228  
ªt
;

230  
	`iwl_fûl_∑gög_mem
(
fwπ
, 
fw
);

231 
	}
}

234 
	$iwl_£nd_∑gög_cmd
(
iwl_fw_ru¡ime
 *
fwπ
,

235 c⁄° 
fw_img
 *
fw
)

237 
iwl_fw_∑gög_cmd
 
∑gög_cmd
 = {

238 .
Êags
 = 
	`˝u_to_À32
(
PAGING_CMD_IS_SECURED
 |

239 
PAGING_CMD_IS_ENABLED
 |

240 (
fwπ
->
num_of_∑ges_ö_œ°_blk
 <<

241 
PAGING_CMD_NUM_OF_PAGES_IN_LAST_GRP_POS
)),

242 .
block_size
 = 
	`˝u_to_À32
(
BLOCK_2_EXP_SIZE
),

243 .
block_num
 = 
	`˝u_to_À32
(
fwπ
->
num_of_∑gög_blk
),

245 
iwl_ho°_cmd
 
hcmd
 = {

246 .
id
 = 
	`WIDE_ID
(
IWL_ALWAYS_LONG_GROUP
, 
FW_PAGING_BLOCK_CMD
),

247 .
Àn
 = { (
∑gög_cmd
), },

248 .
d©a
 = { &
∑gög_cmd
, },

250 
blk_idx
;

253 
blk_idx
 = 0; blk_idx < 
fwπ
->
num_of_∑gög_blk
 + 1; blk_idx++) {

254 
dma_addr_t
 
addr
 = 
fwπ
->
fw_∑gög_db
[
blk_idx
].
fw_∑gög_phys
;

255 
__À32
 
phy_addr
;

257 
addr
 =ádd∏>> 
PAGE_2_EXP_SIZE
;

258 
phy_addr
 = 
	`˝u_to_À32
(
addr
);

259 
∑gög_cmd
.
devi˚_phy_addr
[
blk_idx
] = 
phy_addr
;

262  
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

263 
	}
}

265 
	$iwl_öô_∑gög
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_ucode_ty≥
 
ty≥
)

267 c⁄° 
fw_img
 *
fw
 = &
fwπ
->fw->
img
[
ty≥
];

268 
ªt
;

270 i‡(
fwπ
->
å™s
->
å™s_cfg
->
gí2
)

278 i‡(!
fw
->
∑gög_mem_size
)

281 
ªt
 = 
	`iwl_ßve_fw_∑gög
(
fwπ
, 
fw
);

282 i‡(
ªt
) {

283 
	`IWL_ERR
(
fwπ
, "failedÅo saveÅhe FWÖaging image\n");

284  
ªt
;

287 
ªt
 = 
	`iwl_£nd_∑gög_cmd
(
fwπ
, 
fw
);

288 i‡(
ªt
) {

289 
	`IWL_ERR
(
fwπ
, "failedÅo sendÅheÖaging cmd\n");

290 
	`iwl_‰ì_fw_∑gög
(
fwπ
);

291  
ªt
;

295 
	}
}

296 
IWL_EXPORT_SYMBOL
(
iwl_öô_∑gög
);

	@fw/pnvm.c

6 
	~"iwl-drv.h
"

7 
	~"≤vm.h
"

8 
	~"iwl-¥ph.h
"

9 
	~"iwl-io.h
"

10 
	~"fw/≠i/comm™ds.h
"

11 
	~"fw/≠i/nvm-ªg.h
"

12 
	~"fw/≠i/Æive.h
"

13 
	~"fw/uefi.h
"

15 
	#IWL_PNVM_REDUCED_CAP_BIT
 
	`BIT
(25)

	)

17 
	siwl_≤vm_£˘i⁄
 {

18 
__À32
 
	moff£t
;

19 c⁄° 
u8
 
	md©a
[];

20 } 
	g__∑cked
;

22 
boﬁ
 
	$iwl_≤vm_com∂ëe_‚
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

23 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

25 
iwl_å™s
 *
å™s
 = (iwl_å™†*)
d©a
;

26 
iwl_≤vm_öô_com∂ëe_¡fy
 *
≤vm_¡f
 = (*)
pkt
->
d©a
;

28 
	`IWL_DEBUG_FW
(
å™s
,

30 
	`À32_to_˝u
(
≤vm_¡f
->
°©us
));

32  
åue
;

33 
	}
}

35 
	$iwl_≤vm_h™dÀ_£˘i⁄
(
iwl_å™s
 *
å™s
, c⁄° 
u8
 *
d©a
,

36 
size_t
 
Àn
,

37 
iwl_≤vm_image
 *
≤vm_d©a
)

39 c⁄° 
iwl_ucode_év
 *
év
;

40 
u32
 
sha1
 = 0;

41 
u16
 
mac_ty≥
 = 0, 
rf_id
 = 0;

42 
boﬁ
 
hw_m©ch
 = 
Ál£
;

44 
	`IWL_DEBUG_FW
(
å™s
, "Handling PNVM section\n");

46 
	`mem£t
(
≤vm_d©a
, 0, (*pnvm_data));

48 
Àn
 >(*
év
)) {

49 
u32
 
év_Àn
, 
év_ty≥
;

51 
Àn
 -(*
év
);

52 
év
 = (c⁄° *)
d©a
;

54 
év_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

55 
év_ty≥
 = 
	`À32_to_˝u
(
év
->
ty≥
);

57 i‡(
Àn
 < 
év_Àn
) {

58 
	`IWL_ERR
(
å™s
, "invalid TLVÜen: %zd/%u\n",

59 
Àn
, 
év_Àn
);

60  -
EINVAL
;

63 
d©a
 +(*
év
);

65 
év_ty≥
) {

66 
IWL_UCODE_TLV_PNVM_VERSION
:

67 i‡(
év_Àn
 < (
__À32
)) {

68 
	`IWL_DEBUG_FW
(
å™s
,

70 (
__À32
), 
év_Àn
);

74 
sha1
 = 
	`À32_to_˝up
((c⁄° 
__À32
 *)
d©a
);

76 
	`IWL_DEBUG_FW
(
å™s
,

78 
sha1
);

79 
≤vm_d©a
->
vîsi⁄
 = 
sha1
;

81 
IWL_UCODE_TLV_HW_TYPE
:

82 i‡(
év_Àn
 < 2 * (
__À16
)) {

83 
	`IWL_DEBUG_FW
(
å™s
,

85 2 * (
__À16
), 
év_Àn
);

89 i‡(
hw_m©ch
)

92 
mac_ty≥
 = 
	`À16_to_˝up
((c⁄° 
__À16
 *)
d©a
);

93 
rf_id
 = 
	`À16_to_˝up
((c⁄° 
__À16
 *)(
d©a
 + (__le16)));

95 
	`IWL_DEBUG_FW
(
å™s
,

97 
mac_ty≥
, 
rf_id
);

99 i‡(
mac_ty≥
 =
	`CSR_HW_REV_TYPE
(
å™s
->
hw_ªv
) &&

100 
rf_id
 =
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
))

101 
hw_m©ch
 = 
åue
;

103 
IWL_UCODE_TLV_SEC_RT
: {

104 c⁄° 
iwl_≤vm_£˘i⁄
 *
£˘i⁄
 = (c⁄° *)
d©a
;

105 
u32
 
d©a_Àn
 = 
év_Àn
 - (*
£˘i⁄
);

107 
	`IWL_DEBUG_FW
(
å™s
,

109 
év_Àn
);

112 i‡(
	`À32_to_˝up
((c⁄° 
__À32
 *)
d©a
) == 0xddddeeee) {

113 
	`IWL_DEBUG_FW
(
å™s
, "Ignoring separator.\n");

117 i‡(
≤vm_d©a
->
n_chunks
 =
IPC_DRAM_MAP_ENTRY_NUM_MAX
) {

118 
	`IWL_DEBUG_FW
(
å™s
,

120  -
EINVAL
;

123 
	`IWL_DEBUG_FW
(
å™s
, "Adding data (size %d)\n",

124 
d©a_Àn
);

126 
≤vm_d©a
->
chunks
[≤vm_d©a->
n_chunks
].
d©a
 = 
£˘i⁄
->data;

127 
≤vm_d©a
->
chunks
[≤vm_d©a->
n_chunks
].
Àn
 = 
d©a_Àn
;

128 
≤vm_d©a
->
n_chunks
++;

132 
IWL_UCODE_TLV_MEM_DESC
:

133 i‡(
	`iwl_uefi_h™dÀ_év_mem_desc
(
å™s
, 
d©a
, 
év_Àn
,

134 
≤vm_d©a
))

135  -
EINVAL
;

137 
IWL_UCODE_TLV_PNVM_SKU
:

138 
	`IWL_DEBUG_FW
(
å™s
,

140 
d⁄e
;

142 
	`IWL_DEBUG_FW
(
å™s
, "Found TLV 0x%0x,Üen %d\n",

143 
év_ty≥
, 
év_Àn
);

147 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

148 
d©a
 +
	`ALIGN
(
év_Àn
, 4);

151 
d⁄e
:

152 i‡(!
hw_m©ch
) {

153 
	`IWL_DEBUG_FW
(
å™s
,

155 
	`CSR_HW_REV_TYPE
(
å™s
->
hw_ªv
),

156 
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
));

157  -
ENOENT
;

160 i‡(!
≤vm_d©a
->
n_chunks
) {

161 
	`IWL_DEBUG_FW
(
å™s
, "Empty PNVM, skipping.\n");

162  -
ENOENT
;

166 
	}
}

168 
	$iwl_≤vm_∑r£
(
iwl_å™s
 *
å™s
, c⁄° 
u8
 *
d©a
,

169 
size_t
 
Àn
,

170 
iwl_≤vm_image
 *
≤vm_d©a
)

172 c⁄° 
iwl_ucode_év
 *
év
;

174 
	`IWL_DEBUG_FW
(
å™s
, "Parsing PNVM file\n");

176 
Àn
 >(*
év
)) {

177 
u32
 
év_Àn
, 
év_ty≥
;

178 
u32
 
rf_ty≥
;

180 
Àn
 -(*
év
);

181 
év
 = (c⁄° *)
d©a
;

183 
év_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

184 
év_ty≥
 = 
	`À32_to_˝u
(
év
->
ty≥
);

186 i‡(
Àn
 < 
év_Àn
) {

187 
	`IWL_ERR
(
å™s
, "invalid TLVÜen: %zd/%u\n",

188 
Àn
, 
év_Àn
);

189  -
EINVAL
;

192 i‡(
év_ty≥
 =
IWL_UCODE_TLV_PNVM_SKU
) {

193 c⁄° 
iwl_sku_id
 *
sku_id
 =

194 (c⁄° *)(
d©a
 + (*
év
));

196 
	`IWL_DEBUG_FW
(
å™s
,

198 
év_Àn
);

199 
	`IWL_DEBUG_FW
(
å™s
, "sku_id 0x%0x 0x%0x 0x%0x\n",

200 
	`À32_to_˝u
(
sku_id
->
d©a
[0]),

201 
	`À32_to_˝u
(
sku_id
->
d©a
[1]),

202 
	`À32_to_˝u
(
sku_id
->
d©a
[2]));

204 
d©a
 +(*
év
Ë+ 
	`ALIGN
(
év_Àn
, 4);

205 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

207 
å™s
->
ªdu˚d_ˇp_sku
 = 
Ál£
;

208 
rf_ty≥
 = 
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
);

209 i‡((
å™s
->
sku_id
[0] & 
IWL_PNVM_REDUCED_CAP_BIT
) &&

210 
rf_ty≥
 =
IWL_CFG_RF_TYPE_FM
)

211 
å™s
->
ªdu˚d_ˇp_sku
 = 
åue
;

213 
	`IWL_DEBUG_FW
(
å™s
,

215 
å™s
->
ªdu˚d_ˇp_sku
);

217 i‡(
å™s
->
sku_id
[0] =
	`À32_to_˝u
(sku_id->
d©a
[0]) &&

218 
å™s
->
sku_id
[1] =
	`À32_to_˝u
(sku_id->
d©a
[1]) &&

219 
å™s
->
sku_id
[2] =
	`À32_to_˝u
(sku_id->
d©a
[2])) {

220 
ªt
;

222 
ªt
 = 
	`iwl_≤vm_h™dÀ_£˘i⁄
(
å™s
, 
d©a
, 
Àn
,

223 
≤vm_d©a
);

224 i‡(!
ªt
)

227 
	`IWL_DEBUG_FW
(
å™s
, "SKU ID didn't match!\n");

230 
d©a
 +(*
év
Ë+ 
	`ALIGN
(
év_Àn
, 4);

231 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

235  -
ENOENT
;

236 
	}
}

238 
	$iwl_≤vm_gë_‰om_fs
(
iwl_å™s
 *
å™s
, 
u8
 **
d©a
, 
size_t
 *
Àn
)

240 c⁄° 
fúmw¨e
 *
≤vm
;

241 
≤vm_«me
[
MAX_PNVM_NAME
];

242 
size_t
 
√w_Àn
;

243 
ªt
;

245 
	`iwl_≤vm_gë_fs_«me
(
å™s
, 
≤vm_«me
, (pnvm_name));

247 
ªt
 = 
	`fúmw¨e_ªque°_now¨n
(&
≤vm
, 
≤vm_«me
, 
å™s
->
dev
);

248 i‡(
ªt
) {

249 
	`IWL_DEBUG_FW
(
å™s
, "PNVM file %sÇot found %d\n",

250 
≤vm_«me
, 
ªt
);

251  
ªt
;

254 
√w_Àn
 = 
≤vm
->
size
;

255 *
d©a
 = 
	`kvmemdup
(
≤vm
->d©a,Önvm->
size
, 
GFP_KERNEL
);

256 
	`ªÀa£_fúmw¨e
(
≤vm
);

258 i‡(!*
d©a
)

259  -
ENOMEM
;

261 *
Àn
 = 
√w_Àn
;

264 
	}
}

266 
u8
 *
	$iwl_gë_≤vm_image
(
iwl_å™s
 *
å™s_p
, 
size_t
 *
Àn
)

268 
≤vm_sku_∑ckage
 *
∑ckage
;

269 
u8
 *
image
 = 
NULL
;

272 i‡(
å™s_p
->
sku_id
[2]) {

273 
∑ckage
 = 
	`iwl_uefi_gë_≤vm
(
å™s_p
, 
Àn
);

274 i‡(!
	`IS_ERR_OR_NULL
(
∑ckage
)) {

275 i‡(*
Àn
 >(*
∑ckage
)) {

277 *
Àn
 -(*
∑ckage
);

278 
image
 = 
	`kvmemdup
(
∑ckage
->
d©a
,

279 *
Àn
, 
GFP_KERNEL
);

285 
	`k‰ì
(
∑ckage
);

286 i‡(
image
)

287  
image
;

292 i‡(
	`iwl_≤vm_gë_‰om_fs
(
å™s_p
, &
image
, 
Àn
))

293  
NULL
;

294  
image
;

295 
	}
}

297 
	$iwl_≤vm_lﬂd_≤vm_to_å™s
(
iwl_å™s
 *
å™s
,

298 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

300 
iwl_≤vm_image
 *
≤vm_d©a
 = 
NULL
;

301 
u8
 *
d©a
 = 
NULL
;

302 
size_t
 
Àngth
;

303 
ªt
;

306 i‡(
å™s
->
Áû_to_∑r£_≤vm_image
)

309 i‡(
å™s
->
≤vm_lﬂded
)

310 
£t
;

312 
d©a
 = 
	`iwl_gë_≤vm_image
(
å™s
, &
Àngth
);

313 i‡(!
d©a
) {

314 
å™s
->
Áû_to_∑r£_≤vm_image
 = 
åue
;

318 
≤vm_d©a
 = 
	`kzÆloc
((*≤vm_d©a), 
GFP_KERNEL
);

319 i‡(!
≤vm_d©a
)

320 
‰ì
;

322 
ªt
 = 
	`iwl_≤vm_∑r£
(
å™s
, 
d©a
, 
Àngth
, 
≤vm_d©a
);

323 i‡(
ªt
) {

324 
å™s
->
Áû_to_∑r£_≤vm_image
 = 
åue
;

325 
‰ì
;

328 
ªt
 = 
	`iwl_å™s_lﬂd_≤vm
(
å™s
, 
≤vm_d©a
, 
ˇ∑
);

329 i‡(
ªt
)

330 
‰ì
;

331 
	`IWL_INFO
(
å™s
, "lﬂded PNVM vîsi⁄ %08x\n", 
≤vm_d©a
->
vîsi⁄
);

333 
£t
:

334 
	`iwl_å™s_£t_≤vm
(
å™s
, 
ˇ∑
);

335 
‰ì
:

336 
	`kv‰ì
(
d©a
);

337 
	`k‰ì
(
≤vm_d©a
);

338 
	}
}

341 
	$iwl_≤vm_lﬂd_ªdu˚_powî_to_å™s
(
iwl_å™s
 *
å™s
,

342 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

344 
iwl_≤vm_image
 *
≤vm_d©a
 = 
NULL
;

345 
u8
 *
d©a
 = 
NULL
;

346 
size_t
 
Àngth
;

347 
ªt
;

349 i‡(
å™s
->
Áûed_to_lﬂd_ªdu˚_powî_image
)

352 i‡(
å™s
->
ªdu˚_powî_lﬂded
)

353 
£t
;

355 
d©a
 = 
	`iwl_uefi_gë_ªdu˚d_powî
(
å™s
, &
Àngth
);

356 i‡(
	`IS_ERR
(
d©a
)) {

357 
å™s
->
Áûed_to_lﬂd_ªdu˚_powî_image
 = 
åue
;

361 
≤vm_d©a
 = 
	`kzÆloc
((*≤vm_d©a), 
GFP_KERNEL
);

362 i‡(!
≤vm_d©a
)

363 
‰ì
;

365 
ªt
 = 
	`iwl_uefi_ªdu˚_powî_∑r£
(
å™s
, 
d©a
, 
Àngth
, 
≤vm_d©a
);

366 i‡(
ªt
) {

367 
å™s
->
Áûed_to_lﬂd_ªdu˚_powî_image
 = 
åue
;

368 
‰ì
;

371 
ªt
 = 
	`iwl_å™s_lﬂd_ªdu˚_powî
(
å™s
, 
≤vm_d©a
, 
ˇ∑
);

372 i‡(
ªt
) {

373 
	`IWL_DEBUG_FW
(
å™s
,

375 
ªt
);

376 
å™s
->
Áûed_to_lﬂd_ªdu˚_powî_image
 = 
åue
;

377 
‰ì
;

380 
£t
:

381 
	`iwl_å™s_£t_ªdu˚_powî
(
å™s
, 
ˇ∑
);

382 
‰ì
:

383 
	`k‰ì
(
d©a
);

384 
	`k‰ì
(
≤vm_d©a
);

385 
	}
}

387 
	$iwl_≤vm_lﬂd
(
iwl_å™s
 *
å™s
,

388 
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

389 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

391 
iwl_nŸifiˇti⁄_waô
 
≤vm_waô
;

392 c⁄° 
u16
 
¡f_cmds
[] = { 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
,

393 
PNVM_INIT_COMPLETE_NTFY
) };

396 i‡(!
å™s
->
sku_id
[0] && !trans->sku_id[1] && !trans->sku_id[2])

399 
	`iwl_≤vm_lﬂd_≤vm_to_å™s
(
å™s
, 
ˇ∑
);

400 
	`iwl_≤vm_lﬂd_ªdu˚_powî_to_å™s
(
å™s
, 
ˇ∑
);

402 
	`iwl_öô_nŸifiˇti⁄_waô
(
nŸif_waô
, &
≤vm_waô
,

403 
¡f_cmds
, 
	`ARRAY_SIZE
(ntf_cmds),

404 
iwl_≤vm_com∂ëe_‚
, 
å™s
);

407 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_DOORBELL_TO_ISR6
,

408 
UREG_DOORBELL_TO_ISR6_PNVM
);

410  
	`iwl_waô_nŸifiˇti⁄
(
nŸif_waô
, &
≤vm_waô
,

411 
MVM_UCODE_PNVM_TIMEOUT
);

412 
	}
}

413 
IWL_EXPORT_SYMBOL
(
iwl_≤vm_lﬂd
);

	@fw/pnvm.h

5 #i‚de‡
__IWL_PNVM_H__


6 
	#__IWL_PNVM_H__


	)

8 
	~"iwl-drv.h
"

9 
	~"fw/nŸif-waô.h
"

11 
	#MVM_UCODE_PNVM_TIMEOUT
 (
HZ
 / 4)

	)

13 
	#MAX_PNVM_NAME
 64

	)

15 
iwl_≤vm_lﬂd
(
iwl_å™s
 *
å™s
,

16 
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

17 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
);

19 
ölöe


20 
	$iwl_≤vm_gë_fs_«me
(
iwl_å™s
 *
å™s
,

21 
u8
 *
≤vm_«me
, 
size_t
 
max_Àn
)

23 
_fw_«me_¥e
[
FW_NAME_PRE_BUFSIZE
];

25 
	`¢¥ötf
(
≤vm_«me
, 
max_Àn
, "%s.pnvm",

26 
	`iwl_drv_gë_fw«me_¥e
(
å™s
, 
_fw_«me_¥e
));

27 
	}
}

	@fw/regulatory.c

5 
	~<löux/dmi.h
>

6 
	~"iwl-drv.h
"

7 
	~"iwl-debug.h
"

8 
	~"ªguœt‹y.h
"

9 
	~"fw/ru¡ime.h
"

10 
	~"fw/uefi.h
"

12 
	#GET_BIOS_TABLE
(
__«me
, ...) \

14 
ªt
 = -
ENOENT
; \

15 i‡(
fwπ
->
uefi_èbÀs_lock_°©us
 > 
UEFI_WIFI_GUID_UNLOCKED
) \

16 
ªt
 = 
iwl_uefi_gë_
 ## 
	`__«me
(
__VA_ARGS__
); \

17 i‡(
ªt
 < 0) \

18 
ªt
 = 
iwl_a˝i_gë_
 ## 
	`__«me
(
__VA_ARGS__
); \

19  
ªt
; \

20 } 0)

	)

22 
	#IWL_BIOS_TABLE_LOADER
(
__«me
) \

23 
iwl_bios_gë_
 ## 
	`__«me
(
iwl_fw_ru¡ime
 *
fwπ
) \

24 {
	`GET_BIOS_TABLE
(
__«me
, 
fwπ
); } \

25 
	`IWL_EXPORT_SYMBOL
(
iwl_bios_gë_
 ## 
__«me
)

	)

27 
	#IWL_BIOS_TABLE_LOADER_DATA
(
__«me
, 
d©a_ty≥
) \

28 
iwl_bios_gë_
 ## 
	`__«me
(
iwl_fw_ru¡ime
 *
fwπ
, \

29 
d©a_ty≥
 * 
d©a
) \

30 {
	`GET_BIOS_TABLE
(
__«me
, 
fwπ
, 
d©a
); } \

31 
	`IWL_EXPORT_SYMBOL
(
iwl_bios_gë_
 ## 
__«me
)

	)

33 
IWL_BIOS_TABLE_LOADER
(
wrds_èbÀ
);

34 
IWL_BIOS_TABLE_LOADER
(
ewrd_èbÀ
);

35 
IWL_BIOS_TABLE_LOADER
(
wgds_èbÀ
);

36 
IWL_BIOS_TABLE_LOADER
(
µag_èbÀ
);

37 
IWL_BIOS_TABLE_LOADER_DATA
(
ès_èbÀ
, 
iwl_ès_d©a
);

38 
IWL_BIOS_TABLE_LOADER_DATA
(
pwr_limô
, 
u64
);

39 
IWL_BIOS_TABLE_LOADER_DATA
(
mcc
, );

40 
IWL_BIOS_TABLE_LOADER_DATA
(
eckv
, 
u32
);

43 c⁄° 
dmi_sy°em_id
 
	gdmi_µag_≠¥oved_li°
[] = {

44 { .
idít
 = "HP",

45 .
	gm©ches
 = {

46 
DMI_MATCH
(
DMI_SYS_VENDOR
, "HP"),

49 { .
	gidít
 = "SAMSUNG",

50 .
	gm©ches
 = {

51 
DMI_MATCH
(
DMI_SYS_VENDOR
, "SAMSUNG ELECTRONICS CO., LTD"),

54 { .
	gidít
 = "MSFT",

55 .
	gm©ches
 = {

56 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Microsoft Corporation"),

59 { .
	gidít
 = "ASUS",

60 .
	gm©ches
 = {

61 
DMI_MATCH
(
DMI_SYS_VENDOR
, "ASUSTeK COMPUTER INC."),

64 { .
	gidít
 = "GOOGLE-HP",

65 .
	gm©ches
 = {

66 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Google"),

67 
DMI_MATCH
(
DMI_BOARD_VENDOR
, "HP"),

70 { .
	gidít
 = "GOOGLE-ASUS",

71 .
	gm©ches
 = {

72 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Google"),

73 
DMI_MATCH
(
DMI_BOARD_VENDOR
, "ASUSTek COMPUTER INC."),

76 { .
	gidít
 = "GOOGLE-SAMSUNG",

77 .
	gm©ches
 = {

78 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Google"),

79 
DMI_MATCH
(
DMI_BOARD_VENDOR
, "SAMSUNG ELECTRONICS CO., LTD"),

82 { .
	gidít
 = "DELL",

83 .
	gm©ches
 = {

84 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Dell Inc."),

87 { .
	gidít
 = "DELL",

88 .
	gm©ches
 = {

89 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Alienware"),

92 { .
	gidít
 = "RAZER",

93 .
	gm©ches
 = {

94 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Razer"),

97 { .
	gidít
 = "Honor",

98 .
	gm©ches
 = {

99 
DMI_MATCH
(
DMI_SYS_VENDOR
, "HONOR"),

105 c⁄° 
dmi_sy°em_id
 
	gdmi_ès_≠¥oved_li°
[] = {

106 { .
idít
 = "HP",

107 .
	gm©ches
 = {

108 
DMI_MATCH
(
DMI_SYS_VENDOR
, "HP"),

111 { .
	gidít
 = "SAMSUNG",

112 .
	gm©ches
 = {

113 
DMI_MATCH
(
DMI_SYS_VENDOR
, "SAMSUNG ELECTRONICS CO., LTD"),

116 { .
	gidít
 = "LENOVO",

117 .
	gm©ches
 = {

118 
DMI_MATCH
(
DMI_SYS_VENDOR
, "LENOVO"),

121 { .
	gidít
 = "DELL",

122 .
	gm©ches
 = {

123 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Dell Inc."),

126 { .
	gidít
 = "MSFT",

127 .
	gm©ches
 = {

128 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Microsoft Corporation"),

131 { .
	gidít
 = "Acer",

132 .
	gm©ches
 = {

133 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Acer"),

136 { .
	gidít
 = "ASUS",

137 .
	gm©ches
 = {

138 
DMI_MATCH
(
DMI_SYS_VENDOR
, "ASUSTeK COMPUTER INC."),

141 { .
	gidít
 = "GOOGLE-HP",

142 .
	gm©ches
 = {

143 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Google"),

144 
DMI_MATCH
(
DMI_BOARD_VENDOR
, "HP"),

147 { .
	gidít
 = "MSI",

148 .
	gm©ches
 = {

149 
DMI_MATCH
(
DMI_SYS_VENDOR
, "Micro-Star International Co., Ltd."),

152 { .
	gidít
 = "Honor",

153 .
	gm©ches
 = {

154 
DMI_MATCH
(
DMI_SYS_VENDOR
, "HONOR"),

161 
boﬁ
 
	$iwl_ßr_geo_suµ‹t
(
iwl_fw_ru¡ime
 *
fwπ
)

174  
	`IWL_UCODE_SERIAL
(
fwπ
->
fw
->
ucode_vî
) >= 38 ||

175 (
	`IWL_UCODE_SERIAL
(
fwπ
->
fw
->
ucode_vî
) == 17 &&

176 
fwπ
->
å™s
->
hw_ªv
 !
CSR_HW_REV_TYPE_3160
) ||

177 (
	`IWL_UCODE_SERIAL
(
fwπ
->
fw
->
ucode_vî
) == 29 &&

178 ((
fwπ
->
å™s
->
hw_ªv
 & 
CSR_HW_REV_TYPE_MSK
) ==

179 
CSR_HW_REV_TYPE_7265D
));

180 
	}
}

181 
IWL_EXPORT_SYMBOL
(
iwl_ßr_geo_suµ‹t
);

183 
	$iwl_ßr_geo_fûl_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

184 
iwl_≥r_chaö_off£t
 *
èbÀ
,

185 
u32
 
n_b™ds
, u32 
n_¥ofûes
)

187 
i
, 
j
;

189 i‡(!
fwπ
->
geo_íabÀd
)

190  -
ENODATA
;

192 i‡(!
	`iwl_ßr_geo_suµ‹t
(
fwπ
))

193  -
EOPNOTSUPP
;

195 
i
 = 0; i < 
n_¥ofûes
; i++) {

196 
j
 = 0; j < 
n_b™ds
; j++) {

197 
iwl_≥r_chaö_off£t
 *
chaö
 =

198 &
èbÀ
[
i
 * 
n_b™ds
 + 
j
];

200 
chaö
->
max_tx_powî
 =

201 
	`˝u_to_À16
(
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
max
);

202 
chaö
->
chaö_a
 =

203 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
chaös
[0];

204 
chaö
->
chaö_b
 =

205 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
chaös
[1];

206 
	`IWL_DEBUG_RADIO
(
fwπ
,

208 
i
, 
j
,

209 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
chaös
[0],

210 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
chaös
[1],

211 
fwπ
->
geo_¥ofûes
[
i
].
b™ds
[
j
].
max
);

216 
	}
}

217 
IWL_EXPORT_SYMBOL
(
iwl_ßr_geo_fûl_èbÀ
);

219 
	$iwl_ßr_fûl_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

220 
__À16
 *
≥r_chaö
, 
u32
 
n_subb™ds
,

221 
¥of_a
, 
¥of_b
)

223 
¥ofs
[
BIOS_SAR_NUM_CHAINS
] = { 
¥of_a
, 
¥of_b
 };

224 
i
, 
j
;

226 
i
 = 0; i < 
BIOS_SAR_NUM_CHAINS
; i++) {

227 
iwl_ßr_¥ofûe
 *
¥of
;

230 i‡(
¥ofs
[
i
] == 0)

231  -
EPERM
;

234 i‡(
¥ofs
[
i
] > 
BIOS_SAR_MAX_PROFILE_NUM
)

235  -
EINVAL
;

238 
¥of
 = &
fwπ
->
ßr_¥ofûes
[
¥ofs
[
i
] - 1];

241 i‡(!
¥of
->
íabÀd
) {

242 
	`IWL_DEBUG_RADIO
(
fwπ
, "SARÖrofile %d is disabled.\n",

243 
¥ofs
[
i
]);

252 
	`IWL_DEBUG_INFO
(
fwπ
,

254 
i
, 
¥ofs
[i]);

255 
	`IWL_DEBUG_RADIO
(
fwπ
, " Chaö[%d]:\n", 
i
);

256 
j
 = 0; j < 
n_subb™ds
; j++) {

257 
≥r_chaö
[
i
 * 
n_subb™ds
 + 
j
] =

258 
	`˝u_to_À16
(
¥of
->
chaös
[
i
].
subb™ds
[
j
]);

259 
	`IWL_DEBUG_RADIO
(
fwπ
, " Band[%d] = %d * .125dBm\n",

260 
j
, 
¥of
->
chaös
[
i
].
subb™ds
[j]);

265 
	}
}

267 
	$iwl_ßr_fûl_¥ofûe
(
iwl_fw_ru¡ime
 *
fwπ
,

268 
__À16
 *
≥r_chaö
, 
u32
 
n_èbÀs
, u32 
n_subb™ds
,

269 
¥of_a
, 
¥of_b
)

271 
i
, 
ªt
 = 0;

273 
i
 = 0; i < 
n_èbÀs
; i++) {

274 
ªt
 = 
	`iwl_ßr_fûl_èbÀ
(
fwπ
,

275 &
≥r_chaö
[
i
 * 
n_subb™ds
 * 
BIOS_SAR_NUM_CHAINS
],

276 
n_subb™ds
, 
¥of_a
, 
¥of_b
);

277 i‡(
ªt
)

281  
ªt
;

282 
	}
}

283 
IWL_EXPORT_SYMBOL
(
iwl_ßr_fûl_¥ofûe
);

285 
boﬁ
 
	$iwl_µag_vÆue_vÆid
(
iwl_fw_ru¡ime
 *
fwπ
, 
chaö
,

286 
subb™d
)

288 
s8
 
µag_vÆ
 = 
fwπ
->
µag_chaös
[
chaö
].
subb™ds
[
subb™d
];

290 i‡((
subb™d
 == 0 &&

291 (
µag_vÆ
 > 
IWL_PPAG_MAX_LB
 ||Ö∑g_vÆ < 
IWL_PPAG_MIN_LB
)) ||

292 (
subb™d
 != 0 &&

293 (
µag_vÆ
 > 
IWL_PPAG_MAX_HB
 ||Ö∑g_vÆ < 
IWL_PPAG_MIN_HB
))) {

294 
	`IWL_DEBUG_RADIO
(
fwπ
, "InvÆid PPAG vÆue: %d\n", 
µag_vÆ
);

295  
Ál£
;

297  
åue
;

298 
	}
}

300 
	$iwl_fûl_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

301 
iwl_µag_èbÀ_cmd
 *
cmd
, *
cmd_size
)

303 
u8
 
cmd_vî
;

304 
i
, 
j
, 
num_sub_b™ds
;

305 
s8
 *
gaö
;

306 
boﬁ
 
£nd_µag_Æways
;

309 i‡(
	`CSR_HW_RFID_TYPE
(
fwπ
->
å™s
->
hw_rf_id
) ==

310 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_JF
))

311  -
EOPNOTSUPP
;

313 i‡(!
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_SET_PPAG
)) {

314 
	`IWL_DEBUG_RADIO
(
fwπ
,

316  -
EINVAL
;

319 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
fwπ
->
fw
,

320 
	`WIDE_ID
(
PHY_OPS_GROUP
,

321 
PER_PLATFORM_ANT_GAIN_CMD
), 1);

326 
£nd_µag_Æways
 = 
cmd_vî
 > 3;

329 i‡(!
£nd_µag_Æways
 && !
fwπ
->
µag_Êags
) {

330 
	`IWL_DEBUG_RADIO
(
fwπ
, "PPAGÇotÉnabled, commandÇot sent.\n");

331  -
EINVAL
;

337 
cmd
->
v1
.
Êags
 = 
	`˝u_to_À32
(
fwπ
->
µag_Êags
);

339 
	`IWL_DEBUG_RADIO
(
fwπ
, "PPAG cmd vî i†%d\n", 
cmd_vî
);

340 i‡(
cmd_vî
 == 1) {

341 
num_sub_b™ds
 = 
IWL_NUM_SUB_BANDS_V1
;

342 
gaö
 = 
cmd
->
v1
.gain[0];

343 *
cmd_size
 = (
cmd
->
v1
);

344 i‡(
fwπ
->
µag_vî
 >= 1) {

346 
	`IWL_DEBUG_RADIO
(
fwπ
,

348 
fwπ
->
µag_vî
);

350 } i‡(
cmd_vî
 >= 2 && cmd_ver <= 5) {

351 
num_sub_b™ds
 = 
IWL_NUM_SUB_BANDS_V2
;

352 
gaö
 = 
cmd
->
v2
.gain[0];

353 *
cmd_size
 = (
cmd
->
v2
);

354 i‡(
fwπ
->
µag_vî
 == 0) {

356 
	`IWL_DEBUG_RADIO
(
fwπ
,

360 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported PPAG command version\n");

361  -
EINVAL
;

365 
	`IWL_DEBUG_RADIO
(
fwπ
,

367 
	`À32_to_˝u
(
cmd
->
v1
.
Êags
));

369 i‡(
cmd_vî
 == 5)

370 
cmd
->
v1
.
Êags
 &
	`˝u_to_À32
(
IWL_PPAG_CMD_V5_MASK
);

371 i‡(
cmd_vî
 < 5)

372 
cmd
->
v1
.
Êags
 &
	`˝u_to_À32
(
IWL_PPAG_CMD_V4_MASK
);

374 i‡((
cmd_vî
 == 1 &&

375 !
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

376 
IWL_UCODE_TLV_CAPA_PPAG_CHINA_BIOS_SUPPORT
)) ||

377 (
cmd_vî
 =2 && 
fwπ
->
µag_vî
 >= 2)) {

378 
cmd
->
v1
.
Êags
 &
	`˝u_to_À32
(
IWL_PPAG_ETSI_MASK
);

379 
	`IWL_DEBUG_RADIO
(
fwπ
, "maskingÖpag China bit\n");

381 
	`IWL_DEBUG_RADIO
(
fwπ
, "isn't maskingÖpag China bit\n");

384 
	`IWL_DEBUG_RADIO
(
fwπ
,

386 
	`À32_to_˝u
(
cmd
->
v1
.
Êags
));

388 
i
 = 0; i < 
IWL_NUM_CHAIN_LIMITS
; i++) {

389 
j
 = 0; j < 
num_sub_b™ds
; j++) {

390 i‡(!
£nd_µag_Æways
 &&

391 !
	`iwl_µag_vÆue_vÆid
(
fwπ
, 
i
, 
j
))

392  -
EINVAL
;

394 
gaö
[
i
 * 
num_sub_b™ds
 + 
j
] =

395 
fwπ
->
µag_chaös
[
i
].
subb™ds
[
j
];

396 
	`IWL_DEBUG_RADIO
(
fwπ
,

398 
i
, 
j
, 
gaö
[ò* 
num_sub_b™ds
 + j]);

403 
	}
}

404 
IWL_EXPORT_SYMBOL
(
iwl_fûl_µag_èbÀ
);

406 
boﬁ
 
	$iwl_is_µag_≠¥oved
(
iwl_fw_ru¡ime
 *
fwπ
)

408 i‡(!
	`dmi_check_sy°em
(
dmi_µag_≠¥oved_li°
)) {

409 
	`IWL_DEBUG_RADIO
(
fwπ
,

411 
	`dmi_gë_sy°em_öfo
(
DMI_SYS_VENDOR
) ?: "<unknown>");

412 
fwπ
->
µag_Êags
 = 0;

413  
Ál£
;

416  
åue
;

417 
	}
}

418 
IWL_EXPORT_SYMBOL
(
iwl_is_µag_≠¥oved
);

420 
boﬁ
 
	$iwl_is_ès_≠¥oved
()

422  
	`dmi_check_sy°em
(
dmi_ès_≠¥oved_li°
);

423 
	}
}

424 
IWL_EXPORT_SYMBOL
(
iwl_is_ès_≠¥oved
);

426 
	$iwl_∑r£_ès_£À˘i⁄
(
iwl_fw_ru¡ime
 *
fwπ
,

427 
iwl_ès_d©a
 *
ès_d©a
,

428 c⁄° 
u32
 
ès_£À˘i⁄
)

430 
u8
 
ovîride_õc
 = 
	`u32_gë_bôs
(
ès_£À˘i⁄
,

431 
IWL_WTAS_OVERRIDE_IEC_MSK
);

432 
u8
 
íabÀd_õc
 = 
	`u32_gë_bôs
(
ès_£À˘i⁄
, 
IWL_WTAS_ENABLE_IEC_MSK
);

433 
u8
 
uß_ès_uhb
 = 
	`u32_gë_bôs
(
ès_£À˘i⁄
, 
IWL_WTAS_USA_UHB_MSK
);

434 
íabÀd
 = 
ès_£À˘i⁄
 & 
IWL_WTAS_ENABLED_MSK
;

436 
	`IWL_DEBUG_RADIO
(
fwπ
, "TAS selectionásÑead from BIOS: 0x%x\n",

437 
ès_£À˘i⁄
);

439 
ès_d©a
->
uß_ès_uhb_Ælowed
 = 
uß_ès_uhb
;

440 
ès_d©a
->
ovîride_ès_õc
 = 
ovîride_õc
;

441 
ès_d©a
->
íabÀ_ès_õc
 = 
íabÀd_õc
;

443  
íabÀd
;

444 
	}
}

446 
__À32
 
	$iwl_gë_œri_c⁄fig_bôm≠
(
iwl_fw_ru¡ime
 *
fwπ
)

448 
ªt
;

449 
u32
 
vÆ
;

450 
__À32
 
c⁄fig_bôm≠
 = 0;

452 
	`CSR_HW_RFID_TYPE
(
fwπ
->
å™s
->
hw_rf_id
)) {

453 
IWL_CFG_RF_TYPE_HR1
:

454 
IWL_CFG_RF_TYPE_HR2
:

455 
IWL_CFG_RF_TYPE_JF1
:

456 
IWL_CFG_RF_TYPE_JF2
:

457 
ªt
 = 
	`iwl_bios_gë_dsm
(
fwπ
, 
DSM_FUNC_ENABLE_INDONESIA_5G2
,

458 &
vÆ
);

460 i‡(!
ªt
 && 
vÆ
 =
DSM_VALUE_INDONESIA_ENABLE
)

461 
c⁄fig_bôm≠
 |=

462 
	`˝u_to_À32
(
LARI_CONFIG_ENABLE_5G2_IN_INDONESIA_MSK
);

468 
ªt
 = 
	`iwl_bios_gë_dsm
(
fwπ
, 
DSM_FUNC_DISABLE_SRD
, &
vÆ
);

469 i‡(!
ªt
) {

470 i‡(
vÆ
 =
DSM_VALUE_SRD_PASSIVE
)

471 
c⁄fig_bôm≠
 |=

472 
	`˝u_to_À32
(
LARI_CONFIG_CHANGE_ETSI_TO_PASSIVE_MSK
);

473 i‡(
vÆ
 =
DSM_VALUE_SRD_DISABLE
)

474 
c⁄fig_bôm≠
 |=

475 
	`˝u_to_À32
(
LARI_CONFIG_CHANGE_ETSI_TO_DISABLED_MSK
);

478 i‡(
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

479 
IWL_UCODE_TLV_CAPA_CHINA_22_REG_SUPPORT
)) {

480 
ªt
 = 
	`iwl_bios_gë_dsm
(
fwπ
, 
DSM_FUNC_REGULATORY_CONFIG
,

481 &
vÆ
);

486 i‡(
ªt
 < 0 || 
vÆ
 & 
DSM_MASK_CHINA_22_REG
)

487 
c⁄fig_bôm≠
 |=

488 
	`˝u_to_À32
(
LARI_CONFIG_ENABLE_CHINA_22_REG_SUPPORT_MSK
);

491  
c⁄fig_bôm≠
;

492 
	}
}

493 
IWL_EXPORT_SYMBOL
(
iwl_gë_œri_c⁄fig_bôm≠
);

495 
	$iwl_bios_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_dsm_funcs
 
func
,

496 
u32
 *
vÆue
)

498 
	`GET_BIOS_TABLE
(
dsm
, 
fwπ
, 
func
, 
vÆue
);

499 
	}
}

500 
IWL_EXPORT_SYMBOL
(
iwl_bios_gë_dsm
);

	@fw/regulatory.h

6 #i‚de‡
__fw_ªguœt‹y_h__


7 
	#__fw_ªguœt‹y_h__


	)

9 
	~"fw/img.h
"

10 
	~"fw/≠i/comm™ds.h
"

11 
	~"fw/≠i/powî.h
"

12 
	~"fw/≠i/phy.h
"

13 
	~"fw/≠i/c⁄fig.h
"

14 
	~"fw/img.h
"

15 
	~"iwl-å™s.h
"

17 
	#BIOS_SAR_MAX_PROFILE_NUM
 4

	)

22 
	#BIOS_SAR_MAX_CHAINS_PER_PROFILE
 4

	)

23 
	#BIOS_SAR_NUM_CHAINS
 2

	)

24 
	#BIOS_SAR_MAX_SUB_BANDS_NUM
 11

	)

26 
	#BIOS_GEO_NUM_CHAINS
 2

	)

27 
	#BIOS_GEO_MAX_NUM_BANDS
 3

	)

28 
	#BIOS_GEO_MAX_PROFILE_NUM
 8

	)

29 
	#BIOS_GEO_MIN_PROFILE_NUM
 3

	)

31 
	#IWL_SAR_ENABLE_MSK
 
	`BIT
(0)

	)

34 
	#IWL_PPAG_MIN_LB
 -16

	)

35 
	#IWL_PPAG_MAX_LB
 24

	)

36 
	#IWL_PPAG_MIN_HB
 -16

	)

37 
	#IWL_PPAG_MAX_HB
 40

	)

39 
	#IWL_PPAG_ETSI_CHINA_MASK
 3

	)

40 
	#IWL_PPAG_REV3_MASK
 0x7FF

	)

42 
	#IWL_WTAS_BLACK_LIST_MAX
 16

	)

43 
	#IWL_WTAS_ENABLED_MSK
 0x1

	)

44 
	#IWL_WTAS_OVERRIDE_IEC_MSK
 0x2

	)

45 
	#IWL_WTAS_ENABLE_IEC_MSK
 0x4

	)

46 
	#IWL_WTAS_USA_UHB_MSK
 
	`BIT
(16)

	)

58 
	siwl_ßr_¥ofûe_chaö
 {

59 
u8
 
	msubb™ds
[
BIOS_SAR_MAX_SUB_BANDS_NUM
];

67 
	siwl_ßr_¥ofûe
 {

68 
boﬁ
 
	míabÀd
;

69 
iwl_ßr_¥ofûe_chaö
 
	mchaös
[
BIOS_SAR_MAX_CHAINS_PER_PROFILE
];

79 
	siwl_geo_¥ofûe_b™d
 {

80 
u8
 
	mmax
;

81 
u8
 
	mchaös
[
BIOS_GEO_NUM_CHAINS
];

88 
	siwl_geo_¥ofûe
 {

89 
iwl_geo_¥ofûe_b™d
 
	mb™ds
[
BIOS_GEO_MAX_NUM_BANDS
];

93 
	siwl_µag_chaö
 {

94 
s8
 
	msubb™ds
[
BIOS_SAR_MAX_SUB_BANDS_NUM
];

97 
	siwl_ès_d©a
 {

98 
__À32
 
	mblock_li°_size
;

99 
__À32
 
	mblock_li°_¨øy
[
IWL_WTAS_BLACK_LIST_MAX
];

100 
u8
 
	movîride_ès_õc
;

101 
u8
 
	míabÀ_ès_õc
;

102 
u8
 
	muß_ès_uhb_Ælowed
;

106 
	eiwl_dsm_funcs
 {

107 
	mDSM_FUNC_QUERY
 = 0,

108 
	mDSM_FUNC_DISABLE_SRD
 = 1,

109 
	mDSM_FUNC_ENABLE_INDONESIA_5G2
 = 2,

110 
	mDSM_FUNC_ENABLE_6E
 = 3,

111 
	mDSM_FUNC_REGULATORY_CONFIG
 = 4,

112 
	mDSM_FUNC_11AX_ENABLEMENT
 = 6,

113 
	mDSM_FUNC_ENABLE_UNII4_CHAN
 = 7,

114 
	mDSM_FUNC_ACTIVATE_CHANNEL
 = 8,

115 
	mDSM_FUNC_FORCE_DISABLE_CHANNELS
 = 9,

116 
	mDSM_FUNC_ENERGY_DETECTION_THRESHOLD
 = 10,

117 
	mDSM_FUNC_RFI_CONFIG
 = 11,

118 
	mDSM_FUNC_NUM_FUNCS
 = 12,

121 
	eiwl_dsm_vÆues_§d
 {

122 
	mDSM_VALUE_SRD_ACTIVE
,

123 
	mDSM_VALUE_SRD_PASSIVE
,

124 
	mDSM_VALUE_SRD_DISABLE
,

125 
	mDSM_VALUE_SRD_MAX


128 
	eiwl_dsm_vÆues_öd⁄esü
 {

129 
	mDSM_VALUE_INDONESIA_DISABLE
,

130 
	mDSM_VALUE_INDONESIA_ENABLE
,

131 
	mDSM_VALUE_INDONESIA_RESERVED
,

132 
	mDSM_VALUE_INDONESIA_MAX


135 
	eiwl_dsm_vÆues_rfi
 {

136 
	mDSM_VALUE_RFI_DLVR_DISABLE
 = 
BIT
(0),

137 
	mDSM_VALUE_RFI_DDR_DISABLE
 = 
BIT
(1),

140 
	#DSM_VALUE_RFI_DISABLE
 (
DSM_VALUE_RFI_DLVR_DISABLE
 |\

141 
DSM_VALUE_RFI_DDR_DISABLE
)

	)

143 
	eiwl_dsm_masks_ªg
 {

144 
	mDSM_MASK_CHINA_22_REG
 = 
BIT
(2)

147 
	giwl_fw_ru¡ime
;

149 
boﬁ
 
iwl_ßr_geo_suµ‹t
(
iwl_fw_ru¡ime
 *
fwπ
);

151 
iwl_ßr_geo_fûl_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

152 
iwl_≥r_chaö_off£t
 *
èbÀ
,

153 
u32
 
n_b™ds
, u32 
n_¥ofûes
);

155 
iwl_ßr_fûl_¥ofûe
(
iwl_fw_ru¡ime
 *
fwπ
,

156 
__À16
 *
≥r_chaö
, 
u32
 
n_èbÀs
, u32 
n_subb™ds
,

157 
¥of_a
, 
¥of_b
);

159 
iwl_fûl_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

160 
iwl_µag_èbÀ_cmd
 *
cmd
,

161 *
cmd_size
);

163 
boﬁ
 
iwl_is_µag_≠¥oved
(
iwl_fw_ru¡ime
 *
fwπ
);

165 
boﬁ
 
iwl_is_ès_≠¥oved
();

167 
iwl_∑r£_ès_£À˘i⁄
(
iwl_fw_ru¡ime
 *
fwπ
,

168 
iwl_ès_d©a
 *
ès_d©a
,

169 c⁄° 
u32
 
ès_£À˘i⁄
);

171 
iwl_bios_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

173 
iwl_bios_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

175 
iwl_bios_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

177 
iwl_bios_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

179 
iwl_bios_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

180 
iwl_ès_d©a
 *
d©a
);

182 
iwl_bios_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
,

183 
u64
 *
dÊt_pwr_limô
);

185 
iwl_bios_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
);

186 
iwl_bios_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
ext_˛k
);

188 
__À32
 
iwl_gë_œri_c⁄fig_bôm≠
(
iwl_fw_ru¡ime
 *
fwπ
);

190 
iwl_bios_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_dsm_funcs
 
func
,

191 
u32
 *
vÆue
);

193 
ölöe
 
u32
 
	$iwl_bios_gë_µag_Êags
(c⁄° 
u32
 
µag_modes
,

194 c⁄° 
u8
 
µag_vî
)

196  
µag_modes
 & (
µag_vî
 < 3 ? 
IWL_PPAG_ETSI_CHINA_MASK
 :

197 
IWL_PPAG_REV3_MASK
);

198 
	}
}

	@fw/rs.c

6 
	~<√t/mac80211.h
>

7 
	~"fw/≠i/rs.h
"

8 
	~"iwl-drv.h
"

9 
	~"iwl-c⁄fig.h
"

11 
	#IWL_DECLARE_RATE_INFO
(
r
) \

12 [
IWL_RATE_
##
r
##
M_INDEX
] = IWL_RATE_##r##
M_PLCP


	)

17 c⁄° 
u8
 
	gfw_øã_idx_to_∂˝
[
IWL_RATE_COUNT
] = {

18 
IWL_DECLARE_RATE_INFO
(1),

19 
IWL_DECLARE_RATE_INFO
(2),

20 
IWL_DECLARE_RATE_INFO
(5),

21 
IWL_DECLARE_RATE_INFO
(11),

22 
IWL_DECLARE_RATE_INFO
(6),

23 
IWL_DECLARE_RATE_INFO
(9),

24 
IWL_DECLARE_RATE_INFO
(12),

25 
IWL_DECLARE_RATE_INFO
(18),

26 
IWL_DECLARE_RATE_INFO
(24),

27 
IWL_DECLARE_RATE_INFO
(36),

28 
IWL_DECLARE_RATE_INFO
(48),

29 
IWL_DECLARE_RATE_INFO
(54),

33 c⁄° 
iwl_øã_mcs_öfo
 
	gøã_mcs
[
IWL_RATE_COUNT
] = {

49 c⁄° * c⁄° 
	g™t_«me
[] = {

50 [
ANT_NONE
] = "None",

51 [
ANT_A
] = "A",

52 [
ANT_B
] = "B",

53 [
ANT_AB
] = "AB",

56 c⁄° * c⁄° 
	g¥ëty_bw
[] = {

64 
u8
 
	$iwl_fw_øã_idx_to_∂˝
(
idx
)

66  
fw_øã_idx_to_∂˝
[
idx
];

67 
	}
}

68 
IWL_EXPORT_SYMBOL
(
iwl_fw_øã_idx_to_∂˝
);

70 c⁄° 
iwl_øã_mcs_öfo
 *
	$iwl_øã_mcs
(
idx
)

72  &
øã_mcs
[
idx
];

73 
	}
}

74 
IWL_EXPORT_SYMBOL
(
iwl_øã_mcs
);

76 c⁄° *
	$iwl_rs_¥ëty_™t
(
u8
 
™t
)

78 i‡(
™t
 >
	`ARRAY_SIZE
(
™t_«me
))

81  
™t_«me
[
™t
];

82 
	}
}

83 
IWL_EXPORT_SYMBOL
(
iwl_rs_¥ëty_™t
);

85 c⁄° *
	$iwl_rs_¥ëty_bw
(
bw
)

87 i‡(
bw
 >
	`ARRAY_SIZE
(
¥ëty_bw
))

90  
¥ëty_bw
[
bw
];

91 
	}
}

92 
IWL_EXPORT_SYMBOL
(
iwl_rs_¥ëty_bw
);

94 
u32
 
	$iwl_Àgacy_øã_to_fw_idx
(
u32
 
øã_n_Êags
)

96 
øã
 = 
øã_n_Êags
 & 
RATE_LEGACY_RATE_MSK_V1
;

97 
idx
;

98 
boﬁ
 
ofdm
 = !(
øã_n_Êags
 & 
RATE_MCS_CCK_MSK_V1
);

99 
off£t
 = 
ofdm
 ? 
IWL_FIRST_OFDM_RATE
 : 0;

100 
œ°
 = 
ofdm
 ? 
IWL_RATE_COUNT_LEGACY
 : 
IWL_FIRST_OFDM_RATE
;

102 
idx
 = 
off£t
; idx < 
œ°
; idx++)

103 i‡(
	`iwl_fw_øã_idx_to_∂˝
(
idx
Ë=
øã
)

104  
idx
 - 
off£t
;

105  
IWL_RATE_INVALID
;

106 
	}
}

108 
u32
 
	$iwl_√w_øã_‰om_v1
(
u32
 
øã_v1
)

110 
u32
 
øã_v2
 = 0;

111 
u32
 
dup
 = 0;

113 i‡(
øã_v1
 == 0)

114  
øã_v1
;

116 i‡(
øã_v1
 & 
RATE_MCS_HT_MSK_V1
) {

117 
u32
 
nss
 = 0;

119 
øã_v2
 |
RATE_MCS_HT_MSK
;

120 
øã_v2
 |=

121 
øã_v1
 & 
RATE_HT_MCS_RATE_CODE_MSK_V1
;

122 
nss
 = (
øã_v1
 & 
RATE_HT_MCS_MIMO2_MSK
) >>

123 
RATE_HT_MCS_NSS_POS_V1
;

124 
øã_v2
 |
nss
 << 
RATE_MCS_NSS_POS
;

125 } i‡(
øã_v1
 & 
RATE_MCS_VHT_MSK_V1
 ||

126 
øã_v1
 & 
RATE_MCS_HE_MSK_V1
) {

127 
øã_v2
 |
øã_v1
 & 
RATE_VHT_MCS_RATE_CODE_MSK
;

129 
øã_v2
 |
øã_v1
 & 
RATE_MCS_NSS_MSK
;

131 i‡(
øã_v1
 & 
RATE_MCS_HE_MSK_V1
) {

132 
u32
 
he_ty≥_bôs
 = 
øã_v1
 & 
RATE_MCS_HE_TYPE_MSK_V1
;

133 
u32
 
he_ty≥
 = 
he_ty≥_bôs
 >> 
RATE_MCS_HE_TYPE_POS_V1
;

134 
u32
 
he_106t
 = (
øã_v1
 & 
RATE_MCS_HE_106T_MSK_V1
) >>

135 
RATE_MCS_HE_106T_POS_V1
;

136 
u32
 
he_gi_…f
 = (
øã_v1
 & 
RATE_MCS_HE_GI_LTF_MSK_V1
) >>

137 
RATE_MCS_HE_GI_LTF_POS
;

139 i‡((
he_ty≥_bôs
 =
RATE_MCS_HE_TYPE_SU
 ||

140 
he_ty≥_bôs
 =
RATE_MCS_HE_TYPE_EXT_SU
) &&

141 
he_gi_…f
 =
RATE_MCS_HE_SU_4_LTF
)

146 
he_gi_…f
 +(
øã_v1
 & 
RATE_MCS_SGI_MSK_V1
) >>

147 
RATE_MCS_SGI_POS_V1
;

149 
øã_v2
 |
he_gi_…f
 << 
RATE_MCS_HE_GI_LTF_POS
;

150 
øã_v2
 |
he_ty≥
 << 
RATE_MCS_HE_TYPE_POS
;

151 
øã_v2
 |
he_106t
 << 
RATE_MCS_HE_106T_POS
;

152 
øã_v2
 |
øã_v1
 & 
RATE_HE_DUAL_CARRIER_MODE_MSK
;

153 
øã_v2
 |
RATE_MCS_HE_MSK
;

155 
øã_v2
 |
RATE_MCS_VHT_MSK
;

159 
u32
 
Àgacy_øã
 = 
	`iwl_Àgacy_øã_to_fw_idx
(
øã_v1
);

161 i‡(
	`WARN_ON_ONCE
(
Àgacy_øã
 =
IWL_RATE_INVALID
))

162 
Àgacy_øã
 = (
øã_v1
 & 
RATE_MCS_CCK_MSK_V1
) ?

163 
IWL_FIRST_CCK_RATE
 : 
IWL_FIRST_OFDM_RATE
;

165 
øã_v2
 |
Àgacy_øã
;

166 i‡(!(
øã_v1
 & 
RATE_MCS_CCK_MSK_V1
))

167 
øã_v2
 |
RATE_MCS_LEGACY_OFDM_MSK
;

171 i‡(
øã_v1
 & 
RATE_MCS_LDPC_MSK_V1
)

172 
øã_v2
 |
RATE_MCS_LDPC_MSK
;

173 
øã_v2
 |(
øã_v1
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
) |

174 (
øã_v1
 & 
RATE_MCS_ANT_AB_MSK
) |

175 (
øã_v1
 & 
RATE_MCS_STBC_MSK
) |

176 (
øã_v1
 & 
RATE_MCS_BF_MSK
);

178 
dup
 = (
øã_v1
 & 
RATE_MCS_DUP_MSK_V1
Ë>> 
RATE_MCS_DUP_POS_V1
;

179 i‡(
dup
) {

180 
øã_v2
 |
RATE_MCS_DUP_MSK
;

181 
øã_v2
 |
dup
 << 
RATE_MCS_CHAN_WIDTH_POS
;

184 i‡((!(
øã_v1
 & 
RATE_MCS_HE_MSK_V1
)) &&

185 (
øã_v1
 & 
RATE_MCS_SGI_MSK_V1
))

186 
øã_v2
 |
RATE_MCS_SGI_MSK
;

188  
øã_v2
;

189 
	}
}

190 
IWL_EXPORT_SYMBOL
(
iwl_√w_øã_‰om_v1
);

192 
	$rs_¥ëty_¥öt_øã
(*
buf
, 
bufsz
, c⁄° 
u32
 
øã
)

194 *
ty≥
;

195 
u8
 
mcs
 = 0, 
nss
 = 0;

196 
u8
 
™t
 = (
øã
 & 
RATE_MCS_ANT_AB_MSK
Ë>> 
RATE_MCS_ANT_POS
;

197 
u32
 
bw
 = (
øã
 & 
RATE_MCS_CHAN_WIDTH_MSK
) >>

198 
RATE_MCS_CHAN_WIDTH_POS
;

199 
u32
 
f‹m©
 = 
øã
 & 
RATE_MCS_MOD_TYPE_MSK
;

200 
boﬁ
 
sgi
;

202 i‡(
f‹m©
 =
RATE_MCS_CCK_MSK
 ||

203 
f‹m©
 =
RATE_MCS_LEGACY_OFDM_MSK
) {

204 
Àgacy_øã
 = 
øã
 & 
RATE_LEGACY_RATE_MSK
;

205 
ödex
 = 
f‹m©
 =
RATE_MCS_CCK_MSK
 ?

206 
Àgacy_øã
 :

207 
Àgacy_øã
 + 
IWL_FIRST_OFDM_RATE
;

209  
	`s˙¥ötf
(
buf
, 
bufsz
, "Legacy | ANT: %s Rate: %s Mbps",

210 
	`iwl_rs_¥ëty_™t
(
™t
),

211 
	`iwl_øã_mcs
(
ödex
)->
mbps
);

214 i‡(
f‹m©
 =
RATE_MCS_VHT_MSK
)

215 
ty≥
 = "VHT";

216 i‡(
f‹m©
 =
RATE_MCS_HT_MSK
)

217 
ty≥
 = "HT";

218 i‡(
f‹m©
 =
RATE_MCS_HE_MSK
)

219 
ty≥
 = "HE";

220 i‡(
f‹m©
 =
RATE_MCS_EHT_MSK
)

221 
ty≥
 = "EHT";

223 
ty≥
 = "Unknown";

225 
mcs
 = 
f‹m©
 =
RATE_MCS_HT_MSK
 ?

226 
	`RATE_HT_MCS_INDEX
(
øã
) :

227 
øã
 & 
RATE_MCS_CODE_MSK
;

228 
nss
 = ((
øã
 & 
RATE_MCS_NSS_MSK
)

229 >> 
RATE_MCS_NSS_POS
) + 1;

230 
sgi
 = 
f‹m©
 =
RATE_MCS_HE_MSK
 ?

231 
	`iwl_he_is_sgi
(
øã
) :

232 
øã
 & 
RATE_MCS_SGI_MSK
;

234  
	`s˙¥ötf
(
buf
, 
bufsz
,

236 
øã
, 
ty≥
, 
	`iwl_rs_¥ëty_™t
(
™t
), 
	`iwl_rs_¥ëty_bw
(
bw
), 
mcs
, 
nss
,

237 (
sgi
) ? "SGI " : "NGI ",

238 (
øã
 & 
RATE_MCS_STBC_MSK
) ? "STBC " : "",

239 (
øã
 & 
RATE_MCS_LDPC_MSK
) ? "LDPC " : "",

240 (
øã
 & 
RATE_HE_DUAL_CARRIER_MODE_MSK
) ? "DCM " : "",

241 (
øã
 & 
RATE_MCS_BF_MSK
) ? "BF " : "");

242 
	}
}

243 
IWL_EXPORT_SYMBOL
(
rs_¥ëty_¥öt_øã
);

245 
boﬁ
 
	$iwl_he_is_sgi
(
u32
 
øã_n_Êags
)

247 
u32
 
ty≥
 = 
øã_n_Êags
 & 
RATE_MCS_HE_TYPE_MSK
;

248 
u32
 
…f_gi
 = 
øã_n_Êags
 & 
RATE_MCS_HE_GI_LTF_MSK
;

250 i‡(
ty≥
 =
RATE_MCS_HE_TYPE_SU
 ||

251 
ty≥
 =
RATE_MCS_HE_TYPE_EXT_SU
)

252  
…f_gi
 =
RATE_MCS_HE_SU_4_LTF_08_GI
;

253  
Ál£
;

254 
	}
}

255 
IWL_EXPORT_SYMBOL
(
iwl_he_is_sgi
);

	@fw/runtime.h

6 #i‚de‡
__iwl_fw_ru¡ime_h__


7 
	#__iwl_fw_ru¡ime_h__


	)

9 
	~"iwl-c⁄fig.h
"

10 
	~"iwl-å™s.h
"

11 
	~"img.h
"

12 
	~"fw/≠i/debug.h
"

13 
	~"fw/≠i/∑gög.h
"

14 
	~"fw/≠i/powî.h
"

15 
	~"iwl-ì¥om-∑r£.h
"

16 
	~"fw/a˝i.h
"

17 
	~"fw/ªguœt‹y.h
"

19 
	siwl_fw_ru¡ime_›s
 {

20 (*
	mdump_°¨t
)(*
	m˘x
);

21 (*
	mdump_íd
)(*
	m˘x
);

22 
boﬁ
 (*
fw_ru¬ög
)(*
	m˘x
);

23 (*
	m£nd_hcmd
)(*
	m˘x
, 
iwl_ho°_cmd
 *
	mho°_cmd
);

24 
boﬁ
 (*
d3_debug_íabÀ
)(*
	m˘x
);

27 
	#MAX_NUM_LMAC
 2

	)

28 
	#MAX_NUM_TCM
 2

	)

29 
	#MAX_NUM_RCM
 2

	)

30 
	siwl_fwπ_sh¨ed_mem_cfg
 {

31 
	mnum_lmacs
;

32 
	mnum_txfifo_íåõs
;

34 
u32
 
	mtxfifo_size
[
TX_FIFO_MAX_NUM
];

35 
u32
 
	mrxfifo1_size
;

36 } 
	mlmac
[
MAX_NUM_LMAC
];

37 
u32
 
	mrxfifo2_size
;

38 
u32
 
	mrxfifo2_c⁄åﬁ_size
;

39 
u32
 
	möã∫Æ_txfifo_addr
;

40 
u32
 
	möã∫Æ_txfifo_size
[
TX_FIFO_INTERNAL_MAX_NUM
];

43 
	#IWL_FW_RUNTIME_DUMP_WK_NUM
 5

	)

50 
	siwl_fwπ_dump_d©a
 {

53 
iwl_fw_öi_åiggî_év
 *
	måig
;

54 
iwl_rx_∑ckë
 *
	mfw_pkt
;

57 c⁄° 
iwl_fw_dump_desc
 *
	mdesc
;

58 
boﬁ
 
	mm⁄ô‹_⁄ly
;

68 
	siwl_fwπ_wk_d©a
 {

69 
u8
 
	midx
;

70 
dñayed_w‹k
 
	mwk
;

71 
iwl_fwπ_dump_d©a
 
	mdump_d©a
;

81 
	siwl_txf_ôî_d©a
 {

82 
	mfifo
;

83 
	mlmac
;

84 
u32
 
	mfifo_size
;

85 
u8
 
	möã∫Æ_txf
;

110 
	siwl_fw_ru¡ime
 {

111 
iwl_å™s
 *
	må™s
;

112 c⁄° 
iwl_fw
 *
	mfw
;

113 
devi˚
 *
	mdev
;

115 c⁄° 
iwl_fw_ru¡ime_›s
 *
	m›s
;

116 *
	m›s_˘x
;

118 c⁄° 
iwl_dump_ßnôize_›s
 *
	mßnôize_›s
;

119 *
	mßnôize_˘x
;

122 
iwl_fw_∑gög
 
	mfw_∑gög_db
[
NUM_OF_FW_PAGING_BLOCKS
];

123 
u16
 
	mnum_of_∑gög_blk
;

124 
u16
 
	mnum_of_∑ges_ö_œ°_blk
;

126 
iwl_ucode_ty≥
 
	mcur_fw_img
;

129 
iwl_fwπ_sh¨ed_mem_cfg
 
	msmem_cfg
;

133 
iwl_fwπ_wk_d©a
 
	mwks
[
IWL_FW_RUNTIME_DUMP_WK_NUM
];

134 
	ma˘ive_wks
;

136 
u8
 
	mc⁄f
;

139 
	mn⁄_cﬁÀ˘_ts_°¨t
[
IWL_FW_INI_TIME_POINT_NUM
];

140 
u32
 *
	md3_debug_d©a
;

141 
u32
 
	mlmac_îr_id
[
MAX_NUM_LMAC
];

142 
u32
 
	mtcm_îr_id
[
MAX_NUM_TCM
];

143 
u32
 
	mrcm_îr_id
[
MAX_NUM_RCM
];

144 
u32
 
	mumac_îr_id
;

146 
iwl_txf_ôî_d©a
 
	mtxf_ôî_d©a
;

149 
u8
 
	mty≥
;

150 
u8
 
	msubty≥
;

151 
u32
 
	mlmac_maj‹
;

152 
u32
 
	mlmac_mö‹
;

153 
u32
 
	mumac_maj‹
;

154 
u32
 
	mumac_mö‹
;

155 } 
	mfw_vî
;

156 } 
	mdump
;

158 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


159 
dñayed_w‹k
 
	mwk
;

160 
u32
 
	mdñay
;

162 
u64
 
	m£q
;

163 } 
	mtime°amp
;

164 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


165 
boﬁ
 
	mçc_íabÀd
;

167 
iwl_ßr_¥ofûe
 
	mßr_¥ofûes
[
BIOS_SAR_MAX_PROFILE_NUM
];

168 
u8
 
	mßr_chaö_a_¥ofûe
;

169 
u8
 
	mßr_chaö_b_¥ofûe
;

170 
u8
 
	mªdu˚d_powî_Êags
;

171 
iwl_geo_¥ofûe
 
	mgeo_¥ofûes
[
BIOS_GEO_MAX_PROFILE_NUM
];

172 
u32
 
	mgeo_ªv
;

173 
u32
 
	mgeo_num_¥ofûes
;

174 
boﬁ
 
	mgeo_íabÀd
;

175 
iwl_µag_chaö
 
	mµag_chaös
[
IWL_NUM_CHAIN_LIMITS
];

176 
u32
 
	mµag_Êags
;

177 
u8
 
	mµag_vî
;

178 
iwl_ßr_off£t_m≠pög_cmd
 
	msgom_èbÀ
;

179 
boﬁ
 
	msgom_íabÀd
;

180 
iwl_u©s_èbÀ_cmd
 
	mu©s_èbÀ
;

181 
u8
 
	muefi_èbÀs_lock_°©us
;

182 
boﬁ
 
	mu©s_íabÀd
;

185 
iwl_fw_ru¡ime_öô
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_å™s
 *
å™s
,

186 c⁄° 
iwl_fw
 *
fw
,

187 c⁄° 
iwl_fw_ru¡ime_›s
 *
›s
, *
›s_˘x
,

188 c⁄° 
iwl_dump_ßnôize_›s
 *
ßnôize_›s
,

189 *
ßnôize_˘x
,

190 
díåy
 *
dbgfs_dú
);

192 
ölöe
 
	$iwl_fw_ru¡ime_‰ì
(
iwl_fw_ru¡ime
 *
fwπ
)

194 
i
;

196 
	`k‰ì
(
fwπ
->
dump
.
d3_debug_d©a
);

197 
fwπ
->
dump
.
d3_debug_d©a
 = 
NULL
;

199 
	`iwl_dbg_év_dñ_timîs
(
fwπ
->
å™s
);

200 
i
 = 0; i < 
IWL_FW_RUNTIME_DUMP_WK_NUM
; i++)

201 
	`ˇn˚l_dñayed_w‹k_sync
(&
fwπ
->
dump
.
wks
[
i
].
wk
);

202 
	}
}

204 
iwl_fw_ru¡ime_su•íd
(
iwl_fw_ru¡ime
 *
fwπ
);

206 
iwl_fw_ru¡ime_ªsume
(
iwl_fw_ru¡ime
 *
fwπ
);

208 
ölöe
 
	$iwl_fw_£t_cuºít_image
(
iwl_fw_ru¡ime
 *
fwπ
,

209 
iwl_ucode_ty≥
 
cur_fw_img
)

211 
fwπ
->
cur_fw_img
 = cur_fw_img;

212 
	}
}

214 
iwl_öô_∑gög
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_ucode_ty≥
 
ty≥
);

215 
iwl_‰ì_fw_∑gög
(
iwl_fw_ru¡ime
 *
fwπ
);

217 
iwl_gë_sh¨ed_mem_c⁄f
(
iwl_fw_ru¡ime
 *
fwπ
);

218 
iwl_£t_soc_œãncy
(
iwl_fw_ru¡ime
 *
fwπ
);

219 
iwl_c⁄figuª_rxq
(
iwl_fw_ru¡ime
 *
fwπ
);

	@fw/smem.c

7 
	~"iwl-drv.h
"

8 
	~"ru¡ime.h
"

9 
	~"fw/≠i/comm™ds.h
"

11 
	$iwl_∑r£_sh¨ed_mem_22000
(
iwl_fw_ru¡ime
 *
fwπ
,

12 
iwl_rx_∑ckë
 *
pkt
)

14 
iwl_sh¨ed_mem_cfg
 *
mem_cfg
 = (*)
pkt
->
d©a
;

15 
i
, 
lmac
;

16 
lmac_num
 = 
	`À32_to_˝u
(
mem_cfg
->lmac_num);

17 
u8
 
≠i_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
fwπ
->
fw
, 
SYSTEM_GROUP
,

18 
SHARED_MEM_CFG_CMD
, 0);

20 i‡(
	`WARN_ON
(
lmac_num
 > 
	`ARRAY_SIZE
(
mem_cfg
->
lmac_smem
)))

23 
fwπ
->
smem_cfg
.
num_lmacs
 = 
lmac_num
;

24 
fwπ
->
smem_cfg
.
num_txfifo_íåõs
 =

25 
	`ARRAY_SIZE
(
mem_cfg
->
lmac_smem
[0].
txfifo_size
);

26 
fwπ
->
smem_cfg
.
rxfifo2_size
 = 
	`À32_to_˝u
(
mem_cfg
->rxfifo2_size);

28 i‡(
≠i_vî
 >= 4 &&

29 !
	`WARN_ON_ONCE
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë< (*
mem_cfg
))) {

30 
fwπ
->
smem_cfg
.
rxfifo2_c⁄åﬁ_size
 =

31 
	`À32_to_˝u
(
mem_cfg
->
rxfifo2_c⁄åﬁ_size
);

34 
lmac
 = 0;Üma¯< 
lmac_num
;Ümac++) {

35 
iwl_sh¨ed_mem_lmac_cfg
 *
lmac_cfg
 =

36 &
mem_cfg
->
lmac_smem
[
lmac
];

38 
i
 = 0; i < 
	`ARRAY_SIZE
(
lmac_cfg
->
txfifo_size
); i++)

39 
fwπ
->
smem_cfg
.
lmac
[lmac].
txfifo_size
[
i
] =

40 
	`À32_to_˝u
(
lmac_cfg
->
txfifo_size
[
i
]);

41 
fwπ
->
smem_cfg
.
lmac
[lmac].
rxfifo1_size
 =

42 
	`À32_to_˝u
(
lmac_cfg
->
rxfifo1_size
);

44 
	}
}

46 
	$iwl_∑r£_sh¨ed_mem
(
iwl_fw_ru¡ime
 *
fwπ
,

47 
iwl_rx_∑ckë
 *
pkt
)

49 
iwl_sh¨ed_mem_cfg_v2
 *
mem_cfg
 = (*)
pkt
->
d©a
;

50 
i
;

52 
fwπ
->
smem_cfg
.
num_lmacs
 = 1;

54 
fwπ
->
smem_cfg
.
num_txfifo_íåõs
 = 
	`ARRAY_SIZE
(
mem_cfg
->
txfifo_size
);

55 
i
 = 0; i < 
	`ARRAY_SIZE
(
mem_cfg
->
txfifo_size
); i++)

56 
fwπ
->
smem_cfg
.
lmac
[0].
txfifo_size
[
i
] =

57 
	`À32_to_˝u
(
mem_cfg
->
txfifo_size
[
i
]);

59 
fwπ
->
smem_cfg
.
lmac
[0].
rxfifo1_size
 =

60 
	`À32_to_˝u
(
mem_cfg
->
rxfifo_size
[0]);

61 
fwπ
->
smem_cfg
.
rxfifo2_size
 = 
	`À32_to_˝u
(
mem_cfg
->
rxfifo_size
[1]);

64 i‡(
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

65 
IWL_UCODE_TLV_CAPA_EXTEND_SHARED_MEM_CFG
)) {

66 
	`BUILD_BUG_ON
((
fwπ
->
smem_cfg
.
öã∫Æ_txfifo_size
) !=

67 (
mem_cfg
->
öã∫Æ_txfifo_size
));

69 
fwπ
->
smem_cfg
.
öã∫Æ_txfifo_addr
 =

70 
	`À32_to_˝u
(
mem_cfg
->
öã∫Æ_txfifo_addr
);

72 
i
 = 0;

73 
i
 < 
	`ARRAY_SIZE
(
fwπ
->
smem_cfg
.
öã∫Æ_txfifo_size
);

74 
i
++)

75 
fwπ
->
smem_cfg
.
öã∫Æ_txfifo_size
[
i
] =

76 
	`À32_to_˝u
(
mem_cfg
->
öã∫Æ_txfifo_size
[
i
]);

78 
	}
}

80 
	$iwl_gë_sh¨ed_mem_c⁄f
(
iwl_fw_ru¡ime
 *
fwπ
)

82 
iwl_ho°_cmd
 
cmd
 = {

83 .
Êags
 = 
CMD_WANT_SKB
,

84 .
d©a
 = { 
NULL
, },

85 .
Àn
 = { 0, },

87 
iwl_rx_∑ckë
 *
pkt
;

88 
ªt
;

90 i‡(
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

91 
IWL_UCODE_TLV_CAPA_EXTEND_SHARED_MEM_CFG
))

92 
cmd
.
id
 = 
	`WIDE_ID
(
SYSTEM_GROUP
, 
SHARED_MEM_CFG_CMD
);

94 
cmd
.
id
 = 
SHARED_MEM_CFG
;

96 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
cmd
);

98 i‡(
ªt
) {

99 
	`WARN
(
ªt
 !-
ERFKILL
,

100 "CouldÇŸ sídÅhêSMEM comm™d: %d\n", 
ªt
);

104 
pkt
 = 
cmd
.
ª•_pkt
;

105 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
)

106 
	`iwl_∑r£_sh¨ed_mem_22000
(
fwπ
, 
pkt
);

108 
	`iwl_∑r£_sh¨ed_mem
(
fwπ
, 
pkt
);

110 
	`IWL_DEBUG_INFO
(
fwπ
, "SHARED MEM CFG: got memory offsets/sizes\n");

112 
	`iwl_‰ì_ª•
(&
cmd
);

113 
	}
}

114 
IWL_EXPORT_SYMBOL
(
iwl_gë_sh¨ed_mem_c⁄f
);

	@fw/uefi.c

6 
	~"iwl-drv.h
"

7 
	~"≤vm.h
"

8 
	~"iwl-¥ph.h
"

9 
	~"iwl-io.h
"

11 
	~"fw/uefi.h
"

12 
	~"fw/≠i/Æive.h
"

13 
	~<löux/efi.h
>

14 
	~"fw/ru¡ime.h
"

16 
	#IWL_EFI_VAR_GUID
 
	`EFI_GUID
(0x92daaf2f, 0xc02b, 0x455b, \

18 0x59, 0x4f, 0x4a, 0xó)

	)

20 
	siwl_uefi_≤vm_mem_desc
 {

21 
__À32
 
	maddr
;

22 
__À32
 
	msize
;

23 c⁄° 
u8
 
	md©a
[];

24 } 
	g__∑cked
;

26 *
	$iwl_uefi_gë_v¨übÀ
(
efi_ch¨16_t
 *
«me
, 
efi_guid_t
 *
guid
,

27 *
d©a_size
)

29 
efi_°©us_t
 
°©us
;

30 *
d©a
;

32 i‡(!
d©a_size
)

33  
	`ERR_PTR
(-
EINVAL
);

35 i‡(!
	`efi_π_£rvi˚s_suµ‹ãd
(
EFI_RT_SUPPORTED_GET_VARIABLE
))

36  
	`ERR_PTR
(-
ENODEV
);

39 *
d©a_size
 = 0;

40 
°©us
 = 
efi
.
	`gë_v¨übÀ
(
«me
, 
guid
, 
NULL
, 
d©a_size
, NULL);

41 i‡(
°©us
 !
EFI_BUFFER_TOO_SMALL
 || !*
d©a_size
)

42  
	`ERR_PTR
(-
EIO
);

44 
d©a
 = 
	`kmÆloc
(*
d©a_size
, 
GFP_KERNEL
);

45 i‡(!
d©a
)

46  
	`ERR_PTR
(-
ENOMEM
);

48 
°©us
 = 
efi
.
	`gë_v¨übÀ
(
«me
, 
guid
, 
NULL
, 
d©a_size
, 
d©a
);

49 i‡(
°©us
 !
EFI_SUCCESS
) {

50 
	`k‰ì
(
d©a
);

51  
	`ERR_PTR
(-
ENOENT
);

54  
d©a
;

55 
	}
}

57 *
	$iwl_uefi_gë_≤vm
(
iwl_å™s
 *
å™s
, 
size_t
 *
Àn
)

59 
∑ckage_size
;

60 *
d©a
;

62 *
Àn
 = 0;

64 
d©a
 = 
	`iwl_uefi_gë_v¨übÀ
(
IWL_UEFI_OEM_PNVM_NAME
, &
IWL_EFI_VAR_GUID
,

65 &
∑ckage_size
);

66 i‡(
	`IS_ERR
(
d©a
)) {

67 
	`IWL_DEBUG_FW
(
å™s
,

69 
	`PTR_ERR
(
d©a
), 
∑ckage_size
);

70  
d©a
;

73 
	`IWL_DEBUG_FW
(
å™s
, "Ród PNVM from UEFI wôh sizê%lu\n", 
∑ckage_size
);

74 *
Àn
 = 
∑ckage_size
;

76  
d©a
;

77 
	}
}

80 *
	$iwl_uefi_gë_vîifõd_v¨übÀ
(
iwl_å™s
 *
å™s
,

81 
efi_ch¨16_t
 *
uefi_v¨_«me
,

82 *
v¨_«me
,

83 
ex≥˘ed_size
,

84 *
size
)

86 *
v¨
;

87 
v¨_size
;

89 
v¨
 = 
	`iwl_uefi_gë_v¨übÀ
(
uefi_v¨_«me
, &
IWL_EFI_VAR_GUID
,

90 &
v¨_size
);

92 i‡(
	`IS_ERR
(
v¨
)) {

93 
	`IWL_DEBUG_RADIO
(
å™s
,

94 "%†UEFI v¨übÀÇŸ found 0x%lx\n", 
v¨_«me
,

95 
	`PTR_ERR
(
v¨
));

96  
v¨
;

99 i‡(
v¨_size
 < 
ex≥˘ed_size
) {

100 
	`IWL_DEBUG_RADIO
(
å™s
,

102 
v¨_«me
, 
v¨_size
);

103 
	`k‰ì
(
v¨
);

104  
	`ERR_PTR
(-
EINVAL
);

107 
	`IWL_DEBUG_RADIO
(
å™s
, "%†‰om UEFI wôh sizê%lu\n", 
v¨_«me
,

108 
v¨_size
);

110 i‡(
size
)

111 *
size
 = 
v¨_size
;

112  
v¨
;

113 
	}
}

115 
	$iwl_uefi_h™dÀ_év_mem_desc
(
iwl_å™s
 *
å™s
, c⁄° 
u8
 *
d©a
,

116 
u32
 
év_Àn
, 
iwl_≤vm_image
 *
≤vm_d©a
)

118 c⁄° 
iwl_uefi_≤vm_mem_desc
 *
desc
 = (c⁄° *)
d©a
;

119 
u32
 
d©a_Àn
;

121 i‡(
év_Àn
 < (*
desc
)) {

122 
	`IWL_DEBUG_FW
(
å™s
, "TLVÜí (%dËi†toÿsmÆl\n", 
év_Àn
);

123  -
EINVAL
;

126 
d©a_Àn
 = 
év_Àn
 - (*
desc
);

128 
	`IWL_DEBUG_FW
(
å™s
,

130 
év_Àn
, 
d©a_Àn
);

132 i‡(
	`À32_to_˝u
(
desc
->
size
Ë!
d©a_Àn
) {

133 
	`IWL_DEBUG_FW
(
å™s
, "övÆid mem des¯sizê%d\n", 
desc
->
size
);

134  -
EINVAL
;

137 i‡(
≤vm_d©a
->
n_chunks
 =
IPC_DRAM_MAP_ENTRY_NUM_MAX
) {

138 
	`IWL_DEBUG_FW
(
å™s
, "too manyÖayloadsÅoállocate in DRAM.\n");

139  -
EINVAL
;

142 
	`IWL_DEBUG_FW
(
å™s
, "Addög d©®(sizê%d)\n", 
d©a_Àn
);

144 
≤vm_d©a
->
chunks
[≤vm_d©a->
n_chunks
].
d©a
 = 
desc
->data;

145 
≤vm_d©a
->
chunks
[≤vm_d©a->
n_chunks
].
Àn
 = 
d©a_Àn
;

146 
≤vm_d©a
->
n_chunks
++;

149 
	}
}

151 
	$iwl_uefi_ªdu˚_powî_£˘i⁄
(
iwl_å™s
 *
å™s
,

152 c⁄° 
u8
 *
d©a
, 
size_t
 
Àn
,

153 
iwl_≤vm_image
 *
≤vm_d©a
)

155 c⁄° 
iwl_ucode_év
 *
év
;

157 
	`IWL_DEBUG_FW
(
å™s
, "Handling REDUCE_POWER section\n");

158 
	`mem£t
(
≤vm_d©a
, 0, (*pnvm_data));

160 
Àn
 >(*
év
)) {

161 
u32
 
év_Àn
, 
év_ty≥
;

163 
Àn
 -(*
év
);

164 
év
 = (c⁄° *)
d©a
;

166 
év_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

167 
év_ty≥
 = 
	`À32_to_˝u
(
év
->
ty≥
);

169 i‡(
Àn
 < 
év_Àn
) {

170 
	`IWL_ERR
(
å™s
, "invalid TLVÜen: %zd/%u\n",

171 
Àn
, 
év_Àn
);

172  -
EINVAL
;

175 
d©a
 +(*
év
);

177 
év_ty≥
) {

178 
IWL_UCODE_TLV_MEM_DESC
:

179 i‡(
	`iwl_uefi_h™dÀ_év_mem_desc
(
å™s
, 
d©a
, 
év_Àn
,

180 
≤vm_d©a
))

181  -
EINVAL
;

183 
IWL_UCODE_TLV_PNVM_SKU
:

184 
	`IWL_DEBUG_FW
(
å™s
,

186 
d⁄e
;

188 
	`IWL_DEBUG_FW
(
å™s
, "Found TLV 0x%0x,Üen %d\n",

189 
év_ty≥
, 
év_Àn
);

193 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

194 
d©a
 +
	`ALIGN
(
év_Àn
, 4);

197 
d⁄e
:

198 i‡(!
≤vm_d©a
->
n_chunks
) {

199 
	`IWL_DEBUG_FW
(
å™s
, "Empty REDUCE_POWER, skipping.\n");

200  -
ENOENT
;

203 
	}
}

205 
	$iwl_uefi_ªdu˚_powî_∑r£
(
iwl_å™s
 *
å™s
,

206 c⁄° 
u8
 *
d©a
, 
size_t
 
Àn
,

207 
iwl_≤vm_image
 *
≤vm_d©a
)

209 c⁄° 
iwl_ucode_év
 *
év
;

211 
	`IWL_DEBUG_FW
(
å™s
, "Parsing REDUCE_POWER data\n");

213 
Àn
 >(*
év
)) {

214 
u32
 
év_Àn
, 
év_ty≥
;

216 
Àn
 -(*
év
);

217 
év
 = (c⁄° *)
d©a
;

219 
év_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

220 
év_ty≥
 = 
	`À32_to_˝u
(
év
->
ty≥
);

222 i‡(
Àn
 < 
év_Àn
) {

223 
	`IWL_ERR
(
å™s
, "invalid TLVÜen: %zd/%u\n",

224 
Àn
, 
év_Àn
);

225  -
EINVAL
;

228 i‡(
év_ty≥
 =
IWL_UCODE_TLV_PNVM_SKU
) {

229 c⁄° 
iwl_sku_id
 *
sku_id
 =

230 (c⁄° *)(
d©a
 + (*
év
));

232 
	`IWL_DEBUG_FW
(
å™s
,

234 
év_Àn
);

235 
	`IWL_DEBUG_FW
(
å™s
, "sku_id 0x%0x 0x%0x 0x%0x\n",

236 
	`À32_to_˝u
(
sku_id
->
d©a
[0]),

237 
	`À32_to_˝u
(
sku_id
->
d©a
[1]),

238 
	`À32_to_˝u
(
sku_id
->
d©a
[2]));

240 
d©a
 +(*
év
Ë+ 
	`ALIGN
(
év_Àn
, 4);

241 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

243 i‡(
å™s
->
sku_id
[0] =
	`À32_to_˝u
(sku_id->
d©a
[0]) &&

244 
å™s
->
sku_id
[1] =
	`À32_to_˝u
(sku_id->
d©a
[1]) &&

245 
å™s
->
sku_id
[2] =
	`À32_to_˝u
(sku_id->
d©a
[2])) {

246 
ªt
 = 
	`iwl_uefi_ªdu˚_powî_£˘i⁄
(
å™s
,

247 
d©a
, 
Àn
,

248 
≤vm_d©a
);

249 i‡(!
ªt
)

252 
	`IWL_DEBUG_FW
(
å™s
, "SKU ID didn't match!\n");

255 
d©a
 +(*
év
Ë+ 
	`ALIGN
(
év_Àn
, 4);

256 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

260  -
ENOENT
;

261 
	}
}

263 
u8
 *
	$iwl_uefi_gë_ªdu˚d_powî
(
iwl_å™s
 *
å™s
, 
size_t
 *
Àn
)

265 
≤vm_sku_∑ckage
 *
∑ckage
;

266 
∑ckage_size
;

267 
u8
 *
d©a
;

269 
∑ckage
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
å™s
,

270 
IWL_UEFI_REDUCED_POWER_NAME
,

272 (*
∑ckage
),

273 &
∑ckage_size
);

274 i‡(
	`IS_ERR
(
∑ckage
))

275  
	`ERR_CAST
(
∑ckage
);

277 
	`IWL_DEBUG_FW
(
å™s
, "rev %d,Åotal_size %d,Ç_skus %d\n",

278 
∑ckage
->
ªv
,Öackage->
tŸÆ_size
,Öackage->
n_skus
);

280 *
Àn
 = 
∑ckage_size
 - (*
∑ckage
);

281 
d©a
 = 
	`kmemdup
(
∑ckage
->d©a, *
Àn
, 
GFP_KERNEL
);

282 i‡(!
d©a
) {

283 
	`k‰ì
(
∑ckage
);

284  
	`ERR_PTR
(-
ENOMEM
);

287 
	`k‰ì
(
∑ckage
);

289  
d©a
;

290 
	}
}

292 
	$iwl_uefi_°ï_∑r£
(
uefi_˙v_comm⁄_°ï_d©a
 *
comm⁄_°ï_d©a
,

293 
iwl_å™s
 *
å™s
)

295 i‡(
comm⁄_°ï_d©a
->
ªvisi⁄
 != 1)

296  -
EINVAL
;

298 
å™s
->
mbx_addr_0_°ï
 = (
u32
)
comm⁄_°ï_d©a
->
ªvisi⁄
 |

299 (
u32
)
comm⁄_°ï_d©a
->
˙vi_eq_ch™√l
 << 8 |

300 (
u32
)
comm⁄_°ï_d©a
->
˙vr_eq_ch™√l
 << 16 |

301 (
u32
)
comm⁄_°ï_d©a
->
ødio1
 << 24;

302 
å™s
->
mbx_addr_1_°ï
 = (
u32
)
comm⁄_°ï_d©a
->
ødio2
;

304 
	}
}

306 
	$iwl_uefi_gë_°ï_èbÀ
(
iwl_å™s
 *
å™s
)

308 
uefi_˙v_comm⁄_°ï_d©a
 *
d©a
;

309 
ªt
;

311 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

314 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
å™s
, 
IWL_UEFI_STEP_NAME
,

315 "STEP", (*
d©a
), 
NULL
);

316 i‡(
	`IS_ERR
(
d©a
))

319 
ªt
 = 
	`iwl_uefi_°ï_∑r£
(
d©a
, 
å™s
);

320 i‡(
ªt
 < 0)

321 
	`IWL_DEBUG_FW
(
å™s
, "CannotÑead STEPÅables.Ñev is invalid\n");

323 
	`k‰ì
(
d©a
);

324 
	}
}

325 
IWL_EXPORT_SYMBOL
(
iwl_uefi_gë_°ï_èbÀ
);

327 
	$iwl_uefi_sgom_∑r£
(
uefi_˙v_wœn_sgom_d©a
 *
sgom_d©a
,

328 
iwl_fw_ru¡ime
 *
fwπ
)

330 
i
, 
j
;

332 i‡(
sgom_d©a
->
ªvisi⁄
 != 1)

333  -
EINVAL
;

335 
	`mem˝y
(
fwπ
->
sgom_èbÀ
.
off£t_m≠
, 
sgom_d©a
->offset_map,

336 (
fwπ
->
sgom_èbÀ
.
off£t_m≠
));

338 
i
 = 0; i < 
MCC_TO_SAR_OFFSET_TABLE_ROW_SIZE
; i++) {

339 
j
 = 0; j < 
MCC_TO_SAR_OFFSET_TABLE_COL_SIZE
; j++) {

343 
u8
 
vÆue
 = 
fwπ
->
sgom_èbÀ
.
off£t_m≠
[
i
][
j
];

344 
u8
 
low
 = 
vÆue
 & 0xF;

345 
u8
 
high
 = (
vÆue
 & 0xF0) >> 4;

347 i‡(
high
 > 
fwπ
->
geo_num_¥ofûes
)

348 
high
 = 0;

349 i‡(
low
 > 
fwπ
->
geo_num_¥ofûes
)

350 
low
 = 0;

351 
fwπ
->
sgom_èbÀ
.
off£t_m≠
[
i
][
j
] = (
high
 << 4Ë| 
low
;

355 
fwπ
->
sgom_íabÀd
 = 
åue
;

357 
	}
}

359 
	$iwl_uefi_gë_sgom_èbÀ
(
iwl_å™s
 *
å™s
,

360 
iwl_fw_ru¡ime
 *
fwπ
)

362 
uefi_˙v_wœn_sgom_d©a
 *
d©a
;

363 
ªt
;

365 i‡(!
fwπ
->
geo_íabÀd
)

368 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
å™s
, 
IWL_UEFI_SGOM_NAME
,

369 "SGOM", (*
d©a
), 
NULL
);

370 i‡(
	`IS_ERR
(
d©a
))

373 
ªt
 = 
	`iwl_uefi_sgom_∑r£
(
d©a
, 
fwπ
);

374 i‡(
ªt
 < 0)

375 
	`IWL_DEBUG_FW
(
å™s
, "CannotÑead SGOMÅables.Ñev is invalid\n");

377 
	`k‰ì
(
d©a
);

378 
	}
}

379 
IWL_EXPORT_SYMBOL
(
iwl_uefi_gë_sgom_èbÀ
);

381 
	$iwl_uefi_u©s_∑r£
(
uefi_˙v_wœn_u©s_d©a
 *
u©s_d©a
,

382 
iwl_fw_ru¡ime
 *
fwπ
)

384 i‡(
u©s_d©a
->
ªvisi⁄
 != 1)

385  -
EINVAL
;

387 
	`mem˝y
(
fwπ
->
u©s_èbÀ
.
off£t_m≠
, 
u©s_d©a
->offset_map,

388 (
fwπ
->
u©s_èbÀ
.
off£t_m≠
));

390 
	}
}

392 
	$iwl_uefi_gë_u©s_èbÀ
(
iwl_å™s
 *
å™s
,

393 
iwl_fw_ru¡ime
 *
fwπ
)

395 
uefi_˙v_wœn_u©s_d©a
 *
d©a
;

396 
ªt
;

398 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
å™s
, 
IWL_UEFI_UATS_NAME
,

399 "UATS", (*
d©a
), 
NULL
);

400 i‡(
	`IS_ERR
(
d©a
))

401  -
EINVAL
;

403 
ªt
 = 
	`iwl_uefi_u©s_∑r£
(
d©a
, 
fwπ
);

404 i‡(
ªt
 < 0) {

405 
	`IWL_DEBUG_FW
(
å™s
, "CannotÑead UATSÅable.Ñev is invalid\n");

406 
	`k‰ì
(
d©a
);

407  
ªt
;

410 
	`k‰ì
(
d©a
);

412 
	}
}

413 
IWL_EXPORT_SYMBOL
(
iwl_uefi_gë_u©s_èbÀ
);

415 
	$iwl_uefi_£t_ßr_¥ofûe
(
iwl_fw_ru¡ime
 *
fwπ
,

416 
uefi_ßr_¥ofûe
 *
uefi_ßr_¥of
,

417 
u8
 
¥of_ödex
, 
boﬁ
 
íabÀd
)

419 
	`mem˝y
(&
fwπ
->
ßr_¥ofûes
[
¥of_ödex
].
chaös
, 
uefi_ßr_¥of
,

420 (
uefi_ßr_¥ofûe
));

422 
fwπ
->
ßr_¥ofûes
[
¥of_ödex
].
íabÀd
 =É«bÀd & 
IWL_SAR_ENABLE_MSK
;

423 
	}
}

425 
	$iwl_uefi_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

427 
uefi_˙v_v¨_wrds
 *
d©a
;

428 
ªt
 = 0;

430 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_WRDS_NAME
,

431 "WRDS", (*
d©a
), 
NULL
);

432 i‡(
	`IS_ERR
(
d©a
))

433  -
EINVAL
;

435 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_WRDS_REVISION
) {

436 
ªt
 = -
EINVAL
;

437 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI WRDSÑevision:%d\n",

438 
d©a
->
ªvisi⁄
);

439 
out
;

445 
	`iwl_uefi_£t_ßr_¥ofûe
(
fwπ
, &
d©a
->
ßr_¥ofûe
, 0, d©a->
mode
);

446 
out
:

447 
	`k‰ì
(
d©a
);

448  
ªt
;

449 
	}
}

451 
	$iwl_uefi_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

453 
uefi_˙v_v¨_ewrd
 *
d©a
;

454 
i
, 
ªt
 = 0;

456 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_EWRD_NAME
,

457 "EWRD", (*
d©a
), 
NULL
);

458 i‡(
	`IS_ERR
(
d©a
))

459  -
EINVAL
;

461 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_EWRD_REVISION
) {

462 
ªt
 = -
EINVAL
;

463 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI EWRDÑevision:%d\n",

464 
d©a
->
ªvisi⁄
);

465 
out
;

468 i‡(
d©a
->
num_¥ofûes
 >
BIOS_SAR_MAX_PROFILE_NUM
) {

469 
ªt
 = -
EINVAL
;

470 
out
;

473 
i
 = 0; i < 
d©a
->
num_¥ofûes
; i++)

478 
	`iwl_uefi_£t_ßr_¥ofûe
(
fwπ
, &
d©a
->
ßr_¥ofûes
[
i
], i + 1,

479 
d©a
->
mode
);

481 
out
:

482 
	`k‰ì
(
d©a
);

483  
ªt
;

484 
	}
}

486 
	$iwl_uefi_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

488 
uefi_˙v_v¨_wgds
 *
d©a
;

489 
i
, 
ªt
 = 0;

491 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_WGDS_NAME
,

492 "WGDS", (*
d©a
), 
NULL
);

493 i‡(
	`IS_ERR
(
d©a
))

494  -
EINVAL
;

496 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_WGDS_REVISION
) {

497 
ªt
 = -
EINVAL
;

498 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI WGDSÑevision:%d\n",

499 
d©a
->
ªvisi⁄
);

500 
out
;

503 i‡(
d©a
->
num_¥ofûes
 < 
BIOS_GEO_MIN_PROFILE_NUM
 ||

504 
d©a
->
num_¥ofûes
 > 
BIOS_GEO_MAX_PROFILE_NUM
) {

505 
ªt
 = -
EINVAL
;

506 
	`IWL_DEBUG_RADIO
(
fwπ
, "InvalidÇumber ofÖrofiles in WGDS: %d\n",

507 
d©a
->
num_¥ofûes
);

508 
out
;

511 
fwπ
->
geo_ªv
 = 
d©a
->
ªvisi⁄
;

512 
i
 = 0; i < 
d©a
->
num_¥ofûes
; i++)

513 
	`mem˝y
(&
fwπ
->
geo_¥ofûes
[
i
], &
d©a
->geo_profiles[i],

514 (
iwl_geo_¥ofûe
));

516 
fwπ
->
geo_num_¥ofûes
 = 
d©a
->
num_¥ofûes
;

517 
fwπ
->
geo_íabÀd
 = 
åue
;

518 
out
:

519 
	`k‰ì
(
d©a
);

520  
ªt
;

521 
	}
}

523 
	$iwl_uefi_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

525 
uefi_˙v_v¨_µag
 *
d©a
;

526 
ªt
 = 0;

528 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_PPAG_NAME
,

529 "PPAG", (*
d©a
), 
NULL
);

530 i‡(
	`IS_ERR
(
d©a
))

531  -
EINVAL
;

533 i‡(
d©a
->
ªvisi⁄
 < 
IWL_UEFI_MIN_PPAG_REV
 ||

534 
d©a
->
ªvisi⁄
 > 
IWL_UEFI_MAX_PPAG_REV
) {

535 
ªt
 = -
EINVAL
;

536 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI PPAGÑevision:%d\n",

537 
d©a
->
ªvisi⁄
);

538 
out
;

541 
fwπ
->
µag_vî
 = 
d©a
->
ªvisi⁄
;

542 
fwπ
->
µag_Êags
 = 
	`iwl_bios_gë_µag_Êags
(
d©a
->
µag_modes
,

543 
fwπ
->
µag_vî
);

545 
	`BUILD_BUG_ON
((
fwπ
->
µag_chaös
Ë!(
d©a
->ppag_chains));

546 
	`mem˝y
(&
fwπ
->
µag_chaös
, &
d©a
->ppag_chains,

547 (
d©a
->
µag_chaös
));

548 
out
:

549 
	`k‰ì
(
d©a
);

550  
ªt
;

551 
	}
}

553 
	$iwl_uefi_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

554 
iwl_ès_d©a
 *
ès_d©a
)

556 
uefi_˙v_v¨_wès
 *
uefi_ès
;

557 
ªt
 = 0, 
íabÀd
, 
i
;

559 
uefi_ès
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_WTAS_NAME
,

560 "WTAS", (*
uefi_ès
), 
NULL
);

561 i‡(
	`IS_ERR
(
uefi_ès
))

562  -
EINVAL
;

564 i‡(
uefi_ès
->
ªvisi⁄
 !
IWL_UEFI_WTAS_REVISION
) {

565 
ªt
 = -
EINVAL
;

566 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI WTASÑevision:%d\n",

567 
uefi_ès
->
ªvisi⁄
);

568 
out
;

571 
íabÀd
 = 
	`iwl_∑r£_ès_£À˘i⁄
(
fwπ
, 
ès_d©a
,

572 
uefi_ès
->
ès_£À˘i⁄
);

573 i‡(!
íabÀd
) {

574 
	`IWL_DEBUG_RADIO
(
fwπ
, "TASÇotÉnabled\n");

575 
ªt
 = 0;

576 
out
;

579 
	`IWL_DEBUG_RADIO
(
fwπ
, "Reading TASÅableÑevision %d\n",

580 
uefi_ès
->
ªvisi⁄
);

581 i‡(
uefi_ès
->
bœck_li°_size
 > 
IWL_WTAS_BLACK_LIST_MAX
) {

582 
	`IWL_DEBUG_RADIO
(
fwπ
, "TAS invalidárray size %d\n",

583 
uefi_ès
->
bœck_li°_size
);

584 
ªt
 = -
EINVAL
;

585 
out
;

587 
ès_d©a
->
block_li°_size
 = 
	`˝u_to_À32
(
uefi_ès
->
bœck_li°_size
);

588 
	`IWL_DEBUG_RADIO
(
fwπ
, "TASáºay sizê%u\n", 
uefi_ès
->
bœck_li°_size
);

590 
i
 = 0; i < 
uefi_ès
->
bœck_li°_size
; i++) {

591 
ès_d©a
->
block_li°_¨øy
[
i
] =

592 
	`˝u_to_À32
(
uefi_ès
->
bœck_li°
[
i
]);

593 
	`IWL_DEBUG_RADIO
(
fwπ
, "TAS blockÜist country %d\n",

594 
uefi_ès
->
bœck_li°
[
i
]);

596 
out
:

597 
	`k‰ì
(
uefi_ès
);

598  
ªt
;

599 
	}
}

601 
	$iwl_uefi_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
,

602 
u64
 *
dÊt_pwr_limô
)

604 
uefi_˙v_v¨_•lc
 *
d©a
;

605 
ªt
 = 0;

607 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_SPLC_NAME
,

608 "SPLC", (*
d©a
), 
NULL
);

609 i‡(
	`IS_ERR
(
d©a
))

610  -
EINVAL
;

612 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_SPLC_REVISION
) {

613 
ªt
 = -
EINVAL
;

614 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI SPLCÑevision:%d\n",

615 
d©a
->
ªvisi⁄
);

616 
out
;

618 *
dÊt_pwr_limô
 = 
d©a
->
deÁu…_pwr_limô
;

619 
out
:

620 
	`k‰ì
(
d©a
);

621  
ªt
;

622 
	}
}

624 
	$iwl_uefi_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
)

626 
uefi_˙v_v¨_wrdd
 *
d©a
;

627 
ªt
 = 0;

629 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_WRDD_NAME
,

630 "WRDD", (*
d©a
), 
NULL
);

631 i‡(
	`IS_ERR
(
d©a
))

632  -
EINVAL
;

634 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_WRDD_REVISION
) {

635 
ªt
 = -
EINVAL
;

636 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI WRDDÑevision:%d\n",

637 
d©a
->
ªvisi⁄
);

638 
out
;

641 i‡(
d©a
->
mcc
 !
UEFI_MCC_CHINA
) {

642 
ªt
 = -
EINVAL
;

643 
	`IWL_DEBUG_RADIO
(
fwπ
, "UEFI WRDD is supported only for CN\n");

644 
out
;

647 
mcc
[0] = (
d©a
->mcc >> 8) & 0xff;

648 
mcc
[1] = 
d©a
->mcc & 0xff;

649 
mcc
[2] = '\0';

650 
out
:

651 
	`k‰ì
(
d©a
);

652  
ªt
;

653 
	}
}

655 
	$iwl_uefi_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
exé_˛k
)

657 
uefi_˙v_v¨_eckv
 *
d©a
;

658 
ªt
 = 0;

660 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_ECKV_NAME
,

661 "ECKV", (*
d©a
), 
NULL
);

662 i‡(
	`IS_ERR
(
d©a
))

663  -
EINVAL
;

665 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_ECKV_REVISION
) {

666 
ªt
 = -
EINVAL
;

667 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI WRDDÑevision:%d\n",

668 
d©a
->
ªvisi⁄
);

669 
out
;

671 *
exé_˛k
 = 
d©a
->
ext_˛ock_vÆid
;

672 
out
:

673 
	`k‰ì
(
d©a
);

674  
ªt
;

675 
	}
}

677 
	$iwl_uefi_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_dsm_funcs
 
func
,

678 
u32
 *
vÆue
)

680 
uefi_˙v_v¨_gíîÆ_cfg
 *
d©a
;

681 
ªt
 = -
EINVAL
;

684 i‡(
func
 >
DSM_FUNC_NUM_FUNCS
 || func == 5)

685  -
EOPNOTSUPP
;

687 
d©a
 = 
	`iwl_uefi_gë_vîifõd_v¨übÀ
(
fwπ
->
å™s
, 
IWL_UEFI_DSM_NAME
,

688 "DSM", (*
d©a
), 
NULL
);

689 i‡(
	`IS_ERR
(
d©a
))

690  -
EINVAL
;

692 i‡(
d©a
->
ªvisi⁄
 !
IWL_UEFI_DSM_REVISION
) {

693 
	`IWL_DEBUG_RADIO
(
fwπ
, "Unsupported UEFI DSMÑevision:%d\n",

694 
d©a
->
ªvisi⁄
);

695 
out
;

698 i‡(
	`ARRAY_SIZE
(
d©a
->
fun˘i⁄s
Ë!
UEFI_MAX_DSM_FUNCS
) {

699 
	`IWL_DEBUG_RADIO
(
fwπ
, "Invalid size of DSM functionsárray\n");

700 
out
;

703 *
vÆue
 = 
d©a
->
fun˘i⁄s
[
func
];

704 
ªt
 = 0;

705 
out
:

706 
	`k‰ì
(
d©a
);

707  
ªt
;

708 
	}
}

	@fw/uefi.h

5 #i‚de‡
__iwl_fw_uefi__


6 
	#__iwl_fw_uefi__


	)

8 
	~"fw/ªguœt‹y.h
"

10 
	#IWL_UEFI_OEM_PNVM_NAME
 
L
"UefiCnvWœnOemSig√dPnvm"

	)

11 
	#IWL_UEFI_REDUCED_POWER_NAME
 
L
"UefiCnvWœnRedu˚dPowî"

	)

12 
	#IWL_UEFI_SGOM_NAME
 
L
"UefiCnvWœnS¨GeoOff£tM≠pög"

	)

13 
	#IWL_UEFI_STEP_NAME
 
L
"UefiCnvComm⁄STEP"

	)

14 
	#IWL_UEFI_UATS_NAME
 
L
"CnvUefiWœnUATS"

	)

15 
	#IWL_UEFI_WRDS_NAME
 
L
"UefiCnvWœnWRDS"

	)

16 
	#IWL_UEFI_EWRD_NAME
 
L
"UefiCnvWœnEWRD"

	)

17 
	#IWL_UEFI_WGDS_NAME
 
L
"UefiCnvWœnWGDS"

	)

18 
	#IWL_UEFI_PPAG_NAME
 
L
"UefiCnvWœnPPAG"

	)

19 
	#IWL_UEFI_WTAS_NAME
 
L
"UefiCnvWœnWTAS"

	)

20 
	#IWL_UEFI_SPLC_NAME
 
L
"UefiCnvWœnSPLC"

	)

21 
	#IWL_UEFI_WRDD_NAME
 
L
"UefiCnvWœnWRDD"

	)

22 
	#IWL_UEFI_ECKV_NAME
 
L
"UefiCnvWœnECKV"

	)

23 
	#IWL_UEFI_DSM_NAME
 
L
"UefiCnvWœnGíîÆCfg"

	)

26 
	#IWL_SGOM_MAP_SIZE
 339

	)

27 
	#IWL_UATS_MAP_SIZE
 339

	)

29 
	#IWL_UEFI_WRDS_REVISION
 2

	)

30 
	#IWL_UEFI_EWRD_REVISION
 2

	)

31 
	#IWL_UEFI_WGDS_REVISION
 3

	)

32 
	#IWL_UEFI_MIN_PPAG_REV
 1

	)

33 
	#IWL_UEFI_MAX_PPAG_REV
 3

	)

34 
	#IWL_UEFI_WTAS_REVISION
 1

	)

35 
	#IWL_UEFI_SPLC_REVISION
 0

	)

36 
	#IWL_UEFI_WRDD_REVISION
 0

	)

37 
	#IWL_UEFI_ECKV_REVISION
 0

	)

38 
	#IWL_UEFI_DSM_REVISION
 4

	)

40 
	s≤vm_sku_∑ckage
 {

41 
u8
 
	mªv
;

42 
u32
 
	mtŸÆ_size
;

43 
u8
 
	mn_skus
;

44 
u32
 
	mª£rved
[2];

45 
u8
 
	md©a
[];

46 } 
	g__∑cked
;

48 
	suefi_˙v_wœn_sgom_d©a
 {

49 
u8
 
	mªvisi⁄
;

50 
u8
 
	moff£t_m≠
[
IWL_SGOM_MAP_SIZE
 - 1];

51 } 
	g__∑cked
;

53 
	suefi_˙v_wœn_u©s_d©a
 {

54 
u8
 
	mªvisi⁄
;

55 
u8
 
	moff£t_m≠
[
IWL_UATS_MAP_SIZE
 - 1];

56 } 
	g__∑cked
;

58 
	suefi_˙v_comm⁄_°ï_d©a
 {

59 
u8
 
	mªvisi⁄
;

60 
u8
 
	m°ï_mode
;

61 
u8
 
	m˙vi_eq_ch™√l
;

62 
u8
 
	m˙vr_eq_ch™√l
;

63 
u8
 
	mødio1
;

64 
u8
 
	mødio2
;

65 } 
	g__∑cked
;

72 
	suefi_ßr_¥ofûe
 {

73 
iwl_ßr_¥ofûe_chaö
 
	mchaös
[
BIOS_SAR_MAX_CHAINS_PER_PROFILE
];

74 } 
	g__∑cked
;

83 
	suefi_˙v_v¨_wrds
 {

84 
u8
 
	mªvisi⁄
;

85 
u32
 
	mmode
;

86 
uefi_ßr_¥ofûe
 
	mßr_¥ofûe
;

87 } 
	g__∑cked
;

96 
	suefi_˙v_v¨_ewrd
 {

97 
u8
 
	mªvisi⁄
;

98 
u32
 
	mmode
;

99 
u32
 
	mnum_¥ofûes
;

100 
uefi_ßr_¥ofûe
 
	mßr_¥ofûes
[
BIOS_SAR_MAX_PROFILE_NUM
 - 1];

101 } 
	g__∑cked
;

110 
	suefi_˙v_v¨_wgds
 {

111 
u8
 
	mªvisi⁄
;

112 
u8
 
	mnum_¥ofûes
;

113 
iwl_geo_¥ofûe
 
	mgeo_¥ofûes
[
BIOS_GEO_MAX_PROFILE_NUM
];

114 } 
	g__∑cked
;

122 
	suefi_˙v_v¨_µag
 {

123 
u8
 
	mªvisi⁄
;

124 
u32
 
	mµag_modes
;

125 
iwl_µag_chaö
 
	mµag_chaös
[
IWL_NUM_CHAIN_LIMITS
];

126 } 
	g__∑cked
;

134 
	suefi_˙v_v¨_wès
 {

135 
u8
 
	mªvisi⁄
;

136 
u32
 
	mès_£À˘i⁄
;

137 
u8
 
	mbœck_li°_size
;

138 
u16
 
	mbœck_li°
[
IWL_WTAS_BLACK_LIST_MAX
];

139 } 
	g__∑cked
;

145 
	suefi_˙v_v¨_•lc
 {

146 
u8
 
	mªvisi⁄
;

147 
u32
 
	mdeÁu…_pwr_limô
;

148 } 
	g__∑cked
;

150 
	#UEFI_MCC_CHINA
 0x434e

	)

156 
	suefi_˙v_v¨_wrdd
 {

157 
u8
 
	mªvisi⁄
;

158 
u32
 
	mmcc
;

159 } 
	g__∑cked
;

165 
	suefi_˙v_v¨_eckv
 {

166 
u8
 
	mªvisi⁄
;

167 
u32
 
	mext_˛ock_vÆid
;

168 } 
	g__∑cked
;

170 
	#UEFI_MAX_DSM_FUNCS
 32

	)

176 
	suefi_˙v_v¨_gíîÆ_cfg
 {

177 
u8
 
	mªvisi⁄
;

178 
u32
 
	mfun˘i⁄s
[
UEFI_MAX_DSM_FUNCS
];

179 } 
	g__∑cked
;

186 #ifde‡
CONFIG_EFI


187 *
iwl_uefi_gë_≤vm
(
iwl_å™s
 *
å™s
, 
size_t
 *
Àn
);

188 
u8
 *
iwl_uefi_gë_ªdu˚d_powî
(
iwl_å™s
 *
å™s
, 
size_t
 *
Àn
);

189 
iwl_uefi_ªdu˚_powî_∑r£
(
iwl_å™s
 *
å™s
,

190 c⁄° 
u8
 *
d©a
, 
size_t
 
Àn
,

191 
iwl_≤vm_image
 *
≤vm_d©a
);

192 
iwl_uefi_gë_°ï_èbÀ
(
iwl_å™s
 *
å™s
);

193 
iwl_uefi_h™dÀ_év_mem_desc
(
iwl_å™s
 *
å™s
, c⁄° 
u8
 *
d©a
,

194 
u32
 
év_Àn
, 
iwl_≤vm_image
 *
≤vm_d©a
);

195 
iwl_uefi_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

196 
iwl_uefi_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

197 
iwl_uefi_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

198 
iwl_uefi_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
);

199 
iwl_uefi_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

200 
iwl_ès_d©a
 *
d©a
);

201 
iwl_uefi_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
,

202 
u64
 *
dÊt_pwr_limô
);

203 
iwl_uefi_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
);

204 
iwl_uefi_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
exé_˛k
);

205 
iwl_uefi_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
, 
iwl_dsm_funcs
 
func
,

206 
u32
 *
vÆue
);

207 
iwl_uefi_gë_sgom_èbÀ
(
iwl_å™s
 *
å™s
, 
iwl_fw_ru¡ime
 *
fwπ
);

208 
iwl_uefi_gë_u©s_èbÀ
(
iwl_å™s
 *
å™s
,

209 
iwl_fw_ru¡ime
 *
fwπ
);

211 
ölöe
 *
	$iwl_uefi_gë_≤vm
(
iwl_å™s
 *
å™s
, 
size_t
 *
Àn
)

213  
	`ERR_PTR
(-
EOPNOTSUPP
);

214 
	}
}

216 
ölöe
 

217 
	$iwl_uefi_ªdu˚_powî_∑r£
(
iwl_å™s
 *
å™s
,

218 c⁄° 
u8
 *
d©a
, 
size_t
 
Àn
,

219 
iwl_≤vm_image
 *
≤vm_d©a
)

221  -
EOPNOTSUPP
;

222 
	}
}

224 
ölöe
 
u8
 *

225 
	$iwl_uefi_gë_ªdu˚d_powî
(
iwl_å™s
 *
å™s
, 
size_t
 *
Àn
)

227  
	`ERR_PTR
(-
EOPNOTSUPP
);

228 
	}
}

230 
ölöe
 
	$iwl_uefi_gë_°ï_èbÀ
(
iwl_å™s
 *
å™s
)

232 
	}
}

234 
ölöe
 

235 
	$iwl_uefi_h™dÀ_év_mem_desc
(
iwl_å™s
 *
å™s
, c⁄° 
u8
 *
d©a
,

236 
u32
 
év_Àn
, 
iwl_≤vm_image
 *
≤vm_d©a
)

239 
	}
}

241 
ölöe
 
	$iwl_uefi_gë_wrds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

243  -
ENOENT
;

244 
	}
}

246 
ölöe
 
	$iwl_uefi_gë_ewrd_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

248  -
ENOENT
;

249 
	}
}

251 
ölöe
 
	$iwl_uefi_gë_wgds_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

253  -
ENOENT
;

254 
	}
}

256 
ölöe
 
	$iwl_uefi_gë_µag_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
)

258  -
ENOENT
;

259 
	}
}

261 
ölöe
 
	$iwl_uefi_gë_ès_èbÀ
(
iwl_fw_ru¡ime
 *
fwπ
,

262 
iwl_ès_d©a
 *
d©a
)

264  -
ENOENT
;

265 
	}
}

267 
ölöe
 
	$iwl_uefi_gë_pwr_limô
(
iwl_fw_ru¡ime
 *
fwπ
,

268 
u64
 *
dÊt_pwr_limô
)

270 *
dÊt_pwr_limô
 = 0;

272 
	}
}

274 
ölöe
 
	$iwl_uefi_gë_mcc
(
iwl_fw_ru¡ime
 *
fwπ
, *
mcc
)

276  -
ENOENT
;

277 
	}
}

279 
ölöe
 
	$iwl_uefi_gë_eckv
(
iwl_fw_ru¡ime
 *
fwπ
, 
u32
 *
exé_˛k
)

281  -
ENOENT
;

282 
	}
}

284 
ölöe
 
	$iwl_uefi_gë_dsm
(
iwl_fw_ru¡ime
 *
fwπ
,

285 
iwl_dsm_funcs
 
func
, 
u32
 *
vÆue
)

287  -
ENOENT
;

288 
	}
}

290 
ölöe


291 
	$iwl_uefi_gë_sgom_èbÀ
(
iwl_å™s
 *
å™s
, 
iwl_fw_ru¡ime
 *
fwπ
)

293 
	}
}

295 
ölöe


296 
	$iwl_uefi_gë_u©s_èbÀ
(
iwl_å™s
 *
å™s
,

297 
iwl_fw_ru¡ime
 *
fwπ
)

300 
	}
}

	@iwl-agn-hw.h

9 #i‚de‡
__iwl_agn_hw_h__


10 
	#__iwl_agn_hw_h__


	)

12 
	#IWLAGN_RTC_INST_LOWER_BOUND
 (0x000000)

	)

13 
	#IWLAGN_RTC_INST_UPPER_BOUND
 (0x020000)

	)

15 
	#IWLAGN_RTC_DATA_LOWER_BOUND
 (0x800000)

	)

16 
	#IWLAGN_RTC_DATA_UPPER_BOUND
 (0x80C000)

	)

18 
	#IWLAGN_RTC_INST_SIZE
 (
IWLAGN_RTC_INST_UPPER_BOUND
 - \

19 
IWLAGN_RTC_INST_LOWER_BOUND
)

	)

20 
	#IWLAGN_RTC_DATA_SIZE
 (
IWLAGN_RTC_DATA_UPPER_BOUND
 - \

21 
IWLAGN_RTC_DATA_LOWER_BOUND
)

	)

23 
	#IWL60_RTC_INST_LOWER_BOUND
 (0x000000)

	)

24 
	#IWL60_RTC_INST_UPPER_BOUND
 (0x040000)

	)

25 
	#IWL60_RTC_DATA_LOWER_BOUND
 (0x800000)

	)

26 
	#IWL60_RTC_DATA_UPPER_BOUND
 (0x814000)

	)

27 
	#IWL60_RTC_INST_SIZE
 \

28 (
IWL60_RTC_INST_UPPER_BOUND
 - 
IWL60_RTC_INST_LOWER_BOUND
)

	)

29 
	#IWL60_RTC_DATA_SIZE
 \

30 (
IWL60_RTC_DATA_UPPER_BOUND
 - 
IWL60_RTC_DATA_LOWER_BOUND
)

	)

33 
	#IWLAGN_RSSI_OFFSET
 44

	)

35 
	#IWLAGN_DEFAULT_TX_RETRY
 15

	)

36 
	#IWLAGN_MGMT_DFAULT_RETRY_LIMIT
 3

	)

37 
	#IWLAGN_RTS_DFAULT_RETRY_LIMIT
 60

	)

38 
	#IWLAGN_BAR_DFAULT_RETRY_LIMIT
 60

	)

39 
	#IWLAGN_LOW_RETRY_LIMIT
 7

	)

42 
	#IWLAGN_TX_POWER_TARGET_POWER_MIN
 (0Ë

	)

43 
	#IWLAGN_TX_POWER_TARGET_POWER_MAX
 (16Ë

	)

46 
	#IWLAGN_EEPROM_IMG_SIZE
 2048

	)

49 
	#OTP_HIGH_IMAGE_SIZE_6x00
 (6 * 512 * (
u16
)Ë

	)

50 
	#OTP_HIGH_IMAGE_SIZE_1000
 (0x200 * (
u16
)Ë

	)

51 
	#OTP_MAX_LL_ITEMS_1000
 (3Ë

	)

52 
	#OTP_MAX_LL_ITEMS_6x00
 (4Ë

	)

53 
	#OTP_MAX_LL_ITEMS_6x50
 (7Ë

	)

54 
	#OTP_MAX_LL_ITEMS_2x00
 (4Ë

	)

57 
	#IWLAGN_NUM_QUEUES
 20

	)

	@iwl-config.h

7 #i‚de‡
__IWL_CONFIG_H__


8 
	#__IWL_CONFIG_H__


	)

10 
	~<löux/ty≥s.h
>

11 
	~<löux/√tdevi˚.h
>

12 
	~<löux/õì80211.h
>

13 
	~<löux/∆80211.h
>

14 
	~"iwl-c§.h
"

15 
	~"iwl-drv.h
"

17 
	eiwl_devi˚_Ámûy
 {

18 
	mIWL_DEVICE_FAMILY_UNDEFINED
,

19 
	mIWL_DEVICE_FAMILY_1000
,

20 
	mIWL_DEVICE_FAMILY_100
,

21 
	mIWL_DEVICE_FAMILY_2000
,

22 
	mIWL_DEVICE_FAMILY_2030
,

23 
	mIWL_DEVICE_FAMILY_105
,

24 
	mIWL_DEVICE_FAMILY_135
,

25 
	mIWL_DEVICE_FAMILY_5000
,

26 
	mIWL_DEVICE_FAMILY_5150
,

27 
	mIWL_DEVICE_FAMILY_6000
,

28 
	mIWL_DEVICE_FAMILY_6000i
,

29 
	mIWL_DEVICE_FAMILY_6005
,

30 
	mIWL_DEVICE_FAMILY_6030
,

31 
	mIWL_DEVICE_FAMILY_6050
,

32 
	mIWL_DEVICE_FAMILY_6150
,

33 
	mIWL_DEVICE_FAMILY_7000
,

34 
	mIWL_DEVICE_FAMILY_8000
,

35 
	mIWL_DEVICE_FAMILY_9000
,

36 
	mIWL_DEVICE_FAMILY_22000
,

37 
	mIWL_DEVICE_FAMILY_AX210
,

38 
	mIWL_DEVICE_FAMILY_BZ
,

39 
	mIWL_DEVICE_FAMILY_SC
,

51 
	eiwl_Àd_mode
 {

52 
	mIWL_LED_DEFAULT
,

53 
	mIWL_LED_RF_STATE
,

54 
	mIWL_LED_BLINK
,

55 
	mIWL_LED_DISABLE
,

64 
	eiwl_nvm_ty≥
 {

65 
	mIWL_NVM
,

66 
	mIWL_NVM_EXT
,

67 
	mIWL_NVM_SDP
,

74 
	#IWL_MAX_PLCP_ERR_THRESHOLD_MIN
 1

	)

75 
	#IWL_MAX_PLCP_ERR_THRESHOLD_DEF
 50

	)

76 
	#IWL_MAX_PLCP_ERR_LONG_THRESHOLD_DEF
 100

	)

77 
	#IWL_MAX_PLCP_ERR_EXT_LONG_THRESHOLD_DEF
 200

	)

78 
	#IWL_MAX_PLCP_ERR_THRESHOLD_MAX
 255

	)

79 
	#IWL_MAX_PLCP_ERR_THRESHOLD_DISABLE
 0

	)

82 
	#IWL_WATCHDOG_DISABLED
 0

	)

83 
	#IWL_DEF_WD_TIMEOUT
 2500

	)

84 
	#IWL_LONG_WD_TIMEOUT
 10000

	)

85 
	#IWL_MAX_WD_TIMEOUT
 120000

	)

87 
	#IWL_DEFAULT_MAX_TX_POWER
 22

	)

88 
	#IWL_TX_CSUM_NETIF_FLAGS
 (
NETIF_F_IPV6_CSUM
 | 
NETIF_F_IP_CSUM
 |\

89 
NETIF_F_TSO
 | 
NETIF_F_TSO6
)

	)

90 
	#IWL_CSUM_NETIF_FLAGS_MASK
 (
IWL_TX_CSUM_NETIF_FLAGS
 | 
NETIF_F_RXCSUM
)

	)

93 
	#ANT_NONE
 0x0

	)

94 
	#ANT_INVALID
 0xff

	)

95 
	#ANT_A
 
	`BIT
(0)

	)

96 
	#ANT_B
 
	`BIT
(1)

	)

97 
	#ANT_C
 
	`BIT
(2)

	)

98 
	#ANT_AB
 (
ANT_A
 | 
ANT_B
)

	)

99 
	#ANT_AC
 (
ANT_A
 | 
ANT_C
)

	)

100 
	#ANT_BC
 (
ANT_B
 | 
ANT_C
)

	)

101 
	#ANT_ABC
 (
ANT_A
 | 
ANT_B
 | 
ANT_C
)

	)

104 
ölöe
 
u8
 
	$num_of_™t
(
u8
 
mask
)

106  !!((
mask
Ë& 
ANT_A
) +

107 !!((
mask
Ë& 
ANT_B
) +

108 !!((
mask
Ë& 
ANT_C
);

109 
	}
}

126 
	siwl_ba£_∑øms
 {

127 
	mwd_timeout
;

129 
u16
 
	mì¥om_size
;

130 
u16
 
	mmax_evít_log_size
;

132 
u8
 
	m∂l_cfg
:1,

133 
	mshadow_øm_suµ‹t
:1,

134 
	mshadow_ªg_íabÀ
:1,

135 
	mpcõ_l1_Ælowed
:1,

136 
	m≠mg_wake_up_wa
:1,

137 
	mscd_chaö_ext_wa
:1;

139 
u16
 
	mnum_of_queues
;

140 
u32
 
	mmax_tfd_queue_size
;

142 
u8
 
	mmax_Œ_ôems
;

143 
u8
 
	mÀd_com≥nßti⁄
;

152 
	siwl_ht_∑øms
 {

153 
u8
 
	mht_gªífõld_suµ‹t
:1,

154 
	m°bc
:1,

155 
	mldpc
:1,

156 
	mu£_πs_f‹_aggªg©i⁄
:1;

157 
u8
 
	mht40_b™ds
;

165 
	siwl_â_tx_backoff
 {

166 
s32
 
	mãm≥øtuª
;

167 
u32
 
	mbackoff
;

170 
	#TT_TX_BACKOFF_SIZE
 6

	)

188 
	siwl_â_∑øms
 {

189 
u32
 
	m˘_kûl_íåy
;

190 
u32
 
	m˘_kûl_exô
;

191 
u32
 
	m˘_kûl_duøti⁄
;

192 
u32
 
	mdy«mic_smps_íåy
;

193 
u32
 
	mdy«mic_smps_exô
;

194 
u32
 
	mtx_¥Ÿe˘i⁄_íåy
;

195 
u32
 
	mtx_¥Ÿe˘i⁄_exô
;

196 
iwl_â_tx_backoff
 
	mtx_backoff
[
TT_TX_BACKOFF_SIZE
];

197 
u8
 
	msuµ‹t_˘_kûl
:1,

198 
	msuµ‹t_dy«mic_smps
:1,

199 
	msuµ‹t_tx_¥Ÿe˘i⁄
:1,

200 
	msuµ‹t_tx_backoff
:1;

206 
	#EEPROM_REG_BAND_1_CHANNELS
 0x08

	)

207 
	#EEPROM_REG_BAND_2_CHANNELS
 0x26

	)

208 
	#EEPROM_REG_BAND_3_CHANNELS
 0x42

	)

209 
	#EEPROM_REG_BAND_4_CHANNELS
 0x5C

	)

210 
	#EEPROM_REG_BAND_5_CHANNELS
 0x74

	)

211 
	#EEPROM_REG_BAND_24_HT40_CHANNELS
 0x82

	)

212 
	#EEPROM_REG_BAND_52_HT40_CHANNELS
 0x92

	)

213 
	#EEPROM_6000_REG_BAND_24_HT40_CHANNELS
 0x80

	)

214 
	#EEPROM_REGULATORY_BAND_NO_HT40
 0

	)

217 
	#OTP_LOW_IMAGE_SIZE_2K
 (2 * 512 * (
u16
)Ë

	)

218 
	#OTP_LOW_IMAGE_SIZE_16K
 (16 * 512 * (
u16
)Ë

	)

219 
	#OTP_LOW_IMAGE_SIZE_32K
 (32 * 512 * (
u16
)Ë

	)

221 
	siwl_ì¥om_∑øms
 {

222 c⁄° 
u8
 
	mªguœt‹y_b™ds
[7];

223 
boﬁ
 
	míh™˚d_txpowî
;

230 
	siwl_pwr_tx_backoff
 {

231 
u32
 
	mpwr
;

232 
u32
 
	mbackoff
;

235 
	eiwl_cfg_å™s_…r_dñay
 {

236 
	mIWL_CFG_TRANS_LTR_DELAY_NONE
 = 0,

237 
	mIWL_CFG_TRANS_LTR_DELAY_200US
 = 1,

238 
	mIWL_CFG_TRANS_LTR_DELAY_2500US
 = 2,

239 
	mIWL_CFG_TRANS_LTR_DELAY_1820US
 = 3,

263 
	siwl_cfg_å™s_∑øms
 {

264 c⁄° 
iwl_ba£_∑øms
 *
	mba£_∑øms
;

265 
iwl_devi˚_Ámûy
 
	mdevi˚_Ámûy
;

266 
u32
 
	mumac_¥ph_off£t
;

267 
u32
 
	mxèl_œãncy
;

268 
u32
 
	mexåa_phy_cfg_Êags
;

269 
u32
 
	mrf_id
:1,

270 
	mgí2
:1,

271 
	mmq_rx_suµ‹ãd
:1,

272 
	möãgøãd
:1,

273 
	mlow_œãncy_xèl
:1,

274 
	mbi§_w‹k¨ound
:1,

275 
	m…r_dñay
:2,

276 
	mimr_íabÀd
:1;

284 
	siwl_fw_m⁄_ªg
 {

285 
u32
 
	maddr
;

286 
u32
 
	mmask
;

295 
	siwl_fw_m⁄_ªgs
 {

296 
iwl_fw_m⁄_ªg
 
	mwrôe_±r
;

297 
iwl_fw_m⁄_ªg
 
	mcy˛e_˙t
;

298 
iwl_fw_m⁄_ªg
 
	mcur_‰ag
;

354 
	siwl_cfg
 {

355 
iwl_cfg_å™s_∑øms
 
	må™s
;

357 c⁄° *
	m«me
;

358 c⁄° *
	mfw_«me_¥e
;

359 c⁄° *
	mfw_«me_mac
;

361 c⁄° 
iwl_ht_∑øms
 *
	mht_∑øms
;

362 c⁄° 
iwl_ì¥om_∑øms
 *
	mì¥om_∑øms
;

363 c⁄° 
iwl_pwr_tx_backoff
 *
	mpwr_tx_backoffs
;

364 c⁄° *
	mdeÁu…_nvm_fûe_C_°ï
;

365 c⁄° 
iwl_â_∑øms
 *
	mthîmÆ_∑øms
;

366 
iwl_Àd_mode
 
	mÀd_mode
;

367 
iwl_nvm_ty≥
 
	mnvm_ty≥
;

368 
u32
 
	mmax_d©a_size
;

369 
u32
 
	mmax_ö°_size
;

370 
√tdev_„©uªs_t
 
	m„©uªs
;

371 
u32
 
	mdccm_off£t
;

372 
u32
 
	mdccm_Àn
;

373 
u32
 
	mdccm2_off£t
;

374 
u32
 
	mdccm2_Àn
;

375 
u32
 
	msmem_off£t
;

376 
u32
 
	msmem_Àn
;

377 
u16
 
	mnvm_vî
;

378 
u16
 
	mnvm_ˇlib_vî
;

379 
u32
 
	mrx_wôh_siso_divîsôy
:1,

380 
	mtx_wôh_siso_divîsôy
:1,

381 
	möã∫Æ_wimax_c€x
:1,

382 
	mho°_öãºu±_›î©i⁄_mode
:1,

383 
	mhigh_ãmp
:1,

384 
	mmac_addr_‰om_c§
:10,

385 
	mÕ_xèl_w‹k¨ound
:1,

386 
	m≠mg_nŸ_suµ‹ãd
:1,

387 
	mvht_mu_mimo_suµ‹ãd
:1,

388 
	mcdb
:1,

389 
	mdbgc_suµ‹ãd
:1,

390 
	muhb_suµ‹ãd
:1;

391 
u8
 
	mvÆid_tx_™t
;

392 
u8
 
	mvÆid_rx_™t
;

393 
u8
 
	mn⁄_sh¨ed_™t
;

394 
u8
 
	mnvm_hw_£˘i⁄_num
;

395 
u8
 
	mmax_tx_agg_size
;

396 
u8
 
	mucode_≠i_max
;

397 
u8
 
	mucode_≠i_mö
;

398 
u16
 
	mnum_rbds
;

399 
u32
 
	mmö_umac_îr‹_evít_èbÀ
;

400 
u32
 
	md3_debug_d©a_ba£_addr
;

401 
u32
 
	md3_debug_d©a_Àngth
;

402 
u32
 
	mmö_txq_size
;

403 
u32
 
	mgp2_ªg_addr
;

404 
u32
 
	mmö_ba_txq_size
;

405 c⁄° 
iwl_fw_m⁄_ªgs
 
	mm⁄_døm_ªgs
;

406 c⁄° 
iwl_fw_m⁄_ªgs
 
	mm⁄_smem_ªgs
;

407 c⁄° 
iwl_fw_m⁄_ªgs
 
	mm⁄_dbgi_ªgs
;

410 
	#IWL_CFG_ANY
 (~0)

	)

412 
	#IWL_CFG_MAC_TYPE_PU
 0x31

	)

413 
	#IWL_CFG_MAC_TYPE_TH
 0x32

	)

414 
	#IWL_CFG_MAC_TYPE_QU
 0x33

	)

415 
	#IWL_CFG_MAC_TYPE_QUZ
 0x35

	)

416 
	#IWL_CFG_MAC_TYPE_SO
 0x37

	)

417 
	#IWL_CFG_MAC_TYPE_SOF
 0x43

	)

418 
	#IWL_CFG_MAC_TYPE_MA
 0x44

	)

419 
	#IWL_CFG_MAC_TYPE_BZ
 0x46

	)

420 
	#IWL_CFG_MAC_TYPE_GL
 0x47

	)

421 
	#IWL_CFG_MAC_TYPE_SC
 0x48

	)

422 
	#IWL_CFG_MAC_TYPE_SC2
 0x49

	)

423 
	#IWL_CFG_MAC_TYPE_SC2F
 0x4A

	)

425 
	#IWL_CFG_RF_TYPE_TH
 0x105

	)

426 
	#IWL_CFG_RF_TYPE_TH1
 0x108

	)

427 
	#IWL_CFG_RF_TYPE_JF2
 0x105

	)

428 
	#IWL_CFG_RF_TYPE_JF1
 0x108

	)

429 
	#IWL_CFG_RF_TYPE_HR2
 0x10A

	)

430 
	#IWL_CFG_RF_TYPE_HR1
 0x10C

	)

431 
	#IWL_CFG_RF_TYPE_GF
 0x10D

	)

432 
	#IWL_CFG_RF_TYPE_MR
 0x110

	)

433 
	#IWL_CFG_RF_TYPE_MS
 0x111

	)

434 
	#IWL_CFG_RF_TYPE_FM
 0x112

	)

435 
	#IWL_CFG_RF_TYPE_WH
 0x113

	)

437 
	#IWL_CFG_RF_ID_TH
 0x1

	)

438 
	#IWL_CFG_RF_ID_TH1
 0x1

	)

439 
	#IWL_CFG_RF_ID_JF
 0x3

	)

440 
	#IWL_CFG_RF_ID_JF1
 0x6

	)

441 
	#IWL_CFG_RF_ID_JF1_DIV
 0xA

	)

442 
	#IWL_CFG_RF_ID_HR
 0x7

	)

443 
	#IWL_CFG_RF_ID_HR1
 0x4

	)

445 
	#IWL_CFG_NO_160
 0x1

	)

446 
	#IWL_CFG_160
 0x0

	)

448 
	#IWL_CFG_NO_320
 0x1

	)

449 
	#IWL_CFG_320
 0x0

	)

451 
	#IWL_CFG_CORES_BT
 0x0

	)

452 
	#IWL_CFG_CORES_BT_GNSS
 0x5

	)

454 
	#IWL_CFG_NO_CDB
 0x0

	)

455 
	#IWL_CFG_CDB
 0x1

	)

457 
	#IWL_CFG_NO_JACKET
 0x0

	)

458 
	#IWL_CFG_IS_JACKET
 0x1

	)

460 
	#IWL_SUBDEVICE_RF_ID
(
subdevi˚
Ë((
u16
)((subdevi˚Ë& 0x00F0Ë>> 4)

	)

461 
	#IWL_SUBDEVICE_NO_160
(
subdevi˚
Ë((
u16
)((subdevi˚Ë& 0x0200Ë>> 9)

	)

462 
	#IWL_SUBDEVICE_CORES
(
subdevi˚
Ë((
u16
)((subdevi˚Ë& 0x1C00Ë>> 10)

	)

464 
	siwl_dev_öfo
 {

465 
u16
 
	mdevi˚
;

466 
u16
 
	msubdevi˚
;

467 
u16
 
	mmac_ty≥
;

468 
u16
 
	mrf_ty≥
;

469 
u8
 
	mmac_°ï
;

470 
u8
 
	mrf_°ï
;

471 
u8
 
	mrf_id
;

472 
u8
 
	mno_160
;

473 
u8
 
	mc‹es
;

474 
u8
 
	mcdb
;

475 
u8
 
	mjackë
;

476 c⁄° 
iwl_cfg
 *
	mcfg
;

477 c⁄° *
	m«me
;

480 #i‡
IS_ENABLED
(
CONFIG_IWLWIFI_KUNIT_TESTS
)

481 c⁄° 
iwl_dev_öfo
 
iwl_dev_öfo_èbÀ
[];

482 c⁄° 
iwl_dev_öfo_èbÀ_size
;

483 c⁄° 
iwl_dev_öfo
 *

484 
iwl_pci_föd_dev_öfo
(
u16
 
devi˚
, u16 
subsy°em_devi˚
,

485 
u16
 
mac_ty≥
, 
u8
 
mac_°ï
, u16 
rf_ty≥
, u8 
cdb
,

486 
u8
 
jackë
, u8 
rf_id
, u8 
no_160
, u8 
c‹es
, u8 
rf_°ï
);

492 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl9000_å™s_cfg
;

493 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl9560_å™s_cfg
;

494 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl9560_l⁄g_œãncy_å™s_cfg
;

495 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl9560_sh¨ed_˛k_å™s_cfg
;

496 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_qu_å™s_cfg
;

497 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_qu_medium_œãncy_å™s_cfg
;

498 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_qu_l⁄g_œãncy_å™s_cfg
;

499 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_ax200_å™s_cfg
;

500 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_so_å™s_cfg
;

501 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_so_l⁄g_œãncy_å™s_cfg
;

502 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_so_l⁄g_œãncy_imr_å™s_cfg
;

503 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_ma_å™s_cfg
;

504 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_bz_å™s_cfg
;

505 c⁄° 
iwl_cfg_å™s_∑øms
 
iwl_sc_å™s_cfg
;

506 c⁄° 
iwl9162_«me
[];

507 c⁄° 
iwl9260_«me
[];

508 c⁄° 
iwl9260_1_«me
[];

509 c⁄° 
iwl9270_«me
[];

510 c⁄° 
iwl9461_«me
[];

511 c⁄° 
iwl9462_«me
[];

512 c⁄° 
iwl9560_«me
[];

513 c⁄° 
iwl9162_160_«me
[];

514 c⁄° 
iwl9260_160_«me
[];

515 c⁄° 
iwl9270_160_«me
[];

516 c⁄° 
iwl9461_160_«me
[];

517 c⁄° 
iwl9462_160_«me
[];

518 c⁄° 
iwl9560_160_«me
[];

519 c⁄° 
iwl9260_kûÀr_1550_«me
[];

520 c⁄° 
iwl9560_kûÀr_1550i_«me
[];

521 c⁄° 
iwl9560_kûÀr_1550s_«me
[];

522 c⁄° 
iwl_ax200_«me
[];

523 c⁄° 
iwl_ax203_«me
[];

524 c⁄° 
iwl_ax204_«me
[];

525 c⁄° 
iwl_ax201_«me
[];

526 c⁄° 
iwl_ax101_«me
[];

527 c⁄° 
iwl_ax200_kûÀr_1650w_«me
[];

528 c⁄° 
iwl_ax200_kûÀr_1650x_«me
[];

529 c⁄° 
iwl_ax201_kûÀr_1650s_«me
[];

530 c⁄° 
iwl_ax201_kûÀr_1650i_«me
[];

531 c⁄° 
iwl_ax210_kûÀr_1675w_«me
[];

532 c⁄° 
iwl_ax210_kûÀr_1675x_«me
[];

533 c⁄° 
iwl9560_kûÀr_1550i_160_«me
[];

534 c⁄° 
iwl9560_kûÀr_1550s_160_«me
[];

535 c⁄° 
iwl_ax211_kûÀr_1675s_«me
[];

536 c⁄° 
iwl_ax211_kûÀr_1675i_«me
[];

537 c⁄° 
iwl_ax411_kûÀr_1690s_«me
[];

538 c⁄° 
iwl_ax411_kûÀr_1690i_«me
[];

539 c⁄° 
iwl_ax211_«me
[];

540 c⁄° 
iwl_ax221_«me
[];

541 c⁄° 
iwl_ax231_«me
[];

542 c⁄° 
iwl_ax411_«me
[];

543 c⁄° 
iwl_bz_«me
[];

544 c⁄° 
iwl_mç_«me
[];

545 c⁄° 
iwl_sc_«me
[];

546 c⁄° 
iwl_sc2_«me
[];

547 c⁄° 
iwl_sc2f_«me
[];

548 #i‡
IS_ENABLED
(
CONFIG_IWLDVM
)

549 c⁄° 
iwl_cfg
 
iwl5300_agn_cfg
;

550 c⁄° 
iwl_cfg
 
iwl5100_agn_cfg
;

551 c⁄° 
iwl_cfg
 
iwl5350_agn_cfg
;

552 c⁄° 
iwl_cfg
 
iwl5100_bgn_cfg
;

553 c⁄° 
iwl_cfg
 
iwl5100_abg_cfg
;

554 c⁄° 
iwl_cfg
 
iwl5150_agn_cfg
;

555 c⁄° 
iwl_cfg
 
iwl5150_abg_cfg
;

556 c⁄° 
iwl_cfg
 
iwl6005_2agn_cfg
;

557 c⁄° 
iwl_cfg
 
iwl6005_2abg_cfg
;

558 c⁄° 
iwl_cfg
 
iwl6005_2bg_cfg
;

559 c⁄° 
iwl_cfg
 
iwl6005_2agn_sff_cfg
;

560 c⁄° 
iwl_cfg
 
iwl6005_2agn_d_cfg
;

561 c⁄° 
iwl_cfg
 
iwl6005_2agn_mow1_cfg
;

562 c⁄° 
iwl_cfg
 
iwl6005_2agn_mow2_cfg
;

563 c⁄° 
iwl_cfg
 
iwl1030_bgn_cfg
;

564 c⁄° 
iwl_cfg
 
iwl1030_bg_cfg
;

565 c⁄° 
iwl_cfg
 
iwl6030_2agn_cfg
;

566 c⁄° 
iwl_cfg
 
iwl6030_2abg_cfg
;

567 c⁄° 
iwl_cfg
 
iwl6030_2bgn_cfg
;

568 c⁄° 
iwl_cfg
 
iwl6030_2bg_cfg
;

569 c⁄° 
iwl_cfg
 
iwl6000i_2agn_cfg
;

570 c⁄° 
iwl_cfg
 
iwl6000i_2abg_cfg
;

571 c⁄° 
iwl_cfg
 
iwl6000i_2bg_cfg
;

572 c⁄° 
iwl_cfg
 
iwl6000_3agn_cfg
;

573 c⁄° 
iwl_cfg
 
iwl6050_2agn_cfg
;

574 c⁄° 
iwl_cfg
 
iwl6050_2abg_cfg
;

575 c⁄° 
iwl_cfg
 
iwl6150_bgn_cfg
;

576 c⁄° 
iwl_cfg
 
iwl6150_bg_cfg
;

577 c⁄° 
iwl_cfg
 
iwl1000_bgn_cfg
;

578 c⁄° 
iwl_cfg
 
iwl1000_bg_cfg
;

579 c⁄° 
iwl_cfg
 
iwl100_bgn_cfg
;

580 c⁄° 
iwl_cfg
 
iwl100_bg_cfg
;

581 c⁄° 
iwl_cfg
 
iwl130_bgn_cfg
;

582 c⁄° 
iwl_cfg
 
iwl130_bg_cfg
;

583 c⁄° 
iwl_cfg
 
iwl2000_2bgn_cfg
;

584 c⁄° 
iwl_cfg
 
iwl2000_2bgn_d_cfg
;

585 c⁄° 
iwl_cfg
 
iwl2030_2bgn_cfg
;

586 c⁄° 
iwl_cfg
 
iwl6035_2agn_cfg
;

587 c⁄° 
iwl_cfg
 
iwl6035_2agn_sff_cfg
;

588 c⁄° 
iwl_cfg
 
iwl105_bgn_cfg
;

589 c⁄° 
iwl_cfg
 
iwl105_bgn_d_cfg
;

590 c⁄° 
iwl_cfg
 
iwl135_bgn_cfg
;

592 #i‡
IS_ENABLED
(
CONFIG_IWLMVM
)

593 c⁄° 
iwl_ht_∑øms
 
iwl_22000_ht_∑øms
;

594 c⁄° 
iwl_cfg
 
iwl7260_2ac_cfg
;

595 c⁄° 
iwl_cfg
 
iwl7260_2ac_cfg_high_ãmp
;

596 c⁄° 
iwl_cfg
 
iwl7260_2n_cfg
;

597 c⁄° 
iwl_cfg
 
iwl7260_n_cfg
;

598 c⁄° 
iwl_cfg
 
iwl3160_2ac_cfg
;

599 c⁄° 
iwl_cfg
 
iwl3160_2n_cfg
;

600 c⁄° 
iwl_cfg
 
iwl3160_n_cfg
;

601 c⁄° 
iwl_cfg
 
iwl3165_2ac_cfg
;

602 c⁄° 
iwl_cfg
 
iwl3168_2ac_cfg
;

603 c⁄° 
iwl_cfg
 
iwl7265_2ac_cfg
;

604 c⁄° 
iwl_cfg
 
iwl7265_2n_cfg
;

605 c⁄° 
iwl_cfg
 
iwl7265_n_cfg
;

606 c⁄° 
iwl_cfg
 
iwl7265d_2ac_cfg
;

607 c⁄° 
iwl_cfg
 
iwl7265d_2n_cfg
;

608 c⁄° 
iwl_cfg
 
iwl7265d_n_cfg
;

609 c⁄° 
iwl_cfg
 
iwl8260_2n_cfg
;

610 c⁄° 
iwl_cfg
 
iwl8260_2ac_cfg
;

611 c⁄° 
iwl_cfg
 
iwl8265_2ac_cfg
;

612 c⁄° 
iwl_cfg
 
iwl8275_2ac_cfg
;

613 c⁄° 
iwl_cfg
 
iwl4165_2ac_cfg
;

614 c⁄° 
iwl_cfg
 
iwl9260_2ac_cfg
;

615 c⁄° 
iwl_cfg
 
iwl9560_qu_b0_jf_b0_cfg
;

616 c⁄° 
iwl_cfg
 
iwl9560_qu_c0_jf_b0_cfg
;

617 c⁄° 
iwl_cfg
 
iwl9560_quz_a0_jf_b0_cfg
;

618 c⁄° 
iwl_cfg
 
iwl9560_2ac_cfg_soc
;

619 c⁄° 
iwl_cfg
 
iwl_qu_b0_hr1_b0
;

620 c⁄° 
iwl_cfg
 
iwl_qu_c0_hr1_b0
;

621 c⁄° 
iwl_cfg
 
iwl_quz_a0_hr1_b0
;

622 c⁄° 
iwl_cfg
 
iwl_qu_b0_hr_b0
;

623 c⁄° 
iwl_cfg
 
iwl_qu_c0_hr_b0
;

624 c⁄° 
iwl_cfg
 
iwl_ax200_cfg_cc
;

625 c⁄° 
iwl_cfg
 
iwl_ax201_cfg_qu_hr
;

626 c⁄° 
iwl_cfg
 
iwl_ax201_cfg_qu_c0_hr_b0
;

627 c⁄° 
iwl_cfg
 
iwl_ax201_cfg_quz_hr
;

628 c⁄° 
iwl_cfg
 
iwl_ax1650i_cfg_quz_hr
;

629 c⁄° 
iwl_cfg
 
iwl_ax1650s_cfg_quz_hr
;

630 c⁄° 
iwl_cfg
 
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
;

631 c⁄° 
iwl_cfg
 
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
;

632 c⁄° 
iwl_cfg
 
kûÀr1650s_2ax_cfg_qu_c0_hr_b0
;

633 c⁄° 
iwl_cfg
 
kûÀr1650i_2ax_cfg_qu_c0_hr_b0
;

634 c⁄° 
iwl_cfg
 
kûÀr1650x_2ax_cfg
;

635 c⁄° 
iwl_cfg
 
kûÀr1650w_2ax_cfg
;

636 c⁄° 
iwl_cfg
 
iwœx210_2ax_cfg_so_jf_b0
;

637 c⁄° 
iwl_cfg
 
iwœx211_2ax_cfg_so_gf_a0
;

638 c⁄° 
iwl_cfg
 
iwœx211_2ax_cfg_so_gf_a0_l⁄g
;

639 c⁄° 
iwl_cfg
 
iwœx210_2ax_cfg_ty_gf_a0
;

640 c⁄° 
iwl_cfg
 
iwœx411_2ax_cfg_so_gf4_a0
;

641 c⁄° 
iwl_cfg
 
iwœx411_2ax_cfg_so_gf4_a0_l⁄g
;

643 c⁄° 
iwl_cfg
 
iwl_cfg_ma
;

645 c⁄° 
iwl_cfg
 
iwl_cfg_so_a0_hr_a0
;

646 c⁄° 
iwl_cfg
 
iwl_cfg_so_a0_ms_a0
;

647 c⁄° 
iwl_cfg
 
iwl_cfg_quz_a0_hr_b0
;

649 c⁄° 
iwl_cfg
 
iwl_cfg_bz
;

650 c⁄° 
iwl_cfg
 
iwl_cfg_gl
;

652 c⁄° 
iwl_cfg
 
iwl_cfg_sc
;

653 c⁄° 
iwl_cfg
 
iwl_cfg_sc2
;

654 c⁄° 
iwl_cfg
 
iwl_cfg_sc2f
;

	@iwl-context-info-gen3.h

5 #i‚de‡
__iwl_c⁄ãxt_öfo_fûe_gí3_h__


6 
	#__iwl_c⁄ãxt_öfo_fûe_gí3_h__


	)

8 
	~"iwl-c⁄ãxt-öfo.h
"

10 
	#CSR_CTXT_INFO_BOOT_CTRL
 0x0

	)

11 
	#CSR_CTXT_INFO_ADDR
 0x118

	)

12 
	#CSR_IML_DATA_ADDR
 0x120

	)

13 
	#CSR_IML_SIZE_ADDR
 0x128

	)

14 
	#CSR_IML_RESP_ADDR
 0x12c

	)

16 
	#UNFRAGMENTED_PNVM_PAYLOADS_NUMBER
 2

	)

19 
	#CSR_AUTO_FUNC_BOOT_ENA
 
	`BIT
(1)

	)

21 
	#CSR_AUTO_FUNC_INIT
 
	`BIT
(7)

	)

30 
	eiwl_¥ph_s¸©ch_må_f‹m©
 {

31 
	mIWL_PRPH_MTR_FORMAT_16B
 = 0x0,

32 
	mIWL_PRPH_MTR_FORMAT_32B
 = 0x40000,

33 
	mIWL_PRPH_MTR_FORMAT_64B
 = 0x80000,

34 
	mIWL_PRPH_MTR_FORMAT_256B
 = 0xC0000,

60 
	eiwl_¥ph_s¸©ch_Êags
 {

61 
	mIWL_PRPH_SCRATCH_IMR_DEBUG_EN
 = 
BIT
(1),

62 
	mIWL_PRPH_SCRATCH_EARLY_DEBUG_EN
 = 
BIT
(4),

63 
	mIWL_PRPH_SCRATCH_EDBG_DEST_DRAM
 = 
BIT
(8),

64 
	mIWL_PRPH_SCRATCH_EDBG_DEST_INTERNAL
 = 
BIT
(9),

65 
	mIWL_PRPH_SCRATCH_EDBG_DEST_ST_ARBITER
 = 
BIT
(10),

66 
	mIWL_PRPH_SCRATCH_EDBG_DEST_TB22DTF
 = 
BIT
(11),

67 
	mIWL_PRPH_SCRATCH_RB_SIZE_4K
 = 
BIT
(16),

68 
	mIWL_PRPH_SCRATCH_MTR_MODE
 = 
BIT
(17),

69 
	mIWL_PRPH_SCRATCH_MTR_FORMAT
 = 
BIT
(18) | BIT(19),

70 
	mIWL_PRPH_SCRATCH_RB_SIZE_EXT_MASK
 = 0xf << 20,

71 
	mIWL_PRPH_SCRATCH_RB_SIZE_EXT_8K
 = 8 << 20,

72 
	mIWL_PRPH_SCRATCH_RB_SIZE_EXT_12K
 = 9 << 20,

73 
	mIWL_PRPH_SCRATCH_RB_SIZE_EXT_16K
 = 10 << 20,

83 
	siwl_¥ph_s¸©ch_vîsi⁄
 {

84 
__À16
 
	mmac_id
;

85 
__À16
 
	mvîsi⁄
;

86 
__À16
 
	msize
;

87 
__À16
 
	mª£rved
;

88 } 
	g__∑cked
;

95 
	siwl_¥ph_s¸©ch_c⁄åﬁ
 {

96 
__À32
 
	mc⁄åﬁ_Êags
;

97 
__À32
 
	mª£rved
;

98 } 
	g__∑cked
;

106 
	siwl_¥ph_s¸©ch_≤vm_cfg
 {

107 
__À64
 
	m≤vm_ba£_addr
;

108 
__À32
 
	m≤vm_size
;

109 
__À32
 
	mª£rved
;

110 } 
	g__∑cked
;

117 
	siwl_¥ph_s¸©h_mem_desc_addr_¨øy
 {

118 
__À64
 
	mmem_descs
[
IPC_DRAM_MAP_ENTRY_NUM_MAX
];

119 } 
	g__∑cked
;

126 
	siwl_¥ph_s¸©ch_hwm_cfg
 {

127 
__À64
 
	mhwm_ba£_addr
;

128 
__À32
 
	mhwm_size
;

129 
__À32
 
	mdebug_tokí_c⁄fig
;

130 } 
	g__∑cked
;

137 
	siwl_¥ph_s¸©ch_rbd_cfg
 {

138 
__À64
 
	m‰ì_rbd_addr
;

139 
__À32
 
	mª£rved
;

140 } 
	g__∑cked
;

147 
	siwl_¥ph_s¸©ch_uefi_cfg
 {

148 
__À64
 
	mba£_addr
;

149 
__À32
 
	msize
;

150 
__À32
 
	mª£rved
;

151 } 
	g__∑cked
;

162 
	siwl_¥ph_s¸©ch_°ï_cfg
 {

163 
__À32
 
	mmbx_addr_0
;

164 
__À32
 
	mmbx_addr_1
;

165 } 
	g__∑cked
;

176 
	siwl_¥ph_s¸©ch_˘æ_cfg
 {

177 
iwl_¥ph_s¸©ch_vîsi⁄
 
	mvîsi⁄
;

178 
iwl_¥ph_s¸©ch_c⁄åﬁ
 
	mc⁄åﬁ
;

179 
iwl_¥ph_s¸©ch_≤vm_cfg
 
	m≤vm_cfg
;

180 
iwl_¥ph_s¸©ch_hwm_cfg
 
	mhwm_cfg
;

181 
iwl_¥ph_s¸©ch_rbd_cfg
 
	mrbd_cfg
;

182 
iwl_¥ph_s¸©ch_uefi_cfg
 
	mªdu˚_powî_cfg
;

183 
iwl_¥ph_s¸©ch_°ï_cfg
 
	m°ï_cfg
;

184 } 
	g__∑cked
;

194 
	siwl_¥ph_s¸©ch
 {

195 
iwl_¥ph_s¸©ch_˘æ_cfg
 
	m˘æ_cfg
;

196 
__À32
 
	mf£q_ovîride
;

197 
__À32
 
	m°ï_™Æog_∑øms
;

198 
__À32
 
	mª£rved
[8];

199 
iwl_c⁄ãxt_öfo_døm
 
	mdøm
;

200 } 
	g__∑cked
;

209 
	siwl_¥ph_öfo
 {

210 
__À32
 
	mboŸ_°age_múr‹
;

211 
__À32
 
	mùc_°©us_múr‹
;

212 
__À32
 
	m¶ìp_nŸif
;

213 
__À32
 
	mª£rved
;

214 } 
	g__∑cked
;

260 
	siwl_c⁄ãxt_öfo_gí3
 {

261 
__À16
 
	mvîsi⁄
;

262 
__À16
 
	msize
;

263 
__À32
 
	mc⁄fig
;

264 
__À64
 
	m¥ph_öfo_ba£_addr
;

265 
__À64
 
	m¸_hód_idx_¨r_ba£_addr
;

266 
__À64
 
	må_èû_idx_¨r_ba£_addr
;

267 
__À64
 
	m¸_èû_idx_¨r_ba£_addr
;

268 
__À64
 
	må_hód_idx_¨r_ba£_addr
;

269 
__À16
 
	m¸_idx_¨r_size
;

270 
__À16
 
	må_idx_¨r_size
;

271 
__À64
 
	mmå_ba£_addr
;

272 
__À64
 
	mm¸_ba£_addr
;

273 
__À16
 
	mmå_size
;

274 
__À16
 
	mm¸_size
;

275 
__À16
 
	mmå_do‹bñl_vec
;

276 
__À16
 
	mm¸_do‹bñl_vec
;

277 
__À16
 
	mmå_msi_vec
;

278 
__À16
 
	mm¸_msi_vec
;

279 
u8
 
	mmå_›t_hódî_size
;

280 
u8
 
	mmå_›t_foŸî_size
;

281 
u8
 
	mm¸_›t_hódî_size
;

282 
u8
 
	mm¸_›t_foŸî_size
;

283 
__À16
 
	mmsg_rögs_˘æ_Êags
;

284 
__À16
 
	m¥ph_öfo_msi_vec
;

285 
__À64
 
	m¥ph_s¸©ch_ba£_addr
;

286 
__À32
 
	m¥ph_s¸©ch_size
;

287 
__À32
 
	mª£rved
;

288 } 
	g__∑cked
;

290 
iwl_pcõ_˘xt_öfo_gí3_öô
(
iwl_å™s
 *
å™s
,

291 c⁄° 
fw_img
 *
fw
);

292 
iwl_pcõ_˘xt_öfo_gí3_‰ì
(
iwl_å™s
 *
å™s
, 
boﬁ
 
Æive
);

294 
iwl_å™s_pcõ_˘x_öfo_gí3_lﬂd_≤vm
(
iwl_å™s
 *
å™s
,

295 c⁄° 
iwl_≤vm_image
 *
≤vm_∑ylﬂds
,

296 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
);

297 
iwl_å™s_pcõ_˘x_öfo_gí3_£t_≤vm
(
iwl_å™s
 *
å™s
,

298 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
);

300 
iwl_å™s_pcõ_˘x_öfo_gí3_lﬂd_ªdu˚_powî
(
iwl_å™s
 *
å™s
,

301 c⁄° 
iwl_≤vm_image
 *
∑ylﬂds
,

302 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
);

304 
iwl_å™s_pcõ_˘x_öfo_gí3_£t_ªdu˚_powî
(
iwl_å™s
 *
å™s
,

305 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
);

306 
iwl_å™s_pcõ_˘x_öfo_gí3_£t_°ï
(
iwl_å™s
 *
å™s
,

307 
u32
 
mbx_addr_0_°ï
, u32 
mbx_addr_1_°ï
);

	@iwl-context-info.h

6 #i‚de‡
__iwl_c⁄ãxt_öfo_fûe_h__


7 
	#__iwl_c⁄ãxt_öfo_fûe_h__


	)

10 
	#IWL_MAX_DRAM_ENTRY
 64

	)

11 
	#CSR_CTXT_INFO_BA
 0x40

	)

37 
	eiwl_c⁄ãxt_öfo_Êags
 {

38 
	mIWL_CTXT_INFO_AUTO_FUNC_INIT
 = 0x0001,

39 
	mIWL_CTXT_INFO_EARLY_DEBUG
 = 0x0002,

40 
	mIWL_CTXT_INFO_ENABLE_CDMP
 = 0x0004,

41 
	mIWL_CTXT_INFO_RB_CB_SIZE
 = 0x00f0,

42 
	mIWL_CTXT_INFO_TFD_FORMAT_LONG
 = 0x0100,

43 
	mIWL_CTXT_INFO_RB_SIZE
 = 0x1e00,

44 
	mIWL_CTXT_INFO_RB_SIZE_1K
 = 0x1,

45 
	mIWL_CTXT_INFO_RB_SIZE_2K
 = 0x2,

46 
	mIWL_CTXT_INFO_RB_SIZE_4K
 = 0x4,

47 
	mIWL_CTXT_INFO_RB_SIZE_8K
 = 0x8,

48 
	mIWL_CTXT_INFO_RB_SIZE_12K
 = 0x9,

49 
	mIWL_CTXT_INFO_RB_SIZE_16K
 = 0xa,

50 
	mIWL_CTXT_INFO_RB_SIZE_20K
 = 0xb,

51 
	mIWL_CTXT_INFO_RB_SIZE_24K
 = 0xc,

52 
	mIWL_CTXT_INFO_RB_SIZE_28K
 = 0xd,

53 
	mIWL_CTXT_INFO_RB_SIZE_32K
 = 0xe,

62 
	siwl_c⁄ãxt_öfo_vîsi⁄
 {

63 
__À16
 
	mmac_id
;

64 
__À16
 
	mvîsi⁄
;

65 
__À16
 
	msize
;

66 
__À16
 
	mª£rved
;

67 } 
	g__∑cked
;

73 
	siwl_c⁄ãxt_öfo_c⁄åﬁ
 {

74 
__À32
 
	mc⁄åﬁ_Êags
;

75 
__À32
 
	mª£rved
;

76 } 
	g__∑cked
;

85 
	siwl_c⁄ãxt_öfo_døm
 {

86 
__À64
 
	mumac_img
[
IWL_MAX_DRAM_ENTRY
];

87 
__À64
 
	mlmac_img
[
IWL_MAX_DRAM_ENTRY
];

88 
__À64
 
	mvútuÆ_img
[
IWL_MAX_DRAM_ENTRY
];

89 } 
	g__∑cked
;

97 
	siwl_c⁄ãxt_öfo_rbd_cfg
 {

98 
__À64
 
	m‰ì_rbd_addr
;

99 
__À64
 
	mu£d_rbd_addr
;

100 
__À64
 
	m°©us_wr_±r
;

101 } 
	g__∑cked
;

108 
	siwl_c⁄ãxt_öfo_hcmd_cfg
 {

109 
__À64
 
	mcmd_queue_addr
;

110 
u8
 
	mcmd_queue_size
;

111 
u8
 
	mª£rved
[7];

112 } 
	g__∑cked
;

119 
	siwl_c⁄ãxt_öfo_dump_cfg
 {

120 
__À64
 
	mc‹e_dump_addr
;

121 
__À32
 
	mc‹e_dump_size
;

122 
__À32
 
	mª£rved
;

123 } 
	g__∑cked
;

130 
	siwl_c⁄ãxt_öfo_≤vm_cfg
 {

131 
__À64
 
	m∂©f‹m_nvm_addr
;

132 
__À32
 
	m∂©f‹m_nvm_size
;

133 
__À32
 
	mª£rved
;

134 } 
	g__∑cked
;

142 
	siwl_c⁄ãxt_öfo_óæy_dbg_cfg
 {

143 
__À64
 
	móæy_debug_addr
;

144 
__À32
 
	móæy_debug_size
;

145 
__À32
 
	mª£rved
;

146 } 
	g__∑cked
;

159 
	siwl_c⁄ãxt_öfo
 {

160 
iwl_c⁄ãxt_öfo_vîsi⁄
 
	mvîsi⁄
;

161 
iwl_c⁄ãxt_öfo_c⁄åﬁ
 
	mc⁄åﬁ
;

162 
__À64
 
	mª£rved0
;

163 
iwl_c⁄ãxt_öfo_rbd_cfg
 
	mrbd_cfg
;

164 
iwl_c⁄ãxt_öfo_hcmd_cfg
 
	mhcmd_cfg
;

165 
__À32
 
	mª£rved1
[4];

166 
iwl_c⁄ãxt_öfo_dump_cfg
 
	mdump_cfg
;

167 
iwl_c⁄ãxt_öfo_óæy_dbg_cfg
 
	medbg_cfg
;

168 
iwl_c⁄ãxt_öfo_≤vm_cfg
 
	m≤vm_cfg
;

169 
__À32
 
	mª£rved2
[16];

170 
iwl_c⁄ãxt_öfo_døm
 
	mdøm
;

171 
__À32
 
	mª£rved3
[16];

172 } 
	g__∑cked
;

174 
iwl_pcõ_˘xt_öfo_öô
(
iwl_å™s
 *
å™s
, c⁄° 
fw_img
 *
fw
);

175 
iwl_pcõ_˘xt_öfo_‰ì
(
iwl_å™s
 *
å™s
);

176 
iwl_pcõ_˘xt_öfo_‰ì_∑gög
(
iwl_å™s
 *
å™s
);

177 
iwl_pcõ_öô_fw_£c
(
iwl_å™s
 *
å™s
,

178 c⁄° 
fw_img
 *
fw
,

179 
iwl_c⁄ãxt_öfo_døm
 *
˘xt_døm
);

180 *
iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
iwl_å™s
 *
å™s
,

181 
size_t
 
size
,

182 
dma_addr_t
 *
phys
);

183 
iwl_pcõ_˘xt_öfo_Æloc_dma
(
iwl_å™s
 *
å™s
,

184 c⁄° *
d©a
, 
u32
 
Àn
,

185 
iwl_døm_d©a
 *
døm
);

	@iwl-csr.h

7 #i‚de‡
__iwl_c§_h__


8 
	#__iwl_c§_h__


	)

27 
	#CSR_BASE
 (0x000)

	)

29 
	#CSR_HW_IF_CONFIG_REG
 (
CSR_BASE
+0x000Ë

	)

30 
	#CSR_INT_COALESCING
 (
CSR_BASE
+0x004Ë

	)

31 
	#CSR_INT
 (
CSR_BASE
+0x008Ë

	)

32 
	#CSR_INT_MASK
 (
CSR_BASE
+0x00cË

	)

33 
	#CSR_FH_INT_STATUS
 (
CSR_BASE
+0x010Ë

	)

34 
	#CSR_GPIO_IN
 (
CSR_BASE
+0x018Ë

	)

35 
	#CSR_RESET
 (
CSR_BASE
+0x020Ë

	)

36 
	#CSR_GP_CNTRL
 (
CSR_BASE
+0x024)

	)

37 
	#CSR_FUNC_SCRATCH
 (
CSR_BASE
+0x02cË

	)

40 
	#CSR_INT_PERIODIC_REG
 (
CSR_BASE
+0x005)

	)

50 
	#CSR_HW_REV
 (
CSR_BASE
+0x028)

	)

61 
	#CSR_HW_RF_ID
 (
CSR_BASE
+0x09c)

	)

69 
	#CSR_EEPROM_REG
 (
CSR_BASE
+0x02c)

	)

70 
	#CSR_EEPROM_GP
 (
CSR_BASE
+0x030)

	)

71 
	#CSR_OTP_GP_REG
 (
CSR_BASE
+0x034)

	)

73 
	#CSR_GIO_REG
 (
CSR_BASE
+0x03C)

	)

74 
	#CSR_GP_UCODE_REG
 (
CSR_BASE
+0x048)

	)

75 
	#CSR_GP_DRIVER_REG
 (
CSR_BASE
+0x050)

	)

81 
	#CSR_UCODE_DRV_GP1
 (
CSR_BASE
+0x054)

	)

82 
	#CSR_UCODE_DRV_GP1_SET
 (
CSR_BASE
+0x058)

	)

83 
	#CSR_UCODE_DRV_GP1_CLR
 (
CSR_BASE
+0x05c)

	)

84 
	#CSR_UCODE_DRV_GP2
 (
CSR_BASE
+0x060)

	)

86 
	#CSR_MBOX_SET_REG
 (
CSR_BASE
 + 0x88)

	)

88 
	#CSR_LED_REG
 (
CSR_BASE
+0x094)

	)

89 
	#CSR_DRAM_INT_TBL_REG
 (
CSR_BASE
+0x0A0)

	)

90 
	#CSR_MAC_SHADOW_REG_CTRL
 (
CSR_BASE
 + 0x0A8Ë

	)

91 
	#CSR_MAC_SHADOW_REG_CTRL_RX_WAKE
 
	`BIT
(20)

	)

92 
	#CSR_MAC_SHADOW_REG_CTL2
 (
CSR_BASE
 + 0x0AC)

	)

93 
	#CSR_MAC_SHADOW_REG_CTL2_RX_WAKE
 0xFFFF

	)

96 
	#CSR_LTR_LONG_VAL_AD
 (
CSR_BASE
 + 0x0D4)

	)

97 
	#CSR_LTR_LONG_VAL_AD_NO_SNOOP_REQ
 0x80000000

	)

98 
	#CSR_LTR_LONG_VAL_AD_NO_SNOOP_SCALE
 0x1c000000

	)

99 
	#CSR_LTR_LONG_VAL_AD_NO_SNOOP_VAL
 0x03ff0000

	)

100 
	#CSR_LTR_LONG_VAL_AD_SNOOP_REQ
 0x00008000

	)

101 
	#CSR_LTR_LONG_VAL_AD_SNOOP_SCALE
 0x00001c00

	)

102 
	#CSR_LTR_LONG_VAL_AD_SNOOP_VAL
 0x000003ff

	)

103 
	#CSR_LTR_LONG_VAL_AD_SCALE_USEC
 2

	)

105 
	#CSR_LTR_LAST_MSG
 (
CSR_BASE
 + 0x0DC)

	)

108 
	#CSR_GIO_CHICKEN_BITS
 (
CSR_BASE
+0x100)

	)

110 
	#CSR_IPC_SLEEP_CONTROL
 (
CSR_BASE
 + 0x114)

	)

111 
	#CSR_IPC_SLEEP_CONTROL_SUSPEND
 0x3

	)

112 
	#CSR_IPC_SLEEP_CONTROL_RESUME
 0

	)

117 
	#CSR_DOORBELL_VECTOR
 (
CSR_BASE
 + 0x130)

	)

120 
	#CSR_HOST_CHICKEN
 (
CSR_BASE
 + 0x204)

	)

121 
	#CSR_HOST_CHICKEN_PM_IDLE_SRC_DIS_SB_PME
 
	`BIT
(19)

	)

124 
	#CSR_ANA_PLL_CFG
 (
CSR_BASE
+0x20c)

	)

129 
	#CSR_MONITOR_CFG_REG
 (
CSR_BASE
+0x214)

	)

130 
	#CSR_MONITOR_STATUS_REG
 (
CSR_BASE
+0x228)

	)

131 
	#CSR_MONITOR_XTAL_RESOURCES
 (0x00000010)

	)

141 
	#CSR_HW_REV_WA_REG
 (
CSR_BASE
+0x22C)

	)

143 
	#CSR_DBG_HPET_MEM_REG
 (
CSR_BASE
+0x240)

	)

144 
	#CSR_DBG_LINK_PWR_MGMT_REG
 (
CSR_BASE
+0x250)

	)

150 
	#CSR_FUNC_SCRATCH_INIT_VALUE
 (0x01010101)

	)

153 
	#CSR_HW_IF_CONFIG_REG_MSK_MAC_STEP_DASH
 (0x0000000F)

	)

154 
	#CSR_HW_IF_CONFIG_REG_BIT_MONITOR_SRAM
 (0x00000080)

	)

155 
	#CSR_HW_IF_CONFIG_REG_MSK_BOARD_VER
 (0x000000C0)

	)

156 
	#CSR_HW_IF_CONFIG_REG_BIT_MAC_SI
 (0x00000100)

	)

157 
	#CSR_HW_IF_CONFIG_REG_BIT_RADIO_SI
 (0x00000200)

	)

158 
	#CSR_HW_IF_CONFIG_REG_D3_DEBUG
 (0x00000200)

	)

159 
	#CSR_HW_IF_CONFIG_REG_MSK_PHY_TYPE
 (0x00000C00)

	)

160 
	#CSR_HW_IF_CONFIG_REG_MSK_PHY_DASH
 (0x00003000)

	)

161 
	#CSR_HW_IF_CONFIG_REG_MSK_PHY_STEP
 (0x0000C000)

	)

163 
	#CSR_HW_IF_CONFIG_REG_POS_MAC_DASH
 (0)

	)

164 
	#CSR_HW_IF_CONFIG_REG_POS_MAC_STEP
 (2)

	)

165 
	#CSR_HW_IF_CONFIG_REG_POS_BOARD_VER
 (6)

	)

166 
	#CSR_HW_IF_CONFIG_REG_POS_PHY_TYPE
 (10)

	)

167 
	#CSR_HW_IF_CONFIG_REG_POS_PHY_DASH
 (12)

	)

168 
	#CSR_HW_IF_CONFIG_REG_POS_PHY_STEP
 (14)

	)

170 
	#CSR_HW_IF_CONFIG_REG_BIT_HAP_WAKE_L1A
 (0x00080000)

	)

171 
	#CSR_HW_IF_CONFIG_REG_BIT_EEPROM_OWN_SEM
 (0x00200000)

	)

172 
	#CSR_HW_IF_CONFIG_REG_BIT_NIC_READY
 (0x00400000Ë

	)

173 
	#CSR_HW_IF_CONFIG_REG_BIT_NIC_PREPARE_DONE
 (0x02000000Ë

	)

174 
	#CSR_HW_IF_CONFIG_REG_PREPARE
 (0x08000000Ë

	)

175 
	#CSR_HW_IF_CONFIG_REG_ENABLE_PME
 (0x10000000)

	)

176 
	#CSR_HW_IF_CONFIG_REG_PERSIST_MODE
 (0x40000000Ë

	)

178 
	#CSR_MBOX_SET_REG_OS_ALIVE
 
	`BIT
(5)

	)

180 
	#CSR_INT_PERIODIC_DIS
 (0x00Ë

	)

181 
	#CSR_INT_PERIODIC_ENA
 (0xFFË

	)

185 
	#CSR_INT_BIT_FH_RX
 (1 << 31Ë

	)

186 
	#CSR_INT_BIT_HW_ERR
 (1 << 29Ë

	)

187 
	#CSR_INT_BIT_RX_PERIODIC
 (1 << 28Ë

	)

188 
	#CSR_INT_BIT_FH_TX
 (1 << 27Ë

	)

189 
	#CSR_INT_BIT_SCD
 (1 << 26Ë

	)

190 
	#CSR_INT_BIT_SW_ERR
 (1 << 25Ë

	)

191 
	#CSR_INT_BIT_RF_KILL
 (1 << 7Ë

	)

192 
	#CSR_INT_BIT_CT_KILL
 (1 << 6Ë

	)

193 
	#CSR_INT_BIT_SW_RX
 (1 << 3Ë

	)

194 
	#CSR_INT_BIT_WAKEUP
 (1 << 1Ë

	)

195 
	#CSR_INT_BIT_ALIVE
 (1 << 0Ë

	)

197 
	#CSR_INI_SET_MASK
 (
CSR_INT_BIT_FH_RX
 | \

198 
CSR_INT_BIT_HW_ERR
 | \

199 
CSR_INT_BIT_FH_TX
 | \

200 
CSR_INT_BIT_SW_ERR
 | \

201 
CSR_INT_BIT_RF_KILL
 | \

202 
CSR_INT_BIT_SW_RX
 | \

203 
CSR_INT_BIT_WAKEUP
 | \

204 
CSR_INT_BIT_ALIVE
 | \

205 
CSR_INT_BIT_RX_PERIODIC
)

	)

208 
	#CSR_FH_INT_BIT_ERR
 (1 << 31Ë

	)

209 
	#CSR_FH_INT_BIT_HI_PRIOR
 (1 << 30Ë

	)

210 
	#CSR_FH_INT_BIT_RX_CHNL1
 (1 << 17Ë

	)

211 
	#CSR_FH_INT_BIT_RX_CHNL0
 (1 << 16Ë

	)

212 
	#CSR_FH_INT_BIT_TX_CHNL1
 (1 << 1Ë

	)

213 
	#CSR_FH_INT_BIT_TX_CHNL0
 (1 << 0Ë

	)

215 
	#CSR_FH_INT_RX_MASK
 (
CSR_FH_INT_BIT_HI_PRIOR
 | \

216 
CSR_FH_INT_BIT_RX_CHNL1
 | \

217 
CSR_FH_INT_BIT_RX_CHNL0
)

	)

219 
	#CSR_FH_INT_TX_MASK
 (
CSR_FH_INT_BIT_TX_CHNL1
 | \

220 
CSR_FH_INT_BIT_TX_CHNL0
)

	)

223 
	#CSR_GPIO_IN_BIT_AUX_POWER
 (0x00000200)

	)

224 
	#CSR_GPIO_IN_VAL_VAUX_PWR_SRC
 (0x00000000)

	)

225 
	#CSR_GPIO_IN_VAL_VMAIN_PWR_SRC
 (0x00000200)

	)

228 
	#CSR_RESET_REG_FLAG_NEVO_RESET
 (0x00000001)

	)

229 
	#CSR_RESET_REG_FLAG_FORCE_NMI
 (0x00000002)

	)

230 
	#CSR_RESET_REG_FLAG_SW_RESET
 (0x00000080)

	)

231 
	#CSR_RESET_REG_FLAG_MASTER_DISABLED
 (0x00000100)

	)

232 
	#CSR_RESET_REG_FLAG_STOP_MASTER
 (0x00000200)

	)

233 
	#CSR_RESET_LINK_PWR_MGMT_DISABLED
 (0x80000000)

	)

274 
	#CSR_GP_CNTRL_REG_FLAG_MAC_CLOCK_READY
 (0x00000001)

	)

275 
	#CSR_GP_CNTRL_REG_FLAG_INIT_DONE
 (0x00000004)

	)

276 
	#CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
 (0x00000008)

	)

277 
	#CSR_GP_CNTRL_REG_FLAG_GOING_TO_SLEEP
 (0x00000010)

	)

278 
	#CSR_GP_CNTRL_REG_FLAG_XTAL_ON
 (0x00000400)

	)

280 
	#CSR_GP_CNTRL_REG_VAL_MAC_ACCESS_EN
 (0x00000001)

	)

282 
	#CSR_GP_CNTRL_REG_MSK_POWER_SAVE_TYPE
 (0x07000000)

	)

283 
	#CSR_GP_CNTRL_REG_FLAG_RFKILL_WAKE_L1A_EN
 (0x04000000)

	)

284 
	#CSR_GP_CNTRL_REG_FLAG_HW_RF_KILL_SW
 (0x08000000)

	)

287 
	#CSR_GP_CNTRL_REG_FLAG_MAC_INIT
 
	`BIT
(6)

	)

288 
	#CSR_GP_CNTRL_REG_FLAG_ROM_START
 
	`BIT
(7)

	)

289 
	#CSR_GP_CNTRL_REG_FLAG_MAC_STATUS
 
	`BIT
(20)

	)

290 
	#CSR_GP_CNTRL_REG_FLAG_BZ_MAC_ACCESS_REQ
 
	`BIT
(21)

	)

291 
	#CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_STATUS
 
	`BIT
(28)

	)

292 
	#CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_REQ
 
	`BIT
(29)

	)

293 
	#CSR_GP_CNTRL_REG_FLAG_SW_RESET
 
	`BIT
(31)

	)

296 
	#CSR_HW_REV_STEP_DASH
(
_vÆ
Ë((_vÆË& 
CSR_HW_IF_CONFIG_REG_MSK_MAC_STEP_DASH
)

	)

297 
	#CSR_HW_REV_TYPE
(
_vÆ
Ë(((_vÆË& 0x000FFF0Ë>> 4)

	)

300 
	#CSR_HW_RFID_FLAVOR
(
_vÆ
Ë(((_vÆË& 0x000000FË>> 0)

	)

301 
	#CSR_HW_RFID_DASH
(
_vÆ
Ë(((_vÆË& 0x00000F0Ë>> 4)

	)

302 
	#CSR_HW_RFID_STEP
(
_vÆ
Ë(((_vÆË& 0x0000F00Ë>> 8)

	)

303 
	#CSR_HW_RFID_TYPE
(
_vÆ
Ë(((_vÆË& 0x0FFF000Ë>> 12)

	)

304 
	#CSR_HW_RFID_IS_CDB
(
_vÆ
Ë(((_vÆË& 0x10000000Ë>> 28)

	)

305 
	#CSR_HW_RFID_IS_JACKET
(
_vÆ
Ë(((_vÆË& 0x20000000Ë>> 29)

	)

311 
	mSILICON_A_STEP
 = 0,

312 
	mSILICON_B_STEP
,

313 
	mSILICON_C_STEP
,

314 
	mSILICON_D_STEP
,

315 
	mSILICON_E_STEP
,

316 
	mSILICON_TC_STEP
 = 0xe,

317 
	mSILICON_Z_STEP
 = 0xf,

321 
	#CSR_HW_REV_TYPE_MSK
 (0x000FFF0)

	)

322 
	#CSR_HW_REV_TYPE_5300
 (0x0000020)

	)

323 
	#CSR_HW_REV_TYPE_5350
 (0x0000030)

	)

324 
	#CSR_HW_REV_TYPE_5100
 (0x0000050)

	)

325 
	#CSR_HW_REV_TYPE_5150
 (0x0000040)

	)

326 
	#CSR_HW_REV_TYPE_1000
 (0x0000060)

	)

327 
	#CSR_HW_REV_TYPE_6x00
 (0x0000070)

	)

328 
	#CSR_HW_REV_TYPE_6x50
 (0x0000080)

	)

329 
	#CSR_HW_REV_TYPE_6150
 (0x0000084)

	)

330 
	#CSR_HW_REV_TYPE_6x05
 (0x00000B0)

	)

331 
	#CSR_HW_REV_TYPE_6x30
 
CSR_HW_REV_TYPE_6x05


	)

332 
	#CSR_HW_REV_TYPE_6x35
 
CSR_HW_REV_TYPE_6x05


	)

333 
	#CSR_HW_REV_TYPE_2x30
 (0x00000C0)

	)

334 
	#CSR_HW_REV_TYPE_2x00
 (0x0000100)

	)

335 
	#CSR_HW_REV_TYPE_105
 (0x0000110)

	)

336 
	#CSR_HW_REV_TYPE_135
 (0x0000120)

	)

337 
	#CSR_HW_REV_TYPE_3160
 (0x0000164)

	)

338 
	#CSR_HW_REV_TYPE_7265D
 (0x0000210)

	)

339 
	#CSR_HW_REV_TYPE_NONE
 (0x00001F0)

	)

340 
	#CSR_HW_REV_TYPE_QNJ
 (0x0000360)

	)

341 
	#CSR_HW_REV_TYPE_QNJ_B0
 (0x0000361)

	)

342 
	#CSR_HW_REV_TYPE_QU_B0
 (0x0000331)

	)

343 
	#CSR_HW_REV_TYPE_QU_C0
 (0x0000332)

	)

344 
	#CSR_HW_REV_TYPE_QUZ
 (0x0000351)

	)

345 
	#CSR_HW_REV_TYPE_HR_CDB
 (0x0000340)

	)

346 
	#CSR_HW_REV_TYPE_SO
 (0x0000370)

	)

347 
	#CSR_HW_REV_TYPE_TY
 (0x0000420)

	)

350 
	#CSR_HW_RF_ID_TYPE_JF
 (0x00105100)

	)

351 
	#CSR_HW_RF_ID_TYPE_HR
 (0x0010A000)

	)

352 
	#CSR_HW_RF_ID_TYPE_HR1
 (0x0010c100)

	)

353 
	#CSR_HW_RF_ID_TYPE_HRCDB
 (0x00109F00)

	)

354 
	#CSR_HW_RF_ID_TYPE_GF
 (0x0010D000)

	)

355 
	#CSR_HW_RF_ID_TYPE_GF4
 (0x0010E000)

	)

356 
	#CSR_HW_RF_ID_TYPE_MS
 (0x00111000)

	)

357 
	#CSR_HW_RF_ID_TYPE_FM
 (0x00112000)

	)

358 
	#CSR_HW_RF_ID_TYPE_WP
 (0x00113000)

	)

361 
	#CSR_HW_RF_STEP
(
_vÆ
Ë(((_vÆË>> 8Ë& 0xF)

	)

364 
	#CSR_EEPROM_REG_READ_VALID_MSK
 (0x00000001)

	)

365 
	#CSR_EEPROM_REG_BIT_CMD
 (0x00000002)

	)

366 
	#CSR_EEPROM_REG_MSK_ADDR
 (0x0000FFFC)

	)

367 
	#CSR_EEPROM_REG_MSK_DATA
 (0xFFFF0000)

	)

370 
	#CSR_EEPROM_GP_VALID_MSK
 (0x00000007Ë

	)

371 
	#CSR_EEPROM_GP_IF_OWNER_MSK
 (0x00000180)

	)

372 
	#CSR_EEPROM_GP_BAD_SIGNATURE_BOTH_EEP_AND_OTP
 (0x00000000)

	)

373 
	#CSR_EEPROM_GP_BAD_SIG_EEP_GOOD_SIG_OTP
 (0x00000001)

	)

374 
	#CSR_EEPROM_GP_GOOD_SIG_EEP_LESS_THAN_4K
 (0x00000002)

	)

375 
	#CSR_EEPROM_GP_GOOD_SIG_EEP_MORE_THAN_4K
 (0x00000004)

	)

378 
	#CSR_OTP_GP_REG_DEVICE_SELECT
 (0x00010000Ë

	)

379 
	#CSR_OTP_GP_REG_OTP_ACCESS_MODE
 (0x00020000Ë

	)

380 
	#CSR_OTP_GP_REG_ECC_CORR_STATUS_MSK
 (0x00100000Ë

	)

381 
	#CSR_OTP_GP_REG_ECC_UNCORR_STATUS_MSK
 (0x00200000Ë

	)

384 
	#CSR_GP_REG_POWER_SAVE_STATUS_MSK
 (0x03000000Ë

	)

385 
	#CSR_GP_REG_NO_POWER_SAVE
 (0x00000000)

	)

386 
	#CSR_GP_REG_MAC_POWER_SAVE
 (0x01000000)

	)

387 
	#CSR_GP_REG_PHY_POWER_SAVE
 (0x02000000)

	)

388 
	#CSR_GP_REG_POWER_SAVE_ERROR
 (0x03000000)

	)

392 
	#CSR_GIO_REG_VAL_L0S_DISABLED
 (0x00000002)

	)

422 
	#CSR_UCODE_DRV_GP1_BIT_MAC_SLEEP
 (0x00000001)

	)

423 
	#CSR_UCODE_SW_BIT_RFKILL
 (0x00000002)

	)

424 
	#CSR_UCODE_DRV_GP1_BIT_CMD_BLOCKED
 (0x00000004)

	)

425 
	#CSR_UCODE_DRV_GP1_REG_BIT_CT_KILL_EXIT
 (0x00000008)

	)

426 
	#CSR_UCODE_DRV_GP1_BIT_D3_CFG_COMPLETE
 (0x00000020)

	)

429 
	#CSR_GP_DRIVER_REG_BIT_RADIO_SKU_MSK
 (0x00000003)

	)

430 
	#CSR_GP_DRIVER_REG_BIT_RADIO_SKU_3x3_HYB
 (0x00000000)

	)

431 
	#CSR_GP_DRIVER_REG_BIT_RADIO_SKU_2x2_HYB
 (0x00000001)

	)

432 
	#CSR_GP_DRIVER_REG_BIT_RADIO_SKU_2x2_IPA
 (0x00000002)

	)

433 
	#CSR_GP_DRIVER_REG_BIT_CALIB_VERSION6
 (0x00000004)

	)

434 
	#CSR_GP_DRIVER_REG_BIT_6050_1x2
 (0x00000008)

	)

436 
	#CSR_GP_DRIVER_REG_BIT_RADIO_IQ_INVER
 (0x00000080)

	)

439 
	#CSR_GIO_CHICKEN_BITS_REG_BIT_L1A_NO_L0S_RX
 (0x00800000)

	)

440 
	#CSR_GIO_CHICKEN_BITS_REG_BIT_DIS_L0S_EXIT_TIMER
 (0x20000000)

	)

443 
	#CSR_LED_BSM_CTRL_MSK
 (0xFFFFFFDF)

	)

444 
	#CSR_LED_REG_TURN_ON
 (0x60)

	)

445 
	#CSR_LED_REG_TURN_OFF
 (0x20)

	)

448 
	#CSR50_ANA_PLL_CFG_VAL
 (0x00880300)

	)

451 
	#CSR_DBG_HPET_MEM_REG_VAL
 (0xFFFF0000)

	)

454 
	#CSR_DRAM_INT_TBL_ENABLE
 (1 << 31)

	)

455 
	#CSR_DRAM_INIT_TBL_WRITE_POINTER
 (1 << 28)

	)

456 
	#CSR_DRAM_INIT_TBL_WRAP_CHECK
 (1 << 27)

	)

483 
	#HEEP_CTRL_WRD_PCIEX_CTRL_REG
 (
CSR_BASE
+0x0ec)

	)

484 
	#HEEP_CTRL_WRD_PCIEX_DATA_REG
 (
CSR_BASE
+0x0f4)

	)

501 
	#HBUS_BASE
 (0x400)

	)

512 
	#HBUS_TARG_MEM_RADDR
 (
HBUS_BASE
+0x00c)

	)

513 
	#HBUS_TARG_MEM_WADDR
 (
HBUS_BASE
+0x010)

	)

514 
	#HBUS_TARG_MEM_WDAT
 (
HBUS_BASE
+0x018)

	)

515 
	#HBUS_TARG_MEM_RDAT
 (
HBUS_BASE
+0x01c)

	)

518 
	#HBUS_TARG_MBX_C
 (
HBUS_BASE
+0x030)

	)

519 
	#HBUS_TARG_MBX_C_REG_BIT_CMD_BLOCKED
 (0x00000004)

	)

529 
	#HBUS_TARG_PRPH_WADDR
 (
HBUS_BASE
+0x044)

	)

530 
	#HBUS_TARG_PRPH_RADDR
 (
HBUS_BASE
+0x048)

	)

531 
	#HBUS_TARG_PRPH_WDAT
 (
HBUS_BASE
+0x04c)

	)

532 
	#HBUS_TARG_PRPH_RDAT
 (
HBUS_BASE
+0x050)

	)

535 
	#HBUS_TARG_TEST_REG
 (
HBUS_BASE
+0x05c)

	)

544 
	#HBUS_TARG_WRPTR
 (
HBUS_BASE
+0x060)

	)

546 
	#HBUS_TARG_WRPTR_Q_SHIFT
 (16)

	)

547 
	#HBUS_TARG_WRPTR_RX_Q
(
q
Ë(((qË+ 512Ë<< 
HBUS_TARG_WRPTR_Q_SHIFT
)

	)

559 
	#IWL_HOST_INT_TIMEOUT_MAX
 (0xFF)

	)

560 
	#IWL_HOST_INT_TIMEOUT_DEF
 (0x40)

	)

561 
	#IWL_HOST_INT_TIMEOUT_MIN
 (0x0)

	)

562 
	#IWL_HOST_INT_OPER_MODE
 
	`BIT
(31)

	)

569 
	edtd_diode_ªg
 {

570 
	mDTS_DIODE_REG_DIG_VAL
 = 0x000000FF,

571 
	mDTS_DIODE_REG_VREF_LOW
 = 0x0000FF00,

572 
	mDTS_DIODE_REG_VREF_HIGH
 = 0x00FF0000,

573 
	mDTS_DIODE_REG_VREF_ID
 = 0x03000000,

574 
	mDTS_DIODE_REG_PASS_ONCE
 = 0x80000000,

575 
	mDTS_DIODE_REG_FLAGS_MSK
 = 0xFF000000,

577 
	mDTS_DIODE_REG_FLAGS_VREFS_ID_POS
 = 0,

578 
	mDTS_DIODE_REG_FLAGS_VREFS_ID
 = 0x00000003,

579 
	mDTS_DIODE_REG_FLAGS_PASS_ONCE_POS
 = 7,

580 
	mDTS_DIODE_REG_FLAGS_PASS_ONCE
 = 0x00000080,

587 
	#CSR_MSIX_BASE
 (0x2000)

	)

588 
	#CSR_MSIX_FH_INT_CAUSES_AD
 (
CSR_MSIX_BASE
 + 0x800)

	)

589 
	#CSR_MSIX_FH_INT_MASK_AD
 (
CSR_MSIX_BASE
 + 0x804)

	)

590 
	#CSR_MSIX_HW_INT_CAUSES_AD
 (
CSR_MSIX_BASE
 + 0x808)

	)

591 
	#CSR_MSIX_HW_INT_MASK_AD
 (
CSR_MSIX_BASE
 + 0x80C)

	)

592 
	#CSR_MSIX_AUTOMASK_ST_AD
 (
CSR_MSIX_BASE
 + 0x810)

	)

593 
	#CSR_MSIX_RX_IVAR_AD_REG
 (
CSR_MSIX_BASE
 + 0x880)

	)

594 
	#CSR_MSIX_IVAR_AD_REG
 (
CSR_MSIX_BASE
 + 0x890)

	)

595 
	#CSR_MSIX_PENDING_PBA_AD
 (
CSR_MSIX_BASE
 + 0x1000)

	)

596 
	#CSR_MSIX_RX_IVAR
(
ˇu£
Ë(
CSR_MSIX_RX_IVAR_AD_REG
 + (ˇu£))

	)

597 
	#CSR_MSIX_IVAR
(
ˇu£
Ë(
CSR_MSIX_IVAR_AD_REG
 + (ˇu£))

	)

599 
	#MSIX_FH_INT_CAUSES_Q
(
q
Ë(q)

	)

604 
	emsix_fh_öt_ˇu£s
 {

605 
	mMSIX_FH_INT_CAUSES_Q0
 = 
BIT
(0),

606 
	mMSIX_FH_INT_CAUSES_Q1
 = 
BIT
(1),

607 
	mMSIX_FH_INT_CAUSES_D2S_CH0_NUM
 = 
BIT
(16),

608 
	mMSIX_FH_INT_CAUSES_D2S_CH1_NUM
 = 
BIT
(17),

609 
	mMSIX_FH_INT_CAUSES_S2D
 = 
BIT
(19),

610 
	mMSIX_FH_INT_CAUSES_FH_ERR
 = 
BIT
(21),

614 
	#MSIX_FH_INT_CAUSES_DATA_QUEUE
 0xffff

	)

619 
	emsix_hw_öt_ˇu£s
 {

620 
	mMSIX_HW_INT_CAUSES_REG_ALIVE
 = 
BIT
(0),

621 
	mMSIX_HW_INT_CAUSES_REG_WAKEUP
 = 
BIT
(1),

622 
	mMSIX_HW_INT_CAUSES_REG_IML
 = 
BIT
(1),

623 
	mMSIX_HW_INT_CAUSES_REG_RESET_DONE
 = 
BIT
(2),

624 
	mMSIX_HW_INT_CAUSES_REG_TOP_FATAL_ERR
 = 
BIT
(3),

625 
	mMSIX_HW_INT_CAUSES_REG_SW_ERR_BZ
 = 
BIT
(5),

626 
	mMSIX_HW_INT_CAUSES_REG_CT_KILL
 = 
BIT
(6),

627 
	mMSIX_HW_INT_CAUSES_REG_RF_KILL
 = 
BIT
(7),

628 
	mMSIX_HW_INT_CAUSES_REG_PERIODIC
 = 
BIT
(8),

629 
	mMSIX_HW_INT_CAUSES_REG_SW_ERR
 = 
BIT
(25),

630 
	mMSIX_HW_INT_CAUSES_REG_SCD
 = 
BIT
(26),

631 
	mMSIX_HW_INT_CAUSES_REG_FH_TX
 = 
BIT
(27),

632 
	mMSIX_HW_INT_CAUSES_REG_HW_ERR
 = 
BIT
(29),

633 
	mMSIX_HW_INT_CAUSES_REG_HAP
 = 
BIT
(30),

636 
	#MSIX_MIN_INTERRUPT_VECTORS
 2

	)

637 
	#MSIX_AUTO_CLEAR_CAUSE
 0

	)

638 
	#MSIX_NON_AUTO_CLEAR_CAUSE
 
	`BIT
(7)

	)

644 
	#CSR_ADDR_BASE
(
å™s
Ë(—øns)->
cfg
->
mac_addr_‰om_c§
)

	)

645 
	#CSR_MAC_ADDR0_OTP
(
å™s
Ë(
	`CSR_ADDR_BASE
—ønsË+ 0x00)

	)

646 
	#CSR_MAC_ADDR1_OTP
(
å™s
Ë(
	`CSR_ADDR_BASE
—ønsË+ 0x04)

	)

647 
	#CSR_MAC_ADDR0_STRAP
(
å™s
Ë(
	`CSR_ADDR_BASE
—ønsË+ 0x08)

	)

648 
	#CSR_MAC_ADDR1_STRAP
(
å™s
Ë(
	`CSR_ADDR_BASE
—ønsË+ 0x0c)

	)

	@iwl-dbg-tlv.c

5 
	~<löux/fúmw¨e.h
>

6 
	~"iwl-drv.h
"

7 
	~"iwl-å™s.h
"

8 
	~"iwl-dbg-év.h
"

9 
	~"fw/dbg.h
"

10 
	~"fw/ru¡ime.h
"

22 
	eiwl_dbg_év_ty≥
 {

23 
	mIWL_DBG_TLV_TYPE_DEBUG_INFO
 =

24 
IWL_UCODE_TLV_TYPE_DEBUG_INFO
 - 
IWL_UCODE_TLV_DEBUG_BASE
,

25 
	mIWL_DBG_TLV_TYPE_BUF_ALLOC
,

26 
	mIWL_DBG_TLV_TYPE_HCMD
,

27 
	mIWL_DBG_TLV_TYPE_REGION
,

28 
	mIWL_DBG_TLV_TYPE_TRIGGER
,

29 
	mIWL_DBG_TLV_TYPE_CONF_SET
,

30 
	mIWL_DBG_TLV_TYPE_NUM
,

38 
	siwl_dbg_év_vî_d©a
 {

39 
	mmö_vî
;

40 
	mmax_vî
;

50 
	siwl_dbg_év_timî_node
 {

51 
li°_hód
 
	mli°
;

52 
timî_li°
 
	mtimî
;

53 
iwl_fw_ru¡ime
 *
	mfwπ
;

54 
iwl_ucode_év
 *
	mév
;

57 c⁄° 
iwl_dbg_év_vî_d©a


58 
	gdbg_vî_èbÀ
[
IWL_DBG_TLV_TYPE_NUM
] = {

59 [
IWL_DBG_TLV_TYPE_DEBUG_INFO
] = {.
mö_vî
 = 1, .
	gmax_vî
 = 1,},

60 [
IWL_DBG_TLV_TYPE_BUF_ALLOC
] = {.
mö_vî
 = 1, .
	gmax_vî
 = 1,},

61 [
IWL_DBG_TLV_TYPE_HCMD
] = {.
mö_vî
 = 1, .
	gmax_vî
 = 1,},

62 [
IWL_DBG_TLV_TYPE_REGION
] = {.
mö_vî
 = 1, .
	gmax_vî
 = 3,},

63 [
IWL_DBG_TLV_TYPE_TRIGGER
] = {.
mö_vî
 = 1, .
	gmax_vî
 = 1,},

64 [
IWL_DBG_TLV_TYPE_CONF_SET
] = {.
mö_vî
 = 1, .
	gmax_vî
 = 1,},

68 
iwl_ucode_év
 *
	$iwl_dbg_év_add
(c⁄° 
iwl_ucode_év
 *
év
,

69 
li°_hód
 *
li°
)

71 
u32
 
Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

72 
iwl_dbg_év_node
 *
node
;

74 
node
 = 
	`kzÆloc
(
	`°ru˘_size
“ode, 
év
.
d©a
, 
Àn
), 
GFP_KERNEL
);

75 i‡(!
node
)

76  
NULL
;

78 
	`mem˝y
(&
node
->
év
,Ålv, (node->tlv));

79 
	`mem˝y
(
node
->
év
.
d©a
,Ålv->d©a, 
Àn
);

80 
	`li°_add_èû
(&
node
->
li°
,Üist);

82  &
node
->
év
;

83 
	}
}

85 
boﬁ
 
	$iwl_dbg_év_vî_suµ‹t
(c⁄° 
iwl_ucode_év
 *
év
)

87 c⁄° 
iwl_fw_öi_hódî
 *
hdr
 = (c⁄° *)&
év
->
d©a
[0];

88 
u32
 
ty≥
 = 
	`À32_to_˝u
(
év
->type);

89 
u32
 
év_idx
 = 
ty≥
 - 
IWL_UCODE_TLV_DEBUG_BASE
;

90 
u32
 
vî
 = 
	`À32_to_˝u
(
hdr
->
vîsi⁄
);

92 i‡(
vî
 < 
dbg_vî_èbÀ
[
év_idx
].
mö_vî
 ||

93 
vî
 > 
dbg_vî_èbÀ
[
év_idx
].
max_vî
)

94  
Ál£
;

96  
åue
;

97 
	}
}

99 
	$iwl_dbg_év_Æloc_debug_öfo
(
iwl_å™s
 *
å™s
,

100 c⁄° 
iwl_ucode_év
 *
év
)

102 c⁄° 
iwl_fw_öi_debug_öfo_év
 *
debug_öfo
 = (c⁄° *)
év
->
d©a
;

104 i‡(
	`À32_to_˝u
(
év
->
Àngth
Ë!(*
debug_öfo
))

105  -
EINVAL
;

108 i‡(
	`°∫Àn
(
debug_öfo
->
debug_cfg_«me
,

109 (
debug_öfo
->
debug_cfg_«me
)) ==

110 (
debug_öfo
->
debug_cfg_«me
))

111  -
EINVAL
;

113 
	`IWL_DEBUG_FW
(
å™s
, "WRT: Loading debug cfg: %s\n",

114 
debug_öfo
->
debug_cfg_«me
);

116 i‡(!
	`iwl_dbg_év_add
(
év
, &
å™s
->
dbg
.
debug_öfo_év_li°
))

117  -
ENOMEM
;

119 
	}
}

121 
	$iwl_dbg_év_Æloc_buf_Æloc
(
iwl_å™s
 *
å™s
,

122 c⁄° 
iwl_ucode_év
 *
év
)

124 c⁄° 
iwl_fw_öi_Æloˇti⁄_év
 *
Æloc
 = (c⁄° *)
év
->
d©a
;

125 
u32
 
buf_loˇti⁄
;

126 
u32
 
Æloc_id
;

128 i‡(
	`À32_to_˝u
(
év
->
Àngth
Ë!(*
Æloc
))

129  -
EINVAL
;

131 
buf_loˇti⁄
 = 
	`À32_to_˝u
(
Æloc
->buf_location);

132 
Æloc_id
 = 
	`À32_to_˝u
(
Æloc
->alloc_id);

134 i‡(
buf_loˇti⁄
 =
IWL_FW_INI_LOCATION_INVALID
 ||

135 
buf_loˇti⁄
 >
IWL_FW_INI_LOCATION_NUM
)

136 
îr
;

138 i‡(
Æloc_id
 =
IWL_FW_INI_ALLOCATION_INVALID
 ||

139 
Æloc_id
 >
IWL_FW_INI_ALLOCATION_NUM
)

140 
îr
;

142 i‡(
buf_loˇti⁄
 =
IWL_FW_INI_LOCATION_NPK_PATH
 &&

143 
Æloc_id
 !
IWL_FW_INI_ALLOCATION_ID_DBGC1
)

144 
îr
;

146 i‡(
buf_loˇti⁄
 =
IWL_FW_INI_LOCATION_SRAM_PATH
 &&

147 
Æloc_id
 !
IWL_FW_INI_ALLOCATION_ID_DBGC1
)

148 
îr
;

150 i‡(
buf_loˇti⁄
 =
IWL_FW_INI_LOCATION_DRAM_PATH
 &&

151 
Æloc
->
ªq_size
 == 0) {

152 
	`IWL_ERR
(
å™s
, "WRT: Invalid DRAM bufferállocationÑequested size (0)\n");

153  -
EINVAL
;

156 
å™s
->
dbg
.
fw_m⁄_cfg
[
Æloc_id
] = *
Æloc
;

159 
îr
:

160 
	`IWL_ERR
(
å™s
,

162 
Æloc_id
, 
buf_loˇti⁄
);

163  -
EINVAL
;

164 
	}
}

166 
	$iwl_dbg_év_Æloc_hcmd
(
iwl_å™s
 *
å™s
,

167 c⁄° 
iwl_ucode_év
 *
év
)

169 c⁄° 
iwl_fw_öi_hcmd_év
 *
hcmd
 = (c⁄° *)
év
->
d©a
;

170 
u32
 
ç
 = 
	`À32_to_˝u
(
hcmd
->
time_poöt
);

172 i‡(
	`À32_to_˝u
(
év
->
Àngth
Ë<(*
hcmd
))

173  -
EINVAL
;

178 i‡(
ç
 =
IWL_FW_INI_TIME_POINT_INVALID
 ||

179 
ç
 >
IWL_FW_INI_TIME_POINT_NUM
 ||

180 
ç
 =
IWL_FW_INI_TIME_POINT_EARLY
) {

181 
	`IWL_ERR
(
å™s
,

183 
ç
);

184  -
EINVAL
;

187 i‡(!
	`iwl_dbg_év_add
(
év
, &
å™s
->
dbg
.
time_poöt
[
ç
].
hcmd_li°
))

188  -
ENOMEM
;

190 
	}
}

192 
	$iwl_dbg_év_Æloc_ªgi⁄
(
iwl_å™s
 *
å™s
,

193 c⁄° 
iwl_ucode_év
 *
év
)

195 c⁄° 
iwl_fw_öi_ªgi⁄_év
 *
ªg
 = (c⁄° *)
év
->
d©a
;

196 
iwl_ucode_év
 **
a˘ive_ªg
;

197 
u32
 
id
 = 
	`À32_to_˝u
(
ªg
->id);

198 
u8
 
ty≥
 = 
ªg
->type;

199 
u32
 
év_Àn
 = (*
év
Ë+ 
	`À32_to_˝u
—lv->
Àngth
);

205 i‡(
	`À32_to_˝u
(
ªg
->
hdr
.
vîsi⁄
) >= 2)

206 
id
 &
IWL_FW_INI_REGION_ID_MASK
;

208 i‡(
	`À32_to_˝u
(
év
->
Àngth
Ë< (*
ªg
))

209  -
EINVAL
;

212 
	`IWL_DEBUG_FW
(
å™s
, "WRT:ÖarsingÑegion: %.*s\n",

213 
IWL_FW_INI_MAX_NAME
, 
ªg
->
«me
);

215 i‡(
id
 >
IWL_FW_INI_MAX_REGION_ID
) {

216 
	`IWL_ERR
(
å™s
, "WRT: InvÆidÑegi⁄ id %u\n", 
id
);

217  -
EINVAL
;

220 i‡(
ty≥
 <
IWL_FW_INI_REGION_INVALID
 ||

221 
ty≥
 >
IWL_FW_INI_REGION_NUM
) {

222 
	`IWL_ERR
(
å™s
, "WRT: InvÆidÑegi⁄Åy≥ %u\n", 
ty≥
);

223  -
EINVAL
;

226 i‡(
ty≥
 =
IWL_FW_INI_REGION_PCI_IOSF_CONFIG
 &&

227 !
å™s
->
›s
->
ªad_c⁄fig32
) {

228 
	`IWL_ERR
(
å™s
, "WRT: Unsuµ‹ãdÑegi⁄Åy≥ %u\n", 
ty≥
);

229  -
EOPNOTSUPP
;

232 i‡(
ty≥
 =
IWL_FW_INI_REGION_INTERNAL_BUFFER
) {

233 
å™s
->
dbg
.
imr_d©a
.
§am_addr
 =

234 
	`À32_to_˝u
(
ªg
->
öã∫Æ_buf„r
.
ba£_addr
);

235 
å™s
->
dbg
.
imr_d©a
.
§am_size
 =

236 
	`À32_to_˝u
(
ªg
->
öã∫Æ_buf„r
.
size
);

240 
a˘ive_ªg
 = &
å™s
->
dbg
.
a˘ive_ªgi⁄s
[
id
];

241 i‡(*
a˘ive_ªg
) {

242 
	`IWL_WARN
(
å™s
, "WRT: OvîridögÑegi⁄ id %u\n", 
id
);

244 
	`k‰ì
(*
a˘ive_ªg
);

247 *
a˘ive_ªg
 = 
	`kmemdup
(
év
, 
év_Àn
, 
GFP_KERNEL
);

248 i‡(!*
a˘ive_ªg
)

249  -
ENOMEM
;

251 
	`IWL_DEBUG_FW
(
å™s
, "WRT: E«blögÑegi⁄ id %uÅy≥ %u\n", 
id
, 
ty≥
);

254 
	}
}

256 
	$iwl_dbg_év_Æloc_åiggî
(
iwl_å™s
 *
å™s
,

257 c⁄° 
iwl_ucode_év
 *
év
)

259 c⁄° 
iwl_fw_öi_åiggî_év
 *
åig
 = (c⁄° *)
év
->
d©a
;

260 
u32
 
ç
 = 
	`À32_to_˝u
(
åig
->
time_poöt
);

261 
u32
 
rf
 = 
	`À32_to_˝u
(
åig
->
ª£t_fw
);

262 
iwl_ucode_év
 *
√w_év
;

264 i‡(
	`À32_to_˝u
(
év
->
Àngth
Ë< (*
åig
))

265  -
EINVAL
;

267 i‡(
ç
 <
IWL_FW_INI_TIME_POINT_INVALID
 ||

268 
ç
 >
IWL_FW_INI_TIME_POINT_NUM
) {

269 
	`IWL_ERR
(
å™s
,

271 
ç
);

272  -
EINVAL
;

275 
	`IWL_DEBUG_FW
(
å™s
,

277 
ç
, 
rf
);

278 
å™s
->
dbg
.
œ°_ç_ª£tfw
 = 0xFF;

280 
√w_év
 = 
	`iwl_dbg_év_add
(
év
, &
å™s
->
dbg
.
time_poöt
[
ç
].
åig_li°
);

281 i‡(!
√w_év
)

282  -
ENOMEM
;

284 i‡(!
	`À32_to_˝u
(
åig
->
occuºí˚s
)) {

285 
iwl_fw_öi_åiggî_év
 *
√w_åig
 = (*)
√w_év
->
d©a
;

287 
√w_åig
->
occuºí˚s
 = 
	`˝u_to_À32
(-1);

291 
	}
}

293 
	$iwl_dbg_év_c⁄fig_£t
(
iwl_å™s
 *
å™s
,

294 c⁄° 
iwl_ucode_év
 *
év
)

296 c⁄° 
iwl_fw_öi_c⁄f_£t_év
 *
c⁄f_£t
 = (c⁄° *)
év
->
d©a
;

297 
u32
 
ç
 = 
	`À32_to_˝u
(
c⁄f_£t
->
time_poöt
);

298 
u32
 
ty≥
 = 
	`À32_to_˝u
(
c⁄f_£t
->
£t_ty≥
);

300 i‡(
ç
 <
IWL_FW_INI_TIME_POINT_INVALID
 ||

301 
ç
 >
IWL_FW_INI_TIME_POINT_NUM
) {

302 
	`IWL_DEBUG_FW
(
å™s
,

303 "WRT: InvÆidÅimêpoöà%u f‹ c⁄fig së TLV\n", 
ç
);

304  -
EINVAL
;

307 i‡(
ty≥
 <
IWL_FW_INI_CONFIG_SET_TYPE_INVALID
 ||

308 
ty≥
 >
IWL_FW_INI_CONFIG_SET_TYPE_MAX_NUM
) {

309 
	`IWL_DEBUG_FW
(
å™s
,

310 "WRT: InvÆid c⁄fig sëÅy≥ %u f‹ c⁄fig së TLV\n", 
ty≥
);

311  -
EINVAL
;

314 i‡(!
	`iwl_dbg_év_add
(
év
, &
å™s
->
dbg
.
time_poöt
[
ç
].
c⁄fig_li°
))

315  -
ENOMEM
;

317 
	}
}

319 (*
dbg_év_Æloc
[])(
iwl_å™s
 *
å™s
,

320 c⁄° 
iwl_ucode_év
 *
év
) = {

321 [
IWL_DBG_TLV_TYPE_DEBUG_INFO
] = 
iwl_dbg_év_Æloc_debug_öfo
,

322 [
IWL_DBG_TLV_TYPE_BUF_ALLOC
] = 
iwl_dbg_év_Æloc_buf_Æloc
,

323 [
IWL_DBG_TLV_TYPE_HCMD
] = 
iwl_dbg_év_Æloc_hcmd
,

324 [
IWL_DBG_TLV_TYPE_REGION
] = 
iwl_dbg_év_Æloc_ªgi⁄
,

325 [
IWL_DBG_TLV_TYPE_TRIGGER
] = 
iwl_dbg_év_Æloc_åiggî
,

326 [
IWL_DBG_TLV_TYPE_CONF_SET
] = 
iwl_dbg_év_c⁄fig_£t
,

327 
	}
};

329 
	$iwl_dbg_év_Æloc
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_ucode_év
 *
év
,

330 
boﬁ
 
ext
)

332 
iwl_öi_cfg_°©e
 *
cfg_°©e
 = 
ext
 ?

333 &
å™s
->
dbg
.
exã∫Æ_öi_cfg
 : &å™s->dbg.
öã∫Æ_öi_cfg
;

334 c⁄° 
iwl_fw_öi_hódî
 *
hdr
 = (c⁄° *)&
év
->
d©a
[0];

335 
u32
 
ty≥
;

336 
u32
 
év_idx
;

337 
u32
 
domaö
;

338 
ªt
;

340 i‡(
	`À32_to_˝u
(
év
->
Àngth
Ë< (*
hdr
))

343 
ty≥
 = 
	`À32_to_˝u
(
év
->type);

344 
év_idx
 = 
ty≥
 - 
IWL_UCODE_TLV_DEBUG_BASE
;

345 
domaö
 = 
	`À32_to_˝u
(
hdr
->domain);

347 i‡(
domaö
 !
IWL_FW_INI_DOMAIN_ALWAYS_ON
 &&

348 !(
domaö
 & 
å™s
->
dbg
.
domaös_bôm≠
)) {

349 
	`IWL_DEBUG_FW
(
å™s
,

351 
domaö
, 
å™s
->
dbg
.
domaös_bôm≠
);

355 i‡(
év_idx
 >
	`ARRAY_SIZE
(
dbg_év_Æloc
) || !dbg_tlv_alloc[tlv_idx]) {

356 
	`IWL_ERR
(
å™s
, "WRT: Unsuµ‹ãd TLVÅy≥ 0x%x\n", 
ty≥
);

357 
out_îr
;

360 i‡(!
	`iwl_dbg_év_vî_suµ‹t
(
év
)) {

361 
	`IWL_ERR
(
å™s
, "WRT: Unsuµ‹ãd TLV 0x%x vîsi⁄ %u\n", 
ty≥
,

362 
	`À32_to_˝u
(
hdr
->
vîsi⁄
));

363 
out_îr
;

366 
ªt
 = 
dbg_év_Æloc
[
év_idx
](
å™s
, 
év
);

367 i‡(
ªt
) {

368 
	`IWL_WARN
(
å™s
,

370 
ty≥
, 
ªt
, 
ext
);

371 
out_îr
;

374 i‡(*
cfg_°©e
 =
IWL_INI_CFG_STATE_NOT_LOADED
)

375 *
cfg_°©e
 = 
IWL_INI_CFG_STATE_LOADED
;

379 
out_îr
:

380 *
cfg_°©e
 = 
IWL_INI_CFG_STATE_CORRUPTED
;

381 
	}
}

383 
	$iwl_dbg_év_dñ_timîs
(
iwl_å™s
 *
å™s
)

385 
li°_hód
 *
timî_li°
 = &
å™s
->
dbg
.
≥riodic_åig_li°
;

386 
iwl_dbg_év_timî_node
 *
node
, *
tmp
;

388 
	`li°_f‹_óch_íåy_ß„
(
node
, 
tmp
, 
timî_li°
, 
li°
) {

389 
	`timî_shutdown_sync
(&
node
->
timî
);

390 
	`li°_dñ
(&
node
->
li°
);

391 
	`k‰ì
(
node
);

393 
	}
}

394 
IWL_EXPORT_SYMBOL
(
iwl_dbg_év_dñ_timîs
);

396 
	$iwl_dbg_év_‰agmíts_‰ì
(
iwl_å™s
 *
å™s
,

397 
iwl_fw_öi_Æloˇti⁄_id
 
Æloc_id
)

399 
iwl_fw_m⁄
 *
fw_m⁄
;

400 
i
;

402 i‡(
Æloc_id
 <
IWL_FW_INI_ALLOCATION_INVALID
 ||

403 
Æloc_id
 >
IWL_FW_INI_ALLOCATION_NUM
)

406 
fw_m⁄
 = &
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
];

408 
i
 = 0; i < 
fw_m⁄
->
num_‰ags
; i++) {

409 
iwl_døm_d©a
 *
‰ag
 = &
fw_m⁄
->
‰ags
[
i
];

411 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
‰ag
->
size
, føg->
block
,

412 
‰ag
->
physiˇl
);

414 
‰ag
->
physiˇl
 = 0;

415 
‰ag
->
block
 = 
NULL
;

416 
‰ag
->
size
 = 0;

419 
	`k‰ì
(
fw_m⁄
->
‰ags
);

420 
fw_m⁄
->
‰ags
 = 
NULL
;

421 
fw_m⁄
->
num_‰ags
 = 0;

422 
	}
}

424 
	$iwl_dbg_év_‰ì
(
iwl_å™s
 *
å™s
)

426 
iwl_dbg_év_node
 *
év_node
, *
év_node_tmp
;

427 
i
;

429 
	`iwl_dbg_év_dñ_timîs
(
å™s
);

431 
i
 = 0; i < 
	`ARRAY_SIZE
(
å™s
->
dbg
.
a˘ive_ªgi⁄s
); i++) {

432 
iwl_ucode_év
 **
a˘ive_ªg
 =

433 &
å™s
->
dbg
.
a˘ive_ªgi⁄s
[
i
];

435 
	`k‰ì
(*
a˘ive_ªg
);

436 *
a˘ive_ªg
 = 
NULL
;

439 
	`li°_f‹_óch_íåy_ß„
(
év_node
, 
év_node_tmp
,

440 &
å™s
->
dbg
.
debug_öfo_év_li°
, 
li°
) {

441 
	`li°_dñ
(&
év_node
->
li°
);

442 
	`k‰ì
(
év_node
);

445 
i
 = 0; i < 
	`ARRAY_SIZE
(
å™s
->
dbg
.
time_poöt
); i++) {

446 
iwl_dbg_év_time_poöt_d©a
 *
ç
 =

447 &
å™s
->
dbg
.
time_poöt
[
i
];

449 
	`li°_f‹_óch_íåy_ß„
(
év_node
, 
év_node_tmp
, &
ç
->
åig_li°
,

450 
li°
) {

451 
	`li°_dñ
(&
év_node
->
li°
);

452 
	`k‰ì
(
év_node
);

455 
	`li°_f‹_óch_íåy_ß„
(
év_node
, 
év_node_tmp
, &
ç
->
hcmd_li°
,

456 
li°
) {

457 
	`li°_dñ
(&
év_node
->
li°
);

458 
	`k‰ì
(
év_node
);

461 
	`li°_f‹_óch_íåy_ß„
(
év_node
, 
év_node_tmp
,

462 &
ç
->
a˘ive_åig_li°
, 
li°
) {

463 
	`li°_dñ
(&
év_node
->
li°
);

464 
	`k‰ì
(
év_node
);

467 
	`li°_f‹_óch_íåy_ß„
(
év_node
, 
év_node_tmp
,

468 &
ç
->
c⁄fig_li°
, 
li°
) {

469 
	`li°_dñ
(&
év_node
->
li°
);

470 
	`k‰ì
(
év_node
);

475 
i
 = 0; i < 
	`ARRAY_SIZE
(
å™s
->
dbg
.
fw_m⁄_öi
); i++)

476 
	`iwl_dbg_év_‰agmíts_‰ì
(
å™s
, 
i
);

477 
	}
}

479 
	$iwl_dbg_év_∑r£_bö
(
iwl_å™s
 *
å™s
, c⁄° 
u8
 *
d©a
,

480 
size_t
 
Àn
)

482 c⁄° 
iwl_ucode_év
 *
év
;

483 
u32
 
év_Àn
;

485 
Àn
 >(*
év
)) {

486 
Àn
 -(*
év
);

487 
év
 = (c⁄° *)
d©a
;

489 
év_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

491 i‡(
Àn
 < 
év_Àn
) {

492 
	`IWL_ERR
(
å™s
, "invalid TLVÜen: %zd/%u\n",

493 
Àn
, 
év_Àn
);

494  -
EINVAL
;

496 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

497 
d©a
 +(*
év
Ë+ 
	`ALIGN
(
év_Àn
, 4);

499 
	`iwl_dbg_év_Æloc
(
å™s
, 
év
, 
åue
);

503 
	}
}

505 
	$iwl_dbg_év_lﬂd_bö
(
devi˚
 *
dev
, 
iwl_å™s
 *
å™s
)

507 c⁄° 
fúmw¨e
 *
fw
;

508 c⁄° *
yoyo_bö
 = "iwl-debug-yoyo.bin";

509 
ªs
;

511 i‡(!
iwlwifi_mod_∑øms
.
íabÀ_öi
 ||

512 
å™s
->
å™s_cfg
->
devi˚_Ámûy
 <
IWL_DEVICE_FAMILY_8000
)

515 
ªs
 = 
	`fúmw¨e_ªque°_now¨n
(&
fw
, 
yoyo_bö
, 
dev
);

516 
	`IWL_DEBUG_FW
(
å™s
, "%†%s\n", 
ªs
 ? "didn'àlﬂd" : "lﬂded", 
yoyo_bö
);

518 i‡(
ªs
)

521 
å™s
->
dbg
.
yoyo_bö_lﬂded
 = 
åue
;

523 
	`iwl_dbg_év_∑r£_bö
(
å™s
, 
fw
->
d©a
, fw->
size
);

525 
	`ªÀa£_fúmw¨e
(
fw
);

526 
	}
}

528 
	$iwl_dbg_év_öô
(
iwl_å™s
 *
å™s
)

530 
i
;

532 
	`INIT_LIST_HEAD
(&
å™s
->
dbg
.
debug_öfo_év_li°
);

533 
	`INIT_LIST_HEAD
(&
å™s
->
dbg
.
≥riodic_åig_li°
);

535 
i
 = 0; i < 
	`ARRAY_SIZE
(
å™s
->
dbg
.
time_poöt
); i++) {

536 
iwl_dbg_év_time_poöt_d©a
 *
ç
 =

537 &
å™s
->
dbg
.
time_poöt
[
i
];

539 
	`INIT_LIST_HEAD
(&
ç
->
åig_li°
);

540 
	`INIT_LIST_HEAD
(&
ç
->
hcmd_li°
);

541 
	`INIT_LIST_HEAD
(&
ç
->
a˘ive_åig_li°
);

542 
	`INIT_LIST_HEAD
(&
ç
->
c⁄fig_li°
);

544 
	}
}

546 
	$iwl_dbg_év_Æloc_‰agmít
(
iwl_fw_ru¡ime
 *
fwπ
,

547 
iwl_døm_d©a
 *
‰ag
, 
u32
 
∑ges
)

549 *
block
 = 
NULL
;

550 
dma_addr_t
 
physiˇl
;

552 i‡(!
‰ag
 || føg->
size
 || !
∑ges
)

553  -
EIO
;

562 
∑ges
 > 1) {

563 
block
 = 
	`dma_Æloc_cohîít
(
fwπ
->
dev
, 
∑ges
 * 
PAGE_SIZE
,

564 &
physiˇl
,

565 
GFP_KERNEL
 | 
__GFP_NOWARN
);

566 i‡(
block
)

569 
	`IWL_WARN
(
fwπ
, "WRT: FailedÅoállocate fragment size %lu\n",

570 
∑ges
 * 
PAGE_SIZE
);

572 
∑ges
 = 
	`DIV_ROUND_UP
(pages, 2);

575 i‡(!
block
)

576  -
ENOMEM
;

578 
‰ag
->
physiˇl
 =Öhysical;

579 
‰ag
->
block
 = block;

580 
‰ag
->
size
 = 
∑ges
 * 
PAGE_SIZE
;

582  
∑ges
;

583 
	}
}

585 
	$iwl_dbg_év_Æloc_‰agmíts
(
iwl_fw_ru¡ime
 *
fwπ
,

586 
iwl_fw_öi_Æloˇti⁄_id
 
Æloc_id
)

588 
iwl_fw_m⁄
 *
fw_m⁄
;

589 
iwl_fw_öi_Æloˇti⁄_év
 *
fw_m⁄_cfg
;

590 
u32
 
num_‰ags
, 
ªmaö_∑ges
, 
‰ag_∑ges
;

591 
i
;

593 i‡(
Æloc_id
 < 
IWL_FW_INI_ALLOCATION_INVALID
 ||

594 
Æloc_id
 >
IWL_FW_INI_ALLOCATION_NUM
)

595  -
EIO
;

597 
fw_m⁄_cfg
 = &
fwπ
->
å™s
->
dbg
.fw_m⁄_cfg[
Æloc_id
];

598 
fw_m⁄
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
];

600 i‡(
fw_m⁄
->
num_‰ags
) {

601 
i
 = 0; i < 
fw_m⁄
->
num_‰ags
; i++)

602 
	`mem£t
(
fw_m⁄
->
‰ags
[
i
].
block
, 0,

603 
fw_m⁄
->
‰ags
[
i
].
size
);

607 i‡(
fw_m⁄_cfg
->
buf_loˇti⁄
 !=

608 
	`˝u_to_À32
(
IWL_FW_INI_LOCATION_DRAM_PATH
))

611 
num_‰ags
 = 
	`À32_to_˝u
(
fw_m⁄_cfg
->
max_‰ags_num
);

612 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
) {

613 i‡(
Æloc_id
 !
IWL_FW_INI_ALLOCATION_ID_DBGC1
)

614  -
EIO
;

615 
num_‰ags
 = 1;

616 } i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_BZ
 &&

617 
Æloc_id
 > 
IWL_FW_INI_ALLOCATION_ID_DBGC3
) {

618  -
EIO
;

621 
ªmaö_∑ges
 = 
	`DIV_ROUND_UP
(
	`À32_to_˝u
(
fw_m⁄_cfg
->
ªq_size
),

622 
PAGE_SIZE
);

623 
num_‰ags
 = 
	`mö_t
(
u32
,Çum_‰ags, 
BUF_ALLOC_MAX_NUM_FRAGS
);

624 
num_‰ags
 = 
	`mö_t
(
u32
,Çum_‰ags, 
ªmaö_∑ges
);

625 
‰ag_∑ges
 = 
	`DIV_ROUND_UP
(
ªmaö_∑ges
, 
num_‰ags
);

627 
fw_m⁄
->
‰ags
 = 
	`kˇŒoc
(
num_‰ags
, (*fw_m⁄->‰ags), 
GFP_KERNEL
);

628 i‡(!
fw_m⁄
->
‰ags
)

629  -
ENOMEM
;

631 
i
 = 0; i < 
num_‰ags
; i++) {

632 
∑ges
 = 
	`mö_t
(
u32
, 
‰ag_∑ges
, 
ªmaö_∑ges
);

634 
	`IWL_DEBUG_FW
(
fwπ
,

636 
Æloc_id
, 
i
, 
∑ges
 * 
PAGE_SIZE
);

638 
∑ges
 = 
	`iwl_dbg_év_Æloc_‰agmít
(
fwπ
, &
fw_m⁄
->
‰ags
[
i
],

639 
∑ges
);

640 i‡(
∑ges
 < 0) {

641 
u32
 
Æloc_size
 = 
	`À32_to_˝u
(
fw_m⁄_cfg
->
ªq_size
) -

642 (
ªmaö_∑ges
 * 
PAGE_SIZE
);

644 i‡(
Æloc_size
 < 
	`À32_to_˝u
(
fw_m⁄_cfg
->
mö_size
)) {

645 
	`iwl_dbg_év_‰agmíts_‰ì
(
fwπ
->
å™s
,

646 
Æloc_id
);

647  
∑ges
;

652 
ªmaö_∑ges
 -
∑ges
;

653 
fw_m⁄
->
num_‰ags
++;

657 
	}
}

659 
	$iwl_dbg_év_≠∂y_buf„r
(
iwl_fw_ru¡ime
 *
fwπ
,

660 
iwl_fw_öi_Æloˇti⁄_id
 
Æloc_id
)

662 
iwl_fw_m⁄
 *
fw_m⁄
;

663 
u32
 
ªmaö_‰ags
, 
num_comm™ds
;

664 
i
, 
fw_m⁄_idx
 = 0;

666 i‡(!
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

667 
IWL_UCODE_TLV_CAPA_DBG_BUF_ALLOC_CMD_SUPP
))

670 i‡(
Æloc_id
 < 
IWL_FW_INI_ALLOCATION_INVALID
 ||

671 
Æloc_id
 >
IWL_FW_INI_ALLOCATION_NUM
)

672  -
EIO
;

674 i‡(
	`À32_to_˝u
(
fwπ
->
å™s
->
dbg
.
fw_m⁄_cfg
[
Æloc_id
].
buf_loˇti⁄
) !=

675 
IWL_FW_INI_LOCATION_DRAM_PATH
)

678 
fw_m⁄
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
];

683 i‡(
Æloc_id
 =
IWL_FW_INI_ALLOCATION_ID_DBGC1
)

684 
fw_m⁄_idx
++;

686 
ªmaö_‰ags
 = 
fw_m⁄
->
num_‰ags
 - 
fw_m⁄_idx
;

687 i‡(!
ªmaö_‰ags
)

690 
num_comm™ds
 = 
	`DIV_ROUND_UP
(
ªmaö_‰ags
, 
BUF_ALLOC_MAX_NUM_FRAGS
);

692 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: Applying DRAM destination (alloc_id=%u)\n",

693 
Æloc_id
);

695 
i
 = 0; i < 
num_comm™ds
; i++) {

696 
u32
 
num_‰ags
 = 
	`mö_t
(u32, 
ªmaö_‰ags
,

697 
BUF_ALLOC_MAX_NUM_FRAGS
);

698 
iwl_buf_Æloc_cmd
 
d©a
 = {

699 .
Æloc_id
 = 
	`˝u_to_À32
(alloc_id),

700 .
num_‰ags
 = 
	`˝u_to_À32
(num_frags),

701 .
buf_loˇti⁄
 =

702 
	`˝u_to_À32
(
IWL_FW_INI_LOCATION_DRAM_PATH
),

704 
iwl_ho°_cmd
 
hcmd
 = {

705 .
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, 
BUFFER_ALLOCATION
),

706 .
d©a
[0] = &data,

707 .
Àn
[0] = (
d©a
),

708 .
Êags
 = 
CMD_SEND_IN_RFKILL
,

710 
ªt
, 
j
;

712 
j
 = 0; j < 
num_‰ags
; j++) {

713 
iwl_buf_Æloc_‰ag
 *
‰ag
 = &
d©a
.
‰ags
[
j
];

714 
iwl_døm_d©a
 *
fw_m⁄_‰ag
 =

715 &
fw_m⁄
->
‰ags
[
fw_m⁄_idx
++];

717 
‰ag
->
addr
 = 
	`˝u_to_À64
(
fw_m⁄_‰ag
->
physiˇl
);

718 
‰ag
->
size
 = 
	`˝u_to_À32
(
fw_m⁄_‰ag
->size);

720 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
hcmd
);

721 i‡(
ªt
)

722  
ªt
;

724 
ªmaö_‰ags
 -
num_‰ags
;

728 
	}
}

730 
	$iwl_dbg_év_≠∂y_buf„rs
(
iwl_fw_ru¡ime
 *
fwπ
)

732 
ªt
, 
i
;

734 i‡(
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

735 
IWL_UCODE_TLV_CAPA_DRAM_FRAG_SUPPORT
))

738 
i
 = 0; i < 
IWL_FW_INI_ALLOCATION_NUM
; i++) {

739 
ªt
 = 
	`iwl_dbg_év_≠∂y_buf„r
(
fwπ
, 
i
);

740 i‡(
ªt
)

741 
	`IWL_WARN
(
fwπ
,

743 
i
, 
ªt
);

745 
	}
}

747 
	$iwl_dbg_év_upd©e_døm
(
iwl_fw_ru¡ime
 *
fwπ
,

748 
iwl_fw_öi_Æloˇti⁄_id
 
Æloc_id
,

749 
iwl_døm_öfo
 *
døm_öfo
)

751 
iwl_fw_m⁄
 *
fw_m⁄
;

752 
u32
 
ªmaö_‰ags
, 
num_‰ags
;

753 
j
, 
fw_m⁄_idx
 = 0;

754 
iwl_buf_Æloc_cmd
 *
d©a
;

756 i‡(
	`À32_to_˝u
(
fwπ
->
å™s
->
dbg
.
fw_m⁄_cfg
[
Æloc_id
].
buf_loˇti⁄
) !=

757 
IWL_FW_INI_LOCATION_DRAM_PATH
) {

758 
	`IWL_DEBUG_FW
(
fwπ
, "WRT:álloc_id %uÜocation isÇot in DRAM_PATH\n",

759 
Æloc_id
);

763 
fw_m⁄
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
];

768 i‡(
Æloc_id
 =
IWL_FW_INI_ALLOCATION_ID_DBGC1
)

769 
fw_m⁄_idx
++;

771 
ªmaö_‰ags
 = 
fw_m⁄
->
num_‰ags
 - 
fw_m⁄_idx
;

772 i‡(!
ªmaö_‰ags
)

775 
num_‰ags
 = 
	`mö_t
(
u32
, 
ªmaö_‰ags
, 
BUF_ALLOC_MAX_NUM_FRAGS
);

776 
d©a
 = &
døm_öfo
->
døm_‰ags
[
Æloc_id
 - 1];

777 
d©a
->
Æloc_id
 = 
	`˝u_to_À32
(alloc_id);

778 
d©a
->
num_‰ags
 = 
	`˝u_to_À32
(num_frags);

779 
d©a
->
buf_loˇti⁄
 = 
	`˝u_to_À32
(
IWL_FW_INI_LOCATION_DRAM_PATH
);

781 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: DRAM buffer detailsálloc_id=%u,Çum_frags=%u\n",

782 
	`˝u_to_À32
(
Æloc_id
), cpu_to_À32(
num_‰ags
));

784 
j
 = 0; j < 
num_‰ags
; j++) {

785 
iwl_buf_Æloc_‰ag
 *
‰ag
 = &
d©a
->
‰ags
[
j
];

786 
iwl_døm_d©a
 *
fw_m⁄_‰ag
 = &
fw_m⁄
->
‰ags
[
fw_m⁄_idx
++];

788 
‰ag
->
addr
 = 
	`˝u_to_À64
(
fw_m⁄_‰ag
->
physiˇl
);

789 
‰ag
->
size
 = 
	`˝u_to_À32
(
fw_m⁄_‰ag
->size);

790 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: DRAM fragment details\n");

791 
	`IWL_DEBUG_FW
(
fwπ
, "frag=%u,áddr=0x%016llx, size=0x%x)\n",

792 
j
, 
	`˝u_to_À64
(
fw_m⁄_‰ag
->
physiˇl
),

793 
	`˝u_to_À32
(
fw_m⁄_‰ag
->
size
));

796 
	}
}

798 
	$iwl_dbg_év_upd©e_døms
(
iwl_fw_ru¡ime
 *
fwπ
)

800 
ªt
, 
i
;

801 
boﬁ
 
døm_Æloc
 = 
Ál£
;

802 
iwl_døm_d©a
 *
‰ags
 =

803 &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[
IWL_FW_INI_ALLOCATION_ID_DBGC1
].
‰ags
[0];

804 
iwl_døm_öfo
 *
døm_öfo
;

806 i‡(!
‰ags
 || !‰ags->
block
)

809 
døm_öfo
 = 
‰ags
->
block
;

811 i‡(!
	`fw_has_ˇ∑
(&
fwπ
->
fw
->
ucode_ˇ∑
,

812 
IWL_UCODE_TLV_CAPA_DRAM_FRAG_SUPPORT
))

815 
	`mem£t
(
døm_öfo
, 0, (*dram_info));

817 
i
 = 
IWL_FW_INI_ALLOCATION_ID_DBGC1
;

818 
i
 < 
IWL_FW_INI_ALLOCATION_NUM
; i++) {

819 i‡(
fwπ
->
å™s
->
dbg
.
fw_m⁄_cfg
[
i
].
buf_loˇti⁄
 ==

820 
IWL_FW_INI_LOCATION_INVALID
)

823 
ªt
 = 
	`iwl_dbg_év_upd©e_døm
(
fwπ
, 
i
, 
døm_öfo
);

824 i‡(!
ªt
)

825 
døm_Æloc
 = 
åue
;

827 
	`IWL_INFO
(
fwπ
,

829 
i
, 
ªt
);

832 i‡(
døm_Æloc
) {

833 
døm_öfo
->
fú°_w‹d
 = 
	`˝u_to_À32
(
DRAM_INFO_FIRST_MAGIC_WORD
);

834 
døm_öfo
->
£c⁄d_w‹d
 = 
	`˝u_to_À32
(
DRAM_INFO_SECOND_MAGIC_WORD
);

836 
	}
}

838 
	$iwl_dbg_év_£nd_hcmds
(
iwl_fw_ru¡ime
 *
fwπ
,

839 
li°_hód
 *
hcmd_li°
)

841 
iwl_dbg_év_node
 *
node
;

843 
	`li°_f‹_óch_íåy
(
node
, 
hcmd_li°
, 
li°
) {

844 
iwl_fw_öi_hcmd_év
 *
hcmd
 = (*)
node
->
év
.
d©a
;

845 
iwl_fw_öi_hcmd
 *
hcmd_d©a
 = &
hcmd
->hcmd;

846 
u16
 
hcmd_Àn
 = 
	`À32_to_˝u
(
node
->
év
.
Àngth
Ë- (*
hcmd
);

847 
iwl_ho°_cmd
 
cmd
 = {

848 .
id
 = 
	`WIDE_ID
(
hcmd_d©a
->
group
, hcmd_data->id),

849 .
Àn
 = { 
hcmd_Àn
, },

850 .
d©a
 = { 
hcmd_d©a
->data, },

853 
	`iwl_å™s_£nd_cmd
(
fwπ
->
å™s
, &
cmd
);

855 
	}
}

857 
	$iwl_dbg_év_≠∂y_c⁄fig
(
iwl_fw_ru¡ime
 *
fwπ
,

858 
li°_hód
 *
c⁄f_li°
)

860 
iwl_dbg_év_node
 *
node
;

862 
	`li°_f‹_óch_íåy
(
node
, 
c⁄f_li°
, 
li°
) {

863 
iwl_fw_öi_c⁄f_£t_év
 *
c⁄fig_li°
 = (*)
node
->
év
.
d©a
;

864 
u32
 
cou¡
, 
addªss
, 
vÆue
;

865 
u32
 
Àn
 = (
	`À32_to_˝u
(
node
->
év
.
Àngth
Ë- (*
c⁄fig_li°
)) / 8;

866 
u32
 
ty≥
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
£t_ty≥
);

867 
u32
 
off£t
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_off£t
);

869 
ty≥
) {

870 
IWL_FW_INI_CONFIG_SET_TYPE_DEVICE_PERIPHERY_MAC
: {

871 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
fwπ
->
å™s
)) {

872 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: failedÅo getÇicáccess\n");

873 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: skipping MAC PERIPHERY config\n");

876 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: MAC PERIPHERY c⁄figÜí:Üí %u\n", 
Àn
);

877 
cou¡
 = 0; cou¡ < 
Àn
; count++) {

878 
addªss
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].address);

879 
vÆue
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].value);

880 
	`iwl_å™s_wrôe_¥ph
(
fwπ
->
å™s
, 
addªss
 + 
off£t
, 
vÆue
);

882 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
fwπ
->
å™s
);

885 
IWL_FW_INI_CONFIG_SET_TYPE_DEVICE_MEMORY
: {

886 
cou¡
 = 0; cou¡ < 
Àn
; count++) {

887 
addªss
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].address);

888 
vÆue
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].value);

889 
	`iwl_å™s_wrôe_mem32
(
fwπ
->
å™s
, 
addªss
 + 
off£t
, 
vÆue
);

890 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: DEV_MEM: count %u,ádd: %u val: %u\n",

891 
cou¡
, 
addªss
, 
vÆue
);

895 
IWL_FW_INI_CONFIG_SET_TYPE_CSR
: {

896 
cou¡
 = 0; cou¡ < 
Àn
; count++) {

897 
addªss
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].address);

898 
vÆue
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].value);

899 
	`iwl_wrôe32
(
fwπ
->
å™s
, 
addªss
 + 
off£t
, 
vÆue
);

900 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: CSR: count %u,ádd: %u val: %u\n",

901 
cou¡
, 
addªss
, 
vÆue
);

905 
IWL_FW_INI_CONFIG_SET_TYPE_DBGC_DRAM_ADDR
: {

906 
iwl_dbgc1_öfo
 
døm_öfo
 = {};

907 
iwl_døm_d©a
 *
‰ags
 = &
fwπ
->
å™s
->
dbg
.
fw_m⁄_öi
[1].frags[0];

908 
__À64
 
døm_ba£_addr
;

909 
__À32
 
døm_size
;

910 
u64
 
døm_addr
;

911 
u32
 
ªt
;

913 i‡(!
‰ags
)

916 
døm_ba£_addr
 = 
	`˝u_to_À64
(
‰ags
->
physiˇl
);

917 
døm_size
 = 
	`˝u_to_À32
(
‰ags
->
size
);

918 
døm_addr
 = 
	`À64_to_˝u
(
døm_ba£_addr
);

920 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: dram_base_addr 0x%016llx, dram_size 0x%x\n",

921 
døm_ba£_addr
, 
døm_size
);

922 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: config_list->addr_offset: %u\n",

923 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_off£t
));

924 
cou¡
 = 0; cou¡ < 
Àn
; count++) {

925 
addªss
 = 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[
cou¡
].address);

926 
døm_öfo
.
dbgc1_add_lsb
 =

927 
	`˝u_to_À32
((
døm_addr
 & 0x00000000FFFFFFFFULL) + 0x400);

928 
døm_öfo
.
dbgc1_add_msb
 =

929 
	`˝u_to_À32
((
døm_addr
 & 0xFFFFFFFF00000000ULL) >> 32);

930 
døm_öfo
.
dbgc1_size
 = 
	`˝u_to_À32
(
	`À32_to_˝u
(
døm_size
) - 0x400);

931 
ªt
 = 
	`iwl_å™s_wrôe_mem
(
fwπ
->
å™s
,

932 
addªss
 + 
off£t
, &
døm_öfo
, 4);

933 i‡(
ªt
) {

934 
	`IWL_ERR
(
fwπ
, "FailedÅo write dram_infoÅo HW_SMEM\n");

940 
IWL_FW_INI_CONFIG_SET_TYPE_PERIPH_SCRATCH_HWM
: {

941 
u32
 
debug_tokí_c⁄fig
 =

942 
	`À32_to_˝u
(
c⁄fig_li°
->
addr_vÆ
[0].
vÆue
);

944 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: Setting HWM debugÅoken config: %u\n",

945 
debug_tokí_c⁄fig
);

946 
fwπ
->
å™s
->
dbg
.
ucode_¥e£t
 = 
debug_tokí_c⁄fig
;

953 
	}
}

955 
	$iwl_dbg_év_≥riodic_åig_h™dÀr
(
timî_li°
 *
t
)

957 
iwl_dbg_év_timî_node
 *
timî_node
 =

958 
	`‰om_timî
(
timî_node
, 
t
, 
timî
);

959 
iwl_fwπ_dump_d©a
 
dump_d©a
 = {

960 .
åig
 = (*)
timî_node
->
év
->
d©a
,

962 
ªt
;

964 
ªt
 = 
	`iwl_fw_dbg_öi_cﬁÀ˘
(
timî_node
->
fwπ
, &
dump_d©a
, 
Ál£
);

965 i‡(!
ªt
 ||Ñë =-
EBUSY
) {

966 
u32
 
occur
 = 
	`À32_to_˝u
(
dump_d©a
.
åig
->
occuºí˚s
);

967 
u32
 
cﬁÀ˘_öãrvÆ
 = 
	`À32_to_˝u
(
dump_d©a
.
åig
->
d©a
[0]);

969 i‡(!
occur
)

972 
	`mod_timî
(
t
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
cﬁÀ˘_öãrvÆ
));

974 
	}
}

976 
	$iwl_dbg_év_£t_≥riodic_åigs
(
iwl_fw_ru¡ime
 *
fwπ
)

978 
iwl_dbg_év_node
 *
node
;

979 
li°_hód
 *
åig_li°
 =

980 &
fwπ
->
å™s
->
dbg
.
time_poöt
[
IWL_FW_INI_TIME_POINT_PERIODIC
].
a˘ive_åig_li°
;

982 
	`li°_f‹_óch_íåy
(
node
, 
åig_li°
, 
li°
) {

983 
iwl_fw_öi_åiggî_év
 *
åig
 = (*)
node
->
év
.
d©a
;

984 
iwl_dbg_év_timî_node
 *
timî_node
;

985 
u32
 
occur
 = 
	`À32_to_˝u
(
åig
->
occuºí˚s
), 
cﬁÀ˘_öãrvÆ
;

986 
u32
 
mö_öãrvÆ
 = 100;

988 i‡(!
occur
)

994 i‡(
	`À32_to_˝u
(
node
->
év
.
Àngth
) <

995 (*
åig
Ë+ (
__À32
)) {

996 
	`IWL_ERR
(
fwπ
,

1001 i‡(
	`À32_to_˝u
(
åig
->
d©a
[0]Ë< 
mö_öãrvÆ
) {

1002 
	`IWL_WARN
(
fwπ
,

1004 
	`À32_to_˝u
(
åig
->
d©a
[0]), 
mö_öãrvÆ
);

1005 
åig
->
d©a
[0] = 
	`˝u_to_À32
(
mö_öãrvÆ
);

1008 
cﬁÀ˘_öãrvÆ
 = 
	`À32_to_˝u
(
åig
->
d©a
[0]);

1010 
timî_node
 = 
	`kzÆloc
((*timî_node), 
GFP_KERNEL
);

1011 i‡(!
timî_node
) {

1012 
	`IWL_ERR
(
fwπ
,

1017 
timî_node
->
fwπ
 = fwrt;

1018 
timî_node
->
év
 = &
node
->tlv;

1019 
	`timî_£tup
(&
timî_node
->
timî
,

1020 
iwl_dbg_év_≥riodic_åig_h™dÀr
, 0);

1022 
	`li°_add_èû
(&
timî_node
->
li°
,

1023 &
fwπ
->
å™s
->
dbg
.
≥riodic_åig_li°
);

1025 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: EnablingÖeriodicÅrigger\n");

1027 
	`mod_timî
(&
timî_node
->
timî
,

1028 
jiffõs
 + 
	`m£cs_to_jiffõs
(
cﬁÀ˘_öãrvÆ
));

1030 
	}
}

1032 
boﬁ
 
	$is_åig_d©a_c⁄èöed
(c⁄° 
iwl_ucode_év
 *
√w
,

1033 c⁄° 
iwl_ucode_év
 *
ﬁd
)

1035 c⁄° 
iwl_fw_öi_åiggî_év
 *
√w_åig
 = (c⁄° *)
√w
->
d©a
;

1036 c⁄° 
iwl_fw_öi_åiggî_év
 *
ﬁd_åig
 = (c⁄° *)
ﬁd
->
d©a
;

1037 c⁄° 
__À32
 *
√w_d©a
 = 
√w_åig
->
d©a
, *
ﬁd_d©a
 = 
ﬁd_åig
->data;

1038 
u32
 
√w_dw‹ds_num
 = 
	`iwl_év_¨øy_Àn
(
√w
, 
√w_åig
, 
d©a
);

1039 
u32
 
ﬁd_dw‹ds_num
 = 
	`iwl_év_¨øy_Àn
(
ﬁd
, 
ﬁd_åig
, 
d©a
);

1040 
i
, 
j
;

1042 
i
 = 0; i < 
√w_dw‹ds_num
; i++) {

1043 
boﬁ
 
m©ch
 = 
Ál£
;

1045 
j
 = 0; j < 
ﬁd_dw‹ds_num
; j++) {

1046 i‡(
√w_d©a
[
i
] =
ﬁd_d©a
[
j
]) {

1047 
m©ch
 = 
åue
;

1051 i‡(!
m©ch
)

1052  
Ál£
;

1055  
åue
;

1056 
	}
}

1058 
	$iwl_dbg_év_ovîride_åig_node
(
iwl_fw_ru¡ime
 *
fwπ
,

1059 
iwl_ucode_év
 *
åig_év
,

1060 
iwl_dbg_év_node
 *
node
)

1062 
iwl_ucode_év
 *
node_év
 = &
node
->
év
;

1063 
iwl_fw_öi_åiggî_év
 *
node_åig
 = (*)
node_év
->
d©a
;

1064 
iwl_fw_öi_åiggî_év
 *
åig
 = (*)
åig_év
->
d©a
;

1065 
u32
 
pﬁicy
 = 
	`À32_to_˝u
(
åig
->
≠∂y_pﬁicy
);

1066 
u32
 
size
 = 
	`À32_to_˝u
(
åig_év
->
Àngth
);

1067 
u32
 
åig_d©a_Àn
 = 
size
 - (*
åig
);

1068 
u32
 
off£t
 = 0;

1070 i‡(!(
pﬁicy
 & 
IWL_FW_INI_APPLY_POLICY_OVERRIDE_DATA
)) {

1071 
u32
 
d©a_Àn
 = 
	`À32_to_˝u
(
node_év
->
Àngth
) -

1072 (*
node_åig
);

1074 
	`IWL_DEBUG_FW
(
fwπ
,

1076 
	`À32_to_˝u
(
åig
->
time_poöt
));

1078 
off£t
 +
d©a_Àn
;

1079 
size
 +
d©a_Àn
;

1081 
	`IWL_DEBUG_FW
(
fwπ
,

1083 
	`À32_to_˝u
(
åig
->
time_poöt
));

1086 i‡(
size
 !
	`À32_to_˝u
(
node_év
->
Àngth
)) {

1087 
li°_hód
 *
¥ev
 = 
node
->
li°
.prev;

1088 
iwl_dbg_év_node
 *
tmp
;

1090 
	`li°_dñ
(&
node
->
li°
);

1092 
tmp
 = 
	`kªÆloc
(
node
, (*nodeË+ 
size
, 
GFP_KERNEL
);

1093 i‡(!
tmp
) {

1094 
	`IWL_WARN
(
fwπ
,

1096 
	`À32_to_˝u
(
åig
->
time_poöt
));

1098 
	`li°_add
(&
node
->
li°
, 
¥ev
);

1100  -
ENOMEM
;

1103 
	`li°_add
(&
tmp
->
li°
, 
¥ev
);

1104 
node_év
 = &
tmp
->
év
;

1105 
node_åig
 = (*)
node_év
->
d©a
;

1108 
	`mem˝y
((
u8
 *)
node_åig
->
d©a
 + 
off£t
, 
åig
->d©a, 
åig_d©a_Àn
);

1109 
node_év
->
Àngth
 = 
	`˝u_to_À32
(
size
);

1111 i‡(
pﬁicy
 & 
IWL_FW_INI_APPLY_POLICY_OVERRIDE_CFG
) {

1112 
	`IWL_DEBUG_FW
(
fwπ
,

1114 
	`À32_to_˝u
(
åig
->
time_poöt
));

1117 
	`mem˝y
(
node_åig
, 
åig
, (
__À32
) * 11);

1120 i‡(
pﬁicy
 & 
IWL_FW_INI_APPLY_POLICY_OVERRIDE_REGIONS
) {

1121 
	`IWL_DEBUG_FW
(
fwπ
,

1123 
	`À32_to_˝u
(
åig
->
time_poöt
));

1125 
node_åig
->
ªgi⁄s_mask
 = 
åig
->regions_mask;

1127 
	`IWL_DEBUG_FW
(
fwπ
,

1129 
	`À32_to_˝u
(
åig
->
time_poöt
));

1131 
node_åig
->
ªgi⁄s_mask
 |
åig
->regions_mask;

1135 
	}
}

1138 
	$iwl_dbg_év_add_a˘ive_åiggî
(
iwl_fw_ru¡ime
 *
fwπ
,

1139 
li°_hód
 *
åig_li°
,

1140 
iwl_ucode_év
 *
åig_év
)

1142 
iwl_fw_öi_åiggî_év
 *
åig
 = (*)
åig_év
->
d©a
;

1143 
iwl_dbg_év_node
 *
node
, *
m©ch
 = 
NULL
;

1144 
u32
 
pﬁicy
 = 
	`À32_to_˝u
(
åig
->
≠∂y_pﬁicy
);

1146 
	`li°_f‹_óch_íåy
(
node
, 
åig_li°
, 
li°
) {

1147 i‡(!(
pﬁicy
 & 
IWL_FW_INI_APPLY_POLICY_MATCH_TIME_POINT
))

1150 i‡(!(
pﬁicy
 & 
IWL_FW_INI_APPLY_POLICY_MATCH_DATA
) ||

1151 
	`is_åig_d©a_c⁄èöed
(
åig_év
, &
node
->
év
)) {

1152 
m©ch
 = 
node
;

1157 i‡(!
m©ch
) {

1158 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: EnablingÅrigger (timeÖoint %u)\n",

1159 
	`À32_to_˝u
(
åig
->
time_poöt
));

1160 i‡(!
	`iwl_dbg_év_add
(
åig_év
, 
åig_li°
))

1161  -
ENOMEM
;

1165  
	`iwl_dbg_év_ovîride_åig_node
(
fwπ
, 
åig_év
, 
m©ch
);

1166 
	}
}

1169 
	$iwl_dbg_év_gí_a˘ive_åig_li°
(
iwl_fw_ru¡ime
 *
fwπ
,

1170 
iwl_dbg_év_time_poöt_d©a
 *
ç
)

1172 
iwl_dbg_év_node
 *
node
;

1173 
li°_hód
 *
åig_li°
 = &
ç
->trig_list;

1174 
li°_hód
 *
a˘ive_åig_li°
 = &
ç
->active_trig_list;

1176 
	`li°_f‹_óch_íåy
(
node
, 
åig_li°
, 
li°
) {

1177 
iwl_ucode_év
 *
év
 = &
node
->tlv;

1179 
	`iwl_dbg_év_add_a˘ive_åiggî
(
fwπ
, 
a˘ive_åig_li°
, 
év
);

1181 
	}
}

1183 
boﬁ
 
	$iwl_dbg_év_check_fw_pkt
(
iwl_fw_ru¡ime
 *
fwπ
,

1184 
iwl_fwπ_dump_d©a
 *
dump_d©a
,

1185 
iwl_dbg_év_ç_d©a
 *
ç_d©a
,

1186 
u32
 
åig_d©a
)

1188 
iwl_rx_∑ckë
 *
pkt
 = 
ç_d©a
->
fw_pkt
;

1189 
iwl_cmd_hódî
 *
w™ãd_hdr
 = (*)&
åig_d©a
;

1191 i‡(
pkt
 && (pkt->
hdr
.
cmd
 =
w™ãd_hdr
->cmd &&

1192 
pkt
->
hdr
.
group_id
 =
w™ãd_hdr
->group_id)) {

1193 
iwl_rx_∑ckë
 *
fw_pkt
 =

1194 
	`kmemdup
(
pkt
,

1195 (*
pkt
Ë+ 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(pkt),

1196 
GFP_ATOMIC
);

1198 i‡(!
fw_pkt
)

1199  
Ál£
;

1201 
dump_d©a
->
fw_pkt
 = fw_pkt;

1203  
åue
;

1206  
Ál£
;

1207 
	}
}

1210 
	$iwl_dbg_év_ç_åiggî
(
iwl_fw_ru¡ime
 *
fwπ
, 
boﬁ
 
sync
,

1211 
li°_hód
 *
a˘ive_åig_li°
,

1212 
iwl_dbg_év_ç_d©a
 *
ç_d©a
,

1213 
	$boﬁ
 (*
d©a_check
)(
iwl_fw_ru¡ime
 *
fwπ
,

1214 
iwl_fwπ_dump_d©a
 *
dump_d©a
,

1215 
iwl_dbg_év_ç_d©a
 *
ç_d©a
,

1216 
u32
 
åig_d©a
))

1218 
iwl_dbg_év_node
 *
node
;

1220 
	`li°_f‹_óch_íåy
(
node
, 
a˘ive_åig_li°
, 
li°
) {

1221 
iwl_fwπ_dump_d©a
 
dump_d©a
 = {

1222 .
åig
 = (*)
node
->
év
.
d©a
,

1224 
u32
 
num_d©a
 = 
	`iwl_év_¨øy_Àn
(&
node
->
év
, 
dump_d©a
.
åig
,

1225 
d©a
);

1226 
ªt
, 
i
;

1227 
u32
 
ç
 = 
	`À32_to_˝u
(
dump_d©a
.
åig
->
time_poöt
);

1230 i‡(!
num_d©a
) {

1231 
ªt
 = 
	`iwl_fw_dbg_öi_cﬁÀ˘
(
fwπ
, &
dump_d©a
, 
sync
);

1232 i‡(
ªt
)

1233  
ªt
;

1236 
i
 = 0; i < 
num_d©a
; i++) {

1237 i‡(!
d©a_check
 ||

1238 
	`d©a_check
(
fwπ
, &
dump_d©a
, 
ç_d©a
,

1239 
	`À32_to_˝u
(
dump_d©a
.
åig
->
d©a
[
i
]))) {

1240 
ªt
 = 
	`iwl_fw_dbg_öi_cﬁÀ˘
(
fwπ
, &
dump_d©a
, 
sync
);

1241 i‡(
ªt
)

1242  
ªt
;

1248 
fwπ
->
å™s
->
dbg
.
ª°¨t_ªquúed
 = 
Ál£
;

1249 
	`IWL_DEBUG_FW
(
fwπ
, "WRT:Åp %d,Ñeset_fw %d\n",

1250 
ç
, 
dump_d©a
.
åig
->
ª£t_fw
);

1251 
	`IWL_DEBUG_FW
(
fwπ
,

1253 
fwπ
->
å™s
->
dbg
.
ª°¨t_ªquúed
,

1254 
fwπ
->
å™s
->
dbg
.
œ°_ç_ª£tfw
);

1256 i‡(
fwπ
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 ==

1257 
IWL_DEVICE_FAMILY_9000
) {

1258 
fwπ
->
å™s
->
dbg
.
ª°¨t_ªquúed
 = 
åue
;

1259 } i‡(
ç
 =
IWL_FW_INI_TIME_POINT_FW_ASSERT
 &&

1260 
fwπ
->
å™s
->
dbg
.
œ°_ç_ª£tfw
 ==

1261 
IWL_FW_INI_RESET_FW_MODE_STOP_FW_ONLY
) {

1262 
fwπ
->
å™s
->
dbg
.
ª°¨t_ªquúed
 = 
Ál£
;

1263 
fwπ
->
å™s
->
dbg
.
œ°_ç_ª£tfw
 = 0xFF;

1264 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: FW_ASSERT dueÅoÑeset_fw_mode-noÑestart\n");

1265 } i‡(
	`À32_to_˝u
(
dump_d©a
.
åig
->
ª£t_fw
) ==

1266 
IWL_FW_INI_RESET_FW_MODE_STOP_AND_RELOAD_FW
) {

1267 
	`IWL_DEBUG_FW
(
fwπ
, "WRT: stopándÑeload firmware\n");

1268 
fwπ
->
å™s
->
dbg
.
ª°¨t_ªquúed
 = 
åue
;

1269 } i‡(
	`À32_to_˝u
(
dump_d©a
.
åig
->
ª£t_fw
) ==

1270 
IWL_FW_INI_RESET_FW_MODE_STOP_FW_ONLY
) {

1271 
	`IWL_DEBUG_FW
(
fwπ
,

1273 
fwπ
->
å™s
->
dbg
.
ª°¨t_ªquúed
 = 
Ál£
;

1274 
fwπ
->
å™s
->
dbg
.
œ°_ç_ª£tfw
 =

1275 
	`À32_to_˝u
(
dump_d©a
.
åig
->
ª£t_fw
);

1276 } i‡(
	`À32_to_˝u
(
dump_d©a
.
åig
->
ª£t_fw
) ==

1277 
IWL_FW_INI_RESET_FW_MODE_NOTHING
) {

1278 
	`IWL_DEBUG_FW
(
fwπ
,

1281 
	`IWL_ERR
(
fwπ
, "WRT: wrongÑesetfw %d\n",

1282 
	`À32_to_˝u
(
dump_d©a
.
åig
->
ª£t_fw
));

1286 
	}
}

1288 
	$iwl_dbg_év_öô_cfg
(
iwl_fw_ru¡ime
 *
fwπ
)

1290 
iwl_fw_öi_buf„r_loˇti⁄
 *
öi_de°
 = &
fwπ
->
å™s
->
dbg
.ini_dest;

1291 
ªt
, 
i
;

1292 
u32
 
Áûed_Æloc
 = 0;

1294 i‡(*
öi_de°
 =
IWL_FW_INI_LOCATION_INVALID
) {

1295 
	`IWL_DEBUG_FW
(
fwπ
,

1297 
fwπ
->
å™s
->
dbg
.
domaös_bôm≠
);

1299 
i
 = 0; i < 
	`ARRAY_SIZE
(
fwπ
->
å™s
->
dbg
.
time_poöt
); i++) {

1300 
iwl_dbg_év_time_poöt_d©a
 *
ç
 =

1301 &
fwπ
->
å™s
->
dbg
.
time_poöt
[
i
];

1303 
	`iwl_dbg_év_gí_a˘ive_åig_li°
(
fwπ
, 
ç
);

1305 } i‡(*
öi_de°
 !
IWL_FW_INI_LOCATION_DRAM_PATH
) {

1313 *
öi_de°
 = 
IWL_FW_INI_LOCATION_INVALID
;

1314 
i
 = 0; i < 
IWL_FW_INI_ALLOCATION_NUM
; i++) {

1315 
iwl_fw_öi_Æloˇti⁄_év
 *
fw_m⁄_cfg
 =

1316 &
fwπ
->
å™s
->
dbg
.
fw_m⁄_cfg
[
i
];

1317 
u32
 
de°
 = 
	`À32_to_˝u
(
fw_m⁄_cfg
->
buf_loˇti⁄
);

1319 i‡(
de°
 =
IWL_FW_INI_LOCATION_INVALID
) {

1320 
Áûed_Æloc
 |
	`BIT
(
i
);

1324 i‡(*
öi_de°
 =
IWL_FW_INI_LOCATION_INVALID
)

1325 *
öi_de°
 = 
de°
;

1327 i‡(
de°
 !*
öi_de°
)

1330 
ªt
 = 
	`iwl_dbg_év_Æloc_‰agmíts
(
fwπ
, 
i
);

1332 i‡(
ªt
) {

1333 
	`IWL_WARN
(
fwπ
,

1335 
i
, 
ªt
);

1336 
Áûed_Æloc
 |
	`BIT
(
i
);

1340 i‡(!
Áûed_Æloc
)

1343 
i
 = 0; i < 
	`ARRAY_SIZE
(
fwπ
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
Ë&& 
Áûed_Æloc
; i++) {

1344 
iwl_fw_öi_ªgi⁄_év
 *
ªg
;

1345 
iwl_ucode_év
 **
a˘ive_ªg
 =

1346 &
fwπ
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
[
i
];

1347 
u32
 
ªg_ty≥
;

1349 i‡(!*
a˘ive_ªg
) {

1350 
fwπ
->
å™s
->
dbg
.
unsuµ‹ãd_ªgi⁄_msk
 |
	`BIT
(
i
);

1354 
ªg
 = (*)(*
a˘ive_ªg
)->
d©a
;

1355 
ªg_ty≥
 = 
ªg
->
ty≥
;

1357 i‡(
ªg_ty≥
 !
IWL_FW_INI_REGION_DRAM_BUFFER
 ||

1358 !(
	`BIT
(
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
)Ë& 
Áûed_Æloc
))

1361 
	`IWL_DEBUG_FW
(
fwπ
,

1363 
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
), 
i
);

1365 
Áûed_Æloc
 &~
	`BIT
(
	`À32_to_˝u
(
ªg
->
døm_Æloc_id
));

1366 
fwπ
->
å™s
->
dbg
.
unsuµ‹ãd_ªgi⁄_msk
 |
	`BIT
(
i
);

1368 
	`k‰ì
(*
a˘ive_ªg
);

1369 *
a˘ive_ªg
 = 
NULL
;

1371 
	}
}

1373 
	$_iwl_dbg_év_time_poöt
(
iwl_fw_ru¡ime
 *
fwπ
,

1374 
iwl_fw_öi_time_poöt
 
ç_id
,

1375 
iwl_dbg_év_ç_d©a
 *
ç_d©a
,

1376 
boﬁ
 
sync
)

1378 
li°_hód
 *
hcmd_li°
, *
åig_li°
, *
c⁄f_li°
;

1380 i‡(!
	`iwl_å™s_dbg_öi_vÆid
(
fwπ
->
å™s
) ||

1381 
ç_id
 =
IWL_FW_INI_TIME_POINT_INVALID
 ||

1382 
ç_id
 >
IWL_FW_INI_TIME_POINT_NUM
)

1385 
hcmd_li°
 = &
fwπ
->
å™s
->
dbg
.
time_poöt
[
ç_id
].hcmd_list;

1386 
åig_li°
 = &
fwπ
->
å™s
->
dbg
.
time_poöt
[
ç_id
].
a˘ive_åig_li°
;

1387 
c⁄f_li°
 = &
fwπ
->
å™s
->
dbg
.
time_poöt
[
ç_id
].
c⁄fig_li°
;

1389 
ç_id
) {

1390 
IWL_FW_INI_TIME_POINT_EARLY
:

1391 
	`iwl_dbg_év_öô_cfg
(
fwπ
);

1392 
	`iwl_dbg_év_≠∂y_c⁄fig
(
fwπ
, 
c⁄f_li°
);

1393 
	`iwl_dbg_év_upd©e_døms
(
fwπ
);

1394 
	`iwl_dbg_év_ç_åiggî
(
fwπ
, 
sync
, 
åig_li°
, 
ç_d©a
, 
NULL
);

1396 
IWL_FW_INI_TIME_POINT_AFTER_ALIVE
:

1397 
	`iwl_dbg_év_≠∂y_buf„rs
(
fwπ
);

1398 
	`iwl_dbg_év_£nd_hcmds
(
fwπ
, 
hcmd_li°
);

1399 
	`iwl_dbg_év_≠∂y_c⁄fig
(
fwπ
, 
c⁄f_li°
);

1400 
	`iwl_dbg_év_ç_åiggî
(
fwπ
, 
sync
, 
åig_li°
, 
ç_d©a
, 
NULL
);

1402 
IWL_FW_INI_TIME_POINT_PERIODIC
:

1403 
	`iwl_dbg_év_£t_≥riodic_åigs
(
fwπ
);

1404 
	`iwl_dbg_év_£nd_hcmds
(
fwπ
, 
hcmd_li°
);

1406 
IWL_FW_INI_TIME_POINT_FW_RSP_OR_NOTIF
:

1407 
IWL_FW_INI_TIME_POINT_MISSED_BEACONS
:

1408 
IWL_FW_INI_TIME_POINT_FW_DHC_NOTIFICATION
:

1409 
	`iwl_dbg_év_£nd_hcmds
(
fwπ
, 
hcmd_li°
);

1410 
	`iwl_dbg_év_≠∂y_c⁄fig
(
fwπ
, 
c⁄f_li°
);

1411 
	`iwl_dbg_év_ç_åiggî
(
fwπ
, 
sync
, 
åig_li°
, 
ç_d©a
,

1412 
iwl_dbg_év_check_fw_pkt
);

1415 
	`iwl_dbg_év_£nd_hcmds
(
fwπ
, 
hcmd_li°
);

1416 
	`iwl_dbg_év_≠∂y_c⁄fig
(
fwπ
, 
c⁄f_li°
);

1417 
	`iwl_dbg_év_ç_åiggî
(
fwπ
, 
sync
, 
åig_li°
, 
ç_d©a
, 
NULL
);

1420 
	}
}

1421 
IWL_EXPORT_SYMBOL
(
_iwl_dbg_év_time_poöt
);

	@iwl-dbg-tlv.h

5 #i‚de‡
__iwl_dbg_év_h__


6 
	#__iwl_dbg_év_h__


	)

8 
	~<löux/devi˚.h
>

9 
	~<löux/ty≥s.h
>

10 
	~<fw/fûe.h
>

11 
	~<fw/≠i/dbg-év.h
>

13 
	#IWL_DBG_TLV_MAX_PRESET
 15

	)

14 
	#ENABLE_INI
 (
IWL_DBG_TLV_MAX_PRESET
 + 1)

	)

21 
	siwl_dbg_év_node
 {

22 
li°_hód
 
	mli°
;

23 
iwl_ucode_év
 
	mév
;

30 
	uiwl_dbg_év_ç_d©a
 {

31 
iwl_rx_∑ckë
 *
	mfw_pkt
;

41 
	siwl_dbg_év_time_poöt_d©a
 {

42 
li°_hód
 
	måig_li°
;

43 
li°_hód
 
	ma˘ive_åig_li°
;

44 
li°_hód
 
	mhcmd_li°
;

45 
li°_hód
 
	mc⁄fig_li°
;

48 
	giwl_å™s
;

49 
	giwl_fw_ru¡ime
;

51 
iwl_dbg_év_lﬂd_bö
(
devi˚
 *
dev
, 
iwl_å™s
 *
å™s
);

52 
iwl_dbg_év_‰ì
(
iwl_å™s
 *
å™s
);

53 
iwl_dbg_év_Æloc
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_ucode_év
 *
év
,

54 
boﬁ
 
ext
);

55 
iwl_dbg_év_öô
(
iwl_å™s
 *
å™s
);

56 
_iwl_dbg_év_time_poöt
(
iwl_fw_ru¡ime
 *
fwπ
,

57 
iwl_fw_öi_time_poöt
 
ç_id
,

58 
iwl_dbg_év_ç_d©a
 *
ç_d©a
,

59 
boﬁ
 
sync
);

60 
iwl_dbg_év_öô_cfg
(
iwl_fw_ru¡ime
 *
fwπ
);

62 
ölöe
 
	$iwl_dbg_év_time_poöt
(
iwl_fw_ru¡ime
 *
fwπ
,

63 
iwl_fw_öi_time_poöt
 
ç_id
,

64 
iwl_dbg_év_ç_d©a
 *
ç_d©a
)

66 
	`_iwl_dbg_év_time_poöt
(
fwπ
, 
ç_id
, 
ç_d©a
, 
Ál£
);

67 
	}
}

69 
ölöe
 
	$iwl_dbg_év_time_poöt_sync
(
iwl_fw_ru¡ime
 *
fwπ
,

70 
iwl_fw_öi_time_poöt
 
ç_id
,

71 
iwl_dbg_év_ç_d©a
 *
ç_d©a
)

73 
	`_iwl_dbg_év_time_poöt
(
fwπ
, 
ç_id
, 
ç_d©a
, 
åue
);

74 
	}
}

76 
iwl_dbg_év_dñ_timîs
(
iwl_å™s
 *
å™s
);

	@iwl-debug.c

5 
	~<löux/devi˚.h
>

6 
	~<löux/öãºu±.h
>

7 
	~<löux/exp‹t.h
>

8 
	~"iwl-drv.h
"

9 
	~"iwl-debug.h
"

10 
	~"iwl-devåa˚.h
"

12 
	#__iwl_‚
(
‚
) \

13 
__iwl_
 ##
	`‚
(
devi˚
 *
dev
, c⁄° *
fmt
, ...) \

15 
va_f‹m©
 
vaf
 = { \

16 .
fmt
 = fmt, \

18 
va_li°
 
¨gs
; \

20 
	`va_°¨t
(
¨gs
, 
fmt
); \

21 
vaf
.
va
 = &
¨gs
; \

22 
dev_
 ##
	`‚
(
dev
, "%pV", &
vaf
); \

23 
åa˚_iwlwifi_
 ##
	`‚
(&
vaf
); \

24 
	`va_íd
(
¨gs
); \

25 }

	)

27 
	$__iwl_‚
(
w¨n
)

28 
	`IWL_EXPORT_SYMBOL
(
__iwl_w¨n
);

29 
	$__iwl_‚
(
öfo
)

30 
	`IWL_EXPORT_SYMBOL
(
__iwl_öfo
);

31 
	$__iwl_‚
(
¸ô
)

32 
	`IWL_EXPORT_SYMBOL
(
__iwl_¸ô
);

34 
	$__iwl_îr
(
devi˚
 *
dev
, 
iwl_îr_mode
 
mode
, c⁄° *
fmt
, ...)

36 
va_f‹m©
 
vaf
 = {

37 .
fmt
 = fmt,

39 
va_li°
 
¨gs
, 
¨gs2
;

41 
	`va_°¨t
(
¨gs
, 
fmt
);

42 
mode
) {

43 
IWL_ERR_MODE_RATELIMIT
:

44 i‡(
	`√t_øãlimô
())

46 
ÁŒthrough
;

47 
IWL_ERR_MODE_REGULAR
:

48 
IWL_ERR_MODE_RFKILL
:

49 
	`va_c›y
(
¨gs2
, 
¨gs
);

50 
vaf
.
va
 = &
¨gs2
;

51 i‡(
mode
 =
IWL_ERR_MODE_RFKILL
)

52 
	`dev_îr
(
dev
, "(RFKILLË%pV", &
vaf
);

54 
	`dev_îr
(
dev
, "%pV", &
vaf
);

55 
	`va_íd
(
¨gs2
);

60 
vaf
.
va
 = &
¨gs
;

61 
	`åa˚_iwlwifi_îr
(&
vaf
);

62 
	`va_íd
(
¨gs
);

63 
	}
}

64 
IWL_EXPORT_SYMBOL
(
__iwl_îr
);

66 #i‡
deföed
(
CONFIG_IWLWIFI_DEBUG
Ë|| deföed(
CONFIG_IWLWIFI_DEVICE_TRACING
)

67 
	$__iwl_dbg
(
devi˚
 *
dev
,

68 
u32
 
Àvñ
, 
boﬁ
 
limô
, c⁄° *
fun˘i⁄
,

69 c⁄° *
fmt
, ...)

71 
va_f‹m©
 
vaf
 = {

72 .
fmt
 = fmt,

74 
va_li°
 
¨gs
;

76 
	`va_°¨t
(
¨gs
, 
fmt
);

77 
vaf
.
va
 = &
¨gs
;

78 #ifde‡
CONFIG_IWLWIFI_DEBUG


79 i‡(
	`iwl_have_debug_Àvñ
(
Àvñ
) &&

80 (!
limô
 || 
	`√t_øãlimô
()))

81 
	`dev_¥ötk
(
KERN_DEBUG
, 
dev
, "%†%pV", 
fun˘i⁄
, &
vaf
);

83 
	`åa˚_iwlwifi_dbg
(
Àvñ
, 
fun˘i⁄
, &
vaf
);

84 
	`va_íd
(
¨gs
);

85 
	}
}

86 
IWL_EXPORT_SYMBOL
(
__iwl_dbg
);

	@iwl-debug.h

10 #i‚de‡
__iwl_debug_h__


11 
	#__iwl_debug_h__


	)

13 
	~"iwl-mod∑øms.h
"

16 
ölöe
 
boﬁ
 
	$iwl_have_debug_Àvñ
(
u32
 
Àvñ
)

18 #ifde‡
CONFIG_IWLWIFI_DEBUG


19  
iwlwifi_mod_∑øms
.
debug_Àvñ
 & 
Àvñ
;

21  
Ál£
;

23 
	}
}

25 
	eiwl_îr_mode
 {

26 
	mIWL_ERR_MODE_REGULAR
,

27 
	mIWL_ERR_MODE_RFKILL
,

28 
	mIWL_ERR_MODE_TRACE_ONLY
,

29 
	mIWL_ERR_MODE_RATELIMIT
,

32 
	gdevi˚
;

33 
	$__iwl_îr
(
devi˚
 *
dev
, 
iwl_îr_mode
 
mode
, c⁄° *
fmt
, ...)

34 
	`__¥ötf
(3, 4);

35 
	$__iwl_w¨n
(
devi˚
 *
dev
, c⁄° *
fmt
, ...Ë
	`__¥ötf
(2, 3);

36 
	$__iwl_öfo
(
devi˚
 *
dev
, c⁄° *
fmt
, ...Ë
	`__¥ötf
(2, 3);

37 
	$__iwl_¸ô
(
devi˚
 *
dev
, c⁄° *
fmt
, ...Ë
	`__¥ötf
(2, 3);

40 
	#CHECK_FOR_NEWLINE
(
f
Ë
	`BUILD_BUG_ON
(f[(fË- 2] !'\n')

	)

43 
	#__IWL_ERR_DEV
(
d
, 
mode
, 
f
, 
a
...) \

45 
	`CHECK_FOR_NEWLINE
(
f
); \

46 
	`__iwl_îr
((
d
), 
mode
, 
f
, ## 
a
); \

47 
	}
} 0)

	)

48 
	#IWL_ERR_DEV
(
d
, 
f
, 
a
...) \

49 
	`__IWL_ERR_DEV
(
d
, 
IWL_ERR_MODE_REGULAR
, 
f
, ## 
a
)

	)

50 
	#IWL_ERR
(
m
, 
f
, 
a
...) \

51 
	`IWL_ERR_DEV
((
m
)->
dev
, 
f
, ## 
a
)

	)

52 
	#IWL_ERR_LIMIT
(
m
, 
f
, 
a
...) \

53 
	`__IWL_ERR_DEV
((
m
)->
dev
, 
IWL_ERR_MODE_RATELIMIT
, 
f
, ## 
a
)

	)

54 
	#IWL_WARN
(
m
, 
f
, 
a
...) \

56 
	`CHECK_FOR_NEWLINE
(
f
); \

57 
	`__iwl_w¨n
((
m
)->
dev
, 
f
, ## 
a
); \

58 } 0)

	)

59 
	#IWL_INFO
(
m
, 
f
, 
a
...) \

61 
	`CHECK_FOR_NEWLINE
(
f
); \

62 
	`__iwl_öfo
((
m
)->
dev
, 
f
, ## 
a
); \

63 } 0)

	)

64 
	#IWL_CRIT
(
m
, 
f
, 
a
...) \

66 
	`CHECK_FOR_NEWLINE
(
f
); \

67 
	`__iwl_¸ô
((
m
)->
dev
, 
f
, ## 
a
); \

68 } 0)

	)

70 #i‡
deföed
(
CONFIG_IWLWIFI_DEBUG
Ë|| deföed(
CONFIG_IWLWIFI_DEVICE_TRACING
)

71 
	$__iwl_dbg
(
devi˚
 *
dev
,

72 
u32
 
Àvñ
, 
boﬁ
 
limô
, c⁄° *
fun˘i⁄
,

73 c⁄° *
fmt
, ...Ë
	`__¥ötf
(5, 6);

75 
	$__¥ötf
(5, 6Ë
ölöe
 

76 
	$__iwl_dbg
(
devi˚
 *
dev
,

77 
u32
 
Àvñ
, 
boﬁ
 
limô
, c⁄° *
fun˘i⁄
,

78 c⁄° *
fmt
, ...)

79 {
	}
}

82 
	#iwl_¥öt_hex_îr‹
(
m
, 
p
, 
Àn
) \

84 
	`¥öt_hex_dump
(
KERN_ERR
, "iwl data: ", \

85 
DUMP_PREFIX_OFFSET
, 16, 1, 
p
, 
Àn
, 1); \

86 } 0)

	)

88 
	#__IWL_DEBUG_DEV
(
dev
, 
Àvñ
, 
limô
, 
fmt
, 
¨gs
...) \

90 
	`CHECK_FOR_NEWLINE
(
fmt
); \

91 
	`__iwl_dbg
(
dev
, 
Àvñ
, 
limô
, 
__func__
, 
fmt
, ##
¨gs
); \

92 } 0)

	)

93 
	#IWL_DEBUG
(
m
, 
Àvñ
, 
fmt
, 
¨gs
...) \

94 
	`__IWL_DEBUG_DEV
((
m
)->
dev
, 
Àvñ
, 
Ál£
, 
fmt
, ##
¨gs
)

	)

95 
	#IWL_DEBUG_DEV
(
dev
, 
Àvñ
, 
fmt
, 
¨gs
...) \

96 
	`__IWL_DEBUG_DEV
(
dev
, 
Àvñ
, 
Ál£
, 
fmt
, ##
¨gs
)

	)

97 
	#IWL_DEBUG_LIMIT
(
m
, 
Àvñ
, 
fmt
, 
¨gs
...) \

98 
	`__IWL_DEBUG_DEV
((
m
)->
dev
, 
Àvñ
, 
åue
, 
fmt
, ##
¨gs
)

	)

100 #ifde‡
CONFIG_IWLWIFI_DEBUG


101 
	#iwl_¥öt_hex_dump
(
m
, 
Àvñ
, 
p
, 
Àn
) \

103 i‡(
	`iwl_have_debug_Àvñ
(
Àvñ
)) \

104 
	`¥öt_hex_dump
(
KERN_DEBUG
, "iwl data: ", \

105 
DUMP_PREFIX_OFFSET
, 16, 1, 
p
, 
Àn
, 1); \

106 } 0)

	)

108 
	#iwl_¥öt_hex_dump
(
m
, 
Àvñ
, 
p
, 
Àn
)

	)

136 
	#IWL_DL_INFO
 0x00000001

	)

137 
	#IWL_DL_MAC80211
 0x00000002

	)

138 
	#IWL_DL_HCMD
 0x00000004

	)

139 
	#IWL_DL_TDLS
 0x00000008

	)

141 
	#IWL_DL_QUOTA
 0x00000010

	)

142 
	#IWL_DL_TE
 0x00000020

	)

143 
	#IWL_DL_EEPROM
 0x00000040

	)

144 
	#IWL_DL_RADIO
 0x00000080

	)

146 
	#IWL_DL_POWER
 0x00000100

	)

147 
	#IWL_DL_TEMP
 0x00000200

	)

148 
	#IWL_DL_WOWLAN
 0x00000400

	)

149 
	#IWL_DL_SCAN
 0x00000800

	)

151 
	#IWL_DL_ASSOC
 0x00001000

	)

152 
	#IWL_DL_DROP
 0x00002000

	)

153 
	#IWL_DL_LAR
 0x00004000

	)

154 
	#IWL_DL_COEX
 0x00008000

	)

156 
	#IWL_DL_FW
 0x00010000

	)

157 
	#IWL_DL_RF_KILL
 0x00020000

	)

158 
	#IWL_DL_TPT
 0x00040000

	)

160 
	#IWL_DL_RATE
 0x00100000

	)

161 
	#IWL_DL_CALIB
 0x00200000

	)

162 
	#IWL_DL_WEP
 0x00400000

	)

163 
	#IWL_DL_TX
 0x00800000

	)

165 
	#IWL_DL_RX
 0x01000000

	)

166 
	#IWL_DL_ISR
 0x02000000

	)

167 
	#IWL_DL_HT
 0x04000000

	)

168 
	#IWL_DL_EXTERNAL
 0x08000000

	)

170 
	#IWL_DL_11H
 0x10000000

	)

171 
	#IWL_DL_STATS
 0x20000000

	)

172 
	#IWL_DL_TX_REPLY
 0x40000000

	)

173 
	#IWL_DL_TX_QUEUES
 0x80000000

	)

175 
	#IWL_DEBUG_INFO
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_INFO
, f, ##á)

	)

176 
	#IWL_DEBUG_TDLS
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TDLS
, f, ##á)

	)

177 
	#IWL_DEBUG_MAC80211
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_MAC80211
, f, ##á)

	)

178 
	#IWL_DEBUG_EXTERNAL
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_EXTERNAL
, f, ##á)

	)

179 
	#IWL_DEBUG_TEMP
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TEMP
, f, ##á)

	)

180 
	#IWL_DEBUG_SCAN
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_SCAN
, f, ##á)

	)

181 
	#IWL_DEBUG_RX
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_RX
, f, ##á)

	)

182 
	#IWL_DEBUG_TX
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TX
, f, ##á)

	)

183 
	#IWL_DEBUG_ISR
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_ISR
, f, ##á)

	)

184 
	#IWL_DEBUG_WEP
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_WEP
, f, ##á)

	)

185 
	#IWL_DEBUG_HC
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_HCMD
, f, ##á)

	)

186 
	#IWL_DEBUG_QUOTA
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_QUOTA
, f, ##á)

	)

187 
	#IWL_DEBUG_TE
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TE
, f, ##á)

	)

188 
	#IWL_DEBUG_EEPROM
(
d
, 
f
, 
a
...Ë
	`IWL_DEBUG_DEV
(d, 
IWL_DL_EEPROM
, f, ##á)

	)

189 
	#IWL_DEBUG_CALIB
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_CALIB
, f, ##á)

	)

190 
	#IWL_DEBUG_FW
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_FW
, f, ##á)

	)

191 
	#IWL_DEBUG_RF_KILL
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_RF_KILL
, f, ##á)

	)

192 
	#IWL_DEBUG_DROP
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_DROP
, f, ##á)

	)

193 
	#IWL_DEBUG_DROP_LIMIT
(
p
, 
f
, 
a
...) \

194 
	`IWL_DEBUG_LIMIT
(
p
, 
IWL_DL_DROP
, 
f
, ## 
a
)

	)

195 
	#IWL_DEBUG_COEX
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_COEX
, f, ##á)

	)

196 
	#IWL_DEBUG_RATE
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_RATE
, f, ##á)

	)

197 
	#IWL_DEBUG_RATE_LIMIT
(
p
, 
f
, 
a
...) \

198 
	`IWL_DEBUG_LIMIT
(
p
, 
IWL_DL_RATE
, 
f
, ## 
a
)

	)

199 
	#IWL_DEBUG_ASSOC
(
p
, 
f
, 
a
...) \

200 
	`IWL_DEBUG
(
p
, 
IWL_DL_ASSOC
 | 
IWL_DL_INFO
, 
f
, ## 
a
)

	)

201 
	#IWL_DEBUG_ASSOC_LIMIT
(
p
, 
f
, 
a
...) \

202 
	`IWL_DEBUG_LIMIT
(
p
, 
IWL_DL_ASSOC
 | 
IWL_DL_INFO
, 
f
, ## 
a
)

	)

203 
	#IWL_DEBUG_HT
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_HT
, f, ##á)

	)

204 
	#IWL_DEBUG_STATS
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_STATS
, f, ##á)

	)

205 
	#IWL_DEBUG_STATS_LIMIT
(
p
, 
f
, 
a
...) \

206 
	`IWL_DEBUG_LIMIT
(
p
, 
IWL_DL_STATS
, 
f
, ## 
a
)

	)

207 
	#IWL_DEBUG_TX_REPLY
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TX_REPLY
, f, ##á)

	)

208 
	#IWL_DEBUG_TX_QUEUES
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TX_QUEUES
, f, ##á)

	)

209 
	#IWL_DEBUG_RADIO
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_RADIO
, f, ##á)

	)

210 
	#IWL_DEBUG_DEV_RADIO
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG_DEV
’, 
IWL_DL_RADIO
, f, ##á)

	)

211 
	#IWL_DEBUG_POWER
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_POWER
, f, ##á)

	)

212 
	#IWL_DEBUG_11H
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_11H
, f, ##á)

	)

213 
	#IWL_DEBUG_TPT
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_TPT
, f, ##á)

	)

214 
	#IWL_DEBUG_WOWLAN
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_WOWLAN
, f, ##á)

	)

215 
	#IWL_DEBUG_LAR
(
p
, 
f
, 
a
...Ë
	`IWL_DEBUG
’, 
IWL_DL_LAR
, f, ##á)

	)

216 
	#IWL_DEBUG_FW_INFO
(
p
, 
f
, 
a
...) \

217 
	`IWL_DEBUG
(
p
, 
IWL_DL_INFO
 | 
IWL_DL_FW
, 
f
, ## 
a
)

	)

	@iwl-devtrace-data.h

9 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_DATA
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

10 
	#__IWLWIFI_DEVICE_TRACE_DATA


	)

12 
	~<löux/åa˚poöt.h
>

14 #unde‡
TRACE_SYSTEM


15 
	#TRACE_SYSTEM
 
iwlwifi_d©a


	)

17 
TRACE_EVENT
(
iwlwifi_dev_tx_tb
,

18 
TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
sk_buff
 *
skb
,

19 
u8
 *
d©a_§c
, 
dma_addr_t
 
phys
, 
size_t
 
d©a_Àn
),

20 
TP_ARGS
(
dev
, 
skb
, 
d©a_§c
, 
phys
, 
d©a_Àn
),

21 
TP_STRUCT__íåy
(

22 
DEV_ENTRY


23 
	$__fõld
(
u64
, 
phys
)

25 
	`__dy«mic_¨øy
(
u8
, 
d©a
,

26 
	`iwl_åa˚_d©a
(
skb
Ë? 
d©a_Àn
 : 0)

28 
	`TP_Á°_assign
(

29 
DEV_ASSIGN
;

30 
__íåy
->
phys
 =Öhys;

31 i‡(
	$iwl_åa˚_d©a
(
skb
))

32 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
d©a
), 
d©a_§c
, 
d©a_Àn
);

34 
	`TP_¥ötk
("[%s] TX fømêd©a", 
	`__gë_°r
(
dev
))

37 
	`TRACE_EVENT
(
iwlwifi_dev_rx_d©a
,

38 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
,

39 *
rxbuf
, 
size_t
 
Àn
, size_à
°¨t
),

40 
	`TP_ARGS
(
dev
, 
rxbuf
, 
Àn
, 
°¨t
),

41 
	`TP_STRUCT__íåy
(

42 
DEV_ENTRY


43 
	`__dy«mic_¨øy
(
u8
, 
d©a
, 
Àn
 - 
°¨t
)

45 
	`TP_Á°_assign
(

46 
DEV_ASSIGN
;

47 i‡(
°¨t
 < 
Àn
)

48 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
d©a
),

49 ((
u8
 *)
rxbuf
Ë+ 
°¨t
, 
Àn
 - start);

51 
	`TP_¥ötk
("[%s] RX fømêd©a", 
	`__gë_°r
(
dev
))

55 #unde‡
TRACE_INCLUDE_PATH


56 
	#TRACE_INCLUDE_PATH
 .

	)

57 #unde‡
TRACE_INCLUDE_FILE


58 
	#TRACE_INCLUDE_FILE
 
iwl
-
devåa˚
-
d©a


	)

59 
	~<åa˚/deföe_åa˚.h
>

	@iwl-devtrace-io.h

8 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_IO
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

9 
	#__IWLWIFI_DEVICE_TRACE_IO


	)

11 
	~<löux/åa˚poöt.h
>

12 
	~<löux/pci.h
>

14 #unde‡
TRACE_SYSTEM


15 
	#TRACE_SYSTEM
 
iwlwifi_io


	)

17 
TRACE_EVENT
(
iwlwifi_dev_i‹ód32
,

18 
TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
offs
, u32 
vÆ
),

19 
TP_ARGS
(
dev
, 
offs
, 
vÆ
),

20 
TP_STRUCT__íåy
(

21 
DEV_ENTRY


22 
	$__fõld
(
u32
, 
offs
)

23 
	`__fõld
(
u32
, 
vÆ
)

25 
	`TP_Á°_assign
(

26 
DEV_ASSIGN
;

27 
__íåy
->
offs
 = offs;

28 
__íåy
->
vÆ
 = val;

30 
	`TP_¥ötk
("[%s]Ñead io[%#x] = %#x",

31 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

34 
	`TRACE_EVENT
(
iwlwifi_dev_iowrôe8
,

35 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
offs
, 
u8
 
vÆ
),

36 
	`TP_ARGS
(
dev
, 
offs
, 
vÆ
),

37 
	`TP_STRUCT__íåy
(

38 
DEV_ENTRY


39 
	$__fõld
(
u32
, 
offs
)

40 
	`__fõld
(
u8
, 
vÆ
)

42 
	`TP_Á°_assign
(

43 
DEV_ASSIGN
;

44 
__íåy
->
offs
 = offs;

45 
__íåy
->
vÆ
 = val;

47 
	`TP_¥ötk
("[%s] write io[%#x] = %#x)",

48 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

51 
	`TRACE_EVENT
(
iwlwifi_dev_iowrôe32
,

52 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
offs
, u32 
vÆ
),

53 
	`TP_ARGS
(
dev
, 
offs
, 
vÆ
),

54 
	`TP_STRUCT__íåy
(

55 
DEV_ENTRY


56 
	$__fõld
(
u32
, 
offs
)

57 
	`__fõld
(
u32
, 
vÆ
)

59 
	`TP_Á°_assign
(

60 
DEV_ASSIGN
;

61 
__íåy
->
offs
 = offs;

62 
__íåy
->
vÆ
 = val;

64 
	`TP_¥ötk
("[%s] write io[%#x] = %#x)",

65 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

68 
	`TRACE_EVENT
(
iwlwifi_dev_iowrôe64
,

69 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u64
 
offs
, u64 
vÆ
),

70 
	`TP_ARGS
(
dev
, 
offs
, 
vÆ
),

71 
	`TP_STRUCT__íåy
(

72 
DEV_ENTRY


73 
	$__fõld
(
u64
, 
offs
)

74 
	`__fõld
(
u64
, 
vÆ
)

76 
	`TP_Á°_assign
(

77 
DEV_ASSIGN
;

78 
__íåy
->
offs
 = offs;

79 
__íåy
->
vÆ
 = val;

81 
	`TP_¥ötk
("[%s] write io[%llu] = %llu)",

82 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

85 
	`TRACE_EVENT
(
iwlwifi_dev_iowrôe_¥ph32
,

86 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
offs
, u32 
vÆ
),

87 
	`TP_ARGS
(
dev
, 
offs
, 
vÆ
),

88 
	`TP_STRUCT__íåy
(

89 
DEV_ENTRY


90 
	$__fõld
(
u32
, 
offs
)

91 
	`__fõld
(
u32
, 
vÆ
)

93 
	`TP_Á°_assign
(

94 
DEV_ASSIGN
;

95 
__íåy
->
offs
 = offs;

96 
__íåy
->
vÆ
 = val;

98 
	`TP_¥ötk
("[%s] write PRPH[%#x] = %#x)",

99 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

102 
	`TRACE_EVENT
(
iwlwifi_dev_iowrôe_¥ph64
,

103 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u64
 
offs
, u64 
vÆ
),

104 
	`TP_ARGS
(
dev
, 
offs
, 
vÆ
),

105 
	`TP_STRUCT__íåy
(

106 
DEV_ENTRY


107 
	$__fõld
(
u64
, 
offs
)

108 
	`__fõld
(
u64
, 
vÆ
)

110 
	`TP_Á°_assign
(

111 
DEV_ASSIGN
;

112 
__íåy
->
offs
 = offs;

113 
__íåy
->
vÆ
 = val;

115 
	`TP_¥ötk
("[%s] write PRPH[%llu] = %llu)",

116 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

119 
	`TRACE_EVENT
(
iwlwifi_dev_i‹ód_¥ph32
,

120 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
offs
, u32 
vÆ
),

121 
	`TP_ARGS
(
dev
, 
offs
, 
vÆ
),

122 
	`TP_STRUCT__íåy
(

123 
DEV_ENTRY


124 
	$__fõld
(
u32
, 
offs
)

125 
	`__fõld
(
u32
, 
vÆ
)

127 
	`TP_Á°_assign
(

128 
DEV_ASSIGN
;

129 
__íåy
->
offs
 = offs;

130 
__íåy
->
vÆ
 = val;

132 
	`TP_¥ötk
("[%s]Ñead PRPH[%#x] = %#x",

133 
	`__gë_°r
(
dev
), 
__íåy
->
offs
, __íåy->
vÆ
)

136 
	`TRACE_EVENT
(
iwlwifi_dev_úq
,

137 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
),

138 
	`TP_ARGS
(
dev
),

139 
	`TP_STRUCT__íåy
(

140 
DEV_ENTRY


142 
	`TP_Á°_assign
(

143 
DEV_ASSIGN
;

146 
	`TP_¥ötk
("%d", 0)

149 
	`TRACE_EVENT
(
iwlwifi_dev_úq_msix
,

150 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
msix_íåy
 *msix_entry,

151 
boﬁ
 
defúq
, 
u32
 
öè_fh
, u32 
öè_hw
),

152 
	`TP_ARGS
(
dev
, 
msix_íåy
, 
defúq
, 
öè_fh
, 
öè_hw
),

153 
	`TP_STRUCT__íåy
(

154 
DEV_ENTRY


155 
	$__fõld
(
u32
, 
íåy
)

156 
	$__fõld
(
u8
, 
defúq
)

157 
	$__fõld
(
u32
, 
öè_fh
)

158 
	`__fõld
(
u32
, 
öè_hw
)

160 
	`TP_Á°_assign
(

161 
DEV_ASSIGN
;

162 
__íåy
->
íåy
 = 
msix_íåy
->entry;

163 
__íåy
->
defúq
 = defirq;

164 
__íåy
->
öè_fh
 = inta_fh;

165 
__íåy
->
öè_hw
 = inta_hw;

167 
	`TP_¥ötk
("entry:%d defirq:%d fh:0x%x, hw:0x%x",

168 
__íåy
->
íåy
, __íåy->
defúq
,

169 
__íåy
->
öè_fh
, __íåy->
öè_hw
)

172 
	`TRACE_EVENT
(
iwlwifi_dev_i˘_ªad
,

173 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
ödex
, u32 
vÆue
),

174 
	`TP_ARGS
(
dev
, 
ödex
, 
vÆue
),

175 
	`TP_STRUCT__íåy
(

176 
DEV_ENTRY


177 
	$__fõld
(
u32
, 
ödex
)

178 
	`__fõld
(
u32
, 
vÆue
)

180 
	`TP_Á°_assign
(

181 
DEV_ASSIGN
;

182 
__íåy
->
ödex
 = index;

183 
__íåy
->
vÆue
 = value;

185 
	`TP_¥ötk
("[%s]Ñead ict[%d] = %#.8x",

186 
	`__gë_°r
(
dev
), 
__íåy
->
ödex
, __íåy->
vÆue
)

190 #unde‡
TRACE_INCLUDE_PATH


191 
	#TRACE_INCLUDE_PATH
 .

	)

192 #unde‡
TRACE_INCLUDE_FILE


193 
	#TRACE_INCLUDE_FILE
 
iwl
-
devåa˚
-
io


	)

194 
	~<åa˚/deföe_åa˚.h
>

	@iwl-devtrace-iwlwifi.h

10 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_IWLWIFI
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

11 
	#__IWLWIFI_DEVICE_TRACE_IWLWIFI


	)

13 
	~<löux/åa˚poöt.h
>

15 #unde‡
TRACE_SYSTEM


16 
	#TRACE_SYSTEM
 
iwlwifi


	)

18 
TRACE_EVENT
(
iwlwifi_dev_hcmd
,

19 
TP_PROTO
(c⁄° 
devi˚
 *
dev
,

20 
iwl_ho°_cmd
 *
cmd
, 
u16
 
tŸÆ_size
,

21 
iwl_cmd_hódî_wide
 *
hdr
),

22 
TP_ARGS
(
dev
, 
cmd
, 
tŸÆ_size
, 
hdr
),

23 
TP_STRUCT__íåy
(

24 
DEV_ENTRY


25 
	$__dy«mic_¨øy
(
u8
, 
hcmd
, 
tŸÆ_size
)

26 
	`__fõld
(
u32
, 
Êags
)

28 
	`TP_Á°_assign
(

29 
i
, 
off£t
 = (
iwl_cmd_hódî
);

31 i‡(
hdr
->
group_id
)

32 
off£t
 = (
iwl_cmd_hódî_wide
);

34 
DEV_ASSIGN
;

35 
__íåy
->
Êags
 = 
cmd
->flags;

36 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
hcmd
), 
hdr
, 
off£t
);

38 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

39 i‡(!
cmd
->
Àn
[
i
])

41 
	`mem˝y
((
u8
 *)
	`__gë_dy«mic_¨øy
(
hcmd
Ë+ 
off£t
,

42 
cmd
->
d©a
[
i
], cmd->
Àn
[i]);

43 
off£t
 +
cmd
->
Àn
[
i
];

44 
	}
}

46 
TP_¥ötk
("[%s] hcmd %#.2x.%#.2x (%ssync)",

47 
__gë_°r
(
dev
), ((
u8
 *)
__gë_dy«mic_¨øy
(
hcmd
))[1],

48 ((
u8
 *)
__gë_dy«mic_¨øy
(
hcmd
))[0],

49 
__íåy
->
Êags
 & 
CMD_ASYNC
 ? "a" : "")

52 
TRACE_EVENT
(
iwlwifi_dev_rx
,

53 
TP_PROTO
(c⁄° 
devi˚
 *
dev
,

54 
iwl_rx_∑ckë
 *
pkt
, 
size_t
 
Àn
, size_à
åa˚_Àn
,

55 
size_t
 
hdr_off£t
),

56 
TP_ARGS
(
dev
, 
pkt
, 
Àn
, 
åa˚_Àn
, 
hdr_off£t
),

57 
TP_STRUCT__íåy
(

58 
DEV_ENTRY


59 
	$__fõld
(
u16
, 
cmd
)

60 
	$__fõld
(
u8
, 
hdr_off£t
)

61 
	`__dy«mic_¨øy
(
u8
, 
rxbuf
, 
åa˚_Àn
)

63 
	`TP_Á°_assign
(

64 
DEV_ASSIGN
;

65 
__íåy
->
cmd
 = 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.cmd);

66 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
rxbuf
), 
pkt
, 
åa˚_Àn
);

67 
__íåy
->
hdr_off£t
 = hdr_offset;

69 
	`TP_¥ötk
("[%s] RX cmd %#.2x",

70 
	`__gë_°r
(
dev
), 
__íåy
->
cmd
)

73 
	`TRACE_EVENT
(
iwlwifi_dev_tx
,

74 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
sk_buff
 *
skb
,

75 *
tfd
, 
size_t
 
tfdÀn
,

76 *
buf0
, 
size_t
 
buf0_Àn
,

77 
hdr_Àn
),

78 
	`TP_ARGS
(
dev
, 
skb
, 
tfd
, 
tfdÀn
, 
buf0
, 
buf0_Àn
, 
hdr_Àn
),

79 
	`TP_STRUCT__íåy
(

80 
DEV_ENTRY


81 
	$__fõld
(*, 
skbaddr
)

82 
	$__fõld
(
size_t
, 
‰amñí
)

83 
	$__dy«mic_¨øy
(
u8
, 
tfd
, 
tfdÀn
)

90 
	$__dy«mic_¨øy
(
u8
, 
buf0
, 
buf0_Àn
)

91 
	`__dy«mic_¨øy
(
u8
, 
buf1
, 
hdr_Àn
 > 0 && 
	`iwl_åa˚_d©a
(
skb
) ?

92 0 : 
skb
->
Àn
 - 
hdr_Àn
)

94 
	`TP_Á°_assign
(

95 
DEV_ASSIGN
;

96 
__íåy
->
skbaddr
 = 
skb
;

97 
__íåy
->
‰amñí
 = 
buf0_Àn
;

98 i‡(
hdr_Àn
 > 0)

99 
__íåy
->
‰amñí
 +
skb
->
Àn
 - 
hdr_Àn
;

100 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
tfd
),Åfd, 
tfdÀn
);

101 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
buf0
), buf0, 
buf0_Àn
);

102 i‡(
hdr_Àn
 > 0 && !
	$iwl_åa˚_d©a
(
skb
))

103 
	`skb_c›y_bôs
(
skb
, 
hdr_Àn
,

104 
	`__gë_dy«mic_¨øy
(
buf1
),

105 
skb
->
Àn
 - 
hdr_Àn
);

107 
	`TP_¥ötk
("[%s] TX %.2x (%zu bytes) skbaddr=%p",

108 
	`__gë_°r
(
dev
), ((
u8
 *)
	`__gë_dy«mic_¨øy
(
buf0
))[0],

109 
__íåy
->
‰amñí
, __íåy->
skbaddr
)

112 
	`TRACE_EVENT
(
iwlwifi_dev_ucode_evít
,

113 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
time
, u32 
d©a
, u32 
ev
),

114 
	`TP_ARGS
(
dev
, 
time
, 
d©a
, 
ev
),

115 
	`TP_STRUCT__íåy
(

116 
DEV_ENTRY


118 
	$__fõld
(
u32
, 
time
)

119 
	$__fõld
(
u32
, 
d©a
)

120 
	`__fõld
(
u32
, 
ev
)

122 
	`TP_Á°_assign
(

123 
DEV_ASSIGN
;

124 
__íåy
->
time
 =Åime;

125 
__íåy
->
d©a
 = data;

126 
__íåy
->
ev
 =Év;

128 
	`TP_¥ötk
("[%s] EVT_LOGT:%010u:0x%08x:%04u",

129 
	`__gë_°r
(
dev
), 
__íåy
->
time
, __íåy->
d©a
, __íåy->
ev
)

133 #unde‡
TRACE_INCLUDE_PATH


134 
	#TRACE_INCLUDE_PATH
 .

	)

135 #unde‡
TRACE_INCLUDE_FILE


136 
	#TRACE_INCLUDE_FILE
 
iwl
-
devåa˚
-
iwlwifi


	)

137 
	~<åa˚/deföe_åa˚.h
>

	@iwl-devtrace-msg.h

7 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_MSG
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

8 
	#__IWLWIFI_DEVICE_TRACE_MSG


	)

10 
	~<löux/åa˚poöt.h
>

12 #unde‡
TRACE_SYSTEM


13 
	#TRACE_SYSTEM
 
iwlwifi_msg


	)

15 
	#MAX_MSG_LEN
 110

	)

17 
DECLARE_EVENT_CLASS
(
iwlwifi_msg_evít
,

18 
TP_PROTO
(
va_f‹m©
 *
vaf
),

19 
TP_ARGS
(
vaf
),

20 
TP_STRUCT__íåy
(

21 
__v°rög
(
msg
, 
vaf
->
fmt
, vaf->
va
)

23 
TP_Á°_assign
(

24 
__assign_v°r
(
msg
, 
vaf
->
fmt
, vaf->
va
);

26 
TP_¥ötk
("%s", 
__gë_°r
(
msg
))

29 
DEFINE_EVENT
(
iwlwifi_msg_evít
, 
iwlwifi_îr
,

30 
TP_PROTO
(
va_f‹m©
 *
vaf
),

31 
TP_ARGS
(
vaf
)

34 
DEFINE_EVENT
(
iwlwifi_msg_evít
, 
iwlwifi_w¨n
,

35 
TP_PROTO
(
va_f‹m©
 *
vaf
),

36 
TP_ARGS
(
vaf
)

39 
DEFINE_EVENT
(
iwlwifi_msg_evít
, 
iwlwifi_öfo
,

40 
TP_PROTO
(
va_f‹m©
 *
vaf
),

41 
TP_ARGS
(
vaf
)

44 
DEFINE_EVENT
(
iwlwifi_msg_evít
, 
iwlwifi_¸ô
,

45 
TP_PROTO
(
va_f‹m©
 *
vaf
),

46 
TP_ARGS
(
vaf
)

49 
TRACE_EVENT
(
iwlwifi_dbg
,

50 
TP_PROTO
(
u32
 
Àvñ
, c⁄° *
fun˘i⁄
,

51 
va_f‹m©
 *
vaf
),

52 
TP_ARGS
(
Àvñ
, 
fun˘i⁄
, 
vaf
),

53 
TP_STRUCT__íåy
(

54 
	$__fõld
(
u32
, 
Àvñ
)

55 
	$__°rög
(
fun˘i⁄
, function)

56 
	`__v°rög
(
msg
, 
vaf
->
fmt
, vaf->
va
)

58 
	`TP_Á°_assign
(

59 
__íåy
->
Àvñ
 =Üevel;

60 
	`__assign_°r
(
fun˘i⁄
, function);

61 
	`__assign_v°r
(
msg
, 
vaf
->
fmt
, vaf->
va
);

63 
	`TP_¥ötk
("%s", 
	`__gë_°r
(
msg
))

67 #unde‡
TRACE_INCLUDE_PATH


68 
	#TRACE_INCLUDE_PATH
 .

	)

69 #unde‡
TRACE_INCLUDE_FILE


70 
	#TRACE_INCLUDE_FILE
 
iwl
-
devåa˚
-
msg


	)

71 
	~<åa˚/deföe_åa˚.h
>

	@iwl-devtrace-ucode.h

7 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_UCODE
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

8 
	#__IWLWIFI_DEVICE_TRACE_UCODE


	)

10 
	~<löux/åa˚poöt.h
>

12 #unde‡
TRACE_SYSTEM


13 
	#TRACE_SYSTEM
 
iwlwifi_ucode


	)

15 
TRACE_EVENT
(
iwlwifi_dev_ucode_c⁄t_evít
,

16 
TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
time
, u32 
d©a
, u32 
ev
),

17 
TP_ARGS
(
dev
, 
time
, 
d©a
, 
ev
),

18 
TP_STRUCT__íåy
(

19 
DEV_ENTRY


21 
	$__fõld
(
u32
, 
time
)

22 
	$__fõld
(
u32
, 
d©a
)

23 
	`__fõld
(
u32
, 
ev
)

25 
	`TP_Á°_assign
(

26 
DEV_ASSIGN
;

27 
__íåy
->
time
 =Åime;

28 
__íåy
->
d©a
 = data;

29 
__íåy
->
ev
 =Év;

31 
	`TP_¥ötk
("[%s] EVT_LOGT:%010u:0x%08x:%04u",

32 
	`__gë_°r
(
dev
), 
__íåy
->
time
, __íåy->
d©a
, __íåy->
ev
)

35 
	`TRACE_EVENT
(
iwlwifi_dev_ucode_wøp_evít
,

36 
	`TP_PROTO
(c⁄° 
devi˚
 *
dev
, 
u32
 
wøps
, u32 
n_íåy
, u32 
p_íåy
),

37 
	`TP_ARGS
(
dev
, 
wøps
, 
n_íåy
, 
p_íåy
),

38 
	`TP_STRUCT__íåy
(

39 
DEV_ENTRY


41 
	$__fõld
(
u32
, 
wøps
)

42 
	$__fõld
(
u32
, 
n_íåy
)

43 
	`__fõld
(
u32
, 
p_íåy
)

45 
	`TP_Á°_assign
(

46 
DEV_ASSIGN
;

47 
__íåy
->
wøps
 = wraps;

48 
__íåy
->
n_íåy
 =Ç_entry;

49 
__íåy
->
p_íåy
 =Ö_entry;

51 
	`TP_¥ötk
("[%s] wraps=#%02dÇ=0x%XÖ=0x%X",

52 
	`__gë_°r
(
dev
), 
__íåy
->
wøps
, __íåy->
n_íåy
,

53 
__íåy
->
p_íåy
)

57 #unde‡
TRACE_INCLUDE_PATH


58 
	#TRACE_INCLUDE_PATH
 .

	)

59 #unde‡
TRACE_INCLUDE_FILE


60 
	#TRACE_INCLUDE_FILE
 
iwl
-
devåa˚
-
ucode


	)

61 
	~<åa˚/deföe_åa˚.h
>

	@iwl-devtrace.c

8 
	~<löux/moduÀ.h
>

11 #i‚de‡
__CHECKER__


12 
	~"iwl-å™s.h
"

14 
	#CREATE_TRACE_POINTS


	)

15 #ifde‡
CONFIG_CC_IS_GCC


16 #¥agm®
GCC
 
dügno°ic
 
ign‹ed
 "-Wsuggest-attribute=format"

18 
	~"iwl-devåa˚.h
"

20 
EXPORT_TRACEPOINT_SYMBOL
(
iwlwifi_dev_ucode_evít
);

21 
EXPORT_TRACEPOINT_SYMBOL
(
iwlwifi_dev_ucode_c⁄t_evít
);

22 
EXPORT_TRACEPOINT_SYMBOL
(
iwlwifi_dev_ucode_wøp_evít
);

24 
	~"iwl-devåa˚.h
"

27 
	$__åa˚_iwlwifi_dev_rx
(
iwl_å™s
 *
å™s
, *
pkt
, 
size_t
 
Àn
)

29 
size_t
 
hdr_off£t
 = 0, 
åa˚_Àn
;

31 
åa˚_Àn
 = 
	`iwl_rx_åa˚_Àn
(
å™s
, 
pkt
, 
Àn
, &
hdr_off£t
);

32 
	`åa˚_iwlwifi_dev_rx
(
å™s
->
dev
, 
pkt
, 
Àn
, 
åa˚_Àn
, 
hdr_off£t
);

34 i‡(
åa˚_Àn
 < 
Àn
)

35 
	`åa˚_iwlwifi_dev_rx_d©a
(
å™s
->
dev
, 
pkt
, 
Àn
, 
åa˚_Àn
);

36 
	}
}

	@iwl-devtrace.h

9 #i‚de‡
__IWLWIFI_DEVICE_TRACE


10 
	#__IWLWIFI_DEVICE_TRACE


	)

11 
	~<löux/skbuff.h
>

12 
	~<löux/õì80211.h
>

13 
	~<√t/cfg80211.h
>

14 
	~<√t/mac80211.h
>

15 
	~"iwl-å™s.h
"

16 
ölöe
 
boﬁ
 
	$iwl_åa˚_d©a
(
sk_buff
 *
skb
)

18 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

19 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

20 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

21 
offs
 = 24;

23 i‡(!
	`õì80211_is_d©a
(
fc
))

24  
Ál£
;

27 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_REQ_TX_STATUS
)

28  
Ál£
;

36 i‡(
	`õì80211_has_a4
(
fc
))

37 
offs
 += 6;

38 i‡(
	`õì80211_is_d©a_qos
(
fc
))

39 
offs
 += 2;

43 
offs
 += 6;

45  
skb
->
Àn
 <
offs
 + 2 ||

46 *(
__be16
 *)(
skb
->
d©a
 + 
offs
Ë!
	`˝u_to_be16
(
ETH_P_PAE
);

47 
	}
}

49 
ölöe
 
size_t
 
	$iwl_rx_åa˚_Àn
(c⁄° 
iwl_å™s
 *
å™s
,

50 *
rxbuf
, 
size_t
 
Àn
,

51 
size_t
 *
out_hdr_off£t
)

53 
iwl_cmd_hódî
 *
cmd
 = (*)((
u8
 *)
rxbuf
 + (
__À32
));

54 
õì80211_hdr
 *
hdr
 = 
NULL
;

55 
size_t
 
hdr_off£t
;

57 i‡(
cmd
->cmd !
å™s
->
rx_mpdu_cmd
)

58  
Àn
;

60 
hdr_off£t
 = (
iwl_cmd_hódî
) +

61 
å™s
->
rx_mpdu_cmd_hdr_size
;

63 i‡(
out_hdr_off£t
)

64 *
out_hdr_off£t
 = 
hdr_off£t
;

66 
hdr
 = (*)((
u8
 *)
cmd
 + 
hdr_off£t
);

67 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

68  
Àn
;

70  (
__À32
Ë+ (*
cmd
Ë+ 
å™s
->
rx_mpdu_cmd_hdr_size
 +

71 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

72 
	}
}

74 
	~<löux/åa˚poöt.h
>

75 
	~<löux/devi˚.h
>

78 #i‡!
deföed
(
CONFIG_IWLWIFI_DEVICE_TRACING
Ë|| deföed(
__CHECKER__
)

79 #unde‡
TRACE_EVENT


80 
	#TRACE_EVENT
(
«me
, 
¥Ÿo
, ...) \

81 
ölöe
 
åa˚_
 ## 
	`«me
(
¥Ÿo
Ë{}

	)

82 #unde‡
DECLARE_EVENT_CLASS


83 
	#DECLARE_EVENT_CLASS
(...)

	)

84 #unde‡
DEFINE_EVENT


85 
	#DEFINE_EVENT
(
evt_˛ass
, 
«me
, 
¥Ÿo
, ...) \

86 
ölöe
 
åa˚_
 ## 
	`«me
(
¥Ÿo
Ë{}

	)

89 
	#DEV_ENTRY
 
	`__°rög
(
dev
, 
	`dev_«me
(dev))

	)

90 
	#DEV_ASSIGN
 
	`__assign_°r
(
dev
, 
	`dev_«me
(dev))

	)

92 
	~"iwl-devåa˚-io.h
"

93 
	~"iwl-devåa˚-ucode.h
"

94 
	~"iwl-devåa˚-msg.h
"

95 
	~"iwl-devåa˚-d©a.h
"

96 
	~"iwl-devåa˚-iwlwifi.h
"

98 #ifde‡
CONFIG_IWLWIFI_DEVICE_TRACING


99 
DECLARE_TRACEPOINT
(
iwlwifi_dev_rx
);

100 
DECLARE_TRACEPOINT
(
iwlwifi_dev_rx_d©a
);

103 
__åa˚_iwlwifi_dev_rx
(
iwl_å™s
 *
å™s
, *
pkt
, 
size_t
 
Àn
);

105 
ölöe
 
	$maybe_åa˚_iwlwifi_dev_rx
(
iwl_å™s
 *
å™s
,

106 *
pkt
, 
size_t
 
Àn
)

108 #ifde‡
CONFIG_IWLWIFI_DEVICE_TRACING


109 i‡(
	`åa˚poöt_íabÀd
(
iwlwifi_dev_rx
) ||

110 
	`åa˚poöt_íabÀd
(
iwlwifi_dev_rx_d©a
))

111 
	`__åa˚_iwlwifi_dev_rx
(
å™s
, 
pkt
, 
Àn
);

113 
	}
}

	@iwl-drv.c

7 
	~<löux/com∂ëi⁄.h
>

8 
	~<löux/dma-m≠pög.h
>

9 
	~<löux/fúmw¨e.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/vmÆloc.h
>

13 
	~"iwl-drv.h
"

14 
	~"iwl-c§.h
"

15 
	~"iwl-debug.h
"

16 
	~"iwl-å™s.h
"

17 
	~"iwl-›-mode.h
"

18 
	~"iwl-agn-hw.h
"

19 
	~"fw/img.h
"

20 
	~"iwl-dbg-év.h
"

21 
	~"iwl-c⁄fig.h
"

22 
	~"iwl-mod∑øms.h
"

23 
	~"fw/≠i/Æive.h
"

24 
	~"fw/≠i/mac.h
"

32 
	#DRV_DESCRIPTION
 "I¡ñ(RËWúñes†WiFòdrivî f‹ Löux"

	)

33 
MODULE_DESCRIPTION
(
DRV_DESCRIPTION
);

34 
MODULE_LICENSE
("GPL");

36 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


37 
díåy
 *
	giwl_dbgfs_roŸ
;

54 
	siwl_drv
 {

55 
li°_hód
 
	mli°
;

56 
iwl_fw
 
	mfw
;

58 
iwl_›_mode
 *
	m›_mode
;

59 
iwl_å™s
 *
	må™s
;

60 
devi˚
 *
	mdev
;

62 
	mfw_ödex
;

63 
	mfúmw¨e_«me
[64];

65 
com∂ëi⁄
 
	mªque°_fúmw¨e_com∂ëe
;

67 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


68 
díåy
 *
	mdbgfs_drv
;

69 
díåy
 *
	mdbgfs_å™s
;

70 
díåy
 *
	mdbgfs_›_mode
;

75 
	mDVM_OP_MODE
,

76 
	mMVM_OP_MODE
,

80 
DEFINE_MUTEX
(
iwlwifi_›mode_èbÀ_mtx
);

81 
	siwlwifi_›mode_èbÀ
 {

82 c⁄° *
	m«me
;

83 c⁄° 
iwl_›_mode_›s
 *
	m›s
;

84 
li°_hód
 
	mdrv
;

85 } 
	giwlwifi_›mode_èbÀ
[] = {

86 [
DVM_OP_MODE
] = { .
«me
 = "iwldvm", .
	g›s
 = 
NULL
 },

87 [
MVM_OP_MODE
] = { .
«me
 = "iwlmvm", .
	g›s
 = 
NULL
 },

90 
	#IWL_DEFAULT_SCAN_CHANNELS
 40

	)

96 
	sfw_£c
 {

97 c⁄° *
	md©a
;

98 
size_t
 
	msize
;

99 
u32
 
	moff£t
;

102 
	$iwl_‰ì_fw_desc
(
iwl_drv
 *
drv
, 
fw_desc
 *
desc
)

104 
	`v‰ì
(
desc
->
d©a
);

105 
desc
->
d©a
 = 
NULL
;

106 
desc
->
Àn
 = 0;

107 
	}
}

109 
	$iwl_‰ì_fw_img
(
iwl_drv
 *
drv
, 
fw_img
 *
img
)

111 
i
;

112 
i
 = 0; i < 
img
->
num_£c
; i++)

113 
	`iwl_‰ì_fw_desc
(
drv
, &
img
->
£c
[
i
]);

114 
	`k‰ì
(
img
->
£c
);

115 
	}
}

117 
	$iwl_dóŒoc_ucode
(
iwl_drv
 *
drv
)

119 
i
;

121 
	`k‰ì
(
drv
->
fw
.
dbg
.
de°_év
);

122 
i
 = 0; i < 
	`ARRAY_SIZE
(
drv
->
fw
.
dbg
.
c⁄f_év
); i++)

123 
	`k‰ì
(
drv
->
fw
.
dbg
.
c⁄f_év
[
i
]);

124 
i
 = 0; i < 
	`ARRAY_SIZE
(
drv
->
fw
.
dbg
.
åiggî_év
); i++)

125 
	`k‰ì
(
drv
->
fw
.
dbg
.
åiggî_év
[
i
]);

126 
	`k‰ì
(
drv
->
fw
.
dbg
.
mem_év
);

127 
	`k‰ì
(
drv
->
fw
.
iml
);

128 
	`k‰ì
(
drv
->
fw
.
ucode_ˇ∑
.
cmd_vîsi⁄s
);

129 
	`k‰ì
(
drv
->
fw
.
phy_öãgøti⁄_vî
);

130 
	`k‰ì
(
drv
->
å™s
->
dbg
.
pc_d©a
);

131 
drv
->
å™s
->
dbg
.
pc_d©a
 = 
NULL
;

133 
i
 = 0; i < 
IWL_UCODE_TYPE_MAX
; i++)

134 
	`iwl_‰ì_fw_img
(
drv
, drv->
fw
.
img
 + 
i
);

137 
	`mem£t
(&
drv
->
fw
, 0, (drv->fw));

138 
	}
}

140 
	$iwl_Æloc_fw_desc
(
iwl_drv
 *
drv
, 
fw_desc
 *
desc
,

141 
fw_£c
 *
£c
)

143 *
d©a
;

145 
desc
->
d©a
 = 
NULL
;

147 i‡(!
£c
 || !£c->
size
)

148  -
EINVAL
;

150 
d©a
 = 
	`vmÆloc
(
£c
->
size
);

151 i‡(!
d©a
)

152  -
ENOMEM
;

154 
desc
->
Àn
 = 
£c
->
size
;

155 
desc
->
off£t
 = 
£c
->offset;

156 
	`mem˝y
(
d©a
, 
£c
->d©a, 
desc
->
Àn
);

157 
desc
->
d©a
 = data;

160 
	}
}

162 
ölöe
 
	$iwl_drv_gë_°ï
(
°ï
)

164 i‡(
°ï
 =
SILICON_Z_STEP
)

166 i‡(
°ï
 =
SILICON_TC_STEP
)

168  'a' + 
°ï
;

169 
	}
}

171 c⁄° *
	$iwl_drv_gë_fw«me_¥e
(
iwl_å™s
 *
å™s
, *
buf
)

173 
mac_°ï
, 
rf_°ï
;

174 c⁄° *
rf
, *
cdb
;

176 i‡(
å™s
->
cfg
->
fw_«me_¥e
)

177  
å™s
->
cfg
->
fw_«me_¥e
;

179 i‡(
	`WARN_ON
(!
å™s
->
cfg
->
fw_«me_mac
))

182 
mac_°ï
 = 
	`iwl_drv_gë_°ï
(
å™s
->
hw_ªv_°ï
);

184 
rf_°ï
 = 
	`iwl_drv_gë_°ï
(
	`CSR_HW_RFID_STEP
(
å™s
->
hw_rf_id
));

186 
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
)) {

187 
IWL_CFG_RF_TYPE_HR1
:

188 
IWL_CFG_RF_TYPE_HR2
:

189 
rf
 = "hr";

190 
rf_°ï
 = 'b';

192 
IWL_CFG_RF_TYPE_GF
:

193 
rf
 = "gf";

195 
IWL_CFG_RF_TYPE_MR
:

196 
rf
 = "mr";

198 
IWL_CFG_RF_TYPE_MS
:

199 
rf
 = "ms";

201 
IWL_CFG_RF_TYPE_FM
:

202 
rf
 = "fm";

204 
IWL_CFG_RF_TYPE_WH
:

205 i‡(
SILICON_Z_STEP
 ==

206 
	`CSR_HW_RFID_STEP
(
å™s
->
hw_rf_id
)) {

207 
rf
 = "whtc";

208 
rf_°ï
 = 'a';

210 
rf
 = "wh";

217 
cdb
 = 
	`CSR_HW_RFID_IS_CDB
(
å™s
->
hw_rf_id
) ? "4" : "";

219 
	`s˙¥ötf
(
buf
, 
FW_NAME_PRE_BUFSIZE
,

221 
å™s
->
cfg
->
fw_«me_mac
, 
mac_°ï
,

222 
rf
, 
cdb
, 
rf_°ï
);

224  
buf
;

225 
	}
}

226 
IWL_EXPORT_SYMBOL
(
iwl_drv_gë_fw«me_¥e
);

228 
iwl_ªq_fw_ˇŒback
(c⁄° 
fúmw¨e
 *
ucode_øw
,

229 *
c⁄ãxt
);

231 
	$iwl_ªque°_fúmw¨e
(
iwl_drv
 *
drv
, 
boﬁ
 
fú°
)

233 c⁄° 
iwl_cfg
 *
cfg
 = 
drv
->
å™s
->cfg;

234 
_fw_«me_¥e
[
FW_NAME_PRE_BUFSIZE
];

235 c⁄° *
fw_«me_¥e
;

237 i‡(
drv
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_9000
 &&

238 (
drv
->
å™s
->
hw_ªv_°ï
 !
SILICON_B_STEP
 &&

239 
drv
->
å™s
->
hw_ªv_°ï
 !
SILICON_C_STEP
)) {

240 
	`IWL_ERR
(
drv
,

242 
drv
->
å™s
->
hw_ªv
);

243  -
EINVAL
;

246 
fw_«me_¥e
 = 
	`iwl_drv_gë_fw«me_¥e
(
drv
->
å™s
, 
_fw_«me_¥e
);

248 i‡(
fú°
)

249 
drv
->
fw_ödex
 = 
cfg
->
ucode_≠i_max
;

251 
drv
->
fw_ödex
--;

253 i‡(
drv
->
fw_ödex
 < 
cfg
->
ucode_≠i_mö
) {

254 
	`IWL_ERR
(
drv
, "no suitable firmware found!\n");

256 i‡(
cfg
->
ucode_≠i_mö
 =cfg->
ucode_≠i_max
) {

257 
	`IWL_ERR
(
drv
, "%s-%d i†ªquúed\n", 
fw_«me_¥e
,

258 
cfg
->
ucode_≠i_max
);

260 
	`IWL_ERR
(
drv
, "minimum versionÑequired: %s-%d\n",

261 
fw_«me_¥e
, 
cfg
->
ucode_≠i_mö
);

262 
	`IWL_ERR
(
drv
, "maximum version supported: %s-%d\n",

263 
fw_«me_¥e
, 
cfg
->
ucode_≠i_max
);

266 
	`IWL_ERR
(
drv
,

268  -
ENOENT
;

271 
	`¢¥ötf
(
drv
->
fúmw¨e_«me
, (drv->firmware_name), "%s-%d.ucode",

272 
fw_«me_¥e
, 
drv
->
fw_ödex
);

274 
	`IWL_DEBUG_FW_INFO
(
drv
, "attemptingÅoÜoad firmware '%s'\n",

275 
drv
->
fúmw¨e_«me
);

277  
	`ªque°_fúmw¨e_nowaô
(
THIS_MODULE
, 1, 
drv
->
fúmw¨e_«me
,

278 
drv
->
å™s
->
dev
,

279 
GFP_KERNEL
, 
drv
, 
iwl_ªq_fw_ˇŒback
);

280 
	}
}

282 
	sfw_img_∑rsög
 {

283 
fw_£c
 *
	m£c
;

284 
	m£c_cou¡î
;

290 
	sfw_£c_∑rsög
 {

291 
__À32
 
	moff£t
;

292 c⁄° 
u8
 
	md©a
[];

293 } 
	g__∑cked
;

301 
	siwl_év_ˇlib_d©a
 {

302 
__À32
 
	mucode_ty≥
;

303 
iwl_év_ˇlib_˘æ
 
	mˇlib
;

304 } 
	g__∑cked
;

306 
	siwl_fúmw¨e_põ˚s
 {

307 
fw_img_∑rsög
 
	mimg
[
IWL_UCODE_TYPE_MAX
];

309 
u32
 
	möô_evéog_±r
, 
	möô_evéog_size
, 
	möô_îæog_±r
;

310 
u32
 
	mö°_evéog_±r
, 
	mö°_evéog_size
, 
	mö°_îæog_±r
;

313 
boﬁ
 
	mdbg_de°_év_öô
;

314 c⁄° 
u8
 *
	mdbg_de°_vî
;

316 c⁄° 
iwl_fw_dbg_de°_év
 *
	mdbg_de°_év
;

317 c⁄° 
iwl_fw_dbg_de°_év_v1
 *
	mdbg_de°_év_v1
;

319 c⁄° 
iwl_fw_dbg_c⁄f_év
 *
	mdbg_c⁄f_év
[
FW_DBG_CONF_MAX
];

320 
size_t
 
	mdbg_c⁄f_év_Àn
[
FW_DBG_CONF_MAX
];

321 c⁄° 
iwl_fw_dbg_åiggî_év
 *
	mdbg_åiggî_év
[
FW_DBG_TRIGGER_MAX
];

322 
size_t
 
	mdbg_åiggî_év_Àn
[
FW_DBG_TRIGGER_MAX
];

323 
iwl_fw_dbg_mem_£g_év
 *
	mdbg_mem_év
;

324 
size_t
 
	mn_mem_év
;

331 
fw_£c
 *
	$gë_£c
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

332 
iwl_ucode_ty≥
 
ty≥
,

333 
£c
)

335  &
põ˚s
->
img
[
ty≥
].
£c
[sec];

336 
	}
}

338 
	$Æloc_£c_d©a
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

339 
iwl_ucode_ty≥
 
ty≥
,

340 
£c
)

342 
fw_img_∑rsög
 *
img
 = &
põ˚s
->img[
ty≥
];

343 
fw_£c
 *
£c_mem‹y
;

344 
size
 = 
£c
 + 1;

345 
size_t
 
Æloc_size
 = (*
img
->
£c
Ë* 
size
;

347 i‡(
img
->
£c
 && img->
£c_cou¡î
 >
size
)

350 
£c_mem‹y
 = 
	`kªÆloc
(
img
->
£c
, 
Æloc_size
, 
GFP_KERNEL
);

351 i‡(!
£c_mem‹y
)

354 
img
->
£c
 = 
£c_mem‹y
;

355 
img
->
£c_cou¡î
 = 
size
;

356 
	}
}

358 
	$£t_£c_d©a
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

359 
iwl_ucode_ty≥
 
ty≥
,

360 
£c
,

361 c⁄° *
d©a
)

363 
	`Æloc_£c_d©a
(
põ˚s
, 
ty≥
, 
£c
);

365 
põ˚s
->
img
[
ty≥
].
£c
[£c].
d©a
 = data;

366 
	}
}

368 
	$£t_£c_size
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

369 
iwl_ucode_ty≥
 
ty≥
,

370 
£c
,

371 
size_t
 
size
)

373 
	`Æloc_£c_d©a
(
põ˚s
, 
ty≥
, 
£c
);

375 
põ˚s
->
img
[
ty≥
].
£c
[£c].
size
 = size;

376 
	}
}

378 
size_t
 
	$gë_£c_size
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

379 
iwl_ucode_ty≥
 
ty≥
,

380 
£c
)

382  
põ˚s
->
img
[
ty≥
].
£c
[£c].
size
;

383 
	}
}

385 
	$£t_£c_off£t
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

386 
iwl_ucode_ty≥
 
ty≥
,

387 
£c
,

388 
u32
 
off£t
)

390 
	`Æloc_£c_d©a
(
põ˚s
, 
ty≥
, 
£c
);

392 
põ˚s
->
img
[
ty≥
].
£c
[£c].
off£t
 = offset;

393 
	}
}

398 
	$iwl_°‹e_ucode_£c
(
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

399 c⁄° *
d©a
, 
iwl_ucode_ty≥
 
ty≥
,

400 
size
)

402 
fw_img_∑rsög
 *
img
;

403 
fw_£c
 *
£c
;

404 c⁄° 
fw_£c_∑rsög
 *
£c_∑r£
;

405 
size_t
 
Æloc_size
;

407 i‡(
	`WARN_ON
(!
põ˚s
 || !
d©a
 || 
ty≥
 >
IWL_UCODE_TYPE_MAX
))

410 
£c_∑r£
 = (c⁄° 
fw_£c_∑rsög
 *)
d©a
;

412 
img
 = &
põ˚s
->img[
ty≥
];

414 
Æloc_size
 = (*
img
->
£c
Ë* (img->
£c_cou¡î
 + 1);

415 
£c
 = 
	`kªÆloc
(
img
->£c, 
Æloc_size
, 
GFP_KERNEL
);

416 i‡(!
£c
)

417  -
ENOMEM
;

418 
img
->
£c
 = sec;

420 
£c
 = &
img
->£c[img->
£c_cou¡î
];

422 
£c
->
off£t
 = 
	`À32_to_˝u
(
£c_∑r£
->offset);

423 
£c
->
d©a
 = 
£c_∑r£
->data;

424 
£c
->
size
 = sizê- (
£c_∑r£
->
off£t
);

426 ++
img
->
£c_cou¡î
;

429 
	}
}

431 
	$iwl_£t_deÁu…_ˇlib
(
iwl_drv
 *
drv
, c⁄° 
u8
 *
d©a
)

433 c⁄° 
iwl_év_ˇlib_d©a
 *
def_ˇlib
 =

434 (c⁄° 
iwl_év_ˇlib_d©a
 *)
d©a
;

435 
u32
 
ucode_ty≥
 = 
	`À32_to_˝u
(
def_ˇlib
->ucode_type);

436 i‡(
ucode_ty≥
 >
IWL_UCODE_TYPE_MAX
) {

437 
	`IWL_ERR
(
drv
, "Wrong ucode_type %u for default calibration.\n",

438 
ucode_ty≥
);

439  -
EINVAL
;

441 
drv
->
fw
.
deÁu…_ˇlib
[
ucode_ty≥
].
Êow_åiggî
 =

442 
def_ˇlib
->
ˇlib
.
Êow_åiggî
;

443 
drv
->
fw
.
deÁu…_ˇlib
[
ucode_ty≥
].
evít_åiggî
 =

444 
def_ˇlib
->
ˇlib
.
evít_åiggî
;

447 
	}
}

449 
	$iwl_£t_ucode_≠i_Êags
(
iwl_drv
 *
drv
, c⁄° 
u8
 *
d©a
,

450 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

452 c⁄° 
iwl_ucode_≠i
 *
ucode_≠i
 = (c⁄° *)
d©a
;

453 
u32
 
≠i_ödex
 = 
	`À32_to_˝u
(
ucode_≠i
->api_index);

454 
u32
 
≠i_Êags
 = 
	`À32_to_˝u
(
ucode_≠i
->api_flags);

455 
i
;

457 i‡(
≠i_ödex
 >
	`DIV_ROUND_UP
(
NUM_IWL_UCODE_TLV_API
, 32)) {

458 
	`IWL_WARN
(
drv
,

460 
≠i_ödex
);

464 
i
 = 0; i < 32; i++) {

465 i‡(
≠i_Êags
 & 
	`BIT
(
i
))

466 
	`__£t_bô
(
i
 + 32 * 
≠i_ödex
, 
ˇ∑
->
_≠i
);

468 
	}
}

470 
	$iwl_£t_ucode_ˇ∑bûôõs
(
iwl_drv
 *
drv
, c⁄° 
u8
 *
d©a
,

471 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

473 c⁄° 
iwl_ucode_ˇ∑
 *
ucode_ˇ∑
 = (c⁄° *)
d©a
;

474 
u32
 
≠i_ödex
 = 
	`À32_to_˝u
(
ucode_ˇ∑
->api_index);

475 
u32
 
≠i_Êags
 = 
	`À32_to_˝u
(
ucode_ˇ∑
->
≠i_ˇ∑
);

476 
i
;

478 i‡(
≠i_ödex
 >
	`DIV_ROUND_UP
(
NUM_IWL_UCODE_TLV_CAPA
, 32)) {

479 
	`IWL_WARN
(
drv
,

481 
≠i_ödex
);

485 
i
 = 0; i < 32; i++) {

486 i‡(
≠i_Êags
 & 
	`BIT
(
i
))

487 
	`__£t_bô
(
i
 + 32 * 
≠i_ödex
, 
ˇ∑
->
_ˇ∑
);

489 
	}
}

491 c⁄° *
	$iwl_ªdu˚d_fw_«me
(
iwl_drv
 *
drv
)

493 c⁄° *
«me
 = 
drv
->
fúmw¨e_«me
;

495 i‡(
	`°∫cmp
(
«me
, "iwlwifi-", 8) == 0)

496 
«me
 += 8;

498  
«me
;

499 
	}
}

501 
	$iwl_∑r£_v1_v2_fúmw¨e
(
iwl_drv
 *
drv
,

502 c⁄° 
fúmw¨e
 *
ucode_øw
,

503 
iwl_fúmw¨e_põ˚s
 *
põ˚s
)

505 c⁄° 
iwl_ucode_hódî
 *
ucode
 = (c⁄° *)
ucode_øw
->
d©a
;

506 
u32
 
≠i_vî
, 
hdr_size
, 
buûd
;

507 
buûd°r
[25];

508 c⁄° 
u8
 *
§c
;

510 
drv
->
fw
.
ucode_vî
 = 
	`À32_to_˝u
(
ucode
->
vî
);

511 
≠i_vî
 = 
	`IWL_UCODE_API
(
drv
->
fw
.
ucode_vî
);

513 
≠i_vî
) {

515 
hdr_size
 = 28;

516 i‡(
ucode_øw
->
size
 < 
hdr_size
) {

517 
	`IWL_ERR
(
drv
, "File sizeÅoo small!\n");

518  -
EINVAL
;

520 
buûd
 = 
	`À32_to_˝u
(
ucode
->
u
.
v2
.build);

521 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
,

522 
	`À32_to_˝u
(
ucode
->
u
.
v2
.
ö°_size
));

523 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
,

524 
	`À32_to_˝u
(
ucode
->
u
.
v2
.
d©a_size
));

525 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
,

526 
	`À32_to_˝u
(
ucode
->
u
.
v2
.
öô_size
));

527 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
,

528 
	`À32_to_˝u
(
ucode
->
u
.
v2
.
öô_d©a_size
));

529 
§c
 = 
ucode
->
u
.
v2
.
d©a
;

534 
hdr_size
 = 24;

535 i‡(
ucode_øw
->
size
 < 
hdr_size
) {

536 
	`IWL_ERR
(
drv
, "File sizeÅoo small!\n");

537  -
EINVAL
;

539 
buûd
 = 0;

540 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
,

541 
	`À32_to_˝u
(
ucode
->
u
.
v1
.
ö°_size
));

542 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
,

543 
	`À32_to_˝u
(
ucode
->
u
.
v1
.
d©a_size
));

544 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
,

545 
	`À32_to_˝u
(
ucode
->
u
.
v1
.
öô_size
));

546 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
,

547 
	`À32_to_˝u
(
ucode
->
u
.
v1
.
öô_d©a_size
));

548 
§c
 = 
ucode
->
u
.
v1
.
d©a
;

552 i‡(
buûd
)

553 
	`•rötf
(
buûd°r
, " buûd %u", 
buûd
);

555 
buûd°r
[0] = '\0';

557 
	`¢¥ötf
(
drv
->
fw
.
fw_vîsi⁄
,

558 (
drv
->
fw
.
fw_vîsi⁄
),

560 
	`IWL_UCODE_MAJOR
(
drv
->
fw
.
ucode_vî
),

561 
	`IWL_UCODE_MINOR
(
drv
->
fw
.
ucode_vî
),

562 
	`IWL_UCODE_API
(
drv
->
fw
.
ucode_vî
),

563 
	`IWL_UCODE_SERIAL
(
drv
->
fw
.
ucode_vî
),

564 
buûd°r
, 
	`iwl_ªdu˚d_fw_«me
(
drv
));

568 i‡(
ucode_øw
->
size
 !
hdr_size
 +

569 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
) +

570 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
) +

571 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
) +

572 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
)) {

574 
	`IWL_ERR
(
drv
,

576 ()
ucode_øw
->
size
);

577  -
EINVAL
;

581 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
, 
§c
);

582 
§c
 +
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
);

583 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
,

584 
IWLAGN_RTC_INST_LOWER_BOUND
);

585 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
, 
§c
);

586 
§c
 +
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
);

587 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
,

588 
IWLAGN_RTC_DATA_LOWER_BOUND
);

589 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
, 
§c
);

590 
§c
 +
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
);

591 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
,

592 
IWLAGN_RTC_INST_LOWER_BOUND
);

593 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
, 
§c
);

594 
§c
 +
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
);

595 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
,

596 
IWLAGN_RTC_DATA_LOWER_BOUND
);

598 
	}
}

600 
	$iwl_drv_£t_dump_ex˛ude
(
iwl_drv
 *
drv
,

601 
iwl_ucode_év_ty≥
 
év_ty≥
,

602 c⁄° *
év_d©a
, 
u32
 
év_Àn
)

604 c⁄° 
iwl_fw_dump_ex˛ude
 *
fw
 = 
év_d©a
;

605 
iwl_dump_ex˛ude
 *
ex˛
;

607 i‡(
év_Àn
 < (*
fw
))

610 i‡(
év_ty≥
 =
IWL_UCODE_TLV_SEC_TABLE_ADDR
) {

611 
ex˛
 = &
drv
->
fw
.
dump_ex˛
[0];

614 i‡(
ex˛
->
addr
)

615 
ex˛
 = &
drv
->
fw
.
dump_ex˛_wowœn
[0];

616 } i‡(
	`fw_has_ˇ∑
(&
drv
->
fw
.
ucode_ˇ∑
,

617 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
)) {

619 
ex˛
 = &
drv
->
fw
.
dump_ex˛
[0];

622 
ex˛
 = &
drv
->
fw
.
dump_ex˛_wowœn
[0];

625 i‡(
ex˛
->
addr
)

626 
ex˛
++;

628 i‡(
ex˛
->
addr
) {

629 
	`IWL_DEBUG_FW_INFO
(
drv
, "foundÅoo manyÉxcludes in fw file\n");

633 
ex˛
->
addr
 = 
	`À32_to_˝u
(
fw
->addrË& ~
FW_ADDR_CACHE_CONTROL
;

634 
ex˛
->
size
 = 
	`À32_to_˝u
(
fw
->size);

635 
	}
}

637 
	$iwl_∑r£_dbg_év_as£π_èbÀs
(
iwl_drv
 *
drv
,

638 c⁄° 
iwl_ucode_év
 *
év
)

640 c⁄° 
iwl_fw_öi_ªgi⁄_év
 *
ªgi⁄
;

641 
u32
 
Àngth
 = 
	`À32_to_˝u
(
év
->length);

642 
u32
 
addr
;

644 i‡(
Àngth
 < 
	`off£tof
(
	`ty≥of
(*
ªgi⁄
), 
•ecül_mem
) +

645 (
ªgi⁄
->
•ecül_mem
))

648 
ªgi⁄
 = (c⁄° *)
év
->
d©a
;

649 
addr
 = 
	`À32_to_˝u
(
ªgi⁄
->
•ecül_mem
.
ba£_addr
);

650 
addr
 +
	`À32_to_˝u
(
ªgi⁄
->
•ecül_mem
.
off£t
);

651 
addr
 &~
FW_ADDR_CACHE_CONTROL
;

653 i‡(
ªgi⁄
->
ty≥
 !
IWL_FW_INI_REGION_SPECIAL_DEVICE_MEMORY
)

656 
ªgi⁄
->
sub_ty≥
) {

657 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_UMAC_ERROR_TABLE
:

658 
drv
->
å™s
->
dbg
.
umac_îr‹_evít_èbÀ
 = 
addr
;

659 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

660 
IWL_ERROR_EVENT_TABLE_UMAC
;

662 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_LMAC_1_ERROR_TABLE
:

663 
drv
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[0] = 
addr
;

664 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

665 
IWL_ERROR_EVENT_TABLE_LMAC1
;

667 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_LMAC_2_ERROR_TABLE
:

668 
drv
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[1] = 
addr
;

669 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

670 
IWL_ERROR_EVENT_TABLE_LMAC2
;

672 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_TCM_1_ERROR_TABLE
:

673 
drv
->
å™s
->
dbg
.
tcm_îr‹_evít_èbÀ
[0] = 
addr
;

674 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

675 
IWL_ERROR_EVENT_TABLE_TCM1
;

677 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_TCM_2_ERROR_TABLE
:

678 
drv
->
å™s
->
dbg
.
tcm_îr‹_evít_èbÀ
[1] = 
addr
;

679 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

680 
IWL_ERROR_EVENT_TABLE_TCM2
;

682 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_RCM_1_ERROR_TABLE
:

683 
drv
->
å™s
->
dbg
.
rcm_îr‹_evít_èbÀ
[0] = 
addr
;

684 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

685 
IWL_ERROR_EVENT_TABLE_RCM1
;

687 
IWL_FW_INI_REGION_DEVICE_MEMORY_SUBTYPE_RCM_2_ERROR_TABLE
:

688 
drv
->
å™s
->
dbg
.
rcm_îr‹_evít_èbÀ
[1] = 
addr
;

689 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

690 
IWL_ERROR_EVENT_TABLE_RCM2
;

695 
	}
}

697 
	$iwl_∑r£_év_fúmw¨e
(
iwl_drv
 *
drv
,

698 c⁄° 
fúmw¨e
 *
ucode_øw
,

699 
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

700 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
,

701 
boﬁ
 *
u¢if„r_images
)

703 c⁄° 
iwl_év_ucode_hódî
 *
ucode
 = (c⁄° *)
ucode_øw
->
d©a
;

704 c⁄° 
iwl_ucode_év
 *
év
;

705 
size_t
 
Àn
 = 
ucode_øw
->
size
;

706 c⁄° 
u8
 *
d©a
;

707 
u32
 
év_Àn
;

708 
u32
 
u¢if„r_img
;

709 
iwl_ucode_év_ty≥
 
év_ty≥
;

710 c⁄° 
u8
 *
év_d©a
;

711 
buûd°r
[25];

712 
u32
 
buûd
, 
∑gög_mem_size
;

713 
num_of_˝us
;

714 
boﬁ
 
u¢if„r_ªq
 = 
Ál£
;

716 i‡(
Àn
 < (*
ucode
)) {

717 
	`IWL_ERR
(
drv
, "uCodêha†övÆidÜígth: %zd\n", 
Àn
);

718  -
EINVAL
;

721 i‡(
ucode
->
magic
 !
	`˝u_to_À32
(
IWL_TLV_UCODE_MAGIC
)) {

722 
	`IWL_ERR
(
drv
, "invalid uCode magic: 0X%x\n",

723 
	`À32_to_˝u
(
ucode
->
magic
));

724  -
EINVAL
;

727 
drv
->
fw
.
ucode_vî
 = 
	`À32_to_˝u
(
ucode
->
vî
);

728 
	`mem˝y
(
drv
->
fw
.
hum™_ªadabÀ
, 
ucode
->human_readable,

729 (
drv
->
fw
.
hum™_ªadabÀ
));

730 
buûd
 = 
	`À32_to_˝u
(
ucode
->build);

732 i‡(
buûd
)

733 
	`•rötf
(
buûd°r
, " buûd %u", 
buûd
);

735 
buûd°r
[0] = '\0';

737 
	`¢¥ötf
(
drv
->
fw
.
fw_vîsi⁄
,

738 (
drv
->
fw
.
fw_vîsi⁄
),

740 
	`IWL_UCODE_MAJOR
(
drv
->
fw
.
ucode_vî
),

741 
	`IWL_UCODE_MINOR
(
drv
->
fw
.
ucode_vî
),

742 
	`IWL_UCODE_API
(
drv
->
fw
.
ucode_vî
),

743 
	`IWL_UCODE_SERIAL
(
drv
->
fw
.
ucode_vî
),

744 
buûd°r
, 
	`iwl_ªdu˚d_fw_«me
(
drv
));

746 
d©a
 = 
ucode
->data;

748 
Àn
 -(*
ucode
);

750 
Àn
 >(*
év
)) {

751 
Àn
 -(*
év
);

753 
év
 = (c⁄° *)
d©a
;

754 
év_Àn
 = 
	`À32_to_˝u
(
év
->
Àngth
);

755 
év_ty≥
 = 
	`À32_to_˝u
(
év
->
ty≥
);

756 
év_d©a
 = 
év
->
d©a
;

758 i‡(
Àn
 < 
év_Àn
) {

759 
	`IWL_ERR
(
drv
, "invalid TLVÜen: %zd/%u\n",

760 
Àn
, 
év_Àn
);

761  -
EINVAL
;

763 
Àn
 -
	`ALIGN
(
év_Àn
, 4);

764 
d©a
 +(*
év
Ë+ 
	`ALIGN
(
év_Àn
, 4);

766 
év_ty≥
) {

767 
IWL_UCODE_TLV_INST
:

768 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_REGULAR
,

769 
IWL_UCODE_SECTION_INST
, 
év_d©a
);

770 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

771 
IWL_UCODE_SECTION_INST
, 
év_Àn
);

772 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_REGULAR
,

773 
IWL_UCODE_SECTION_INST
,

774 
IWLAGN_RTC_INST_LOWER_BOUND
);

776 
IWL_UCODE_TLV_DATA
:

777 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_REGULAR
,

778 
IWL_UCODE_SECTION_DATA
, 
év_d©a
);

779 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

780 
IWL_UCODE_SECTION_DATA
, 
év_Àn
);

781 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_REGULAR
,

782 
IWL_UCODE_SECTION_DATA
,

783 
IWLAGN_RTC_DATA_LOWER_BOUND
);

785 
IWL_UCODE_TLV_INIT
:

786 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_INIT
,

787 
IWL_UCODE_SECTION_INST
, 
év_d©a
);

788 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
,

789 
IWL_UCODE_SECTION_INST
, 
év_Àn
);

790 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_INIT
,

791 
IWL_UCODE_SECTION_INST
,

792 
IWLAGN_RTC_INST_LOWER_BOUND
);

794 
IWL_UCODE_TLV_INIT_DATA
:

795 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_INIT
,

796 
IWL_UCODE_SECTION_DATA
, 
év_d©a
);

797 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
,

798 
IWL_UCODE_SECTION_DATA
, 
év_Àn
);

799 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_INIT
,

800 
IWL_UCODE_SECTION_DATA
,

801 
IWLAGN_RTC_DATA_LOWER_BOUND
);

803 
IWL_UCODE_TLV_BOOT
:

804 
	`IWL_ERR
(
drv
, "Found unexpected BOOT ucode\n");

806 
IWL_UCODE_TLV_PROBE_MAX_LEN
:

807 i‡(
év_Àn
 !(
u32
))

808 
övÆid_év_Àn
;

809 
ˇ∑
->
max_¥obe_Àngth
 =

810 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

812 
IWL_UCODE_TLV_PAN
:

813 i‡(
év_Àn
)

814 
övÆid_év_Àn
;

815 
ˇ∑
->
Êags
 |
IWL_UCODE_TLV_FLAGS_PAN
;

817 
IWL_UCODE_TLV_FLAGS
:

819 i‡(
év_Àn
 < (
u32
))

820 
övÆid_év_Àn
;

822 i‡(
év_Àn
 % (
u32
))

823 
övÆid_év_Àn
;

831 
ˇ∑
->
Êags
 = 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

833 
IWL_UCODE_TLV_API_CHANGES_SET
:

834 i‡(
év_Àn
 !(
iwl_ucode_≠i
))

835 
övÆid_év_Àn
;

836 
	`iwl_£t_ucode_≠i_Êags
(
drv
, 
év_d©a
, 
ˇ∑
);

838 
IWL_UCODE_TLV_ENABLED_CAPABILITIES
:

839 i‡(
év_Àn
 !(
iwl_ucode_ˇ∑
))

840 
övÆid_év_Àn
;

841 
	`iwl_£t_ucode_ˇ∑bûôõs
(
drv
, 
év_d©a
, 
ˇ∑
);

843 
IWL_UCODE_TLV_INIT_EVTLOG_PTR
:

844 i‡(
év_Àn
 !(
u32
))

845 
övÆid_év_Àn
;

846 
põ˚s
->
öô_evéog_±r
 =

847 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

849 
IWL_UCODE_TLV_INIT_EVTLOG_SIZE
:

850 i‡(
év_Àn
 !(
u32
))

851 
övÆid_év_Àn
;

852 
põ˚s
->
öô_evéog_size
 =

853 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

855 
IWL_UCODE_TLV_INIT_ERRLOG_PTR
:

856 i‡(
év_Àn
 !(
u32
))

857 
övÆid_év_Àn
;

858 
põ˚s
->
öô_îæog_±r
 =

859 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

861 
IWL_UCODE_TLV_RUNT_EVTLOG_PTR
:

862 i‡(
év_Àn
 !(
u32
))

863 
övÆid_év_Àn
;

864 
põ˚s
->
ö°_evéog_±r
 =

865 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

867 
IWL_UCODE_TLV_RUNT_EVTLOG_SIZE
:

868 i‡(
év_Àn
 !(
u32
))

869 
övÆid_év_Àn
;

870 
põ˚s
->
ö°_evéog_size
 =

871 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

873 
IWL_UCODE_TLV_RUNT_ERRLOG_PTR
:

874 i‡(
év_Àn
 !(
u32
))

875 
övÆid_év_Àn
;

876 
põ˚s
->
ö°_îæog_±r
 =

877 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

879 
IWL_UCODE_TLV_ENHANCE_SENS_TBL
:

880 i‡(
év_Àn
)

881 
övÆid_év_Àn
;

882 
drv
->
fw
.
íh™˚_£nsôivôy_èbÀ
 = 
åue
;

884 
IWL_UCODE_TLV_WOWLAN_INST
:

885 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_WOWLAN
,

886 
IWL_UCODE_SECTION_INST
, 
év_d©a
);

887 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_WOWLAN
,

888 
IWL_UCODE_SECTION_INST
, 
év_Àn
);

889 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_WOWLAN
,

890 
IWL_UCODE_SECTION_INST
,

891 
IWLAGN_RTC_INST_LOWER_BOUND
);

893 
IWL_UCODE_TLV_WOWLAN_DATA
:

894 
	`£t_£c_d©a
(
põ˚s
, 
IWL_UCODE_WOWLAN
,

895 
IWL_UCODE_SECTION_DATA
, 
év_d©a
);

896 
	`£t_£c_size
(
põ˚s
, 
IWL_UCODE_WOWLAN
,

897 
IWL_UCODE_SECTION_DATA
, 
év_Àn
);

898 
	`£t_£c_off£t
(
põ˚s
, 
IWL_UCODE_WOWLAN
,

899 
IWL_UCODE_SECTION_DATA
,

900 
IWLAGN_RTC_DATA_LOWER_BOUND
);

902 
IWL_UCODE_TLV_PHY_CALIBRATION_SIZE
:

903 i‡(
év_Àn
 !(
u32
))

904 
övÆid_év_Àn
;

905 
ˇ∑
->
°™d¨d_phy_ˇlibøti⁄_size
 =

906 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

908 
IWL_UCODE_TLV_SEC_RT
:

909 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
, 
IWL_UCODE_REGULAR
,

910 
év_Àn
);

911 
drv
->
fw
.
ty≥
 = 
IWL_FW_MVM
;

913 
IWL_UCODE_TLV_SEC_INIT
:

914 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
, 
IWL_UCODE_INIT
,

915 
év_Àn
);

916 
drv
->
fw
.
ty≥
 = 
IWL_FW_MVM
;

918 
IWL_UCODE_TLV_SEC_WOWLAN
:

919 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
, 
IWL_UCODE_WOWLAN
,

920 
év_Àn
);

921 
drv
->
fw
.
ty≥
 = 
IWL_FW_MVM
;

923 
IWL_UCODE_TLV_DEF_CALIB
:

924 i‡(
év_Àn
 !(
iwl_év_ˇlib_d©a
))

925 
övÆid_év_Àn
;

926 i‡(
	`iwl_£t_deÁu…_ˇlib
(
drv
, 
év_d©a
))

927 
év_îr‹
;

929 
IWL_UCODE_TLV_PHY_SKU
:

930 i‡(
év_Àn
 !(
u32
))

931 
övÆid_év_Àn
;

932 
drv
->
fw
.
phy_c⁄fig
 = 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

933 
drv
->
fw
.
vÆid_tx_™t
 = (drv->fw.
phy_c⁄fig
 &

934 
FW_PHY_CFG_TX_CHAIN
) >>

935 
FW_PHY_CFG_TX_CHAIN_POS
;

936 
drv
->
fw
.
vÆid_rx_™t
 = (drv->fw.
phy_c⁄fig
 &

937 
FW_PHY_CFG_RX_CHAIN
) >>

938 
FW_PHY_CFG_RX_CHAIN_POS
;

940 
IWL_UCODE_TLV_SECURE_SEC_RT
:

941 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
, 
IWL_UCODE_REGULAR
,

942 
év_Àn
);

943 
drv
->
fw
.
ty≥
 = 
IWL_FW_MVM
;

945 
IWL_UCODE_TLV_SECURE_SEC_INIT
:

946 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
, 
IWL_UCODE_INIT
,

947 
év_Àn
);

948 
drv
->
fw
.
ty≥
 = 
IWL_FW_MVM
;

950 
IWL_UCODE_TLV_SECURE_SEC_WOWLAN
:

951 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
, 
IWL_UCODE_WOWLAN
,

952 
év_Àn
);

953 
drv
->
fw
.
ty≥
 = 
IWL_FW_MVM
;

955 
IWL_UCODE_TLV_NUM_OF_CPU
:

956 i‡(
év_Àn
 !(
u32
))

957 
övÆid_év_Àn
;

958 
num_of_˝us
 =

959 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

961 i‡(
num_of_˝us
 == 2) {

962 
drv
->
fw
.
img
[
IWL_UCODE_REGULAR
].
is_duÆ_˝us
 =

963 
åue
;

964 
drv
->
fw
.
img
[
IWL_UCODE_INIT
].
is_duÆ_˝us
 =

965 
åue
;

966 
drv
->
fw
.
img
[
IWL_UCODE_WOWLAN
].
is_duÆ_˝us
 =

967 
åue
;

968 } i‡((
num_of_˝us
 > 2) || (num_of_cpus < 1)) {

969 
	`IWL_ERR
(
drv
, "Driver support upÅo 2 CPUs\n");

970  -
EINVAL
;

973 
IWL_UCODE_TLV_N_SCAN_CHANNELS
:

974 i‡(
év_Àn
 !(
u32
))

975 
övÆid_év_Àn
;

976 
ˇ∑
->
n_sˇn_ch™√ls
 =

977 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

979 
IWL_UCODE_TLV_FW_VERSION
: {

980 c⁄° 
__À32
 *
±r
 = (c⁄° *)
év_d©a
;

981 
u32
 
maj‹
, 
mö‹
;

982 
u8
 
loˇl_comp
;

984 i‡(
év_Àn
 !(
u32
) * 3)

985 
övÆid_év_Àn
;

987 
maj‹
 = 
	`À32_to_˝up
(
±r
++);

988 
mö‹
 = 
	`À32_to_˝up
(
±r
++);

989 
loˇl_comp
 = 
	`À32_to_˝up
(
±r
);

991 i‡(
maj‹
 >= 35)

992 
	`¢¥ötf
(
drv
->
fw
.
fw_vîsi⁄
,

993 (
drv
->
fw
.
fw_vîsi⁄
),

994 "%u.%08x.%u %s", 
maj‹
, 
mö‹
,

995 
loˇl_comp
, 
	`iwl_ªdu˚d_fw_«me
(
drv
));

997 
	`¢¥ötf
(
drv
->
fw
.
fw_vîsi⁄
,

998 (
drv
->
fw
.
fw_vîsi⁄
),

999 "%u.%u.%u %s", 
maj‹
, 
mö‹
,

1000 
loˇl_comp
, 
	`iwl_ªdu˚d_fw_«me
(
drv
));

1003 
IWL_UCODE_TLV_FW_DBG_DEST
: {

1004 c⁄° 
iwl_fw_dbg_de°_év
 *
de°
 = 
NULL
;

1005 c⁄° 
iwl_fw_dbg_de°_év_v1
 *
de°_v1
 = 
NULL
;

1006 
u8
 
m⁄_mode
;

1008 
põ˚s
->
dbg_de°_vî
 = (c⁄° 
u8
 *)
év_d©a
;

1009 i‡(*
põ˚s
->
dbg_de°_vî
 == 1) {

1010 
de°
 = (c⁄° *)
év_d©a
;

1011 } i‡(*
põ˚s
->
dbg_de°_vî
 == 0) {

1012 
de°_v1
 = (c⁄° *)
év_d©a
;

1014 
	`IWL_ERR
(
drv
,

1016 *
põ˚s
->
dbg_de°_vî
);

1020 i‡(
põ˚s
->
dbg_de°_év_öô
) {

1021 
	`IWL_ERR
(
drv
,

1026 
põ˚s
->
dbg_de°_év_öô
 = 
åue
;

1028 i‡(
de°_v1
) {

1029 
põ˚s
->
dbg_de°_év_v1
 = 
de°_v1
;

1030 
m⁄_mode
 = 
de°_v1
->
m⁄ô‹_mode
;

1032 
põ˚s
->
dbg_de°_év
 = 
de°
;

1033 
m⁄_mode
 = 
de°
->
m⁄ô‹_mode
;

1036 
	`IWL_INFO
(
drv
, "Found debug destination: %s\n",

1037 
	`gë_fw_dbg_mode_°rög
(
m⁄_mode
));

1039 
drv
->
fw
.
dbg
.
n_de°_ªg
 = (
de°_v1
) ?

1040 
év_Àn
 -

1041 
	`off£tof
(
iwl_fw_dbg_de°_év_v1
,

1042 
ªg_›s
) :

1043 
év_Àn
 -

1044 
	`off£tof
(
iwl_fw_dbg_de°_év
,

1045 
ªg_›s
);

1047 
drv
->
fw
.
dbg
.
n_de°_ªg
 /=

1048 (
drv
->
fw
.
dbg
.
de°_év
->
ªg_›s
[0]);

1052 
IWL_UCODE_TLV_FW_DBG_CONF
: {

1053 c⁄° 
iwl_fw_dbg_c⁄f_év
 *
c⁄f
 =

1054 (c⁄° *)
év_d©a
;

1056 i‡(!
põ˚s
->
dbg_de°_év_öô
) {

1057 
	`IWL_ERR
(
drv
,

1059 
c⁄f
->
id
);

1063 i‡(
c⁄f
->
id
 >
	`ARRAY_SIZE
(
drv
->
fw
.
dbg
.
c⁄f_év
)) {

1064 
	`IWL_ERR
(
drv
,

1066 
c⁄f
->
id
);

1070 i‡(
põ˚s
->
dbg_c⁄f_év
[
c⁄f
->
id
]) {

1071 
	`IWL_ERR
(
drv
,

1073 
c⁄f
->
id
);

1077 i‡(
c⁄f
->
u¢if„r
)

1078 
u¢if„r_ªq
 = 
åue
;

1080 
	`IWL_INFO
(
drv
, "Found debug configuration: %d\n",

1081 
c⁄f
->
id
);

1083 
põ˚s
->
dbg_c⁄f_év
[
c⁄f
->
id
] = conf;

1084 
põ˚s
->
dbg_c⁄f_év_Àn
[
c⁄f
->
id
] = 
év_Àn
;

1087 
IWL_UCODE_TLV_FW_DBG_TRIGGER
: {

1088 c⁄° 
iwl_fw_dbg_åiggî_év
 *
åiggî
 =

1089 (c⁄° *)
év_d©a
;

1090 
u32
 
åiggî_id
 = 
	`À32_to_˝u
(
åiggî
->
id
);

1092 i‡(
åiggî_id
 >
	`ARRAY_SIZE
(
drv
->
fw
.
dbg
.
åiggî_év
)) {

1093 
	`IWL_ERR
(
drv
,

1095 
åiggî
->
id
);

1099 i‡(
põ˚s
->
dbg_åiggî_év
[
åiggî_id
]) {

1100 
	`IWL_ERR
(
drv
,

1102 
åiggî
->
id
);

1106 
	`IWL_INFO
(
drv
, "Found debugÅriggî: %u\n", 
åiggî
->
id
);

1108 
põ˚s
->
dbg_åiggî_év
[
åiggî_id
] = 
åiggî
;

1109 
põ˚s
->
dbg_åiggî_év_Àn
[
åiggî_id
] = 
év_Àn
;

1112 
IWL_UCODE_TLV_FW_DBG_DUMP_LST
: {

1113 i‡(
év_Àn
 !(
u32
)) {

1114 
	`IWL_ERR
(
drv
,

1119 
drv
->
fw
.
dbg
.
dump_mask
 =

1120 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

1123 
IWL_UCODE_TLV_SEC_RT_USNIFFER
:

1124 *
u¢if„r_images
 = 
åue
;

1125 
	`iwl_°‹e_ucode_£c
(
põ˚s
, 
év_d©a
,

1126 
IWL_UCODE_REGULAR_USNIFFER
,

1127 
év_Àn
);

1129 
IWL_UCODE_TLV_PAGING
:

1130 i‡(
év_Àn
 !(
u32
))

1131 
övÆid_év_Àn
;

1132 
∑gög_mem_size
 = 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

1134 
	`IWL_DEBUG_FW
(
drv
,

1136 
∑gög_mem_size
);

1138 i‡(
∑gög_mem_size
 > 
MAX_PAGING_IMAGE_SIZE
) {

1139 
	`IWL_ERR
(
drv
,

1141 
MAX_PAGING_IMAGE_SIZE
);

1142  -
EINVAL
;

1145 i‡(
∑gög_mem_size
 & (
FW_PAGING_SIZE
 - 1)) {

1146 
	`IWL_ERR
(
drv
,

1148 
FW_PAGING_SIZE
);

1149  -
EINVAL
;

1152 
drv
->
fw
.
img
[
IWL_UCODE_REGULAR
].
∑gög_mem_size
 =

1153 
∑gög_mem_size
;

1154 
u¢if„r_img
 = 
IWL_UCODE_REGULAR_USNIFFER
;

1155 
drv
->
fw
.
img
[
u¢if„r_img
].
∑gög_mem_size
 =

1156 
∑gög_mem_size
;

1158 
IWL_UCODE_TLV_FW_GSCAN_CAPA
:

1161 
IWL_UCODE_TLV_FW_MEM_SEG
: {

1162 c⁄° 
iwl_fw_dbg_mem_£g_év
 *
dbg_mem
 =

1163 (c⁄° *)
év_d©a
;

1164 
size_t
 
size
;

1165 
iwl_fw_dbg_mem_£g_év
 *
n
;

1167 i‡(
év_Àn
 !((*
dbg_mem
)))

1168 
övÆid_év_Àn
;

1170 
	`IWL_DEBUG_INFO
(
drv
, "Found debug memory segment: %u\n",

1171 
dbg_mem
->
d©a_ty≥
);

1173 
size
 = (*
põ˚s
->
dbg_mem_év
) *

1174 (
põ˚s
->
n_mem_év
 + 1);

1175 
n
 = 
	`kªÆloc
(
põ˚s
->
dbg_mem_év
, 
size
, 
GFP_KERNEL
);

1176 i‡(!
n
)

1177  -
ENOMEM
;

1178 
põ˚s
->
dbg_mem_év
 = 
n
;

1179 
põ˚s
->
dbg_mem_év
[põ˚s->
n_mem_év
] = *
dbg_mem
;

1180 
põ˚s
->
n_mem_év
++;

1183 
IWL_UCODE_TLV_IML
: {

1184 
drv
->
fw
.
iml_Àn
 = 
év_Àn
;

1185 
drv
->
fw
.
iml
 = 
	`kmemdup
(
év_d©a
, 
év_Àn
, 
GFP_KERNEL
);

1186 i‡(!
drv
->
fw
.
iml
)

1187  -
ENOMEM
;

1190 
IWL_UCODE_TLV_FW_RECOVERY_INFO
: {

1192 
__À32
 
buf_addr
;

1193 
__À32
 
buf_size
;

1194 } *
ªcov_öfo
 = (c⁄° *)
év_d©a
;

1196 i‡(
év_Àn
 !(*
ªcov_öfo
))

1197 
övÆid_év_Àn
;

1198 
ˇ∑
->
îr‹_log_addr
 =

1199 
	`À32_to_˝u
(
ªcov_öfo
->
buf_addr
);

1200 
ˇ∑
->
îr‹_log_size
 =

1201 
	`À32_to_˝u
(
ªcov_öfo
->
buf_size
);

1204 
IWL_UCODE_TLV_FW_FSEQ_VERSION
: {

1206 
u8
 
vîsi⁄
[32];

1207 
u8
 
sha1
[20];

1208 } *
f£q_vî
 = (c⁄° *)
év_d©a
;

1210 i‡(
év_Àn
 !(*
f£q_vî
))

1211 
övÆid_év_Àn
;

1212 
	`IWL_INFO
(
drv
, "TLV_FW_FSEQ_VERSION: %s\n",

1213 
f£q_vî
->
vîsi⁄
);

1216 
IWL_UCODE_TLV_FW_NUM_STATIONS
:

1217 i‡(
év_Àn
 !(
u32
))

1218 
övÆid_év_Àn
;

1219 i‡(
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
) >

1220 
IWL_MVM_STATION_COUNT_MAX
) {

1221 
	`IWL_ERR
(
drv
,

1223 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
));

1224 
év_îr‹
;

1226 
ˇ∑
->
num_°©i⁄s
 =

1227 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

1229 
IWL_UCODE_TLV_FW_NUM_BEACONS
:

1230 i‡(
év_Àn
 !(
u32
))

1231 
övÆid_év_Àn
;

1232 
ˇ∑
->
num_bóc⁄s
 =

1233 
	`À32_to_˝up
((c⁄° 
__À32
 *)
év_d©a
);

1235 
IWL_UCODE_TLV_UMAC_DEBUG_ADDRS
: {

1236 c⁄° 
iwl_umac_debug_addrs
 *
dbg_±rs
 =

1237 (c⁄° *)
év_d©a
;

1239 i‡(
év_Àn
 !(*
dbg_±rs
))

1240 
övÆid_év_Àn
;

1241 i‡(
drv
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 <

1242 
IWL_DEVICE_FAMILY_22000
)

1244 
drv
->
å™s
->
dbg
.
umac_îr‹_evít_èbÀ
 =

1245 
	`À32_to_˝u
(
dbg_±rs
->
îr‹_öfo_addr
) &

1246 ~
FW_ADDR_CACHE_CONTROL
;

1247 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

1248 
IWL_ERROR_EVENT_TABLE_UMAC
;

1251 
IWL_UCODE_TLV_LMAC_DEBUG_ADDRS
: {

1252 c⁄° 
iwl_lmac_debug_addrs
 *
dbg_±rs
 =

1253 (c⁄° *)
év_d©a
;

1255 i‡(
év_Àn
 !(*
dbg_±rs
))

1256 
övÆid_év_Àn
;

1257 i‡(
drv
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 <

1258 
IWL_DEVICE_FAMILY_22000
)

1260 
drv
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[0] =

1261 
	`À32_to_˝u
(
dbg_±rs
->
îr‹_evít_èbÀ_±r
) &

1262 ~
FW_ADDR_CACHE_CONTROL
;

1263 
drv
->
å™s
->
dbg
.
îr‹_evít_èbÀ_év_°©us
 |=

1264 
IWL_ERROR_EVENT_TABLE_LMAC1
;

1267 
IWL_UCODE_TLV_TYPE_REGIONS
:

1268 
	`iwl_∑r£_dbg_év_as£π_èbÀs
(
drv
, 
év
);

1269 
ÁŒthrough
;

1270 
IWL_UCODE_TLV_TYPE_DEBUG_INFO
:

1271 
IWL_UCODE_TLV_TYPE_BUFFER_ALLOCATION
:

1272 
IWL_UCODE_TLV_TYPE_HCMD
:

1273 
IWL_UCODE_TLV_TYPE_TRIGGERS
:

1274 
IWL_UCODE_TLV_TYPE_CONF_SET
:

1275 i‡(
iwlwifi_mod_∑øms
.
íabÀ_öi
)

1276 
	`iwl_dbg_év_Æloc
(
drv
->
å™s
, 
év
, 
Ál£
);

1278 
IWL_UCODE_TLV_CMD_VERSIONS
:

1279 i‡(
év_Àn
 % (
iwl_fw_cmd_vîsi⁄
)) {

1280 
	`IWL_ERR
(
drv
,

1282 
év_Àn
);

1283 
év_Àn
 /(
iwl_fw_cmd_vîsi⁄
);

1284 
év_Àn
 *(
iwl_fw_cmd_vîsi⁄
);

1286 i‡(
	`WARN_ON
(
ˇ∑
->
cmd_vîsi⁄s
))

1287  -
EINVAL
;

1288 
ˇ∑
->
cmd_vîsi⁄s
 = 
	`kmemdup
(
év_d©a
, 
év_Àn
,

1289 
GFP_KERNEL
);

1290 i‡(!
ˇ∑
->
cmd_vîsi⁄s
)

1291  -
ENOMEM
;

1292 
ˇ∑
->
n_cmd_vîsi⁄s
 =

1293 
év_Àn
 / (
iwl_fw_cmd_vîsi⁄
);

1295 
IWL_UCODE_TLV_PHY_INTEGRATION_VERSION
:

1296 i‡(
drv
->
fw
.
phy_öãgøti⁄_vî
) {

1297 
	`IWL_ERR
(
drv
,

1302 
drv
->
fw
.
phy_öãgøti⁄_vî
 =

1303 
	`kmemdup
(
év_d©a
, 
év_Àn
, 
GFP_KERNEL
);

1304 i‡(!
drv
->
fw
.
phy_öãgøti⁄_vî
)

1305  -
ENOMEM
;

1306 
drv
->
fw
.
phy_öãgøti⁄_vî_Àn
 = 
év_Àn
;

1308 
IWL_UCODE_TLV_SEC_TABLE_ADDR
:

1309 
IWL_UCODE_TLV_D3_KEK_KCK_ADDR
:

1310 
	`iwl_drv_£t_dump_ex˛ude
(
drv
, 
év_ty≥
,

1311 
év_d©a
, 
év_Àn
);

1313 
IWL_UCODE_TLV_CURRENT_PC
:

1314 i‡(
év_Àn
 < (
iwl_pc_d©a
))

1315 
övÆid_év_Àn
;

1316 
drv
->
å™s
->
dbg
.
pc_d©a
 =

1317 
	`kmemdup
(
év_d©a
, 
év_Àn
, 
GFP_KERNEL
);

1318 i‡(!
drv
->
å™s
->
dbg
.
pc_d©a
)

1319  -
ENOMEM
;

1320 
drv
->
å™s
->
dbg
.
num_pc
 =

1321 
év_Àn
 / (
iwl_pc_d©a
);

1324 
	`IWL_DEBUG_INFO
(
drv
, "unknow¿TLV: %d\n", 
év_ty≥
);

1329 i‡(!
	`fw_has_ˇ∑
(
ˇ∑
, 
IWL_UCODE_TLV_CAPA_USNIFFER_UNIFIED
) &&

1330 
u¢if„r_ªq
 && !*
u¢if„r_images
) {

1331 
	`IWL_ERR
(
drv
,

1333  -
EINVAL
;

1336 i‡(
Àn
) {

1337 
	`IWL_ERR
(
drv
, "övÆid TLVá·îÖ¨sög: %zd\n", 
Àn
);

1338 
	`iwl_¥öt_hex_dump
(
drv
, 
IWL_DL_FW
, 
d©a
, 
Àn
);

1339  -
EINVAL
;

1344 
övÆid_év_Àn
:

1345 
	`IWL_ERR
(
drv
, "TLV %d ha†övÆid size: %u\n", 
év_ty≥
, 
év_Àn
);

1346 
év_îr‹
:

1347 
	`iwl_¥öt_hex_dump
(
drv
, 
IWL_DL_FW
, 
év_d©a
, 
év_Àn
);

1349  -
EINVAL
;

1350 
	}
}

1352 
	$iwl_Æloc_ucode
(
iwl_drv
 *
drv
,

1353 
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

1354 
iwl_ucode_ty≥
 
ty≥
)

1356 
i
;

1357 
fw_desc
 *
£c
;

1359 
£c
 = 
	`kˇŒoc
(
põ˚s
->
img
[
ty≥
].
£c_cou¡î
, (*£c), 
GFP_KERNEL
);

1360 i‡(!
£c
)

1361  -
ENOMEM
;

1362 
drv
->
fw
.
img
[
ty≥
].
£c
 = sec;

1363 
drv
->
fw
.
img
[
ty≥
].
num_£c
 = 
põ˚s
->img[ty≥].
£c_cou¡î
;

1365 
i
 = 0; i < 
põ˚s
->
img
[
ty≥
].
£c_cou¡î
; i++)

1366 i‡(
	`iwl_Æloc_fw_desc
(
drv
, &
£c
[
i
], 
	`gë_£c
(
põ˚s
, 
ty≥
, i)))

1367  -
ENOMEM
;

1370 
	}
}

1372 
	$vÆid©e_£c_sizes
(
iwl_drv
 *
drv
,

1373 
iwl_fúmw¨e_põ˚s
 *
põ˚s
,

1374 c⁄° 
iwl_cfg
 *
cfg
)

1376 
	`IWL_DEBUG_INFO
(
drv
, "f/wÖackage hdrÑuntime inst size = %zd\n",

1377 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

1378 
IWL_UCODE_SECTION_INST
));

1379 
	`IWL_DEBUG_INFO
(
drv
, "f/wÖackage hdrÑuntime data size = %zd\n",

1380 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

1381 
IWL_UCODE_SECTION_DATA
));

1382 
	`IWL_DEBUG_INFO
(
drv
, "f/wÖackage hdr init inst size = %zd\n",

1383 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
));

1384 
	`IWL_DEBUG_INFO
(
drv
, "f/wÖackage hdr init data size = %zd\n",

1385 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
));

1388 i‡(
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_INST
) >

1389 
cfg
->
max_ö°_size
) {

1390 
	`IWL_ERR
(
drv
, "uCode instrÜen %zdÅooÜargeÅo fit in\n",

1391 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

1392 
IWL_UCODE_SECTION_INST
));

1396 i‡(
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
, 
IWL_UCODE_SECTION_DATA
) >

1397 
cfg
->
max_d©a_size
) {

1398 
	`IWL_ERR
(
drv
, "uCode dataÜen %zdÅooÜargeÅo fit in\n",

1399 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

1400 
IWL_UCODE_SECTION_DATA
));

1404 i‡(
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_INST
) >

1405 
cfg
->
max_ö°_size
) {

1406 
	`IWL_ERR
(
drv
, "uCode init instrÜen %zdÅooÜargeÅo fit in\n",

1407 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
,

1408 
IWL_UCODE_SECTION_INST
));

1412 i‡(
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_INIT
, 
IWL_UCODE_SECTION_DATA
) >

1413 
cfg
->
max_d©a_size
) {

1414 
	`IWL_ERR
(
drv
, "uCode init dataÜen %zdÅooÜargeÅo fit in\n",

1415 
	`gë_£c_size
(
põ˚s
, 
IWL_UCODE_REGULAR
,

1416 
IWL_UCODE_SECTION_DATA
));

1420 
	}
}

1422 
iwl_›_mode
 *

1423 
	$_iwl_›_mode_°¨t
(
iwl_drv
 *
drv
, 
iwlwifi_›mode_èbÀ
 *
›
)

1425 c⁄° 
iwl_›_mode_›s
 *
›s
 = 
›
->ops;

1426 
díåy
 *
dbgfs_dú
 = 
NULL
;

1427 
iwl_›_mode
 *
›_mode
 = 
NULL
;

1430 
	`lockdï_as£π_hñd
(&
iwlwifi_›mode_èbÀ_mtx
);

1432 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1433 
drv
->
dbgfs_›_mode
 = 
	`debugfs_¸óã_dú
(
›
->
«me
,

1434 
drv
->
dbgfs_drv
);

1435 
dbgfs_dú
 = 
drv
->
dbgfs_›_mode
;

1438 
›_mode
 = 
›s
->
	`°¨t
(
drv
->
å™s
, drv->å™s->
cfg
,

1439 &
drv
->
fw
, 
dbgfs_dú
);

1440 i‡(
›_mode
)

1441  
›_mode
;

1443 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1444 
	`debugfs_ªmove_ªcursive
(
drv
->
dbgfs_›_mode
);

1445 
drv
->
dbgfs_›_mode
 = 
NULL
;

1448  
NULL
;

1449 
	}
}

1451 
	$_iwl_›_mode_°›
(
iwl_drv
 *
drv
)

1454 
	`lockdï_as£π_hñd
(&
iwlwifi_›mode_èbÀ_mtx
);

1457 i‡(
drv
->
›_mode
) {

1458 
	`iwl_›_mode_°›
(
drv
->
›_mode
);

1459 
drv
->
›_mode
 = 
NULL
;

1461 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1462 
	`debugfs_ªmove_ªcursive
(
drv
->
dbgfs_›_mode
);

1463 
drv
->
dbgfs_›_mode
 = 
NULL
;

1466 
	}
}

1474 
	$iwl_ªq_fw_ˇŒback
(c⁄° 
fúmw¨e
 *
ucode_øw
, *
c⁄ãxt
)

1476 
iwl_drv
 *
drv
 = 
c⁄ãxt
;

1477 
iwl_fw
 *
fw
 = &
drv
->fw;

1478 c⁄° 
iwl_ucode_hódî
 *
ucode
;

1479 
iwlwifi_›mode_èbÀ
 *
›
;

1480 
îr
;

1481 
iwl_fúmw¨e_põ˚s
 *
põ˚s
;

1482 c⁄° 
≠i_max
 = 
drv
->
å™s
->
cfg
->
ucode_≠i_max
;

1483 c⁄° 
≠i_mö
 = 
drv
->
å™s
->
cfg
->
ucode_≠i_mö
;

1484 
size_t
 
åiggî_év_sz
[
FW_DBG_TRIGGER_MAX
];

1485 
u32
 
≠i_vî
;

1486 
i
;

1487 
boﬁ
 
u¢if„r_images
 = 
Ál£
;

1488 
boﬁ
 
Áûuª
 = 
åue
;

1490 
fw
->
ucode_ˇ∑
.
max_¥obe_Àngth
 = 
IWL_DEFAULT_MAX_PROBE_LENGTH
;

1491 
fw
->
ucode_ˇ∑
.
°™d¨d_phy_ˇlibøti⁄_size
 =

1492 
IWL_DEFAULT_STANDARD_PHY_CALIBRATE_TBL_SIZE
;

1493 
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
 = 
IWL_DEFAULT_SCAN_CHANNELS
;

1494 
fw
->
ucode_ˇ∑
.
num_°©i⁄s
 = 
IWL_MVM_STATION_COUNT_MAX
;

1495 
fw
->
ucode_ˇ∑
.
num_bóc⁄s
 = 1;

1497 
fw
->
dbg
.
dump_mask
 = 0xffffffff;

1499 
põ˚s
 = 
	`kzÆloc
((*põ˚s), 
GFP_KERNEL
);

1500 i‡(!
põ˚s
)

1501 
out_‰ì_fw
;

1503 i‡(!
ucode_øw
)

1504 
åy_agaö
;

1506 
	`IWL_DEBUG_FW_INFO
(
drv
, "Loaded firmware file '%s' (%zd bytes).\n",

1507 
drv
->
fúmw¨e_«me
, 
ucode_øw
->
size
);

1510 i‡(
ucode_øw
->
size
 < 4) {

1511 
	`IWL_ERR
(
drv
, "File size wayÅoo small!\n");

1512 
åy_agaö
;

1516 
ucode
 = (c⁄° 
iwl_ucode_hódî
 *)
ucode_øw
->
d©a
;

1518 i‡(
ucode
->
vî
)

1519 
îr
 = 
	`iwl_∑r£_v1_v2_fúmw¨e
(
drv
, 
ucode_øw
, 
põ˚s
);

1521 
îr
 = 
	`iwl_∑r£_év_fúmw¨e
(
drv
, 
ucode_øw
, 
põ˚s
,

1522 &
fw
->
ucode_ˇ∑
, &
u¢if„r_images
);

1524 i‡(
îr
)

1525 
åy_agaö
;

1527 i‡(
	`fw_has_≠i
(&
drv
->
fw
.
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_NEW_VERSION
))

1528 
≠i_vî
 = 
drv
->
fw
.
ucode_vî
;

1530 
≠i_vî
 = 
	`IWL_UCODE_API
(
drv
->
fw
.
ucode_vî
);

1537 i‡(
≠i_vî
 < 
≠i_mö
 ||ápi_vî > 
≠i_max
) {

1538 
	`IWL_ERR
(
drv
,

1541 
≠i_max
, 
≠i_vî
);

1542 
åy_agaö
;

1549 i‡(
fw
->
ty≥
 =
IWL_FW_DVM
 && 
	`vÆid©e_£c_sizes
(
drv
, 
põ˚s
,

1550 
drv
->
å™s
->
cfg
))

1551 
åy_agaö
;

1559 
i
 = 0; i < 
IWL_UCODE_TYPE_MAX
; i++)

1560 i‡(
	`iwl_Æloc_ucode
(
drv
, 
põ˚s
, 
i
))

1561 
out_‰ì_fw
;

1563 i‡(
põ˚s
->
dbg_de°_év_öô
) {

1564 
size_t
 
dbg_de°_size
 = (*
drv
->
fw
.
dbg
.
de°_év
) +

1565 (
drv
->
fw
.
dbg
.
de°_év
->
ªg_›s
[0]) *

1566 
drv
->
fw
.
dbg
.
n_de°_ªg
;

1568 
drv
->
fw
.
dbg
.
de°_év
 = 
	`kmÆloc
(
dbg_de°_size
, 
GFP_KERNEL
);

1570 i‡(!
drv
->
fw
.
dbg
.
de°_év
)

1571 
out_‰ì_fw
;

1573 i‡(*
põ˚s
->
dbg_de°_vî
 == 0) {

1574 
	`mem˝y
(
drv
->
fw
.
dbg
.
de°_év
, 
põ˚s
->
dbg_de°_év_v1
,

1575 
dbg_de°_size
);

1577 
iwl_fw_dbg_de°_év_v1
 *
de°_év
 =

1578 
drv
->
fw
.
dbg
.
de°_év
;

1580 
de°_év
->
vîsi⁄
 = 
põ˚s
->
dbg_de°_év
->version;

1581 
de°_év
->
m⁄ô‹_mode
 =

1582 
põ˚s
->
dbg_de°_év
->
m⁄ô‹_mode
;

1583 
de°_év
->
size_powî
 =

1584 
põ˚s
->
dbg_de°_év
->
size_powî
;

1585 
de°_év
->
wøp_cou¡
 =

1586 
põ˚s
->
dbg_de°_év
->
wøp_cou¡
;

1587 
de°_év
->
wrôe_±r_ªg
 =

1588 
põ˚s
->
dbg_de°_év
->
wrôe_±r_ªg
;

1589 
de°_év
->
ba£_shi·
 =

1590 
põ˚s
->
dbg_de°_év
->
ba£_shi·
;

1591 
	`mem˝y
(
de°_év
->
ªg_›s
,

1592 
põ˚s
->
dbg_de°_év
->
ªg_›s
,

1593 (
drv
->
fw
.
dbg
.
de°_év
->
ªg_›s
[0]) *

1594 
drv
->
fw
.
dbg
.
n_de°_ªg
);

1604 
de°_év
->
ba£_ªg
 = 
põ˚s
->
dbg_de°_év
->
cfg_ªg
;

1605 
de°_év
->
íd_shi·
 =

1606 
põ˚s
->
dbg_de°_év
->
size_shi·
;

1610 
i
 = 0; i < 
	`ARRAY_SIZE
(
drv
->
fw
.
dbg
.
c⁄f_év
); i++) {

1611 i‡(
põ˚s
->
dbg_c⁄f_év
[
i
]) {

1612 
drv
->
fw
.
dbg
.
c⁄f_év
[
i
] =

1613 
	`kmemdup
(
põ˚s
->
dbg_c⁄f_év
[
i
],

1614 
põ˚s
->
dbg_c⁄f_év_Àn
[
i
],

1615 
GFP_KERNEL
);

1616 i‡(!
drv
->
fw
.
dbg
.
c⁄f_év
[
i
])

1617 
out_‰ì_fw
;

1621 
	`mem£t
(&
åiggî_év_sz
, 0xff, (trigger_tlv_sz));

1623 
åiggî_év_sz
[
FW_DBG_TRIGGER_MISSED_BEACONS
] =

1624 (
iwl_fw_dbg_åiggî_mis£d_bc⁄
);

1625 
åiggî_év_sz
[
FW_DBG_TRIGGER_CHANNEL_SWITCH
] = 0;

1626 
åiggî_év_sz
[
FW_DBG_TRIGGER_FW_NOTIF
] =

1627 (
iwl_fw_dbg_åiggî_cmd
);

1628 
åiggî_év_sz
[
FW_DBG_TRIGGER_MLME
] =

1629 (
iwl_fw_dbg_åiggî_mlme
);

1630 
åiggî_év_sz
[
FW_DBG_TRIGGER_STATS
] =

1631 (
iwl_fw_dbg_åiggî_°©s
);

1632 
åiggî_év_sz
[
FW_DBG_TRIGGER_RSSI
] =

1633 (
iwl_fw_dbg_åiggî_low_rssi
);

1634 
åiggî_év_sz
[
FW_DBG_TRIGGER_TXQ_TIMERS
] =

1635 (
iwl_fw_dbg_åiggî_txq_timî
);

1636 
åiggî_év_sz
[
FW_DBG_TRIGGER_TIME_EVENT
] =

1637 (
iwl_fw_dbg_åiggî_time_evít
);

1638 
åiggî_év_sz
[
FW_DBG_TRIGGER_BA
] =

1639 (
iwl_fw_dbg_åiggî_ba
);

1640 
åiggî_év_sz
[
FW_DBG_TRIGGER_TDLS
] =

1641 (
iwl_fw_dbg_åiggî_tdls
);

1643 
i
 = 0; i < 
	`ARRAY_SIZE
(
drv
->
fw
.
dbg
.
åiggî_év
); i++) {

1644 i‡(
põ˚s
->
dbg_åiggî_év
[
i
]) {

1652 i‡(
	`WARN_ON
(
põ˚s
->
dbg_åiggî_év_Àn
[
i
] <

1653 (
åiggî_év_sz
[
i
] +

1654 (
iwl_fw_dbg_åiggî_év
))))

1655 
out_‰ì_fw
;

1656 
drv
->
fw
.
dbg
.
åiggî_év_Àn
[
i
] =

1657 
põ˚s
->
dbg_åiggî_év_Àn
[
i
];

1658 
drv
->
fw
.
dbg
.
åiggî_év
[
i
] =

1659 
	`kmemdup
(
põ˚s
->
dbg_åiggî_év
[
i
],

1660 
drv
->
fw
.
dbg
.
åiggî_év_Àn
[
i
],

1661 
GFP_KERNEL
);

1662 i‡(!
drv
->
fw
.
dbg
.
åiggî_év
[
i
])

1663 
out_‰ì_fw
;

1669 
drv
->
fw
.
dbg
.
mem_év
 = 
põ˚s
->
dbg_mem_év
;

1670 
põ˚s
->
dbg_mem_év
 = 
NULL
;

1671 
drv
->
fw
.
dbg
.
n_mem_év
 = 
põ˚s
->n_mem_tlv;

1678 
fw
->
öô_evéog_±r
 = 
põ˚s
->init_evtlog_ptr;

1679 i‡(
põ˚s
->
öô_evéog_size
)

1680 
fw
->
öô_evéog_size
 = (
põ˚s
->init_evtlog_size - 16)/12;

1682 
fw
->
öô_evéog_size
 =

1683 
drv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_evít_log_size
;

1684 
fw
->
öô_îæog_±r
 = 
põ˚s
->init_errlog_ptr;

1685 
fw
->
ö°_evéog_±r
 = 
põ˚s
->inst_evtlog_ptr;

1686 i‡(
põ˚s
->
ö°_evéog_size
)

1687 
fw
->
ö°_evéog_size
 = (
põ˚s
->inst_evtlog_size - 16)/12;

1689 
fw
->
ö°_evéog_size
 =

1690 
drv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_evít_log_size
;

1691 
fw
->
ö°_îæog_±r
 = 
põ˚s
->inst_errlog_ptr;

1697 i‡(
fw
->
ucode_ˇ∑
.
°™d¨d_phy_ˇlibøti⁄_size
 >

1698 
IWL_MAX_PHY_CALIBRATE_TBL_SIZE
)

1699 
fw
->
ucode_ˇ∑
.
°™d¨d_phy_ˇlibøti⁄_size
 =

1700 
IWL_MAX_STANDARD_PHY_CALIBRATE_TBL_SIZE
;

1703 
	`ªÀa£_fúmw¨e
(
ucode_øw
);

1705 
	`iwl_dbg_év_lﬂd_bö
(
drv
->
å™s
->
dev
, drv->trans);

1707 
	`muãx_lock
(&
iwlwifi_›mode_èbÀ_mtx
);

1708 
fw
->
ty≥
) {

1709 
IWL_FW_DVM
:

1710 
›
 = &
iwlwifi_›mode_èbÀ
[
DVM_OP_MODE
];

1713 
	`WARN
(1, "InvÆid fwÅy≥ %d\n", 
fw
->
ty≥
);

1714 
ÁŒthrough
;

1715 
IWL_FW_MVM
:

1716 
›
 = &
iwlwifi_›mode_èbÀ
[
MVM_OP_MODE
];

1720 
	`IWL_INFO
(
drv
, "loaded firmware version %s op_mode %s\n",

1721 
drv
->
fw
.
fw_vîsi⁄
, 
›
->
«me
);

1724 
	`li°_add_èû
(&
drv
->
li°
, &
›
->drv);

1726 i‡(
›
->
›s
) {

1727 
drv
->
›_mode
 = 
	`_iwl_›_mode_°¨t
(drv, 
›
);

1729 i‡(!
drv
->
›_mode
) {

1730 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1731 
out_unböd
;

1734 
	`ªque°_moduÀ_nowaô
("%s", 
›
->
«me
);

1736 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1738 
	`com∂ëe
(&
drv
->
ªque°_fúmw¨e_com∂ëe
);

1740 
Áûuª
 = 
Ál£
;

1741 
‰ì
;

1743 
åy_agaö
:

1745 
	`ªÀa£_fúmw¨e
(
ucode_øw
);

1746 i‡(
	`iwl_ªque°_fúmw¨e
(
drv
, 
Ál£
))

1747 
out_unböd
;

1748 
‰ì
;

1750 
out_‰ì_fw
:

1751 
	`ªÀa£_fúmw¨e
(
ucode_øw
);

1752 
out_unböd
:

1753 
	`com∂ëe
(&
drv
->
ªque°_fúmw¨e_com∂ëe
);

1754 
	`devi˚_ªÀa£_drivî
(
drv
->
å™s
->
dev
);

1756 
Áûuª
 = 
Ál£
;

1757 
‰ì
:

1758 i‡(
Áûuª
)

1759 
	`iwl_dóŒoc_ucode
(
drv
);

1761 i‡(
põ˚s
) {

1762 
i
 = 0; i < 
	`ARRAY_SIZE
(
põ˚s
->
img
); i++)

1763 
	`k‰ì
(
põ˚s
->
img
[
i
].
£c
);

1764 
	`k‰ì
(
põ˚s
->
dbg_mem_év
);

1765 
	`k‰ì
(
põ˚s
);

1767 
	}
}

1769 
iwl_drv
 *
	$iwl_drv_°¨t
(
iwl_å™s
 *
å™s
)

1771 
iwl_drv
 *
drv
;

1772 
ªt
;

1774 
drv
 = 
	`kzÆloc
((*drv), 
GFP_KERNEL
);

1775 i‡(!
drv
) {

1776 
ªt
 = -
ENOMEM
;

1777 
îr
;

1780 
drv
->
å™s
 =Årans;

1781 
drv
->
dev
 = 
å™s
->dev;

1783 
	`öô_com∂ëi⁄
(&
drv
->
ªque°_fúmw¨e_com∂ëe
);

1784 
	`INIT_LIST_HEAD
(&
drv
->
li°
);

1786 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1788 
drv
->
dbgfs_drv
 = 
	`debugfs_¸óã_dú
(
	`dev_«me
(
å™s
->
dev
),

1789 
iwl_dbgfs_roŸ
);

1792 
drv
->
å™s
->
dbgfs_dú
 = 
	`debugfs_¸óã_dú
("å™s", drv->
dbgfs_drv
);

1795 
drv
->
å™s
->
dbg
.
domaös_bôm≠
 = 
	`IWL_TRANS_FW_DBG_DOMAIN
(drv->trans);

1796 i‡(
iwlwifi_mod_∑øms
.
íabÀ_öi
 !
ENABLE_INI
) {

1800 
drv
->
å™s
->
dbg
.
domaös_bôm≠
 &= 0xffff;

1801 i‡(
iwlwifi_mod_∑øms
.
íabÀ_öi
 !
IWL_FW_INI_PRESET_DISABLE
) {

1802 i‡(
iwlwifi_mod_∑øms
.
íabÀ_öi
 > 
ENABLE_INI
) {

1803 
	`IWL_ERR
(
å™s
,

1805 
ENABLE_INI
);

1806 
iwlwifi_mod_∑øms
.
íabÀ_öi
 = 0;

1808 
drv
->
å™s
->
dbg
.
domaös_bôm≠
 =

1809 
	`BIT
(
IWL_FW_DBG_DOMAIN_POS
 + 
iwlwifi_mod_∑øms
.
íabÀ_öi
);

1813 
ªt
 = 
	`iwl_ªque°_fúmw¨e
(
drv
, 
åue
);

1814 i‡(
ªt
) {

1815 
	`IWL_ERR
(
å™s
, "Couldn'tÑequestÅhe fw\n");

1816 
îr_fw
;

1819  
drv
;

1821 
îr_fw
:

1822 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1823 
	`debugfs_ªmove_ªcursive
(
drv
->
dbgfs_drv
);

1824 
	`iwl_dbg_év_‰ì
(
drv
->
å™s
);

1826 
	`k‰ì
(
drv
);

1827 
îr
:

1828  
	`ERR_PTR
(
ªt
);

1829 
	}
}

1831 
	$iwl_drv_°›
(
iwl_drv
 *
drv
)

1833 
	`waô_f‹_com∂ëi⁄
(&
drv
->
ªque°_fúmw¨e_com∂ëe
);

1835 
	`muãx_lock
(&
iwlwifi_›mode_èbÀ_mtx
);

1837 
	`_iwl_›_mode_°›
(
drv
);

1839 
	`iwl_dóŒoc_ucode
(
drv
);

1846 i‡(!
	`li°_em±y
(&
drv
->
li°
))

1847 
	`li°_dñ
(&
drv
->
li°
);

1848 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1850 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1851 
drv
->
å™s
->
›s
->
	`debugfs_˛ónup
(drv->trans);

1853 
	`debugfs_ªmove_ªcursive
(
drv
->
dbgfs_drv
);

1856 
	`iwl_dbg_év_‰ì
(
drv
->
å™s
);

1858 
	`k‰ì
(
drv
);

1859 
	}
}

1862 
iwl_mod_∑øms
 
	giwlwifi_mod_∑øms
 = {

1863 .
fw_ª°¨t
 = 
åue
,

1864 .
	gbt_c€x_a˘ive
 = 
åue
,

1865 .
	gpowî_Àvñ
 = 
IWL_POWER_INDEX_1
,

1866 .
	gu≠sd_dißbÀ
 = 
IWL_DISABLE_UAPSD_BSS
 | 
IWL_DISABLE_UAPSD_P2P_CLIENT
,

1867 .
	gíabÀ_öi
 = 
ENABLE_INI
,

1870 
IWL_EXPORT_SYMBOL
(
iwlwifi_mod_∑øms
);

1872 
	$iwl_›mode_ªgi°î
(c⁄° *
«me
, c⁄° 
iwl_›_mode_›s
 *
›s
)

1874 
i
;

1875 
iwl_drv
 *
drv
;

1876 
iwlwifi_›mode_èbÀ
 *
›
;

1878 
	`muãx_lock
(&
iwlwifi_›mode_èbÀ_mtx
);

1879 
i
 = 0; i < 
	`ARRAY_SIZE
(
iwlwifi_›mode_èbÀ
); i++) {

1880 
›
 = &
iwlwifi_›mode_èbÀ
[
i
];

1881 i‡(
	`°rcmp
(
›
->
«me
,Çame))

1883 
›
->
›s
 = ops;

1885 
	`li°_f‹_óch_íåy
(
drv
, &
›
->drv, 
li°
)

1886 
drv
->
›_mode
 = 
	`_iwl_›_mode_°¨t
(drv, 
›
);

1888 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1891 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1892  -
EIO
;

1893 
	}
}

1894 
IWL_EXPORT_SYMBOL
(
iwl_›mode_ªgi°î
);

1896 
	$iwl_›mode_dîegi°î
(c⁄° *
«me
)

1898 
i
;

1899 
iwl_drv
 *
drv
;

1901 
	`muãx_lock
(&
iwlwifi_›mode_èbÀ_mtx
);

1902 
i
 = 0; i < 
	`ARRAY_SIZE
(
iwlwifi_›mode_èbÀ
); i++) {

1903 i‡(
	`°rcmp
(
iwlwifi_›mode_èbÀ
[
i
].
«me
,Çame))

1905 
iwlwifi_›mode_èbÀ
[
i
].
›s
 = 
NULL
;

1908 
	`li°_f‹_óch_íåy
(
drv
, &
iwlwifi_›mode_èbÀ
[
i
].drv, 
li°
)

1909 
	`_iwl_›_mode_°›
(
drv
);

1911 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1914 
	`muãx_u∆ock
(&
iwlwifi_›mode_èbÀ_mtx
);

1915 
	}
}

1916 
IWL_EXPORT_SYMBOL
(
iwl_›mode_dîegi°î
);

1918 
__öô
 
	$iwl_drv_öô
()

1920 
i
, 
îr
;

1922 
i
 = 0; i < 
	`ARRAY_SIZE
(
iwlwifi_›mode_èbÀ
); i++)

1923 
	`INIT_LIST_HEAD
(&
iwlwifi_›mode_èbÀ
[
i
].
drv
);

1925 
	`¥_öfo
(
DRV_DESCRIPTION
 "\n");

1927 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1929 
iwl_dbgfs_roŸ
 = 
	`debugfs_¸óã_dú
(
DRV_NAME
, 
NULL
);

1932 
îr
 = 
	`iwl_pci_ªgi°î_drivî
();

1933 i‡(
îr
)

1934 
˛ónup_debugfs
;

1938 
˛ónup_debugfs
:

1939 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1940 
	`debugfs_ªmove_ªcursive
(
iwl_dbgfs_roŸ
);

1942  
îr
;

1943 
	}
}

1944 
moduÀ_öô
(
iwl_drv_öô
);

1946 
__exô
 
	$iwl_drv_exô
()

1948 
	`iwl_pci_uƒegi°î_drivî
();

1950 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1951 
	`debugfs_ªmove_ªcursive
(
iwl_dbgfs_roŸ
);

1953 
	}
}

1954 
moduÀ_exô
(
iwl_drv_exô
);

1956 #ifde‡
CONFIG_IWLWIFI_DEBUG


1957 
moduÀ_∑øm_«med
(
debug
, 
iwlwifi_mod_∑øms
.
debug_Àvñ
, 
uöt
, 0644);

1958 
MODULE_PARM_DESC
(
debug
, "debug output mask");

1961 
moduÀ_∑øm_«med
(
sw¸y±o
, 
iwlwifi_mod_∑øms
.swcrypto, , 0444);

1962 
MODULE_PARM_DESC
(
sw¸y±o
, "using crypto in software (default 0 [hardware])");

1963 
moduÀ_∑øm_«med
(11
n_dißbÀ
, 
iwlwifi_mod_∑øms
.
dißbÀ_11n
, 
uöt
, 0444);

1964 
MODULE_PARM_DESC
(11
n_dißbÀ
,

1966 
moduÀ_∑øm_«med
(
amsdu_size
, 
iwlwifi_mod_∑øms
.amsdu_size, , 0444);

1967 
MODULE_PARM_DESC
(
amsdu_size
,

1970 
moduÀ_∑øm_«med
(
fw_ª°¨t
, 
iwlwifi_mod_∑øms
.fw_ª°¨t, 
boﬁ
, 0444);

1971 
MODULE_PARM_DESC
(
fw_ª°¨t
, "restart firmware in case ofÉrror (defaultÅrue)");

1973 
moduÀ_∑øm_«med
(
nvm_fûe
, 
iwlwifi_mod_∑øms
.nvm_fûe, 
ch¨p
, 0444);

1974 
MODULE_PARM_DESC
(
nvm_fûe
, "NVM fileÇame");

1976 
moduÀ_∑øm_«med
(
u≠sd_dißbÀ
, 
iwlwifi_mod_∑øms
.u≠sd_dißbÀ, 
uöt
, 0644);

1977 
MODULE_PARM_DESC
(
u≠sd_dißbÀ
,

1980 
moduÀ_∑øm_«med
(
íabÀ_öi
, 
iwlwifi_mod_∑øms
.íabÀ_öi, 
uöt
, 0444);

1981 
MODULE_PARM_DESC
(
íabÀ_öi
,

2001 
moduÀ_∑øm_«med
(
bt_c€x_a˘ive
, 
iwlwifi_mod_∑øms
.bt_coex_active,

2002 
boﬁ
, 0444);

2003 
MODULE_PARM_DESC
(
bt_c€x_a˘ive
, "enable wifi/bt co-exist (default:Énable)");

2005 
moduÀ_∑øm_«med
(
Àd_mode
, 
iwlwifi_mod_∑øms
.led_mode, , 0444);

2006 
MODULE_PARM_DESC
(
Àd_mode
, "0=system default, "

2009 
moduÀ_∑øm_«med
(
powî_ßve
, 
iwlwifi_mod_∑øms
.powî_ßve, 
boﬁ
, 0444);

2010 
MODULE_PARM_DESC
(
powî_ßve
,

2013 
moduÀ_∑øm_«med
(
powî_Àvñ
, 
iwlwifi_mod_∑øms
.power_level, , 0444);

2014 
MODULE_PARM_DESC
(
powî_Àvñ
,

2017 
moduÀ_∑øm_«med
(
dißbÀ_11ac
, 
iwlwifi_mod_∑øms
.dißbÀ_11ac, 
boﬁ
, 0444);

2018 
MODULE_PARM_DESC
(
dißbÀ_11ac
, "Disable VHT capabilities (default: false)");

2020 
moduÀ_∑øm_«med
(
ªmove_whí_g⁄e
,

2021 
iwlwifi_mod_∑øms
.
ªmove_whí_g⁄e
, 
boﬁ
,

2023 
MODULE_PARM_DESC
(
ªmove_whí_g⁄e
,

2026 
moduÀ_∑øm_«med
(
dißbÀ_11ax
, 
iwlwifi_mod_∑øms
.dißbÀ_11ax, 
boﬁ
,

2027 
S_IRUGO
);

2028 
MODULE_PARM_DESC
(
dißbÀ_11ax
, "Disable HE capabilities (default: false)");

2030 
moduÀ_∑øm_«med
(
dißbÀ_11be
, 
iwlwifi_mod_∑øms
.dißbÀ_11be, 
boﬁ
, 0444);

2031 
MODULE_PARM_DESC
(
dißbÀ_11be
, "Disable EHT capabilities (default: false)");

	@iwl-drv.h

6 #i‚de‡
__iwl_drv_h__


7 
	#__iwl_drv_h__


	)

8 
	~<löux/exp‹t.h
>

9 
	~<kunô/visibûôy.h
>

12 
	#DRV_NAME
 "iwlwifi"

	)

15 
	#NVM_RF_CFG_DASH_MSK
(
x
Ë(x & 0x3Ë

	)

16 
	#NVM_RF_CFG_STEP_MSK
(
x
Ë((x >> 2Ë& 0x3Ë

	)

17 
	#NVM_RF_CFG_TYPE_MSK
(
x
Ë((x >> 4Ë& 0x3Ë

	)

18 
	#NVM_RF_CFG_PNUM_MSK
(
x
Ë((x >> 6Ë& 0x3Ë

	)

19 
	#NVM_RF_CFG_TX_ANT_MSK
(
x
Ë((x >> 8Ë& 0xFË

	)

20 
	#NVM_RF_CFG_RX_ANT_MSK
(
x
Ë((x >> 12Ë& 0xFË

	)

22 
	#EXT_NVM_RF_CFG_FLAVOR_MSK
(
x
Ë((xË& 0xF)

	)

23 
	#EXT_NVM_RF_CFG_DASH_MSK
(
x
Ë(((xË>> 4Ë& 0xF)

	)

24 
	#EXT_NVM_RF_CFG_STEP_MSK
(
x
Ë(((xË>> 8Ë& 0xF)

	)

25 
	#EXT_NVM_RF_CFG_TYPE_MSK
(
x
Ë(((xË>> 12Ë& 0xFFF)

	)

26 
	#EXT_NVM_RF_CFG_TX_ANT_MSK
(
x
Ë(((xË>> 24Ë& 0xF)

	)

27 
	#EXT_NVM_RF_CFG_RX_ANT_MSK
(
x
Ë(((xË>> 28Ë& 0xF)

	)

54 
	giwl_drv
;

55 
	giwl_å™s
;

56 
	giwl_cfg
;

67 
iwl_drv
 *
iwl_drv_°¨t
(
iwl_å™s
 *
å™s
);

78 
iwl_drv_°›
(
iwl_drv
 *
drv
);

87 #ifde‡
CONFIG_IWLWIFI_OPMODE_MODULAR


88 
	#IWL_EXPORT_SYMBOL
(
sym
Ë
	`EXPORT_SYMBOL_NS_GPL
(sym, 
IWLWIFI
)

	)

90 
	#IWL_EXPORT_SYMBOL
(
sym
)

	)

93 #i‡
IS_ENABLED
(
CONFIG_IWLWIFI_KUNIT_TESTS
)

94 
	#EXPORT_SYMBOL_IF_IWLWIFI_KUNIT
(
sym
Ë
	`EXPORT_SYMBOL_IF_KUNIT
(sym)

	)

95 
	#VISIBLE_IF_IWLWIFI_KUNIT


	)

97 
	#EXPORT_SYMBOL_IF_IWLWIFI_KUNIT
(
sym
)

	)

98 
	#VISIBLE_IF_IWLWIFI_KUNIT
 

	)

101 
	#FW_NAME_PRE_BUFSIZE
 64

	)

102 
	giwl_å™s
;

103 c⁄° *
iwl_drv_gë_fw«me_¥e
(
iwl_å™s
 *
å™s
, *
buf
);

	@iwl-eeprom-parse.c

6 
	~<löux/ty≥s.h
>

7 
	~<löux/¶ab.h
>

8 
	~<löux/exp‹t.h
>

9 
	~"iwl-drv.h
"

10 
	~"iwl-mod∑øms.h
"

11 
	~"iwl-ì¥om-∑r£.h
"

13 #i‡
IS_ENABLED
(
CONFIG_IWLDVM
)

17 
	#ADDRESS_MSK
 0x0000FFFF

	)

18 
	#INDIRECT_TYPE_MSK
 0x000F0000

	)

19 
	#INDIRECT_HOST
 0x00010000

	)

20 
	#INDIRECT_GENERAL
 0x00020000

	)

21 
	#INDIRECT_REGULATORY
 0x00030000

	)

22 
	#INDIRECT_CALIBRATION
 0x00040000

	)

23 
	#INDIRECT_PROCESS_ADJST
 0x00050000

	)

24 
	#INDIRECT_OTHERS
 0x00060000

	)

25 
	#INDIRECT_TXP_LIMIT
 0x00070000

	)

26 
	#INDIRECT_TXP_LIMIT_SIZE
 0x00080000

	)

27 
	#INDIRECT_ADDRESS
 0x00100000

	)

30 
	#EEPROM_LINK_HOST
 (2*0x64)

	)

31 
	#EEPROM_LINK_GENERAL
 (2*0x65)

	)

32 
	#EEPROM_LINK_REGULATORY
 (2*0x66)

	)

33 
	#EEPROM_LINK_CALIBRATION
 (2*0x67)

	)

34 
	#EEPROM_LINK_PROCESS_ADJST
 (2*0x68)

	)

35 
	#EEPROM_LINK_OTHERS
 (2*0x69)

	)

36 
	#EEPROM_LINK_TXP_LIMIT
 (2*0x6a)

	)

37 
	#EEPROM_LINK_TXP_LIMIT_SIZE
 (2*0x6b)

	)

40 
	#EEPROM_DEVICE_ID
 (2*0x08Ë

	)

41 
	#EEPROM_SUBSYSTEM_ID
 (2*0x0AË

	)

42 
	#EEPROM_MAC_ADDRESS
 (2*0x15Ë

	)

43 
	#EEPROM_BOARD_REVISION
 (2*0x35Ë

	)

44 
	#EEPROM_BOARD_PBA_NUMBER
 (2*0x3B+1Ë

	)

45 
	#EEPROM_VERSION
 (2*0x44Ë

	)

46 
	#EEPROM_SKU_CAP
 (2*0x45Ë

	)

47 
	#EEPROM_OEM_MODE
 (2*0x46Ë

	)

48 
	#EEPROM_RADIO_CONFIG
 (2*0x48Ë

	)

49 
	#EEPROM_NUM_MAC_ADDRESS
 (2*0x4CË

	)

52 
	siwl_ì¥om_ˇlib_hdr
 {

53 
u8
 
	mvîsi⁄
;

54 
u8
 
	m∑_ty≥
;

55 
__À16
 
	mvﬁège
;

56 } 
	g__∑cked
;

58 
	#EEPROM_CALIB_ALL
 (
INDIRECT_ADDRESS
 | 
INDIRECT_CALIBRATION
)

	)

59 
	#EEPROM_XTAL
 ((2*0x128Ë| 
EEPROM_CALIB_ALL
)

	)

62 
	#EEPROM_KELVIN_TEMPERATURE
 ((2*0x12AË| 
EEPROM_CALIB_ALL
)

	)

63 
	#EEPROM_RAW_TEMPERATURE
 ((2*0x12BË| 
EEPROM_CALIB_ALL
)

	)

66 
	eì¥om_sku_bôs
 {

67 
	mEEPROM_SKU_CAP_BAND_24GHZ
 = 
BIT
(4),

68 
	mEEPROM_SKU_CAP_BAND_52GHZ
 = 
BIT
(5),

69 
	mEEPROM_SKU_CAP_11N_ENABLE
 = 
BIT
(6),

70 
	mEEPROM_SKU_CAP_AMT_ENABLE
 = 
BIT
(7),

71 
	mEEPROM_SKU_CAP_IPAN_ENABLE
 = 
BIT
(8)

75 
	#EEPROM_RF_CFG_TYPE_MSK
(
x
Ë(x & 0x3Ë

	)

76 
	#EEPROM_RF_CFG_STEP_MSK
(
x
Ë((x >> 2Ë& 0x3Ë

	)

77 
	#EEPROM_RF_CFG_DASH_MSK
(
x
Ë((x >> 4Ë& 0x3Ë

	)

78 
	#EEPROM_RF_CFG_PNUM_MSK
(
x
Ë((x >> 6Ë& 0x3Ë

	)

79 
	#EEPROM_RF_CFG_TX_ANT_MSK
(
x
Ë((x >> 8Ë& 0xFË

	)

80 
	#EEPROM_RF_CFG_RX_ANT_MSK
(
x
Ë((x >> 12Ë& 0xFË

	)

90 c⁄° 
u8
 
	giwl_ì¥om_b™d_1
[14] = {

94 c⁄° 
u8
 
	giwl_ì¥om_b™d_2
[] = {

98 c⁄° 
u8
 
	giwl_ì¥om_b™d_3
[] = {

102 c⁄° 
u8
 
	giwl_ì¥om_b™d_4
[] = {

106 c⁄° 
u8
 
	giwl_ì¥om_b™d_5
[] = {

110 c⁄° 
u8
 
	giwl_ì¥om_b™d_6
[] = {

114 c⁄° 
u8
 
	giwl_ì¥om_b™d_7
[] = {

118 
	#IWL_NUM_CHANNELS
 (
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_1
) + \

119 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_2
) + \

120 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_3
) + \

121 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_4
) + \

122 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_5
))

	)

125 
õì80211_øã
 
	giwl_cfg80211_øãs
[] = {

126 { .
bôøã
 = 1 * 10, .
	ghw_vÆue
 = 0, .
	ghw_vÆue_sh‹t
 = 0, },

127 { .
	gbôøã
 = 2 * 10, .
	ghw_vÆue
 = 1, .
	ghw_vÆue_sh‹t
 = 1,

128 .
	gÊags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
, },

129 { .
	gbôøã
 = 5.5 * 10, .
	ghw_vÆue
 = 2, .
	ghw_vÆue_sh‹t
 = 2,

130 .
	gÊags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
, },

131 { .
	gbôøã
 = 11 * 10, .
	ghw_vÆue
 = 3, .
	ghw_vÆue_sh‹t
 = 3,

132 .
	gÊags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
, },

133 { .
	gbôøã
 = 6 * 10, .
	ghw_vÆue
 = 4, .
	ghw_vÆue_sh‹t
 = 4, },

134 { .
	gbôøã
 = 9 * 10, .
	ghw_vÆue
 = 5, .
	ghw_vÆue_sh‹t
 = 5, },

135 { .
	gbôøã
 = 12 * 10, .
	ghw_vÆue
 = 6, .
	ghw_vÆue_sh‹t
 = 6, },

136 { .
	gbôøã
 = 18 * 10, .
	ghw_vÆue
 = 7, .
	ghw_vÆue_sh‹t
 = 7, },

137 { .
	gbôøã
 = 24 * 10, .
	ghw_vÆue
 = 8, .
	ghw_vÆue_sh‹t
 = 8, },

138 { .
	gbôøã
 = 36 * 10, .
	ghw_vÆue
 = 9, .
	ghw_vÆue_sh‹t
 = 9, },

139 { .
	gbôøã
 = 48 * 10, .
	ghw_vÆue
 = 10, .
	ghw_vÆue_sh‹t
 = 10, },

140 { .
	gbôøã
 = 54 * 10, .
	ghw_vÆue
 = 11, .
	ghw_vÆue_sh‹t
 = 11, },

142 
	#RATES_24_OFFS
 0

	)

143 
	#N_RATES_24
 
	`ARRAY_SIZE
(
iwl_cfg80211_øãs
)

	)

144 
	#RATES_52_OFFS
 4

	)

145 
	#N_RATES_52
 (
N_RATES_24
 - 
RATES_52_OFFS
)

	)

149 
u16
 
	$iwl_ì¥om_quîy16
(c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
, 
off£t
)

151 i‡(
	`WARN_ON
(
off£t
 + (
u16
Ë> 
ì¥om_size
))

153  
	`À16_to_˝up
((
__À16
 *)(
ì¥om
 + 
off£t
));

154 
	}
}

156 
u32
 
	$ì¥om_ödúe˘_addªss
(c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
,

157 
u32
 
addªss
)

159 
u16
 
off£t
 = 0;

161 i‡((
addªss
 & 
INDIRECT_ADDRESS
) == 0)

162  
addªss
;

164 
addªss
 & 
INDIRECT_TYPE_MSK
) {

165 
INDIRECT_HOST
:

166 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

167 
EEPROM_LINK_HOST
);

169 
INDIRECT_GENERAL
:

170 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

171 
EEPROM_LINK_GENERAL
);

173 
INDIRECT_REGULATORY
:

174 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

175 
EEPROM_LINK_REGULATORY
);

177 
INDIRECT_TXP_LIMIT
:

178 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

179 
EEPROM_LINK_TXP_LIMIT
);

181 
INDIRECT_TXP_LIMIT_SIZE
:

182 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

183 
EEPROM_LINK_TXP_LIMIT_SIZE
);

185 
INDIRECT_CALIBRATION
:

186 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

187 
EEPROM_LINK_CALIBRATION
);

189 
INDIRECT_PROCESS_ADJST
:

190 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

191 
EEPROM_LINK_PROCESS_ADJST
);

193 
INDIRECT_OTHERS
:

194 
off£t
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

195 
EEPROM_LINK_OTHERS
);

198 
	`WARN_ON
(1);

203  (
addªss
 & 
ADDRESS_MSK
Ë+ (
off£t
 << 1);

204 
	}
}

206 c⁄° 
u8
 *
	$iwl_ì¥om_quîy_addr
(c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
,

207 
u32
 
off£t
)

209 
u32
 
addªss
 = 
	`ì¥om_ödúe˘_addªss
(
ì¥om
, 
ì¥om_size
, 
off£t
);

211 i‡(
	`WARN_ON
(
addªss
 >
ì¥om_size
))

212  
NULL
;

214  &
ì¥om
[
addªss
];

215 
	}
}

217 
	$iwl_ì¥om_ªad_ˇlib
(c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
,

218 
iwl_nvm_d©a
 *
d©a
)

220 
iwl_ì¥om_ˇlib_hdr
 *
hdr
;

222 
hdr
 = (*)
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
,

223 
EEPROM_CALIB_ALL
);

224 i‡(!
hdr
)

225  -
ENODATA
;

226 
d©a
->
ˇlib_vîsi⁄
 = 
hdr
->
vîsi⁄
;

227 
d©a
->
ˇlib_vﬁège
 = 
hdr
->
vﬁège
;

230 
	}
}

241 
	eiwl_ì¥om_ch™√l_Êags
 {

242 
	mEEPROM_CHANNEL_VALID
 = 
BIT
(0),

243 
	mEEPROM_CHANNEL_IBSS
 = 
BIT
(1),

244 
	mEEPROM_CHANNEL_ACTIVE
 = 
BIT
(3),

245 
	mEEPROM_CHANNEL_RADAR
 = 
BIT
(4),

246 
	mEEPROM_CHANNEL_WIDE
 = 
BIT
(5),

247 
	mEEPROM_CHANNEL_DFS
 = 
BIT
(7),

255 
	siwl_ì¥om_ch™√l
 {

256 
u8
 
	mÊags
;

257 
s8
 
	mmax_powî_avg
;

258 } 
	g__∑cked
;

261 
	eiwl_ì¥om_íh™˚d_txpwr_Êags
 {

262 
	mIWL_EEPROM_ENH_TXP_FL_VALID
 = 
BIT
(0),

263 
	mIWL_EEPROM_ENH_TXP_FL_BAND_52G
 = 
BIT
(1),

264 
	mIWL_EEPROM_ENH_TXP_FL_OFDM
 = 
BIT
(2),

265 
	mIWL_EEPROM_ENH_TXP_FL_40MHZ
 = 
BIT
(3),

266 
	mIWL_EEPROM_ENH_TXP_FL_HT_AP
 = 
BIT
(4),

267 
	mIWL_EEPROM_ENH_TXP_FL_RES1
 = 
BIT
(5),

268 
	mIWL_EEPROM_ENH_TXP_FL_RES2
 = 
BIT
(6),

269 
	mIWL_EEPROM_ENH_TXP_FL_COMMON_TYPE
 = 
BIT
(7),

286 
	siwl_ì¥om_íh™˚d_txpwr
 {

287 
u8
 
	mÊags
;

288 
u8
 
	mch™√l
;

289 
s8
 
	mchaö_a_max
;

290 
s8
 
	mchaö_b_max
;

291 
s8
 
	mchaö_c_max
;

292 
u8
 
	mdñè_20_ö_40
;

293 
s8
 
	mmimo2_max
;

294 
s8
 
	mmimo3_max
;

295 } 
	g__∑cked
;

297 
s8
 
	$iwl_gë_max_txpwr_hÆf_dbm
(c⁄° 
iwl_nvm_d©a
 *
d©a
,

298 
iwl_ì¥om_íh™˚d_txpwr
 *
txp
)

300 
s8
 
ªsu…
 = 0;

303 i‡(
d©a
->
vÆid_tx_™t
 & 
ANT_A
 && 
txp
->
chaö_a_max
 > 
ªsu…
)

304 
ªsu…
 = 
txp
->
chaö_a_max
;

306 i‡(
d©a
->
vÆid_tx_™t
 & 
ANT_B
 && 
txp
->
chaö_b_max
 > 
ªsu…
)

307 
ªsu…
 = 
txp
->
chaö_b_max
;

309 i‡(
d©a
->
vÆid_tx_™t
 & 
ANT_C
 && 
txp
->
chaö_c_max
 > 
ªsu…
)

310 
ªsu…
 = 
txp
->
chaö_c_max
;

312 i‡((
d©a
->
vÆid_tx_™t
 =
ANT_AB
 ||

313 
d©a
->
vÆid_tx_™t
 =
ANT_BC
 ||

314 
d©a
->
vÆid_tx_™t
 =
ANT_AC
Ë&& 
txp
->
mimo2_max
 > 
ªsu…
)

315 
ªsu…
 = 
txp
->
mimo2_max
;

317 i‡(
d©a
->
vÆid_tx_™t
 =
ANT_ABC
 && 
txp
->
mimo3_max
 > 
ªsu…
)

318 
ªsu…
 = 
txp
->
mimo3_max
;

320  
ªsu…
;

321 
	}
}

323 
	#EEPROM_TXP_OFFS
 (0x00 | 
INDIRECT_ADDRESS
 | 
INDIRECT_TXP_LIMIT
)

	)

324 
	#EEPROM_TXP_ENTRY_LEN
 (
iwl_ì¥om_íh™˚d_txpwr
)

	)

325 
	#EEPROM_TXP_SZ_OFFS
 (0x00 | 
INDIRECT_ADDRESS
 | 
INDIRECT_TXP_LIMIT_SIZE
)

	)

327 
	#TXP_CHECK_AND_PRINT
(
x
) \

328 ((
txp
->
Êags
 & 
IWL_EEPROM_ENH_TXP_FL_
##
x
Ë? #x " " : "")

	)

331 
	$iwl_ì¥om_íh_txp_ªad_ñemít
(
iwl_nvm_d©a
 *
d©a
,

332 
iwl_ì¥om_íh™˚d_txpwr
 *
txp
,

333 
n_ch™√ls
, 
s8
 
max_txpowî_avg
)

335 
ch_idx
;

336 
∆80211_b™d
 
b™d
;

338 
b™d
 = 
txp
->
Êags
 & 
IWL_EEPROM_ENH_TXP_FL_BAND_52G
 ?

339 
NL80211_BAND_5GHZ
 : 
NL80211_BAND_2GHZ
;

341 
ch_idx
 = 0; ch_idx < 
n_ch™√ls
; ch_idx++) {

342 
õì80211_ch™√l
 *
ch™
 = &
d©a
->
ch™√ls
[
ch_idx
];

345 i‡(
txp
->
ch™√l
 !0 && 
ch™
->
hw_vÆue
 !=Åxp->channel)

349 i‡(
b™d
 !
ch™
->band)

352 i‡(
ch™
->
max_powî
 < 
max_txpowî_avg
 &&

353 !(
txp
->
Êags
 & 
IWL_EEPROM_ENH_TXP_FL_40MHZ
))

354 
ch™
->
max_powî
 = 
max_txpowî_avg
;

356 
	}
}

358 
	$iwl_ì¥om_íh™˚d_txpowî
(
devi˚
 *
dev
,

359 
iwl_nvm_d©a
 *
d©a
,

360 c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
,

361 
n_ch™√ls
)

363 
iwl_ì¥om_íh™˚d_txpwr
 *
txp_¨øy
, *
txp
;

364 
idx
, 
íåõs
;

365 
__À16
 *
txp_Àn
;

366 
s8
 
max_txp_avg_hÆfdbm
;

368 
	`BUILD_BUG_ON
((
iwl_ì¥om_íh™˚d_txpwr
) != 8);

371 
txp_Àn
 = (
__À16
 *)
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
,

372 
EEPROM_TXP_SZ_OFFS
);

373 
íåõs
 = 
	`À16_to_˝up
(
txp_Àn
Ë* 2 / 
EEPROM_TXP_ENTRY_LEN
;

375 
txp_¨øy
 = (*)
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
,

376 
EEPROM_TXP_OFFS
);

378 
idx
 = 0; idx < 
íåõs
; idx++) {

379 
txp
 = &
txp_¨øy
[
idx
];

381 i‡(!(
txp
->
Êags
 & 
IWL_EEPROM_ENH_TXP_FL_VALID
))

384 
	`IWL_DEBUG_EEPROM
(
dev
, "%s %d:\t %s%s%s%s%s%s%s%s (0x%02x)\n",

385 (
txp
->
ch™√l
 && (txp->
Êags
 &

386 
IWL_EEPROM_ENH_TXP_FL_COMMON_TYPE
)) ?

387 "Comm⁄ " : (
txp
->
ch™√l
) ?

389 (
txp
->
ch™√l
),

390 
	`TXP_CHECK_AND_PRINT
(
VALID
),

391 
	`TXP_CHECK_AND_PRINT
(
BAND_52G
),

392 
	`TXP_CHECK_AND_PRINT
(
OFDM
),

393 
	`TXP_CHECK_AND_PRINT
(40
MHZ
),

394 
	`TXP_CHECK_AND_PRINT
(
HT_AP
),

395 
	`TXP_CHECK_AND_PRINT
(
RES1
),

396 
	`TXP_CHECK_AND_PRINT
(
RES2
),

397 
	`TXP_CHECK_AND_PRINT
(
COMMON_TYPE
),

398 
txp
->
Êags
);

399 
	`IWL_DEBUG_EEPROM
(
dev
,

401 
txp
->
chaö_a_max
,Åxp->
chaö_b_max
,

402 
txp
->
chaö_c_max
);

403 
	`IWL_DEBUG_EEPROM
(
dev
,

405 
txp
->
mimo2_max
,Åxp->
mimo3_max
,

406 ((
txp
->
dñè_20_ö_40
 & 0xf0) >> 4),

407 (
txp
->
dñè_20_ö_40
 & 0x0f));

409 
max_txp_avg_hÆfdbm
 = 
	`iwl_gë_max_txpwr_hÆf_dbm
(
d©a
, 
txp
);

411 
	`iwl_ì¥om_íh_txp_ªad_ñemít
(
d©a
, 
txp
, 
n_ch™√ls
,

412 
	`DIV_ROUND_UP
(
max_txp_avg_hÆfdbm
, 2));

414 i‡(
max_txp_avg_hÆfdbm
 > 
d©a
->
max_tx_pwr_hÆf_dbm
)

415 
d©a
->
max_tx_pwr_hÆf_dbm
 = 
max_txp_avg_hÆfdbm
;

417 
	}
}

419 
	$iwl_öô_b™d_ª„ªn˚
(c⁄° 
iwl_cfg
 *
cfg
,

420 c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
,

421 
ì¥om_b™d
, *
ì¥om_ch_cou¡
,

422 c⁄° 
iwl_ì¥om_ch™√l
 **
ch_öfo
,

423 c⁄° 
u8
 **
ì¥om_ch_¨øy
)

425 
u32
 
off£t
 = 
cfg
->
ì¥om_∑øms
->
ªguœt‹y_b™ds
[
ì¥om_b™d
 - 1];

427 
off£t
 |
INDIRECT_ADDRESS
 | 
INDIRECT_REGULATORY
;

429 *
ch_öfo
 = (*)
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
, 
off£t
);

431 
ì¥om_b™d
) {

433 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_1
);

434 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_1
;

437 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_2
);

438 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_2
;

441 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_3
);

442 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_3
;

445 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_4
);

446 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_4
;

449 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_5
);

450 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_5
;

453 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_6
);

454 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_6
;

457 *
ì¥om_ch_cou¡
 = 
	`ARRAY_SIZE
(
iwl_ì¥om_b™d_7
);

458 *
ì¥om_ch_¨øy
 = 
iwl_ì¥om_b™d_7
;

461 *
ì¥om_ch_cou¡
 = 0;

462 *
ì¥om_ch_¨øy
 = 
NULL
;

463 
	`WARN_ON
(1);

465 
	}
}

467 
	#CHECK_AND_PRINT
(
x
) \

468 ((
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_
##
x
Ë? #x " " : "")

	)

470 
	$iwl_mod_ht40_ch™_öfo
(
devi˚
 *
dev
,

471 
iwl_nvm_d©a
 *
d©a
, 
n_ch™√ls
,

472 
∆80211_b™d
 
b™d
, 
u16
 
ch™√l
,

473 c⁄° 
iwl_ì¥om_ch™√l
 *
ì¥om_ch
,

474 
u8
 
˛ór_ht40_exãnsi⁄_ch™√l
)

476 
õì80211_ch™√l
 *
ch™
 = 
NULL
;

477 
i
;

479 
i
 = 0; i < 
n_ch™√ls
; i++) {

480 i‡(
d©a
->
ch™√ls
[
i
].
b™d
 != band)

482 i‡(
d©a
->
ch™√ls
[
i
].
hw_vÆue
 !
ch™√l
)

484 
ch™
 = &
d©a
->
ch™√ls
[
i
];

488 i‡(!
ch™
)

491 
	`IWL_DEBUG_EEPROM
(
dev
,

493 
ch™√l
,

494 
b™d
 =
NL80211_BAND_5GHZ
 ? "5.2" : "2.4",

495 
	`CHECK_AND_PRINT
(
IBSS
),

496 
	`CHECK_AND_PRINT
(
ACTIVE
),

497 
	`CHECK_AND_PRINT
(
RADAR
),

498 
	`CHECK_AND_PRINT
(
WIDE
),

499 
	`CHECK_AND_PRINT
(
DFS
),

500 
ì¥om_ch
->
Êags
,

501 
ì¥om_ch
->
max_powî_avg
,

502 ((
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_IBSS
) &&

503 !(
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_RADAR
)) ? ""

506 i‡(
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_VALID
)

507 
ch™
->
Êags
 &~
˛ór_ht40_exãnsi⁄_ch™√l
;

508 
	}
}

510 
	#CHECK_AND_PRINT_I
(
x
) \

511 ((
ì¥om_ch_öfo
[
ch_idx
].
Êags
 & 
EEPROM_CHANNEL_
##
x
Ë? #x " " : "")

	)

513 
	$iwl_öô_ch™√l_m≠
(
devi˚
 *
dev
, c⁄° 
iwl_cfg
 *
cfg
,

514 
iwl_nvm_d©a
 *
d©a
,

515 c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
)

517 
b™d
, 
ch_idx
;

518 c⁄° 
iwl_ì¥om_ch™√l
 *
ì¥om_ch_öfo
;

519 c⁄° 
u8
 *
ì¥om_ch_¨øy
;

520 
ì¥om_ch_cou¡
;

521 
n_ch™√ls
 = 0;

526 
b™d
 = 1; band <= 5; band++) {

527 
õì80211_ch™√l
 *
ch™√l
;

529 
	`iwl_öô_b™d_ª„ªn˚
(
cfg
, 
ì¥om
, 
ì¥om_size
, 
b™d
,

530 &
ì¥om_ch_cou¡
, &
ì¥om_ch_öfo
,

531 &
ì¥om_ch_¨øy
);

534 
ch_idx
 = 0; ch_idx < 
ì¥om_ch_cou¡
; ch_idx++) {

535 c⁄° 
iwl_ì¥om_ch™√l
 *
ì¥om_ch
;

537 
ì¥om_ch
 = &
ì¥om_ch_öfo
[
ch_idx
];

539 i‡(!(
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_VALID
)) {

540 
	`IWL_DEBUG_EEPROM
(
dev
,

542 
ì¥om_ch_¨øy
[
ch_idx
],

543 
ì¥om_ch_öfo
[
ch_idx
].
Êags
,

544 (
b™d
 != 1) ? "5.2" : "2.4");

548 
ch™√l
 = &
d©a
->
ch™√ls
[
n_ch™√ls
];

549 
n_ch™√ls
++;

551 
ch™√l
->
hw_vÆue
 = 
ì¥om_ch_¨øy
[
ch_idx
];

552 
ch™√l
->
b™d
 = (b™d =1Ë? 
NL80211_BAND_2GHZ


553 : 
NL80211_BAND_5GHZ
;

554 
ch™√l
->
˚¡î_‰eq
 =

555 
	`õì80211_ch™√l_to_‰equícy
(

556 
ch™√l
->
hw_vÆue
, ch™√l->
b™d
);

559 
ch™√l
->
Êags
 = 
IEEE80211_CHAN_NO_HT40
;

561 i‡(!(
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_IBSS
))

562 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_IR
;

564 i‡(!(
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_ACTIVE
))

565 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_IR
;

567 i‡(
ì¥om_ch
->
Êags
 & 
EEPROM_CHANNEL_RADAR
)

568 
ch™√l
->
Êags
 |
IEEE80211_CHAN_RADAR
;

571 
ch™√l
->
max_powî
 =

572 
ì¥om_ch_öfo
[
ch_idx
].
max_powî_avg
;

573 
	`IWL_DEBUG_EEPROM
(
dev
,

575 
ch™√l
->
hw_vÆue
,

576 (
b™d
 != 1) ? "5.2" : "2.4",

577 
	`CHECK_AND_PRINT_I
(
VALID
),

578 
	`CHECK_AND_PRINT_I
(
IBSS
),

579 
	`CHECK_AND_PRINT_I
(
ACTIVE
),

580 
	`CHECK_AND_PRINT_I
(
RADAR
),

581 
	`CHECK_AND_PRINT_I
(
WIDE
),

582 
	`CHECK_AND_PRINT_I
(
DFS
),

583 
ì¥om_ch_öfo
[
ch_idx
].
Êags
,

584 
ì¥om_ch_öfo
[
ch_idx
].
max_powî_avg
,

585 ((
ì¥om_ch_öfo
[
ch_idx
].
Êags
 &

586 
EEPROM_CHANNEL_IBSS
) &&

587 !(
ì¥om_ch_öfo
[
ch_idx
].
Êags
 &

588 
EEPROM_CHANNEL_RADAR
))

593 i‡(
cfg
->
ì¥om_∑øms
->
íh™˚d_txpowî
) {

600 
	`iwl_ì¥om_íh™˚d_txpowî
(
dev
, 
d©a
, 
ì¥om
, 
ì¥om_size
,

601 
n_ch™√ls
);

604 
i
;

606 
d©a
->
max_tx_pwr_hÆf_dbm
 = -128;

608 
i
 = 0; i < 
n_ch™√ls
; i++)

609 
d©a
->
max_tx_pwr_hÆf_dbm
 =

610 
	`max_t
(
s8
, 
d©a
->
max_tx_pwr_hÆf_dbm
,

611 
d©a
->
ch™√ls
[
i
].
max_powî
 * 2);

615 i‡(
cfg
->
ì¥om_∑øms
->
ªguœt‹y_b™ds
[5] ==

616 
EEPROM_REGULATORY_BAND_NO_HT40
 &&

617 
cfg
->
ì¥om_∑øms
->
ªguœt‹y_b™ds
[6] ==

618 
EEPROM_REGULATORY_BAND_NO_HT40
)

619  
n_ch™√ls
;

622 
b™d
 = 6; band <= 7; band++) {

623 
∆80211_b™d
 
õìb™d
;

625 
	`iwl_öô_b™d_ª„ªn˚
(
cfg
, 
ì¥om
, 
ì¥om_size
, 
b™d
,

626 &
ì¥om_ch_cou¡
, &
ì¥om_ch_öfo
,

627 &
ì¥om_ch_¨øy
);

630 
õìb™d
 = (
b™d
 =6Ë? 
NL80211_BAND_2GHZ


631 : 
NL80211_BAND_5GHZ
;

634 
ch_idx
 = 0; ch_idx < 
ì¥om_ch_cou¡
; ch_idx++) {

636 
	`iwl_mod_ht40_ch™_öfo
(
dev
, 
d©a
, 
n_ch™√ls
, 
õìb™d
,

637 
ì¥om_ch_¨øy
[
ch_idx
],

638 &
ì¥om_ch_öfo
[
ch_idx
],

639 
IEEE80211_CHAN_NO_HT40PLUS
);

642 
	`iwl_mod_ht40_ch™_öfo
(
dev
, 
d©a
, 
n_ch™√ls
, 
õìb™d
,

643 
ì¥om_ch_¨øy
[
ch_idx
] + 4,

644 &
ì¥om_ch_öfo
[
ch_idx
],

645 
IEEE80211_CHAN_NO_HT40MINUS
);

649  
n_ch™√ls
;

650 
	}
}

653 
	$iwl_öô_sb™d_ch™√ls
(
iwl_nvm_d©a
 *
d©a
,

654 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

655 
n_ch™√ls
, 
∆80211_b™d
 
b™d
)

657 
õì80211_ch™√l
 *
ch™
 = &
d©a
->
ch™√ls
[0];

658 
n
 = 0, 
idx
 = 0;

660 
idx
 < 
n_ch™√ls
 && 
ch™
->
b™d
 != band)

661 
ch™
 = &
d©a
->
ch™√ls
[++
idx
];

663 
sb™d
->
ch™√ls
 = &
d©a
->ch™√ls[
idx
];

665 
idx
 < 
n_ch™√ls
 && 
ch™
->
b™d
 == band) {

666 
ch™
 = &
d©a
->
ch™√ls
[++
idx
];

667 
n
++;

670 
sb™d
->
n_ch™√ls
 = 
n
;

672  
n
;

673 
	}
}

675 
	#MAX_BIT_RATE_40_MHZ
 150

	)

676 
	#MAX_BIT_RATE_20_MHZ
 72

	)

678 
	$iwl_öô_ht_hw_ˇ∑b
(
iwl_å™s
 *
å™s
,

679 
iwl_nvm_d©a
 *
d©a
,

680 
õì80211_°a_ht_ˇp
 *
ht_öfo
,

681 
∆80211_b™d
 
b™d
,

682 
u8
 
tx_chaös
, u8 
rx_chaös
)

684 c⁄° 
iwl_cfg
 *
cfg
 = 
å™s
->cfg;

685 
max_bô_øã
 = 0;

687 
tx_chaös
 = 
	`hweight8
(tx_chains);

688 i‡(
cfg
->
rx_wôh_siso_divîsôy
)

689 
rx_chaös
 = 1;

691 
rx_chaös
 = 
	`hweight8
(rx_chains);

693 i‡(!(
d©a
->
sku_ˇp_11n_íabÀ
) ||

694 (
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_DISABLE_HT_ALL
) ||

695 !
cfg
->
ht_∑øms
) {

696 
ht_öfo
->
ht_suµ‹ãd
 = 
Ál£
;

700 i‡(
d©a
->
sku_ˇp_mimo_dißbÀd
)

701 
rx_chaös
 = 1;

703 
ht_öfo
->
ht_suµ‹ãd
 = 
åue
;

704 
ht_öfo
->
ˇp
 = 
IEEE80211_HT_CAP_DSSSCCK40
;

706 i‡(
cfg
->
ht_∑øms
->
°bc
) {

707 
ht_öfo
->
ˇp
 |(1 << 
IEEE80211_HT_CAP_RX_STBC_SHIFT
);

709 i‡(
tx_chaös
 > 1)

710 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_TX_STBC
;

713 i‡(
cfg
->
ht_∑øms
->
ldpc
)

714 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_LDPC_CODING
;

716 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
 ||

717 
iwlwifi_mod_∑øms
.
amsdu_size
 >
IWL_AMSDU_8K
)

718 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_MAX_AMSDU
;

720 
ht_öfo
->
ampdu_Á˘‹
 = 
IEEE80211_HT_MAX_AMPDU_64K
;

721 
ht_öfo
->
ampdu_dísôy
 = 
IEEE80211_HT_MPDU_DENSITY_4
;

723 
ht_öfo
->
mcs
.
rx_mask
[0] = 0xFF;

724 
ht_öfo
->
mcs
.
rx_mask
[1] = 0x00;

725 
ht_öfo
->
mcs
.
rx_mask
[2] = 0x00;

727 i‡(
rx_chaös
 >= 2)

728 
ht_öfo
->
mcs
.
rx_mask
[1] = 0xFF;

729 i‡(
rx_chaös
 >= 3)

730 
ht_öfo
->
mcs
.
rx_mask
[2] = 0xFF;

732 i‡(
cfg
->
ht_∑øms
->
ht_gªífõld_suµ‹t
)

733 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_GRN_FLD
;

734 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_SGI_20
;

736 
max_bô_øã
 = 
MAX_BIT_RATE_20_MHZ
;

738 i‡(
cfg
->
ht_∑øms
->
ht40_b™ds
 & 
	`BIT
(
b™d
)) {

739 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

740 
ht_öfo
->
ˇp
 |
IEEE80211_HT_CAP_SGI_40
;

741 
max_bô_øã
 = 
MAX_BIT_RATE_40_MHZ
;

745 
max_bô_øã
 *
rx_chaös
;

746 
	`WARN_ON
(
max_bô_øã
 & ~
IEEE80211_HT_MCS_RX_HIGHEST_MASK
);

747 
ht_öfo
->
mcs
.
rx_highe°
 = 
	`˝u_to_À16
(
max_bô_øã
);

750 
ht_öfo
->
mcs
.
tx_∑øms
 = 
IEEE80211_HT_MCS_TX_DEFINED
;

751 i‡(
tx_chaös
 !
rx_chaös
) {

752 
ht_öfo
->
mcs
.
tx_∑øms
 |
IEEE80211_HT_MCS_TX_RX_DIFF
;

753 
ht_öfo
->
mcs
.
tx_∑øms
 |((
tx_chaös
 - 1) <<

754 
IEEE80211_HT_MCS_TX_MAX_STREAMS_SHIFT
);

756 
	}
}

758 #i‡
IS_ENABLED
(
CONFIG_IWLDVM
)

759 
	$iwl_öô_sb™ds
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

760 
iwl_nvm_d©a
 *
d©a
,

761 c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
)

763 
devi˚
 *
dev
 = 
å™s
->dev;

764 
n_ch™√ls
 = 
	`iwl_öô_ch™√l_m≠
(
dev
, 
cfg
, 
d©a
,

765 
ì¥om
, 
ì¥om_size
);

766 
n_u£d
 = 0;

767 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

769 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

770 
sb™d
->
b™d
 = 
NL80211_BAND_2GHZ
;

771 
sb™d
->
bôøãs
 = &
iwl_cfg80211_øãs
[
RATES_24_OFFS
];

772 
sb™d
->
n_bôøãs
 = 
N_RATES_24
;

773 
n_u£d
 +
	`iwl_öô_sb™d_ch™√ls
(
d©a
, 
sb™d
, 
n_ch™√ls
,

774 
NL80211_BAND_2GHZ
);

775 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
ht_ˇp
, 
NL80211_BAND_2GHZ
,

776 
d©a
->
vÆid_tx_™t
, d©a->
vÆid_rx_™t
);

778 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

779 
sb™d
->
b™d
 = 
NL80211_BAND_5GHZ
;

780 
sb™d
->
bôøãs
 = &
iwl_cfg80211_øãs
[
RATES_52_OFFS
];

781 
sb™d
->
n_bôøãs
 = 
N_RATES_52
;

782 
n_u£d
 +
	`iwl_öô_sb™d_ch™√ls
(
d©a
, 
sb™d
, 
n_ch™√ls
,

783 
NL80211_BAND_5GHZ
);

784 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
ht_ˇp
, 
NL80211_BAND_5GHZ
,

785 
d©a
->
vÆid_tx_™t
, d©a->
vÆid_rx_™t
);

787 i‡(
n_ch™√ls
 !
n_u£d
)

788 
	`IWL_ERR_DEV
(
dev
, "EEPROM: used only %d of %d channels\n",

789 
n_u£d
, 
n_ch™√ls
);

790 
	}
}

794 
iwl_nvm_d©a
 *

795 
	$iwl_∑r£_ì¥om_d©a
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

796 c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
)

798 
iwl_nvm_d©a
 *
d©a
;

799 
devi˚
 *
dev
 = 
å™s
->dev;

800 c⁄° *
tmp
;

801 
u16
 
ødio_cfg
, 
sku
;

803 i‡(
	`WARN_ON
(!
cfg
 || !cfg->
ì¥om_∑øms
))

804  
NULL
;

806 
d©a
 = 
	`kzÆloc
(
	`°ru˘_size
(d©a, 
ch™√ls
, 
IWL_NUM_CHANNELS
),

807 
GFP_KERNEL
);

808 i‡(!
d©a
)

809  
NULL
;

812 
tmp
 = 
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
, 
EEPROM_MAC_ADDRESS
);

813 i‡(!
tmp
)

814 
îr_‰ì
;

815 
	`mem˝y
(
d©a
->
hw_addr
, 
tmp
, 
ETH_ALEN
);

816 
d©a
->
n_hw_addrs
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

817 
EEPROM_NUM_MAC_ADDRESS
);

819 i‡(
	`iwl_ì¥om_ªad_ˇlib
(
ì¥om
, 
ì¥om_size
, 
d©a
))

820 
îr_‰ì
;

822 
tmp
 = 
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
, 
EEPROM_XTAL
);

823 i‡(!
tmp
)

824 
îr_‰ì
;

825 
	`mem˝y
(
d©a
->
xèl_ˇlib
, 
tmp
, (data->xtal_calib));

827 
tmp
 = 
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
,

828 
EEPROM_RAW_TEMPERATURE
);

829 i‡(!
tmp
)

830 
îr_‰ì
;

831 
d©a
->
øw_ãm≥øtuª
 = *(
__À16
 *)
tmp
;

833 
tmp
 = 
	`iwl_ì¥om_quîy_addr
(
ì¥om
, 
ì¥om_size
,

834 
EEPROM_KELVIN_TEMPERATURE
);

835 i‡(!
tmp
)

836 
îr_‰ì
;

837 
d©a
->
kñvö_ãm≥øtuª
 = *(
__À16
 *)
tmp
;

838 
d©a
->
kñvö_vﬁège
 = *((
__À16
 *)
tmp
 + 1);

840 
ødio_cfg
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

841 
EEPROM_RADIO_CONFIG
);

842 
d©a
->
ødio_cfg_dash
 = 
	`EEPROM_RF_CFG_DASH_MSK
(
ødio_cfg
);

843 
d©a
->
ødio_cfg_≤um
 = 
	`EEPROM_RF_CFG_PNUM_MSK
(
ødio_cfg
);

844 
d©a
->
ødio_cfg_°ï
 = 
	`EEPROM_RF_CFG_STEP_MSK
(
ødio_cfg
);

845 
d©a
->
ødio_cfg_ty≥
 = 
	`EEPROM_RF_CFG_TYPE_MSK
(
ødio_cfg
);

846 
d©a
->
vÆid_rx_™t
 = 
	`EEPROM_RF_CFG_RX_ANT_MSK
(
ødio_cfg
);

847 
d©a
->
vÆid_tx_™t
 = 
	`EEPROM_RF_CFG_TX_ANT_MSK
(
ødio_cfg
);

849 
sku
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

850 
EEPROM_SKU_CAP
);

851 
d©a
->
sku_ˇp_11n_íabÀ
 = 
sku
 & 
EEPROM_SKU_CAP_11N_ENABLE
;

852 
d©a
->
sku_ˇp_amt_íabÀ
 = 
sku
 & 
EEPROM_SKU_CAP_AMT_ENABLE
;

853 
d©a
->
sku_ˇp_b™d_24ghz_íabÀ
 = 
sku
 & 
EEPROM_SKU_CAP_BAND_24GHZ
;

854 
d©a
->
sku_ˇp_b™d_52ghz_íabÀ
 = 
sku
 & 
EEPROM_SKU_CAP_BAND_52GHZ
;

855 
d©a
->
sku_ˇp_ù™_íabÀ
 = 
sku
 & 
EEPROM_SKU_CAP_IPAN_ENABLE
;

856 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_DISABLE_HT_ALL
)

857 
d©a
->
sku_ˇp_11n_íabÀ
 = 
Ál£
;

859 
d©a
->
nvm_vîsi⁄
 = 
	`iwl_ì¥om_quîy16
(
ì¥om
, 
ì¥om_size
,

860 
EEPROM_VERSION
);

863 i‡(
cfg
->
vÆid_tx_™t
)

864 
d©a
->
vÆid_tx_™t
 = 
cfg
->valid_tx_ant;

865 i‡(
cfg
->
vÆid_rx_™t
)

866 
d©a
->
vÆid_rx_™t
 = 
cfg
->valid_rx_ant;

868 i‡(!
d©a
->
vÆid_tx_™t
 || !d©a->
vÆid_rx_™t
) {

869 
	`IWL_ERR_DEV
(
dev
, "invalidántennas (0x%x, 0x%x)\n",

870 
d©a
->
vÆid_tx_™t
, d©a->
vÆid_rx_™t
);

871 
îr_‰ì
;

874 
	`iwl_öô_sb™ds
(
å™s
, 
cfg
, 
d©a
, 
ì¥om
, 
ì¥om_size
);

876  
d©a
;

877 
îr_‰ì
:

878 
	`k‰ì
(
d©a
);

879  
NULL
;

880 
	}
}

881 
IWL_EXPORT_SYMBOL
(
iwl_∑r£_ì¥om_d©a
);

	@iwl-eeprom-parse.h

6 #i‚de‡
__iwl_ì¥om_∑r£_h__


7 
	#__iwl_ì¥om_∑r£_h__


	)

9 
	~<löux/ty≥s.h
>

10 
	~<löux/if_ëhî.h
>

11 
	~<√t/cfg80211.h
>

12 
	~"iwl-å™s.h
"

14 
	siwl_nvm_d©a
 {

15 
	mn_hw_addrs
;

16 
u8
 
	mhw_addr
[
ETH_ALEN
];

18 
u8
 
	mˇlib_vîsi⁄
;

19 
__À16
 
	mˇlib_vﬁège
;

21 
__À16
 
	møw_ãm≥øtuª
;

22 
__À16
 
	mkñvö_ãm≥øtuª
;

23 
__À16
 
	mkñvö_vﬁège
;

24 
__À16
 
	mxèl_ˇlib
[2];

26 
boﬁ
 
	msku_ˇp_b™d_24ghz_íabÀ
;

27 
boﬁ
 
	msku_ˇp_b™d_52ghz_íabÀ
;

28 
boﬁ
 
	msku_ˇp_11n_íabÀ
;

29 
boﬁ
 
	msku_ˇp_11ac_íabÀ
;

30 
boﬁ
 
	msku_ˇp_11ax_íabÀ
;

31 
boﬁ
 
	msku_ˇp_amt_íabÀ
;

32 
boﬁ
 
	msku_ˇp_ù™_íabÀ
;

33 
boﬁ
 
	msku_ˇp_mimo_dißbÀd
;

34 
boﬁ
 
	msku_ˇp_11be_íabÀ
;

36 
u16
 
	mødio_cfg_ty≥
;

37 
u8
 
	mødio_cfg_°ï
;

38 
u8
 
	mødio_cfg_dash
;

39 
u8
 
	mødio_cfg_≤um
;

40 
u8
 
	mvÆid_tx_™t
, 
	mvÆid_rx_™t
;

42 
u32
 
	mnvm_vîsi⁄
;

43 
s8
 
	mmax_tx_pwr_hÆf_dbm
;

45 
boﬁ
 
	mœr_íabÀd
;

46 
boﬁ
 
	mvht160_suµ‹ãd
;

47 
õì80211_suµ‹ãd_b™d
 
	mb™ds
[
NUM_NL80211_BANDS
];

53 
õì80211_sb™d_i·y≥_d©a
 
	mlow
[2];

54 
õì80211_sb™d_i·y≥_d©a
 
	mhigh
[2];

55 
õì80211_sb™d_i·y≥_d©a
 
	muhb
[2];

56 } 
	mi·d
;

58 
õì80211_ch™√l
 
	mch™√ls
[];

74 
iwl_nvm_d©a
 *

75 
iwl_∑r£_ì¥om_d©a
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

76 c⁄° 
u8
 *
ì¥om
, 
size_t
 
ì¥om_size
);

78 
iwl_öô_sb™d_ch™√ls
(
iwl_nvm_d©a
 *
d©a
,

79 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

80 
n_ch™√ls
, 
∆80211_b™d
 
b™d
);

82 
iwl_öô_ht_hw_ˇ∑b
(
iwl_å™s
 *
å™s
,

83 
iwl_nvm_d©a
 *
d©a
,

84 
õì80211_°a_ht_ˇp
 *
ht_öfo
,

85 
∆80211_b™d
 
b™d
,

86 
u8
 
tx_chaös
, u8 
rx_chaös
);

	@iwl-eeprom-read.c

5 
	~<löux/ty≥s.h
>

6 
	~<löux/¶ab.h
>

7 
	~<löux/exp‹t.h
>

9 
	~"iwl-drv.h
"

10 
	~"iwl-debug.h
"

11 
	~"iwl-ì¥om-ªad.h
"

12 
	~"iwl-io.h
"

13 
	~"iwl-¥ph.h
"

14 
	~"iwl-c§.h
"

24 
	#IWL_EEPROM_ACCESS_TIMEOUT
 5000

	)

32 
	#IWL_EEPROM_SEM_TIMEOUT
 10

	)

33 
	#IWL_EEPROM_SEM_RETRY_LIMIT
 1000

	)

36 
	$iwl_ì¥om_acquúe_£m≠h‹e
(
iwl_å™s
 *
å™s
)

38 
u16
 
cou¡
;

39 
ªt
;

41 
cou¡
 = 0; cou¡ < 
IWL_EEPROM_SEM_RETRY_LIMIT
; count++) {

43 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

44 
CSR_HW_IF_CONFIG_REG_BIT_EEPROM_OWN_SEM
);

47 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

48 
CSR_HW_IF_CONFIG_REG_BIT_EEPROM_OWN_SEM
,

49 
CSR_HW_IF_CONFIG_REG_BIT_EEPROM_OWN_SEM
,

50 
IWL_EEPROM_SEM_TIMEOUT
);

51 i‡(
ªt
 >= 0) {

52 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
,

54 
cou¡
+1);

55  
ªt
;

59  
ªt
;

60 
	}
}

62 
	$iwl_ì¥om_ªÀa£_£m≠h‹e
(
iwl_å™s
 *
å™s
)

64 
	`iwl_˛ór_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

65 
CSR_HW_IF_CONFIG_REG_BIT_EEPROM_OWN_SEM
);

66 
	}
}

68 
	$iwl_ì¥om_vîify_sig«tuª
(
iwl_å™s
 *
å™s
, 
boﬁ
 
nvm_is_Ÿp
)

70 
u32
 
gp
 = 
	`iwl_ªad32
(
å™s
, 
CSR_EEPROM_GP
Ë& 
CSR_EEPROM_GP_VALID_MSK
;

72 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "EEPROM sig«tuª=0x%08x\n", 
gp
);

74 
gp
) {

75 
CSR_EEPROM_GP_BAD_SIG_EEP_GOOD_SIG_OTP
:

76 i‡(!
nvm_is_Ÿp
) {

77 
	`IWL_ERR
(
å™s
, "EEPROM with bad signature: 0x%08x\n",

78 
gp
);

79  -
ENOENT
;

82 
CSR_EEPROM_GP_GOOD_SIG_EEP_LESS_THAN_4K
:

83 
CSR_EEPROM_GP_GOOD_SIG_EEP_MORE_THAN_4K
:

84 i‡(
nvm_is_Ÿp
) {

85 
	`IWL_ERR
(
å™s
, "OTP wôh bad sig«tuª: 0x%08x\n", 
gp
);

86  -
ENOENT
;

89 
CSR_EEPROM_GP_BAD_SIGNATURE_BOTH_EEP_AND_OTP
:

91 
	`IWL_ERR
(
å™s
,

93 
nvm_is_Ÿp
 ? "OTP" : "EEPROM", 
gp
);

94  -
ENOENT
;

96 
	}
}

104 
	$iwl_£t_Ÿp_ac˚ss_absﬁuã
(
iwl_å™s
 *
å™s
)

106 
	`iwl_ªad32
(
å™s
, 
CSR_OTP_GP_REG
);

108 
	`iwl_˛ór_bô
(
å™s
, 
CSR_OTP_GP_REG
,

109 
CSR_OTP_GP_REG_OTP_ACCESS_MODE
);

110 
	}
}

112 
	$iwl_nvm_is_Ÿp
(
iwl_å™s
 *
å™s
)

114 
u32
 
Ÿpgp
;

117 
å™s
->
hw_ªv
 & 
CSR_HW_REV_TYPE_MSK
) {

118 
CSR_HW_REV_TYPE_NONE
:

119 
	`IWL_ERR
(
å™s
, "Unknown hardwareÅype\n");

120  -
EIO
;

121 
CSR_HW_REV_TYPE_5300
:

122 
CSR_HW_REV_TYPE_5350
:

123 
CSR_HW_REV_TYPE_5100
:

124 
CSR_HW_REV_TYPE_5150
:

127 
Ÿpgp
 = 
	`iwl_ªad32
(
å™s
, 
CSR_OTP_GP_REG
);

128 i‡(
Ÿpgp
 & 
CSR_OTP_GP_REG_DEVICE_SELECT
)

132 
	}
}

134 
	$iwl_öô_Ÿp_ac˚ss
(
iwl_å™s
 *
å™s
)

136 
ªt
;

138 
ªt
 = 
	`iwl_föish_nic_öô
(
å™s
);

139 i‡(
ªt
)

140  
ªt
;

142 
	`iwl_£t_bôs_¥ph
(
å™s
, 
APMG_PS_CTRL_REG
,

143 
APMG_PS_CTRL_VAL_RESET_REQ
);

144 
	`udñay
(5);

145 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
APMG_PS_CTRL_REG
,

146 
APMG_PS_CTRL_VAL_RESET_REQ
);

152 i‡(
å™s
->
å™s_cfg
->
ba£_∑øms
->
shadow_øm_suµ‹t
)

153 
	`iwl_£t_bô
(
å™s
, 
CSR_DBG_LINK_PWR_MGMT_REG
,

154 
CSR_RESET_LINK_PWR_MGMT_DISABLED
);

157 
	}
}

159 
	$iwl_ªad_Ÿp_w‹d
(
iwl_å™s
 *
å™s
, 
u16
 
addr
,

160 
__À16
 *
ì¥om_d©a
)

162 
ªt
 = 0;

163 
u32
 
r
;

164 
u32
 
Ÿpgp
;

166 
	`iwl_wrôe32
(
å™s
, 
CSR_EEPROM_REG
,

167 
CSR_EEPROM_REG_MSK_ADDR
 & (
addr
 << 1));

168 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_EEPROM_REG
,

169 
CSR_EEPROM_REG_READ_VALID_MSK
,

170 
CSR_EEPROM_REG_READ_VALID_MSK
,

171 
IWL_EEPROM_ACCESS_TIMEOUT
);

172 i‡(
ªt
 < 0) {

173 
	`IWL_ERR
(
å™s
, "Timêouàªadög OTP[%d]\n", 
addr
);

174  
ªt
;

176 
r
 = 
	`iwl_ªad32
(
å™s
, 
CSR_EEPROM_REG
);

178 
Ÿpgp
 = 
	`iwl_ªad32
(
å™s
, 
CSR_OTP_GP_REG
);

179 i‡(
Ÿpgp
 & 
CSR_OTP_GP_REG_ECC_UNCORR_STATUS_MSK
) {

182 
	`iwl_£t_bô
(
å™s
, 
CSR_OTP_GP_REG
,

183 
CSR_OTP_GP_REG_ECC_UNCORR_STATUS_MSK
);

184 
	`IWL_ERR
(
å™s
, "Uncorrectable OTP ECCÉrror,ábort OTPÑead\n");

185  -
EINVAL
;

187 i‡(
Ÿpgp
 & 
CSR_OTP_GP_REG_ECC_CORR_STATUS_MSK
) {

190 
	`iwl_£t_bô
(
å™s
, 
CSR_OTP_GP_REG
,

191 
CSR_OTP_GP_REG_ECC_CORR_STATUS_MSK
);

192 
	`IWL_ERR
(
å™s
, "Correctable OTP ECCÉrror, continueÑead\n");

194 *
ì¥om_d©a
 = 
	`˝u_to_À16
(
r
 >> 16);

196 
	}
}

201 
boﬁ
 
	$iwl_is_Ÿp_em±y
(
iwl_å™s
 *
å™s
)

203 
u16
 
√xt_lök_addr
 = 0;

204 
__À16
 
lök_vÆue
;

205 
boﬁ
 
is_em±y
 = 
Ál£
;

208 i‡(!
	`iwl_ªad_Ÿp_w‹d
(
å™s
, 
√xt_lök_addr
, &
lök_vÆue
)) {

209 i‡(!
lök_vÆue
) {

210 
	`IWL_ERR
(
å™s
, "OTP isÉmpty\n");

211 
is_em±y
 = 
åue
;

214 
	`IWL_ERR
(
å™s
, "UnableÅoÑead first block of OTPÜist.\n");

215 
is_em±y
 = 
åue
;

218  
is_em±y
;

219 
	}
}

231 
	$iwl_föd_Ÿp_image
(
iwl_å™s
 *
å™s
,

232 
u16
 *
vÆidblockaddr
)

234 
u16
 
√xt_lök_addr
 = 0, 
vÆid_addr
;

235 
__À16
 
lök_vÆue
 = 0;

236 
u£dblocks
 = 0;

239 
	`iwl_£t_Ÿp_ac˚ss_absﬁuã
(
å™s
);

242 i‡(
	`iwl_is_Ÿp_em±y
(
å™s
))

243  -
EINVAL
;

254 
vÆid_addr
 = 
√xt_lök_addr
;

255 
√xt_lök_addr
 = 
	`À16_to_˝u
(
lök_vÆue
Ë* (
u16
);

256 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "OTP blocks %dáddr 0x%x\n",

257 
u£dblocks
, 
√xt_lök_addr
);

258 i‡(
	`iwl_ªad_Ÿp_w‹d
(
å™s
, 
√xt_lök_addr
, &
lök_vÆue
))

259  -
EINVAL
;

260 i‡(!
lök_vÆue
) {

266 *
vÆidblockaddr
 = 
vÆid_addr
;

268 *
vÆidblockaddr
 += 2;

272 
u£dblocks
++;

273 } 
u£dblocks
 <
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_Œ_ôems
);

276 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "OTP hasÇo valid blocks\n");

277  -
EINVAL
;

278 
	}
}

288 
	$iwl_ªad_ì¥om
(
iwl_å™s
 *
å™s
, 
u8
 **
ì¥om
, 
size_t
 *
ì¥om_size
)

290 
__À16
 *
e
;

291 
u32
 
gp
 = 
	`iwl_ªad32
(
å™s
, 
CSR_EEPROM_GP
);

292 
sz
;

293 
ªt
;

294 
u16
 
addr
;

295 
u16
 
vÆidblockaddr
 = 0;

296 
u16
 
ˇche_addr
 = 0;

297 
nvm_is_Ÿp
;

299 i‡(!
ì¥om
 || !
ì¥om_size
)

300  -
EINVAL
;

302 
nvm_is_Ÿp
 = 
	`iwl_nvm_is_Ÿp
(
å™s
);

303 i‡(
nvm_is_Ÿp
 < 0)

304  
nvm_is_Ÿp
;

306 
sz
 = 
å™s
->
å™s_cfg
->
ba£_∑øms
->
ì¥om_size
;

307 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "NVM sizê%d\n", 
sz
);

309 
e
 = 
	`kmÆloc
(
sz
, 
GFP_KERNEL
);

310 i‡(!
e
)

311  -
ENOMEM
;

313 
ªt
 = 
	`iwl_ì¥om_vîify_sig«tuª
(
å™s
, 
nvm_is_Ÿp
);

314 i‡(
ªt
 < 0) {

315 
	`IWL_ERR
(
å™s
, "EEPROMÇŸ found, EEPROM_GP=0x%08x\n", 
gp
);

316 
îr_‰ì
;

320 
ªt
 = 
	`iwl_ì¥om_acquúe_£m≠h‹e
(
å™s
);

321 i‡(
ªt
 < 0) {

322 
	`IWL_ERR
(
å™s
, "FailedÅoácquire EEPROM semaphore.\n");

323 
îr_‰ì
;

326 i‡(
nvm_is_Ÿp
) {

327 
ªt
 = 
	`iwl_öô_Ÿp_ac˚ss
(
å™s
);

328 i‡(
ªt
) {

329 
	`IWL_ERR
(
å™s
, "FailedÅo initialize OTPáccess.\n");

330 
îr_u∆ock
;

333 
	`iwl_wrôe32
(
å™s
, 
CSR_EEPROM_GP
,

334 
	`iwl_ªad32
(
å™s
, 
CSR_EEPROM_GP
) &

335 ~
CSR_EEPROM_GP_IF_OWNER_MSK
);

337 
	`iwl_£t_bô
(
å™s
, 
CSR_OTP_GP_REG
,

338 
CSR_OTP_GP_REG_ECC_CORR_STATUS_MSK
 |

339 
CSR_OTP_GP_REG_ECC_UNCORR_STATUS_MSK
);

341 i‡(!
å™s
->
å™s_cfg
->
ba£_∑øms
->
shadow_øm_suµ‹t
) {

342 
ªt
 = 
	`iwl_föd_Ÿp_image
(
å™s
, &
vÆidblockaddr
);

343 i‡(
ªt
)

344 
îr_u∆ock
;

346 
addr
 = 
vÆidblockaddr
;ádd∏< vÆidblockadd∏+ 
sz
;

347 
addr
 +(
u16
)) {

348 
__À16
 
ì¥om_d©a
;

350 
ªt
 = 
	`iwl_ªad_Ÿp_w‹d
(
å™s
, 
addr
, &
ì¥om_d©a
);

351 i‡(
ªt
)

352 
îr_u∆ock
;

353 
e
[
ˇche_addr
 / 2] = 
ì¥om_d©a
;

354 
ˇche_addr
 +(
u16
);

358 
addr
 = 0;ádd∏< 
sz
;ádd∏+(
u16
)) {

359 
u32
 
r
;

361 
	`iwl_wrôe32
(
å™s
, 
CSR_EEPROM_REG
,

362 
CSR_EEPROM_REG_MSK_ADDR
 & (
addr
 << 1));

364 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_EEPROM_REG
,

365 
CSR_EEPROM_REG_READ_VALID_MSK
,

366 
CSR_EEPROM_REG_READ_VALID_MSK
,

367 
IWL_EEPROM_ACCESS_TIMEOUT
);

368 i‡(
ªt
 < 0) {

369 
	`IWL_ERR
(
å™s
,

370 "Timêouàªadög EEPROM[%d]\n", 
addr
);

371 
îr_u∆ock
;

373 
r
 = 
	`iwl_ªad32
(
å™s
, 
CSR_EEPROM_REG
);

374 
e
[
addr
 / 2] = 
	`˝u_to_À16
(
r
 >> 16);

378 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "NVM Type: %s\n",

379 
nvm_is_Ÿp
 ? "OTP" : "EEPROM");

381 
	`iwl_ì¥om_ªÀa£_£m≠h‹e
(
å™s
);

383 *
ì¥om_size
 = 
sz
;

384 *
ì¥om
 = (
u8
 *)
e
;

387 
îr_u∆ock
:

388 
	`iwl_ì¥om_ªÀa£_£m≠h‹e
(
å™s
);

389 
îr_‰ì
:

390 
	`k‰ì
(
e
);

392  
ªt
;

393 
	}
}

394 
IWL_EXPORT_SYMBOL
(
iwl_ªad_ì¥om
);

	@iwl-eeprom-read.h

5 #i‚de‡
__iwl_ì¥om_h__


6 
	#__iwl_ì¥om_h__


	)

8 
	~"iwl-å™s.h
"

10 
iwl_ªad_ì¥om
(
iwl_å™s
 *
å™s
, 
u8
 **
ì¥om
, 
size_t
 *
ì¥om_size
);

	@iwl-fh.h

6 #i‚de‡
__iwl_fh_h__


7 
	#__iwl_fh_h__


	)

9 
	~<löux/ty≥s.h
>

10 
	~<löux/bôfõld.h
>

12 
	~"iwl-å™s.h
"

22 
	#FH_MEM_LOWER_BOUND
 (0x1000)

	)

23 
	#FH_MEM_UPPER_BOUND
 (0x2000)

	)

24 
	#FH_MEM_LOWER_BOUND_GEN2
 (0xa06000)

	)

25 
	#FH_MEM_UPPER_BOUND_GEN2
 (0xa08000)

	)

44 
	#FH_KW_MEM_ADDR_REG
 (
FH_MEM_LOWER_BOUND
 + 0x97C)

	)

61 
	#FH_MEM_CBBC_0_15_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0x9D0)

	)

62 
	#FH_MEM_CBBC_0_15_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xA10)

	)

63 
	#FH_MEM_CBBC_16_19_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xBF0)

	)

64 
	#FH_MEM_CBBC_16_19_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xC00)

	)

65 
	#FH_MEM_CBBC_20_31_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xB20)

	)

66 
	#FH_MEM_CBBC_20_31_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xB80)

	)

68 
	#TFH_TFDQ_CBB_TABLE
 (0x1C00)

	)

71 
ölöe
 
	$FH_MEM_CBBC_QUEUE
(
iwl_å™s
 *
å™s
,

72 
ch∆
)

74 i‡(
å™s
->
å™s_cfg
->
gí2
) {

75 
	`WARN_ON_ONCE
(
ch∆
 >= 64);

76  
TFH_TFDQ_CBB_TABLE
 + 8 * 
ch∆
;

78 i‡(
ch∆
 < 16)

79  
FH_MEM_CBBC_0_15_LOWER_BOUND
 + 4 * 
ch∆
;

80 i‡(
ch∆
 < 20)

81  
FH_MEM_CBBC_16_19_LOWER_BOUND
 + 4 * (
ch∆
 - 16);

82 
	`WARN_ON_ONCE
(
ch∆
 >= 32);

83  
FH_MEM_CBBC_20_31_LOWER_BOUND
 + 4 * (
ch∆
 - 20);

84 
	}
}

104 
	#TFH_TRANSFER_MODE
 (0x1F40)

	)

105 
	#TFH_TRANSFER_MAX_PENDING_REQ
 0xc

	)

106 
	#TFH_CHUNK_SIZE_128
 
	`BIT
(8)

	)

107 
	#TFH_CHUNK_SPLIT_MODE
 
	`BIT
(10)

	)

115 
	#TFH_TXCMD_UPDATE_CFG
 (0x1F48)

	)

129 
	#TFH_SRV_DMA_CHNL0_CTRL
 (0x1F60)

	)

130 
	#TFH_SRV_DMA_SNOOP
 
	`BIT
(0)

	)

131 
	#TFH_SRV_DMA_TO_DRIVER
 
	`BIT
(24)

	)

132 
	#TFH_SRV_DMA_START
 
	`BIT
(31)

	)

135 
	#TFH_SRV_DMA_CHNL0_SRAM_ADDR
 (0x1F64)

	)

138 
	#TFH_SRV_DMA_CHNL0_DRAM_ADDR
 (0x1F68)

	)

144 
	#TFH_SRV_DMA_CHNL0_BC
 (0x1F70)

	)

215 
	#FH_MEM_RSCSR_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xBC0)

	)

216 
	#FH_MEM_RSCSR_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xC00)

	)

217 
	#FH_MEM_RSCSR_CHNL0
 (
FH_MEM_RSCSR_LOWER_BOUND
)

	)

224 
	#FH_RSCSR_CHNL0_STTS_WPTR_REG
 (
FH_MEM_RSCSR_CHNL0
)

	)

231 
	#FH_RSCSR_CHNL0_RBDCB_BASE_REG
 (
FH_MEM_RSCSR_CHNL0
 + 0x004)

	)

239 
	#FH_RSCSR_CHNL0_RBDCB_WPTR_REG
 (
FH_MEM_RSCSR_CHNL0
 + 0x008)

	)

240 
	#FH_RSCSR_CHNL0_WPTR
 (
FH_RSCSR_CHNL0_RBDCB_WPTR_REG
)

	)

242 
	#FW_RSCSR_CHNL0_RXDCB_RDPTR_REG
 (
FH_MEM_RSCSR_CHNL0
 + 0x00c)

	)

243 
	#FH_RSCSR_CHNL0_RDPTR
 
FW_RSCSR_CHNL0_RXDCB_RDPTR_REG


	)

271 
	#FH_MEM_RCSR_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xC00)

	)

272 
	#FH_MEM_RCSR_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xCC0)

	)

273 
	#FH_MEM_RCSR_CHNL0
 (
FH_MEM_RCSR_LOWER_BOUND
)

	)

275 
	#FH_MEM_RCSR_CHNL0_CONFIG_REG
 (
FH_MEM_RCSR_CHNL0
)

	)

276 
	#FH_MEM_RCSR_CHNL0_RBDCB_WPTR
 (
FH_MEM_RCSR_CHNL0
 + 0x8)

	)

277 
	#FH_MEM_RCSR_CHNL0_FLUSH_RB_REQ
 (
FH_MEM_RCSR_CHNL0
 + 0x10)

	)

279 
	#FH_RCSR_CHNL0_RX_CONFIG_RB_TIMEOUT_MSK
 (0x00000FF0Ë

	)

280 
	#FH_RCSR_CHNL0_RX_CONFIG_IRQ_DEST_MSK
 (0x00001000Ë

	)

281 
	#FH_RCSR_CHNL0_RX_CONFIG_SINGLE_FRAME_MSK
 (0x00008000Ë

	)

282 
	#FH_RCSR_CHNL0_RX_CONFIG_RB_SIZE_MSK
 (0x00030000Ë

	)

283 
	#FH_RCSR_CHNL0_RX_CONFIG_RBDBC_SIZE_MSK
 (0x00F00000Ë

	)

284 
	#FH_RCSR_CHNL0_RX_CONFIG_DMA_CHNL_EN_MSK
 (0xC0000000Ë

	)

286 
	#FH_RCSR_RX_CONFIG_RBDCB_SIZE_POS
 (20)

	)

287 
	#FH_RCSR_RX_CONFIG_REG_IRQ_RBTH_POS
 (4)

	)

288 
	#RX_RB_TIMEOUT
 (0x11)

	)

290 
	#FH_RCSR_RX_CONFIG_CHNL_EN_PAUSE_VAL
 (0x00000000)

	)

291 
	#FH_RCSR_RX_CONFIG_CHNL_EN_PAUSE_EOF_VAL
 (0x40000000)

	)

292 
	#FH_RCSR_RX_CONFIG_CHNL_EN_ENABLE_VAL
 (0x80000000)

	)

294 
	#FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_4K
 (0x00000000)

	)

295 
	#FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_8K
 (0x00010000)

	)

296 
	#FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_12K
 (0x00020000)

	)

297 
	#FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_16K
 (0x00030000)

	)

299 
	#FH_RCSR_CHNL0_RX_IGNORE_RXF_EMPTY
 (0x00000004)

	)

300 
	#FH_RCSR_CHNL0_RX_CONFIG_IRQ_DEST_NO_INT_VAL
 (0x00000000)

	)

301 
	#FH_RCSR_CHNL0_RX_CONFIG_IRQ_DEST_INT_HOST_VAL
 (0x00001000)

	)

316 
	#FH_MEM_RSSR_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xC40)

	)

317 
	#FH_MEM_RSSR_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xD00)

	)

319 
	#FH_MEM_RSSR_SHARED_CTRL_REG
 (
FH_MEM_RSSR_LOWER_BOUND
)

	)

320 
	#FH_MEM_RSSR_RX_STATUS_REG
 (
FH_MEM_RSSR_LOWER_BOUND
 + 0x004)

	)

321 
	#FH_MEM_RSSR_RX_ENABLE_ERR_IRQ2DRV
\

322 (
FH_MEM_RSSR_LOWER_BOUND
 + 0x008)

	)

324 
	#FH_RSSR_CHNL0_RX_STATUS_CHNL_IDLE
 (0x01000000)

	)

326 
	#FH_MEM_TFDIB_REG1_ADDR_BITSHIFT
 28

	)

327 
	#FH_MEM_TB_MAX_LENGTH
 (0x00020000)

	)

331 
	#RFH_Q0_FRBDCB_BA_LSB
 0xA08000

	)

332 
	#RFH_Q_FRBDCB_BA_LSB
(
q
Ë(
RFH_Q0_FRBDCB_BA_LSB
 + (qË* 8)

	)

334 
	#RFH_Q0_FRBDCB_WIDX
 0xA08080

	)

335 
	#RFH_Q_FRBDCB_WIDX
(
q
Ë(
RFH_Q0_FRBDCB_WIDX
 + (qË* 4)

	)

337 
	#RFH_Q0_FRBDCB_WIDX_TRG
 0x1C80

	)

338 
	#RFH_Q_FRBDCB_WIDX_TRG
(
q
Ë(
RFH_Q0_FRBDCB_WIDX_TRG
 + (qË* 4)

	)

340 
	#RFH_Q0_FRBDCB_RIDX
 0xA080C0

	)

341 
	#RFH_Q_FRBDCB_RIDX
(
q
Ë(
RFH_Q0_FRBDCB_RIDX
 + (qË* 4)

	)

343 
	#RFH_Q0_URBDCB_BA_LSB
 0xA08100

	)

344 
	#RFH_Q_URBDCB_BA_LSB
(
q
Ë(
RFH_Q0_URBDCB_BA_LSB
 + (qË* 8)

	)

346 
	#RFH_Q0_URBDCB_WIDX
 0xA08180

	)

347 
	#RFH_Q_URBDCB_WIDX
(
q
Ë(
RFH_Q0_URBDCB_WIDX
 + (qË* 4)

	)

348 
	#RFH_Q0_URBDCB_VAID
 0xA081C0

	)

349 
	#RFH_Q_URBDCB_VAID
(
q
Ë(
RFH_Q0_URBDCB_VAID
 + (qË* 4)

	)

351 
	#RFH_Q0_URBD_STTS_WPTR_LSB
 0xA08200

	)

352 
	#RFH_Q_URBD_STTS_WPTR_LSB
(
q
Ë(
RFH_Q0_URBD_STTS_WPTR_LSB
 + (qË* 8)

	)

354 
	#RFH_Q0_ORB_WPTR_LSB
 0xA08280

	)

355 
	#RFH_Q_ORB_WPTR_LSB
(
q
Ë(
RFH_Q0_ORB_WPTR_LSB
 + (qË* 8)

	)

356 
	#RFH_RBDBUF_RBD0_LSB
 0xA08300

	)

357 
	#RFH_RBDBUF_RBD_LSB
(
q
Ë(
RFH_RBDBUF_RBD0_LSB
 + (qË* 8)

	)

380 
	#RFH_GEN_STATUS
 0xA09808

	)

381 
	#RFH_GEN_STATUS_GEN3
 0xA07824

	)

382 
	#RBD_FETCH_IDLE
 
	`BIT
(29)

	)

383 
	#SRAM_DMA_IDLE
 
	`BIT
(30)

	)

384 
	#RXF_DMA_IDLE
 
	`BIT
(31)

	)

387 
	#RFH_RXF_DMA_CFG
 0xA09820

	)

388 
	#RFH_RXF_DMA_CFG_GEN3
 0xA07880

	)

390 
	#RFH_RXF_DMA_RB_SIZE_MASK
 (0x000F0000Ë

	)

391 
	#RFH_RXF_DMA_RB_SIZE_POS
 16

	)

392 
	#RFH_RXF_DMA_RB_SIZE_1K
 (0x1 << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

393 
	#RFH_RXF_DMA_RB_SIZE_2K
 (0x2 << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

394 
	#RFH_RXF_DMA_RB_SIZE_4K
 (0x4 << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

395 
	#RFH_RXF_DMA_RB_SIZE_8K
 (0x8 << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

396 
	#RFH_RXF_DMA_RB_SIZE_12K
 (0x9 << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

397 
	#RFH_RXF_DMA_RB_SIZE_16K
 (0xA << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

398 
	#RFH_RXF_DMA_RB_SIZE_20K
 (0xB << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

399 
	#RFH_RXF_DMA_RB_SIZE_24K
 (0xC << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

400 
	#RFH_RXF_DMA_RB_SIZE_28K
 (0xD << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

401 
	#RFH_RXF_DMA_RB_SIZE_32K
 (0xE << 
RFH_RXF_DMA_RB_SIZE_POS
)

	)

403 
	#RFH_RXF_DMA_RBDCB_SIZE_MASK
 (0x00F00000Ë

	)

404 
	#RFH_RXF_DMA_RBDCB_SIZE_POS
 20

	)

405 
	#RFH_RXF_DMA_RBDCB_SIZE_8
 (0x3 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

406 
	#RFH_RXF_DMA_RBDCB_SIZE_16
 (0x4 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

407 
	#RFH_RXF_DMA_RBDCB_SIZE_32
 (0x5 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

408 
	#RFH_RXF_DMA_RBDCB_SIZE_64
 (0x7 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

409 
	#RFH_RXF_DMA_RBDCB_SIZE_128
 (0x7 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

410 
	#RFH_RXF_DMA_RBDCB_SIZE_256
 (0x8 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

411 
	#RFH_RXF_DMA_RBDCB_SIZE_512
 (0x9 << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

412 
	#RFH_RXF_DMA_RBDCB_SIZE_1024
 (0xA << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

413 
	#RFH_RXF_DMA_RBDCB_SIZE_2048
 (0xB << 
RFH_RXF_DMA_RBDCB_SIZE_POS
)

	)

414 
	#RFH_RXF_DMA_MIN_RB_SIZE_MASK
 (0x03000000Ë

	)

415 
	#RFH_RXF_DMA_MIN_RB_SIZE_POS
 24

	)

416 
	#RFH_RXF_DMA_MIN_RB_4_8
 (3 << 
RFH_RXF_DMA_MIN_RB_SIZE_POS
)

	)

417 
	#RFH_RXF_DMA_DROP_TOO_LARGE_MASK
 (0x04000000Ë

	)

418 
	#RFH_RXF_DMA_SINGLE_FRAME_MASK
 (0x20000000Ë

	)

419 
	#RFH_DMA_EN_MASK
 (0xC0000000Ë

	)

420 
	#RFH_DMA_EN_ENABLE_VAL
 
	`BIT
(31)

	)

422 
	#RFH_RXF_RXQ_ACTIVE
 0xA0980C

	)

424 
	#RFH_GEN_CFG
 0xA09800

	)

425 
	#RFH_GEN_CFG_SERVICE_DMA_SNOOP
 
	`BIT
(0)

	)

426 
	#RFH_GEN_CFG_RFH_DMA_SNOOP
 
	`BIT
(1)

	)

427 
	#RFH_GEN_CFG_RB_CHUNK_SIZE
 
	`BIT
(4)

	)

428 
	#RFH_GEN_CFG_RB_CHUNK_SIZE_128
 1

	)

429 
	#RFH_GEN_CFG_RB_CHUNK_SIZE_64
 0

	)

431 
	#RFH_GEN_CFG_DEFAULT_RXQ_NUM
 0xF00

	)

432 
	#RFH_GEN_CFG_VAL
(
_n
, 
_v
Ë
	`FIELD_PREP
(
RFH_GEN_CFG_
 ## _n, _v)

	)

437 
	#FH_MEM_TFDIB_DRAM_ADDR_LSB_MSK
 (0xFFFFFFFF)

	)

438 
	#FH_TFDIB_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0x900)

	)

439 
	#FH_TFDIB_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0x958)

	)

440 
	#FH_TFDIB_CTRL0_REG
(
_ch∆
Ë(
FH_TFDIB_LOWER_BOUND
 + 0x8 * (_ch∆))

	)

441 
	#FH_TFDIB_CTRL1_REG
(
_ch∆
Ë(
FH_TFDIB_LOWER_BOUND
 + 0x8 * (_ch∆Ë+ 0x4)

	)

465 
	#FH_TCSR_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xD00)

	)

466 
	#FH_TCSR_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xE60)

	)

469 
	#FH_TCSR_CHNL_NUM
 (8)

	)

472 
	#FH_TCSR_CHNL_TX_CONFIG_REG
(
_ch∆
) \

473 (
FH_TCSR_LOWER_BOUND
 + 0x20 * (
_ch∆
))

	)

474 
	#FH_TCSR_CHNL_TX_CREDIT_REG
(
_ch∆
) \

475 (
FH_TCSR_LOWER_BOUND
 + 0x20 * (
_ch∆
Ë+ 0x4)

	)

476 
	#FH_TCSR_CHNL_TX_BUF_STS_REG
(
_ch∆
) \

477 (
FH_TCSR_LOWER_BOUND
 + 0x20 * (
_ch∆
Ë+ 0x8)

	)

479 
	#FH_TCSR_TX_CONFIG_REG_VAL_MSG_MODE_TXF
 (0x00000000)

	)

480 
	#FH_TCSR_TX_CONFIG_REG_VAL_MSG_MODE_DRV
 (0x00000001)

	)

482 
	#FH_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_DISABLE
 (0x00000000)

	)

483 
	#FH_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_ENABLE
 (0x00000008)

	)

485 
	#FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_HOST_NOINT
 (0x00000000)

	)

486 
	#FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_HOST_ENDTFD
 (0x00100000)

	)

487 
	#FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_HOST_IFTFD
 (0x00200000)

	)

489 
	#FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_RTC_NOINT
 (0x00000000)

	)

490 
	#FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_RTC_ENDTFD
 (0x00400000)

	)

491 
	#FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_RTC_IFTFD
 (0x00800000)

	)

493 
	#FH_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_PAUSE
 (0x00000000)

	)

494 
	#FH_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_PAUSE_EOF
 (0x40000000)

	)

495 
	#FH_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_ENABLE
 (0x80000000)

	)

497 
	#FH_TCSR_CHNL_TX_BUF_STS_REG_VAL_TFDB_EMPTY
 (0x00000000)

	)

498 
	#FH_TCSR_CHNL_TX_BUF_STS_REG_VAL_TFDB_WAIT
 (0x00002000)

	)

499 
	#FH_TCSR_CHNL_TX_BUF_STS_REG_VAL_TFDB_VALID
 (0x00000003)

	)

501 
	#FH_TCSR_CHNL_TX_BUF_STS_REG_POS_TB_NUM
 (20)

	)

502 
	#FH_TCSR_CHNL_TX_BUF_STS_REG_POS_TB_IDX
 (12)

	)

516 
	#FH_TSSR_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xEA0)

	)

517 
	#FH_TSSR_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0xEC0)

	)

519 
	#FH_TSSR_TX_STATUS_REG
 (
FH_TSSR_LOWER_BOUND
 + 0x010)

	)

538 
	#FH_TSSR_TX_ERROR_REG
 (
FH_TSSR_LOWER_BOUND
 + 0x018)

	)

539 
	#FH_TSSR_TX_MSG_CONFIG_REG
 (
FH_TSSR_LOWER_BOUND
 + 0x008)

	)

541 
	#FH_TSSR_TX_STATUS_REG_MSK_CHNL_IDLE
(
_ch∆
Ë((1 << (_ch∆)Ë<< 16)

	)

544 
	#FH_SRVC_CHNL
 (9)

	)

545 
	#FH_SRVC_LOWER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0x9C8)

	)

546 
	#FH_SRVC_UPPER_BOUND
 (
FH_MEM_LOWER_BOUND
 + 0x9D0)

	)

547 
	#FH_SRVC_CHNL_SRAM_ADDR_REG
(
_ch∆
) \

548 (
FH_SRVC_LOWER_BOUND
 + ((
_ch∆
Ë- 9Ë* 0x4)

	)

550 
	#FH_TX_CHICKEN_BITS_REG
 (
FH_MEM_LOWER_BOUND
 + 0xE98)

	)

551 
	#FH_TX_TRB_REG
(
_ch™
Ë(
FH_MEM_LOWER_BOUND
 + 0x958 + (_ch™Ë* 4)

	)

556 
	#FH_TX_CHICKEN_BITS_SCD_AUTO_RETRY_EN
 (0x00000002)

	)

558 
	#RX_POOL_SIZE
(
rbds
) ((rbds) - 1 + \

559 
IWL_MAX_RX_HW_QUEUES
 * \

560 (
RX_CLAIM_REQ_ALLOC
 - 
RX_POST_REQ_ALLOC
))

	)

562 
	#RX_QUEUE_CB_SIZE
(
x
Ë
	`ûog2
(x)

	)

564 
	#RX_QUEUE_SIZE
 256

	)

565 
	#RX_QUEUE_MASK
 255

	)

566 
	#RX_QUEUE_SIZE_LOG
 8

	)

568 
	#IWL_DEFAULT_RX_QUEUE
 0

	)

581 
	siwl_rb_°©us
 {

582 
__À16
 
	m˛o£d_rb_num
;

583 
__À16
 
	m˛o£d_‰_num
;

584 
__À16
 
	mföished_rb_num
;

585 
__À16
 
	mföished_‰_num
;

586 
__À32
 
	m__•¨e
;

587 } 
	g__∑cked
;

590 
	#TFD_QUEUE_SIZE_MAX
 (256)

	)

591 
	#TFD_QUEUE_SIZE_MAX_GEN3
 (65536)

	)

593 
	#TFD_QUEUE_CB_SIZE
(
x
Ë(
	`ûog2
(xË- 3)

	)

594 
	#TFD_QUEUE_SIZE_BC_DUP
 (64)

	)

595 
	#TFD_QUEUE_BC_SIZE
 (
TFD_QUEUE_SIZE_MAX
 + 
TFD_QUEUE_SIZE_BC_DUP
)

	)

596 
	#TFD_QUEUE_BC_SIZE_GEN3_AX210
 1024

	)

597 
	#TFD_QUEUE_BC_SIZE_GEN3_BZ
 (1024 * 4)

	)

598 
	#IWL_TX_DMA_MASK
 
	`DMA_BIT_MASK
(36)

	)

599 
	#IWL_NUM_OF_TBS
 20

	)

600 
	#IWL_TFH_NUM_TBS
 25

	)

603 
	#IMR_TFH_SRV_DMA_CHNL0_CTRL
 0x00a0a51c

	)

604 
	#IMR_TFH_SRV_DMA_CHNL0_SRAM_ADDR
 0x00a0a520

	)

605 
	#IMR_TFH_SRV_DMA_CHNL0_DRAM_ADDR_LSB
 0x00a0a524

	)

606 
	#IMR_TFH_SRV_DMA_CHNL0_DRAM_ADDR_MSB
 0x00a0a528

	)

607 
	#IMR_TFH_SRV_DMA_CHNL0_BC
 0x00a0a52c

	)

608 
	#TFH_SRV_DMA_CHNL0_LEFT_BC
 0x00a0a530

	)

611 
	#IMR_RFH_GEN_CFG_SERVICE_DMA_RS_MSK
 0x0000000c

	)

612 
	#IMR_RFH_GEN_CFG_SERVICE_DMA_SNOOP_MSK
 0x00000002

	)

615 
	#IMR_UREG_CHICK_HALT_UMAC_PERMANENTLY_MSK
 0x80000000

	)

616 
	#IMR_UREG_CHICK
 0x00d05c00

	)

617 
	#IMR_TFH_SRV_DMA_CHNL0_CTRL_D2S_IRQ_TARGET_POS
 0x00800000

	)

618 
	#IMR_TFH_SRV_DMA_CHNL0_CTRL_D2S_RS_MSK
 0x00000030

	)

619 
	#IMR_TFH_SRV_DMA_CHNL0_CTRL_D2S_DMA_EN_POS
 0x80000000

	)

621 
ölöe
 
u8
 
	$iwl_gë_dma_hi_addr
(
dma_addr_t
 
addr
)

623  ((
addr
Ë> (
u32
Ë? 
	`uµî_32_bôs
(addr) : 0) & 0xF;

624 
	}
}

631 
	eiwl_tfd_tb_hi_n_Àn
 {

632 
	mTB_HI_N_LEN_ADDR_HI_MSK
 = 0xf,

633 
	mTB_HI_N_LEN_LEN_MSK
 = 0xfff0,

645 
	siwl_tfd_tb
 {

646 
__À32
 
	mlo
;

647 
__À16
 
	mhi_n_Àn
;

648 } 
	g__∑cked
;

658 
	siwl_tfh_tb
 {

659 
__À16
 
	mtb_Àn
;

660 
__À64
 
	maddr
;

661 } 
	g__∑cked
;

693 
	siwl_tfd
 {

694 
u8
 
	m__ª£rved1
[3];

695 
u8
 
	mnum_tbs
;

696 
iwl_tfd_tb
 
	mtbs
[
IWL_NUM_OF_TBS
];

697 
__À32
 
	m__∑d
;

698 } 
	g__∑cked
;

708 
	siwl_tfh_tfd
 {

709 
__À16
 
	mnum_tbs
;

710 
iwl_tfh_tb
 
	mtbs
[
IWL_TFH_NUM_TBS
];

711 
__À32
 
	m__∑d
;

712 } 
	g__∑cked
;

715 
	#IWL_KW_SIZE
 0x1000

	)

732 
	siwœgn_scd_bc_tbl
 {

733 
__À16
 
	mtfd_off£t
[
TFD_QUEUE_BC_SIZE
];

734 } 
	g__∑cked
;

743 
	siwl_gí3_bc_tbl_íåy
 {

744 
__À16
 
	mtfd_off£t
;

745 } 
	g__∑cked
;

	@iwl-io.c

6 
	~<löux/dñay.h
>

7 
	~<löux/devi˚.h
>

8 
	~<löux/exp‹t.h
>

10 
	~"iwl-drv.h
"

11 
	~"iwl-io.h
"

12 
	~"iwl-c§.h
"

13 
	~"iwl-debug.h
"

14 
	~"iwl-¥ph.h
"

15 
	~"iwl-fh.h
"

17 
	$iwl_wrôe8
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, 
u8
 
vÆ
)

19 
	`åa˚_iwlwifi_dev_iowrôe8
(
å™s
->
dev
, 
ofs
, 
vÆ
);

20 
	`iwl_å™s_wrôe8
(
å™s
, 
ofs
, 
vÆ
);

21 
	}
}

22 
IWL_EXPORT_SYMBOL
(
iwl_wrôe8
);

24 
	$iwl_wrôe32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
)

26 
	`åa˚_iwlwifi_dev_iowrôe32
(
å™s
->
dev
, 
ofs
, 
vÆ
);

27 
	`iwl_å™s_wrôe32
(
å™s
, 
ofs
, 
vÆ
);

28 
	}
}

29 
IWL_EXPORT_SYMBOL
(
iwl_wrôe32
);

31 
	$iwl_wrôe64
(
iwl_å™s
 *
å™s
, 
u64
 
ofs
, u64 
vÆ
)

33 
	`åa˚_iwlwifi_dev_iowrôe64
(
å™s
->
dev
, 
ofs
, 
vÆ
);

34 
	`iwl_å™s_wrôe32
(
å™s
, 
ofs
, 
	`lowî_32_bôs
(
vÆ
));

35 
	`iwl_å™s_wrôe32
(
å™s
, 
ofs
 + 4, 
	`uµî_32_bôs
(
vÆ
));

36 
	}
}

37 
IWL_EXPORT_SYMBOL
(
iwl_wrôe64
);

39 
u32
 
	$iwl_ªad32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

41 
u32
 
vÆ
 = 
	`iwl_å™s_ªad32
(
å™s
, 
ofs
);

43 
	`åa˚_iwlwifi_dev_i‹ód32
(
å™s
->
dev
, 
ofs
, 
vÆ
);

44  
vÆ
;

45 
	}
}

46 
IWL_EXPORT_SYMBOL
(
iwl_ªad32
);

48 
	#IWL_POLL_INTERVAL
 10

	)

50 
	$iwl_pﬁl_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

51 
u32
 
bôs
, u32 
mask
, 
timeout
)

53 
t
 = 0;

56 i‡((
	`iwl_ªad32
(
å™s
, 
addr
Ë& 
mask
Ë=(
bôs
 & mask))

57  
t
;

58 
	`udñay
(
IWL_POLL_INTERVAL
);

59 
t
 +
IWL_POLL_INTERVAL
;

60 } 
t
 < 
timeout
);

62  -
ETIMEDOUT
;

63 
	}
}

64 
IWL_EXPORT_SYMBOL
(
iwl_pﬁl_bô
);

66 
u32
 
	$iwl_ªad_dúe˘32
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
)

68 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

69 
u32
 
vÆue
 = 
	`iwl_ªad32
(
å™s
, 
ªg
);

71 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

72  
vÆue
;

77 
	}
}

78 
IWL_EXPORT_SYMBOL
(
iwl_ªad_dúe˘32
);

80 
	$iwl_wrôe_dúe˘32
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
, u32 
vÆue
)

82 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

83 
	`iwl_wrôe32
(
å™s
, 
ªg
, 
vÆue
);

84 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

86 
	}
}

87 
IWL_EXPORT_SYMBOL
(
iwl_wrôe_dúe˘32
);

89 
	$iwl_wrôe_dúe˘64
(
iwl_å™s
 *
å™s
, 
u64
 
ªg
, u64 
vÆue
)

91 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

92 
	`iwl_wrôe64
(
å™s
, 
ªg
, 
vÆue
);

93 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

95 
	}
}

96 
IWL_EXPORT_SYMBOL
(
iwl_wrôe_dúe˘64
);

98 
	$iwl_pﬁl_dúe˘_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
, u32 
mask
,

99 
timeout
)

101 
t
 = 0;

104 i‡((
	`iwl_ªad_dúe˘32
(
å™s
, 
addr
Ë& 
mask
) == mask)

105  
t
;

106 
	`udñay
(
IWL_POLL_INTERVAL
);

107 
t
 +
IWL_POLL_INTERVAL
;

108 } 
t
 < 
timeout
);

110  -
ETIMEDOUT
;

111 
	}
}

112 
IWL_EXPORT_SYMBOL
(
iwl_pﬁl_dúe˘_bô
);

114 
u32
 
	$iwl_ªad_¥ph_no_gøb
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

116 
u32
 
vÆ
 = 
	`iwl_å™s_ªad_¥ph
(
å™s
, 
ofs
);

117 
	`åa˚_iwlwifi_dev_i‹ód_¥ph32
(
å™s
->
dev
, 
ofs
, 
vÆ
);

118  
vÆ
;

119 
	}
}

120 
IWL_EXPORT_SYMBOL
(
iwl_ªad_¥ph_no_gøb
);

122 
	$iwl_wrôe_¥ph_no_gøb
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
)

124 
	`åa˚_iwlwifi_dev_iowrôe_¥ph32
(
å™s
->
dev
, 
ofs
, 
vÆ
);

125 
	`iwl_å™s_wrôe_¥ph
(
å™s
, 
ofs
, 
vÆ
);

126 
	}
}

127 
IWL_EXPORT_SYMBOL
(
iwl_wrôe_¥ph_no_gøb
);

129 
	$iwl_wrôe_¥ph64_no_gøb
(
iwl_å™s
 *
å™s
, 
u64
 
ofs
, u64 
vÆ
)

131 
	`åa˚_iwlwifi_dev_iowrôe_¥ph64
(
å™s
->
dev
, 
ofs
, 
vÆ
);

132 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
, 
vÆ
 & 0xffffffff);

133 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
 + 4, 
vÆ
 >> 32);

134 
	}
}

135 
IWL_EXPORT_SYMBOL
(
iwl_wrôe_¥ph64_no_gøb
);

137 
u32
 
	$iwl_ªad_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

139 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

140 
u32
 
vÆ
 = 
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
ofs
);

142 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

144  
vÆ
;

149 
	}
}

150 
IWL_EXPORT_SYMBOL
(
iwl_ªad_¥ph
);

152 
	$iwl_wrôe_¥ph_dñay
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
, u32 
dñay_ms
)

154 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

155 
	`mdñay
(
dñay_ms
);

156 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
, 
vÆ
);

157 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

159 
	}
}

160 
IWL_EXPORT_SYMBOL
(
iwl_wrôe_¥ph_dñay
);

162 
	$iwl_pﬁl_¥ph_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

163 
u32
 
bôs
, u32 
mask
, 
timeout
)

165 
t
 = 0;

168 i‡((
	`iwl_ªad_¥ph
(
å™s
, 
addr
Ë& 
mask
Ë=(
bôs
 & mask))

169  
t
;

170 
	`udñay
(
IWL_POLL_INTERVAL
);

171 
t
 +
IWL_POLL_INTERVAL
;

172 } 
t
 < 
timeout
);

174  -
ETIMEDOUT
;

175 
	}
}

177 
	$iwl_£t_bôs_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
mask
)

179 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

180 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
,

181 
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
ofs
) |

182 
mask
);

183 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

185 
	}
}

186 
IWL_EXPORT_SYMBOL
(
iwl_£t_bôs_¥ph
);

188 
	$iwl_£t_bôs_mask_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

189 
u32
 
bôs
, u32 
mask
)

191 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

192 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
,

193 (
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
ofs
) &

194 
mask
Ë| 
bôs
);

195 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

197 
	}
}

198 
IWL_EXPORT_SYMBOL
(
iwl_£t_bôs_mask_¥ph
);

200 
	$iwl_˛ór_bôs_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
mask
)

202 
u32
 
vÆ
;

204 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

205 
vÆ
 = 
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
ofs
);

206 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
, (
vÆ
 & ~
mask
));

207 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

209 
	}
}

210 
IWL_EXPORT_SYMBOL
(
iwl_˛ór_bôs_¥ph
);

212 
	$iwl_f‹˚_nmi
(
iwl_å™s
 *
å™s
)

214 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_9000
)

215 
	`iwl_wrôe_¥ph_dñay
(
å™s
, 
DEVICE_SET_NMI_REG
,

216 
DEVICE_SET_NMI_VAL_DRV
, 1);

217 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

218 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_NIC_SET_NMI_DRIVER
,

219 
UREG_NIC_SET_NMI_DRIVER_NMI_FROM_DRIVER
);

220 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_BZ
)

221 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_DOORBELL_TO_ISR6
,

222 
UREG_DOORBELL_TO_ISR6_NMI_BIT
);

224 
	`iwl_wrôe32
(
å™s
, 
CSR_DOORBELL_VECTOR
,

225 
UREG_DOORBELL_TO_ISR6_NMI_BIT
);

226 
	}
}

227 
IWL_EXPORT_SYMBOL
(
iwl_f‹˚_nmi
);

229 c⁄° *
	$gë_rfh_°rög
(
cmd
)

231 
	#IWL_CMD
(
x
Ëx:  #x

	)

232 
	#IWL_CMD_MQ
(
¨g
, 
ªg
, 
q
Ë{ i‡◊rg =
	`ªg
(q)Ë #ªg; }

	)

234 
i
;

236 
i
 = 0; i < 
IWL_MAX_RX_HW_QUEUES
; i++) {

237 
	`IWL_CMD_MQ
(
cmd
, 
RFH_Q_FRBDCB_BA_LSB
, 
i
);

238 
	`IWL_CMD_MQ
(
cmd
, 
RFH_Q_FRBDCB_WIDX
, 
i
);

239 
	`IWL_CMD_MQ
(
cmd
, 
RFH_Q_FRBDCB_RIDX
, 
i
);

240 
	`IWL_CMD_MQ
(
cmd
, 
RFH_Q_URBD_STTS_WPTR_LSB
, 
i
);

243 
cmd
) {

244 
	`IWL_CMD
(
RFH_RXF_DMA_CFG
);

245 
	`IWL_CMD
(
RFH_GEN_CFG
);

246 
	`IWL_CMD
(
RFH_GEN_STATUS
);

247 
	`IWL_CMD
(
FH_TSSR_TX_STATUS_REG
);

248 
	`IWL_CMD
(
FH_TSSR_TX_ERROR_REG
);

252 #unde‡
IWL_CMD_MQ


253 
	}
}

255 
	sªg
 {

256 
u32
 
	maddr
;

257 
boﬁ
 
	mis64
;

260 
	$iwl_dump_rfh
(
iwl_å™s
 *
å™s
, **
buf
)

262 
i
, 
q
;

263 
num_q
 = 
å™s
->
num_rx_queues
;

264 c⁄° 
u32
 
rfh_tbl
[] = {

265 
RFH_RXF_DMA_CFG
,

266 
RFH_GEN_CFG
,

267 
RFH_GEN_STATUS
,

268 
FH_TSSR_TX_STATUS_REG
,

269 
FH_TSSR_TX_ERROR_REG
,

271 c⁄° 
ªg
 
rfh_mq_tbl
[] = {

272 { 
RFH_Q0_FRBDCB_BA_LSB
, 
åue
 },

273 { 
RFH_Q0_FRBDCB_WIDX
, 
Ál£
 },

274 { 
RFH_Q0_FRBDCB_RIDX
, 
Ál£
 },

275 { 
RFH_Q0_URBD_STTS_WPTR_LSB
, 
åue
 },

278 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


279 i‡(
buf
) {

280 
pos
 = 0;

288 
size_t
 
bufsz
 = 
	`ARRAY_SIZE
(
rfh_tbl
) * 53 +

289 
	`ARRAY_SIZE
(
rfh_mq_tbl
Ë* 53 * 
num_q
 + 40;

291 *
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

292 i‡(!*
buf
)

293  -
ENOMEM
;

295 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

298 
i
 = 0; i < 
	`ARRAY_SIZE
(
rfh_tbl
); i++)

299 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

301 
	`gë_rfh_°rög
(
rfh_tbl
[
i
]),

302 
	`iwl_ªad_¥ph
(
å™s
, 
rfh_tbl
[
i
]));

304 
i
 = 0; i < 
	`ARRAY_SIZE
(
rfh_mq_tbl
); i++)

305 
q
 = 0; q < 
num_q
; q++) {

306 
u32
 
addr
 = 
rfh_mq_tbl
[
i
].addr;

308 
addr
 +
q
 * (
rfh_mq_tbl
[
i
].
is64
 ? 8 : 4);

309 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

311 
	`gë_rfh_°rög
(
addr
), 
q
,

312 
	`iwl_ªad_¥ph
(
å™s
, 
addr
));

315  
pos
;

319 
	`IWL_ERR
(
å™s
, "RFHÑegister values:\n");

320 
i
 = 0; i < 
	`ARRAY_SIZE
(
rfh_tbl
); i++)

321 
	`IWL_ERR
(
å™s
, " %34s: 0X%08x\n",

322 
	`gë_rfh_°rög
(
rfh_tbl
[
i
]),

323 
	`iwl_ªad_¥ph
(
å™s
, 
rfh_tbl
[
i
]));

325 
i
 = 0; i < 
	`ARRAY_SIZE
(
rfh_mq_tbl
); i++)

326 
q
 = 0; q < 
num_q
; q++) {

327 
u32
 
addr
 = 
rfh_mq_tbl
[
i
].addr;

329 
addr
 +
q
 * (
rfh_mq_tbl
[
i
].
is64
 ? 8 : 4);

330 
	`IWL_ERR
(
å™s
, " %34s(q %d): 0X%08x\n",

331 
	`gë_rfh_°rög
(
addr
), 
q
,

332 
	`iwl_ªad_¥ph
(
å™s
, 
addr
));

336 
	}
}

338 c⁄° *
	$gë_fh_°rög
(
cmd
)

340 
cmd
) {

341 
	`IWL_CMD
(
FH_RSCSR_CHNL0_STTS_WPTR_REG
);

342 
	`IWL_CMD
(
FH_RSCSR_CHNL0_RBDCB_BASE_REG
);

343 
	`IWL_CMD
(
FH_RSCSR_CHNL0_WPTR
);

344 
	`IWL_CMD
(
FH_MEM_RCSR_CHNL0_CONFIG_REG
);

345 
	`IWL_CMD
(
FH_MEM_RSSR_SHARED_CTRL_REG
);

346 
	`IWL_CMD
(
FH_MEM_RSSR_RX_STATUS_REG
);

347 
	`IWL_CMD
(
FH_MEM_RSSR_RX_ENABLE_ERR_IRQ2DRV
);

348 
	`IWL_CMD
(
FH_TSSR_TX_STATUS_REG
);

349 
	`IWL_CMD
(
FH_TSSR_TX_ERROR_REG
);

353 #unde‡
IWL_CMD


354 
	}
}

356 
	$iwl_dump_fh
(
iwl_å™s
 *
å™s
, **
buf
)

358 
i
;

359 c⁄° 
u32
 
fh_tbl
[] = {

360 
FH_RSCSR_CHNL0_STTS_WPTR_REG
,

361 
FH_RSCSR_CHNL0_RBDCB_BASE_REG
,

362 
FH_RSCSR_CHNL0_WPTR
,

363 
FH_MEM_RCSR_CHNL0_CONFIG_REG
,

364 
FH_MEM_RSSR_SHARED_CTRL_REG
,

365 
FH_MEM_RSSR_RX_STATUS_REG
,

366 
FH_MEM_RSSR_RX_ENABLE_ERR_IRQ2DRV
,

367 
FH_TSSR_TX_STATUS_REG
,

368 
FH_TSSR_TX_ERROR_REG


371 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

372  
	`iwl_dump_rfh
(
å™s
, 
buf
);

374 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


375 i‡(
buf
) {

376 
pos
 = 0;

377 
size_t
 
bufsz
 = 
	`ARRAY_SIZE
(
fh_tbl
) * 48 + 40;

379 *
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

380 i‡(!*
buf
)

381  -
ENOMEM
;

383 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

386 
i
 = 0; i < 
	`ARRAY_SIZE
(
fh_tbl
); i++)

387 
pos
 +
	`s˙¥ötf
(*
buf
 +Öos, 
bufsz
 -Öos,

389 
	`gë_fh_°rög
(
fh_tbl
[
i
]),

390 
	`iwl_ªad_dúe˘32
(
å™s
, 
fh_tbl
[
i
]));

392  
pos
;

396 
	`IWL_ERR
(
å™s
, "FHÑegister values:\n");

397 
i
 = 0; i < 
	`ARRAY_SIZE
(
fh_tbl
); i++)

398 
	`IWL_ERR
(
å™s
, " %34s: 0X%08x\n",

399 
	`gë_fh_°rög
(
fh_tbl
[
i
]),

400 
	`iwl_ªad_dúe˘32
(
å™s
, 
fh_tbl
[
i
]));

403 
	}
}

405 
	#IWL_HOST_MON_BLOCK_PEMON
 0x00

	)

406 
	#IWL_HOST_MON_BLOCK_HIPM
 0x22

	)

408 
	#IWL_HOST_MON_BLOCK_PEMON_VEC0
 0x00

	)

409 
	#IWL_HOST_MON_BLOCK_PEMON_VEC1
 0x01

	)

410 
	#IWL_HOST_MON_BLOCK_PEMON_WFPM
 0x06

	)

412 
	$iwl_dump_ho°_m⁄ô‹_block
(
iwl_å™s
 *
å™s
,

413 
u32
 
block
, u32 
vec
, u32 
ôî
)

415 
i
;

417 
	`IWL_ERR
(
å™s
, "Ho° m⁄ô‹ block 0x%x ve˘‹ 0x%x\n", 
block
, 
vec
);

418 
	`iwl_wrôe32
(
å™s
, 
CSR_MONITOR_CFG_REG
, (
block
 << 8Ë| 
vec
);

419 
i
 = 0; i < 
ôî
; i++)

420 
	`IWL_ERR
(
å™s
, " value [iter %d]: 0x%08x\n",

421 
i
, 
	`iwl_ªad32
(
å™s
, 
CSR_MONITOR_STATUS_REG
));

422 
	}
}

424 
	$iwl_dump_ho°_m⁄ô‹
(
iwl_å™s
 *
å™s
)

426 
å™s
->
å™s_cfg
->
devi˚_Ámûy
) {

427 
IWL_DEVICE_FAMILY_22000
:

428 
IWL_DEVICE_FAMILY_AX210
:

429 
	`IWL_ERR
(
å™s
, "CSR_RESET = 0x%x\n",

430 
	`iwl_ªad32
(
å™s
, 
CSR_RESET
));

431 
	`iwl_dump_ho°_m⁄ô‹_block
(
å™s
, 
IWL_HOST_MON_BLOCK_PEMON
,

432 
IWL_HOST_MON_BLOCK_PEMON_VEC0
, 15);

433 
	`iwl_dump_ho°_m⁄ô‹_block
(
å™s
, 
IWL_HOST_MON_BLOCK_PEMON
,

434 
IWL_HOST_MON_BLOCK_PEMON_VEC1
, 15);

435 
	`iwl_dump_ho°_m⁄ô‹_block
(
å™s
, 
IWL_HOST_MON_BLOCK_PEMON
,

436 
IWL_HOST_MON_BLOCK_PEMON_WFPM
, 15);

437 
	`iwl_dump_ho°_m⁄ô‹_block
(
å™s
, 
IWL_HOST_MON_BLOCK_HIPM
,

438 
IWL_HOST_MON_BLOCK_PEMON_VEC0
, 1);

444 
	}
}

446 
	$iwl_föish_nic_öô
(
iwl_å™s
 *
å™s
)

448 c⁄° 
iwl_cfg_å™s_∑øms
 *
cfg_å™s
 = 
å™s
->
å™s_cfg
;

449 
u32
 
pﬁl_ªady
;

450 
îr
;

452 i‡(
cfg_å™s
->
bi§_w‹k¨ound
) {

454 
	`mdñay
(2);

461 i‡(
cfg_å™s
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

462 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

463 
CSR_GP_CNTRL_REG_FLAG_MAC_CLOCK_READY
 |

464 
CSR_GP_CNTRL_REG_FLAG_MAC_INIT
);

465 
pﬁl_ªady
 = 
CSR_GP_CNTRL_REG_FLAG_MAC_STATUS
;

467 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

468 
CSR_GP_CNTRL_REG_FLAG_INIT_DONE
);

469 
pﬁl_ªady
 = 
CSR_GP_CNTRL_REG_FLAG_MAC_CLOCK_READY
;

472 i‡(
cfg_å™s
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_8000
)

473 
	`udñay
(2);

480 
îr
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_GP_CNTRL
, 
pﬁl_ªady
,Öoll_ready, 25000);

481 i‡(
îr
 < 0) {

482 
	`IWL_DEBUG_INFO
(
å™s
, "FailedÅo wake NIC\n");

484 
	`iwl_dump_ho°_m⁄ô‹
(
å™s
);

487 i‡(
cfg_å™s
->
bi§_w‹k¨ound
) {

489 
	`udñay
(200);

492  
îr
 < 0 ?Érr : 0;

493 
	}
}

494 
IWL_EXPORT_SYMBOL
(
iwl_föish_nic_öô
);

496 
	$iwl_å™s_sync_nmi_wôh_addr
(
iwl_å™s
 *
å™s
, 
u32
 
öè_addr
,

497 
u32
 
sw_îr_bô
)

499 
timeout
 = 
jiffõs
 + 
IWL_TRANS_NMI_TIMEOUT
;

500 
boﬁ
 
öãºu±s_íabÀd
 = 
	`ã°_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
);

505 i‡(
öãºu±s_íabÀd
)

506 
	`iwl_å™s_öãºu±s
(
å™s
, 
Ál£
);

508 
	`iwl_f‹˚_nmi
(
å™s
);

509 
	`time_a·î
(
timeout
, 
jiffõs
)) {

510 
u32
 
öè_hw
 = 
	`iwl_ªad32
(
å™s
, 
öè_addr
);

513 i‡(
öè_hw
 & 
sw_îr_bô
) {

515 
	`iwl_wrôe32
(
å™s
, 
öè_addr
, 
öè_hw
 & 
sw_îr_bô
);

519 
	`mdñay
(1);

526 i‡(
öãºu±s_íabÀd
)

527 
	`iwl_å™s_öãºu±s
(
å™s
, 
åue
);

529 
	`iwl_å™s_fw_îr‹
(
å™s
, 
Ál£
);

530 
	}
}

	@iwl-io.h

5 #i‚de‡
__iwl_io_h__


6 
	#__iwl_io_h__


	)

8 
	~"iwl-devåa˚.h
"

9 
	~"iwl-å™s.h
"

11 
iwl_wrôe8
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, 
u8
 
vÆ
);

12 
iwl_wrôe32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
);

13 
iwl_wrôe64
(
iwl_å™s
 *
å™s
, 
u64
 
ofs
, u64 
vÆ
);

14 
u32
 
iwl_ªad32
(
iwl_å™s
 *
å™s
, u32 
ofs
);

16 
ölöe
 
	$iwl_£t_bô
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
, u32 
mask
)

18 
	`iwl_å™s_£t_bôs_mask
(
å™s
, 
ªg
, 
mask
, mask);

19 
	}
}

21 
ölöe
 
	$iwl_˛ór_bô
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
, u32 
mask
)

23 
	`iwl_å™s_£t_bôs_mask
(
å™s
, 
ªg
, 
mask
, 0);

24 
	}
}

26 
iwl_pﬁl_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

27 
u32
 
bôs
, u32 
mask
, 
timeout
);

28 
iwl_pﬁl_dúe˘_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
, u32 
mask
,

29 
timeout
);

31 
u32
 
iwl_ªad_dúe˘32
(
iwl_å™s
 *
å™s
, u32 
ªg
);

32 
iwl_wrôe_dúe˘32
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
, u32 
vÆue
);

33 
iwl_wrôe_dúe˘64
(
iwl_å™s
 *
å™s
, 
u64
 
ªg
, u64 
vÆue
);

36 
u32
 
iwl_ªad_¥ph_no_gøb
(
iwl_å™s
 *
å™s
, u32 
ofs
);

37 
u32
 
iwl_ªad_¥ph
(
iwl_å™s
 *
å™s
, u32 
ofs
);

38 
iwl_wrôe_¥ph_no_gøb
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
);

39 
iwl_wrôe_¥ph64_no_gøb
(
iwl_å™s
 *
å™s
, 
u64
 
ofs
, u64 
vÆ
);

40 
iwl_wrôe_¥ph_dñay
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

41 
u32
 
vÆ
, u32 
dñay_ms
);

42 
ölöe
 
	$iwl_wrôe_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
)

44 
	`iwl_wrôe_¥ph_dñay
(
å™s
, 
ofs
, 
vÆ
, 0);

45 
	}
}

47 
iwl_pﬁl_¥ph_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

48 
u32
 
bôs
, u32 
mask
, 
timeout
);

49 
iwl_£t_bôs_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
mask
);

50 
iwl_£t_bôs_mask_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

51 
u32
 
bôs
, u32 
mask
);

52 
iwl_˛ór_bôs_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
mask
);

53 
iwl_f‹˚_nmi
(
iwl_å™s
 *
å™s
);

55 
iwl_föish_nic_öô
(
iwl_å™s
 *
å™s
);

58 
iwl_dump_fh
(
iwl_å™s
 *
å™s
, **
buf
);

65 
ölöe
 
u32
 
	$iwl_umac_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

67  
ofs
 + 
å™s
->
å™s_cfg
->
umac_¥ph_off£t
;

68 
	}
}

70 
ölöe
 
u32
 
	$iwl_ªad_umac_¥ph_no_gøb
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

72  
	`iwl_ªad_¥ph_no_gøb
(
å™s
, 
ofs
 +

73 
å™s
->
å™s_cfg
->
umac_¥ph_off£t
);

74 
	}
}

76 
ölöe
 
u32
 
	$iwl_ªad_umac_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

78  
	`iwl_ªad_¥ph
(
å™s
, 
ofs
 +Åøns->
å™s_cfg
->
umac_¥ph_off£t
);

79 
	}
}

81 
ölöe
 
	$iwl_wrôe_umac_¥ph_no_gøb
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

82 
u32
 
vÆ
)

84 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
ofs
 +Åøns->
å™s_cfg
->
umac_¥ph_off£t
,

85 
vÆ
);

86 
	}
}

88 
ölöe
 
	$iwl_wrôe_umac_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

89 
u32
 
vÆ
)

91 
	`iwl_wrôe_¥ph
(
å™s
, 
ofs
 +Åøns->
å™s_cfg
->
umac_¥ph_off£t
, 
vÆ
);

92 
	}
}

94 
ölöe
 
	$iwl_pﬁl_umac_¥ph_bô
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

95 
u32
 
bôs
, u32 
mask
, 
timeout
)

97  
	`iwl_pﬁl_¥ph_bô
(
å™s
, 
addr
 +

98 
å™s
->
å™s_cfg
->
umac_¥ph_off£t
,

99 
bôs
, 
mask
, 
timeout
);

100 
	}
}

	@iwl-modparams.h

5 #i‚de‡
__iwl_mod∑øms_h__


6 
	#__iwl_mod∑øms_h__


	)

8 
	~<löux/ty≥s.h
>

9 
	~<löux/•ölock.h
>

10 
	~<löux/gÂ.h
>

12 
iwl_mod_∑øms
 
iwlwifi_mod_∑øms
;

14 
	eiwl_powî_Àvñ
 {

15 
	mIWL_POWER_INDEX_1
,

16 
	mIWL_POWER_INDEX_2
,

17 
	mIWL_POWER_INDEX_3
,

18 
	mIWL_POWER_INDEX_4
,

19 
	mIWL_POWER_INDEX_5
,

20 
	mIWL_POWER_NUM


23 
	eiwl_dißbÀ_11n
 {

24 
	mIWL_DISABLE_HT_ALL
 = 
BIT
(0),

25 
	mIWL_DISABLE_HT_TXAGG
 = 
BIT
(1),

26 
	mIWL_DISABLE_HT_RXAGG
 = 
BIT
(2),

27 
	mIWL_ENABLE_HT_TXAGG
 = 
BIT
(3),

30 
	eiwl_amsdu_size
 {

31 
	mIWL_AMSDU_DEF
 = 0,

32 
	mIWL_AMSDU_4K
 = 1,

33 
	mIWL_AMSDU_8K
 = 2,

34 
	mIWL_AMSDU_12K
 = 3,

36 
	mIWL_AMSDU_2K
 = 4,

39 
	eiwl_u≠sd_dißbÀ
 {

40 
	mIWL_DISABLE_UAPSD_BSS
 = 
BIT
(0),

41 
	mIWL_DISABLE_UAPSD_P2P_CLIENT
 = 
BIT
(1),

67 
	siwl_mod_∑øms
 {

68 
	msw¸y±o
;

69 
	mdißbÀ_11n
;

70 
	mamsdu_size
;

71 
boﬁ
 
	mfw_ª°¨t
;

72 
boﬁ
 
	mbt_c€x_a˘ive
;

73 
	mÀd_mode
;

74 
boﬁ
 
	mpowî_ßve
;

75 
	mpowî_Àvñ
;

76 #ifde‡
CONFIG_IWLWIFI_DEBUG


77 
u32
 
	mdebug_Àvñ
;

79 *
	mnvm_fûe
;

80 
u32
 
	mu≠sd_dißbÀ
;

81 
boﬁ
 
	mdißbÀ_11ac
;

85 
boﬁ
 
	mdißbÀ_11ax
;

86 
boﬁ
 
	mªmove_whí_g⁄e
;

87 
u32
 
	míabÀ_öi
;

88 
boﬁ
 
	mdißbÀ_11be
;

91 
ölöe
 
boﬁ
 
	$iwl_íabÀ_rx_ampdu
()

93 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_DISABLE_HT_RXAGG
)

94  
Ál£
;

95  
åue
;

96 
	}
}

98 
ölöe
 
boﬁ
 
	$iwl_íabÀ_tx_ampdu
()

100 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_DISABLE_HT_TXAGG
)

101  
Ál£
;

102 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_ENABLE_HT_TXAGG
)

103  
åue
;

106  
åue
;

107 
	}
}

	@iwl-nvm-parse.c

7 
	~<löux/ty≥s.h
>

8 
	~<löux/¶ab.h
>

9 
	~<löux/exp‹t.h
>

10 
	~<löux/ëhîdevi˚.h
>

11 
	~<löux/pci.h
>

12 
	~<löux/fúmw¨e.h
>

14 
	~"iwl-drv.h
"

15 
	~"iwl-mod∑øms.h
"

16 
	~"iwl-nvm-∑r£.h
"

17 
	~"iwl-¥ph.h
"

18 
	~"iwl-io.h
"

19 
	~"iwl-c§.h
"

20 
	~"fw/a˝i.h
"

21 
	~"fw/≠i/nvm-ªg.h
"

22 
	~"fw/≠i/comm™ds.h
"

23 
	~"fw/≠i/cmdhdr.h
"

24 
	~"fw/img.h
"

25 
	~"mei/iwl-mei.h
"

28 
	envm_off£ts
 {

30 
	mSUBSYSTEM_ID
 = 0x0A,

31 
	mHW_ADDR
 = 0x15,

34 
	mNVM_SW_SECTION
 = 0x1C0,

35 
	mNVM_VERSION
 = 0,

36 
	mRADIO_CFG
 = 1,

37 
	mSKU
 = 2,

38 
	mN_HW_ADDRS
 = 3,

39 
	mNVM_CHANNELS
 = 0x1E0 - 
NVM_SW_SECTION
,

42 
	mNVM_CALIB_SECTION
 = 0x2B8,

43 
	mXTAL_CALIB
 = 0x316 - 
NVM_CALIB_SECTION
,

46 
	mNVM_CHANNELS_SDP
 = 0,

49 
	eext_nvm_off£ts
 {

51 
	mMAC_ADDRESS_OVERRIDE_EXT_NVM
 = 1,

54 
	mNVM_VERSION_EXT_NVM
 = 0,

55 
	mN_HW_ADDRS_FAMILY_8000
 = 3,

58 
	mRADIO_CFG_FAMILY_EXT_NVM
 = 0,

59 
	mSKU_FAMILY_8000
 = 2,

62 
	mNVM_CHANNELS_EXTENDED
 = 0,

63 
	mNVM_LAR_OFFSET_OLD
 = 0x4C7,

64 
	mNVM_LAR_OFFSET
 = 0x507,

65 
	mNVM_LAR_ENABLED
 = 0x7,

69 
	envm_sku_bôs
 {

70 
	mNVM_SKU_CAP_BAND_24GHZ
 = 
BIT
(0),

71 
	mNVM_SKU_CAP_BAND_52GHZ
 = 
BIT
(1),

72 
	mNVM_SKU_CAP_11N_ENABLE
 = 
BIT
(2),

73 
	mNVM_SKU_CAP_11AC_ENABLE
 = 
BIT
(3),

74 
	mNVM_SKU_CAP_MIMO_DISABLE
 = 
BIT
(5),

80 c⁄° 
u16
 
	giwl_nvm_ch™√ls
[] = {

89 c⁄° 
u16
 
	giwl_ext_nvm_ch™√ls
[] = {

98 c⁄° 
u16
 
	giwl_uhb_nvm_ch™√ls
[] = {

112 
	#IWL_NVM_NUM_CHANNELS
 
	`ARRAY_SIZE
(
iwl_nvm_ch™√ls
)

	)

113 
	#IWL_NVM_NUM_CHANNELS_EXT
 
	`ARRAY_SIZE
(
iwl_ext_nvm_ch™√ls
)

	)

114 
	#IWL_NVM_NUM_CHANNELS_UHB
 
	`ARRAY_SIZE
(
iwl_uhb_nvm_ch™√ls
)

	)

115 
	#NUM_2GHZ_CHANNELS
 14

	)

116 
	#NUM_5GHZ_CHANNELS
 37

	)

117 
	#FIRST_2GHZ_HT_MINUS
 5

	)

118 
	#LAST_2GHZ_HT_PLUS
 9

	)

119 
	#N_HW_ADDR_MASK
 0xF

	)

122 
õì80211_øã
 
	giwl_cfg80211_øãs
[] = {

123 { .
bôøã
 = 1 * 10, .
	ghw_vÆue
 = 0, .
	ghw_vÆue_sh‹t
 = 0, },

124 { .
	gbôøã
 = 2 * 10, .
	ghw_vÆue
 = 1, .
	ghw_vÆue_sh‹t
 = 1,

125 .
	gÊags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
, },

126 { .
	gbôøã
 = 5.5 * 10, .
	ghw_vÆue
 = 2, .
	ghw_vÆue_sh‹t
 = 2,

127 .
	gÊags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
, },

128 { .
	gbôøã
 = 11 * 10, .
	ghw_vÆue
 = 3, .
	ghw_vÆue_sh‹t
 = 3,

129 .
	gÊags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
, },

130 { .
	gbôøã
 = 6 * 10, .
	ghw_vÆue
 = 4, .
	ghw_vÆue_sh‹t
 = 4, },

131 { .
	gbôøã
 = 9 * 10, .
	ghw_vÆue
 = 5, .
	ghw_vÆue_sh‹t
 = 5, },

132 { .
	gbôøã
 = 12 * 10, .
	ghw_vÆue
 = 6, .
	ghw_vÆue_sh‹t
 = 6, },

133 { .
	gbôøã
 = 18 * 10, .
	ghw_vÆue
 = 7, .
	ghw_vÆue_sh‹t
 = 7, },

134 { .
	gbôøã
 = 24 * 10, .
	ghw_vÆue
 = 8, .
	ghw_vÆue_sh‹t
 = 8, },

135 { .
	gbôøã
 = 36 * 10, .
	ghw_vÆue
 = 9, .
	ghw_vÆue_sh‹t
 = 9, },

136 { .
	gbôøã
 = 48 * 10, .
	ghw_vÆue
 = 10, .
	ghw_vÆue_sh‹t
 = 10, },

137 { .
	gbôøã
 = 54 * 10, .
	ghw_vÆue
 = 11, .
	ghw_vÆue_sh‹t
 = 11, },

139 
	#RATES_24_OFFS
 0

	)

140 
	#N_RATES_24
 
	`ARRAY_SIZE
(
iwl_cfg80211_øãs
)

	)

141 
	#RATES_52_OFFS
 4

	)

142 
	#N_RATES_52
 (
N_RATES_24
 - 
RATES_52_OFFS
)

	)

162 
	eiwl_nvm_ch™√l_Êags
 {

163 
	mNVM_CHANNEL_VALID
 = 
BIT
(0),

164 
	mNVM_CHANNEL_IBSS
 = 
BIT
(1),

165 
	mNVM_CHANNEL_ACTIVE
 = 
BIT
(3),

166 
	mNVM_CHANNEL_RADAR
 = 
BIT
(4),

167 
	mNVM_CHANNEL_INDOOR_ONLY
 = 
BIT
(5),

168 
	mNVM_CHANNEL_GO_CONCURRENT
 = 
BIT
(6),

169 
	mNVM_CHANNEL_UNIFORM
 = 
BIT
(7),

170 
	mNVM_CHANNEL_20MHZ
 = 
BIT
(8),

171 
	mNVM_CHANNEL_40MHZ
 = 
BIT
(9),

172 
	mNVM_CHANNEL_80MHZ
 = 
BIT
(10),

173 
	mNVM_CHANNEL_160MHZ
 = 
BIT
(11),

174 
	mNVM_CHANNEL_DC_HIGH
 = 
BIT
(12),

175 
	mNVM_CHANNEL_VLP
 = 
BIT
(13),

176 
	mNVM_CHANNEL_AFC
 = 
BIT
(14),

197 
	eiwl_ªg_ˇ∑_Êags_v1
 {

198 
	mREG_CAPA_V1_BF_CCD_LOW_BAND
 = 
BIT
(0),

199 
	mREG_CAPA_V1_BF_CCD_HIGH_BAND
 = 
BIT
(1),

200 
	mREG_CAPA_V1_160MHZ_ALLOWED
 = 
BIT
(2),

201 
	mREG_CAPA_V1_80MHZ_ALLOWED
 = 
BIT
(3),

202 
	mREG_CAPA_V1_MCS_8_ALLOWED
 = 
BIT
(4),

203 
	mREG_CAPA_V1_MCS_9_ALLOWED
 = 
BIT
(5),

204 
	mREG_CAPA_V1_40MHZ_FORBIDDEN
 = 
BIT
(7),

205 
	mREG_CAPA_V1_DC_HIGH_ENABLED
 = 
BIT
(9),

206 
	mREG_CAPA_V1_11AX_DISABLED
 = 
BIT
(10),

230 
	eiwl_ªg_ˇ∑_Êags_v2
 {

231 
	mREG_CAPA_V2_STRADDLE_DISABLED
 = 
BIT
(0),

232 
	mREG_CAPA_V2_BF_CCD_LOW_BAND
 = 
BIT
(1),

233 
	mREG_CAPA_V2_BF_CCD_HIGH_BAND
 = 
BIT
(2),

234 
	mREG_CAPA_V2_160MHZ_ALLOWED
 = 
BIT
(3),

235 
	mREG_CAPA_V2_80MHZ_ALLOWED
 = 
BIT
(4),

236 
	mREG_CAPA_V2_MCS_8_ALLOWED
 = 
BIT
(5),

237 
	mREG_CAPA_V2_MCS_9_ALLOWED
 = 
BIT
(6),

238 
	mREG_CAPA_V2_WEATHER_DISABLED
 = 
BIT
(7),

239 
	mREG_CAPA_V2_40MHZ_ALLOWED
 = 
BIT
(8),

240 
	mREG_CAPA_V2_11AX_DISABLED
 = 
BIT
(10),

257 
	eiwl_ªg_ˇ∑_Êags_v4
 {

258 
	mREG_CAPA_V4_160MHZ_ALLOWED
 = 
BIT
(3),

259 
	mREG_CAPA_V4_80MHZ_ALLOWED
 = 
BIT
(4),

260 
	mREG_CAPA_V4_MCS_12_ALLOWED
 = 
BIT
(5),

261 
	mREG_CAPA_V4_MCS_13_ALLOWED
 = 
BIT
(6),

262 
	mREG_CAPA_V4_11BE_DISABLED
 = 
BIT
(8),

263 
	mREG_CAPA_V4_11AX_DISABLED
 = 
BIT
(13),

264 
	mREG_CAPA_V4_320MHZ_ALLOWED
 = 
BIT
(16),

271 
	#REG_CAPA_V2_RESP_VER
 6

	)

276 
	#REG_CAPA_V4_RESP_VER
 8

	)

293 
	siwl_ªg_ˇ∑
 {

294 
boﬁ
 
	mÆlow_40mhz
;

295 
boﬁ
 
	mÆlow_80mhz
;

296 
boﬁ
 
	mÆlow_160mhz
;

297 
boﬁ
 
	mÆlow_320mhz
;

298 
boﬁ
 
	mdißbÀ_11ax
;

299 
boﬁ
 
	mdißbÀ_11be
;

302 
ölöe
 
	$iwl_nvm_¥öt_ch™√l_Êags
(
devi˚
 *
dev
, 
u32
 
Àvñ
,

303 
ch™
, 
u32
 
Êags
)

305 
	#CHECK_AND_PRINT_I
(
x
) \

306 ((
Êags
 & 
NVM_CHANNEL_
##
x
Ë? " " #x : "")

	)

308 i‡(!(
Êags
 & 
NVM_CHANNEL_VALID
)) {

309 
	`IWL_DEBUG_DEV
(
dev
, 
Àvñ
, "Ch. %d: 0x%x: NoÅraffic\n",

310 
ch™
, 
Êags
);

315 
	`IWL_DEBUG_DEV
(
dev
, 
Àvñ
,

317 
ch™
, 
Êags
,

318 
	`CHECK_AND_PRINT_I
(
VALID
),

319 
	`CHECK_AND_PRINT_I
(
IBSS
),

320 
	`CHECK_AND_PRINT_I
(
ACTIVE
),

321 
	`CHECK_AND_PRINT_I
(
RADAR
),

322 
	`CHECK_AND_PRINT_I
(
INDOOR_ONLY
),

323 
	`CHECK_AND_PRINT_I
(
GO_CONCURRENT
),

324 
	`CHECK_AND_PRINT_I
(
UNIFORM
),

325 
	`CHECK_AND_PRINT_I
(20
MHZ
),

326 
	`CHECK_AND_PRINT_I
(40
MHZ
),

327 
	`CHECK_AND_PRINT_I
(80
MHZ
),

328 
	`CHECK_AND_PRINT_I
(160
MHZ
),

329 
	`CHECK_AND_PRINT_I
(
DC_HIGH
),

330 
	`CHECK_AND_PRINT_I
(
VLP
),

331 
	`CHECK_AND_PRINT_I
(
AFC
));

332 #unde‡
CHECK_AND_PRINT_I


333 
	}
}

335 
u32
 
	$iwl_gë_ch™√l_Êags
(
u8
 
ch_num
, 
ch_idx
, 
∆80211_b™d
 
b™d
,

336 
u32
 
nvm_Êags
, c⁄° 
iwl_cfg
 *
cfg
)

338 
u32
 
Êags
 = 
IEEE80211_CHAN_NO_HT40
;

340 i‡(
b™d
 =
NL80211_BAND_2GHZ
 && (
nvm_Êags
 & 
NVM_CHANNEL_40MHZ
)) {

341 i‡(
ch_num
 <
LAST_2GHZ_HT_PLUS
)

342 
Êags
 &~
IEEE80211_CHAN_NO_HT40PLUS
;

343 i‡(
ch_num
 >
FIRST_2GHZ_HT_MINUS
)

344 
Êags
 &~
IEEE80211_CHAN_NO_HT40MINUS
;

345 } i‡(
nvm_Êags
 & 
NVM_CHANNEL_40MHZ
) {

346 i‡((
ch_idx
 - 
NUM_2GHZ_CHANNELS
) % 2 == 0)

347 
Êags
 &~
IEEE80211_CHAN_NO_HT40PLUS
;

349 
Êags
 &~
IEEE80211_CHAN_NO_HT40MINUS
;

351 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_80MHZ
))

352 
Êags
 |
IEEE80211_CHAN_NO_80MHZ
;

353 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_160MHZ
))

354 
Êags
 |
IEEE80211_CHAN_NO_160MHZ
;

356 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_IBSS
))

357 
Êags
 |
IEEE80211_CHAN_NO_IR
;

359 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_ACTIVE
))

360 
Êags
 |
IEEE80211_CHAN_NO_IR
;

362 i‡(
nvm_Êags
 & 
NVM_CHANNEL_RADAR
)

363 
Êags
 |
IEEE80211_CHAN_RADAR
;

365 i‡(
nvm_Êags
 & 
NVM_CHANNEL_INDOOR_ONLY
)

366 
Êags
 |
IEEE80211_CHAN_INDOOR_ONLY
;

371 i‡((
nvm_Êags
 & 
NVM_CHANNEL_GO_CONCURRENT
) &&

372 (
Êags
 & 
IEEE80211_CHAN_NO_IR
))

373 
Êags
 |
IEEE80211_CHAN_IR_CONCURRENT
;

376 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_VLP
))

377 
Êags
 |
IEEE80211_CHAN_NO_6GHZ_VLP_CLIENT
;

378 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_AFC
))

379 
Êags
 |
IEEE80211_CHAN_NO_6GHZ_AFC_CLIENT
;

381  
Êags
;

382 
	}
}

384 
∆80211_b™d
 
	$iwl_∆80211_b™d_‰om_ch™√l_idx
(
ch_idx
)

386 i‡(
ch_idx
 >
NUM_2GHZ_CHANNELS
 + 
NUM_5GHZ_CHANNELS
) {

387  
NL80211_BAND_6GHZ
;

390 i‡(
ch_idx
 >
NUM_2GHZ_CHANNELS
)

391  
NL80211_BAND_5GHZ
;

392  
NL80211_BAND_2GHZ
;

393 
	}
}

395 
	$iwl_öô_ch™√l_m≠
(
devi˚
 *
dev
, c⁄° 
iwl_cfg
 *
cfg
,

396 
iwl_nvm_d©a
 *
d©a
,

397 c⁄° * c⁄° 
nvm_ch_Êags
,

398 
u32
 
sb™ds_Êags
, 
boﬁ
 
v4
)

400 
ch_idx
;

401 
n_ch™√ls
 = 0;

402 
õì80211_ch™√l
 *
ch™√l
;

403 
u32
 
ch_Êags
;

404 
num_of_ch
;

405 c⁄° 
u16
 *
nvm_ch™
;

407 i‡(
cfg
->
uhb_suµ‹ãd
) {

408 
num_of_ch
 = 
IWL_NVM_NUM_CHANNELS_UHB
;

409 
nvm_ch™
 = 
iwl_uhb_nvm_ch™√ls
;

410 } i‡(
cfg
->
nvm_ty≥
 =
IWL_NVM_EXT
) {

411 
num_of_ch
 = 
IWL_NVM_NUM_CHANNELS_EXT
;

412 
nvm_ch™
 = 
iwl_ext_nvm_ch™√ls
;

414 
num_of_ch
 = 
IWL_NVM_NUM_CHANNELS
;

415 
nvm_ch™
 = 
iwl_nvm_ch™√ls
;

418 
ch_idx
 = 0; ch_idx < 
num_of_ch
; ch_idx++) {

419 
∆80211_b™d
 
b™d
 =

420 
	`iwl_∆80211_b™d_‰om_ch™√l_idx
(
ch_idx
);

422 i‡(
v4
)

423 
ch_Êags
 =

424 
	`__À32_to_˝up
((c⁄° 
__À32
 *)
nvm_ch_Êags
 + 
ch_idx
);

426 
ch_Êags
 =

427 
	`__À16_to_˝up
((c⁄° 
__À16
 *)
nvm_ch_Êags
 + 
ch_idx
);

429 i‡(
b™d
 =
NL80211_BAND_5GHZ
 &&

430 !
d©a
->
sku_ˇp_b™d_52ghz_íabÀ
)

434 i‡((
sb™ds_Êags
 & 
IWL_NVM_SBANDS_FLAGS_NO_WIDE_IN_5GHZ
) &&

435 
b™d
 =
NL80211_BAND_5GHZ
) {

436 
ch_Êags
 &~(
NVM_CHANNEL_40MHZ
 |

437 
NVM_CHANNEL_80MHZ
 |

438 
NVM_CHANNEL_160MHZ
);

441 i‡(
ch_Êags
 & 
NVM_CHANNEL_160MHZ
)

442 
d©a
->
vht160_suµ‹ãd
 = 
åue
;

444 i‡(!(
sb™ds_Êags
 & 
IWL_NVM_SBANDS_FLAGS_LAR
) &&

445 !(
ch_Êags
 & 
NVM_CHANNEL_VALID
)) {

451 
	`iwl_nvm_¥öt_ch™√l_Êags
(
dev
, 
IWL_DL_EEPROM
,

452 
nvm_ch™
[
ch_idx
], 
ch_Êags
);

456 
ch™√l
 = &
d©a
->
ch™√ls
[
n_ch™√ls
];

457 
n_ch™√ls
++;

459 
ch™√l
->
hw_vÆue
 = 
nvm_ch™
[
ch_idx
];

460 
ch™√l
->
b™d
 = band;

461 
ch™√l
->
˚¡î_‰eq
 =

462 
	`õì80211_ch™√l_to_‰equícy
(

463 
ch™√l
->
hw_vÆue
, ch™√l->
b™d
);

471 
ch™√l
->
max_powî
 = 
IWL_DEFAULT_MAX_TX_POWER
;

474 i‡(!(
sb™ds_Êags
 & 
IWL_NVM_SBANDS_FLAGS_LAR
))

475 
ch™√l
->
Êags
 = 
	`iwl_gë_ch™√l_Êags
(
nvm_ch™
[
ch_idx
],

476 
ch_idx
, 
b™d
,

477 
ch_Êags
, 
cfg
);

479 
ch™√l
->
Êags
 = 0;

484 i‡(
cfg
->
uhb_suµ‹ãd
)

485 
ch™√l
->
Êags
 = 0;

486 
	`iwl_nvm_¥öt_ch™√l_Êags
(
dev
, 
IWL_DL_EEPROM
,

487 
ch™√l
->
hw_vÆue
, 
ch_Êags
);

488 
	`IWL_DEBUG_EEPROM
(
dev
, "Ch. %d: %ddBm\n",

489 
ch™√l
->
hw_vÆue
, ch™√l->
max_powî
);

492  
n_ch™√ls
;

493 
	}
}

495 
	$iwl_öô_vht_hw_ˇ∑b
(
iwl_å™s
 *
å™s
,

496 
iwl_nvm_d©a
 *
d©a
,

497 
õì80211_°a_vht_ˇp
 *
vht_ˇp
,

498 
u8
 
tx_chaös
, u8 
rx_chaös
)

500 c⁄° 
iwl_cfg
 *
cfg
 = 
å™s
->cfg;

501 
num_rx_™ts
 = 
	`num_of_™t
(
rx_chaös
);

502 
num_tx_™ts
 = 
	`num_of_™t
(
tx_chaös
);

504 
vht_ˇp
->
vht_suµ‹ãd
 = 
åue
;

506 
vht_ˇp
->
ˇp
 = 
IEEE80211_VHT_CAP_SHORT_GI_80
 |

507 
IEEE80211_VHT_CAP_RXSTBC_1
 |

508 
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
 |

509 3 << 
IEEE80211_VHT_CAP_BEAMFORMEE_STS_SHIFT
 |

510 
IEEE80211_VHT_MAX_AMPDU_1024K
 <<

511 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_SHIFT
;

513 i‡(!
å™s
->
cfg
->
ht_∑øms
->
°bc
)

514 
vht_ˇp
->
ˇp
 &~
IEEE80211_VHT_CAP_RXSTBC_MASK
;

516 i‡(
d©a
->
vht160_suµ‹ãd
)

517 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
 |

518 
IEEE80211_VHT_CAP_SHORT_GI_160
;

520 i‡(
cfg
->
vht_mu_mimo_suµ‹ãd
)

521 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
;

523 i‡(
cfg
->
ht_∑øms
->
ldpc
)

524 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_RXLDPC
;

526 i‡(
d©a
->
sku_ˇp_mimo_dißbÀd
) {

527 
num_rx_™ts
 = 1;

528 
num_tx_™ts
 = 1;

531 i‡(
å™s
->
cfg
->
ht_∑øms
->
°bc
 && 
num_tx_™ts
 > 1)

532 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_TXSTBC
;

534 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_TX_ANTENNA_PATTERN
;

536 
iwlwifi_mod_∑øms
.
amsdu_size
) {

537 
IWL_AMSDU_DEF
:

538 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

539 
vht_ˇp
->
ˇp
 |=

540 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
;

542 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_3895
;

544 
IWL_AMSDU_2K
:

545 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

546 
vht_ˇp
->
ˇp
 |=

547 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
;

549 
	`WARN
(1, "RB size of 2K isÇot supported byÅhis device\n");

551 
IWL_AMSDU_4K
:

552 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_3895
;

554 
IWL_AMSDU_8K
:

555 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991
;

557 
IWL_AMSDU_12K
:

558 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
;

564 
vht_ˇp
->
vht_mcs
.
rx_mcs_m≠
 =

565 
	`˝u_to_À16
(
IEEE80211_VHT_MCS_SUPPORT_0_9
 << 0 |

566 
IEEE80211_VHT_MCS_SUPPORT_0_9
 << 2 |

567 
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 4 |

568 
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 6 |

569 
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 8 |

570 
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 10 |

571 
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 12 |

572 
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 14);

574 i‡(
num_rx_™ts
 =1 || 
cfg
->
rx_wôh_siso_divîsôy
) {

575 
vht_ˇp
->
ˇp
 |
IEEE80211_VHT_CAP_RX_ANTENNA_PATTERN
;

577 
vht_ˇp
->
vht_mcs
.
rx_mcs_m≠
 |=

578 
	`˝u_to_À16
(
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 2);

581 
vht_ˇp
->
vht_mcs
.
tx_mcs_m≠
 = vht_ˇp->vht_mcs.
rx_mcs_m≠
;

583 
vht_ˇp
->
vht_mcs
.
tx_highe°
 |=

584 
	`˝u_to_À16
(
IEEE80211_VHT_EXT_NSS_BW_CAPABLE
);

585 
	}
}

587 c⁄° 
u8
 
	giwl_víd‹_ˇps
[] = {

593 
	#IWL_VENDOR_CAP_IMPROVED_BF_FDBK_HE
 
	`BIT
(0)

	)

594 
IWL_VENDOR_CAP_IMPROVED_BF_FDBK_HE
,

598 c⁄° 
õì80211_sb™d_i·y≥_d©a
 
	giwl_he_eht_ˇ∑
[] = {

600 .
ty≥s_mask
 = 
BIT
(
NL80211_IFTYPE_STATION
),

601 .
	ghe_ˇp
 = {

602 .
has_he
 = 
åue
,

603 .
	ghe_ˇp_ñem
 = {

604 .
mac_ˇp_öfo
[0] =

605 
IEEE80211_HE_MAC_CAP0_HTC_HE
,

606 .
	gmac_ˇp_öfo
[1] =

607 
IEEE80211_HE_MAC_CAP1_TF_MAC_PAD_DUR_16US
 |

608 
IEEE80211_HE_MAC_CAP1_MULTI_TID_AGG_RX_QOS_8
,

609 .
	gmac_ˇp_öfo
[2] =

610 
IEEE80211_HE_MAC_CAP2_32BIT_BA_BITMAP
,

611 .
	gmac_ˇp_öfo
[3] =

612 
IEEE80211_HE_MAC_CAP3_OMI_CONTROL
 |

613 
IEEE80211_HE_MAC_CAP3_RX_CTRL_FRAME_TO_MULTIBSS
,

614 .
	gmac_ˇp_öfo
[4] =

615 
IEEE80211_HE_MAC_CAP4_AMSDU_IN_AMPDU
 |

616 
IEEE80211_HE_MAC_CAP4_MULTI_TID_AGG_TX_QOS_B39
,

617 .
	gmac_ˇp_öfo
[5] =

618 
IEEE80211_HE_MAC_CAP5_MULTI_TID_AGG_TX_QOS_B40
 |

619 
IEEE80211_HE_MAC_CAP5_MULTI_TID_AGG_TX_QOS_B41
 |

620 
IEEE80211_HE_MAC_CAP5_UL_2x996_TONE_RU
 |

621 
IEEE80211_HE_MAC_CAP5_HE_DYNAMIC_SM_PS
 |

622 
IEEE80211_HE_MAC_CAP5_HT_VHT_TRIG_FRAME_RX
,

623 .
	gphy_ˇp_öfo
[1] =

624 
IEEE80211_HE_PHY_CAP1_PREAMBLE_PUNC_RX_MASK
 |

625 
IEEE80211_HE_PHY_CAP1_DEVICE_CLASS_A
 |

626 
IEEE80211_HE_PHY_CAP1_LDPC_CODING_IN_PAYLOAD
,

627 .
	gphy_ˇp_öfo
[2] =

628 
IEEE80211_HE_PHY_CAP2_NDP_4x_LTF_AND_3_2US
 |

629 
IEEE80211_HE_PHY_CAP2_STBC_RX_UNDER_80MHZ
,

630 .
	gphy_ˇp_öfo
[3] =

631 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_BPSK
 |

632 
IEEE80211_HE_PHY_CAP3_DCM_MAX_TX_NSS_1
 |

633 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_BPSK
 |

634 
IEEE80211_HE_PHY_CAP3_DCM_MAX_RX_NSS_1
,

635 .
	gphy_ˇp_öfo
[4] =

636 
IEEE80211_HE_PHY_CAP4_SU_BEAMFORMEE
 |

637 
IEEE80211_HE_PHY_CAP4_BEAMFORMEE_MAX_STS_ABOVE_80MHZ_8
 |

638 
IEEE80211_HE_PHY_CAP4_BEAMFORMEE_MAX_STS_UNDER_80MHZ_8
,

639 .
	gphy_ˇp_öfo
[6] =

640 
IEEE80211_HE_PHY_CAP6_TRIG_SU_BEAMFORMING_FB
 |

641 
IEEE80211_HE_PHY_CAP6_TRIG_MU_BEAMFORMING_PARTIAL_BW_FB
 |

642 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
,

643 .
	gphy_ˇp_öfo
[7] =

644 
IEEE80211_HE_PHY_CAP7_POWER_BOOST_FACTOR_SUPP
 |

645 
IEEE80211_HE_PHY_CAP7_HE_SU_MU_PPDU_4XLTF_AND_08_US_GI
,

646 .
	gphy_ˇp_öfo
[8] =

647 
IEEE80211_HE_PHY_CAP8_HE_ER_SU_PPDU_4XLTF_AND_08_US_GI
 |

648 
IEEE80211_HE_PHY_CAP8_20MHZ_IN_40MHZ_HE_PPDU_IN_2G
 |

649 
IEEE80211_HE_PHY_CAP8_20MHZ_IN_160MHZ_HE_PPDU
 |

650 
IEEE80211_HE_PHY_CAP8_80MHZ_IN_160MHZ_HE_PPDU
 |

651 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_242
,

652 .
	gphy_ˇp_öfo
[9] =

653 
IEEE80211_HE_PHY_CAP9_RX_FULL_BW_SU_USING_MU_WITH_COMP_SIGB
 |

654 
IEEE80211_HE_PHY_CAP9_RX_FULL_BW_SU_USING_MU_WITH_NON_COMP_SIGB
 |

655 (
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_RESERVED
 <<

656 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_POS
),

657 .
	gphy_ˇp_öfo
[10] =

658 
IEEE80211_HE_PHY_CAP10_HE_MU_M1RU_MAX_LTF
,

665 .
	ghe_mcs_nss_suµ
 = {

666 .
rx_mcs_80
 = 
˝u_to_À16
(0xfffa),

667 .
	gtx_mcs_80
 = 
˝u_to_À16
(0xfffa),

668 .
	grx_mcs_160
 = 
˝u_to_À16
(0xfffa),

669 .
	gtx_mcs_160
 = 
˝u_to_À16
(0xfffa),

670 .
	grx_mcs_80p80
 = 
˝u_to_À16
(0xffff),

671 .
	gtx_mcs_80p80
 = 
˝u_to_À16
(0xffff),

677 .
	gµe_thªs
 = {0x61, 0x1c, 0xc7, 0x71},

679 .
	geht_ˇp
 = {

680 .
has_eht
 = 
åue
,

681 .
	geht_ˇp_ñem
 = {

682 .
mac_ˇp_öfo
[0] =

683 
IEEE80211_EHT_MAC_CAP0_OM_CONTROL
 |

684 
IEEE80211_EHT_MAC_CAP0_TRIG_TXOP_SHARING_MODE1
 |

685 
IEEE80211_EHT_MAC_CAP0_TRIG_TXOP_SHARING_MODE2
 |

686 
IEEE80211_EHT_MAC_CAP0_SCS_TRAFFIC_DESC
,

687 .
	gphy_ˇp_öfo
[0] =

688 
IEEE80211_EHT_PHY_CAP0_242_TONE_RU_GT20MHZ
 |

689 
IEEE80211_EHT_PHY_CAP0_NDP_4_EHT_LFT_32_GI
 |

690 
IEEE80211_EHT_PHY_CAP0_PARTIAL_BW_UL_MU_MIMO
 |

691 
IEEE80211_EHT_PHY_CAP0_SU_BEAMFORMEE
 |

692 
IEEE80211_EHT_PHY_CAP0_BEAMFORMEE_SS_80MHZ_MASK
,

693 .
	gphy_ˇp_öfo
[1] =

694 
IEEE80211_EHT_PHY_CAP1_BEAMFORMEE_SS_80MHZ_MASK
 |

695 
IEEE80211_EHT_PHY_CAP1_BEAMFORMEE_SS_160MHZ_MASK
,

696 .
	gphy_ˇp_öfo
[3] =

697 
IEEE80211_EHT_PHY_CAP3_NG_16_SU_FEEDBACK
 |

698 
IEEE80211_EHT_PHY_CAP3_NG_16_MU_FEEDBACK
 |

699 
IEEE80211_EHT_PHY_CAP3_CODEBOOK_4_2_SU_FDBK
 |

700 
IEEE80211_EHT_PHY_CAP3_CODEBOOK_7_5_MU_FDBK
 |

701 
IEEE80211_EHT_PHY_CAP3_TRIG_SU_BF_FDBK
 |

702 
IEEE80211_EHT_PHY_CAP3_TRIG_MU_BF_PART_BW_FDBK
 |

703 
IEEE80211_EHT_PHY_CAP3_TRIG_CQI_FDBK
,

705 .
	gphy_ˇp_öfo
[4] =

706 
IEEE80211_EHT_PHY_CAP4_PART_BW_DL_MU_MIMO
 |

707 
IEEE80211_EHT_PHY_CAP4_POWER_BOOST_FACT_SUPP
 |

708 
IEEE80211_EHT_PHY_CAP4_EHT_MU_PPDU_4_EHT_LTF_08_GI
,

709 .
	gphy_ˇp_öfo
[5] =

710 
FIELD_PREP_CONST
(
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_MASK
,

711 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_16US
) |

712 
	gIEEE80211_EHT_PHY_CAP5_NON_TRIG_CQI_FEEDBACK
 |

713 
	gIEEE80211_EHT_PHY_CAP5_TX_LESS_242_TONE_RU_SUPP
 |

714 
	gIEEE80211_EHT_PHY_CAP5_RX_LESS_242_TONE_RU_SUPP
,

715 .
	gphy_ˇp_öfo
[6] =

716 
IEEE80211_EHT_PHY_CAP6_MCS15_SUPP_MASK
 |

717 
IEEE80211_EHT_PHY_CAP6_EHT_DUP_6GHZ_SUPP
,

718 .
	gphy_ˇp_öfo
[8] =

719 
IEEE80211_EHT_PHY_CAP8_RX_1024QAM_WIDER_BW_DL_OFDMA
 |

720 
IEEE80211_EHT_PHY_CAP8_RX_4096QAM_WIDER_BW_DL_OFDMA
,

727 .
	geht_mcs_nss_suµ
 = {

728 .
bw
.
_80
 = {

729 .
rx_tx_mcs9_max_nss
 = 0x22,

730 .
	grx_tx_mcs11_max_nss
 = 0x22,

731 .
	grx_tx_mcs13_max_nss
 = 0x22,

733 .
	gbw
.
	g_160
 = {

734 .
rx_tx_mcs9_max_nss
 = 0x22,

735 .
	grx_tx_mcs11_max_nss
 = 0x22,

736 .
	grx_tx_mcs13_max_nss
 = 0x22,

738 .
	gbw
.
	g_320
 = {

739 .
rx_tx_mcs9_max_nss
 = 0x22,

740 .
	grx_tx_mcs11_max_nss
 = 0x22,

741 .
	grx_tx_mcs13_max_nss
 = 0x22,

752 .
	geht_µe_thªs
 = {0xc1, 0x0e, 0xe0 }

756 .
	gty≥s_mask
 = 
BIT
(
NL80211_IFTYPE_AP
),

757 .
	ghe_ˇp
 = {

758 .
has_he
 = 
åue
,

759 .
	ghe_ˇp_ñem
 = {

760 .
mac_ˇp_öfo
[0] =

761 
IEEE80211_HE_MAC_CAP0_HTC_HE
,

762 .
	gmac_ˇp_öfo
[1] =

763 
IEEE80211_HE_MAC_CAP1_MULTI_TID_AGG_RX_QOS_8
,

764 .
	gmac_ˇp_öfo
[3] =

765 
IEEE80211_HE_MAC_CAP3_OMI_CONTROL
,

766 .
	gphy_ˇp_öfo
[1] =

767 
IEEE80211_HE_PHY_CAP1_LDPC_CODING_IN_PAYLOAD
,

768 .
	gphy_ˇp_öfo
[2] =

769 
IEEE80211_HE_PHY_CAP2_STBC_RX_UNDER_80MHZ
 |

770 
IEEE80211_HE_PHY_CAP2_NDP_4x_LTF_AND_3_2US
,

771 .
	gphy_ˇp_öfo
[3] =

772 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_BPSK
 |

773 
IEEE80211_HE_PHY_CAP3_DCM_MAX_TX_NSS_1
 |

774 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_BPSK
 |

775 
IEEE80211_HE_PHY_CAP3_DCM_MAX_RX_NSS_1
,

776 .
	gphy_ˇp_öfo
[6] =

777 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
,

778 .
	gphy_ˇp_öfo
[7] =

779 
IEEE80211_HE_PHY_CAP7_HE_SU_MU_PPDU_4XLTF_AND_08_US_GI
,

780 .
	gphy_ˇp_öfo
[8] =

781 
IEEE80211_HE_PHY_CAP8_HE_ER_SU_PPDU_4XLTF_AND_08_US_GI
 |

782 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_242
,

783 .
	gphy_ˇp_öfo
[9] =

784 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_RESERVED


785 << 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_POS
,

792 .
	ghe_mcs_nss_suµ
 = {

793 .
rx_mcs_80
 = 
˝u_to_À16
(0xfffa),

794 .
	gtx_mcs_80
 = 
˝u_to_À16
(0xfffa),

795 .
	grx_mcs_160
 = 
˝u_to_À16
(0xfffa),

796 .
	gtx_mcs_160
 = 
˝u_to_À16
(0xfffa),

797 .
	grx_mcs_80p80
 = 
˝u_to_À16
(0xffff),

798 .
	gtx_mcs_80p80
 = 
˝u_to_À16
(0xffff),

804 .
	gµe_thªs
 = {0x61, 0x1c, 0xc7, 0x71},

806 .
	geht_ˇp
 = {

807 .
has_eht
 = 
åue
,

808 .
	geht_ˇp_ñem
 = {

809 .
mac_ˇp_öfo
[0] =

810 
IEEE80211_EHT_MAC_CAP0_OM_CONTROL
 |

811 
IEEE80211_EHT_MAC_CAP0_TRIG_TXOP_SHARING_MODE1
 |

812 
IEEE80211_EHT_MAC_CAP0_TRIG_TXOP_SHARING_MODE2
,

813 .
	gphy_ˇp_öfo
[0] =

814 
IEEE80211_EHT_PHY_CAP0_242_TONE_RU_GT20MHZ
 |

815 
IEEE80211_EHT_PHY_CAP0_NDP_4_EHT_LFT_32_GI
,

816 .
	gphy_ˇp_öfo
[5] =

817 
FIELD_PREP_CONST
(
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_MASK
,

818 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_16US
),

825 .
	geht_mcs_nss_suµ
 = {

826 .
bw
.
_80
 = {

827 .
rx_tx_mcs9_max_nss
 = 0x22,

828 .
	grx_tx_mcs11_max_nss
 = 0x22,

829 .
	grx_tx_mcs13_max_nss
 = 0x22,

831 .
	gbw
.
	g_160
 = {

832 .
rx_tx_mcs9_max_nss
 = 0x22,

833 .
	grx_tx_mcs11_max_nss
 = 0x22,

834 .
	grx_tx_mcs13_max_nss
 = 0x22,

836 .
	gbw
.
	g_320
 = {

837 .
rx_tx_mcs9_max_nss
 = 0x22,

838 .
	grx_tx_mcs11_max_nss
 = 0x22,

839 .
	grx_tx_mcs13_max_nss
 = 0x22,

850 .
	geht_µe_thªs
 = {0xc1, 0x0e, 0xe0 }

855 
	$iwl_öô_he_6ghz_ˇ∑
(
iwl_å™s
 *
å™s
,

856 
iwl_nvm_d©a
 *
d©a
,

857 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

858 
u8
 
tx_chaös
, u8 
rx_chaös
)

860 
õì80211_°a_ht_ˇp
 
ht_ˇp
;

861 
õì80211_°a_vht_ˇp
 
vht_ˇp
 = {};

862 
õì80211_sb™d_i·y≥_d©a
 *
i·y≥_d©a
;

863 
u16
 
he_6ghz_ˇ∑
 = 0;

864 
u32
 
exp
;

865 
i
;

867 i‡(
sb™d
->
b™d
 !
NL80211_BAND_6GHZ
)

871 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
ht_ˇp
, 
NL80211_BAND_5GHZ
,

872 
tx_chaös
, 
rx_chaös
);

873 
	`WARN_ON
(!
ht_ˇp
.
ht_suµ‹ãd
);

874 
	`iwl_öô_vht_hw_ˇ∑b
(
å™s
, 
d©a
, &
vht_ˇp
, 
tx_chaös
, 
rx_chaös
);

875 
	`WARN_ON
(!
vht_ˇp
.
vht_suµ‹ãd
);

877 
he_6ghz_ˇ∑
 |=

878 
	`u16_ícode_bôs
(
ht_ˇp
.
ampdu_dísôy
,

879 
IEEE80211_HE_6GHZ_CAP_MIN_MPDU_START
);

880 
exp
 = 
	`u32_gë_bôs
(
vht_ˇp
.
ˇp
,

881 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
);

882 
he_6ghz_ˇ∑
 |=

883 
	`u16_ícode_bôs
(
exp
, 
IEEE80211_HE_6GHZ_CAP_MAX_AMPDU_LEN_EXP
);

884 
exp
 = 
	`u32_gë_bôs
(
vht_ˇp
.
ˇp
, 
IEEE80211_VHT_CAP_MAX_MPDU_MASK
);

885 
he_6ghz_ˇ∑
 |=

886 
	`u16_ícode_bôs
(
exp
, 
IEEE80211_HE_6GHZ_CAP_MAX_MPDU_LEN
);

888 i‡(
vht_ˇp
.
ˇp
 & 
IEEE80211_VHT_CAP_TX_ANTENNA_PATTERN
)

889 
he_6ghz_ˇ∑
 |
IEEE80211_HE_6GHZ_CAP_TX_ANTPAT_CONS
;

890 i‡(
vht_ˇp
.
ˇp
 & 
IEEE80211_VHT_CAP_RX_ANTENNA_PATTERN
)

891 
he_6ghz_ˇ∑
 |
IEEE80211_HE_6GHZ_CAP_RX_ANTPAT_CONS
;

893 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "he_6ghz_ˇ∑=0x%x\n", 
he_6ghz_ˇ∑
);

896 
i·y≥_d©a
 = (*)(
uöçå_t
)
sb™d
->iftype_data;

897 
i
 = 0; i < 
sb™d
->
n_i·y≥_d©a
; i++)

898 
i·y≥_d©a
[
i
].
he_6ghz_ˇ∑
.
ˇ∑
 = 
	`˝u_to_À16
(he_6ghz_capa);

899 
	}
}

902 
	$iwl_nvm_fixup_sb™d_i·d
(
iwl_å™s
 *
å™s
,

903 
iwl_nvm_d©a
 *
d©a
,

904 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

905 
õì80211_sb™d_i·y≥_d©a
 *
i·y≥_d©a
,

906 
u8
 
tx_chaös
, u8 
rx_chaös
,

907 c⁄° 
iwl_fw
 *
fw
)

909 
boﬁ
 
is_≠
 = 
i·y≥_d©a
->
ty≥s_mask
 & 
	`BIT
(
NL80211_IFTYPE_AP
);

910 
boﬁ
 
no_320
;

912 
no_320
 = (!
å™s
->
å™s_cfg
->
öãgøãd
 &&

913 
å™s
->
pcõ_lök_•ìd
 < 
PCI_EXP_LNKSTA_CLS_8_0GB
) ||

914 
å™s
->
ªdu˚d_ˇp_sku
;

916 i‡(!
d©a
->
sku_ˇp_11be_íabÀ
 || 
iwlwifi_mod_∑øms
.
dißbÀ_11be
)

917 
i·y≥_d©a
->
eht_ˇp
.
has_eht
 = 
Ál£
;

922 i‡(
sb™d
->
b™d
 =
NL80211_BAND_6GHZ
 && 
i·y≥_d©a
->
eht_ˇp
.
has_eht
)

923 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[3] |=

924 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_2
;

925 i‡(
sb™d
->
b™d
 !
NL80211_BAND_2GHZ
)

926 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[3] |=

927 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_1
;

929 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[3] |=

930 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_3
;

932 
sb™d
->
b™d
) {

933 
NL80211_BAND_2GHZ
:

934 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[0] |=

935 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
;

936 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
mac_ˇp_öfo
[0] |=

937 
	`u8_ícode_bôs
(
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_11454
,

938 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_MASK
);

940 
NL80211_BAND_6GHZ
:

941 i‡(!
no_320
) {

942 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[0] |=

943 
IEEE80211_EHT_PHY_CAP0_320MHZ_IN_6GHZ
;

944 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[1] |=

945 
IEEE80211_EHT_PHY_CAP1_BEAMFORMEE_SS_320MHZ_MASK
;

947 
ÁŒthrough
;

948 
NL80211_BAND_5GHZ
:

949 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[0] |=

950 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_80MHZ_IN_5G
 |

951 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

954 
	`WARN_ON
(1);

958 i‡((
tx_chaös
 & 
rx_chaös
Ë=
ANT_AB
) {

959 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[2] |=

960 
IEEE80211_HE_PHY_CAP2_STBC_TX_UNDER_80MHZ
;

961 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[5] |=

962 
IEEE80211_HE_PHY_CAP5_BEAMFORMEE_NUM_SND_DIM_UNDER_80MHZ_2
 |

963 
IEEE80211_HE_PHY_CAP5_BEAMFORMEE_NUM_SND_DIM_ABOVE_80MHZ_2
;

964 i‡(!
is_≠
) {

965 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[7] |=

966 
IEEE80211_HE_PHY_CAP7_MAX_NC_2
;

968 i‡(
i·y≥_d©a
->
eht_ˇp
.
has_eht
) {

974 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[2] |= 0x49;

980 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[4] |= 0x10;

984 
õì80211_he_mcs_nss_suµ
 *
he_mcs_nss_suµ
 =

985 &
i·y≥_d©a
->
he_ˇp
.
he_mcs_nss_suµ
;

987 i‡(
i·y≥_d©a
->
eht_ˇp
.
has_eht
) {

988 
õì80211_eht_mcs_nss_suµ
 *
mcs_nss
 =

989 &
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
;

991 
	`mem£t
(
mcs_nss
, 0x11, (*mcs_nss));

994 i‡(!
is_≠
) {

998 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[1] &=

999 ~
IEEE80211_HE_PHY_CAP1_MIDAMBLE_RX_TX_MAX_NSTS
;

1000 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[2] &=

1001 ~
IEEE80211_HE_PHY_CAP2_MIDAMBLE_RX_TX_MAX_NSTS
;

1002 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[7] |=

1003 
IEEE80211_HE_PHY_CAP7_MAX_NC_1
;

1006 
he_mcs_nss_suµ
->
rx_mcs_80
 |=

1007 
	`˝u_to_À16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 2);

1008 
he_mcs_nss_suµ
->
tx_mcs_80
 |=

1009 
	`˝u_to_À16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 2);

1010 
he_mcs_nss_suµ
->
rx_mcs_160
 |=

1011 
	`˝u_to_À16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 2);

1012 
he_mcs_nss_suµ
->
tx_mcs_160
 |=

1013 
	`˝u_to_À16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 2);

1014 
he_mcs_nss_suµ
->
rx_mcs_80p80
 |=

1015 
	`˝u_to_À16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 2);

1016 
he_mcs_nss_suµ
->
tx_mcs_80p80
 |=

1017 
	`˝u_to_À16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 2);

1020 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
 && !
is_≠
)

1021 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[2] |=

1022 
IEEE80211_HE_PHY_CAP2_UL_MU_FULL_MU_MIMO
;

1024 
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
)) {

1025 
IWL_CFG_RF_TYPE_GF
:

1026 
IWL_CFG_RF_TYPE_MR
:

1027 
IWL_CFG_RF_TYPE_MS
:

1028 
IWL_CFG_RF_TYPE_FM
:

1029 
IWL_CFG_RF_TYPE_WH
:

1030 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[9] |=

1031 
IEEE80211_HE_PHY_CAP9_TX_1024_QAM_LESS_THAN_242_TONE_RU
;

1032 i‡(!
is_≠
)

1033 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[9] |=

1034 
IEEE80211_HE_PHY_CAP9_RX_1024_QAM_LESS_THAN_242_TONE_RU
;

1038 i‡(
	`CSR_HW_REV_TYPE
(
å™s
->
hw_ªv
Ë=
IWL_CFG_MAC_TYPE_GL
 &&

1039 
i·y≥_d©a
->
eht_ˇp
.
has_eht
) {

1040 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
mac_ˇp_öfo
[0] &=

1041 ~(
IEEE80211_EHT_MAC_CAP0_TRIG_TXOP_SHARING_MODE1
 |

1042 
IEEE80211_EHT_MAC_CAP0_TRIG_TXOP_SHARING_MODE2
);

1043 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[3] &=

1044 ~(
IEEE80211_EHT_PHY_CAP0_PARTIAL_BW_UL_MU_MIMO
 |

1045 
IEEE80211_EHT_PHY_CAP3_NG_16_SU_FEEDBACK
 |

1046 
IEEE80211_EHT_PHY_CAP3_NG_16_MU_FEEDBACK
 |

1047 
IEEE80211_EHT_PHY_CAP3_CODEBOOK_4_2_SU_FDBK
 |

1048 
IEEE80211_EHT_PHY_CAP3_CODEBOOK_7_5_MU_FDBK
 |

1049 
IEEE80211_EHT_PHY_CAP3_TRIG_MU_BF_PART_BW_FDBK
 |

1050 
IEEE80211_EHT_PHY_CAP3_TRIG_CQI_FDBK
);

1051 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[4] &=

1052 ~(
IEEE80211_EHT_PHY_CAP4_PART_BW_DL_MU_MIMO
 |

1053 
IEEE80211_EHT_PHY_CAP4_POWER_BOOST_FACT_SUPP
);

1054 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[5] &=

1055 ~
IEEE80211_EHT_PHY_CAP5_NON_TRIG_CQI_FEEDBACK
;

1056 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[6] &=

1057 ~(
IEEE80211_EHT_PHY_CAP6_MCS15_SUPP_MASK
 |

1058 
IEEE80211_EHT_PHY_CAP6_EHT_DUP_6GHZ_SUPP
);

1059 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[5] |=

1060 
IEEE80211_EHT_PHY_CAP5_SUPP_EXTRA_EHT_LTF
;

1063 i‡(
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_BROADCAST_TWT
))

1064 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[2] |=

1065 
IEEE80211_HE_MAC_CAP2_BCAST_TWT
;

1067 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_22000
 &&

1068 !
is_≠
) {

1069 
i·y≥_d©a
->
víd‹_ñems
.
d©a
 = 
iwl_víd‹_ˇps
;

1070 
i·y≥_d©a
->
víd‹_ñems
.
Àn
 = 
	`ARRAY_SIZE
(
iwl_víd‹_ˇps
);

1073 i‡(!
å™s
->
cfg
->
ht_∑øms
->
°bc
) {

1074 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[2] &=

1075 ~
IEEE80211_HE_PHY_CAP2_STBC_RX_UNDER_80MHZ
;

1076 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[7] &=

1077 ~
IEEE80211_HE_PHY_CAP7_STBC_RX_ABOVE_80MHZ
;

1080 i‡(
å™s
->
°ï_urm
) {

1081 
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
.
bw
.
_320
.
rx_tx_mcs11_max_nss
 = 0;

1082 
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
.
bw
.
_320
.
rx_tx_mcs13_max_nss
 = 0;

1085 i‡(
å™s
->
no_160
)

1086 
i·y≥_d©a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[0] &=

1087 ~
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

1089 i‡(
å™s
->
ªdu˚d_ˇp_sku
) {

1090 
	`mem£t
(&
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
.
bw
.
_320
, 0,

1091 (
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
.
bw
.
_320
));

1092 
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
.
bw
.
_80
.
rx_tx_mcs13_max_nss
 = 0;

1093 
i·y≥_d©a
->
eht_ˇp
.
eht_mcs_nss_suµ
.
bw
.
_160
.
rx_tx_mcs13_max_nss
 = 0;

1094 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[8] &=

1095 ~
IEEE80211_EHT_PHY_CAP8_RX_4096QAM_WIDER_BW_DL_OFDMA
;

1096 
i·y≥_d©a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[2] &=

1097 ~
IEEE80211_EHT_PHY_CAP2_SOUNDING_DIM_320MHZ_MASK
;

1099 
	}
}

1101 
	$iwl_öô_he_hw_ˇ∑b
(
iwl_å™s
 *
å™s
,

1102 
iwl_nvm_d©a
 *
d©a
,

1103 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

1104 
u8
 
tx_chaös
, u8 
rx_chaös
,

1105 c⁄° 
iwl_fw
 *
fw
)

1107 
õì80211_sb™d_i·y≥_d©a
 *
i·y≥_d©a
;

1108 
i
;

1110 
	`BUILD_BUG_ON
((
d©a
->
i·d
.
low
Ë!(
iwl_he_eht_ˇ∑
));

1111 
	`BUILD_BUG_ON
((
d©a
->
i·d
.
high
Ë!(
iwl_he_eht_ˇ∑
));

1112 
	`BUILD_BUG_ON
((
d©a
->
i·d
.
uhb
Ë!(
iwl_he_eht_ˇ∑
));

1114 
sb™d
->
b™d
) {

1115 
NL80211_BAND_2GHZ
:

1116 
i·y≥_d©a
 = 
d©a
->
i·d
.
low
;

1118 
NL80211_BAND_5GHZ
:

1119 
i·y≥_d©a
 = 
d©a
->
i·d
.
high
;

1121 
NL80211_BAND_6GHZ
:

1122 
i·y≥_d©a
 = 
d©a
->
i·d
.
uhb
;

1125 
	`WARN_ON
(1);

1129 
	`mem˝y
(
i·y≥_d©a
, 
iwl_he_eht_ˇ∑
, (iwl_he_eht_capa));

1131 
	`_õì80211_£t_sb™d_i·y≥_d©a
(
sb™d
, 
i·y≥_d©a
,

1132 
	`ARRAY_SIZE
(
iwl_he_eht_ˇ∑
));

1134 
i
 = 0; i < 
sb™d
->
n_i·y≥_d©a
; i++)

1135 
	`iwl_nvm_fixup_sb™d_i·d
(
å™s
, 
d©a
, 
sb™d
, &
i·y≥_d©a
[
i
],

1136 
tx_chaös
, 
rx_chaös
, 
fw
);

1138 
	`iwl_öô_he_6ghz_ˇ∑
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
);

1139 
	}
}

1141 
	$iwl_ªöô_ˇb
(
iwl_å™s
 *
å™s
, 
iwl_nvm_d©a
 *
d©a
,

1142 
u8
 
tx_chaös
, u8 
rx_chaös
, c⁄° 
iwl_fw
 *
fw
)

1144 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

1146 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

1147 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
ht_ˇp
, 
NL80211_BAND_2GHZ
,

1148 
tx_chaös
, 
rx_chaös
);

1150 i‡(
d©a
->
sku_ˇp_11ax_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1151 
	`iwl_öô_he_hw_ˇ∑b
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
,

1152 
fw
);

1154 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

1155 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
ht_ˇp
, 
NL80211_BAND_5GHZ
,

1156 
tx_chaös
, 
rx_chaös
);

1157 i‡(
d©a
->
sku_ˇp_11ac_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ac
)

1158 
	`iwl_öô_vht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
vht_ˇp
,

1159 
tx_chaös
, 
rx_chaös
);

1161 i‡(
d©a
->
sku_ˇp_11ax_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1162 
	`iwl_öô_he_hw_ˇ∑b
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
,

1163 
fw
);

1165 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_6GHZ
];

1166 i‡(
d©a
->
sku_ˇp_11ax_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1167 
	`iwl_öô_he_hw_ˇ∑b
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
,

1168 
fw
);

1169 
	}
}

1170 
IWL_EXPORT_SYMBOL
(
iwl_ªöô_ˇb
);

1172 
	$iwl_öô_sb™ds
(
iwl_å™s
 *
å™s
,

1173 
iwl_nvm_d©a
 *
d©a
,

1174 c⁄° *
nvm_ch_Êags
, 
u8
 
tx_chaös
,

1175 
u8
 
rx_chaös
, 
u32
 
sb™ds_Êags
, 
boﬁ
 
v4
,

1176 c⁄° 
iwl_fw
 *
fw
)

1178 
devi˚
 *
dev
 = 
å™s
->dev;

1179 c⁄° 
iwl_cfg
 *
cfg
 = 
å™s
->cfg;

1180 
n_ch™√ls
;

1181 
n_u£d
 = 0;

1182 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

1184 
n_ch™√ls
 = 
	`iwl_öô_ch™√l_m≠
(
dev
, 
cfg
, 
d©a
, 
nvm_ch_Êags
,

1185 
sb™ds_Êags
, 
v4
);

1186 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

1187 
sb™d
->
b™d
 = 
NL80211_BAND_2GHZ
;

1188 
sb™d
->
bôøãs
 = &
iwl_cfg80211_øãs
[
RATES_24_OFFS
];

1189 
sb™d
->
n_bôøãs
 = 
N_RATES_24
;

1190 
n_u£d
 +
	`iwl_öô_sb™d_ch™√ls
(
d©a
, 
sb™d
, 
n_ch™√ls
,

1191 
NL80211_BAND_2GHZ
);

1192 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
ht_ˇp
, 
NL80211_BAND_2GHZ
,

1193 
tx_chaös
, 
rx_chaös
);

1195 i‡(
d©a
->
sku_ˇp_11ax_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1196 
	`iwl_öô_he_hw_ˇ∑b
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
,

1197 
fw
);

1199 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

1200 
sb™d
->
b™d
 = 
NL80211_BAND_5GHZ
;

1201 
sb™d
->
bôøãs
 = &
iwl_cfg80211_øãs
[
RATES_52_OFFS
];

1202 
sb™d
->
n_bôøãs
 = 
N_RATES_52
;

1203 
n_u£d
 +
	`iwl_öô_sb™d_ch™√ls
(
d©a
, 
sb™d
, 
n_ch™√ls
,

1204 
NL80211_BAND_5GHZ
);

1205 
	`iwl_öô_ht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
ht_ˇp
, 
NL80211_BAND_5GHZ
,

1206 
tx_chaös
, 
rx_chaös
);

1207 i‡(
d©a
->
sku_ˇp_11ac_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ac
)

1208 
	`iwl_öô_vht_hw_ˇ∑b
(
å™s
, 
d©a
, &
sb™d
->
vht_ˇp
,

1209 
tx_chaös
, 
rx_chaös
);

1211 i‡(
d©a
->
sku_ˇp_11ax_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1212 
	`iwl_öô_he_hw_ˇ∑b
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
,

1213 
fw
);

1216 
sb™d
 = &
d©a
->
b™ds
[
NL80211_BAND_6GHZ
];

1217 
sb™d
->
b™d
 = 
NL80211_BAND_6GHZ
;

1219 
sb™d
->
bôøãs
 = &
iwl_cfg80211_øãs
[
RATES_52_OFFS
];

1220 
sb™d
->
n_bôøãs
 = 
N_RATES_52
;

1221 
n_u£d
 +
	`iwl_öô_sb™d_ch™√ls
(
d©a
, 
sb™d
, 
n_ch™√ls
,

1222 
NL80211_BAND_6GHZ
);

1224 i‡(
d©a
->
sku_ˇp_11ax_íabÀ
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1225 
	`iwl_öô_he_hw_ˇ∑b
(
å™s
, 
d©a
, 
sb™d
, 
tx_chaös
, 
rx_chaös
,

1226 
fw
);

1228 
sb™d
->
n_ch™√ls
 = 0;

1229 i‡(
n_ch™√ls
 !
n_u£d
)

1230 
	`IWL_ERR_DEV
(
dev
, "NVM: used only %d of %d channels\n",

1231 
n_u£d
, 
n_ch™√ls
);

1232 
	}
}

1234 
	$iwl_gë_sku
(c⁄° 
iwl_cfg
 *
cfg
, c⁄° 
__À16
 *
nvm_sw
,

1235 c⁄° 
__À16
 *
phy_sku
)

1237 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
)

1238  
	`À16_to_˝up
(
nvm_sw
 + 
SKU
);

1240  
	`À32_to_˝up
((c⁄° 
__À32
 *)(
phy_sku
 + 
SKU_FAMILY_8000
));

1241 
	}
}

1243 
	$iwl_gë_nvm_vîsi⁄
(c⁄° 
iwl_cfg
 *
cfg
, c⁄° 
__À16
 *
nvm_sw
)

1245 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
)

1246  
	`À16_to_˝up
(
nvm_sw
 + 
NVM_VERSION
);

1248  
	`À32_to_˝up
((c⁄° 
__À32
 *)(
nvm_sw
 +

1249 
NVM_VERSION_EXT_NVM
));

1250 
	}
}

1252 
	$iwl_gë_ødio_cfg
(c⁄° 
iwl_cfg
 *
cfg
, c⁄° 
__À16
 *
nvm_sw
,

1253 c⁄° 
__À16
 *
phy_sku
)

1255 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
)

1256  
	`À16_to_˝up
(
nvm_sw
 + 
RADIO_CFG
);

1258  
	`À32_to_˝up
((c⁄° 
__À32
 *)(
phy_sku
 + 
RADIO_CFG_FAMILY_EXT_NVM
));

1260 
	}
}

1262 
	$iwl_gë_n_hw_addrs
(c⁄° 
iwl_cfg
 *
cfg
, c⁄° 
__À16
 *
nvm_sw
)

1264 
n_hw_addr
;

1266 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
)

1267  
	`À16_to_˝up
(
nvm_sw
 + 
N_HW_ADDRS
);

1269 
n_hw_addr
 = 
	`À32_to_˝up
((c⁄° 
__À32
 *)(
nvm_sw
 + 
N_HW_ADDRS_FAMILY_8000
));

1271  
n_hw_addr
 & 
N_HW_ADDR_MASK
;

1272 
	}
}

1274 
	$iwl_£t_ødio_cfg
(c⁄° 
iwl_cfg
 *
cfg
,

1275 
iwl_nvm_d©a
 *
d©a
,

1276 
u32
 
ødio_cfg
)

1278 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
) {

1279 
d©a
->
ødio_cfg_ty≥
 = 
	`NVM_RF_CFG_TYPE_MSK
(
ødio_cfg
);

1280 
d©a
->
ødio_cfg_°ï
 = 
	`NVM_RF_CFG_STEP_MSK
(
ødio_cfg
);

1281 
d©a
->
ødio_cfg_dash
 = 
	`NVM_RF_CFG_DASH_MSK
(
ødio_cfg
);

1282 
d©a
->
ødio_cfg_≤um
 = 
	`NVM_RF_CFG_PNUM_MSK
(
ødio_cfg
);

1287 
d©a
->
ødio_cfg_ty≥
 = 
	`EXT_NVM_RF_CFG_TYPE_MSK
(
ødio_cfg
);

1288 
d©a
->
ødio_cfg_°ï
 = 
	`EXT_NVM_RF_CFG_STEP_MSK
(
ødio_cfg
);

1289 
d©a
->
ødio_cfg_dash
 = 
	`EXT_NVM_RF_CFG_DASH_MSK
(
ødio_cfg
);

1290 
d©a
->
ødio_cfg_≤um
 = 
	`EXT_NVM_RF_CFG_FLAVOR_MSK
(
ødio_cfg
);

1291 
d©a
->
vÆid_tx_™t
 = 
	`EXT_NVM_RF_CFG_TX_ANT_MSK
(
ødio_cfg
);

1292 
d©a
->
vÆid_rx_™t
 = 
	`EXT_NVM_RF_CFG_RX_ANT_MSK
(
ødio_cfg
);

1293 
	}
}

1295 
	$iwl_Êù_hw_addªss
(
__À32
 
mac_addr0
, __À32 
mac_addr1
, 
u8
 *
de°
)

1297 c⁄° 
u8
 *
hw_addr
;

1299 
hw_addr
 = (c⁄° 
u8
 *)&
mac_addr0
;

1300 
de°
[0] = 
hw_addr
[3];

1301 
de°
[1] = 
hw_addr
[2];

1302 
de°
[2] = 
hw_addr
[1];

1303 
de°
[3] = 
hw_addr
[0];

1305 
hw_addr
 = (c⁄° 
u8
 *)&
mac_addr1
;

1306 
de°
[4] = 
hw_addr
[1];

1307 
de°
[5] = 
hw_addr
[0];

1308 
	}
}

1310 
	$iwl_£t_hw_addªss_‰om_c§
(
iwl_å™s
 *
å™s
,

1311 
iwl_nvm_d©a
 *
d©a
)

1313 
__À32
 
mac_addr0
 = 
	`˝u_to_À32
(
	`iwl_ªad32
(
å™s
,

1314 
	`CSR_MAC_ADDR0_STRAP
(
å™s
)));

1315 
__À32
 
mac_addr1
 = 
	`˝u_to_À32
(
	`iwl_ªad32
(
å™s
,

1316 
	`CSR_MAC_ADDR1_STRAP
(
å™s
)));

1318 
	`iwl_Êù_hw_addªss
(
mac_addr0
, 
mac_addr1
, 
d©a
->
hw_addr
);

1323 i‡(
	`is_vÆid_ëhî_addr
(
d©a
->
hw_addr
))

1326 
mac_addr0
 = 
	`˝u_to_À32
(
	`iwl_ªad32
(
å™s
, 
	`CSR_MAC_ADDR0_OTP
(trans)));

1327 
mac_addr1
 = 
	`˝u_to_À32
(
	`iwl_ªad32
(
å™s
, 
	`CSR_MAC_ADDR1_OTP
(trans)));

1329 
	`iwl_Êù_hw_addªss
(
mac_addr0
, 
mac_addr1
, 
d©a
->
hw_addr
);

1330 
	}
}

1332 
	$iwl_£t_hw_addªss_Ámûy_8000
(
iwl_å™s
 *
å™s
,

1333 c⁄° 
iwl_cfg
 *
cfg
,

1334 
iwl_nvm_d©a
 *
d©a
,

1335 c⁄° 
__À16
 *
mac_ovîride
,

1336 c⁄° 
__be16
 *
nvm_hw
)

1338 c⁄° 
u8
 *
hw_addr
;

1340 i‡(
mac_ovîride
) {

1341 c⁄° 
u8
 
ª£rved_mac
[] = {

1345 
hw_addr
 = (c⁄° 
u8
 *)(
mac_ovîride
 +

1346 
MAC_ADDRESS_OVERRIDE_EXT_NVM
);

1352 
	`mem˝y
(
d©a
->
hw_addr
, hw_addr, 
ETH_ALEN
);

1358 i‡(
	`is_vÆid_ëhî_addr
(
d©a
->
hw_addr
) &&

1359 
	`memcmp
(
ª£rved_mac
, 
hw_addr
, 
ETH_ALEN
) != 0)

1362 
	`IWL_ERR
(
å™s
,

1366 i‡(
nvm_hw
) {

1368 
__À32
 
mac_addr0
 = 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
å™s
,

1369 
WFMP_MAC_ADDR_0
));

1370 
__À32
 
mac_addr1
 = 
	`˝u_to_À32
(
	`iwl_å™s_ªad_¥ph
(
å™s
,

1371 
WFMP_MAC_ADDR_1
));

1373 
	`iwl_Êù_hw_addªss
(
mac_addr0
, 
mac_addr1
, 
d©a
->
hw_addr
);

1378 
	`IWL_ERR
(
å™s
, "macáddress isÇot found\n");

1379 
	}
}

1381 
	$iwl_£t_hw_addªss
(
iwl_å™s
 *
å™s
,

1382 c⁄° 
iwl_cfg
 *
cfg
,

1383 
iwl_nvm_d©a
 *
d©a
, c⁄° 
__be16
 *
nvm_hw
,

1384 c⁄° 
__À16
 *
mac_ovîride
)

1386 i‡(
cfg
->
mac_addr_‰om_c§
) {

1387 
	`iwl_£t_hw_addªss_‰om_c§
(
å™s
, 
d©a
);

1388 } i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
) {

1389 c⁄° 
u8
 *
hw_addr
 = (c⁄° u8 *)(
nvm_hw
 + 
HW_ADDR
);

1392 
d©a
->
hw_addr
[0] = hw_addr[1];

1393 
d©a
->
hw_addr
[1] = hw_addr[0];

1394 
d©a
->
hw_addr
[2] = hw_addr[3];

1395 
d©a
->
hw_addr
[3] = hw_addr[2];

1396 
d©a
->
hw_addr
[4] = hw_addr[5];

1397 
d©a
->
hw_addr
[5] = hw_addr[4];

1399 
	`iwl_£t_hw_addªss_Ámûy_8000
(
å™s
, 
cfg
, 
d©a
,

1400 
mac_ovîride
, 
nvm_hw
);

1403 i‡(!
	`is_vÆid_ëhî_addr
(
d©a
->
hw_addr
)) {

1404 
	`IWL_ERR
(
å™s
, "no valid macáddress was found\n");

1405  -
EINVAL
;

1408 i‡(!
å™s
->
csme_own
)

1409 
	`IWL_INFO
(
å™s
, "base HWáddress: %pM, OTP minor version: 0x%x\n",

1410 
d©a
->
hw_addr
, 
	`iwl_ªad_¥ph
(
å™s
, 
REG_OTP_MINOR
));

1413 
	}
}

1415 
boﬁ


1416 
	$iwl_nvm_no_wide_ö_5ghz
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

1417 c⁄° 
__be16
 *
nvm_hw
)

1428 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_7000
) {

1433 
u16
 
subsy°em_id
 = 
	`be16_to_˝up
(
nvm_hw
 + 
SUBSYSTEM_ID
);

1434 
u8
 
sku
 = (
subsy°em_id
 & 0x1e) >> 1;

1436 i‡(
sku
 == 5 || sku == 9) {

1437 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
,

1439 
subsy°em_id
, 
sku
);

1440  
åue
;

1444  
Ál£
;

1445 
	}
}

1447 
iwl_nvm_d©a
 *

1448 
	$iwl_∑r£_mei_nvm_d©a
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

1449 c⁄° 
iwl_mei_nvm
 *
mei_nvm
,

1450 c⁄° 
iwl_fw
 *
fw
, 
u8
 
tx_™t
, u8 
rx_™t
)

1452 
iwl_nvm_d©a
 *
d©a
;

1453 
u32
 
sb™ds_Êags
 = 0;

1454 
u8
 
rx_chaös
 = 
fw
->
vÆid_rx_™t
;

1455 
u8
 
tx_chaös
 = 
fw
->
vÆid_rx_™t
;

1457 i‡(
cfg
->
uhb_suµ‹ãd
)

1458 
d©a
 = 
	`kzÆloc
(
	`°ru˘_size
(d©a, 
ch™√ls
,

1459 
IWL_NVM_NUM_CHANNELS_UHB
),

1460 
GFP_KERNEL
);

1462 
d©a
 = 
	`kzÆloc
(
	`°ru˘_size
(d©a, 
ch™√ls
,

1463 
IWL_NVM_NUM_CHANNELS_EXT
),

1464 
GFP_KERNEL
);

1465 i‡(!
d©a
)

1466  
NULL
;

1468 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
mei_nvm
->
ch™√ls
) !=

1469 
IWL_NVM_NUM_CHANNELS_UHB
);

1470 
d©a
->
nvm_vîsi⁄
 = 
mei_nvm
->nvm_version;

1472 
	`iwl_£t_ødio_cfg
(
cfg
, 
d©a
, 
mei_nvm
->
ødio_cfg
);

1473 i‡(
d©a
->
vÆid_tx_™t
)

1474 
tx_chaös
 &
d©a
->
vÆid_tx_™t
;

1475 i‡(
d©a
->
vÆid_rx_™t
)

1476 
rx_chaös
 &
d©a
->
vÆid_rx_™t
;

1477 i‡(
tx_™t
)

1478 
tx_chaös
 &
tx_™t
;

1479 i‡(
rx_™t
)

1480 
rx_chaös
 &
rx_™t
;

1482 
d©a
->
sku_ˇp_mimo_dißbÀd
 = 
Ál£
;

1483 
d©a
->
sku_ˇp_b™d_24ghz_íabÀ
 = 
åue
;

1484 
d©a
->
sku_ˇp_b™d_52ghz_íabÀ
 = 
åue
;

1485 
d©a
->
sku_ˇp_11n_íabÀ
 =

1486 !(
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_DISABLE_HT_ALL
);

1487 
d©a
->
sku_ˇp_11ac_íabÀ
 = 
åue
;

1488 
d©a
->
sku_ˇp_11ax_íabÀ
 =

1489 
mei_nvm
->
ˇps
 & 
MEI_NVM_CAPS_11AX_SUPPORT
;

1491 
d©a
->
œr_íabÀd
 = 
mei_nvm
->
ˇps
 & 
MEI_NVM_CAPS_LARI_SUPPORT
;

1493 
d©a
->
n_hw_addrs
 = 
mei_nvm
->n_hw_addrs;

1495 i‡(
	`iwl_£t_hw_addªss
(
å™s
, 
cfg
, 
d©a
, 
NULL
, NULL)) {

1496 
	`k‰ì
(
d©a
);

1497  
NULL
;

1500 i‡(
d©a
->
œr_íabÀd
 &&

1501 
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_LAR_SUPPORT
))

1502 
sb™ds_Êags
 |
IWL_NVM_SBANDS_FLAGS_LAR
;

1504 
	`iwl_öô_sb™ds
(
å™s
, 
d©a
, 
mei_nvm
->
ch™√ls
, 
tx_chaös
, 
rx_chaös
,

1505 
sb™ds_Êags
, 
åue
, 
fw
);

1507  
d©a
;

1508 
	}
}

1509 
IWL_EXPORT_SYMBOL
(
iwl_∑r£_mei_nvm_d©a
);

1511 
iwl_nvm_d©a
 *

1512 
	$iwl_∑r£_nvm_d©a
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

1513 c⁄° 
iwl_fw
 *
fw
,

1514 c⁄° 
__be16
 *
nvm_hw
, c⁄° 
__À16
 *
nvm_sw
,

1515 c⁄° 
__À16
 *
nvm_ˇlib
, c⁄° __À16 *
ªguœt‹y
,

1516 c⁄° 
__À16
 *
mac_ovîride
, c⁄° __À16 *
phy_sku
,

1517 
u8
 
tx_chaös
, u8 
rx_chaös
)

1519 
iwl_nvm_d©a
 *
d©a
;

1520 
boﬁ
 
œr_íabÀd
;

1521 
u32
 
sku
, 
ødio_cfg
;

1522 
u32
 
sb™ds_Êags
 = 0;

1523 
u16
 
œr_c⁄fig
;

1524 c⁄° 
__À16
 *
ch_£˘i⁄
;

1526 i‡(
cfg
->
uhb_suµ‹ãd
)

1527 
d©a
 = 
	`kzÆloc
(
	`°ru˘_size
(d©a, 
ch™√ls
,

1528 
IWL_NVM_NUM_CHANNELS_UHB
),

1529 
GFP_KERNEL
);

1530 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
)

1531 
d©a
 = 
	`kzÆloc
(
	`°ru˘_size
(d©a, 
ch™√ls
,

1532 
IWL_NVM_NUM_CHANNELS
),

1533 
GFP_KERNEL
);

1535 
d©a
 = 
	`kzÆloc
(
	`°ru˘_size
(d©a, 
ch™√ls
,

1536 
IWL_NVM_NUM_CHANNELS_EXT
),

1537 
GFP_KERNEL
);

1538 i‡(!
d©a
)

1539  
NULL
;

1541 
d©a
->
nvm_vîsi⁄
 = 
	`iwl_gë_nvm_vîsi⁄
(
cfg
, 
nvm_sw
);

1543 
ødio_cfg
 = 
	`iwl_gë_ødio_cfg
(
cfg
, 
nvm_sw
, 
phy_sku
);

1544 
	`iwl_£t_ødio_cfg
(
cfg
, 
d©a
, 
ødio_cfg
);

1545 i‡(
d©a
->
vÆid_tx_™t
)

1546 
tx_chaös
 &
d©a
->
vÆid_tx_™t
;

1547 i‡(
d©a
->
vÆid_rx_™t
)

1548 
rx_chaös
 &
d©a
->
vÆid_rx_™t
;

1550 
sku
 = 
	`iwl_gë_sku
(
cfg
, 
nvm_sw
, 
phy_sku
);

1551 
d©a
->
sku_ˇp_b™d_24ghz_íabÀ
 = 
sku
 & 
NVM_SKU_CAP_BAND_24GHZ
;

1552 
d©a
->
sku_ˇp_b™d_52ghz_íabÀ
 = 
sku
 & 
NVM_SKU_CAP_BAND_52GHZ
;

1553 
d©a
->
sku_ˇp_11n_íabÀ
 = 
sku
 & 
NVM_SKU_CAP_11N_ENABLE
;

1554 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11n
 & 
IWL_DISABLE_HT_ALL
)

1555 
d©a
->
sku_ˇp_11n_íabÀ
 = 
Ál£
;

1556 
d©a
->
sku_ˇp_11ac_íabÀ
 = d©a->
sku_ˇp_11n_íabÀ
 &&

1557 (
sku
 & 
NVM_SKU_CAP_11AC_ENABLE
);

1558 
d©a
->
sku_ˇp_mimo_dißbÀd
 = 
sku
 & 
NVM_SKU_CAP_MIMO_DISABLE
;

1560 
d©a
->
n_hw_addrs
 = 
	`iwl_gë_n_hw_addrs
(
cfg
, 
nvm_sw
);

1562 i‡(
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
) {

1564 i‡(!
nvm_ˇlib
) {

1565 
	`IWL_ERR
(
å™s
,

1567 
	`k‰ì
(
d©a
);

1568  
NULL
;

1571 
ch_£˘i⁄
 = 
cfg
->
nvm_ty≥
 =
IWL_NVM_SDP
 ?

1572 &
ªguœt‹y
[
NVM_CHANNELS_SDP
] :

1573 &
nvm_sw
[
NVM_CHANNELS
];

1576 
d©a
->
xèl_ˇlib
[0] = *(
nvm_ˇlib
 + 
XTAL_CALIB
);

1577 
d©a
->
xèl_ˇlib
[1] = *(
nvm_ˇlib
 + 
XTAL_CALIB
 + 1);

1578 
œr_íabÀd
 = 
åue
;

1580 
u16
 
œr_off£t
 = 
d©a
->
nvm_vîsi⁄
 < 0xE39 ?

1581 
NVM_LAR_OFFSET_OLD
 :

1582 
NVM_LAR_OFFSET
;

1584 
œr_c⁄fig
 = 
	`À16_to_˝up
(
ªguœt‹y
 + 
œr_off£t
);

1585 
d©a
->
œr_íabÀd
 = !!(
œr_c⁄fig
 &

1586 
NVM_LAR_ENABLED
);

1587 
œr_íabÀd
 = 
d©a
->lar_enabled;

1588 
ch_£˘i⁄
 = &
ªguœt‹y
[
NVM_CHANNELS_EXTENDED
];

1592 i‡(
	`iwl_£t_hw_addªss
(
å™s
, 
cfg
, 
d©a
, 
nvm_hw
, 
mac_ovîride
)) {

1593 
	`k‰ì
(
d©a
);

1594  
NULL
;

1597 i‡(
œr_íabÀd
 &&

1598 
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_LAR_SUPPORT
))

1599 
sb™ds_Êags
 |
IWL_NVM_SBANDS_FLAGS_LAR
;

1601 i‡(
	`iwl_nvm_no_wide_ö_5ghz
(
å™s
, 
cfg
, 
nvm_hw
))

1602 
sb™ds_Êags
 |
IWL_NVM_SBANDS_FLAGS_NO_WIDE_IN_5GHZ
;

1604 
	`iwl_öô_sb™ds
(
å™s
, 
d©a
, 
ch_£˘i⁄
, 
tx_chaös
, 
rx_chaös
,

1605 
sb™ds_Êags
, 
Ál£
, 
fw
);

1606 
d©a
->
ˇlib_vîsi⁄
 = 255;

1608  
d©a
;

1609 
	}
}

1610 
IWL_EXPORT_SYMBOL
(
iwl_∑r£_nvm_d©a
);

1612 
u32
 
	$iwl_nvm_gë_ªgdom_bw_Êags
(c⁄° 
u16
 *
nvm_ch™
,

1613 
ch_idx
, 
u16
 
nvm_Êags
,

1614 
iwl_ªg_ˇ∑
 
ªg_ˇ∑
,

1615 c⁄° 
iwl_cfg
 *
cfg
,

1616 
boﬁ
 
u©s_íabÀd
)

1618 
u32
 
Êags
 = 
NL80211_RRF_NO_HT40
;

1620 i‡(
ch_idx
 < 
NUM_2GHZ_CHANNELS
 &&

1621 (
nvm_Êags
 & 
NVM_CHANNEL_40MHZ
)) {

1622 i‡(
nvm_ch™
[
ch_idx
] <
LAST_2GHZ_HT_PLUS
)

1623 
Êags
 &~
NL80211_RRF_NO_HT40PLUS
;

1624 i‡(
nvm_ch™
[
ch_idx
] >
FIRST_2GHZ_HT_MINUS
)

1625 
Êags
 &~
NL80211_RRF_NO_HT40MINUS
;

1626 } i‡(
nvm_Êags
 & 
NVM_CHANNEL_40MHZ
) {

1627 i‡((
ch_idx
 - 
NUM_2GHZ_CHANNELS
) % 2 == 0)

1628 
Êags
 &~
NL80211_RRF_NO_HT40PLUS
;

1630 
Êags
 &~
NL80211_RRF_NO_HT40MINUS
;

1633 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_80MHZ
))

1634 
Êags
 |
NL80211_RRF_NO_80MHZ
;

1635 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_160MHZ
))

1636 
Êags
 |
NL80211_RRF_NO_160MHZ
;

1638 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_ACTIVE
))

1639 
Êags
 |
NL80211_RRF_NO_IR
;

1641 i‡(
nvm_Êags
 & 
NVM_CHANNEL_RADAR
)

1642 
Êags
 |
NL80211_RRF_DFS
;

1644 i‡(
nvm_Êags
 & 
NVM_CHANNEL_INDOOR_ONLY
)

1645 
Êags
 |
NL80211_RRF_NO_OUTDOOR
;

1650 i‡((
nvm_Êags
 & 
NVM_CHANNEL_GO_CONCURRENT
)) {

1651 i‡(
Êags
 & 
NL80211_RRF_NO_IR
)

1652 
Êags
 |
NL80211_RRF_GO_CONCURRENT
;

1653 i‡(
Êags
 & 
NL80211_RRF_DFS
) {

1654 
Êags
 |
NL80211_RRF_DFS_CONCURRENT
;

1658 
Êags
 &~
NL80211_RRF_NO_IR
;

1663 i‡(
u©s_íabÀd
) {

1664 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_VLP
))

1665 
Êags
 |
NL80211_RRF_NO_6GHZ_VLP_CLIENT
;

1667 i‡(!(
nvm_Êags
 & 
NVM_CHANNEL_AFC
))

1668 
Êags
 |
NL80211_RRF_NO_6GHZ_AFC_CLIENT
;

1674 i‡(
ch_idx
 >
NUM_2GHZ_CHANNELS
) {

1675 i‡(!
ªg_ˇ∑
.
Ælow_40mhz
)

1676 
Êags
 |
NL80211_RRF_NO_HT40
;

1678 i‡(!
ªg_ˇ∑
.
Ælow_80mhz
)

1679 
Êags
 |
NL80211_RRF_NO_80MHZ
;

1681 i‡(!
ªg_ˇ∑
.
Ælow_160mhz
)

1682 
Êags
 |
NL80211_RRF_NO_160MHZ
;

1684 i‡(!
ªg_ˇ∑
.
Ælow_320mhz
)

1685 
Êags
 |
NL80211_RRF_NO_320MHZ
;

1688 i‡(
ªg_ˇ∑
.
dißbÀ_11ax
)

1689 
Êags
 |
NL80211_RRF_NO_HE
;

1691 i‡(
ªg_ˇ∑
.
dißbÀ_11be
)

1692 
Êags
 |
NL80211_RRF_NO_EHT
;

1694  
Êags
;

1695 
	}
}

1697 
iwl_ªg_ˇ∑
 
	$iwl_gë_ªg_ˇ∑
(
u32
 
Êags
, 
u8
 
ª•_vî
)

1699 
iwl_ªg_ˇ∑
 
ªg_ˇ∑
 = {};

1701 i‡(
ª•_vî
 >
REG_CAPA_V4_RESP_VER
) {

1702 
ªg_ˇ∑
.
Ælow_40mhz
 = 
åue
;

1703 
ªg_ˇ∑
.
Ælow_80mhz
 = 
Êags
 & 
REG_CAPA_V4_80MHZ_ALLOWED
;

1704 
ªg_ˇ∑
.
Ælow_160mhz
 = 
Êags
 & 
REG_CAPA_V4_160MHZ_ALLOWED
;

1705 
ªg_ˇ∑
.
Ælow_320mhz
 = 
Êags
 & 
REG_CAPA_V4_320MHZ_ALLOWED
;

1706 
ªg_ˇ∑
.
dißbÀ_11ax
 = 
Êags
 & 
REG_CAPA_V4_11AX_DISABLED
;

1707 
ªg_ˇ∑
.
dißbÀ_11be
 = 
Êags
 & 
REG_CAPA_V4_11BE_DISABLED
;

1708 } i‡(
ª•_vî
 >
REG_CAPA_V2_RESP_VER
) {

1709 
ªg_ˇ∑
.
Ælow_40mhz
 = 
Êags
 & 
REG_CAPA_V2_40MHZ_ALLOWED
;

1710 
ªg_ˇ∑
.
Ælow_80mhz
 = 
Êags
 & 
REG_CAPA_V2_80MHZ_ALLOWED
;

1711 
ªg_ˇ∑
.
Ælow_160mhz
 = 
Êags
 & 
REG_CAPA_V2_160MHZ_ALLOWED
;

1712 
ªg_ˇ∑
.
dißbÀ_11ax
 = 
Êags
 & 
REG_CAPA_V2_11AX_DISABLED
;

1714 
ªg_ˇ∑
.
Ælow_40mhz
 = !(
Êags
 & 
REG_CAPA_V1_40MHZ_FORBIDDEN
);

1715 
ªg_ˇ∑
.
Ælow_80mhz
 = 
Êags
 & 
REG_CAPA_V1_80MHZ_ALLOWED
;

1716 
ªg_ˇ∑
.
Ælow_160mhz
 = 
Êags
 & 
REG_CAPA_V1_160MHZ_ALLOWED
;

1717 
ªg_ˇ∑
.
dißbÀ_11ax
 = 
Êags
 & 
REG_CAPA_V1_11AX_DISABLED
;

1719  
ªg_ˇ∑
;

1720 
	}
}

1722 
õì80211_ªgdomaö
 *

1723 
	$iwl_∑r£_nvm_mcc_öfo
(
devi˚
 *
dev
, c⁄° 
iwl_cfg
 *
cfg
,

1724 
num_of_ch
, 
__À32
 *
ch™√ls
, 
u16
 
fw_mcc
,

1725 
u16
 
geo_öfo
, 
u32
 
ˇp
, 
u8
 
ª•_vî
, 
boﬁ
 
u©s_íabÀd
)

1727 
ch_idx
;

1728 
u16
 
ch_Êags
;

1729 
u32
 
ªg_ruÀ_Êags
, 
¥ev_ªg_ruÀ_Êags
 = 0;

1730 c⁄° 
u16
 *
nvm_ch™
;

1731 
õì80211_ªgdomaö
 *
ªgd
, *
c›y_rd
;

1732 
õì80211_ªg_ruÀ
 *
ruÀ
;

1733 
∆80211_b™d
 
b™d
;

1734 
˚¡î_‰eq
, 
¥ev_˚¡î_‰eq
 = 0;

1735 
vÆid_ruÀs
 = 0;

1736 
boﬁ
 
√w_ruÀ
;

1737 
max_num_ch
;

1738 
iwl_ªg_ˇ∑
 
ªg_ˇ∑
;

1740 i‡(
cfg
->
uhb_suµ‹ãd
) {

1741 
max_num_ch
 = 
IWL_NVM_NUM_CHANNELS_UHB
;

1742 
nvm_ch™
 = 
iwl_uhb_nvm_ch™√ls
;

1743 } i‡(
cfg
->
nvm_ty≥
 =
IWL_NVM_EXT
) {

1744 
max_num_ch
 = 
IWL_NVM_NUM_CHANNELS_EXT
;

1745 
nvm_ch™
 = 
iwl_ext_nvm_ch™√ls
;

1747 
max_num_ch
 = 
IWL_NVM_NUM_CHANNELS
;

1748 
nvm_ch™
 = 
iwl_nvm_ch™√ls
;

1751 i‡(
num_of_ch
 > 
max_num_ch
) {

1752 
	`IWL_DEBUG_DEV
(
dev
, 
IWL_DL_LAR
,

1754 
num_of_ch
, 
max_num_ch
);

1755 
num_of_ch
 = 
max_num_ch
;

1758 i‡(
	`WARN_ON_ONCE
(
num_of_ch
 > 
NL80211_MAX_SUPP_REG_RULES
))

1759  
	`ERR_PTR
(-
EINVAL
);

1761 
	`IWL_DEBUG_DEV
(
dev
, 
IWL_DL_LAR
, "buildingÑegdom for %d channels\n",

1762 
num_of_ch
);

1765 
ªgd
 = 
	`kzÆloc
(
	`°ru˘_size
‘egd, 
ªg_ruÀs
, 
num_of_ch
), 
GFP_KERNEL
);

1766 i‡(!
ªgd
)

1767  
	`ERR_PTR
(-
ENOMEM
);

1770 
ªgd
->
Æpha2
[0] = 
fw_mcc
 >> 8;

1771 
ªgd
->
Æpha2
[1] = 
fw_mcc
 & 0xff;

1774 
ªg_ˇ∑
 = 
	`iwl_gë_ªg_ˇ∑
(
ˇp
, 
ª•_vî
);

1776 
ch_idx
 = 0; ch_idx < 
num_of_ch
; ch_idx++) {

1777 
ch_Êags
 = (
u16
)
	`__À32_to_˝up
(
ch™√ls
 + 
ch_idx
);

1778 
b™d
 = 
	`iwl_∆80211_b™d_‰om_ch™√l_idx
(
ch_idx
);

1779 
˚¡î_‰eq
 = 
	`õì80211_ch™√l_to_‰equícy
(
nvm_ch™
[
ch_idx
],

1780 
b™d
);

1781 
√w_ruÀ
 = 
Ál£
;

1783 i‡(!(
ch_Êags
 & 
NVM_CHANNEL_VALID
)) {

1784 
	`iwl_nvm_¥öt_ch™√l_Êags
(
dev
, 
IWL_DL_LAR
,

1785 
nvm_ch™
[
ch_idx
], 
ch_Êags
);

1789 
ªg_ruÀ_Êags
 = 
	`iwl_nvm_gë_ªgdom_bw_Êags
(
nvm_ch™
, 
ch_idx
,

1790 
ch_Êags
, 
ªg_ˇ∑
,

1791 
cfg
, 
u©s_íabÀd
);

1794 i‡(
ch_idx
 =0 || 
¥ev_ªg_ruÀ_Êags
 !
ªg_ruÀ_Êags
 ||

1795 
˚¡î_‰eq
 - 
¥ev_˚¡î_‰eq
 > 20) {

1796 
vÆid_ruÀs
++;

1797 
√w_ruÀ
 = 
åue
;

1800 
ruÀ
 = &
ªgd
->
ªg_ruÀs
[
vÆid_ruÀs
 - 1];

1802 i‡(
√w_ruÀ
)

1803 
ruÀ
->
‰eq_ønge
.
°¨t_‰eq_khz
 =

1804 
	`MHZ_TO_KHZ
(
˚¡î_‰eq
 - 10);

1806 
ruÀ
->
‰eq_ønge
.
íd_‰eq_khz
 = 
	`MHZ_TO_KHZ
(
˚¡î_‰eq
 + 10);

1809 
ruÀ
->
powî_ruÀ
.
max_™ã¬a_gaö
 = 
	`DBI_TO_MBI
(6);

1810 
ruÀ
->
powî_ruÀ
.
max_eúp
 =

1811 
	`DBM_TO_MBM
(
IWL_DEFAULT_MAX_TX_POWER
);

1813 
ruÀ
->
Êags
 = 
ªg_ruÀ_Êags
;

1816 
ruÀ
->
Êags
 |
NL80211_RRF_AUTO_BW
;

1817 
ruÀ
->
‰eq_ønge
.
max_b™dwidth_khz
 = 0;

1819 
¥ev_˚¡î_‰eq
 = 
˚¡î_‰eq
;

1820 
¥ev_ªg_ruÀ_Êags
 = 
ªg_ruÀ_Êags
;

1822 
	`iwl_nvm_¥öt_ch™√l_Êags
(
dev
, 
IWL_DL_LAR
,

1823 
nvm_ch™
[
ch_idx
], 
ch_Êags
);

1825 i‡(!(
geo_öfo
 & 
GEO_WMM_ETSI_5GHZ_INFO
) ||

1826 
b™d
 =
NL80211_BAND_2GHZ
)

1829 
	`ªg_quîy_ªgdb_wmm
(
ªgd
->
Æpha2
, 
˚¡î_‰eq
, 
ruÀ
);

1840 i‡(!
vÆid_ruÀs
) {

1841 
vÆid_ruÀs
 = 1;

1842 
ruÀ
 = &
ªgd
->
ªg_ruÀs
[
vÆid_ruÀs
 - 1];

1843 
ruÀ
->
‰eq_ønge
.
°¨t_‰eq_khz
 = 
	`MHZ_TO_KHZ
(2412);

1844 
ruÀ
->
‰eq_ønge
.
íd_‰eq_khz
 = 
	`MHZ_TO_KHZ
(2413);

1845 
ruÀ
->
‰eq_ønge
.
max_b™dwidth_khz
 = 
	`MHZ_TO_KHZ
(1);

1846 
ruÀ
->
powî_ruÀ
.
max_™ã¬a_gaö
 = 
	`DBI_TO_MBI
(6);

1847 
ruÀ
->
powî_ruÀ
.
max_eúp
 =

1848 
	`DBM_TO_MBM
(
IWL_DEFAULT_MAX_TX_POWER
);

1851 
ªgd
->
n_ªg_ruÀs
 = 
vÆid_ruÀs
;

1857 
c›y_rd
 = 
	`kmemdup
(
ªgd
, 
	`°ru˘_size
‘egd, 
ªg_ruÀs
, 
vÆid_ruÀs
),

1858 
GFP_KERNEL
);

1859 i‡(!
c›y_rd
)

1860 
c›y_rd
 = 
	`ERR_PTR
(-
ENOMEM
);

1862 
	`k‰ì
(
ªgd
);

1863  
c›y_rd
;

1864 
	}
}

1865 
IWL_EXPORT_SYMBOL
(
iwl_∑r£_nvm_mcc_öfo
);

1867 
	#IWL_MAX_NVM_SECTION_SIZE
 0x1b58

	)

1868 
	#IWL_MAX_EXT_NVM_SECTION_SIZE
 0x1ffc

	)

1869 
	#MAX_NVM_FILE_LEN
 16384

	)

1871 
	$iwl_nvm_fixups
(
u32
 
hw_id
, 
£˘i⁄
, 
u8
 *
d©a
,

1872 
Àn
)

1874 
	#IWL_4165_DEVICE_ID
 0x5501

	)

1875 
	#NVM_SKU_CAP_MIMO_DISABLE
 
	`BIT
(5)

	)

1877 i‡(
£˘i⁄
 =
NVM_SECTION_TYPE_PHY_SKU
 &&

1878 
hw_id
 =
IWL_4165_DEVICE_ID
 && 
d©a
 && 
Àn
 >= 5 &&

1879 (
d©a
[4] & 
NVM_SKU_CAP_MIMO_DISABLE
))

1881 
d©a
[3] = 
ANT_B
 | (ANT_B << 4);

1882 
	}
}

1883 
IWL_EXPORT_SYMBOL
(
iwl_nvm_fixups
);

1906 
	$iwl_ªad_exã∫Æ_nvm
(
iwl_å™s
 *
å™s
,

1907 c⁄° *
nvm_fûe_«me
,

1908 
iwl_nvm_£˘i⁄
 *
nvm_£˘i⁄s
)

1910 
ªt
, 
£˘i⁄_size
;

1911 
u16
 
£˘i⁄_id
;

1912 c⁄° 
fúmw¨e
 *
fw_íåy
;

1914 
__À16
 
w‹d1
;

1915 
__À16
 
w‹d2
;

1916 
u8
 
d©a
[];

1917 } *
fûe_£c
;

1918 c⁄° 
u8
 *
eof
;

1919 
u8
 *
ãmp
;

1920 
max_£˘i⁄_size
;

1921 c⁄° 
__À32
 *
dw‹d_buff
;

1923 
	#NVM_WORD1_LEN
(
x
Ë(8 * (x & 0x03FF))

	)

1924 
	#NVM_WORD2_ID
(
x
Ë(x >> 12)

	)

1925 
	#EXT_NVM_WORD2_LEN
(
x
Ë(2 * (((xË& 0xFFË<< 8 | (xË>> 8))

	)

1926 
	#EXT_NVM_WORD1_ID
(
x
Ë((xË>> 4)

	)

1927 
	#NVM_HEADER_0
 (0x2A504C54)

	)

1928 
	#NVM_HEADER_1
 (0x4E564D2A)

	)

1929 
	#NVM_HEADER_SIZE
 (4 * (
u32
))

	)

1931 
	`IWL_DEBUG_EEPROM
(
å™s
->
dev
, "Read fromÉxternal NVM\n");

1934 i‡(
å™s
->
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
)

1935 
max_£˘i⁄_size
 = 
IWL_MAX_NVM_SECTION_SIZE
;

1937 
max_£˘i⁄_size
 = 
IWL_MAX_EXT_NVM_SECTION_SIZE
;

1945 
ªt
 = 
	`ªque°_fúmw¨e
(&
fw_íåy
, 
nvm_fûe_«me
, 
å™s
->
dev
);

1946 i‡(
ªt
) {

1947 
	`IWL_ERR
(
å™s
, "ERROR: %s isn'távailable %d\n",

1948 
nvm_fûe_«me
, 
ªt
);

1949  
ªt
;

1952 
	`IWL_INFO
(
å™s
, "Loaded NVM file %s (%zu bytes)\n",

1953 
nvm_fûe_«me
, 
fw_íåy
->
size
);

1955 i‡(
fw_íåy
->
size
 > 
MAX_NVM_FILE_LEN
) {

1956 
	`IWL_ERR
(
å™s
, "NVM fileÅooÜarge\n");

1957 
ªt
 = -
EINVAL
;

1958 
out
;

1961 
eof
 = 
fw_íåy
->
d©a
 + fw_íåy->
size
;

1962 
dw‹d_buff
 = (c⁄° 
__À32
 *)
fw_íåy
->
d©a
;

1971 i‡(
fw_íåy
->
size
 > 
NVM_HEADER_SIZE
 &&

1972 
dw‹d_buff
[0] =
	`˝u_to_À32
(
NVM_HEADER_0
) &&

1973 
dw‹d_buff
[1] =
	`˝u_to_À32
(
NVM_HEADER_1
)) {

1974 
fûe_£c
 = (c⁄° *)(
fw_íåy
->
d©a
 + 
NVM_HEADER_SIZE
);

1975 
	`IWL_INFO
(
å™s
, "NVM Vîsi⁄ %08X\n", 
	`À32_to_˝u
(
dw‹d_buff
[2]));

1976 
	`IWL_INFO
(
å™s
, "NVM Manufacturing date %08X\n",

1977 
	`À32_to_˝u
(
dw‹d_buff
[3]));

1980 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_8000
 &&

1981 
å™s
->
hw_ªv_°ï
 =
SILICON_C_STEP
 &&

1982 
	`À32_to_˝u
(
dw‹d_buff
[2]) < 0xE4A) {

1983 
ªt
 = -
EFAULT
;

1984 
out
;

1987 
fûe_£c
 = (c⁄° *)
fw_íåy
->
d©a
;

1990 
åue
) {

1991 i‡(
fûe_£c
->
d©a
 > 
eof
) {

1992 
	`IWL_ERR
(
å™s
,

1994 
ªt
 = -
EINVAL
;

1999 i‡(!
fûe_£c
->
w‹d1
 && !fûe_£c->
w‹d2
) {

2000 
ªt
 = 0;

2004 i‡(
å™s
->
cfg
->
nvm_ty≥
 !
IWL_NVM_EXT
) {

2005 
£˘i⁄_size
 =

2006 2 * 
	`NVM_WORD1_LEN
(
	`À16_to_˝u
(
fûe_£c
->
w‹d1
));

2007 
£˘i⁄_id
 = 
	`NVM_WORD2_ID
(
	`À16_to_˝u
(
fûe_£c
->
w‹d2
));

2009 
£˘i⁄_size
 = 2 * 
	`EXT_NVM_WORD2_LEN
(

2010 
	`À16_to_˝u
(
fûe_£c
->
w‹d2
));

2011 
£˘i⁄_id
 = 
	`EXT_NVM_WORD1_ID
(

2012 
	`À16_to_˝u
(
fûe_£c
->
w‹d1
));

2015 i‡(
£˘i⁄_size
 > 
max_£˘i⁄_size
) {

2016 
	`IWL_ERR
(
å™s
, "ERROR - sectionÅooÜarge (%d)\n",

2017 
£˘i⁄_size
);

2018 
ªt
 = -
EINVAL
;

2022 i‡(!
£˘i⁄_size
) {

2023 
	`IWL_ERR
(
å™s
, "ERROR - sectionÉmpty\n");

2024 
ªt
 = -
EINVAL
;

2028 i‡(
fûe_£c
->
d©a
 + 
£˘i⁄_size
 > 
eof
) {

2029 
	`IWL_ERR
(
å™s
,

2031 
£˘i⁄_size
);

2032 
ªt
 = -
EINVAL
;

2036 i‡(
	`WARN
(
£˘i⁄_id
 >
NVM_MAX_NUM_SECTIONS
,

2037 "InvÆid NVM se˘i⁄ ID %d\n", 
£˘i⁄_id
)) {

2038 
ªt
 = -
EINVAL
;

2042 
ãmp
 = 
	`kmemdup
(
fûe_£c
->
d©a
, 
£˘i⁄_size
, 
GFP_KERNEL
);

2043 i‡(!
ãmp
) {

2044 
ªt
 = -
ENOMEM
;

2048 
	`iwl_nvm_fixups
(
å™s
->
hw_id
, 
£˘i⁄_id
, 
ãmp
, 
£˘i⁄_size
);

2050 
	`k‰ì
(
nvm_£˘i⁄s
[
£˘i⁄_id
].
d©a
);

2051 
nvm_£˘i⁄s
[
£˘i⁄_id
].
d©a
 = 
ãmp
;

2052 
nvm_£˘i⁄s
[
£˘i⁄_id
].
Àngth
 = 
£˘i⁄_size
;

2055 
fûe_£c
 = (c⁄° *)(fûe_£c->
d©a
 + 
£˘i⁄_size
);

2057 
out
:

2058 
	`ªÀa£_fúmw¨e
(
fw_íåy
);

2059  
ªt
;

2060 
	}
}

2061 
IWL_EXPORT_SYMBOL
(
iwl_ªad_exã∫Æ_nvm
);

2063 
iwl_nvm_d©a
 *
	$iwl_gë_nvm
(
iwl_å™s
 *
å™s
,

2064 c⁄° 
iwl_fw
 *
fw
,

2065 
u8
 
£t_tx_™t
, u8 
£t_rx_™t
)

2067 
iwl_nvm_gë_öfo
 
cmd
 = {};

2068 
iwl_nvm_d©a
 *
nvm
;

2069 
iwl_ho°_cmd
 
hcmd
 = {

2070 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
,

2071 .
d©a
 = { &
cmd
, },

2072 .
Àn
 = { (
cmd
) },

2073 .
id
 = 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
, 
NVM_GET_INFO
)

2075 
ªt
;

2076 
boﬁ
 
em±y_Ÿp
;

2077 
u32
 
mac_Êags
;

2078 
u32
 
sb™ds_Êags
 = 0;

2079 
u8
 
tx_™t
;

2080 
u8
 
rx_™t
;

2088 
iwl_nvm_gë_öfo_r•
 *
r•
;

2089 
iwl_nvm_gë_öfo_r•_v3
 *
r•_v3
;

2090 
boﬁ
 
v4
 = 
	`fw_has_≠i
(&
fw
->
ucode_ˇ∑
,

2091 
IWL_UCODE_TLV_API_REGULATORY_NVM_INFO
);

2092 
size_t
 
r•_size
 = 
v4
 ? (*
r•
Ë: (*
r•_v3
);

2093 *
ch™√l_¥ofûe
;

2095 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
å™s
, &
hcmd
);

2096 i‡(
ªt
)

2097  
	`ERR_PTR
(
ªt
);

2099 i‡(
	`WARN
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
hcmd
.
ª•_pkt
Ë!
r•_size
,

2101 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
hcmd
.
ª•_pkt
))) {

2102 
ªt
 = -
EINVAL
;

2103 
out
;

2106 
r•
 = (*)
hcmd
.
ª•_pkt
->
d©a
;

2107 
em±y_Ÿp
 = !!(
	`À32_to_˝u
(
r•
->
gíîÆ
.
Êags
) &

2108 
NVM_GENERAL_FLAGS_EMPTY_OTP
);

2109 i‡(
em±y_Ÿp
)

2110 
	`IWL_INFO
(
å™s
, "OTP isÉmpty\n");

2112 
nvm
 = 
	`kzÆloc
(
	`°ru˘_size
“vm, 
ch™√ls
, 
IWL_NUM_CHANNELS
), 
GFP_KERNEL
);

2113 i‡(!
nvm
) {

2114 
ªt
 = -
ENOMEM
;

2115 
out
;

2118 
	`iwl_£t_hw_addªss_‰om_c§
(
å™s
, 
nvm
);

2121 i‡(!
	`is_vÆid_ëhî_addr
(
nvm
->
hw_addr
)) {

2122 
	`IWL_ERR
(
å™s
, "no valid macáddress was found\n");

2123 
ªt
 = -
EINVAL
;

2124 
îr_‰ì
;

2127 
	`IWL_INFO
(
å™s
, "ba£ HWáddªss: %pM\n", 
nvm
->
hw_addr
);

2130 
nvm
->
nvm_vîsi⁄
 = 
	`À16_to_˝u
(
r•
->
gíîÆ
.nvm_version);

2131 
nvm
->
n_hw_addrs
 = 
r•
->
gíîÆ
.n_hw_addrs;

2132 i‡(
nvm
->
n_hw_addrs
 == 0)

2133 
	`IWL_WARN
(
å™s
,

2135 
em±y_Ÿp
);

2138 
mac_Êags
 = 
	`À32_to_˝u
(
r•
->
mac_sku
.
mac_sku_Êags
);

2139 
nvm
->
sku_ˇp_11ac_íabÀ
 =

2140 !!(
mac_Êags
 & 
NVM_MAC_SKU_FLAGS_802_11AC_ENABLED
);

2141 
nvm
->
sku_ˇp_11n_íabÀ
 =

2142 !!(
mac_Êags
 & 
NVM_MAC_SKU_FLAGS_802_11N_ENABLED
);

2143 
nvm
->
sku_ˇp_11ax_íabÀ
 =

2144 !!(
mac_Êags
 & 
NVM_MAC_SKU_FLAGS_802_11AX_ENABLED
);

2145 
nvm
->
sku_ˇp_b™d_24ghz_íabÀ
 =

2146 !!(
mac_Êags
 & 
NVM_MAC_SKU_FLAGS_BAND_2_4_ENABLED
);

2147 
nvm
->
sku_ˇp_b™d_52ghz_íabÀ
 =

2148 !!(
mac_Êags
 & 
NVM_MAC_SKU_FLAGS_BAND_5_2_ENABLED
);

2149 
nvm
->
sku_ˇp_mimo_dißbÀd
 =

2150 !!(
mac_Êags
 & 
NVM_MAC_SKU_FLAGS_MIMO_DISABLED
);

2151 i‡(
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
Ë>
IWL_CFG_RF_TYPE_FM
)

2152 
nvm
->
sku_ˇp_11be_íabÀ
 = 
åue
;

2155 
nvm
->
vÆid_tx_™t
 = (
u8
)
	`À32_to_˝u
(
r•
->
phy_sku
.
tx_chaös
);

2156 
nvm
->
vÆid_rx_™t
 = (
u8
)
	`À32_to_˝u
(
r•
->
phy_sku
.
rx_chaös
);

2158 i‡(
	`À32_to_˝u
(
r•
->
ªguœt‹y
.
œr_íabÀd
) &&

2159 
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
,

2160 
IWL_UCODE_TLV_CAPA_LAR_SUPPORT
)) {

2161 
nvm
->
œr_íabÀd
 = 
åue
;

2162 
sb™ds_Êags
 |
IWL_NVM_SBANDS_FLAGS_LAR
;

2165 
r•_v3
 = (*)
r•
;

2166 
ch™√l_¥ofûe
 = 
v4
 ? (*)
r•
->
ªguœt‹y
.channel_profile :

2167 (*)
r•_v3
->
ªguœt‹y
.
ch™√l_¥ofûe
;

2169 
tx_™t
 = 
nvm
->
vÆid_tx_™t
 & 
fw
->valid_tx_ant;

2170 
rx_™t
 = 
nvm
->
vÆid_rx_™t
 & 
fw
->valid_rx_ant;

2172 i‡(
£t_tx_™t
)

2173 
tx_™t
 &
£t_tx_™t
;

2174 i‡(
£t_rx_™t
)

2175 
rx_™t
 &
£t_rx_™t
;

2177 
	`iwl_öô_sb™ds
(
å™s
, 
nvm
, 
ch™√l_¥ofûe
, 
tx_™t
, 
rx_™t
,

2178 
sb™ds_Êags
, 
v4
, 
fw
);

2180 
	`iwl_‰ì_ª•
(&
hcmd
);

2181  
nvm
;

2183 
îr_‰ì
:

2184 
	`k‰ì
(
nvm
);

2185 
out
:

2186 
	`iwl_‰ì_ª•
(&
hcmd
);

2187  
	`ERR_PTR
(
ªt
);

2188 
	}
}

2189 
IWL_EXPORT_SYMBOL
(
iwl_gë_nvm
);

	@iwl-nvm-parse.h

6 #i‚de‡
__iwl_nvm_∑r£_h__


7 
	#__iwl_nvm_∑r£_h__


	)

9 
	~<√t/cfg80211.h
>

10 
	~"iwl-ì¥om-∑r£.h
"

11 
	~"mei/iwl-mei.h
"

19 
	eiwl_nvm_sb™ds_Êags
 {

20 
	mIWL_NVM_SBANDS_FLAGS_LAR
 = 
BIT
(0),

21 
	mIWL_NVM_SBANDS_FLAGS_NO_WIDE_IN_5GHZ
 = 
BIT
(1),

32 
iwl_nvm_d©a
 *

33 
iwl_∑r£_nvm_d©a
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

34 c⁄° 
iwl_fw
 *
fw
,

35 c⁄° 
__be16
 *
nvm_hw
, c⁄° 
__À16
 *
nvm_sw
,

36 c⁄° 
__À16
 *
nvm_ˇlib
, c⁄° __À16 *
ªguœt‹y
,

37 c⁄° 
__À16
 *
mac_ovîride
, c⁄° __À16 *
phy_sku
,

38 
u8
 
tx_chaös
, u8 
rx_chaös
);

50 
õì80211_ªgdomaö
 *

51 
iwl_∑r£_nvm_mcc_öfo
(
devi˚
 *
dev
, c⁄° 
iwl_cfg
 *
cfg
,

52 
num_of_ch
, 
__À32
 *
ch™√ls
, 
u16
 
fw_mcc
,

53 
u16
 
geo_öfo
, 
u32
 
ˇp
, 
u8
 
ª•_vî
, 
boﬁ
 
u©s_íabÀd
);

62 
	siwl_nvm_£˘i⁄
 {

63 
u16
 
	mÀngth
;

64 c⁄° 
u8
 *
	md©a
;

70 
iwl_ªad_exã∫Æ_nvm
(
iwl_å™s
 *
å™s
,

71 c⁄° *
nvm_fûe_«me
,

72 
iwl_nvm_£˘i⁄
 *
nvm_£˘i⁄s
);

73 
iwl_nvm_fixups
(
u32
 
hw_id
, 
£˘i⁄
, 
u8
 *
d©a
,

74 
Àn
);

82 
iwl_nvm_d©a
 *
iwl_gë_nvm
(
iwl_å™s
 *
å™s
,

83 c⁄° 
iwl_fw
 *
fw
,

84 
u8
 
£t_tx_™t
, u8 
£t_rx_™t
);

89 
iwl_nvm_d©a
 *

90 
iwl_∑r£_mei_nvm_d©a
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

91 c⁄° 
iwl_mei_nvm
 *
mei_nvm
,

92 c⁄° 
iwl_fw
 *
fw
, 
u8
 
£t_tx_™t
, u8 
£t_rx_™t
);

97 
iwl_ªöô_ˇb
(
iwl_å™s
 *
å™s
, 
iwl_nvm_d©a
 *
d©a
,

98 
u8
 
tx_chaös
, u8 
rx_chaös
, c⁄° 
iwl_fw
 *
fw
);

	@iwl-op-mode.h

7 #i‚de‡
__iwl_›_mode_h__


8 
	#__iwl_›_mode_h__


	)

10 
	~<löux/√tdevi˚.h
>

11 
	~<löux/debugfs.h
>

12 
	~"iwl-dbg-év.h
"

14 
	giwl_›_mode
;

15 
	giwl_å™s
;

16 
	gsk_buff
;

17 
	giwl_devi˚_cmd
;

18 
	giwl_rx_cmd_buf„r
;

19 
	giwl_fw
;

20 
	giwl_cfg
;

89 
	siwl_›_mode_›s
 {

90 
	miwl_›_mode
 *(*
	m°¨t
)(
iwl_å™s
 *
	må™s
,

91 c⁄° 
iwl_cfg
 *
	mcfg
,

92 c⁄° 
iwl_fw
 *
	mfw
,

93 
díåy
 *
	mdbgfs_dú
);

94 (*
	m°›
)(
iwl_›_mode
 *
	m›_mode
);

95 (*
	mrx
)(
iwl_›_mode
 *
	m›_mode
, 
«pi_°ru˘
 *
	m«pi
,

96 
iwl_rx_cmd_buf„r
 *
	mrxb
);

97 (*
	mrx_rss
)(
iwl_›_mode
 *
	m›_mode
, 
«pi_°ru˘
 *
	m«pi
,

98 
iwl_rx_cmd_buf„r
 *
	mrxb
, 
	mqueue
);

99 (*
	mqueue_fuŒ
)(
iwl_›_mode
 *
	m›_mode
, 
	mqueue
);

100 (*
	mqueue_nŸ_fuŒ
)(
iwl_›_mode
 *
	m›_mode
, 
	mqueue
);

101 
boﬁ
 (*
hw_rf_kûl
)(
iwl_›_mode
 *
	m›_mode
, boﬁ 
	m°©e
);

102 (*
	m‰ì_skb
)(
iwl_›_mode
 *
	m›_mode
, 
sk_buff
 *
	mskb
);

103 (*
	mnic_îr‹
)(
iwl_›_mode
 *
	m›_mode
, 
boﬁ
 
	msync
);

104 (*
	mcmd_queue_fuŒ
)(
iwl_›_mode
 *
	m›_mode
);

105 (*
	mnic_c⁄fig
)(
iwl_›_mode
 *
	m›_mode
);

106 (*
	mwimax_a˘ive
)(
iwl_›_mode
 *
	m›_mode
);

107 (*
	mtime_poöt
)(
iwl_›_mode
 *
	m›_mode
,

108 
iwl_fw_öi_time_poöt
 
	mç_id
,

109 
iwl_dbg_év_ç_d©a
 *
	mç_d©a
);

112 
iwl_›mode_ªgi°î
(c⁄° *
«me
, c⁄° 
iwl_›_mode_›s
 *
›s
);

113 
iwl_›mode_dîegi°î
(c⁄° *
«me
);

121 
	siwl_›_mode
 {

122 c⁄° 
iwl_›_mode_›s
 *
	m›s
;

124 
	m›_mode_•ecific
[] 
__Æig√d
((*));

127 
ölöe
 
	$iwl_›_mode_°›
(
iwl_›_mode
 *
›_mode
)

129 
	`might_¶ìp
();

130 
›_mode
->
›s
->
	`°›
(op_mode);

131 
	}
}

133 
ölöe
 
	$iwl_›_mode_rx
(
iwl_›_mode
 *
›_mode
,

134 
«pi_°ru˘
 *
«pi
,

135 
iwl_rx_cmd_buf„r
 *
rxb
)

137  
›_mode
->
›s
->
	`rx
(›_mode, 
«pi
, 
rxb
);

138 
	}
}

140 
ölöe
 
	$iwl_›_mode_rx_rss
(
iwl_›_mode
 *
›_mode
,

141 
«pi_°ru˘
 *
«pi
,

142 
iwl_rx_cmd_buf„r
 *
rxb
,

143 
queue
)

145 
›_mode
->
›s
->
	`rx_rss
(›_mode, 
«pi
, 
rxb
, 
queue
);

146 
	}
}

148 
ölöe
 
	$iwl_›_mode_queue_fuŒ
(
iwl_›_mode
 *
›_mode
,

149 
queue
)

151 
›_mode
->
›s
->
	`queue_fuŒ
(›_mode, 
queue
);

152 
	}
}

154 
ölöe
 
	$iwl_›_mode_queue_nŸ_fuŒ
(
iwl_›_mode
 *
›_mode
,

155 
queue
)

157 
›_mode
->
›s
->
	`queue_nŸ_fuŒ
(›_mode, 
queue
);

158 
	}
}

160 
ölöe
 
boﬁ
 
__mu°_check


161 
	$iwl_›_mode_hw_rf_kûl
(
iwl_›_mode
 *
›_mode
, 
boﬁ
 
°©e
)

163 
	`might_¶ìp
();

164  
›_mode
->
›s
->
	`hw_rf_kûl
(›_mode, 
°©e
);

165 
	}
}

167 
ölöe
 
	$iwl_›_mode_‰ì_skb
(
iwl_›_mode
 *
›_mode
,

168 
sk_buff
 *
skb
)

170 i‡(
	`WARN_ON_ONCE
(!
›_mode
))

172 
›_mode
->
›s
->
	`‰ì_skb
(›_mode, 
skb
);

173 
	}
}

175 
ölöe
 
	$iwl_›_mode_nic_îr‹
(
iwl_›_mode
 *
›_mode
, 
boﬁ
 
sync
)

177 
›_mode
->
›s
->
	`nic_îr‹
(›_mode, 
sync
);

178 
	}
}

180 
ölöe
 
	$iwl_›_mode_cmd_queue_fuŒ
(
iwl_›_mode
 *
›_mode
)

182 
›_mode
->
›s
->
	`cmd_queue_fuŒ
(op_mode);

183 
	}
}

185 
ölöe
 
	$iwl_›_mode_nic_c⁄fig
(
iwl_›_mode
 *
›_mode
)

187 
	`might_¶ìp
();

188 
›_mode
->
›s
->
	`nic_c⁄fig
(op_mode);

189 
	}
}

191 
ölöe
 
	$iwl_›_mode_wimax_a˘ive
(
iwl_›_mode
 *
›_mode
)

193 
	`might_¶ìp
();

194 
›_mode
->
›s
->
	`wimax_a˘ive
(op_mode);

195 
	}
}

197 
ölöe
 
	$iwl_›_mode_time_poöt
(
iwl_›_mode
 *
›_mode
,

198 
iwl_fw_öi_time_poöt
 
ç_id
,

199 
iwl_dbg_év_ç_d©a
 *
ç_d©a
)

201 i‡(!
›_mode
 || !›_mode->
›s
 || !›_mode->›s->
time_poöt
)

203 
›_mode
->
›s
->
	`time_poöt
(›_mode, 
ç_id
, 
ç_d©a
);

204 
	}
}

	@iwl-phy-db.c

6 
	~<löux/¶ab.h
>

7 
	~<löux/°rög.h
>

8 
	~<löux/exp‹t.h
>

10 
	~"iwl-drv.h
"

11 
	~"iwl-phy-db.h
"

12 
	~"iwl-debug.h
"

13 
	~"iwl-›-mode.h
"

14 
	~"iwl-å™s.h
"

16 
	siwl_phy_db_íåy
 {

17 
u16
 
	msize
;

18 
u8
 *
	md©a
;

32 
	siwl_phy_db
 {

33 
iwl_phy_db_íåy
 
	mcfg
;

34 
iwl_phy_db_íåy
 
	mˇlib_nch
;

35 
	mn_group_∑pd
;

36 
iwl_phy_db_íåy
 *
	mˇlib_ch_group_∑pd
;

37 
	mn_group_txp
;

38 
iwl_phy_db_íåy
 *
	mˇlib_ch_group_txp
;

40 
iwl_å™s
 *
	må™s
;

43 
	eiwl_phy_db_£˘i⁄_ty≥
 {

44 
	mIWL_PHY_DB_CFG
 = 1,

45 
	mIWL_PHY_DB_CALIB_NCH
,

46 
	mIWL_PHY_DB_UNUSED
,

47 
	mIWL_PHY_DB_CALIB_CHG_PAPD
,

48 
	mIWL_PHY_DB_CALIB_CHG_TXP
,

49 
	mIWL_PHY_DB_MAX


52 
	#PHY_DB_CMD
 0x6c

	)

55 
	siwl_phy_db_chg_txp
 {

56 
__À32
 
	m•a˚
;

57 
__À16
 
	mmax_ch™√l_idx
;

58 } 
	g__∑cked
;

60 
iwl_phy_db
 *
	$iwl_phy_db_öô
(
iwl_å™s
 *
å™s
)

62 
iwl_phy_db
 *
phy_db
 = 
	`kzÆloc
((iwl_phy_db),

63 
GFP_KERNEL
);

65 i‡(!
phy_db
)

66  
phy_db
;

68 
phy_db
->
å™s
 =Årans;

70 
phy_db
->
n_group_txp
 = -1;

71 
phy_db
->
n_group_∑pd
 = -1;

74  
phy_db
;

75 
	}
}

76 
IWL_EXPORT_SYMBOL
(
iwl_phy_db_öô
);

82 
iwl_phy_db_íåy
 *

83 
	$iwl_phy_db_gë_£˘i⁄
(
iwl_phy_db
 *
phy_db
,

84 
iwl_phy_db_£˘i⁄_ty≥
 
ty≥
,

85 
u16
 
chg_id
)

87 i‡(!
phy_db
 || 
ty≥
 >
IWL_PHY_DB_MAX
)

88  
NULL
;

90 
ty≥
) {

91 
IWL_PHY_DB_CFG
:

92  &
phy_db
->
cfg
;

93 
IWL_PHY_DB_CALIB_NCH
:

94  &
phy_db
->
ˇlib_nch
;

95 
IWL_PHY_DB_CALIB_CHG_PAPD
:

96 i‡(
chg_id
 >
phy_db
->
n_group_∑pd
)

97  
NULL
;

98  &
phy_db
->
ˇlib_ch_group_∑pd
[
chg_id
];

99 
IWL_PHY_DB_CALIB_CHG_TXP
:

100 i‡(
chg_id
 >
phy_db
->
n_group_txp
)

101  
NULL
;

102  &
phy_db
->
ˇlib_ch_group_txp
[
chg_id
];

104  
NULL
;

106  
NULL
;

107 
	}
}

109 
	$iwl_phy_db_‰ì_£˘i⁄
(
iwl_phy_db
 *
phy_db
,

110 
iwl_phy_db_£˘i⁄_ty≥
 
ty≥
,

111 
u16
 
chg_id
)

113 
iwl_phy_db_íåy
 *
íåy
 =

114 
	`iwl_phy_db_gë_£˘i⁄
(
phy_db
, 
ty≥
, 
chg_id
);

115 i‡(!
íåy
)

118 
	`k‰ì
(
íåy
->
d©a
);

119 
íåy
->
d©a
 = 
NULL
;

120 
íåy
->
size
 = 0;

121 
	}
}

123 
	$iwl_phy_db_‰ì
(
iwl_phy_db
 *
phy_db
)

125 
i
;

127 i‡(!
phy_db
)

130 
	`iwl_phy_db_‰ì_£˘i⁄
(
phy_db
, 
IWL_PHY_DB_CFG
, 0);

131 
	`iwl_phy_db_‰ì_£˘i⁄
(
phy_db
, 
IWL_PHY_DB_CALIB_NCH
, 0);

133 
i
 = 0; i < 
phy_db
->
n_group_∑pd
; i++)

134 
	`iwl_phy_db_‰ì_£˘i⁄
(
phy_db
, 
IWL_PHY_DB_CALIB_CHG_PAPD
, 
i
);

135 
	`k‰ì
(
phy_db
->
ˇlib_ch_group_∑pd
);

137 
i
 = 0; i < 
phy_db
->
n_group_txp
; i++)

138 
	`iwl_phy_db_‰ì_£˘i⁄
(
phy_db
, 
IWL_PHY_DB_CALIB_CHG_TXP
, 
i
);

139 
	`k‰ì
(
phy_db
->
ˇlib_ch_group_txp
);

141 
	`k‰ì
(
phy_db
);

142 
	}
}

143 
IWL_EXPORT_SYMBOL
(
iwl_phy_db_‰ì
);

145 
	$iwl_phy_db_£t_£˘i⁄
(
iwl_phy_db
 *
phy_db
,

146 
iwl_rx_∑ckë
 *
pkt
)

148 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

149 
iwl_ˇlib_ªs_nŸif_phy_db
 *
phy_db_nŸif
 =

150 (
iwl_ˇlib_ªs_nŸif_phy_db
 *)
pkt
->
d©a
;

151 
iwl_phy_db_£˘i⁄_ty≥
 
ty≥
;

152 
u16
 
size
;

153 
iwl_phy_db_íåy
 *
íåy
;

154 
u16
 
chg_id
 = 0;

156 i‡(
pkt_Àn
 < (*
phy_db_nŸif
))

157  -
EINVAL
;

159 
ty≥
 = 
	`À16_to_˝u
(
phy_db_nŸif
->type);

160 
size
 = 
	`À16_to_˝u
(
phy_db_nŸif
->
Àngth
);

162 i‡(
pkt_Àn
 < (*
phy_db_nŸif
Ë+ 
size
)

163  -
EINVAL
;

165 i‡(!
phy_db
)

166  -
EINVAL
;

168 i‡(
ty≥
 =
IWL_PHY_DB_CALIB_CHG_PAPD
) {

169 
chg_id
 = 
	`À16_to_˝up
((
__À16
 *)
phy_db_nŸif
->
d©a
);

170 i‡(
phy_db
 && !phy_db->
ˇlib_ch_group_∑pd
) {

175 
phy_db
->
ˇlib_ch_group_∑pd
 = 
	`kˇŒoc
(
chg_id
 + 1,

176 (
iwl_phy_db_íåy
),

177 
GFP_ATOMIC
);

178 i‡(!
phy_db
->
ˇlib_ch_group_∑pd
)

179  -
ENOMEM
;

180 
phy_db
->
n_group_∑pd
 = 
chg_id
 + 1;

182 } i‡(
ty≥
 =
IWL_PHY_DB_CALIB_CHG_TXP
) {

183 
chg_id
 = 
	`À16_to_˝up
((
__À16
 *)
phy_db_nŸif
->
d©a
);

184 i‡(
phy_db
 && !phy_db->
ˇlib_ch_group_txp
) {

189 
phy_db
->
ˇlib_ch_group_txp
 = 
	`kˇŒoc
(
chg_id
 + 1,

190 (
iwl_phy_db_íåy
),

191 
GFP_ATOMIC
);

192 i‡(!
phy_db
->
ˇlib_ch_group_txp
)

193  -
ENOMEM
;

194 
phy_db
->
n_group_txp
 = 
chg_id
 + 1;

198 
íåy
 = 
	`iwl_phy_db_gë_£˘i⁄
(
phy_db
, 
ty≥
, 
chg_id
);

199 i‡(!
íåy
)

200  -
EINVAL
;

202 
	`k‰ì
(
íåy
->
d©a
);

203 
íåy
->
d©a
 = 
	`kmemdup
(
phy_db_nŸif
->d©a, 
size
, 
GFP_ATOMIC
);

204 i‡(!
íåy
->
d©a
) {

205 
íåy
->
size
 = 0;

206  -
ENOMEM
;

209 
íåy
->
size
 = size;

211 
	`IWL_DEBUG_INFO
(
phy_db
->
å™s
,

213 
__func__
, 
__LINE__
, 
ty≥
, 
size
);

216 
	}
}

217 
IWL_EXPORT_SYMBOL
(
iwl_phy_db_£t_£˘i⁄
);

219 
	$is_vÆid_ch™√l
(
u16
 
ch_id
)

221 i‡(
ch_id
 <= 14 ||

222 (36 <
ch_id
 && ch_id <= 64 && ch_id % 4 == 0) ||

223 (100 <
ch_id
 && ch_id <= 140 && ch_id % 4 == 0) ||

224 (145 <
ch_id
 && ch_id <= 165 && ch_id % 4 == 1))

227 
	}
}

229 
u8
 
	$ch_id_to_ch_ödex
(
u16
 
ch_id
)

231 i‡(
	`WARN_ON
(!
	`is_vÆid_ch™√l
(
ch_id
)))

234 i‡(
ch_id
 <= 14)

235  
ch_id
 - 1;

236 i‡(
ch_id
 <= 64)

237  (
ch_id
 + 20) / 4;

238 i‡(
ch_id
 <= 140)

239  (
ch_id
 - 12) / 4;

240  (
ch_id
 - 13) / 4;

241 
	}
}

244 
u16
 
	$ch™√l_id_to_∑pd
(
u16
 
ch_id
)

246 i‡(
	`WARN_ON
(!
	`is_vÆid_ch™√l
(
ch_id
)))

249 i‡(1 <
ch_id
 && ch_id <= 14)

251 i‡(36 <
ch_id
 && ch_id <= 64)

253 i‡(100 <
ch_id
 && ch_id <= 140)

256 
	}
}

258 
u16
 
	$ch™√l_id_to_txp
(
iwl_phy_db
 *
phy_db
, 
u16
 
ch_id
)

260 
iwl_phy_db_chg_txp
 *
txp_chg
;

261 
i
;

262 
u8
 
ch_ödex
 = 
	`ch_id_to_ch_ödex
(
ch_id
);

263 i‡(
ch_ödex
 == 0xff)

266 
i
 = 0; i < 
phy_db
->
n_group_txp
; i++) {

267 
txp_chg
 = (*)
phy_db
->
ˇlib_ch_group_txp
[
i
].
d©a
;

268 i‡(!
txp_chg
)

274 i‡(
	`À16_to_˝u
(
txp_chg
->
max_ch™√l_idx
Ë>
ch_ödex
)

275  
i
;

278 
	}
}

280 
	$iwl_phy_db_gë_£˘i⁄_d©a
(
iwl_phy_db
 *
phy_db
,

281 
u32
 
ty≥
, 
u8
 **
d©a
, 
u16
 *
size
, u16 
ch_id
)

283 
iwl_phy_db_íåy
 *
íåy
;

284 
u16
 
ch_group_id
 = 0;

286 i‡(!
phy_db
)

287  -
EINVAL
;

290 i‡(
ty≥
 =
IWL_PHY_DB_CALIB_CHG_PAPD
)

291 
ch_group_id
 = 
	`ch™√l_id_to_∑pd
(
ch_id
);

292 i‡(
ty≥
 =
IWL_PHY_DB_CALIB_CHG_TXP
)

293 
ch_group_id
 = 
	`ch™√l_id_to_txp
(
phy_db
, 
ch_id
);

295 
íåy
 = 
	`iwl_phy_db_gë_£˘i⁄
(
phy_db
, 
ty≥
, 
ch_group_id
);

296 i‡(!
íåy
)

297  -
EINVAL
;

299 *
d©a
 = 
íåy
->data;

300 *
size
 = 
íåy
->size;

302 
	`IWL_DEBUG_INFO
(
phy_db
->
å™s
,

304 
__func__
, 
__LINE__
, 
ty≥
, *
size
);

307 
	}
}

309 
	$iwl_£nd_phy_db_cmd
(
iwl_phy_db
 *
phy_db
, 
u16
 
ty≥
,

310 
u16
 
Àngth
, *
d©a
)

312 
iwl_phy_db_cmd
 
phy_db_cmd
;

313 
iwl_ho°_cmd
 
cmd
 = {

314 .
id
 = 
PHY_DB_CMD
,

317 
	`IWL_DEBUG_INFO
(
phy_db
->
å™s
,

319 
ty≥
, 
Àngth
);

322 
phy_db_cmd
.
ty≥
 = 
	`˝u_to_À16
(type);

323 
phy_db_cmd
.
Àngth
 = 
	`˝u_to_À16
(length);

326 
cmd
.
d©a
[0] = &
phy_db_cmd
;

327 
cmd
.
Àn
[0] = (
iwl_phy_db_cmd
);

328 
cmd
.
d©a
[1] = data;

329 
cmd
.
Àn
[1] = 
Àngth
;

330 
cmd
.
d©aÊags
[1] = 
IWL_HCMD_DFL_NOCOPY
;

332  
	`iwl_å™s_£nd_cmd
(
phy_db
->
å™s
, &
cmd
);

333 
	}
}

335 
	$iwl_phy_db_£nd_Æl_ch™√l_groups
(

336 
iwl_phy_db
 *
phy_db
,

337 
iwl_phy_db_£˘i⁄_ty≥
 
ty≥
,

338 
u8
 
max_ch_groups
)

340 
u16
 
i
;

341 
îr
;

342 
iwl_phy_db_íåy
 *
íåy
;

345 
i
 = 0; i < 
max_ch_groups
; i++) {

346 
íåy
 = 
	`iwl_phy_db_gë_£˘i⁄
(
phy_db
,

347 
ty≥
,

348 
i
);

349 i‡(!
íåy
)

350  -
EINVAL
;

352 i‡(!
íåy
->
size
)

356 
îr
 = 
	`iwl_£nd_phy_db_cmd
(
phy_db
,

357 
ty≥
,

358 
íåy
->
size
,

359 
íåy
->
d©a
);

360 i‡(
îr
) {

361 
	`IWL_ERR
(
phy_db
->
å™s
,

363 
ty≥
, 
i
, 
îr
);

364  
îr
;

367 
	`IWL_DEBUG_INFO
(
phy_db
->
å™s
,

369 
ty≥
, 
i
);

373 
	}
}

375 
	$iwl_£nd_phy_db_d©a
(
iwl_phy_db
 *
phy_db
)

377 
u8
 *
d©a
 = 
NULL
;

378 
u16
 
size
 = 0;

379 
îr
;

381 
	`IWL_DEBUG_INFO
(
phy_db
->
å™s
,

385 
îr
 = 
	`iwl_phy_db_gë_£˘i⁄_d©a
(
phy_db
, 
IWL_PHY_DB_CFG
,

386 &
d©a
, &
size
, 0);

387 i‡(
îr
) {

388 
	`IWL_ERR
(
phy_db
->
å™s
, "Cannot get Phy DB cfg section\n");

389  
îr
;

392 
îr
 = 
	`iwl_£nd_phy_db_cmd
(
phy_db
, 
IWL_PHY_DB_CFG
, 
size
, 
d©a
);

393 i‡(
îr
) {

394 
	`IWL_ERR
(
phy_db
->
å™s
,

396  
îr
;

399 
îr
 = 
	`iwl_phy_db_gë_£˘i⁄_d©a
(
phy_db
, 
IWL_PHY_DB_CALIB_NCH
,

400 &
d©a
, &
size
, 0);

401 i‡(
îr
) {

402 
	`IWL_ERR
(
phy_db
->
å™s
,

404  
îr
;

407 
îr
 = 
	`iwl_£nd_phy_db_cmd
(
phy_db
, 
IWL_PHY_DB_CALIB_NCH
, 
size
, 
d©a
);

408 i‡(
îr
) {

409 
	`IWL_ERR
(
phy_db
->
å™s
,

411  
îr
;

415 
îr
 = 
	`iwl_phy_db_£nd_Æl_ch™√l_groups
(
phy_db
,

416 
IWL_PHY_DB_CALIB_CHG_PAPD
,

417 
phy_db
->
n_group_∑pd
);

418 i‡(
îr
) {

419 
	`IWL_ERR
(
phy_db
->
å™s
,

421  
îr
;

425 
îr
 = 
	`iwl_phy_db_£nd_Æl_ch™√l_groups
(
phy_db
,

426 
IWL_PHY_DB_CALIB_CHG_TXP
,

427 
phy_db
->
n_group_txp
);

428 i‡(
îr
) {

429 
	`IWL_ERR
(
phy_db
->
å™s
,

431  
îr
;

434 
	`IWL_DEBUG_INFO
(
phy_db
->
å™s
,

437 
	}
}

438 
IWL_EXPORT_SYMBOL
(
iwl_£nd_phy_db_d©a
);

	@iwl-phy-db.h

5 #i‚de‡
__IWL_PHYDB_H__


6 
	#__IWL_PHYDB_H__


	)

8 
	~<löux/ty≥s.h
>

10 
	~"iwl-›-mode.h
"

11 
	~"iwl-å™s.h
"

13 
iwl_phy_db
 *
iwl_phy_db_öô
(
iwl_å™s
 *
å™s
);

15 
iwl_phy_db_‰ì
(
iwl_phy_db
 *
phy_db
);

17 
iwl_phy_db_£t_£˘i⁄
(
iwl_phy_db
 *
phy_db
,

18 
iwl_rx_∑ckë
 *
pkt
);

21 
iwl_£nd_phy_db_d©a
(
iwl_phy_db
 *
phy_db
);

	@iwl-prph.h

7 #i‚def 
__iwl_¥ph_h__


8 
	#__iwl_¥ph_h__


	)

9 
	~<löux/bôfõld.h
>

15 
	#PRPH_BASE
 (0x00000)

	)

16 
	#PRPH_END
 (0xFFFFF)

	)

19 
	#APMG_BASE
 (
PRPH_BASE
 + 0x3000)

	)

20 
	#APMG_CLK_CTRL_REG
 (
APMG_BASE
 + 0x0000)

	)

21 
	#APMG_CLK_EN_REG
 (
APMG_BASE
 + 0x0004)

	)

22 
	#APMG_CLK_DIS_REG
 (
APMG_BASE
 + 0x0008)

	)

23 
	#APMG_PS_CTRL_REG
 (
APMG_BASE
 + 0x000c)

	)

24 
	#APMG_PCIDEV_STT_REG
 (
APMG_BASE
 + 0x0010)

	)

25 
	#APMG_RFKILL_REG
 (
APMG_BASE
 + 0x0014)

	)

26 
	#APMG_RTC_INT_STT_REG
 (
APMG_BASE
 + 0x001c)

	)

27 
	#APMG_RTC_INT_MSK_REG
 (
APMG_BASE
 + 0x0020)

	)

28 
	#APMG_DIGITAL_SVR_REG
 (
APMG_BASE
 + 0x0058)

	)

29 
	#APMG_ANALOG_SVR_REG
 (
APMG_BASE
 + 0x006C)

	)

31 
	#APMS_CLK_VAL_MRB_FUNC_MODE
 (0x00000001)

	)

32 
	#APMG_CLK_VAL_DMA_CLK_RQT
 (0x00000200)

	)

33 
	#APMG_CLK_VAL_BSM_CLK_RQT
 (0x00000800)

	)

35 
	#APMG_PS_CTRL_EARLY_PWR_OFF_RESET_DIS
 (0x00400000)

	)

36 
	#APMG_PS_CTRL_VAL_RESET_REQ
 (0x04000000)

	)

37 
	#APMG_PS_CTRL_MSK_PWR_SRC
 (0x03000000)

	)

38 
	#APMG_PS_CTRL_VAL_PWR_SRC_VMAIN
 (0x00000000)

	)

39 
	#APMG_PS_CTRL_VAL_PWR_SRC_VAUX
 (0x02000000)

	)

40 
	#APMG_SVR_VOLTAGE_CONFIG_BIT_MSK
 (0x000001E0Ë

	)

41 
	#APMG_SVR_DIGITAL_VOLTAGE_1_32
 (0x00000060)

	)

43 
	#APMG_PCIDEV_STT_VAL_PERSIST_DIS
 (0x00000200)

	)

44 
	#APMG_PCIDEV_STT_VAL_L1_ACT_DIS
 (0x00000800)

	)

45 
	#APMG_PCIDEV_STT_VAL_WAKE_ME
 (0x00004000)

	)

47 
	#APMG_RTC_INT_STT_RFKILL
 (0x10000000)

	)

50 
	#DEVICE_SYSTEM_TIME_REG
 0xA0206C

	)

53 
	#DEVICE_SET_NMI_REG
 0x00a01c30

	)

54 
	#DEVICE_SET_NMI_VAL_DRV
 
	`BIT
(7)

	)

56 
	#UREG_NIC_SET_NMI_DRIVER
 0x00a05c10

	)

57 
	#UREG_NIC_SET_NMI_DRIVER_NMI_FROM_DRIVER
 
	`BIT
(24)

	)

58 
	#UREG_NIC_SET_NMI_DRIVER_RESET_HANDSHAKE
 (
	`BIT
(24Ë| BIT(25))

	)

61 
	#SHR_BASE
 0x00a10000

	)

64 
	#SHR_APMG_GP1_REG
 0x01dc

	)

65 
	#SHR_APMG_GP1_REG_PRPH
 (
SHR_BASE
 + 
SHR_APMG_GP1_REG
)

	)

66 
	#SHR_APMG_GP1_WF_XTAL_LP_EN
 0x00000004

	)

67 
	#SHR_APMG_GP1_CHICKEN_BIT_SELECT
 0x80000000

	)

70 
	#SHR_APMG_DL_CFG_REG
 0x01c4

	)

71 
	#SHR_APMG_DL_CFG_REG_PRPH
 (
SHR_BASE
 + 
SHR_APMG_DL_CFG_REG
)

	)

72 
	#SHR_APMG_DL_CFG_RTCS_CLK_SELECTOR_MSK
 0x000000c0

	)

73 
	#SHR_APMG_DL_CFG_RTCS_CLK_INTERNAL_XTAL
 0x00000080

	)

74 
	#SHR_APMG_DL_CFG_DL_CLOCK_POWER_UP
 0x00000100

	)

77 
	#SHR_APMG_XTAL_CFG_REG
 0x1c0

	)

78 
	#SHR_APMG_XTAL_CFG_XTAL_ON_REQ
 0x80000000

	)

84 
	#RELEASE_CPU_RESET
 (0x300C)

	)

85 
	#RELEASE_CPU_RESET_BIT
 
	`BIT
(24)

	)

91 
	#SHR_MISC_WFM_DTS_EN
 (0x00a10024)

	)

92 
	#DTSC_CFG_MODE
 (0x00a10604)

	)

93 
	#DTSC_VREF_AVG
 (0x00a10648)

	)

94 
	#DTSC_VREF5_AVG
 (0x00a1064c)

	)

95 
	#DTSC_CFG_MODE_PERIODIC
 (0x2)

	)

96 
	#DTSC_PTAT_AVG
 (0x00a10650)

	)

170 
	#SCD_MEM_LOWER_BOUND
 (0x0000)

	)

177 
	#SCD_WIN_SIZE
 64

	)

178 
	#SCD_FRAME_LIMIT
 64

	)

180 
	#SCD_TXFIFO_POS_TID
 (0)

	)

181 
	#SCD_TXFIFO_POS_RA
 (4)

	)

182 
	#SCD_QUEUE_RA_TID_MAP_RATID_MSK
 (0x01FF)

	)

185 
	#SCD_QUEUE_STTS_REG_POS_TXF
 (0)

	)

186 
	#SCD_QUEUE_STTS_REG_POS_ACTIVE
 (3)

	)

187 
	#SCD_QUEUE_STTS_REG_POS_WSL
 (4)

	)

188 
	#SCD_QUEUE_STTS_REG_POS_SCD_ACT_EN
 (19)

	)

189 
	#SCD_QUEUE_STTS_REG_MSK
 (0x017F0000)

	)

191 
	#SCD_QUEUE_CTX_REG1_CREDIT
 (0x00FFFF00)

	)

192 
	#SCD_QUEUE_CTX_REG1_SUPER_CREDIT
 (0xFF000000)

	)

193 
	#SCD_QUEUE_CTX_REG1_VAL
(
_n
, 
_v
Ë
	`FIELD_PREP
(
SCD_QUEUE_CTX_REG1_
 ## _n, _v)

	)

195 
	#SCD_QUEUE_CTX_REG2_WIN_SIZE
 (0x0000007F)

	)

196 
	#SCD_QUEUE_CTX_REG2_FRAME_LIMIT
 (0x007F0000)

	)

197 
	#SCD_QUEUE_CTX_REG2_VAL
(
_n
, 
_v
Ë
	`FIELD_PREP
(
SCD_QUEUE_CTX_REG2_
 ## _n, _v)

	)

199 
	#SCD_GP_CTRL_ENABLE_31_QUEUES
 
	`BIT
(0)

	)

200 
	#SCD_GP_CTRL_AUTO_ACTIVE_MODE
 
	`BIT
(18)

	)

203 
	#SCD_CONTEXT_MEM_LOWER_BOUND
 (
SCD_MEM_LOWER_BOUND
 + 0x600)

	)

204 
	#SCD_CONTEXT_MEM_UPPER_BOUND
 (
SCD_MEM_LOWER_BOUND
 + 0x6A0)

	)

207 
	#SCD_TX_STTS_MEM_LOWER_BOUND
 (
SCD_MEM_LOWER_BOUND
 + 0x6A0)

	)

208 
	#SCD_TX_STTS_MEM_UPPER_BOUND
 (
SCD_MEM_LOWER_BOUND
 + 0x7E0)

	)

211 
	#SCD_TRANS_TBL_MEM_LOWER_BOUND
 (
SCD_MEM_LOWER_BOUND
 + 0x7E0)

	)

212 
	#SCD_TRANS_TBL_MEM_UPPER_BOUND
 (
SCD_MEM_LOWER_BOUND
 + 0x808)

	)

214 
	#SCD_CONTEXT_QUEUE_OFFSET
(
x
)\

215 (
SCD_CONTEXT_MEM_LOWER_BOUND
 + ((
x
Ë* 8))

	)

217 
	#SCD_TX_STTS_QUEUE_OFFSET
(
x
)\

218 (
SCD_TX_STTS_MEM_LOWER_BOUND
 + ((
x
Ë* 16))

	)

220 
	#SCD_TRANS_TBL_OFFSET_QUEUE
(
x
) \

221 ((
SCD_TRANS_TBL_MEM_LOWER_BOUND
 + ((
x
Ë* 2)Ë& 0xfffc)

	)

223 
	#SCD_BASE
 (
PRPH_BASE
 + 0xa02c00)

	)

225 
	#SCD_SRAM_BASE_ADDR
 (
SCD_BASE
 + 0x0)

	)

226 
	#SCD_DRAM_BASE_ADDR
 (
SCD_BASE
 + 0x8)

	)

227 
	#SCD_AIT
 (
SCD_BASE
 + 0x0c)

	)

228 
	#SCD_TXFACT
 (
SCD_BASE
 + 0x10)

	)

229 
	#SCD_ACTIVE
 (
SCD_BASE
 + 0x14)

	)

230 
	#SCD_QUEUECHAIN_SEL
 (
SCD_BASE
 + 0xe8)

	)

231 
	#SCD_CHAINEXT_EN
 (
SCD_BASE
 + 0x244)

	)

232 
	#SCD_AGGR_SEL
 (
SCD_BASE
 + 0x248)

	)

233 
	#SCD_INTERRUPT_MASK
 (
SCD_BASE
 + 0x108)

	)

234 
	#SCD_GP_CTRL
 (
SCD_BASE
 + 0x1a8)

	)

235 
	#SCD_EN_CTRL
 (
SCD_BASE
 + 0x254)

	)

240 
	#OSC_CLK
 (0xa04068)

	)

241 
	#OSC_CLK_FORCE_CONTROL
 (0x8)

	)

243 
	#FH_UCODE_LOAD_STATUS
 (0x1AF0)

	)

250 
	#UREG_UCODE_LOAD_STATUS
 (0xa05c40)

	)

251 
	#UREG_CPU_INIT_RUN
 (0xa05c44)

	)

253 
	#LMPM_SECURE_UCODE_LOAD_CPU1_HDR_ADDR
 (0x1E78)

	)

254 
	#LMPM_SECURE_UCODE_LOAD_CPU2_HDR_ADDR
 (0x1E7C)

	)

256 
	#LMPM_SECURE_CPU1_HDR_MEM_SPACE
 (0x420000)

	)

257 
	#LMPM_SECURE_CPU2_HDR_MEM_SPACE
 (0x420400)

	)

259 
	#LMAC2_PRPH_OFFSET
 (0x100000)

	)

262 
	#RXF_SIZE_ADDR
 (0xa00c88)

	)

263 
	#RXF_RD_D_SPACE
 (0xa00c40)

	)

264 
	#RXF_RD_WR_PTR
 (0xa00c50)

	)

265 
	#RXF_RD_RD_PTR
 (0xa00c54)

	)

266 
	#RXF_RD_FENCE_PTR
 (0xa00c4c)

	)

267 
	#RXF_SET_FENCE_MODE
 (0xa00c14)

	)

268 
	#RXF_LD_WR2FENCE
 (0xa00c1c)

	)

269 
	#RXF_FIFO_RD_FENCE_INC
 (0xa00c68)

	)

270 
	#RXF_SIZE_BYTE_CND_POS
 (7)

	)

271 
	#RXF_SIZE_BYTE_CNT_MSK
 (0x3f‡<< 
RXF_SIZE_BYTE_CND_POS
)

	)

272 
	#RXF_DIFF_FROM_PREV
 (0x200)

	)

273 
	#RXF2C_DIFF_FROM_PREV
 (0x4e00)

	)

275 
	#RXF_LD_FENCE_OFFSET_ADDR
 (0xa00c10)

	)

276 
	#RXF_FIFO_RD_FENCE_ADDR
 (0xa00c0c)

	)

279 
	#TXF_FIFO_ITEM_CNT
 (0xa00438)

	)

280 
	#TXF_WR_PTR
 (0xa00414)

	)

281 
	#TXF_RD_PTR
 (0xa00410)

	)

282 
	#TXF_FENCE_PTR
 (0xa00418)

	)

283 
	#TXF_LOCK_FENCE
 (0xa00424)

	)

284 
	#TXF_LARC_NUM
 (0xa0043c)

	)

285 
	#TXF_READ_MODIFY_DATA
 (0xa00448)

	)

286 
	#TXF_READ_MODIFY_ADDR
 (0xa0044c)

	)

289 
	#TXF_CPU2_FIFO_ITEM_CNT
 (0xA00538)

	)

290 
	#TXF_CPU2_WR_PTR
 (0xA00514)

	)

291 
	#TXF_CPU2_RD_PTR
 (0xA00510)

	)

292 
	#TXF_CPU2_FENCE_PTR
 (0xA00518)

	)

293 
	#TXF_CPU2_LOCK_FENCE
 (0xA00524)

	)

294 
	#TXF_CPU2_NUM
 (0xA0053C)

	)

295 
	#TXF_CPU2_READ_MODIFY_DATA
 (0xA00548)

	)

296 
	#TXF_CPU2_READ_MODIFY_ADDR
 (0xA0054C)

	)

299 
	#RSP_RADIO_CMD
 (0xa02804)

	)

300 
	#RSP_RADIO_RDDAT
 (0xa02814)

	)

301 
	#RADIO_RSP_ADDR_POS
 (6)

	)

302 
	#RADIO_RSP_RD_CMD
 (3)

	)

305 
	#HPM_MAC_LTR_CSR
 0xa0348c

	)

306 
	#HPM_MAC_LRT_ENABLE_ALL
 0xf

	)

308 
	#HPM_UMAC_LTR
 0xa03480

	)

311 
	#MON_BUFF_SAMPLE_CTL
 (0xa03c00)

	)

312 
	#MON_BUFF_BASE_ADDR
 (0xa03c1c)

	)

313 
	#MON_BUFF_END_ADDR
 (0xa03c40)

	)

314 
	#MON_BUFF_WRPTR
 (0xa03c44)

	)

315 
	#MON_BUFF_CYCLE_CNT
 (0xa03c48)

	)

317 
	#MON_BUFF_BASE_ADDR_VER2
 (0xa03c1c)

	)

318 
	#MON_BUFF_END_ADDR_VER2
 (0xa03c20)

	)

319 
	#MON_BUFF_WRPTR_VER2
 (0xa03c24)

	)

320 
	#MON_BUFF_CYCLE_CNT_VER2
 (0xa03c28)

	)

321 
	#MON_BUFF_SHIFT_VER2
 (0x8)

	)

323 
	#DBGC_CUR_DBGBUF_BASE_ADDR_LSB
 (0xd03c20)

	)

324 
	#DBGC_CUR_DBGBUF_BASE_ADDR_MSB
 (0xd03c24)

	)

325 
	#DBGC_CUR_DBGBUF_STATUS
 (0xd03c1c)

	)

326 
	#DBGC_DBGBUF_WRAP_AROUND
 (0xd03c2c)

	)

327 
	#DBGC_CUR_DBGBUF_STATUS_OFFSET_MSK
 (0x00ffffff)

	)

328 
	#DBGC_CUR_DBGBUF_STATUS_IDX_MSK
 (0x0f000000)

	)

330 
	#MON_DMARB_RD_CTL_ADDR
 (0xa03c60)

	)

331 
	#MON_DMARB_RD_DATA_ADDR
 (0xa03c5c)

	)

333 
	#DBGC_IN_SAMPLE
 (0xa03c00)

	)

334 
	#DBGC_OUT_CTRL
 (0xa03c0c)

	)

337 
	#LDBG_M2S_BUF_WPTR
 (0xa0476c)

	)

338 
	#LDBG_M2S_BUF_WRAP_CNT
 (0xa04774)

	)

339 
	#LDBG_M2S_BUF_WPTR_VAL_MSK
 (0x000fffff)

	)

340 
	#LDBG_M2S_BUF_WRAP_CNT_VAL_MSK
 (0x000fffff)

	)

343 
	#WFPM_PS_CTL_CLR
 0xA0300C

	)

344 
	#WFMP_MAC_ADDR_0
 0xA03080

	)

345 
	#WFMP_MAC_ADDR_1
 0xA03084

	)

346 
	#LMPM_PMG_EN
 0xA01CEC

	)

347 
	#RADIO_REG_SYS_MANUAL_DFT_0
 0xAD4078

	)

348 
	#RFIC_REG_RD
 0xAD0470

	)

349 
	#WFPM_CTRL_REG
 0xA03030

	)

350 
	#WFPM_OTP_CFG1_ADDR
 0x00a03098

	)

351 
	#WFPM_OTP_CFG1_IS_JACKET_BIT
 
	`BIT
(5)

	)

352 
	#WFPM_OTP_CFG1_IS_CDB_BIT
 
	`BIT
(4)

	)

353 
	#WFPM_OTP_BZ_BNJ_JACKET_BIT
 5

	)

354 
	#WFPM_OTP_BZ_BNJ_CDB_BIT
 4

	)

355 
	#WFPM_OTP_CFG1_IS_JACKET
(
_vÆ
Ë(((_vÆË& 0x00000020Ë>> 
WFPM_OTP_BZ_BNJ_JACKET_BIT
)

	)

356 
	#WFPM_OTP_CFG1_IS_CDB
(
_vÆ
Ë(((_vÆË& 0x00000010Ë>> 
WFPM_OTP_BZ_BNJ_CDB_BIT
)

	)

359 
	#WFPM_GP2
 0xA030B4

	)

362 
	#DBGI_SRAM_TARGET_ACCESS_RDATA_LSB
 0x00A2E154

	)

363 
	#DBGI_SRAM_TARGET_ACCESS_RDATA_MSB
 0x00A2E158

	)

364 
	#DBGI_SRAM_FIFO_POINTERS
 0x00A2E148

	)

365 
	#DBGI_SRAM_FIFO_POINTERS_WR_PTR_MSK
 0x00000FFF

	)

368 
	mWFPM_AUX_CTL_AUX_IF_MAC_OWNER_MSK
 = 0x80000000,

371 
	#CNVI_AUX_MISC_CHIP
 0xA200B0

	)

372 
	#CNVI_AUX_MISC_CHIP_MAC_STEP
(
_vÆ
Ë(((_vÆË& 0xf000000Ë>> 24)

	)

373 
	#CNVI_AUX_MISC_CHIP_PROD_TYPE
(
_vÆ
Ë((_vÆË& 0xfff)

	)

374 
	#CNVI_AUX_MISC_CHIP_PROD_TYPE_BZ_U
 0x930

	)

376 
	#CNVR_AUX_MISC_CHIP
 0xA2B800

	)

377 
	#CNVR_SCU_SD_REGS_SD_REG_DIG_DCDC_VTRIM
 0xA29890

	)

378 
	#CNVR_SCU_SD_REGS_SD_REG_ACTIVE_VDIG_MIRROR
 0xA29938

	)

379 
	#CNVI_SCU_SEQ_DATA_DW9
 0xA27488

	)

381 
	#CNVI_PMU_STEP_FLOW
 0xA2D588

	)

382 
	#CNVI_PMU_STEP_FLOW_FORCE_URM
 
	`BIT
(2)

	)

384 
	#PREG_AUX_BUS_WPROT_0
 0xA04CC0

	)

387 
	#PREG_PRPH_WPROT_9000
 0xA04CE0

	)

389 
	#PREG_PRPH_WPROT_22000
 0xA04D00

	)

391 
	#SB_MODIFY_CFG_FLAG
 0xA03088

	)

392 
	#SB_CFG_RESIDES_IN_ROM
 0x80

	)

393 
	#SB_CPU_1_STATUS
 0xA01E30

	)

394 
	#SB_CPU_2_STATUS
 0xA01E34

	)

395 
	#UMAG_SB_CPU_1_STATUS
 0xA038C0

	)

396 
	#UMAG_SB_CPU_2_STATUS
 0xA038C4

	)

397 
	#UMAG_GEN_HW_STATUS
 0xA038C8

	)

398 
	#UREG_UMAC_CURRENT_PC
 0xa05c18

	)

399 
	#UREG_LMAC1_CURRENT_PC
 0xa05c1c

	)

400 
	#UREG_LMAC2_CURRENT_PC
 0xa05c20

	)

402 
	#WFPM_LMAC1_PD_NOTIFICATION
 0xa0338c

	)

403 
	#WFPM_ARC1_PD_NOTIFICATION
 0xa03044

	)

404 
	#HPM_SECONDARY_DEVICE_STATE
 0xa03404

	)

405 
	#WFPM_MAC_OTP_CFG7_ADDR
 0xa03338

	)

406 
	#WFPM_MAC_OTP_CFG7_DATA
 0xa0333c

	)

411 
	mUMAG_GEN_HW_IS_FPGA
 = 
BIT
(1),

415 
	#LMPM_CHICK
 0xA01FF8

	)

417 
	mLMPM_CHICK_EXTENDED_ADDR_SPACE
 = 
BIT
(0),

421 
	#LMPM_PAGE_PASS_NOTIF
 0xA03824

	)

423 
	mLMPM_PAGE_PASS_NOTIF_POS
 = 
BIT
(20),

436 
	#REG_CRF_ID_TYPE
(
vÆ
Ë(((vÆË& 0x00000FFFË>> 0)

	)

437 
	#REG_CRF_ID_SLAVE
(
vÆ
Ë(((vÆË& 0x00080000Ë>> 19)

	)

438 
	#REG_CRF_ID_DASH
(
vÆ
Ë(((vÆË& 0x00F00000Ë>> 20)

	)

439 
	#REG_CRF_ID_STEP
(
vÆ
Ë(((vÆË& 0x0F000000Ë>> 24)

	)

440 
	#REG_CRF_ID_FLAVOR
(
vÆ
Ë(((vÆË& 0xF0000000Ë>> 28)

	)

442 
	#UREG_CHICK
 (0xA05C00)

	)

443 
	#UREG_CHICK_MSI_ENABLE
 
	`BIT
(24)

	)

444 
	#UREG_CHICK_MSIX_ENABLE
 
	`BIT
(25)

	)

446 
	#SD_REG_VER
 0xa29600

	)

447 
	#SD_REG_VER_GEN2
 0x00a2b800

	)

449 
	#REG_CRF_ID_TYPE_JF_1
 0x201

	)

450 
	#REG_CRF_ID_TYPE_JF_2
 0x202

	)

451 
	#REG_CRF_ID_TYPE_HR_CDB
 0x503

	)

452 
	#REG_CRF_ID_TYPE_HR_NONE_CDB
 0x504

	)

453 
	#REG_CRF_ID_TYPE_HR_NONE_CDB_1X1
 0x501

	)

454 
	#REG_CRF_ID_TYPE_HR_NONE_CDB_CCP
 0x532

	)

455 
	#REG_CRF_ID_TYPE_GF
 0x410

	)

456 
	#REG_CRF_ID_TYPE_GF_TC
 0xF08

	)

457 
	#REG_CRF_ID_TYPE_MR
 0x810

	)

458 
	#REG_CRF_ID_TYPE_FM
 0x910

	)

459 
	#REG_CRF_ID_TYPE_FMI
 0x930

	)

460 
	#REG_CRF_ID_TYPE_FMR
 0x900

	)

461 
	#REG_CRF_ID_TYPE_WHP
 0xA10

	)

463 
	#HPM_DEBUG
 0xA03440

	)

464 
	#PERSISTENCE_BIT
 
	`BIT
(12)

	)

465 
	#PREG_WFPM_ACCESS
 
	`BIT
(12)

	)

467 
	#HPM_HIPM_GEN_CFG
 0xA03458

	)

468 
	#HPM_HIPM_GEN_CFG_CR_PG_EN
 
	`BIT
(0)

	)

469 
	#HPM_HIPM_GEN_CFG_CR_SLP_EN
 
	`BIT
(1)

	)

470 
	#HPM_HIPM_GEN_CFG_CR_FORCE_ACTIVE
 
	`BIT
(10)

	)

472 
	#UREG_DOORBELL_TO_ISR6
 0xA05C04

	)

473 
	#UREG_DOORBELL_TO_ISR6_NMI_BIT
 
	`BIT
(0)

	)

474 
	#UREG_DOORBELL_TO_ISR6_RESET_HANDSHAKE
 (
	`BIT
(0Ë| BIT(1))

	)

475 
	#UREG_DOORBELL_TO_ISR6_SUSPEND
 
	`BIT
(18)

	)

476 
	#UREG_DOORBELL_TO_ISR6_RESUME
 
	`BIT
(19)

	)

477 
	#UREG_DOORBELL_TO_ISR6_PNVM
 
	`BIT
(20)

	)

484 
	#UREG_DOORBELL_TO_ISR6_SLEEP_CTRL
 
	`BIT
(31)

	)

486 
	#CNVI_MBOX_C
 0xA3400C

	)

488 
	#FSEQ_ERROR_CODE
 0xA340C8

	)

489 
	#FSEQ_TOP_INIT_VERSION
 0xA34038

	)

490 
	#FSEQ_CNVIO_INIT_VERSION
 0xA3403C

	)

491 
	#FSEQ_OTP_VERSION
 0xA340FC

	)

492 
	#FSEQ_TOP_CONTENT_VERSION
 0xA340F4

	)

493 
	#FSEQ_ALIVE_TOKEN
 0xA340F0

	)

494 
	#FSEQ_CNVI_ID
 0xA3408C

	)

495 
	#FSEQ_CNVR_ID
 0xA34090

	)

496 
	#FSEQ_PREV_CNVIO_INIT_VERSION
 0xA34084

	)

497 
	#FSEQ_WIFI_FSEQ_VERSION
 0xA34040

	)

498 
	#FSEQ_BT_FSEQ_VERSION
 0xA34044

	)

499 
	#FSEQ_CLASS_TP_VERSION
 0xA34078

	)

501 
	#IWL_D3_SLEEP_STATUS_SUSPEND
 0xD3

	)

502 
	#IWL_D3_SLEEP_STATUS_RESUME
 0xD0

	)

504 
	#WMAL_INDRCT_RD_CMD1_OPMOD_POS
 28

	)

505 
	#WMAL_INDRCT_RD_CMD1_BYTE_ADDRESS_MSK
 0xFFFFF

	)

506 
	#WMAL_CMD_READ_BURST_ACCESS
 2

	)

507 
	#WMAL_MRSPF_1
 0xADFC20

	)

508 
	#WMAL_INDRCT_RD_CMD1
 0xADFD44

	)

509 
	#WMAL_INDRCT_CMD1
 0xADFC14

	)

510 
	#WMAL_INDRCT_CMD
(
addr
) \

511 ((
WMAL_CMD_READ_BURST_ACCESS
 << 
WMAL_INDRCT_RD_CMD1_OPMOD_POS
) | \

512 ((
addr
Ë& 
WMAL_INDRCT_RD_CMD1_BYTE_ADDRESS_MSK
))

	)

514 
	#WFPM_LMAC1_PS_CTL_RW
 0xA03380

	)

515 
	#WFPM_LMAC2_PS_CTL_RW
 0xA033C0

	)

516 
	#WFPM_PS_CTL_RW_PHYRF_PD_FSM_CURSTATE_MSK
 0x0000000F

	)

517 
	#WFPM_PHYRF_STATE_ON
 5

	)

518 
	#HBUS_TIMEOUT
 0xA5A5A5A1

	)

519 
	#WFPM_DPHY_OFF
 0xDF10FF

	)

521 
	#REG_OTP_MINOR
 0xA0333C

	)

523 
	#WFPM_LMAC2_PD_NOTIFICATION
 0xA033CC

	)

524 
	#WFPM_LMAC2_PD_RE_READ
 
	`BIT
(31)

	)

526 
	#DPHYIP_INDIRECT
 0xA2D800

	)

527 
	#DPHYIP_INDIRECT_RD_MSK
 0xFF000000

	)

528 
	#DPHYIP_INDIRECT_RD_SHIFT
 24

	)

	@iwl-scd.h

5 #i‚de‡
__iwl_scd_h__


6 
	#__iwl_scd_h__


	)

8 
	~"iwl-å™s.h
"

9 
	~"iwl-io.h
"

10 
	~"iwl-¥ph.h
"

13 
ölöe
 
	$iwl_scd_txq_£t_chaö
(
iwl_å™s
 *
å™s
,

14 
u16
 
txq_id
)

16 
	`iwl_£t_bôs_¥ph
(
å™s
, 
SCD_QUEUECHAIN_SEL
, 
	`BIT
(
txq_id
));

17 
	}
}

19 
ölöe
 
	$iwl_scd_txq_íabÀ_agg
(
iwl_å™s
 *
å™s
,

20 
u16
 
txq_id
)

22 
	`iwl_£t_bôs_¥ph
(
å™s
, 
SCD_AGGR_SEL
, 
	`BIT
(
txq_id
));

23 
	}
}

25 
ölöe
 
	$iwl_scd_txq_dißbÀ_agg
(
iwl_å™s
 *
å™s
,

26 
u16
 
txq_id
)

28 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
SCD_AGGR_SEL
, 
	`BIT
(
txq_id
));

29 
	}
}

31 
ölöe
 
	$iwl_scd_dißbÀ_agg
(
iwl_å™s
 *
å™s
)

33 
	`iwl_£t_bôs_¥ph
(
å™s
, 
SCD_AGGR_SEL
, 0);

34 
	}
}

36 
ölöe
 
	$iwl_scd_a˘iv©e_fifos
(
iwl_å™s
 *
å™s
)

38 
	`iwl_wrôe_¥ph
(
å™s
, 
SCD_TXFACT
, 
	`IWL_MASK
(0, 7));

39 
	}
}

41 
ölöe
 
	$iwl_scd_dó˘iv©e_fifos
(
iwl_å™s
 *
å™s
)

43 
	`iwl_wrôe_¥ph
(
å™s
, 
SCD_TXFACT
, 0);

44 
	}
}

46 
ölöe
 
	$iwl_scd_íabÀ_£t_a˘ive
(
iwl_å™s
 *
å™s
,

47 
u32
 
vÆue
)

49 
	`iwl_wrôe_¥ph
(
å™s
, 
SCD_EN_CTRL
, 
vÆue
);

50 
	}
}

52 
ölöe
 
	$SCD_QUEUE_WRPTR
(
ch∆
)

54 i‡(
ch∆
 < 20)

55  
SCD_BASE
 + 0x18 + 
ch∆
 * 4;

56 
	`WARN_ON_ONCE
(
ch∆
 >= 32);

57  
SCD_BASE
 + 0x284 + (
ch∆
 - 20) * 4;

58 
	}
}

60 
ölöe
 
	$SCD_QUEUE_RDPTR
(
ch∆
)

62 i‡(
ch∆
 < 20)

63  
SCD_BASE
 + 0x68 + 
ch∆
 * 4;

64 
	`WARN_ON_ONCE
(
ch∆
 >= 32);

65  
SCD_BASE
 + 0x2B4 + 
ch∆
 * 4;

66 
	}
}

68 
ölöe
 
	$SCD_QUEUE_STATUS_BITS
(
ch∆
)

70 i‡(
ch∆
 < 20)

71  
SCD_BASE
 + 0x10¯+ 
ch∆
 * 4;

72 
	`WARN_ON_ONCE
(
ch∆
 >= 32);

73  
SCD_BASE
 + 0x334 + 
ch∆
 * 4;

74 
	}
}

76 
ölöe
 
	$iwl_scd_txq_£t_öa˘ive
(
iwl_å™s
 *
å™s
,

77 
u16
 
txq_id
)

79 
	`iwl_wrôe_¥ph
(
å™s
, 
	`SCD_QUEUE_STATUS_BITS
(
txq_id
),

80 (0 << 
SCD_QUEUE_STTS_REG_POS_ACTIVE
)|

81 (1 << 
SCD_QUEUE_STTS_REG_POS_SCD_ACT_EN
));

82 
	}
}

	@iwl-trans.c

7 
	~<löux/kî√l.h
>

8 
	~<löux/b£¨ch.h
>

10 
	~"fw/≠i/tx.h
"

11 
	~"iwl-å™s.h
"

12 
	~"iwl-drv.h
"

13 
	~"iwl-fh.h
"

14 
	~"queue/tx.h
"

15 
	~<löux/dm≠oﬁ.h
>

16 
	~"fw/≠i/comm™ds.h
"

18 
iwl_å™s
 *
	$iwl_å™s_Æloc
(
¥iv_size
,

19 
devi˚
 *
dev
,

20 c⁄° 
iwl_å™s_›s
 *
›s
,

21 c⁄° 
iwl_cfg_å™s_∑øms
 *
cfg_å™s
)

23 
iwl_å™s
 *
å™s
;

24 #ifde‡
CONFIG_LOCKDEP


25 
lock_˛ass_key
 
__key
;

28 
å™s
 = 
	`devm_kzÆloc
(
dev
, (*å™sË+ 
¥iv_size
, 
GFP_KERNEL
);

29 i‡(!
å™s
)

30  
NULL
;

32 
å™s
->
å™s_cfg
 = 
cfg_å™s
;

34 #ifde‡
CONFIG_LOCKDEP


35 
	`lockdï_öô_m≠
(&
å™s
->
sync_cmd_lockdï_m≠
, "sync_cmd_lockdep_map",

36 &
__key
, 0);

39 
å™s
->
dev
 = dev;

40 
å™s
->
›s
 = ops;

41 
å™s
->
num_rx_queues
 = 1;

43 
	`WARN_ON
(!
›s
->
waô_txq_em±y
 && !›s->
waô_tx_queues_em±y
);

45 i‡(
å™s
->
å™s_cfg
->
gí2
) {

46 
å™s
->
txqs
.
tfd
.
addr_size
 = 64;

47 
å™s
->
txqs
.
tfd
.
max_tbs
 = 
IWL_TFH_NUM_TBS
;

48 
å™s
->
txqs
.
tfd
.
size
 = (
iwl_tfh_tfd
);

50 
å™s
->
txqs
.
tfd
.
addr_size
 = 36;

51 
å™s
->
txqs
.
tfd
.
max_tbs
 = 
IWL_NUM_OF_TBS
;

52 
å™s
->
txqs
.
tfd
.
size
 = (
iwl_tfd
);

54 
å™s
->
max_skb_‰ags
 = 
	`IWL_TRANS_MAX_FRAGS
(trans);

56  
å™s
;

57 
	}
}

59 
	$iwl_å™s_öô
(
iwl_å™s
 *
å™s
)

61 
txcmd_size
, 
txcmd_Æign
;

63 i‡(!
å™s
->
å™s_cfg
->
gí2
) {

64 
txcmd_size
 = (
iwl_tx_cmd
);

65 
txcmd_Æign
 = (*);

66 } i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
) {

67 
txcmd_size
 = (
iwl_tx_cmd_gí2
);

68 
txcmd_Æign
 = 64;

70 
txcmd_size
 = (
iwl_tx_cmd_gí3
);

71 
txcmd_Æign
 = 128;

74 
txcmd_size
 +(
iwl_cmd_hódî
);

75 
txcmd_size
 += 36;

78 i‡(
	`WARN_ON
(
å™s
->
å™s_cfg
->
gí2
 && 
txcmd_size
 >
txcmd_Æign
))

79  -
EINVAL
;

81 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

82 
å™s
->
txqs
.
bc_tbl_size
 =

83 (
iwl_gí3_bc_tbl_íåy
Ë* 
TFD_QUEUE_BC_SIZE_GEN3_BZ
;

84 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

85 
å™s
->
txqs
.
bc_tbl_size
 =

86 (
iwl_gí3_bc_tbl_íåy
Ë* 
TFD_QUEUE_BC_SIZE_GEN3_AX210
;

88 
å™s
->
txqs
.
bc_tbl_size
 = (
iwœgn_scd_bc_tbl
);

94 i‡(
å™s
->
å™s_cfg
->
gí2
) {

95 
å™s
->
txqs
.
bc_poﬁ
 = 
	`dmam_poﬁ_¸óã
("iwlwifi:bc",Åøns->
dev
,

96 
å™s
->
txqs
.
bc_tbl_size
,

98 i‡(!
å™s
->
txqs
.
bc_poﬁ
)

99  -
ENOMEM
;

103 
	`WARN_ON
(
å™s
->
txqs
.
tfd
.
addr_size
 !=

104 (
å™s
->
å™s_cfg
->
gí2
 ? 64 : 36));

106 
	`¢¥ötf
(
å™s
->
dev_cmd_poﬁ_«me
, (trans->dev_cmd_pool_name),

107 "iwl_cmd_poﬁ:%s", 
	`dev_«me
(
å™s
->
dev
));

108 
å™s
->
dev_cmd_poﬁ
 =

109 
	`kmem_ˇche_¸óã
(
å™s
->
dev_cmd_poﬁ_«me
,

110 
txcmd_size
, 
txcmd_Æign
,

111 
SLAB_HWCACHE_ALIGN
, 
NULL
);

112 i‡(!
å™s
->
dev_cmd_poﬁ
)

113  -
ENOMEM
;

115 
å™s
->
txqs
.
tso_hdr_∑ge
 = 
	`Æloc_≥r˝u
(
iwl_tso_hdr_∑ge
);

116 i‡(!
å™s
->
txqs
.
tso_hdr_∑ge
) {

117 
	`kmem_ˇche_de°roy
(
å™s
->
dev_cmd_poﬁ
);

118  -
ENOMEM
;

122 
	`öô_waôqueue_hód
(&
å™s
->
waô_comm™d_queue
);

125 
	}
}

127 
	$iwl_å™s_‰ì
(
iwl_å™s
 *
å™s
)

129 
i
;

131 i‡(
å™s
->
txqs
.
tso_hdr_∑ge
) {

132 
	`f‹_óch_possibÀ_˝u
(
i
) {

133 
iwl_tso_hdr_∑ge
 *
p
 =

134 
	`≥r_˝u_±r
(
å™s
->
txqs
.
tso_hdr_∑ge
, 
i
);

136 i‡(
p
 &&Ö->
∑ge
)

137 
	`__‰ì_∑ge
(
p
->
∑ge
);

140 
	`‰ì_≥r˝u
(
å™s
->
txqs
.
tso_hdr_∑ge
);

143 
	`kmem_ˇche_de°roy
(
å™s
->
dev_cmd_poﬁ
);

144 
	}
}

146 
	$iwl_å™s_£nd_cmd
(
iwl_å™s
 *
å™s
, 
iwl_ho°_cmd
 *
cmd
)

148 
ªt
;

150 i‡(
	`u∆ikñy
(!(
cmd
->
Êags
 & 
CMD_SEND_IN_RFKILL
) &&

151 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
)))

152  -
ERFKILL
;

163 i‡(
	`u∆ikñy
(
å™s
->
sy°em_pm_mode
 =
IWL_PLAT_PM_MODE_D3
 &&

164 !(
cmd
->
Êags
 & 
CMD_SEND_IN_D3
)))

165  -
EHOSTDOWN
;

167 i‡(
	`u∆ikñy
(
	`ã°_bô
(
STATUS_FW_ERROR
, &
å™s
->
°©us
)))

168  -
EIO
;

170 i‡(
	`u∆ikñy
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

171 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

172  -
EIO
;

175 i‡(!(
cmd
->
Êags
 & 
CMD_ASYNC
))

176 
	`lock_m≠_acquúe_ªad
(&
å™s
->
sync_cmd_lockdï_m≠
);

178 i‡(
å™s
->
wide_cmd_hódî
 && !
	`iwl_cmd_groupid
(
cmd
->
id
)) {

179 i‡(
cmd
->
id
 !
REPLY_ERROR
)

180 
cmd
->
id
 = 
	`DEF_ID
(cmd->id);

183 
ªt
 = 
	`iwl_å™s_txq_£nd_hcmd
(
å™s
, 
cmd
);

185 i‡(!(
cmd
->
Êags
 & 
CMD_ASYNC
))

186 
	`lock_m≠_ªÀa£
(&
å™s
->
sync_cmd_lockdï_m≠
);

188 i‡(
	`WARN_ON
((
cmd
->
Êags
 & 
CMD_WANT_SKB
Ë&& !
ªt
 && !cmd->
ª•_pkt
))

189  -
EIO
;

191  
ªt
;

192 
	}
}

193 
IWL_EXPORT_SYMBOL
(
iwl_å™s_£nd_cmd
);

203 
	$iwl_hcmd_«mes_cmp
(c⁄° *
key
, c⁄° *
ñt
)

205 c⁄° 
iwl_hcmd_«mes
 *
«me
 = 
ñt
;

206 c⁄° 
u8
 *
cmd1
 = 
key
;

207 
u8
 
cmd2
 = 
«me
->
cmd_id
;

209  (*
cmd1
 - 
cmd2
);

210 
	}
}

212 c⁄° *
	$iwl_gë_cmd_°rög
(
iwl_å™s
 *
å™s
, 
u32
 
id
)

214 
u8
 
gΩ
, 
cmd
;

215 
iwl_hcmd_«mes
 *
ªt
;

216 c⁄° 
iwl_hcmd_¨r
 *
¨r
;

217 
size_t
 
size
 = (
iwl_hcmd_«mes
);

219 
gΩ
 = 
	`iwl_cmd_groupid
(
id
);

220 
cmd
 = 
	`iwl_cmd_›code
(
id
);

222 i‡(!
å™s
->
comm™d_groups
 || 
gΩ
 >å™s->
comm™d_groups_size
 ||

223 !
å™s
->
comm™d_groups
[
gΩ
].
¨r
)

226 
¨r
 = &
å™s
->
comm™d_groups
[
gΩ
];

227 
ªt
 = 
	`b£¨ch
(&
cmd
, 
¨r
->¨r,áº->
size
, size, 
iwl_hcmd_«mes_cmp
);

228 i‡(!
ªt
)

230  
ªt
->
cmd_«me
;

231 
	}
}

232 
IWL_EXPORT_SYMBOL
(
iwl_gë_cmd_°rög
);

234 
	$iwl_cmd_groups_vîify_s‹ãd
(c⁄° 
iwl_å™s_c⁄fig
 *
å™s
)

236 
i
, 
j
;

237 c⁄° 
iwl_hcmd_¨r
 *
¨r
;

239 
i
 = 0; i < 
å™s
->
comm™d_groups_size
; i++) {

240 
¨r
 = &
å™s
->
comm™d_groups
[
i
];

241 i‡(!
¨r
->arr)

243 
j
 = 0; j < 
¨r
->
size
 - 1; j++)

244 i‡(
¨r
->¨r[
j
].
cmd_id
 >árr->arr[j + 1].cmd_id)

248 
	}
}

249 
IWL_EXPORT_SYMBOL
(
iwl_cmd_groups_vîify_s‹ãd
);

	@iwl-trans.h

7 #i‚de‡
__iwl_å™s_h__


8 
	#__iwl_å™s_h__


	)

10 
	~<löux/õì80211.h
>

11 
	~<löux/mm.h
>

12 
	~<löux/lockdï.h
>

13 
	~<löux/kî√l.h
>

15 
	~"iwl-debug.h
"

16 
	~"iwl-c⁄fig.h
"

17 
	~"fw/img.h
"

18 
	~"iwl-›-mode.h
"

19 
	~<löux/fúmw¨e.h
>

20 
	~"fw/≠i/cmdhdr.h
"

21 
	~"fw/≠i/txq.h
"

22 
	~"fw/≠i/dbg-év.h
"

23 
	~"iwl-dbg-év.h
"

60 
	#IWL_FW_DBG_DOMAIN_POS
 16

	)

61 
	#IWL_FW_DBG_DOMAIN
 
	`BIT
(
IWL_FW_DBG_DOMAIN_POS
)

	)

63 
	#IWL_TRANS_FW_DBG_DOMAIN
(
å™s
Ë
IWL_FW_INI_DOMAIN_ALWAYS_ON


	)

65 
	#FH_RSCSR_FRAME_SIZE_MSK
 0x00003FFF

	)

66 
	#FH_RSCSR_FRAME_INVALID
 0x55550000

	)

67 
	#FH_RSCSR_FRAME_ALIGN
 0x40

	)

68 
	#FH_RSCSR_RPA_EN
 
	`BIT
(25)

	)

69 
	#FH_RSCSR_RADA_EN
 
	`BIT
(26)

	)

70 
	#FH_RSCSR_RXQ_POS
 16

	)

71 
	#FH_RSCSR_RXQ_MASK
 0x3F0000

	)

73 
	siwl_rx_∑ckë
 {

91 
__À32
 
	mÀn_n_Êags
;

92 
iwl_cmd_hódî
 
	mhdr
;

93 
u8
 
	md©a
[];

94 } 
	g__∑cked
;

96 
ölöe
 
u32
 
	$iwl_rx_∑ckë_Àn
(c⁄° 
iwl_rx_∑ckë
 *
pkt
)

98  
	`À32_to_˝u
(
pkt
->
Àn_n_Êags
Ë& 
FH_RSCSR_FRAME_SIZE_MSK
;

99 
	}
}

101 
ölöe
 
u32
 
	$iwl_rx_∑ckë_∑ylﬂd_Àn
(c⁄° 
iwl_rx_∑ckë
 *
pkt
)

103  
	`iwl_rx_∑ckë_Àn
(
pkt
Ë- ’kt->
hdr
);

104 
	}
}

118 
	eCMD_MODE
 {

119 
	mCMD_ASYNC
 = 
BIT
(0),

120 
	mCMD_WANT_SKB
 = 
BIT
(1),

121 
	mCMD_SEND_IN_RFKILL
 = 
BIT
(2),

122 
	mCMD_BLOCK_TXQS
 = 
BIT
(3),

123 
	mCMD_SEND_IN_D3
 = 
BIT
(4),

126 
	#DEF_CMD_PAYLOAD_SIZE
 320

	)

135 
	siwl_devi˚_cmd
 {

138 
iwl_cmd_hódî
 
	mhdr
;

139 
u8
 
	m∑ylﬂd
[
DEF_CMD_PAYLOAD_SIZE
];

142 
iwl_cmd_hódî_wide
 
	mhdr_wide
;

143 
u8
 
	m∑ylﬂd_wide
[
DEF_CMD_PAYLOAD_SIZE
 -

144 (
iwl_cmd_hódî_wide
) +

145 (
iwl_cmd_hódî
)];

148 } 
	g__∑cked
;

157 
	siwl_devi˚_tx_cmd
 {

158 
iwl_cmd_hódî
 
	mhdr
;

159 
u8
 
	m∑ylﬂd
[];

160 } 
	g__∑cked
;

162 
	#TFD_MAX_PAYLOAD_SIZE
 ((
iwl_devi˚_cmd
))

	)

168 
	#IWL_MAX_CMD_TBS_PER_TFD
 2

	)

174 
	#IWL_TRANS_MAX_FRAGS
(
å™s
Ë(—øns)->
txqs
.
tfd
.
max_tbs
 - 3)

	)

191 
	eiwl_hcmd_d©aÊag
 {

192 
	mIWL_HCMD_DFL_NOCOPY
 = 
BIT
(0),

193 
	mIWL_HCMD_DFL_DUP
 = 
BIT
(1),

196 
	eiwl_îr‹_evít_èbÀ_°©us
 {

197 
	mIWL_ERROR_EVENT_TABLE_LMAC1
 = 
BIT
(0),

198 
	mIWL_ERROR_EVENT_TABLE_LMAC2
 = 
BIT
(1),

199 
	mIWL_ERROR_EVENT_TABLE_UMAC
 = 
BIT
(2),

200 
	mIWL_ERROR_EVENT_TABLE_TCM1
 = 
BIT
(3),

201 
	mIWL_ERROR_EVENT_TABLE_TCM2
 = 
BIT
(4),

202 
	mIWL_ERROR_EVENT_TABLE_RCM1
 = 
BIT
(5),

203 
	mIWL_ERROR_EVENT_TABLE_RCM2
 = 
BIT
(6),

219 
	siwl_ho°_cmd
 {

220 c⁄° *
	md©a
[
IWL_MAX_CMD_TBS_PER_TFD
];

221 
iwl_rx_∑ckë
 *
	mª•_pkt
;

222 
	m_rx_∑ge_addr
;

223 
u32
 
	m_rx_∑ge_‹dî
;

225 
u32
 
	mÊags
;

226 
u32
 
	mid
;

227 
u16
 
	mÀn
[
IWL_MAX_CMD_TBS_PER_TFD
];

228 
u8
 
	md©aÊags
[
IWL_MAX_CMD_TBS_PER_TFD
];

231 
ölöe
 
	$iwl_‰ì_ª•
(
iwl_ho°_cmd
 *
cmd
)

233 
	`‰ì_∑ges
(
cmd
->
_rx_∑ge_addr
, cmd->
_rx_∑ge_‹dî
);

234 
	}
}

236 
	siwl_rx_cmd_buf„r
 {

237 
∑ge
 *
	m_∑ge
;

238 
	m_off£t
;

239 
boﬁ
 
	m_∑ge_°ﬁí
;

240 
u32
 
	m_rx_∑ge_‹dî
;

241 
	måuesize
;

244 
ölöe
 *
	$rxb_addr
(
iwl_rx_cmd_buf„r
 *
r
)

246  (*)(()
	`∑ge_addªss
(
r
->
_∑ge
Ë+Ñ->
_off£t
);

247 
	}
}

249 
ölöe
 
	$rxb_off£t
(
iwl_rx_cmd_buf„r
 *
r
)

251  
r
->
_off£t
;

252 
	}
}

254 
ölöe
 
∑ge
 *
	$rxb_°ól_∑ge
(
iwl_rx_cmd_buf„r
 *
r
)

256 
r
->
_∑ge_°ﬁí
 = 
åue
;

257 
	`gë_∑ge
(
r
->
_∑ge
);

258  
r
->
_∑ge
;

259 
	}
}

261 
ölöe
 
	$iwl_‰ì_rxb
(
iwl_rx_cmd_buf„r
 *
r
)

263 
	`__‰ì_∑ges
(
r
->
_∑ge
,Ñ->
_rx_∑ge_‹dî
);

264 
	}
}

266 
	#MAX_NO_RECLAIM_CMDS
 6

	)

268 
	#IWL_MASK
(
lo
, 
hi
Ë((1 << (hi)Ë| ((1 << (hi)Ë- (1 << (lo))))

	)

274 
	#IWL_MAX_HW_QUEUES
 32

	)

275 
	#IWL_MAX_TVQM_QUEUES
 512

	)

277 
	#IWL_MAX_TID_COUNT
 8

	)

278 
	#IWL_MGMT_TID
 15

	)

279 
	#IWL_FRAME_LIMIT
 64

	)

280 
	#IWL_MAX_RX_HW_QUEUES
 16

	)

281 
	#IWL_9000_MAX_RX_HW_QUEUES
 1

	)

288 
	eiwl_d3_°©us
 {

289 
	mIWL_D3_STATUS_ALIVE
,

290 
	mIWL_D3_STATUS_RESET
,

309 
	eiwl_å™s_°©us
 {

310 
	mSTATUS_SYNC_HCMD_ACTIVE
,

311 
	mSTATUS_DEVICE_ENABLED
,

312 
	mSTATUS_TPOWER_PMI
,

313 
	mSTATUS_INT_ENABLED
,

314 
	mSTATUS_RFKILL_HW
,

315 
	mSTATUS_RFKILL_OPMODE
,

316 
	mSTATUS_FW_ERROR
,

317 
	mSTATUS_TRANS_GOING_IDLE
,

318 
	mSTATUS_TRANS_IDLE
,

319 
	mSTATUS_TRANS_DEAD
,

320 
	mSTATUS_SUPPRESS_CMD_ERROR_ONCE
,

323 
ölöe
 

324 
	$iwl_å™s_gë_rb_size_‹dî
(
iwl_amsdu_size
 
rb_size
)

326 
rb_size
) {

327 
IWL_AMSDU_2K
:

328  
	`gë_‹dî
(2 * 1024);

329 
IWL_AMSDU_4K
:

330  
	`gë_‹dî
(4 * 1024);

331 
IWL_AMSDU_8K
:

332  
	`gë_‹dî
(8 * 1024);

333 
IWL_AMSDU_12K
:

334  
	`gë_‹dî
(16 * 1024);

336 
	`WARN_ON
(1);

339 
	}
}

341 
ölöe
 

342 
	$iwl_å™s_gë_rb_size
(
iwl_amsdu_size
 
rb_size
)

344 
rb_size
) {

345 
IWL_AMSDU_2K
:

347 
IWL_AMSDU_4K
:

349 
IWL_AMSDU_8K
:

351 
IWL_AMSDU_12K
:

354 
	`WARN_ON
(1);

357 
	}
}

359 
	siwl_hcmd_«mes
 {

360 
u8
 
	mcmd_id
;

361 c⁄° *c⁄° 
	mcmd_«me
;

364 
	#HCMD_NAME
(
x
) \

365 { .
cmd_id
 = 
x
, .
cmd_«me
 = #x }

	)

367 
	siwl_hcmd_¨r
 {

368 c⁄° 
iwl_hcmd_«mes
 *
	m¨r
;

369 
	msize
;

372 
	#HCMD_ARR
(
x
) \

373 { .
¨r
 = 
x
, .
size
 = 
	`ARRAY_SIZE
(xË}

	)

383 
	siwl_dump_ßnôize_›s
 {

384 (*
	m‰ob_txf
)(*
	m˘x
, *
	mbuf
, 
size_t
 
	mbuÊí
);

385 (*
	m‰ob_hcmd
)(*
	m˘x
, *
	mhcmd
, 
size_t
 
	mbuÊí
);

386 (*
	m‰ob_mem
)(*
	m˘x
, 
u32
 
	mmem_addr
, *
	mmem
, 
size_t
 
	mbuÊí
);

417 
	siwl_å™s_c⁄fig
 {

418 
iwl_›_mode
 *
	m›_mode
;

420 
u8
 
	mcmd_queue
;

421 
u8
 
	mcmd_fifo
;

422 
	mcmd_q_wdg_timeout
;

423 c⁄° 
u8
 *
	mno_ª˛aim_cmds
;

424 
	mn_no_ª˛aim_cmds
;

426 
iwl_amsdu_size
 
	mrx_buf_size
;

427 
boﬁ
 
	mbc_èbÀ_dw‹d
;

428 
boﬁ
 
	mscd_£t_a˘ive
;

429 c⁄° 
iwl_hcmd_¨r
 *
	mcomm™d_groups
;

430 
	mcomm™d_groups_size
;

432 
u8
 
	mcb_d©a_offs
;

433 
boﬁ
 
	mfw_ª£t_h™dshake
;

434 
u8
 
	mqueue_Æloc_cmd_vî
;

437 
	siwl_å™s_dump_d©a
 {

438 
u32
 
	mÀn
;

439 
u8
 
	md©a
[];

442 
	giwl_å™s
;

444 
	siwl_å™s_txq_scd_cfg
 {

445 
u8
 
	mfifo
;

446 
u8
 
	m°a_id
;

447 
u8
 
	mtid
;

448 
boﬁ
 
	maggªg©e
;

449 
	m‰ame_limô
;

459 
	siwl_å™s_rxq_dma_d©a
 {

460 
u64
 
	m‰_bd_cb
;

461 
u32
 
	m‰_bd_wid
;

462 
u64
 
	murbd_°ts_wΩå
;

463 
u64
 
	mur_bd_cb
;

467 
	#IPC_DRAM_MAP_ENTRY_NUM_MAX
 64

	)

475 
	siwl_≤vm_image
 {

477 c⁄° *
	md©a
;

478 
u32
 
	mÀn
;

479 } 
	mchunks
[
IPC_DRAM_MAP_ENTRY_NUM_MAX
];

480 
u32
 
	mn_chunks
;

481 
u32
 
	mvîsi⁄
;

575 
	siwl_å™s_›s
 {

577 (*
	m°¨t_hw
)(
iwl_å™s
 *
	miwl_å™s
);

578 (*
	m›_mode_Àave
)(
iwl_å™s
 *
	miwl_å™s
);

579 (*
	m°¨t_fw
)(
iwl_å™s
 *
	må™s
, c⁄° 
fw_img
 *
	mfw
,

580 
boﬁ
 
	mrun_ö_rfkûl
);

581 (*
	mfw_Æive
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mscd_addr
);

582 (*
	m°›_devi˚
)(
iwl_å™s
 *
	må™s
);

584 (*
	md3_su•íd
)(
iwl_å™s
 *
	må™s
, 
boﬁ
 
	mã°
, boﬁ 
	mª£t
);

585 (*
	md3_ªsume
)(
iwl_å™s
 *
	må™s
, 
iwl_d3_°©us
 *
	m°©us
,

586 
boﬁ
 
	mã°
, boﬁ 
	mª£t
);

588 (*
	m£nd_cmd
)(
iwl_å™s
 *
	må™s
, 
iwl_ho°_cmd
 *
	mcmd
);

590 (*
	mtx
)(
iwl_å™s
 *
	må™s
, 
sk_buff
 *
	mskb
,

591 
iwl_devi˚_tx_cmd
 *
	mdev_cmd
, 
	mqueue
);

592 (*
	mª˛aim
)(
iwl_å™s
 *
	må™s
, 
	mqueue
, 
	ms¢
,

593 
sk_buff_hód
 *
	mskbs
, 
boﬁ
 
	mis_Êush
);

595 (*
	m£t_q_±rs
)(
iwl_å™s
 *
	må™s
, 
	mqueue
, 
	m±r
);

597 
boﬁ
 (*
txq_íabÀ
)(
iwl_å™s
 *
	må™s
, 
	mqueue
, 
u16
 
	ms¢
,

598 c⁄° 
iwl_å™s_txq_scd_cfg
 *
	mcfg
,

599 
	mqueue_wdg_timeout
);

600 (*
	mtxq_dißbÀ
)(
iwl_å™s
 *
	må™s
, 
	mqueue
,

601 
boﬁ
 
	mc⁄figuª_scd
);

603 (*
	mtxq_Æloc
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mÊags
,

604 
u32
 
	m°a_mask
, 
u8
 
	mtid
,

605 
	msize
, 
	mqueue_wdg_timeout
);

606 (*
	mtxq_‰ì
)(
iwl_å™s
 *
	må™s
, 
	mqueue
);

607 (*
	mrxq_dma_d©a
)(
iwl_å™s
 *
	må™s
, 
	mqueue
,

608 
iwl_å™s_rxq_dma_d©a
 *
	md©a
);

610 (*
	mtxq_£t_sh¨ed_mode
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mtxq_id
,

611 
boﬁ
 
	msh¨ed
);

613 (*
	mwaô_tx_queues_em±y
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mtxq_bm
);

614 (*
	mwaô_txq_em±y
)(
iwl_å™s
 *
	må™s
, 
	mqueue
);

615 (*
	m‰ìze_txq_timî
)(
iwl_å™s
 *
	må™s
, 
	mtxqs
,

616 
boﬁ
 
	m‰ìze
);

618 (*
	mwrôe8
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mofs
, 
u8
 
	mvÆ
);

619 (*
	mwrôe32
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mofs
, u32 
	mvÆ
);

620 
u32
 (*
ªad32
)(
iwl_å™s
 *
	må™s
, u32 
	mofs
);

621 
u32
 (*
ªad_¥ph
)(
iwl_å™s
 *
	må™s
, u32 
	mofs
);

622 (*
	mwrôe_¥ph
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mofs
, u32 
	mvÆ
);

623 (*
	mªad_mem
)(
iwl_å™s
 *
	må™s
, 
u32
 
	maddr
,

624 *
	mbuf
, 
	mdw‹ds
);

625 (*
	mwrôe_mem
)(
iwl_å™s
 *
	må™s
, 
u32
 
	maddr
,

626 c⁄° *
	mbuf
, 
	mdw‹ds
);

627 (*
	mªad_c⁄fig32
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mofs
, u32 *
	mvÆ
);

628 (*
	mc⁄figuª
)(
iwl_å™s
 *
	må™s
,

629 c⁄° 
iwl_å™s_c⁄fig
 *
	må™s_cfg
);

630 (*
	m£t_pmi
)(
iwl_å™s
 *
	må™s
, 
boﬁ
 
	m°©e
);

631 (*
	msw_ª£t
)(
iwl_å™s
 *
	må™s
, 
boﬁ
 
	mªèke_ow√rshù
);

632 
boﬁ
 (*
gøb_nic_ac˚ss
)(
iwl_å™s
 *
	må™s
);

633 (*
	mªÀa£_nic_ac˚ss
)(
iwl_å™s
 *
	må™s
);

634 (*
	m£t_bôs_mask
)(
iwl_å™s
 *
	må™s
, 
u32
 
	mªg
, u32 
	mmask
,

635 
u32
 
	mvÆue
);

637 
	miwl_å™s_dump_d©a
 *(*
	mdump_d©a
)(
iwl_å™s
 *
	må™s
,

638 
u32
 
	mdump_mask
,

639 c⁄° 
iwl_dump_ßnôize_›s
 *
	mßnôize_›s
,

640 *
	mßnôize_˘x
);

641 (*
	mdebugfs_˛ónup
)(
iwl_å™s
 *
	må™s
);

642 (*
	msync_nmi
)(
iwl_å™s
 *
	må™s
);

643 (*
	mlﬂd_≤vm
)(
iwl_å™s
 *
	må™s
,

644 c⁄° 
iwl_≤vm_image
 *
	m≤vm_∑ylﬂds
,

645 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
	mˇ∑
);

646 (*
	m£t_≤vm
)(
iwl_å™s
 *
	må™s
,

647 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
	mˇ∑
);

648 (*
	mlﬂd_ªdu˚_powî
)(
iwl_å™s
 *
	må™s
,

649 c⁄° 
iwl_≤vm_image
 *
	m∑ylﬂds
,

650 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
	mˇ∑
);

651 (*
	m£t_ªdu˚_powî
)(
iwl_å™s
 *
	må™s
,

652 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
	mˇ∑
);

654 (*
	möãºu±s
)(
iwl_å™s
 *
	må™s
, 
boﬁ
 
	míabÀ
);

655 (*
	mimr_dma_d©a
)(
iwl_å™s
 *
	må™s
,

656 
u32
 
	md°_addr
, 
u64
 
	m§c_addr
,

657 
u32
 
	mbyã_˙t
);

668 
	eiwl_å™s_°©e
 {

669 
	mIWL_TRANS_NO_FW
,

670 
	mIWL_TRANS_FW_STARTED
,

671 
	mIWL_TRANS_FW_ALIVE
,

708 
	eiwl_∂©_pm_mode
 {

709 
	mIWL_PLAT_PM_MODE_DISABLED
,

710 
	mIWL_PLAT_PM_MODE_D3
,

720 
	eiwl_öi_cfg_°©e
 {

721 
	mIWL_INI_CFG_STATE_NOT_LOADED
,

722 
	mIWL_INI_CFG_STATE_LOADED
,

723 
	mIWL_INI_CFG_STATE_CORRUPTED
,

727 
	#IWL_TRANS_NMI_TIMEOUT
 (
HZ
 / 4)

	)

735 
	siwl_døm_d©a
 {

736 
dma_addr_t
 
	mphysiˇl
;

737 *
	mblock
;

738 
	msize
;

749 
	siwl_døm_ªgi⁄s
 {

750 
iwl_døm_d©a
 
	mdøms
[
IPC_DRAM_MAP_ENTRY_NUM_MAX
];

751 
iwl_døm_d©a
 
	m¥ph_s¸©ch_mem_desc
;

752 
u8
 
	mn_ªgi⁄s
;

760 
	siwl_fw_m⁄
 {

761 
u32
 
	mnum_‰ags
;

762 
iwl_døm_d©a
 *
	m‰ags
;

772 
	siwl_£lf_öô_døm
 {

773 
iwl_døm_d©a
 *
	mfw
;

774 
	mfw_˙t
;

775 
iwl_døm_d©a
 *
	m∑gög
;

776 
	m∑gög_˙t
;

789 
	siwl_imr_d©a
 {

790 
u32
 
	mimr_íabÀ
;

791 
u32
 
	mimr_size
;

792 
u32
 
	m§am_addr
;

793 
u32
 
	m§am_size
;

794 
u32
 
	mimr2§am_ªmaöbyã
;

795 
u64
 
	mimr_cuº_addr
;

796 
__À64
 
	mimr_ba£_addr
;

799 
	#IWL_TRANS_CURRENT_PC_NAME_MAX_BYTES
 32

	)

806 
	siwl_pc_d©a
 {

807 
u8
 
	mpc_«me
[
IWL_TRANS_CURRENT_PC_NAME_MAX_BYTES
];

808 
u32
 
	mpc_addªss
;

848 
	siwl_å™s_debug
 {

849 
u8
 
	mn_de°_ªg
;

850 
boﬁ
 
	mªc_⁄
;

852 c⁄° 
iwl_fw_dbg_de°_év_v1
 *
	mde°_év
;

853 c⁄° 
iwl_fw_dbg_c⁄f_év
 *
	mc⁄f_év
[
FW_DBG_CONF_MAX
];

854 
iwl_fw_dbg_åiggî_év
 * c⁄° *
	måiggî_év
;

856 
u32
 
	mlmac_îr‹_evít_èbÀ
[2];

857 
u32
 
	mumac_îr‹_evít_èbÀ
;

858 
u32
 
	mtcm_îr‹_evít_èbÀ
[2];

859 
u32
 
	mrcm_îr‹_evít_èbÀ
[2];

860 
	mîr‹_evít_èbÀ_év_°©us
;

862 
iwl_öi_cfg_°©e
 
	möã∫Æ_öi_cfg
;

863 
iwl_öi_cfg_°©e
 
	mexã∫Æ_öi_cfg
;

865 
iwl_fw_öi_Æloˇti⁄_év
 
	mfw_m⁄_cfg
[
IWL_FW_INI_ALLOCATION_NUM
];

866 
iwl_fw_m⁄
 
	mfw_m⁄_öi
[
IWL_FW_INI_ALLOCATION_NUM
];

868 
iwl_døm_d©a
 
	mfw_m⁄
;

870 
boﬁ
 
	mhw_îr‹
;

871 
iwl_fw_öi_buf„r_loˇti⁄
 
	möi_de°
;

873 
u64
 
	munsuµ‹ãd_ªgi⁄_msk
;

874 
iwl_ucode_év
 *
	ma˘ive_ªgi⁄s
[
IWL_FW_INI_MAX_REGION_ID
];

875 
li°_hód
 
	mdebug_öfo_év_li°
;

876 
iwl_dbg_év_time_poöt_d©a
 
	mtime_poöt
[
IWL_FW_INI_TIME_POINT_NUM
];

877 
li°_hód
 
	m≥riodic_åig_li°
;

879 
u32
 
	mdomaös_bôm≠
;

880 
u32
 
	mucode_¥e£t
;

881 
boﬁ
 
	mª°¨t_ªquúed
;

882 
u32
 
	mœ°_ç_ª£tfw
;

883 
iwl_imr_d©a
 
	mimr_d©a
;

884 
u8
 
	mdump_fûe_«me_ext
[
IWL_FW_INI_MAX_NAME
];

885 
boﬁ
 
	mdump_fûe_«me_ext_vÆid
;

886 
u32
 
	mnum_pc
;

887 
iwl_pc_d©a
 *
	mpc_d©a
;

888 
boﬁ
 
	myoyo_bö_lﬂded
;

891 
	siwl_dma_±r
 {

892 
dma_addr_t
 
	mdma
;

893 *
	maddr
;

894 
size_t
 
	msize
;

897 
	siwl_cmd_mëa
 {

899 
iwl_ho°_cmd
 *
	msour˚
;

900 
u32
 
	mÊags
;

901 
u32
 
	mtbs
;

913 
	#IWL_FIRST_TB_SIZE
 20

	)

914 
	#IWL_FIRST_TB_SIZE_ALIGN
 
	`ALIGN
(
IWL_FIRST_TB_SIZE
, 64)

	)

916 
	siwl_pcõ_txq_íåy
 {

917 *
	mcmd
;

918 
sk_buff
 *
	mskb
;

920 c⁄° *
	m‰ì_buf
;

921 
iwl_cmd_mëa
 
	mmëa
;

924 
	siwl_pcõ_fú°_tb_buf
 {

925 
u8
 
	mbuf
[
IWL_FIRST_TB_SIZE_ALIGN
];

972 
	siwl_txq
 {

973 *
	mtfds
;

974 
iwl_pcõ_fú°_tb_buf
 *
	mfú°_tb_bufs
;

975 
dma_addr_t
 
	mfú°_tb_dma
;

976 
iwl_pcõ_txq_íåy
 *
	míåõs
;

978 
•ölock_t
 
	mlock
;

979 
	m‰ozí_expúy_ªmaödî
;

980 
timî_li°
 
	m°uck_timî
;

981 
iwl_å™s
 *
	må™s
;

982 
boﬁ
 
	m√ed_upd©e
;

983 
boﬁ
 
	m‰ozí
;

984 
boﬁ
 
	mampdu
;

985 
	mblock
;

986 
	mwd_timeout
;

987 
sk_buff_hód
 
	movîÊow_q
;

988 
iwl_dma_±r
 
	mbc_tbl
;

990 
	mwrôe_±r
;

991 
	mªad_±r
;

992 
dma_addr_t
 
	mdma_addr
;

993 
	mn_wödow
;

994 
u32
 
	mid
;

995 
	mlow_m¨k
;

996 
	mhigh_m¨k
;

998 
boﬁ
 
	movîÊow_tx
;

1021 
	siwl_å™s_txqs
 {

1022 
	mqueue_u£d
[
BITS_TO_LONGS
(
IWL_MAX_TVQM_QUEUES
)];

1023 
	mqueue_°›≥d
[
BITS_TO_LONGS
(
IWL_MAX_TVQM_QUEUES
)];

1024 
iwl_txq
 *
	mtxq
[
IWL_MAX_TVQM_QUEUES
];

1025 
dma_poﬁ
 *
	mbc_poﬁ
;

1026 
size_t
 
	mbc_tbl_size
;

1027 
boﬁ
 
	mbc_èbÀ_dw‹d
;

1028 
u8
 
	m∑ge_offs
;

1029 
u8
 
	mdev_cmd_offs
;

1030 
iwl_tso_hdr_∑ge
 
__≥r˝u
 *
	mtso_hdr_∑ge
;

1033 
u8
 
	mfifo
;

1034 
u8
 
	mq_id
;

1035 
	mwdg_timeout
;

1036 } 
	mcmd
;

1039 
u8
 
	mmax_tbs
;

1040 
u16
 
	msize
;

1041 
u8
 
	maddr_size
;

1042 } 
	mtfd
;

1044 
iwl_dma_±r
 
	mscd_bc_tbls
;

1046 
u8
 
	mqueue_Æloc_cmd_vî
;

1113 
	siwl_å™s
 {

1114 
boﬁ
 
	mcsme_own
;

1115 c⁄° 
iwl_å™s_›s
 *
	m›s
;

1116 
iwl_›_mode
 *
	m›_mode
;

1117 c⁄° 
iwl_cfg_å™s_∑øms
 *
	må™s_cfg
;

1118 c⁄° 
iwl_cfg
 *
	mcfg
;

1119 
iwl_drv
 *
	mdrv
;

1120 
iwl_å™s_°©e
 
	m°©e
;

1121 
	m°©us
;

1123 
devi˚
 *
	mdev
;

1124 
u32
 
	mmax_skb_‰ags
;

1125 
u32
 
	mhw_ªv
;

1126 
u32
 
	mhw_ªv_°ï
;

1127 
u32
 
	mhw_rf_id
;

1128 
u32
 
	mhw_¸f_id
;

1129 
u32
 
	mhw_˙v_id
;

1130 
u32
 
	mhw_wÂm_id
;

1131 
u32
 
	mhw_id
;

1132 
	mhw_id_°r
[52];

1133 
u32
 
	msku_id
[3];

1134 
boﬁ
 
	mªdu˚d_ˇp_sku
;

1135 
u8
 
	mno_160
:1, 
	m°ï_urm
:1;

1137 
u8
 
	mrx_mpdu_cmd
, 
	mrx_mpdu_cmd_hdr_size
;

1139 
boﬁ
 
	mpm_suµ‹t
;

1140 
boﬁ
 
	m…r_íabÀd
;

1141 
u8
 
	m≤vm_lﬂded
:1;

1142 
u8
 
	mÁû_to_∑r£_≤vm_image
:1;

1143 
u8
 
	mªdu˚_powî_lﬂded
:1;

1144 
u8
 
	mÁûed_to_lﬂd_ªdu˚_powî_image
:1;

1146 c⁄° 
iwl_hcmd_¨r
 *
	mcomm™d_groups
;

1147 
	mcomm™d_groups_size
;

1148 
boﬁ
 
	mwide_cmd_hódî
;

1150 
waô_queue_hód_t
 
	mwaô_comm™d_queue
;

1151 
u8
 
	mnum_rx_queues
;

1153 
size_t
 
	miml_Àn
;

1154 
u8
 *
	miml
;

1157 
kmem_ˇche
 *
	mdev_cmd_poﬁ
;

1158 
	mdev_cmd_poﬁ_«me
[50];

1160 
díåy
 *
	mdbgfs_dú
;

1162 #ifde‡
CONFIG_LOCKDEP


1163 
lockdï_m≠
 
	msync_cmd_lockdï_m≠
;

1166 
iwl_å™s_debug
 
	mdbg
;

1167 
iwl_£lf_öô_døm
 
	möô_døm
;

1169 
iwl_∂©_pm_mode
 
	msy°em_pm_mode
;

1171 c⁄° *
	m«me
;

1172 
iwl_å™s_txqs
 
	mtxqs
;

1173 
u32
 
	mmbx_addr_0_°ï
;

1174 
u32
 
	mmbx_addr_1_°ï
;

1176 
u8
 
	mpcõ_lök_•ìd
;

1178 
iwl_dma_±r
 
	mövÆid_tx_cmd
;

1182 
	må™s_•ecific
[] 
__Æig√d
((*));

1185 c⁄° *
iwl_gë_cmd_°rög
(
iwl_å™s
 *
å™s
, 
u32
 
id
);

1186 
iwl_cmd_groups_vîify_s‹ãd
(c⁄° 
iwl_å™s_c⁄fig
 *
å™s
);

1188 
ölöe
 
	$iwl_å™s_c⁄figuª
(
iwl_å™s
 *
å™s
,

1189 c⁄° 
iwl_å™s_c⁄fig
 *
å™s_cfg
)

1191 
å™s
->
›_mode
 = 
å™s_cfg
->op_mode;

1193 
å™s
->
›s
->
	`c⁄figuª
—øns, 
å™s_cfg
);

1194 
	`WARN_ON
(
	`iwl_cmd_groups_vîify_s‹ãd
(
å™s_cfg
));

1195 
	}
}

1197 
ölöe
 
	$iwl_å™s_°¨t_hw
(
iwl_å™s
 *
å™s
)

1199 
	`might_¶ìp
();

1201  
å™s
->
›s
->
	`°¨t_hw
(trans);

1202 
	}
}

1204 
ölöe
 
	$iwl_å™s_›_mode_Àave
(
iwl_å™s
 *
å™s
)

1206 
	`might_¶ìp
();

1208 i‡(
å™s
->
›s
->
›_mode_Àave
)

1209 
å™s
->
›s
->
	`›_mode_Àave
(trans);

1211 
å™s
->
›_mode
 = 
NULL
;

1213 
å™s
->
°©e
 = 
IWL_TRANS_NO_FW
;

1214 
	}
}

1216 
ölöe
 
	$iwl_å™s_fw_Æive
(
iwl_å™s
 *
å™s
, 
u32
 
scd_addr
)

1218 
	`might_¶ìp
();

1220 
å™s
->
°©e
 = 
IWL_TRANS_FW_ALIVE
;

1222 
å™s
->
›s
->
	`fw_Æive
—øns, 
scd_addr
);

1223 
	}
}

1225 
ölöe
 
	$iwl_å™s_°¨t_fw
(
iwl_å™s
 *
å™s
,

1226 c⁄° 
fw_img
 *
fw
,

1227 
boﬁ
 
run_ö_rfkûl
)

1229 
ªt
;

1231 
	`might_¶ìp
();

1233 
	`WARN_ON_ONCE
(!
å™s
->
rx_mpdu_cmd
);

1235 
	`˛ór_bô
(
STATUS_FW_ERROR
, &
å™s
->
°©us
);

1236 
ªt
 = 
å™s
->
›s
->
	`°¨t_fw
—øns, 
fw
, 
run_ö_rfkûl
);

1237 i‡(
ªt
 == 0)

1238 
å™s
->
°©e
 = 
IWL_TRANS_FW_STARTED
;

1240  
ªt
;

1241 
	}
}

1243 
ölöe
 
	$iwl_å™s_°›_devi˚
(
iwl_å™s
 *
å™s
)

1245 
	`might_¶ìp
();

1247 
å™s
->
›s
->
	`°›_devi˚
(trans);

1249 
å™s
->
°©e
 = 
IWL_TRANS_NO_FW
;

1250 
	}
}

1252 
ölöe
 
	$iwl_å™s_d3_su•íd
(
iwl_å™s
 *
å™s
, 
boﬁ
 
ã°
,

1253 
boﬁ
 
ª£t
)

1255 
	`might_¶ìp
();

1256 i‡(!
å™s
->
›s
->
d3_su•íd
)

1257  -
EOPNOTSUPP
;

1259  
å™s
->
›s
->
	`d3_su•íd
—øns, 
ã°
, 
ª£t
);

1260 
	}
}

1262 
ölöe
 
	$iwl_å™s_d3_ªsume
(
iwl_å™s
 *
å™s
,

1263 
iwl_d3_°©us
 *
°©us
,

1264 
boﬁ
 
ã°
, boﬁ 
ª£t
)

1266 
	`might_¶ìp
();

1267 i‡(!
å™s
->
›s
->
d3_ªsume
)

1268  -
EOPNOTSUPP
;

1270  
å™s
->
›s
->
	`d3_ªsume
—øns, 
°©us
, 
ã°
, 
ª£t
);

1271 
	}
}

1273 
ölöe
 
iwl_å™s_dump_d©a
 *

1274 
	$iwl_å™s_dump_d©a
(
iwl_å™s
 *
å™s
, 
u32
 
dump_mask
,

1275 c⁄° 
iwl_dump_ßnôize_›s
 *
ßnôize_›s
,

1276 *
ßnôize_˘x
)

1278 i‡(!
å™s
->
›s
->
dump_d©a
)

1279  
NULL
;

1280  
å™s
->
›s
->
	`dump_d©a
—øns, 
dump_mask
,

1281 
ßnôize_›s
, 
ßnôize_˘x
);

1282 
	}
}

1284 
ölöe
 
iwl_devi˚_tx_cmd
 *

1285 
	$iwl_å™s_Æloc_tx_cmd
(
iwl_å™s
 *
å™s
)

1287  
	`kmem_ˇche_zÆloc
(
å™s
->
dev_cmd_poﬁ
, 
GFP_ATOMIC
);

1288 
	}
}

1290 
iwl_å™s_£nd_cmd
(
iwl_å™s
 *
å™s
, 
iwl_ho°_cmd
 *
cmd
);

1292 
ölöe
 
	$iwl_å™s_‰ì_tx_cmd
(
iwl_å™s
 *
å™s
,

1293 
iwl_devi˚_tx_cmd
 *
dev_cmd
)

1295 
	`kmem_ˇche_‰ì
(
å™s
->
dev_cmd_poﬁ
, 
dev_cmd
);

1296 
	}
}

1298 
ölöe
 
	$iwl_å™s_tx
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

1299 
iwl_devi˚_tx_cmd
 *
dev_cmd
, 
queue
)

1301 i‡(
	`u∆ikñy
(
	`ã°_bô
(
STATUS_FW_ERROR
, &
å™s
->
°©us
)))

1302  -
EIO
;

1304 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1305 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1306  -
EIO
;

1309  
å™s
->
›s
->
	`tx
—øns, 
skb
, 
dev_cmd
, 
queue
);

1310 
	}
}

1312 
ölöe
 
	$iwl_å™s_ª˛aim
(
iwl_å™s
 *
å™s
, 
queue
,

1313 
s¢
, 
sk_buff_hód
 *
skbs
,

1314 
boﬁ
 
is_Êush
)

1316 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1317 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1321 
å™s
->
›s
->
	`ª˛aim
—øns, 
queue
, 
s¢
, 
skbs
, 
is_Êush
);

1322 
	}
}

1324 
ölöe
 
	$iwl_å™s_£t_q_±rs
(
iwl_å™s
 *
å™s
, 
queue
,

1325 
±r
)

1327 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1328 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1332 
å™s
->
›s
->
	`£t_q_±rs
—øns, 
queue
, 
±r
);

1333 
	}
}

1335 
ölöe
 
	$iwl_å™s_txq_dißbÀ
(
iwl_å™s
 *
å™s
, 
queue
,

1336 
boﬁ
 
c⁄figuª_scd
)

1338 
å™s
->
›s
->
	`txq_dißbÀ
—øns, 
queue
, 
c⁄figuª_scd
);

1339 
	}
}

1341 
ölöe
 
boﬁ


1342 
	$iwl_å™s_txq_íabÀ_cfg
(
iwl_å™s
 *
å™s
, 
queue
, 
u16
 
s¢
,

1343 c⁄° 
iwl_å™s_txq_scd_cfg
 *
cfg
,

1344 
queue_wdg_timeout
)

1346 
	`might_¶ìp
();

1348 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1349 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1350  
Ál£
;

1353  
å™s
->
›s
->
	`txq_íabÀ
—øns, 
queue
, 
s¢
,

1354 
cfg
, 
queue_wdg_timeout
);

1355 
	}
}

1357 
ölöe
 

1358 
	$iwl_å™s_gë_rxq_dma_d©a
(
iwl_å™s
 *
å™s
, 
queue
,

1359 
iwl_å™s_rxq_dma_d©a
 *
d©a
)

1361 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›s
->
rxq_dma_d©a
))

1362  -
EOPNOTSUPP
;

1364  
å™s
->
›s
->
	`rxq_dma_d©a
—øns, 
queue
, 
d©a
);

1365 
	}
}

1367 
ölöe
 

1368 
	$iwl_å™s_txq_‰ì
(
iwl_å™s
 *
å™s
, 
queue
)

1370 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›s
->
txq_‰ì
))

1373 
å™s
->
›s
->
	`txq_‰ì
—øns, 
queue
);

1374 
	}
}

1376 
ölöe
 

1377 
	$iwl_å™s_txq_Æloc
(
iwl_å™s
 *
å™s
,

1378 
u32
 
Êags
, u32 
°a_mask
, 
u8
 
tid
,

1379 
size
, 
wdg_timeout
)

1381 
	`might_¶ìp
();

1383 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›s
->
txq_Æloc
))

1384  -
EOPNOTSUPP
;

1386 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1387 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1388  -
EIO
;

1391  
å™s
->
›s
->
	`txq_Æloc
—øns, 
Êags
, 
°a_mask
, 
tid
,

1392 
size
, 
wdg_timeout
);

1393 
	}
}

1395 
ölöe
 
	$iwl_å™s_txq_£t_sh¨ed_mode
(
iwl_å™s
 *
å™s
,

1396 
queue
, 
boﬁ
 
sh¨ed_mode
)

1398 i‡(
å™s
->
›s
->
txq_£t_sh¨ed_mode
)

1399 
å™s
->
›s
->
	`txq_£t_sh¨ed_mode
—øns, 
queue
, 
sh¨ed_mode
);

1400 
	}
}

1402 
ölöe
 
	$iwl_å™s_txq_íabÀ
(
iwl_å™s
 *
å™s
, 
queue
,

1403 
fifo
, 
°a_id
, 
tid
,

1404 
‰ame_limô
, 
u16
 
s¢
,

1405 
queue_wdg_timeout
)

1407 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

1408 .
fifo
 = fifo,

1409 .
°a_id
 = sta_id,

1410 .
tid
 =Åid,

1411 .
‰ame_limô
 = frame_limit,

1412 .
aggªg©e
 = 
°a_id
 >= 0,

1415 
	`iwl_å™s_txq_íabÀ_cfg
(
å™s
, 
queue
, 
s¢
, &
cfg
, 
queue_wdg_timeout
);

1416 
	}
}

1418 
ölöe


1419 
	$iwl_å™s_ac_txq_íabÀ
(
iwl_å™s
 *
å™s
, 
queue
, 
fifo
,

1420 
queue_wdg_timeout
)

1422 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

1423 .
fifo
 = fifo,

1424 .
°a_id
 = -1,

1425 .
tid
 = 
IWL_MAX_TID_COUNT
,

1426 .
‰ame_limô
 = 
IWL_FRAME_LIMIT
,

1427 .
aggªg©e
 = 
Ál£
,

1430 
	`iwl_å™s_txq_íabÀ_cfg
(
å™s
, 
queue
, 0, &
cfg
, 
queue_wdg_timeout
);

1431 
	}
}

1433 
ölöe
 
	$iwl_å™s_‰ìze_txq_timî
(
iwl_å™s
 *
å™s
,

1434 
txqs
,

1435 
boﬁ
 
‰ìze
)

1437 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1438 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1442 i‡(
å™s
->
›s
->
‰ìze_txq_timî
)

1443 
å™s
->
›s
->
	`‰ìze_txq_timî
—øns, 
txqs
, 
‰ìze
);

1444 
	}
}

1446 
ölöe
 
	$iwl_å™s_waô_tx_queues_em±y
(
iwl_å™s
 *
å™s
,

1447 
u32
 
txqs
)

1449 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›s
->
waô_tx_queues_em±y
))

1450  -
EOPNOTSUPP
;

1453 i‡(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
) {

1454 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1455  -
EIO
;

1458  
å™s
->
›s
->
	`waô_tx_queues_em±y
—øns, 
txqs
);

1459 
	}
}

1461 
ölöe
 
	$iwl_å™s_waô_txq_em±y
(
iwl_å™s
 *
å™s
, 
queue
)

1463 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›s
->
waô_txq_em±y
))

1464  -
EOPNOTSUPP
;

1466 i‡(
	`WARN_ON_ONCE
(
å™s
->
°©e
 !
IWL_TRANS_FW_ALIVE
)) {

1467 
	`IWL_ERR
(
å™s
, "%†bad sèã = %d\n", 
__func__
,Åøns->
°©e
);

1468  -
EIO
;

1471  
å™s
->
›s
->
	`waô_txq_em±y
—øns, 
queue
);

1472 
	}
}

1474 
ölöe
 
	$iwl_å™s_wrôe8
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, 
u8
 
vÆ
)

1476 
å™s
->
›s
->
	`wrôe8
—øns, 
ofs
, 
vÆ
);

1477 
	}
}

1479 
ölöe
 
	$iwl_å™s_wrôe32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
)

1481 
å™s
->
›s
->
	`wrôe32
—øns, 
ofs
, 
vÆ
);

1482 
	}
}

1484 
ölöe
 
u32
 
	$iwl_å™s_ªad32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

1486  
å™s
->
›s
->
	`ªad32
—øns, 
ofs
);

1487 
	}
}

1489 
ölöe
 
u32
 
	$iwl_å™s_ªad_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

1491  
å™s
->
›s
->
	`ªad_¥ph
—øns, 
ofs
);

1492 
	}
}

1494 
ölöe
 
	$iwl_å™s_wrôe_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

1495 
u32
 
vÆ
)

1497  
å™s
->
›s
->
	`wrôe_¥ph
—øns, 
ofs
, 
vÆ
);

1498 
	}
}

1500 
ölöe
 
	$iwl_å™s_ªad_mem
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

1501 *
buf
, 
dw‹ds
)

1503  
å™s
->
›s
->
	`ªad_mem
—øns, 
addr
, 
buf
, 
dw‹ds
);

1504 
	}
}

1506 
	#iwl_å™s_ªad_mem_byãs
(
å™s
, 
addr
, 
buf
, 
bufsize
) \

1508 i‡(
	`__buûtö_c⁄°™t_p
(
bufsize
)) \

1509 
	`BUILD_BUG_ON
((
bufsize
Ë% (
u32
)); \

1510 
	`iwl_å™s_ªad_mem
(
å™s
, 
addr
, 
buf
, (
bufsize
Ë/ (
u32
));\

1511 } 0)

	)

1513 
ölöe
 
	$iwl_å™s_wrôe_imr_mem
(
iwl_å™s
 *
å™s
,

1514 
u32
 
d°_addr
, 
u64
 
§c_addr
,

1515 
u32
 
byã_˙t
)

1517 i‡(
å™s
->
›s
->
imr_dma_d©a
)

1518  
å™s
->
›s
->
	`imr_dma_d©a
—øns, 
d°_addr
, 
§c_addr
, 
byã_˙t
);

1520 
	}
}

1522 
ölöe
 
u32
 
	$iwl_å™s_ªad_mem32
(
iwl_å™s
 *
å™s
, 
u32
 
addr
)

1524 
u32
 
vÆue
;

1526 i‡(
	`iwl_å™s_ªad_mem
(
å™s
, 
addr
, &
vÆue
, 1))

1529  
vÆue
;

1530 
	}
}

1532 
ölöe
 
	$iwl_å™s_wrôe_mem
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

1533 c⁄° *
buf
, 
dw‹ds
)

1535  
å™s
->
›s
->
	`wrôe_mem
—øns, 
addr
, 
buf
, 
dw‹ds
);

1536 
	}
}

1538 
ölöe
 
u32
 
	$iwl_å™s_wrôe_mem32
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

1539 
u32
 
vÆ
)

1541  
	`iwl_å™s_wrôe_mem
(
å™s
, 
addr
, &
vÆ
, 1);

1542 
	}
}

1544 
ölöe
 
	$iwl_å™s_£t_pmi
(
iwl_å™s
 *
å™s
, 
boﬁ
 
°©e
)

1546 i‡(
å™s
->
›s
->
£t_pmi
)

1547 
å™s
->
›s
->
	`£t_pmi
—øns, 
°©e
);

1548 
	}
}

1550 
ölöe
 
	$iwl_å™s_sw_ª£t
(
iwl_å™s
 *
å™s
,

1551 
boﬁ
 
ªèke_ow√rshù
)

1553 i‡(
å™s
->
›s
->
sw_ª£t
)

1554  
å™s
->
›s
->
	`sw_ª£t
—øns, 
ªèke_ow√rshù
);

1556 
	}
}

1558 
ölöe
 

1559 
	$iwl_å™s_£t_bôs_mask
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
, u32 
mask
, u32 
vÆue
)

1561 
å™s
->
›s
->
	`£t_bôs_mask
—øns, 
ªg
, 
mask
, 
vÆue
);

1562 
	}
}

1564 
	#iwl_å™s_gøb_nic_ac˚ss
(
å™s
) \

1565 
	`__c⁄d_lock
(
nic_ac˚ss
, \

1566 
	`likñy
((
å™s
)->
›s
->
	`gøb_nic_ac˚ss
—øns)))

	)

1568 
ölöe
 
	$__ªÀa£s
(
nic_ac˚ss
)

1569 
	$iwl_å™s_ªÀa£_nic_ac˚ss
(
iwl_å™s
 *
å™s
)

1571 
å™s
->
›s
->
	`ªÀa£_nic_ac˚ss
(trans);

1572 
	`__ªÀa£
(
nic_ac˚ss
);

1573 
	}
}

1575 
ölöe
 
	$iwl_å™s_fw_îr‹
(
iwl_å™s
 *
å™s
, 
boﬁ
 
sync
)

1577 i‡(
	`WARN_ON_ONCE
(!
å™s
->
›_mode
))

1581 i‡(!
	`ã°_™d_£t_bô
(
STATUS_FW_ERROR
, &
å™s
->
°©us
)) {

1582 
	`iwl_›_mode_nic_îr‹
(
å™s
->
›_mode
, 
sync
);

1583 
å™s
->
°©e
 = 
IWL_TRANS_NO_FW
;

1585 
	}
}

1587 
ölöe
 
boﬁ
 
	$iwl_å™s_fw_ru¬ög
(
iwl_å™s
 *
å™s
)

1589  
å™s
->
°©e
 =
IWL_TRANS_FW_ALIVE
;

1590 
	}
}

1592 
ölöe
 
	$iwl_å™s_sync_nmi
(
iwl_å™s
 *
å™s
)

1594 i‡(
å™s
->
›s
->
sync_nmi
)

1595 
å™s
->
›s
->
	`sync_nmi
(trans);

1596 
	}
}

1598 
iwl_å™s_sync_nmi_wôh_addr
(
iwl_å™s
 *
å™s
, 
u32
 
öè_addr
,

1599 
u32
 
sw_îr_bô
);

1601 
ölöe
 
	$iwl_å™s_lﬂd_≤vm
(
iwl_å™s
 *
å™s
,

1602 c⁄° 
iwl_≤vm_image
 *
≤vm_d©a
,

1603 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

1605  
å™s
->
›s
->
	`lﬂd_≤vm
—øns, 
≤vm_d©a
, 
ˇ∑
);

1606 
	}
}

1608 
ölöe
 
	$iwl_å™s_£t_≤vm
(
iwl_å™s
 *
å™s
,

1609 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

1611 i‡(
å™s
->
›s
->
£t_≤vm
)

1612 
å™s
->
›s
->
	`£t_≤vm
—øns, 
ˇ∑
);

1613 
	}
}

1615 
ölöe
 
	giwl_å™s_lﬂd_ªdu˚_powî


1616 (
iwl_å™s
 *
	gå™s
,

1617 c⁄° 
iwl_≤vm_image
 *
	g∑ylﬂds
,

1618 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
	gˇ∑
)

1620  
	gå™s
->
	g›s
->
lﬂd_ªdu˚_powî
(
å™s
, 
∑ylﬂds
, 
ˇ∑
);

1623 
ölöe
 

1624 
	$iwl_å™s_£t_ªdu˚_powî
(
iwl_å™s
 *
å™s
,

1625 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

1627 i‡(
å™s
->
›s
->
£t_ªdu˚_powî
)

1628 
å™s
->
›s
->
	`£t_ªdu˚_powî
—øns, 
ˇ∑
);

1629 
	}
}

1631 
ölöe
 
boﬁ
 
	$iwl_å™s_dbg_öi_vÆid
(
iwl_å™s
 *
å™s
)

1633  
å™s
->
dbg
.
öã∫Æ_öi_cfg
 !
IWL_INI_CFG_STATE_NOT_LOADED
 ||

1634 
å™s
->
dbg
.
exã∫Æ_öi_cfg
 !
IWL_INI_CFG_STATE_NOT_LOADED
;

1635 
	}
}

1637 
ölöe
 
	$iwl_å™s_öãºu±s
(
iwl_å™s
 *
å™s
, 
boﬁ
 
íabÀ
)

1639 i‡(
å™s
->
›s
->
öãºu±s
)

1640 
å™s
->
›s
->
	`öãºu±s
—øns, 
íabÀ
);

1641 
	}
}

1646 
iwl_å™s
 *
iwl_å™s_Æloc
(
¥iv_size
,

1647 
devi˚
 *
dev
,

1648 c⁄° 
iwl_å™s_›s
 *
›s
,

1649 c⁄° 
iwl_cfg_å™s_∑øms
 *
cfg_å™s
);

1650 
iwl_å™s_öô
(
iwl_å™s
 *
å™s
);

1651 
iwl_å™s_‰ì
(
iwl_å™s
 *
å™s
);

1653 
ölöe
 
boﬁ
 
	$iwl_å™s_is_hw_îr‹_vÆue
(
u32
 
vÆ
)

1655  ((
vÆ
 & ~0xf) == 0xa5a5a5a0) || ((val & ~0xf) == 0x5a5a5a50);

1656 
	}
}

1661 
__mu°_check
 
iwl_pci_ªgi°î_drivî
();

1662 
iwl_pci_uƒegi°î_drivî
();

1663 
iwl_å™s_pcõ_ªmove
(
iwl_å™s
 *
å™s
, 
boﬁ
 
ªsˇn
);

	@iwlwifi.mod.c

1 
	~<löux/moduÀ.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<löux/buûd-ß….h
>

4 
	~<löux/ñ‚Ÿe-…o.h
>

5 
	~<löux/exp‹t-öã∫Æ.h
>

6 
	~<löux/vîmagic.h
>

7 
	~<löux/compûî.h
>

9 #ifde‡
CONFIG_UNWINDER_ORC


10 
	~<asm/‹c_hódî.h
>

11 
	gORC_HEADER
;

14 
	gBUILD_SALT
;

15 
	gBUILD_LTO_INFO
;

17 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

18 
MODULE_INFO
(
«me
, 
KBUILD_MODNAME
);

20 
__visibÀ
 
moduÀ
 
__this_moduÀ


21 
__£˘i⁄
(".gnu.linkonce.this_module") = {

22 .
«me
 = 
KBUILD_MODNAME
,

23 .
	göô
 = 
öô_moduÀ
,

24 #ifde‡
CONFIG_MODULE_UNLOAD


25 .
	gexô
 = 
˛ónup_moduÀ
,

27 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

30 #ifde‡
CONFIG_MITIGATION_RETPOLINE


31 
MODULE_INFO
(
ªçﬁöe
, "Y");

34 
KSYMTAB_FUNC
(
iwl_wrôe8
, "_gpl", "IWLWIFI");

35 
KSYMTAB_FUNC
(
iwl_wrôe32
, "_gpl", "IWLWIFI");

36 
KSYMTAB_FUNC
(
iwl_wrôe64
, "_gpl", "IWLWIFI");

37 
KSYMTAB_FUNC
(
iwl_ªad32
, "_gpl", "IWLWIFI");

38 
KSYMTAB_FUNC
(
iwl_pﬁl_bô
, "_gpl", "IWLWIFI");

39 
KSYMTAB_FUNC
(
iwl_ªad_dúe˘32
, "_gpl", "IWLWIFI");

40 
KSYMTAB_FUNC
(
iwl_wrôe_dúe˘32
, "_gpl", "IWLWIFI");

41 
KSYMTAB_FUNC
(
iwl_wrôe_dúe˘64
, "_gpl", "IWLWIFI");

42 
KSYMTAB_FUNC
(
iwl_pﬁl_dúe˘_bô
, "_gpl", "IWLWIFI");

43 
KSYMTAB_FUNC
(
iwl_ªad_¥ph_no_gøb
, "_gpl", "IWLWIFI");

44 
KSYMTAB_FUNC
(
iwl_wrôe_¥ph_no_gøb
, "_gpl", "IWLWIFI");

45 
KSYMTAB_FUNC
(
iwl_wrôe_¥ph64_no_gøb
, "_gpl", "IWLWIFI");

46 
KSYMTAB_FUNC
(
iwl_ªad_¥ph
, "_gpl", "IWLWIFI");

47 
KSYMTAB_FUNC
(
iwl_wrôe_¥ph_dñay
, "_gpl", "IWLWIFI");

48 
KSYMTAB_FUNC
(
iwl_£t_bôs_¥ph
, "_gpl", "IWLWIFI");

49 
KSYMTAB_FUNC
(
iwl_£t_bôs_mask_¥ph
, "_gpl", "IWLWIFI");

50 
KSYMTAB_FUNC
(
iwl_˛ór_bôs_¥ph
, "_gpl", "IWLWIFI");

51 
KSYMTAB_FUNC
(
iwl_f‹˚_nmi
, "_gpl", "IWLWIFI");

52 
KSYMTAB_FUNC
(
iwl_föish_nic_öô
, "_gpl", "IWLWIFI");

53 
KSYMTAB_FUNC
(
iwl_drv_gë_fw«me_¥e
, "_gpl", "IWLWIFI");

54 
KSYMTAB_DATA
(
iwlwifi_mod_∑øms
, "_gpl", "IWLWIFI");

55 
KSYMTAB_FUNC
(
iwl_›mode_ªgi°î
, "_gpl", "IWLWIFI");

56 
KSYMTAB_FUNC
(
iwl_›mode_dîegi°î
, "_gpl", "IWLWIFI");

57 
KSYMTAB_FUNC
(
__iwl_w¨n
, "_gpl", "IWLWIFI");

58 
KSYMTAB_FUNC
(
__iwl_öfo
, "_gpl", "IWLWIFI");

59 
KSYMTAB_FUNC
(
__iwl_¸ô
, "_gpl", "IWLWIFI");

60 
KSYMTAB_FUNC
(
__iwl_îr
, "_gpl", "IWLWIFI");

61 
KSYMTAB_FUNC
(
__iwl_dbg
, "_gpl", "IWLWIFI");

62 
KSYMTAB_FUNC
(
iwl_ªad_ì¥om
, "_gpl", "IWLWIFI");

63 
KSYMTAB_FUNC
(
iwl_∑r£_ì¥om_d©a
, "_gpl", "IWLWIFI");

64 
KSYMTAB_FUNC
(
iwl_phy_db_öô
, "_gpl", "IWLWIFI");

65 
KSYMTAB_FUNC
(
iwl_phy_db_‰ì
, "_gpl", "IWLWIFI");

66 
KSYMTAB_FUNC
(
iwl_phy_db_£t_£˘i⁄
, "_gpl", "IWLWIFI");

67 
KSYMTAB_FUNC
(
iwl_£nd_phy_db_d©a
, "_gpl", "IWLWIFI");

68 
KSYMTAB_FUNC
(
iwl_ªöô_ˇb
, "_gpl", "IWLWIFI");

69 
KSYMTAB_FUNC
(
iwl_∑r£_mei_nvm_d©a
, "_gpl", "IWLWIFI");

70 
KSYMTAB_FUNC
(
iwl_∑r£_nvm_d©a
, "_gpl", "IWLWIFI");

71 
KSYMTAB_FUNC
(
iwl_∑r£_nvm_mcc_öfo
, "_gpl", "IWLWIFI");

72 
KSYMTAB_FUNC
(
iwl_nvm_fixups
, "_gpl", "IWLWIFI");

73 
KSYMTAB_FUNC
(
iwl_ªad_exã∫Æ_nvm
, "_gpl", "IWLWIFI");

74 
KSYMTAB_FUNC
(
iwl_gë_nvm
, "_gpl", "IWLWIFI");

75 
KSYMTAB_FUNC
(
iwl_å™s_pcõ_ªmove
, "", "");

76 
KSYMTAB_FUNC
(
iwl_dbg_év_dñ_timîs
, "_gpl", "IWLWIFI");

77 
KSYMTAB_FUNC
(
_iwl_dbg_év_time_poöt
, "_gpl", "IWLWIFI");

78 
KSYMTAB_FUNC
(
iwl_å™s_£nd_cmd
, "_gpl", "IWLWIFI");

79 
KSYMTAB_FUNC
(
iwl_gë_cmd_°rög
, "_gpl", "IWLWIFI");

80 
KSYMTAB_FUNC
(
iwl_cmd_groups_vîify_s‹ãd
, "_gpl", "IWLWIFI");

81 
KSYMTAB_FUNC
(
iwl_fw_lookup_cmd_vî
, "_gpl", "");

82 
KSYMTAB_FUNC
(
iwl_fw_lookup_nŸif_vî
, "_gpl", "");

83 
KSYMTAB_FUNC
(
iwl_fw_lookup_as£π_desc
, "_gpl", "");

84 
KSYMTAB_FUNC
(
iwl_nŸifiˇti⁄_waô_öô
, "_gpl", "IWLWIFI");

85 
KSYMTAB_FUNC
(
iwl_nŸifiˇti⁄_waô
, "_gpl", "IWLWIFI");

86 
KSYMTAB_FUNC
(
iwl_ab‹t_nŸifiˇti⁄_waôs
, "_gpl", "IWLWIFI");

87 
KSYMTAB_FUNC
(
iwl_öô_nŸifiˇti⁄_waô
, "_gpl", "IWLWIFI");

88 
KSYMTAB_FUNC
(
iwl_ªmove_nŸifiˇti⁄
, "_gpl", "IWLWIFI");

89 
KSYMTAB_FUNC
(
iwl_waô_nŸifiˇti⁄
, "_gpl", "IWLWIFI");

90 
KSYMTAB_FUNC
(
iwl_fw_øã_idx_to_∂˝
, "_gpl", "IWLWIFI");

91 
KSYMTAB_FUNC
(
iwl_øã_mcs
, "_gpl", "IWLWIFI");

92 
KSYMTAB_FUNC
(
iwl_rs_¥ëty_™t
, "_gpl", "IWLWIFI");

93 
KSYMTAB_FUNC
(
iwl_rs_¥ëty_bw
, "_gpl", "IWLWIFI");

94 
KSYMTAB_FUNC
(
iwl_√w_øã_‰om_v1
, "_gpl", "IWLWIFI");

95 
KSYMTAB_FUNC
(
rs_¥ëty_¥öt_øã
, "_gpl", "IWLWIFI");

96 
KSYMTAB_FUNC
(
iwl_he_is_sgi
, "_gpl", "IWLWIFI");

97 
KSYMTAB_DATA
(
iwl_dump_desc_as£π
, "_gpl", "IWLWIFI");

98 
KSYMTAB_FUNC
(
iwl_fw_dbg_cﬁÀ˘_desc
, "_gpl", "IWLWIFI");

99 
KSYMTAB_FUNC
(
iwl_fw_dbg_îr‹_cﬁÀ˘
, "_gpl", "IWLWIFI");

100 
KSYMTAB_FUNC
(
iwl_fw_dbg_cﬁÀ˘
, "_gpl", "IWLWIFI");

101 
KSYMTAB_FUNC
(
iwl_fw_dbg_cﬁÀ˘_åig
, "_gpl", "IWLWIFI");

102 
KSYMTAB_FUNC
(
iwl_fw_°¨t_dbg_c⁄f
, "_gpl", "IWLWIFI");

103 
KSYMTAB_FUNC
(
iwl_fw_dbg_ªad_d3_debug_d©a
, "_gpl", "IWLWIFI");

104 
KSYMTAB_FUNC
(
iwl_fw_dbg_°›_sync
, "_gpl", "IWLWIFI");

105 
KSYMTAB_FUNC
(
iwl_fw_dbg_°›_ª°¨t_ªc‹dög
, "_gpl", "IWLWIFI");

106 
KSYMTAB_FUNC
(
iwl_fw_dißbÀ_dbg_as£πs
, "_gpl", "IWLWIFI");

107 
KSYMTAB_FUNC
(
iwl_fw_dbg_˛ór_m⁄ô‹_buf
, "_gpl", "IWLWIFI");

108 
KSYMTAB_FUNC
(
iwl_≤vm_lﬂd
, "_gpl", "IWLWIFI");

109 
KSYMTAB_FUNC
(
iwl_fwπ_dump_îr‹_logs
, "_gpl", "IWLWIFI");

110 
KSYMTAB_FUNC
(
iwl_bios_gë_wrds_èbÀ
, "_gpl", "IWLWIFI");

111 
KSYMTAB_FUNC
(
iwl_bios_gë_ewrd_èbÀ
, "_gpl", "IWLWIFI");

112 
KSYMTAB_FUNC
(
iwl_bios_gë_wgds_èbÀ
, "_gpl", "IWLWIFI");

113 
KSYMTAB_FUNC
(
iwl_bios_gë_µag_èbÀ
, "_gpl", "IWLWIFI");

114 
KSYMTAB_FUNC
(
iwl_bios_gë_ès_èbÀ
, "_gpl", "IWLWIFI");

115 
KSYMTAB_FUNC
(
iwl_bios_gë_pwr_limô
, "_gpl", "IWLWIFI");

116 
KSYMTAB_FUNC
(
iwl_bios_gë_mcc
, "_gpl", "IWLWIFI");

117 
KSYMTAB_FUNC
(
iwl_bios_gë_eckv
, "_gpl", "IWLWIFI");

118 
KSYMTAB_FUNC
(
iwl_ßr_geo_suµ‹t
, "_gpl", "IWLWIFI");

119 
KSYMTAB_FUNC
(
iwl_ßr_geo_fûl_èbÀ
, "_gpl", "IWLWIFI");

120 
KSYMTAB_FUNC
(
iwl_ßr_fûl_¥ofûe
, "_gpl", "IWLWIFI");

121 
KSYMTAB_FUNC
(
iwl_fûl_µag_èbÀ
, "_gpl", "IWLWIFI");

122 
KSYMTAB_FUNC
(
iwl_is_µag_≠¥oved
, "_gpl", "IWLWIFI");

123 
KSYMTAB_FUNC
(
iwl_is_ès_≠¥oved
, "_gpl", "IWLWIFI");

124 
KSYMTAB_FUNC
(
iwl_gë_œri_c⁄fig_bôm≠
, "_gpl", "IWLWIFI");

125 
KSYMTAB_FUNC
(
iwl_bios_gë_dsm
, "_gpl", "IWLWIFI");

126 
KSYMTAB_FUNC
(
iwl_‰ì_fw_∑gög
, "_gpl", "IWLWIFI");

127 
KSYMTAB_FUNC
(
iwl_öô_∑gög
, "_gpl", "IWLWIFI");

128 
KSYMTAB_FUNC
(
iwl_gë_sh¨ed_mem_c⁄f
, "_gpl", "IWLWIFI");

129 
KSYMTAB_FUNC
(
iwl_fw_ru¡ime_öô
, "_gpl", "IWLWIFI");

130 
KSYMTAB_FUNC
(
iwl_fw_ru¡ime_su•íd
, "_gpl", "IWLWIFI");

131 
KSYMTAB_FUNC
(
iwl_fw_ru¡ime_ªsume
, "_gpl", "IWLWIFI");

132 
KSYMTAB_FUNC
(
iwl_£t_soc_œãncy
, "_gpl", "IWLWIFI");

133 
KSYMTAB_FUNC
(
iwl_c⁄figuª_rxq
, "_gpl", "IWLWIFI");

134 
KSYMTAB_FUNC
(
iwl_a˝i_gë_phy_fûãrs
, "_gpl", "IWLWIFI");

135 
KSYMTAB_FUNC
(
iwl_a˝i_gë_guid_lock_°©us
, "_gpl", "IWLWIFI");

136 
KSYMTAB_FUNC
(
iwl_uefi_gë_°ï_èbÀ
, "_gpl", "IWLWIFI");

137 
KSYMTAB_FUNC
(
iwl_uefi_gë_sgom_èbÀ
, "_gpl", "IWLWIFI");

138 
KSYMTAB_FUNC
(
iwl_uefi_gë_u©s_èbÀ
, "_gpl", "IWLWIFI");

139 
KSYMTAB_DATA
(
__åa˚poöt_iwlwifi_dev_ucode_evít
, "", "");

140 
KSYMTAB_FUNC
(
__åa˚ôî_iwlwifi_dev_ucode_evít
, "", "");

141 
KSYMTAB_DATA
(
__SCK__ç_func_iwlwifi_dev_ucode_evít
, "", "");

142 
KSYMTAB_FUNC
(
__SCT__ç_func_iwlwifi_dev_ucode_evít
, "", "");

143 
KSYMTAB_DATA
(
__åa˚poöt_iwlwifi_dev_ucode_c⁄t_evít
, "", "");

144 
KSYMTAB_FUNC
(
__åa˚ôî_iwlwifi_dev_ucode_c⁄t_evít
, "", "");

145 
KSYMTAB_DATA
(
__SCK__ç_func_iwlwifi_dev_ucode_c⁄t_evít
, "", "");

146 
KSYMTAB_FUNC
(
__SCT__ç_func_iwlwifi_dev_ucode_c⁄t_evít
, "", "");

147 
KSYMTAB_DATA
(
__åa˚poöt_iwlwifi_dev_ucode_wøp_evít
, "", "");

148 
KSYMTAB_FUNC
(
__åa˚ôî_iwlwifi_dev_ucode_wøp_evít
, "", "");

149 
KSYMTAB_DATA
(
__SCK__ç_func_iwlwifi_dev_ucode_wøp_evít
, "", "");

150 
KSYMTAB_FUNC
(
__SCT__ç_func_iwlwifi_dev_ucode_wøp_evít
, "", "");

152 
SYMBOL_CRC
(
iwl_wrôe8
, 0xfae700e7, "_gpl");

153 
SYMBOL_CRC
(
iwl_wrôe32
, 0x5a9a0f02, "_gpl");

154 
SYMBOL_CRC
(
iwl_wrôe64
, 0xdf5ea1f7, "_gpl");

155 
SYMBOL_CRC
(
iwl_ªad32
, 0x74f978f1, "_gpl");

156 
SYMBOL_CRC
(
iwl_pﬁl_bô
, 0x677c7b17, "_gpl");

157 
SYMBOL_CRC
(
iwl_ªad_dúe˘32
, 0x65e1ed6e, "_gpl");

158 
SYMBOL_CRC
(
iwl_wrôe_dúe˘32
, 0x5b757b98, "_gpl");

159 
SYMBOL_CRC
(
iwl_wrôe_dúe˘64
, 0xdeb1d56d, "_gpl");

160 
SYMBOL_CRC
(
iwl_pﬁl_dúe˘_bô
, 0xdcfa1b1d, "_gpl");

161 
SYMBOL_CRC
(
iwl_ªad_¥ph_no_gøb
, 0xe52aed00, "_gpl");

162 
SYMBOL_CRC
(
iwl_wrôe_¥ph_no_gøb
, 0x96e4edfa, "_gpl");

163 
SYMBOL_CRC
(
iwl_wrôe_¥ph64_no_gøb
, 0xab36b5f0, "_gpl");

164 
SYMBOL_CRC
(
iwl_ªad_¥ph
, 0x8946d657, "_gpl");

165 
SYMBOL_CRC
(
iwl_wrôe_¥ph_dñay
, 0x2e0e8e51, "_gpl");

166 
SYMBOL_CRC
(
iwl_£t_bôs_¥ph
, 0xc3cf5445, "_gpl");

167 
SYMBOL_CRC
(
iwl_£t_bôs_mask_¥ph
, 0x11d4d038, "_gpl");

168 
SYMBOL_CRC
(
iwl_˛ór_bôs_¥ph
, 0x10401233, "_gpl");

169 
SYMBOL_CRC
(
iwl_f‹˚_nmi
, 0x6b96550b, "_gpl");

170 
SYMBOL_CRC
(
iwl_föish_nic_öô
, 0xe1dca41b, "_gpl");

171 
SYMBOL_CRC
(
iwl_drv_gë_fw«me_¥e
, 0xd9b9bce7, "_gpl");

172 
SYMBOL_CRC
(
iwlwifi_mod_∑øms
, 0x828c6838, "_gpl");

173 
SYMBOL_CRC
(
iwl_›mode_ªgi°î
, 0xd1e5c49d, "_gpl");

174 
SYMBOL_CRC
(
iwl_›mode_dîegi°î
, 0x5c52e109, "_gpl");

175 
SYMBOL_CRC
(
__iwl_w¨n
, 0x3963c569, "_gpl");

176 
SYMBOL_CRC
(
__iwl_öfo
, 0x336dc14b, "_gpl");

177 
SYMBOL_CRC
(
__iwl_¸ô
, 0x3ffa91d8, "_gpl");

178 
SYMBOL_CRC
(
__iwl_îr
, 0xbc6d2e80, "_gpl");

179 
SYMBOL_CRC
(
__iwl_dbg
, 0x1a41bea2, "_gpl");

180 
SYMBOL_CRC
(
iwl_ªad_ì¥om
, 0x5c9ee63b, "_gpl");

181 
SYMBOL_CRC
(
iwl_∑r£_ì¥om_d©a
, 0x54a7f923, "_gpl");

182 
SYMBOL_CRC
(
iwl_phy_db_öô
, 0x2c2aa183, "_gpl");

183 
SYMBOL_CRC
(
iwl_phy_db_‰ì
, 0x35033c81, "_gpl");

184 
SYMBOL_CRC
(
iwl_phy_db_£t_£˘i⁄
, 0xce0c6460, "_gpl");

185 
SYMBOL_CRC
(
iwl_£nd_phy_db_d©a
, 0x776221bf, "_gpl");

186 
SYMBOL_CRC
(
iwl_ªöô_ˇb
, 0xe4d95482, "_gpl");

187 
SYMBOL_CRC
(
iwl_∑r£_mei_nvm_d©a
, 0x8b9e4380, "_gpl");

188 
SYMBOL_CRC
(
iwl_∑r£_nvm_d©a
, 0xfa9d7aa8, "_gpl");

189 
SYMBOL_CRC
(
iwl_∑r£_nvm_mcc_öfo
, 0x84ac762c, "_gpl");

190 
SYMBOL_CRC
(
iwl_nvm_fixups
, 0xea1b26fc, "_gpl");

191 
SYMBOL_CRC
(
iwl_ªad_exã∫Æ_nvm
, 0xb771f6b5, "_gpl");

192 
SYMBOL_CRC
(
iwl_gë_nvm
, 0x8feb7c9c, "_gpl");

193 
SYMBOL_CRC
(
iwl_å™s_pcõ_ªmove
, 0x5ca2ab3f, "");

194 
SYMBOL_CRC
(
iwl_dbg_év_dñ_timîs
, 0xac0c74d0, "_gpl");

195 
SYMBOL_CRC
(
_iwl_dbg_év_time_poöt
, 0x823a54e0, "_gpl");

196 
SYMBOL_CRC
(
iwl_å™s_£nd_cmd
, 0x09a60b14, "_gpl");

197 
SYMBOL_CRC
(
iwl_gë_cmd_°rög
, 0x01fcc15e, "_gpl");

198 
SYMBOL_CRC
(
iwl_cmd_groups_vîify_s‹ãd
, 0x65f1a0a6, "_gpl");

199 
SYMBOL_CRC
(
iwl_fw_lookup_cmd_vî
, 0xea451077, "_gpl");

200 
SYMBOL_CRC
(
iwl_fw_lookup_nŸif_vî
, 0xb77a076b, "_gpl");

201 
SYMBOL_CRC
(
iwl_fw_lookup_as£π_desc
, 0x5987fe45, "_gpl");

202 
SYMBOL_CRC
(
iwl_nŸifiˇti⁄_waô_öô
, 0x5988395c, "_gpl");

203 
SYMBOL_CRC
(
iwl_nŸifiˇti⁄_waô
, 0xe75b7e77, "_gpl");

204 
SYMBOL_CRC
(
iwl_ab‹t_nŸifiˇti⁄_waôs
, 0x1332e4de, "_gpl");

205 
SYMBOL_CRC
(
iwl_öô_nŸifiˇti⁄_waô
, 0xe0eb5838, "_gpl");

206 
SYMBOL_CRC
(
iwl_ªmove_nŸifiˇti⁄
, 0xf88964e4, "_gpl");

207 
SYMBOL_CRC
(
iwl_waô_nŸifiˇti⁄
, 0xbafc8994, "_gpl");

208 
SYMBOL_CRC
(
iwl_fw_øã_idx_to_∂˝
, 0x874c77de, "_gpl");

209 
SYMBOL_CRC
(
iwl_øã_mcs
, 0xb7d5ffb1, "_gpl");

210 
SYMBOL_CRC
(
iwl_rs_¥ëty_™t
, 0x84bb50e1, "_gpl");

211 
SYMBOL_CRC
(
iwl_rs_¥ëty_bw
, 0xb37b318c, "_gpl");

212 
SYMBOL_CRC
(
iwl_√w_øã_‰om_v1
, 0x49e0135d, "_gpl");

213 
SYMBOL_CRC
(
rs_¥ëty_¥öt_øã
, 0x37956b72, "_gpl");

214 
SYMBOL_CRC
(
iwl_he_is_sgi
, 0x78971d7e, "_gpl");

215 
SYMBOL_CRC
(
iwl_dump_desc_as£π
, 0x2710c362, "_gpl");

216 
SYMBOL_CRC
(
iwl_fw_dbg_cﬁÀ˘_desc
, 0xe4ed81e4, "_gpl");

217 
SYMBOL_CRC
(
iwl_fw_dbg_îr‹_cﬁÀ˘
, 0x31888ef8, "_gpl");

218 
SYMBOL_CRC
(
iwl_fw_dbg_cﬁÀ˘
, 0x0fee759a, "_gpl");

219 
SYMBOL_CRC
(
iwl_fw_dbg_cﬁÀ˘_åig
, 0x265f1610, "_gpl");

220 
SYMBOL_CRC
(
iwl_fw_°¨t_dbg_c⁄f
, 0xdf38a28f, "_gpl");

221 
SYMBOL_CRC
(
iwl_fw_dbg_ªad_d3_debug_d©a
, 0xe7795903, "_gpl");

222 
SYMBOL_CRC
(
iwl_fw_dbg_°›_sync
, 0x2d0fcccb, "_gpl");

223 
SYMBOL_CRC
(
iwl_fw_dbg_°›_ª°¨t_ªc‹dög
, 0x7d3c655c, "_gpl");

224 
SYMBOL_CRC
(
iwl_fw_dißbÀ_dbg_as£πs
, 0x7698a1b2, "_gpl");

225 
SYMBOL_CRC
(
iwl_fw_dbg_˛ór_m⁄ô‹_buf
, 0x1eaba99b, "_gpl");

226 
SYMBOL_CRC
(
iwl_≤vm_lﬂd
, 0xc3ee5efc, "_gpl");

227 
SYMBOL_CRC
(
iwl_fwπ_dump_îr‹_logs
, 0xbd9f5390, "_gpl");

228 
SYMBOL_CRC
(
iwl_bios_gë_wrds_èbÀ
, 0xc2f18b90, "_gpl");

229 
SYMBOL_CRC
(
iwl_bios_gë_ewrd_èbÀ
, 0xc98ade86, "_gpl");

230 
SYMBOL_CRC
(
iwl_bios_gë_wgds_èbÀ
, 0x7ae65444, "_gpl");

231 
SYMBOL_CRC
(
iwl_bios_gë_µag_èbÀ
, 0xe7bc2a3f, "_gpl");

232 
SYMBOL_CRC
(
iwl_bios_gë_ès_èbÀ
, 0xe94dfbcb, "_gpl");

233 
SYMBOL_CRC
(
iwl_bios_gë_pwr_limô
, 0xe7292b98, "_gpl");

234 
SYMBOL_CRC
(
iwl_bios_gë_mcc
, 0x465c6543, "_gpl");

235 
SYMBOL_CRC
(
iwl_bios_gë_eckv
, 0x44c70302, "_gpl");

236 
SYMBOL_CRC
(
iwl_ßr_geo_suµ‹t
, 0x1d01450d, "_gpl");

237 
SYMBOL_CRC
(
iwl_ßr_geo_fûl_èbÀ
, 0x0ff31737, "_gpl");

238 
SYMBOL_CRC
(
iwl_ßr_fûl_¥ofûe
, 0xa0f2ecfe, "_gpl");

239 
SYMBOL_CRC
(
iwl_fûl_µag_èbÀ
, 0xabc3aaa2, "_gpl");

240 
SYMBOL_CRC
(
iwl_is_µag_≠¥oved
, 0x94a9e99c, "_gpl");

241 
SYMBOL_CRC
(
iwl_is_ès_≠¥oved
, 0x7c55f97b, "_gpl");

242 
SYMBOL_CRC
(
iwl_gë_œri_c⁄fig_bôm≠
, 0x30daeda9, "_gpl");

243 
SYMBOL_CRC
(
iwl_bios_gë_dsm
, 0xf59c6828, "_gpl");

244 
SYMBOL_CRC
(
iwl_‰ì_fw_∑gög
, 0xed6bd0a3, "_gpl");

245 
SYMBOL_CRC
(
iwl_öô_∑gög
, 0x4432c9b9, "_gpl");

246 
SYMBOL_CRC
(
iwl_gë_sh¨ed_mem_c⁄f
, 0xd9642e48, "_gpl");

247 
SYMBOL_CRC
(
iwl_fw_ru¡ime_öô
, 0x9d7126c7, "_gpl");

248 
SYMBOL_CRC
(
iwl_fw_ru¡ime_su•íd
, 0x56caa787, "_gpl");

249 
SYMBOL_CRC
(
iwl_fw_ru¡ime_ªsume
, 0x65aebd2a, "_gpl");

250 
SYMBOL_CRC
(
iwl_£t_soc_œãncy
, 0x496d42b8, "_gpl");

251 
SYMBOL_CRC
(
iwl_c⁄figuª_rxq
, 0x1e71fc3c, "_gpl");

252 
SYMBOL_CRC
(
iwl_a˝i_gë_phy_fûãrs
, 0x9ebe23b3, "_gpl");

253 
SYMBOL_CRC
(
iwl_a˝i_gë_guid_lock_°©us
, 0x0681918c, "_gpl");

254 
SYMBOL_CRC
(
iwl_uefi_gë_°ï_èbÀ
, 0x8a692cda, "_gpl");

255 
SYMBOL_CRC
(
iwl_uefi_gë_sgom_èbÀ
, 0x524d2632, "_gpl");

256 
SYMBOL_CRC
(
iwl_uefi_gë_u©s_èbÀ
, 0xc7da1f37, "_gpl");

257 
SYMBOL_CRC
(
__åa˚poöt_iwlwifi_dev_ucode_evít
, 0x1d892fa0, "");

258 
SYMBOL_CRC
(
__åa˚ôî_iwlwifi_dev_ucode_evít
, 0xf90e038b, "");

259 
SYMBOL_CRC
(
__SCK__ç_func_iwlwifi_dev_ucode_evít
, 0xc318508b, "");

260 
SYMBOL_CRC
(
__SCT__ç_func_iwlwifi_dev_ucode_evít
, 0xd81e2f28, "");

261 
SYMBOL_CRC
(
__åa˚poöt_iwlwifi_dev_ucode_c⁄t_evít
, 0xd9cdd658, "");

262 
SYMBOL_CRC
(
__åa˚ôî_iwlwifi_dev_ucode_c⁄t_evít
, 0x1147cf4d, "");

263 
SYMBOL_CRC
(
__SCK__ç_func_iwlwifi_dev_ucode_c⁄t_evít
, 0xbfea42d1, "");

264 
SYMBOL_CRC
(
__SCT__ç_func_iwlwifi_dev_ucode_c⁄t_evít
, 0x3a2a40a5, "");

265 
SYMBOL_CRC
(
__åa˚poöt_iwlwifi_dev_ucode_wøp_evít
, 0x4e41aa62, "");

266 
SYMBOL_CRC
(
__åa˚ôî_iwlwifi_dev_ucode_wøp_evít
, 0x8224d8cf, "");

267 
SYMBOL_CRC
(
__SCK__ç_func_iwlwifi_dev_ucode_wøp_evít
, 0x28663eeb, "");

268 
SYMBOL_CRC
(
__SCT__ç_func_iwlwifi_dev_ucode_wøp_evít
, 0x38688d65, "");

270 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

271 
__u£d
 
__£˘i⁄
("__versions") = {

508 
MODULE_INFO
(
dïíds
, "cfg80211");

510 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001201bc*sc*i*");

511 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001301bc*sc*i*");

512 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001204bc*sc*i*");

513 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001304bc*sc*i*");

514 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001205bc*sc*i*");

515 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001305bc*sc*i*");

516 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001206bc*sc*i*");

517 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001306bc*sc*i*");

518 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001221bc*sc*i*");

519 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001321bc*sc*i*");

520 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001224bc*sc*i*");

521 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001324bc*sc*i*");

522 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001225bc*sc*i*");

523 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001325bc*sc*i*");

524 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001226bc*sc*i*");

525 
MODULE_ALIAS
("pci:v00008086d00004232sv*sd00001326bc*sc*i*");

526 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001211bc*sc*i*");

527 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001311bc*sc*i*");

528 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001214bc*sc*i*");

529 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001314bc*sc*i*");

530 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001215bc*sc*i*");

531 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001315bc*sc*i*");

532 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001216bc*sc*i*");

533 
MODULE_ALIAS
("pci:v00008086d00004237sv*sd00001316bc*sc*i*");

534 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001021bc*sc*i*");

535 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001121bc*sc*i*");

536 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001024bc*sc*i*");

537 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001124bc*sc*i*");

538 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001001bc*sc*i*");

539 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001101bc*sc*i*");

540 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001004bc*sc*i*");

541 
MODULE_ALIAS
("pci:v00008086d00004235sv*sd00001104bc*sc*i*");

542 
MODULE_ALIAS
("pci:v00008086d00004236sv*sd00001011bc*sc*i*");

543 
MODULE_ALIAS
("pci:v00008086d00004236sv*sd00001111bc*sc*i*");

544 
MODULE_ALIAS
("pci:v00008086d00004236sv*sd00001014bc*sc*i*");

545 
MODULE_ALIAS
("pci:v00008086d00004236sv*sd00001114bc*sc*i*");

546 
MODULE_ALIAS
("pci:v00008086d0000423Asv*sd00001001bc*sc*i*");

547 
MODULE_ALIAS
("pci:v00008086d0000423Asv*sd00001021bc*sc*i*");

548 
MODULE_ALIAS
("pci:v00008086d0000423Bsv*sd00001011bc*sc*i*");

549 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001201bc*sc*i*");

550 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001301bc*sc*i*");

551 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001206bc*sc*i*");

552 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001306bc*sc*i*");

553 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001221bc*sc*i*");

554 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001321bc*sc*i*");

555 
MODULE_ALIAS
("pci:v00008086d0000423Csv*sd00001326bc*sc*i*");

556 
MODULE_ALIAS
("pci:v00008086d0000423Dsv*sd00001211bc*sc*i*");

557 
MODULE_ALIAS
("pci:v00008086d0000423Dsv*sd00001311bc*sc*i*");

558 
MODULE_ALIAS
("pci:v00008086d0000423Dsv*sd00001216bc*sc*i*");

559 
MODULE_ALIAS
("pci:v00008086d0000423Dsv*sd00001316bc*sc*i*");

560 
MODULE_ALIAS
("pci:v00008086d0000422Bsv*sd00001101bc*sc*i*");

561 
MODULE_ALIAS
("pci:v00008086d0000422Bsv*sd00001108bc*sc*i*");

562 
MODULE_ALIAS
("pci:v00008086d0000422Bsv*sd00001121bc*sc*i*");

563 
MODULE_ALIAS
("pci:v00008086d0000422Bsv*sd00001128bc*sc*i*");

564 
MODULE_ALIAS
("pci:v00008086d0000422Csv*sd00001301bc*sc*i*");

565 
MODULE_ALIAS
("pci:v00008086d0000422Csv*sd00001306bc*sc*i*");

566 
MODULE_ALIAS
("pci:v00008086d0000422Csv*sd00001307bc*sc*i*");

567 
MODULE_ALIAS
("pci:v00008086d0000422Csv*sd00001321bc*sc*i*");

568 
MODULE_ALIAS
("pci:v00008086d0000422Csv*sd00001326bc*sc*i*");

569 
MODULE_ALIAS
("pci:v00008086d00004238sv*sd00001111bc*sc*i*");

570 
MODULE_ALIAS
("pci:v00008086d00004238sv*sd00001118bc*sc*i*");

571 
MODULE_ALIAS
("pci:v00008086d00004239sv*sd00001311bc*sc*i*");

572 
MODULE_ALIAS
("pci:v00008086d00004239sv*sd00001316bc*sc*i*");

573 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001301bc*sc*i*");

574 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001306bc*sc*i*");

575 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001307bc*sc*i*");

576 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001308bc*sc*i*");

577 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001321bc*sc*i*");

578 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001326bc*sc*i*");

579 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001328bc*sc*i*");

580 
MODULE_ALIAS
("pci:v00008086d00000085sv*sd00001311bc*sc*i*");

581 
MODULE_ALIAS
("pci:v00008086d00000085sv*sd00001318bc*sc*i*");

582 
MODULE_ALIAS
("pci:v00008086d00000085sv*sd00001316bc*sc*i*");

583 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd0000C020bc*sc*i*");

584 
MODULE_ALIAS
("pci:v00008086d00000085sv*sd0000C220bc*sc*i*");

585 
MODULE_ALIAS
("pci:v00008086d00000085sv*sd0000C228bc*sc*i*");

586 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00004820bc*sc*i*");

587 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001304bc*sc*i*");

588 
MODULE_ALIAS
("pci:v00008086d00000082sv*sd00001305bc*sc*i*");

589 
MODULE_ALIAS
("pci:v00008086d0000008Asv*sd00005305bc*sc*i*");

590 
MODULE_ALIAS
("pci:v00008086d0000008Asv*sd00005307bc*sc*i*");

591 
MODULE_ALIAS
("pci:v00008086d0000008Asv*sd00005325bc*sc*i*");

592 
MODULE_ALIAS
("pci:v00008086d0000008Asv*sd00005327bc*sc*i*");

593 
MODULE_ALIAS
("pci:v00008086d0000008Bsv*sd00005315bc*sc*i*");

594 
MODULE_ALIAS
("pci:v00008086d0000008Bsv*sd00005317bc*sc*i*");

595 
MODULE_ALIAS
("pci:v00008086d00000090sv*sd00005211bc*sc*i*");

596 
MODULE_ALIAS
("pci:v00008086d00000090sv*sd00005215bc*sc*i*");

597 
MODULE_ALIAS
("pci:v00008086d00000090sv*sd00005216bc*sc*i*");

598 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005201bc*sc*i*");

599 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005205bc*sc*i*");

600 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005206bc*sc*i*");

601 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005207bc*sc*i*");

602 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005221bc*sc*i*");

603 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005225bc*sc*i*");

604 
MODULE_ALIAS
("pci:v00008086d00000091sv*sd00005226bc*sc*i*");

605 
MODULE_ALIAS
("pci:v00008086d00000087sv*sd00001301bc*sc*i*");

606 
MODULE_ALIAS
("pci:v00008086d00000087sv*sd00001306bc*sc*i*");

607 
MODULE_ALIAS
("pci:v00008086d00000087sv*sd00001321bc*sc*i*");

608 
MODULE_ALIAS
("pci:v00008086d00000087sv*sd00001326bc*sc*i*");

609 
MODULE_ALIAS
("pci:v00008086d00000089sv*sd00001311bc*sc*i*");

610 
MODULE_ALIAS
("pci:v00008086d00000089sv*sd00001316bc*sc*i*");

611 
MODULE_ALIAS
("pci:v00008086d00000885sv*sd00001305bc*sc*i*");

612 
MODULE_ALIAS
("pci:v00008086d00000885sv*sd00001307bc*sc*i*");

613 
MODULE_ALIAS
("pci:v00008086d00000885sv*sd00001325bc*sc*i*");

614 
MODULE_ALIAS
("pci:v00008086d00000885sv*sd00001327bc*sc*i*");

615 
MODULE_ALIAS
("pci:v00008086d00000886sv*sd00001315bc*sc*i*");

616 
MODULE_ALIAS
("pci:v00008086d00000886sv*sd00001317bc*sc*i*");

617 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001205bc*sc*i*");

618 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001305bc*sc*i*");

619 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001225bc*sc*i*");

620 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001325bc*sc*i*");

621 
MODULE_ALIAS
("pci:v00008086d00000084sv*sd00001215bc*sc*i*");

622 
MODULE_ALIAS
("pci:v00008086d00000084sv*sd00001315bc*sc*i*");

623 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001206bc*sc*i*");

624 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001306bc*sc*i*");

625 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001226bc*sc*i*");

626 
MODULE_ALIAS
("pci:v00008086d00000083sv*sd00001326bc*sc*i*");

627 
MODULE_ALIAS
("pci:v00008086d00000084sv*sd00001216bc*sc*i*");

628 
MODULE_ALIAS
("pci:v00008086d00000084sv*sd00001316bc*sc*i*");

629 
MODULE_ALIAS
("pci:v00008086d000008AEsv*sd00001005bc*sc*i*");

630 
MODULE_ALIAS
("pci:v00008086d000008AEsv*sd00001007bc*sc*i*");

631 
MODULE_ALIAS
("pci:v00008086d000008AFsv*sd00001015bc*sc*i*");

632 
MODULE_ALIAS
("pci:v00008086d000008AFsv*sd00001017bc*sc*i*");

633 
MODULE_ALIAS
("pci:v00008086d000008AEsv*sd00001025bc*sc*i*");

634 
MODULE_ALIAS
("pci:v00008086d000008AEsv*sd00001027bc*sc*i*");

635 
MODULE_ALIAS
("pci:v00008086d00000896sv*sd00005005bc*sc*i*");

636 
MODULE_ALIAS
("pci:v00008086d00000896sv*sd00005007bc*sc*i*");

637 
MODULE_ALIAS
("pci:v00008086d00000897sv*sd00005015bc*sc*i*");

638 
MODULE_ALIAS
("pci:v00008086d00000897sv*sd00005017bc*sc*i*");

639 
MODULE_ALIAS
("pci:v00008086d00000896sv*sd00005025bc*sc*i*");

640 
MODULE_ALIAS
("pci:v00008086d00000896sv*sd00005027bc*sc*i*");

641 
MODULE_ALIAS
("pci:v00008086d00000890sv*sd00004022bc*sc*i*");

642 
MODULE_ALIAS
("pci:v00008086d00000891sv*sd00004222bc*sc*i*");

643 
MODULE_ALIAS
("pci:v00008086d00000890sv*sd00004422bc*sc*i*");

644 
MODULE_ALIAS
("pci:v00008086d00000890sv*sd00004822bc*sc*i*");

645 
MODULE_ALIAS
("pci:v00008086d00000887sv*sd00004062bc*sc*i*");

646 
MODULE_ALIAS
("pci:v00008086d00000888sv*sd00004262bc*sc*i*");

647 
MODULE_ALIAS
("pci:v00008086d00000887sv*sd00004462bc*sc*i*");

648 
MODULE_ALIAS
("pci:v00008086d0000088Esv*sd00004060bc*sc*i*");

649 
MODULE_ALIAS
("pci:v00008086d0000088Esv*sd0000406Abc*sc*i*");

650 
MODULE_ALIAS
("pci:v00008086d0000088Fsv*sd00004260bc*sc*i*");

651 
MODULE_ALIAS
("pci:v00008086d0000088Fsv*sd0000426Abc*sc*i*");

652 
MODULE_ALIAS
("pci:v00008086d0000088Esv*sd00004460bc*sc*i*");

653 
MODULE_ALIAS
("pci:v00008086d0000088Esv*sd0000446Abc*sc*i*");

654 
MODULE_ALIAS
("pci:v00008086d0000088Esv*sd00004860bc*sc*i*");

655 
MODULE_ALIAS
("pci:v00008086d0000088Fsv*sd00005260bc*sc*i*");

656 
MODULE_ALIAS
("pci:v00008086d00000894sv*sd00000022bc*sc*i*");

657 
MODULE_ALIAS
("pci:v00008086d00000895sv*sd00000222bc*sc*i*");

658 
MODULE_ALIAS
("pci:v00008086d00000894sv*sd00000422bc*sc*i*");

659 
MODULE_ALIAS
("pci:v00008086d00000894sv*sd00000822bc*sc*i*");

660 
MODULE_ALIAS
("pci:v00008086d00000892sv*sd00000062bc*sc*i*");

661 
MODULE_ALIAS
("pci:v00008086d00000893sv*sd00000262bc*sc*i*");

662 
MODULE_ALIAS
("pci:v00008086d00000892sv*sd00000462bc*sc*i*");

663 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004070bc*sc*i*");

664 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004072bc*sc*i*");

665 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004170bc*sc*i*");

666 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004C60bc*sc*i*");

667 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004C70bc*sc*i*");

668 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004060bc*sc*i*");

669 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000406Abc*sc*i*");

670 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004160bc*sc*i*");

671 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004062bc*sc*i*");

672 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004162bc*sc*i*");

673 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004270bc*sc*i*");

674 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004272bc*sc*i*");

675 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004260bc*sc*i*");

676 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000426Abc*sc*i*");

677 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004262bc*sc*i*");

678 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004470bc*sc*i*");

679 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004472bc*sc*i*");

680 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004460bc*sc*i*");

681 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000446Abc*sc*i*");

682 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004462bc*sc*i*");

683 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004870bc*sc*i*");

684 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000486Ebc*sc*i*");

685 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004A70bc*sc*i*");

686 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004A6Ebc*sc*i*");

687 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004A6Cbc*sc*i*");

688 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004570bc*sc*i*");

689 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004560bc*sc*i*");

690 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004370bc*sc*i*");

691 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004360bc*sc*i*");

692 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00005070bc*sc*i*");

693 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00005072bc*sc*i*");

694 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00005170bc*sc*i*");

695 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00005770bc*sc*i*");

696 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004020bc*sc*i*");

697 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000402Abc*sc*i*");

698 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd00004220bc*sc*i*");

699 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd00004420bc*sc*i*");

700 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C070bc*sc*i*");

701 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C072bc*sc*i*");

702 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C170bc*sc*i*");

703 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C060bc*sc*i*");

704 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C06Abc*sc*i*");

705 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C160bc*sc*i*");

706 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C062bc*sc*i*");

707 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C162bc*sc*i*");

708 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C770bc*sc*i*");

709 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C760bc*sc*i*");

710 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C270bc*sc*i*");

711 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000CC70bc*sc*i*");

712 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000CC60bc*sc*i*");

713 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C272bc*sc*i*");

714 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C260bc*sc*i*");

715 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C26Abc*sc*i*");

716 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C262bc*sc*i*");

717 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C470bc*sc*i*");

718 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C472bc*sc*i*");

719 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C460bc*sc*i*");

720 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C462bc*sc*i*");

721 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C570bc*sc*i*");

722 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C560bc*sc*i*");

723 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C370bc*sc*i*");

724 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C360bc*sc*i*");

725 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C020bc*sc*i*");

726 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C02Abc*sc*i*");

727 
MODULE_ALIAS
("pci:v00008086d000008B2sv*sd0000C220bc*sc*i*");

728 
MODULE_ALIAS
("pci:v00008086d000008B1sv*sd0000C420bc*sc*i*");

729 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000070bc*sc*i*");

730 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000072bc*sc*i*");

731 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000170bc*sc*i*");

732 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000172bc*sc*i*");

733 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000060bc*sc*i*");

734 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000062bc*sc*i*");

735 
MODULE_ALIAS
("pci:v00008086d000008B4sv*sd00000270bc*sc*i*");

736 
MODULE_ALIAS
("pci:v00008086d000008B4sv*sd00000272bc*sc*i*");

737 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000470bc*sc*i*");

738 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00000472bc*sc*i*");

739 
MODULE_ALIAS
("pci:v00008086d000008B4sv*sd00000370bc*sc*i*");

740 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008070bc*sc*i*");

741 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008072bc*sc*i*");

742 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008170bc*sc*i*");

743 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008172bc*sc*i*");

744 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008060bc*sc*i*");

745 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008062bc*sc*i*");

746 
MODULE_ALIAS
("pci:v00008086d000008B4sv*sd00008270bc*sc*i*");

747 
MODULE_ALIAS
("pci:v00008086d000008B4sv*sd00008370bc*sc*i*");

748 
MODULE_ALIAS
("pci:v00008086d000008B4sv*sd00008272bc*sc*i*");

749 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008470bc*sc*i*");

750 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00008570bc*sc*i*");

751 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00001070bc*sc*i*");

752 
MODULE_ALIAS
("pci:v00008086d000008B3sv*sd00001170bc*sc*i*");

753 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00004010bc*sc*i*");

754 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00004012bc*sc*i*");

755 
MODULE_ALIAS
("pci:v00008086d00003166sv*sd00004212bc*sc*i*");

756 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00004410bc*sc*i*");

757 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00004510bc*sc*i*");

758 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00004110bc*sc*i*");

759 
MODULE_ALIAS
("pci:v00008086d00003166sv*sd00004310bc*sc*i*");

760 
MODULE_ALIAS
("pci:v00008086d00003166sv*sd00004210bc*sc*i*");

761 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00008010bc*sc*i*");

762 
MODULE_ALIAS
("pci:v00008086d00003165sv*sd00008110bc*sc*i*");

763 
MODULE_ALIAS
("pci:v00008086d000024FBsv*sd00002010bc*sc*i*");

764 
MODULE_ALIAS
("pci:v00008086d000024FBsv*sd00002110bc*sc*i*");

765 
MODULE_ALIAS
("pci:v00008086d000024FBsv*sd00002050bc*sc*i*");

766 
MODULE_ALIAS
("pci:v00008086d000024FBsv*sd00002150bc*sc*i*");

767 
MODULE_ALIAS
("pci:v00008086d000024FBsv*sd00000000bc*sc*i*");

768 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005010bc*sc*i*");

769 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005110bc*sc*i*");

770 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005100bc*sc*i*");

771 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005310bc*sc*i*");

772 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005302bc*sc*i*");

773 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005210bc*sc*i*");

774 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005C10bc*sc*i*");

775 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005012bc*sc*i*");

776 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005412bc*sc*i*");

777 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005410bc*sc*i*");

778 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005510bc*sc*i*");

779 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005400bc*sc*i*");

780 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00001010bc*sc*i*");

781 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005000bc*sc*i*");

782 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd0000500Abc*sc*i*");

783 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005200bc*sc*i*");

784 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005002bc*sc*i*");

785 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005102bc*sc*i*");

786 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005202bc*sc*i*");

787 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009010bc*sc*i*");

788 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009012bc*sc*i*");

789 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd0000900Abc*sc*i*");

790 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009110bc*sc*i*");

791 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009112bc*sc*i*");

792 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00009210bc*sc*i*");

793 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00009200bc*sc*i*");

794 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009510bc*sc*i*");

795 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00009310bc*sc*i*");

796 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009410bc*sc*i*");

797 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005020bc*sc*i*");

798 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd0000502Abc*sc*i*");

799 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005420bc*sc*i*");

800 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005090bc*sc*i*");

801 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005190bc*sc*i*");

802 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005590bc*sc*i*");

803 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005290bc*sc*i*");

804 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005490bc*sc*i*");

805 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00005F10bc*sc*i*");

806 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd00005212bc*sc*i*");

807 
MODULE_ALIAS
("pci:v00008086d0000095Bsv*sd0000520Abc*sc*i*");

808 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009000bc*sc*i*");

809 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009400bc*sc*i*");

810 
MODULE_ALIAS
("pci:v00008086d0000095Asv*sd00009E10bc*sc*i*");

811 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000010bc*sc*i*");

812 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001010bc*sc*i*");

813 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd000010B0bc*sc*i*");

814 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000130bc*sc*i*");

815 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001130bc*sc*i*");

816 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000132bc*sc*i*");

817 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001132bc*sc*i*");

818 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000110bc*sc*i*");

819 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd000001F0bc*sc*i*");

820 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000012bc*sc*i*");

821 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001012bc*sc*i*");

822 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001110bc*sc*i*");

823 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000050bc*sc*i*");

824 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000250bc*sc*i*");

825 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001050bc*sc*i*");

826 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000150bc*sc*i*");

827 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00001150bc*sc*i*");

828 
MODULE_ALIAS
("pci:v00008086d000024F4sv*sd00000030bc*sc*i*");

829 
MODULE_ALIAS
("pci:v00008086d000024F4sv*sd00001030bc*sc*i*");

830 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000C010bc*sc*i*");

831 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000C110bc*sc*i*");

832 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000D010bc*sc*i*");

833 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000C050bc*sc*i*");

834 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000D050bc*sc*i*");

835 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000D0B0bc*sc*i*");

836 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd0000B0B0bc*sc*i*");

837 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00008010bc*sc*i*");

838 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00008110bc*sc*i*");

839 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00009010bc*sc*i*");

840 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00009110bc*sc*i*");

841 
MODULE_ALIAS
("pci:v00008086d000024F4sv*sd00008030bc*sc*i*");

842 
MODULE_ALIAS
("pci:v00008086d000024F4sv*sd00009030bc*sc*i*");

843 
MODULE_ALIAS
("pci:v00008086d000024F4sv*sd0000C030bc*sc*i*");

844 
MODULE_ALIAS
("pci:v00008086d000024F4sv*sd0000D030bc*sc*i*");

845 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00008130bc*sc*i*");

846 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00009130bc*sc*i*");

847 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00008132bc*sc*i*");

848 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00009132bc*sc*i*");

849 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00008050bc*sc*i*");

850 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00008150bc*sc*i*");

851 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00009050bc*sc*i*");

852 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00009150bc*sc*i*");

853 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000004bc*sc*i*");

854 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000044bc*sc*i*");

855 
MODULE_ALIAS
("pci:v00008086d000024F5sv*sd00000010bc*sc*i*");

856 
MODULE_ALIAS
("pci:v00008086d000024F6sv*sd00000030bc*sc*i*");

857 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000810bc*sc*i*");

858 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000910bc*sc*i*");

859 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000850bc*sc*i*");

860 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000950bc*sc*i*");

861 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000930bc*sc*i*");

862 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00000000bc*sc*i*");

863 
MODULE_ALIAS
("pci:v00008086d000024F3sv*sd00004010bc*sc*i*");

864 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000010bc*sc*i*");

865 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000110bc*sc*i*");

866 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00001110bc*sc*i*");

867 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00001130bc*sc*i*");

868 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000130bc*sc*i*");

869 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00001010bc*sc*i*");

870 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd000010D0bc*sc*i*");

871 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000050bc*sc*i*");

872 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000150bc*sc*i*");

873 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00009010bc*sc*i*");

874 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00008110bc*sc*i*");

875 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00008050bc*sc*i*");

876 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00008010bc*sc*i*");

877 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000810bc*sc*i*");

878 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00009110bc*sc*i*");

879 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00008130bc*sc*i*");

880 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000910bc*sc*i*");

881 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000930bc*sc*i*");

882 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000950bc*sc*i*");

883 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000850bc*sc*i*");

884 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00001014bc*sc*i*");

885 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00003E02bc*sc*i*");

886 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00003E01bc*sc*i*");

887 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00001012bc*sc*i*");

888 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000012bc*sc*i*");

889 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00000014bc*sc*i*");

890 
MODULE_ALIAS
("pci:v00008086d000024FDsv*sd00009074bc*sc*i*");

891 
MODULE_ALIAS
("pci:v00008086d00002526sv*sd*bc*sc*i*");

892 
MODULE_ALIAS
("pci:v00008086d0000271Bsv*sd*bc*sc*i*");

893 
MODULE_ALIAS
("pci:v00008086d0000271Csv*sd*bc*sc*i*");

894 
MODULE_ALIAS
("pci:v00008086d000030DCsv*sd*bc*sc*i*");

895 
MODULE_ALIAS
("pci:v00008086d000031DCsv*sd*bc*sc*i*");

896 
MODULE_ALIAS
("pci:v00008086d00009DF0sv*sd*bc*sc*i*");

897 
MODULE_ALIAS
("pci:v00008086d0000A370sv*sd*bc*sc*i*");

898 
MODULE_ALIAS
("pci:v00008086d000002F0sv*sd*bc*sc*i*");

899 
MODULE_ALIAS
("pci:v00008086d000006F0sv*sd*bc*sc*i*");

900 
MODULE_ALIAS
("pci:v00008086d000034F0sv*sd*bc*sc*i*");

901 
MODULE_ALIAS
("pci:v00008086d00003DF0sv*sd*bc*sc*i*");

902 
MODULE_ALIAS
("pci:v00008086d00004DF0sv*sd*bc*sc*i*");

903 
MODULE_ALIAS
("pci:v00008086d000043F0sv*sd*bc*sc*i*");

904 
MODULE_ALIAS
("pci:v00008086d0000A0F0sv*sd*bc*sc*i*");

905 
MODULE_ALIAS
("pci:v00008086d00002723sv*sd*bc*sc*i*");

906 
MODULE_ALIAS
("pci:v00008086d00002725sv*sd*bc*sc*i*");

907 
MODULE_ALIAS
("pci:v00008086d00007A70sv*sd*bc*sc*i*");

908 
MODULE_ALIAS
("pci:v00008086d00007AF0sv*sd*bc*sc*i*");

909 
MODULE_ALIAS
("pci:v00008086d000051F0sv*sd*bc*sc*i*");

910 
MODULE_ALIAS
("pci:v00008086d000051F1sv*sd*bc*sc*i*");

911 
MODULE_ALIAS
("pci:v00008086d000051F1sv*sd*bc*sc*i*");

912 
MODULE_ALIAS
("pci:v00008086d000054F0sv*sd*bc*sc*i*");

913 
MODULE_ALIAS
("pci:v00008086d00007F70sv*sd*bc*sc*i*");

914 
MODULE_ALIAS
("pci:v00008086d00002729sv*sd*bc*sc*i*");

915 
MODULE_ALIAS
("pci:v00008086d00007E40sv*sd*bc*sc*i*");

916 
MODULE_ALIAS
("pci:v00008086d00002727sv*sd*bc*sc*i*");

917 
MODULE_ALIAS
("pci:v00008086d0000272Dsv*sd*bc*sc*i*");

918 
MODULE_ALIAS
("pci:v00008086d0000272Bsv*sd*bc*sc*i*");

919 
MODULE_ALIAS
("pci:v00008086d0000A840sv*sd*bc*sc*i*");

920 
MODULE_ALIAS
("pci:v00008086d00007740sv*sd*bc*sc*i*");

921 
MODULE_ALIAS
("pci:v00008086d0000E440sv*sd*bc*sc*i*");

922 
MODULE_ALIAS
("pci:v00008086d0000E340sv*sd*bc*sc*i*");

923 
MODULE_ALIAS
("pci:v00008086d0000D340sv*sd*bc*sc*i*");

924 
MODULE_ALIAS
("pci:v00008086d00006E70sv*sd*bc*sc*i*");

926 
MODULE_INFO
(
§cvîsi⁄
, "57A7BCA3D4A83C1B067C948");

	@mei/internal.h

6 #i‚de‡
__IWLMEI_INTERNAL_H_


7 
	#__IWLMEI_INTERNAL_H_


	)

9 
	~<u≠i/löux/if_ëhî.h
>

10 
	~<löux/√tdevi˚.h
>

12 
	~"ßp.h
"

14 
rx_h™dÀr_ªsu…_t
 
iwl_mei_rx_fûãr
(
sk_buff
 *
skb
,

15 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

16 
boﬁ
 *
∑ss_to_csme
);

18 
iwl_mei_add_d©a_to_rög
(
sk_buff
 *
skb
, 
boﬁ
 
cb_tx
);

	@mei/iwl-mei.h

6 #i‚de‡
__iwl_mei_h__


7 
	#__iwl_mei_h__


	)

9 
	~<löux/if_ëhî.h
>

10 
	~<löux/skbuff.h
>

11 
	~<löux/õì80211.h
>

193 
	eiwl_mei_nvm_ˇps
 {

194 
	mMEI_NVM_CAPS_LARI_SUPPORT
 = 
BIT
(0),

195 
	mMEI_NVM_CAPS_11AX_SUPPORT
 = 
BIT
(1),

210 
	siwl_mei_nvm
 {

211 
u8
 
	mhw_addr
[
ETH_ALEN
];

212 
u8
 
	mn_hw_addrs
;

213 
u8
 
	mª£rved
;

214 
u32
 
	mødio_cfg
;

215 
u32
 
	mˇps
;

216 
u32
 
	mnvm_vîsi⁄
;

217 
u32
 
	mch™√ls
[110];

230 
	eiwl_mei_∑úwi£_cùhî
 {

231 
	mIWL_MEI_CIPHER_NONE
 = 0,

232 
	mIWL_MEI_CIPHER_TKIP
 = 2,

233 
	mIWL_MEI_CIPHER_CCMP
 = 4,

234 
	mIWL_MEI_CIPHER_GCMP
 = 8,

235 
	mIWL_MEI_CIPHER_GCMP_256
 = 9,

247 
	eiwl_mei_akm_auth
 {

248 
	mIWL_MEI_AKM_AUTH_OPEN
 = 0,

249 
	mIWL_MEI_AKM_AUTH_RSNA
 = 6,

250 
	mIWL_MEI_AKM_AUTH_RSNA_PSK
 = 7,

251 
	mIWL_MEI_AKM_AUTH_SAE
 = 9,

265 
	siwl_mei_c⁄n_öfo
 {

266 
u8
 
	mÕ_°©e
;

267 
u8
 
	mauth_mode
;

268 
u8
 
	mssid_Àn
;

269 
u8
 
	mch™√l
;

270 
u8
 
	mb™d
;

271 
u8
 
	m∑úwi£_cùhî
;

272 
u8
 
	mbssid
[
ETH_ALEN
];

273 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

281 
	siwl_mei_cﬁloc_öfo
 {

282 
u8
 
	mch™√l
;

283 
u8
 
	mbssid
[
ETH_ALEN
];

301 
	siwl_mei_›s
 {

302 (*
	mme_c⁄n_°©us
)(*
	m¥iv
,

303 c⁄° 
iwl_mei_c⁄n_öfo
 *
	mc⁄n_öfo
);

304 (*
	mrfkûl
)(*
	m¥iv
, 
boﬁ
 
	mblocked
, boﬁ 
	mcsme_èkög_ow√rshù
);

305 (*
	mrﬂmög_f‹biddí
)(*
	m¥iv
, 
boﬁ
 
	mf‹biddí
);

306 (*
	mßp_c⁄√˘ed
)(*
	m¥iv
);

307 (*
	mnic_°ﬁí
)(*
	m¥iv
);

310 #i‡
IS_ENABLED
(
CONFIG_IWLMEI
)

317 
boﬁ
 
iwl_mei_is_c⁄√˘ed
();

328 
iwl_mei_nvm
 *
iwl_mei_gë_nvm
();

337 
iwl_mei_gë_ow√rshù
();

346 
iwl_mei_£t_rfkûl_°©e
(
boﬁ
 
hw_rfkûl
, boﬁ 
sw_rfkûl
);

355 
iwl_mei_£t_nic_öfo
(c⁄° 
u8
 *
mac_addªss
, c⁄° u8 *
nvm_addªss
);

363 
iwl_mei_£t_cou¡ry_code
(
u16
 
mcc
);

372 
iwl_mei_£t_powî_limô
(c⁄° 
__À16
 *
powî_limô
);

385 
iwl_mei_ªgi°î
(*
¥iv
, c⁄° 
iwl_mei_›s
 *
›s
);

393 
iwl_mei_°¨t_uƒegi°î
();

401 
iwl_mei_uƒegi°î_com∂ëe
();

418 
iwl_mei_£t_√tdev
(
√t_devi˚
 *
√tdev
);

434 
iwl_mei_tx_c›y_to_csme
(
sk_buff
 *
skb
, 
ivÀn
);

442 
iwl_mei_ho°_assocüãd
(c⁄° 
iwl_mei_c⁄n_öfo
 *
c⁄n_öfo
,

443 c⁄° 
iwl_mei_cﬁloc_öfo
 *
cﬁloc_öfo
);

448 
iwl_mei_ho°_dißssocüãd
();

454 
iwl_mei_devi˚_°©e
(
boﬁ
 
up
);

462 
iwl_mei_∂dr_ªq
();

469 
iwl_mei_Æive_nŸif
(
boﬁ
 
suc˚ss
);

473 
ölöe
 
boﬁ
 
	$iwl_mei_is_c⁄√˘ed
()

474 {  
Ál£
; 
	}
}

476 
ölöe
 
iwl_mei_nvm
 *
	$iwl_mei_gë_nvm
()

477 {  
NULL
; 
	}
}

479 
ölöe
 
	$iwl_mei_gë_ow√rshù
()

480 {  0; 
	}
}

482 
ölöe
 
	$iwl_mei_£t_rfkûl_°©e
(
boﬁ
 
hw_rfkûl
, boﬁ 
sw_rfkûl
)

483 {
	}
}

485 
ölöe
 
	$iwl_mei_£t_nic_öfo
(c⁄° 
u8
 *
mac_addªss
, c⁄° u8 *
nvm_addªss
)

486 {
	}
}

488 
ölöe
 
	$iwl_mei_£t_cou¡ry_code
(
u16
 
mcc
)

489 {
	}
}

491 
ölöe
 
	$iwl_mei_£t_powî_limô
(
__À16
 *
powî_limô
)

492 {
	}
}

494 
ölöe
 
	$iwl_mei_ªgi°î
(*
¥iv
,

495 c⁄° 
iwl_mei_›s
 *
›s
)

496 {  -
EOPNOTSUPP
; 
	}
}

498 
ölöe
 
	$iwl_mei_°¨t_uƒegi°î
()

499 {
	}
}

501 
ölöe
 
	$iwl_mei_uƒegi°î_com∂ëe
()

502 {
	}
}

504 
ölöe
 
	$iwl_mei_£t_√tdev
(
√t_devi˚
 *
√tdev
)

505 {
	}
}

507 
ölöe
 
	$iwl_mei_tx_c›y_to_csme
(
sk_buff
 *
skb
,

508 
ivÀn
)

509 {
	}
}

511 
ölöe
 
	$iwl_mei_ho°_assocüãd
(c⁄° 
iwl_mei_c⁄n_öfo
 *
c⁄n_öfo
,

512 c⁄° 
iwl_mei_cﬁloc_öfo
 *
cﬁloc_öfo
)

513 {
	}
}

515 
ölöe
 
	$iwl_mei_ho°_dißssocüãd
()

516 {
	}
}

518 
ölöe
 
	$iwl_mei_devi˚_°©e
(
boﬁ
 
up
)

519 {
	}
}

521 
ölöe
 
	$iwl_mei_∂dr_ªq
()

522 {  0; 
	}
}

524 
ölöe
 
	$iwl_mei_Æive_nŸif
(
boﬁ
 
suc˚ss
)

525 {
	}
}

	@mei/main.c

6 
	~<löux/ëhîdevi˚.h
>

7 
	~<löux/√tdevi˚.h
>

8 
	~<löux/õì80211.h
>

9 
	~<löux/π√éök.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/moduÀ∑øm.h
>

12 
	~<löux/mei_˛_bus.h
>

13 
	~<löux/rcupd©e.h
>

14 
	~<löux/debugfs.h
>

15 
	~<löux/skbuff.h
>

16 
	~<löux/waô.h
>

17 
	~<löux/¶ab.h
>

18 
	~<löux/mm.h
>

20 
	~<√t/cfg80211.h
>

22 
	~"öã∫Æ.h
"

23 
	~"iwl-mei.h
"

24 
	~"åa˚.h
"

25 
	~"åa˚-d©a.h
"

26 
	~"ßp.h
"

28 
MODULE_DESCRIPTION
("The Intel(R) wireless / CSME firmware interface");

29 
MODULE_LICENSE
("GPL");

31 
	#MEI_WLAN_UUID
 
	`UUID_LE
(0x13280904, 0x7792, 0x4fcb, \

32 0xa1, 0xØ, 0x5e, 0x70, 0xcb, 0xb1, 0xe8, 0x65)

	)

37 
	#MEI_OWNERSHIP_RETAKE_TIMEOUT_MS
 
	`m£cs_to_jiffõs
(60000)

	)

47 
mei_˛_devi˚
 *
	giwl_mei_globÆ_˛dev
;

48 
DEFINE_MUTEX
(
iwl_mei_muãx
);

49 
	giwl_mei_°©us
;

51 
	eiwl_mei_°©us_bôs
 {

52 
	mIWL_MEI_STATUS_SAP_CONNECTED
,

55 
boﬁ
 
	$iwl_mei_is_c⁄√˘ed
()

57  
	`ã°_bô
(
IWL_MEI_STATUS_SAP_CONNECTED
, &
iwl_mei_°©us
);

58 
	}
}

59 
EXPORT_SYMBOL_GPL
(
iwl_mei_is_c⁄√˘ed
);

61 
	#SAP_VERSION
 3

	)

62 
	#SAP_CONTROL_BLOCK_ID
 0x21504153

	)

64 
	siwl_ßp_q_˘æ_blk
 {

65 
__À32
 
	mwr_±r
;

66 
__À32
 
	mrd_±r
;

67 
__À32
 
	msize
;

70 
	eiwl_ßp_q_idx
 {

71 
	mSAP_QUEUE_IDX_NOTIF
 = 0,

72 
	mSAP_QUEUE_IDX_DATA
,

73 
	mSAP_QUEUE_IDX_MAX
,

76 
	siwl_ßp_dú
 {

77 
__À32
 
	mª£rved
;

78 
iwl_ßp_q_˘æ_blk
 
	mq_˘æ_blk
[
SAP_QUEUE_IDX_MAX
];

81 
	eiwl_ßp_dú_idx
 {

82 
	mSAP_DIRECTION_HOST_TO_ME
 = 0,

83 
	mSAP_DIRECTION_ME_TO_HOST
,

84 
	mSAP_DIRECTION_MAX
,

87 
	siwl_ßp_sh¨ed_mem_˘æ_blk
 {

88 
__À32
 
	mßp_id
;

89 
__À32
 
	msize
;

90 
iwl_ßp_dú
 
	mdú
[
SAP_DIRECTION_MAX
];

111 
	#SAP_H2M_DATA_Q_SZ
 48256

	)

112 
	#SAP_M2H_DATA_Q_SZ
 24128

	)

113 
	#SAP_H2M_NOTIF_Q_SZ
 2240

	)

114 
	#SAP_M2H_NOTIF_Q_SZ
 62720

	)

116 
	#_IWL_MEI_SAP_SHARED_MEM_SZ
 \

117 ((
iwl_ßp_sh¨ed_mem_˘æ_blk
) + \

118 
SAP_H2M_DATA_Q_SZ
 + 
SAP_H2M_NOTIF_Q_SZ
 + \

119 
SAP_M2H_DATA_Q_SZ
 + 
SAP_M2H_NOTIF_Q_SZ
 + 4)

	)

121 
	#IWL_MEI_SAP_SHARED_MEM_SZ
 \

122 (
	`roundup
(
_IWL_MEI_SAP_SHARED_MEM_SZ
, 
PAGE_SIZE
))

	)

124 
	siwl_mei_sh¨ed_mem_±rs
 {

125 
iwl_ßp_sh¨ed_mem_˘æ_blk
 *
	m˘æ
;

126 *
	mq_hód
[
SAP_DIRECTION_MAX
][
SAP_QUEUE_IDX_MAX
];

127 
size_t
 
	mq_size
[
SAP_DIRECTION_MAX
][
SAP_QUEUE_IDX_MAX
];

130 
	siwl_mei_fûãrs
 {

131 
rcu_hód
 
	mrcu_hód
;

132 
iwl_ßp_oob_fûãrs
 
	mfûãrs
;

170 
	siwl_mei
 {

171 
waô_queue_hód_t
 
	mgë_nvm_wq
;

172 
w‹k_°ru˘
 
	m£nd_cß_msg_wk
;

173 
waô_queue_hód_t
 
	mgë_ow√rshù_wq
;

174 
iwl_mei_sh¨ed_mem_±rs
 
	msh¨ed_mem
;

175 
mei_˛_devi˚
 *
	m˛dev
;

176 
iwl_mei_nvm
 *
	mnvm
;

177 
iwl_mei_fûãrs
 
__rcu
 *
	mfûãrs
;

178 
boﬁ
 
	mgŸ_ow√rshù
;

179 
boﬁ
 
	mamt_íabÀd
;

180 
boﬁ
 
	mcß_thrŸéed
;

181 
boﬁ
 
	mcsme_èkög_ow√rshù
;

182 
boﬁ
 
	mlök_¥Ÿ_°©e
;

183 
boﬁ
 
	mdevi˚_down
;

184 
dñayed_w‹k
 
	mcß_thrŸée_íd_wk
;

185 
waô_queue_hód_t
 
	m∂dr_wq
;

186 
boﬁ
 
	m∂dr_a˘ive
;

187 
•ölock_t
 
	md©a_q_lock
;

188 
w‹k_°ru˘
 
	m√tdev_w‹k
;

189 
dñayed_w‹k
 
	mow√rshù_dw‹k
;

191 
©omic_t
 
	mßp_£q_no
;

192 
©omic_t
 
	m£q_no
;

194 
díåy
 *
	mdbgfs_dú
;

214 
	siwl_mei_ˇche
 {

215 c⁄° 
iwl_mei_›s
 *
	m›s
;

216 
√t_devi˚
 
__rcu
 *
	m√tdev
;

217 c⁄° 
iwl_ßp_nŸif_c⁄√˘i⁄_öfo
 *
	mc⁄n_öfo
;

218 c⁄° 
__À16
 *
	mpowî_limô
;

219 
u32
 
	mrf_kûl
;

220 
u16
 
	mmcc
;

221 
u8
 
	mmac_addªss
[6];

222 
u8
 
	mnvm_addªss
[6];

223 *
	m¥iv
;

226 
iwl_mei_ˇche
 
	giwl_mei_ˇche
 = {

227 .
rf_kûl
 = 
SAP_HW_RFKILL_DEASSERTED
 | 
SAP_SW_RFKILL_DEASSERTED


230 
	$iwl_mei_‰ì_sh¨ed_mem
(
mei_˛_devi˚
 *
˛dev
)

232 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

234 i‡(
	`mei_˛dev_dma_unm≠
(
˛dev
))

235 
	`dev_îr
(&
˛dev
->
dev
, "Couldn't unmapÅhe shared memÖroperly\n");

236 
	`mem£t
(&
mei
->
sh¨ed_mem
, 0, (mei->shared_mem));

237 
	}
}

239 
	#HBM_DMA_BUF_ID_WLAN
 1

	)

241 
	$iwl_mei_Æloc_sh¨ed_mem
(
mei_˛_devi˚
 *
˛dev
)

243 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

244 
iwl_mei_sh¨ed_mem_±rs
 *
mem
 = &
mei
->
sh¨ed_mem
;

246 
mem
->
˘æ
 = 
	`mei_˛dev_dma_m≠
(
˛dev
, 
HBM_DMA_BUF_ID_WLAN
,

247 
IWL_MEI_SAP_SHARED_MEM_SZ
);

249 i‡(
	`IS_ERR
(
mem
->
˘æ
)) {

250 
ªt
 = 
	`PTR_ERR
(
mem
->
˘æ
);

252 
mem
->
˘æ
 = 
NULL
;

254  
ªt
;

257 
	`mem£t
(
mem
->
˘æ
, 0, 
IWL_MEI_SAP_SHARED_MEM_SZ
);

260 
	}
}

262 
	$iwl_mei_öô_sh¨ed_mem
(
iwl_mei
 *
mei
)

264 
iwl_mei_sh¨ed_mem_±rs
 *
mem
 = &
mei
->
sh¨ed_mem
;

265 
iwl_ßp_dú
 *
h2m
;

266 
iwl_ßp_dú
 *
m2h
;

267 
dú
, 
queue
;

268 
u8
 *
q_hód
;

270 
mem
->
˘æ
->
ßp_id
 = 
	`˝u_to_À32
(
SAP_CONTROL_BLOCK_ID
);

272 
mem
->
˘æ
->
size
 = 
	`˝u_to_À32
((*mem->ctrl));

274 
h2m
 = &
mem
->
˘æ
->
dú
[
SAP_DIRECTION_HOST_TO_ME
];

275 
m2h
 = &
mem
->
˘æ
->
dú
[
SAP_DIRECTION_ME_TO_HOST
];

277 
h2m
->
q_˘æ_blk
[
SAP_QUEUE_IDX_DATA
].
size
 =

278 
	`˝u_to_À32
(
SAP_H2M_DATA_Q_SZ
);

279 
h2m
->
q_˘æ_blk
[
SAP_QUEUE_IDX_NOTIF
].
size
 =

280 
	`˝u_to_À32
(
SAP_H2M_NOTIF_Q_SZ
);

281 
m2h
->
q_˘æ_blk
[
SAP_QUEUE_IDX_DATA
].
size
 =

282 
	`˝u_to_À32
(
SAP_M2H_DATA_Q_SZ
);

283 
m2h
->
q_˘æ_blk
[
SAP_QUEUE_IDX_NOTIF
].
size
 =

284 
	`˝u_to_À32
(
SAP_M2H_NOTIF_Q_SZ
);

287 
q_hód
 = (*)(
mem
->
˘æ
 + 1);

290 
dú
 = 0; dú < 
SAP_DIRECTION_MAX
; dir++) {

291 
queue
 = 0; queuê< 
SAP_QUEUE_IDX_MAX
; queue++) {

292 
mem
->
q_hód
[
dú
][
queue
] = q_head;

293 
q_hód
 +=

294 
	`À32_to_˝u
(
mem
->
˘æ
->
dú
[dú].
q_˘æ_blk
[
queue
].
size
);

295 
mem
->
q_size
[
dú
][
queue
] =

296 
	`À32_to_˝u
(
mem
->
˘æ
->
dú
[dú].
q_˘æ_blk
[
queue
].
size
);

300 *(
__À32
 *)
q_hód
 = 
	`˝u_to_À32
(
SAP_CONTROL_BLOCK_ID
);

301 
	}
}

303 
ssize_t
 
	$iwl_mei_wrôe_cy˛ic_buf
(
mei_˛_devi˚
 *
˛dev
,

304 
iwl_ßp_q_˘æ_blk
 *
nŸif_q
,

305 
u8
 *
q_hód
,

306 c⁄° 
iwl_ßp_hdr
 *
hdr
,

307 
u32
 
q_sz
)

309 
u32
 
rd
 = 
	`À32_to_˝u
(
	`READ_ONCE
(
nŸif_q
->
rd_±r
));

310 
u32
 
wr
 = 
	`À32_to_˝u
(
	`READ_ONCE
(
nŸif_q
->
wr_±r
));

311 
size_t
 
room_ö_buf
;

312 
size_t
 
tx_sz
 = (*
hdr
Ë+ 
	`À16_to_˝u
(hdr->
Àn
);

314 i‡(
rd
 > 
q_sz
 || 
wr
 > q_sz) {

315 
	`dev_îr
(&
˛dev
->
dev
,

317  -
EINVAL
;

320 
room_ö_buf
 = 
wr
 >
rd
 ? 
q_sz
 - wr +Ñd :Ñd - wr;

323 i‡(
room_ö_buf
 < 
tx_sz
) {

324 
	`dev_îr
(&
˛dev
->
dev
,

326  -
ENOSPC
;

329 i‡(
wr
 + 
tx_sz
 <
q_sz
) {

330 
	`mem˝y
(
q_hód
 + 
wr
, 
hdr
, 
tx_sz
);

332 
	`mem˝y
(
q_hód
 + 
wr
, 
hdr
, 
q_sz
 - wr);

333 
	`mem˝y
(
q_hód
, (c⁄° 
u8
 *)
hdr
 + 
q_sz
 - 
wr
, 
tx_sz
 - (q_sz - wr));

336 
	`WRITE_ONCE
(
nŸif_q
->
wr_±r
, 
	`˝u_to_À32
((
wr
 + 
tx_sz
Ë% 
q_sz
));

338 
	}
}

340 
boﬁ
 
	$iwl_mei_ho°_to_me_d©a_≥ndög
(c⁄° 
iwl_mei
 *
mei
)

342 
iwl_ßp_q_˘æ_blk
 *
nŸif_q
;

343 
iwl_ßp_dú
 *
dú
;

345 
dú
 = &
mei
->
sh¨ed_mem
.
˘æ
->dú[
SAP_DIRECTION_HOST_TO_ME
];

346 
nŸif_q
 = &
dú
->
q_˘æ_blk
[
SAP_QUEUE_IDX_DATA
];

348 i‡(
	`READ_ONCE
(
nŸif_q
->
wr_±r
Ë!READ_ONCE“Ÿif_q->
rd_±r
))

349  
åue
;

351 
nŸif_q
 = &
dú
->
q_˘æ_blk
[
SAP_QUEUE_IDX_NOTIF
];

352  
	`READ_ONCE
(
nŸif_q
->
wr_±r
Ë!READ_ONCE“Ÿif_q->
rd_±r
);

353 
	}
}

355 
	$iwl_mei_£nd_check_sh¨ed_¨ó
(
mei_˛_devi˚
 *
˛dev
)

357 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

358 
iwl_ßp_me_msg_°¨t
 
msg
 = {

359 .
hdr
.
ty≥
 = 
	`˝u_to_À32
(
SAP_ME_MSG_CHECK_SHARED_AREA
),

360 .
hdr
.
£q_num
 = 
	`˝u_to_À32
(
	`©omic_öc_ªtu∫
(&
mei
->
£q_no
)),

362 
ªt
;

364 
	`lockdï_as£π_hñd
(&
iwl_mei_muãx
);

366 i‡(
mei
->
cß_thrŸéed
)

369 
	`åa˚_iwlmei_me_msg
(&
msg
.
hdr
, 
åue
);

370 
ªt
 = 
	`mei_˛dev_£nd
(
˛dev
, (*)&
msg
, (msg));

371 i‡(
ªt
 !(
msg
)) {

372 
	`dev_îr
(&
˛dev
->
dev
,

374 
ªt
);

375  
ªt
;

378 
mei
->
cß_thrŸéed
 = 
åue
;

380 
	`scheduÀ_dñayed_w‹k
(&
mei
->
cß_thrŸée_íd_wk
,

381 
	`m£cs_to_jiffõs
(100));

384 
	}
}

386 
	$iwl_mei_cß_thrŸée_íd_wk
(
w‹k_°ru˘
 *
wk
)

388 
iwl_mei
 *
mei
 =

389 
	`c⁄èöî_of
(
wk
, 
iwl_mei
, 
cß_thrŸée_íd_wk
.
w‹k
);

391 
	`muãx_lock
(&
iwl_mei_muãx
);

393 
mei
->
cß_thrŸéed
 = 
Ál£
;

395 i‡(
	`iwl_mei_ho°_to_me_d©a_≥ndög
(
mei
))

396 
	`iwl_mei_£nd_check_sh¨ed_¨ó
(
mei
->
˛dev
);

398 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

399 
	}
}

401 
	$iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei_˛_devi˚
 *
˛dev
,

402 
iwl_ßp_hdr
 *
hdr
)

404 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

405 
iwl_ßp_q_˘æ_blk
 *
nŸif_q
;

406 
iwl_ßp_dú
 *
dú
;

407 *
q_hód
;

408 
u32
 
q_sz
;

409 
ªt
;

411 
	`lockdï_as£π_hñd
(&
iwl_mei_muãx
);

413 i‡(!
mei
->
sh¨ed_mem
.
˘æ
) {

414 
	`dev_îr
(&
˛dev
->
dev
,

416  -
EINVAL
;

419 i‡(!
	`iwl_mei_is_c⁄√˘ed
()) {

420 
	`dev_îr
(&
˛dev
->
dev
,

422  -
ENODEV
;

425 
hdr
->
£q_num
 = 
	`˝u_to_À32
(
	`©omic_öc_ªtu∫
(&
mei
->
ßp_£q_no
));

426 
	`dev_dbg
(&
˛dev
->
dev
, "Sídög %d\n", 
hdr
->
ty≥
);

428 
dú
 = &
mei
->
sh¨ed_mem
.
˘æ
->dú[
SAP_DIRECTION_HOST_TO_ME
];

429 
nŸif_q
 = &
dú
->
q_˘æ_blk
[
SAP_QUEUE_IDX_NOTIF
];

430 
q_hód
 = 
mei
->
sh¨ed_mem
.q_hód[
SAP_DIRECTION_HOST_TO_ME
][
SAP_QUEUE_IDX_NOTIF
];

431 
q_sz
 = 
mei
->
sh¨ed_mem
.
q_size
[
SAP_DIRECTION_HOST_TO_ME
][
SAP_QUEUE_IDX_NOTIF
];

432 
ªt
 = 
	`iwl_mei_wrôe_cy˛ic_buf
(
q_hód
, 
nŸif_q
, q_hód, 
hdr
, 
q_sz
);

434 i‡(
ªt
 < 0)

435  
ªt
;

437 
	`åa˚_iwlmei_ßp_cmd
(
hdr
, 
åue
);

439  
	`iwl_mei_£nd_check_sh¨ed_¨ó
(
˛dev
);

440 
	}
}

442 
	$iwl_mei_add_d©a_to_rög
(
sk_buff
 *
skb
, 
boﬁ
 
cb_tx
)

444 
iwl_ßp_q_˘æ_blk
 *
nŸif_q
;

445 
iwl_ßp_dú
 *
dú
;

446 
iwl_mei
 *
mei
;

447 
size_t
 
room_ö_buf
;

448 
size_t
 
tx_sz
;

449 
size_t
 
hdr_sz
;

450 
u32
 
q_sz
;

451 
u32
 
rd
;

452 
u32
 
wr
;

453 
u8
 *
q_hód
;

455 i‡(!
iwl_mei_globÆ_˛dev
)

458 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

467 
	`•ö_lock_bh
(&
mei
->
d©a_q_lock
);

469 i‡(!
	`iwl_mei_is_c⁄√˘ed
()) {

470 
	`•ö_u∆ock_bh
(&
mei
->
d©a_q_lock
);

479 
dú
 = &
mei
->
sh¨ed_mem
.
˘æ
->dú[
SAP_DIRECTION_HOST_TO_ME
];

480 
nŸif_q
 = &
dú
->
q_˘æ_blk
[
SAP_QUEUE_IDX_DATA
];

481 
q_hód
 = 
mei
->
sh¨ed_mem
.q_hód[
SAP_DIRECTION_HOST_TO_ME
][
SAP_QUEUE_IDX_DATA
];

482 
q_sz
 = 
mei
->
sh¨ed_mem
.
q_size
[
SAP_DIRECTION_HOST_TO_ME
][
SAP_QUEUE_IDX_DATA
];

484 
rd
 = 
	`À32_to_˝u
(
	`READ_ONCE
(
nŸif_q
->
rd_±r
));

485 
wr
 = 
	`À32_to_˝u
(
	`READ_ONCE
(
nŸif_q
->
wr_±r
));

486 
hdr_sz
 = 
cb_tx
 ? (
iwl_ßp_cb_d©a
) :

487 (
iwl_ßp_hdr
);

488 
tx_sz
 = 
skb
->
Àn
 + 
hdr_sz
;

490 i‡(
rd
 > 
q_sz
 || 
wr
 > q_sz) {

491 
	`dev_îr
(&
mei
->
˛dev
->
dev
,

493 
out
;

496 
room_ö_buf
 = 
wr
 >
rd
 ? 
q_sz
 - wr +Ñd :Ñd - wr;

499 i‡(
room_ö_buf
 < 
tx_sz
) {

500 
	`dev_îr
(&
mei
->
˛dev
->
dev
,

502 
out
;

505 i‡(
	`skb_hódroom
(
skb
Ë< 
hdr_sz
) {

506 
	`dev_îr
(&
mei
->
˛dev
->
dev
,

508 
out
;

511 i‡(
cb_tx
) {

512 
iwl_ßp_cb_d©a
 *
cb_hdr
 = 
	`skb_push
(
skb
, (*cb_hdr));

514 
	`mem£t
(
cb_hdr
, 0, (*cb_hdr));

515 
cb_hdr
->
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_CB_DATA_PACKET
);

516 
cb_hdr
->
hdr
.
Àn
 = 
	`˝u_to_À16
(
skb
->len - (cb_hdr->hdr));

517 
cb_hdr
->
hdr
.
£q_num
 = 
	`˝u_to_À32
(
	`©omic_öc_ªtu∫
(&
mei
->
ßp_£q_no
));

518 
cb_hdr
->
to_me_fût_°©us
 = 
	`˝u_to_À32
(
	`BIT
(
CB_TX_DHCP_FILT_IDX
));

519 
cb_hdr
->
d©a_Àn
 = 
	`˝u_to_À32
(
skb
->
Àn
 - (*cb_hdr));

520 
	`åa˚_iwlmei_ßp_d©a
(
skb
, 
IWL_SAP_TX_DHCP
);

522 
iwl_ßp_hdr
 *
hdr
 = 
	`skb_push
(
skb
, (*hdr));

524 
hdr
->
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_DATA_PACKET
);

525 
hdr
->
Àn
 = 
	`˝u_to_À16
(
skb
->len - (*hdr));

526 
hdr
->
£q_num
 = 
	`˝u_to_À32
(
	`©omic_öc_ªtu∫
(&
mei
->
ßp_£q_no
));

527 
	`åa˚_iwlmei_ßp_d©a
(
skb
, 
IWL_SAP_TX_DATA_FROM_AIR
);

530 i‡(
wr
 + 
tx_sz
 <
q_sz
) {

531 
	`skb_c›y_bôs
(
skb
, 0, 
q_hód
 + 
wr
, 
tx_sz
);

533 
	`skb_c›y_bôs
(
skb
, 0, 
q_hód
 + 
wr
, 
q_sz
 - wr);

534 
	`skb_c›y_bôs
(
skb
, 
q_sz
 - 
wr
, 
q_hód
, 
tx_sz
 - (q_sz - wr));

537 
	`WRITE_ONCE
(
nŸif_q
->
wr_±r
, 
	`˝u_to_À32
((
wr
 + 
tx_sz
Ë% 
q_sz
));

539 
out
:

540 
	`•ö_u∆ock_bh
(&
mei
->
d©a_q_lock
);

541 
	}
}

544 
	$iwl_mei_£nd_ßp_msg
(
mei_˛_devi˚
 *
˛dev
, 
u16
 
ty≥
)

546 
iwl_ßp_hdr
 
msg
 = {

547 .
ty≥
 = 
	`˝u_to_À16
(type),

550  
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
˛dev
, &
msg
);

551 
	}
}

553 
	$iwl_mei_£nd_cß_msg_wk
(
w‹k_°ru˘
 *
wk
)

555 
iwl_mei
 *
mei
 =

556 
	`c⁄èöî_of
(
wk
, 
iwl_mei
, 
£nd_cß_msg_wk
);

558 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

561 
	`muãx_lock
(&
iwl_mei_muãx
);

563 
	`iwl_mei_£nd_check_sh¨ed_¨ó
(
mei
->
˛dev
);

565 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

566 
	}
}

569 
rx_h™dÀr_ªsu…_t
 
	$iwl_mei_rx_h™dÀr
(
sk_buff
 **
pskb
)

571 
sk_buff
 *
skb
 = *
pskb
;

572 
iwl_mei
 *
mei
 =

573 
	`rcu_dîe„ªn˚
(
skb
->
dev
->
rx_h™dÀr_d©a
);

574 
iwl_mei_fûãrs
 *
fûãrs
 = 
	`rcu_dîe„ªn˚
(
mei
->filters);

575 
boﬁ
 
rx_f‹_csme
 = 
Ál£
;

576 
rx_h™dÀr_ªsu…_t
 
ªs
;

582 i‡(!
	`iwl_mei_is_c⁄√˘ed
()) {

583 
	`dev_îr
(&
mei
->
˛dev
->
dev
,

585  
RX_HANDLER_PASS
;

588 i‡(
fûãrs
)

589 
ªs
 = 
	`iwl_mei_rx_fûãr
(
skb
, &
fûãrs
->fûãrs, &
rx_f‹_csme
);

591 
ªs
 = 
RX_HANDLER_PASS
;

598 i‡(
rx_f‹_csme
)

599 
	`scheduÀ_w‹k
(&
mei
->
£nd_cß_msg_wk
);

601 i‡(
ªs
 !
RX_HANDLER_PASS
) {

602 
	`åa˚_iwlmei_ßp_d©a
(
skb
, 
IWL_SAP_RX_DATA_DROPPED_FROM_AIR
);

603 
	`dev_k‰ì_skb
(
skb
);

606  
ªs
;

607 
	}
}

609 
	$iwl_mei_√tdev_w‹k
(
w‹k_°ru˘
 *
wk
)

611 
iwl_mei
 *
mei
 =

612 
	`c⁄èöî_of
(
wk
, 
iwl_mei
, 
√tdev_w‹k
);

613 
√t_devi˚
 *
√tdev
;

619 
	`π∆_lock
();

620 
	`muãx_lock
(&
iwl_mei_muãx
);

622 
√tdev
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
iwl_mei_ˇche
.netdev,

623 
	`lockdï_is_hñd
(&
iwl_mei_muãx
));

624 i‡(
√tdev
) {

625 i‡(
mei
->
amt_íabÀd
)

626 
	`√tdev_rx_h™dÀr_ªgi°î
(
√tdev
, 
iwl_mei_rx_h™dÀr
,

627 
mei
);

629 
	`√tdev_rx_h™dÀr_uƒegi°î
(
√tdev
);

632 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

633 
	`π∆_u∆ock
();

634 
	}
}

637 
	$iwl_mei_h™dÀ_rx_°¨t_ok
(
mei_˛_devi˚
 *
˛dev
,

638 c⁄° 
iwl_ßp_me_msg_°¨t_ok
 *
r•
,

639 
ssize_t
 
Àn
)

641 i‡(
Àn
 !(*
r•
)) {

642 
	`dev_îr
(&
˛dev
->
dev
,

644 
	`dev_îr
(&
˛dev
->
dev
,

646 
Àn
, (*
r•
));

650 i‡(
r•
->
suµ‹ãd_vîsi⁄
 !
SAP_VERSION
) {

651 
	`dev_îr
(&
˛dev
->
dev
,

653 
r•
->
suµ‹ãd_vîsi⁄
);

657 
	`muãx_lock
(&
iwl_mei_muãx
);

658 
	`£t_bô
(
IWL_MEI_STATUS_SAP_CONNECTED
, &
iwl_mei_°©us
);

663 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

664 
	}
}

666 
	$iwl_mei_h™dÀ_csme_fûãrs
(
mei_˛_devi˚
 *
˛dev
,

667 c⁄° 
iwl_ßp_csme_fûãrs
 *
fûãrs
)

669 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

670 
iwl_mei_fûãrs
 *
√w_fûãrs
;

671 
iwl_mei_fûãrs
 *
ﬁd_fûãrs
;

673 
ﬁd_fûãrs
 =

674 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mei
->
fûãrs
,

675 
	`lockdï_is_hñd
(&
iwl_mei_muãx
));

677 
√w_fûãrs
 = 
	`kzÆloc
((*√w_fûãrs), 
GFP_KERNEL
);

678 i‡(!
√w_fûãrs
)

682 
√w_fûãrs
->
fûãrs
 = filters->filters;

684 
	`rcu_assign_poöãr
(
mei
->
fûãrs
, 
√w_fûãrs
);

686 i‡(
ﬁd_fûãrs
)

687 
	`k‰ì_rcu
(
ﬁd_fûãrs
, 
rcu_hód
);

688 
	}
}

691 
	$iwl_mei_h™dÀ_c⁄n_°©us
(
mei_˛_devi˚
 *
˛dev
,

692 c⁄° 
iwl_ßp_nŸif_c⁄n_°©us
 *
°©us
)

694 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

695 
iwl_mei_c⁄n_öfo
 
c⁄n_öfo
 = {

696 .
Õ_°©e
 = 
	`À32_to_˝u
(
°©us
->
lök_¥Ÿ_°©e
),

697 .
ssid_Àn
 = 
	`À32_to_˝u
(
°©us
->
c⁄n_öfo
.ssid_len),

698 .
ch™√l
 = 
°©us
->
c⁄n_öfo
.channel,

699 .
b™d
 = 
°©us
->
c⁄n_öfo
.band,

700 .
auth_mode
 = 
	`À32_to_˝u
(
°©us
->
c⁄n_öfo
.auth_mode),

701 .
∑úwi£_cùhî
 = 
	`À32_to_˝u
(
°©us
->
c⁄n_öfo
.pairwise_cipher),

704 i‡(!
iwl_mei_ˇche
.
›s
 ||

705 
c⁄n_öfo
.
ssid_Àn
 > 
	`ARRAY_SIZE
(c⁄n_öfo.
ssid
))

708 
	`mem˝y
(
c⁄n_öfo
.
ssid
, 
°©us
->c⁄n_öfo.ssid, c⁄n_öfo.
ssid_Àn
);

709 
	`ëhî_addr_c›y
(
c⁄n_öfo
.
bssid
, 
°©us
->conn_info.bssid);

711 
iwl_mei_ˇche
.
›s
->
	`me_c⁄n_°©us
(iwl_mei_ˇche.
¥iv
, &
c⁄n_öfo
);

713 
mei
->
lök_¥Ÿ_°©e
 = 
°©us
->link_prot_state;

722 i‡(
mei
->
gŸ_ow√rshù
)

723 
iwl_mei_ˇche
.
›s
->
	`rﬂmög_f‹biddí
(iwl_mei_ˇche.
¥iv
,

724 
°©us
->
lök_¥Ÿ_°©e
);

726 
iwl_mei_ˇche
.
›s
->
	`rfkûl
(iwl_mei_ˇche.
¥iv
,

727 
°©us
->
lök_¥Ÿ_°©e
, 
Ál£
);

728 
	}
}

730 
	$iwl_mei_£t_öô_c⁄f
(
iwl_mei
 *
mei
)

732 
iwl_ßp_nŸif_ho°_lök_up
 
lök_msg
 = {

733 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_HOST_LINK_UP
),

734 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
lök_msg
) - (link_msg.hdr)),

736 
iwl_ßp_nŸif_cou¡ry_code
 
mcc_msg
 = {

737 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_COUNTRY_CODE
),

738 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
mcc_msg
) - (mcc_msg.hdr)),

739 .
mcc
 = 
	`˝u_to_À16
(
iwl_mei_ˇche
.mcc),

741 
iwl_ßp_nŸif_ßr_limôs
 
ßr_msg
 = {

742 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_SAR_LIMITS
),

743 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
ßr_msg
) - (sar_msg.hdr)),

745 
iwl_ßp_nŸif_ho°_nic_öfo
 
nic_öfo_msg
 = {

746 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_NIC_INFO
),

747 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
nic_öfo_msg
) - (nic_info_msg.hdr)),

749 
iwl_ßp_msg_dw
 
rfkûl_msg
 = {

750 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_RADIO_STATE
),

751 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
rfkûl_msg
) - (rfkill_msg.hdr)),

752 .
vÆ
 = 
	`˝u_to_À32
(
iwl_mei_ˇche
.
rf_kûl
),

756 i‡(
iwl_mei_ˇche
.
›s
) {

757 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
,

758 
SAP_MSG_NOTIF_WIFIDR_UP
);

759 
iwl_mei_ˇche
.
›s
->
	`ßp_c⁄√˘ed
(iwl_mei_ˇche.
¥iv
);

762 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
, 
SAP_MSG_NOTIF_WHO_OWNS_NIC
);

764 i‡(
iwl_mei_ˇche
.
c⁄n_öfo
) {

765 
lök_msg
.
c⁄n_öfo
 = *
iwl_mei_ˇche
.conn_info;

766 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
lök_msg
.
hdr
);

769 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
mcc_msg
.
hdr
);

771 i‡(
iwl_mei_ˇche
.
powî_limô
) {

772 
	`mem˝y
(
ßr_msg
.
ßr_chaö_öfo_èbÀ
, 
iwl_mei_ˇche
.
powî_limô
,

773 (
ßr_msg
.
ßr_chaö_öfo_èbÀ
));

774 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
ßr_msg
.
hdr
);

777 i‡(
	`is_vÆid_ëhî_addr
(
iwl_mei_ˇche
.
mac_addªss
)) {

778 
	`ëhî_addr_c›y
(
nic_öfo_msg
.
mac_addªss
,

779 
iwl_mei_ˇche
.
mac_addªss
);

780 
	`ëhî_addr_c›y
(
nic_öfo_msg
.
nvm_addªss
,

781 
iwl_mei_ˇche
.
nvm_addªss
);

782 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
nic_öfo_msg
.
hdr
);

785 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
rfkûl_msg
.
hdr
);

786 
	}
}

788 
	$iwl_mei_h™dÀ_amt_°©e
(
mei_˛_devi˚
 *
˛dev
,

789 c⁄° 
iwl_ßp_msg_dw
 *
dw
)

791 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

793 
	`muãx_lock
(&
iwl_mei_muãx
);

795 i‡(
mei
->
amt_íabÀd
 =!!
	`À32_to_˝u
(
dw
->
vÆ
))

796 
out
;

798 
mei
->
amt_íabÀd
 = 
dw
->
vÆ
;

800 i‡(
mei
->
amt_íabÀd
)

801 
	`iwl_mei_£t_öô_c⁄f
(
mei
);

802 i‡(
iwl_mei_ˇche
.
›s
)

803 
iwl_mei_ˇche
.
›s
->
	`rfkûl
(iwl_mei_ˇche.
¥iv
, 
Ál£
, false);

805 
	`scheduÀ_w‹k
(&
mei
->
√tdev_w‹k
);

807 
out
:

808 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

809 
	}
}

811 
	$iwl_mei_h™dÀ_nic_ow√r
(
mei_˛_devi˚
 *
˛dev
,

812 c⁄° 
iwl_ßp_msg_dw
 *
dw
)

814 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

816 
mei
->
gŸ_ow√rshù
 = 
dw
->
vÆ
 !
	`˝u_to_À32
(
SAP_NIC_OWNER_ME
);

817 
	}
}

819 
	$iwl_mei_h™dÀ_ˇn_ªÀa£_ow√rshù
(
mei_˛_devi˚
 *
˛dev
,

820 c⁄° *
∑ylﬂd
)

823 i‡(
iwl_mei_ˇche
.
›s
)

824 
	`iwl_mei_£nd_ßp_msg
(
˛dev
,

825 
SAP_MSG_NOTIF_HOST_ASKS_FOR_NIC_OWNERSHIP
);

826 
	}
}

828 
	$iwl_mei_h™dÀ_csme_èkög_ow√rshù
(
mei_˛_devi˚
 *
˛dev
,

829 c⁄° *
∑ylﬂd
)

831 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

833 
	`dev_öfo
(&
˛dev
->
dev
, "CSMEÅakes ownership\n");

835 
mei
->
gŸ_ow√rshù
 = 
Ál£
;

837 i‡(
iwl_mei_ˇche
.
›s
 && !
mei
->
devi˚_down
) {

842 
mei
->
csme_èkög_ow√rshù
 = 
åue
;

844 
iwl_mei_ˇche
.
›s
->
	`rfkûl
(iwl_mei_ˇche.
¥iv
, 
åue
,Årue);

846 
	`iwl_mei_£nd_ßp_msg
(
˛dev
,

847 
SAP_MSG_NOTIF_CSME_OWNERSHIP_CONFIRMED
);

848 
	`scheduÀ_dñayed_w‹k
(&
mei
->
ow√rshù_dw‹k
,

849 
MEI_OWNERSHIP_RETAKE_TIMEOUT_MS
);

851 
	}
}

853 
	$iwl_mei_h™dÀ_nvm
(
mei_˛_devi˚
 *
˛dev
,

854 c⁄° 
iwl_ßp_nvm
 *
ßp_nvm
)

856 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

857 c⁄° 
iwl_mei_nvm
 *
mei_nvm
 = (c⁄° *)
ßp_nvm
;

858 
i
;

860 
	`k‰ì
(
mei
->
nvm
);

861 
mei
->
nvm
 = 
	`kzÆloc
((*
mei_nvm
), 
GFP_KERNEL
);

862 i‡(!
mei
->
nvm
)

865 
	`ëhî_addr_c›y
(
mei
->
nvm
->
hw_addr
, 
ßp_nvm
->hw_addr);

866 
mei
->
nvm
->
n_hw_addrs
 = 
ßp_nvm
->n_hw_addrs;

867 
mei
->
nvm
->
ødio_cfg
 = 
	`À32_to_˝u
(
ßp_nvm
->radio_cfg);

868 
mei
->
nvm
->
ˇps
 = 
	`À32_to_˝u
(
ßp_nvm
->caps);

869 
mei
->
nvm
->
nvm_vîsi⁄
 = 
	`À32_to_˝u
(
ßp_nvm
->nvm_version);

871 
i
 = 0; i < 
	`ARRAY_SIZE
(
mei
->
nvm
->
ch™√ls
); i++)

872 
mei
->
nvm
->
ch™√ls
[
i
] = 
	`À32_to_˝u
(
ßp_nvm
->channels[i]);

874 
	`wake_up_Æl
(&
mei
->
gë_nvm_wq
);

875 
	}
}

877 
	$iwl_mei_h™dÀ_rx_ho°_own_ªq
(
mei_˛_devi˚
 *
˛dev
,

878 c⁄° 
iwl_ßp_msg_dw
 *
dw
)

880 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

886 i‡(!
dw
->
vÆ
) {

887 
	`dev_öfo
(&
˛dev
->
dev
, "OwnershipÑeq denied\n");

891 
mei
->
gŸ_ow√rshù
 = 
åue
;

892 
	`wake_up_Æl
(&
mei
->
gë_ow√rshù_wq
);

894 
	`iwl_mei_£nd_ßp_msg
(
˛dev
,

895 
SAP_MSG_NOTIF_HOST_OWNERSHIP_CONFIRMED
);

898 i‡(
iwl_mei_ˇche
.
›s
)

899 
iwl_mei_ˇche
.
›s
->
	`rfkûl
(iwl_mei_ˇche.
¥iv
, 
Ál£
, false);

900 
	}
}

902 
	$iwl_mei_h™dÀ_∂dr_ack
(
mei_˛_devi˚
 *
˛dev
,

903 c⁄° 
iwl_ßp_∂dr_ack_d©a
 *
ack
)

905 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

907 
mei
->
∂dr_a˘ive
 = 
	`À32_to_˝u
(
ack
->
°©us
Ë=
SAP_PLDR_STATUS_SUCCESS
;

908 
	`wake_up_Æl
(&
mei
->
∂dr_wq
);

909 
	}
}

911 
	$iwl_mei_h™dÀ_pög
(
mei_˛_devi˚
 *
˛dev
,

912 c⁄° 
iwl_ßp_hdr
 *
hdr
)

914 
	`iwl_mei_£nd_ßp_msg
(
˛dev
, 
SAP_MSG_NOTIF_PONG
);

915 
	}
}

917 
	$iwl_mei_h™dÀ_ßp_msg
(
mei_˛_devi˚
 *
˛dev
,

918 c⁄° 
iwl_ßp_hdr
 *
hdr
)

920 
u16
 
Àn
 = 
	`À16_to_˝u
(
hdr
->len) + (*hdr);

921 
u16
 
ty≥
 = 
	`À16_to_˝u
(
hdr
->type);

923 
	`dev_dbg
(&
˛dev
->
dev
,

925 
	`À16_to_˝u
(
hdr
->
ty≥
), 
Àn
,

926 
	`À32_to_˝u
(
hdr
->
£q_num
));

928 
	#SAP_MSG_HANDLER
(
_cmd
, 
_h™dÀr
, 
_sz
) \

929 
SAP_MSG_NOTIF_
 ## 
_cmd
: \

930 i‡(
Àn
 < 
_sz
) { \

931 
	`dev_îr
(&
˛dev
->
dev
, \

933 
	`À16_to_˝u
(
hdr
->
ty≥
), \

934 ()
Àn
, \

935 ()
_sz
); \

938 
	`muãx_lock
(&
iwl_mei_muãx
); \

939 
	`_h™dÀr
(
˛dev
, (c⁄° *)
hdr
); \

940 
	`muãx_u∆ock
(&
iwl_mei_muãx
); \

941 

	)

943 
	#SAP_MSG_HANDLER_NO_LOCK
(
_cmd
, 
_h™dÀr
, 
_sz
) \

944 
SAP_MSG_NOTIF_
 ## 
_cmd
: \

945 i‡(
Àn
 < 
_sz
) { \

946 
	`dev_îr
(&
˛dev
->
dev
, \

948 
	`À16_to_˝u
(
hdr
->
ty≥
), \

949 ()
Àn
, \

950 ()
_sz
); \

953 
	`_h™dÀr
(
˛dev
, (c⁄° *)
hdr
); \

954 

	)

956 
	#SAP_MSG_HANDLER_NO_HANDLER
(
_cmd
, 
_sz
) \

957 
SAP_MSG_NOTIF_
 ## 
_cmd
: \

958 i‡(
Àn
 < 
_sz
) { \

959 
	`dev_îr
(&
˛dev
->
dev
, \

961 
	`À16_to_˝u
(
hdr
->
ty≥
), \

962 ()
Àn
, \

963 ()
_sz
); \

966 

	)

968 
ty≥
) {

969 
	`SAP_MSG_HANDLER
(
PING
, 
iwl_mei_h™dÀ_pög
, 0);

970 
	`SAP_MSG_HANDLER
(
CSME_FILTERS
,

971 
iwl_mei_h™dÀ_csme_fûãrs
,

972 (
iwl_ßp_csme_fûãrs
));

973 
	`SAP_MSG_HANDLER
(
CSME_CONN_STATUS
,

974 
iwl_mei_h™dÀ_c⁄n_°©us
,

975 (
iwl_ßp_nŸif_c⁄n_°©us
));

976 
	`SAP_MSG_HANDLER_NO_LOCK
(
AMT_STATE
,

977 
iwl_mei_h™dÀ_amt_°©e
,

978 (
iwl_ßp_msg_dw
));

979 
	`SAP_MSG_HANDLER_NO_HANDLER
(
PONG
, 0);

980 
	`SAP_MSG_HANDLER
(
NVM
, 
iwl_mei_h™dÀ_nvm
,

981 (
iwl_ßp_nvm
));

982 
	`SAP_MSG_HANDLER
(
CSME_REPLY_TO_HOST_OWNERSHIP_REQ
,

983 
iwl_mei_h™dÀ_rx_ho°_own_ªq
,

984 (
iwl_ßp_msg_dw
));

985 
	`SAP_MSG_HANDLER
(
NIC_OWNER
, 
iwl_mei_h™dÀ_nic_ow√r
,

986 (
iwl_ßp_msg_dw
));

987 
	`SAP_MSG_HANDLER
(
CSME_CAN_RELEASE_OWNERSHIP
,

988 
iwl_mei_h™dÀ_ˇn_ªÀa£_ow√rshù
, 0);

989 
	`SAP_MSG_HANDLER
(
CSME_TAKING_OWNERSHIP
,

990 
iwl_mei_h™dÀ_csme_èkög_ow√rshù
, 0);

991 
	`SAP_MSG_HANDLER
(
PLDR_ACK
, 
iwl_mei_h™dÀ_∂dr_ack
,

992 (
iwl_ßp_∂dr_ack_d©a
));

999 
	`dev_dbg
(&
˛dev
->
dev
, "Unsupported message:Åype %d,Üen %d\n",

1000 
	`À16_to_˝u
(
hdr
->
ty≥
), 
Àn
);

1003 #unde‡
SAP_MSG_HANDLER


1004 #unde‡
SAP_MSG_HANDLER_NO_LOCK


1005 
	}
}

1007 
	$iwl_mei_ªad_‰om_q
(c⁄° 
u8
 *
q_hód
, 
u32
 
q_sz
,

1008 
u32
 *
_rd
, u32 
wr
,

1009 *
_buf
, 
u32
 
Àn
)

1011 
u8
 *
buf
 = 
_buf
;

1012 
u32
 
rd
 = *
_rd
;

1014 i‡(
rd
 + 
Àn
 <
q_sz
) {

1015 
	`mem˝y
(
buf
, 
q_hód
 + 
rd
, 
Àn
);

1016 
rd
 +
Àn
;

1018 
	`mem˝y
(
buf
, 
q_hód
 + 
rd
, 
q_sz
 -Ñd);

1019 
	`mem˝y
(
buf
 + 
q_sz
 - 
rd
, 
q_hód
, 
Àn
 - (q_sz -Ñd));

1020 
rd
 = 
Àn
 - (
q_sz
 -Ñd);

1023 *
_rd
 = 
rd
;

1024 
	}
}

1026 
	#QOS_HDR_IV_SNAP_LEN
 ((
õì80211_qos_hdr
) + \

1027 
IEEE80211_TKIP_IV_LEN
 + \

1028 (
rfc1042_hódî
Ë+ 
ETH_TLEN
)

	)

1030 
	$iwl_mei_h™dÀ_ßp_d©a
(
mei_˛_devi˚
 *
˛dev
,

1031 c⁄° 
u8
 *
q_hód
, 
u32
 
q_sz
,

1032 
u32
 
rd
, u32 
wr
, 
ssize_t
 
vÆid_rx_sz
,

1033 
sk_buff_hód
 *
tx_skbs
)

1035 
iwl_ßp_hdr
 
hdr
;

1036 
√t_devi˚
 *
√tdev
 =

1037 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
iwl_mei_ˇche
.
√tdev
,

1038 
	`lockdï_is_hñd
(&
iwl_mei_muãx
));

1040 i‡(!
√tdev
)

1043 
vÆid_rx_sz
 >(
hdr
)) {

1044 
ëhhdr
 *ethhdr;

1045 *
d©a
;

1046 
sk_buff
 *
skb
;

1047 
u16
 
Àn
;

1049 
	`iwl_mei_ªad_‰om_q
(
q_hód
, 
q_sz
, &
rd
, 
wr
, &
hdr
, (hdr));

1050 
vÆid_rx_sz
 -(
hdr
);

1051 
Àn
 = 
	`À16_to_˝u
(
hdr
.len);

1053 i‡(
vÆid_rx_sz
 < 
Àn
) {

1054 
	`dev_îr
(&
˛dev
->
dev
,

1056 
vÆid_rx_sz
, 
Àn
);

1060 i‡(
Àn
 < (*
ëhhdr
)) {

1061 
	`dev_îr
(&
˛dev
->
dev
,

1063 
Àn
);

1066 
vÆid_rx_sz
 -
Àn
;

1068 i‡(
	`À16_to_˝u
(
hdr
.
ty≥
Ë!
SAP_MSG_DATA_PACKET
) {

1069 
	`dev_îr
(&
˛dev
->
dev
, "Unsupported Rx data:Åype %d,Üen %d\n",

1070 
	`À16_to_˝u
(
hdr
.
ty≥
), 
Àn
);

1075 
skb
 = 
	`√tdev_Æloc_skb
(
√tdev
, 
Àn
 + 
QOS_HDR_IV_SNAP_LEN
);

1076 i‡(!
skb
)

1079 
	`skb_ª£rve
(
skb
, 
QOS_HDR_IV_SNAP_LEN
);

1080 
ëhhdr
 = 
	`skb_push
(
skb
, (*ethhdr));

1082 
	`iwl_mei_ªad_‰om_q
(
q_hód
, 
q_sz
, &
rd
, 
wr
,

1083 
ëhhdr
, (*ethhdr));

1084 
Àn
 -(*
ëhhdr
);

1086 
	`skb_ª£t_mac_hódî
(
skb
);

1087 
	`skb_ª£t_√tw‹k_hódî
(
skb
);

1088 
skb
->
¥Ÿocﬁ
 = 
ëhhdr
->
h_¥Ÿo
;

1090 
d©a
 = 
	`skb_put
(
skb
, 
Àn
);

1091 
	`iwl_mei_ªad_‰om_q
(
q_hód
, 
q_sz
, &
rd
, 
wr
, 
d©a
, 
Àn
);

1100 
	`__skb_queue_èû
(
tx_skbs
, 
skb
);

1102 
	}
}

1104 
	$iwl_mei_h™dÀ_ßp_rx_cmd
(
mei_˛_devi˚
 *
˛dev
,

1105 c⁄° 
u8
 *
q_hód
, 
u32
 
q_sz
,

1106 
u32
 
rd
, u32 
wr
, 
ssize_t
 
vÆid_rx_sz
)

1108 
∑ge
 *
p
 = 
	`Æloc_∑ge
(
GFP_KERNEL
);

1109 
iwl_ßp_hdr
 *
hdr
;

1111 i‡(!
p
)

1114 
hdr
 = 
	`∑ge_addªss
(
p
);

1116 
vÆid_rx_sz
 >(*
hdr
)) {

1117 
u16
 
Àn
;

1119 
	`iwl_mei_ªad_‰om_q
(
q_hód
, 
q_sz
, &
rd
, 
wr
, 
hdr
, (*hdr));

1120 
vÆid_rx_sz
 -(*
hdr
);

1121 
Àn
 = 
	`À16_to_˝u
(
hdr
->len);

1123 i‡(
vÆid_rx_sz
 < 
Àn
)

1126 
	`iwl_mei_ªad_‰om_q
(
q_hód
, 
q_sz
, &
rd
, 
wr
, 
hdr
 + 1, 
Àn
);

1128 
	`åa˚_iwlmei_ßp_cmd
(
hdr
, 
Ál£
);

1129 
	`iwl_mei_h™dÀ_ßp_msg
(
˛dev
, 
hdr
);

1130 
vÆid_rx_sz
 -
Àn
;

1134 i‡(
vÆid_rx_sz
)

1135 
	`dev_îr
(&
˛dev
->
dev
,

1138 
	`__‰ì_∑ge
(
p
);

1139 
	}
}

1141 
	$iwl_mei_h™dÀ_ßp_rx
(
mei_˛_devi˚
 *
˛dev
,

1142 
iwl_ßp_q_˘æ_blk
 *
nŸif_q
,

1143 c⁄° 
u8
 *
q_hód
,

1144 
sk_buff_hód
 *
skbs
,

1145 
u32
 
q_sz
)

1147 
u32
 
rd
 = 
	`À32_to_˝u
(
	`READ_ONCE
(
nŸif_q
->
rd_±r
));

1148 
u32
 
wr
 = 
	`À32_to_˝u
(
	`READ_ONCE
(
nŸif_q
->
wr_±r
));

1149 
ssize_t
 
vÆid_rx_sz
;

1151 i‡(
rd
 > 
q_sz
 || 
wr
 > q_sz) {

1152 
	`dev_îr
(&
˛dev
->
dev
,

1157 i‡(
rd
 =
wr
)

1160 
vÆid_rx_sz
 = 
wr
 > 
rd
 ? w∏-Ñd : 
q_sz
 -Ñd + wr;

1162 i‡(
skbs
)

1163 
	`iwl_mei_h™dÀ_ßp_d©a
(
˛dev
, 
q_hód
, 
q_sz
, 
rd
, 
wr
,

1164 
vÆid_rx_sz
, 
skbs
);

1166 
	`iwl_mei_h™dÀ_ßp_rx_cmd
(
˛dev
, 
q_hód
, 
q_sz
, 
rd
, 
wr
,

1167 
vÆid_rx_sz
);

1170 
	`WRITE_ONCE
(
nŸif_q
->
rd_±r
, 
	`˝u_to_À32
(
wr
));

1171 
	}
}

1173 
	$iwl_mei_h™dÀ_check_sh¨ed_¨ó
(
mei_˛_devi˚
 *
˛dev
)

1175 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

1176 
iwl_ßp_q_˘æ_blk
 *
nŸif_q
;

1177 
sk_buff_hód
 
tx_skbs
;

1178 
iwl_ßp_dú
 *
dú
;

1179 *
q_hód
;

1180 
u32
 
q_sz
;

1182 i‡(!
mei
->
sh¨ed_mem
.
˘æ
)

1185 
dú
 = &
mei
->
sh¨ed_mem
.
˘æ
->dú[
SAP_DIRECTION_ME_TO_HOST
];

1186 
nŸif_q
 = &
dú
->
q_˘æ_blk
[
SAP_QUEUE_IDX_NOTIF
];

1187 
q_hód
 = 
mei
->
sh¨ed_mem
.q_hód[
SAP_DIRECTION_ME_TO_HOST
][
SAP_QUEUE_IDX_NOTIF
];

1188 
q_sz
 = 
mei
->
sh¨ed_mem
.
q_size
[
SAP_DIRECTION_ME_TO_HOST
][
SAP_QUEUE_IDX_NOTIF
];

1195 
	`iwl_mei_h™dÀ_ßp_rx
(
˛dev
, 
nŸif_q
, 
q_hód
, 
NULL
, 
q_sz
);

1197 
	`muãx_lock
(&
iwl_mei_muãx
);

1198 
dú
 = &
mei
->
sh¨ed_mem
.
˘æ
->dú[
SAP_DIRECTION_ME_TO_HOST
];

1199 
nŸif_q
 = &
dú
->
q_˘æ_blk
[
SAP_QUEUE_IDX_DATA
];

1200 
q_hód
 = 
mei
->
sh¨ed_mem
.q_hód[
SAP_DIRECTION_ME_TO_HOST
][
SAP_QUEUE_IDX_DATA
];

1201 
q_sz
 = 
mei
->
sh¨ed_mem
.
q_size
[
SAP_DIRECTION_ME_TO_HOST
][
SAP_QUEUE_IDX_DATA
];

1203 
	`__skb_queue_hód_öô
(&
tx_skbs
);

1205 
	`iwl_mei_h™dÀ_ßp_rx
(
˛dev
, 
nŸif_q
, 
q_hód
, &
tx_skbs
, 
q_sz
);

1207 i‡(
	`skb_queue_em±y
(&
tx_skbs
)) {

1208 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1219 
	`rcu_ªad_lock
();

1221 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1223 i‡(!
	`rcu_ac˚ss_poöãr
(
iwl_mei_ˇche
.
√tdev
)) {

1224 
	`dev_îr
(&
˛dev
->
dev
, "Can't Tx withoutáÇetdev\n");

1225 
	`skb_queue_purge
(&
tx_skbs
);

1226 
out
;

1229 !
	`skb_queue_em±y
(&
tx_skbs
)) {

1230 
sk_buff
 *
skb
 = 
	`__skb_dequeue
(&
tx_skbs
);

1232 
	`åa˚_iwlmei_ßp_d©a
(
skb
, 
IWL_SAP_RX_DATA_TO_AIR
);

1233 
	`dev_queue_xmô
(
skb
);

1236 
out
:

1237 
	`rcu_ªad_u∆ock
();

1238 
	}
}

1240 
	$iwl_mei_rx
(
mei_˛_devi˚
 *
˛dev
)

1242 
iwl_ßp_me_msg_hdr
 *
hdr
;

1243 
u8
 
msg
[100];

1244 
ssize_t
 
ªt
;

1246 
ªt
 = 
	`mei_˛dev_ªcv
(
˛dev
, (
u8
 *)&
msg
, (msg));

1247 i‡(
ªt
 < 0) {

1248 
	`dev_îr
(&
˛dev
->
dev
, "ÁûedÅÿª˚ivêd©a: %zd\n", 
ªt
);

1252 i‡(
ªt
 == 0) {

1253 
	`dev_îr
(&
˛dev
->
dev
, "gotánÉmptyÑesponse\n");

1257 
hdr
 = (*)
msg
;

1258 
	`åa˚_iwlmei_me_msg
(
hdr
, 
Ál£
);

1260 
	`À32_to_˝u
(
hdr
->
ty≥
)) {

1261 
SAP_ME_MSG_START_OK
:

1262 
	`BUILD_BUG_ON
((
iwl_ßp_me_msg_°¨t_ok
) >

1263 (
msg
));

1265 
	`iwl_mei_h™dÀ_rx_°¨t_ok
(
˛dev
, (*)
msg
, 
ªt
);

1267 
SAP_ME_MSG_CHECK_SHARED_AREA
:

1268 
	`iwl_mei_h™dÀ_check_sh¨ed_¨ó
(
˛dev
);

1271 
	`dev_îr
(&
˛dev
->
dev
, "gotá RXÇotification: %d\n",

1272 
	`À32_to_˝u
(
hdr
->
ty≥
));

1275 
	}
}

1277 
	$iwl_mei_£nd_°¨t
(
mei_˛_devi˚
 *
˛dev
)

1279 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

1280 
iwl_ßp_me_msg_°¨t
 
msg
 = {

1281 .
hdr
.
ty≥
 = 
	`˝u_to_À32
(
SAP_ME_MSG_START
),

1282 .
hdr
.
£q_num
 = 
	`˝u_to_À32
(
	`©omic_öc_ªtu∫
(&
mei
->
£q_no
)),

1283 .
hdr
.
Àn
 = 
	`˝u_to_À32
((
msg
)),

1284 .
suµ‹ãd_vîsi⁄s
[0] = 
SAP_VERSION
,

1285 .
öô_d©a_£q_num
 = 
	`˝u_to_À16
(0x100),

1286 .
öô_nŸif_£q_num
 = 
	`˝u_to_À16
(0x800),

1288 
ªt
;

1290 
	`åa˚_iwlmei_me_msg
(&
msg
.
hdr
, 
åue
);

1291 
ªt
 = 
	`mei_˛dev_£nd
(
˛dev
, (*)&
msg
, (msg));

1292 i‡(
ªt
 !(
msg
)) {

1293 
	`dev_îr
(&
˛dev
->
dev
,

1295 
ªt
);

1296  
ªt
;

1300 
	}
}

1302 
	$iwl_mei_íabÀ
(
mei_˛_devi˚
 *
˛dev
)

1304 
ªt
;

1306 
ªt
 = 
	`mei_˛dev_íabÀ
(
˛dev
);

1307 i‡(
ªt
 < 0) {

1308 
	`dev_îr
(&
˛dev
->
dev
, "ÁûedÅÿíabÀÅhêdevi˚: %d\n", 
ªt
);

1309  
ªt
;

1312 
ªt
 = 
	`mei_˛dev_ªgi°î_rx_cb
(
˛dev
, 
iwl_mei_rx
);

1313 i‡(
ªt
) {

1314 
	`dev_îr
(&
˛dev
->
dev
,

1315 "ÁûedÅÿªgi°îÅÿthêrx cb: %d\n", 
ªt
);

1316 
	`mei_˛dev_dißbÀ
(
˛dev
);

1317  
ªt
;

1321 
	}
}

1323 
iwl_mei_nvm
 *
	$iwl_mei_gë_nvm
()

1325 
iwl_mei_nvm
 *
nvm
 = 
NULL
;

1326 
iwl_mei
 *
mei
;

1327 
ªt
;

1329 
	`muãx_lock
(&
iwl_mei_muãx
);

1331 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1332 
out
;

1334 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1336 i‡(!
mei
)

1337 
out
;

1339 
ªt
 = 
	`iwl_mei_£nd_ßp_msg
(
iwl_mei_globÆ_˛dev
,

1340 
SAP_MSG_NOTIF_GET_NVM
);

1341 i‡(
ªt
)

1342 
out
;

1344 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1346 
ªt
 = 
	`waô_evít_timeout
(
mei
->
gë_nvm_wq
, mei->
nvm
, 2 * 
HZ
);

1347 i‡(!
ªt
)

1348  
NULL
;

1350 
	`muãx_lock
(&
iwl_mei_muãx
);

1352 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1353 
out
;

1355 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1357 i‡(!
mei
)

1358 
out
;

1360 i‡(
mei
->
nvm
)

1361 
nvm
 = 
	`kmemdup
(
mei
->nvm, (*mei->nvm), 
GFP_KERNEL
);

1363 
out
:

1364 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1365  
nvm
;

1366 
	}
}

1367 
EXPORT_SYMBOL_GPL
(
iwl_mei_gë_nvm
);

1369 
	#IWL_MEI_PLDR_NUM_RETRIES
 3

	)

1371 
	$iwl_mei_∂dr_ªq
()

1373 
iwl_mei
 *
mei
;

1374 
ªt
;

1375 
iwl_ßp_∂dr_d©a
 
msg
 = {

1376 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_PLDR
),

1377 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1379 
i
;

1381 
	`muãx_lock
(&
iwl_mei_muãx
);

1384 i‡(!
	`iwl_mei_is_c⁄√˘ed
()) {

1385 
ªt
 = 0;

1386 
out
;

1389 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1391 i‡(!
mei
) {

1392 
ªt
 = -
ENODEV
;

1393 
out
;

1396 i‡(!
mei
->
amt_íabÀd
) {

1397 
ªt
 = 0;

1398 
out
;

1401 
i
 = 0; i < 
IWL_MEI_PLDR_NUM_RETRIES
; i++) {

1402 
ªt
 = 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1403 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1404 i‡(
ªt
)

1405  
ªt
;

1407 
ªt
 = 
	`waô_evít_timeout
(
mei
->
∂dr_wq
, mei->
∂dr_a˘ive
, 
HZ
 / 2);

1408 i‡(
ªt
)

1412 
	`muãx_lock
(&
iwl_mei_muãx
);

1415 i‡(
ªt
)

1418 
ªt
 = -
ETIMEDOUT
;

1419 
out
:

1420 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1421  
ªt
;

1422 
	}
}

1423 
EXPORT_SYMBOL_GPL
(
iwl_mei_∂dr_ªq
);

1425 
	$iwl_mei_gë_ow√rshù
()

1427 
iwl_mei
 *
mei
;

1428 
ªt
;

1430 
	`muãx_lock
(&
iwl_mei_muãx
);

1433 i‡(!
	`iwl_mei_is_c⁄√˘ed
()) {

1434 
ªt
 = 0;

1435 
out
;

1438 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1440 i‡(!
mei
) {

1441 
ªt
 = -
ENODEV
;

1442 
out
;

1445 i‡(!
mei
->
amt_íabÀd
) {

1446 
ªt
 = 0;

1447 
out
;

1450 i‡(
mei
->
gŸ_ow√rshù
) {

1451 
ªt
 = 0;

1452 
out
;

1455 
ªt
 = 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
,

1456 
SAP_MSG_NOTIF_HOST_ASKS_FOR_NIC_OWNERSHIP
);

1457 i‡(
ªt
)

1458 
out
;

1460 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1462 
ªt
 = 
	`waô_evít_timeout
(
mei
->
gë_ow√rshù_wq
,

1463 
mei
->
gŸ_ow√rshù
, 
HZ
 / 2);

1464 i‡(!
ªt
) {

1465 
	`scheduÀ_dñayed_w‹k
(&
mei
->
ow√rshù_dw‹k
,

1466 
MEI_OWNERSHIP_RETAKE_TIMEOUT_MS
);

1467  -
ETIMEDOUT
;

1471 
out
:

1472 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1473  
ªt
;

1474 
	}
}

1475 
EXPORT_SYMBOL_GPL
(
iwl_mei_gë_ow√rshù
);

1477 
	$iwl_mei_Æive_nŸif
(
boﬁ
 
suc˚ss
)

1479 
iwl_mei
 *
mei
;

1480 
iwl_ßp_∂dr_íd_d©a
 
msg
 = {

1481 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_PLDR_END
),

1482 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1483 .
°©us
 = 
suc˚ss
 ? 
	`˝u_to_À32
(
SAP_PLDR_STATUS_SUCCESS
) :

1484 
	`˝u_to_À32
(
SAP_PLDR_STATUS_FAILURE
),

1487 
	`muãx_lock
(&
iwl_mei_muãx
);

1489 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1490 
out
;

1492 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1493 i‡(!
mei
 || !mei->
∂dr_a˘ive
)

1494 
out
;

1496 
mei
->
∂dr_a˘ive
 = 
Ál£
;

1498 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1499 
out
:

1500 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1501 
	}
}

1502 
EXPORT_SYMBOL_GPL
(
iwl_mei_Æive_nŸif
);

1504 
	$iwl_mei_ho°_assocüãd
(c⁄° 
iwl_mei_c⁄n_öfo
 *
c⁄n_öfo
,

1505 c⁄° 
iwl_mei_cﬁloc_öfo
 *
cﬁloc_öfo
)

1507 
iwl_ßp_nŸif_ho°_lök_up
 
msg
 = {

1508 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_HOST_LINK_UP
),

1509 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1510 .
c⁄n_öfo
 = {

1511 .
ssid_Àn
 = 
	`˝u_to_À32
(
c⁄n_öfo
->ssid_len),

1512 .
ch™√l
 = 
c⁄n_öfo
->channel,

1513 .
b™d
 = 
c⁄n_öfo
->band,

1514 .
∑úwi£_cùhî
 = 
	`˝u_to_À32
(
c⁄n_öfo
->pairwise_cipher),

1515 .
auth_mode
 = 
	`˝u_to_À32
(
c⁄n_öfo
->auth_mode),

1518 
iwl_mei
 *
mei
;

1520 i‡(
c⁄n_öfo
->
ssid_Àn
 > 
	`ARRAY_SIZE
(
msg
.c⁄n_öfo.
ssid
))

1523 
	`mem˝y
(
msg
.
c⁄n_öfo
.
ssid
, c⁄n_öfo->ssid, c⁄n_öfo->
ssid_Àn
);

1524 
	`mem˝y
(
msg
.
c⁄n_öfo
.
bssid
, c⁄n_öfo->bssid, 
ETH_ALEN
);

1526 i‡(
cﬁloc_öfo
) {

1527 
msg
.
cﬁloc_ch™√l
 = 
cﬁloc_öfo
->
ch™√l
;

1528 
msg
.
cﬁloc_b™d
 = 
cﬁloc_öfo
->
ch™√l
 <= 14 ? 0 : 1;

1529 
	`mem˝y
(
msg
.
cﬁloc_bssid
, 
cﬁloc_öfo
->
bssid
, 
ETH_ALEN
);

1532 
	`muãx_lock
(&
iwl_mei_muãx
);

1534 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1535 
out
;

1537 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1539 i‡(!
mei
 || !mei->
amt_íabÀd
)

1540 
out
;

1542 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1544 
out
:

1545 
	`k‰ì
(
iwl_mei_ˇche
.
c⁄n_öfo
);

1546 
iwl_mei_ˇche
.
c⁄n_öfo
 =

1547 
	`kmemdup
(&
msg
.
c⁄n_öfo
, (msg.c⁄n_öfo), 
GFP_KERNEL
);

1548 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1549 
	}
}

1550 
EXPORT_SYMBOL_GPL
(
iwl_mei_ho°_assocüãd
);

1552 
	$iwl_mei_ho°_dißssocüãd
()

1554 
iwl_mei
 *
mei
;

1555 
iwl_ßp_nŸif_ho°_lök_down
 
msg
 = {

1556 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_HOST_LINK_DOWN
),

1557 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1558 .
ty≥
 = 
HOST_LINK_DOWN_TYPE_TEMPORARY
,

1561 
	`muãx_lock
(&
iwl_mei_muãx
);

1563 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1564 
out
;

1566 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1568 i‡(!
mei
 || !mei->
amt_íabÀd
)

1569 
out
;

1571 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1573 
out
:

1574 
	`k‰ì
(
iwl_mei_ˇche
.
c⁄n_öfo
);

1575 
iwl_mei_ˇche
.
c⁄n_öfo
 = 
NULL
;

1576 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1577 
	}
}

1578 
EXPORT_SYMBOL_GPL
(
iwl_mei_ho°_dißssocüãd
);

1580 
	$iwl_mei_£t_rfkûl_°©e
(
boﬁ
 
hw_rfkûl
, boﬁ 
sw_rfkûl
)

1582 
iwl_mei
 *
mei
;

1583 
u32
 
rfkûl_°©e
 = 0;

1584 
iwl_ßp_msg_dw
 
msg
 = {

1585 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_RADIO_STATE
),

1586 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1589 i‡(!
sw_rfkûl
)

1590 
rfkûl_°©e
 |
SAP_SW_RFKILL_DEASSERTED
;

1592 i‡(!
hw_rfkûl
)

1593 
rfkûl_°©e
 |
SAP_HW_RFKILL_DEASSERTED
;

1595 
	`muãx_lock
(&
iwl_mei_muãx
);

1597 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1598 
out
;

1600 
msg
.
vÆ
 = 
	`˝u_to_À32
(
rfkûl_°©e
);

1602 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1604 i‡(!
mei
 || !mei->
amt_íabÀd
)

1605 
out
;

1607 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1609 
out
:

1610 
iwl_mei_ˇche
.
rf_kûl
 = 
rfkûl_°©e
;

1611 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1612 
	}
}

1613 
EXPORT_SYMBOL_GPL
(
iwl_mei_£t_rfkûl_°©e
);

1615 
	$iwl_mei_£t_nic_öfo
(c⁄° 
u8
 *
mac_addªss
, c⁄° u8 *
nvm_addªss
)

1617 
iwl_mei
 *
mei
;

1618 
iwl_ßp_nŸif_ho°_nic_öfo
 
msg
 = {

1619 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_NIC_INFO
),

1620 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1623 
	`muãx_lock
(&
iwl_mei_muãx
);

1625 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1626 
out
;

1628 
	`ëhî_addr_c›y
(
msg
.
mac_addªss
, mac_address);

1629 
	`ëhî_addr_c›y
(
msg
.
nvm_addªss
,Çvm_address);

1631 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1633 i‡(!
mei
 || !mei->
amt_íabÀd
)

1634 
out
;

1636 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1638 
out
:

1639 
	`ëhî_addr_c›y
(
iwl_mei_ˇche
.
mac_addªss
, mac_address);

1640 
	`ëhî_addr_c›y
(
iwl_mei_ˇche
.
nvm_addªss
,Çvm_address);

1641 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1642 
	}
}

1643 
EXPORT_SYMBOL_GPL
(
iwl_mei_£t_nic_öfo
);

1645 
	$iwl_mei_£t_cou¡ry_code
(
u16
 
mcc
)

1647 
iwl_mei
 *
mei
;

1648 
iwl_ßp_nŸif_cou¡ry_code
 
msg
 = {

1649 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_COUNTRY_CODE
),

1650 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1651 .
mcc
 = 
	`˝u_to_À16
(mcc),

1654 
	`muãx_lock
(&
iwl_mei_muãx
);

1656 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1657 
out
;

1659 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1661 i‡(!
mei
 || !mei->
amt_íabÀd
)

1662 
out
;

1664 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1666 
out
:

1667 
iwl_mei_ˇche
.
mcc
 = mcc;

1668 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1669 
	}
}

1670 
EXPORT_SYMBOL_GPL
(
iwl_mei_£t_cou¡ry_code
);

1672 
	$iwl_mei_£t_powî_limô
(c⁄° 
__À16
 *
powî_limô
)

1674 
iwl_mei
 *
mei
;

1675 
iwl_ßp_nŸif_ßr_limôs
 
msg
 = {

1676 .
hdr
.
ty≥
 = 
	`˝u_to_À16
(
SAP_MSG_NOTIF_SAR_LIMITS
),

1677 .
hdr
.
Àn
 = 
	`˝u_to_À16
((
msg
) - (msg.hdr)),

1680 
	`muãx_lock
(&
iwl_mei_muãx
);

1682 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1683 
out
;

1685 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1687 i‡(!
mei
 || !mei->
amt_íabÀd
)

1688 
out
;

1690 
	`mem˝y
(
msg
.
ßr_chaö_öfo_èbÀ
, 
powî_limô
, (msg.sar_chain_info_table));

1692 
	`iwl_mei_£nd_ßp_msg_∑ylﬂd
(
mei
->
˛dev
, &
msg
.
hdr
);

1694 
out
:

1695 
	`k‰ì
(
iwl_mei_ˇche
.
powî_limô
);

1696 
iwl_mei_ˇche
.
powî_limô
 = 
	`kmemdup
(power_limit,

1697 (
msg
.
ßr_chaö_öfo_èbÀ
), 
GFP_KERNEL
);

1698 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1699 
	}
}

1700 
EXPORT_SYMBOL_GPL
(
iwl_mei_£t_powî_limô
);

1702 
	$iwl_mei_£t_√tdev
(
√t_devi˚
 *
√tdev
)

1704 
iwl_mei
 *
mei
;

1706 
	`muãx_lock
(&
iwl_mei_muãx
);

1708 i‡(!
	`iwl_mei_is_c⁄√˘ed
()) {

1709 
	`rcu_assign_poöãr
(
iwl_mei_ˇche
.
√tdev
,Çetdev);

1710 
out
;

1713 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1715 i‡(!
mei
)

1716 
out
;

1718 i‡(!
√tdev
) {

1719 
√t_devi˚
 *
dev
 =

1720 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
iwl_mei_ˇche
.
√tdev
,

1721 
	`lockdï_is_hñd
(&
iwl_mei_muãx
));

1723 i‡(!
dev
)

1724 
out
;

1726 
	`√tdev_rx_h™dÀr_uƒegi°î
(
dev
);

1729 
	`rcu_assign_poöãr
(
iwl_mei_ˇche
.
√tdev
,Çetdev);

1731 i‡(
√tdev
 && 
mei
->
amt_íabÀd
)

1732 
	`√tdev_rx_h™dÀr_ªgi°î
(
√tdev
, 
iwl_mei_rx_h™dÀr
, 
mei
);

1734 
out
:

1735 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1736 
	}
}

1737 
EXPORT_SYMBOL_GPL
(
iwl_mei_£t_√tdev
);

1739 
	$iwl_mei_devi˚_°©e
(
boﬁ
 
up
)

1741 
iwl_mei
 *
mei
;

1743 
	`muãx_lock
(&
iwl_mei_muãx
);

1745 i‡(!
	`iwl_mei_is_c⁄√˘ed
())

1746 
out
;

1748 
mei
 = 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1750 i‡(!
mei
)

1751 
out
;

1753 
mei
->
devi˚_down
 = !
up
;

1755 i‡(
up
 || !
mei
->
csme_èkög_ow√rshù
)

1756 
out
;

1758 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
,

1759 
SAP_MSG_NOTIF_CSME_OWNERSHIP_CONFIRMED
);

1760 
mei
->
csme_èkög_ow√rshù
 = 
Ál£
;

1761 
	`scheduÀ_dñayed_w‹k
(&
mei
->
ow√rshù_dw‹k
,

1762 
MEI_OWNERSHIP_RETAKE_TIMEOUT_MS
);

1763 
out
:

1764 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1765 
	}
}

1766 
EXPORT_SYMBOL_GPL
(
iwl_mei_devi˚_°©e
);

1768 
	$iwl_mei_ªgi°î
(*
¥iv
, c⁄° 
iwl_mei_›s
 *
›s
)

1770 
ªt
;

1776 i‡(!
¥iv
)

1777  -
EINVAL
;

1779 
	`muãx_lock
(&
iwl_mei_muãx
);

1782 i‡(
iwl_mei_ˇche
.
¥iv
 || iwl_mei_ˇche.
›s
) {

1783 
ªt
 = -
EBUSY
;

1784 
out
;

1787 
iwl_mei_ˇche
.
¥iv
 =Öriv;

1788 
iwl_mei_ˇche
.
›s
 = ops;

1790 i‡(
iwl_mei_globÆ_˛dev
) {

1791 
iwl_mei
 *
mei
 =

1792 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1795 i‡(
	`iwl_mei_is_c⁄√˘ed
()) {

1796 i‡(
mei
->
amt_íabÀd
)

1797 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
,

1798 
SAP_MSG_NOTIF_WIFIDR_UP
);

1799 
›s
->
	`rfkûl
(
¥iv
, 
mei
->
lök_¥Ÿ_°©e
, 
Ál£
);

1802 
ªt
 = 0;

1804 
out
:

1805 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1806  
ªt
;

1807 
	}
}

1808 
EXPORT_SYMBOL_GPL
(
iwl_mei_ªgi°î
);

1810 
	$iwl_mei_°¨t_uƒegi°î
()

1812 
	`muãx_lock
(&
iwl_mei_muãx
);

1815 i‡(
	`rcu_ac˚ss_poöãr
(
iwl_mei_ˇche
.
√tdev
))

1816 
	`¥_îr
("Still hadáÇetdevÖointer set upon unregister\n");

1818 
	`k‰ì
(
iwl_mei_ˇche
.
c⁄n_öfo
);

1819 
iwl_mei_ˇche
.
c⁄n_öfo
 = 
NULL
;

1820 
	`k‰ì
(
iwl_mei_ˇche
.
powî_limô
);

1821 
iwl_mei_ˇche
.
powî_limô
 = 
NULL
;

1822 
iwl_mei_ˇche
.
›s
 = 
NULL
;

1825 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1826 
	}
}

1827 
EXPORT_SYMBOL_GPL
(
iwl_mei_°¨t_uƒegi°î
);

1829 
	$iwl_mei_uƒegi°î_com∂ëe
()

1831 
	`muãx_lock
(&
iwl_mei_muãx
);

1833 
iwl_mei_ˇche
.
¥iv
 = 
NULL
;

1835 i‡(
iwl_mei_globÆ_˛dev
) {

1836 
iwl_mei
 *
mei
 =

1837 
	`mei_˛dev_gë_drvd©a
(
iwl_mei_globÆ_˛dev
);

1839 i‡(
mei
->
amt_íabÀd
)

1840 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
,

1841 
SAP_MSG_NOTIF_WIFIDR_DOWN
);

1842 
mei
->
gŸ_ow√rshù
 = 
Ál£
;

1845 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1846 
	}
}

1847 
EXPORT_SYMBOL_GPL
(
iwl_mei_uƒegi°î_com∂ëe
);

1849 #i‡
IS_ENABLED
(
CONFIG_DEBUG_FS
)

1851 
ssize_t


1852 
	$iwl_mei_dbgfs_£nd_°¨t_mesßge_wrôe
(
fûe
 *file,

1853 c⁄° 
__u£r
 *
u£r_buf
,

1854 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1856 
ªt
;

1858 
	`muãx_lock
(&
iwl_mei_muãx
);

1860 i‡(!
iwl_mei_globÆ_˛dev
) {

1861 
ªt
 = -
ENODEV
;

1862 
out
;

1865 
ªt
 = 
	`iwl_mei_£nd_°¨t
(
iwl_mei_globÆ_˛dev
);

1867 
out
:

1868 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

1869  
ªt
 ?: 
cou¡
;

1870 
	}
}

1872 c⁄° 
fûe_›î©i⁄s
 
	giwl_mei_dbgfs_£nd_°¨t_mesßge_›s
 = {

1873 .
wrôe
 = 
iwl_mei_dbgfs_£nd_°¨t_mesßge_wrôe
,

1874 .
	g›í
 = 
sim∂e_›í
,

1875 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1878 
ssize_t
 
	$iwl_mei_dbgfs_ªq_ow√rshù_wrôe
(
fûe
 *file,

1879 c⁄° 
__u£r
 *
u£r_buf
,

1880 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1882 
	`iwl_mei_gë_ow√rshù
();

1884  
cou¡
;

1885 
	}
}

1887 c⁄° 
fûe_›î©i⁄s
 
	giwl_mei_dbgfs_ªq_ow√rshù_›s
 = {

1888 .
wrôe
 = 
iwl_mei_dbgfs_ªq_ow√rshù_wrôe
,

1889 .
	g›í
 = 
sim∂e_›í
,

1890 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1893 
	$iwl_mei_dbgfs_ªgi°î
(
iwl_mei
 *
mei
)

1895 
mei
->
dbgfs_dú
 = 
	`debugfs_¸óã_dú
(
KBUILD_MODNAME
, 
NULL
);

1897 i‡(!
mei
->
dbgfs_dú
)

1900 
	`debugfs_¸óã_ul⁄g
("°©us", 
S_IRUSR
,

1901 
mei
->
dbgfs_dú
, &
iwl_mei_°©us
);

1902 
	`debugfs_¸óã_fûe
("£nd_°¨t_mesßge", 
S_IWUSR
, 
mei
->
dbgfs_dú
,

1903 
mei
, &
iwl_mei_dbgfs_£nd_°¨t_mesßge_›s
);

1904 
	`debugfs_¸óã_fûe
("ªq_ow√rshù", 
S_IWUSR
, 
mei
->
dbgfs_dú
,

1905 
mei
, &
iwl_mei_dbgfs_ªq_ow√rshù_›s
);

1906 
	}
}

1908 
	$iwl_mei_dbgfs_uƒegi°î
(
iwl_mei
 *
mei
)

1910 
	`debugfs_ªmove_ªcursive
(
mei
->
dbgfs_dú
);

1911 
mei
->
dbgfs_dú
 = 
NULL
;

1912 
	}
}

1916 
	$iwl_mei_dbgfs_ªgi°î
(
iwl_mei
 *
mei
Ë{
	}
}

1917 
	$iwl_mei_dbgfs_uƒegi°î
(
iwl_mei
 *
mei
Ë{
	}
}

1921 
	$iwl_mei_ow√rshù_dw‹k
(
w‹k_°ru˘
 *
wk
)

1923 
	`iwl_mei_gë_ow√rshù
();

1924 
	}
}

1926 
	#ALLOC_SHARED_MEM_RETRY_MAX_NUM
 3

	)

1936 
	$iwl_mei_¥obe
(
mei_˛_devi˚
 *
˛dev
,

1937 c⁄° 
mei_˛_devi˚_id
 *
id
)

1939 
Æloc_ªåy
 = 
ALLOC_SHARED_MEM_RETRY_MAX_NUM
;

1940 
iwl_mei
 *
mei
;

1941 
ªt
;

1943 
mei
 = 
	`devm_kzÆloc
(&
˛dev
->
dev
, (*mei), 
GFP_KERNEL
);

1944 i‡(!
mei
)

1945  -
ENOMEM
;

1947 
	`öô_waôqueue_hód
(&
mei
->
gë_nvm_wq
);

1948 
	`INIT_WORK
(&
mei
->
£nd_cß_msg_wk
, 
iwl_mei_£nd_cß_msg_wk
);

1949 
	`INIT_DELAYED_WORK
(&
mei
->
cß_thrŸée_íd_wk
,

1950 
iwl_mei_cß_thrŸée_íd_wk
);

1951 
	`öô_waôqueue_hód
(&
mei
->
gë_ow√rshù_wq
);

1952 
	`öô_waôqueue_hód
(&
mei
->
∂dr_wq
);

1953 
	`•ö_lock_öô
(&
mei
->
d©a_q_lock
);

1954 
	`INIT_WORK
(&
mei
->
√tdev_w‹k
, 
iwl_mei_√tdev_w‹k
);

1955 
	`INIT_DELAYED_WORK
(&
mei
->
ow√rshù_dw‹k
, 
iwl_mei_ow√rshù_dw‹k
);

1957 
	`mei_˛dev_£t_drvd©a
(
˛dev
, 
mei
);

1958 
mei
->
˛dev
 = cldev;

1959 
mei
->
devi˚_down
 = 
åue
;

1962 
ªt
 = 
	`iwl_mei_Æloc_sh¨ed_mem
(
˛dev
);

1963 i‡(!
ªt
)

1974 
	`dev_dbg
(&
˛dev
->
dev
,

1976 
ªt
, 
Æloc_ªåy
, 
ALLOC_SHARED_MEM_RETRY_MAX_NUM
);

1977 
	`m¶ìp
(100);

1978 
Æloc_ªåy
--;

1979 } 
Æloc_ªåy
);

1981 i‡(
ªt
) {

1982 
	`dev_îr
(&
˛dev
->
dev
, "Couldn'tállocateÅhe shared memory: %d\n",

1983 
ªt
);

1984 
‰ì
;

1987 
	`iwl_mei_öô_sh¨ed_mem
(
mei
);

1989 
ªt
 = 
	`iwl_mei_íabÀ
(
˛dev
);

1990 i‡(
ªt
)

1991 
‰ì_sh¨ed_mem
;

1993 
	`iwl_mei_dbgfs_ªgi°î
(
mei
);

1999 
	`muãx_lock
(&
iwl_mei_muãx
);

2000 
ªt
 = 
	`iwl_mei_£nd_°¨t
(
˛dev
);

2001 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

2002 i‡(
ªt
)

2003 
debugfs_uƒegi°î
;

2006 
iwl_mei_globÆ_˛dev
 = 
˛dev
;

2010 
debugfs_uƒegi°î
:

2011 
	`iwl_mei_dbgfs_uƒegi°î
(
mei
);

2012 
	`mei_˛dev_dißbÀ
(
˛dev
);

2013 
‰ì_sh¨ed_mem
:

2014 
	`iwl_mei_‰ì_sh¨ed_mem
(
˛dev
);

2015 
‰ì
:

2016 
	`mei_˛dev_£t_drvd©a
(
˛dev
, 
NULL
);

2017 
	`devm_k‰ì
(&
˛dev
->
dev
, 
mei
);

2019  
ªt
;

2020 
	}
}

2022 
	#SEND_SAP_MAX_WAIT_ITERATION
 10

	)

2023 
	#IWLMEI_DEVICE_DOWN_WAIT_ITERATION
 50

	)

2025 
	$iwl_mei_ªmove
(
mei_˛_devi˚
 *
˛dev
)

2027 
iwl_mei
 *
mei
 = 
	`mei_˛dev_gë_drvd©a
(
˛dev
);

2028 
i
;

2034 i‡(
	`mei_˛dev_íabÀd
(
˛dev
Ë&& 
iwl_mei_ˇche
.
›s
) {

2035 
ôî
 = 
IWLMEI_DEVICE_DOWN_WAIT_ITERATION
;

2036 
boﬁ
 
down
 = 
Ál£
;

2043 !
down
 && 
ôî
--) {

2044 
	`mdñay
(1);

2046 
	`muãx_lock
(&
iwl_mei_muãx
);

2047 
down
 = 
mei
->
devi˚_down
;

2048 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

2051 i‡(!
down
)

2052 
iwl_mei_ˇche
.
›s
->
	`nic_°ﬁí
(iwl_mei_ˇche.
¥iv
);

2055 i‡(
	`rcu_ac˚ss_poöãr
(
iwl_mei_ˇche
.
√tdev
)) {

2056 
√t_devi˚
 *
dev
;

2062 
	`π∆_lock
();

2063 
	`muãx_lock
(&
iwl_mei_muãx
);

2069 
dev
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
iwl_mei_ˇche
.
√tdev
,

2070 
	`lockdï_is_hñd
(&
iwl_mei_muãx
));

2072 
	`√tdev_rx_h™dÀr_uƒegi°î
(
dev
);

2073 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

2074 
	`π∆_u∆ock
();

2077 
	`muãx_lock
(&
iwl_mei_muãx
);

2082 
mei
->
cß_thrŸéed
 = 
Ál£
;

2083 
	`iwl_mei_£nd_ßp_msg
(
mei
->
˛dev
,

2084 
SAP_MSG_NOTIF_HOST_GOES_DOWN
);

2086 
i
 = 0; i < 
SEND_SAP_MAX_WAIT_ITERATION
; i++) {

2087 i‡(!
	`iwl_mei_ho°_to_me_d©a_≥ndög
(
mei
))

2090 
	`m¶ìp
(20);

2098 i‡(
i
 =
SEND_SAP_MAX_WAIT_ITERATION
)

2099 
	`dev_îr
(&
mei
->
˛dev
->
dev
,

2102 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

2111 
	`•ö_lock_bh
(&
mei
->
d©a_q_lock
);

2112 
	`˛ór_bô
(
IWL_MEI_STATUS_SAP_CONNECTED
, &
iwl_mei_°©us
);

2113 
	`•ö_u∆ock_bh
(&
mei
->
d©a_q_lock
);

2115 i‡(
iwl_mei_ˇche
.
›s
)

2116 
iwl_mei_ˇche
.
›s
->
	`rfkûl
(iwl_mei_ˇche.
¥iv
, 
Ál£
, false);

2124 
	`mei_˛dev_dißbÀ
(
˛dev
);

2131 
	`ˇn˚l_w‹k_sync
(&
mei
->
£nd_cß_msg_wk
);

2132 
	`ˇn˚l_dñayed_w‹k_sync
(&
mei
->
cß_thrŸée_íd_wk
);

2133 
	`ˇn˚l_w‹k_sync
(&
mei
->
√tdev_w‹k
);

2134 
	`ˇn˚l_dñayed_w‹k_sync
(&
mei
->
ow√rshù_dw‹k
);

2141 
	`wake_up_Æl
(&
mei
->
gë_ow√rshù_wq
);

2142 
	`wake_up_Æl
(&
mei
->
∂dr_wq
);

2144 
	`muãx_lock
(&
iwl_mei_muãx
);

2146 
iwl_mei_globÆ_˛dev
 = 
NULL
;

2148 
	`wake_up_Æl
(&
mei
->
gë_nvm_wq
);

2150 
	`iwl_mei_‰ì_sh¨ed_mem
(
˛dev
);

2152 
	`iwl_mei_dbgfs_uƒegi°î
(
mei
);

2154 
	`mei_˛dev_£t_drvd©a
(
˛dev
, 
NULL
);

2156 
	`k‰ì
(
mei
->
nvm
);

2158 
	`k‰ì
(
	`rcu_ac˚ss_poöãr
(
mei
->
fûãrs
));

2160 
	`devm_k‰ì
(&
˛dev
->
dev
, 
mei
);

2162 
	`muãx_u∆ock
(&
iwl_mei_muãx
);

2163 
	}
}

2165 c⁄° 
mei_˛_devi˚_id
 
	giwl_mei_tbl
[] = {

2167 .
«me
 = 
KBUILD_MODNAME
,

2168 .
	guuid
 = 
MEI_WLAN_UUID
,

2169 .
	gvîsi⁄
 = 
MEI_CL_VERSION_ANY
,

2181 
mei_˛_drivî
 
	giwl_mei_˛_drivî
 = {

2182 .
id_èbÀ
 = 
iwl_mei_tbl
,

2183 .
	g«me
 = 
KBUILD_MODNAME
,

2184 .
	g¥obe
 = 
iwl_mei_¥obe
,

2185 .
	gªmove
 = 
iwl_mei_ªmove
,

2188 
moduÀ_mei_˛_drivî
(
iwl_mei_˛_drivî
);

	@mei/net.c

6 
	~<u≠i/löux/if_ëhî.h
>

7 
	~<u≠i/löux/if_¨p.h
>

8 
	~<u≠i/löux/icmp.h
>

10 
	~<löux/ëhîdevi˚.h
>

11 
	~<löux/√tdevi˚.h
>

12 
	~<löux/skbuff.h
>

13 
	~<löux/õì80211.h
>

15 
	~<√t/cfg80211.h
>

16 
	~<√t/ù.h
>

18 
	~<löux/if_¨p.h
>

19 
	~<löux/icmp.h
>

20 
	~<löux/udp.h
>

21 
	~<löux/ù.h
>

22 
	~<löux/mm.h
>

24 
	~"öã∫Æ.h
"

25 
	~"ßp.h
"

26 
	~"iwl-mei.h
"

33 
boﬁ
 
	$iwl_mei_rx_fûãr_ëh
(c⁄° 
ëhhdr
 *ethhdr,

34 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

35 
boﬁ
 *
∑ss_to_csme
,

36 
rx_h™dÀr_ªsu…_t
 *
rx_h™dÀr_ªs
)

38 c⁄° 
iwl_ßp_ëh_fûãr
 *
fût
;

41 i‡(!
	`is_mu…iˇ°_ëhî_addr
(
ëhhdr
->
h_de°
) ||

42 
	`is_brﬂdˇ°_ëhî_addr
(
ëhhdr
->
h_de°
))

43  
Ál£
;

45 
fût
 = &
fûãrs
->
ëh_fûãrs
[0];

46 
fût
 < &
fûãrs
->
ëh_fûãrs
[0] + 
	`ARRAY_SIZE
(filters->eth_filters);

47 
fût
++) {

49 i‡(!(
fût
->
Êags
 & 
SAP_ETH_FILTER_ENABLED
))

52 i‡(
	`com∑ª_ëhî_hódî
(
fût
->
mac_addªss
, 
ëhhdr
->
h_de°
))

56 i‡(
fût
->
Êags
 & 
SAP_ETH_FILTER_COPY
)

57 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

59 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_CONSUMED
;

62 i‡(
fût
->
Êags
 & 
SAP_ETH_FILTER_STOP
) {

63 *
∑ss_to_csme
 = 
åue
;

64  
åue
;

67  
Ál£
;

71 *
∑ss_to_csme
 = 
Ál£
;

73  
åue
;

74 
	}
}

80 
boﬁ
 
	$iwl_mei_rx_fûãr_¨p
(
sk_buff
 *
skb
,

81 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

82 
rx_h™dÀr_ªsu…_t
 *
rx_h™dÀr_ªs
)

84 c⁄° 
iwl_ßp_ùv4_fûãr
 *
fût
 = &
fûãrs
->
ùv4_fûãr
;

85 c⁄° 
¨phdr
 *
¨p
;

86 c⁄° 
__be32
 *
èrgë_ù
;

87 
u32
 
Êags
 = 
	`À32_to_˝u
(
fût
->flags);

89 i‡(!
	`pskb_may_puŒ
(
skb
, 
	`¨p_hdr_Àn
(skb->
dev
)))

90  
Ál£
;

92 
¨p
 = 
	`¨p_hdr
(
skb
);

95 i‡(
¨p
->
¨_hrd
 !
	`ht⁄s
(
ARPHRD_ETHER
) ||

96 
¨p
->
¨_¥o
 !
	`ht⁄s
(
ETH_P_IP
))

97  
Ál£
;

105 
èrgë_ù
 = (c⁄° *)((c⁄° 
u8
 *)(
¨p
 + 1) +

106 
ETH_ALEN
 + (
__be32
) + ETH_ALEN);

112 i‡(
¨p
->
¨_›
 =
	`ht⁄s
(
ARPOP_REQUEST
) &&

113 (
fût
->
Êags
 & 
	`˝u_to_À32
(
SAP_IPV4_FILTER_ARP_REQ_PASS
)) &&

114 (
fût
->
ùv4_addr
 =0 || fût->ùv4_add∏=*
èrgë_ù
)) {

115 i‡(
Êags
 & 
SAP_IPV4_FILTER_ARP_REQ_COPY
)

116 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

118 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_CONSUMED
;

120  
åue
;

124 i‡(
Êags
 & 
SAP_IPV4_FILTER_ARP_RESP_PASS
 &&

125 
¨p
->
¨_›
 =
	`ht⁄s
(
ARPOP_REPLY
)) {

126 i‡(
Êags
 & 
SAP_IPV4_FILTER_ARP_RESP_COPY
)

127 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

129 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_CONSUMED
;

131  
åue
;

134  
Ál£
;

135 
	}
}

137 
boﬁ


138 
	$iwl_mei_rx_fûãr_t˝_udp
(
sk_buff
 *
skb
, 
boﬁ
 
ù_m©ch
,

139 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

140 
rx_h™dÀr_ªsu…_t
 *
rx_h™dÀr_ªs
)

142 c⁄° 
iwl_ßp_Êex_fûãr
 *
fût
;

144 
fût
 = &
fûãrs
->
Êex_fûãrs
[0];

145 
fût
 < &
fûãrs
->
Êex_fûãrs
[0] + 
	`ARRAY_SIZE
(filters->flex_filters);

146 
fût
++) {

147 i‡(!(
fût
->
Êags
 & 
SAP_FLEX_FILTER_ENABLED
))

154 i‡((
fût
->
Êags
 &

155 (
SAP_FLEX_FILTER_IPV4
 | 
SAP_FLEX_FILTER_IPV6
)) &&

156 !
ù_m©ch
)

159 i‡((
fût
->
Êags
 & 
SAP_FLEX_FILTER_UDP
) &&

160 
	`ù_hdr
(
skb
)->
¥Ÿocﬁ
 !
IPPROTO_UDP
)

163 i‡((
fût
->
Êags
 & 
SAP_FLEX_FILTER_TCP
) &&

164 
	`ù_hdr
(
skb
)->
¥Ÿocﬁ
 !
IPPROTO_TCP
)

173 i‡((
fût
->
§c_p‹t
 && fût->§c_p‹à!
	`udp_hdr
(
skb
)->
sour˚
) ||

174 (
fût
->
d°_p‹t
 && fût->d°_p‹à!
	`udp_hdr
(
skb
)->
de°
))

177 i‡(
fût
->
Êags
 & 
SAP_FLEX_FILTER_COPY
)

178 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

180 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_CONSUMED
;

182  
åue
;

185  
Ál£
;

186 
	}
}

188 
boﬁ
 
	$iwl_mei_rx_fûãr_ùv4
(
sk_buff
 *
skb
,

189 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

190 
rx_h™dÀr_ªsu…_t
 *
rx_h™dÀr_ªs
)

192 c⁄° 
iwl_ßp_ùv4_fûãr
 *
fût
 = &
fûãrs
->
ùv4_fûãr
;

193 c⁄° 
ùhdr
 *iphdr;

194 
ùhdæí
;

195 
boﬁ
 
m©ch
;

197 i‡(!
	`pskb_may_puŒ
(
skb
, 
	`skb_√tw‹k_off£t
(skbË+ (*
ùhdr
)) ||

198 !
	`pskb_may_puŒ
(
skb
, 
	`skb_√tw‹k_off£t
(skbË+ 
	`ù_hdæí
(skb)))

199  
Ál£
;

201 
ùhdæí
 = 
	`ù_hdæí
(
skb
);

202 
ùhdr
 = 
	`ù_hdr
(
skb
);

203 
m©ch
 = !
fûãrs
->
ùv4_fûãr
.
ùv4_addr
 ||

204 
fûãrs
->
ùv4_fûãr
.
ùv4_addr
 =
ùhdr
->
daddr
;

206 
	`skb_£t_å™•‹t_hódî
(
skb
, 
	`skb_√tw‹k_off£t
(skbË+ 
ùhdæí
);

208 
	`ù_hdr
(
skb
)->
¥Ÿocﬁ
) {

209 
IPPROTO_UDP
:

210 
IPPROTO_TCP
:

216 i‡(!
	`pskb_may_puŒ
(
skb
, 
	`skb_å™•‹t_off£t
(skb) +

217 (
udphdr
)))

218  
Ál£
;

220  
	`iwl_mei_rx_fûãr_t˝_udp
(
skb
, 
m©ch
,

221 
fûãrs
, 
rx_h™dÀr_ªs
);

223 
IPPROTO_ICMP
: {

224 
icmphdr
 *
icmp
;

226 i‡(!
	`pskb_may_puŒ
(
skb
, 
	`skb_å™•‹t_off£t
(skbË+ (*
icmp
)))

227  
Ál£
;

229 
icmp
 = 
	`icmp_hdr
(
skb
);

235 i‡((
fût
->
Êags
 & 
	`˝u_to_À32
(
SAP_IPV4_FILTER_ICMP_PASS
)) &&

236 
m©ch
 && (
icmp
->
ty≥
 !
ICMP_ECHO
 || icmp->
code
 != 0)) {

237 i‡(
fût
->
Êags
 & 
	`˝u_to_À32
(
SAP_IPV4_FILTER_ICMP_COPY
))

238 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

240 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_CONSUMED
;

242  
åue
;

246 
IPPROTO_ICMPV6
:

248 i‡((
fûãrs
->
icmpv6_Êags
 & 
	`˝u_to_À32
(
SAP_ICMPV6_FILTER_ENABLED
) &&

249 
m©ch
)) {

250 i‡(
fûãrs
->
icmpv6_Êags
 &

251 
	`˝u_to_À32
(
SAP_ICMPV6_FILTER_COPY
))

252 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

254 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_CONSUMED
;

256  
åue
;

260  
Ál£
;

263  
Ál£
;

264 
	}
}

266 
boﬁ
 
	$iwl_mei_rx_fûãr_ùv6
(
sk_buff
 *
skb
,

267 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

268 
rx_h™dÀr_ªsu…_t
 *
rx_h™dÀr_ªs
)

270 *
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

274  
Ál£
;

275 
	}
}

277 
rx_h™dÀr_ªsu…_t


278 
	$iwl_mei_rx_∑ss_to_csme
(
sk_buff
 *
skb
,

279 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

280 
boﬁ
 *
∑ss_to_csme
)

282 c⁄° 
ëhhdr
 *ëhhd∏(*)
	`skb_mac_hódî
(
skb
);

283 
rx_h™dÀr_ªsu…_t
 
rx_h™dÀr_ªs
 = 
RX_HANDLER_PASS
;

284 
	`boﬁ
 (*
fût_h™dÀr
)(
sk_buff
 *
skb
,

285 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

286 
rx_h™dÀr_ªsu…_t
 *
rx_h™dÀr_ªs
);

292 
	`skb_ª£t_√tw‹k_hódî
(
skb
);

298 i‡(!
	`skb_mac_off£t
(
skb
))

299  
RX_HANDLER_PASS
;

301 i‡(
	`skb_hódroom
(
skb
Ë< (*
ëhhdr
))

302  
RX_HANDLER_PASS
;

304 i‡(
	`iwl_mei_rx_fûãr_ëh
(
ëhhdr
, 
fûãrs
,

305 
∑ss_to_csme
, &
rx_h™dÀr_ªs
))

306  
rx_h™dÀr_ªs
;

308 
skb
->
¥Ÿocﬁ
) {

309 
	`ht⁄s
(
ETH_P_IP
):

310 
fût_h™dÀr
 = 
iwl_mei_rx_fûãr_ùv4
;

312 
	`ht⁄s
(
ETH_P_ARP
):

313 
fût_h™dÀr
 = 
iwl_mei_rx_fûãr_¨p
;

315 
	`ht⁄s
(
ETH_P_IPV6
):

316 
fût_h™dÀr
 = 
iwl_mei_rx_fûãr_ùv6
;

319 *
∑ss_to_csme
 = 
Ál£
;

320  
rx_h™dÀr_ªs
;

323 *
∑ss_to_csme
 = 
	`fût_h™dÀr
(
skb
, 
fûãrs
, &
rx_h™dÀr_ªs
);

325  
rx_h™dÀr_ªs
;

326 
	}
}

328 
rx_h™dÀr_ªsu…_t
 
	$iwl_mei_rx_fûãr
(
sk_buff
 *
‹ig_skb
,

329 c⁄° 
iwl_ßp_oob_fûãrs
 *
fûãrs
,

330 
boﬁ
 *
∑ss_to_csme
)

332 
rx_h™dÀr_ªsu…_t
 
ªt
;

333 
sk_buff
 *
skb
;

335 
ªt
 = 
	`iwl_mei_rx_∑ss_to_csme
(
‹ig_skb
, 
fûãrs
, 
∑ss_to_csme
);

337 i‡(!*
∑ss_to_csme
)

338  
RX_HANDLER_PASS
;

340 i‡(
ªt
 =
RX_HANDLER_PASS
) {

341 
skb
 = 
	`skb_c›y
(
‹ig_skb
, 
GFP_ATOMIC
);

343 i‡(!
skb
)

344  
RX_HANDLER_PASS
;

346 
skb
 = 
‹ig_skb
;

350 
	`skb_push
(
skb
, skb->
d©a
 - 
	`skb_mac_hódî
(skb));

357 
	`iwl_mei_add_d©a_to_rög
(
skb
, 
Ál£
);

363 i‡(
ªt
 =
RX_HANDLER_PASS
)

364 
	`dev_k‰ì_skb
(
skb
);

366  
ªt
;

367 
	}
}

369 
	#DHCP_SERVER_PORT
 67

	)

370 
	#DHCP_CLIENT_PORT
 68

	)

371 
	$iwl_mei_tx_c›y_to_csme
(
sk_buff
 *
‹igskb
, 
ivÀn
)

373 
õì80211_hdr
 *
hdr
;

374 
sk_buff
 *
skb
;

375 
ëhhdr
Éthhdr;

376 
ëhhdr
 *
ëh
;

379 i‡(
‹igskb
->
¥Ÿocﬁ
 !
	`ht⁄s
(
ETH_P_IP
) ||

380 
	`ù_hdr
(
‹igskb
)->
¥Ÿocﬁ
 !
IPPROTO_UDP
 ||

381 
	`udp_hdr
(
‹igskb
)->
sour˚
 !
	`ht⁄s
(
DHCP_CLIENT_PORT
) ||

382 
	`udp_hdr
(
‹igskb
)->
de°
 !
	`ht⁄s
(
DHCP_SERVER_PORT
))

389 
skb
 = 
	`skb_c›y
(
‹igskb
, 
GFP_ATOMIC
);

390 i‡(!
skb
)

393 
skb
->
¥Ÿocﬁ
 = 
‹igskb
->protocol;

395 
hdr
 = (*)
skb
->
d©a
;

397 
	`mem˝y
(
ëhhdr
.
h_de°
, 
	`õì80211_gë_DA
(
hdr
), 
ETH_ALEN
);

398 
	`mem˝y
(
ëhhdr
.
h_sour˚
, 
	`õì80211_gë_SA
(
hdr
), 
ETH_ALEN
);

404 
	`pskb_puŒ
(
skb
, 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
Ë+ 
ivÀn
 + 6);

405 
ëh
 = 
	`skb_push
(
skb
, (
ëhhdr
.
h_de°
Ë+ ”thhdr.
h_sour˚
));

406 
	`mem˝y
(
ëh
, &
ëhhdr
, ”thhdr.
h_de°
Ë+ ”thhdr.
h_sour˚
));

408 
	`iwl_mei_add_d©a_to_rög
(
skb
, 
åue
);

410 
	`dev_k‰ì_skb
(
skb
);

411 
	}
}

412 
EXPORT_SYMBOL_GPL
(
iwl_mei_tx_c›y_to_csme
);

	@mei/sap.h

6 #i‚de‡
__ßp_h__


7 
	#__ßp_h__


	)

9 
	~"mei/iwl-mei.h
"

129 
	eiwl_ßp_me_msg_id
 {

130 
	mSAP_ME_MSG_START
 = 1,

131 
	mSAP_ME_MSG_START_OK
,

132 
	mSAP_ME_MSG_CHECK_SHARED_AREA
,

141 
	siwl_ßp_me_msg_hdr
 {

142 
__À32
 
	mty≥
;

143 
__À32
 
	m£q_num
;

144 
__À32
 
	mÀn
;

145 } 
	g__∑cked
;

159 
	siwl_ßp_me_msg_°¨t
 {

160 
iwl_ßp_me_msg_hdr
 
	mhdr
;

161 
__À64
 
	msh¨ed_mem
;

162 
__À16
 
	möô_d©a_£q_num
;

163 
__À16
 
	möô_nŸif_£q_num
;

164 
u8
 
	msuµ‹ãd_vîsi⁄s
[64];

165 } 
	g__∑cked
;

178 
	siwl_ßp_me_msg_°¨t_ok
 {

179 
iwl_ßp_me_msg_hdr
 
	mhdr
;

180 
__À16
 
	möô_d©a_£q_num
;

181 
__À16
 
	möô_nŸif_£q_num
;

182 
u8
 
	msuµ‹ãd_vîsi⁄
;

183 
u8
 
	mª£rved
[3];

184 } 
	g__∑cked
;

243 
	eiwl_ßp_msg
 {

244 
	mSAP_MSG_NOTIF_BOTH_WAYS_MIN
 = 0,

245 
	mSAP_MSG_NOTIF_PING
 = 1,

246 
	mSAP_MSG_NOTIF_PONG
 = 2,

247 
	mSAP_MSG_NOTIF_BOTH_WAYS_MAX
,

249 
	mSAP_MSG_NOTIF_FROM_CSME_MIN
 = 500,

250 
	mSAP_MSG_NOTIF_CSME_FILTERS
 = 
SAP_MSG_NOTIF_FROM_CSME_MIN
,

252 
	mSAP_MSG_NOTIF_AMT_STATE
 = 502,

253 
	mSAP_MSG_NOTIF_CSME_REPLY_TO_HOST_OWNERSHIP_REQ
 = 503,

254 
	mSAP_MSG_NOTIF_CSME_TAKING_OWNERSHIP
 = 504,

255 
	mSAP_MSG_NOTIF_TRIGGER_IP_REFRESH
 = 505,

256 
	mSAP_MSG_NOTIF_CSME_CAN_RELEASE_OWNERSHIP
 = 506,

261 
	mSAP_MSG_NOTIF_NIC_OWNER
 = 511,

262 
	mSAP_MSG_NOTIF_CSME_CONN_STATUS
 = 512,

263 
	mSAP_MSG_NOTIF_NVM
 = 513,

265 
	mSAP_MSG_NOTIF_PLDR_ACK
 = 518,

266 
	mSAP_MSG_NOTIF_FROM_CSME_MAX
,

268 
	mSAP_MSG_NOTIF_FROM_HOST_MIN
 = 1000,

269 
	mSAP_MSG_NOTIF_BAND_SELECTION
 = 
SAP_MSG_NOTIF_FROM_HOST_MIN
,

270 
	mSAP_MSG_NOTIF_RADIO_STATE
 = 1001,

271 
	mSAP_MSG_NOTIF_NIC_INFO
 = 1002,

272 
	mSAP_MSG_NOTIF_HOST_ASKS_FOR_NIC_OWNERSHIP
 = 1003,

273 
	mSAP_MSG_NOTIF_HOST_SUSPENDS
 = 1004,

274 
	mSAP_MSG_NOTIF_HOST_RESUMES
 = 1005,

275 
	mSAP_MSG_NOTIF_HOST_GOES_DOWN
 = 1006,

276 
	mSAP_MSG_NOTIF_CSME_OWNERSHIP_CONFIRMED
 = 1007,

277 
	mSAP_MSG_NOTIF_COUNTRY_CODE
 = 1008,

278 
	mSAP_MSG_NOTIF_HOST_LINK_UP
 = 1009,

279 
	mSAP_MSG_NOTIF_HOST_LINK_DOWN
 = 1010,

280 
	mSAP_MSG_NOTIF_WHO_OWNS_NIC
 = 1011,

281 
	mSAP_MSG_NOTIF_WIFIDR_DOWN
 = 1012,

282 
	mSAP_MSG_NOTIF_WIFIDR_UP
 = 1013,

284 
	mSAP_MSG_NOTIF_HOST_OWNERSHIP_CONFIRMED
 = 1015,

285 
	mSAP_MSG_NOTIF_SAR_LIMITS
 = 1016,

286 
	mSAP_MSG_NOTIF_GET_NVM
 = 1017,

288 
	mSAP_MSG_NOTIF_PLDR
 = 1024,

289 
	mSAP_MSG_NOTIF_PLDR_END
 = 1025,

290 
	mSAP_MSG_NOTIF_FROM_HOST_MAX
,

292 
	mSAP_MSG_DATA_MIN
 = 2000,

293 
	mSAP_MSG_DATA_PACKET
 = 
SAP_MSG_DATA_MIN
,

294 
	mSAP_MSG_CB_DATA_PACKET
 = 2001,

295 
	mSAP_MSG_DATA_MAX
,

305 
	siwl_ßp_hdr
 {

306 
__À16
 
	mty≥
;

307 
__À16
 
	mÀn
;

308 
__À32
 
	m£q_num
;

309 
u8
 
	m∑ylﬂd
[];

317 
	siwl_ßp_msg_dw
 {

318 
iwl_ßp_hdr
 
	mhdr
;

319 
__À32
 
	mvÆ
;

328 
	eiwl_ßp_nic_ow√r
 {

329 
	mSAP_NIC_OWNER_UNKNOWN
,

330 
	mSAP_NIC_OWNER_HOST
,

331 
	mSAP_NIC_OWNER_ME
,

334 
	eiwl_ßp_wifi_auth_ty≥
 {

335 
	mSAP_WIFI_AUTH_TYPE_OPEN
 = 
IWL_MEI_AKM_AUTH_OPEN
,

336 
	mSAP_WIFI_AUTH_TYPE_RSNA
 = 
IWL_MEI_AKM_AUTH_RSNA
,

337 
	mSAP_WIFI_AUTH_TYPE_RSNA_PSK
 = 
IWL_MEI_AKM_AUTH_RSNA_PSK
,

338 
	mSAP_WIFI_AUTH_TYPE_SAE
 = 
IWL_MEI_AKM_AUTH_SAE
,

339 
	mSAP_WIFI_AUTH_TYPE_MAX
,

350 
	eiwl_ßp_wifi_cùhî_Æg
 {

351 
	mSAP_WIFI_CIPHER_ALG_NONE
 = 
IWL_MEI_CIPHER_NONE
,

352 
	mSAP_WIFI_CIPHER_ALG_TKIP
 = 
IWL_MEI_CIPHER_TKIP
,

353 
	mSAP_WIFI_CIPHER_ALG_CCMP
 = 
IWL_MEI_CIPHER_CCMP
,

354 
	mSAP_WIFI_CIPHER_ALG_GCMP
 = 
IWL_MEI_CIPHER_GCMP
,

355 
	mSAP_WIFI_CIPHER_ALG_GCMP_256
 = 
IWL_MEI_CIPHER_GCMP_256
,

371 
	siwl_ßp_nŸif_c⁄√˘i⁄_öfo
 {

372 
__À32
 
	mssid_Àn
;

373 
u8
 
	mssid
[32];

374 
__À32
 
	mauth_mode
;

375 
__À32
 
	m∑úwi£_cùhî
;

376 
u8
 
	mch™√l
;

377 
u8
 
	mb™d
;

378 
__À16
 
	mª£rved
;

379 
u8
 
	mbssid
[6];

380 
__À16
 
	mª£rved1
;

381 } 
	g__∑cked
;

388 
	eiwl_ßp_sˇn_ªque°
 {

389 
	mSCAN_REQUEST_FILTERING
 = 1 << 0,

390 
	mSCAN_REQUEST_FAST
 = 1 << 1,

400 
	siwl_ßp_nŸif_c⁄n_°©us
 {

401 
iwl_ßp_hdr
 
	mhdr
;

402 
__À32
 
	mlök_¥Ÿ_°©e
;

403 
__À32
 
	msˇn_ªque°
;

404 
iwl_ßp_nŸif_c⁄√˘i⁄_öfo
 
	mc⁄n_öfo
;

405 } 
	g__∑cked
;

414 
	eiwl_ßp_ødio_°©e_bôm≠
 {

415 
	mSAP_SW_RFKILL_DEASSERTED
 = 1 << 0,

416 
	mSAP_HW_RFKILL_DEASSERTED
 = 1 << 1,

427 
	eiwl_ßp_nŸif_ho°_su•íds_bôm≠
 {

428 
	mSAP_OFFER_NIC
 = 1 << 0,

429 
	mSAP_FILTER_CONFIGURED
 = 1 << 1,

430 
	mSAP_NLO_CONFIGURED
 = 1 << 2,

431 
	mSAP_HOST_OWNS_NIC
 = 1 << 3,

432 
	mSAP_LINK_PROTECTED
 = 1 << 4,

443 
	siwl_ßp_nŸif_cou¡ry_code
 {

444 
iwl_ßp_hdr
 
	mhdr
;

445 
__À16
 
	mmcc
;

446 
u8
 
	msour˚_id
;

447 
u8
 
	mª£rved
;

448 
__À32
 
	mdiff_time
;

449 } 
	g__∑cked
;

461 
	siwl_ßp_nŸif_ho°_lök_up
 {

462 
iwl_ßp_hdr
 
	mhdr
;

463 
iwl_ßp_nŸif_c⁄√˘i⁄_öfo
 
	mc⁄n_öfo
;

464 
u8
 
	mcﬁloc_ch™√l
;

465 
u8
 
	mcﬁloc_b™d
;

466 
__À16
 
	mª£rved
;

467 
u8
 
	mcﬁloc_bssid
[6];

468 
__À16
 
	mª£rved1
;

469 } 
	g__∑cked
;

477 
	eiwl_ßp_nŸif_lök_down_ty≥
 {

478 
	mHOST_LINK_DOWN_TYPE_NONE
,

479 
	mHOST_LINK_DOWN_TYPE_TEMPORARY
,

480 
	mHOST_LINK_DOWN_TYPE_LONG
,

491 
	siwl_ßp_nŸif_ho°_lök_down
 {

492 
iwl_ßp_hdr
 
	mhdr
;

493 
u8
 
	mty≥
;

494 
u8
 
	mª£rved
[2];

495 
u8
 
	mªas⁄_vÆid
;

496 
__À32
 
	mªas⁄
;

497 } 
	g__∑cked
;

505 
	siwl_ßp_nŸif_ho°_nic_öfo
 {

506 
iwl_ßp_hdr
 
	mhdr
;

507 
u8
 
	mmac_addªss
[6];

508 
u8
 
	mnvm_addªss
[6];

509 } 
	g__∑cked
;

516 
	siwl_ßp_nŸif_dw
 {

517 
iwl_ßp_hdr
 
	mhdr
;

518 
__À32
 
	mdw
;

519 } 
	g__∑cked
;

526 
	siwl_ßp_nŸif_ßr_limôs
 {

527 
iwl_ßp_hdr
 
	mhdr
;

528 
__À16
 
	mßr_chaö_öfo_èbÀ
[2][5];

529 } 
	g__∑cked
;

536 
	eiwl_ßp_nvm_ˇps
 {

537 
	mSAP_NVM_CAPS_LARI_SUPPORT
 = 
BIT
(0),

538 
	mSAP_NVM_CAPS_11AX_SUPPORT
 = 
BIT
(1),

552 
	siwl_ßp_nvm
 {

553 
iwl_ßp_hdr
 
	mhdr
;

554 
u8
 
	mhw_addr
[6];

555 
u8
 
	mn_hw_addrs
;

556 
u8
 
	mª£rved
;

557 
__À32
 
	mødio_cfg
;

558 
__À32
 
	mˇps
;

559 
__À32
 
	mnvm_vîsi⁄
;

560 
__À32
 
	mch™√ls
[110];

561 } 
	g__∑cked
;

569 
	eiwl_ßp_ëh_fûãr_Êags
 {

570 
	mSAP_ETH_FILTER_STOP
 = 
BIT
(0),

571 
	mSAP_ETH_FILTER_COPY
 = 
BIT
(1),

572 
	mSAP_ETH_FILTER_ENABLED
 = 
BIT
(2),

580 
	siwl_ßp_ëh_fûãr
 {

581 
u8
 
	mmac_addªss
[6];

582 
u8
 
	mÊags
;

583 } 
	g__∑cked
;

594 
	eiwl_ßp_Êex_fûãr_Êags
 {

595 
	mSAP_FLEX_FILTER_COPY
 = 
BIT
(0),

596 
	mSAP_FLEX_FILTER_ENABLED
 = 
BIT
(1),

597 
	mSAP_FLEX_FILTER_IPV6
 = 
BIT
(2),

598 
	mSAP_FLEX_FILTER_IPV4
 = 
BIT
(3),

599 
	mSAP_FLEX_FILTER_TCP
 = 
BIT
(4),

600 
	mSAP_FLEX_FILTER_UDP
 = 
BIT
(5),

610 
	siwl_ßp_Êex_fûãr
 {

611 
__be16
 
	m§c_p‹t
;

612 
__be16
 
	md°_p‹t
;

613 
u8
 
	mÊags
;

614 
u8
 
	mª£rved
;

615 } 
	g__∑cked
;

626 
	eiwl_ßp_ùv4_fûãr_Êags
 {

627 
	mSAP_IPV4_FILTER_ICMP_PASS
 = 
BIT
(0),

628 
	mSAP_IPV4_FILTER_ICMP_COPY
 = 
BIT
(1),

629 
	mSAP_IPV4_FILTER_ARP_REQ_PASS
 = 
BIT
(2),

630 
	mSAP_IPV4_FILTER_ARP_REQ_COPY
 = 
BIT
(3),

631 
	mSAP_IPV4_FILTER_ARP_RESP_PASS
 = 
BIT
(4),

632 
	mSAP_IPV4_FILTER_ARP_RESP_COPY
 = 
BIT
(5),

640 
	siwl_ßp_ùv4_fûãr
 {

641 
__be32
 
	mùv4_addr
;

642 
__À32
 
	mÊags
;

643 } 
	g__∑cked
;

650 
	eiwl_ßp_ùv6_fûãr_Êags
 {

651 
	mSAP_IPV6_ADDR_FILTER_COPY
 = 
BIT
(0),

652 
	mSAP_IPV6_ADDR_FILTER_ENABLED
 = 
BIT
(1),

660 
	siwl_ßp_ùv6_fûãr
 {

661 
u8
 
	maddr_lo24
[3];

662 
u8
 
	mÊags
;

663 } 
	g__∑cked
;

670 
	eiwl_ßp_icmpv6_fûãr_Êags
 {

671 
	mSAP_ICMPV6_FILTER_ENABLED
 = 
BIT
(0),

672 
	mSAP_ICMPV6_FILTER_COPY
 = 
BIT
(1),

680 
	eiwl_ßp_vœn_fûãr_Êags
 {

681 
	mSAP_VLAN_FILTER_VLAN_ID_MSK
 = 0x0FFF,

682 
	mSAP_VLAN_FILTER_ENABLED
 = 
BIT
(15),

695 
	siwl_ßp_oob_fûãrs
 {

696 
iwl_ßp_Êex_fûãr
 
	mÊex_fûãrs
[14];

697 
__À32
 
	micmpv6_Êags
;

698 
iwl_ßp_ùv6_fûãr
 
	mùv6_fûãrs
[4];

699 
iwl_ßp_ëh_fûãr
 
	mëh_fûãrs
[5];

700 
u8
 
	mª£rved
;

701 
iwl_ßp_ùv4_fûãr
 
	mùv4_fûãr
;

702 
__À16
 
	mvœn
[4];

703 } 
	g__∑cked
;

714 
	siwl_ßp_csme_fûãrs
 {

715 
iwl_ßp_hdr
 
	mhdr
;

716 
__À32
 
	mmode
;

717 
u8
 
	mmac_addªss
[6];

718 
__À16
 
	mª£rved
;

719 
u8
 
	mcbfûãrs
[1728];

720 
iwl_ßp_oob_fûãrs
 
	mfûãrs
;

721 } 
	g__∑cked
;

723 
	#CB_TX_DHCP_FILT_IDX
 30

	)

734 
	siwl_ßp_cb_d©a
 {

735 
iwl_ßp_hdr
 
	mhdr
;

736 
__À32
 
	mª£rved
[7];

737 
__À32
 
	mto_me_fût_°©us
;

738 
__À32
 
	mª£rved2
;

739 
__À32
 
	md©a_Àn
;

740 
u8
 
	m∑ylﬂd
[];

748 
	siwl_ßp_∂dr_d©a
 {

749 
iwl_ßp_hdr
 
	mhdr
;

750 
__À32
 
	mvîsi⁄
;

751 } 
	g__∑cked
;

758 
	eiwl_ßp_∂dr_°©us
 {

759 
	mSAP_PLDR_STATUS_SUCCESS
 = 0,

760 
	mSAP_PLDR_STATUS_FAILURE
 = 1,

769 
	siwl_ßp_∂dr_íd_d©a
 {

770 
iwl_ßp_hdr
 
	mhdr
;

771 
__À32
 
	mvîsi⁄
;

772 
__À32
 
	m°©us
;

773 } 
	g__∑cked
;

780 
	siwl_ßp_∂dr_ack_d©a
 {

781 
iwl_ßp_hdr
 
	mhdr
;

782 
__À32
 
	mvîsi⁄
;

783 
__À32
 
	m°©us
;

784 } 
	g__∑cked
;

	@mei/trace-data.h

6 #i‡!
deföed
(
CONFIG_IWLWIFI_DEVICE_TRACING
)

8 
	#åa˚_iwlmei_ßp_d©a
(...)

	)

12 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_IWLWIFI_SAP_DATA
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

14 #i‚de‡
__IWLWIFI_DEVICE_TRACE_IWLWIFI_SAP_DATA


15 
	eiwl_ßp_d©a_åa˚_ty≥
 {

16 
	mIWL_SAP_RX_DATA_TO_AIR
,

17 
	mIWL_SAP_TX_DATA_FROM_AIR
,

18 
	mIWL_SAP_RX_DATA_DROPPED_FROM_AIR
,

19 
	mIWL_SAP_TX_DHCP
,

22 
ölöe
 
size_t


23 
	$iwlmei_ßp_d©a_off£t
(
iwl_ßp_d©a_åa˚_ty≥
 
åa˚_ty≥
)

25 
åa˚_ty≥
) {

26 
IWL_SAP_RX_DATA_TO_AIR
:

28 
IWL_SAP_TX_DATA_FROM_AIR
:

29 
IWL_SAP_RX_DATA_DROPPED_FROM_AIR
:

30  (
iwl_ßp_hdr
);

31 
IWL_SAP_TX_DHCP
:

32  (
iwl_ßp_cb_d©a
);

34 
	`WARN_ON_ONCE
(1);

38 
	}
}

41 
	#__IWLWIFI_DEVICE_TRACE_IWLWIFI_SAP_DATA


	)

43 
	~<löux/åa˚poöt.h
>

44 
	~<löux/skbuff.h
>

45 
	~"ßp.h
"

47 #unde‡
TRACE_SYSTEM


48 
	#TRACE_SYSTEM
 
iwlmei_ßp_d©a


	)

50 
TRACE_EVENT
(
iwlmei_ßp_d©a
,

51 
TP_PROTO
(c⁄° 
sk_buff
 *
skb
,

52 
iwl_ßp_d©a_åa˚_ty≥
 
åa˚_ty≥
),

53 
TP_ARGS
(
skb
, 
åa˚_ty≥
),

54 
TP_STRUCT__íåy
(

55 
__dy«mic_¨øy
(
u8
, 
d©a
,

56 
skb
->
Àn
 - 
	$iwlmei_ßp_d©a_off£t
(
åa˚_ty≥
))

57 
	`__fõld
(
u32
, 
åa˚_ty≥
)

59 
	`TP_Á°_assign
(

60 
size_t
 
off£t
 = 
	`iwlmei_ßp_d©a_off£t
(
åa˚_ty≥
);

61 
__íåy
->
åa˚_ty≥
 =Årace_type;

62 
	`skb_c›y_bôs
(
skb
, 
off£t
, 
	`__gë_dy«mic_¨øy
(
d©a
),

63 
skb
->
Àn
 - 
off£t
);

65 
	`TP_¥ötk
("sap_data:trace_type %dÜen %d",

66 
__íåy
->
åa˚_ty≥
, 
	`__gë_dy«mic_¨øy_Àn
(
d©a
))

76 #unde‡
TRACE_INCLUDE_PATH


77 
	#TRACE_INCLUDE_PATH
 .

	)

78 #unde‡
TRACE_INCLUDE_FILE


79 
	#TRACE_INCLUDE_FILE
 
åa˚
-
d©a


	)

80 
	~<åa˚/deföe_åa˚.h
>

	@mei/trace.c

6 
	~<löux/moduÀ.h
>

9 #i‚de‡
__CHECKER__


11 
	#CREATE_TRACE_POINTS


	)

12 
	~"åa˚.h
"

13 
	~"åa˚-d©a.h
"

	@mei/trace.h

6 #i‡!
deföed
(
CONFIG_IWLWIFI_DEVICE_TRACING
)

8 
	#åa˚_iwlmei_ßp_cmd
(...)

	)

9 
	#åa˚_iwlmei_me_msg
(...)

	)

13 #i‡!
deföed
(
__IWLWIFI_DEVICE_TRACE_IWLWIFI_SAP_CMD
Ë|| deföed(
TRACE_HEADER_MULTI_READ
)

14 
	#__IWLWIFI_DEVICE_TRACE_IWLWIFI_SAP_CMD


	)

16 
	~<löux/åa˚poöt.h
>

18 #unde‡
TRACE_SYSTEM


19 
	#TRACE_SYSTEM
 
iwlmei_ßp_cmd


	)

21 
	~"mei/ßp.h
"

23 
TRACE_EVENT
(
iwlmei_ßp_cmd
,

24 
TP_PROTO
(c⁄° 
iwl_ßp_hdr
 *
ßp_cmd
, 
boﬁ
 
tx
),

25 
TP_ARGS
(
ßp_cmd
, 
tx
),

26 
TP_STRUCT__íåy
(

27 
__dy«mic_¨øy
(
u8
, 
cmd
,

28 
À16_to_˝u
(
ßp_cmd
->
Àn
) + (*sap_cmd))

29 
	$__fõld
(
u8
, 
tx
)

30 
	$__fõld
(
u16
, 
ty≥
)

31 
	$__fõld
(
u16
, 
Àn
)

32 
	`__fõld
(
u32
, 
£q
)

34 
	`TP_Á°_assign
(

35 
	`mem˝y
(
	`__gë_dy«mic_¨øy
(
cmd
), 
ßp_cmd
,

36 
	`À16_to_˝u
(
ßp_cmd
->
Àn
) + (*sap_cmd));

37 
__íåy
->
tx
 =Åx;

38 
__íåy
->
ty≥
 = 
	`À16_to_˝u
(
ßp_cmd
->type);

39 
__íåy
->
Àn
 = 
	`À16_to_˝u
(
ßp_cmd
->len);

40 
__íåy
->
£q
 = 
	`À32_to_˝u
(
ßp_cmd
->
£q_num
);

42 
	`TP_¥ötk
("ßp_cmd %s:Åy≥ %dÜí %d seq %d", 
__íåy
->
tx
 ? "Tx" : "Rx",

43 
__íåy
->
ty≥
, __íåy->
Àn
, __íåy->
£q
)

46 
	`TRACE_EVENT
(
iwlmei_me_msg
,

47 
	`TP_PROTO
(c⁄° 
iwl_ßp_me_msg_hdr
 *
hdr
, 
boﬁ
 
tx
),

48 
	`TP_ARGS
(
hdr
, 
tx
),

49 
	`TP_STRUCT__íåy
(

50 
	$__fõld
(
u8
, 
ty≥
)

51 
	$__fõld
(
u8
, 
tx
)

52 
	`__fõld
(
u32
, 
£q_num
)

54 
	`TP_Á°_assign
(

55 
__íåy
->
ty≥
 = 
	`À32_to_˝u
(
hdr
->type);

56 
__íåy
->
£q_num
 = 
	`À32_to_˝u
(
hdr
->seq_num);

57 
__íåy
->
tx
 =Åx;

59 
	`TP_¥ötk
("ME mesßge: %s:Åy≥ %d seq %d", 
__íåy
->
tx
 ? "Tx" : "Rx",

60 
__íåy
->
ty≥
, __íåy->
£q_num
)

70 #unde‡
TRACE_INCLUDE_PATH


71 
	#TRACE_INCLUDE_PATH
 .

	)

72 #unde‡
TRACE_INCLUDE_FILE


73 
	#TRACE_INCLUDE_FILE
 
åa˚


	)

74 
	~<åa˚/deföe_åa˚.h
>

	@mvm/binding.c

7 
	~<√t/mac80211.h
>

8 
	~"fw-≠i.h
"

9 
	~"mvm.h
"

11 
	siwl_mvm_iÁ˚_ôî©‹_d©a
 {

12 
õì80211_vif
 *
	mign‹e_vif
;

13 
	midx
;

15 
iwl_mvm_phy_˘xt
 *
	mphy˘xt
;

17 
u16
 
	mids
[
MAX_MACS_IN_BINDING
];

18 
u16
 
	mcﬁ‹s
[
MAX_MACS_IN_BINDING
];

21 
	$iwl_mvm_bödög_cmd
(
iwl_mvm
 *
mvm
, 
u32
 
a˘i⁄
,

22 
iwl_mvm_iÁ˚_ôî©‹_d©a
 *
d©a
)

24 
iwl_bödög_cmd
 
cmd
;

25 
iwl_mvm_phy_˘xt
 *
phy˘xt
 = 
d©a
->phyctxt;

26 
i
, 
ªt
;

27 
u32
 
°©us
;

28 
size
;

30 
	`mem£t
(&
cmd
, 0, (cmd));

32 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

33 
IWL_UCODE_TLV_CAPA_BINDING_CDB_SUPPORT
)) {

34 
size
 = (
cmd
);

35 
cmd
.
lmac_id
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_lmac_id
(
mvm
,

36 
phy˘xt
->
ch™√l
->
b™d
));

38 
size
 = 
IWL_BINDING_CMD_SIZE_V1
;

41 
cmd
.
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
phy˘xt
->
id
,

42 
phy˘xt
->
cﬁ‹
));

43 
cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(action);

44 
cmd
.
phy
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
phy˘xt
->
id
,

45 
phy˘xt
->
cﬁ‹
));

47 
i
 = 0; i < 
MAX_MACS_IN_BINDING
; i++)

48 
cmd
.
macs
[
i
] = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

49 
i
 = 0; i < 
d©a
->
idx
; i++)

50 
cmd
.
macs
[
i
] = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
d©a
->
ids
[i],

51 
d©a
->
cﬁ‹s
[
i
]));

53 
°©us
 = 0;

54 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
BINDING_CONTEXT_CMD
,

55 
size
, &
cmd
, &
°©us
);

56 i‡(
ªt
) {

57 
	`IWL_ERR
(
mvm
, "FailedÅo send binding (action:%d): %d\n",

58 
a˘i⁄
, 
ªt
);

59  
ªt
;

62 i‡(
°©us
) {

63 
	`IWL_ERR
(
mvm
, "Bödög comm™d faûed: %u\n", 
°©us
);

64 
ªt
 = -
EIO
;

67  
ªt
;

68 
	}
}

70 
	$iwl_mvm_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

71 
õì80211_vif
 *
vif
)

73 
iwl_mvm_iÁ˚_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

74 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

76 i‡(
vif
 =
d©a
->
ign‹e_vif
)

79 i‡(
mvmvif
->
deÊök
.
phy_˘xt
 !
d©a
->
phy˘xt
)

82 i‡(
	`WARN_ON_ONCE
(
d©a
->
idx
 >
MAX_MACS_IN_BINDING
))

85 
d©a
->
ids
[d©a->
idx
] = 
mvmvif
->
id
;

86 
d©a
->
cﬁ‹s
[d©a->
idx
] = 
mvmvif
->
cﬁ‹
;

87 
d©a
->
idx
++;

88 
	}
}

90 
	$iwl_mvm_bödög_upd©e
(
iwl_mvm
 *
mvm
,

91 
õì80211_vif
 *
vif
,

92 
iwl_mvm_phy_˘xt
 *
phy˘xt
,

93 
boﬁ
 
add
)

95 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

96 
iwl_mvm_iÁ˚_ôî©‹_d©a
 
d©a
 = {

97 .
ign‹e_vif
 = 
vif
,

98 .
phy˘xt
 =Öhyctxt,

100 
u32
 
a˘i⁄
 = 
FW_CTXT_ACTION_MODIFY
;

102 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

104 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

105 
IEEE80211_IFACE_ITER_NORMAL
,

106 
iwl_mvm_iÁ˚_ôî©‹
,

107 &
d©a
);

113 i‡(
d©a
.
idx
 == 0) {

114 i‡(
add
)

115 
a˘i⁄
 = 
FW_CTXT_ACTION_ADD
;

117 
a˘i⁄
 = 
FW_CTXT_ACTION_REMOVE
;

120 i‡(
add
) {

121 i‡(
	`WARN_ON_ONCE
(
d©a
.
idx
 >
MAX_MACS_IN_BINDING
))

122  -
EINVAL
;

124 
d©a
.
ids
[d©a.
idx
] = 
mvmvif
->
id
;

125 
d©a
.
cﬁ‹s
[d©a.
idx
] = 
mvmvif
->
cﬁ‹
;

126 
d©a
.
idx
++;

129  
	`iwl_mvm_bödög_cmd
(
mvm
, 
a˘i⁄
, &
d©a
);

130 
	}
}

132 
	$iwl_mvm_bödög_add_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

134 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

136 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
deÊök
.
phy_˘xt
))

137  -
EINVAL
;

143 i‡(
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
))

144  -
EINVAL
;

146  
	`iwl_mvm_bödög_upd©e
(
mvm
, 
vif
, 
mvmvif
->
deÊök
.
phy_˘xt
,

147 
åue
);

148 
	}
}

150 
	$iwl_mvm_bödög_ªmove_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

152 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

153 
ªt
;

155 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
deÊök
.
phy_˘xt
))

156  -
EINVAL
;

158 
ªt
 = 
	`iwl_mvm_bödög_upd©e
(
mvm
, 
vif
, 
mvmvif
->
deÊök
.
phy_˘xt
,

159 
Ál£
);

161 i‡(!
ªt
)

162 i‡(
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
åue
))

163 
	`IWL_ERR
(
mvm
, "FailedÅo update SF state\n");

165  
ªt
;

166 
	}
}

168 
u32
 
	$iwl_mvm_gë_lmac_id
(
iwl_mvm
 *
mvm
, 
∆80211_b™d
 
b™d
)

170 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_CDB_SUPPORT
) ||

171 
b™d
 =
NL80211_BAND_2GHZ
)

172  
IWL_LMAC_24G_INDEX
;

173  
IWL_LMAC_5G_INDEX
;

174 
	}
}

	@mvm/coex.c

6 
	~<löux/õì80211.h
>

7 
	~<löux/ëhîdevi˚.h
>

8 
	~<√t/mac80211.h
>

10 
	~"fw/≠i/c€x.h
"

11 
	~"iwl-mod∑øms.h
"

12 
	~"mvm.h
"

13 
	~"iwl-debug.h
"

16 c⁄° 
__À64
 
	giwl_ci_mask
[][3] = {

18 {
˝u_to_À64
(0), cpu_to_le64(0), cpu_to_le64(0)},

20 
˝u_to_À64
(0x0000001FFFULL),

21 
˝u_to_À64
(0x0ULL),

22 
˝u_to_À64
(0x00007FFFFFULL),

25 
˝u_to_À64
(0x000000FFFFULL),

26 
˝u_to_À64
(0x0ULL),

27 
˝u_to_À64
(0x0003FFFFFFULL),

30 
˝u_to_À64
(0x000003FFFCULL),

31 
˝u_to_À64
(0x0ULL),

32 
˝u_to_À64
(0x000FFFFFFCULL),

35 
˝u_to_À64
(0x00001FFFE0ULL),

36 
˝u_to_À64
(0x0ULL),

37 
˝u_to_À64
(0x007FFFFFE0ULL),

40 
˝u_to_À64
(0x00007FFF80ULL),

41 
˝u_to_À64
(0x00007FFFFFULL),

42 
˝u_to_À64
(0x01FFFFFF80ULL),

45 
˝u_to_À64
(0x0003FFFC00ULL),

46 
˝u_to_À64
(0x0003FFFFFFULL),

47 
˝u_to_À64
(0x0FFFFFFC00ULL),

50 
˝u_to_À64
(0x000FFFF000ULL),

51 
˝u_to_À64
(0x000FFFFFFCULL),

52 
˝u_to_À64
(0x3FFFFFF000ULL),

55 
˝u_to_À64
(0x007FFF8000ULL),

56 
˝u_to_À64
(0x007FFFFFE0ULL),

57 
˝u_to_À64
(0xFFFFFF8000ULL),

60 
˝u_to_À64
(0x01FFFE0000ULL),

61 
˝u_to_À64
(0x01FFFFFF80ULL),

62 
˝u_to_À64
(0xFFFFFE0000ULL),

65 
˝u_to_À64
(0x0FFFF00000ULL),

66 
˝u_to_À64
(0x0FFFFFFC00ULL),

67 
˝u_to_À64
(0x0ULL),

70 
˝u_to_À64
(0x3FFFC00000ULL),

71 
˝u_to_À64
(0x3FFFFFF000ULL),

72 
˝u_to_À64
(0x0)

75 
˝u_to_À64
(0xFFFE000000ULL),

76 
˝u_to_À64
(0xFFFFFF8000ULL),

77 
˝u_to_À64
(0x0)

80 
˝u_to_À64
(0xFFF8000000ULL),

81 
˝u_to_À64
(0xFFFFFE0000ULL),

82 
˝u_to_À64
(0x0)

85 
˝u_to_À64
(0xFE00000000ULL),

86 
˝u_to_À64
(0x0ULL),

87 
˝u_to_À64
(0x0ULL)

91 
iwl_bt_c€x_lut_ty≥


92 
	$iwl_gë_c€x_ty≥
(
iwl_mvm
 *
mvm
, c⁄° 
õì80211_vif
 *
vif
)

94 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

95 
iwl_bt_c€x_lut_ty≥
 
ªt
;

96 
u16
 
phy_˘x_id
;

97 
u32
 
¥im¨y_ch_phy_id
, 
£c⁄d¨y_ch_phy_id
;

107 
	`rcu_ªad_lock
();

109 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->
bss_c⁄f
.chanctx_conf);

111 i‡(!
ch™˘x_c⁄f
 ||

112 
ch™˘x_c⁄f
->
def
.
ch™
->
b™d
 !
NL80211_BAND_2GHZ
) {

113 
	`rcu_ªad_u∆ock
();

114  
BT_COEX_INVALID_LUT
;

117 
ªt
 = 
BT_COEX_TX_DIS_LUT
;

119 
phy_˘x_id
 = *((
u16
 *)
ch™˘x_c⁄f
->
drv_¥iv
);

120 
¥im¨y_ch_phy_id
 = 
	`À32_to_˝u
(
mvm
->
œ°_bt_ci_cmd
.primary_ch_phy_id);

121 
£c⁄d¨y_ch_phy_id
 =

122 
	`À32_to_˝u
(
mvm
->
œ°_bt_ci_cmd
.
£c⁄d¨y_ch_phy_id
);

124 i‡(
¥im¨y_ch_phy_id
 =
phy_˘x_id
)

125 
ªt
 = 
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
¥im¨y_ch_lut
);

126 i‡(
£c⁄d¨y_ch_phy_id
 =
phy_˘x_id
)

127 
ªt
 = 
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
£c⁄d¨y_ch_lut
);

130 
	`rcu_ªad_u∆ock
();

132  
ªt
;

133 
	}
}

135 
	$iwl_mvm_£nd_bt_öô_c⁄f
(
iwl_mvm
 *
mvm
)

137 
iwl_bt_c€x_cmd
 
bt_cmd
 = {};

138 
u32
 
mode
;

140 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

142 i‡(
	`u∆ikñy
(
mvm
->
bt_f‹˚_™t_mode
 !
BT_FORCE_ANT_DIS
)) {

143 
mvm
->
bt_f‹˚_™t_mode
) {

144 
BT_FORCE_ANT_BT
:

145 
mode
 = 
BT_COEX_BT
;

147 
BT_FORCE_ANT_WIFI
:

148 
mode
 = 
BT_COEX_WIFI
;

151 
	`WARN_ON
(1);

152 
mode
 = 0;

155 
bt_cmd
.
mode
 = 
	`˝u_to_À32
(mode);

156 
£nd_cmd
;

159 
bt_cmd
.
mode
 = 
	`˝u_to_À32
(
BT_COEX_NW
);

161 i‡(
IWL_MVM_BT_COEX_SYNC2SCO
)

162 
bt_cmd
.
íabÀd_moduÀs
 |=

163 
	`˝u_to_À32
(
BT_COEX_SYNC2SCO_ENABLED
);

165 i‡(
	`iwl_mvm_is_m∂ut_suµ‹ãd
(
mvm
))

166 
bt_cmd
.
íabÀd_moduÀs
 |
	`˝u_to_À32
(
BT_COEX_MPLUT_ENABLED
);

168 
bt_cmd
.
íabÀd_moduÀs
 |
	`˝u_to_À32
(
BT_COEX_HIGH_BAND_RET
);

170 
£nd_cmd
:

171 
	`mem£t
(&
mvm
->
œ°_bt_nŸif
, 0, (mvm->last_bt_notif));

172 
	`mem£t
(&
mvm
->
œ°_bt_ci_cmd
, 0, (mvm->last_bt_ci_cmd));

174  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
BT_CONFIG
, 0, (
bt_cmd
), &bt_cmd);

175 
	}
}

177 
	$iwl_mvm_bt_c€x_ªdu˚d_txp
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
,

178 
boﬁ
 
íabÀ
)

180 
iwl_bt_c€x_ªdu˚d_txp_upd©e_cmd
 
cmd
 = {};

181 
iwl_mvm_°a
 *
mvm°a
;

182 
u32
 
vÆue
;

184 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

187 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 
°a_id
);

188 i‡(!
mvm°a
)

192 i‡(
mvm°a
->
bt_ªdu˚d_txpowî
 =
íabÀ
)

195 
vÆue
 = 
mvm°a
->
deÊök
.
°a_id
;

197 i‡(
íabÀ
)

198 
vÆue
 |
BT_REDUCED_TX_POWER_BIT
;

200 
	`IWL_DEBUG_COEX
(
mvm
, "%sableÑeduced Tx Power for sta %d\n",

201 
íabÀ
 ? "í" : "dis", 
°a_id
);

203 
cmd
.
ªdu˚d_txp
 = 
	`˝u_to_À32
(
vÆue
);

204 
mvm°a
->
bt_ªdu˚d_txpowî
 = 
íabÀ
;

206  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
BT_COEX_UPDATE_REDUCED_TXP
,

207 
CMD_ASYNC
, (
cmd
), &cmd);

208 
	}
}

210 
	siwl_bt_ôî©‹_d©a
 {

211 
iwl_bt_c€x_¥ofûe_nŸif
 *
	mnŸif
;

212 
iwl_mvm
 *
	mmvm
;

213 
õì80211_ch™˘x_c⁄f
 *
	m¥im¨y
;

214 
õì80211_ch™˘x_c⁄f
 *
	m£c⁄d¨y
;

215 
boﬁ
 
	m¥im¨y_Œ
;

216 
u8
 
	m¥im¨y_lﬂd
;

217 
u8
 
	m£c⁄d¨y_lﬂd
;

220 
ölöe


221 
	$iwl_mvm_bt_c€x_íabÀ_rssi_evít
(
iwl_mvm
 *
mvm
,

222 
õì80211_vif
 *
vif
,

223 
boﬁ
 
íabÀ
, 
rssi
)

225 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

227 
mvmvif
->
bf_d©a
.
œ°_bt_c€x_evít
 = 
rssi
;

228 
mvmvif
->
bf_d©a
.
bt_c€x_max_thﬁd
 =

229 
íabÀ
 ? -
IWL_MVM_BT_COEX_EN_RED_TXP_THRESH
 : 0;

230 
mvmvif
->
bf_d©a
.
bt_c€x_mö_thﬁd
 =

231 
íabÀ
 ? -
IWL_MVM_BT_COEX_DIS_RED_TXP_THRESH
 : 0;

232 
	}
}

234 
	#MVM_COEX_TCM_PERIOD
 (
HZ
 * 10)

	)

236 
	$iwl_mvm_bt_c€x_tcm_ba£d_ci
(
iwl_mvm
 *
mvm
,

237 
iwl_bt_ôî©‹_d©a
 *
d©a
)

239 
now
 = 
jiffõs
;

241 i‡(!
	`time_a·î
(
now
, 
mvm
->
bt_c€x_œ°_tcm_ts
 + 
MVM_COEX_TCM_PERIOD
))

244 
mvm
->
bt_c€x_œ°_tcm_ts
 = 
now
;

249 i‡(
d©a
->
¥im¨y_Œ
)

252 i‡(
d©a
->
¥im¨y_lﬂd
 >d©a->
£c⁄d¨y_lﬂd
)

255 
	`sw≠
(
d©a
->
¥im¨y
, d©a->
£c⁄d¨y
);

256 
	}
}

258 
	$iwl_mvm_bt_c€x_íabÀ_e§
(
iwl_mvm
 *
mvm
,

259 
õì80211_vif
 *
vif
, 
boﬁ
 
íabÀ
)

261 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

262 
lök_id
;

264 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

266 i‡(!
vif
->
cfg
.
assoc
 || !
	`õì80211_vif_is_mld
(vif))

270 i‡(
mvmvif
->
bt_c€x_e§_dißbÀd
 =!
íabÀ
)

273 
mvmvif
->
bt_c€x_e§_dißbÀd
 = !
íabÀ
;

276 i‡(
mvmvif
->
e§_a˘ive
 =
íabÀ
)

279 i‡(
íabÀ
) {

281 
	`iwl_mvm_mld_£À˘_löks
(
mvm
, 
vif
, 
Ál£
);

289 
lök_id
 = 
	`iwl_mvm_mld_gë_¥im¨y_lök
(
mvm
, 
vif
, vif->
a˘ive_löks
);

290 
	`WARN_ON
(
lök_id
 < 0);

292 
	`õì80211_£t_a˘ive_löks_async
(
vif
,

293 
vif
->
a˘ive_löks
 & 
	`BIT
(
lök_id
));

294 
	}
}

300 
boﬁ


301 
	$iwl_mvm_bt_c€x_ˇlcuœã_e§_mode
(
iwl_mvm
 *
mvm
,

302 
õì80211_vif
 *
vif
,

303 
lök_id
, 
¥im¨y_lök
)

305 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

306 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

307 
boﬁ
 
have_wifi_loss_øã
 =

308 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

309 
BT_PROFILE_NOTIFICATION
, 0) > 4;

310 
s8
 
lök_rssi
 = 0;

311 
u8
 
wifi_loss_øã
;

313 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

315 i‡(
mvm
->
œ°_bt_nŸif
.
wifi_loss_low_rssi
 =
BT_OFF
)

316  
åue
;

319 i‡(
lök_id
 =
¥im¨y_lök
)

320  
Ál£
;

323 i‡(!
have_wifi_loss_øã
)

324  
åue
;

330 i‡(
lök_öfo
)

331 
lök_rssi
 = (
s8
)
lök_öfo
->
bóc⁄_°©s
.
avg_sig«l
;

338 i‡(!
lök_rssi
)

339 
wifi_loss_øã
 = 
mvm
->
œ°_bt_nŸif
.
wifi_loss_mid_high_rssi
;

341 i‡(!
mvmvif
->
bt_c€x_e§_dißbÀd
)

343 
wifi_loss_øã
 =

344 
lök_rssi
 <-
IWL_MVM_BT_COEX_DISABLE_ESR_THRESH
 ?

345 
mvm
->
œ°_bt_nŸif
.
wifi_loss_low_rssi
 :

346 
mvm
->
œ°_bt_nŸif
.
wifi_loss_mid_high_rssi
;

349 
wifi_loss_øã
 =

350 
lök_rssi
 <-
IWL_MVM_BT_COEX_ENABLE_ESR_THRESH
 ?

351 
mvm
->
œ°_bt_nŸif
.
wifi_loss_low_rssi
 :

352 
mvm
->
œ°_bt_nŸif
.
wifi_loss_mid_high_rssi
;

354  
wifi_loss_øã
 <
IWL_MVM_BT_COEX_WIFI_LOSS_THRESH
;

355 
	}
}

357 
	$iwl_mvm_bt_c€x_upd©e_vif_e§
(
iwl_mvm
 *
mvm
,

358 
õì80211_vif
 *
vif
,

359 
lök_id
)

361 
ußbÀ_löks
 = 
	`õì80211_vif_ußbÀ_löks
(
vif
);

362 
¥im¨y_lök
 = 
	`iwl_mvm_mld_gë_¥im¨y_lök
(
mvm
, 
vif
,

363 
ußbÀ_löks
);

364 
boﬁ
 
íabÀ
;

367 i‡(
¥im¨y_lök
 < 0)

370 
íabÀ
 = 
	`iwl_mvm_bt_c€x_ˇlcuœã_e§_mode
(
mvm
, 
vif
, 
lök_id
,

371 
¥im¨y_lök
);

373 
	`iwl_mvm_bt_c€x_íabÀ_e§
(
mvm
, 
vif
, 
íabÀ
);

374 
	}
}

376 
	$iwl_mvm_bt_nŸif_≥r_lök
(
iwl_mvm
 *
mvm
,

377 
õì80211_vif
 *
vif
,

378 
iwl_bt_ôî©‹_d©a
 *
d©a
,

379 
lök_id
)

382 
õì80211_smps_mode
 
smps_mode
 = 
IEEE80211_SMPS_AUTOMATIC
;

383 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

384 
u32
 
bt_a˘ivôy_gødög
, 
mö_ag_f‹_°©ic_smps
;

385 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

386 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
;

387 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

388 
ave_rssi
;

390 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

392 
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

393 i‡(!
lök_öfo
)

396 
lök_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->lök_c⁄f[
lök_id
]);

401 i‡(!
lök_c⁄f
)

404 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->chanctx_conf);

407 i‡((!
ch™˘x_c⁄f
 ||

408 
ch™˘x_c⁄f
->
def
.
ch™
->
b™d
 !
NL80211_BAND_2GHZ
)) {

409 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

411 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_BT_COEX
,

412 
smps_mode
, 
lök_id
);

413 
	`iwl_mvm_bt_c€x_ªdu˚d_txp
(
mvm
, 
lök_öfo
->
≠_°a_id
,

414 
Ál£
);

416 
	`iwl_mvm_bt_c€x_íabÀ_rssi_evít
(
mvm
, 
vif
, 
Ál£
, 0);

421 
	`iwl_mvm_bt_c€x_upd©e_vif_e§
(
mvm
, 
vif
, 
lök_id
);

423 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_COEX_SCHEMA_2
))

424 
mö_ag_f‹_°©ic_smps
 = 
BT_VERY_HIGH_TRAFFIC
;

426 
mö_ag_f‹_°©ic_smps
 = 
BT_HIGH_TRAFFIC
;

428 
bt_a˘ivôy_gødög
 = 
	`À32_to_˝u
(
d©a
->
nŸif
->bt_activity_grading);

429 i‡(
bt_a˘ivôy_gødög
 >
mö_ag_f‹_°©ic_smps
)

430 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

431 i‡(
bt_a˘ivôy_gødög
 >
BT_LOW_TRAFFIC
)

432 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

435 i‡(!
vif
->
cfg
.
assoc
)

436 
smps_mode
 = 
IEEE80211_SMPS_AUTOMATIC
;

438 i‡(
lök_öfo
->
phy_˘xt
 &&

439 (
mvm
->
œ°_bt_nŸif
.
ºc_°©us
 & 
	`BIT
(
lök_öfo
->
phy_˘xt
->
id
)))

440 
smps_mode
 = 
IEEE80211_SMPS_AUTOMATIC
;

442 
	`IWL_DEBUG_COEX
(
d©a
->
mvm
,

444 
mvmvif
->
id
, 
lök_öfo
->
fw_lök_id
,

445 
bt_a˘ivôy_gødög
, 
smps_mode
);

447 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

448 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_BT_COEX
,

449 
smps_mode
, 
lök_id
);

452 i‡(
	`iwl_mvm_vif_low_œãncy
(
mvmvif
)) {

453 
d©a
->
¥im¨y_Œ
 = 
åue
;

455 
d©a
->
£c⁄d¨y
 = d©a->
¥im¨y
;

456 
d©a
->
¥im¨y
 = 
ch™˘x_c⁄f
;

459 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

460 i‡(!
mvmvif
->
≠_ibss_a˘ive
)

463 i‡(
ch™˘x_c⁄f
 =
d©a
->
¥im¨y
)

466 i‡(!
d©a
->
¥im¨y_Œ
) {

471 
d©a
->
£c⁄d¨y
 = d©a->
¥im¨y
;

472 
d©a
->
¥im¨y
 = 
ch™˘x_c⁄f
;

475 
d©a
->
£c⁄d¨y
 = 
ch™˘x_c⁄f
;

479 i‡(
d©a
->
¥im¨y
 =
ch™˘x_c⁄f
)

480 
d©a
->
¥im¨y_lﬂd
 = 
mvm
->
tcm
.
ªsu…
.
lﬂd
[
mvmvif
->
id
];

481 i‡(
d©a
->
£c⁄d¨y
 =
ch™˘x_c⁄f
)

482 
d©a
->
£c⁄d¨y_lﬂd
 = 
mvm
->
tcm
.
ªsu…
.
lﬂd
[
mvmvif
->
id
];

490 i‡(!
d©a
->
¥im¨y
 || d©a->¥im¨y =
ch™˘x_c⁄f
)

491 
d©a
->
¥im¨y
 = 
ch™˘x_c⁄f
;

492 i‡(!
d©a
->
£c⁄d¨y
)

494 
d©a
->
£c⁄d¨y
 = 
ch™˘x_c⁄f
;

497 i‡(
d©a
->
¥im¨y
 =
ch™˘x_c⁄f
)

498 
d©a
->
¥im¨y_lﬂd
 = 
mvm
->
tcm
.
ªsu…
.
lﬂd
[
mvmvif
->
id
];

499 i‡(
d©a
->
£c⁄d¨y
 =
ch™˘x_c⁄f
)

500 
d©a
->
£c⁄d¨y_lﬂd
 = 
mvm
->
tcm
.
ªsu…
.
lﬂd
[
mvmvif
->
id
];

507 i‡(
	`iwl_gë_c€x_ty≥
(
mvm
, 
vif
Ë=
BT_COEX_LOOSE_LUT
 ||

508 
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
Ë=
BT_OFF
 ||

509 !
vif
->
cfg
.
assoc
) {

510 
	`iwl_mvm_bt_c€x_ªdu˚d_txp
(
mvm
, 
lök_öfo
->
≠_°a_id
, 
Ál£
);

512 
	`iwl_mvm_bt_c€x_íabÀ_rssi_evít
(
mvm
, 
vif
, 
Ál£
, 0);

517 
ave_rssi
 = 
mvmvif
->
bf_d©a
.
ave_bóc⁄_sig«l
;

520 i‡(!
ave_rssi
)

521 
ave_rssi
 = -100;

522 i‡(
ave_rssi
 > -
IWL_MVM_BT_COEX_EN_RED_TXP_THRESH
) {

523 i‡(
	`iwl_mvm_bt_c€x_ªdu˚d_txp
(
mvm
, 
lök_öfo
->
≠_°a_id
,

524 
åue
))

525 
	`IWL_ERR
(
mvm
, "Couldn't send BT_CONFIG cmd\n");

526 } i‡(
ave_rssi
 < -
IWL_MVM_BT_COEX_DIS_RED_TXP_THRESH
) {

527 i‡(
	`iwl_mvm_bt_c€x_ªdu˚d_txp
(
mvm
, 
lök_öfo
->
≠_°a_id
,

528 
Ál£
))

529 
	`IWL_ERR
(
mvm
, "Couldn't send BT_CONFIG cmd\n");

533 
	`iwl_mvm_bt_c€x_íabÀ_rssi_evít
(
mvm
, 
vif
, 
åue
, 
ave_rssi
);

534 
	}
}

537 
	$iwl_mvm_bt_nŸif_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

538 
õì80211_vif
 *
vif
)

540 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

541 
iwl_bt_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

542 
iwl_mvm
 *
mvm
 = 
d©a
->mvm;

543 
lök_id
;

545 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

547 
vif
->
ty≥
) {

548 
NL80211_IFTYPE_STATION
:

550 
NL80211_IFTYPE_AP
:

551 i‡(!
mvmvif
->
≠_ibss_a˘ive
)

559 i‡(
d©a
->
nŸif
->
wifi_loss_low_rssi
 =
BT_OFF
)

560 
	`iwl_mvm_bt_c€x_íabÀ_e§
(
mvm
, 
vif
, 
åue
);

562 
lök_id
 = 0;Üök_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;Üink_id++)

563 
	`iwl_mvm_bt_nŸif_≥r_lök
(
mvm
, 
vif
, 
d©a
, 
lök_id
);

564 
	}
}

566 
	$iwl_mvm_bt_c€x_nŸif_h™dÀ
(
iwl_mvm
 *
mvm
)

568 
iwl_bt_ôî©‹_d©a
 
d©a
 = {

569 .
mvm
 = mvm,

570 .
nŸif
 = &
mvm
->
œ°_bt_nŸif
,

572 
iwl_bt_c€x_ci_cmd
 
cmd
 = {};

573 
u8
 
ci_bw_idx
;

576 i‡(
	`u∆ikñy
(
mvm
->
bt_f‹˚_™t_mode
 !
BT_FORCE_ANT_DIS
))

579 
	`rcu_ªad_lock
();

580 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

581 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

582 
iwl_mvm_bt_nŸif_ôî©‹
, &
d©a
);

584 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

585 
	`rcu_ªad_u∆ock
();

589 
	`iwl_mvm_bt_c€x_tcm_ba£d_ci
(
mvm
, &
d©a
);

591 i‡(
d©a
.
¥im¨y
) {

592 
õì80211_ch™˘x_c⁄f
 *
ch™
 = 
d©a
.
¥im¨y
;

593 i‡(
	`WARN_ON
(!
ch™
->
def
.chan)) {

594 
	`rcu_ªad_u∆ock
();

598 i‡(
ch™
->
def
.
width
 < 
NL80211_CHAN_WIDTH_40
) {

599 
ci_bw_idx
 = 0;

601 i‡(
ch™
->
def
.
˚¡î_‰eq1
 >

602 
ch™
->
def
.ch™->
˚¡î_‰eq
)

603 
ci_bw_idx
 = 2;

605 
ci_bw_idx
 = 1;

608 
cmd
.
bt_¥im¨y_ci
 =

609 
iwl_ci_mask
[
ch™
->
def
.ch™->
hw_vÆue
][
ci_bw_idx
];

610 
cmd
.
¥im¨y_ch_phy_id
 =

611 
	`˝u_to_À32
(*((
u16
 *)
d©a
.
¥im¨y
->
drv_¥iv
));

614 i‡(
d©a
.
£c⁄d¨y
) {

615 
õì80211_ch™˘x_c⁄f
 *
ch™
 = 
d©a
.
£c⁄d¨y
;

616 i‡(
	`WARN_ON
(!
d©a
.
£c⁄d¨y
->
def
.
ch™
)) {

617 
	`rcu_ªad_u∆ock
();

621 i‡(
ch™
->
def
.
width
 < 
NL80211_CHAN_WIDTH_40
) {

622 
ci_bw_idx
 = 0;

624 i‡(
ch™
->
def
.
˚¡î_‰eq1
 >

625 
ch™
->
def
.ch™->
˚¡î_‰eq
)

626 
ci_bw_idx
 = 2;

628 
ci_bw_idx
 = 1;

631 
cmd
.
bt_£c⁄d¨y_ci
 =

632 
iwl_ci_mask
[
ch™
->
def
.ch™->
hw_vÆue
][
ci_bw_idx
];

633 
cmd
.
£c⁄d¨y_ch_phy_id
 =

634 
	`˝u_to_À32
(*((
u16
 *)
d©a
.
£c⁄d¨y
->
drv_¥iv
));

637 
	`rcu_ªad_u∆ock
();

640 i‡(
	`memcmp
(&
cmd
, &
mvm
->
œ°_bt_ci_cmd
, (cmd))) {

641 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
BT_COEX_CI
, 0,

642 (
cmd
), &cmd))

643 
	`IWL_ERR
(
mvm
, "FailedÅo send BT_CI cmd\n");

644 
	`mem˝y
(&
mvm
->
œ°_bt_ci_cmd
, &
cmd
, (cmd));

646 
	}
}

648 
	$iwl_mvm_rx_bt_c€x_nŸif
(
iwl_mvm
 *
mvm
,

649 
iwl_rx_cmd_buf„r
 *
rxb
)

651 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

652 
iwl_bt_c€x_¥ofûe_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

654 
	`IWL_DEBUG_COEX
(
mvm
, "BT Coex NotificationÑeceived\n");

655 
	`IWL_DEBUG_COEX
(
mvm
, "\tBT còcom∂ün˚ %d\n", 
nŸif
->
bt_ci_com∂ün˚
);

656 
	`IWL_DEBUG_COEX
(
mvm
, "\tBTÖrimary_ch_lut %d\n",

657 
	`À32_to_˝u
(
nŸif
->
¥im¨y_ch_lut
));

658 
	`IWL_DEBUG_COEX
(
mvm
, "\tBT secondary_ch_lut %d\n",

659 
	`À32_to_˝u
(
nŸif
->
£c⁄d¨y_ch_lut
));

660 
	`IWL_DEBUG_COEX
(
mvm
, "\tBTáctivity grading %d\n",

661 
	`À32_to_˝u
(
nŸif
->
bt_a˘ivôy_gødög
));

664 
	`mem˝y
(&
mvm
->
œ°_bt_nŸif
, 
nŸif
, (mvm->last_bt_notif));

666 
	`iwl_mvm_bt_c€x_nŸif_h™dÀ
(
mvm
);

667 
	}
}

669 
	$iwl_mvm_bt_rssi_evít
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

670 
õì80211_rssi_evít_d©a
 
rssi_evít
)

672 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

673 
ªt
;

675 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

678 i‡(
	`u∆ikñy
(
mvm
->
bt_f‹˚_™t_mode
 !
BT_FORCE_ANT_DIS
))

685 i‡(
mvmvif
->
deÊök
.
≠_°a_id
 =
IWL_MVM_INVALID_STA
)

689 i‡(
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
Ë=
BT_OFF
)

692 
	`IWL_DEBUG_COEX
(
mvm
, "RSSI f‹ %pM i†now %s\n", 
vif
->
bss_c⁄f
.
bssid
,

693 
rssi_evít
 =
RSSI_EVENT_HIGH
 ? "HIGH" : "LOW");

699 i‡(
rssi_evít
 =
RSSI_EVENT_LOW
 ||

700 
	`iwl_gë_c€x_ty≥
(
mvm
, 
vif
Ë=
BT_COEX_LOOSE_LUT
)

701 
ªt
 = 
	`iwl_mvm_bt_c€x_ªdu˚d_txp
(
mvm
,

702 
mvmvif
->
deÊök
.
≠_°a_id
,

703 
Ál£
);

705 
ªt
 = 
	`iwl_mvm_bt_c€x_ªdu˚d_txp
(
mvm
,

706 
mvmvif
->
deÊök
.
≠_°a_id
,

707 
åue
);

709 i‡(
ªt
)

710 
	`IWL_ERR
(
mvm
, "couldn't send BT_CONFIG HCMD upon RSSIÉvent\n");

711 
	}
}

713 
	#LINK_QUAL_AGG_TIME_LIMIT_DEF
 (4000)

	)

714 
	#LINK_QUAL_AGG_TIME_LIMIT_BT_ACT
 (1200)

	)

716 
u16
 
	$iwl_mvm_c€x_agg_time_limô
(
iwl_mvm
 *
mvm
,

717 
õì80211_°a
 *
°a
)

719 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

720 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

721 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = 
mvmvif
->
deÊök
.phy_ctxt;

722 
iwl_bt_c€x_lut_ty≥
 
lut_ty≥
;

724 i‡(
mvm
->
œ°_bt_nŸif
.
âc_°©us
 & 
	`BIT
(
phy_˘xt
->
id
))

725  
LINK_QUAL_AGG_TIME_LIMIT_DEF
;

727 i‡(
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
) <

728 
BT_HIGH_TRAFFIC
)

729  
LINK_QUAL_AGG_TIME_LIMIT_DEF
;

731 
lut_ty≥
 = 
	`iwl_gë_c€x_ty≥
(
mvm
, 
mvm°a
->
vif
);

733 i‡(
lut_ty≥
 =
BT_COEX_LOOSE_LUT
 ||Üut_ty≥ =
BT_COEX_INVALID_LUT
)

734  
LINK_QUAL_AGG_TIME_LIMIT_DEF
;

737  
LINK_QUAL_AGG_TIME_LIMIT_BT_ACT
;

738 
	}
}

740 
boﬁ
 
	$iwl_mvm_bt_c€x_is_mimo_Ælowed
(
iwl_mvm
 *
mvm
,

741 
õì80211_°a
 *
°a
)

743 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

744 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

745 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = 
mvmvif
->
deÊök
.phy_ctxt;

746 
iwl_bt_c€x_lut_ty≥
 
lut_ty≥
;

748 i‡(
mvm
->
œ°_bt_nŸif
.
âc_°©us
 & 
	`BIT
(
phy_˘xt
->
id
))

749  
åue
;

751 i‡(
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
) <

752 
BT_HIGH_TRAFFIC
)

753  
åue
;

762 
lut_ty≥
 = 
	`iwl_gë_c€x_ty≥
(
mvm
, 
mvm°a
->
vif
);

763  
lut_ty≥
 !
BT_COEX_LOOSE_LUT
;

764 
	}
}

766 
boﬁ
 
	$iwl_mvm_bt_c€x_is_™t_avaû
(
iwl_mvm
 *
mvm
, 
u8
 
™t
)

768 i‡(
™t
 & 
mvm
->
cfg
->
n⁄_sh¨ed_™t
)

769  
åue
;

771  
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
) <

772 
BT_HIGH_TRAFFIC
;

773 
	}
}

775 
boﬁ
 
	$iwl_mvm_bt_c€x_is_sh¨ed_™t_avaû
(
iwl_mvm
 *
mvm
)

777  
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
Ë< 
BT_HIGH_TRAFFIC
;

778 
	}
}

780 
boﬁ
 
	$iwl_mvm_bt_c€x_is_çc_Ælowed
(
iwl_mvm
 *
mvm
,

781 
∆80211_b™d
 
b™d
)

783 
u32
 
bt_a˘ivôy
 = 
	`À32_to_˝u
(
mvm
->
œ°_bt_nŸif
.
bt_a˘ivôy_gødög
);

785 i‡(
b™d
 !
NL80211_BAND_2GHZ
)

786  
Ál£
;

788  
bt_a˘ivôy
 >
BT_LOW_TRAFFIC
;

789 
	}
}

791 
u8
 
	$iwl_mvm_bt_c€x_gë_sögÀ_™t_msk
(
iwl_mvm
 *
mvm
, 
u8
 
íabÀd_™ts
)

793 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_COEX_SCHEMA_2
) &&

794 (
mvm
->
cfg
->
n⁄_sh¨ed_™t
 & 
íabÀd_™ts
))

795  
mvm
->
cfg
->
n⁄_sh¨ed_™t
;

797  
	`fú°_™ã¬a
(
íabÀd_™ts
);

798 
	}
}

800 
u8
 
	$iwl_mvm_bt_c€x_tx_¥io
(
iwl_mvm
 *
mvm
, 
õì80211_hdr
 *
hdr
,

801 
õì80211_tx_öfo
 *
öfo
, 
u8
 
ac
)

803 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

804 
boﬁ
 
m∂ut_íabÀd
 = 
	`iwl_mvm_is_m∂ut_suµ‹ãd
(
mvm
);

806 i‡(
öfo
->
b™d
 !
NL80211_BAND_2GHZ
)

809 i‡(
	`u∆ikñy
(
mvm
->
bt_tx_¥io
))

810  
mvm
->
bt_tx_¥io
 - 1;

812 i‡(
	`likñy
(
	`õì80211_is_d©a
(
fc
))) {

813 i‡(
	`likñy
(
	`õì80211_is_d©a_qos
(
fc
))) {

814 
ac
) {

815 
IEEE80211_AC_BE
:

816  
m∂ut_íabÀd
 ? 1 : 0;

817 
IEEE80211_AC_VI
:

818  
m∂ut_íabÀd
 ? 2 : 3;

819 
IEEE80211_AC_VO
:

824 } i‡(
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
)) {

828 } i‡(
	`õì80211_is_mgmt
(
fc
)) {

829  
	`õì80211_is_dißssoc
(
fc
) ? 0 : 3;

830 } i‡(
	`õì80211_is_˘l
(
fc
)) {

836 
	}
}

838 
	$iwl_mvm_bt_c€x_vif_ch™ge
(
iwl_mvm
 *
mvm
)

840 
	`iwl_mvm_bt_c€x_nŸif_h™dÀ
(
mvm
);

841 
	}
}

	@mvm/constants.h

7 #i‚de‡
__MVM_CONSTANTS_H


8 
	#__MVM_CONSTANTS_H


	)

10 
	~<löux/õì80211.h
>

11 
	~"fw-≠i.h
"

13 
	#IWL_MVM_UAPSD_NOAGG_BSSIDS_NUM
 20

	)

14 
	#IWL_MVM_BT_COEX_DISABLE_ESR_THRESH
 69

	)

15 
	#IWL_MVM_BT_COEX_ENABLE_ESR_THRESH
 63

	)

16 
	#IWL_MVM_BT_COEX_WIFI_LOSS_THRESH
 0

	)

18 
	#IWL_MVM_DEFAULT_PS_TX_DATA_TIMEOUT
 (100 * 
USEC_PER_MSEC
)

	)

19 
	#IWL_MVM_DEFAULT_PS_RX_DATA_TIMEOUT
 (100 * 
USEC_PER_MSEC
)

	)

20 
	#IWL_MVM_WOWLAN_PS_TX_DATA_TIMEOUT
 (10 * 
USEC_PER_MSEC
)

	)

21 
	#IWL_MVM_WOWLAN_PS_RX_DATA_TIMEOUT
 (10 * 
USEC_PER_MSEC
)

	)

22 
	#IWL_MVM_SHORT_PS_TX_DATA_TIMEOUT
 (2 * 1024Ë

	)

23 
	#IWL_MVM_SHORT_PS_RX_DATA_TIMEOUT
 (40 * 1024Ë

	)

24 
	#IWL_MVM_P2P_LOWLATENCY_PS_ENABLE
 0

	)

25 
	#IWL_MVM_UAPSD_RX_DATA_TIMEOUT
 (50 * 
USEC_PER_MSEC
)

	)

26 
	#IWL_MVM_UAPSD_TX_DATA_TIMEOUT
 (50 * 
USEC_PER_MSEC
)

	)

27 
	#IWL_MVM_UAPSD_QUEUES
 (
IEEE80211_WMM_IE_STA_QOSINFO_AC_VO
 |\

28 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VI
 |\

29 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BK
 |\

30 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BE
)

	)

31 
	#IWL_MVM_PS_HEAVY_TX_THLD_PACKETS
 20

	)

32 
	#IWL_MVM_PS_HEAVY_RX_THLD_PACKETS
 8

	)

33 
	#IWL_MVM_PS_SNOOZE_HEAVY_TX_THLD_PACKETS
 30

	)

34 
	#IWL_MVM_PS_SNOOZE_HEAVY_RX_THLD_PACKETS
 20

	)

35 
	#IWL_MVM_PS_HEAVY_TX_THLD_PERCENT
 50

	)

36 
	#IWL_MVM_PS_HEAVY_RX_THLD_PERCENT
 50

	)

37 
	#IWL_MVM_PS_SNOOZE_INTERVAL
 25

	)

38 
	#IWL_MVM_PS_SNOOZE_WINDOW
 50

	)

39 
	#IWL_MVM_WOWLAN_PS_SNOOZE_WINDOW
 25

	)

40 
	#IWL_MVM_LOWLAT_QUOTA_MIN_PERCENT
 64

	)

41 
	#IWL_MVM_BT_COEX_EN_RED_TXP_THRESH
 62

	)

42 
	#IWL_MVM_BT_COEX_DIS_RED_TXP_THRESH
 65

	)

43 
	#IWL_MVM_BT_COEX_SYNC2SCO
 1

	)

44 
	#IWL_MVM_BT_COEX_MPLUT
 1

	)

45 
	#IWL_MVM_BT_COEX_RRC
 1

	)

46 
	#IWL_MVM_BT_COEX_TTC
 1

	)

47 
	#IWL_MVM_BT_COEX_MPLUT_REG0
 0x22002200

	)

48 
	#IWL_MVM_BT_COEX_MPLUT_REG1
 0x11118451

	)

49 
	#IWL_MVM_BT_COEX_ANTENNA_COUPLING_THRS
 30

	)

50 
	#IWL_MVM_FW_MCAST_FILTER_PASS_ALL
 0

	)

51 
	#IWL_MVM_FW_BCAST_FILTER_PASS_ALL
 0

	)

52 
	#IWL_MVM_QUOTA_THRESHOLD
 4

	)

53 
	#IWL_MVM_RS_RSSI_BASED_INIT_RATE
 0

	)

54 
	#IWL_MVM_RS_80_20_FAR_RANGE_TWEAK
 1

	)

55 
	#IWL_MVM_TOF_IS_RESPONDER
 0

	)

56 
	#IWL_MVM_HW_CSUM_DISABLE
 0

	)

57 
	#IWL_MVM_PARSE_NVM
 0

	)

58 
	#IWL_MVM_ADWELL_ENABLE
 1

	)

59 
	#IWL_MVM_ADWELL_MAX_BUDGET
 0

	)

60 
	#IWL_MVM_TCM_LOAD_MEDIUM_THRESH
 10

	)

61 
	#IWL_MVM_TCM_LOAD_HIGH_THRESH
 50

	)

62 
	#IWL_MVM_TCM_LOWLAT_ENABLE_THRESH
 100

	)

63 
	#IWL_MVM_UAPSD_NONAGG_PERIOD
 5000

	)

64 
	#IWL_MVM_UAPSD_NOAGG_LIST_LEN
 
IWL_MVM_UAPSD_NOAGG_BSSIDS_NUM


	)

65 
	#IWL_MVM_NON_TRANSMITTING_AP
 0

	)

66 
	#IWL_MVM_CONN_LISTEN_INTERVAL
 10

	)

67 
	#IWL_MVM_RS_NUM_TRY_BEFORE_ANT_TOGGLE
 1

	)

68 
	#IWL_MVM_RS_HT_VHT_RETRIES_PER_RATE
 2

	)

69 
	#IWL_MVM_RS_HT_VHT_RETRIES_PER_RATE_TW
 1

	)

70 
	#IWL_MVM_RS_INITIAL_MIMO_NUM_RATES
 3

	)

71 
	#IWL_MVM_RS_INITIAL_SISO_NUM_RATES
 3

	)

72 
	#IWL_MVM_RS_INITIAL_LEGACY_NUM_RATES
 2

	)

73 
	#IWL_MVM_RS_INITIAL_LEGACY_RETRIES
 2

	)

74 
	#IWL_MVM_RS_SECONDARY_LEGACY_RETRIES
 1

	)

75 
	#IWL_MVM_RS_SECONDARY_LEGACY_NUM_RATES
 16

	)

76 
	#IWL_MVM_RS_SECONDARY_SISO_NUM_RATES
 3

	)

77 
	#IWL_MVM_RS_SECONDARY_SISO_RETRIES
 1

	)

78 
	#IWL_MVM_RS_RATE_MIN_FAILURE_TH
 3

	)

79 
	#IWL_MVM_RS_RATE_MIN_SUCCESS_TH
 8

	)

80 
	#IWL_MVM_RS_STAY_IN_COLUMN_TIMEOUT
 5

	)

81 
	#IWL_MVM_RS_IDLE_TIMEOUT
 5

	)

82 
	#IWL_MVM_RS_MISSED_RATE_MAX
 15

	)

83 
	#IWL_MVM_RS_LEGACY_FAILURE_LIMIT
 160

	)

84 
	#IWL_MVM_RS_LEGACY_SUCCESS_LIMIT
 480

	)

85 
	#IWL_MVM_RS_LEGACY_TABLE_COUNT
 160

	)

86 
	#IWL_MVM_RS_NON_LEGACY_FAILURE_LIMIT
 400

	)

87 
	#IWL_MVM_RS_NON_LEGACY_SUCCESS_LIMIT
 4500

	)

88 
	#IWL_MVM_RS_NON_LEGACY_TABLE_COUNT
 1500

	)

89 
	#IWL_MVM_RS_SR_FORCE_DECREASE
 15

	)

90 
	#IWL_MVM_RS_SR_NO_DECREASE
 85

	)

91 
	#IWL_MVM_RS_AGG_TIME_LIMIT
 4000

	)

92 
	#IWL_MVM_RS_AGG_DISABLE_START
 3

	)

93 
	#IWL_MVM_RS_AGG_START_THRESHOLD
 10

	)

94 
	#IWL_MVM_RS_TPC_SR_FORCE_INCREASE
 75

	)

95 
	#IWL_MVM_RS_TPC_SR_NO_INCREASE
 85

	)

96 
	#IWL_MVM_RS_TPC_TX_POWER_STEP
 3

	)

97 
	#IWL_MVM_ENABLE_EBS
 1

	)

98 
	#IWL_MVM_FTM_INITIATOR_ALGO
 
IWL_TOF_ALGO_TYPE_MAX_LIKE


	)

99 
	#IWL_MVM_FTM_INITIATOR_DYNACK
 
åue


	)

100 
	#IWL_MVM_FTM_LMR_FEEDBACK_TERMINATE
 
Ál£


	)

101 
	#IWL_MVM_FTM_R2I_MAX_REP
 7

	)

102 
	#IWL_MVM_FTM_I2R_MAX_REP
 7

	)

103 
	#IWL_MVM_FTM_R2I_MAX_STS
 1

	)

104 
	#IWL_MVM_FTM_I2R_MAX_STS
 1

	)

105 
	#IWL_MVM_FTM_R2I_MAX_TOTAL_LTF
 3

	)

106 
	#IWL_MVM_FTM_I2R_MAX_TOTAL_LTF
 3

	)

107 
	#IWL_MVM_FTM_INITIATOR_SECURE_LTF
 
Ál£


	)

108 
	#IWL_MVM_FTM_RESP_NDP_SUPPORT
 
åue


	)

109 
	#IWL_MVM_FTM_RESP_LMR_FEEDBACK_SUPPORT
 
åue


	)

110 
	#IWL_MVM_FTM_NON_TB_MIN_TIME_BETWEEN_MSR
 5

	)

111 
	#IWL_MVM_FTM_NON_TB_MAX_TIME_BETWEEN_MSR
 1000

	)

112 
	#IWL_MVM_D3_DEBUG
 
Ál£


	)

113 
	#IWL_MVM_USE_TWT
 
åue


	)

114 
	#IWL_MVM_AMPDU_CONSEC_DROPS_DELBA
 20

	)

115 
	#IWL_MVM_USE_NSSN_SYNC
 0

	)

116 
	#IWL_MVM_FTM_INITIATOR_ENABLE_SMOOTH
 
Ál£


	)

117 
	#IWL_MVM_FTM_INITIATOR_SMOOTH_ALPHA
 40

	)

119 
	#IWL_MVM_FTM_INITIATOR_SMOOTH_UNDERSHOOT
 20016

	)

120 
	#IWL_MVM_FTM_INITIATOR_SMOOTH_OVERSHOOT
 20016

	)

121 
	#IWL_MVM_FTM_INITIATOR_SMOOTH_AGE_SEC
 2

	)

122 
	#IWL_MVM_DISABLE_AP_FILS
 
Ál£


	)

123 
	#IWL_MVM_6GHZ_PASSIVE_SCAN_TIMEOUT
 3000

	)

124 
	#IWL_MVM_6GHZ_PASSIVE_SCAN_ASSOC_TIMEOUT
 60

	)

125 
	#IWL_MVM_AUTO_EML_ENABLE
 
åue


	)

	@mvm/d3.c

7 
	~<löux/ëhîdevi˚.h
>

8 
	~<löux/ù.h
>

9 
	~<löux/fs.h
>

10 
	~<√t/cfg80211.h
>

11 
	~<√t/ùv6.h
>

12 
	~<√t/t˝.h
>

13 
	~<√t/addrc⁄f.h
>

14 
	~"iwl-mod∑øms.h
"

15 
	~"fw-≠i.h
"

16 
	~"mvm.h
"

17 
	~"fw/img.h
"

19 
	$iwl_mvm_£t_ªkey_d©a
(
õì80211_hw
 *
hw
,

20 
õì80211_vif
 *
vif
,

21 
cfg80211_gtk_ªkey_d©a
 *
d©a
)

23 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

24 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

26 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

28 
	`muãx_lock
(&
mvm
->
muãx
);

30 
mvmvif
->
ªkey_d©a
.
kek_Àn
 = 
d©a
->kek_len;

31 
mvmvif
->
ªkey_d©a
.
kck_Àn
 = 
d©a
->kck_len;

32 
	`mem˝y
(
mvmvif
->
ªkey_d©a
.
kek
, 
d©a
->kek, d©a->
kek_Àn
);

33 
	`mem˝y
(
mvmvif
->
ªkey_d©a
.
kck
, 
d©a
->kck, d©a->
kck_Àn
);

34 
mvmvif
->
ªkey_d©a
.
akm
 = 
d©a
->akm & 0xFF;

35 
mvmvif
->
ªkey_d©a
.
ª∂ay_˘r
 =

36 
	`˝u_to_À64
(
	`be64_to_˝up
((c⁄° 
__be64
 *)
d©a
->
ª∂ay_˘r
));

37 
mvmvif
->
ªkey_d©a
.
vÆid
 = 
åue
;

39 
	`muãx_u∆ock
(&
mvm
->
muãx
);

40 
	}
}

42 #i‡
IS_ENABLED
(
CONFIG_IPV6
)

43 
	$iwl_mvm_ùv6_addr_ch™ge
(
õì80211_hw
 *
hw
,

44 
õì80211_vif
 *
vif
,

45 
öë6_dev
 *
idev
)

47 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

48 
öë6_iÁddr
 *
iÁ
;

49 
idx
 = 0;

51 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

53 
	`mem£t
(
mvmvif
->
ã¡©ive_addrs
, 0, (mvmvif->tentative_addrs));

55 
	`ªad_lock_bh
(&
idev
->
lock
);

56 
	`li°_f‹_óch_íåy
(
iÁ
, &
idev
->
addr_li°
, 
if_li°
) {

57 
mvmvif
->
èrgë_ùv6_addrs
[
idx
] = 
iÁ
->
addr
;

58 i‡(
iÁ
->
Êags
 & 
IFA_F_TENTATIVE
)

59 
	`__£t_bô
(
idx
, 
mvmvif
->
ã¡©ive_addrs
);

60 
idx
++;

61 i‡(
idx
 >
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_MAX
) {

62 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

66 
	`ªad_u∆ock_bh
(&
idev
->
lock
);

68 
mvmvif
->
num_èrgë_ùv6_addrs
 = 
idx
;

69 
	}
}

72 
	$iwl_mvm_£t_deÁu…_uniˇ°_key
(
õì80211_hw
 *
hw
,

73 
õì80211_vif
 *
vif
, 
idx
)

75 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

77 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

78 
mvmvif
->
tx_key_idx
 = 
idx
;

79 
	}
}

81 
	$iwl_mvm_c⁄vît_p1k
(
u16
 *
p1k
, 
__À16
 *
out
)

83 
i
;

85 
i
 = 0; i < 
IWL_P1K_SIZE
; i++)

86 
out
[
i
] = 
	`˝u_to_À16
(
p1k
[i]);

87 
	}
}

89 c⁄° 
u8
 *
	$iwl_mvm_föd_max_≤
(
õì80211_key_c⁄f
 *
key
,

90 
iwl_mvm_key_≤
 *
±k_≤
,

91 
õì80211_key_£q
 *
£q
,

92 
tid
, 
queues
)

94 c⁄° 
u8
 *
ªt
 = 
£q
->
ccmp
.
≤
;

95 
i
;

98 
	`õì80211_gë_key_rx_£q
(
key
, 
tid
, 
£q
);

101 
i
 = 1; i < 
queues
; i++) {

102 c⁄° 
u8
 *
tmp
 = 
±k_≤
->
q
[
i
].
≤
[
tid
];

104 i‡(
	`memcmp
(
ªt
, 
tmp
, 
IEEE80211_CCMP_PN_LEN
) <= 0)

105 
ªt
 = 
tmp
;

108  
ªt
;

109 
	}
}

111 
	swowœn_key_ª¥ogøm_d©a
 {

112 
boﬁ
 
	mîr‹
;

113 
	mwï_key_idx
;

116 
	$iwl_mvm_wowœn_¥ogøm_keys
(
õì80211_hw
 *
hw
,

117 
õì80211_vif
 *
vif
,

118 
õì80211_°a
 *
°a
,

119 
õì80211_key_c⁄f
 *
key
,

120 *
_d©a
)

122 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

123 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

124 
wowœn_key_ª¥ogøm_d©a
 *
d©a
 = 
_d©a
;

125 
ªt
;

127 
key
->
cùhî
) {

128 
WLAN_CIPHER_SUITE_WEP40
:

129 
WLAN_CIPHER_SUITE_WEP104
: {

131 
iwl_mvm_wï_key_cmd
 
wï_key_cmd
;

132 
iwl_mvm_wï_key
 
wï_key
;

133 } 
__∑cked
 
wkc
 = {

134 .
wï_key_cmd
.
mac_id_n_cﬁ‹
 =

135 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

136 
mvmvif
->
cﬁ‹
)),

137 .
wï_key_cmd
.
num_keys
 = 1,

139 .
wï_key_cmd
.
de¸y±i⁄_ty≥
 = 
STA_KEY_FLG_WEP
,

140 .
wï_key
.
key_ödex
 = 
key
->
keyidx
,

141 .
wï_key
.
key_size
 = 
key
->
keyÀn
,

149 i‡(
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)

152 
	`mem˝y
(&
wkc
.
wï_key
.
key
[3], key->key, key->
keyÀn
);

153 i‡(
key
->
keyidx
 =
mvmvif
->
tx_key_idx
) {

155 
wkc
.
wï_key
.
key_off£t
 = 0;

158 
d©a
->
wï_key_idx
++;

159 
wkc
.
wï_key
.
key_off£t
 = 
d©a
->
wï_key_idx
;

162 
	`muãx_lock
(&
mvm
->
muãx
);

163 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
WEP_KEY
, 0, (
wkc
), &wkc);

164 
d©a
->
îr‹
 = 
ªt
 != 0;

166 
mvm
->
±k_ivÀn
 = 
key
->
iv_Àn
;

167 
mvm
->
±k_icvÀn
 = 
key
->
icv_Àn
;

168 
mvm
->
gtk_ivÀn
 = 
key
->
iv_Àn
;

169 
mvm
->
gtk_icvÀn
 = 
key
->
icv_Àn
;

170 
	`muãx_u∆ock
(&
mvm
->
muãx
);

176 
d©a
->
îr‹
 = 
åue
;

178 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

179 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

181 
WLAN_CIPHER_SUITE_AES_CMAC
:

190 
WLAN_CIPHER_SUITE_TKIP
:

191 
WLAN_CIPHER_SUITE_CCMP
:

192 
WLAN_CIPHER_SUITE_GCMP
:

193 
WLAN_CIPHER_SUITE_GCMP_256
:

197 
	`muãx_lock
(&
mvm
->
muãx
);

202 i‡(
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
) {

203 
mvm
->
±k_ivÀn
 = 
key
->
iv_Àn
;

204 
mvm
->
±k_icvÀn
 = 
key
->
icv_Àn
;

205 
ªt
 = 
	`iwl_mvm_£t_°a_key
(
mvm
, 
vif
, 
°a
, 
key
, 0);

213 
mvm
->
gtk_ivÀn
 = 
key
->
iv_Àn
;

214 
mvm
->
gtk_icvÀn
 = 
key
->
icv_Àn
;

215 
ªt
 = 
	`iwl_mvm_£t_°a_key
(
mvm
, 
vif
, 
°a
, 
key
, 1);

217 
	`muãx_u∆ock
(&
mvm
->
muãx
);

218 
d©a
->
îr‹
 = 
ªt
 != 0;

219 
	}
}

221 
	swowœn_key_rsc_tsc_d©a
 {

222 
iwl_wowœn_rsc_tsc_∑øms_cmd_v4
 *
	mrsc_tsc
;

223 
boﬁ
 
	mhave_rsc_tsc
;

226 
	$iwl_mvm_wowœn_gë_rsc_tsc_d©a
(
õì80211_hw
 *
hw
,

227 
õì80211_vif
 *
vif
,

228 
õì80211_°a
 *
°a
,

229 
õì80211_key_c⁄f
 *
key
,

230 *
_d©a
)

232 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

233 
wowœn_key_rsc_tsc_d©a
 *
d©a
 = 
_d©a
;

234 
´s_sc
 *aes_sc;

235 
tkù_sc
 *tkù_sc, *
tkù_tx_sc
 = 
NULL
;

236 
õì80211_key_£q
 
£q
;

237 
i
;

239 
key
->
cùhî
) {

242 
WLAN_CIPHER_SUITE_TKIP
:

243 i‡(
°a
) {

244 
u64
 
≤64
;

246 
tkù_sc
 =

247 
d©a
->
rsc_tsc
->
∑øms
.
Æl_tsc_rsc
.
tkù
.
uniˇ°_rsc
;

248 
tkù_tx_sc
 =

249 &
d©a
->
rsc_tsc
->
∑øms
.
Æl_tsc_rsc
.
tkù
.
tsc
;

251 
≤64
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

252 
tkù_tx_sc
->
iv16
 = 
	`˝u_to_À16
(
	`TKIP_PN_TO_IV16
(
≤64
));

253 
tkù_tx_sc
->
iv32
 = 
	`˝u_to_À32
(
	`TKIP_PN_TO_IV32
(
≤64
));

255 
tkù_sc
 =

256 
d©a
->
rsc_tsc
->
∑øms
.
Æl_tsc_rsc
.
tkù
.
mu…iˇ°_rsc
;

264 
i
 = 0; i < 
IWL_NUM_RSC
; i++) {

265 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

266 
tkù_sc
[
i
].
iv16
 = 
	`˝u_to_À16
(
£q
.
tkù
.iv16);

267 
tkù_sc
[
i
].
iv32
 = 
	`˝u_to_À32
(
£q
.
tkù
.iv32);

270 
d©a
->
have_rsc_tsc
 = 
åue
;

272 
WLAN_CIPHER_SUITE_CCMP
:

273 
WLAN_CIPHER_SUITE_GCMP
:

274 
WLAN_CIPHER_SUITE_GCMP_256
:

275 i‡(
°a
) {

276 
´s_sc
 *
´s_tx_sc
;

277 
u64
 
≤64
;

279 
´s_sc
 =

280 
d©a
->
rsc_tsc
->
∑øms
.
Æl_tsc_rsc
.
´s
.
uniˇ°_rsc
;

281 
´s_tx_sc
 =

282 &
d©a
->
rsc_tsc
->
∑øms
.
Æl_tsc_rsc
.
´s
.
tsc
;

284 
≤64
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

285 
´s_tx_sc
->
≤
 = 
	`˝u_to_À64
(
≤64
);

287 
´s_sc
 =

288 
d©a
->
rsc_tsc
->
∑øms
.
Æl_tsc_rsc
.
´s
.
mu…iˇ°_rsc
;

295 i‡(
°a
 && 
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

296 
iwl_mvm_°a
 *
mvm°a
;

297 
iwl_mvm_key_≤
 *
±k_≤
;

298 c⁄° 
u8
 *
≤
;

300 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

301 
	`rcu_ªad_lock
();

302 
±k_≤
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->±k_≤[
key
->
keyidx
]);

303 i‡(
	`WARN_ON
(!
±k_≤
)) {

304 
	`rcu_ªad_u∆ock
();

308 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

309 
≤
 = 
	`iwl_mvm_föd_max_≤
(
key
, 
±k_≤
, &
£q
, 
i
,

310 
mvm
->
å™s
->
num_rx_queues
);

311 
´s_sc
[
i
].
≤
 = 
	`˝u_to_À64
((
u64
)pn[5] |

312 ((
u64
)
≤
[4] << 8) |

313 ((
u64
)
≤
[3] << 16) |

314 ((
u64
)
≤
[2] << 24) |

315 ((
u64
)
≤
[1] << 32) |

316 ((
u64
)
≤
[0] << 40));

319 
	`rcu_ªad_u∆ock
();

321 
i
 = 0; i < 
IWL_NUM_RSC
; i++) {

322 
u8
 *
≤
 = 
£q
.
ccmp
.pn;

324 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

325 
´s_sc
[
i
].
≤
 = 
	`˝u_to_À64
((
u64
)pn[5] |

326 ((
u64
)
≤
[4] << 8) |

327 ((
u64
)
≤
[3] << 16) |

328 ((
u64
)
≤
[2] << 24) |

329 ((
u64
)
≤
[1] << 32) |

330 ((
u64
)
≤
[0] << 40));

333 
d©a
->
have_rsc_tsc
 = 
åue
;

336 
	}
}

338 
	swowœn_key_rsc_v5_d©a
 {

339 
iwl_wowœn_rsc_tsc_∑øms_cmd
 *
	mrsc
;

340 
boﬁ
 
	mhave_rsc
;

341 
	mgtks
;

342 
	mgtk_ids
[4];

345 
	$iwl_mvm_wowœn_gë_rsc_v5_d©a
(
õì80211_hw
 *
hw
,

346 
õì80211_vif
 *
vif
,

347 
õì80211_°a
 *
°a
,

348 
õì80211_key_c⁄f
 *
key
,

349 *
_d©a
)

351 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

352 
wowœn_key_rsc_v5_d©a
 *
d©a
 = 
_d©a
;

353 
õì80211_key_£q
 
£q
;

354 
__À64
 *
rsc
;

355 
i
;

358 
key
->
cùhî
) {

361 
WLAN_CIPHER_SUITE_TKIP
:

362 
WLAN_CIPHER_SUITE_CCMP
:

363 
WLAN_CIPHER_SUITE_GCMP
:

364 
WLAN_CIPHER_SUITE_GCMP_256
:

368 i‡(
°a
) {

369 
rsc
 = 
d©a
->rsc->
uˇ°_rsc
;

371 i‡(
	`WARN_ON
(
d©a
->
gtks
 >
	`ARRAY_SIZE
(d©a->
gtk_ids
)))

373 
d©a
->
gtk_ids
[d©a->
gtks
] = 
key
->
keyidx
;

374 
rsc
 = 
d©a
->rsc->
mˇ°_rsc
[d©a->
gtks
 % 2];

375 i‡(
	`WARN_ON
(
key
->
keyidx
 >=

376 
	`ARRAY_SIZE
(
d©a
->
rsc
->
mˇ°_key_id_m≠
)))

378 
d©a
->
rsc
->
mˇ°_key_id_m≠
[
key
->
keyidx
] = d©a->
gtks
 % 2;

379 i‡(
d©a
->
gtks
 >= 2) {

380 
¥ev
 = 
d©a
->
gtks
 - 2;

381 
¥ev_idx
 = 
d©a
->
gtk_ids
[
¥ev
];

383 
d©a
->
rsc
->
mˇ°_key_id_m≠
[
¥ev_idx
] =

384 
IWL_MCAST_KEY_MAP_INVALID
;

386 
d©a
->
gtks
++;

389 
key
->
cùhî
) {

391 
	`WARN_ON
(1);

393 
WLAN_CIPHER_SUITE_TKIP
:

400 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

401 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

403 
rsc
[
i
] = 
	`˝u_to_À64
(((
u64
)
£q
.
tkù
.
iv32
 << 16) |

404 
£q
.
tkù
.
iv16
);

407 
d©a
->
have_rsc
 = 
åue
;

409 
WLAN_CIPHER_SUITE_CCMP
:

410 
WLAN_CIPHER_SUITE_GCMP
:

411 
WLAN_CIPHER_SUITE_GCMP_256
:

416 i‡(
°a
) {

417 
iwl_mvm_°a
 *
mvm°a
;

418 
iwl_mvm_key_≤
 *
±k_≤
;

419 c⁄° 
u8
 *
≤
;

421 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

422 
	`rcu_ªad_lock
();

423 
±k_≤
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->±k_≤[
key
->
keyidx
]);

424 i‡(
	`WARN_ON
(!
±k_≤
)) {

425 
	`rcu_ªad_u∆ock
();

429 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

430 
≤
 = 
	`iwl_mvm_föd_max_≤
(
key
, 
±k_≤
, &
£q
, 
i
,

431 
mvm
->
å™s
->
num_rx_queues
);

432 
rsc
[
i
] = 
	`˝u_to_À64
((
u64
)
≤
[5] |

433 ((
u64
)
≤
[4] << 8) |

434 ((
u64
)
≤
[3] << 16) |

435 ((
u64
)
≤
[2] << 24) |

436 ((
u64
)
≤
[1] << 32) |

437 ((
u64
)
≤
[0] << 40));

440 
	`rcu_ªad_u∆ock
();

442 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

443 
u8
 *
≤
 = 
£q
.
ccmp
.pn;

445 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

446 
rsc
[
i
] = 
	`˝u_to_À64
((
u64
)
≤
[5] |

447 ((
u64
)
≤
[4] << 8) |

448 ((
u64
)
≤
[3] << 16) |

449 ((
u64
)
≤
[2] << 24) |

450 ((
u64
)
≤
[1] << 32) |

451 ((
u64
)
≤
[0] << 40));

454 
d©a
->
have_rsc
 = 
åue
;

457 
	}
}

459 
	$iwl_mvm_wowœn_c⁄fig_rsc_tsc
(
iwl_mvm
 *
mvm
,

460 
õì80211_vif
 *
vif
,

461 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
)

463 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
WOWLAN_TSC_RSC_PARAM
,

464 
IWL_FW_CMD_VER_UNKNOWN
);

465 
ªt
;

467 i‡(
vî
 == 5) {

468 
wowœn_key_rsc_v5_d©a
 
d©a
 = {};

469 
i
;

471 
d©a
.
rsc
 = 
	`kzÆloc
((*d©a.rsc), 
GFP_KERNEL
);

472 i‡(!
d©a
.
rsc
)

473  -
ENOMEM
;

475 
i
 = 0; i < 
	`ARRAY_SIZE
(
d©a
.
rsc
->
mˇ°_key_id_m≠
); i++)

476 
d©a
.
rsc
->
mˇ°_key_id_m≠
[
i
] =

477 
IWL_MCAST_KEY_MAP_INVALID
;

478 
d©a
.
rsc
->
°a_id
 = 
	`˝u_to_À32
(
mvm_lök
->
≠_°a_id
);

480 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
,

481 
iwl_mvm_wowœn_gë_rsc_v5_d©a
,

482 &
d©a
);

484 i‡(
d©a
.
have_rsc
)

485 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
WOWLAN_TSC_RSC_PARAM
,

486 
CMD_ASYNC
, (*
d©a
.
rsc
),

487 
d©a
.
rsc
);

489 
ªt
 = 0;

490 
	`k‰ì
(
d©a
.
rsc
);

491 } i‡(
vî
 =4 || vî =2 || vî =
IWL_FW_CMD_VER_UNKNOWN
) {

492 
wowœn_key_rsc_tsc_d©a
 
d©a
 = {};

493 
size
;

495 
d©a
.
rsc_tsc
 = 
	`kzÆloc
((*d©a.rsc_tsc), 
GFP_KERNEL
);

496 i‡(!
d©a
.
rsc_tsc
)

497  -
ENOMEM
;

499 i‡(
vî
 == 4) {

500 
size
 = (*
d©a
.
rsc_tsc
);

501 
d©a
.
rsc_tsc
->
°a_id
 =

502 
	`˝u_to_À32
(
mvm_lök
->
≠_°a_id
);

505 
size
 = (
d©a
.
rsc_tsc
->
∑øms
);

508 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
,

509 
iwl_mvm_wowœn_gë_rsc_tsc_d©a
,

510 &
d©a
);

512 i‡(
d©a
.
have_rsc_tsc
)

513 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
WOWLAN_TSC_RSC_PARAM
,

514 
CMD_ASYNC
, 
size
,

515 
d©a
.
rsc_tsc
);

517 
ªt
 = 0;

518 
	`k‰ì
(
d©a
.
rsc_tsc
);

520 
ªt
 = 0;

521 
	`WARN_ON_ONCE
(1);

524  
ªt
;

525 
	}
}

527 
	swowœn_key_tkù_d©a
 {

528 
iwl_wowœn_tkù_∑øms_cmd
 
	mtkù
;

529 
boﬁ
 
	mhave_tkù_keys
;

532 
	$iwl_mvm_wowœn_gë_tkù_d©a
(
õì80211_hw
 *
hw
,

533 
õì80211_vif
 *
vif
,

534 
õì80211_°a
 *
°a
,

535 
õì80211_key_c⁄f
 *
key
,

536 *
_d©a
)

538 
wowœn_key_tkù_d©a
 *
d©a
 = 
_d©a
;

539 
iwl_p1k_ˇche
 *
rx_p1ks
;

540 
u8
 *
rx_mic_key
;

541 
õì80211_key_£q
 
£q
;

542 
u32
 
cur_rx_iv32
 = 0;

543 
u16
 
p1k
[
IWL_P1K_SIZE
];

544 
i
;

546 
key
->
cùhî
) {

549 
WLAN_CIPHER_SUITE_TKIP
:

550 i‡(
°a
) {

551 
u64
 
≤64
;

553 
rx_p1ks
 = 
d©a
->
tkù
.
rx_uni
;

555 
≤64
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

557 
	`õì80211_gë_tkù_p1k_iv
(
key
, 
	`TKIP_PN_TO_IV32
(
≤64
),

558 
p1k
);

559 
	`iwl_mvm_c⁄vît_p1k
(
p1k
, 
d©a
->
tkù
.
tx
.p1k);

561 
	`mem˝y
(
d©a
->
tkù
.
mic_keys
.
tx
,

562 &
key
->key[
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
],

563 
IWL_MIC_KEY_SIZE
);

565 
rx_mic_key
 = 
d©a
->
tkù
.
mic_keys
.
rx_uniˇ°
;

567 
rx_p1ks
 = 
d©a
->
tkù
.
rx_mu…i
;

568 
rx_mic_key
 = 
d©a
->
tkù
.
mic_keys
.
rx_mˇ°
;

571 
i
 = 0; i < 
IWL_NUM_RSC
; i++) {

572 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

574 i‡(
£q
.
tkù
.
iv32
 > 
cur_rx_iv32
)

575 
cur_rx_iv32
 = 
£q
.
tkù
.
iv32
;

578 
	`õì80211_gë_tkù_rx_p1k
(
key
, 
vif
->
bss_c⁄f
.
bssid
,

579 
cur_rx_iv32
, 
p1k
);

580 
	`iwl_mvm_c⁄vît_p1k
(
p1k
, 
rx_p1ks
[0].p1k);

581 
	`õì80211_gë_tkù_rx_p1k
(
key
, 
vif
->
bss_c⁄f
.
bssid
,

582 
cur_rx_iv32
 + 1, 
p1k
);

583 
	`iwl_mvm_c⁄vît_p1k
(
p1k
, 
rx_p1ks
[1].p1k);

585 
	`mem˝y
(
rx_mic_key
,

586 &
key
->key[
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
],

587 
IWL_MIC_KEY_SIZE
);

589 
d©a
->
have_tkù_keys
 = 
åue
;

592 
	}
}

594 
	swowœn_key_gtk_ty≥_ôî
 {

595 
iwl_wowœn_kek_kck_m©îül_cmd_v4
 *
	mkek_kck_cmd
;

598 
	$iwl_mvm_wowœn_gtk_ty≥_ôî
(
õì80211_hw
 *
hw
,

599 
õì80211_vif
 *
vif
,

600 
õì80211_°a
 *
°a
,

601 
õì80211_key_c⁄f
 *
key
,

602 *
_d©a
)

604 
wowœn_key_gtk_ty≥_ôî
 *
d©a
 = 
_d©a
;

606 
key
->
cùhî
) {

609 
WLAN_CIPHER_SUITE_TKIP
:

610 i‡(!
°a
)

611 
d©a
->
kek_kck_cmd
->
gtk_cùhî
 =

612 
	`˝u_to_À32
(
STA_KEY_FLG_TKIP
);

614 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

615 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

616 
d©a
->
kek_kck_cmd
->
igtk_cùhî
 = 
	`˝u_to_À32
(
STA_KEY_FLG_GCMP
);

618 
WLAN_CIPHER_SUITE_AES_CMAC
:

619 
d©a
->
kek_kck_cmd
->
igtk_cùhî
 = 
	`˝u_to_À32
(
STA_KEY_FLG_CCM
);

621 
WLAN_CIPHER_SUITE_CCMP
:

622 i‡(!
°a
)

623 
d©a
->
kek_kck_cmd
->
gtk_cùhî
 =

624 
	`˝u_to_À32
(
STA_KEY_FLG_CCM
);

626 
WLAN_CIPHER_SUITE_GCMP
:

627 
WLAN_CIPHER_SUITE_GCMP_256
:

628 i‡(!
°a
)

629 
d©a
->
kek_kck_cmd
->
gtk_cùhî
 =

630 
	`˝u_to_À32
(
STA_KEY_FLG_GCMP
);

633 
	}
}

635 
	$iwl_mvm_£nd_∑âîns_v1
(
iwl_mvm
 *
mvm
,

636 
cfg80211_wowœn
 *
wowœn
)

638 
iwl_wowœn_∑âîns_cmd_v1
 *
∑âîn_cmd
;

639 
iwl_ho°_cmd
 
cmd
 = {

640 .
id
 = 
WOWLAN_PATTERNS
,

641 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

643 
i
, 
îr
;

645 i‡(!
wowœn
->
n_∑âîns
)

648 
cmd
.
Àn
[0] = 
	`°ru˘_size
(
∑âîn_cmd
, 
∑âîns
, 
wowœn
->
n_∑âîns
);

650 
∑âîn_cmd
 = 
	`kmÆloc
(
cmd
.
Àn
[0], 
GFP_KERNEL
);

651 i‡(!
∑âîn_cmd
)

652  -
ENOMEM
;

654 
∑âîn_cmd
->
n_∑âîns
 = 
	`˝u_to_À32
(
wowœn
->n_patterns);

656 
i
 = 0; i < 
wowœn
->
n_∑âîns
; i++) {

657 
mask_Àn
 = 
	`DIV_ROUND_UP
(
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
, 8);

659 
	`mem˝y
(&
∑âîn_cmd
->
∑âîns
[
i
].
mask
,

660 
wowœn
->
∑âîns
[
i
].
mask
, 
mask_Àn
);

661 
	`mem˝y
(&
∑âîn_cmd
->
∑âîns
[
i
].
∑âîn
,

662 
wowœn
->
∑âîns
[
i
].
∑âîn
,

663 
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
);

664 
∑âîn_cmd
->
∑âîns
[
i
].
mask_size
 = 
mask_Àn
;

665 
∑âîn_cmd
->
∑âîns
[
i
].
∑âîn_size
 =

666 
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
;

669 
cmd
.
d©a
[0] = 
∑âîn_cmd
;

670 
îr
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

671 
	`k‰ì
(
∑âîn_cmd
);

672  
îr
;

673 
	}
}

675 
	$iwl_mvm_£nd_∑âîns
(
iwl_mvm
 *
mvm
,

676 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
,

677 
cfg80211_wowœn
 *
wowœn
)

679 
iwl_wowœn_∑âîns_cmd
 *
∑âîn_cmd
;

680 
iwl_ho°_cmd
 
cmd
 = {

681 .
id
 = 
WOWLAN_PATTERNS
,

682 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

684 
i
, 
îr
;

685 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd
.
id
,

686 
IWL_FW_CMD_VER_UNKNOWN
);

688 i‡(!
wowœn
->
n_∑âîns
)

691 
cmd
.
Àn
[0] = (*
∑âîn_cmd
) +

692 
wowœn
->
n_∑âîns
 * (
iwl_wowœn_∑âîn_v2
);

694 
∑âîn_cmd
 = 
	`kzÆloc
(
cmd
.
Àn
[0], 
GFP_KERNEL
);

695 i‡(!
∑âîn_cmd
)

696  -
ENOMEM
;

698 
∑âîn_cmd
->
n_∑âîns
 = 
wowœn
->n_patterns;

699 i‡(
vî
 >= 3)

700 
∑âîn_cmd
->
°a_id
 = 
mvm_lök
->
≠_°a_id
;

702 
i
 = 0; i < 
wowœn
->
n_∑âîns
; i++) {

703 
mask_Àn
 = 
	`DIV_ROUND_UP
(
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
, 8);

705 
∑âîn_cmd
->
∑âîns
[
i
].
∑âîn_ty≥
 =

706 
WOWLAN_PATTERN_TYPE_BITMASK
;

708 
	`mem˝y
(&
∑âîn_cmd
->
∑âîns
[
i
].
u
.
bômask
.
mask
,

709 
wowœn
->
∑âîns
[
i
].
mask
, 
mask_Àn
);

710 
	`mem˝y
(&
∑âîn_cmd
->
∑âîns
[
i
].
u
.
bômask
.
∑âîn
,

711 
wowœn
->
∑âîns
[
i
].
∑âîn
,

712 
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
);

713 
∑âîn_cmd
->
∑âîns
[
i
].
u
.
bômask
.
mask_size
 = 
mask_Àn
;

714 
∑âîn_cmd
->
∑âîns
[
i
].
u
.
bômask
.
∑âîn_size
 =

715 
wowœn
->
∑âîns
[
i
].
∑âîn_Àn
;

718 
cmd
.
d©a
[0] = 
∑âîn_cmd
;

719 
îr
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

720 
	`k‰ì
(
∑âîn_cmd
);

721  
îr
;

722 
	}
}

724 
	$iwl_mvm_d3_ª¥ogøm
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

725 
õì80211_°a
 *
≠_°a
)

727 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

728 
õì80211_ch™˘x_c⁄f
 *
˘x
;

729 
u8
 
chaös_°©ic
, 
chaös_dy«mic
;

730 
cfg80211_ch™_def
 
ch™def
, 
≠_def
;

731 
ªt
, 
i
;

732 
iwl_bödög_cmd_v1
 
bödög_cmd
 = {};

733 
iwl_time_quŸa_cmd
 
quŸa_cmd
 = {};

734 
iwl_time_quŸa_d©a
 *
quŸa
;

735 
u32
 
°©us
;

737 i‡(
	`WARN_ON_ONCE
(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) ||

738 
	`õì80211_vif_is_mld
(
vif
)))

739  -
EINVAL
;

742 i‡(
	`WARN_ON
(!
mvmvif
->
deÊök
.
phy_˘xt
))

743  -
EINVAL
;

745 
	`rcu_ªad_lock
();

746 
˘x
 = 
	`rcu_dîe„ªn˚
(
vif
->
bss_c⁄f
.
ch™˘x_c⁄f
);

747 i‡(
	`WARN_ON
(!
˘x
)) {

748 
	`rcu_ªad_u∆ock
();

749  -
EINVAL
;

751 
ch™def
 = 
˘x
->
def
;

752 
≠_def
 = 
˘x
->
≠
;

753 
chaös_°©ic
 = 
˘x
->
rx_chaös_°©ic
;

754 
chaös_dy«mic
 = 
˘x
->
rx_chaös_dy«mic
;

755 
	`rcu_ªad_u∆ock
();

757 
ªt
 = 
	`iwl_mvm_phy_˘xt_add
(
mvm
, 
mvmvif
->
deÊök
.
phy_˘xt
, &
ch™def
,

758 &
≠_def
, 
chaös_°©ic
, 
chaös_dy«mic
);

759 i‡(
ªt
)

760  
ªt
;

763 
mvmvif
->
u∂ﬂded
 = 
Ál£
;

765 i‡(
	`WARN_ON
(!
vif
->
cfg
.
assoc
))

766  -
EINVAL
;

768 
ªt
 = 
	`iwl_mvm_mac_˘xt_add
(
mvm
, 
vif
);

769 i‡(
ªt
)

770  
ªt
;

773 
bödög_cmd
.
id_™d_cﬁ‹
 =

774 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
deÊök
.
phy_˘xt
->
id
,

775 
mvmvif
->
deÊök
.
phy_˘xt
->
cﬁ‹
));

776 
bödög_cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
);

777 
bödög_cmd
.
phy
 =

778 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
deÊök
.
phy_˘xt
->
id
,

779 
mvmvif
->
deÊök
.
phy_˘xt
->
cﬁ‹
));

780 
bödög_cmd
.
macs
[0] = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

781 
mvmvif
->
cﬁ‹
));

782 
i
 = 1; i < 
MAX_MACS_IN_BINDING
; i++)

783 
bödög_cmd
.
macs
[
i
] = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

785 
°©us
 = 0;

786 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
BINDING_CONTEXT_CMD
,

787 
IWL_BINDING_CMD_SIZE_V1
, &
bödög_cmd
,

788 &
°©us
);

789 i‡(
ªt
) {

790 
	`IWL_ERR
(
mvm
, "FaûedÅÿadd bödög: %d\n", 
ªt
);

791  
ªt
;

794 i‡(
°©us
) {

795 
	`IWL_ERR
(
mvm
, "Bödög comm™d faûed: %u\n", 
°©us
);

796  -
EIO
;

799 
ªt
 = 
	`iwl_mvm_°a_£nd_to_fw
(
mvm
, 
≠_°a
, 
Ál£
, 0);

800 i‡(
ªt
)

801  
ªt
;

802 
	`rcu_assign_poöãr
(
mvm
->
fw_id_to_mac_id
[
mvmvif
->
deÊök
.
≠_°a_id
],

803 
≠_°a
);

805 
ªt
 = 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
);

806 i‡(
ªt
)

807  
ªt
;

810 
quŸa
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, &
quŸa_cmd
, 0);

811 
quŸa
->
id_™d_cﬁ‹
 =

812 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
deÊök
.
phy_˘xt
->
id
,

813 
mvmvif
->
deÊök
.
phy_˘xt
->
cﬁ‹
));

814 
quŸa
->quŸ®
	`˝u_to_À32
(
IWL_MVM_MAX_QUOTA
);

815 
quŸa
->
max_duøti⁄
 = 
	`˝u_to_À32
(
IWL_MVM_MAX_QUOTA
);

817 
i
 = 1; i < 
MAX_BINDINGS
; i++) {

818 
quŸa
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, &
quŸa_cmd
, 
i
);

819 
quŸa
->
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

822 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TIME_QUOTA_CMD
, 0,

823 
	`iwl_mvm_quŸa_cmd_size
(
mvm
), &
quŸa_cmd
);

824 i‡(
ªt
)

825 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd quŸa: %d\n", 
ªt
);

827 i‡(
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
Ë&& 
	`iwl_mvm_öô_fw_ªgd
(mvm, 
Ál£
))

828 
	`IWL_ERR
(
mvm
, "FailedÅo initialize D3 LAR information\n");

831 
	}
}

833 
	$iwl_mvm_gë_œ°_n⁄qos_£q
(
iwl_mvm
 *
mvm
,

834 
õì80211_vif
 *
vif
)

836 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

837 
iwl_n⁄qos_£q_quîy_cmd
 
quîy_cmd
 = {

838 .
gë_£t_Êag
 = 
	`˝u_to_À32
(
IWL_NONQOS_SEQ_GET
),

839 .
mac_id_n_cﬁ‹
 =

840 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

841 
mvmvif
->
cﬁ‹
)),

843 
iwl_ho°_cmd
 
cmd
 = {

844 .
id
 = 
NON_QOS_TX_COUNTER_CMD
,

845 .
Êags
 = 
CMD_WANT_SKB
,

847 
îr
;

848 
u32
 
size
;

850 
cmd
.
d©a
[0] = &
quîy_cmd
;

851 
cmd
.
Àn
[0] = (
quîy_cmd
);

853 
îr
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

854 i‡(
îr
)

855  
îr
;

857 
size
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
cmd
.
ª•_pkt
);

858 i‡(
size
 < (
__À16
)) {

859 
îr
 = -
EINVAL
;

861 
îr
 = 
	`À16_to_˝up
((
__À16
 *)
cmd
.
ª•_pkt
->
d©a
);

863 
îr
 = (
u16
) (err - 0x10);

866 
	`iwl_‰ì_ª•
(&
cmd
);

867  
îr
;

868 
	}
}

870 
	$iwl_mvm_£t_œ°_n⁄qos_£q
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

872 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

873 
iwl_n⁄qos_£q_quîy_cmd
 
quîy_cmd
 = {

874 .
gë_£t_Êag
 = 
	`˝u_to_À32
(
IWL_NONQOS_SEQ_SET
),

875 .
mac_id_n_cﬁ‹
 =

876 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

877 
mvmvif
->
cﬁ‹
)),

878 .
vÆue
 = 
	`˝u_to_À16
(
mvmvif
->
£qno
),

882 i‡(!
mvmvif
->
£qno_vÆid
)

885 
mvmvif
->
£qno_vÆid
 = 
Ál£
;

887 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
NON_QOS_TX_COUNTER_CMD
, 0,

888 (
quîy_cmd
), &query_cmd))

889 
	`IWL_ERR
(
mvm
, "failedÅo setÇon-QoS seqno\n");

890 
	}
}

892 
	$iwl_mvm_swôch_to_d3
(
iwl_mvm
 *
mvm
)

894 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_REGULAR
, 
åue
);

896 
	`iwl_mvm_°›_devi˚
(
mvm
);

907 
	`£t_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
);

910 
	`mem£t
(
mvm
->
fw_key_èbÀ
, 0, (mvm->fw_key_table));

912 
mvm
->
±k_ivÀn
 = 0;

913 
mvm
->
±k_icvÀn
 = 0;

914 
mvm
->
±k_ivÀn
 = 0;

915 
mvm
->
±k_icvÀn
 = 0;

917  
	`iwl_mvm_lﬂd_d3_fw
(
mvm
);

918 
	}
}

921 
	$iwl_mvm_gë_wowœn_c⁄fig
(
iwl_mvm
 *
mvm
,

922 
cfg80211_wowœn
 *
wowœn
,

923 
iwl_wowœn_c⁄fig_cmd
 *
wowœn_c⁄fig_cmd
,

924 
õì80211_vif
 *
vif
, 
iwl_mvm_vif
 *
mvmvif
,

925 
õì80211_°a
 *
≠_°a
)

927 
iwl_mvm_°a
 *
mvm_≠_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
≠_°a
);

931 
wowœn_c⁄fig_cmd
->
is_11n_c⁄√˘i⁄
 =

932 
≠_°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
;

933 
wowœn_c⁄fig_cmd
->
Êags
 = 
ENABLE_L3_FILTERING
 |

934 
ENABLE_NBNS_FILTERING
 | 
ENABLE_DHCP_FILTERING
;

936 i‡(
≠_°a
->
mÂ
)

937 
wowœn_c⁄fig_cmd
->
Êags
 |
IS_11W_ASSOC
;

939 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
WOWLAN_CONFIGURATION
, 0) < 6) {

941 
ªt
 = 
	`iwl_mvm_gë_œ°_n⁄qos_£q
(
mvm
, 
vif
);

943 i‡(
ªt
 < 0)

944  
ªt
;

946 
wowœn_c⁄fig_cmd
->
n⁄_qos_£q
 = 
	`˝u_to_À16
(
ªt
);

949 
	`iwl_mvm_£t_wowœn_qos_£q
(
mvm_≠_°a
, 
wowœn_c⁄fig_cmd
);

951 i‡(
wowœn
->
disc⁄√˘
)

952 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

953 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_BEACON_MISS
 |

954 
IWL_WOWLAN_WAKEUP_LINK_CHANGE
);

955 i‡(
wowœn
->
magic_pkt
)

956 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

957 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_MAGIC_PACKET
);

958 i‡(
wowœn
->
gtk_ªkey_Áûuª
)

959 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

960 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_GTK_REKEY_FAIL
);

961 i‡(
wowœn
->
óp_idítôy_ªq
)

962 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

963 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_EAP_IDENT_REQ
);

964 i‡(
wowœn
->
four_way_h™dshake
)

965 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

966 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_4WAY_HANDSHAKE
);

967 i‡(
wowœn
->
n_∑âîns
)

968 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

969 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_PATTERN_MATCH
);

971 i‡(
wowœn
->
rfkûl_ªÀa£
)

972 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

973 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_RF_KILL_DEASSERT
);

975 i‡(
wowœn
->
t˝
) {

980 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

981 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_REMOTE_LINK_LOSS
 |

982 
IWL_WOWLAN_WAKEUP_REMOTE_SIGNATURE_TABLE
 |

983 
IWL_WOWLAN_WAKEUP_REMOTE_WAKEUP_PACKET
 |

984 
IWL_WOWLAN_WAKEUP_LINK_CHANGE
);

987 i‡(
wowœn
->
™y
) {

988 
wowœn_c⁄fig_cmd
->
wakeup_fûãr
 |=

989 
	`˝u_to_À32
(
IWL_WOWLAN_WAKEUP_BEACON_MISS
 |

990 
IWL_WOWLAN_WAKEUP_LINK_CHANGE
 |

991 
IWL_WOWLAN_WAKEUP_RX_FRAME
 |

992 
IWL_WOWLAN_WAKEUP_BCN_FILTERING
);

996 
	}
}

998 
	$iwl_mvm_wowœn_c⁄fig_key_∑øms
(
iwl_mvm
 *
mvm
,

999 
õì80211_vif
 *
vif
,

1000 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
)

1002 
boﬁ
 
unifõd
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1003 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

1004 
wowœn_key_ª¥ogøm_d©a
 
key_d©a
 = {};

1005 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1006 
ªt
;

1007 
u8
 
cmd_vî
;

1008 
size_t
 
cmd_size
;

1010 i‡(!
unifõd
) {

1022 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
, 
iwl_mvm_wowœn_¥ogøm_keys
,

1023 &
key_d©a
);

1025 i‡(
key_d©a
.
îr‹
)

1026  -
EIO
;

1029 
ªt
 = 
	`iwl_mvm_wowœn_c⁄fig_rsc_tsc
(
mvm
, 
vif
, 
mvm_lök
);

1030 i‡(
ªt
)

1031  
ªt
;

1033 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1034 
IWL_UCODE_TLV_API_TKIP_MIC_KEYS
)) {

1035 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
WOWLAN_TKIP_PARAM
,

1036 
IWL_FW_CMD_VER_UNKNOWN
);

1037 
wowœn_key_tkù_d©a
 
tkù_d©a
 = {};

1038 
size
;

1040 i‡(
vî
 == 2) {

1041 
size
 = (
tkù_d©a
.
tkù
);

1042 
tkù_d©a
.
tkù
.
°a_id
 =

1043 
	`˝u_to_À32
(
mvm_lök
->
≠_°a_id
);

1044 } i‡(
vî
 =1 || vî =
IWL_FW_CMD_VER_UNKNOWN
) {

1045 
size
 = (
iwl_wowœn_tkù_∑øms_cmd_vî_1
);

1047 
	`WARN_ON_ONCE
(1);

1048  -
EINVAL
;

1051 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
, 
iwl_mvm_wowœn_gë_tkù_d©a
,

1052 &
tkù_d©a
);

1054 i‡(
tkù_d©a
.
have_tkù_keys
) {

1056 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1057 
WOWLAN_TKIP_PARAM
,

1058 
CMD_ASYNC
, 
size
,

1059 &
tkù_d©a
.
tkù
);

1060 i‡(
ªt
)

1061  
ªt
;

1066 i‡(
mvmvif
->
ªkey_d©a
.
vÆid
) {

1067 
iwl_wowœn_kek_kck_m©îül_cmd_v4
 
kek_kck_cmd
 = {};

1068 
iwl_wowœn_kek_kck_m©îül_cmd_v4
 *
_kek_kck_cmd
 =

1069 &
kek_kck_cmd
;

1070 
wowœn_key_gtk_ty≥_ôî
 
gtk_ty≥_d©a
 = {

1071 .
kek_kck_cmd
 = 
_kek_kck_cmd
,

1074 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1075 
WOWLAN_KEK_KCK_MATERIAL
,

1076 
IWL_FW_CMD_VER_UNKNOWN
);

1077 i‡(
	`WARN_ON
(
cmd_vî
 != 2 && cmd_ver != 3 && cmd_ver != 4 &&

1078 
cmd_vî
 !
IWL_FW_CMD_VER_UNKNOWN
))

1079  -
EINVAL
;

1081 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
, 
iwl_mvm_wowœn_gtk_ty≥_ôî
,

1082 &
gtk_ty≥_d©a
);

1084 
	`mem˝y
(
kek_kck_cmd
.
kck
, 
mvmvif
->
ªkey_d©a
.kck,

1085 
mvmvif
->
ªkey_d©a
.
kck_Àn
);

1086 
kek_kck_cmd
.
kck_Àn
 = 
	`˝u_to_À16
(
mvmvif
->
ªkey_d©a
.kck_len);

1087 
	`mem˝y
(
kek_kck_cmd
.
kek
, 
mvmvif
->
ªkey_d©a
.kek,

1088 
mvmvif
->
ªkey_d©a
.
kek_Àn
);

1089 
kek_kck_cmd
.
kek_Àn
 = 
	`˝u_to_À16
(
mvmvif
->
ªkey_d©a
.kek_len);

1090 
kek_kck_cmd
.
ª∂ay_˘r
 = 
mvmvif
->
ªkey_d©a
.replay_ctr;

1091 
kek_kck_cmd
.
akm
 = 
	`˝u_to_À32
(
mvmvif
->
ªkey_d©a
.akm);

1092 
kek_kck_cmd
.
°a_id
 = 
	`˝u_to_À32
(
mvm_lök
->
≠_°a_id
);

1094 i‡(
cmd_vî
 == 4) {

1095 
cmd_size
 = (
iwl_wowœn_kek_kck_m©îül_cmd_v4
);

1097 i‡(
cmd_vî
 == 3)

1098 
cmd_size
 =

1099 (
iwl_wowœn_kek_kck_m©îül_cmd_v3
);

1101 
cmd_size
 =

1102 (
iwl_wowœn_kek_kck_m©îül_cmd_v2
);

1104 
_kek_kck_cmd
 = (*)

1105 ((
u8
 *)
_kek_kck_cmd
 + (
kek_kck_cmd
.
°a_id
));

1108 
	`IWL_DEBUG_WOWLAN
(
mvm
, "settingákm %d\n",

1109 
mvmvif
->
ªkey_d©a
.
akm
);

1111 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
WOWLAN_KEK_KCK_MATERIAL
,

1112 
CMD_ASYNC
, 
cmd_size
, 
_kek_kck_cmd
);

1113 i‡(
ªt
)

1114  
ªt
;

1118 
	}
}

1121 
	$iwl_mvm_wowœn_c⁄fig
(
iwl_mvm
 *
mvm
,

1122 
cfg80211_wowœn
 *
wowœn
,

1123 
iwl_wowœn_c⁄fig_cmd
 *
wowœn_c⁄fig_cmd
,

1124 
õì80211_vif
 *
vif
, 
iwl_mvm_vif
 *
mvmvif
,

1125 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
,

1126 
õì80211_°a
 *
≠_°a
)

1128 
ªt
;

1129 
boﬁ
 
unifõd_image
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1130 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

1132 
mvm
->
ofÊﬂd_tid
 = 
wowœn_c⁄fig_cmd
->
ofÊﬂdög_tid
;

1134 i‡(!
unifõd_image
) {

1135 
ªt
 = 
	`iwl_mvm_swôch_to_d3
(
mvm
);

1136 i‡(
ªt
)

1137  
ªt
;

1139 
ªt
 = 
	`iwl_mvm_d3_ª¥ogøm
(
mvm
, 
vif
, 
≠_°a
);

1140 i‡(
ªt
)

1141  
ªt
;

1144 
ªt
 = 
	`iwl_mvm_wowœn_c⁄fig_key_∑øms
(
mvm
, 
vif
, 
mvm_lök
);

1145 i‡(
ªt
)

1146  
ªt
;

1148 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
WOWLAN_CONFIGURATION
, 0,

1149 (*
wowœn_c⁄fig_cmd
),

1150 
wowœn_c⁄fig_cmd
);

1151 i‡(
ªt
)

1152  
ªt
;

1154 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1155 
IWL_UCODE_TLV_API_WOWLAN_TCP_SYN_WAKE
))

1156 
ªt
 = 
	`iwl_mvm_£nd_∑âîns
(
mvm
, 
mvm_lök
, 
wowœn
);

1158 
ªt
 = 
	`iwl_mvm_£nd_∑âîns_v1
(
mvm
, 
wowœn
);

1159 i‡(
ªt
)

1160  
ªt
;

1162  
	`iwl_mvm_£nd_¥Ÿo_ofÊﬂd
(
mvm
, 
vif
, 
Ál£
, 
åue
, 0);

1163 
	}
}

1166 
	$iwl_mvm_√tdëe˘_c⁄fig
(
iwl_mvm
 *
mvm
,

1167 
cfg80211_wowœn
 *
wowœn
,

1168 
cfg80211_sched_sˇn_ªque°
 *
nd_c⁄fig
,

1169 
õì80211_vif
 *
vif
)

1171 
ªt
;

1172 
boﬁ
 
unifõd_image
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1173 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

1175 i‡(!
unifõd_image
) {

1176 
ªt
 = 
	`iwl_mvm_swôch_to_d3
(
mvm
);

1177 i‡(
ªt
)

1178  
ªt
;

1185 
ªt
 = 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_SCHED
, 
åue
);

1186 i‡(
ªt
)

1187  
ªt
;

1190 
ªt
 = 
	`iwl_mvm_sched_sˇn_°¨t
(
mvm
, 
vif
, 
nd_c⁄fig
, &mvm->
nd_õs
,

1191 
IWL_MVM_SCAN_NETDETECT
);

1192 i‡(
ªt
)

1193  
ªt
;

1195 i‡(
	`WARN_ON
(
mvm
->
nd_m©ch_£ts
 || mvm->
nd_ch™√ls
))

1196  -
EBUSY
;

1199 i‡(
nd_c⁄fig
->
n_m©ch_£ts
) {

1200 
mvm
->
nd_m©ch_£ts
 = 
	`kmemdup
(
nd_c⁄fig
->
m©ch_£ts
,

1201 (*
nd_c⁄fig
->
m©ch_£ts
) *

1202 
nd_c⁄fig
->
n_m©ch_£ts
,

1203 
GFP_KERNEL
);

1204 i‡(
mvm
->
nd_m©ch_£ts
)

1205 
mvm
->
n_nd_m©ch_£ts
 = 
nd_c⁄fig
->
n_m©ch_£ts
;

1209 
mvm
->
nd_ch™√ls
 = 
	`kmemdup
(
nd_c⁄fig
->
ch™√ls
,

1210 (*
nd_c⁄fig
->
ch™√ls
) *

1211 
nd_c⁄fig
->
n_ch™√ls
,

1212 
GFP_KERNEL
);

1213 i‡(
mvm
->
nd_ch™√ls
)

1214 
mvm
->
n_nd_ch™√ls
 = 
nd_c⁄fig
->
n_ch™√ls
;

1217 
	}
}

1219 
	$iwl_mvm_‰ì_nd
(
iwl_mvm
 *
mvm
)

1221 
	`k‰ì
(
mvm
->
nd_m©ch_£ts
);

1222 
mvm
->
nd_m©ch_£ts
 = 
NULL
;

1223 
mvm
->
n_nd_m©ch_£ts
 = 0;

1224 
	`k‰ì
(
mvm
->
nd_ch™√ls
);

1225 
mvm
->
nd_ch™√ls
 = 
NULL
;

1226 
mvm
->
n_nd_ch™√ls
 = 0;

1227 
	}
}

1229 
	$__iwl_mvm_su•íd
(
õì80211_hw
 *
hw
,

1230 
cfg80211_wowœn
 *
wowœn
,

1231 
boﬁ
 
ã°
)

1233 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1234 
õì80211_vif
 *
vif
 = 
NULL
;

1235 
iwl_mvm_vif
 *
mvmvif
 = 
NULL
;

1236 
õì80211_°a
 *
≠_°a
 = 
NULL
;

1237 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
;

1238 
iwl_d3_m™agî_c⁄fig
 
d3_cfg_cmd_d©a
 = {

1244 .
mö_¶ìp_time
 = 
	`˝u_to_À32
(10 * 1000 * 1000),

1246 
iwl_ho°_cmd
 
d3_cfg_cmd
 = {

1247 .
id
 = 
D3_CONFIG_CMD
,

1248 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_D3
,

1249 .
d©a
[0] = &
d3_cfg_cmd_d©a
,

1250 .
Àn
[0] = (
d3_cfg_cmd_d©a
),

1252 
ªt
, 
¥im¨y_lök
;

1253 
Àn
 
__maybe_unu£d
;

1254 
boﬁ
 
unifõd_image
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1255 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

1257 i‡(!
wowœn
) {

1262 
	`WARN_ON
(!
ã°
);

1263  -
EINVAL
;

1266 
vif
 = 
	`iwl_mvm_gë_bss_vif
(
mvm
);

1267 i‡(
	`IS_ERR_OR_NULL
(
vif
))

1270 i‡(
	`hweight16
(
vif
->
a˘ive_löks
) > 1) {

1277 
¥im¨y_lök
 = 
	`iwl_mvm_mld_gë_¥im¨y_lök
(
mvm
, 
vif
,

1278 
vif
->
a˘ive_löks
);

1280 i‡(
	`WARN_ONCE
(
¥im¨y_lök
 < 0, "noÖrimaryÜink in 0x%x\n",

1281 
vif
->
a˘ive_löks
))

1282 
¥im¨y_lök
 = 
	`__ffs
(
vif
->
a˘ive_löks
);

1284 
ªt
 = 
	`õì80211_£t_a˘ive_löks
(
vif
, 
	`BIT
(
¥im¨y_lök
));

1285 i‡(
ªt
)

1286  
ªt
;

1287 } i‡(
vif
->
a˘ive_löks
) {

1288 
¥im¨y_lök
 = 
	`__ffs
(
vif
->
a˘ive_löks
);

1290 
¥im¨y_lök
 = 0;

1293 
	`muãx_lock
(&
mvm
->
muãx
);

1295 
	`£t_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
);

1297 
	`synchr⁄ize_√t
();

1299 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1301 
mvm_lök
 = 
mvmvif
->
lök
[
¥im¨y_lök
];

1302 i‡(
	`WARN_ON_ONCE
(!
mvm_lök
)) {

1303 
ªt
 = -
EINVAL
;

1304 
out_n‹e£t
;

1307 i‡(
mvm_lök
->
≠_°a_id
 =
IWL_MVM_INVALID_STA
) {

1309 i‡(!
wowœn
->
nd_c⁄fig
) {

1310 
ªt
 = 1;

1311 
out_n‹e£t
;

1314 
ªt
 = 
	`iwl_mvm_√tdëe˘_c⁄fig
(

1315 
mvm
, 
wowœn
, wowœn->
nd_c⁄fig
, 
vif
);

1316 i‡(
ªt
)

1317 
out
;

1319 
mvm
->
√t_dëe˘
 = 
åue
;

1321 
iwl_wowœn_c⁄fig_cmd
 
wowœn_c⁄fig_cmd
 = {

1322 .
ofÊﬂdög_tid
 = 0,

1325 
wowœn_c⁄fig_cmd
.
°a_id
 = 
mvm_lök
->
≠_°a_id
;

1327 
≠_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

1328 
mvm
->
fw_id_to_mac_id
[
mvm_lök
->
≠_°a_id
],

1329 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1330 i‡(
	`IS_ERR_OR_NULL
(
≠_°a
)) {

1331 
ªt
 = -
EINVAL
;

1332 
out_n‹e£t
;

1335 
ªt
 = 
	`iwl_mvm_°a_ísuª_queue
(

1336 
mvm
, 
≠_°a
->
txq
[
wowœn_c⁄fig_cmd
.
ofÊﬂdög_tid
]);

1337 i‡(
ªt
)

1338 
out_n‹e£t
;

1340 
ªt
 = 
	`iwl_mvm_gë_wowœn_c⁄fig
(
mvm
, 
wowœn
, &
wowœn_c⁄fig_cmd
,

1341 
vif
, 
mvmvif
, 
≠_°a
);

1342 i‡(
ªt
)

1343 
out_n‹e£t
;

1344 
ªt
 = 
	`iwl_mvm_wowœn_c⁄fig
(
mvm
, 
wowœn
, &
wowœn_c⁄fig_cmd
,

1345 
vif
, 
mvmvif
, 
mvm_lök
, 
≠_°a
);

1346 i‡(
ªt
)

1347 
out
;

1349 
mvm
->
√t_dëe˘
 = 
Ál£
;

1352 
ªt
 = 
	`iwl_mvm_powî_upd©e_devi˚
(
mvm
);

1353 i‡(
ªt
)

1354 
out
;

1356 
ªt
 = 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

1357 i‡(
ªt
)

1358 
out
;

1360 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1361 i‡(
mvm
->
d3_wake_syßs£π
)

1362 
d3_cfg_cmd_d©a
.
wakeup_Êags
 |=

1363 
	`˝u_to_À32
(
IWL_WAKEUP_D3_CONFIG_FW_ERROR
);

1371 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_9000
)

1372 
	`iwl_fw_dbg_°›_ª°¨t_ªc‹dög
(&
mvm
->
fwπ
, 
NULL
, 
åue
);

1374 
mvm
->
å™s
->
sy°em_pm_mode
 = 
IWL_PLAT_PM_MODE_D3
;

1377 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
d3_cfg_cmd
);

1378 i‡(
ªt
)

1379 
out
;

1380 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1381 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
d3_cfg_cmd
.
ª•_pkt
);

1382 i‡(
Àn
 >(
u32
)) {

1383 
mvm
->
d3_ã°_pme_±r
 =

1384 
	`À32_to_˝up
((
__À32
 *)
d3_cfg_cmd
.
ª•_pkt
->
d©a
);

1387 
	`iwl_‰ì_ª•
(&
d3_cfg_cmd
);

1389 
	`˛ór_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
);

1391 
ªt
 = 
	`iwl_å™s_d3_su•íd
(
mvm
->
å™s
, 
ã°
, !
unifõd_image
);

1392 
out
:

1393 i‡(
ªt
 < 0) {

1394 
	`iwl_mvm_‰ì_nd
(
mvm
);

1396 i‡(!
unifõd_image
) {

1397 i‡(
mvm
->
fw_ª°¨t
 > 0) {

1398 
mvm
->
fw_ª°¨t
--;

1399 
	`õì80211_ª°¨t_hw
(
mvm
->
hw
);

1403 
	`˛ór_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
);

1405 
out_n‹e£t
:

1406 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1408  
ªt
;

1409 
	}
}

1411 
	$iwl_mvm_su•íd
(
õì80211_hw
 *
hw
, 
cfg80211_wowœn
 *
wowœn
)

1413 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1415 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1417 
	`iwl_mvm_∑u£_tcm
(
mvm
, 
åue
);

1419 
	`iwl_fw_ru¡ime_su•íd
(&
mvm
->
fwπ
);

1421 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1422  
	`__iwl_mvm_su•íd
(
hw
, 
wowœn
, 
Ál£
);

1423 
	}
}

1425 
	siwl_mu…iˇ°_key_d©a
 {

1426 
u8
 
	mkey
[
WOWLAN_KEY_MAX_SIZE
];

1427 
u8
 
	mÀn
;

1428 
u8
 
	mÊags
;

1429 
u8
 
	mid
;

1430 
u8
 
	mùn
[6];

1434 
	siwl_wowœn_°©us_d©a
 {

1435 
u64
 
	mª∂ay_˘r
;

1436 
u32
 
	mnum_of_gtk_ªkeys
;

1437 
u32
 
	mª˚ived_bóc⁄s
;

1438 
u32
 
	mwakeup_ªas⁄s
;

1439 
u32
 
	mwake_∑ckë_Àngth
;

1440 
u32
 
	mwake_∑ckë_bufsize
;

1441 
u16
 
	m∑âîn_numbî
;

1442 
u16
 
	mn⁄_qos_£q_˘r
;

1443 
u16
 
	mqos_£q_˘r
[8];

1444 
u8
 
	mtid_ã¨_down
;

1448 
u8
 
	mkey
[
WOWLAN_KEY_MAX_SIZE
];

1449 
u8
 
	mÀn
;

1450 
u8
 
	mÊags
;

1451 
u8
 
	mid
;

1452 } 
	mgtk
[
WOWLAN_GTK_KEYS_NUM
];

1462 
õì80211_key_£q
 
	m£q
[
IWL_MAX_TID_COUNT
];

1463 } 
	mtkù
, 
	m´s
;

1470 
s8
 
	mkey_id
;

1471 
boﬁ
 
	mvÆid
;

1472 } 
	mgtk_£q
[2];

1477 
õì80211_key_£q
 
	m£q
[
IWL_MAX_TID_COUNT
];

1478 
u64
 
	mtx_≤
;

1479 } 
	mtkù
, 
	m´s
;

1480 } 
	m±k
;

1482 
iwl_mu…iˇ°_key_d©a
 
	migtk
;

1483 
iwl_mu…iˇ°_key_d©a
 
	mbigtk
[
WOWLAN_BIGTK_KEYS_NUM
];

1485 
u8
 *
	mwake_∑ckë
;

1488 
	$iwl_mvm_ªp‹t_wakeup_ªas⁄s
(
iwl_mvm
 *
mvm
,

1489 
õì80211_vif
 *
vif
,

1490 
iwl_wowœn_°©us_d©a
 *
°©us
)

1492 
sk_buff
 *
pkt
 = 
NULL
;

1493 
cfg80211_wowœn_wakeup
 
wakeup
 = {

1494 .
∑âîn_idx
 = -1,

1496 
cfg80211_wowœn_wakeup
 *
wakeup_ªp‹t
 = &
wakeup
;

1497 
u32
 
ªas⁄s
 = 
°©us
->
wakeup_ªas⁄s
;

1499 i‡(
ªas⁄s
 =
IWL_WOWLAN_WAKEUP_BY_NON_WIRELESS
) {

1500 
wakeup_ªp‹t
 = 
NULL
;

1501 
ªp‹t
;

1504 
	`pm_wakeup_evít
(
mvm
->
dev
, 0);

1506 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_MAGIC_PACKET
)

1507 
wakeup
.
magic_pkt
 = 
åue
;

1509 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_PATTERN
)

1510 
wakeup
.
∑âîn_idx
 =

1511 
°©us
->
∑âîn_numbî
;

1513 i‡(
ªas⁄s
 & (
IWL_WOWLAN_WAKEUP_BY_DISCONNECTION_ON_MISSED_BEACON
 |

1514 
IWL_WOWLAN_WAKEUP_BY_DISCONNECTION_ON_DEAUTH
 |

1515 
IWL_WOWLAN_WAKEUP_BY_GTK_REKEY_FAILURE
))

1516 
wakeup
.
disc⁄√˘
 = 
åue
;

1518 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_GTK_REKEY_FAILURE
)

1519 
wakeup
.
gtk_ªkey_Áûuª
 = 
åue
;

1521 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_RFKILL_DEASSERTED
)

1522 
wakeup
.
rfkûl_ªÀa£
 = 
åue
;

1524 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_EAPOL_REQUEST
)

1525 
wakeup
.
óp_idítôy_ªq
 = 
åue
;

1527 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_FOUR_WAY_HANDSHAKE
)

1528 
wakeup
.
four_way_h™dshake
 = 
åue
;

1530 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_REM_WAKE_LINK_LOSS
)

1531 
wakeup
.
t˝_c⁄∆o°
 = 
åue
;

1533 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_REM_WAKE_SIGNATURE_TABLE
)

1534 
wakeup
.
t˝_nom‹ëokís
 = 
åue
;

1536 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_REM_WAKE_WAKEUP_PACKET
)

1537 
wakeup
.
t˝_m©ch
 = 
åue
;

1539 i‡(
ªas⁄s
 & 
IWL_WAKEUP_BY_11W_UNPROTECTED_DEAUTH_OR_DISASSOC
)

1540 
wakeup
.
u≈rŸ_dóuth_dißssoc
 = 
åue
;

1542 i‡(
°©us
->
wake_∑ckë
) {

1543 
pktsize
 = 
°©us
->
wake_∑ckë_bufsize
;

1544 
pkéí
 = 
°©us
->
wake_∑ckë_Àngth
;

1545 c⁄° 
u8
 *
pktd©a
 = 
°©us
->
wake_∑ckë
;

1546 c⁄° 
õì80211_hdr
 *
hdr
 = (c⁄° *)
pktd©a
;

1547 
åunˇãd
 = 
pkéí
 - 
pktsize
;

1550 i‡(
	`WARN_ON_ONCE
(
åunˇãd
 < 0))

1551 
åunˇãd
 = 0;

1553 i‡(
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
)) {

1554 
hdæí
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

1555 
ivÀn
 = 0, 
icvÀn
 = 4;

1557 
pkt
 = 
	`Æloc_skb
(
pktsize
, 
GFP_KERNEL
);

1558 i‡(!
pkt
)

1559 
ªp‹t
;

1561 
	`skb_put_d©a
(
pkt
, 
pktd©a
, 
hdæí
);

1562 
pktd©a
 +
hdæí
;

1563 
pktsize
 -
hdæí
;

1565 i‡(
	`õì80211_has_¥Ÿe˘ed
(
hdr
->
‰ame_c⁄åﬁ
)) {

1572 i‡(
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
)) {

1573 
ivÀn
 = 
mvm
->
gtk_ivÀn
;

1574 
icvÀn
 +
mvm
->
gtk_icvÀn
;

1576 
ivÀn
 = 
mvm
->
±k_ivÀn
;

1577 
icvÀn
 +
mvm
->
±k_icvÀn
;

1582 i‡(
åunˇãd
 >
icvÀn
) {

1583 
icvÀn
 = 0;

1584 
åunˇãd
 -
icvÀn
;

1586 
icvÀn
 -
åunˇãd
;

1587 
åunˇãd
 = 0;

1590 
pktsize
 -
ivÀn
 + 
icvÀn
;

1591 
pktd©a
 +
ivÀn
;

1593 
	`skb_put_d©a
(
pkt
, 
pktd©a
, 
pktsize
);

1595 i‡(
	`õì80211_d©a_to_8023
(
pkt
, 
vif
->
addr
, vif->
ty≥
))

1596 
ªp‹t
;

1597 
wakeup
.
∑ckë
 = 
pkt
->
d©a
;

1598 
wakeup
.
∑ckë_¥e£¡_Àn
 = 
pkt
->
Àn
;

1599 
wakeup
.
∑ckë_Àn
 = 
pkt
->
Àn
 - 
åunˇãd
;

1600 
wakeup
.
∑ckë_80211
 = 
Ál£
;

1602 
fc¶í
 = 4;

1604 i‡(
åunˇãd
 >= 4) {

1605 
åunˇãd
 -= 4;

1606 
fc¶í
 = 0;

1608 
fc¶í
 -
åunˇãd
;

1609 
åunˇãd
 = 0;

1611 
pktsize
 -
fc¶í
;

1612 
wakeup
.
∑ckë
 = 
°©us
->
wake_∑ckë
;

1613 
wakeup
.
∑ckë_¥e£¡_Àn
 = 
pktsize
;

1614 
wakeup
.
∑ckë_Àn
 = 
pkéí
 - 
åunˇãd
;

1615 
wakeup
.
∑ckë_80211
 = 
åue
;

1619 
ªp‹t
:

1620 
	`õì80211_ªp‹t_wowœn_wakeup
(
vif
, 
wakeup_ªp‹t
, 
GFP_KERNEL
);

1621 
	`k‰ì_skb
(
pkt
);

1622 
	}
}

1624 
	$iwl_mvm_À64_to_´s_£q
(
__À64
 
À_≤
, 
õì80211_key_£q
 *
£q
)

1626 
u64
 
≤
 = 
	`À64_to_˝u
(
À_≤
);

1628 
£q
->
ccmp
.
≤
[0] =Ön >> 40;

1629 
£q
->
ccmp
.
≤
[1] =Ön >> 32;

1630 
£q
->
ccmp
.
≤
[2] =Ön >> 24;

1631 
£q
->
ccmp
.
≤
[3] =Ön >> 16;

1632 
£q
->
ccmp
.
≤
[4] =Ön >> 8;

1633 
£q
->
ccmp
.
≤
[5] =Ön;

1634 
	}
}

1636 
	$iwl_mvm_´s_sc_to_£q
(
´s_sc
 *
sc
,

1637 
õì80211_key_£q
 *
£q
)

1639 
	`iwl_mvm_À64_to_´s_£q
(
sc
->
≤
, 
£q
);

1640 
	}
}

1642 
	$iwl_mvm_À64_to_tkù_£q
(
__À64
 
À_≤
, 
õì80211_key_£q
 *
£q
)

1644 
u64
 
≤
 = 
	`À64_to_˝u
(
À_≤
);

1646 
£q
->
tkù
.
iv16
 = (
u16
)
≤
;

1647 
£q
->
tkù
.
iv32
 = (
u32
)(
≤
 >> 16);

1648 
	}
}

1650 
	$iwl_mvm_tkù_sc_to_£q
(
tkù_sc
 *
sc
,

1651 
õì80211_key_£q
 *
£q
)

1653 
£q
->
tkù
.
iv32
 = 
	`À32_to_˝u
(
sc
->iv32);

1654 
£q
->
tkù
.
iv16
 = 
	`À16_to_˝u
(
sc
->iv16);

1655 
	}
}

1657 
	$iwl_mvm_£t_key_rx_£q_tids
(
õì80211_key_c⁄f
 *
key
,

1658 
õì80211_key_£q
 *
£q
)

1660 
tid
;

1662 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++)

1663 
	`õì80211_£t_key_rx_£q
(
key
, 
tid
, &
£q
[tid]);

1664 
	}
}

1666 
	$iwl_mvm_£t_´s_±k_rx_£q
(
iwl_mvm
 *
mvm
,

1667 
iwl_wowœn_°©us_d©a
 *
°©us
,

1668 
õì80211_°a
 *
°a
,

1669 
õì80211_key_c⁄f
 *
key
)

1671 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1672 
iwl_mvm_key_≤
 *
±k_≤
;

1673 
tid
;

1675 
	`iwl_mvm_£t_key_rx_£q_tids
(
key
, 
°©us
->
±k
.
´s
.
£q
);

1677 i‡(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
))

1681 
	`rcu_ªad_lock
();

1682 
±k_≤
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->±k_≤[
key
->
keyidx
]);

1683 i‡(
	`WARN_ON
(!
±k_≤
)) {

1684 
	`rcu_ªad_u∆ock
();

1688 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++) {

1689 
i
;

1691 
i
 = 1; i < 
mvm
->
å™s
->
num_rx_queues
; i++)

1692 
	`mem˝y
(
±k_≤
->
q
[
i
].
≤
[
tid
],

1693 
°©us
->
±k
.
´s
.
£q
[
tid
].
ccmp
.
≤
,

1694 
IEEE80211_CCMP_PN_LEN
);

1696 
	`rcu_ªad_u∆ock
();

1697 
	}
}

1699 
	$iwl_mvm_c⁄vît_key_cou¡îs
(
iwl_wowœn_°©us_d©a
 *
°©us
,

1700 
iwl_Æl_tsc_rsc
 *
sc
)

1702 
i
;

1704 
	`BUILD_BUG_ON
(
IWL_MAX_TID_COUNT
 > IWL_MAX_TID_COUNT);

1705 
	`BUILD_BUG_ON
(
IWL_MAX_TID_COUNT
 > 
IWL_NUM_RSC
);

1708 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

1709 
	`iwl_mvm_tkù_sc_to_£q
(&
sc
->
tkù
.
mu…iˇ°_rsc
[
i
],

1710 &
°©us
->
gtk_£q
[0].
tkù
.
£q
[
i
]);

1711 
	`iwl_mvm_´s_sc_to_£q
(&
sc
->
´s
.
mu…iˇ°_rsc
[
i
],

1712 &
°©us
->
gtk_£q
[0].
´s
.
£q
[
i
]);

1714 
°©us
->
gtk_£q
[0].
vÆid
 = 
åue
;

1715 
°©us
->
gtk_£q
[0].
key_id
 = -1;

1718 
°©us
->
±k
.
tkù
.
tx_≤
 = (
u64
)
	`À16_to_˝u
(
sc
->tkù.
tsc
.
iv16
) |

1719 ((
u64
)
	`À32_to_˝u
(
sc
->
tkù
.
tsc
.
iv32
) << 16);

1720 
°©us
->
±k
.
´s
.
tx_≤
 = 
	`À64_to_˝u
(
sc
->´s.
tsc
.
≤
);

1723 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

1724 
	`iwl_mvm_tkù_sc_to_£q
(&
sc
->
tkù
.
uniˇ°_rsc
[
i
],

1725 &
°©us
->
±k
.
tkù
.
£q
[
i
]);

1726 
	`iwl_mvm_´s_sc_to_£q
(&
sc
->
´s
.
uniˇ°_rsc
[
i
],

1727 &
°©us
->
±k
.
´s
.
£q
[
i
]);

1729 
	}
}

1732 
	$iwl_mvm_c⁄vît_key_cou¡îs_v5_gtk_£q
(
iwl_wowœn_°©us_d©a
 *
°©us
,

1733 
iwl_wowœn_Æl_rsc_tsc_v5
 *
sc
,

1734 
idx
, 
key_id
)

1736 
tid
;

1738 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++) {

1739 
	`iwl_mvm_À64_to_tkù_£q
(
sc
->
mˇ°_rsc
[
idx
][
tid
],

1740 &
°©us
->
gtk_£q
[
idx
].
tkù
.
£q
[
tid
]);

1741 
	`iwl_mvm_À64_to_´s_£q
(
sc
->
mˇ°_rsc
[
idx
][
tid
],

1742 &
°©us
->
gtk_£q
[
idx
].
´s
.
£q
[
tid
]);

1745 
°©us
->
gtk_£q
[
idx
].
vÆid
 = 
åue
;

1746 
°©us
->
gtk_£q
[
idx
].
key_id
 = key_id;

1747 
	}
}

1750 
	$iwl_mvm_c⁄vît_key_cou¡îs_v5
(
iwl_wowœn_°©us_d©a
 *
°©us
,

1751 
iwl_wowœn_Æl_rsc_tsc_v5
 *
sc
)

1753 
i
, 
tid
;

1755 
	`BUILD_BUG_ON
(
IWL_MAX_TID_COUNT
 > IWL_MAX_TID_COUNT);

1756 
	`BUILD_BUG_ON
(
IWL_MAX_TID_COUNT
 > 
IWL_NUM_RSC
);

1757 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
sc
->
mˇ°_rsc
Ë!ARRAY_SIZE(
°©us
->
gtk_£q
));

1760 
i
 = 0; i < 
	`ARRAY_SIZE
(
sc
->
mˇ°_key_id_m≠
); i++) {

1761 
u8
 
íåy
 = 
sc
->
mˇ°_key_id_m≠
[
i
];

1763 i‡(
íåy
 < 
	`ARRAY_SIZE
(
sc
->
mˇ°_rsc
))

1764 
	`iwl_mvm_c⁄vît_key_cou¡îs_v5_gtk_£q
(
°©us
, 
sc
,

1765 
íåy
, 
i
);

1771 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++) {

1772 
	`iwl_mvm_À64_to_tkù_£q
(
sc
->
uˇ°_rsc
[
tid
],

1773 &
°©us
->
±k
.
tkù
.
£q
[
tid
]);

1774 
	`iwl_mvm_À64_to_´s_£q
(
sc
->
uˇ°_rsc
[
tid
],

1775 &
°©us
->
±k
.
´s
.
£q
[
tid
]);

1777 
	}
}

1779 
	$iwl_mvm_£t_key_rx_£q_idx
(
õì80211_key_c⁄f
 *
key
,

1780 
iwl_wowœn_°©us_d©a
 *
°©us
,

1781 
idx
)

1783 
key
->
cùhî
) {

1784 
WLAN_CIPHER_SUITE_CCMP
:

1785 
WLAN_CIPHER_SUITE_GCMP
:

1786 
WLAN_CIPHER_SUITE_GCMP_256
:

1787 
	`iwl_mvm_£t_key_rx_£q_tids
(
key
, 
°©us
->
gtk_£q
[
idx
].
´s
.
£q
);

1789 
WLAN_CIPHER_SUITE_TKIP
:

1790 
	`iwl_mvm_£t_key_rx_£q_tids
(
key
, 
°©us
->
gtk_£q
[
idx
].
tkù
.
£q
);

1793 
	`WARN_ON
(1);

1795 
	}
}

1797 
	$iwl_mvm_£t_key_rx_£q
(
õì80211_key_c⁄f
 *
key
,

1798 
iwl_wowœn_°©us_d©a
 *
°©us
,

1799 
boﬁ
 
ö°ÆÀd
)

1801 
i
;

1803 
i
 = 0; i < 
	`ARRAY_SIZE
(
°©us
->
gtk_£q
); i++) {

1804 i‡(!
°©us
->
gtk_£q
[
i
].
vÆid
)

1808 i‡(
°©us
->
gtk_£q
[
i
].
key_id
 =
key
->
keyidx
) {

1809 
s8
 
√w_key_id
 = -1;

1811 i‡(
°©us
->
num_of_gtk_ªkeys
)

1812 
√w_key_id
 = 
°©us
->
gtk
[0].
Êags
 &

1813 
IWL_WOWLAN_GTK_IDX_MASK
;

1816 i‡(
√w_key_id
 !
key
->
keyidx
)

1817 
	`iwl_mvm_£t_key_rx_£q_idx
(
key
, 
°©us
, 
i
);

1822 i‡(
°©us
->
gtk_£q
[
i
].
key_id
 == -1 &&

1823 (!
°©us
->
num_of_gtk_ªkeys
 || 
ö°ÆÀd
))

1824 
	`iwl_mvm_£t_key_rx_£q_idx
(
key
, 
°©us
, 
i
);

1826 
	}
}

1828 
	siwl_mvm_d3_gtk_ôî_d©a
 {

1829 
iwl_mvm
 *
	mmvm
;

1830 
iwl_wowœn_°©us_d©a
 *
	m°©us
;

1831 
u32
 
	mgtk_cùhî
, 
	migtk_cùhî
, 
	mbigtk_cùhî
;

1832 
boﬁ
 
	munh™dÀd_cùhî
, 
	migtk_suµ‹t
, 
	mbigtk_suµ‹t
;

1833 
	mnum_keys
;

1836 
	$iwl_mvm_d3_föd_œ°_keys
(
õì80211_hw
 *
hw
,

1837 
õì80211_vif
 *
vif
,

1838 
õì80211_°a
 *
°a
,

1839 
õì80211_key_c⁄f
 *
key
,

1840 *
_d©a
)

1842 
iwl_mvm_d3_gtk_ôî_d©a
 *
d©a
 = 
_d©a
;

1844 i‡(
d©a
->
unh™dÀd_cùhî
)

1847 
key
->
cùhî
) {

1848 
WLAN_CIPHER_SUITE_WEP40
:

1849 
WLAN_CIPHER_SUITE_WEP104
:

1852 
WLAN_CIPHER_SUITE_CCMP
:

1853 
WLAN_CIPHER_SUITE_GCMP
:

1854 
WLAN_CIPHER_SUITE_GCMP_256
:

1855 
WLAN_CIPHER_SUITE_TKIP
:

1857 
d©a
->
gtk_cùhî
 = 
key
->
cùhî
;

1859 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1860 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1861 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1862 
WLAN_CIPHER_SUITE_AES_CMAC
:

1864 i‡(
d©a
->
igtk_suµ‹t
 &&

1865 (
key
->
keyidx
 == 4 || key->keyidx == 5)) {

1866 
d©a
->
igtk_cùhî
 = 
key
->
cùhî
;

1867 } i‡(
d©a
->
bigtk_suµ‹t
 &&

1868 (
key
->
keyidx
 == 6 || key->keyidx == 7)) {

1869 
d©a
->
bigtk_cùhî
 = 
key
->
cùhî
;

1871 
d©a
->
unh™dÀd_cùhî
 = 
åue
;

1877 
d©a
->
unh™dÀd_cùhî
 = 
åue
;

1881 
d©a
->
num_keys
++;

1882 
	}
}

1885 
	$iwl_mvm_d3_£t_igtk_bigtk_ùn
(c⁄° 
iwl_mu…iˇ°_key_d©a
 *
key
,

1886 
õì80211_key_£q
 *
£q
, 
u32
 
cùhî
)

1888 
cùhî
) {

1889 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1890 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1891 
	`BUILD_BUG_ON
((
£q
->
´s_gmac
.
≤
Ë!(
key
->
ùn
));

1892 
	`mem˝y
(
£q
->
´s_gmac
.
≤
, 
key
->
ùn
, (seq->aes_gmac.pn));

1894 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1895 
WLAN_CIPHER_SUITE_AES_CMAC
:

1896 
	`BUILD_BUG_ON
((
£q
->
´s_cmac
.
≤
Ë!(
key
->
ùn
));

1897 
	`mem˝y
(
£q
->
´s_cmac
.
≤
, 
key
->
ùn
, (seq->aes_cmac.pn));

1900 
	`WARN_ON
(1);

1902 
	}
}

1905 
	$iwl_mvm_d3_upd©e_igtk_bigtk
(
iwl_wowœn_°©us_d©a
 *
°©us
,

1906 
õì80211_key_c⁄f
 *
key
,

1907 
iwl_mu…iˇ°_key_d©a
 *
key_d©a
)

1909 i‡(
°©us
->
num_of_gtk_ªkeys
 && 
key_d©a
->
Àn
) {

1911 
	`õì80211_ªmove_key
(
key
);

1913 
õì80211_key_£q
 
£q
;

1915 
	`iwl_mvm_d3_£t_igtk_bigtk_ùn
(
key_d©a
,

1916 &
£q
,

1917 
key
->
cùhî
);

1918 
	`õì80211_£t_key_rx_£q
(
key
, 0, &
£q
);

1920 
	}
}

1922 
	$iwl_mvm_d3_upd©e_keys
(
õì80211_hw
 *
hw
,

1923 
õì80211_vif
 *
vif
,

1924 
õì80211_°a
 *
°a
,

1925 
õì80211_key_c⁄f
 *
key
,

1926 *
_d©a
)

1928 
iwl_mvm_d3_gtk_ôî_d©a
 *
d©a
 = 
_d©a
;

1929 
iwl_wowœn_°©us_d©a
 *
°©us
 = 
d©a
->status;

1930 
s8
 
keyidx
;

1932 i‡(
d©a
->
unh™dÀd_cùhî
)

1935 
key
->
cùhî
) {

1936 
WLAN_CIPHER_SUITE_WEP40
:

1937 
WLAN_CIPHER_SUITE_WEP104
:

1940 
WLAN_CIPHER_SUITE_CCMP
:

1941 
WLAN_CIPHER_SUITE_GCMP
:

1942 
WLAN_CIPHER_SUITE_GCMP_256
:

1943 i‡(
°a
) {

1944 
	`©omic64_£t
(&
key
->
tx_≤
, 
°©us
->
±k
.
´s
.tx_pn);

1945 
	`iwl_mvm_£t_´s_±k_rx_£q
(
d©a
->
mvm
, 
°©us
, 
°a
, 
key
);

1948 
ÁŒthrough
;

1949 
WLAN_CIPHER_SUITE_TKIP
:

1950 i‡(
°a
) {

1951 
	`©omic64_£t
(&
key
->
tx_≤
, 
°©us
->
±k
.
tkù
.tx_pn);

1952 
	`iwl_mvm_£t_key_rx_£q_tids
(
key
, 
°©us
->
±k
.
tkù
.
£q
);

1955 
keyidx
 = 
key
->keyidx;

1961 i‡(
°©us
->
num_of_gtk_ªkeys
 &&

1962 ((
°©us
->
gtk
[0].
Àn
 && 
keyidx
 =°©us->gtk[0].
id
) ||

1963 (
°©us
->
gtk
[1].
Àn
 && 
keyidx
 =°©us->gtk[1].
id
))) {

1964 
	`õì80211_ªmove_key
(
key
);

1966 
	`iwl_mvm_£t_key_rx_£q
(
key
, 
d©a
->
°©us
, 
Ál£
);

1969 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1970 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1971 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1972 
WLAN_CIPHER_SUITE_AES_CMAC
:

1973 i‡(
key
->
keyidx
 == 4 || key->keyidx == 5) {

1974 
	`iwl_mvm_d3_upd©e_igtk_bigtk
(
°©us
, 
key
,

1975 &
°©us
->
igtk
);

1977 i‡(
key
->
keyidx
 == 6 || key->keyidx == 7) {

1978 
u8
 
idx
 = 
key
->
keyidx
 =
°©us
->
bigtk
[1].
id
;

1980 
	`iwl_mvm_d3_upd©e_igtk_bigtk
(
°©us
, 
key
,

1981 &
°©us
->
bigtk
[
idx
]);

1984 
	}
}

1986 
boﬁ
 
	$iwl_mvm_gtk_ªkey
(
iwl_wowœn_°©us_d©a
 *
°©us
,

1987 
õì80211_vif
 *
vif
,

1988 
iwl_mvm
 *
mvm
, 
u32
 
gtk_cùhî
)

1990 
i
, 
j
;

1991 
õì80211_key_c⁄f
 *
key
;

1993 
õì80211_key_c⁄f
 
c⁄f
;

1994 
u8
 
key
[32];

1995 } 
c⁄f
 = {

1996 .
c⁄f
.
cùhî
 = 
gtk_cùhî
,

1998 
lök_id
 = 
vif
->
a˘ive_löks
 ? 
	`__ffs
(vif->active_links) : -1;

2000 
	`BUILD_BUG_ON
(
WLAN_KEY_LEN_CCMP
 !
WLAN_KEY_LEN_GCMP
);

2001 
	`BUILD_BUG_ON
((
c⁄f
.
key
Ë< 
WLAN_KEY_LEN_CCMP
);

2002 
	`BUILD_BUG_ON
((
c⁄f
.
key
Ë< 
WLAN_KEY_LEN_GCMP_256
);

2003 
	`BUILD_BUG_ON
((
c⁄f
.
key
Ë< 
WLAN_KEY_LEN_TKIP
);

2004 
	`BUILD_BUG_ON
((
c⁄f
.
key
Ë< (
°©us
->
gtk
[0].key));

2006 
gtk_cùhî
) {

2007 
WLAN_CIPHER_SUITE_CCMP
:

2008 
WLAN_CIPHER_SUITE_GCMP
:

2009 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_CCMP
;

2011 
WLAN_CIPHER_SUITE_GCMP_256
:

2012 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_GCMP_256
;

2014 
WLAN_CIPHER_SUITE_TKIP
:

2015 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_TKIP
;

2018 
	`WARN_ON
(1);

2021 
i
 = 0; i < 
	`ARRAY_SIZE
(
°©us
->
gtk
); i++) {

2022 i‡(!
°©us
->
gtk
[
i
].
Àn
)

2025 
c⁄f
.c⁄f.
keyidx
 = 
°©us
->
gtk
[
i
].
id
;

2026 
	`IWL_DEBUG_WOWLAN
(
mvm
,

2028 
c⁄f
.c⁄f.
cùhî
, c⁄f.c⁄f.
keyidx
);

2029 
	`mem˝y
(
c⁄f
.c⁄f.
key
, 
°©us
->
gtk
[
i
].key,

2030 (
°©us
->
gtk
[
i
].
key
));

2032 
key
 = 
	`õì80211_gtk_ªkey_add
(
vif
, &
c⁄f
.c⁄f, 
lök_id
);

2033 i‡(
	`IS_ERR
(
key
))

2034  
Ál£
;

2036 
j
 = 0; j < 
	`ARRAY_SIZE
(
°©us
->
gtk_£q
); j++) {

2037 i‡(!
°©us
->
gtk_£q
[
j
].
vÆid
 ||

2038 
°©us
->
gtk_£q
[
j
].
key_id
 !
key
->
keyidx
)

2040 
	`iwl_mvm_£t_key_rx_£q_idx
(
key
, 
°©us
, 
j
);

2043 
	`WARN_ON
(
j
 =
	`ARRAY_SIZE
(
°©us
->
gtk_£q
));

2046  
åue
;

2047 
	}
}

2049 
boﬁ


2050 
	$iwl_mvm_d3_igtk_bigtk_ªkey_add
(
iwl_wowœn_°©us_d©a
 *
°©us
,

2051 
õì80211_vif
 *
vif
, 
u32
 
cùhî
,

2052 
iwl_mu…iˇ°_key_d©a
 *
key_d©a
)

2054 
õì80211_key_c⁄f
 *
key_c⁄fig
;

2056 
õì80211_key_c⁄f
 
c⁄f
;

2057 
u8
 
key
[
WOWLAN_KEY_MAX_SIZE
];

2058 } 
c⁄f
 = {

2059 .
c⁄f
.
cùhî
 = cipher,

2060 .
c⁄f
.
keyidx
 = 
key_d©a
->
id
,

2062 
õì80211_key_£q
 
£q
;

2063 
lök_id
 = 
vif
->
a˘ive_löks
 ? 
	`__ffs
(vif->active_links) : -1;

2065 i‡(!
key_d©a
->
Àn
)

2066  
åue
;

2068 
	`iwl_mvm_d3_£t_igtk_bigtk_ùn
(
key_d©a
, &
£q
, 
c⁄f
.c⁄f.
cùhî
);

2070 
cùhî
) {

2071 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

2072 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_BIP_GMAC_128
;

2074 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

2075 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_BIP_GMAC_256
;

2077 
WLAN_CIPHER_SUITE_AES_CMAC
:

2078 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_AES_CMAC
;

2080 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

2081 
c⁄f
.c⁄f.
keyÀn
 = 
WLAN_KEY_LEN_BIP_CMAC_256
;

2084 
	`WARN_ON
(1);

2086 
	`BUILD_BUG_ON
((
c⁄f
.
key
Ë< (
key_d©a
->key));

2087 
	`mem˝y
(
c⁄f
.c⁄f.
key
, 
key_d©a
->key, c⁄f.c⁄f.
keyÀn
);

2089 
key_c⁄fig
 = 
	`õì80211_gtk_ªkey_add
(
vif
, &
c⁄f
.c⁄f, 
lök_id
);

2090 i‡(
	`IS_ERR
(
key_c⁄fig
))

2091  
Ál£
;

2092 
	`õì80211_£t_key_rx_£q
(
key_c⁄fig
, 0, &
£q
);

2094 i‡(
key_c⁄fig
->
keyidx
 == 4 || key_config->keyidx == 5) {

2095 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2096 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
;

2098 
lök_id
 =Üink_id < 0 ? 0 :Üink_id;

2099 
mvm_lök
 = 
mvmvif
->
lök
[
lök_id
];

2100 
mvm_lök
->
igtk
 = 
key_c⁄fig
;

2103  
åue
;

2104 
	}
}

2106 
	$iwl_mvm_lookup_wowœn_°©us_vî
(
iwl_mvm
 *
mvm
)

2108 
u8
 
nŸif_vî
;

2110 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

2111 
IWL_UCODE_TLV_API_WOWLAN_KEY_MATERIAL
))

2115 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LONG_GROUP
,

2116 
WOWLAN_GET_STATUSES
, 0);

2117 i‡(!
nŸif_vî
)

2118 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

2119 
WOWLAN_GET_STATUSES
, 7);

2121  
nŸif_vî
;

2122 
	}
}

2124 
boﬁ
 
	$iwl_mvm_£tup_c⁄√˘i⁄_kìp
(
iwl_mvm
 *
mvm
,

2125 
õì80211_vif
 *
vif
,

2126 
iwl_wowœn_°©us_d©a
 *
°©us
)

2128 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2129 
iwl_mvm_d3_gtk_ôî_d©a
 
gtkd©a
 = {

2130 .
mvm
 = mvm,

2131 .
°©us
 = status,

2133 
i
;

2134 
u32
 
disc⁄√˘i⁄_ªas⁄s
 =

2135 
IWL_WOWLAN_WAKEUP_BY_DISCONNECTION_ON_MISSED_BEACON
 |

2136 
IWL_WOWLAN_WAKEUP_BY_DISCONNECTION_ON_DEAUTH
;

2138 i‡(!
°©us
 || !
vif
->
bss_c⁄f
.
bssid
)

2139  
Ál£
;

2141 i‡(
	`iwl_mvm_lookup_wowœn_°©us_vî
(
mvm
) > 6 ||

2142 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

2143 
WOWLAN_INFO_NOTIFICATION
,

2145 
gtkd©a
.
igtk_suµ‹t
 = 
åue
;

2147 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

2148 
WOWLAN_INFO_NOTIFICATION
,

2150 
gtkd©a
.
bigtk_suµ‹t
 = 
åue
;

2153 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
,

2154 
iwl_mvm_d3_föd_œ°_keys
, &
gtkd©a
);

2156 i‡(
gtkd©a
.
unh™dÀd_cùhî
)

2157  
Ál£
;

2158 i‡(!
gtkd©a
.
num_keys
)

2159 
out
;

2165 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
,

2166 
iwl_mvm_d3_upd©e_keys
, &
gtkd©a
);

2168 i‡(
°©us
->
num_of_gtk_ªkeys
) {

2169 
__be64
 
ª∂ay_˘r
 = 
	`˝u_to_be64
(
°©us
->replay_ctr);

2171 
	`IWL_DEBUG_WOWLAN
(
mvm
, "num of GTKÑekeying %d\n",

2172 
°©us
->
num_of_gtk_ªkeys
);

2174 i‡(!
	`iwl_mvm_gtk_ªkey
(
°©us
, 
vif
, 
mvm
, 
gtkd©a
.
gtk_cùhî
))

2175  
Ál£
;

2177 i‡(!
	`iwl_mvm_d3_igtk_bigtk_ªkey_add
(
°©us
, 
vif
,

2178 
gtkd©a
.
igtk_cùhî
,

2179 &
°©us
->
igtk
))

2180  
Ál£
;

2182 
i
 = 0; i < 
	`ARRAY_SIZE
(
°©us
->
bigtk
); i++) {

2183 i‡(!
	`iwl_mvm_d3_igtk_bigtk_ªkey_add
(
°©us
, 
vif
,

2184 
gtkd©a
.
bigtk_cùhî
,

2185 &
°©us
->
bigtk
[
i
]))

2186  
Ál£
;

2189 
	`õì80211_gtk_ªkey_nŸify
(
vif
, vif->
bss_c⁄f
.
bssid
,

2190 (*)&
ª∂ay_˘r
, 
GFP_KERNEL
);

2193 
out
:

2194 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LONG_GROUP
,

2195 
WOWLAN_GET_STATUSES
, 0) < 10) {

2196 
mvmvif
->
£qno_vÆid
 = 
åue
;

2198 
mvmvif
->
£qno
 = 
°©us
->
n⁄_qos_£q_˘r
 + 0x10;

2201 i‡(
°©us
->
wakeup_ªas⁄s
 & 
disc⁄√˘i⁄_ªas⁄s
)

2202  
Ál£
;

2204  
åue
;

2205 
	}
}

2207 
	$iwl_mvm_c⁄vît_gtk_v2
(
iwl_wowœn_°©us_d©a
 *
°©us
,

2208 
iwl_wowœn_gtk_°©us_v2
 *
d©a
)

2210 
	`BUILD_BUG_ON
((
°©us
->
gtk
[0].
key
Ë< (
d©a
->key));

2211 
	`BUILD_BUG_ON
(
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 +

2212 (
d©a
->
tkù_mic_key
) >

2213 (
°©us
->
gtk
[0].
key
));

2215 
°©us
->
gtk
[0].
Àn
 = 
d©a
->
key_Àn
;

2216 
°©us
->
gtk
[0].
Êags
 = 
d©a
->
key_Êags
;

2218 
	`mem˝y
(
°©us
->
gtk
[0].
key
, 
d©a
->key, (data->key));

2221 i‡(
°©us
->
gtk
[0].
Àn
 =
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
)

2222 
	`mem˝y
(
°©us
->
gtk
[0].
key
 + 
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
,

2223 
d©a
->
tkù_mic_key
, (data->tkip_mic_key));

2224 
	}
}

2226 
	$iwl_mvm_c⁄vît_gtk_v3
(
iwl_wowœn_°©us_d©a
 *
°©us
,

2227 
iwl_wowœn_gtk_°©us_v3
 *
d©a
)

2229 
d©a_idx
, 
°©us_idx
 = 0;

2231 
	`BUILD_BUG_ON
((
°©us
->
gtk
[0].
key
Ë< (
d©a
[0].key));

2232 
	`BUILD_BUG_ON
(
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 +

2233 (
d©a
[0].
tkù_mic_key
) >

2234 (
°©us
->
gtk
[0].
key
));

2235 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
°©us
->
gtk
Ë< 
WOWLAN_GTK_KEYS_NUM
);

2236 
d©a_idx
 = 0; d©a_idx < 
	`ARRAY_SIZE
(
°©us
->
gtk
); data_idx++) {

2237 i‡(!(
d©a
[
d©a_idx
].
key_Àn
))

2239 
°©us
->
gtk
[
°©us_idx
].
Àn
 = 
d©a
[
d©a_idx
].
key_Àn
;

2240 
°©us
->
gtk
[
°©us_idx
].
Êags
 = 
d©a
[
d©a_idx
].
key_Êags
;

2241 
°©us
->
gtk
[
°©us_idx
].
id
 = sètus->gtk[°©us_idx].
Êags
 &

2242 
IWL_WOWLAN_GTK_IDX_MASK
;

2244 
	`mem˝y
(
°©us
->
gtk
[
°©us_idx
].
key
, 
d©a
[
d©a_idx
].key,

2245 (
d©a
[
d©a_idx
].
key
));

2248 i‡(
°©us
->
gtk
[
°©us_idx
].
Àn
 ==

2249 
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
)

2250 
	`mem˝y
(
°©us
->
gtk
[
°©us_idx
].
key
 +

2251 
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
,

2252 
d©a
[
d©a_idx
].
tkù_mic_key
,

2253 (
d©a
[
d©a_idx
].
tkù_mic_key
));

2254 
°©us_idx
++;

2256 
	}
}

2258 
	$iwl_mvm_c⁄vît_igtk
(
iwl_wowœn_°©us_d©a
 *
°©us
,

2259 
iwl_wowœn_igtk_°©us
 *
d©a
)

2261 
i
;

2263 
	`BUILD_BUG_ON
((
°©us
->
igtk
.
key
Ë< (
d©a
->key));

2264 
	`BUILD_BUG_ON
((
°©us
->
igtk
.
ùn
Ë!(
d©a
->ipn));

2266 i‡(!
d©a
->
key_Àn
)

2269 
°©us
->
igtk
.
Àn
 = 
d©a
->
key_Àn
;

2270 
°©us
->
igtk
.
Êags
 = 
d©a
->
key_Êags
;

2271 
°©us
->
igtk
.
id
 = 
	`u32_gë_bôs
(
d©a
->
key_Êags
,

2272 
IWL_WOWLAN_IGTK_BIGTK_IDX_MASK
)

2273 + 
WOWLAN_IGTK_MIN_INDEX
;

2275 
	`mem˝y
(
°©us
->
igtk
.
key
, 
d©a
->key, (data->key));

2278 
i
 = 0; i < (
d©a
->
ùn
); i++)

2279 
°©us
->
igtk
.
ùn
[
i
] = 
d©a
->ipn[(data->ipn) - i - 1];

2280 
	}
}

2282 
	$iwl_mvm_c⁄vît_bigtk
(
iwl_wowœn_°©us_d©a
 *
°©us
,

2283 c⁄° 
iwl_wowœn_igtk_°©us
 *
d©a
)

2285 
d©a_idx
, 
°©us_idx
 = 0;

2287 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
°©us
->
bigtk
Ë< 
WOWLAN_BIGTK_KEYS_NUM
);

2289 
d©a_idx
 = 0; d©a_idx < 
WOWLAN_BIGTK_KEYS_NUM
; data_idx++) {

2290 i‡(!
d©a
[
d©a_idx
].
key_Àn
)

2293 
°©us
->
bigtk
[
°©us_idx
].
Àn
 = 
d©a
[
d©a_idx
].
key_Àn
;

2294 
°©us
->
bigtk
[
°©us_idx
].
Êags
 = 
d©a
[
d©a_idx
].
key_Êags
;

2295 
°©us
->
bigtk
[
°©us_idx
].
id
 =

2296 
	`u32_gë_bôs
(
d©a
[
d©a_idx
].
key_Êags
,

2297 
IWL_WOWLAN_IGTK_BIGTK_IDX_MASK
)

2298 + 
WOWLAN_BIGTK_MIN_INDEX
;

2300 
	`BUILD_BUG_ON
((
°©us
->
bigtk
[
°©us_idx
].
key
) <

2301 (
d©a
[
d©a_idx
].
key
));

2302 
	`BUILD_BUG_ON
((
°©us
->
bigtk
[
°©us_idx
].
ùn
) <

2303 (
d©a
[
d©a_idx
].
ùn
));

2305 
	`mem˝y
(
°©us
->
bigtk
[
°©us_idx
].
key
, 
d©a
[
d©a_idx
].key,

2306 (
d©a
[
d©a_idx
].
key
));

2307 
	`mem˝y
(
°©us
->
bigtk
[
°©us_idx
].
ùn
, 
d©a
[
d©a_idx
].ipn,

2308 (
d©a
[
d©a_idx
].
ùn
));

2309 
°©us_idx
++;

2311 
	}
}

2313 
	$iwl_mvm_∑r£_wowœn_öfo_nŸif
(
iwl_mvm
 *
mvm
,

2314 
iwl_wowœn_öfo_nŸif
 *
d©a
,

2315 
iwl_wowœn_°©us_d©a
 *
°©us
,

2316 
u32
 
Àn
)

2318 
u32
 
i
;

2320 i‡(!
d©a
) {

2321 
	`IWL_ERR
(
mvm
, "iwl_wowlan_info_notif data is NULL\n");

2322 
°©us
 = 
NULL
;

2326 i‡(
Àn
 < (*
d©a
)) {

2327 
	`IWL_ERR
(
mvm
, "Invalid WoWLAN infoÇotification!\n");

2328 
°©us
 = 
NULL
;

2332 
	`iwl_mvm_c⁄vît_key_cou¡îs_v5
(
°©us
, &
d©a
->
gtk
[0].
sc
);

2333 
	`iwl_mvm_c⁄vît_gtk_v3
(
°©us
, 
d©a
->
gtk
);

2334 
	`iwl_mvm_c⁄vît_igtk
(
°©us
, &
d©a
->
igtk
[0]);

2335 
	`iwl_mvm_c⁄vît_bigtk
(
°©us
, 
d©a
->
bigtk
);

2336 
°©us
->
ª∂ay_˘r
 = 
	`À64_to_˝u
(
d©a
->replay_ctr);

2337 
°©us
->
∑âîn_numbî
 = 
	`À16_to_˝u
(
d©a
->pattern_number);

2338 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++)

2339 
°©us
->
qos_£q_˘r
[
i
] =

2340 
	`À16_to_˝u
(
d©a
->
qos_£q_˘r
[
i
]);

2341 
°©us
->
wakeup_ªas⁄s
 = 
	`À32_to_˝u
(
d©a
->wakeup_reasons);

2342 
°©us
->
num_of_gtk_ªkeys
 =

2343 
	`À32_to_˝u
(
d©a
->
num_of_gtk_ªkeys
);

2344 
°©us
->
ª˚ived_bóc⁄s
 = 
	`À32_to_˝u
(
d©a
->received_beacons);

2345 
°©us
->
tid_ã¨_down
 = 
d©a
->tid_tear_down;

2346 
	}
}

2349 
	$iwl_mvm_∑r£_wowœn_öfo_nŸif_v2
(
iwl_mvm
 *
mvm
,

2350 
iwl_wowœn_öfo_nŸif_v2
 *
d©a
,

2351 
iwl_wowœn_°©us_d©a
 *
°©us
,

2352 
u32
 
Àn
)

2354 
u32
 
i
;

2356 i‡(!
d©a
) {

2357 
	`IWL_ERR
(
mvm
, "iwl_wowlan_info_notif data is NULL\n");

2358 
°©us
 = 
NULL
;

2362 i‡(
Àn
 < (*
d©a
)) {

2363 
	`IWL_ERR
(
mvm
, "Invalid WoWLAN infoÇotification!\n");

2364 
°©us
 = 
NULL
;

2368 
	`iwl_mvm_c⁄vît_key_cou¡îs_v5
(
°©us
, &
d©a
->
gtk
[0].
sc
);

2369 
	`iwl_mvm_c⁄vît_gtk_v3
(
°©us
, 
d©a
->
gtk
);

2370 
	`iwl_mvm_c⁄vît_igtk
(
°©us
, &
d©a
->
igtk
[0]);

2371 
°©us
->
ª∂ay_˘r
 = 
	`À64_to_˝u
(
d©a
->replay_ctr);

2372 
°©us
->
∑âîn_numbî
 = 
	`À16_to_˝u
(
d©a
->pattern_number);

2373 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++)

2374 
°©us
->
qos_£q_˘r
[
i
] =

2375 
	`À16_to_˝u
(
d©a
->
qos_£q_˘r
[
i
]);

2376 
°©us
->
wakeup_ªas⁄s
 = 
	`À32_to_˝u
(
d©a
->wakeup_reasons);

2377 
°©us
->
num_of_gtk_ªkeys
 =

2378 
	`À32_to_˝u
(
d©a
->
num_of_gtk_ªkeys
);

2379 
°©us
->
ª˚ived_bóc⁄s
 = 
	`À32_to_˝u
(
d©a
->received_beacons);

2380 
°©us
->
tid_ã¨_down
 = 
d©a
->tid_tear_down;

2381 
	}
}

2384 
	#iwl_mvm_∑r£_wowœn_°©us_comm⁄
(
_vî
) \

2385 
iwl_wowœn_°©us_d©a
 * \

2386 
iwl_mvm_∑r£_wowœn_°©us_comm⁄_
 ## 
	`_vî
(
iwl_mvm
 *
mvm
, \

2387 
iwl_wowœn_°©us_
 ##
_vî
 *
d©a
,\

2388 
Àn
) \

2390 
iwl_wowœn_°©us_d©a
 *
°©us
; \

2391 
d©a_size
, 
i
; \

2393 i‡(
Àn
 < (*
d©a
)) { \

2394 
	`IWL_ERR
(
mvm
, "Invalid WoWLAN statusÑesponse!\n"); \

2395  
NULL
; \

2398 
d©a_size
 = 
	`ALIGN
(
	`À32_to_˝u
(
d©a
->
wake_∑ckë_bufsize
), 4); \

2399 i‡(
Àn
 !(*
d©a
Ë+ 
d©a_size
) { \

2400 
	`IWL_ERR
(
mvm
, "Invalid WoWLAN statusÑesponse!\n"); \

2401  
NULL
; \

2404 
°©us
 = 
	`kzÆloc
((*°©us), 
GFP_KERNEL
); \

2405 i‡(!
°©us
) \

2406  
NULL
; \

2409 
°©us
->
ª∂ay_˘r
 = 
	`À64_to_˝u
(
d©a
->replay_ctr); \

2410 
°©us
->
∑âîn_numbî
 = 
	`À16_to_˝u
(
d©a
->pattern_number); \

2411 
°©us
->
n⁄_qos_£q_˘r
 = 
	`À16_to_˝u
(
d©a
->non_qos_seq_ctr); \

2412 
i
 = 0; i < 8; i++) \

2413 
°©us
->
qos_£q_˘r
[
i
] = \

2414 
	`À16_to_˝u
(
d©a
->
qos_£q_˘r
[
i
]); \

2415 
°©us
->
wakeup_ªas⁄s
 = 
	`À32_to_˝u
(
d©a
->wakeup_reasons); \

2416 
°©us
->
num_of_gtk_ªkeys
 = \

2417 
	`À32_to_˝u
(
d©a
->
num_of_gtk_ªkeys
); \

2418 
°©us
->
ª˚ived_bóc⁄s
 = 
	`À32_to_˝u
(
d©a
->received_beacons); \

2419 
°©us
->
wake_∑ckë_Àngth
 = \

2420 
	`À32_to_˝u
(
d©a
->
wake_∑ckë_Àngth
); \

2421 
°©us
->
wake_∑ckë_bufsize
 = \

2422 
	`À32_to_˝u
(
d©a
->
wake_∑ckë_bufsize
); \

2423 i‡(
°©us
->
wake_∑ckë_bufsize
) { \

2424 
°©us
->
wake_∑ckë
 = \

2425 
	`kmemdup
(
d©a
->
wake_∑ckë
, \

2426 
°©us
->
wake_∑ckë_bufsize
, \

2427 
GFP_KERNEL
); \

2428 i‡(!
°©us
->
wake_∑ckë
) { \

2429 
	`k‰ì
(
°©us
); \

2430  
NULL
; \

2433 
°©us
->
wake_∑ckë
 = 
NULL
; \

2436  
°©us
; \

2437 }

	)

2439 
	$iwl_mvm_∑r£_wowœn_°©us_comm⁄
(
v6
)

2440 
	$iwl_mvm_∑r£_wowœn_°©us_comm⁄
(
v7
)

2441 
	$iwl_mvm_∑r£_wowœn_°©us_comm⁄
(
v9
)

2442 
	$iwl_mvm_∑r£_wowœn_°©us_comm⁄
(
v12
)

2444 
iwl_wowœn_°©us_d©a
 *

2445 
	$iwl_mvm_£nd_wowœn_gë_°©us
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
)

2447 
iwl_wowœn_°©us_d©a
 *
°©us
;

2448 
iwl_wowœn_gë_°©us_cmd
 
gë_°©us_cmd
 = {

2449 .
°a_id
 = 
	`˝u_to_À32
(sta_id),

2451 
iwl_ho°_cmd
 
cmd
 = {

2452 .
id
 = 
WOWLAN_GET_STATUSES
,

2453 .
Êags
 = 
CMD_WANT_SKB
,

2454 .
d©a
 = { &
gë_°©us_cmd
, },

2455 .
Àn
 = { (
gë_°©us_cmd
), },

2457 
ªt
, 
Àn
;

2458 
u8
 
nŸif_vî
;

2459 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd
.
id
,

2460 
IWL_FW_CMD_VER_UNKNOWN
);

2462 i‡(
cmd_vî
 =
IWL_FW_CMD_VER_UNKNOWN
)

2463 
cmd
.
Àn
[0] = 0;

2465 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2467 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

2468 i‡(
ªt
) {

2469 
	`IWL_ERR
(
mvm
, "ÁûedÅÿquîy wakeu∞°©u†(%d)\n", 
ªt
);

2470  
	`ERR_PTR
(
ªt
);

2473 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
cmd
.
ª•_pkt
);

2476 
nŸif_vî
 = 
	`iwl_mvm_lookup_wowœn_°©us_vî
(
mvm
);

2478 i‡(
nŸif_vî
 < 7) {

2479 
iwl_wowœn_°©us_v6
 *
v6
 = (*)
cmd
.
ª•_pkt
->
d©a
;

2481 
°©us
 = 
	`iwl_mvm_∑r£_wowœn_°©us_comm⁄_v6
(
mvm
, 
v6
, 
Àn
);

2482 i‡(!
°©us
)

2483 
out_‰ì_ª•
;

2485 
	`BUILD_BUG_ON
((
v6
->
gtk
.
de¸y±_key
) >

2486 (
°©us
->
gtk
[0].
key
));

2487 
	`BUILD_BUG_ON
(
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 +

2488 (
v6
->
gtk
.
tkù_mic_key
) >

2489 (
°©us
->
gtk
[0].
key
));

2492 
	`mem˝y
(
°©us
->
gtk
[0].
key
, 
v6
->gtk.
de¸y±_key
,

2493 (
v6
->
gtk
.
de¸y±_key
));

2494 
	`mem˝y
(
°©us
->
gtk
[0].
key
 + 
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
,

2495 
v6
->
gtk
.
tkù_mic_key
,

2496 (
v6
->
gtk
.
tkù_mic_key
));

2498 
	`iwl_mvm_c⁄vît_key_cou¡îs
(
°©us
, &
v6
->
gtk
.
rsc
.
Æl_tsc_rsc
);

2501 
°©us
->
gtk
[0].
Àn
 = 16;

2508 
°©us
->
gtk
[0].
Êags
 = 
v6
->gtk.
key_ödex
 | 
	`BIT
(7);

2509 } i‡(
nŸif_vî
 == 7) {

2510 
iwl_wowœn_°©us_v7
 *
v7
 = (*)
cmd
.
ª•_pkt
->
d©a
;

2512 
°©us
 = 
	`iwl_mvm_∑r£_wowœn_°©us_comm⁄_v7
(
mvm
, 
v7
, 
Àn
);

2513 i‡(!
°©us
)

2514 
out_‰ì_ª•
;

2516 
	`iwl_mvm_c⁄vît_key_cou¡îs
(
°©us
, &
v7
->
gtk
[0].
rsc
.
Æl_tsc_rsc
);

2517 
	`iwl_mvm_c⁄vît_gtk_v2
(
°©us
, &
v7
->
gtk
[0]);

2518 
	`iwl_mvm_c⁄vît_igtk
(
°©us
, &
v7
->
igtk
[0]);

2519 } i‡(
nŸif_vî
 == 9 ||Çotif_ver == 10 ||Çotif_ver == 11) {

2520 
iwl_wowœn_°©us_v9
 *
v9
 = (*)
cmd
.
ª•_pkt
->
d©a
;

2525 
°©us
 = 
	`iwl_mvm_∑r£_wowœn_°©us_comm⁄_v9
(
mvm
, 
v9
, 
Àn
);

2526 i‡(!
°©us
)

2527 
out_‰ì_ª•
;

2529 
	`iwl_mvm_c⁄vît_key_cou¡îs
(
°©us
, &
v9
->
gtk
[0].
rsc
.
Æl_tsc_rsc
);

2530 
	`iwl_mvm_c⁄vît_gtk_v2
(
°©us
, &
v9
->
gtk
[0]);

2531 
	`iwl_mvm_c⁄vît_igtk
(
°©us
, &
v9
->
igtk
[0]);

2533 
°©us
->
tid_ã¨_down
 = 
v9
->tid_tear_down;

2534 } i‡(
nŸif_vî
 == 12) {

2535 
iwl_wowœn_°©us_v12
 *
v12
 = (*)
cmd
.
ª•_pkt
->
d©a
;

2537 
°©us
 = 
	`iwl_mvm_∑r£_wowœn_°©us_comm⁄_v12
(
mvm
, 
v12
, 
Àn
);

2538 i‡(!
°©us
)

2539 
out_‰ì_ª•
;

2541 
	`iwl_mvm_c⁄vît_key_cou¡îs_v5
(
°©us
, &
v12
->
gtk
[0].
sc
);

2542 
	`iwl_mvm_c⁄vît_gtk_v3
(
°©us
, 
v12
->
gtk
);

2543 
	`iwl_mvm_c⁄vît_igtk
(
°©us
, &
v12
->
igtk
[0]);

2545 
°©us
->
tid_ã¨_down
 = 
v12
->tid_tear_down;

2547 
	`IWL_ERR
(
mvm
,

2549 
nŸif_vî
);

2550 
°©us
 = 
NULL
;

2553 
out_‰ì_ª•
:

2554 
	`iwl_‰ì_ª•
(&
cmd
);

2555  
°©us
;

2556 
	}
}

2559 
boﬁ
 
	$iwl_mvm_quîy_wakeup_ªas⁄s
(
iwl_mvm
 *
mvm
,

2560 
õì80211_vif
 *
vif
,

2561 
iwl_wowœn_°©us_d©a
 *
°©us
)

2563 
i
;

2564 
boﬁ
 
kìp
 = 
Ál£
;

2565 
iwl_mvm_°a
 *
mvm_≠_°a
;

2567 i‡(!
°©us
)

2568 
out_u∆ock
;

2570 
	`IWL_DEBUG_WOWLAN
(
mvm
, "wakeupÑeason 0x%x\n",

2571 
°©us
->
wakeup_ªas⁄s
);

2574 
mvm_≠_°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 0);

2575 i‡(!
mvm_≠_°a
)

2576 
out_u∆ock
;

2578 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

2579 
u16
 
£q
 = 
°©us
->
qos_£q_˘r
[
i
];

2581 
£q
 += 0x10;

2582 
mvm_≠_°a
->
tid_d©a
[
i
].
£q_numbî
 = 
£q
;

2585 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
) {

2586 
i
 = 
mvm
->
ofÊﬂd_tid
;

2587 
	`iwl_å™s_£t_q_±rs
(
mvm
->
å™s
,

2588 
mvm_≠_°a
->
tid_d©a
[
i
].
txq_id
,

2589 
mvm_≠_°a
->
tid_d©a
[
i
].
£q_numbî
 >> 4);

2592 
	`iwl_mvm_ªp‹t_wakeup_ªas⁄s
(
mvm
, 
vif
, 
°©us
);

2594 
kìp
 = 
	`iwl_mvm_£tup_c⁄√˘i⁄_kìp
(
mvm
, 
vif
, 
°©us
);

2595 
out_u∆ock
:

2596 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2597  
kìp
;

2598 
	}
}

2600 
	#ND_QUERY_BUF_LEN
 ((
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch
) * \

2601 
IWL_SCAN_MAX_PROFILES
)

	)

2603 
	siwl_mvm_nd_ªsu…s
 {

2604 
u32
 
	mm©ched_¥ofûes
;

2605 
u8
 
	mm©ches
[
ND_QUERY_BUF_LEN
];

2609 
	$iwl_mvm_√tdëe˘_quîy_ªsu…s
(
iwl_mvm
 *
mvm
,

2610 
iwl_mvm_nd_ªsu…s
 *
ªsu…s
)

2612 
iwl_sˇn_ofÊﬂd_m©ch_öfo
 *
quîy
;

2613 
iwl_ho°_cmd
 
cmd
 = {

2614 .
id
 = 
SCAN_OFFLOAD_PROFILES_QUERY_CMD
,

2615 .
Êags
 = 
CMD_WANT_SKB
,

2617 
ªt
, 
Àn
;

2618 
size_t
 
quîy_Àn
, 
m©ches_Àn
;

2619 
max_¥ofûes
 = 
	`iwl_umac_sˇn_gë_max_¥ofûes
(
mvm
->
fw
);

2621 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

2622 i‡(
ªt
) {

2623 
	`IWL_ERR
(
mvm
, "ÁûedÅÿquîy m©chedÖrofûe†(%d)\n", 
ªt
);

2624  
ªt
;

2627 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

2628 
IWL_UCODE_TLV_API_SCAN_OFFLOAD_CHANS
)) {

2629 
quîy_Àn
 = (
iwl_sˇn_ofÊﬂd_m©ch_öfo
);

2630 
m©ches_Àn
 = (
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch
) *

2631 
max_¥ofûes
;

2633 
quîy_Àn
 = (
iwl_sˇn_ofÊﬂd_¥ofûes_quîy_v1
);

2634 
m©ches_Àn
 = (
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch_v1
) *

2635 
max_¥ofûes
;

2638 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
cmd
.
ª•_pkt
);

2639 i‡(
Àn
 < 
quîy_Àn
) {

2640 
	`IWL_ERR
(
mvm
, "Invalid scan offloadÖrofiles queryÑesponse!\n");

2641 
ªt
 = -
EIO
;

2642 
out_‰ì_ª•
;

2645 
quîy
 = (*)
cmd
.
ª•_pkt
->
d©a
;

2647 
ªsu…s
->
m©ched_¥ofûes
 = 
	`À32_to_˝u
(
quîy
->matched_profiles);

2648 
	`mem˝y
(
ªsu…s
->
m©ches
, 
quîy
->m©ches, 
m©ches_Àn
);

2650 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2651 
mvm
->
œ°_√tdëe˘_sˇns
 = 
	`À32_to_˝u
(
quîy
->
n_sˇns_d⁄e
);

2654 
out_‰ì_ª•
:

2655 
	`iwl_‰ì_ª•
(&
cmd
);

2656  
ªt
;

2657 
	}
}

2659 
	$iwl_mvm_quîy_num_m©ch_ch™s
(
iwl_mvm
 *
mvm
,

2660 
iwl_mvm_nd_ªsu…s
 *
ªsu…s
,

2661 
idx
)

2663 
n_ch™s
 = 0, 
i
;

2665 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

2666 
IWL_UCODE_TLV_API_SCAN_OFFLOAD_CHANS
)) {

2667 
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch
 *
m©ches
 =

2668 (*)
ªsu…s
->
m©ches
;

2670 
i
 = 0; i < 
SCAN_OFFLOAD_MATCHING_CHANNELS_LEN
; i++)

2671 
n_ch™s
 +
	`hweight8
(
m©ches
[
idx
].
m©chög_ch™√ls
[
i
]);

2673 
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch_v1
 *
m©ches
 =

2674 (*)
ªsu…s
->
m©ches
;

2676 
i
 = 0; i < 
SCAN_OFFLOAD_MATCHING_CHANNELS_LEN_V1
; i++)

2677 
n_ch™s
 +
	`hweight8
(
m©ches
[
idx
].
m©chög_ch™√ls
[
i
]);

2680  
n_ch™s
;

2681 
	}
}

2683 
	$iwl_mvm_quîy_£t_‰eqs
(
iwl_mvm
 *
mvm
,

2684 
iwl_mvm_nd_ªsu…s
 *
ªsu…s
,

2685 
cfg80211_wowœn_nd_m©ch
 *
m©ch
,

2686 
idx
)

2688 
i
;

2690 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

2691 
IWL_UCODE_TLV_API_SCAN_OFFLOAD_CHANS
)) {

2692 
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch
 *
m©ches
 =

2693 (*)
ªsu…s
->
m©ches
;

2695 
i
 = 0; i < 
SCAN_OFFLOAD_MATCHING_CHANNELS_LEN
 * 8; i++)

2696 i‡(
m©ches
[
idx
].
m©chög_ch™√ls
[
i
 / 8] & (
	`BIT
(i % 8)))

2697 
m©ch
->
ch™√ls
[m©ch->
n_ch™√ls
++] =

2698 
mvm
->
nd_ch™√ls
[
i
]->
˚¡î_‰eq
;

2700 
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch_v1
 *
m©ches
 =

2701 (*)
ªsu…s
->
m©ches
;

2703 
i
 = 0; i < 
SCAN_OFFLOAD_MATCHING_CHANNELS_LEN_V1
 * 8; i++)

2704 i‡(
m©ches
[
idx
].
m©chög_ch™√ls
[
i
 / 8] & (
	`BIT
(i % 8)))

2705 
m©ch
->
ch™√ls
[m©ch->
n_ch™√ls
++] =

2706 
mvm
->
nd_ch™√ls
[
i
]->
˚¡î_‰eq
;

2708 
	}
}

2718 
	eiwl_d3_nŸif
 {

2719 
	mIWL_D3_NOTIF_WOWLAN_INFO
 = 
BIT
(0),

2720 
	mIWL_D3_NOTIF_WOWLAN_WAKE_PKT
 = 
BIT
(1),

2721 
	mIWL_D3_NOTIF_PROT_OFFLOAD
 = 
BIT
(2),

2722 
	mIWL_D3_ND_MATCH_INFO
 = 
BIT
(3),

2723 
	mIWL_D3_NOTIF_D3_END_NOTIF
 = 
BIT
(4)

2727 
	siwl_d3_d©a
 {

2728 
iwl_wowœn_°©us_d©a
 *
	m°©us
;

2729 
boﬁ
 
	mã°
;

2730 
u32
 
	md3_íd_Êags
;

2731 
u32
 
	mnŸif_ex≥˘ed
;

2732 
u32
 
	mnŸif_ª˚ived
;

2733 
iwl_mvm_nd_ªsu…s
 *
	mnd_ªsu…s
;

2734 
boﬁ
 
	mnd_ªsu…s_vÆid
;

2737 
	$iwl_mvm_quîy_√tdëe˘_ªas⁄s
(
iwl_mvm
 *
mvm
,

2738 
õì80211_vif
 *
vif
,

2739 
iwl_d3_d©a
 *
d3_d©a
)

2741 
cfg80211_wowœn_nd_öfo
 *
√t_dëe˘
 = 
NULL
;

2742 
cfg80211_wowœn_wakeup
 
wakeup
 = {

2743 .
∑âîn_idx
 = -1,

2745 
cfg80211_wowœn_wakeup
 *
wakeup_ªp‹t
 = &
wakeup
;

2746 
m©ched_¥ofûes
;

2747 
u32
 
ªas⁄s
 = 0;

2748 
i
, 
n_m©ches
, 
ªt
;

2750 i‡(
	`WARN_ON
(!
d3_d©a
 || !d3_d©a->
°©us
))

2751 
out
;

2753 
ªas⁄s
 = 
d3_d©a
->
°©us
->
wakeup_ªas⁄s
;

2755 i‡(
ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_BY_RFKILL_DEASSERTED
)

2756 
wakeup
.
rfkûl_ªÀa£
 = 
åue
;

2758 i‡(
ªas⁄s
 !
IWL_WOWLAN_WAKEUP_BY_NON_WIRELESS
)

2759 
out
;

2761 i‡(!
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

2762 
WOWLAN_INFO_NOTIFICATION
, 0)) {

2763 
	`IWL_INFO
(
mvm
, "Query FW for NDÑesults\n");

2764 
ªt
 = 
	`iwl_mvm_√tdëe˘_quîy_ªsu…s
(
mvm
, 
d3_d©a
->
nd_ªsu…s
);

2767 
	`IWL_INFO
(
mvm
, "Notification based NDÑesults\n");

2768 
ªt
 = 
d3_d©a
->
nd_ªsu…s_vÆid
 ? 0 : -1;

2771 i‡(
ªt
 || !
d3_d©a
->
nd_ªsu…s
->
m©ched_¥ofûes
) {

2772 
wakeup_ªp‹t
 = 
NULL
;

2773 
out
;

2776 
m©ched_¥ofûes
 = 
d3_d©a
->
nd_ªsu…s
->matched_profiles;

2777 i‡(
mvm
->
n_nd_m©ch_£ts
) {

2778 
n_m©ches
 = 
	`hweight_l⁄g
(
m©ched_¥ofûes
);

2780 
	`IWL_ERR
(
mvm
, "noÇet detect match informationávailable\n");

2781 
n_m©ches
 = 0;

2784 
√t_dëe˘
 = 
	`kzÆloc
(
	`°ru˘_size
“ë_dëe˘, 
m©ches
, 
n_m©ches
),

2785 
GFP_KERNEL
);

2786 i‡(!
√t_dëe˘
 || !
n_m©ches
)

2787 
out_ªp‹t_nd
;

2789 
	`f‹_óch_£t_bô
(
i
, &
m©ched_¥ofûes
, 
mvm
->
n_nd_m©ch_£ts
) {

2790 
cfg80211_wowœn_nd_m©ch
 *
m©ch
;

2791 
idx
, 
n_ch™√ls
 = 0;

2793 
n_ch™√ls
 = 
	`iwl_mvm_quîy_num_m©ch_ch™s
(
mvm
,

2794 
d3_d©a
->
nd_ªsu…s
,

2795 
i
);

2797 
m©ch
 = 
	`kzÆloc
(
	`°ru˘_size
(m©ch, 
ch™√ls
, 
n_ch™√ls
),

2798 
GFP_KERNEL
);

2799 i‡(!
m©ch
)

2800 
out_ªp‹t_nd
;

2802 
√t_dëe˘
->
m©ches
[√t_dëe˘->
n_m©ches
++] = 
m©ch
;

2807 
idx
 = 
mvm
->
n_nd_m©ch_£ts
 - 
i
 - 1;

2808 
m©ch
->
ssid
.
ssid_Àn
 = 
mvm
->
nd_m©ch_£ts
[
idx
].ssid.ssid_len;

2809 
	`mem˝y
(
m©ch
->
ssid
.ssid, 
mvm
->
nd_m©ch_£ts
[
idx
].ssid.ssid,

2810 
m©ch
->
ssid
.
ssid_Àn
);

2812 i‡(
mvm
->
n_nd_ch™√ls
 < 
n_ch™√ls
)

2815 
	`iwl_mvm_quîy_£t_‰eqs
(
mvm
, 
d3_d©a
->
nd_ªsu…s
, 
m©ch
, 
i
);

2818 
out_ªp‹t_nd
:

2819 
wakeup
.
√t_dëe˘
 =Çet_detect;

2820 
out
:

2821 
	`iwl_mvm_‰ì_nd
(
mvm
);

2823 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2824 
	`õì80211_ªp‹t_wowœn_wakeup
(
vif
, 
wakeup_ªp‹t
, 
GFP_KERNEL
);

2826 i‡(
√t_dëe˘
) {

2827 
i
 = 0; i < 
√t_dëe˘
->
n_m©ches
; i++)

2828 
	`k‰ì
(
√t_dëe˘
->
m©ches
[
i
]);

2829 
	`k‰ì
(
√t_dëe˘
);

2831 
	}
}

2833 
	$iwl_mvm_d3_disc⁄√˘_ôî
(*
d©a
, 
u8
 *
mac
,

2834 
õì80211_vif
 *
vif
)

2837 i‡(
d©a
 =
vif
)

2840 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

2841 
	`õì80211_ªsume_disc⁄√˘
(
vif
);

2842 
	}
}

2844 
boﬁ
 
	$iwl_mvm_π_°©us
(
iwl_å™s
 *
å™s
, 
u32
 
ba£
, u32 *
îr_id
)

2846 
	sîr‹_èbÀ_°¨t
 {

2848 
u32
 
vÆid
;

2849 
__À32
 
îr_id
;

2850 } 
îr_öfo
;

2852 i‡(!
ba£
)

2853  
Ál£
;

2855 
	`iwl_å™s_ªad_mem_byãs
(
å™s
, 
ba£
,

2856 &
îr_öfo
, (err_info));

2857 i‡(
îr_öfo
.
vÆid
 && 
îr_id
)

2858 *
îr_id
 = 
	`À32_to_˝u
(
îr_öfo
.err_id);

2860  !!
îr_öfo
.
vÆid
;

2861 
	}
}

2863 
boﬁ
 
	$iwl_mvm_check_π_°©us
(
iwl_mvm
 *
mvm
,

2864 
õì80211_vif
 *
vif
)

2866 
u32
 
îr_id
;

2869 i‡(
	`iwl_mvm_π_°©us
(
mvm
->
å™s
,

2870 
mvm
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[0],

2871 &
îr_id
)) {

2872 i‡(
îr_id
 =
RF_KILL_INDICATOR_FOR_WOWLAN
) {

2873 
cfg80211_wowœn_wakeup
 
wakeup
 = {

2874 .
rfkûl_ªÀa£
 = 
åue
,

2876 
	`õì80211_ªp‹t_wowœn_wakeup
(
vif
, &
wakeup
,

2877 
GFP_KERNEL
);

2879  
åue
;

2883 i‡(
	`iwl_mvm_π_°©us
(
mvm
->
å™s
,

2884 
mvm
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[1], 
NULL
))

2885  
åue
;

2888 i‡(
	`iwl_mvm_π_°©us
(
mvm
->
å™s
,

2889 
mvm
->
å™s
->
dbg
.
umac_îr‹_evít_èbÀ
, 
NULL
))

2890  
åue
;

2892  
Ál£
;

2893 
	}
}

2900 
boﬁ


2901 
	$iwl_mvm_choo£_quîy_wakeup_ªas⁄s
(
iwl_mvm
 *
mvm
,

2902 
õì80211_vif
 *
vif
,

2903 
iwl_d3_d©a
 *
d3_d©a
)

2905 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2908 i‡(!
d3_d©a
->
°©us
) {

2909 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2910 
u8
 
°a_id
 = 
mvm
->
√t_dëe˘
 ? 
IWL_MVM_INVALID_STA
 :

2911 
mvmvif
->
deÊök
.
≠_°a_id
;

2914 
	`WARN_ON
(
	`õì80211_vif_is_mld
(
vif
));

2916 
d3_d©a
->
°©us
 = 
	`iwl_mvm_£nd_wowœn_gë_°©us
(
mvm
, 
°a_id
);

2919 i‡(
mvm
->
√t_dëe˘
) {

2920 
	`iwl_mvm_quîy_√tdëe˘_ªas⁄s
(
mvm
, 
vif
, 
d3_d©a
);

2922 
boﬁ
 
kìp
 = 
	`iwl_mvm_quîy_wakeup_ªas⁄s
(
mvm
, 
vif
,

2923 
d3_d©a
->
°©us
);

2925 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2926 i‡(
kìp
)

2927 
mvm
->
kìp_vif
 = 
vif
;

2930  
kìp
;

2932  
Ál£
;

2933 
	}
}

2935 
	#IWL_WOWLAN_WAKEUP_REASON_HAS_WAKEUP_PKT
 (
IWL_WOWLAN_WAKEUP_BY_MAGIC_PACKET
 | \

2936 
IWL_WOWLAN_WAKEUP_BY_PATTERN
 | \

2937 
IWL_WAKEUP_BY_PATTERN_IPV4_TCP_SYN
 |\

2938 
IWL_WAKEUP_BY_PATTERN_IPV4_TCP_SYN_WILDCARD
 |\

2939 
IWL_WAKEUP_BY_PATTERN_IPV6_TCP_SYN
 |\

2940 
IWL_WAKEUP_BY_PATTERN_IPV6_TCP_SYN_WILDCARD
)

	)

2942 
	$iwl_mvm_wowœn_°‹e_wake_pkt
(
iwl_mvm
 *
mvm
,

2943 
iwl_wowœn_wake_pkt_nŸif
 *
nŸif
,

2944 
iwl_wowœn_°©us_d©a
 *
°©us
,

2945 
u32
 
Àn
)

2947 
u32
 
d©a_size
, 
∑ckë_Àn
 = 
	`À32_to_˝u
(
nŸif
->
wake_∑ckë_Àngth
);

2949 i‡(
Àn
 < (*
nŸif
)) {

2950 
	`IWL_ERR
(
mvm
, "Invalid WoWLAN wakeÖacketÇotification!\n");

2951  -
EIO
;

2954 i‡(
	`WARN_ON
(!
°©us
)) {

2955 
	`IWL_ERR
(
mvm
, "Got wakeÖacketÇotification but wowlan status data is NULL\n");

2956  -
EIO
;

2959 i‡(
	`WARN_ON
(!(
°©us
->
wakeup_ªas⁄s
 &

2960 
IWL_WOWLAN_WAKEUP_REASON_HAS_WAKEUP_PKT
))) {

2961 
	`IWL_ERR
(
mvm
, "Got wakeupÖacket but wakeupÑeason is %x\n",

2962 
°©us
->
wakeup_ªas⁄s
);

2963  -
EIO
;

2966 
d©a_size
 = 
Àn
 - 
	`off£tof
(
iwl_wowœn_wake_pkt_nŸif
, 
wake_∑ckë
);

2969 i‡(
∑ckë_Àn
 < 
d©a_size
)

2970 
d©a_size
 = 
∑ckë_Àn
;

2972 
°©us
->
wake_∑ckë
 = 
	`kmemdup
(
nŸif
->wake_∑ckë, 
d©a_size
,

2973 
GFP_ATOMIC
);

2975 i‡(!
°©us
->
wake_∑ckë
)

2976  -
ENOMEM
;

2978 
°©us
->
wake_∑ckë_Àngth
 = 
∑ckë_Àn
;

2979 
°©us
->
wake_∑ckë_bufsize
 = 
d©a_size
;

2982 
	}
}

2984 
	$iwl_mvm_nd_m©ch_öfo_h™dÀr
(
iwl_mvm
 *
mvm
,

2985 
iwl_d3_d©a
 *
d3_d©a
,

2986 
iwl_sˇn_ofÊﬂd_m©ch_öfo
 *
nŸif
,

2987 
u32
 
Àn
)

2989 
iwl_wowœn_°©us_d©a
 *
°©us
 = 
d3_d©a
->status;

2990 
õì80211_vif
 *
vif
 = 
	`iwl_mvm_gë_bss_vif
(
mvm
);

2991 
iwl_mvm_nd_ªsu…s
 *
ªsu…s
 = 
d3_d©a
->
nd_ªsu…s
;

2992 
size_t
 
i
, 
m©ches_Àn
 = (
iwl_sˇn_ofÊﬂd_¥ofûe_m©ch
) *

2993 
	`iwl_umac_sˇn_gë_max_¥ofûes
(
mvm
->
fw
);

2995 i‡(
	`IS_ERR_OR_NULL
(
vif
))

2998 i‡(
Àn
 < (
iwl_sˇn_ofÊﬂd_m©ch_öfo
)) {

2999 
	`IWL_ERR
(
mvm
, "Invalid scan match infoÇotification\n");

3003 i‡(!
mvm
->
√t_dëe˘
) {

3004 
	`IWL_ERR
(
mvm
, "Unexpected scan match infoÇotification\n");

3008 i‡(!
°©us
 || sètus->
wakeup_ªas⁄s
 !
IWL_WOWLAN_WAKEUP_BY_NON_WIRELESS
) {

3009 
	`IWL_ERR
(
mvm
,

3014 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3015 
mvm
->
œ°_√tdëe˘_sˇns
 = 
	`À32_to_˝u
(
nŸif
->
n_sˇns_d⁄e
);

3018 
ªsu…s
->
m©ched_¥ofûes
 = 
	`À32_to_˝u
(
nŸif
->matched_profiles);

3019 
	`IWL_INFO
(
mvm
, "number of matchedÖrofiles=%u\n",

3020 
ªsu…s
->
m©ched_¥ofûes
);

3022 i‡(
ªsu…s
->
m©ched_¥ofûes
) {

3023 
	`mem˝y
(
ªsu…s
->
m©ches
, 
nŸif
->m©ches, 
m©ches_Àn
);

3024 
d3_d©a
->
nd_ªsu…s_vÆid
 = 
åue
;

3028 
mvm
->
sˇn_°©us
 = 0;

3029 
i
 = 0; i < 
mvm
->
max_sˇns
; i++)

3030 
mvm
->
sˇn_uid_°©us
[
i
] = 0;

3031 
	}
}

3033 
boﬁ
 
	$iwl_mvm_waô_d3_nŸif
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

3034 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

3036 
iwl_mvm
 *
mvm
 =

3037 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

3038 
iwl_d3_d©a
 *
d3_d©a
 = 
d©a
;

3039 
u32
 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

3040 
ªt
;

3041 
wowœn_öfo_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
,

3042 
PROT_OFFLOAD_GROUP
,

3043 
WOWLAN_INFO_NOTIFICATION
,

3044 
IWL_FW_CMD_VER_UNKNOWN
);

3047 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.
cmd
)) {

3048 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
WOWLAN_INFO_NOTIFICATION
): {

3050 i‡(
d3_d©a
->
nŸif_ª˚ived
 & 
IWL_D3_NOTIF_WOWLAN_INFO
) {

3052 
	`IWL_DEBUG_WOWLAN
(
mvm
,

3057 i‡(
wowœn_öfo_vî
 < 2) {

3058 
iwl_wowœn_öfo_nŸif_v1
 *
nŸif_v1
 =

3059 (*)
pkt
->
d©a
;

3060 
iwl_wowœn_öfo_nŸif_v2
 *
nŸif_v2
;

3062 
nŸif_v2
 = 
	`kmemdup
(
nŸif_v1
, (*nŸif_v2), 
GFP_ATOMIC
);

3064 i‡(!
nŸif_v2
)

3065  
Ál£
;

3067 
nŸif_v2
->
tid_ã¨_down
 = 
nŸif_v1
->tid_tear_down;

3068 
nŸif_v2
->
°©i⁄_id
 = 
nŸif_v1
->station_id;

3069 
	`mem£t_a·î
(
nŸif_v2
, 0, 
°©i⁄_id
);

3070 
	`iwl_mvm_∑r£_wowœn_öfo_nŸif_v2
(
mvm
, 
nŸif_v2
,

3071 
d3_d©a
->
°©us
,

3072 
Àn
);

3073 
	`k‰ì
(
nŸif_v2
);

3075 } i‡(
wowœn_öfo_vî
 == 2) {

3076 
iwl_wowœn_öfo_nŸif_v2
 *
nŸif_v2
 =

3077 (*)
pkt
->
d©a
;

3079 
	`iwl_mvm_∑r£_wowœn_öfo_nŸif_v2
(
mvm
, 
nŸif_v2
,

3080 
d3_d©a
->
°©us
,

3081 
Àn
);

3083 
iwl_wowœn_öfo_nŸif
 *
nŸif
 =

3084 (*)
pkt
->
d©a
;

3086 
	`iwl_mvm_∑r£_wowœn_öfo_nŸif
(
mvm
, 
nŸif
,

3087 
d3_d©a
->
°©us
, 
Àn
);

3090 
d3_d©a
->
nŸif_ª˚ived
 |
IWL_D3_NOTIF_WOWLAN_INFO
;

3092 i‡(
d3_d©a
->
°©us
 &&

3093 
d3_d©a
->
°©us
->
wakeup_ªas⁄s
 & 
IWL_WOWLAN_WAKEUP_REASON_HAS_WAKEUP_PKT
)

3095 
d3_d©a
->
nŸif_ex≥˘ed
 |
IWL_D3_NOTIF_WOWLAN_WAKE_PKT
;

3099 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
WOWLAN_WAKE_PKT_NOTIFICATION
): {

3100 
iwl_wowœn_wake_pkt_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

3102 i‡(
d3_d©a
->
nŸif_ª˚ived
 & 
IWL_D3_NOTIF_WOWLAN_WAKE_PKT
) {

3104 
	`IWL_ERR
(
mvm
,

3107 
d3_d©a
->
nŸif_ª˚ived
 |
IWL_D3_NOTIF_WOWLAN_WAKE_PKT
;

3108 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

3109 
ªt
 = 
	`iwl_mvm_wowœn_°‹e_wake_pkt
(
mvm
, 
nŸif
,

3110 
d3_d©a
->
°©us
,

3111 
Àn
);

3112 i‡(
ªt
)

3113 
	`IWL_ERR
(
mvm
,

3119 
	`WIDE_ID
(
SCAN_GROUP
, 
OFFLOAD_MATCH_INFO_NOTIF
): {

3120 
iwl_sˇn_ofÊﬂd_m©ch_öfo
 *
nŸif
 = (*)
pkt
->
d©a
;

3122 i‡(
d3_d©a
->
nŸif_ª˚ived
 & 
IWL_D3_ND_MATCH_INFO
) {

3123 
	`IWL_ERR
(
mvm
,

3128 
d3_d©a
->
nŸif_ª˚ived
 |
IWL_D3_ND_MATCH_INFO
;

3131 
d3_d©a
->
nŸif_ex≥˘ed
 |
IWL_D3_ND_MATCH_INFO
;

3133 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

3134 
	`iwl_mvm_nd_m©ch_öfo_h™dÀr
(
mvm
, 
d3_d©a
, 
nŸif
, 
Àn
);

3137 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
D3_END_NOTIFICATION
): {

3138 
iwl_mvm_d3_íd_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

3140 
d3_d©a
->
d3_íd_Êags
 = 
	`__À32_to_˝u
(
nŸif
->
Êags
);

3141 
d3_d©a
->
nŸif_ª˚ived
 |
IWL_D3_NOTIF_D3_END_NOTIF
;

3146 
	`WARN_ON
(1);

3149  
d3_d©a
->
nŸif_ª˚ived
 =d3_d©a->
nŸif_ex≥˘ed
;

3150 
	}
}

3152 
	$iwl_mvm_ªsume_fúmw¨e
(
iwl_mvm
 *
mvm
, 
boﬁ
 
ã°
)

3154 
ªt
;

3155 
iwl_d3_°©us
 
d3_°©us
;

3156 
iwl_ho°_cmd
 
cmd
 = {

3157 .
id
 = 
D0I3_END_CMD
,

3158 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_D3
,

3160 
boﬁ
 
ª£t
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

3161 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

3163 
ªt
 = 
	`iwl_å™s_d3_ªsume
(
mvm
->
å™s
, &
d3_°©us
, 
ã°
, !
ª£t
);

3164 i‡(
ªt
)

3165  
ªt
;

3167 i‡(
d3_°©us
 !
IWL_D3_STATUS_ALIVE
) {

3168 
	`IWL_INFO
(
mvm
, "Device wasÑeset during suspend\n");

3169  -
ENOENT
;

3177 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 <
IWL_DEVICE_FAMILY_22000
 &&

3178 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_D0I3_END_FIRST
)) {

3179 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

3180 i‡(
ªt
 < 0)

3181 
	`IWL_ERR
(
mvm
, "FailedÅo send D0I3_END_CMD first (%d)\n",

3182 
ªt
);

3185  
ªt
;

3186 
	}
}

3188 
	#IWL_MVM_D3_NOTIF_TIMEOUT
 (
HZ
 / 5)

	)

3190 
	$iwl_mvm_d3_nŸif_waô
(
iwl_mvm
 *
mvm
,

3191 
iwl_d3_d©a
 *
d3_d©a
)

3193 c⁄° 
u16
 
d3_ªsume_nŸif
[] = {

3194 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
WOWLAN_INFO_NOTIFICATION
),

3195 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
WOWLAN_WAKE_PKT_NOTIFICATION
),

3196 
	`WIDE_ID
(
SCAN_GROUP
, 
OFFLOAD_MATCH_INFO_NOTIF
),

3197 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
D3_END_NOTIFICATION
)

3199 
iwl_nŸifiˇti⁄_waô
 
waô_d3_nŸif
;

3200 
ªt
;

3202 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_d3_nŸif
,

3203 
d3_ªsume_nŸif
, 
	`ARRAY_SIZE
(d3_resume_notif),

3204 
iwl_mvm_waô_d3_nŸif
, 
d3_d©a
);

3206 
ªt
 = 
	`iwl_mvm_ªsume_fúmw¨e
(
mvm
, 
d3_d©a
->
ã°
);

3207 i‡(
ªt
) {

3208 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_d3_nŸif
);

3209  
ªt
;

3212  
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_d3_nŸif
,

3213 
IWL_MVM_D3_NOTIF_TIMEOUT
);

3214 
	}
}

3216 
ölöe
 
boﬁ
 
	$iwl_mvm_d3_ªsume_nŸif_ba£d
(
iwl_mvm
 *
mvm
)

3218  
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

3219 
WOWLAN_INFO_NOTIFICATION
, 0) &&

3220 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

3221 
WOWLAN_WAKE_PKT_NOTIFICATION
, 0) &&

3222 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

3223 
D3_END_NOTIFICATION
, 0);

3224 
	}
}

3226 
	$__iwl_mvm_ªsume
(
iwl_mvm
 *
mvm
, 
boﬁ
 
ã°
)

3228 
õì80211_vif
 *
vif
 = 
NULL
;

3229 
ªt
 = 1;

3230 
iwl_mvm_nd_ªsu…s
 
ªsu…s
 = {};

3231 
iwl_d3_d©a
 
d3_d©a
 = {

3232 .
ã°
 =Åest,

3233 .
nŸif_ex≥˘ed
 =

3234 
IWL_D3_NOTIF_WOWLAN_INFO
 |

3235 
IWL_D3_NOTIF_D3_END_NOTIF
,

3236 .
nd_ªsu…s_vÆid
 = 
Ál£
,

3237 .
nd_ªsu…s
 = &
ªsu…s
,

3239 
boﬁ
 
unifõd_image
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

3240 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

3241 
boﬁ
 
d0i3_fú°
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

3242 
IWL_UCODE_TLV_CAPA_D0I3_END_FIRST
);

3243 
boﬁ
 
ªsume_nŸif_ba£d
 = 
	`iwl_mvm_d3_ªsume_nŸif_ba£d
(
mvm
);

3244 
boﬁ
 
kìp
 = 
Ál£
;

3246 
	`muãx_lock
(&
mvm
->
muãx
);

3248 
mvm
->
œ°_ª£t_‹_ªsume_time_jiffõs
 = 
jiffõs
;

3251 
vif
 = 
	`iwl_mvm_gë_bss_vif
(
mvm
);

3252 i‡(
	`IS_ERR_OR_NULL
(
vif
))

3253 
îr
;

3255 
	`iwl_fw_dbg_ªad_d3_debug_d©a
(&
mvm
->
fwπ
);

3257 i‡(
	`iwl_mvm_check_π_°©us
(
mvm
, 
vif
)) {

3258 
	`£t_bô
(
STATUS_FW_ERROR
, &
mvm
->
å™s
->
°©us
);

3259 
	`iwl_mvm_dump_nic_îr‹_log
(
mvm
);

3260 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

3261 
IWL_FW_INI_TIME_POINT_FW_ASSERT
, 
NULL
);

3262 
	`iwl_fw_dbg_cﬁÀ˘_desc
(&
mvm
->
fwπ
, &
iwl_dump_desc_as£π
,

3263 
Ál£
, 0);

3264 
ªt
 = 1;

3265 
îr
;

3268 i‡(
ªsume_nŸif_ba£d
) {

3269 
d3_d©a
.
°©us
 = 
	`kzÆloc
((*d3_d©a.°©us), 
GFP_KERNEL
);

3270 i‡(!
d3_d©a
.
°©us
) {

3271 
	`IWL_ERR
(
mvm
, "FailedÅoállocate wowlan status\n");

3272 
ªt
 = -
ENOMEM
;

3273 
îr
;

3276 
ªt
 = 
	`iwl_mvm_d3_nŸif_waô
(
mvm
, &
d3_d©a
);

3277 i‡(
ªt
)

3278 
îr
;

3280 
ªt
 = 
	`iwl_mvm_ªsume_fúmw¨e
(
mvm
, 
ã°
);

3281 i‡(
ªt
 < 0)

3282 
îr
;

3286 
mvm
->
å™s
->
sy°em_pm_mode
 = 
IWL_PLAT_PM_MODE_DISABLED
;

3289 i‡(
d3_d©a
.
d3_íd_Êags
 & 
IWL_D0I3_RESET_REQUIRE
)

3290 
quîy_wakeup_ªas⁄s
;

3296 
	`iwl_mvm_upd©e_ch™ged_ªgdom
(
mvm
);

3299 
	`iwl_mvm_µag_£nd_cmd
(
mvm
);

3301 i‡(!
unifõd_image
)

3303 
	`iwl_mvm_ßr_£À˘_¥ofûe
(
mvm
, 1, 1);

3305 i‡(
mvm
->
√t_dëe˘
 && 
unifõd_image
) {

3312 
ªt
 = 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_NETDETECT
,

3313 
Ál£
);

3316 
quîy_wakeup_ªas⁄s
:

3317 
kìp
 = 
	`iwl_mvm_choo£_quîy_wakeup_ªas⁄s
(
mvm
, 
vif
, &
d3_d©a
);

3319 
out
;

3321 
îr
:

3322 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3323 
out
:

3324 i‡(
d3_d©a
.
°©us
)

3325 
	`k‰ì
(
d3_d©a
.
°©us
->
wake_∑ckë
);

3326 
	`k‰ì
(
d3_d©a
.
°©us
);

3327 
	`iwl_mvm_‰ì_nd
(
mvm
);

3329 i‡(!
d3_d©a
.
ã°
 && !
mvm
->
√t_dëe˘
)

3330 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_mtx
(
mvm
->
hw
,

3331 
IEEE80211_IFACE_ITER_NORMAL
,

3332 
iwl_mvm_d3_disc⁄√˘_ôî
,

3333 
kìp
 ? 
vif
 : 
NULL
);

3335 
	`˛ór_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
);

3338 i‡(
unifõd_image
 && !
ªt
) {

3340 i‡(
d0i3_fú°
)

3343 i‡(!
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PROT_OFFLOAD_GROUP
,

3344 
D3_END_NOTIFICATION
, 0)) {

3345 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
D0I3_END_CMD
, 0, 0, 
NULL
);

3346 i‡(!
ªt
)

3348 } i‡(!(
d3_d©a
.
d3_íd_Êags
 & 
IWL_D0I3_RESET_REQUIRE
)) {

3358 
	`£t_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
, &
mvm
->
°©us
);

3361 
mvm
->
å™s
->
sy°em_pm_mode
 = 
IWL_PLAT_PM_MODE_DISABLED
;

3364 
	}
}

3366 
	$iwl_mvm_ªsume
(
õì80211_hw
 *
hw
)

3368 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3369 
ªt
;

3371 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3373 
ªt
 = 
	`__iwl_mvm_ªsume
(
mvm
, 
Ál£
);

3375 
	`iwl_mvm_ªsume_tcm
(
mvm
);

3377 
	`iwl_fw_ru¡ime_ªsume
(&
mvm
->
fwπ
);

3379 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3380  
ªt
;

3381 
	}
}

3383 
	$iwl_mvm_£t_wakeup
(
õì80211_hw
 *
hw
, 
boﬁ
 
íabÀd
)

3385 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3387 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3388 
	`devi˚_£t_wakeup_íabÀ
(
mvm
->
å™s
->
dev
, 
íabÀd
);

3389 
	}
}

3391 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3392 
	$iwl_mvm_d3_ã°_›í
(
öode
 *öode, 
fûe
 *file)

3394 
iwl_mvm
 *
mvm
 = 
öode
->
i_¥iv©e
;

3395 
îr
;

3397 i‡(
mvm
->
d3_ã°_a˘ive
)

3398  -
EBUSY
;

3400 
fûe
->
¥iv©e_d©a
 = 
öode
->
i_¥iv©e
;

3402 
	`iwl_mvm_∑u£_tcm
(
mvm
, 
åue
);

3404 
	`iwl_fw_ru¡ime_su•íd
(&
mvm
->
fwπ
);

3407 
	`π∆_lock
();

3408 
	`wùhy_lock
(
mvm
->
hw
->
wùhy
);

3409 
îr
 = 
	`__iwl_mvm_su•íd
(
mvm
->
hw
, mvm->hw->
wùhy
->
wowœn_c⁄fig
, 
åue
);

3410 
	`wùhy_u∆ock
(
mvm
->
hw
->
wùhy
);

3411 
	`π∆_u∆ock
();

3412 i‡(
îr
 > 0)

3413 
îr
 = -
EINVAL
;

3414 i‡(
îr
)

3415  
îr
;

3417 
mvm
->
d3_ã°_a˘ive
 = 
åue
;

3418 
mvm
->
kìp_vif
 = 
NULL
;

3420 
	}
}

3422 
ssize_t
 
	$iwl_mvm_d3_ã°_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

3423 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3425 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

3426 
íd
 = 
jiffõs
 + 60 * 
HZ
;

3427 
u32
 
pme_as£πed
;

3429 
åue
) {

3431 i‡(
mvm
->
d3_ã°_pme_±r
) {

3432 
pme_as£πed
 = 
	`iwl_å™s_ªad_mem32
(
mvm
->
å™s
,

3433 
mvm
->
d3_ã°_pme_±r
);

3434 i‡(
pme_as£πed
)

3438 i‡(
	`m¶ìp_öãºu±ibÀ
(100))

3441 i‡(
	`time_is_bef‹e_jiffõs
(
íd
)) {

3442 
	`IWL_ERR
(
mvm
,

3444  -
ETIMEDOUT
;

3449 
	}
}

3451 
	$iwl_mvm_d3_ã°_disc⁄n_w‹k_ôî
(*
_d©a
, 
u8
 *
mac
,

3452 
õì80211_vif
 *
vif
)

3455 i‡(
_d©a
 =
vif
)

3458 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

3459 
	`õì80211_c⁄√˘i⁄_loss
(
vif
);

3460 
	}
}

3462 
	$iwl_mvm_d3_ã°_ªÀa£
(
öode
 *öode, 
fûe
 *file)

3464 
iwl_mvm
 *
mvm
 = 
öode
->
i_¥iv©e
;

3465 
boﬁ
 
unifõd_image
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

3466 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

3468 
mvm
->
d3_ã°_a˘ive
 = 
Ál£
;

3470 
	`iwl_fw_dbg_ªad_d3_debug_d©a
(&
mvm
->
fwπ
);

3472 
	`π∆_lock
();

3473 
	`wùhy_lock
(
mvm
->
hw
->
wùhy
);

3474 
	`__iwl_mvm_ªsume
(
mvm
, 
åue
);

3475 
	`wùhy_u∆ock
(
mvm
->
hw
->
wùhy
);

3476 
	`π∆_u∆ock
();

3478 
	`iwl_mvm_ªsume_tcm
(
mvm
);

3480 
	`iwl_fw_ru¡ime_ªsume
(&
mvm
->
fwπ
);

3482 
	`iwl_ab‹t_nŸifiˇti⁄_waôs
(&
mvm
->
nŸif_waô
);

3483 i‡(!
unifõd_image
) {

3484 
ªmaöög_time
 = 10;

3486 
	`õì80211_ª°¨t_hw
(
mvm
->
hw
);

3489 
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

3490 
ªmaöög_time
 > 0) {

3491 
ªmaöög_time
--;

3492 
	`m¶ìp
(1000);

3495 i‡(
ªmaöög_time
 == 0)

3496 
	`IWL_ERR
(
mvm
, "Timed out waiting for HWÑestart!\n");

3499 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

3500 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

3501 
iwl_mvm_d3_ã°_disc⁄n_w‹k_ôî
, 
mvm
->
kìp_vif
);

3504 
	}
}

3506 c⁄° 
fûe_›î©i⁄s
 
	giwl_dbgfs_d3_ã°_›s
 = {

3507 .
Œ£ek
 = 
no_Œ£ek
,

3508 .
	g›í
 = 
iwl_mvm_d3_ã°_›í
,

3509 .
	gªad
 = 
iwl_mvm_d3_ã°_ªad
,

3510 .
	gªÀa£
 = 
iwl_mvm_d3_ã°_ªÀa£
,

	@mvm/debugfs-vif.c

7 
	~"mvm.h
"

8 
	~"debugfs.h
"

10 
	$iwl_dbgfs_upd©e_pm
(
iwl_mvm
 *
mvm
,

11 
õì80211_vif
 *
vif
,

12 
iwl_dbgfs_pm_mask
 
∑øm
, 
vÆ
)

14 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

15 
iwl_dbgfs_pm
 *
dbgfs_pm
 = &
mvmvif
->dbgfs_pm;

17 
dbgfs_pm
->
mask
 |
∑øm
;

19 
∑øm
) {

20 
MVM_DEBUGFS_PM_KEEP_ALIVE
: {

21 
dtim≥r
 = 
vif
->
bss_c⁄f
.
dtim_≥riod
 ?: 1;

22 
dtim≥r_m£c
 = 
dtim≥r
 * 
vif
->
bss_c⁄f
.
bóc⁄_öt
;

24 
	`IWL_DEBUG_POWER
(
mvm
, "debugfs: së kìp_Æive%d sec\n", 
vÆ
);

25 i‡(
vÆ
 * 
MSEC_PER_SEC
 < 3 * 
dtim≥r_m£c
)

26 
	`IWL_WARN
(
mvm
,

28 
vÆ
 * 
MSEC_PER_SEC
, 3 * 
dtim≥r_m£c
);

29 
dbgfs_pm
->
kìp_Æive_£c⁄ds
 = 
vÆ
;

32 
MVM_DEBUGFS_PM_SKIP_OVER_DTIM
:

33 
	`IWL_DEBUG_POWER
(
mvm
, "skip_over_dtim %s\n",

34 
vÆ
 ? "enabled" : "disabled");

35 
dbgfs_pm
->
skù_ovî_dtim
 = 
vÆ
;

37 
MVM_DEBUGFS_PM_SKIP_DTIM_PERIODS
:

38 
	`IWL_DEBUG_POWER
(
mvm
, "skù_dtim_≥riods=%d\n", 
vÆ
);

39 
dbgfs_pm
->
skù_dtim_≥riods
 = 
vÆ
;

41 
MVM_DEBUGFS_PM_RX_DATA_TIMEOUT
:

42 
	`IWL_DEBUG_POWER
(
mvm
, "rx_d©a_timeout=%d\n", 
vÆ
);

43 
dbgfs_pm
->
rx_d©a_timeout
 = 
vÆ
;

45 
MVM_DEBUGFS_PM_TX_DATA_TIMEOUT
:

46 
	`IWL_DEBUG_POWER
(
mvm
, "tx_d©a_timeout=%d\n", 
vÆ
);

47 
dbgfs_pm
->
tx_d©a_timeout
 = 
vÆ
;

49 
MVM_DEBUGFS_PM_LPRX_ENA
:

50 
	`IWL_DEBUG_POWER
(
mvm
, "Õrx %s\n", 
vÆ
 ? "enabled" : "disabled");

51 
dbgfs_pm
->
Õrx_ía
 = 
vÆ
;

53 
MVM_DEBUGFS_PM_LPRX_RSSI_THRESHOLD
:

54 
	`IWL_DEBUG_POWER
(
mvm
, "Õrx_rssi_thªshﬁd=%d\n", 
vÆ
);

55 
dbgfs_pm
->
Õrx_rssi_thªshﬁd
 = 
vÆ
;

57 
MVM_DEBUGFS_PM_SNOOZE_ENABLE
:

58 
	`IWL_DEBUG_POWER
(
mvm
, "¢ooze_íabÀ=%d\n", 
vÆ
);

59 
dbgfs_pm
->
¢ooze_ía
 = 
vÆ
;

61 
MVM_DEBUGFS_PM_UAPSD_MISBEHAVING
:

62 
	`IWL_DEBUG_POWER
(
mvm
, "u≠sd_misbehavög_íabÀ=%d\n", 
vÆ
);

63 
dbgfs_pm
->
u≠sd_misbehavög
 = 
vÆ
;

65 
MVM_DEBUGFS_PM_USE_PS_POLL
:

66 
	`IWL_DEBUG_POWER
(
mvm
, "u£_ps_pﬁl=%d\n", 
vÆ
);

67 
dbgfs_pm
->
u£_ps_pﬁl
 = 
vÆ
;

70 
	}
}

72 
ssize_t
 
	$iwl_dbgfs_pm_∑øms_wrôe
(
õì80211_vif
 *
vif
, *
buf
,

73 
size_t
 
cou¡
, 
loff_t
 *
µos
)

75 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

76 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

77 
iwl_dbgfs_pm_mask
 
∑øm
;

78 
vÆ
, 
ªt
;

80 i‡(!
	`°∫cmp
("kìp_Æive=", 
buf
, 11)) {

81 i‡(
	`ssˇnf
(
buf
 + 11, "%d", &
vÆ
) != 1)

82  -
EINVAL
;

83 
∑øm
 = 
MVM_DEBUGFS_PM_KEEP_ALIVE
;

84 } i‡(!
	`°∫cmp
("skù_ovî_dtim=", 
buf
, 15)) {

85 i‡(
	`ssˇnf
(
buf
 + 15, "%d", &
vÆ
) != 1)

86  -
EINVAL
;

87 
∑øm
 = 
MVM_DEBUGFS_PM_SKIP_OVER_DTIM
;

88 } i‡(!
	`°∫cmp
("skù_dtim_≥riods=", 
buf
, 18)) {

89 i‡(
	`ssˇnf
(
buf
 + 18, "%d", &
vÆ
) != 1)

90  -
EINVAL
;

91 
∑øm
 = 
MVM_DEBUGFS_PM_SKIP_DTIM_PERIODS
;

92 } i‡(!
	`°∫cmp
("rx_d©a_timeout=", 
buf
, 16)) {

93 i‡(
	`ssˇnf
(
buf
 + 16, "%d", &
vÆ
) != 1)

94  -
EINVAL
;

95 
∑øm
 = 
MVM_DEBUGFS_PM_RX_DATA_TIMEOUT
;

96 } i‡(!
	`°∫cmp
("tx_d©a_timeout=", 
buf
, 16)) {

97 i‡(
	`ssˇnf
(
buf
 + 16, "%d", &
vÆ
) != 1)

98  -
EINVAL
;

99 
∑øm
 = 
MVM_DEBUGFS_PM_TX_DATA_TIMEOUT
;

100 } i‡(!
	`°∫cmp
("Õrx=", 
buf
, 5)) {

101 i‡(
	`ssˇnf
(
buf
 + 5, "%d", &
vÆ
) != 1)

102  -
EINVAL
;

103 
∑øm
 = 
MVM_DEBUGFS_PM_LPRX_ENA
;

104 } i‡(!
	`°∫cmp
("Õrx_rssi_thªshﬁd=", 
buf
, 20)) {

105 i‡(
	`ssˇnf
(
buf
 + 20, "%d", &
vÆ
) != 1)

106  -
EINVAL
;

107 i‡(
vÆ
 > 
POWER_LPRX_RSSI_THRESHOLD_MAX
 || val <

108 
POWER_LPRX_RSSI_THRESHOLD_MIN
)

109  -
EINVAL
;

110 
∑øm
 = 
MVM_DEBUGFS_PM_LPRX_RSSI_THRESHOLD
;

111 } i‡(!
	`°∫cmp
("¢ooze_íabÀ=", 
buf
, 14)) {

112 i‡(
	`ssˇnf
(
buf
 + 14, "%d", &
vÆ
) != 1)

113  -
EINVAL
;

114 
∑øm
 = 
MVM_DEBUGFS_PM_SNOOZE_ENABLE
;

115 } i‡(!
	`°∫cmp
("u≠sd_misbehavög=", 
buf
, 18)) {

116 i‡(
	`ssˇnf
(
buf
 + 18, "%d", &
vÆ
) != 1)

117  -
EINVAL
;

118 
∑øm
 = 
MVM_DEBUGFS_PM_UAPSD_MISBEHAVING
;

119 } i‡(!
	`°∫cmp
("u£_ps_pﬁl=", 
buf
, 12)) {

120 i‡(
	`ssˇnf
(
buf
 + 12, "%d", &
vÆ
) != 1)

121  -
EINVAL
;

122 
∑øm
 = 
MVM_DEBUGFS_PM_USE_PS_POLL
;

124  -
EINVAL
;

127 
	`muãx_lock
(&
mvm
->
muãx
);

128 
	`iwl_dbgfs_upd©e_pm
(
mvm
, 
vif
, 
∑øm
, 
vÆ
);

129 
ªt
 = 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

130 
	`muãx_u∆ock
(&
mvm
->
muãx
);

132  
ªt
 ?: 
cou¡
;

133 
	}
}

135 
ssize_t
 
	$iwl_dbgfs_tx_pwr_lmt_ªad
(
fûe
 *file,

136 
__u£r
 *
u£r_buf
,

137 
size_t
 
cou¡
, 
loff_t
 *
µos
)

139 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

140 
buf
[64];

141 
bufsz
 = (
buf
);

142 
pos
;

144 
pos
 = 
	`s˙¥ötf
(
buf
, 
bufsz
, "bssÜimit = %d\n",

145 
vif
->
bss_c⁄f
.
txpowî
);

147  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

148 
	}
}

150 
ssize_t
 
	$iwl_dbgfs_pm_∑øms_ªad
(
fûe
 *file,

151 
__u£r
 *
u£r_buf
,

152 
size_t
 
cou¡
, 
loff_t
 *
µos
)

154 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

155 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

156 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

157 
buf
[512];

158 
bufsz
 = (
buf
);

159 
pos
;

161 
pos
 = 
	`iwl_mvm_powî_mac_dbgfs_ªad
(
mvm
, 
vif
, 
buf
, 
bufsz
);

163  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

164 
	}
}

166 
ssize_t
 
	$iwl_dbgfs_mac_∑øms_ªad
(
fûe
 *file,

167 
__u£r
 *
u£r_buf
,

168 
size_t
 
cou¡
, 
loff_t
 *
µos
)

170 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

171 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

172 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

173 
u8
 
≠_°a_id
;

174 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

175 
buf
[512];

176 
bufsz
 = (
buf
);

177 
pos
 = 0;

178 
i
;

180 
	`muãx_lock
(&
mvm
->
muãx
);

182 
≠_°a_id
 = 
mvmvif
->
deÊök
.ap_sta_id;

184 
	`õì80211_vif_ty≥_p2p
(
vif
)) {

185 
NL80211_IFTYPE_ADHOC
:

186 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "type: ibss\n");

188 
NL80211_IFTYPE_STATION
:

189 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "type: bss\n");

191 
NL80211_IFTYPE_AP
:

192 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "type:áp\n");

194 
NL80211_IFTYPE_P2P_CLIENT
:

195 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "type:Ö2p client\n");

197 
NL80211_IFTYPE_P2P_GO
:

198 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "type:Ö2p go\n");

200 
NL80211_IFTYPE_P2P_DEVICE
:

201 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "type:Ö2p dev\n");

207 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "mac id/color: %d / %d\n",

208 
mvmvif
->
id
, mvmvif->
cﬁ‹
);

209 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bssid: %pM\n",

210 
vif
->
bss_c⁄f
.
bssid
);

211 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "Load: %d\n",

212 
mvm
->
tcm
.
ªsu…
.
lﬂd
[
mvmvif
->
id
]);

213 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "QoS:\n");

214 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvmvif
->
deÊök
.
queue_∑øms
); i++)

215 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos,

217 
i
, 
mvmvif
->
deÊök
.
queue_∑øms
[i].
tx›
,

218 
mvmvif
->
deÊök
.
queue_∑øms
[
i
].
cw_mö
,

219 
mvmvif
->
deÊök
.
queue_∑øms
[
i
].
cw_max
,

220 
mvmvif
->
deÊök
.
queue_∑øms
[
i
].
aifs
,

221 
mvmvif
->
deÊök
.
queue_∑øms
[
i
].
u≠sd
);

223 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

224 
≠_°a_id
 !
IWL_MVM_INVALID_STA
) {

225 
iwl_mvm_°a
 *
mvm_°a
;

227 
mvm_°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 
≠_°a_id
);

228 i‡(
mvm_°a
) {

229 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos,

231 
≠_°a_id
,

232 
mvm_°a
->
bt_ªdu˚d_txpowî
);

236 
	`rcu_ªad_lock
();

237 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->
bss_c⁄f
.chanctx_conf);

238 i‡(
ch™˘x_c⁄f
)

239 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos,

241 
ch™˘x_c⁄f
->
rx_chaös_°©ic
,

242 
ch™˘x_c⁄f
->
rx_chaös_dy«mic
);

243 
	`rcu_ªad_u∆ock
();

245 
	`muãx_u∆ock
(&
mvm
->
muãx
);

247  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

248 
	}
}

250 
	$iwl_dbgfs_upd©e_bf
(
õì80211_vif
 *
vif
,

251 
iwl_dbgfs_bf_mask
 
∑øm
, 
vÆue
)

253 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

254 
iwl_dbgfs_bf
 *
dbgfs_bf
 = &
mvmvif
->dbgfs_bf;

256 
dbgfs_bf
->
mask
 |
∑øm
;

258 
∑øm
) {

259 
MVM_DEBUGFS_BF_ENERGY_DELTA
:

260 
dbgfs_bf
->
bf_íîgy_dñè
 = 
vÆue
;

262 
MVM_DEBUGFS_BF_ROAMING_ENERGY_DELTA
:

263 
dbgfs_bf
->
bf_rﬂmög_íîgy_dñè
 = 
vÆue
;

265 
MVM_DEBUGFS_BF_ROAMING_STATE
:

266 
dbgfs_bf
->
bf_rﬂmög_°©e
 = 
vÆue
;

268 
MVM_DEBUGFS_BF_TEMP_THRESHOLD
:

269 
dbgfs_bf
->
bf_ãmp_thªshﬁd
 = 
vÆue
;

271 
MVM_DEBUGFS_BF_TEMP_FAST_FILTER
:

272 
dbgfs_bf
->
bf_ãmp_Á°_fûãr
 = 
vÆue
;

274 
MVM_DEBUGFS_BF_TEMP_SLOW_FILTER
:

275 
dbgfs_bf
->
bf_ãmp_¶ow_fûãr
 = 
vÆue
;

277 
MVM_DEBUGFS_BF_ENABLE_BEACON_FILTER
:

278 
dbgfs_bf
->
bf_íabÀ_bóc⁄_fûãr
 = 
vÆue
;

280 
MVM_DEBUGFS_BF_DEBUG_FLAG
:

281 
dbgfs_bf
->
bf_debug_Êag
 = 
vÆue
;

283 
MVM_DEBUGFS_BF_ESCAPE_TIMER
:

284 
dbgfs_bf
->
bf_esˇ≥_timî
 = 
vÆue
;

286 
MVM_DEBUGFS_BA_ENABLE_BEACON_ABORT
:

287 
dbgfs_bf
->
ba_íabÀ_bóc⁄_ab‹t
 = 
vÆue
;

289 
MVM_DEBUGFS_BA_ESCAPE_TIMER
:

290 
dbgfs_bf
->
ba_esˇ≥_timî
 = 
vÆue
;

293 
	}
}

295 
ssize_t
 
	$iwl_dbgfs_bf_∑øms_wrôe
(
õì80211_vif
 *
vif
, *
buf
,

296 
size_t
 
cou¡
, 
loff_t
 *
µos
)

298 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

299 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

300 
iwl_dbgfs_bf_mask
 
∑øm
;

301 
vÆue
, 
ªt
 = 0;

303 i‡(!
	`°∫cmp
("bf_íîgy_dñè=", 
buf
, 16)) {

304 i‡(
	`ssˇnf
(
buf
+16, "%d", &
vÆue
) != 1)

305  -
EINVAL
;

306 i‡(
vÆue
 < 
IWL_BF_ENERGY_DELTA_MIN
 ||

307 
vÆue
 > 
IWL_BF_ENERGY_DELTA_MAX
)

308  -
EINVAL
;

309 
∑øm
 = 
MVM_DEBUGFS_BF_ENERGY_DELTA
;

310 } i‡(!
	`°∫cmp
("bf_rﬂmög_íîgy_dñè=", 
buf
, 24)) {

311 i‡(
	`ssˇnf
(
buf
+24, "%d", &
vÆue
) != 1)

312  -
EINVAL
;

313 i‡(
vÆue
 < 
IWL_BF_ROAMING_ENERGY_DELTA_MIN
 ||

314 
vÆue
 > 
IWL_BF_ROAMING_ENERGY_DELTA_MAX
)

315  -
EINVAL
;

316 
∑øm
 = 
MVM_DEBUGFS_BF_ROAMING_ENERGY_DELTA
;

317 } i‡(!
	`°∫cmp
("bf_rﬂmög_°©e=", 
buf
, 17)) {

318 i‡(
	`ssˇnf
(
buf
+17, "%d", &
vÆue
) != 1)

319  -
EINVAL
;

320 i‡(
vÆue
 < 
IWL_BF_ROAMING_STATE_MIN
 ||

321 
vÆue
 > 
IWL_BF_ROAMING_STATE_MAX
)

322  -
EINVAL
;

323 
∑øm
 = 
MVM_DEBUGFS_BF_ROAMING_STATE
;

324 } i‡(!
	`°∫cmp
("bf_ãmp_thªshﬁd=", 
buf
, 18)) {

325 i‡(
	`ssˇnf
(
buf
+18, "%d", &
vÆue
) != 1)

326  -
EINVAL
;

327 i‡(
vÆue
 < 
IWL_BF_TEMP_THRESHOLD_MIN
 ||

328 
vÆue
 > 
IWL_BF_TEMP_THRESHOLD_MAX
)

329  -
EINVAL
;

330 
∑øm
 = 
MVM_DEBUGFS_BF_TEMP_THRESHOLD
;

331 } i‡(!
	`°∫cmp
("bf_ãmp_Á°_fûãr=", 
buf
, 20)) {

332 i‡(
	`ssˇnf
(
buf
+20, "%d", &
vÆue
) != 1)

333  -
EINVAL
;

334 i‡(
vÆue
 < 
IWL_BF_TEMP_FAST_FILTER_MIN
 ||

335 
vÆue
 > 
IWL_BF_TEMP_FAST_FILTER_MAX
)

336  -
EINVAL
;

337 
∑øm
 = 
MVM_DEBUGFS_BF_TEMP_FAST_FILTER
;

338 } i‡(!
	`°∫cmp
("bf_ãmp_¶ow_fûãr=", 
buf
, 20)) {

339 i‡(
	`ssˇnf
(
buf
+20, "%d", &
vÆue
) != 1)

340  -
EINVAL
;

341 i‡(
vÆue
 < 
IWL_BF_TEMP_SLOW_FILTER_MIN
 ||

342 
vÆue
 > 
IWL_BF_TEMP_SLOW_FILTER_MAX
)

343  -
EINVAL
;

344 
∑øm
 = 
MVM_DEBUGFS_BF_TEMP_SLOW_FILTER
;

345 } i‡(!
	`°∫cmp
("bf_íabÀ_bóc⁄_fûãr=", 
buf
, 24)) {

346 i‡(
	`ssˇnf
(
buf
+24, "%d", &
vÆue
) != 1)

347  -
EINVAL
;

348 i‡(
vÆue
 < 0 || value > 1)

349  -
EINVAL
;

350 
∑øm
 = 
MVM_DEBUGFS_BF_ENABLE_BEACON_FILTER
;

351 } i‡(!
	`°∫cmp
("bf_debug_Êag=", 
buf
, 14)) {

352 i‡(
	`ssˇnf
(
buf
+14, "%d", &
vÆue
) != 1)

353  -
EINVAL
;

354 i‡(
vÆue
 < 0 || value > 1)

355  -
EINVAL
;

356 
∑øm
 = 
MVM_DEBUGFS_BF_DEBUG_FLAG
;

357 } i‡(!
	`°∫cmp
("bf_esˇ≥_timî=", 
buf
, 16)) {

358 i‡(
	`ssˇnf
(
buf
+16, "%d", &
vÆue
) != 1)

359  -
EINVAL
;

360 i‡(
vÆue
 < 
IWL_BF_ESCAPE_TIMER_MIN
 ||

361 
vÆue
 > 
IWL_BF_ESCAPE_TIMER_MAX
)

362  -
EINVAL
;

363 
∑øm
 = 
MVM_DEBUGFS_BF_ESCAPE_TIMER
;

364 } i‡(!
	`°∫cmp
("ba_esˇ≥_timî=", 
buf
, 16)) {

365 i‡(
	`ssˇnf
(
buf
+16, "%d", &
vÆue
) != 1)

366  -
EINVAL
;

367 i‡(
vÆue
 < 
IWL_BA_ESCAPE_TIMER_MIN
 ||

368 
vÆue
 > 
IWL_BA_ESCAPE_TIMER_MAX
)

369  -
EINVAL
;

370 
∑øm
 = 
MVM_DEBUGFS_BA_ESCAPE_TIMER
;

371 } i‡(!
	`°∫cmp
("ba_íabÀ_bóc⁄_ab‹t=", 
buf
, 23)) {

372 i‡(
	`ssˇnf
(
buf
+23, "%d", &
vÆue
) != 1)

373  -
EINVAL
;

374 i‡(
vÆue
 < 0 || value > 1)

375  -
EINVAL
;

376 
∑øm
 = 
MVM_DEBUGFS_BA_ENABLE_BEACON_ABORT
;

378  -
EINVAL
;

381 
	`muãx_lock
(&
mvm
->
muãx
);

382 
	`iwl_dbgfs_upd©e_bf
(
vif
, 
∑øm
, 
vÆue
);

383 i‡(
∑øm
 =
MVM_DEBUGFS_BF_ENABLE_BEACON_FILTER
 && !
vÆue
)

384 
ªt
 = 
	`iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

386 
ªt
 = 
	`iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

387 
	`muãx_u∆ock
(&
mvm
->
muãx
);

389  
ªt
 ?: 
cou¡
;

390 
	}
}

392 
ssize_t
 
	$iwl_dbgfs_bf_∑øms_ªad
(
fûe
 *file,

393 
__u£r
 *
u£r_buf
,

394 
size_t
 
cou¡
, 
loff_t
 *
µos
)

396 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

397 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

398 
buf
[256];

399 
pos
 = 0;

400 c⁄° 
size_t
 
bufsz
 = (
buf
);

401 
iwl_bóc⁄_fûãr_cmd
 
cmd
 = {

402 
IWL_BF_CMD_CONFIG_DEFAULTS
,

403 .
bf_íabÀ_bóc⁄_fûãr
 =

404 
	`˝u_to_À32
(
IWL_BF_ENABLE_BEACON_FILTER_DEFAULT
),

405 .
ba_íabÀ_bóc⁄_ab‹t
 =

406 
	`˝u_to_À32
(
IWL_BA_ENABLE_BEACON_ABORT_DEFAULT
),

409 
	`iwl_mvm_bóc⁄_fûãr_debugfs_∑ømëîs
(
vif
, &
cmd
);

410 i‡(
mvmvif
->
bf_d©a
.
bf_íabÀd
)

411 
cmd
.
bf_íabÀ_bóc⁄_fûãr
 = 
	`˝u_to_À32
(1);

413 
cmd
.
bf_íabÀ_bóc⁄_fûãr
 = 0;

415 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_energy_delta = %d\n",

416 
	`À32_to_˝u
(
cmd
.
bf_íîgy_dñè
));

417 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_roaming_energy_delta = %d\n",

418 
	`À32_to_˝u
(
cmd
.
bf_rﬂmög_íîgy_dñè
));

419 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_roaming_state = %d\n",

420 
	`À32_to_˝u
(
cmd
.
bf_rﬂmög_°©e
));

421 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_temp_threshold = %d\n",

422 
	`À32_to_˝u
(
cmd
.
bf_ãmp_thªshﬁd
));

423 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_temp_fast_filter = %d\n",

424 
	`À32_to_˝u
(
cmd
.
bf_ãmp_Á°_fûãr
));

425 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_temp_slow_filter = %d\n",

426 
	`À32_to_˝u
(
cmd
.
bf_ãmp_¶ow_fûãr
));

427 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_enable_beacon_filter = %d\n",

428 
	`À32_to_˝u
(
cmd
.
bf_íabÀ_bóc⁄_fûãr
));

429 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_debug_flag = %d\n",

430 
	`À32_to_˝u
(
cmd
.
bf_debug_Êag
));

431 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "bf_escape_timer = %d\n",

432 
	`À32_to_˝u
(
cmd
.
bf_esˇ≥_timî
));

433 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "ba_escape_timer = %d\n",

434 
	`À32_to_˝u
(
cmd
.
ba_esˇ≥_timî
));

435 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "ba_enable_beacon_abort = %d\n",

436 
	`À32_to_˝u
(
cmd
.
ba_íabÀ_bóc⁄_ab‹t
));

438  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

439 
	}
}

441 
ssize_t
 
	$iwl_dbgfs_os_devi˚_timediff_ªad
(
fûe
 *file,

442 
__u£r
 *
u£r_buf
,

443 
size_t
 
cou¡
, 
loff_t
 *
µos
)

445 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

446 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

447 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

448 
u32
 
cuº_gp2
;

449 
u64
 
cuº_os
;

450 
s64
 
diff
;

451 
buf
[64];

452 c⁄° 
size_t
 
bufsz
 = (
buf
);

453 
pos
 = 0;

455 
	`muãx_lock
(&
mvm
->
muãx
);

456 
	`iwl_mvm_gë_sync_time
(
mvm
, 
CLOCK_BOOTTIME
, &
cuº_gp2
, &
cuº_os
, 
NULL
);

457 
	`muãx_u∆ock
(&
mvm
->
muãx
);

459 
	`do_div
(
cuº_os
, 
NSEC_PER_USEC
);

460 
diff
 = 
cuº_os
 - 
cuº_gp2
;

461 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "diff=%Œd\n", 
diff
);

463  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

464 
	}
}

466 
ssize_t
 
	$iwl_dbgfs_low_œãncy_wrôe
(
õì80211_vif
 *
vif
, *
buf
,

467 
size_t
 
cou¡
, 
loff_t
 *
µos
)

469 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

470 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

471 
u8
 
vÆue
;

472 
ªt
;

474 
ªt
 = 
	`k°πou8
(
buf
, 0, &
vÆue
);

475 i‡(
ªt
)

476  
ªt
;

477 i‡(
vÆue
 > 1)

478  -
EINVAL
;

480 
	`muãx_lock
(&
mvm
->
muãx
);

481 
	`iwl_mvm_upd©e_low_œãncy
(
mvm
, 
vif
, 
vÆue
, 
LOW_LATENCY_DEBUGFS
);

482 
	`muãx_u∆ock
(&
mvm
->
muãx
);

484  
cou¡
;

485 
	}
}

487 
ssize_t


488 
	$iwl_dbgfs_low_œãncy_f‹˚_wrôe
(
õì80211_vif
 *
vif
, *
buf
,

489 
size_t
 
cou¡
, 
loff_t
 *
µos
)

491 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

492 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

493 
u8
 
vÆue
;

494 
ªt
;

496 
ªt
 = 
	`k°πou8
(
buf
, 0, &
vÆue
);

497 i‡(
ªt
)

498  
ªt
;

500 i‡(
vÆue
 > 
NUM_LOW_LATENCY_FORCE
)

501  -
EINVAL
;

503 
	`muãx_lock
(&
mvm
->
muãx
);

504 i‡(
vÆue
 =
LOW_LATENCY_FORCE_UNSET
) {

505 
	`iwl_mvm_upd©e_low_œãncy
(
mvm
, 
vif
, 
Ál£
,

506 
LOW_LATENCY_DEBUGFS_FORCE
);

507 
	`iwl_mvm_upd©e_low_œãncy
(
mvm
, 
vif
, 
Ál£
,

508 
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
);

510 
	`iwl_mvm_upd©e_low_œãncy
(
mvm
, 
vif
,

511 
vÆue
 =
LOW_LATENCY_FORCE_ON
,

512 
LOW_LATENCY_DEBUGFS_FORCE
);

513 
	`iwl_mvm_upd©e_low_œãncy
(
mvm
, 
vif
, 
åue
,

514 
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
);

516 
	`muãx_u∆ock
(&
mvm
->
muãx
);

517  
cou¡
;

518 
	}
}

520 
ssize_t
 
	$iwl_dbgfs_low_œãncy_ªad
(
fûe
 *file,

521 
__u£r
 *
u£r_buf
,

522 
size_t
 
cou¡
, 
loff_t
 *
µos
)

524 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

525 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

526 
f‹m©
[] = "traffic=%d\ndbgfs=%d\nvcmd=%d\nvif_type=%d\n"

533 
buf
[(
f‹m©
) + 1] = {};

534 
Àn
;

536 
Àn
 = 
	`s˙¥ötf
(
buf
, (bufË- 1, 
f‹m©
,

537 !!(
mvmvif
->
low_œãncy
 & 
LOW_LATENCY_TRAFFIC
),

538 !!(
mvmvif
->
low_œãncy
 & 
LOW_LATENCY_DEBUGFS
),

539 !!(
mvmvif
->
low_œãncy
 & 
LOW_LATENCY_VCMD
),

540 !!(
mvmvif
->
low_œãncy
 & 
LOW_LATENCY_VIF_TYPE
),

541 !!(
mvmvif
->
low_œãncy
 &

542 
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
),

543 !!(
mvmvif
->
low_œãncy
 & 
LOW_LATENCY_DEBUGFS_FORCE
),

544 !!(
mvmvif
->
low_œãncy_a˘uÆ
));

545  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

546 
	}
}

548 
ssize_t
 
	$iwl_dbgfs_u≠sd_misbehavög_ªad
(
fûe
 *file,

549 
__u£r
 *
u£r_buf
,

550 
size_t
 
cou¡
, 
loff_t
 *
µos
)

552 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

553 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

554 
buf
[20];

555 
Àn
;

557 
Àn
 = 
	`•rötf
(
buf
, "%pM\n", 
mvmvif
->
u≠sd_misbehavög_≠_addr
);

558  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

559 
	}
}

561 
ssize_t
 
	$iwl_dbgfs_u≠sd_misbehavög_wrôe
(
õì80211_vif
 *
vif
,

562 *
buf
, 
size_t
 
cou¡
,

563 
loff_t
 *
µos
)

565 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

566 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

567 
boﬁ
 
ªt
;

569 
	`muãx_lock
(&
mvm
->
muãx
);

570 
ªt
 = 
	`mac_±⁄
(
buf
, 
mvmvif
->
u≠sd_misbehavög_≠_addr
);

571 
	`muãx_u∆ock
(&
mvm
->
muãx
);

573  
ªt
 ? 
cou¡
 : -
EINVAL
;

574 
	}
}

576 
ssize_t
 
	$iwl_dbgfs_rx_phyöfo_wrôe
(
õì80211_vif
 *
vif
, *
buf
,

577 
size_t
 
cou¡
, 
loff_t
 *
µos
)

579 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

580 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

581 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

582 
u16
 
vÆue
;

583 
lök_id
, 
ªt
 = -
EINVAL
;

585 
ªt
 = 
	`k°πou16
(
buf
, 0, &
vÆue
);

586 i‡(
ªt
)

587  
ªt
;

589 
	`muãx_lock
(&
mvm
->
muãx
);

591 
mvm
->
dbgfs_rx_phyöfo
 = 
vÆue
;

593 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
) {

594 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

595 
cfg80211_ch™_def
 
mö_def
, 
≠_def
;

596 
iwl_mvm_phy_˘xt
 *
phy_˘xt
;

597 
u8
 
chaös_°©ic
, 
chaös_dy«mic
;

599 
	`rcu_ªad_lock
();

600 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->chanctx_conf);

601 i‡(!
ch™˘x_c⁄f
) {

602 
	`rcu_ªad_u∆ock
();

608 
mö_def
 = 
ch™˘x_c⁄f
->min_def;

609 
≠_def
 = 
ch™˘x_c⁄f
->
≠
;

610 
chaös_°©ic
 = 
ch™˘x_c⁄f
->
rx_chaös_°©ic
;

611 
chaös_dy«mic
 = 
ch™˘x_c⁄f
->
rx_chaös_dy«mic
;

612 
	`rcu_ªad_u∆ock
();

614 
phy_˘xt
 = 
mvmvif
->
lök
[
lök_id
]->phy_ctxt;

615 i‡(!
phy_˘xt
)

618 
ªt
 = 
	`iwl_mvm_phy_˘xt_ch™ged
(
mvm
, 
phy_˘xt
, &
mö_def
, &
≠_def
,

619 
chaös_°©ic
, 
chaös_dy«mic
);

622 
	`muãx_u∆ock
(&
mvm
->
muãx
);

624  
ªt
 ?: 
cou¡
;

625 
	}
}

627 
ssize_t
 
	$iwl_dbgfs_rx_phyöfo_ªad
(
fûe
 *file,

628 
__u£r
 *
u£r_buf
,

629 
size_t
 
cou¡
, 
loff_t
 *
µos
)

631 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

632 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

633 
buf
[8];

634 
Àn
;

636 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "0x%04x\n",

637 
mvmvif
->
mvm
->
dbgfs_rx_phyöfo
);

639  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

640 
	}
}

642 
	$iwl_dbgfs_quŸa_check
(*
d©a
, 
u8
 *
mac
,

643 
õì80211_vif
 *
vif
)

645 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

646 *
ªt
 = 
d©a
;

648 i‡(
mvmvif
->
dbgfs_quŸa_mö
)

649 *
ªt
 = -
EINVAL
;

650 
	}
}

652 
ssize_t
 
	$iwl_dbgfs_quŸa_mö_wrôe
(
õì80211_vif
 *
vif
, *
buf
,

653 
size_t
 
cou¡
, 
loff_t
 *
µos
)

655 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

656 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

657 
u16
 
vÆue
;

658 
ªt
;

660 
ªt
 = 
	`k°πou16
(
buf
, 0, &
vÆue
);

661 i‡(
ªt
)

662  
ªt
;

664 i‡(
vÆue
 > 95)

665  -
EINVAL
;

667 
	`muãx_lock
(&
mvm
->
muãx
);

669 
mvmvif
->
dbgfs_quŸa_mö
 = 0;

670 
	`õì80211_ôî©e_öãrÁ˚s
(
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

671 
iwl_dbgfs_quŸa_check
, &
ªt
);

672 i‡(
ªt
 == 0) {

673 
mvmvif
->
dbgfs_quŸa_mö
 = 
vÆue
;

674 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

676 
	`muãx_u∆ock
(&
mvm
->
muãx
);

678  
ªt
 ?: 
cou¡
;

679 
	}
}

681 
ssize_t
 
	$iwl_dbgfs_quŸa_mö_ªad
(
fûe
 *file,

682 
__u£r
 *
u£r_buf
,

683 
size_t
 
cou¡
, 
loff_t
 *
µos
)

685 
õì80211_vif
 *
vif
 = 
fûe
->
¥iv©e_d©a
;

686 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

687 
buf
[10];

688 
Àn
;

690 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "%d\n", 
mvmvif
->
dbgfs_quŸa_mö
);

692  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

693 
	}
}

695 
	#MVM_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

696 
	`_MVM_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
õì80211_vif
)

	)

697 
	#MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

698 
	`_MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
õì80211_vif
)

	)

699 
	#MVM_DEBUGFS_ADD_FILE_VIF
(
«me
, 
∑ª¡
, 
mode
) do { \

700 
	`debugfs_¸óã_fûe
(#«me, 
mode
, 
∑ª¡
, 
vif
, \

701 &
iwl_dbgfs_
##
«me
##
_›s
); \

702 } 0)

	)

704 
MVM_DEBUGFS_READ_FILE_OPS
(
mac_∑øms
);

705 
MVM_DEBUGFS_READ_FILE_OPS
(
tx_pwr_lmt
);

706 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
pm_∑øms
, 32);

707 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
bf_∑øms
, 256);

708 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
low_œãncy
, 10);

709 
MVM_DEBUGFS_WRITE_FILE_OPS
(
low_œãncy_f‹˚
, 10);

710 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
u≠sd_misbehavög
, 20);

711 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
rx_phyöfo
, 10);

712 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
quŸa_mö
, 32);

713 
MVM_DEBUGFS_READ_FILE_OPS
(
os_devi˚_timediff
);

715 
	$iwl_mvm_vif_add_debugfs
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
)

717 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

718 
díåy
 *
dbgfs_dú
 = 
vif
->
debugfs_dú
;

719 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

721 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

722 
mvmvif
->
dbgfs_dú
 = 
	`debugfs_¸óã_dú
("iwlmvm", dbgfs_dir);

723 i‡(
	`IS_ERR_OR_NULL
(
mvmvif
->
dbgfs_dú
)) {

724 
	`IWL_ERR
(
mvm
, "FailedÅo create debugfs directory under %pd\n",

725 
dbgfs_dú
);

726 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

730 i‡(
iwlmvm_mod_∑øms
.
powî_scheme
 !
IWL_POWER_SCHEME_CAM
 &&

731 ((
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
p2p
) ||

732 (
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && vif->
p2p
)))

733 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
pm_∑øms
, 
mvmvif
->
dbgfs_dú
, 0600);

735 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
tx_pwr_lmt
, 
mvmvif
->
dbgfs_dú
, 0400);

736 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
mac_∑øms
, 
mvmvif
->
dbgfs_dú
, 0400);

737 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
low_œãncy
, 
mvmvif
->
dbgfs_dú
, 0600);

738 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
low_œãncy_f‹˚
, 
mvmvif
->
dbgfs_dú
, 0600);

739 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
u≠sd_misbehavög
, 
mvmvif
->
dbgfs_dú
, 0600);

740 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
rx_phyöfo
, 
mvmvif
->
dbgfs_dú
, 0600);

741 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
quŸa_mö
, 
mvmvif
->
dbgfs_dú
, 0600);

742 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
os_devi˚_timediff
, 
mvmvif
->
dbgfs_dú
, 0400);

744 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
p2p
 &&

745 
mvmvif
 =
mvm
->
bf_Ælowed_vif
)

746 
	`MVM_DEBUGFS_ADD_FILE_VIF
(
bf_∑øms
, 
mvmvif
->
dbgfs_dú
, 0600);

747 
	}
}

749 
	$iwl_mvm_vif_dbgfs_add_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

751 
díåy
 *
dbgfs_dú
 = 
vif
->
debugfs_dú
;

752 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

753 
buf
[3 * 3 + 11 + (
NL80211_WIPHY_NAME_MAXLEN
 + 1) +

754 (7 + 
IFNAMSIZ
 + 1) + 6 + 1];

755 
«me
[7 + 
IFNAMSIZ
 + 1];

758 i‡(!
dbgfs_dú
)

768 
	`¢¥ötf
(
«me
, “ame), "%pd", 
dbgfs_dú
);

769 
	`¢¥ötf
(
buf
, (buf), "../../../%pd3/iwlmvm", 
dbgfs_dú
);

771 
mvmvif
->
dbgfs_¶ök
 =

772 
	`debugfs_¸óã_symlök
(
«me
, 
mvm
->
debugfs_dú
, 
buf
);

773 
	}
}

775 
	$iwl_mvm_vif_dbgfs_rm_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

777 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

779 
	`debugfs_ªmove
(
mvmvif
->
dbgfs_¶ök
);

780 
mvmvif
->
dbgfs_¶ök
 = 
NULL
;

781 
	}
}

783 
	#MVM_DEBUGFS_WRITE_LINK_FILE_OPS
(
«me
, 
bufsz
) \

784 
	`_MVM_DEBUGFS_WRITE_FILE_OPS
(
lök_
##
«me
, 
bufsz
, \

785 
õì80211_bss_c⁄f
)

	)

786 
	#MVM_DEBUGFS_READ_WRITE_LINK_FILE_OPS
(
«me
, 
bufsz
) \

787 
	`_MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
lök_
##
«me
, 
bufsz
, \

788 
õì80211_bss_c⁄f
)

	)

789 
	#MVM_DEBUGFS_ADD_LINK_FILE
(
«me
, 
∑ª¡
, 
mode
) \

790 
	`debugfs_¸óã_fûe
(#«me, 
mode
, 
∑ª¡
, 
lök_c⁄f
, \

791 &
iwl_dbgfs_lök_
##
«me
##
_›s
)

	)

793 
	$iwl_mvm_debugfs_add_lök_fûes
(
õì80211_vif
 *
vif
,

794 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

795 
díåy
 *
mvm_dú
)

798 
	}
}

800 
	$iwl_mvm_lök_add_debugfs
(
õì80211_hw
 *
hw
,

801 
õì80211_vif
 *
vif
,

802 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

803 
díåy
 *
dú
)

805 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

806 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

807 
lök_id
 = 
lök_c⁄f
->link_id;

808 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

809 
díåy
 *
mvm_dú
;

811 i‡(
	`WARN_ON
(!
lök_öfo
Ë|| !
dú
)

814 i‡(
dú
 =
vif
->
debugfs_dú
) {

815 
	`WARN_ON
(!
mvmvif
->
dbgfs_dú
);

816 
mvm_dú
 = 
mvmvif
->
dbgfs_dú
;

818 
mvm_dú
 = 
	`debugfs_¸óã_dú
("iwlmvm", 
dú
);

819 i‡(
	`IS_ERR_OR_NULL
(
mvm_dú
)) {

820 
	`IWL_ERR
(
mvm
, "FailedÅo create debugfs directory under %pd\n",

821 
dú
);

826 
	`iwl_mvm_debugfs_add_lök_fûes
(
vif
, 
lök_c⁄f
, 
mvm_dú
);

827 
	}
}

	@mvm/debugfs.c

7 
	~<löux/vmÆloc.h
>

8 
	~<löux/îr.h
>

9 
	~<löux/õì80211.h
>

10 
	~<löux/√tdevi˚.h
>

11 
	~<löux/dmi.h
>

13 
	~"mvm.h
"

14 
	~"°a.h
"

15 
	~"iwl-io.h
"

16 
	~"debugfs.h
"

17 
	~"iwl-mod∑øms.h
"

18 
	~"iwl-drv.h
"

19 
	~"fw/îr‹-dump.h
"

20 
	~"fw/≠i/phy-˘xt.h
"

22 
ssize_t
 
	$iwl_dbgfs_˘dp_budgë_ªad
(
fûe
 *file,

23 
__u£r
 *
u£r_buf
,

24 
size_t
 
cou¡
, 
loff_t
 *
µos
)

26 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

27 
buf
[16];

28 
pos
, 
budgë
;

30 i‡(!
	`iwl_mvm_is_˘dp_suµ‹ãd
(
mvm
))

31  -
EOPNOTSUPP
;

33 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

34 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
)

35  -
EIO
;

37 
	`muãx_lock
(&
mvm
->
muãx
);

38 
budgë
 = 
	`iwl_mvm_˘dp_comm™d
(
mvm
, 
CTDP_CMD_OPERATION_REPORT
, 0);

39 
	`muãx_u∆ock
(&
mvm
->
muãx
);

41 i‡(
budgë
 < 0)

42  
budgë
;

44 
pos
 = 
	`s˙¥ötf
(
buf
, (buf), "%d\n", 
budgë
);

46  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

47 
	}
}

49 
ssize_t
 
	$iwl_dbgfs_°›_˘dp_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

50 
size_t
 
cou¡
, 
loff_t
 *
µos
)

52 
ªt
;

53 
boﬁ
 
f‹˚
;

55 i‡(!
	`k°πoboﬁ
(
buf
, &
f‹˚
))

56 
	`IWL_DEBUG_INFO
(
mvm
,

58 
f‹˚
);

64 i‡(!
f‹˚
 && !
	`iwl_mvm_is_˘dp_suµ‹ãd
(
mvm
))

65  -
EOPNOTSUPP
;

67 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

68 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
)

69  -
EIO
;

71 
	`muãx_lock
(&
mvm
->
muãx
);

72 
ªt
 = 
	`iwl_mvm_˘dp_comm™d
(
mvm
, 
CTDP_CMD_OPERATION_STOP
, 0);

73 
	`muãx_u∆ock
(&
mvm
->
muãx
);

75  
ªt
 ?: 
cou¡
;

76 
	}
}

78 
ssize_t
 
	$iwl_dbgfs_°¨t_˘dp_wrôe
(
iwl_mvm
 *
mvm
,

79 *
buf
, 
size_t
 
cou¡
,

80 
loff_t
 *
µos
)

82 
ªt
;

83 
boﬁ
 
f‹˚
;

85 i‡(!
	`k°πoboﬁ
(
buf
, &
f‹˚
))

86 
	`IWL_DEBUG_INFO
(
mvm
,

88 
f‹˚
);

94 i‡(!
f‹˚
 && !
	`iwl_mvm_is_˘dp_suµ‹ãd
(
mvm
))

95  -
EOPNOTSUPP
;

97 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

98 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
)

99  -
EIO
;

101 
	`muãx_lock
(&
mvm
->
muãx
);

102 
ªt
 = 
	`iwl_mvm_˘dp_comm™d
(
mvm
, 
CTDP_CMD_OPERATION_START
, 0);

103 
	`muãx_u∆ock
(&
mvm
->
muãx
);

105  
ªt
 ?: 
cou¡
;

106 
	}
}

108 
ssize_t
 
	$iwl_dbgfs_f‹˚_˘kûl_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

109 
size_t
 
cou¡
, 
loff_t
 *
µos
)

111 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

112 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
)

113  -
EIO
;

115 
	`iwl_mvm_íãr_˘kûl
(
mvm
);

117  
cou¡
;

118 
	}
}

120 
ssize_t
 
	$iwl_dbgfs_tx_Êush_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

121 
size_t
 
cou¡
, 
loff_t
 *
µos
)

123 
ªt
;

124 
u32
 
Êush_¨g
;

126 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

127 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
)

128  -
EIO
;

130 i‡(
	`k°πou32
(
buf
, 0, &
Êush_¨g
))

131  -
EINVAL
;

133 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

134 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

136 
Êush_¨g
);

137 
	`muãx_lock
(&
mvm
->
muãx
);

138 
ªt
 = 
	`iwl_mvm_Êush_°a_tids
(
mvm
, 
Êush_¨g
, 0xFFFF)

139 ? : 
cou¡
;

140 
	`muãx_u∆ock
(&
mvm
->
muãx
);

141  
ªt
;

144 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "FLUSHING queues maskÅo flush = 0x%x\n",

145 
Êush_¨g
);

147 
	`muãx_lock
(&
mvm
->
muãx
);

148 
ªt
 = 
	`iwl_mvm_Êush_tx_∑th
(
mvm
, 
Êush_¨g
Ë? : 
cou¡
;

149 
	`muãx_u∆ock
(&
mvm
->
muãx
);

151  
ªt
;

152 
	}
}

154 
ssize_t
 
	$iwl_dbgfs_°a_døö_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

155 
size_t
 
cou¡
, 
loff_t
 *
µos
)

157 
iwl_mvm_°a
 *
mvm°a
;

158 
°a_id
, 
døö
, 
ªt
;

160 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

161 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
)

162  -
EIO
;

164 i‡(
	`ssˇnf
(
buf
, "%d %d", &
°a_id
, &
døö
) != 2)

165  -
EINVAL
;

166 i‡(
°a_id
 < 0 || sè_id >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
)

167  -
EINVAL
;

168 i‡(
døö
 < 0 || drain > 1)

169  -
EINVAL
;

171 
	`muãx_lock
(&
mvm
->
muãx
);

173 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 
°a_id
);

175 i‡(!
mvm°a
)

176 
ªt
 = -
ENOENT
;

178 
ªt
 = 
	`iwl_mvm_døö_°a
(
mvm
, 
mvm°a
, 
døö
Ë? : 
cou¡
;

180 
	`muãx_u∆ock
(&
mvm
->
muãx
);

182  
ªt
;

183 
	}
}

185 
ssize_t
 
	$iwl_dbgfs_§am_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

186 
size_t
 
cou¡
, 
loff_t
 *
µos
)

188 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

189 c⁄° 
fw_img
 *
img
;

190 
ofs
, 
Àn
;

191 
size_t
 
ªt
;

192 
u8
 *
±r
;

194 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

195  -
EINVAL
;

198 
img
 = &
mvm
->
fw
->img[mvm->
fwπ
.
cur_fw_img
];

199 
ofs
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
off£t
;

200 
Àn
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].len;

202 i‡(
mvm
->
dbgfs_§am_Àn
) {

203 
ofs
 = 
mvm
->
dbgfs_§am_off£t
;

204 
Àn
 = 
mvm
->
dbgfs_§am_Àn
;

207 
±r
 = 
	`kzÆloc
(
Àn
, 
GFP_KERNEL
);

208 i‡(!
±r
)

209  -
ENOMEM
;

211 
	`iwl_å™s_ªad_mem_byãs
(
mvm
->
å™s
, 
ofs
, 
±r
, 
Àn
);

213 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
±r
, 
Àn
);

215 
	`k‰ì
(
±r
);

217  
ªt
;

218 
	}
}

220 
ssize_t
 
	$iwl_dbgfs_§am_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

221 
size_t
 
cou¡
, 
loff_t
 *
µos
)

223 c⁄° 
fw_img
 *
img
;

224 
u32
 
off£t
, 
Àn
;

225 
u32
 
img_off£t
, 
img_Àn
;

227 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

228  -
EINVAL
;

230 
img
 = &
mvm
->
fw
->img[mvm->
fwπ
.
cur_fw_img
];

231 
img_off£t
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
off£t
;

232 
img_Àn
 = 
img
->
£c
[
IWL_UCODE_SECTION_DATA
].
Àn
;

234 i‡(
	`ssˇnf
(
buf
, "%x,%x", &
off£t
, &
Àn
) == 2) {

235 i‡((
off£t
 & 0x3Ë|| (
Àn
 & 0x3))

236  -
EINVAL
;

238 i‡(
off£t
 + 
Àn
 > 
img_off£t
 + 
img_Àn
)

239  -
EINVAL
;

241 
mvm
->
dbgfs_§am_off£t
 = 
off£t
;

242 
mvm
->
dbgfs_§am_Àn
 = 
Àn
;

244 
mvm
->
dbgfs_§am_off£t
 = 0;

245 
mvm
->
dbgfs_§am_Àn
 = 0;

248  
cou¡
;

249 
	}
}

251 
ssize_t
 
	$iwl_dbgfs_£t_nic_ãm≥øtuª_ªad
(
fûe
 *file,

252 
__u£r
 *
u£r_buf
,

253 
size_t
 
cou¡
, 
loff_t
 *
µos
)

255 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

256 
buf
[16];

257 
pos
;

259 i‡(!
mvm
->
ãm≥øtuª_ã°
)

260 
pos
 = 
	`s˙¥ötf
(
buf
, (buf), "disabled\n");

262 
pos
 = 
	`s˙¥ötf
(
buf
, (buf), "%d\n", 
mvm
->
ãm≥øtuª
);

264  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

265 
	}
}

274 
ssize_t
 
	$iwl_dbgfs_£t_nic_ãm≥øtuª_wrôe
(
iwl_mvm
 *
mvm
,

275 *
buf
, 
size_t
 
cou¡
,

276 
loff_t
 *
µos
)

278 
ãm≥øtuª
;

280 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
Ë&& !mvm->
ãm≥øtuª_ã°
)

281  -
EIO
;

283 i‡(
	`k°πoöt
(
buf
, 10, &
ãm≥øtuª
))

284  -
EINVAL
;

286 i‡((
ãm≥øtuª
 > 
IWL_MVM_DEBUG_SET_TEMPERATURE_MAX
 &&

287 
ãm≥øtuª
 !
IWL_MVM_DEBUG_SET_TEMPERATURE_DISABLE
) ||

288 
ãm≥øtuª
 < 
IWL_MVM_DEBUG_SET_TEMPERATURE_MIN
)

289  -
EINVAL
;

291 
	`muãx_lock
(&
mvm
->
muãx
);

292 i‡(
ãm≥øtuª
 =
IWL_MVM_DEBUG_SET_TEMPERATURE_DISABLE
) {

293 i‡(!
mvm
->
ãm≥øtuª_ã°
)

294 
out
;

296 
mvm
->
ãm≥øtuª_ã°
 = 
Ál£
;

301 
mvm
->
ãm≥øtuª
 = 0;

303 
mvm
->
ãm≥øtuª_ã°
 = 
åue
;

304 
mvm
->
ãm≥øtuª
 =Åemperature;

306 
	`IWL_DEBUG_TEMP
(
mvm
, "%sabling debug setÅemperature (temp = %d)\n",

307 
mvm
->
ãm≥øtuª_ã°
 ? "En" : "Dis",

308 
mvm
->
ãm≥øtuª
);

310 
	`iwl_mvm_â_h™dÀr
(
mvm
);

312 
out
:

313 
	`muãx_u∆ock
(&
mvm
->
muãx
);

315  
cou¡
;

316 
	}
}

318 
ssize_t
 
	$iwl_dbgfs_nic_ãmp_ªad
(
fûe
 *file,

319 
__u£r
 *
u£r_buf
,

320 
size_t
 
cou¡
, 
loff_t
 *
µos
)

322 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

323 
buf
[16];

324 
pos
, 
ªt
;

325 
s32
 
ãmp
;

327 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

328  -
EIO
;

330 
	`muãx_lock
(&
mvm
->
muãx
);

331 
ªt
 = 
	`iwl_mvm_gë_ãmp
(
mvm
, &
ãmp
);

332 
	`muãx_u∆ock
(&
mvm
->
muãx
);

334 i‡(
ªt
)

335  -
EIO
;

337 
pos
 = 
	`s˙¥ötf
(
buf
, (buf), "%d\n", 
ãmp
);

339  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

340 
	}
}

342 #ifde‡
CONFIG_ACPI


343 
ssize_t
 
	$iwl_dbgfs_ßr_geo_¥ofûe_ªad
(
fûe
 *file,

344 
__u£r
 *
u£r_buf
,

345 
size_t
 
cou¡
, 
loff_t
 *
µos
)

347 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

348 
buf
[256];

349 
pos
 = 0;

350 
bufsz
 = (
buf
);

351 
tbl_idx
;

353 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

354  -
EIO
;

356 
	`muãx_lock
(&
mvm
->
muãx
);

357 
tbl_idx
 = 
	`iwl_mvm_gë_ßr_geo_¥ofûe
(
mvm
);

358 i‡(
tbl_idx
 < 0) {

359 
	`muãx_u∆ock
(&
mvm
->
muãx
);

360  
tbl_idx
;

363 i‡(!
tbl_idx
) {

364 
pos
 = 
	`s˙¥ötf
(
buf
, 
bufsz
,

367 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

368 "U£ geogøphi¯¥ofûê%d\n", 
tbl_idx
);

369 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

371 
mvm
->
fwπ
.
geo_¥ofûes
[
tbl_idx
 - 1].
b™ds
[0].
chaös
[0],

372 
mvm
->
fwπ
.
geo_¥ofûes
[
tbl_idx
 - 1].
b™ds
[0].
chaös
[1],

373 
mvm
->
fwπ
.
geo_¥ofûes
[
tbl_idx
 - 1].
b™ds
[0].
max
);

374 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

376 
mvm
->
fwπ
.
geo_¥ofûes
[
tbl_idx
 - 1].
b™ds
[1].
chaös
[0],

377 
mvm
->
fwπ
.
geo_¥ofûes
[
tbl_idx
 - 1].
b™ds
[1].
chaös
[1],

378 
mvm
->
fwπ
.
geo_¥ofûes
[
tbl_idx
 - 1].
b™ds
[1].
max
);

380 
	`muãx_u∆ock
(&
mvm
->
muãx
);

382  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

383 
	}
}

385 
ssize_t
 
	$iwl_dbgfs_wifi_6e_íabÀ_ªad
(
fûe
 *file,

386 
__u£r
 *
u£r_buf
,

387 
size_t
 
cou¡
, 
loff_t
 *
µos
)

389 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

390 
îr
, 
pos
;

391 
buf
[12];

392 
u32
 
vÆue
;

394 
îr
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_ENABLE_6E
, &
vÆue
);

395 i‡(
îr
)

396  
îr
;

398 
pos
 = 
	`•rötf
(
buf
, "0x%08x\n", 
vÆue
);

400  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

401 
	}
}

404 
ssize_t
 
	$iwl_dbgfs_°©i⁄s_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

405 
size_t
 
cou¡
, 
loff_t
 *
µos
)

407 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

408 
õì80211_°a
 *
°a
;

409 
buf
[400];

410 
i
, 
pos
 = 0, 
bufsz
 = (
buf
);

412 
	`muãx_lock
(&
mvm
->
muãx
);

414 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

415 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%.2d: ", 
i
);

416 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
i
],

417 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

418 i‡(!
°a
)

419 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "N/A\n");

420 i‡(
	`IS_ERR
(
°a
))

421 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%ld\n",

422 
	`PTR_ERR
(
°a
));

424 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%pM\n",

425 
°a
->
addr
);

428 
	`muãx_u∆ock
(&
mvm
->
muãx
);

430  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

431 
	}
}

433 
ssize_t
 
	$iwl_dbgfs_rs_d©a_ªad
(
õì80211_lök_°a
 *
lök_°a
,

434 
iwl_mvm_°a
 *
mvm°a
,

435 
iwl_mvm
 *
mvm
,

436 
iwl_mvm_lök_°a
 *
mvm_lök_°a
,

437 
__u£r
 *
u£r_buf
,

438 
size_t
 
cou¡
, 
loff_t
 *
µos
)

440 
iwl_lq_°a_rs_fw
 *
lq_°a
 = &
mvm_lök_°a
->lq_°a.
rs_fw
;

441 c⁄° 
size_t
 
bufsz
 = 2048;

442 *
buff
;

443 
desc
 = 0;

444 
ssize_t
 
ªt
;

446 
buff
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

447 i‡(!
buff
)

448  -
ENOMEM
;

450 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, "sta_id %d\n",

451 
lq_°a
->
≥rs
.
°a_id
);

452 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

454 
lq_°a
->
≥rs
.
dbg_fixed_øã
);

455 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

457 
lq_°a
->
≥rs
.
dbg_agg_‰ame_cou¡_lim
);

458 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

460 (
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
Ë& 
ANT_A
) ? "ANT_A," : "",

461 (
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
Ë& 
ANT_B
) ? "ANT_B," : "");

462 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

464 
lq_°a
->
œ°_øã_n_Êags
);

466 
desc
 +
	`rs_¥ëty_¥öt_øã
(
buff
 + desc, 
bufsz
 - desc,

467 
lq_°a
->
œ°_øã_n_Êags
);

468 i‡(
desc
 < 
bufsz
 - 1)

469 
buff
[
desc
++] = '\n';

471 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
desc
);

472 
	`k‰ì
(
buff
);

473  
ªt
;

474 
	}
}

476 
ssize_t
 
	$iwl_dbgfs_amsdu_Àn_wrôe
(
õì80211_lök_°a
 *
lök_°a
,

477 
iwl_mvm_°a
 *
mvm°a
,

478 
iwl_mvm
 *
mvm
,

479 
iwl_mvm_lök_°a
 *
mvm_lök_°a
,

480 *
buf
, 
size_t
 
cou¡
,

481 
loff_t
 *
µos
)

483 
i
;

484 
u16
 
amsdu_Àn
;

486 i‡(
	`k°πou16
(
buf
, 0, &
amsdu_Àn
))

487  -
EINVAL
;

490 i‡(
amsdu_Àn
 && 
mvm_lök_°a
->
‹ig_amsdu_Àn
)

491  -
EBUSY
;

493 i‡(
amsdu_Àn
) {

494 
mvm_lök_°a
->
‹ig_amsdu_Àn
 = 
lök_°a
->
agg
.
max_amsdu_Àn
;

495 
lök_°a
->
agg
.
max_amsdu_Àn
 = 
amsdu_Àn
;

496 
lök_°a
->
agg
.
max_amsdu_Àn
 = 
amsdu_Àn
;

497 
i
 = 0; i < 
	`ARRAY_SIZE
(
lök_°a
->
agg
.
max_tid_amsdu_Àn
); i++)

498 
lök_°a
->
agg
.
max_tid_amsdu_Àn
[
i
] = 
amsdu_Àn
;

500 
lök_°a
->
agg
.
max_amsdu_Àn
 = 
mvm_lök_°a
->
‹ig_amsdu_Àn
;

501 
mvm_lök_°a
->
‹ig_amsdu_Àn
 = 0;

504 
	`õì80211_°a_ªˇlc_aggªg©es
(
lök_°a
->
°a
);

506  
cou¡
;

507 
	}
}

509 
ssize_t
 
	$iwl_dbgfs_amsdu_Àn_ªad
(
õì80211_lök_°a
 *
lök_°a
,

510 
iwl_mvm_°a
 *
mvm°a
,

511 
iwl_mvm
 *
mvm
,

512 
iwl_mvm_lök_°a
 *
mvm_lök_°a
,

513 
__u£r
 *
u£r_buf
,

514 
size_t
 
cou¡
, 
loff_t
 *
µos
)

516 
buf
[32];

517 
pos
;

519 
pos
 = 
	`s˙¥ötf
(
buf
, (buf), "current %d ",

520 
lök_°a
->
agg
.
max_amsdu_Àn
);

521 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, (buf) -Öos, "stored %d\n",

522 
mvm_lök_°a
->
‹ig_amsdu_Àn
);

524  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

525 
	}
}

527 
ssize_t
 
	$iwl_dbgfs_dißbÀ_powî_off_ªad
(
fûe
 *file,

528 
__u£r
 *
u£r_buf
,

529 
size_t
 
cou¡
, 
loff_t
 *
µos
)

531 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

532 
buf
[64];

533 
bufsz
 = (
buf
);

534 
pos
 = 0;

536 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "disable_power_off_d0=%d\n",

537 
mvm
->
dißbÀ_powî_off
);

538 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "disable_power_off_d3=%d\n",

539 
mvm
->
dißbÀ_powî_off_d3
);

541  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

542 
	}
}

544 
ssize_t
 
	$iwl_dbgfs_dißbÀ_powî_off_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

545 
size_t
 
cou¡
, 
loff_t
 *
µos
)

547 
ªt
, 
vÆ
;

549 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

550  -
EIO
;

552 i‡(!
	`°∫cmp
("dißbÀ_powî_off_d0=", 
buf
, 21)) {

553 i‡(
	`ssˇnf
(
buf
 + 21, "%d", &
vÆ
) != 1)

554  -
EINVAL
;

555 
mvm
->
dißbÀ_powî_off
 = 
vÆ
;

556 } i‡(!
	`°∫cmp
("dißbÀ_powî_off_d3=", 
buf
, 21)) {

557 i‡(
	`ssˇnf
(
buf
 + 21, "%d", &
vÆ
) != 1)

558  -
EINVAL
;

559 
mvm
->
dißbÀ_powî_off_d3
 = 
vÆ
;

561  -
EINVAL
;

564 
	`muãx_lock
(&
mvm
->
muãx
);

565 
ªt
 = 
	`iwl_mvm_powî_upd©e_devi˚
(
mvm
);

566 
	`muãx_u∆ock
(&
mvm
->
muãx
);

568  
ªt
 ?: 
cou¡
;

569 
	}
}

572 
	$iwl_mvm_c€x_dump_mbox
(
iwl_bt_c€x_¥ofûe_nŸif
 *
nŸif
, *
buf
,

573 
pos
, 
bufsz
)

575 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "MBOX dw0:\n");

577 
	`BT_MBOX_PRINT
(0, 
LE_SLAVE_LAT
, 
Ál£
);

578 
	`BT_MBOX_PRINT
(0, 
LE_PROF1
, 
Ál£
);

579 
	`BT_MBOX_PRINT
(0, 
LE_PROF2
, 
Ál£
);

580 
	`BT_MBOX_PRINT
(0, 
LE_PROF_OTHER
, 
Ál£
);

581 
	`BT_MBOX_PRINT
(0, 
CHL_SEQ_N
, 
Ál£
);

582 
	`BT_MBOX_PRINT
(0, 
INBAND_S
, 
Ál£
);

583 
	`BT_MBOX_PRINT
(0, 
LE_MIN_RSSI
, 
Ál£
);

584 
	`BT_MBOX_PRINT
(0, 
LE_SCAN
, 
Ál£
);

585 
	`BT_MBOX_PRINT
(0, 
LE_ADV
, 
Ál£
);

586 
	`BT_MBOX_PRINT
(0, 
LE_MAX_TX_POWER
, 
Ál£
);

587 
	`BT_MBOX_PRINT
(0, 
OPEN_CON_1
, 
åue
);

589 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "MBOX dw1:\n");

591 
	`BT_MBOX_PRINT
(1, 
BR_MAX_TX_POWER
, 
Ál£
);

592 
	`BT_MBOX_PRINT
(1, 
IP_SR
, 
Ál£
);

593 
	`BT_MBOX_PRINT
(1, 
LE_MSTR
, 
Ál£
);

594 
	`BT_MBOX_PRINT
(1, 
AGGR_TRFC_LD
, 
Ál£
);

595 
	`BT_MBOX_PRINT
(1, 
MSG_TYPE
, 
Ál£
);

596 
	`BT_MBOX_PRINT
(1, 
SSN
, 
åue
);

598 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "MBOX dw2:\n");

600 
	`BT_MBOX_PRINT
(2, 
SNIFF_ACT
, 
Ál£
);

601 
	`BT_MBOX_PRINT
(2, 
PAG
, 
Ál£
);

602 
	`BT_MBOX_PRINT
(2, 
INQUIRY
, 
Ál£
);

603 
	`BT_MBOX_PRINT
(2, 
CONN
, 
Ál£
);

604 
	`BT_MBOX_PRINT
(2, 
SNIFF_INTERVAL
, 
Ál£
);

605 
	`BT_MBOX_PRINT
(2, 
DISC
, 
Ál£
);

606 
	`BT_MBOX_PRINT
(2, 
SCO_TX_ACT
, 
Ál£
);

607 
	`BT_MBOX_PRINT
(2, 
SCO_RX_ACT
, 
Ál£
);

608 
	`BT_MBOX_PRINT
(2, 
ESCO_RE_TX
, 
Ál£
);

609 
	`BT_MBOX_PRINT
(2, 
SCO_DURATION
, 
åue
);

611 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "MBOX dw3:\n");

613 
	`BT_MBOX_PRINT
(3, 
SCO_STATE
, 
Ál£
);

614 
	`BT_MBOX_PRINT
(3, 
SNIFF_STATE
, 
Ál£
);

615 
	`BT_MBOX_PRINT
(3, 
A2DP_STATE
, 
Ál£
);

616 
	`BT_MBOX_PRINT
(3, 
A2DP_SRC
, 
Ál£
);

617 
	`BT_MBOX_PRINT
(3, 
ACL_STATE
, 
Ál£
);

618 
	`BT_MBOX_PRINT
(3, 
MSTR_STATE
, 
Ál£
);

619 
	`BT_MBOX_PRINT
(3, 
OBX_STATE
, 
Ál£
);

620 
	`BT_MBOX_PRINT
(3, 
OPEN_CON_2
, 
Ál£
);

621 
	`BT_MBOX_PRINT
(3, 
TRAFFIC_LOAD
, 
Ál£
);

622 
	`BT_MBOX_PRINT
(3, 
CHL_SEQN_LSB
, 
Ál£
);

623 
	`BT_MBOX_PRINT
(3, 
INBAND_P
, 
Ál£
);

624 
	`BT_MBOX_PRINT
(3, 
MSG_TYPE_2
, 
Ál£
);

625 
	`BT_MBOX_PRINT
(3, 
SSN_2
, 
Ál£
);

626 
	`BT_MBOX_PRINT
(3, 
UPDATE_REQUEST
, 
åue
);

628  
pos
;

629 
	}
}

631 
ssize_t
 
	$iwl_dbgfs_bt_nŸif_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

632 
size_t
 
cou¡
, 
loff_t
 *
µos
)

634 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

635 
iwl_bt_c€x_¥ofûe_nŸif
 *
nŸif
 = &
mvm
->
œ°_bt_nŸif
;

636 *
buf
;

637 
ªt
, 
pos
 = 0, 
bufsz
 = () * 1024;

639 
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

640 i‡(!
buf
)

641  -
ENOMEM
;

643 
	`muãx_lock
(&
mvm
->
muãx
);

645 
pos
 +
	`iwl_mvm_c€x_dump_mbox
(
nŸif
, 
buf
,Öos, 
bufsz
);

647 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "bt_ci_compliance = %d\n",

648 
nŸif
->
bt_ci_com∂ün˚
);

649 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "primary_ch_lut = %d\n",

650 
	`À32_to_˝u
(
nŸif
->
¥im¨y_ch_lut
));

651 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "secondary_ch_lut = %d\n",

652 
	`À32_to_˝u
(
nŸif
->
£c⁄d¨y_ch_lut
));

653 
pos
 +
	`s˙¥ötf
(
buf
 +Öos,

654 
bufsz
 - 
pos
, "bt_activity_grading = %d\n",

655 
	`À32_to_˝u
(
nŸif
->
bt_a˘ivôy_gødög
));

656 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "bt_rrc = %d\n",

657 
nŸif
->
ºc_°©us
 & 0xF);

658 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "bt_ttc = %d\n",

659 
nŸif
->
âc_°©us
 & 0xF);

661 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "sync_sco = %d\n",

662 
IWL_MVM_BT_COEX_SYNC2SCO
);

663 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "mplut = %d\n",

664 
IWL_MVM_BT_COEX_MPLUT
);

666 
	`muãx_u∆ock
(&
mvm
->
muãx
);

668 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

669 
	`k‰ì
(
buf
);

671  
ªt
;

672 
	}
}

673 #unde‡
BT_MBOX_PRINT


675 
ssize_t
 
	$iwl_dbgfs_bt_cmd_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

676 
size_t
 
cou¡
, 
loff_t
 *
µos
)

678 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

679 
iwl_bt_c€x_ci_cmd
 *
cmd
 = &
mvm
->
œ°_bt_ci_cmd
;

680 
buf
[256];

681 
bufsz
 = (
buf
);

682 
pos
 = 0;

684 
	`muãx_lock
(&
mvm
->
muãx
);

686 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Channel inhibition CMD\n");

687 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

689 
	`À64_to_˝u
(
cmd
->
bt_¥im¨y_ci
));

690 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

692 
	`À64_to_˝u
(
cmd
->
bt_£c⁄d¨y_ci
));

694 
	`muãx_u∆ock
(&
mvm
->
muãx
);

696  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

697 
	}
}

699 
ssize_t


700 
	$iwl_dbgfs_bt_tx_¥io_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

701 
size_t
 
cou¡
, 
loff_t
 *
µos
)

703 
u32
 
bt_tx_¥io
;

705 i‡(
	`ssˇnf
(
buf
, "%u", &
bt_tx_¥io
) != 1)

706  -
EINVAL
;

707 i‡(
bt_tx_¥io
 > 4)

708  -
EINVAL
;

710 
mvm
->
bt_tx_¥io
 = bt_tx_prio;

712  
cou¡
;

713 
	}
}

715 
ssize_t


716 
	$iwl_dbgfs_bt_f‹˚_™t_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

717 
size_t
 
cou¡
, 
loff_t
 *
µos
)

719 c⁄° * c⁄° 
modes_°r
[
BT_FORCE_ANT_MAX
] = {

720 [
BT_FORCE_ANT_DIS
] = "dis",

721 [
BT_FORCE_ANT_AUTO
] = "auto",

722 [
BT_FORCE_ANT_BT
] = "bt",

723 [
BT_FORCE_ANT_WIFI
] = "wifi",

725 
ªt
, 
bt_f‹˚_™t_mode
;

727 
ªt
 = 
	`m©ch_°rög
(
modes_°r
, 
	`ARRAY_SIZE
(modes_°r), 
buf
);

728 i‡(
ªt
 < 0)

729  
ªt
;

731 
bt_f‹˚_™t_mode
 = 
ªt
;

732 
ªt
 = 0;

733 
	`muãx_lock
(&
mvm
->
muãx
);

734 i‡(
mvm
->
bt_f‹˚_™t_mode
 == bt_force_ant_mode)

735 
out
;

737 
mvm
->
bt_f‹˚_™t_mode
 = bt_force_ant_mode;

738 
	`IWL_DEBUG_COEX
(
mvm
, "Force mode: %s\n",

739 
modes_°r
[
mvm
->
bt_f‹˚_™t_mode
]);

741 i‡(
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

742 
ªt
 = 
	`iwl_mvm_£nd_bt_öô_c⁄f
(
mvm
);

744 
ªt
 = 0;

746 
out
:

747 
	`muãx_u∆ock
(&
mvm
->
muãx
);

748  
ªt
 ?: 
cou¡
;

749 
	}
}

751 
ssize_t
 
	$iwl_dbgfs_fw_vî_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

752 
size_t
 
cou¡
, 
loff_t
 *
µos
)

754 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

755 *
buff
, *
pos
, *
ídpos
;

756 c⁄° 
size_t
 
bufsz
 = 1024;

757 
_fw_«me_¥e
[
FW_NAME_PRE_BUFSIZE
];

758 
ªt
;

760 
buff
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

761 i‡(!
buff
)

762  -
ENOMEM
;

764 
pos
 = 
buff
;

765 
ídpos
 = 
pos
 + 
bufsz
;

767 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "FWÖrefix: %s\n",

768 
	`iwl_drv_gë_fw«me_¥e
(
mvm
->
å™s
, 
_fw_«me_¥e
));

769 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "FW: %s\n",

770 
mvm
->
fwπ
.
fw
->
hum™_ªadabÀ
);

771 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Device: %s\n",

772 
mvm
->
fwπ
.
å™s
->
«me
);

773 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Bus: %s\n",

774 
mvm
->
fwπ
.
dev
->
bus
->
«me
);

776 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
pos
 - buff);

777 
	`k‰ì
(
buff
);

779  
ªt
;

780 
	}
}

782 
ssize_t
 
	$iwl_dbgfs_ès_gë_°©us_ªad
(
fûe
 *file,

783 
__u£r
 *
u£r_buf
,

784 
size_t
 
cou¡
, 
loff_t
 *
µos
)

786 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

787 
iwl_mvm_ès_°©us_ª•
 
ès_r•
;

788 
iwl_mvm_ès_°©us_ª•
 *
r•
 = &
ès_r•
;

789 c⁄° 
size_t
 
bufsz
 = 1024;

790 *
buff
, *
pos
, *
ídpos
;

791 c⁄° * c⁄° 
ès_dis_ªas⁄
[
TAS_DISABLED_REASON_MAX
] = {

792 [
TAS_DISABLED_DUE_TO_BIOS
] =

794 [
TAS_DISABLED_DUE_TO_SAR_6DBM
] =

796 [
TAS_DISABLED_REASON_INVALID
] =

799 c⁄° * c⁄° 
ès_cuºít_°©us
[
TAS_DYNA_STATUS_MAX
] = {

800 [
TAS_DYNA_INACTIVE
] = "INACTIVE",

801 [
TAS_DYNA_INACTIVE_MVM_MODE
] =

803 [
TAS_DYNA_INACTIVE_TRIGGER_MODE
] =

805 [
TAS_DYNA_INACTIVE_BLOCK_LISTED
] =

807 [
TAS_DYNA_INACTIVE_UHB_NON_US
] =

809 [
TAS_DYNA_ACTIVE
] = "ACTIVE",

811 
iwl_ho°_cmd
 
hcmd
 = {

812 .
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, 
GET_TAS_STATUS
),

813 .
Êags
 = 
CMD_WANT_SKB
,

814 .
Àn
 = { 0, },

815 .
d©a
 = { 
NULL
, },

817 
ªt
, 
i
, 
tmp
;

818 
boﬁ
 
ès_íabÀd
 = 
Ál£
;

819 
dyn_°©us
;

821 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

822  -
ENODEV
;

824 
	`muãx_lock
(&
mvm
->
muãx
);

825 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

826 
	`muãx_u∆ock
(&
mvm
->
muãx
);

827 i‡(
ªt
 < 0)

828  
ªt
;

830 
buff
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

831 i‡(!
buff
)

832  -
ENOMEM
;

833 
pos
 = 
buff
;

834 
ídpos
 = 
pos
 + 
bufsz
;

836 
r•
 = (*)
hcmd
.
ª•_pkt
->
d©a
;

838 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "TAS Conclusion:\n");

839 
i
 = 0; i < 
r•
->
ö_duÆ_ødio
 + 1; i++) {

840 i‡(
r•
->
ès_°©us_mac
[
i
].
b™d
 !
TAS_LMAC_BAND_INVALID
 &&

841 
r•
->
ès_°©us_mac
[
i
].
dy«mic_°©us
 & 
	`BIT
(
TAS_DYNA_ACTIVE
)) {

842 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "\tON for ");

843 
r•
->
ès_°©us_mac
[
i
].
b™d
) {

844 
TAS_LMAC_BAND_HB
:

845 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "HB\n");

847 
TAS_LMAC_BAND_LB
:

848 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "LB\n");

850 
TAS_LMAC_BAND_UHB
:

851 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "UHB\n");

853 
TAS_LMAC_BAND_INVALID
:

854 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

858 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

860 
r•
->
ès_°©us_mac
[
i
].
b™d
);

861 
out
;

863 
ès_íabÀd
 = 
åue
;

866 i‡(!
ès_íabÀd
)

867 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "\tOFF\n");

869 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "TAS Report\n");

870 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "TAS FW version: %d\n",

871 
r•
->
ès_fw_vîsi⁄
);

872 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Is UHBÉnabled for USA?: %s\n",

873 
r•
->
is_uhb_f‹_uß_íabÀ
 ? "True" : "False");

874 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Current MCC: 0x%x\n",

875 
	`À16_to_˝u
(
r•
->
cuº_mcc
));

877 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "BlockÜistÉntries:");

878 
i
 = 0; i < 
IWL_WTAS_BLACK_LIST_MAX
; i++)

879 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, " 0x%x",

880 
	`À16_to_˝u
(
r•
->
block_li°
[
i
]));

882 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "\nOEMÇame: %s\n",

883 
	`dmi_gë_sy°em_öfo
(
DMI_SYS_VENDOR
) ?: "<unknown>");

884 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "\tVendor In Approved List: %s\n",

885 
	`iwl_is_ès_≠¥oved
() ? "YES" : "NO");

886 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

888 
r•
->
ö_duÆ_ødio
 ? "TRUE" : "FALSE");

890 
i
 = 0; i < 
r•
->
ö_duÆ_ødio
 + 1; i++) {

891 i‡(
r•
->
ès_°©us_mac
[
i
].
°©ic_°©us
 == 0) {

892 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

894 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

896 
ès_dis_ªas⁄
[0]);

897 
out
;

900 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "TAS status for ");

901 
r•
->
ès_°©us_mac
[
i
].
b™d
) {

902 
TAS_LMAC_BAND_HB
:

903 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "High band\n");

905 
TAS_LMAC_BAND_LB
:

906 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Low band\n");

908 
TAS_LMAC_BAND_UHB
:

909 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

912 
TAS_LMAC_BAND_INVALID
:

913 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

917 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

919 
r•
->
ès_°©us_mac
[
i
].
b™d
);

920 
out
;

922 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Static status: %sabled\n",

923 
r•
->
ès_°©us_mac
[
i
].
°©ic_°©us
 ?

925 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

927 i‡(
r•
->
ès_°©us_mac
[
i
].
°©ic_dis_ªas⁄
 < 
TAS_DISABLED_REASON_MAX
)

928 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "%s (%d)\n",

929 
ès_dis_ªas⁄
[
r•
->
ès_°©us_mac
[
i
].
°©ic_dis_ªas⁄
],

930 
r•
->
ès_°©us_mac
[
i
].
°©ic_dis_ªas⁄
);

932 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

934 
r•
->
ès_°©us_mac
[
i
].
°©ic_dis_ªas⁄
);

936 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Dynamic status:\n");

937 
dyn_°©us
 = (
r•
->
ès_°©us_mac
[
i
].
dy«mic_°©us
);

938 
	`f‹_óch_£t_bô
(
tmp
, &
dyn_°©us
, (dyn_status)) {

939 i‡(
tmp
 >0 &&Åm∞< 
TAS_DYNA_STATUS_MAX
)

940 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

942 
ès_cuºít_°©us
[
tmp
],Åmp);

945 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

947 
r•
->
ès_°©us_mac
[
i
].
√¨_disc⁄√˘i⁄
 ?

949 
tmp
 = 
	`À16_to_˝u
(
r•
->
ès_°©us_mac
[
i
].
max_ªg_pwr_limô
);

950 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

952 
tmp
 / 8, 125 * (tmp % 8));

953 
tmp
 = 
	`À16_to_˝u
(
r•
->
ès_°©us_mac
[
i
].
ßr_limô
);

954 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

956 
tmp
 / 8, 125 * (tmp % 8));

959 
out
:

960 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
pos
 - buff);

961 
	`k‰ì
(
buff
);

962 
	`iwl_‰ì_ª•
(&
hcmd
);

963  
ªt
;

964 
	}
}

966 
ssize_t
 
	$iwl_dbgfs_phy_öãgøti⁄_vî_ªad
(
fûe
 *file,

967 
__u£r
 *
u£r_buf
,

968 
size_t
 
cou¡
, 
loff_t
 *
µos
)

970 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

971 *
buf
;

972 
size_t
 
bufsz
;

973 
pos
;

974 
ssize_t
 
ªt
;

976 
bufsz
 = 
mvm
->
fw
->
phy_öãgøti⁄_vî_Àn
 + 2;

977 
buf
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

978 i‡(!
buf
)

979  -
ENOMEM
;

981 
pos
 = 
	`s˙¥ötf
(
buf
, 
bufsz
, "%.*s\n", 
mvm
->
fw
->
phy_öãgøti⁄_vî_Àn
,

982 
mvm
->
fw
->
phy_öãgøti⁄_vî
);

984 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

986 
	`k‰ì
(
buf
);

987  
ªt
;

988 
	}
}

990 
	#PRINT_STATS_LE32
(
_°ru˘
, 
_memb
) \

991 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, \

992 
fmt_èbÀ
, #_memb, \

993 
	`À32_to_˝u
(
_°ru˘
->
_memb
))

	)

995 
ssize_t
 
	$iwl_dbgfs_fw_rx_°©s_ªad
(
fûe
 *file,

996 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

997 
loff_t
 *
µos
)

999 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

1000 c⁄° *
fmt_èbÀ
 = "\t%-30s %10u\n";

1001 c⁄° *
fmt_hódî
 = "%-32s\n";

1002 
pos
 = 0;

1003 *
buf
;

1004 
ªt
;

1005 
size_t
 
bufsz
;

1006 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1007 
	`WIDE_ID
(
SYSTEM_GROUP
,

1008 
SYSTEM_STATISTICS_CMD
),

1009 
IWL_FW_CMD_VER_UNKNOWN
);

1011 i‡(
cmd_vî
 !
IWL_FW_CMD_VER_UNKNOWN
)

1012  -
EOPNOTSUPP
;

1014 i‡(
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
))

1015 
bufsz
 = (((
mvm_°©i°ics_rx
) /

1016 (
__À32
)) * 43) + (4 * 33) + 1;

1019 
bufsz
 = (((
mvm_°©i°ics_rx_v3
) /

1020 (
__À32
)) * 43) + (4 * 33) + 1;

1022 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1023 i‡(!
buf
)

1024  -
ENOMEM
;

1026 
	`muãx_lock
(&
mvm
->
muãx
);

1028 i‡(
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1029 
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
Ál£
);

1031 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, 
fmt_hódî
,

1033 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1034 
mvm_°©i°ics_rx_phy_v2
 *
ofdm
 = &
mvm
->
rx_°©s_v3
.ofdm;

1036 
	`PRINT_STATS_LE32
(
ofdm
, 
öa_˙t
);

1037 
	`PRINT_STATS_LE32
(
ofdm
, 
föa_˙t
);

1038 
	`PRINT_STATS_LE32
(
ofdm
, 
∂˝_îr
);

1039 
	`PRINT_STATS_LE32
(
ofdm
, 
¸c32_îr
);

1040 
	`PRINT_STATS_LE32
(
ofdm
, 
ovîrun_îr
);

1041 
	`PRINT_STATS_LE32
(
ofdm
, 
óæy_ovîrun_îr
);

1042 
	`PRINT_STATS_LE32
(
ofdm
, 
¸c32_good
);

1043 
	`PRINT_STATS_LE32
(
ofdm
, 
Ál£_Æ¨m_˙t
);

1044 
	`PRINT_STATS_LE32
(
ofdm
, 
föa_sync_îr_˙t
);

1045 
	`PRINT_STATS_LE32
(
ofdm
, 
sfd_timeout
);

1046 
	`PRINT_STATS_LE32
(
ofdm
, 
föa_timeout
);

1047 
	`PRINT_STATS_LE32
(
ofdm
, 
uƒe•⁄ded_πs
);

1048 
	`PRINT_STATS_LE32
(
ofdm
, 
rxe_‰ame_lmt_ovîrun
);

1049 
	`PRINT_STATS_LE32
(
ofdm
, 
£¡_ack_˙t
);

1050 
	`PRINT_STATS_LE32
(
ofdm
, 
£¡_˘s_˙t
);

1051 
	`PRINT_STATS_LE32
(
ofdm
, 
£¡_ba_r•_˙t
);

1052 
	`PRINT_STATS_LE32
(
ofdm
, 
d•_£lf_kûl
);

1053 
	`PRINT_STATS_LE32
(
ofdm
, 
mh_f‹m©_îr
);

1054 
	`PRINT_STATS_LE32
(
ofdm
, 
ª_acq_maö_rssi_sum
);

1055 
	`PRINT_STATS_LE32
(
ofdm
, 
ª£rved
);

1057 
mvm_°©i°ics_rx_phy
 *
ofdm
 = &
mvm
->
rx_°©s
.ofdm;

1059 
	`PRINT_STATS_LE32
(
ofdm
, 
uƒe•⁄ded_πs
);

1060 
	`PRINT_STATS_LE32
(
ofdm
, 
rxe_‰ame_lmt_ovîrun
);

1061 
	`PRINT_STATS_LE32
(
ofdm
, 
£¡_ba_r•_˙t
);

1062 
	`PRINT_STATS_LE32
(
ofdm
, 
d•_£lf_kûl
);

1063 
	`PRINT_STATS_LE32
(
ofdm
, 
ª£rved
);

1066 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, 
fmt_hódî
,

1068 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1069 
mvm_°©i°ics_rx_phy_v2
 *
cck
 = &
mvm
->
rx_°©s_v3
.cck;

1071 
	`PRINT_STATS_LE32
(
cck
, 
öa_˙t
);

1072 
	`PRINT_STATS_LE32
(
cck
, 
föa_˙t
);

1073 
	`PRINT_STATS_LE32
(
cck
, 
∂˝_îr
);

1074 
	`PRINT_STATS_LE32
(
cck
, 
¸c32_îr
);

1075 
	`PRINT_STATS_LE32
(
cck
, 
ovîrun_îr
);

1076 
	`PRINT_STATS_LE32
(
cck
, 
óæy_ovîrun_îr
);

1077 
	`PRINT_STATS_LE32
(
cck
, 
¸c32_good
);

1078 
	`PRINT_STATS_LE32
(
cck
, 
Ál£_Æ¨m_˙t
);

1079 
	`PRINT_STATS_LE32
(
cck
, 
föa_sync_îr_˙t
);

1080 
	`PRINT_STATS_LE32
(
cck
, 
sfd_timeout
);

1081 
	`PRINT_STATS_LE32
(
cck
, 
föa_timeout
);

1082 
	`PRINT_STATS_LE32
(
cck
, 
uƒe•⁄ded_πs
);

1083 
	`PRINT_STATS_LE32
(
cck
, 
rxe_‰ame_lmt_ovîrun
);

1084 
	`PRINT_STATS_LE32
(
cck
, 
£¡_ack_˙t
);

1085 
	`PRINT_STATS_LE32
(
cck
, 
£¡_˘s_˙t
);

1086 
	`PRINT_STATS_LE32
(
cck
, 
£¡_ba_r•_˙t
);

1087 
	`PRINT_STATS_LE32
(
cck
, 
d•_£lf_kûl
);

1088 
	`PRINT_STATS_LE32
(
cck
, 
mh_f‹m©_îr
);

1089 
	`PRINT_STATS_LE32
(
cck
, 
ª_acq_maö_rssi_sum
);

1090 
	`PRINT_STATS_LE32
(
cck
, 
ª£rved
);

1092 
mvm_°©i°ics_rx_phy
 *
cck
 = &
mvm
->
rx_°©s
.cck;

1094 
	`PRINT_STATS_LE32
(
cck
, 
uƒe•⁄ded_πs
);

1095 
	`PRINT_STATS_LE32
(
cck
, 
rxe_‰ame_lmt_ovîrun
);

1096 
	`PRINT_STATS_LE32
(
cck
, 
£¡_ba_r•_˙t
);

1097 
	`PRINT_STATS_LE32
(
cck
, 
d•_£lf_kûl
);

1098 
	`PRINT_STATS_LE32
(
cck
, 
ª£rved
);

1101 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, 
fmt_hódî
,

1103 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1104 
mvm_°©i°ics_rx_n⁄_phy_v3
 *
gíîÆ
 =

1105 &
mvm
->
rx_°©s_v3
.
gíîÆ
;

1107 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bogus_˘s
);

1108 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bogus_ack
);

1109 
	`PRINT_STATS_LE32
(
gíîÆ
, 
n⁄_bssid_‰ames
);

1110 
	`PRINT_STATS_LE32
(
gíîÆ
, 
fûãªd_‰ames
);

1111 
	`PRINT_STATS_LE32
(
gíîÆ
, 
n⁄_ch™√l_bóc⁄s
);

1112 
	`PRINT_STATS_LE32
(
gíîÆ
, 
ch™√l_bóc⁄s
);

1113 
	`PRINT_STATS_LE32
(
gíîÆ
, 
num_mis£d_bc⁄
);

1114 
	`PRINT_STATS_LE32
(
gíîÆ
, 
adc_rx_ßtuøti⁄_time
);

1115 
	`PRINT_STATS_LE32
(
gíîÆ
, 
öa_dëe˘i⁄_£¨ch_time
);

1116 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_sûí˚_rssi_a
);

1117 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_sûí˚_rssi_b
);

1118 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_sûí˚_rssi_c
);

1119 
	`PRINT_STATS_LE32
(
gíîÆ
, 
öãr„ªn˚_d©a_Êag
);

1120 
	`PRINT_STATS_LE32
(
gíîÆ
, 
ch™√l_lﬂd
);

1121 
	`PRINT_STATS_LE32
(
gíîÆ
, 
d•_Ál£_Æ¨ms
);

1122 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_rssi_a
);

1123 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_rssi_b
);

1124 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_rssi_c
);

1125 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_íîgy_a
);

1126 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_íîgy_b
);

1127 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_íîgy_c
);

1128 
	`PRINT_STATS_LE32
(
gíîÆ
, 
num_bt_kûls
);

1129 
	`PRINT_STATS_LE32
(
gíîÆ
, 
mac_id
);

1130 
	`PRINT_STATS_LE32
(
gíîÆ
, 
dúe˘ed_d©a_mpdu
);

1132 
mvm_°©i°ics_rx_n⁄_phy
 *
gíîÆ
 =

1133 &
mvm
->
rx_°©s
.
gíîÆ
;

1135 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bogus_˘s
);

1136 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bogus_ack
);

1137 
	`PRINT_STATS_LE32
(
gíîÆ
, 
n⁄_ch™√l_bóc⁄s
);

1138 
	`PRINT_STATS_LE32
(
gíîÆ
, 
ch™√l_bóc⁄s
);

1139 
	`PRINT_STATS_LE32
(
gíîÆ
, 
num_mis£d_bc⁄
);

1140 
	`PRINT_STATS_LE32
(
gíîÆ
, 
adc_rx_ßtuøti⁄_time
);

1141 
	`PRINT_STATS_LE32
(
gíîÆ
, 
öa_dëe˘i⁄_£¨ch_time
);

1142 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_sûí˚_rssi_a
);

1143 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_sûí˚_rssi_b
);

1144 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_sûí˚_rssi_c
);

1145 
	`PRINT_STATS_LE32
(
gíîÆ
, 
öãr„ªn˚_d©a_Êag
);

1146 
	`PRINT_STATS_LE32
(
gíîÆ
, 
ch™√l_lﬂd
);

1147 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_rssi_a
);

1148 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_rssi_b
);

1149 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_rssi_c
);

1150 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_íîgy_a
);

1151 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_íîgy_b
);

1152 
	`PRINT_STATS_LE32
(
gíîÆ
, 
bóc⁄_íîgy_c
);

1153 
	`PRINT_STATS_LE32
(
gíîÆ
, 
num_bt_kûls
);

1154 
	`PRINT_STATS_LE32
(
gíîÆ
, 
mac_id
);

1157 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, 
fmt_hódî
,

1159 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1160 
mvm_°©i°ics_rx_ht_phy_v1
 *
ht
 =

1161 &
mvm
->
rx_°©s_v3
.
ofdm_ht
;

1163 
	`PRINT_STATS_LE32
(
ht
, 
∂˝_îr
);

1164 
	`PRINT_STATS_LE32
(
ht
, 
ovîrun_îr
);

1165 
	`PRINT_STATS_LE32
(
ht
, 
óæy_ovîrun_îr
);

1166 
	`PRINT_STATS_LE32
(
ht
, 
¸c32_good
);

1167 
	`PRINT_STATS_LE32
(
ht
, 
¸c32_îr
);

1168 
	`PRINT_STATS_LE32
(
ht
, 
mh_f‹m©_îr
);

1169 
	`PRINT_STATS_LE32
(
ht
, 
agg_¸c32_good
);

1170 
	`PRINT_STATS_LE32
(
ht
, 
agg_mpdu_˙t
);

1171 
	`PRINT_STATS_LE32
(
ht
, 
agg_˙t
);

1172 
	`PRINT_STATS_LE32
(
ht
, 
unsuµ‹t_mcs
);

1174 
mvm_°©i°ics_rx_ht_phy
 *
ht
 =

1175 &
mvm
->
rx_°©s
.
ofdm_ht
;

1177 
	`PRINT_STATS_LE32
(
ht
, 
mh_f‹m©_îr
);

1178 
	`PRINT_STATS_LE32
(
ht
, 
agg_mpdu_˙t
);

1179 
	`PRINT_STATS_LE32
(
ht
, 
agg_˙t
);

1180 
	`PRINT_STATS_LE32
(
ht
, 
unsuµ‹t_mcs
);

1183 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1185 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1186 
	`k‰ì
(
buf
);

1188  
ªt
;

1189 
	}
}

1190 #unde‡
PRINT_STAT_LE32


1192 
ssize_t
 
	$iwl_dbgfs_fw_sy°em_°©s_ªad
(
fûe
 *file,

1193 
__u£r
 *
u£r_buf
,

1194 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1196 *
buff
, *
pos
, *
ídpos
;

1197 
ªt
;

1198 
size_t
 
bufsz
;

1199 
i
;

1200 
iwl_mvm_vif
 *
mvmvif
;

1201 
õì80211_vif
 *
vif
;

1202 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

1203 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1204 
	`WIDE_ID
(
SYSTEM_GROUP
,

1205 
SYSTEM_STATISTICS_CMD
),

1206 
IWL_FW_CMD_VER_UNKNOWN
);

1209 
bufsz
 = (
cmd_vî
 == 1) ? 4096 : 64;

1211 
buff
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

1212 i‡(!
buff
)

1213  -
ENOMEM
;

1215 
pos
 = 
buff
;

1216 
ídpos
 = 
pos
 + 
bufsz
;

1218 i‡(
cmd_vî
 != 1) {

1219 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1220 "Sy°em sèt†nŸ suµ‹ãd:%d\n", 
cmd_vî
);

1221 
£nd_out
;

1224 
	`muãx_lock
(&
mvm
->
muãx
);

1225 i‡(
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1226 
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
Ál£
);

1228 
i
 = 0; i < 
NUM_MAC_INDEX_DRIVER
; i++) {

1229 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
i
, 
Ál£
);

1230 i‡(!
vif
)

1233 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

1237 i‡(
i
 =
NUM_MAC_INDEX_DRIVER
 || !
vif
) {

1238 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "vif is NULL\n");

1239 
ªÀa£_£nd_out
;

1242 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1243 i‡(!
mvmvif
) {

1244 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "mvmvif is NULL\n");

1245 
ªÀa£_£nd_out
;

1248 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
) {

1249 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
i
];

1251 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1252 "lök_id %d", 
i
);

1253 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1255 
lök_öfo
->
bóc⁄_°©s
.
num_bóc⁄s
);

1256 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1258 
lök_öfo
->
bóc⁄_°©s
.
accu_num_bóc⁄s
);

1259 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1261 
lök_öfo
->
bóc⁄_°©s
.
avg_sig«l
);

1264 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1266 
mvm
->
ødio_°©s
.
rx_time
);

1267 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1269 
mvm
->
ødio_°©s
.
tx_time
);

1270 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1272 
mvm
->
accu_ødio_°©s
.
rx_time
);

1273 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1275 
mvm
->
accu_ødio_°©s
.
tx_time
);

1277 
ªÀa£_£nd_out
:

1278 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1280 
£nd_out
:

1281 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
pos
 - buff);

1282 
	`k‰ì
(
buff
);

1284  
ªt
;

1285 
	}
}

1287 
ssize_t
 
	$iwl_dbgfs_‰ame_°©s_ªad
(
iwl_mvm
 *
mvm
,

1288 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

1289 
loff_t
 *
µos
,

1290 
iwl_mvm_‰ame_°©s
 *
°©s
)

1292 *
buff
, *
pos
, *
ídpos
;

1293 
idx
, 
i
;

1294 
ªt
;

1295 c⁄° 
size_t
 
bufsz
 = 1024;

1297 
buff
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

1298 i‡(!
buff
)

1299  -
ENOMEM
;

1301 
	`•ö_lock_bh
(&
mvm
->
drv_°©s_lock
);

1303 
pos
 = 
buff
;

1304 
ídpos
 = 
pos
 + 
bufsz
;

1306 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

1308 
°©s
->
Àgacy_‰ames
,

1309 
°©s
->
ht_‰ames
,

1310 
°©s
->
vht_‰ames
);

1311 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "20/40/80\t:\t%d/%d/%d\n",

1312 
°©s
->
bw_20_‰ames
,

1313 
°©s
->
bw_40_‰ames
,

1314 
°©s
->
bw_80_‰ames
);

1315 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "NGI/SGI\t\t:\t%d/%d\n",

1316 
°©s
->
ngi_‰ames
,

1317 
°©s
->
sgi_‰ames
);

1318 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "SISO/MIMO2\t:\t%d/%d\n",

1319 
°©s
->
siso_‰ames
,

1320 
°©s
->
mimo2_‰ames
);

1321 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "FAIL/SCSS\t:\t%d/%d\n",

1322 
°©s
->
Áû_‰ames
,

1323 
°©s
->
suc˚ss_‰ames
);

1324 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "MPDUságg\t:\t%d\n",

1325 
°©s
->
agg_‰ames
);

1326 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "A-MPDUs\t\t:\t%d\n",

1327 
°©s
->
ampdu_cou¡
);

1328 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Avg MPDUs/A-MPDU:\t%d\n",

1329 
°©s
->
ampdu_cou¡
 > 0 ?

1330 (
°©s
->
agg_‰ames
 / sèts->
ampdu_cou¡
) : 0);

1332 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Last Rates\n");

1334 
idx
 = 
°©s
->
œ°_‰ame_idx
 - 1;

1335 
i
 = 0; i < 
	`ARRAY_SIZE
(
°©s
->
œ°_øãs
); i++) {

1336 
idx
 = (idx + 1Ë% 
	`ARRAY_SIZE
(
°©s
->
œ°_øãs
);

1337 i‡(
°©s
->
œ°_øãs
[
idx
] == 0)

1339 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "Rate[%d]: ",

1340 ()(
	`ARRAY_SIZE
(
°©s
->
œ°_øãs
Ë- 
i
));

1341 
pos
 +
	`rs_¥ëty_¥öt_øã_v1
’os, 
ídpos
 -Öos,

1342 
°©s
->
œ°_øãs
[
idx
]);

1343 i‡(
pos
 < 
ídpos
 - 1)

1344 *
pos
++ = '\n';

1346 
	`•ö_u∆ock_bh
(&
mvm
->
drv_°©s_lock
);

1348 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
pos
 - buff);

1349 
	`k‰ì
(
buff
);

1351  
ªt
;

1352 
	}
}

1354 
ssize_t
 
	$iwl_dbgfs_drv_rx_°©s_ªad
(
fûe
 *file,

1355 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

1356 
loff_t
 *
µos
)

1358 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

1360  
	`iwl_dbgfs_‰ame_°©s_ªad
(
mvm
, 
u£r_buf
, 
cou¡
, 
µos
,

1361 &
mvm
->
drv_rx_°©s
);

1362 
	}
}

1364 
ssize_t
 
	$iwl_dbgfs_fw_ª°¨t_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

1365 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1367 
__maybe_unu£d
 
ªt
;

1369 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1370  -
EIO
;

1372 
	`muãx_lock
(&
mvm
->
muãx
);

1375 i‡(
mvm
->
fw_ª°¨t
 >= 0)

1376 
mvm
->
fw_ª°¨t
++;

1378 i‡(
cou¡
 =6 && !
	`°rcmp
(
buf
, "nolog\n")) {

1379 
	`£t_bô
(
IWL_MVM_STATUS_SUPPRESS_ERROR_LOG_ONCE
, &
mvm
->
°©us
);

1380 
	`£t_bô
(
STATUS_SUPPRESS_CMD_ERROR_ONCE
, &
mvm
->
å™s
->
°©us
);

1384 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1385 
	`WIDE_ID
(
LONG_GROUP
, 
REPLY_ERROR
),

1386 0, 0, 
NULL
);

1388 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1390  
cou¡
;

1391 
	}
}

1393 
ssize_t
 
	$iwl_dbgfs_fw_nmi_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

1394 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1396 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1397  -
EIO
;

1399 i‡(
cou¡
 =6 && !
	`°rcmp
(
buf
, "nolog\n"))

1400 
	`£t_bô
(
IWL_MVM_STATUS_SUPPRESS_ERROR_LOG_ONCE
, &
mvm
->
°©us
);

1402 
	`iwl_f‹˚_nmi
(
mvm
->
å™s
);

1404  
cou¡
;

1405 
	}
}

1407 
ssize_t


1408 
	$iwl_dbgfs_sˇn_™t_rxchaö_ªad
(
fûe
 *file,

1409 
__u£r
 *
u£r_buf
,

1410 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1412 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

1413 
pos
 = 0;

1414 
buf
[32];

1415 c⁄° 
size_t
 
bufsz
 = (
buf
);

1418 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Antennas for scan: ");

1419 i‡(
mvm
->
sˇn_rx_™t
 & 
ANT_A
)

1420 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "A");

1421 i‡(
mvm
->
sˇn_rx_™t
 & 
ANT_B
)

1422 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "B");

1423 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, " (%x)\n", 
mvm
->
sˇn_rx_™t
);

1425  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1426 
	}
}

1428 
ssize_t


1429 
	$iwl_dbgfs_sˇn_™t_rxchaö_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

1430 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1432 
u8
 
sˇn_rx_™t
;

1434 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1435  -
EIO
;

1437 i‡(
	`ssˇnf
(
buf
, "%hhx", &
sˇn_rx_™t
) != 1)

1438  -
EINVAL
;

1439 i‡(
sˇn_rx_™t
 > 
ANT_ABC
)

1440  -
EINVAL
;

1441 i‡(
sˇn_rx_™t
 & ~(
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
)))

1442  -
EINVAL
;

1444 i‡(
mvm
->
sˇn_rx_™t
 != scan_rx_ant) {

1445 
mvm
->
sˇn_rx_™t
 = scan_rx_ant;

1446 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1447 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
))

1448 
	`iwl_mvm_c⁄fig_sˇn
(
mvm
);

1451  
cou¡
;

1452 
	}
}

1454 
ssize_t
 
	$iwl_dbgfs_ödúe˘i⁄_tbl_wrôe
(
iwl_mvm
 *
mvm
,

1455 *
buf
, 
size_t
 
cou¡
,

1456 
loff_t
 *
µos
)

1458 
iwl_rss_c⁄fig_cmd
 
cmd
 = {

1459 .
Êags
 = 
	`˝u_to_À32
(
IWL_RSS_ENABLE
),

1460 .
hash_mask
 = 
IWL_RSS_HASH_TYPE_IPV4_TCP
 |

1461 
IWL_RSS_HASH_TYPE_IPV4_UDP
 |

1462 
IWL_RSS_HASH_TYPE_IPV4_PAYLOAD
 |

1463 
IWL_RSS_HASH_TYPE_IPV6_TCP
 |

1464 
IWL_RSS_HASH_TYPE_IPV6_UDP
 |

1465 
IWL_RSS_HASH_TYPE_IPV6_PAYLOAD
,

1467 
ªt
, 
i
, 
num_ª≥©s
, 
nbyãs
 = 
cou¡
 / 2;

1469 
ªt
 = 
	`hex2bö
(
cmd
.
ödúe˘i⁄_èbÀ
, 
buf
, 
nbyãs
);

1470 i‡(
ªt
)

1471  
ªt
;

1480 
num_ª≥©s
 = 
	`ARRAY_SIZE
(
cmd
.
ödúe˘i⁄_èbÀ
Ë/ 
nbyãs
;

1481 
i
 = 1; i < 
num_ª≥©s
; i++)

1482 
	`mem˝y
(&
cmd
.
ödúe˘i⁄_èbÀ
[
i
 * 
nbyãs
],

1483 
cmd
.
ödúe˘i⁄_èbÀ
, 
nbyãs
);

1485 
	`mem˝y
(&
cmd
.
ödúe˘i⁄_èbÀ
[
i
 * 
nbyãs
], cmd.indirection_table,

1486 
	`ARRAY_SIZE
(
cmd
.
ödúe˘i⁄_èbÀ
Ë% 
nbyãs
);

1488 
	`√tdev_rss_key_fûl
(
cmd
.
£¸ë_key
, (cmd.secret_key));

1490 
	`muãx_lock
(&
mvm
->
muãx
);

1491 i‡(
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1492 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
RSS_CONFIG_CMD
, 0,

1493 (
cmd
), &cmd);

1495 
ªt
 = 0;

1496 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1498  
ªt
 ?: 
cou¡
;

1499 
	}
}

1501 
ssize_t
 
	$iwl_dbgfs_öje˘_∑ckë_wrôe
(
iwl_mvm
 *
mvm
,

1502 *
buf
, 
size_t
 
cou¡
,

1503 
loff_t
 *
µos
)

1505 
iwl_›_mode
 *
›mode
 = 
	`c⁄èöî_of
((*)
mvm
,

1506 
iwl_›_mode
,

1507 
›_mode_•ecific
);

1508 
iwl_rx_cmd_buf„r
 
rxb
 = {

1509 .
_rx_∑ge_‹dî
 = 0,

1510 .
åuesize
 = 0,

1511 .
_off£t
 = 0,

1513 
iwl_rx_∑ckë
 *
pkt
;

1514 
bö_Àn
 = 
cou¡
 / 2;

1515 
ªt
 = -
EINVAL
;

1517 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1518  -
EIO
;

1521 i‡(!
mvm
->
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

1522  -
EOPNOTSUPP
;

1524 
rxb
.
_∑ge
 = 
	`Æloc_∑ges
(
GFP_ATOMIC
, 0);

1525 i‡(!
rxb
.
_∑ge
)

1526  -
ENOMEM
;

1527 
pkt
 = 
	`rxb_addr
(&
rxb
);

1529 
ªt
 = 
	`hex2bö
(
	`∑ge_addªss
(
rxb
.
_∑ge
), 
buf
, 
bö_Àn
);

1530 i‡(
ªt
)

1531 
out
;

1534 i‡(
bö_Àn
 < (*
pkt
) ||

1535 
bö_Àn
 !(*
pkt
Ë+ 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(pkt))

1536 
out
;

1538 
	`loˇl_bh_dißbÀ
();

1539 
	`iwl_mvm_rx_mq
(
›mode
, 
NULL
, &
rxb
);

1540 
	`loˇl_bh_íabÀ
();

1541 
ªt
 = 0;

1543 
out
:

1544 
	`iwl_‰ì_rxb
(&
rxb
);

1546  
ªt
 ?: 
cou¡
;

1547 
	}
}

1549 
	$_iwl_dbgfs_öje˘_bóc⁄_õ
(
iwl_mvm
 *
mvm
, *
bö
, 
Àn
)

1551 
õì80211_vif
 *
vif
;

1552 
iwl_mvm_vif
 *
mvmvif
;

1553 
sk_buff
 *
bóc⁄
;

1554 
õì80211_tx_öfo
 *
öfo
;

1555 
iwl_mac_bóc⁄_cmd
 
bóc⁄_cmd
 = {};

1556 
lök_id
;

1557 
u8
 
øã
;

1558 
i
;

1560 
Àn
 /= 2;

1563 i‡(
Àn
 >
U8_MAX
)

1564  -
EINVAL
;

1566 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1567  -
EIO
;

1569 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
) &&

1570 !
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1571 
IWL_UCODE_TLV_API_NEW_BEACON_TEMPLATE
))

1572  -
EINVAL
;

1574 
	`muãx_lock
(&
mvm
->
muãx
);

1576 
i
 = 0; i < 
NUM_MAC_INDEX_DRIVER
; i++) {

1577 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
i
, 
Ál£
);

1578 i‡(!
vif
)

1581 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

1585 i‡(
i
 =
NUM_MAC_INDEX_DRIVER
 || !
vif
)

1586 
out_îr
;

1588 
mvm
->
hw
->
exåa_bóc⁄_èûroom
 = 
Àn
;

1590 
bóc⁄
 = 
	`õì80211_bóc⁄_gë_ãm∂©e
(
mvm
->
hw
, 
vif
, 
NULL
, 0);

1591 i‡(!
bóc⁄
)

1592 
out_îr
;

1594 i‡(
Àn
 && 
	`hex2bö
(
	`skb_put_zîo
(
bóc⁄
,Üí), 
bö
,Üen)) {

1595 
	`dev_k‰ì_skb
(
bóc⁄
);

1596 
out_îr
;

1599 
mvm
->
bóc⁄_öje˘_a˘ive
 = 
åue
;

1601 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1602 
öfo
 = 
	`IEEE80211_SKB_CB
(
bóc⁄
);

1603 
øã
 = 
	`iwl_mvm_mac_˘xt_gë_bóc⁄_øã
(
mvm
, 
öfo
, 
vif
);

1605 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
lök_id
) {

1606 
bóc⁄_cmd
.
Êags
 =

1607 
	`˝u_to_À16
(
	`iwl_mvm_mac_˘xt_gë_bóc⁄_Êags
(
mvm
->
fw
,

1608 
øã
));

1609 
bóc⁄_cmd
.
byã_˙t
 = 
	`˝u_to_À16
((
u16
)
bóc⁄
->
Àn
);

1610 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
BEACON_TEMPLATE_CMD
, 0) > 12)

1611 
bóc⁄_cmd
.
lök_id
 =

1612 
	`˝u_to_À32
(
mvmvif
->
lök
[
lök_id
]->
fw_lök_id
);

1614 
bóc⁄_cmd
.
lök_id
 = 
	`˝u_to_À32
((
u32
)
mvmvif
->
id
);

1616 
	`iwl_mvm_mac_˘xt_£t_tim
(
mvm
, &
bóc⁄_cmd
.
tim_idx
,

1617 &
bóc⁄_cmd
.
tim_size
,

1618 
bóc⁄
->
d©a
, bóc⁄->
Àn
);

1620 
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_cmd
(
mvm
, 
bóc⁄
, &
bóc⁄_cmd
,

1621 (
bóc⁄_cmd
));

1623 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1625 
	`dev_k‰ì_skb
(
bóc⁄
);

1629 
out_îr
:

1630 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1631  -
EINVAL
;

1632 
	}
}

1634 
ssize_t
 
	$iwl_dbgfs_öje˘_bóc⁄_õ_wrôe
(
iwl_mvm
 *
mvm
,

1635 *
buf
, 
size_t
 
cou¡
,

1636 
loff_t
 *
µos
)

1638 
ªt
 = 
	`_iwl_dbgfs_öje˘_bóc⁄_õ
(
mvm
, 
buf
, 
cou¡
);

1640 
mvm
->
hw
->
exåa_bóc⁄_èûroom
 = 0;

1641  
ªt
 ?: 
cou¡
;

1642 
	}
}

1644 
ssize_t
 
	$iwl_dbgfs_öje˘_bóc⁄_õ_ª°‹e_wrôe
(
iwl_mvm
 *
mvm
,

1645 *
buf
,

1646 
size_t
 
cou¡
,

1647 
loff_t
 *
µos
)

1649 
ªt
 = 
	`_iwl_dbgfs_öje˘_bóc⁄_õ
(
mvm
, 
NULL
, 0);

1651 
mvm
->
hw
->
exåa_bóc⁄_èûroom
 = 0;

1652 
mvm
->
bóc⁄_öje˘_a˘ive
 = 
Ál£
;

1653  
ªt
 ?: 
cou¡
;

1654 
	}
}

1656 
ssize_t
 
	$iwl_dbgfs_fw_dbg_c⁄f_ªad
(
fûe
 *file,

1657 
__u£r
 *
u£r_buf
,

1658 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1660 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

1661 
c⁄f
;

1662 
buf
[8];

1663 c⁄° 
size_t
 
bufsz
 = (
buf
);

1664 
pos
 = 0;

1666 
	`muãx_lock
(&
mvm
->
muãx
);

1667 
c⁄f
 = 
mvm
->
fwπ
.
dump
.conf;

1668 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1670 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%d\n", 
c⁄f
);

1672  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1673 
	}
}

1675 
ssize_t
 
	$iwl_dbgfs_fw_dbg_c⁄f_wrôe
(
iwl_mvm
 *
mvm
,

1676 *
buf
, 
size_t
 
cou¡
,

1677 
loff_t
 *
µos
)

1679 
c⁄f_id
;

1680 
ªt
;

1682 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1683  -
EIO
;

1685 
ªt
 = 
	`k°πouöt
(
buf
, 0, &
c⁄f_id
);

1686 i‡(
ªt
)

1687  
ªt
;

1689 i‡(
	`WARN_ON
(
c⁄f_id
 >
FW_DBG_CONF_MAX
))

1690  -
EINVAL
;

1692 
	`muãx_lock
(&
mvm
->
muãx
);

1693 
ªt
 = 
	`iwl_fw_°¨t_dbg_c⁄f
(&
mvm
->
fwπ
, 
c⁄f_id
);

1694 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1696  
ªt
 ?: 
cou¡
;

1697 
	}
}

1699 
ssize_t
 
	$iwl_dbgfs_fw_dbg_cﬁÀ˘_wrôe
(
iwl_mvm
 *
mvm
,

1700 *
buf
, 
size_t
 
cou¡
,

1701 
loff_t
 *
µos
)

1703 i‡(
cou¡
 == 0)

1706 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_USER_TRIGGER
,

1707 
NULL
);

1709 
	`iwl_fw_dbg_cﬁÀ˘
(&
mvm
->
fwπ
, 
FW_DBG_TRIGGER_USER
, 
buf
,

1710 (
cou¡
 - 1), 
NULL
);

1712  
cou¡
;

1713 
	}
}

1715 
ssize_t
 
	$iwl_dbgfs_fw_dbg_˛ór_wrôe
(
iwl_mvm
 *
mvm
,

1716 *
buf
, 
size_t
 
cou¡
,

1717 
loff_t
 *
µos
)

1719 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_9000
)

1720  -
EOPNOTSUPP
;

1722 
	`muãx_lock
(&
mvm
->
muãx
);

1723 
	`iwl_fw_dbg_˛ór_m⁄ô‹_buf
(&
mvm
->
fwπ
);

1724 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1726  
cou¡
;

1727 
	}
}

1729 
ssize_t
 
	$iwl_dbgfs_dbg_time_poöt_wrôe
(
iwl_mvm
 *
mvm
,

1730 *
buf
, 
size_t
 
cou¡
,

1731 
loff_t
 *
µos
)

1733 
u32
 
timïoöt
;

1735 i‡(
	`k°πou32
(
buf
, 0, &
timïoöt
))

1736  -
EINVAL
;

1738 i‡(
timïoöt
 =
IWL_FW_INI_TIME_POINT_INVALID
 ||

1739 
timïoöt
 >
IWL_FW_INI_TIME_POINT_NUM
)

1740  -
EINVAL
;

1742 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
timïoöt
, 
NULL
);

1744  
cou¡
;

1745 
	}
}

1747 
	#MVM_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

1748 
	`_MVM_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
iwl_mvm
)

	)

1749 
	#MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

1750 
	`_MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
iwl_mvm
)

	)

1751 
	#MVM_DEBUGFS_ADD_FILE_ALIAS
(
Æüs
, 
«me
, 
∑ª¡
, 
mode
) do { \

1752 
	`debugfs_¸óã_fûe
(
Æüs
, 
mode
, 
∑ª¡
, 
mvm
, \

1753 &
iwl_dbgfs_
##
«me
##
_›s
); \

1754 } 0)

	)

1755 
	#MVM_DEBUGFS_ADD_FILE
(
«me
, 
∑ª¡
, 
mode
) \

1756 
	`MVM_DEBUGFS_ADD_FILE_ALIAS
(#«me, 
«me
, 
∑ª¡
, 
mode
)

	)

1758 
ssize_t


1759 
	$_iwl_dbgfs_lök_°a_wøp_wrôe
(
	$ssize_t
 (*
ªÆ
)(
õì80211_lök_°a
 *,

1760 
iwl_mvm_°a
 *,

1761 
iwl_mvm
 *,

1762 
iwl_mvm_lök_°a
 *,

1764 
size_t
, 
loff_t
 *),

1765 
fûe
 *file,

1766 *
buf
, 
size_t
 
buf_size
, 
loff_t
 *
µos
)

1768 
õì80211_lök_°a
 *
lök_°a
 = 
fûe
->
¥iv©e_d©a
;

1769 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
lök_°a
->
°a
);

1770 
iwl_mvm
 *
mvm
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
)->mvm;

1771 
iwl_mvm_lök_°a
 *
mvm_lök_°a
;

1772 
ssize_t
 
ªt
;

1774 
	`muãx_lock
(&
mvm
->
muãx
);

1776 
mvm_lök_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm°a
->
lök
[
lök_°a
->
lök_id
],

1777 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1778 i‡(
	`WARN_ON
(!
mvm_lök_°a
)) {

1779 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1780  -
ENODEV
;

1783 
ªt
 = 
	`ªÆ
(
lök_°a
, 
mvm°a
, 
mvm
, 
mvm_lök_°a
, 
buf
, 
buf_size
, 
µos
);

1785 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1787  
ªt
;

1788 
	}
}

1790 
ssize_t


1791 
	$_iwl_dbgfs_lök_°a_wøp_ªad
(
	$ssize_t
 (*
ªÆ
)(
õì80211_lök_°a
 *,

1792 
iwl_mvm_°a
 *,

1793 
iwl_mvm
 *,

1794 
iwl_mvm_lök_°a
 *,

1795 
__u£r
 *,

1796 
size_t
, 
loff_t
 *),

1797 
fûe
 *file,

1798 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1800 
õì80211_lök_°a
 *
lök_°a
 = 
fûe
->
¥iv©e_d©a
;

1801 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
lök_°a
->
°a
);

1802 
iwl_mvm
 *
mvm
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
)->mvm;

1803 
iwl_mvm_lök_°a
 *
mvm_lök_°a
;

1804 
ssize_t
 
ªt
;

1806 
	`muãx_lock
(&
mvm
->
muãx
);

1808 
mvm_lök_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm°a
->
lök
[
lök_°a
->
lök_id
],

1809 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1810 i‡(
	`WARN_ON
(!
mvm_lök_°a
)) {

1811 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1812  -
ENODEV
;

1815 
ªt
 = 
	`ªÆ
(
lök_°a
, 
mvm°a
, 
mvm
, 
mvm_lök_°a
, 
u£r_buf
, 
cou¡
, 
µos
);

1817 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1819  
ªt
;

1820 
	}
}

1822 
	#MVM_DEBUGFS_LINK_STA_WRITE_WRAPPER
(
«me
, 
buÊí
) \

1823 
ssize_t
 
_iwl_dbgfs_lök_°a_
##
«me
##
	`_wrôe
(
fûe
 *file, \

1824 c⁄° 
__u£r
 *
u£r_buf
, \

1825 
size_t
 
cou¡
, 
loff_t
 *
µos
) \

1827 
buf
[
buÊí
] = {}; \

1828 
size_t
 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1); \

1830 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
)) \

1831  -
EFAULT
; \

1833  
	`_iwl_dbgfs_lök_°a_wøp_wrôe
(
iwl_dbgfs_
##
«me
##
_wrôe
, \

1834 
fûe
, \

1835 
buf
, 
buf_size
, 
µos
); \

1837 

	)

1838 
	#MVM_DEBUGFS_LINK_STA_READ_WRAPPER
(
«me
) \

1839 
ssize_t
 
_iwl_dbgfs_lök_°a_
##
«me
##
	`_ªad
(
fûe
 *file, \

1840 
__u£r
 *
u£r_buf
, \

1841 
size_t
 
cou¡
, 
loff_t
 *
µos
) \

1843  
	`_iwl_dbgfs_lök_°a_wøp_ªad
(
iwl_dbgfs_
##
«me
##
_ªad
, \

1844 
fûe
, \

1845 
u£r_buf
, 
cou¡
, 
µos
); \

1847 

	)

1848 
	#MVM_DEBUGFS_WRITE_LINK_STA_FILE_OPS
(
«me
, 
bufsz
) \

1849 
	`MVM_DEBUGFS_LINK_STA_WRITE_WRAPPER
(
«me
, 
bufsz
) \

1850 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_lök_°a_
##
«me
##
_›s
 = { \

1851 .
wrôe
 = 
_iwl_dbgfs_lök_°a_
##
«me
##
_wrôe
, \

1852 .
›í
 = 
sim∂e_›í
, \

1853 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

1854 }

	)

1856 
	#MVM_DEBUGFS_READ_LINK_STA_FILE_OPS
(
«me
) \

1857 
	`MVM_DEBUGFS_LINK_STA_READ_WRAPPER
(
«me
) \

1858 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_lök_°a_
##
«me
##
_›s
 = { \

1859 .
ªad
 = 
_iwl_dbgfs_lök_°a_
##
«me
##
_ªad
, \

1860 .
›í
 = 
sim∂e_›í
, \

1861 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

1862 }

	)

1864 
	#MVM_DEBUGFS_READ_WRITE_LINK_STA_FILE_OPS
(
«me
, 
bufsz
) \

1865 
	`MVM_DEBUGFS_LINK_STA_READ_WRAPPER
(
«me
) \

1866 
	`MVM_DEBUGFS_LINK_STA_WRITE_WRAPPER
(
«me
, 
bufsz
) \

1867 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_lök_°a_
##
«me
##
_›s
 = { \

1868 .
ªad
 = 
_iwl_dbgfs_lök_°a_
##
«me
##
_ªad
, \

1869 .
wrôe
 = 
_iwl_dbgfs_lök_°a_
##
«me
##
_wrôe
, \

1870 .
›í
 = 
sim∂e_›í
, \

1871 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

1872 }

	)

1874 
	#MVM_DEBUGFS_ADD_LINK_STA_FILE_ALIAS
(
Æüs
, 
«me
, 
∑ª¡
, 
mode
) \

1875 
	`debugfs_¸óã_fûe
(
Æüs
, 
mode
, 
∑ª¡
, 
lök_°a
, \

1876 &
iwl_dbgfs_lök_°a_
##
«me
##
_›s
)

	)

1877 
	#MVM_DEBUGFS_ADD_LINK_STA_FILE
(
«me
, 
∑ª¡
, 
mode
) \

1878 
	`MVM_DEBUGFS_ADD_LINK_STA_FILE_ALIAS
(#«me, 
«me
, 
∑ª¡
, 
mode
)

	)

1880 
ssize_t


1881 
	$iwl_dbgfs_¥ph_ªg_ªad
(
fûe
 *file,

1882 
__u£r
 *
u£r_buf
,

1883 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1885 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

1886 
pos
 = 0;

1887 
buf
[32];

1888 c⁄° 
size_t
 
bufsz
 = (
buf
);

1890 i‡(!
mvm
->
dbgfs_¥ph_ªg_addr
)

1891  -
EINVAL
;

1893 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Reg 0x%x: (0x%x)\n",

1894 
mvm
->
dbgfs_¥ph_ªg_addr
,

1895 
	`iwl_ªad_¥ph
(
mvm
->
å™s
, mvm->
dbgfs_¥ph_ªg_addr
));

1897  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

1898 
	}
}

1900 
ssize_t


1901 
	$iwl_dbgfs_¥ph_ªg_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

1902 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1904 
u8
 
¨gs
;

1905 
u32
 
vÆue
;

1907 
¨gs
 = 
	`ssˇnf
(
buf
, "%ò%i", &
mvm
->
dbgfs_¥ph_ªg_addr
, &
vÆue
);

1909 i‡(
¨gs
 == 1)

1910 
out
;

1913 i‡(
¨gs
 != 2)

1914  -
EINVAL
;

1916 
	`iwl_wrôe_¥ph
(
mvm
->
å™s
, mvm->
dbgfs_¥ph_ªg_addr
, 
vÆue
);

1918 
out
:

1919  
cou¡
;

1920 
	}
}

1922 
ssize_t


1923 
	$iwl_dbgfs_£nd_echo_cmd_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

1924 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1926 
ªt
;

1928 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1929  -
EIO
;

1931 
	`muãx_lock
(&
mvm
->
muãx
);

1932 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ECHO_CMD
, 0, 0, 
NULL
);

1933 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1935  
ªt
 ?: 
cou¡
;

1936 
	}
}

1938 
	siwl_mvm_¢if„r_≠∂y
 {

1939 
iwl_mvm
 *
	mmvm
;

1940 
u8
 *
	mbssid
;

1941 
u16
 
	maid
;

1944 
boﬁ
 
	$iwl_mvm_¢if„r_≠∂y
(
iwl_nŸif_waô_d©a
 *
nŸif_d©a
,

1945 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

1947 
iwl_mvm_¢if„r_≠∂y
 *
≠∂y
 = 
d©a
;

1949 
≠∂y
->
mvm
->
cur_aid
 = 
	`˝u_to_À16
◊µly->
aid
);

1950 
	`mem˝y
(
≠∂y
->
mvm
->
cur_bssid
,áµly->
bssid
,

1951 (
≠∂y
->
mvm
->
cur_bssid
));

1953  
åue
;

1954 
	}
}

1956 
ssize_t


1957 
	$iwl_dbgfs_he_¢if„r_∑øms_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

1958 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1960 
iwl_nŸifiˇti⁄_waô
 
waô
;

1961 
iwl_he_m⁄ô‹_cmd
 
he_m⁄_cmd
 = {};

1962 
iwl_mvm_¢if„r_≠∂y
 
≠∂y
 = {

1963 .
mvm
 = mvm,

1965 
u16
 
waô_cmds
[] = {

1966 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
HE_AIR_SNIFFER_CONFIG_CMD
),

1968 
u32
 
aid
;

1969 
ªt
;

1971 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

1972  -
EIO
;

1974 
ªt
 = 
	`ssˇnf
(
buf
, "%x %2hhx:%2hhx:%2hhx:%2hhx:%2hhx:%2hhx", &
aid
,

1975 &
he_m⁄_cmd
.
bssid
[0], &he_mon_cmd.bssid[1],

1976 &
he_m⁄_cmd
.
bssid
[2], &he_mon_cmd.bssid[3],

1977 &
he_m⁄_cmd
.
bssid
[4], &he_mon_cmd.bssid[5]);

1978 i‡(
ªt
 != 7)

1979  -
EINVAL
;

1981 
he_m⁄_cmd
.
aid
 = 
	`˝u_to_À16
(aid);

1983 
≠∂y
.
aid
 =áid;

1984 
≠∂y
.
bssid
 = (*)
he_m⁄_cmd
.bssid;

1986 
	`muãx_lock
(&
mvm
->
muãx
);

1997 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô
,

1998 
waô_cmds
, 
	`ARRAY_SIZE
(wait_cmds),

1999 
iwl_mvm_¢if„r_≠∂y
, &
≠∂y
);

2001 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

2002 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
HE_AIR_SNIFFER_CONFIG_CMD
),

2004 (
he_m⁄_cmd
), &he_mon_cmd);

2007 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô
);

2009 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2011  
ªt
 ?: 
cou¡
;

2012 
	}
}

2014 
ssize_t


2015 
	$iwl_dbgfs_he_¢if„r_∑øms_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

2016 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2018 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

2019 
u8
 
buf
[32];

2020 
Àn
;

2022 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

2024 
	`À16_to_˝u
(
mvm
->
cur_aid
), mvm->
cur_bssid
[0],

2025 
mvm
->
cur_bssid
[1], mvm->cur_bssid[2], mvm->cur_bssid[3],

2026 
mvm
->
cur_bssid
[4], mvm->cur_bssid[5]);

2028  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2029 
	}
}

2031 
ssize_t


2032 
	$iwl_dbgfs_u≠sd_nﬂgg_bssids_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

2033 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2035 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

2036 
u8
 
buf
[
IWL_MVM_UAPSD_NOAGG_BSSIDS_NUM
 * 
ETH_ALEN
 * 3 + 1];

2037 
pos
 = 0;

2038 
size_t
 
bufsz
 = (
buf
);

2039 
i
;

2041 
	`muãx_lock
(&
mvm
->
muãx
);

2043 
i
 = 0; i < 
IWL_MVM_UAPSD_NOAGG_LIST_LEN
; i++)

2044 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "%pM\n",

2045 
mvm
->
u≠sd_nﬂgg_bssids
[
i
].
addr
);

2047 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2049  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2050 
	}
}

2052 
ssize_t


2053 
	$iwl_dbgfs_…r_c⁄fig_wrôe
(
iwl_mvm
 *
mvm
,

2054 *
buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2056 
ªt
;

2057 
iwl_…r_c⁄fig_cmd
 
…r_c⁄fig
 = {0};

2059 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

2060  -
EIO
;

2062 i‡(
	`ssˇnf
(
buf
, "%x,%x,%x,%x,%x,%x,%x",

2063 &
…r_c⁄fig
.
Êags
,

2064 &
…r_c⁄fig
.
°©ic_l⁄g
,

2065 &
…r_c⁄fig
.
°©ic_sh‹t
,

2066 &
…r_c⁄fig
.
…r_cfg_vÆues
[0],

2067 &
…r_c⁄fig
.
…r_cfg_vÆues
[1],

2068 &
…r_c⁄fig
.
…r_cfg_vÆues
[2],

2069 &
…r_c⁄fig
.
…r_cfg_vÆues
[3]) != 7) {

2070  -
EINVAL
;

2073 
	`muãx_lock
(&
mvm
->
muãx
);

2074 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
LTR_CONFIG
, 0, (
…r_c⁄fig
),

2075 &
…r_c⁄fig
);

2076 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2078 i‡(
ªt
)

2079 
	`IWL_ERR
(
mvm
, "failedÅo sendÜtr configuration cmd\n");

2081  
ªt
 ?: 
cou¡
;

2082 
	}
}

2084 
ssize_t
 
	$iwl_dbgfs_rfi_‰eq_èbÀ_wrôe
(
iwl_mvm
 *
mvm
, *
buf
,

2085 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2087 
ªt
 = 0;

2088 
u16
 
›_id
;

2090 i‡(
	`k°πou16
(
buf
, 10, &
›_id
))

2091  -
EINVAL
;

2094 i‡(!
›_id
) {

2095 
	`muãx_lock
(&
mvm
->
muãx
);

2096 
ªt
 = 
	`iwl_rfi_£nd_c⁄fig_cmd
(
mvm
, 
NULL
);

2097 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2099 
ªt
 = -
EOPNOTSUPP
;

2102  
ªt
 ?: 
cou¡
;

2103 
	}
}

2110 
	#IWL_RFI_BUF_SIZE
 (
IWL_RFI_LUT_INSTALLED_SIZE
 *\

2111 (5 + 
IWL_RFI_LUT_ENTRY_CHANNELS_NUM
 * (6 + 5)))

	)

2113 
ssize_t
 
	$iwl_dbgfs_rfi_‰eq_èbÀ_ªad
(
fûe
 *file,

2114 
__u£r
 *
u£r_buf
,

2115 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2117 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

2118 
iwl_rfi_‰eq_èbÀ_ª•_cmd
 *
ª•
;

2119 
u32
 
°©us
;

2120 
buf
[
IWL_RFI_BUF_SIZE
];

2121 
i
, 
j
, 
pos
 = 0;

2123 
ª•
 = 
	`iwl_rfi_gë_‰eq_èbÀ
(
mvm
);

2124 i‡(
	`IS_ERR
(
ª•
))

2125  
	`PTR_ERR
(
ª•
);

2127 
°©us
 = 
	`À32_to_˝u
(
ª•
->status);

2128 i‡(
°©us
 !
RFI_FREQ_TABLE_OK
) {

2129 
	`s˙¥ötf
(
buf
, 
IWL_RFI_BUF_SIZE
, "°©u†%d\n", 
°©us
);

2130 
out
;

2133 
i
 = 0; i < 
	`ARRAY_SIZE
(
ª•
->
èbÀ
); i++) {

2134 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
IWL_RFI_BUF_SIZE
 -Öos, "%d: ",

2135 
ª•
->
èbÀ
[
i
].
‰eq
);

2137 
j
 = 0; j < 
	`ARRAY_SIZE
(
ª•
->
èbÀ
[
i
].
ch™√ls
); j++)

2138 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
IWL_RFI_BUF_SIZE
 -Öos,

2140 
ª•
->
èbÀ
[
i
].
ch™√ls
[
j
],

2141 
ª•
->
èbÀ
[
i
].
b™ds
[
j
]);

2142 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
IWL_RFI_BUF_SIZE
 -Öos, "\n");

2145 
out
:

2146 
	`k‰ì
(
ª•
);

2147  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2148 
	}
}

2150 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
¥ph_ªg
, 64);

2153 
MVM_DEBUGFS_READ_FILE_OPS
(
˘dp_budgë
);

2154 
MVM_DEBUGFS_WRITE_FILE_OPS
(
°›_˘dp
, 8);

2155 
MVM_DEBUGFS_WRITE_FILE_OPS
(
°¨t_˘dp
, 8);

2156 
MVM_DEBUGFS_WRITE_FILE_OPS
(
f‹˚_˘kûl
, 8);

2157 
MVM_DEBUGFS_WRITE_FILE_OPS
(
tx_Êush
, 16);

2158 
MVM_DEBUGFS_WRITE_FILE_OPS
(
°a_døö
, 8);

2159 
MVM_DEBUGFS_WRITE_FILE_OPS
(
£nd_echo_cmd
, 8);

2160 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
§am
, 64);

2161 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
£t_nic_ãm≥øtuª
, 64);

2162 
MVM_DEBUGFS_READ_FILE_OPS
(
nic_ãmp
);

2163 
MVM_DEBUGFS_READ_FILE_OPS
(
°©i⁄s
);

2164 
MVM_DEBUGFS_READ_LINK_STA_FILE_OPS
(
rs_d©a
);

2165 
MVM_DEBUGFS_READ_FILE_OPS
(
bt_nŸif
);

2166 
MVM_DEBUGFS_READ_FILE_OPS
(
bt_cmd
);

2167 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
dißbÀ_powî_off
, 64);

2168 
MVM_DEBUGFS_READ_FILE_OPS
(
fw_rx_°©s
);

2169 
MVM_DEBUGFS_READ_FILE_OPS
(
drv_rx_°©s
);

2170 
MVM_DEBUGFS_READ_FILE_OPS
(
fw_sy°em_°©s
);

2171 
MVM_DEBUGFS_READ_FILE_OPS
(
fw_vî
);

2172 
MVM_DEBUGFS_READ_FILE_OPS
(
phy_öãgøti⁄_vî
);

2173 
MVM_DEBUGFS_READ_FILE_OPS
(
ès_gë_°©us
);

2174 
MVM_DEBUGFS_WRITE_FILE_OPS
(
fw_ª°¨t
, 10);

2175 
MVM_DEBUGFS_WRITE_FILE_OPS
(
fw_nmi
, 10);

2176 
MVM_DEBUGFS_WRITE_FILE_OPS
(
bt_tx_¥io
, 10);

2177 
MVM_DEBUGFS_WRITE_FILE_OPS
(
bt_f‹˚_™t
, 10);

2178 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
sˇn_™t_rxchaö
, 8);

2179 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
fw_dbg_c⁄f
, 8);

2180 
MVM_DEBUGFS_WRITE_FILE_OPS
(
fw_dbg_cﬁÀ˘
, 64);

2181 
MVM_DEBUGFS_WRITE_FILE_OPS
(
fw_dbg_˛ór
, 64);

2182 
MVM_DEBUGFS_WRITE_FILE_OPS
(
dbg_time_poöt
, 64);

2183 
MVM_DEBUGFS_WRITE_FILE_OPS
(
ödúe˘i⁄_tbl
,

2184 (
IWL_RSS_INDIRECTION_TABLE_SIZE
 * 2));

2185 
MVM_DEBUGFS_WRITE_FILE_OPS
(
öje˘_∑ckë
, 512);

2186 
MVM_DEBUGFS_WRITE_FILE_OPS
(
öje˘_bóc⁄_õ
, 512);

2187 
MVM_DEBUGFS_WRITE_FILE_OPS
(
öje˘_bóc⁄_õ_ª°‹e
, 512);

2189 
MVM_DEBUGFS_READ_FILE_OPS
(
u≠sd_nﬂgg_bssids
);

2191 #ifde‡
CONFIG_ACPI


2192 
MVM_DEBUGFS_READ_FILE_OPS
(
ßr_geo_¥ofûe
);

2193 
MVM_DEBUGFS_READ_FILE_OPS
(
wifi_6e_íabÀ
);

2196 
MVM_DEBUGFS_READ_WRITE_LINK_STA_FILE_OPS
(
amsdu_Àn
, 16);

2198 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
he_¢if„r_∑øms
, 32);

2200 
MVM_DEBUGFS_WRITE_FILE_OPS
(
…r_c⁄fig
, 512);

2201 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
rfi_‰eq_èbÀ
, 16);

2203 
ssize_t
 
	$iwl_dbgfs_mem_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

2204 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2206 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

2207 
iwl_dbg_mem_ac˚ss_cmd
 
cmd
 = {};

2208 
iwl_dbg_mem_ac˚ss_r•
 *
r•
;

2209 
iwl_ho°_cmd
 
hcmd
 = {

2210 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
,

2211 .
d©a
 = { &
cmd
, },

2212 .
Àn
 = { (
cmd
) },

2214 
size_t
 
dñè
;

2215 
ssize_t
 
ªt
, 
Àn
;

2217 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

2218  -
EIO
;

2220 
hcmd
.
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, *
µos
 >> 24 ? 
UMAC_RD_WR
 : 
LMAC_RD_WR
);

2221 
cmd
.
›
 = 
	`˝u_to_À32
(
DEBUG_MEM_OP_READ
);

2224 
dñè
 = *
µos
 & 0x3;

2225 
cmd
.
addr
 = 
	`˝u_to_À32
(*
µos
 - 
dñè
);

2226 
cmd
.
Àn
 = 
	`˝u_to_À32
(
	`mö
(
	`ALIGN
(
cou¡
 + 
dñè
, 4) / 4,

2227 (
size_t
)
DEBUG_MEM_MAX_SIZE_DWORDS
));

2229 
	`muãx_lock
(&
mvm
->
muãx
);

2230 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

2231 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2233 i‡(
ªt
 < 0)

2234  
ªt
;

2236 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
hcmd
.
ª•_pkt
Ë< (*
r•
)) {

2237 
ªt
 = -
EIO
;

2238 
out
;

2241 
r•
 = (*)
hcmd
.
ª•_pkt
->
d©a
;

2242 i‡(
	`À32_to_˝u
(
r•
->
°©us
Ë!
DEBUG_MEM_STATUS_SUCCESS
) {

2243 
ªt
 = -
ENXIO
;

2244 
out
;

2247 
Àn
 = 
	`mö
((
size_t
)
	`À32_to_˝u
(
r•
->len) << 2,

2248 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
hcmd
.
ª•_pkt
Ë- (*
r•
));

2249 
Àn
 = 
	`mö
÷í - 
dñè
, 
cou¡
);

2250 i‡(
Àn
 < 0) {

2251 
ªt
 = -
EFAULT
;

2252 
out
;

2255 
ªt
 = 
Àn
 - 
	`c›y_to_u£r
(
u£r_buf
, (
u8
 *)
r•
->
d©a
 + 
dñè
,Üen);

2256 *
µos
 +
ªt
;

2258 
out
:

2259 
	`iwl_‰ì_ª•
(&
hcmd
);

2260  
ªt
;

2261 
	}
}

2263 
ssize_t
 
	$iwl_dbgfs_mem_wrôe
(
fûe
 *file,

2264 c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

2265 
loff_t
 *
µos
)

2267 
iwl_mvm
 *
mvm
 = 
fûe
->
¥iv©e_d©a
;

2268 
iwl_dbg_mem_ac˚ss_cmd
 *
cmd
;

2269 
iwl_dbg_mem_ac˚ss_r•
 *
r•
;

2270 
iwl_ho°_cmd
 
hcmd
 = {};

2271 
size_t
 
cmd_size
;

2272 
size_t
 
d©a_size
;

2273 
u32
 
›
, 
Àn
;

2274 
ssize_t
 
ªt
;

2276 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

2277  -
EIO
;

2279 
hcmd
.
id
 = 
	`WIDE_ID
(
DEBUG_GROUP
, *
µos
 >> 24 ? 
UMAC_RD_WR
 : 
LMAC_RD_WR
);

2281 i‡(*
µos
 & 0x3 || 
cou¡
 < 4) {

2282 
›
 = 
DEBUG_MEM_OP_WRITE_BYTES
;

2283 
Àn
 = 
	`mö
(
cou¡
, (
size_t
)(4 - (*
µos
 & 0x3)));

2284 
d©a_size
 = 
Àn
;

2286 
›
 = 
DEBUG_MEM_OP_WRITE
;

2287 
Àn
 = 
	`mö
(
cou¡
 >> 2, (
size_t
)
DEBUG_MEM_MAX_SIZE_DWORDS
);

2288 
d©a_size
 = 
Àn
 << 2;

2291 
cmd_size
 = (*
cmd
Ë+ 
	`ALIGN
(
d©a_size
, 4);

2292 
cmd
 = 
	`kzÆloc
(
cmd_size
, 
GFP_KERNEL
);

2293 i‡(!
cmd
)

2294  -
ENOMEM
;

2296 
cmd
->
›
 = 
	`˝u_to_À32
(op);

2297 
cmd
->
Àn
 = 
	`˝u_to_À32
(len);

2298 
cmd
->
addr
 = 
	`˝u_to_À32
(*
µos
);

2299 i‡(
	`c›y_‰om_u£r
((*)
cmd
->
d©a
, 
u£r_buf
, 
d©a_size
)) {

2300 
	`k‰ì
(
cmd
);

2301  -
EFAULT
;

2304 
hcmd
.
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
,

2305 
hcmd
.
d©a
[0] = (*)
cmd
;

2306 
hcmd
.
Àn
[0] = 
cmd_size
;

2308 
	`muãx_lock
(&
mvm
->
muãx
);

2309 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

2310 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2312 
	`k‰ì
(
cmd
);

2314 i‡(
ªt
 < 0)

2315  
ªt
;

2317 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
hcmd
.
ª•_pkt
Ë< (*
r•
)) {

2318 
ªt
 = -
EIO
;

2319 
out
;

2322 
r•
 = (*)
hcmd
.
ª•_pkt
->
d©a
;

2323 i‡(
r•
->
°©us
 !
DEBUG_MEM_STATUS_SUCCESS
) {

2324 
ªt
 = -
ENXIO
;

2325 
out
;

2328 
ªt
 = 
d©a_size
;

2329 *
µos
 +
ªt
;

2331 
out
:

2332 
	`iwl_‰ì_ª•
(&
hcmd
);

2333  
ªt
;

2334 
	}
}

2336 c⁄° 
fûe_›î©i⁄s
 
	giwl_dbgfs_mem_›s
 = {

2337 .
ªad
 = 
iwl_dbgfs_mem_ªad
,

2338 .
	gwrôe
 = 
iwl_dbgfs_mem_wrôe
,

2339 .
	g›í
 = 
sim∂e_›í
,

2340 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2343 
	$iwl_mvm_lök_°a_add_debugfs
(
õì80211_hw
 *
hw
,

2344 
õì80211_vif
 *
vif
,

2345 
õì80211_lök_°a
 *
lök_°a
,

2346 
díåy
 *
dú
)

2348 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

2350 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

2352 i‡(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)) {

2353 
	`MVM_DEBUGFS_ADD_LINK_STA_FILE
(
rs_d©a
, 
dú
, 0400);

2356 
	`MVM_DEBUGFS_ADD_LINK_STA_FILE
(
amsdu_Àn
, 
dú
, 0600);

2357 
	}
}

2359 
	$iwl_mvm_dbgfs_ªgi°î
(
iwl_mvm
 *
mvm
)

2361 
díåy
 *
bˇ°_dú
 
__maybe_unu£d
;

2363 
	`•ö_lock_öô
(&
mvm
->
drv_°©s_lock
);

2365 
	`MVM_DEBUGFS_ADD_FILE
(
tx_Êush
, 
mvm
->
debugfs_dú
, 0200);

2366 
	`MVM_DEBUGFS_ADD_FILE
(
°a_døö
, 
mvm
->
debugfs_dú
, 0200);

2367 
	`MVM_DEBUGFS_ADD_FILE
(
§am
, 
mvm
->
debugfs_dú
, 0600);

2368 
	`MVM_DEBUGFS_ADD_FILE
(
£t_nic_ãm≥øtuª
, 
mvm
->
debugfs_dú
, 0600);

2369 
	`MVM_DEBUGFS_ADD_FILE
(
nic_ãmp
, 
mvm
->
debugfs_dú
, 0400);

2370 
	`MVM_DEBUGFS_ADD_FILE
(
˘dp_budgë
, 
mvm
->
debugfs_dú
, 0400);

2371 
	`MVM_DEBUGFS_ADD_FILE
(
°›_˘dp
, 
mvm
->
debugfs_dú
, 0200);

2372 
	`MVM_DEBUGFS_ADD_FILE
(
°¨t_˘dp
, 
mvm
->
debugfs_dú
, 0200);

2373 
	`MVM_DEBUGFS_ADD_FILE
(
f‹˚_˘kûl
, 
mvm
->
debugfs_dú
, 0200);

2374 
	`MVM_DEBUGFS_ADD_FILE
(
°©i⁄s
, 
mvm
->
debugfs_dú
, 0400);

2375 
	`MVM_DEBUGFS_ADD_FILE
(
bt_nŸif
, 
mvm
->
debugfs_dú
, 0400);

2376 
	`MVM_DEBUGFS_ADD_FILE
(
bt_cmd
, 
mvm
->
debugfs_dú
, 0400);

2377 
	`MVM_DEBUGFS_ADD_FILE
(
dißbÀ_powî_off
, 
mvm
->
debugfs_dú
, 0600);

2378 
	`MVM_DEBUGFS_ADD_FILE
(
fw_vî
, 
mvm
->
debugfs_dú
, 0400);

2379 
	`MVM_DEBUGFS_ADD_FILE
(
fw_rx_°©s
, 
mvm
->
debugfs_dú
, 0400);

2380 
	`MVM_DEBUGFS_ADD_FILE
(
drv_rx_°©s
, 
mvm
->
debugfs_dú
, 0400);

2381 
	`MVM_DEBUGFS_ADD_FILE
(
fw_sy°em_°©s
, 
mvm
->
debugfs_dú
, 0400);

2382 
	`MVM_DEBUGFS_ADD_FILE
(
fw_ª°¨t
, 
mvm
->
debugfs_dú
, 0200);

2383 
	`MVM_DEBUGFS_ADD_FILE
(
fw_nmi
, 
mvm
->
debugfs_dú
, 0200);

2384 
	`MVM_DEBUGFS_ADD_FILE
(
bt_tx_¥io
, 
mvm
->
debugfs_dú
, 0200);

2385 
	`MVM_DEBUGFS_ADD_FILE
(
bt_f‹˚_™t
, 
mvm
->
debugfs_dú
, 0200);

2386 
	`MVM_DEBUGFS_ADD_FILE
(
sˇn_™t_rxchaö
, 
mvm
->
debugfs_dú
, 0600);

2387 
	`MVM_DEBUGFS_ADD_FILE
(
¥ph_ªg
, 
mvm
->
debugfs_dú
, 0600);

2388 
	`MVM_DEBUGFS_ADD_FILE
(
fw_dbg_c⁄f
, 
mvm
->
debugfs_dú
, 0600);

2389 
	`MVM_DEBUGFS_ADD_FILE
(
fw_dbg_cﬁÀ˘
, 
mvm
->
debugfs_dú
, 0200);

2390 
	`MVM_DEBUGFS_ADD_FILE
(
fw_dbg_˛ór
, 
mvm
->
debugfs_dú
, 0200);

2391 
	`MVM_DEBUGFS_ADD_FILE
(
dbg_time_poöt
, 
mvm
->
debugfs_dú
, 0200);

2392 
	`MVM_DEBUGFS_ADD_FILE
(
£nd_echo_cmd
, 
mvm
->
debugfs_dú
, 0200);

2393 
	`MVM_DEBUGFS_ADD_FILE
(
ödúe˘i⁄_tbl
, 
mvm
->
debugfs_dú
, 0200);

2394 
	`MVM_DEBUGFS_ADD_FILE
(
öje˘_∑ckë
, 
mvm
->
debugfs_dú
, 0200);

2395 
	`MVM_DEBUGFS_ADD_FILE
(
öje˘_bóc⁄_õ
, 
mvm
->
debugfs_dú
, 0200);

2396 
	`MVM_DEBUGFS_ADD_FILE
(
öje˘_bóc⁄_õ_ª°‹e
, 
mvm
->
debugfs_dú
, 0200);

2397 
	`MVM_DEBUGFS_ADD_FILE
(
rfi_‰eq_èbÀ
, 
mvm
->
debugfs_dú
, 0600);

2399 i‡(
mvm
->
fw
->
phy_öãgøti⁄_vî
)

2400 
	`MVM_DEBUGFS_ADD_FILE
(
phy_öãgøti⁄_vî
, 
mvm
->
debugfs_dú
, 0400);

2401 
	`MVM_DEBUGFS_ADD_FILE
(
ès_gë_°©us
, 
mvm
->
debugfs_dú
, 0400);

2402 #ifde‡
CONFIG_ACPI


2403 
	`MVM_DEBUGFS_ADD_FILE
(
ßr_geo_¥ofûe
, 
mvm
->
debugfs_dú
, 0400);

2404 
	`MVM_DEBUGFS_ADD_FILE
(
wifi_6e_íabÀ
, 
mvm
->
debugfs_dú
, 0400);

2406 
	`MVM_DEBUGFS_ADD_FILE
(
he_¢if„r_∑øms
, 
mvm
->
debugfs_dú
, 0600);

2408 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_SET_LTR_GEN2
))

2409 
	`MVM_DEBUGFS_ADD_FILE
(
…r_c⁄fig
, 
mvm
->
debugfs_dú
, 0200);

2411 
	`debugfs_¸óã_boﬁ
("enable_scan_iteration_notif", 0600,

2412 
mvm
->
debugfs_dú
, &mvm->
sˇn_ôî_nŸif_íabÀd
);

2413 
	`debugfs_¸óã_boﬁ
("dr›_b˙_≠_mode", 0600, 
mvm
->
debugfs_dú
,

2414 &
mvm
->
dr›_b˙_≠_mode
);

2416 
	`MVM_DEBUGFS_ADD_FILE
(
u≠sd_nﬂgg_bssids
, 
mvm
->
debugfs_dú
, 
S_IRUSR
);

2418 #ifde‡
CONFIG_PM_SLEEP


2419 
	`MVM_DEBUGFS_ADD_FILE
(
d3_ã°
, 
mvm
->
debugfs_dú
, 0400);

2420 
	`debugfs_¸óã_boﬁ
("d3_wake_syßs£π", 0600, 
mvm
->
debugfs_dú
,

2421 &
mvm
->
d3_wake_syßs£π
);

2422 
	`debugfs_¸óã_u32
("œ°_√tdëe˘_sˇns", 0400, 
mvm
->
debugfs_dú
,

2423 &
mvm
->
œ°_√tdëe˘_sˇns
);

2426 
	`debugfs_¸óã_u8
("ps_dißbÀd", 0400, 
mvm
->
debugfs_dú
,

2427 &
mvm
->
ps_dißbÀd
);

2428 
	`debugfs_¸óã_blob
("nvm_hw", 0400, 
mvm
->
debugfs_dú
,

2429 &
mvm
->
nvm_hw_blob
);

2430 
	`debugfs_¸óã_blob
("nvm_sw", 0400, 
mvm
->
debugfs_dú
,

2431 &
mvm
->
nvm_sw_blob
);

2432 
	`debugfs_¸óã_blob
("nvm_ˇlib", 0400, 
mvm
->
debugfs_dú
,

2433 &
mvm
->
nvm_ˇlib_blob
);

2434 
	`debugfs_¸óã_blob
("nvm_¥od", 0400, 
mvm
->
debugfs_dú
,

2435 &
mvm
->
nvm_¥od_blob
);

2436 
	`debugfs_¸óã_blob
("nvm_phy_sku", 0400, 
mvm
->
debugfs_dú
,

2437 &
mvm
->
nvm_phy_sku_blob
);

2438 
	`debugfs_¸óã_blob
("nvm_ªg", 
S_IRUSR
,

2439 
mvm
->
debugfs_dú
, &mvm->
nvm_ªg_blob
);

2441 
	`debugfs_¸óã_fûe
("mem", 0600, 
mvm
->
debugfs_dú
, mvm,

2442 &
iwl_dbgfs_mem_›s
);

2448 i‡(!
	`IS_ERR
(
mvm
->
debugfs_dú
)) {

2449 
buf
[100];

2451 
	`¢¥ötf
(
buf
, 100, "../../%pd2", 
mvm
->
debugfs_dú
->
d_∑ª¡
);

2452 
	`debugfs_¸óã_symlök
("iwlwifi", 
mvm
->
hw
->
wùhy
->
debugfsdú
,

2453 
buf
);

2455 
	}
}

	@mvm/debugfs.h

7 
	#MVM_DEBUGFS_READ_FILE_OPS
(
«me
) \

8 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

9 .
ªad
 = 
iwl_dbgfs_
##
«me
##
_ªad
, \

10 .
›í
 = 
sim∂e_›í
, \

11 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

12 }

	)

14 
	#MVM_DEBUGFS_WRITE_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

15 
ssize_t
 
_iwl_dbgfs_
##
«me
##
	`_wrôe
(
fûe
 *file, \

16 c⁄° 
__u£r
 *
u£r_buf
, \

17 
size_t
 
cou¡
, 
loff_t
 *
µos
) \

19 
¨gty≥
 *
¨g
 = 
fûe
->
¥iv©e_d©a
; \

20 
buf
[
buÊí
] = {}; \

21 
size_t
 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1); \

23 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
)) \

24  -
EFAULT
; \

26  
iwl_dbgfs_
##
«me
##
	`_wrôe
(
¨g
, 
buf
, 
buf_size
, 
µos
); \

28 

	)

29 
	#_MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
buÊí
, 
¨gty≥
) \

30 
	`MVM_DEBUGFS_WRITE_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

31 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

32 .
wrôe
 = 
_iwl_dbgfs_
##
«me
##
_wrôe
, \

33 .
ªad
 = 
iwl_dbgfs_
##
«me
##
_ªad
, \

34 .
›í
 = 
sim∂e_›í
, \

35 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

36 };

	)

38 
	#_MVM_DEBUGFS_WRITE_FILE_OPS
(
«me
, 
buÊí
, 
¨gty≥
) \

39 
	`MVM_DEBUGFS_WRITE_WRAPPER
(
«me
, 
buÊí
, 
¨gty≥
) \

40 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

41 .
wrôe
 = 
_iwl_dbgfs_
##
«me
##
_wrôe
, \

42 .
›í
 = 
sim∂e_›í
, \

43 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

44 };

	)

	@mvm/ftm-initiator.c

6 
	~<löux/ëhîdevi˚.h
>

7 
	~<löux/m©h64.h
>

8 
	~<√t/cfg80211.h
>

9 
	~"mvm.h
"

10 
	~"iwl-io.h
"

11 
	~"iwl-¥ph.h
"

12 
	~"c⁄°™ts.h
"

14 
	siwl_mvm_loc_íåy
 {

15 
li°_hód
 
	mli°
;

16 
u8
 
	maddr
[
ETH_ALEN
];

17 
u8
 
	mlci_Àn
, 
	mcivic_Àn
;

18 
u8
 
	mbuf
[];

21 
	siwl_mvm_smoŸh_íåy
 {

22 
li°_hód
 
	mli°
;

23 
u8
 
	maddr
[
ETH_ALEN
];

24 
s64
 
	mπt_avg
;

25 
u64
 
	mho°_time
;

28 
	eiwl_mvm_∑¢_Êags
 {

29 
	mIWL_MVM_PASN_FLAG_HAS_HLTK
 = 
BIT
(0),

32 
	siwl_mvm_·m_∑¢_íåy
 {

33 
li°_hód
 
	mli°
;

34 
u8
 
	maddr
[
ETH_ALEN
];

35 
u8
 
	mh…k
[
HLTK_11AZ_LEN
];

36 
u8
 
	mtk
[
TK_11AZ_LEN
];

37 
u8
 
	mcùhî
;

38 
u8
 
	mtx_≤
[
IEEE80211_CCMP_PN_LEN
];

39 
u8
 
	mrx_≤
[
IEEE80211_CCMP_PN_LEN
];

40 
u32
 
	mÊags
;

43 
	$iwl_mvm_·m_add_∑¢_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

44 
u8
 *
addr
, 
u32
 
cùhî
, u8 *
tk
, u32 
tk_Àn
,

45 
u8
 *
h…k
, 
u32
 
h…k_Àn
)

47 
iwl_mvm_·m_∑¢_íåy
 *
∑¢
 = 
	`kzÆloc
((*pasn),

48 
GFP_KERNEL
);

49 
u32
 
ex≥˘ed_tk_Àn
;

51 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

53 i‡(!
∑¢
)

54  -
ENOBUFS
;

56 
	`iwl_mvm_·m_ªmove_∑¢_°a
(
mvm
, 
addr
);

58 
∑¢
->
cùhî
 = 
	`iwl_mvm_cùhî_to_loˇti⁄_cùhî
(cipher);

60 
∑¢
->
cùhî
) {

61 
IWL_LOCATION_CIPHER_CCMP_128
:

62 
IWL_LOCATION_CIPHER_GCMP_128
:

63 
ex≥˘ed_tk_Àn
 = 
WLAN_KEY_LEN_CCMP
;

65 
IWL_LOCATION_CIPHER_GCMP_256
:

66 
ex≥˘ed_tk_Àn
 = 
WLAN_KEY_LEN_GCMP_256
;

69 
out
;

77 i‡(
vif
->
cfg
.
assoc
) {

78 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

79 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

80 
lök_id
;

81 
õì80211_°a
 *
°a
;

82 
u8
 
°a_id
;

84 
	`rcu_ªad_lock
();

85 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
) {

86 i‡(
	`memcmp
(
addr
, 
lök_c⁄f
->
bssid
, 
ETH_ALEN
))

89 
°a_id
 = 
mvmvif
->
lök
[
lök_id
]->
≠_°a_id
;

90 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

91 i‡(!
	`IS_ERR_OR_NULL
(
°a
Ë&& sè->
mÂ
)

92 
ex≥˘ed_tk_Àn
 = 0;

95 
	`rcu_ªad_u∆ock
();

98 i‡(
tk_Àn
 !
ex≥˘ed_tk_Àn
 ||

99 (
h…k_Àn
 && h…k_À¿!(
∑¢
->
h…k
))) {

100 
	`IWL_ERR
(
mvm
, "Invalid keyÜength:Åk_len=%u hltk_len=%u\n",

101 
tk_Àn
, 
h…k_Àn
);

102 
out
;

105 i‡(!
ex≥˘ed_tk_Àn
 && !
h…k_Àn
) {

106 
	`IWL_ERR
(
mvm
, "TKánd HLTKÇot set\n");

107 
out
;

110 
	`mem˝y
(
∑¢
->
addr
,áddr, (pasn->addr));

112 i‡(
h…k_Àn
) {

113 
	`mem˝y
(
∑¢
->
h…k
, hltk, (pasn->hltk));

114 
∑¢
->
Êags
 |
IWL_MVM_PASN_FLAG_HAS_HLTK
;

117 i‡(
tk
 && 
tk_Àn
)

118 
	`mem˝y
(
∑¢
->
tk
,Åk, (pasn->tk));

120 
	`li°_add_èû
(&
∑¢
->
li°
, &
mvm
->
·m_öôüt‹
.
∑¢_li°
);

122 
out
:

123 
	`k‰ì
(
∑¢
);

124  -
EINVAL
;

125 
	}
}

127 
	$iwl_mvm_·m_ªmove_∑¢_°a
(
iwl_mvm
 *
mvm
, 
u8
 *
addr
)

129 
iwl_mvm_·m_∑¢_íåy
 *
íåy
, *
¥ev
;

131 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

133 
	`li°_f‹_óch_íåy_ß„
(
íåy
, 
¥ev
, &
mvm
->
·m_öôüt‹
.
∑¢_li°
,

134 
li°
) {

135 i‡(
	`memcmp
(
íåy
->
addr
,áddr, (entry->addr)))

138 
	`li°_dñ
(&
íåy
->
li°
);

139 
	`k‰ì
(
íåy
);

142 
	}
}

144 
	$iwl_mvm_·m_ª£t
(
iwl_mvm
 *
mvm
)

146 
iwl_mvm_loc_íåy
 *
e
, *
t
;

148 
mvm
->
·m_öôüt‹
.
ªq
 = 
NULL
;

149 
mvm
->
·m_öôüt‹
.
ªq_wdev
 = 
NULL
;

150 
	`mem£t
(
mvm
->
·m_öôüt‹
.
ª•⁄£s
, 0,

151 (
mvm
->
·m_öôüt‹
.
ª•⁄£s
));

153 
	`li°_f‹_óch_íåy_ß„
(
e
, 
t
, &
mvm
->
·m_öôüt‹
.
loc_li°
, 
li°
) {

154 
	`li°_dñ
(&
e
->
li°
);

155 
	`k‰ì
(
e
);

157 
	}
}

159 
	$iwl_mvm_·m_ª°¨t
(
iwl_mvm
 *
mvm
)

161 
cfg80211_pm§_ªsu…
 
ªsu…
 = {

162 .
°©us
 = 
NL80211_PMSR_STATUS_FAILURE
,

163 .
föÆ
 = 1,

164 .
ho°_time
 = 
	`ktime_gë_boŸtime_ns
(),

165 .
ty≥
 = 
NL80211_PMSR_TYPE_FTM
,

167 
i
;

169 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

171 i‡(!
mvm
->
·m_öôüt‹
.
ªq
)

174 
i
 = 0; i < 
mvm
->
·m_öôüt‹
.
ªq
->
n_≥îs
; i++) {

175 
	`mem˝y
(
ªsu…
.
addr
, 
mvm
->
·m_öôüt‹
.
ªq
->
≥îs
[
i
].addr,

176 
ETH_ALEN
);

177 
ªsu…
.
·m
.
bur°_ödex
 = 
mvm
->
·m_öôüt‹
.
ª•⁄£s
[
i
];

179 
	`cfg80211_pm§_ªp‹t
(
mvm
->
·m_öôüt‹
.
ªq_wdev
,

180 
mvm
->
·m_öôüt‹
.
ªq
,

181 &
ªsu…
, 
GFP_KERNEL
);

184 
	`cfg80211_pm§_com∂ëe
(
mvm
->
·m_öôüt‹
.
ªq_wdev
,

185 
mvm
->
·m_öôüt‹
.
ªq
, 
GFP_KERNEL
);

186 
	`iwl_mvm_·m_ª£t
(
mvm
);

187 
	}
}

189 
	$iwl_mvm_·m_öôüt‹_smoŸh_c⁄fig
(
iwl_mvm
 *
mvm
)

191 
	`INIT_LIST_HEAD
(&
mvm
->
·m_öôüt‹
.
smoŸh
.
ª•
);

193 
	`IWL_DEBUG_INFO
(
mvm
,

195 
IWL_MVM_FTM_INITIATOR_ENABLE_SMOOTH
,

196 
IWL_MVM_FTM_INITIATOR_SMOOTH_ALPHA
,

197 
IWL_MVM_FTM_INITIATOR_SMOOTH_AGE_SEC
 * 
HZ
,

198 
IWL_MVM_FTM_INITIATOR_SMOOTH_OVERSHOOT
,

199 
IWL_MVM_FTM_INITIATOR_SMOOTH_UNDERSHOOT
);

200 
	}
}

202 
	$iwl_mvm_·m_öôüt‹_smoŸh_°›
(
iwl_mvm
 *
mvm
)

204 
iwl_mvm_smoŸh_íåy
 *
£
, *
°
;

206 
	`li°_f‹_óch_íåy_ß„
(
£
, 
°
, &
mvm
->
·m_öôüt‹
.
smoŸh
.
ª•
,

207 
li°
) {

208 
	`li°_dñ
(&
£
->
li°
);

209 
	`k‰ì
(
£
);

211 
	}
}

214 
	$iwl_·m_ønge_ªque°_°©us_to_îr
(
iwl_tof_ønge_ªque°_°©us
 
s
)

216 
s
) {

217 
IWL_TOF_RANGE_REQUEST_STATUS_SUCCESS
:

219 
IWL_TOF_RANGE_REQUEST_STATUS_BUSY
:

220  -
EBUSY
;

222 
	`WARN_ON_ONCE
(1);

223  -
EIO
;

225 
	}
}

227 
	$iwl_mvm_·m_cmd_v5
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

228 
iwl_tof_ønge_ªq_cmd_v5
 *
cmd
,

229 
cfg80211_pm§_ªque°
 *
ªq
)

231 
i
;

233 
cmd
->
ªque°_id
 = 
ªq
->
cookõ
;

234 
cmd
->
num_of_≠
 = 
ªq
->
n_≥îs
;

237 i‡(!
ªq
->
timeout
 ||Ñeq->timeout > 255 * 100)

238 
cmd
->
ªq_timeout
 = 255;

240 
cmd
->
ªq_timeout
 = 
	`DIV_ROUND_UP
(
ªq
->
timeout
, 100);

246 
cmd
->
maˇddr_øndom
 = 1;

247 
	`mem˝y
(
cmd
->
maˇddr_ãm∂©e
, 
ªq
->
mac_addr
, 
ETH_ALEN
);

248 
i
 = 0; i < 
ETH_ALEN
; i++)

249 
cmd
->
maˇddr_mask
[
i
] = ~
ªq
->
mac_addr_mask
[i];

251 i‡(
vif
->
cfg
.
assoc
)

252 
	`mem˝y
(
cmd
->
ønge_ªq_bssid
, 
vif
->
bss_c⁄f
.
bssid
, 
ETH_ALEN
);

254 
	`ëh_brﬂdˇ°_addr
(
cmd
->
ønge_ªq_bssid
);

255 
	}
}

257 
	$iwl_mvm_·m_cmd_comm⁄
(
iwl_mvm
 *
mvm
,

258 
õì80211_vif
 *
vif
,

259 
iwl_tof_ønge_ªq_cmd_v9
 *
cmd
,

260 
cfg80211_pm§_ªque°
 *
ªq
)

262 
i
;

264 
cmd
->
öôüt‹_Êags
 =

265 
	`˝u_to_À32
(
IWL_TOF_INITIATOR_FLAGS_MACADDR_RANDOM
 |

266 
IWL_TOF_INITIATOR_FLAGS_NON_ASAP_SUPPORT
);

267 
cmd
->
ªque°_id
 = 
ªq
->
cookõ
;

268 
cmd
->
num_of_≠
 = 
ªq
->
n_≥îs
;

274 i‡(
ªq
->
timeout
)

275 
cmd
->
ªq_timeout_ms
 = 
	`˝u_to_À32
(
ªq
->
timeout
);

277 
cmd
->
ªq_timeout_ms
 = 
	`˝u_to_À32
(0xfffff);

279 
	`mem˝y
(
cmd
->
maˇddr_ãm∂©e
, 
ªq
->
mac_addr
, 
ETH_ALEN
);

280 
i
 = 0; i < 
ETH_ALEN
; i++)

281 
cmd
->
maˇddr_mask
[
i
] = ~
ªq
->
mac_addr_mask
[i];

283 i‡(
vif
->
cfg
.
assoc
) {

284 
	`mem˝y
(
cmd
->
ønge_ªq_bssid
, 
vif
->
bss_c⁄f
.
bssid
, 
ETH_ALEN
);

287 
i
 = 0; i < 
ªq
->
n_≥îs
; i++) {

288 i‡(
ªq
->
≥îs
[
i
].
ªp‹t_≠_tsf
) {

289 
iwl_mvm_vif
 *
mvmvif
 =

290 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

292 
cmd
->
tsf_mac_id
 = 
	`˝u_to_À32
(
mvmvif
->
id
);

297 
	`ëh_brﬂdˇ°_addr
(
cmd
->
ønge_ªq_bssid
);

301 
cmd
->
tsf_mac_id
 = 
	`˝u_to_À32
(0xff);

302 
	}
}

304 
	$iwl_mvm_·m_cmd_v8
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

305 
iwl_tof_ønge_ªq_cmd_v8
 *
cmd
,

306 
cfg80211_pm§_ªque°
 *
ªq
)

308 
	`iwl_mvm_·m_cmd_comm⁄
(
mvm
, 
vif
, (*)
cmd
, 
ªq
);

309 
	}
}

312 
	$iwl_mvm_·m_èrgë_ch™def_v1
(
iwl_mvm
 *
mvm
,

313 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

314 
u8
 *
ch™√l
, u8 *
b™dwidth
,

315 
u8
 *
˘æ_ch_posôi⁄
)

317 
u32
 
‰eq
 = 
≥î
->
ch™def
.
ch™
->
˚¡î_‰eq
;

319 *
ch™√l
 = 
	`õì80211_‰equícy_to_ch™√l
(
‰eq
);

321 
≥î
->
ch™def
.
width
) {

322 
NL80211_CHAN_WIDTH_20_NOHT
:

323 *
b™dwidth
 = 
IWL_TOF_BW_20_LEGACY
;

325 
NL80211_CHAN_WIDTH_20
:

326 *
b™dwidth
 = 
IWL_TOF_BW_20_HT
;

328 
NL80211_CHAN_WIDTH_40
:

329 *
b™dwidth
 = 
IWL_TOF_BW_40
;

331 
NL80211_CHAN_WIDTH_80
:

332 *
b™dwidth
 = 
IWL_TOF_BW_80
;

335 
	`IWL_ERR
(
mvm
, "Unsupported BW in FTMÑequest (%d)\n",

336 
≥î
->
ch™def
.
width
);

337  -
EINVAL
;

340 *
˘æ_ch_posôi⁄
 = (
≥î
->
ch™def
.
width
 > 
NL80211_CHAN_WIDTH_20
) ?

341 
	`iwl_mvm_gë_˘æ_pos
(&
≥î
->
ch™def
) : 0;

344 
	}
}

347 
	$iwl_mvm_·m_èrgë_ch™def_v2
(
iwl_mvm
 *
mvm
,

348 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

349 
u8
 *
ch™√l
, u8 *
f‹m©_bw
,

350 
u8
 *
˘æ_ch_posôi⁄
)

352 
u32
 
‰eq
 = 
≥î
->
ch™def
.
ch™
->
˚¡î_‰eq
;

353 
u8
 
cmd_vî
;

355 *
ch™√l
 = 
	`õì80211_‰equícy_to_ch™√l
(
‰eq
);

357 
≥î
->
ch™def
.
width
) {

358 
NL80211_CHAN_WIDTH_20_NOHT
:

359 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_LEGACY
;

360 *
f‹m©_bw
 |
IWL_LOCATION_BW_20MHZ
 << 
LOCATION_BW_POS
;

362 
NL80211_CHAN_WIDTH_20
:

363 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_HT
;

364 *
f‹m©_bw
 |
IWL_LOCATION_BW_20MHZ
 << 
LOCATION_BW_POS
;

366 
NL80211_CHAN_WIDTH_40
:

367 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_HT
;

368 *
f‹m©_bw
 |
IWL_LOCATION_BW_40MHZ
 << 
LOCATION_BW_POS
;

370 
NL80211_CHAN_WIDTH_80
:

371 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_VHT
;

372 *
f‹m©_bw
 |
IWL_LOCATION_BW_80MHZ
 << 
LOCATION_BW_POS
;

374 
NL80211_CHAN_WIDTH_160
:

375 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

376 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

377 
IWL_FW_CMD_VER_UNKNOWN
);

379 i‡(
cmd_vî
 >= 13) {

380 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_HE
;

381 *
f‹m©_bw
 |
IWL_LOCATION_BW_160MHZ
 << 
LOCATION_BW_POS
;

384 
ÁŒthrough
;

386 
	`IWL_ERR
(
mvm
, "Unsupported BW in FTMÑequest (%d)\n",

387 
≥î
->
ch™def
.
width
);

388  -
EINVAL
;

392 i‡(
≥î
->
·m
.
åiggî_ba£d
 ||Öìr->·m.
n⁄_åiggî_ba£d
)

393 *
f‹m©_bw
 |
IWL_LOCATION_FRAME_FORMAT_HE
;

395 *
˘æ_ch_posôi⁄
 = (
≥î
->
ch™def
.
width
 > 
NL80211_CHAN_WIDTH_20
) ?

396 
	`iwl_mvm_gë_˘æ_pos
(&
≥î
->
ch™def
) : 0;

399 
	}
}

402 
	$iwl_mvm_·m_put_èrgë_v2
(
iwl_mvm
 *
mvm
,

403 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

404 
iwl_tof_ønge_ªq_≠_íåy_v2
 *
èrgë
)

406 
ªt
;

408 
ªt
 = 
	`iwl_mvm_·m_èrgë_ch™def_v1
(
mvm
, 
≥î
, &
èrgë
->
ch™√l_num
,

409 &
èrgë
->
b™dwidth
,

410 &
èrgë
->
˘æ_ch_posôi⁄
);

411 i‡(
ªt
)

412  
ªt
;

414 
	`mem˝y
(
èrgë
->
bssid
, 
≥î
->
addr
, 
ETH_ALEN
);

415 
èrgë
->
bur°_≥riod
 =

416 
	`˝u_to_À16
(
≥î
->
·m
.
bur°_≥riod
);

417 
èrgë
->
ßm∂es_≥r_bur°
 = 
≥î
->
·m
.
·ms_≥r_bur°
;

418 
èrgë
->
num_of_bur°s
 = 
≥î
->
·m
.
num_bur°s_exp
;

419 
èrgë
->
mósuª_ty≥
 = 0;

420 
èrgë
->
ªåõs_≥r_ßm∂e
 = 
≥î
->
·m
.
·mr_ªåõs
;

421 
èrgë
->
aßp_mode
 = 
≥î
->
·m
.
aßp
;

422 
èrgë
->
íabÀ_dyn_ack
 = 
IWL_MVM_FTM_INITIATOR_DYNACK
;

424 i‡(
≥î
->
·m
.
ªque°_lci
)

425 
èrgë
->
loˇti⁄_ªq
 |
IWL_TOF_LOC_LCI
;

426 i‡(
≥î
->
·m
.
ªque°_civi˛oc
)

427 
èrgë
->
loˇti⁄_ªq
 |
IWL_TOF_LOC_CIVIC
;

429 
èrgë
->
Ægo_ty≥
 = 
IWL_MVM_FTM_INITIATOR_ALGO
;

432 
	}
}

434 
	#FTM_PUT_FLAG
(
Êag
Ë(
èrgë
->
öôüt‹_≠_Êags
 |= \

435 
	`˝u_to_À32
(
IWL_INITIATOR_AP_FLAGS_
##
Êag
))

	)

438 
	$iwl_mvm_·m_put_èrgë_comm⁄
(
iwl_mvm
 *
mvm
,

439 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

440 
iwl_tof_ønge_ªq_≠_íåy_v6
 *
èrgë
)

442 
	`mem˝y
(
èrgë
->
bssid
, 
≥î
->
addr
, 
ETH_ALEN
);

443 
èrgë
->
bur°_≥riod
 =

444 
	`˝u_to_À16
(
≥î
->
·m
.
bur°_≥riod
);

445 
èrgë
->
ßm∂es_≥r_bur°
 = 
≥î
->
·m
.
·ms_≥r_bur°
;

446 
èrgë
->
num_of_bur°s
 = 
≥î
->
·m
.
num_bur°s_exp
;

447 
èrgë
->
·mr_max_ªåõs
 = 
≥î
->
·m
.
·mr_ªåõs
;

448 
èrgë
->
öôüt‹_≠_Êags
 = 
	`˝u_to_À32
(0);

450 i‡(
≥î
->
·m
.
aßp
)

451 
	`FTM_PUT_FLAG
(
ASAP
);

453 i‡(
≥î
->
·m
.
ªque°_lci
)

454 
	`FTM_PUT_FLAG
(
LCI_REQUEST
);

456 i‡(
≥î
->
·m
.
ªque°_civi˛oc
)

457 
	`FTM_PUT_FLAG
(
CIVIC_REQUEST
);

459 i‡(
IWL_MVM_FTM_INITIATOR_DYNACK
)

460 
	`FTM_PUT_FLAG
(
DYN_ACK
);

462 i‡(
IWL_MVM_FTM_INITIATOR_ALGO
 =
IWL_TOF_ALGO_TYPE_LINEAR_REG
)

463 
	`FTM_PUT_FLAG
(
ALGO_LR
);

464 i‡(
IWL_MVM_FTM_INITIATOR_ALGO
 =
IWL_TOF_ALGO_TYPE_FFT
)

465 
	`FTM_PUT_FLAG
(
ALGO_FFT
);

467 i‡(
≥î
->
·m
.
åiggî_ba£d
)

468 
	`FTM_PUT_FLAG
(
TB
);

469 i‡(
≥î
->
·m
.
n⁄_åiggî_ba£d
)

470 
	`FTM_PUT_FLAG
(
NON_TB
);

472 i‡((
≥î
->
·m
.
åiggî_ba£d
 ||Öìr->·m.
n⁄_åiggî_ba£d
) &&

473 
≥î
->
·m
.
lmr_„edback
)

474 
	`FTM_PUT_FLAG
(
LMR_FEEDBACK
);

475 
	}
}

478 
	$iwl_mvm_·m_put_èrgë_v3
(
iwl_mvm
 *
mvm
,

479 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

480 
iwl_tof_ønge_ªq_≠_íåy_v3
 *
èrgë
)

482 
ªt
;

484 
ªt
 = 
	`iwl_mvm_·m_èrgë_ch™def_v1
(
mvm
, 
≥î
, &
èrgë
->
ch™√l_num
,

485 &
èrgë
->
b™dwidth
,

486 &
èrgë
->
˘æ_ch_posôi⁄
);

487 i‡(
ªt
)

488  
ªt
;

494 
	`iwl_mvm_·m_put_èrgë_comm⁄
(
mvm
, 
≥î
, (*)
èrgë
);

497 
	}
}

500 
	$iwl_mvm_·m_put_èrgë_v4
(
iwl_mvm
 *
mvm
,

501 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

502 
iwl_tof_ønge_ªq_≠_íåy_v4
 *
èrgë
)

504 
ªt
;

506 
ªt
 = 
	`iwl_mvm_·m_èrgë_ch™def_v2
(
mvm
, 
≥î
, &
èrgë
->
ch™√l_num
,

507 &
èrgë
->
f‹m©_bw
,

508 &
èrgë
->
˘æ_ch_posôi⁄
);

509 i‡(
ªt
)

510  
ªt
;

512 
	`iwl_mvm_·m_put_èrgë_comm⁄
(
mvm
, 
≥î
, (*)
èrgë
);

515 
	}
}

518 
	$iwl_mvm_·m_put_èrgë
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

519 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

520 
iwl_tof_ønge_ªq_≠_íåy_v6
 *
èrgë
)

522 
ªt
;

524 
ªt
 = 
	`iwl_mvm_·m_èrgë_ch™def_v2
(
mvm
, 
≥î
, &
èrgë
->
ch™√l_num
,

525 &
èrgë
->
f‹m©_bw
,

526 &
èrgë
->
˘æ_ch_posôi⁄
);

527 i‡(
ªt
)

528  
ªt
;

530 
	`iwl_mvm_·m_put_èrgë_comm⁄
(
mvm
, 
≥î
, 
èrgë
);

532 i‡(
vif
->
cfg
.
assoc
) {

533 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

534 
õì80211_°a
 *
°a
;

535 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

536 
lök_id
;

538 
	`rcu_ªad_lock
();

539 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
) {

540 i‡(
	`memcmp
(
≥î
->
addr
, 
lök_c⁄f
->
bssid
, 
ETH_ALEN
))

543 
èrgë
->
°a_id
 = 
mvmvif
->
lök
[
lök_id
]->
≠_°a_id
;

544 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
èrgë
->
°a_id
]);

545 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
))) {

546 
	`rcu_ªad_u∆ock
();

547  
	`PTR_ERR_OR_ZERO
(
°a
);

550 i‡(
°a
->
mÂ
 && (
≥î
->
·m
.
åiggî_ba£d
 ||

551 
≥î
->
·m
.
n⁄_åiggî_ba£d
))

552 
	`FTM_PUT_FLAG
(
PMF
);

555 
	`rcu_ªad_u∆ock
();

557 
èrgë
->
°a_id
 = 
IWL_MVM_INVALID_STA
;

564 
èrgë
->
bóc⁄_öãrvÆ
 = 
	`˝u_to_À16
(100);

566 
	}
}

568 
	$iwl_mvm_·m_£nd_cmd
(
iwl_mvm
 *
mvm
, 
iwl_ho°_cmd
 *
hcmd
)

570 
u32
 
°©us
;

571 
îr
 = 
	`iwl_mvm_£nd_cmd_°©us
(
mvm
, 
hcmd
, &
°©us
);

573 i‡(!
îr
 && 
°©us
) {

574 
	`IWL_ERR
(
mvm
, "FTMÑangeÑequest command failure, status: %u\n",

575 
°©us
);

576 
îr
 = 
	`iwl_·m_ønge_ªque°_°©us_to_îr
(
°©us
);

579  
îr
;

580 
	}
}

582 
	$iwl_mvm_·m_°¨t_v5
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

583 
cfg80211_pm§_ªque°
 *
ªq
)

585 
iwl_tof_ønge_ªq_cmd_v5
 
cmd_v5
;

586 
iwl_ho°_cmd
 
hcmd
 = {

587 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

588 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

589 .
d©a
[0] = &
cmd_v5
,

590 .
Àn
[0] = (
cmd_v5
),

592 
u8
 
i
;

593 
îr
;

595 
	`iwl_mvm_·m_cmd_v5
(
mvm
, 
vif
, &
cmd_v5
, 
ªq
);

597 
i
 = 0; i < 
cmd_v5
.
num_of_≠
; i++) {

598 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

600 
îr
 = 
	`iwl_mvm_·m_put_èrgë_v2
(
mvm
, 
≥î
, &
cmd_v5
.
≠
[
i
]);

601 i‡(
îr
)

602  
îr
;

605  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

606 
	}
}

608 
	$iwl_mvm_·m_°¨t_v7
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

609 
cfg80211_pm§_ªque°
 *
ªq
)

611 
iwl_tof_ønge_ªq_cmd_v7
 
cmd_v7
;

612 
iwl_ho°_cmd
 
hcmd
 = {

613 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

614 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

615 .
d©a
[0] = &
cmd_v7
,

616 .
Àn
[0] = (
cmd_v7
),

618 
u8
 
i
;

619 
îr
;

625 
	`iwl_mvm_·m_cmd_v8
(
mvm
, 
vif
, (*)&
cmd_v7
, 
ªq
);

627 
i
 = 0; i < 
cmd_v7
.
num_of_≠
; i++) {

628 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

630 
îr
 = 
	`iwl_mvm_·m_put_èrgë_v3
(
mvm
, 
≥î
, &
cmd_v7
.
≠
[
i
]);

631 i‡(
îr
)

632  
îr
;

635  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

636 
	}
}

638 
	$iwl_mvm_·m_°¨t_v8
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

639 
cfg80211_pm§_ªque°
 *
ªq
)

641 
iwl_tof_ønge_ªq_cmd_v8
 
cmd
;

642 
iwl_ho°_cmd
 
hcmd
 = {

643 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

644 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

645 .
d©a
[0] = &
cmd
,

646 .
Àn
[0] = (
cmd
),

648 
u8
 
i
;

649 
îr
;

651 
	`iwl_mvm_·m_cmd_v8
(
mvm
, 
vif
, (*)&
cmd
, 
ªq
);

653 
i
 = 0; i < 
cmd
.
num_of_≠
; i++) {

654 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

656 
îr
 = 
	`iwl_mvm_·m_put_èrgë_v4
(
mvm
, 
≥î
, &
cmd
.
≠
[
i
]);

657 i‡(
îr
)

658  
îr
;

661  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

662 
	}
}

664 
	$iwl_mvm_·m_°¨t_v9
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

665 
cfg80211_pm§_ªque°
 *
ªq
)

667 
iwl_tof_ønge_ªq_cmd_v9
 
cmd
;

668 
iwl_ho°_cmd
 
hcmd
 = {

669 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

670 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

671 .
d©a
[0] = &
cmd
,

672 .
Àn
[0] = (
cmd
),

674 
u8
 
i
;

675 
îr
;

677 
	`iwl_mvm_·m_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
ªq
);

679 
i
 = 0; i < 
cmd
.
num_of_≠
; i++) {

680 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

681 
iwl_tof_ønge_ªq_≠_íåy_v6
 *
èrgë
 = &
cmd
.
≠
[
i
];

683 
îr
 = 
	`iwl_mvm_·m_put_èrgë
(
mvm
, 
vif
, 
≥î
, 
èrgë
);

684 i‡(
îr
)

685  
îr
;

688  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

689 
	}
}

691 
	$ôî
(
õì80211_hw
 *
hw
,

692 
õì80211_vif
 *
vif
,

693 
õì80211_°a
 *
°a
,

694 
õì80211_key_c⁄f
 *
key
,

695 *
d©a
)

697 
iwl_tof_ønge_ªq_≠_íåy_v6
 *
èrgë
 = 
d©a
;

699 i‡(!
°a
 || 
	`memcmp
(°a->
addr
, 
èrgë
->
bssid
, 
ETH_ALEN
))

702 
	`WARN_ON
(!
°a
->
mÂ
);

704 i‡(
	`WARN_ON
(
key
->
keyÀn
 > (
èrgë
->
tk
)))

707 
	`mem˝y
(
èrgë
->
tk
, 
key
->key, key->
keyÀn
);

708 
èrgë
->
cùhî
 = 
	`iwl_mvm_cùhî_to_loˇti⁄_cùhî
(
key
->cipher);

709 
	`WARN_ON
(
èrgë
->
cùhî
 =
IWL_LOCATION_CIPHER_INVALID
);

710 
	}
}

713 
	$iwl_mvm_·m_£t_£cuªd_øngög
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

714 
iwl_tof_ønge_ªq_≠_íåy_v7
 *
èrgë
)

716 
iwl_mvm_·m_∑¢_íåy
 *
íåy
;

717 
u32
 
Êags
 = 
	`À32_to_˝u
(
èrgë
->
öôüt‹_≠_Êags
);

719 i‡(!(
Êags
 & (
IWL_INITIATOR_AP_FLAGS_NON_TB
 |

720 
IWL_INITIATOR_AP_FLAGS_TB
)))

723 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

725 
	`li°_f‹_óch_íåy
(
íåy
, &
mvm
->
·m_öôüt‹
.
∑¢_li°
, 
li°
) {

726 i‡(
	`memcmp
(
íåy
->
addr
, 
èrgë
->
bssid
, (entry->addr)))

729 
èrgë
->
cùhî
 = 
íåy
->cipher;

731 i‡(
íåy
->
Êags
 & 
IWL_MVM_PASN_FLAG_HAS_HLTK
)

732 
	`mem˝y
(
èrgë
->
h…k
, 
íåy
->hltk, (target->hltk));

734 
	`mem£t
(
èrgë
->
h…k
, 0, (target->hltk));

736 i‡(
vif
->
cfg
.
assoc
 &&

737 !
	`memcmp
(
vif
->
bss_c⁄f
.
bssid
, 
èrgë
->bssid,

738 (
èrgë
->
bssid
)))

739 
	`õì80211_ôî_keys
(
mvm
->
hw
, 
vif
, 
ôî
, 
èrgë
);

741 
	`mem˝y
(
èrgë
->
tk
, 
íåy
->tk, (target->tk));

743 
	`mem˝y
(
èrgë
->
rx_≤
, 
íåy
->rx_pn, (target->rx_pn));

744 
	`mem˝y
(
èrgë
->
tx_≤
, 
íåy
->tx_pn, (target->tx_pn));

746 
èrgë
->
öôüt‹_≠_Êags
 |=

747 
	`˝u_to_À32
(
IWL_INITIATOR_AP_FLAGS_SECURED
);

750 
	}
}

753 
	$iwl_mvm_·m_put_èrgë_v7
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

754 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

755 
iwl_tof_ønge_ªq_≠_íåy_v7
 *
èrgë
)

757 
îr
 = 
	`iwl_mvm_·m_put_èrgë
(
mvm
, 
vif
, 
≥î
, (*)
èrgë
);

758 i‡(
îr
)

759  
îr
;

761 
	`iwl_mvm_·m_£t_£cuªd_øngög
(
mvm
, 
vif
, 
èrgë
);

762  
îr
;

763 
	}
}

765 
	$iwl_mvm_·m_°¨t_v11
(
iwl_mvm
 *
mvm
,

766 
õì80211_vif
 *
vif
,

767 
cfg80211_pm§_ªque°
 *
ªq
)

769 
iwl_tof_ønge_ªq_cmd_v11
 
cmd
;

770 
iwl_ho°_cmd
 
hcmd
 = {

771 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

772 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

773 .
d©a
[0] = &
cmd
,

774 .
Àn
[0] = (
cmd
),

776 
u8
 
i
;

777 
îr
;

779 
	`iwl_mvm_·m_cmd_comm⁄
(
mvm
, 
vif
, (*)&
cmd
, 
ªq
);

781 
i
 = 0; i < 
cmd
.
num_of_≠
; i++) {

782 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

783 
iwl_tof_ønge_ªq_≠_íåy_v7
 *
èrgë
 = &
cmd
.
≠
[
i
];

785 
îr
 = 
	`iwl_mvm_·m_put_èrgë_v7
(
mvm
, 
vif
, 
≥î
, 
èrgë
);

786 i‡(
îr
)

787  
îr
;

790  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

791 
	}
}

794 
	$iwl_mvm_·m_£t_ndp_∑øms
(
iwl_mvm
 *
mvm
,

795 
iwl_tof_ønge_ªq_≠_íåy_v8
 *
èrgë
)

798 
u32
 
i2r_max_°s
 = 
IWL_MVM_FTM_I2R_MAX_STS
 > 1 ? 1 :

799 
IWL_MVM_FTM_I2R_MAX_STS
;

801 
èrgë
->
r2i_ndp_∑øms
 = 
IWL_MVM_FTM_R2I_MAX_REP
 |

802 (
IWL_MVM_FTM_R2I_MAX_STS
 << 
IWL_LOCATION_MAX_STS_POS
);

803 
èrgë
->
i2r_ndp_∑øms
 = 
IWL_MVM_FTM_I2R_MAX_REP
 |

804 (
i2r_max_°s
 << 
IWL_LOCATION_MAX_STS_POS
);

805 
èrgë
->
r2i_max_tŸÆ_…f
 = 
IWL_MVM_FTM_R2I_MAX_TOTAL_LTF
;

806 
èrgë
->
i2r_max_tŸÆ_…f
 = 
IWL_MVM_FTM_I2R_MAX_TOTAL_LTF
;

807 
	}
}

810 
	$iwl_mvm_·m_put_èrgë_v8
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

811 
cfg80211_pm§_ªque°_≥î
 *
≥î
,

812 
iwl_tof_ønge_ªq_≠_íåy_v8
 *
èrgë
)

814 
u32
 
Êags
;

815 
ªt
 = 
	`iwl_mvm_·m_put_èrgë_v7
(
mvm
, 
vif
, 
≥î
, (*)
èrgë
);

817 i‡(
ªt
)

818  
ªt
;

820 
	`iwl_mvm_·m_£t_ndp_∑øms
(
mvm
, 
èrgë
);

825 
Êags
 = 
	`À32_to_˝u
(
èrgë
->
öôüt‹_≠_Êags
);

826 i‡(
Êags
 & 
IWL_INITIATOR_AP_FLAGS_SECURED
) {

827 i‡(!
IWL_MVM_FTM_INITIATOR_SECURE_LTF
)

828 
Êags
 &~
IWL_INITIATOR_AP_FLAGS_SECURED
;

830 
Êags
 |
IWL_INITIATOR_AP_FLAGS_PMF
;

831 
èrgë
->
öôüt‹_≠_Êags
 = 
	`˝u_to_À32
(
Êags
);

835 
	}
}

837 
	$iwl_mvm_·m_°¨t_v12
(
iwl_mvm
 *
mvm
,

838 
õì80211_vif
 *
vif
,

839 
cfg80211_pm§_ªque°
 *
ªq
)

841 
iwl_tof_ønge_ªq_cmd_v12
 
cmd
;

842 
iwl_ho°_cmd
 
hcmd
 = {

843 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

844 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

845 .
d©a
[0] = &
cmd
,

846 .
Àn
[0] = (
cmd
),

848 
u8
 
i
;

849 
îr
;

851 
	`iwl_mvm_·m_cmd_comm⁄
(
mvm
, 
vif
, (*)&
cmd
, 
ªq
);

853 
i
 = 0; i < 
cmd
.
num_of_≠
; i++) {

854 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

855 
iwl_tof_ønge_ªq_≠_íåy_v8
 *
èrgë
 = &
cmd
.
≠
[
i
];

857 
îr
 = 
	`iwl_mvm_·m_put_èrgë_v8
(
mvm
, 
vif
, 
≥î
, 
èrgë
);

858 i‡(
îr
)

859  
îr
;

862  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

863 
	}
}

865 
	$iwl_mvm_·m_°¨t_v13
(
iwl_mvm
 *
mvm
,

866 
õì80211_vif
 *
vif
,

867 
cfg80211_pm§_ªque°
 *
ªq
)

869 
iwl_tof_ønge_ªq_cmd_v13
 
cmd
;

870 
iwl_ho°_cmd
 
hcmd
 = {

871 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

872 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

873 .
d©a
[0] = &
cmd
,

874 .
Àn
[0] = (
cmd
),

876 
u8
 
i
;

877 
îr
;

879 
	`iwl_mvm_·m_cmd_comm⁄
(
mvm
, 
vif
, (*)&
cmd
, 
ªq
);

881 
i
 = 0; i < 
cmd
.
num_of_≠
; i++) {

882 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

883 
iwl_tof_ønge_ªq_≠_íåy_v9
 *
èrgë
 = &
cmd
.
≠
[
i
];

885 
îr
 = 
	`iwl_mvm_·m_put_èrgë_v8
(
mvm
, 
vif
, 
≥î
, (*)
èrgë
);

886 i‡(
îr
)

887  
îr
;

889 i‡(
≥î
->
·m
.
åiggî_ba£d
 ||Öìr->·m.
n⁄_åiggî_ba£d
)

890 
èrgë
->
bss_cﬁ‹
 = 
≥î
->
·m
.bss_color;

892 i‡(
≥î
->
·m
.
n⁄_åiggî_ba£d
) {

893 
èrgë
->
mö_time_bëwìn_m§
 =

894 
	`˝u_to_À16
(
IWL_MVM_FTM_NON_TB_MIN_TIME_BETWEEN_MSR
);

895 
èrgë
->
bur°_≥riod
 =

896 
	`˝u_to_À16
(
IWL_MVM_FTM_NON_TB_MAX_TIME_BETWEEN_MSR
);

898 
èrgë
->
mö_time_bëwìn_m§
 = 
	`˝u_to_À16
(0);

901 
èrgë
->
b™d
 =

902 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
≥î
->
ch™def
.
ch™
->
b™d
);

905  
	`iwl_mvm_·m_£nd_cmd
(
mvm
, &
hcmd
);

906 
	}
}

908 
	$iwl_mvm_·m_°¨t
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

909 
cfg80211_pm§_ªque°
 *
ªq
)

911 
boﬁ
 
√w_≠i
 = 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

912 
IWL_UCODE_TLV_API_FTM_NEW_RANGE_REQ
);

913 
îr
;

915 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

917 i‡(
mvm
->
·m_öôüt‹
.
ªq
)

918  -
EBUSY
;

920 i‡(
√w_≠i
) {

921 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

922 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_REQ_CMD
),

923 
IWL_FW_CMD_VER_UNKNOWN
);

925 
cmd_vî
) {

927 
îr
 = 
	`iwl_mvm_·m_°¨t_v13
(
mvm
, 
vif
, 
ªq
);

930 
îr
 = 
	`iwl_mvm_·m_°¨t_v12
(
mvm
, 
vif
, 
ªq
);

933 
îr
 = 
	`iwl_mvm_·m_°¨t_v11
(
mvm
, 
vif
, 
ªq
);

937 
îr
 = 
	`iwl_mvm_·m_°¨t_v9
(
mvm
, 
vif
, 
ªq
);

940 
îr
 = 
	`iwl_mvm_·m_°¨t_v8
(
mvm
, 
vif
, 
ªq
);

943 
îr
 = 
	`iwl_mvm_·m_°¨t_v7
(
mvm
, 
vif
, 
ªq
);

947 
îr
 = 
	`iwl_mvm_·m_°¨t_v5
(
mvm
, 
vif
, 
ªq
);

950 i‡(!
îr
) {

951 
mvm
->
·m_öôüt‹
.
ªq
 =Ñeq;

952 
mvm
->
·m_öôüt‹
.
ªq_wdev
 = 
	`õì80211_vif_to_wdev
(
vif
);

955  
îr
;

956 
	}
}

958 
	$iwl_mvm_·m_ab‹t
(
iwl_mvm
 *
mvm
, 
cfg80211_pm§_ªque°
 *
ªq
)

960 
iwl_tof_ønge_ab‹t_cmd
 
cmd
 = {

961 .
ªque°_id
 = 
ªq
->
cookõ
,

964 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

966 i‡(
ªq
 !
mvm
->
·m_öôüt‹
.req)

969 
	`iwl_mvm_·m_ª£t
(
mvm
);

971 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RANGE_ABORT_CMD
),

972 0, (
cmd
), &cmd))

973 
	`IWL_ERR
(
mvm
, "failedÅoábort FTMÖrocess\n");

974 
	}
}

976 
	$iwl_mvm_·m_föd_≥î
(
cfg80211_pm§_ªque°
 *
ªq
,

977 c⁄° 
u8
 *
addr
)

979 
i
;

981 
i
 = 0; i < 
ªq
->
n_≥îs
; i++) {

982 
cfg80211_pm§_ªque°_≥î
 *
≥î
 = &
ªq
->
≥îs
[
i
];

984 i‡(
	`ëhî_addr_equÆ_u«lig√d
(
≥î
->
addr
,áddr))

985  
i
;

988  -
ENOENT
;

989 
	}
}

991 
u64
 
	$iwl_mvm_·m_gë_ho°_time
(
iwl_mvm
 *
mvm
, 
__À32
 
fw_gp2_ts
)

993 
u32
 
gp2_ts
 = 
	`À32_to_˝u
(
fw_gp2_ts
);

994 
u32
 
cuº_gp2
, 
diff
;

995 
u64
 
now_‰om_boŸ_ns
;

997 
	`iwl_mvm_gë_sync_time
(
mvm
, 
CLOCK_BOOTTIME
, &
cuº_gp2
,

998 &
now_‰om_boŸ_ns
, 
NULL
);

1000 i‡(
cuº_gp2
 >
gp2_ts
)

1001 
diff
 = 
cuº_gp2
 - 
gp2_ts
;

1003 
diff
 = 
cuº_gp2
 + (
U32_MAX
 - 
gp2_ts
 + 1);

1005  
now_‰om_boŸ_ns
 - (
u64
)
diff
 * 1000;

1006 
	}
}

1008 
	$iwl_mvm_·m_gë_lci_civic
(
iwl_mvm
 *
mvm
,

1009 
cfg80211_pm§_ªsu…
 *
ªs
)

1011 
iwl_mvm_loc_íåy
 *
íåy
;

1013 
	`li°_f‹_óch_íåy
(
íåy
, &
mvm
->
·m_öôüt‹
.
loc_li°
, 
li°
) {

1014 i‡(!
	`ëhî_addr_equÆ_u«lig√d
(
ªs
->
addr
, 
íåy
->addr))

1017 i‡(
íåy
->
lci_Àn
) {

1018 
ªs
->
·m
.
lci_Àn
 = 
íåy
->lci_len;

1019 
ªs
->
·m
.
lci
 = 
íåy
->
buf
;

1022 i‡(
íåy
->
civic_Àn
) {

1023 
ªs
->
·m
.
civi˛oc_Àn
 = 
íåy
->
civic_Àn
;

1024 
ªs
->
·m
.
civi˛oc
 = 
íåy
->
buf
 +É¡ry->
lci_Àn
;

1030 
	}
}

1032 
	$iwl_mvm_·m_ønge_ª•_vÆid
(
iwl_mvm
 *
mvm
, 
u8
 
ªque°_id
,

1033 
u8
 
num_of_≠s
)

1035 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1037 i‡(
ªque°_id
 !(
u8
)
mvm
->
·m_öôüt‹
.
ªq
->
cookõ
) {

1038 
	`IWL_ERR
(
mvm
, "Request ID mismatch, got %u,áctive %u\n",

1039 
ªque°_id
, (
u8
)
mvm
->
·m_öôüt‹
.
ªq
->
cookõ
);

1040  -
EINVAL
;

1043 i‡(
num_of_≠s
 > 
mvm
->
·m_öôüt‹
.
ªq
->
n_≥îs
) {

1044 
	`IWL_ERR
(
mvm
, "FTMÑangeÑesponse invalid\n");

1045  -
EINVAL
;

1049 
	}
}

1051 
	$iwl_mvm_·m_πt_smoŸhög
(
iwl_mvm
 *
mvm
,

1052 
cfg80211_pm§_ªsu…
 *
ªs
)

1054 
iwl_mvm_smoŸh_íåy
 *
ª•
 = 
NULL
, *
ôî
;

1055 
s64
 
πt_avg
, 
πt
 = 
ªs
->
·m
.rtt_avg;

1056 
u32
 
undîshoŸ
, 
ovîshoŸ
;

1057 
u8
 
Æpha
;

1059 i‡(!
IWL_MVM_FTM_INITIATOR_ENABLE_SMOOTH
)

1062 
	`WARN_ON
(
πt
 < 0);

1064 i‡(
ªs
->
°©us
 !
NL80211_PMSR_STATUS_SUCCESS
) {

1065 
	`IWL_DEBUG_INFO
(
mvm
,

1067 
ªs
->
addr
,Ñes->
°©us
);

1071 
	`li°_f‹_óch_íåy
(
ôî
, &
mvm
->
·m_öôüt‹
.
smoŸh
.
ª•
, 
li°
) {

1072 i‡(!
	`memcmp
(
ªs
->
addr
, 
ôî
->addr, 
ETH_ALEN
)) {

1073 
ª•
 = 
ôî
;

1078 i‡(!
ª•
) {

1079 
ª•
 = 
	`kzÆloc
((*ª•), 
GFP_KERNEL
);

1080 i‡(!
ª•
)

1083 
	`mem˝y
(
ª•
->
addr
, 
ªs
->addr, 
ETH_ALEN
);

1084 
	`li°_add_èû
(&
ª•
->
li°
, &
mvm
->
·m_öôüt‹
.
smoŸh
.resp);

1086 
ª•
->
πt_avg
 = 
πt
;

1088 
	`IWL_DEBUG_INFO
(
mvm
, "new: %pM:Ñtt_avg=%lld\n",

1089 
ª•
->
addr
,Ñe•->
πt_avg
);

1090 
upd©e_time
;

1093 i‡(
ªs
->
ho°_time
 - 
ª•
->host_time >

1094 
IWL_MVM_FTM_INITIATOR_SMOOTH_AGE_SEC
 * 1000000000) {

1095 
ª•
->
πt_avg
 = 
πt
;

1097 
	`IWL_DEBUG_INFO
(
mvm
, "expired: %pM:Ñtt_avg=%lld\n",

1098 
ª•
->
addr
,Ñe•->
πt_avg
);

1099 
upd©e_time
;

1103 
undîshoŸ
 = 
IWL_MVM_FTM_INITIATOR_SMOOTH_UNDERSHOOT
;

1104 
ovîshoŸ
 = 
IWL_MVM_FTM_INITIATOR_SMOOTH_OVERSHOOT
;

1105 
Æpha
 = 
IWL_MVM_FTM_INITIATOR_SMOOTH_ALPHA
;

1107 
πt_avg
 = 
	`div_s64
(
Æpha
 * 
πt
 + (100 -áÕhaË* 
ª•
->rtt_avg, 100);

1109 
	`IWL_DEBUG_INFO
(
mvm
,

1111 
ª•
->
addr
,Ñe•->
πt_avg
,Ñâ_avg, 
πt
);

1117 
ª•
->
πt_avg
 =Ñtt_avg;

1120 i‡(
πt_avg
 > 
πt
 && (πt_avg -ÑâË> 
undîshoŸ
) {

1121 
ªs
->
·m
.
πt_avg
 =Ñtt_avg;

1123 
	`IWL_DEBUG_INFO
(
mvm
,

1125 (
πt_avg
 - 
πt
));

1126 } i‡(
πt_avg
 < 
πt
 && (rtt -Ñtt_avg) >

1127 
ovîshoŸ
) {

1128 
ªs
->
·m
.
πt_avg
 =Ñtt_avg;

1129 
	`IWL_DEBUG_INFO
(
mvm
,

1131 (
πt
 - 
πt_avg
));

1134 
upd©e_time
:

1135 
ª•
->
ho°_time
 = 
ªs
->host_time;

1136 
	}
}

1138 
	$iwl_mvm_debug_ønge_ª•
(
iwl_mvm
 *
mvm
, 
u8
 
ödex
,

1139 
cfg80211_pm§_ªsu…
 *
ªs
)

1141 
s64
 
πt_avg
 = 
	`div_s64
(
ªs
->
·m
.rtt_avg * 100, 6666);

1143 
	`IWL_DEBUG_INFO
(
mvm
, "íåy %d\n", 
ödex
);

1144 
	`IWL_DEBUG_INFO
(
mvm
, "\t°©us: %d\n", 
ªs
->
°©us
);

1145 
	`IWL_DEBUG_INFO
(
mvm
, "\tBSSID: %pM\n", 
ªs
->
addr
);

1146 
	`IWL_DEBUG_INFO
(
mvm
, "\tho°Åime: %Œu\n", 
ªs
->
ho°_time
);

1147 
	`IWL_DEBUG_INFO
(
mvm
, "\tbur° index: %d\n", 
ªs
->
·m
.
bur°_ödex
);

1148 
	`IWL_DEBUG_INFO
(
mvm
, "\tsuc˚s†num: %u\n", 
ªs
->
·m
.
num_·mr_suc˚s£s
);

1149 
	`IWL_DEBUG_INFO
(
mvm
, "\åssi: %d\n", 
ªs
->
·m
.
rssi_avg
);

1150 
	`IWL_DEBUG_INFO
(
mvm
, "\åssò•ªad: %d\n", 
ªs
->
·m
.
rssi_•ªad
);

1151 
	`IWL_DEBUG_INFO
(
mvm
, "\åâ: %Œd\n", 
ªs
->
·m
.
πt_avg
);

1152 
	`IWL_DEBUG_INFO
(
mvm
, "\åâ v¨: %Œu\n", 
ªs
->
·m
.
πt_v¨ün˚
);

1153 
	`IWL_DEBUG_INFO
(
mvm
, "\åâ s¥ód: %Œu\n", 
ªs
->
·m
.
πt_•ªad
);

1154 
	`IWL_DEBUG_INFO
(
mvm
, "\tdi°™˚: %Œd\n", 
πt_avg
);

1155 
	}
}

1158 
	$iwl_mvm_·m_∑¢_upd©e_≤
(
iwl_mvm
 *
mvm
,

1159 
iwl_tof_ønge_r•_≠_íåy_¡fy_v6
 *
fw_≠
)

1161 
iwl_mvm_·m_∑¢_íåy
 *
íåy
;

1163 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1165 
	`li°_f‹_óch_íåy
(
íåy
, &
mvm
->
·m_öôüt‹
.
∑¢_li°
, 
li°
) {

1166 i‡(
	`memcmp
(
fw_≠
->
bssid
, 
íåy
->
addr
, (entry->addr)))

1169 
	`mem˝y
(
íåy
->
rx_≤
, 
fw_≠
->rx_pn, (entry->rx_pn));

1170 
	`mem˝y
(
íåy
->
tx_≤
, 
fw_≠
->tx_pn, (entry->tx_pn));

1173 
	}
}

1175 
u8
 
	$iwl_mvm_·m_gë_ønge_ª•_vî
(
iwl_mvm
 *
mvm
)

1177 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1178 
IWL_UCODE_TLV_API_FTM_NEW_RANGE_REQ
))

1182 i‡(
mvm
->
cmd_vî
.
ønge_ª•
 >= 8)

1183  
mvm
->
cmd_vî
.
ønge_ª•
;

1184 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1185 
IWL_UCODE_TLV_API_FTM_RTT_ACCURACY
))

1190 
	}
}

1192 
boﬁ
 
	$iwl_mvm_·m_ª•_size_vÆid©i⁄
(
u8
 
vî
, 
pkt_Àn
)

1194 
vî
) {

1197  
pkt_Àn
 =(
iwl_tof_ønge_r•_¡fy_v8
);

1199  
pkt_Àn
 =(
iwl_tof_ønge_r•_¡fy_v7
);

1201  
pkt_Àn
 =(
iwl_tof_ønge_r•_¡fy_v6
);

1203  
pkt_Àn
 =(
iwl_tof_ønge_r•_¡fy_v5
);

1205 
	`WARN_ONCE
(1, "FTM: unsuµ‹ãdÑ™gêª•⁄£ vîsi⁄ %u", 
vî
);

1206  
Ál£
;

1208 
	}
}

1210 
	$iwl_mvm_·m_ønge_ª•
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

1212 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1213 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1214 
iwl_tof_ønge_r•_¡fy_v5
 *
fw_ª•_v5
 = (*)
pkt
->
d©a
;

1215 
iwl_tof_ønge_r•_¡fy_v6
 *
fw_ª•_v6
 = (*)
pkt
->
d©a
;

1216 
iwl_tof_ønge_r•_¡fy_v7
 *
fw_ª•_v7
 = (*)
pkt
->
d©a
;

1217 
iwl_tof_ønge_r•_¡fy_v8
 *
fw_ª•_v8
 = (*)
pkt
->
d©a
;

1218 
i
;

1219 
boﬁ
 
√w_≠i
 = 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1220 
IWL_UCODE_TLV_API_FTM_NEW_RANGE_REQ
);

1221 
u8
 
num_of_≠s
, 
œ°_ö_b©ch
;

1222 
u8
 
nŸif_vî
 = 
	`iwl_mvm_·m_gë_ønge_ª•_vî
(
mvm
);

1224 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1226 i‡(!
mvm
->
·m_öôüt‹
.
ªq
) {

1230 i‡(
	`u∆ikñy
(!
	`iwl_mvm_·m_ª•_size_vÆid©i⁄
(
nŸif_vî
, 
pkt_Àn
)))

1233 i‡(
√w_≠i
) {

1234 i‡(
	`iwl_mvm_·m_ønge_ª•_vÆid
(
mvm
, 
fw_ª•_v8
->
ªque°_id
,

1235 
fw_ª•_v8
->
num_of_≠s
))

1238 
num_of_≠s
 = 
fw_ª•_v8
->num_of_aps;

1239 
œ°_ö_b©ch
 = 
fw_ª•_v8
->
œ°_ªp‹t
;

1241 i‡(
	`iwl_mvm_·m_ønge_ª•_vÆid
(
mvm
, 
fw_ª•_v5
->
ªque°_id
,

1242 
fw_ª•_v5
->
num_of_≠s
))

1245 
num_of_≠s
 = 
fw_ª•_v5
->num_of_aps;

1246 
œ°_ö_b©ch
 = 
fw_ª•_v5
->last_in_batch;

1249 
	`IWL_DEBUG_INFO
(
mvm
, "RangeÑesponseÑeceived\n");

1250 
	`IWL_DEBUG_INFO
(
mvm
, "request id: %lld,Çum ofÉntries: %u\n",

1251 
mvm
->
·m_öôüt‹
.
ªq
->
cookõ
, 
num_of_≠s
);

1253 
i
 = 0; i < 
num_of_≠s
 && i < 
IWL_MVM_TOF_MAX_APS
; i++) {

1254 
cfg80211_pm§_ªsu…
 
ªsu…
 = {};

1255 
iwl_tof_ønge_r•_≠_íåy_¡fy_v6
 *
fw_≠
;

1256 
≥î_idx
;

1258 i‡(
√w_≠i
) {

1259 i‡(
nŸif_vî
 >= 8) {

1260 
fw_≠
 = &
fw_ª•_v8
->
≠
[
i
];

1261 
	`iwl_mvm_·m_∑¢_upd©e_≤
(
mvm
, 
fw_≠
);

1262 } i‡(
nŸif_vî
 == 7) {

1263 
fw_≠
 = (*)&
fw_ª•_v7
->
≠
[
i
];

1265 
fw_≠
 = (*)&
fw_ª•_v6
->
≠
[
i
];

1268 
ªsu…
.
föÆ
 = 
fw_≠
->
œ°_bur°
;

1269 
ªsu…
.
≠_tsf
 = 
	`À32_to_˝u
(
fw_≠
->
°¨t_tsf
);

1270 
ªsu…
.
≠_tsf_vÆid
 = 1;

1273 
fw_≠
 = (*)&
fw_ª•_v5
->
≠
[
i
];

1279 
ªsu…
.
föÆ
 = 0;

1282 
≥î_idx
 = 
	`iwl_mvm_·m_föd_≥î
(
mvm
->
·m_öôüt‹
.
ªq
,

1283 
fw_≠
->
bssid
);

1284 i‡(
≥î_idx
 < 0) {

1285 
	`IWL_WARN
(
mvm
,

1287 
fw_≠
->
bssid
, 
i
);

1291 
fw_≠
->
mósuª_°©us
) {

1292 
IWL_TOF_ENTRY_SUCCESS
:

1293 
ªsu…
.
°©us
 = 
NL80211_PMSR_STATUS_SUCCESS
;

1295 
IWL_TOF_ENTRY_TIMING_MEASURE_TIMEOUT
:

1296 
ªsu…
.
°©us
 = 
NL80211_PMSR_STATUS_TIMEOUT
;

1298 
IWL_TOF_ENTRY_NO_RESPONSE
:

1299 
ªsu…
.
°©us
 = 
NL80211_PMSR_STATUS_FAILURE
;

1300 
ªsu…
.
·m
.
Áûuª_ªas⁄
 =

1301 
NL80211_PMSR_FTM_FAILURE_NO_RESPONSE
;

1303 
IWL_TOF_ENTRY_REQUEST_REJECTED
:

1304 
ªsu…
.
°©us
 = 
NL80211_PMSR_STATUS_FAILURE
;

1305 
ªsu…
.
·m
.
Áûuª_ªas⁄
 =

1306 
NL80211_PMSR_FTM_FAILURE_PEER_BUSY
;

1307 
ªsu…
.
·m
.
busy_ªåy_time
 = 
fw_≠
->
ªfußl_≥riod
;

1310 
ªsu…
.
°©us
 = 
NL80211_PMSR_STATUS_FAILURE
;

1311 
ªsu…
.
·m
.
Áûuª_ªas⁄
 =

1312 
NL80211_PMSR_FTM_FAILURE_UNSPECIFIED
;

1315 
	`mem˝y
(
ªsu…
.
addr
, 
fw_≠
->
bssid
, 
ETH_ALEN
);

1316 
ªsu…
.
ho°_time
 = 
	`iwl_mvm_·m_gë_ho°_time
(
mvm
,

1317 
fw_≠
->
time°amp
);

1318 
ªsu…
.
ty≥
 = 
NL80211_PMSR_TYPE_FTM
;

1319 
ªsu…
.
·m
.
bur°_ödex
 = 
mvm
->
·m_öôüt‹
.
ª•⁄£s
[
≥î_idx
];

1320 
mvm
->
·m_öôüt‹
.
ª•⁄£s
[
≥î_idx
]++;

1321 
ªsu…
.
·m
.
rssi_avg
 = 
fw_≠
->
rssi
;

1322 
ªsu…
.
·m
.
rssi_avg_vÆid
 = 1;

1323 
ªsu…
.
·m
.
rssi_•ªad
 = 
fw_≠
->rssi_spread;

1324 
ªsu…
.
·m
.
rssi_•ªad_vÆid
 = 1;

1325 
ªsu…
.
·m
.
πt_avg
 = (
s32
)
	`À32_to_˝u
(
fw_≠
->
πt
);

1326 
ªsu…
.
·m
.
πt_avg_vÆid
 = 1;

1327 
ªsu…
.
·m
.
πt_v¨ün˚
 = 
	`À32_to_˝u
(
fw_≠
->rtt_variance);

1328 
ªsu…
.
·m
.
πt_v¨ün˚_vÆid
 = 1;

1329 
ªsu…
.
·m
.
πt_•ªad
 = 
	`À32_to_˝u
(
fw_≠
->rtt_spread);

1330 
ªsu…
.
·m
.
πt_•ªad_vÆid
 = 1;

1332 
	`iwl_mvm_·m_gë_lci_civic
(
mvm
, &
ªsu…
);

1334 
	`iwl_mvm_·m_πt_smoŸhög
(
mvm
, &
ªsu…
);

1336 
	`cfg80211_pm§_ªp‹t
(
mvm
->
·m_öôüt‹
.
ªq_wdev
,

1337 
mvm
->
·m_öôüt‹
.
ªq
,

1338 &
ªsu…
, 
GFP_KERNEL
);

1340 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1341 
IWL_UCODE_TLV_API_FTM_RTT_ACCURACY
))

1342 
	`IWL_DEBUG_INFO
(
mvm
, "RTT confidence: %u\n",

1343 
fw_≠
->
πtC⁄fidí˚
);

1345 
	`iwl_mvm_debug_ønge_ª•
(
mvm
, 
i
, &
ªsu…
);

1348 i‡(
œ°_ö_b©ch
) {

1349 
	`cfg80211_pm§_com∂ëe
(
mvm
->
·m_öôüt‹
.
ªq_wdev
,

1350 
mvm
->
·m_öôüt‹
.
ªq
,

1351 
GFP_KERNEL
);

1352 
	`iwl_mvm_·m_ª£t
(
mvm
);

1354 
	}
}

1356 
	$iwl_mvm_·m_lc_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

1358 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1359 c⁄° 
õì80211_mgmt
 *
mgmt
 = (*)
pkt
->
d©a
;

1360 
size_t
 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1361 
iwl_mvm_loc_íåy
 *
íåy
;

1362 c⁄° 
u8
 *
õs
, *
lci
, *
civic
, *
m§_õ
;

1363 
size_t
 
õs_Àn
, 
lci_Àn
 = 0, 
civic_Àn
 = 0;

1364 
size_t
 
ba£Àn
 = 
IEEE80211_MIN_ACTION_SIZE
 +

1365 (
mgmt
->
u
.
a˘i⁄
.u.
·m
);

1366 c⁄° 
u8
 
Ωπ_ty≥_lci
 = 
IEEE80211_SPCT_MSR_RPRT_TYPE_LCI
;

1367 c⁄° 
u8
 
Ωπ_ty≥_civic
 = 
IEEE80211_SPCT_MSR_RPRT_TYPE_CIVIC
;

1369 i‡(
Àn
 <
ba£Àn
)

1372 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1374 
õs
 = 
mgmt
->
u
.
a˘i⁄
.u.
·m
.
v¨übÀ
;

1375 
õs_Àn
 = 
Àn
 - 
ba£Àn
;

1377 
m§_õ
 = 
	`cfg80211_föd_õ_m©ch
(
WLAN_EID_MEASURE_REPORT
, 
õs
, 
õs_Àn
,

1378 &
Ωπ_ty≥_lci
, 1, 4);

1379 i‡(
m§_õ
) {

1380 
lci
 = 
m§_õ
 + 2;

1381 
lci_Àn
 = 
m§_õ
[1];

1384 
m§_õ
 = 
	`cfg80211_föd_õ_m©ch
(
WLAN_EID_MEASURE_REPORT
, 
õs
, 
õs_Àn
,

1385 &
Ωπ_ty≥_civic
, 1, 4);

1386 i‡(
m§_õ
) {

1387 
civic
 = 
m§_õ
 + 2;

1388 
civic_Àn
 = 
m§_õ
[1];

1391 
íåy
 = 
	`kmÆloc
((*íåyË+ 
lci_Àn
 + 
civic_Àn
, 
GFP_KERNEL
);

1392 i‡(!
íåy
)

1395 
	`mem˝y
(
íåy
->
addr
, 
mgmt
->
bssid
, 
ETH_ALEN
);

1397 
íåy
->
lci_Àn
 =Üci_len;

1398 i‡(
lci_Àn
)

1399 
	`mem˝y
(
íåy
->
buf
, 
lci
, 
lci_Àn
);

1401 
íåy
->
civic_Àn
 = civic_len;

1402 i‡(
civic_Àn
)

1403 
	`mem˝y
(
íåy
->
buf
 + 
lci_Àn
, 
civic
, 
civic_Àn
);

1405 
	`li°_add_èû
(&
íåy
->
li°
, &
mvm
->
·m_öôüt‹
.
loc_li°
);

1406 
	}
}

	@mvm/ftm-responder.c

6 
	~<√t/cfg80211.h
>

7 
	~<löux/ëhîdevi˚.h
>

8 
	~"mvm.h
"

9 
	~"c⁄°™ts.h
"

11 
	siwl_mvm_∑¢_°a
 {

12 
li°_hód
 
	mli°
;

13 
iwl_mvm_öt_°a
 
	möt_°a
;

14 
u8
 
	maddr
[
ETH_ALEN
];

17 
õì80211_key_c⁄f
 
	mkeyc⁄f
;

20 
	siwl_mvm_∑¢_h…k_d©a
 {

21 
u8
 *
	maddr
;

22 
u8
 
	mcùhî
;

23 
u8
 *
	mh…k
;

26 
	$iwl_mvm_·m_ª•⁄dî_£t_bw_v1
(
cfg80211_ch™_def
 *
ch™def
,

27 
u8
 *
bw
, u8 *
˘æ_ch_posôi⁄
)

29 
ch™def
->
width
) {

30 
NL80211_CHAN_WIDTH_20_NOHT
:

31 *
bw
 = 
IWL_TOF_BW_20_LEGACY
;

33 
NL80211_CHAN_WIDTH_20
:

34 *
bw
 = 
IWL_TOF_BW_20_HT
;

36 
NL80211_CHAN_WIDTH_40
:

37 *
bw
 = 
IWL_TOF_BW_40
;

38 *
˘æ_ch_posôi⁄
 = 
	`iwl_mvm_gë_˘æ_pos
(
ch™def
);

40 
NL80211_CHAN_WIDTH_80
:

41 *
bw
 = 
IWL_TOF_BW_80
;

42 *
˘æ_ch_posôi⁄
 = 
	`iwl_mvm_gë_˘æ_pos
(
ch™def
);

45  -
EOPNOTSUPP
;

49 
	}
}

51 
	$iwl_mvm_·m_ª•⁄dî_£t_bw_v2
(
cfg80211_ch™_def
 *
ch™def
,

52 
u8
 *
f‹m©_bw
, u8 *
˘æ_ch_posôi⁄
,

53 
u8
 
cmd_vî
)

55 
ch™def
->
width
) {

56 
NL80211_CHAN_WIDTH_20_NOHT
:

57 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_LEGACY
;

58 *
f‹m©_bw
 |
IWL_LOCATION_BW_20MHZ
 << 
LOCATION_BW_POS
;

60 
NL80211_CHAN_WIDTH_20
:

61 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_HT
;

62 *
f‹m©_bw
 |
IWL_LOCATION_BW_20MHZ
 << 
LOCATION_BW_POS
;

64 
NL80211_CHAN_WIDTH_40
:

65 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_HT
;

66 *
f‹m©_bw
 |
IWL_LOCATION_BW_40MHZ
 << 
LOCATION_BW_POS
;

67 *
˘æ_ch_posôi⁄
 = 
	`iwl_mvm_gë_˘æ_pos
(
ch™def
);

69 
NL80211_CHAN_WIDTH_80
:

70 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_VHT
;

71 *
f‹m©_bw
 |
IWL_LOCATION_BW_80MHZ
 << 
LOCATION_BW_POS
;

72 *
˘æ_ch_posôi⁄
 = 
	`iwl_mvm_gë_˘æ_pos
(
ch™def
);

74 
NL80211_CHAN_WIDTH_160
:

75 i‡(
cmd_vî
 >= 9) {

76 *
f‹m©_bw
 = 
IWL_LOCATION_FRAME_FORMAT_HE
;

77 *
f‹m©_bw
 |
IWL_LOCATION_BW_160MHZ
 << 
LOCATION_BW_POS
;

78 *
˘æ_ch_posôi⁄
 = 
	`iwl_mvm_gë_˘æ_pos
(
ch™def
);

81 
ÁŒthrough
;

83  -
EOPNOTSUPP
;

87 
	}
}

90 
	$iwl_mvm_·m_ª•⁄dî_£t_ndp
(
iwl_mvm
 *
mvm
,

91 
iwl_tof_ª•⁄dî_c⁄fig_cmd_v9
 *
cmd
)

94 
u32
 
r2i_max_°s
 = 
IWL_MVM_FTM_R2I_MAX_STS
 < 2 ?

95 
IWL_MVM_FTM_R2I_MAX_STS
 : 1;

97 
cmd
->
r2i_ndp_∑øms
 = 
IWL_MVM_FTM_R2I_MAX_REP
 |

98 (
r2i_max_°s
 << 
IWL_RESPONDER_STS_POS
) |

99 (
IWL_MVM_FTM_R2I_MAX_TOTAL_LTF
 << 
IWL_RESPONDER_TOTAL_LTF_POS
);

100 
cmd
->
i2r_ndp_∑øms
 = 
IWL_MVM_FTM_I2R_MAX_REP
 |

101 (
IWL_MVM_FTM_I2R_MAX_STS
 << 
IWL_RESPONDER_STS_POS
) |

102 (
IWL_MVM_FTM_I2R_MAX_TOTAL_LTF
 << 
IWL_RESPONDER_TOTAL_LTF_POS
);

103 
cmd
->
cmd_vÆid_fõlds
 |=

104 
	`˝u_to_À32
(
IWL_TOF_RESPONDER_CMD_VALID_NDP_PARAMS
);

105 
	}
}

108 
	$iwl_mvm_·m_ª•⁄dî_cmd
(
iwl_mvm
 *
mvm
,

109 
õì80211_vif
 *
vif
,

110 
cfg80211_ch™_def
 *
ch™def
,

111 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

113 
u32
 
cmd_id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RESPONDER_CONFIG_CMD
);

114 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

120 
iwl_tof_ª•⁄dî_c⁄fig_cmd_v9
 
cmd
 = {

121 .
ch™√l_num
 = 
ch™def
->
ch™
->
hw_vÆue
,

122 .
cmd_vÆid_fõlds
 =

123 
	`˝u_to_À32
(
IWL_TOF_RESPONDER_CMD_VALID_CHAN_INFO
 |

124 
IWL_TOF_RESPONDER_CMD_VALID_BSSID
 |

125 
IWL_TOF_RESPONDER_CMD_VALID_STA_ID
),

126 .
°a_id
 = 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
]->
bˇ°_°a
.sta_id,

128 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
, 6);

129 
îr
;

130 
cmd_size
;

132 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

135 i‡(
cmd_vî
 == 9) {

136 
cmd
.
cmd_vÆid_fõlds
 |=

137 
	`˝u_to_À32
(
IWL_TOF_RESPONDER_CMD_VALID_BSS_COLOR
 |

138 
IWL_TOF_RESPONDER_CMD_VALID_MIN_MAX_TIME_BETWEEN_MSR
);

139 
cmd
.
bss_cﬁ‹
 = 1;

140 
cmd
.
mö_time_bëwìn_m§
 =

141 
	`˝u_to_À16
(
IWL_MVM_FTM_NON_TB_MIN_TIME_BETWEEN_MSR
);

142 
cmd
.
max_time_bëwìn_m§
 =

143 
	`˝u_to_À16
(
IWL_MVM_FTM_NON_TB_MAX_TIME_BETWEEN_MSR
);

144 
cmd_size
 = (
iwl_tof_ª•⁄dî_c⁄fig_cmd_v9
);

147 
cmd_size
 = (
iwl_tof_ª•⁄dî_c⁄fig_cmd_v8
);

150 i‡(
cmd_vî
 >= 8)

151 
	`iwl_mvm_·m_ª•⁄dî_£t_ndp
(
mvm
, &
cmd
);

153 i‡(
cmd_vî
 >= 7)

154 
îr
 = 
	`iwl_mvm_·m_ª•⁄dî_£t_bw_v2
(
ch™def
, &
cmd
.
f‹m©_bw
,

155 &
cmd
.
˘æ_ch_posôi⁄
,

156 
cmd_vî
);

158 
îr
 = 
	`iwl_mvm_·m_ª•⁄dî_£t_bw_v1
(
ch™def
, &
cmd
.
f‹m©_bw
,

159 &
cmd
.
˘æ_ch_posôi⁄
);

161 i‡(
îr
) {

162 
	`IWL_ERR
(
mvm
, "FailedÅo setÑesponder bandwidth\n");

163  
îr
;

166 
	`mem˝y
(
cmd
.
bssid
, 
vif
->
addr
, 
ETH_ALEN
);

168  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
cmd_size
, &
cmd
);

169 
	}
}

172 
	$iwl_mvm_·m_ª•⁄dî_dyn_cfg_v2
(
iwl_mvm
 *
mvm
,

173 
õì80211_vif
 *
vif
,

174 
õì80211_·m_ª•⁄dî_∑øms
 *
∑øms
)

176 
iwl_tof_ª•⁄dî_dyn_c⁄fig_cmd_v2
 
cmd
 = {

177 .
lci_Àn
 = 
	`˝u_to_À32
(
∑øms
->lci_len + 2),

178 .
civic_Àn
 = 
	`˝u_to_À32
(
∑øms
->
civi˛oc_Àn
 + 2),

180 
u8
 
d©a
[
IWL_LCI_CIVIC_IE_MAX_SIZE
] = {0};

181 
iwl_ho°_cmd
 
hcmd
 = {

182 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RESPONDER_DYN_CONFIG_CMD
),

183 .
d©a
[0] = &
cmd
,

184 .
Àn
[0] = (
cmd
),

185 .
d©a
[1] = &data,

188 .
d©aÊags
[1] = 
IWL_HCMD_DFL_DUP
,

190 
u32
 
Æig√d_lci_Àn
 = 
	`ALIGN
(
∑øms
->
lci_Àn
 + 2, 4);

191 
u32
 
Æig√d_civi˛oc_Àn
 = 
	`ALIGN
(
∑øms
->
civi˛oc_Àn
 + 2, 4);

192 
u8
 *
pos
 = 
d©a
;

194 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

196 i‡(
Æig√d_lci_Àn
 + 
Æig√d_civi˛oc_Àn
 > (
d©a
)) {

197 
	`IWL_ERR
(
mvm
, "LCI/civicloc dataÅoo big (%zd + %zd)\n",

198 
∑øms
->
lci_Àn
,Ö¨ams->
civi˛oc_Àn
);

199  -
ENOBUFS
;

202 
pos
[0] = 
WLAN_EID_MEASURE_REPORT
;

203 
pos
[1] = 
∑øms
->
lci_Àn
;

204 
	`mem˝y
(
pos
 + 2, 
∑øms
->
lci
,Ö¨ams->
lci_Àn
);

206 
pos
 +
Æig√d_lci_Àn
;

207 
pos
[0] = 
WLAN_EID_MEASURE_REPORT
;

208 
pos
[1] = 
∑øms
->
civi˛oc_Àn
;

209 
	`mem˝y
(
pos
 + 2, 
∑øms
->
civi˛oc
,Ö¨ams->
civi˛oc_Àn
);

211 
hcmd
.
Àn
[1] = 
Æig√d_lci_Àn
 + 
Æig√d_civi˛oc_Àn
;

213  
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

214 
	}
}

217 
	$iwl_mvm_·m_ª•⁄dî_dyn_cfg_v3
(
iwl_mvm
 *
mvm
,

218 
õì80211_vif
 *
vif
,

219 
õì80211_·m_ª•⁄dî_∑øms
 *
∑øms
,

220 
iwl_mvm_∑¢_h…k_d©a
 *
h…k_d©a
)

222 
iwl_tof_ª•⁄dî_dyn_c⁄fig_cmd
 
cmd
;

223 
iwl_ho°_cmd
 
hcmd
 = {

224 .
id
 = 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RESPONDER_DYN_CONFIG_CMD
),

225 .
d©a
[0] = &
cmd
,

226 .
Àn
[0] = (
cmd
),

228 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

231 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

233 
cmd
.
vÆid_Êags
 = 0;

235 i‡(
∑øms
) {

236 i‡(
∑øms
->
lci_Àn
 + 2 > (
cmd
.
lci_buf
) ||

237 
∑øms
->
civi˛oc_Àn
 + 2 > (
cmd
.
civic_buf
)) {

238 
	`IWL_ERR
(
mvm
,

240 
∑øms
->
lci_Àn
,Ö¨ams->
civi˛oc_Àn
);

241  -
ENOBUFS
;

244 
cmd
.
lci_buf
[0] = 
WLAN_EID_MEASURE_REPORT
;

245 
cmd
.
lci_buf
[1] = 
∑øms
->
lci_Àn
;

246 
	`mem˝y
(
cmd
.
lci_buf
 + 2, 
∑øms
->
lci
,Ö¨ams->
lci_Àn
);

247 
cmd
.
lci_Àn
 = 
∑øms
->lci_len + 2;

249 
cmd
.
civic_buf
[0] = 
WLAN_EID_MEASURE_REPORT
;

250 
cmd
.
civic_buf
[1] = 
∑øms
->
civi˛oc_Àn
;

251 
	`mem˝y
(
cmd
.
civic_buf
 + 2, 
∑øms
->
civi˛oc
,

252 
∑øms
->
civi˛oc_Àn
);

253 
cmd
.
civic_Àn
 = 
∑øms
->
civi˛oc_Àn
 + 2;

255 
cmd
.
vÆid_Êags
 |
IWL_RESPONDER_DYN_CFG_VALID_LCI
 |

256 
IWL_RESPONDER_DYN_CFG_VALID_CIVIC
;

259 i‡(
h…k_d©a
) {

260 i‡(
h…k_d©a
->
cùhî
 > 
IWL_LOCATION_CIPHER_GCMP_256
) {

261 
	`IWL_ERR
(
mvm
, "invalid cipher: %u\n",

262 
h…k_d©a
->
cùhî
);

263  -
EINVAL
;

266 
cmd
.
cùhî
 = 
h…k_d©a
->cipher;

267 
	`mem˝y
(
cmd
.
addr
, 
h…k_d©a
->addr, (cmd.addr));

268 
	`mem˝y
(
cmd
.
h…k_buf
, 
h…k_d©a
->
h…k
, (cmd.hltk_buf));

269 
cmd
.
vÆid_Êags
 |
IWL_RESPONDER_DYN_CFG_VALID_PASN_STA
;

272  
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

273 
	}
}

276 
	$iwl_mvm_·m_ª•⁄dî_dyn_cfg_cmd
(
iwl_mvm
 *
mvm
,

277 
õì80211_vif
 *
vif
,

278 
õì80211_·m_ª•⁄dî_∑øms
 *
∑øms
)

280 
ªt
;

281 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

282 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RESPONDER_DYN_CONFIG_CMD
),

285 
cmd_vî
) {

287 
ªt
 = 
	`iwl_mvm_·m_ª•⁄dî_dyn_cfg_v2
(
mvm
, 
vif
,

288 
∑øms
);

291 
ªt
 = 
	`iwl_mvm_·m_ª•⁄dî_dyn_cfg_v3
(
mvm
, 
vif
,

292 
∑øms
, 
NULL
);

295 
	`IWL_ERR
(
mvm
, "Unsupported DYN_CONFIG_CMD version %u\n",

296 
cmd_vî
);

297 
ªt
 = -
EOPNOTSUPP
;

300  
ªt
;

301 
	}
}

303 
	$iwl_mvm_ª•_dñ_∑¢_°a
(
iwl_mvm
 *
mvm
,

304 
õì80211_vif
 *
vif
,

305 
iwl_mvm_∑¢_°a
 *
°a
)

307 
	`li°_dñ
(&
°a
->
li°
);

309 i‡(
°a
->
keyc⁄f
.
keyÀn
)

310 
	`iwl_mvm_£c_key_dñ_∑¢
(
mvm
, 
vif
, 
	`BIT
(
°a
->
öt_°a
.
°a_id
),

311 &
°a
->
keyc⁄f
);

313 i‡(
	`iwl_mvm_has_mld_≠i
(
mvm
->
fw
))

314 
	`iwl_mvm_mld_rm_°a_id
(
mvm
, 
°a
->
öt_°a
.
°a_id
);

316 
	`iwl_mvm_rm_°a_id
(
mvm
, 
vif
, 
°a
->
öt_°a
.
°a_id
);

318 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, &
°a
->
öt_°a
);

319 
	`k‰ì
(
°a
);

320 
	}
}

322 
	$iwl_mvm_·m_ª•odî_add_∑¢_°a
(
iwl_mvm
 *
mvm
,

323 
õì80211_vif
 *
vif
,

324 
u8
 *
addr
, 
u32
 
cùhî
, u8 *
tk
, u32 
tk_Àn
,

325 
u8
 *
h…k
, 
u32
 
h…k_Àn
)

327 
ªt
;

328 
iwl_mvm_∑¢_°a
 *
°a
 = 
NULL
;

329 
iwl_mvm_∑¢_h…k_d©a
 
h…k_d©a
 = {

330 .
addr
 =áddr,

331 .
h…k
 = hltk,

333 
iwl_mvm_∑¢_h…k_d©a
 *
h…k_d©a_±r
 = 
NULL
;

335 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

336 
	`WIDE_ID
(
LOCATION_GROUP
, 
TOF_RESPONDER_DYN_CONFIG_CMD
),

339 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

341 i‡(
cmd_vî
 < 3) {

342 
	`IWL_ERR
(
mvm
, "Adding PASN stationÇot supported by FW\n");

343  -
EOPNOTSUPP
;

346 i‡((!
h…k
 || !
h…k_Àn
Ë&& (!
tk
 || !
tk_Àn
)) {

347 
	`IWL_ERR
(
mvm
, "TKánd HLTKÇot set\n");

348  -
EINVAL
;

351 i‡(
h…k
 && 
h…k_Àn
) {

352 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

353 
IWL_UCODE_TLV_CAPA_SECURE_LTF_SUPPORT
)) {

354 
	`IWL_ERR
(
mvm
, "No support for secure LTF measurement\n");

355  -
EINVAL
;

358 
h…k_d©a
.
cùhî
 = 
	`iwl_mvm_cùhî_to_loˇti⁄_cùhî
(cipher);

359 i‡(
h…k_d©a
.
cùhî
 =
IWL_LOCATION_CIPHER_INVALID
) {

360 
	`IWL_ERR
(
mvm
, "övÆid cùhî: %u\n", 
cùhî
);

361  -
EINVAL
;

364 
h…k_d©a_±r
 = &
h…k_d©a
;

367 i‡(
tk
 && 
tk_Àn
) {

368 
°a
 = 
	`kzÆloc
((*°aË+ 
tk_Àn
, 
GFP_KERNEL
);

369 i‡(!
°a
)

370  -
ENOBUFS
;

372 
ªt
 = 
	`iwl_mvm_add_∑¢_°a
(
mvm
, 
vif
, &
°a
->
öt_°a
, 
addr
,

373 
cùhî
, 
tk
, 
tk_Àn
, &
°a
->
keyc⁄f
);

374 i‡(
ªt
) {

375 
	`k‰ì
(
°a
);

376  
ªt
;

379 
	`mem˝y
(
°a
->
addr
,áddr, 
ETH_ALEN
);

380 
	`li°_add_èû
(&
°a
->
li°
, &
mvm
->
ª•_∑¢_li°
);

383 
ªt
 = 
	`iwl_mvm_·m_ª•⁄dî_dyn_cfg_v3
(
mvm
, 
vif
, 
NULL
, 
h…k_d©a_±r
);

384 i‡(
ªt
 && 
°a
)

385 
	`iwl_mvm_ª•_dñ_∑¢_°a
(
mvm
, 
vif
, 
°a
);

387  
ªt
;

388 
	}
}

390 
	$iwl_mvm_·m_ª•_ªmove_∑¢_°a
(
iwl_mvm
 *
mvm
,

391 
õì80211_vif
 *
vif
, 
u8
 *
addr
)

393 
iwl_mvm_∑¢_°a
 *
°a
, *
¥ev
;

395 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

397 
	`li°_f‹_óch_íåy_ß„
(
°a
, 
¥ev
, &
mvm
->
ª•_∑¢_li°
, 
li°
) {

398 i‡(!
	`memcmp
(
°a
->
addr
,áddr, 
ETH_ALEN
)) {

399 
	`iwl_mvm_ª•_dñ_∑¢_°a
(
mvm
, 
vif
, 
°a
);

404 
	`IWL_ERR
(
mvm
, "FTM: PASN sèti⁄ %pMÇŸ found\n", 
addr
);

405  -
EINVAL
;

406 
	}
}

408 
	$iwl_mvm_·m_°¨t_ª•⁄dî
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

409 
õì80211_bss_c⁄f
 *
bss_c⁄f
)

411 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

412 
õì80211_·m_ª•⁄dî_∑øms
 *
∑øms
;

413 
õì80211_ch™˘x_c⁄f
 
˘x
, *
p˘x
;

414 
u16
 *
phy_˘xt_id
;

415 
iwl_mvm_phy_˘xt
 *
phy_˘xt
;

416 
ªt
;

418 
∑øms
 = 
bss_c⁄f
->
·mr_∑øms
;

420 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

422 i‡(
	`WARN_ON_ONCE
(!
bss_c⁄f
->
·m_ª•⁄dî
))

423  -
EINVAL
;

425 i‡(
vif
->
p2p
 || vif->
ty≥
 !
NL80211_IFTYPE_AP
 ||

426 !
mvmvif
->
≠_ibss_a˘ive
) {

427 
	`IWL_ERR
(
mvm
, "Cannot startÑesponder,Çot in AP mode\n");

428  -
EIO
;

431 
	`rcu_ªad_lock
();

432 
p˘x
 = 
	`rcu_dîe„ªn˚
(
bss_c⁄f
->
ch™˘x_c⁄f
);

436 
˘x
 = *
p˘x
;

437 
phy_˘xt_id
 = (
u16
 *)
p˘x
->
drv_¥iv
;

438 
	`rcu_ªad_u∆ock
();

440 
phy_˘xt
 = &
mvm
->
phy_˘xts
[*
phy_˘xt_id
];

441 
ªt
 = 
	`iwl_mvm_phy_˘xt_ch™ged
(
mvm
, 
phy_˘xt
, &
˘x
.
def
, &˘x.
≠
,

442 
˘x
.
rx_chaös_°©ic
,

443 
˘x
.
rx_chaös_dy«mic
);

444 i‡(
ªt
)

445  
ªt
;

447 
ªt
 = 
	`iwl_mvm_·m_ª•⁄dî_cmd
(
mvm
, 
vif
, &
˘x
.
def
, 
bss_c⁄f
);

448 i‡(
ªt
)

449  
ªt
;

451 i‡(
∑øms
)

452 
ªt
 = 
	`iwl_mvm_·m_ª•⁄dî_dyn_cfg_cmd
(
mvm
, 
vif
, 
∑øms
);

454  
ªt
;

455 
	}
}

457 
	$iwl_mvm_·m_ª•⁄dî_˛ór
(
iwl_mvm
 *
mvm
,

458 
õì80211_vif
 *
vif
)

460 
iwl_mvm_∑¢_°a
 *
°a
, *
¥ev
;

462 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

464 
	`li°_f‹_óch_íåy_ß„
(
°a
, 
¥ev
, &
mvm
->
ª•_∑¢_li°
, 
li°
)

465 
	`iwl_mvm_ª•_dñ_∑¢_°a
(
mvm
, 
vif
, 
°a
);

466 
	}
}

468 
	$iwl_mvm_·m_ª°¨t_ª•⁄dî
(
iwl_mvm
 *
mvm
,

469 
õì80211_vif
 *
vif
,

470 
õì80211_bss_c⁄f
 *
bss_c⁄f
)

472 i‡(!
bss_c⁄f
->
·m_ª•⁄dî
)

475 
	`iwl_mvm_·m_ª•⁄dî_˛ór
(
mvm
, 
vif
);

476 
	`iwl_mvm_·m_°¨t_ª•⁄dî
(
mvm
, 
vif
, 
bss_c⁄f
);

477 
	}
}

479 
	$iwl_mvm_·m_ª•⁄dî_°©s
(
iwl_mvm
 *
mvm
,

480 
iwl_rx_cmd_buf„r
 *
rxb
)

482 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

483 
iwl_·m_ª•⁄dî_°©s
 *
ª•
 = (*)
pkt
->
d©a
;

484 
cfg80211_·m_ª•⁄dî_°©s
 *
°©s
 = &
mvm
->
·m_ª•_°©s
;

485 
u32
 
Êags
 = 
	`À32_to_˝u
(
ª•
->flags);

487 i‡(
ª•
->
suc˚ss_·m
 =ª•->
·m_≥r_bur°
)

488 
°©s
->
suc˚ss_num
++;

489 i‡(
ª•
->
suc˚ss_·m
 >= 2)

490 
°©s
->
∑πül_num
++;

492 
°©s
->
Áûed_num
++;

494 i‡((
Êags
 & 
FTM_RESP_STAT_ASAP_REQ
) &&

495 (
Êags
 & 
FTM_RESP_STAT_ASAP_RESP
))

496 
°©s
->
aßp_num
++;

498 i‡(
Êags
 & 
FTM_RESP_STAT_NON_ASAP_RESP
)

499 
°©s
->
n⁄_aßp_num
++;

501 
°©s
->
tŸÆ_duøti⁄_ms
 +
	`À32_to_˝u
(
ª•
->
duøti⁄
Ë/ 
USEC_PER_MSEC
;

503 i‡(
Êags
 & 
FTM_RESP_STAT_TRIGGER_UNKNOWN
)

504 
°©s
->
unknown_åiggîs_num
++;

506 i‡(
Êags
 & 
FTM_RESP_STAT_DUP
)

507 
°©s
->
ªscheduÀ_ªque°s_num
++;

509 i‡(
Êags
 & 
FTM_RESP_STAT_NON_ASAP_OUT_WIN
)

510 
°©s
->
out_of_wödow_åiggîs_num
++;

511 
	}
}

	@mvm/fw-api.h

7 #i‚de‡
__fw_≠i_h__


8 
	#__fw_≠i_h__


	)

10 
	~"fw/≠i/tdls.h
"

11 
	~"fw/≠i/mac-cfg.h
"

12 
	~"fw/≠i/ofÊﬂd.h
"

13 
	~"fw/≠i/c⁄ãxt.h
"

14 
	~"fw/≠i/time-evít.h
"

15 
	~"fw/≠i/d©≠©h.h
"

16 
	~"fw/≠i/phy.h
"

17 
	~"fw/≠i/c⁄fig.h
"

18 
	~"fw/≠i/sy°em.h
"

19 
	~"fw/≠i/Æive.h
"

20 
	~"fw/≠i/bödög.h
"

21 
	~"fw/≠i/cmdhdr.h
"

22 
	~"fw/≠i/c€x.h
"

23 
	~"fw/≠i/comm™ds.h
"

24 
	~"fw/≠i/d3.h
"

25 
	~"fw/≠i/fûãr.h
"

26 
	~"fw/≠i/Àd.h
"

27 
	~"fw/≠i/mac.h
"

28 
	~"fw/≠i/nvm-ªg.h
"

29 
	~"fw/≠i/phy-˘xt.h
"

30 
	~"fw/≠i/powî.h
"

31 
	~"fw/≠i/rs.h
"

32 
	~"fw/≠i/rx.h
"

33 
	~"fw/≠i/sˇn.h
"

34 
	~"fw/≠i/sf.h
"

35 
	~"fw/≠i/°a.h
"

36 
	~"fw/≠i/°©s.h
"

37 
	~"fw/≠i/loˇti⁄.h
"

38 
	~"fw/≠i/tx.h
"

39 
	~"fw/≠i/rfi.h
"

	@mvm/fw.c

7 
	~<√t/mac80211.h
>

8 
	~<löux/√tdevi˚.h
>

9 
	~<löux/dmi.h
>

11 
	~"iwl-å™s.h
"

12 
	~"iwl-›-mode.h
"

13 
	~"fw/img.h
"

14 
	~"iwl-debug.h
"

15 
	~"iwl-¥ph.h
"

16 
	~"fw/a˝i.h
"

17 
	~"fw/≤vm.h
"

18 
	~"fw/uefi.h
"

19 
	~"fw/ªguœt‹y.h
"

21 
	~"mvm.h
"

22 
	~"fw/dbg.h
"

23 
	~"iwl-phy-db.h
"

24 
	~"iwl-mod∑øms.h
"

25 
	~"iwl-nvm-∑r£.h
"

26 
	~"time-sync.h
"

28 
	#MVM_UCODE_ALIVE_TIMEOUT
 (2 * 
HZ
)

	)

29 
	#MVM_UCODE_CALIB_TIMEOUT
 (2 * 
HZ
)

	)

31 
	#IWL_UATS_VLP_AP_SUPPORTED
 
	`BIT
(29)

	)

32 
	#IWL_UATS_AFC_AP_SUPPORTED
 
	`BIT
(30)

	)

34 
	siwl_mvm_Æive_d©a
 {

35 
boﬁ
 
	mvÆid
;

36 
u32
 
	mscd_ba£_addr
;

39 
	$iwl_£nd_tx_™t_cfg
(
iwl_mvm
 *
mvm
, 
u8
 
vÆid_tx_™t
)

41 
iwl_tx_™t_cfg_cmd
 
tx_™t_cmd
 = {

42 .
vÆid
 = 
	`˝u_to_À32
(
vÆid_tx_™t
),

45 
	`IWL_DEBUG_FW
(
mvm
, "£À˘ vÆidÅxá¡: %u\n", 
vÆid_tx_™t
);

46  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TX_ANT_CONFIGURATION_CMD
, 0,

47 (
tx_™t_cmd
), &tx_ant_cmd);

48 
	}
}

50 
	$iwl_£nd_rss_cfg_cmd
(
iwl_mvm
 *
mvm
)

52 
i
;

53 
iwl_rss_c⁄fig_cmd
 
cmd
 = {

54 .
Êags
 = 
	`˝u_to_À32
(
IWL_RSS_ENABLE
),

55 .
hash_mask
 = 
	`BIT
(
IWL_RSS_HASH_TYPE_IPV4_TCP
) |

56 
	`BIT
(
IWL_RSS_HASH_TYPE_IPV4_UDP
) |

57 
	`BIT
(
IWL_RSS_HASH_TYPE_IPV4_PAYLOAD
) |

58 
	`BIT
(
IWL_RSS_HASH_TYPE_IPV6_TCP
) |

59 
	`BIT
(
IWL_RSS_HASH_TYPE_IPV6_UDP
) |

60 
	`BIT
(
IWL_RSS_HASH_TYPE_IPV6_PAYLOAD
),

63 i‡(
mvm
->
å™s
->
num_rx_queues
 == 1)

67 
i
 = 0; i < 
	`ARRAY_SIZE
(
cmd
.
ödúe˘i⁄_èbÀ
); i++)

68 
cmd
.
ödúe˘i⁄_èbÀ
[
i
] =

69 1 + (
i
 % (
mvm
->
å™s
->
num_rx_queues
 - 1));

70 
	`√tdev_rss_key_fûl
(
cmd
.
£¸ë_key
, (cmd.secret_key));

72  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
RSS_CONFIG_CMD
, 0, (
cmd
), &cmd);

73 
	}
}

75 
	$iwl_mvm_£nd_dqa_cmd
(
iwl_mvm
 *
mvm
)

77 
iwl_dqa_íabÀ_cmd
 
dqa_cmd
 = {

78 .
cmd_queue
 = 
	`˝u_to_À32
(
IWL_MVM_DQA_CMD_QUEUE
),

80 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
DQA_ENABLE_CMD
);

81 
ªt
;

83 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, (
dqa_cmd
), &dqa_cmd);

84 i‡(
ªt
)

85 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd DQAÉ«blög comm™d: %d\n", 
ªt
);

87 
	`IWL_DEBUG_FW
(
mvm
, "Working in DQA mode\n");

89  
ªt
;

90 
	}
}

92 
	$iwl_mvm_mfu_as£π_dump_nŸif
(
iwl_mvm
 *
mvm
,

93 
iwl_rx_cmd_buf„r
 *
rxb
)

95 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

96 
iwl_mfu_as£π_dump_nŸif
 *
mfu_dump_nŸif
 = (*)
pkt
->
d©a
;

97 
__À32
 *
dump_d©a
 = 
mfu_dump_nŸif
->
d©a
;

98 
n_w‹ds
 = 
	`À32_to_˝u
(
mfu_dump_nŸif
->
d©a_size
Ë/ (
__À32
);

99 
i
;

101 i‡(
mfu_dump_nŸif
->
ödex_num
 == 0)

102 
	`IWL_INFO
(
mvm
, "MFUARTássert id 0x%x occurred\n",

103 
	`À32_to_˝u
(
mfu_dump_nŸif
->
as£π_id
));

105 
i
 = 0; i < 
n_w‹ds
; i++)

106 
	`IWL_DEBUG_INFO
(
mvm
,

108 
	`À16_to_˝u
(
mfu_dump_nŸif
->
ödex_num
) *

109 
n_w‹ds
 + 
i
,

110 
	`À32_to_˝u
(
dump_d©a
[
i
]));

111 
	}
}

113 
boﬁ
 
	$iwl_Æive_‚
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

114 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

116 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

117 
iwl_mvm
 *
mvm
 =

118 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

119 
iwl_mvm_Æive_d©a
 *
Æive_d©a
 = 
d©a
;

120 
iwl_umac_Æive
 *
umac
;

121 
iwl_lmac_Æive
 *
lmac1
;

122 
iwl_lmac_Æive
 *
lmac2
 = 
NULL
;

123 
u16
 
°©us
;

124 
u32
 
lmac_îr‹_evít_èbÀ
, 
umac_îr‹_èbÀ
;

125 
u32
 
vîsi⁄
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

126 
UCODE_ALIVE_NTFY
, 0);

127 
u32
 
i
;

130 i‡(
vîsi⁄
 == 6) {

131 
iwl_Æive_¡f_v6
 *
∑live
;

133 i‡(
pkt_Àn
 < (*
∑live
))

134  
Ál£
;

136 
∑live
 = (*)
pkt
->
d©a
;

137 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_íabÀ
 =

138 
	`À32_to_˝u
(
∑live
->
imr
.
íabÀd
);

139 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_size
 =

140 
	`À32_to_˝u
(
∑live
->
imr
.
size
);

141 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr2§am_ªmaöbyã
 =

142 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_size
;

143 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_ba£_addr
 =

144 
∑live
->
imr
.
ba£_addr
;

145 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_cuº_addr
 =

146 
	`À64_to_˝u
(
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_ba£_addr
);

147 
	`IWL_DEBUG_FW
(
mvm
, "IMR Enabled: 0x0%x size 0x0%x Address 0x%016llx\n",

148 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_íabÀ
,

149 
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_size
,

150 
	`À64_to_˝u
(
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_ba£_addr
));

152 i‡(!
mvm
->
å™s
->
dbg
.
imr_d©a
.
imr_íabÀ
) {

153 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvm
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
); i++) {

154 
iwl_ucode_év
 *
ªg_év
;

155 
iwl_fw_öi_ªgi⁄_év
 *
ªg
;

157 
ªg_év
 = 
mvm
->
å™s
->
dbg
.
a˘ive_ªgi⁄s
[
i
];

158 i‡(!
ªg_év
)

161 
ªg
 = (*)
ªg_év
->
d©a
;

167 i‡(
ªg
->
ty≥
 =
IWL_FW_INI_REGION_DRAM_IMR
) {

168 
mvm
->
å™s
->
dbg
.
unsuµ‹ãd_ªgi⁄_msk
 |
	`BIT
(
i
);

175 i‡(
vîsi⁄
 >= 5) {

176 
iwl_Æive_¡f_v5
 *
∑live
;

178 i‡(
pkt_Àn
 < (*
∑live
))

179  
Ál£
;

181 
∑live
 = (*)
pkt
->
d©a
;

182 
umac
 = &
∑live
->
umac_d©a
;

183 
lmac1
 = &
∑live
->
lmac_d©a
[0];

184 
lmac2
 = &
∑live
->
lmac_d©a
[1];

185 
°©us
 = 
	`À16_to_˝u
(
∑live
->status);

187 
mvm
->
å™s
->
sku_id
[0] = 
	`À32_to_˝u
(
∑live
->sku_id.
d©a
[0]);

188 
mvm
->
å™s
->
sku_id
[1] = 
	`À32_to_˝u
(
∑live
->sku_id.
d©a
[1]);

189 
mvm
->
å™s
->
sku_id
[2] = 
	`À32_to_˝u
(
∑live
->sku_id.
d©a
[2]);

191 
	`IWL_DEBUG_FW
(
mvm
, "Got sku_id: 0x0%x 0x0%x 0x0%x\n",

192 
mvm
->
å™s
->
sku_id
[0],

193 
mvm
->
å™s
->
sku_id
[1],

194 
mvm
->
å™s
->
sku_id
[2]);

195 } i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë=(
iwl_Æive_¡f_v4
)) {

196 
iwl_Æive_¡f_v4
 *
∑live
;

198 i‡(
pkt_Àn
 < (*
∑live
))

199  
Ál£
;

201 
∑live
 = (*)
pkt
->
d©a
;

202 
umac
 = &
∑live
->
umac_d©a
;

203 
lmac1
 = &
∑live
->
lmac_d©a
[0];

204 
lmac2
 = &
∑live
->
lmac_d©a
[1];

205 
°©us
 = 
	`À16_to_˝u
(
∑live
->status);

206 } i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
) ==

207 (
iwl_Æive_¡f_v3
)) {

208 
iwl_Æive_¡f_v3
 *
∑live3
;

210 i‡(
pkt_Àn
 < (*
∑live3
))

211  
Ál£
;

213 
∑live3
 = (*)
pkt
->
d©a
;

214 
umac
 = &
∑live3
->
umac_d©a
;

215 
lmac1
 = &
∑live3
->
lmac_d©a
;

216 
°©us
 = 
	`À16_to_˝u
(
∑live3
->status);

218 
	`WARN
(1, "unsupportedáliveÇotification (size %d)\n",

219 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
));

221  
Ál£
;

224 
lmac_îr‹_evít_èbÀ
 =

225 
	`À32_to_˝u
(
lmac1
->
dbg_±rs
.
îr‹_evít_èbÀ_±r
);

226 
	`iwl_fw_lmac1_£t_Æive_îr_èbÀ
(
mvm
->
å™s
, 
lmac_îr‹_evít_èbÀ
);

228 i‡(
lmac2
)

229 
mvm
->
å™s
->
dbg
.
lmac_îr‹_evít_èbÀ
[1] =

230 
	`À32_to_˝u
(
lmac2
->
dbg_±rs
.
îr‹_evít_èbÀ_±r
);

232 
umac_îr‹_èbÀ
 = 
	`À32_to_˝u
(
umac
->
dbg_±rs
.
îr‹_öfo_addr
) &

233 ~
FW_ADDR_CACHE_CONTROL
;

235 i‡(
umac_îr‹_èbÀ
) {

236 i‡(
umac_îr‹_èbÀ
 >=

237 
mvm
->
å™s
->
cfg
->
mö_umac_îr‹_evít_èbÀ
) {

238 
	`iwl_fw_umac_£t_Æive_îr_èbÀ
(
mvm
->
å™s
,

239 
umac_îr‹_èbÀ
);

241 
	`IWL_ERR
(
mvm
,

243 
umac_îr‹_èbÀ
,

244 (
mvm
->
fwπ
.
cur_fw_img
 =
IWL_UCODE_INIT
) ?

249 
Æive_d©a
->
scd_ba£_addr
 = 
	`À32_to_˝u
(
lmac1
->
dbg_±rs
.
scd_ba£_±r
);

250 
Æive_d©a
->
vÆid
 = 
°©us
 =
IWL_ALIVE_STATUS_OK
;

252 
	`IWL_DEBUG_FW
(
mvm
,

254 
°©us
, 
lmac1
->
vî_ty≥
,Ümac1->
vî_subty≥
);

256 i‡(
lmac2
)

257 
	`IWL_DEBUG_FW
(
mvm
, "Alive ucode CDB\n");

259 
	`IWL_DEBUG_FW
(
mvm
,

261 
	`À32_to_˝u
(
umac
->
umac_maj‹
),

262 
	`À32_to_˝u
(
umac
->
umac_mö‹
));

264 
	`iwl_fwπ_upd©e_fw_vîsi⁄s
(&
mvm
->
fwπ
, 
lmac1
, 
umac
);

266  
åue
;

267 
	}
}

269 
boﬁ
 
	$iwl_waô_öô_com∂ëe
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

270 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

272 
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
INIT_COMPLETE_NOTIF
);

274  
åue
;

275 
	}
}

277 
boﬁ
 
	$iwl_waô_phy_db_íåy
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

278 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

280 
iwl_phy_db
 *
phy_db
 = 
d©a
;

282 i‡(
pkt
->
hdr
.
cmd
 !
CALIB_RES_NOTIF_PHY_DB
) {

283 
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
INIT_COMPLETE_NOTIF
);

284  
åue
;

287 
	`WARN_ON
(
	`iwl_phy_db_£t_£˘i⁄
(
phy_db
, 
pkt
));

289  
Ál£
;

290 
	}
}

292 
	$iwl_mvm_¥öt_pd_nŸifiˇti⁄
(
iwl_mvm
 *
mvm
)

294 
	#IWL_FW_PRINT_REG_INFO
(
ªg_«me
) \

295 
	`IWL_ERR
(
mvm
, #ªg_«mê": 0x%x\n", 
	`iwl_ªad_umac_¥ph
(
å™s
, 
ªg_«me
))

	)

297 
iwl_å™s
 *
å™s
 = 
mvm
->trans;

298 
iwl_devi˚_Ámûy
 
devi˚_Ámûy
 = 
å™s
->
å™s_cfg
->device_family;

300 i‡(
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_8000
)

303 i‡(
devi˚_Ámûy
 <
IWL_DEVICE_FAMILY_9000
)

304 
	`IWL_FW_PRINT_REG_INFO
(
WFPM_ARC1_PD_NOTIFICATION
);

306 
	`IWL_FW_PRINT_REG_INFO
(
WFPM_LMAC1_PD_NOTIFICATION
);

308 
	`IWL_FW_PRINT_REG_INFO
(
HPM_SECONDARY_DEVICE_STATE
);

311 
	`IWL_FW_PRINT_REG_INFO
(
WFPM_MAC_OTP_CFG7_ADDR
);

312 
	`IWL_FW_PRINT_REG_INFO
(
WFPM_MAC_OTP_CFG7_DATA
);

313 
	}
}

315 
	$iwl_mvm_lﬂd_ucode_waô_Æive
(
iwl_mvm
 *
mvm
,

316 
iwl_ucode_ty≥
 
ucode_ty≥
)

318 
iwl_nŸifiˇti⁄_waô
 
Æive_waô
;

319 
iwl_mvm_Æive_d©a
 
Æive_d©a
 = {};

320 c⁄° 
fw_img
 *
fw
;

321 
ªt
;

322 
iwl_ucode_ty≥
 
ﬁd_ty≥
 = 
mvm
->
fwπ
.
cur_fw_img
;

323 c⁄° 
u16
 
Æive_cmd
[] = { 
UCODE_ALIVE_NTFY
 };

324 
boﬁ
 
run_ö_rfkûl
 =

325 
ucode_ty≥
 =
IWL_UCODE_INIT
 || 
	`iwl_mvm_has_unifõd_ucode
(
mvm
);

326 
u8
 
cou¡
;

327 
iwl_pc_d©a
 *
pc_d©a
;

329 i‡(
ucode_ty≥
 =
IWL_UCODE_REGULAR
 &&

330 
	`iwl_fw_dbg_c⁄f_u¢if„r
(
mvm
->
fw
, 
FW_DBG_START_FROM_ALIVE
) &&

331 !(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

332 
IWL_UCODE_TLV_CAPA_USNIFFER_UNIFIED
)))

333 
fw
 = 
	`iwl_gë_ucode_image
(
mvm
->fw, 
IWL_UCODE_REGULAR_USNIFFER
);

335 
fw
 = 
	`iwl_gë_ucode_image
(
mvm
->fw, 
ucode_ty≥
);

336 i‡(
	`WARN_ON
(!
fw
))

337  -
EINVAL
;

338 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
ucode_ty≥
);

339 
	`˛ór_bô
(
IWL_MVM_STATUS_FIRMWARE_RUNNING
, &
mvm
->
°©us
);

341 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
Æive_waô
,

342 
Æive_cmd
, 
	`ARRAY_SIZE
(alive_cmd),

343 
iwl_Æive_‚
, &
Æive_d©a
);

350 
ªt
 = 
	`iwl_å™s_°¨t_fw
(
mvm
->
å™s
, 
fw
, 
run_ö_rfkûl
);

351 i‡(
ªt
) {

352 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
ﬁd_ty≥
);

353 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
Æive_waô
);

354  
ªt
;

361 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
Æive_waô
,

362 
MVM_UCODE_ALIVE_TIMEOUT
);

364 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 ==

365 
IWL_DEVICE_FAMILY_AX210
) {

367 
	`IWL_INFO
(
mvm
, "WFPM_UMAC_PD_NOTIFICATION: 0x%x\n",

368 
	`iwl_ªad_umac_¥ph
(
mvm
->
å™s
, 
WFPM_ARC1_PD_NOTIFICATION
));

369 
	`IWL_INFO
(
mvm
, "WFPM_LMAC2_PD_NOTIFICATION: 0x%x\n",

370 
	`iwl_ªad_umac_¥ph
(
mvm
->
å™s
, 
WFPM_LMAC2_PD_NOTIFICATION
));

371 
	`IWL_INFO
(
mvm
, "WFPM_AUTH_KEY_0: 0x%x\n",

372 
	`iwl_ªad_umac_¥ph
(
mvm
->
å™s
, 
SB_MODIFY_CFG_FLAG
));

373 
	`IWL_INFO
(
mvm
, "CNVI_SCU_SEQ_DATA_DW9: 0x%x\n",

374 
	`iwl_ªad_¥ph
(
mvm
->
å™s
, 
CNVI_SCU_SEQ_DATA_DW9
));

377 i‡(
ªt
) {

378 
iwl_å™s
 *
å™s
 = 
mvm
->trans;

381 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

382 
IWL_DEVICE_FAMILY_22000
) {

383 
	`IWL_ERR
(
mvm
,

385 
	`iwl_ªad_umac_¥ph
(
å™s
, 
UMAG_SB_CPU_1_STATUS
),

386 
	`iwl_ªad_umac_¥ph
(
å™s
,

387 
UMAG_SB_CPU_2_STATUS
));

388 } i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

389 
IWL_DEVICE_FAMILY_8000
) {

390 
	`IWL_ERR
(
mvm
,

392 
	`iwl_ªad_¥ph
(
å™s
, 
SB_CPU_1_STATUS
),

393 
	`iwl_ªad_¥ph
(
å™s
, 
SB_CPU_2_STATUS
));

396 
	`iwl_mvm_¥öt_pd_nŸifiˇti⁄
(
mvm
);

399 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

400 
IWL_DEVICE_FAMILY_22000
) {

401 
pc_d©a
 = 
å™s
->
dbg
.pc_data;

402 
cou¡
 = 0; cou¡ < 
å™s
->
dbg
.
num_pc
;

403 
cou¡
++, 
pc_d©a
++)

404 
	`IWL_ERR
(
mvm
, "%s: 0x%x\n",

405 
pc_d©a
->
pc_«me
,

406 
pc_d©a
->
pc_addªss
);

407 } i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

408 
IWL_DEVICE_FAMILY_9000
) {

409 
	`IWL_ERR
(
mvm
, "UMAC PC: 0x%x\n",

410 
	`iwl_ªad_umac_¥ph
(
å™s
,

411 
UREG_UMAC_CURRENT_PC
));

412 
	`IWL_ERR
(
mvm
, "LMAC PC: 0x%x\n",

413 
	`iwl_ªad_umac_¥ph
(
å™s
,

414 
UREG_LMAC1_CURRENT_PC
));

415 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
))

416 
	`IWL_ERR
(
mvm
, "LMAC2 PC: 0x%x\n",

417 
	`iwl_ªad_umac_¥ph
(
å™s
,

418 
UREG_LMAC2_CURRENT_PC
));

421 i‡(
ªt
 =-
ETIMEDOUT
 && !
mvm
->
∂dr_sync
)

422 
	`iwl_fw_dbg_îr‹_cﬁÀ˘
(&
mvm
->
fwπ
,

423 
FW_DBG_TRIGGER_ALIVE_TIMEOUT
);

425 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
ﬁd_ty≥
);

426  
ªt
;

429 i‡(!
Æive_d©a
.
vÆid
) {

430 
	`IWL_ERR
(
mvm
, "Loaded ucode isÇot valid!\n");

431 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
ﬁd_ty≥
);

432  -
EIO
;

436 
	`iwl_mei_Æive_nŸif
(
åue
);

438 
ªt
 = 
	`iwl_≤vm_lﬂd
(
mvm
->
å™s
, &mvm->
nŸif_waô
,

439 &
mvm
->
fw
->
ucode_ˇ∑
);

440 i‡(
ªt
) {

441 
	`IWL_ERR
(
mvm
, "Timeout waiting for PNVMÜoad!\n");

442 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
ﬁd_ty≥
);

443  
ªt
;

446 
	`iwl_å™s_fw_Æive
(
mvm
->
å™s
, 
Æive_d©a
.
scd_ba£_addr
);

457 
	`mem£t
(&
mvm
->
queue_öfo
, 0, (mvm->queue_info));

464 
mvm
->
queue_öfo
[
IWL_MVM_DQA_CMD_QUEUE
].
tid_bôm≠
 =

465 
	`BIT
(
IWL_MAX_TID_COUNT
 + 2);

467 
	`£t_bô
(
IWL_MVM_STATUS_FIRMWARE_RUNNING
, &
mvm
->
°©us
);

468 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


469 
	`iwl_fw_£t_dbg_ªc_⁄
(&
mvm
->
fwπ
);

478 
	`cfg80211_bss_Êush
(
mvm
->
hw
->
wùhy
);

481 
	}
}

483 
	$iwl_mvm_phy_fûãr_öô
(
iwl_mvm
 *
mvm
,

484 
iwl_phy_•ecific_cfg
 *
phy_fûãrs
)

486 #ifde‡
CONFIG_ACPI


487 *
phy_fûãrs
 = 
mvm
->phy_filters;

489 
	}
}

491 
	$iwl_mvm_u©s_öô
(
iwl_mvm
 *
mvm
)

493 
u8
 
cmd_vî
;

494 
ªt
;

495 
iwl_ho°_cmd
 
cmd
 = {

496 .
id
 = 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
,

497 
UATS_TABLE_CMD
),

498 .
Êags
 = 0,

499 .
d©a
[0] = &
mvm
->
fwπ
.
u©s_èbÀ
,

500 .
Àn
[0] = (
mvm
->
fwπ
.
u©s_èbÀ
),

501 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

504 i‡(!(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

505 
IWL_DEVICE_FAMILY_AX210
)) {

506 
	`IWL_DEBUG_RADIO
(
mvm
, "UATS feature isÇot supported\n");

510 i‡(!
mvm
->
fwπ
.
u©s_íabÀd
) {

511 
	`IWL_DEBUG_RADIO
(
mvm
, "UATS feature is disabled\n");

515 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd
.
id
,

516 
IWL_FW_CMD_VER_UNKNOWN
);

517 i‡(
cmd_vî
 != 1) {

518 
	`IWL_DEBUG_RADIO
(
mvm
,

520 
cmd_vî
);

524 
ªt
 = 
	`iwl_uefi_gë_u©s_èbÀ
(
mvm
->
å™s
, &mvm->
fwπ
);

525 i‡(
ªt
 < 0) {

526 
	`IWL_ERR
(
mvm
, "ÁûedÅÿªad UATSÅabÀ (%d)\n", 
ªt
);

530 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

531 i‡(
ªt
 < 0)

532 
	`IWL_ERR
(
mvm
, "ÁûedÅÿ£nd UATS_TABLE_CMD (%d)\n", 
ªt
);

534 
	`IWL_DEBUG_RADIO
(
mvm
, "UATS_TABLE_CMD sentÅo FW\n");

535 
	}
}

537 
	$iwl_mvm_sgom_öô
(
iwl_mvm
 *
mvm
)

539 
u8
 
cmd_vî
;

540 
ªt
;

541 
iwl_ho°_cmd
 
cmd
 = {

542 .
id
 = 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
,

543 
SAR_OFFSET_MAPPING_TABLE_CMD
),

544 .
Êags
 = 0,

545 .
d©a
[0] = &
mvm
->
fwπ
.
sgom_èbÀ
,

546 .
Àn
[0] = (
mvm
->
fwπ
.
sgom_èbÀ
),

547 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

550 i‡(!
mvm
->
fwπ
.
sgom_íabÀd
) {

551 
	`IWL_DEBUG_RADIO
(
mvm
, "SGOMÅable is disabled\n");

555 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd
.
id
,

556 
IWL_FW_CMD_VER_UNKNOWN
);

558 i‡(
cmd_vî
 != 2) {

559 
	`IWL_DEBUG_RADIO
(
mvm
, "command version is unsupported. version = %d\n",

560 
cmd_vî
);

564 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

565 i‡(
ªt
 < 0)

566 
	`IWL_ERR
(
mvm
, "ÁûedÅÿ£nd SAR_OFFSET_MAPPING_CMD (%d)\n", 
ªt
);

568  
ªt
;

569 
	}
}

571 
	$iwl_£nd_phy_cfg_cmd
(
iwl_mvm
 *
mvm
)

573 
u32
 
cmd_id
 = 
PHY_CONFIGURATION_CMD
;

574 
iwl_phy_cfg_cmd_v3
 
phy_cfg_cmd
;

575 
iwl_ucode_ty≥
 
ucode_ty≥
 = 
mvm
->
fwπ
.
cur_fw_img
;

576 
u8
 
cmd_vî
;

577 
size_t
 
cmd_size
;

579 i‡(
	`iwl_mvm_has_unifõd_ucode
(
mvm
) &&

580 !
mvm
->
å™s
->
cfg
->
tx_wôh_siso_divîsôy
)

583 i‡(
mvm
->
å™s
->
cfg
->
tx_wôh_siso_divîsôy
) {

588 
phy_cfg_cmd
.
phy_cfg
 =

589 
	`˝u_to_À32
(
FW_PHY_CFG_CHAIN_SAD_ENABLED
);

593 
phy_cfg_cmd
.
phy_cfg
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_phy_c⁄fig
(
mvm
));

596 
phy_cfg_cmd
.
phy_cfg
 |=

597 
	`˝u_to_À32
(
mvm
->
å™s
->
å™s_cfg
->
exåa_phy_cfg_Êags
);

599 
phy_cfg_cmd
.
ˇlib_c⁄åﬁ
.
evít_åiggî
 =

600 
mvm
->
fw
->
deÁu…_ˇlib
[
ucode_ty≥
].
evít_åiggî
;

601 
phy_cfg_cmd
.
ˇlib_c⁄åﬁ
.
Êow_åiggî
 =

602 
mvm
->
fw
->
deÁu…_ˇlib
[
ucode_ty≥
].
Êow_åiggî
;

604 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

605 
IWL_FW_CMD_VER_UNKNOWN
);

606 i‡(
cmd_vî
 >= 3)

607 
	`iwl_mvm_phy_fûãr_öô
(
mvm
, &
phy_cfg_cmd
.
phy_•ecific_cfg
);

609 
	`IWL_DEBUG_INFO
(
mvm
, "Sending Phy CFG command: 0x%x\n",

610 
phy_cfg_cmd
.
phy_cfg
);

611 
cmd_size
 = (
cmd_vî
 =3Ë? (
iwl_phy_cfg_cmd_v3
) :

612 (
iwl_phy_cfg_cmd_v1
);

613  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
cmd_size
, &
phy_cfg_cmd
);

614 
	}
}

616 
	$iwl_run_unifõd_mvm_ucode
(
iwl_mvm
 *
mvm
)

618 
iwl_nŸifiˇti⁄_waô
 
öô_waô
;

619 
iwl_nvm_ac˚ss_com∂ëe_cmd
 
nvm_com∂ëe
 = {};

620 
iwl_öô_exãnded_cfg_cmd
 
öô_cfg
 = {

621 .
öô_Êags
 = 
	`˝u_to_À32
(
	`BIT
(
IWL_INIT_NVM
)),

623 c⁄° 
u16
 
öô_com∂ëe
[] = {

624 
INIT_COMPLETE_NOTIF
,

626 
u32
 
sb_cfg
;

627 
ªt
;

629 i‡(
mvm
->
å™s
->
cfg
->
tx_wôh_siso_divîsôy
)

630 
öô_cfg
.
öô_Êags
 |
	`˝u_to_À32
(
	`BIT
(
IWL_INIT_PHY
));

632 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

634 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
Ál£
;

636 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_AX210
) {

637 
sb_cfg
 = 
	`iwl_ªad_umac_¥ph
(
mvm
->
å™s
, 
SB_MODIFY_CFG_FLAG
);

639 
mvm
->
∂dr_sync
 = 
sb_cfg
 =
SB_CFG_RESIDES_IN_ROM
;

640 i‡(
mvm
->
∂dr_sync
 && 
	`iwl_mei_∂dr_ªq
())

641  -
EBUSY
;

644 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
,

645 &
öô_waô
,

646 
öô_com∂ëe
,

647 
	`ARRAY_SIZE
(
öô_com∂ëe
),

648 
iwl_waô_öô_com∂ëe
,

649 
NULL
);

651 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_EARLY
, 
NULL
);

654 
ªt
 = 
	`iwl_mvm_lﬂd_ucode_waô_Æive
(
mvm
, 
IWL_UCODE_REGULAR
);

655 i‡(
ªt
) {

656 
	`IWL_ERR
(
mvm
, "FaûedÅÿ°¨àRT ucode: %d\n", 
ªt
);

659 i‡(
mvm
->
∂dr_sync
) {

660 
	`iwl_mei_Æive_nŸif
(
Ál£
);

661 
	`iwl_å™s_pcõ_ªmove
(
mvm
->
å™s
, 
åue
);

664 
îr‹
;

666 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_AFTER_ALIVE
,

667 
NULL
);

669 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_BZ
)

670 
mvm
->
å™s
->
°ï_urm
 = !!(
	`iwl_ªad_umac_¥ph
(mvm->trans,

671 
CNVI_PMU_STEP_FLOW
) &

672 
CNVI_PMU_STEP_FLOW_FORCE_URM
);

677 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
SYSTEM_GROUP
,

678 
INIT_EXTENDED_CFG_CMD
),

679 
CMD_SEND_IN_RFKILL
,

680 (
öô_cfg
), &init_cfg);

681 i‡(
ªt
) {

682 
	`IWL_ERR
(
mvm
, "FailedÅoÑun init config command: %d\n",

683 
ªt
);

684 
îr‹
;

688 i‡(
mvm
->
nvm_fûe_«me
) {

689 
ªt
 = 
	`iwl_ªad_exã∫Æ_nvm
(
mvm
->
å™s
, mvm->
nvm_fûe_«me
,

690 
mvm
->
nvm_£˘i⁄s
);

691 i‡(
ªt
)

692 
îr‹
;

693 
ªt
 = 
	`iwl_mvm_lﬂd_nvm_to_nic
(
mvm
);

694 i‡(
ªt
)

695 
îr‹
;

698 i‡(
IWL_MVM_PARSE_NVM
 && !
mvm
->
nvm_d©a
) {

699 
ªt
 = 
	`iwl_nvm_öô
(
mvm
);

700 i‡(
ªt
) {

701 
	`IWL_ERR
(
mvm
, "FaûedÅÿªad NVM: %d\n", 
ªt
);

702 
îr‹
;

706 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
,

707 
NVM_ACCESS_COMPLETE
),

708 
CMD_SEND_IN_RFKILL
,

709 (
nvm_com∂ëe
), &nvm_complete);

710 i‡(
ªt
) {

711 
	`IWL_ERR
(
mvm
, "FailedÅoÑun complete NVMáccess: %d\n",

712 
ªt
);

713 
îr‹
;

716 
ªt
 = 
	`iwl_£nd_phy_cfg_cmd
(
mvm
);

717 i‡(
ªt
) {

718 
	`IWL_ERR
(
mvm
, "FailedÅoÑun PHY configuration: %d\n",

719 
ªt
);

720 
îr‹
;

724 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
öô_waô
,

725 
MVM_UCODE_ALIVE_TIMEOUT
);

726 i‡(
ªt
)

727  
ªt
;

730 i‡(!
IWL_MVM_PARSE_NVM
 && !
mvm
->
nvm_d©a
) {

731 
mvm
->
nvm_d©a
 = 
	`iwl_gë_nvm
(mvm->
å™s
, mvm->
fw
,

732 
mvm
->
£t_tx_™t
, mvm->
£t_rx_™t
);

733 i‡(
	`IS_ERR
(
mvm
->
nvm_d©a
)) {

734 
ªt
 = 
	`PTR_ERR
(
mvm
->
nvm_d©a
);

735 
mvm
->
nvm_d©a
 = 
NULL
;

736 
	`IWL_ERR
(
mvm
, "FaûedÅÿªad NVM: %d\n", 
ªt
);

737  
ªt
;

741 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
åue
;

745 
îr‹
:

746 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
öô_waô
);

747  
ªt
;

748 
	}
}

750 
	$iwl_run_öô_mvm_ucode
(
iwl_mvm
 *
mvm
)

752 
iwl_nŸifiˇti⁄_waô
 
ˇlib_waô
;

753 c⁄° 
u16
 
öô_com∂ëe
[] = {

754 
INIT_COMPLETE_NOTIF
,

755 
CALIB_RES_NOTIF_PHY_DB


757 
ªt
;

759 i‡(
	`iwl_mvm_has_unifõd_ucode
(
mvm
))

760  
	`iwl_run_unifõd_mvm_ucode
(
mvm
);

762 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

764 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
Ál£
;

766 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
,

767 &
ˇlib_waô
,

768 
öô_com∂ëe
,

769 
	`ARRAY_SIZE
(
öô_com∂ëe
),

770 
iwl_waô_phy_db_íåy
,

771 
mvm
->
phy_db
);

773 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_EARLY
, 
NULL
);

776 
ªt
 = 
	`iwl_mvm_lﬂd_ucode_waô_Æive
(
mvm
, 
IWL_UCODE_INIT
);

777 i‡(
ªt
) {

778 
	`IWL_ERR
(
mvm
, "FaûedÅÿ°¨àINIT ucode: %d\n", 
ªt
);

779 
ªmove_nŸif
;

782 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_8000
) {

783 
ªt
 = 
	`iwl_mvm_£nd_bt_öô_c⁄f
(
mvm
);

784 i‡(
ªt
)

785 
ªmove_nŸif
;

789 i‡(!
mvm
->
nvm_d©a
) {

790 
ªt
 = 
	`iwl_nvm_öô
(
mvm
);

791 i‡(
ªt
) {

792 
	`IWL_ERR
(
mvm
, "FaûedÅÿªad NVM: %d\n", 
ªt
);

793 
ªmove_nŸif
;

798 i‡(
mvm
->
nvm_fûe_«me
) {

799 
ªt
 = 
	`iwl_mvm_lﬂd_nvm_to_nic
(
mvm
);

800 i‡(
ªt
)

801 
ªmove_nŸif
;

804 
	`WARN_ONCE
(
mvm
->
nvm_d©a
->
nvm_vîsi⁄
 < mvm->
å™s
->
cfg
->
nvm_vî
,

806 
mvm
->
nvm_d©a
->
nvm_vîsi⁄
, mvm->
å™s
->
cfg
->
nvm_vî
);

812 i‡(
	`iwl_mvm_is_ødio_hw_kûÀd
(
mvm
)) {

813 
	`IWL_DEBUG_RF_KILL
(
mvm
,

815 
ªmove_nŸif
;

818 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
åue
;

821 
ªt
 = 
	`iwl_£nd_tx_™t_cfg
(
mvm
, 
	`iwl_mvm_gë_vÆid_tx_™t
(mvm));

822 i‡(
ªt
)

823 
ªmove_nŸif
;

825 
ªt
 = 
	`iwl_£nd_phy_cfg_cmd
(
mvm
);

826 i‡(
ªt
) {

827 
	`IWL_ERR
(
mvm
, "FailedÅoÑun INIT calibrations: %d\n",

828 
ªt
);

829 
ªmove_nŸif
;

836 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
ˇlib_waô
,

837 
MVM_UCODE_CALIB_TIMEOUT
);

838 i‡(!
ªt
)

839 
out
;

841 i‡(
	`iwl_mvm_is_ødio_hw_kûÀd
(
mvm
)) {

842 
	`IWL_DEBUG_RF_KILL
(
mvm
, "RFKILL while calibrating.\n");

843 
ªt
 = 0;

845 
	`IWL_ERR
(
mvm
, "FailedÅoÑun INIT calibrations: %d\n",

846 
ªt
);

849 
out
;

851 
ªmove_nŸif
:

852 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
ˇlib_waô
);

853 
out
:

854 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
Ál£
;

855 i‡(
iwlmvm_mod_∑øms
.
öô_dbg
 && !
mvm
->
nvm_d©a
) {

857 
mvm
->
nvm_d©a
 = 
	`kzÆloc
((
iwl_nvm_d©a
) +

858 (
õì80211_ch™√l
) +

859 (
õì80211_øã
),

860 
GFP_KERNEL
);

861 i‡(!
mvm
->
nvm_d©a
)

862  -
ENOMEM
;

863 
mvm
->
nvm_d©a
->
b™ds
[0].
ch™√ls
 = mvm->nvm_data->channels;

864 
mvm
->
nvm_d©a
->
b™ds
[0].
n_ch™√ls
 = 1;

865 
mvm
->
nvm_d©a
->
b™ds
[0].
n_bôøãs
 = 1;

866 
mvm
->
nvm_d©a
->
b™ds
[0].
bôøãs
 =

867 (*)(
mvm
->
nvm_d©a
->
ch™√ls
 + 1);

868 
mvm
->
nvm_d©a
->
b™ds
[0].
bôøãs
->
hw_vÆue
 = 10;

871  
ªt
;

872 
	}
}

874 
	$iwl_mvm_c⁄fig_…r
(
iwl_mvm
 *
mvm
)

876 
iwl_…r_c⁄fig_cmd
 
cmd
 = {

877 .
Êags
 = 
	`˝u_to_À32
(
LTR_CFG_FLAG_FEATURE_ENABLE
),

880 i‡(!
mvm
->
å™s
->
…r_íabÀd
)

883  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
LTR_CONFIG
, 0,

884 (
cmd
), &cmd);

885 
	}
}

887 
	$iwl_mvm_ßr_£À˘_¥ofûe
(
iwl_mvm
 *
mvm
, 
¥of_a
, 
¥of_b
)

889 
u32
 
cmd_id
 = 
REDUCE_TX_POWER_CMD
;

890 
iwl_dev_tx_powî_cmd
 
cmd
 = {

891 .
comm⁄
.
£t_mode
 = 
	`˝u_to_À32
(
IWL_TX_POWER_MODE_SET_CHAINS
),

893 
__À16
 *
≥r_chaö
;

894 
ªt
;

895 
u16
 
Àn
 = 0;

896 
u32
 
n_subb™ds
;

897 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

898 
IWL_FW_CMD_VER_UNKNOWN
);

899 i‡(
cmd_vî
 == 7) {

900 
Àn
 = (
cmd
.
v7
);

901 
n_subb™ds
 = 
IWL_NUM_SUB_BANDS_V2
;

902 
≥r_chaö
 = 
cmd
.
v7
.per_chain[0][0];

903 
cmd
.
v7
.
Êags
 = 
	`˝u_to_À32
(
mvm
->
fwπ
.
ªdu˚d_powî_Êags
);

904 } i‡(
cmd_vî
 == 6) {

905 
Àn
 = (
cmd
.
v6
);

906 
n_subb™ds
 = 
IWL_NUM_SUB_BANDS_V2
;

907 
≥r_chaö
 = 
cmd
.
v6
.per_chain[0][0];

908 } i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

909 
IWL_UCODE_TLV_API_REDUCE_TX_POWER
)) {

910 
Àn
 = (
cmd
.
v5
);

911 
n_subb™ds
 = 
IWL_NUM_SUB_BANDS_V1
;

912 
≥r_chaö
 = 
cmd
.
v5
.per_chain[0][0];

913 } i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

914 
IWL_UCODE_TLV_CAPA_TX_POWER_ACK
)) {

915 
Àn
 = (
cmd
.
v4
);

916 
n_subb™ds
 = 
IWL_NUM_SUB_BANDS_V1
;

917 
≥r_chaö
 = 
cmd
.
v4
.per_chain[0][0];

919 
Àn
 = (
cmd
.
v3
);

920 
n_subb™ds
 = 
IWL_NUM_SUB_BANDS_V1
;

921 
≥r_chaö
 = 
cmd
.
v3
.per_chain[0][0];

925 
Àn
 +(
cmd
.
comm⁄
);

927 
ªt
 = 
	`iwl_ßr_fûl_¥ofûe
(&
mvm
->
fwπ
, 
≥r_chaö
,

928 
IWL_NUM_CHAIN_TABLES
,

929 
n_subb™ds
, 
¥of_a
, 
¥of_b
);

932 i‡(
ªt
)

933  
ªt
;

935 
	`iwl_mei_£t_powî_limô
(
≥r_chaö
);

937 
	`IWL_DEBUG_RADIO
(
mvm
, "Sending REDUCE_TX_POWER_CMDÖer chain\n");

938  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
Àn
, &
cmd
);

939 
	}
}

941 
	$iwl_mvm_gë_ßr_geo_¥ofûe
(
iwl_mvm
 *
mvm
)

943 
iwl_geo_tx_powî_¥ofûes_cmd
 
geo_tx_cmd
;

944 
iwl_geo_tx_powî_¥ofûes_ª•
 *
ª•
;

945 
u16
 
Àn
;

946 
ªt
;

947 
iwl_ho°_cmd
 
cmd
 = {

948 .
id
 = 
	`WIDE_ID
(
PHY_OPS_GROUP
, 
PER_CHAIN_LIMIT_OFFSET_CMD
),

949 .
Êags
 = 
CMD_WANT_SKB
,

950 .
d©a
 = { &
geo_tx_cmd
 },

952 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd
.
id
,

953 
IWL_FW_CMD_VER_UNKNOWN
);

956 
geo_tx_cmd
.
v1
.
›s
 =

957 
	`˝u_to_À32
(
IWL_PER_CHAIN_OFFSET_GET_CURRENT_TABLE
);

959 i‡(
cmd_vî
 == 5)

960 
Àn
 = (
geo_tx_cmd
.
v5
);

961 i‡(
cmd_vî
 == 4)

962 
Àn
 = (
geo_tx_cmd
.
v4
);

963 i‡(
cmd_vî
 == 3)

964 
Àn
 = (
geo_tx_cmd
.
v3
);

965 i‡(
	`fw_has_≠i
(&
mvm
->
fwπ
.
fw
->
ucode_ˇ∑
,

966 
IWL_UCODE_TLV_API_SAR_TABLE_VER
))

967 
Àn
 = (
geo_tx_cmd
.
v2
);

969 
Àn
 = (
geo_tx_cmd
.
v1
);

971 i‡(!
	`iwl_ßr_geo_suµ‹t
(&
mvm
->
fwπ
))

972  -
EOPNOTSUPP
;

974 
cmd
.
Àn
[0] =Üen;

976 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

977 i‡(
ªt
) {

978 
	`IWL_ERR
(
mvm
, "FaûedÅÿgë geogøphi¯¥ofûêöfÿ%d\n", 
ªt
);

979  
ªt
;

982 
ª•
 = (*)
cmd
.
ª•_pkt
->
d©a
;

983 
ªt
 = 
	`À32_to_˝u
(
ª•
->
¥ofûe_idx
);

985 i‡(
	`WARN_ON
(
ªt
 > 
BIOS_GEO_MAX_PROFILE_NUM
))

986 
ªt
 = -
EIO
;

988 
	`iwl_‰ì_ª•
(&
cmd
);

989  
ªt
;

990 
	}
}

992 
	$iwl_mvm_ßr_geo_öô
(
iwl_mvm
 *
mvm
)

994 
u32
 
cmd_id
 = 
	`WIDE_ID
(
PHY_OPS_GROUP
, 
PER_CHAIN_LIMIT_OFFSET_CMD
);

995 
iwl_geo_tx_powî_¥ofûes_cmd
 
cmd
;

996 
u16
 
Àn
;

997 
u32
 
n_b™ds
;

998 
u32
 
n_¥ofûes
;

999 
__À32
 
sk
 = 
	`˝u_to_À32
(0);

1000 
ªt
;

1001 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

1002 
IWL_FW_CMD_VER_UNKNOWN
);

1004 
	`BUILD_BUG_ON
(
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v1
, 
›s
) !=

1005 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v2
, 
›s
) ||

1006 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v2
, 
›s
) !=

1007 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v3
, 
›s
) ||

1008 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v3
, 
›s
) !=

1009 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v4
, 
›s
) ||

1010 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v4
, 
›s
) !=

1011 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v5
, 
›s
));

1014 
cmd
.
v1
.
›s
 = 
	`˝u_to_À32
(
IWL_PER_CHAIN_OFFSET_SET_TABLES
);

1017 i‡(
mvm
->
fwπ
.
geo_ªv
 == 1)

1018 
sk
 = 
	`˝u_to_À32
(1);

1020 i‡(
cmd_vî
 == 5) {

1021 
Àn
 = (
cmd
.
v5
);

1022 
n_b™ds
 = 
	`ARRAY_SIZE
(
cmd
.
v5
.
èbÀ
[0]);

1023 
n_¥ofûes
 = 
BIOS_GEO_MAX_PROFILE_NUM
;

1024 
cmd
.
v5
.
èbÀ_ªvisi⁄
 = 
sk
;

1025 } i‡(
cmd_vî
 == 4) {

1026 
Àn
 = (
cmd
.
v4
);

1027 
n_b™ds
 = 
	`ARRAY_SIZE
(
cmd
.
v4
.
èbÀ
[0]);

1028 
n_¥ofûes
 = 
BIOS_GEO_MAX_PROFILE_NUM
;

1029 
cmd
.
v4
.
èbÀ_ªvisi⁄
 = 
sk
;

1030 } i‡(
cmd_vî
 == 3) {

1031 
Àn
 = (
cmd
.
v3
);

1032 
n_b™ds
 = 
	`ARRAY_SIZE
(
cmd
.
v3
.
èbÀ
[0]);

1033 
n_¥ofûes
 = 
BIOS_GEO_MIN_PROFILE_NUM
;

1034 
cmd
.
v3
.
èbÀ_ªvisi⁄
 = 
sk
;

1035 } i‡(
	`fw_has_≠i
(&
mvm
->
fwπ
.
fw
->
ucode_ˇ∑
,

1036 
IWL_UCODE_TLV_API_SAR_TABLE_VER
)) {

1037 
Àn
 = (
cmd
.
v2
);

1038 
n_b™ds
 = 
	`ARRAY_SIZE
(
cmd
.
v2
.
èbÀ
[0]);

1039 
n_¥ofûes
 = 
BIOS_GEO_MIN_PROFILE_NUM
;

1040 
cmd
.
v2
.
èbÀ_ªvisi⁄
 = 
sk
;

1042 
Àn
 = (
cmd
.
v1
);

1043 
n_b™ds
 = 
	`ARRAY_SIZE
(
cmd
.
v1
.
èbÀ
[0]);

1044 
n_¥ofûes
 = 
BIOS_GEO_MIN_PROFILE_NUM
;

1047 
	`BUILD_BUG_ON
(
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v1
, 
èbÀ
) !=

1048 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v2
, 
èbÀ
) ||

1049 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v2
, 
èbÀ
) !=

1050 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v3
, 
èbÀ
) ||

1051 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v3
, 
èbÀ
) !=

1052 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v4
, 
èbÀ
) ||

1053 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v4
, 
èbÀ
) !=

1054 
	`off£tof
(
iwl_geo_tx_powî_¥ofûes_cmd_v5
, 
èbÀ
));

1056 
ªt
 = 
	`iwl_ßr_geo_fûl_èbÀ
(&
mvm
->
fwπ
, &
cmd
.
v1
.
èbÀ
[0][0],

1057 
n_b™ds
, 
n_¥ofûes
);

1063 i‡(
ªt
)

1066  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
Àn
, &
cmd
);

1067 
	}
}

1069 
	$iwl_mvm_µag_£nd_cmd
(
iwl_mvm
 *
mvm
)

1071 
iwl_µag_èbÀ_cmd
 
cmd
;

1072 
ªt
, 
cmd_size
;

1074 
ªt
 = 
	`iwl_fûl_µag_èbÀ
(&
mvm
->
fwπ
, &
cmd
, &
cmd_size
);

1076 i‡(
ªt
 < 0)

1079 
	`IWL_DEBUG_RADIO
(
mvm
, "Sending PER_PLATFORM_ANT_GAIN_CMD\n");

1080 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
PHY_OPS_GROUP
,

1081 
PER_PLATFORM_ANT_GAIN_CMD
),

1082 0, 
cmd_size
, &
cmd
);

1083 i‡(
ªt
 < 0)

1084 
	`IWL_ERR
(
mvm
, "failedÅo send PER_PLATFORM_ANT_GAIN_CMD (%d)\n",

1085 
ªt
);

1087  
ªt
;

1088 
	}
}

1090 
	$iwl_mvm_µag_öô
(
iwl_mvm
 *
mvm
)

1093 i‡(!(
	`iwl_is_µag_≠¥oved
(&
mvm
->
fwπ
)))

1096  
	`iwl_mvm_µag_£nd_cmd
(
mvm
);

1097 
	}
}

1099 
boﬁ
 
	$iwl_mvm_add_to_ès_block_li°
(
__À32
 *
li°
, __À32 *
À_size
, 
mcc
)

1101 
i
;

1102 
u32
 
size
 = 
	`À32_to_˝u
(*
À_size
);

1105 i‡(
size
 >
IWL_WTAS_BLACK_LIST_MAX
)

1106  
Ál£
;

1108 
i
 = 0; i < 
size
; i++) {

1109 i‡(
li°
[
i
] =
	`˝u_to_À32
(
mcc
))

1110  
åue
;

1113 
li°
[
size
++] = 
	`˝u_to_À32
(
mcc
);

1114 *
À_size
 = 
	`˝u_to_À32
(
size
);

1115  
åue
;

1116 
	}
}

1118 
	$iwl_mvm_ès_öô
(
iwl_mvm
 *
mvm
)

1120 
u32
 
cmd_id
 = 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
, 
TAS_CONFIG
);

1121 
ªt
;

1122 
iwl_ès_d©a
 
d©a
 = {};

1123 
iwl_ès_c⁄fig_cmd
 
cmd
 = {};

1124 
cmd_size
, 
fw_vî
;

1126 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
d©a
.
block_li°_¨øy
) !=

1127 
IWL_WTAS_BLACK_LIST_MAX
);

1128 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
cmd
.
comm⁄
.
block_li°_¨øy
) !=

1129 
IWL_WTAS_BLACK_LIST_MAX
);

1131 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_TAS_CFG
)) {

1132 
	`IWL_DEBUG_RADIO
(
mvm
, "TASÇotÉnabled in FW\n");

1136 
ªt
 = 
	`iwl_bios_gë_ès_èbÀ
(&
mvm
->
fwπ
, &
d©a
);

1137 i‡(
ªt
 < 0) {

1138 
	`IWL_DEBUG_RADIO
(
mvm
,

1140 
ªt
);

1144 i‡(
ªt
 == 0)

1147 i‡(!
	`iwl_is_ès_≠¥oved
()) {

1148 
	`IWL_DEBUG_RADIO
(
mvm
,

1150 
	`dmi_gë_sy°em_öfo
(
DMI_SYS_VENDOR
) ?: "<unknown>");

1151 i‡((!
	`iwl_mvm_add_to_ès_block_li°
(
d©a
.
block_li°_¨øy
,

1152 &
d©a
.
block_li°_size
,

1153 
IWL_MCC_US
)) ||

1154 (!
	`iwl_mvm_add_to_ès_block_li°
(
d©a
.
block_li°_¨øy
,

1155 &
d©a
.
block_li°_size
,

1156 
IWL_MCC_CANADA
))) {

1157 
	`IWL_DEBUG_RADIO
(
mvm
,

1162 
	`IWL_DEBUG_RADIO
(
mvm
,

1164 
	`dmi_gë_sy°em_öfo
(
DMI_SYS_VENDOR
) ?: "<unknown>");

1167 
fw_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

1168 
IWL_FW_CMD_VER_UNKNOWN
);

1170 
	`mem˝y
(&
cmd
.
comm⁄
, &
d©a
, (
iwl_ès_c⁄fig_cmd_comm⁄
));

1173 i‡(
fw_vî
 == 4) {

1174 
cmd
.
v4
.
ovîride_ès_õc
 = 
d©a
.override_tas_iec;

1175 
cmd
.
v4
.
íabÀ_ès_õc
 = 
d©a
.enable_tas_iec;

1176 
cmd
.
v4
.
uß_ès_uhb_Ælowed
 = 
d©a
.usa_tas_uhb_allowed;

1178 
cmd
.
v3
.
ovîride_ès_õc
 = 
	`˝u_to_À16
(
d©a
.override_tas_iec);

1179 
cmd
.
v3
.
íabÀ_ès_õc
 = 
	`˝u_to_À16
(
d©a
.enable_tas_iec);

1182 
cmd_size
 = (
iwl_ès_c⁄fig_cmd_comm⁄
);

1183 i‡(
fw_vî
 >= 3)

1185 
cmd_size
 +(
iwl_ès_c⁄fig_cmd_v3
);

1187 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
cmd_size
, &
cmd
);

1188 i‡(
ªt
 < 0)

1189 
	`IWL_DEBUG_RADIO
(
mvm
, "ÁûedÅÿ£nd TAS_CONFIG (%d)\n", 
ªt
);

1190 
	}
}

1192 
boﬁ
 
	$iwl_mvm_evÆ_dsm_rfi
(
iwl_mvm
 *
mvm
)

1194 
u32
 
vÆue
 = 0;

1196 
boﬁ
 
bios_íabÀ_rfi
 = 
Ál£
;

1197 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_RFI_CONFIG
, &
vÆue
);

1200 i‡(
ªt
 < 0) {

1201 
	`IWL_DEBUG_RADIO
(
mvm
, "FaûedÅÿgë DSM RFI,Ñë=%d\n", 
ªt
);

1202  
bios_íabÀ_rfi
;

1205 
vÆue
 &
DSM_VALUE_RFI_DISABLE
;

1211 i‡(!
vÆue
) {

1212 
	`IWL_DEBUG_RADIO
(
mvm
, "DSM RFI isÉvaluatedÅoÉnable\n");

1213 
bios_íabÀ_rfi
 = 
åue
;

1214 } i‡(
vÆue
 =
DSM_VALUE_RFI_DISABLE
) {

1215 
	`IWL_DEBUG_RADIO
(
mvm
, "DSM RFI isÉvaluatedÅo disable\n");

1217 
	`IWL_DEBUG_RADIO
(
mvm
,

1218 "DSM RFI gŸ invÆid vÆue, vÆue=%d\n", 
vÆue
);

1221  
bios_íabÀ_rfi
;

1222 
	}
}

1224 
	$iwl_mvm_œri_cfg
(
iwl_mvm
 *
mvm
)

1226 
ªt
;

1227 
u32
 
vÆue
;

1228 
iwl_œri_c⁄fig_ch™ge_cmd_v7
 
cmd
 = {};

1229 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1230 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
,

1231 
LARI_CONFIG_CHANGE
), 1);

1233 
cmd
.
c⁄fig_bôm≠
 = 
	`iwl_gë_œri_c⁄fig_bôm≠
(&
mvm
->
fwπ
);

1235 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_11AX_ENABLEMENT
, &
vÆue
);

1236 i‡(!
ªt
)

1237 
cmd
.
€m_11ax_Ælow_bôm≠
 = 
	`˝u_to_À32
(
vÆue
);

1239 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_ENABLE_UNII4_CHAN
, &
vÆue
);

1240 i‡(!
ªt
)

1241 
cmd
.
€m_unii4_Ælow_bôm≠
 = 
	`˝u_to_À32
(
vÆue
);

1243 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_ACTIVATE_CHANNEL
, &
vÆue
);

1244 i‡(!
ªt
) {

1245 i‡(
cmd_vî
 < 8)

1246 
vÆue
 &~
ACTIVATE_5G2_IN_WW_MASK
;

1247 
cmd
.
ch™_°©e_a˘ive_bôm≠
 = 
	`˝u_to_À32
(
vÆue
);

1250 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_ENABLE_6E
, &
vÆue
);

1251 i‡(!
ªt
)

1252 
cmd
.
€m_uhb_Ælow_bôm≠
 = 
	`˝u_to_À32
(
vÆue
);

1254 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_FORCE_DISABLE_CHANNELS
,

1255 &
vÆue
);

1256 i‡(!
ªt
)

1257 
cmd
.
f‹˚_dißbÀ_ch™√ls_bôm≠
 = 
	`˝u_to_À32
(
vÆue
);

1259 
ªt
 = 
	`iwl_bios_gë_dsm
(&
mvm
->
fwπ
, 
DSM_FUNC_ENERGY_DETECTION_THRESHOLD
,

1260 &
vÆue
);

1261 i‡(!
ªt
)

1262 
cmd
.
edt_bôm≠
 = 
	`˝u_to_À32
(
vÆue
);

1264 i‡(
cmd
.
c⁄fig_bôm≠
 ||

1265 
cmd
.
€m_uhb_Ælow_bôm≠
 ||

1266 
cmd
.
€m_11ax_Ælow_bôm≠
 ||

1267 
cmd
.
€m_unii4_Ælow_bôm≠
 ||

1268 
cmd
.
ch™_°©e_a˘ive_bôm≠
 ||

1269 
cmd
.
f‹˚_dißbÀ_ch™√ls_bôm≠
 ||

1270 
cmd
.
edt_bôm≠
) {

1271 
size_t
 
cmd_size
;

1273 
cmd_vî
) {

1276 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v7
);

1279 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v6
);

1282 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v5
);

1285 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v4
);

1288 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v3
);

1291 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v2
);

1294 
cmd_size
 = (
iwl_œri_c⁄fig_ch™ge_cmd_v1
);

1298 
	`IWL_DEBUG_RADIO
(
mvm
,

1300 
	`À32_to_˝u
(
cmd
.
c⁄fig_bôm≠
),

1301 
	`À32_to_˝u
(
cmd
.
€m_11ax_Ælow_bôm≠
));

1302 
	`IWL_DEBUG_RADIO
(
mvm
,

1304 
	`À32_to_˝u
(
cmd
.
€m_unii4_Ælow_bôm≠
),

1305 
	`À32_to_˝u
(
cmd
.
ch™_°©e_a˘ive_bôm≠
),

1306 
cmd_vî
);

1307 
	`IWL_DEBUG_RADIO
(
mvm
,

1309 
	`À32_to_˝u
(
cmd
.
€m_uhb_Ælow_bôm≠
),

1310 
	`À32_to_˝u
(
cmd
.
f‹˚_dißbÀ_ch™√ls_bôm≠
));

1311 
	`IWL_DEBUG_RADIO
(
mvm
,

1313 
	`À32_to_˝u
(
cmd
.
edt_bôm≠
));

1314 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1315 
	`WIDE_ID
(
REGULATORY_AND_NVM_GROUP
,

1316 
LARI_CONFIG_CHANGE
),

1317 0, 
cmd_size
, &
cmd
);

1318 i‡(
ªt
 < 0)

1319 
	`IWL_DEBUG_RADIO
(
mvm
,

1321 
ªt
);

1324 i‡(
	`À32_to_˝u
(
cmd
.
€m_uhb_Ælow_bôm≠
Ë& 
IWL_UATS_VLP_AP_SUPPORTED
 ||

1325 
	`À32_to_˝u
(
cmd
.
€m_uhb_Ælow_bôm≠
Ë& 
IWL_UATS_AFC_AP_SUPPORTED
)

1326 
mvm
->
fwπ
.
u©s_íabÀd
 = 
åue
;

1327 
	}
}

1329 
	$iwl_mvm_gë_bios_èbÀs
(
iwl_mvm
 *
mvm
)

1331 
ªt
;

1333 
	`iwl_a˝i_gë_guid_lock_°©us
(&
mvm
->
fwπ
);

1336 
ªt
 = 
	`iwl_bios_gë_µag_èbÀ
(&
mvm
->
fwπ
);

1337 i‡(
ªt
 < 0) {

1338 
	`IWL_DEBUG_RADIO
(
mvm
,

1340 
ªt
);

1344 
ªt
 = 
	`iwl_bios_gë_wrds_èbÀ
(&
mvm
->
fwπ
);

1345 i‡(
ªt
 < 0) {

1346 
	`IWL_DEBUG_RADIO
(
mvm
,

1348 
ªt
);

1353 i‡(!
	`iwl_bios_gë_wgds_èbÀ
(&
mvm
->
fwπ
)) {

1360 
	`IWL_ERR
(
mvm
, "BIOS contains WGDS butÇo WRDS\n");

1364 
ªt
 = 
	`iwl_bios_gë_ewrd_èbÀ
(&
mvm
->
fwπ
);

1367 i‡(
ªt
 < 0)

1368 
	`IWL_DEBUG_RADIO
(
mvm
,

1370 
ªt
);

1373 i‡(
	`iwl_ßr_geo_suµ‹t
(&
mvm
->
fwπ
)) {

1374 
ªt
 = 
	`iwl_bios_gë_wgds_èbÀ
(&
mvm
->
fwπ
);

1375 i‡(
ªt
 < 0)

1376 
	`IWL_DEBUG_RADIO
(
mvm
,

1378 
ªt
);

1383 
	`iwl_a˝i_gë_phy_fûãrs
(&
mvm
->
fwπ
, &mvm->
phy_fûãrs
);

1385 i‡(
	`iwl_bios_gë_eckv
(&
mvm
->
fwπ
, &mvm->
ext_˛ock_vÆid
))

1386 
	`IWL_DEBUG_RADIO
(
mvm
, "ECKVÅable doesn'tÉxist in BIOS\n");

1387 
	}
}

1389 
	$iwl_mvm_disc⁄√˘_ôî©‹
(*
d©a
, 
u8
 *
mac
,

1390 
õì80211_vif
 *
vif
)

1392 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

1393 
	`õì80211_hw_ª°¨t_disc⁄√˘
(
vif
);

1394 
	}
}

1396 
	$iwl_mvm_£nd_ªcovîy_cmd
(
iwl_mvm
 *
mvm
, 
u32
 
Êags
)

1398 
u32
 
îr‹_log_size
 = 
mvm
->
fw
->
ucode_ˇ∑
.error_log_size;

1399 
ªt
;

1400 
u32
 
ª•
;

1402 
iwl_fw_îr‹_ªcovîy_cmd
 
ªcovîy_cmd
 = {

1403 .
Êags
 = 
	`˝u_to_À32
(flags),

1404 .
buf_size
 = 0,

1406 
iwl_ho°_cmd
 
ho°_cmd
 = {

1407 .
id
 = 
	`WIDE_ID
(
SYSTEM_GROUP
, 
FW_ERROR_RECOVERY_CMD
),

1408 .
Êags
 = 
CMD_WANT_SKB
,

1409 .
d©a
 = {&
ªcovîy_cmd
, },

1410 .
Àn
 = {(
ªcovîy_cmd
), },

1414 i‡(!
îr‹_log_size
)

1417 i‡(
Êags
 & 
ERROR_RECOVERY_UPDATE_DB
) {

1419 i‡(!
mvm
->
îr‹_ªcovîy_buf
)

1422 
ho°_cmd
.
d©a
[1] = 
mvm
->
îr‹_ªcovîy_buf
;

1423 
ho°_cmd
.
Àn
[1] = 
îr‹_log_size
;

1424 
ho°_cmd
.
d©aÊags
[1] = 
IWL_HCMD_DFL_NOCOPY
;

1425 
ªcovîy_cmd
.
buf_size
 = 
	`˝u_to_À32
(
îr‹_log_size
);

1428 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
ho°_cmd
);

1429 
	`k‰ì
(
mvm
->
îr‹_ªcovîy_buf
);

1430 
mvm
->
îr‹_ªcovîy_buf
 = 
NULL
;

1432 i‡(
ªt
) {

1433 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£ndÑecovîy cmd %d\n", 
ªt
);

1438 i‡(
Êags
 & 
ERROR_RECOVERY_UPDATE_DB
) {

1439 
ª•
 = 
	`À32_to_˝u
(*(
__À32
 *)
ho°_cmd
.
ª•_pkt
->
d©a
);

1440 i‡(
ª•
) {

1441 
	`IWL_ERR
(
mvm
,

1443 
ª•
);

1445 
	`õì80211_ôî©e_öãrÁ˚s
(
mvm
->
hw
, 0,

1446 
iwl_mvm_disc⁄√˘_ôî©‹
,

1447 
mvm
);

1450 
	}
}

1452 
	$iwl_mvm_ßr_öô
(
iwl_mvm
 *
mvm
)

1454  
	`iwl_mvm_ßr_£À˘_¥ofûe
(
mvm
, 1, 1);

1455 
	}
}

1457 
	$iwl_mvm_lﬂd_π_fw
(
iwl_mvm
 *
mvm
)

1459 
ªt
;

1461 i‡(
	`iwl_mvm_has_unifõd_ucode
(
mvm
))

1462  
	`iwl_run_unifõd_mvm_ucode
(
mvm
);

1464 
ªt
 = 
	`iwl_run_öô_mvm_ucode
(
mvm
);

1466 i‡(
ªt
) {

1467 
	`IWL_ERR
(
mvm
, "FaûedÅÿru¿INIT ucode: %d\n", 
ªt
);

1469 i‡(
iwlmvm_mod_∑øms
.
öô_dbg
)

1471  
ªt
;

1474 
	`iwl_fw_dbg_°›_sync
(&
mvm
->
fwπ
);

1475 
	`iwl_å™s_°›_devi˚
(
mvm
->
å™s
);

1476 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
mvm
->
å™s
);

1477 i‡(
ªt
)

1478  
ªt
;

1480 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
Ál£
;

1481 
ªt
 = 
	`iwl_mvm_lﬂd_ucode_waô_Æive
(
mvm
, 
IWL_UCODE_REGULAR
);

1482 i‡(
ªt
)

1483  
ªt
;

1485 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
åue
;

1487 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_AFTER_ALIVE
,

1488 
NULL
);

1490  
	`iwl_öô_∑gög
(&
mvm
->
fwπ
, mvm->fwπ.
cur_fw_img
);

1491 
	}
}

1493 
	$iwl_mvm_up
(
iwl_mvm
 *
mvm
)

1495 
ªt
, 
i
;

1496 
õì80211_suµ‹ãd_b™d
 *
sb™d
 = 
NULL
;

1498 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1500 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
mvm
->
å™s
);

1501 i‡(
ªt
)

1502  
ªt
;

1504 
ªt
 = 
	`iwl_mvm_lﬂd_π_fw
(
mvm
);

1505 i‡(
ªt
) {

1506 
	`IWL_ERR
(
mvm
, "FaûedÅÿ°¨àRT ucode: %d\n", 
ªt
);

1507 i‡(
ªt
 !-
ERFKILL
 && !
mvm
->
∂dr_sync
)

1508 
	`iwl_fw_dbg_îr‹_cﬁÀ˘
(&
mvm
->
fwπ
,

1509 
FW_DBG_TRIGGER_DRIVER
);

1510 
îr‹
;

1514 
mvm
->
∂dr_sync
 = 
Ál£
;

1516 
	`iwl_fw_dißbÀ_dbg_as£πs
(&
mvm
->
fwπ
);

1517 
	`iwl_gë_sh¨ed_mem_c⁄f
(&
mvm
->
fwπ
);

1519 
ªt
 = 
	`iwl_mvm_sf_upd©e
(
mvm
, 
NULL
, 
Ál£
);

1520 i‡(
ªt
)

1521 
	`IWL_ERR
(
mvm
, "FailedÅo initialize Smart Fifo\n");

1523 i‡(!
	`iwl_å™s_dbg_öi_vÆid
(
mvm
->
å™s
)) {

1524 
mvm
->
fwπ
.
dump
.
c⁄f
 = 
FW_DBG_INVALID
;

1526 i‡(
mvm
->
fw
->
dbg
.
de°_év
)

1527 
mvm
->
fwπ
.
dump
.
c⁄f
 = 
FW_DBG_START_FROM_ALIVE
;

1528 
	`iwl_fw_°¨t_dbg_c⁄f
(&
mvm
->
fwπ
, 
FW_DBG_START_FROM_ALIVE
);

1531 
ªt
 = 
	`iwl_£nd_tx_™t_cfg
(
mvm
, 
	`iwl_mvm_gë_vÆid_tx_™t
(mvm));

1532 i‡(
ªt
)

1533 
îr‹
;

1535 i‡(!
	`iwl_mvm_has_unifõd_ucode
(
mvm
)) {

1537 
ªt
 = 
	`iwl_£nd_phy_db_d©a
(
mvm
->
phy_db
);

1538 i‡(
ªt
)

1539 
îr‹
;

1540 
ªt
 = 
	`iwl_£nd_phy_cfg_cmd
(
mvm
);

1541 i‡(
ªt
)

1542 
îr‹
;

1545 
ªt
 = 
	`iwl_mvm_£nd_bt_öô_c⁄f
(
mvm
);

1546 i‡(
ªt
)

1547 
îr‹
;

1549 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1550 
IWL_UCODE_TLV_CAPA_SOC_LATENCY_SUPPORT
)) {

1551 
ªt
 = 
	`iwl_£t_soc_œãncy
(&
mvm
->
fwπ
);

1552 i‡(
ªt
)

1553 
îr‹
;

1556 
	`iwl_mvm_œri_cfg
(
mvm
);

1559 
ªt
 = 
	`iwl_c⁄figuª_rxq
(&
mvm
->
fwπ
);

1560 i‡(
ªt
)

1561 
îr‹
;

1563 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

1564 
ªt
 = 
	`iwl_£nd_rss_cfg_cmd
(
mvm
);

1565 i‡(
ªt
) {

1566 
	`IWL_ERR
(
mvm
, "FailedÅo configure RSS queues: %d\n",

1567 
ªt
);

1568 
îr‹
;

1573 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

1574 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
i
], 
NULL
);

1575 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_lök_°a
[
i
], 
NULL
);

1578 
i
 = 0; i < 
IWL_MVM_FW_MAX_LINK_ID
 + 1; i++)

1579 
	`RCU_INIT_POINTER
(
mvm
->
lök_id_to_lök_c⁄f
[
i
], 
NULL
);

1581 
	`mem£t
(&
mvm
->
fw_lök_ids_m≠
, 0, (mvm->fw_link_ids_map));

1583 
mvm
->
tdls_cs
.
≥î
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

1586 
	`mem£t
(&
mvm
->
œ°_quŸa_cmd
, 0xff, (mvm->last_quota_cmd));

1588 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_DQA_SUPPORT
)) {

1589 
ªt
 = 
	`iwl_mvm_£nd_dqa_cmd
(
mvm
);

1590 i‡(
ªt
)

1591 
îr‹
;

1600 i‡(!
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
)) {

1605 
ªt
 = 
	`iwl_mvm_add_aux_°a
(
mvm
, 
MAC_INDEX_AUX
);

1606 i‡(
ªt
)

1607 
îr‹
;

1611 
i
 = 0;

1612 !
sb™d
 && 
i
 < 
NUM_NL80211_BANDS
)

1613 
sb™d
 = 
mvm
->
hw
->
wùhy
->
b™ds
[
i
++];

1615 i‡(
	`WARN_ON_ONCE
(!
sb™d
)) {

1616 
ªt
 = -
ENODEV
;

1617 
îr‹
;

1620 i‡(
	`iwl_mvm_is_â_ö_fw
(
mvm
)) {

1625 
	`iwl_mvm_£nd_ãmp_ªp‹t_ths_cmd
(
mvm
);

1628 
	`iwl_mvm_â_tx_backoff
(
mvm
, 0);

1631 #ifde‡
CONFIG_THERMAL


1638 i‡(
	`iwl_mvm_is_˘dp_suµ‹ãd
(
mvm
)) {

1639 
ªt
 = 
	`iwl_mvm_˘dp_comm™d
(
mvm
, 
CTDP_CMD_OPERATION_START
,

1640 
mvm
->
coﬁög_dev
.
cur_°©e
);

1641 i‡(
ªt
)

1642 
îr‹
;

1646 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_SET_LTR_GEN2
))

1647 
	`WARN_ON
(
	`iwl_mvm_c⁄fig_…r
(
mvm
));

1649 
ªt
 = 
	`iwl_mvm_powî_upd©e_devi˚
(
mvm
);

1650 i‡(
ªt
)

1651 
îr‹
;

1657 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
)) {

1658 
ªt
 = 
	`iwl_mvm_öô_mcc
(
mvm
);

1659 i‡(
ªt
)

1660 
îr‹
;

1663 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
)) {

1664 
mvm
->
sˇn_ty≥
 = 
IWL_SCAN_TYPE_NOT_SET
;

1665 
mvm
->
hb_sˇn_ty≥
 = 
IWL_SCAN_TYPE_NOT_SET
;

1666 
ªt
 = 
	`iwl_mvm_c⁄fig_sˇn
(
mvm
);

1667 i‡(
ªt
)

1668 
îr‹
;

1671 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

1672 
	`iwl_mvm_£nd_ªcovîy_cmd
(
mvm
, 
ERROR_RECOVERY_UPDATE_DB
);

1674 i‡(
mvm
->
time_sync
.
a˘ive
)

1675 
	`iwl_mvm_time_sync_c⁄fig
(
mvm
, mvm->
time_sync
.
≥î_addr
,

1676 
IWL_TIME_SYNC_PROTOCOL_TM
 |

1677 
IWL_TIME_SYNC_PROTOCOL_FTM
);

1680 i‡(!
mvm
->
±p_d©a
.
±p_˛ock
)

1681 
	`iwl_mvm_±p_öô
(
mvm
);

1683 
ªt
 = 
	`iwl_mvm_µag_öô
(
mvm
);

1684 i‡(
ªt
)

1685 
îr‹
;

1687 
ªt
 = 
	`iwl_mvm_ßr_öô
(
mvm
);

1688 i‡(
ªt
 == 0)

1689 
ªt
 = 
	`iwl_mvm_ßr_geo_öô
(
mvm
);

1690 i‡(
ªt
 < 0)

1691 
îr‹
;

1693 
ªt
 = 
	`iwl_mvm_sgom_öô
(
mvm
);

1694 i‡(
ªt
)

1695 
îr‹
;

1697 
	`iwl_mvm_ès_öô
(
mvm
);

1698 
	`iwl_mvm_Àds_sync
(
mvm
);

1699 
	`iwl_mvm_u©s_öô
(
mvm
);

1701 i‡(
	`iwl_rfi_suµ‹ãd
(
mvm
)) {

1702 i‡(
	`iwl_mvm_evÆ_dsm_rfi
(
mvm
))

1703 
	`iwl_rfi_£nd_c⁄fig_cmd
(
mvm
, 
NULL
);

1706 
	`iwl_mvm_mei_devi˚_°©e
(
mvm
, 
åue
);

1708 
	`IWL_DEBUG_INFO
(
mvm
, "RT uCode started.\n");

1710 
îr‹
:

1711 i‡(!
iwlmvm_mod_∑øms
.
öô_dbg
 || !
ªt
)

1712 
	`iwl_mvm_°›_devi˚
(
mvm
);

1713  
ªt
;

1714 
	}
}

1716 
	$iwl_mvm_lﬂd_d3_fw
(
iwl_mvm
 *
mvm
)

1718 
ªt
, 
i
;

1720 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1722 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
mvm
->
å™s
);

1723 i‡(
ªt
)

1724  
ªt
;

1726 
ªt
 = 
	`iwl_mvm_lﬂd_ucode_waô_Æive
(
mvm
, 
IWL_UCODE_WOWLAN
);

1727 i‡(
ªt
) {

1728 
	`IWL_ERR
(
mvm
, "FaûedÅÿ°¨àWoWLAN fúmw¨e: %d\n", 
ªt
);

1729 
îr‹
;

1732 
ªt
 = 
	`iwl_£nd_tx_™t_cfg
(
mvm
, 
	`iwl_mvm_gë_vÆid_tx_™t
(mvm));

1733 i‡(
ªt
)

1734 
îr‹
;

1737 
ªt
 = 
	`iwl_£nd_phy_db_d©a
(
mvm
->
phy_db
);

1738 i‡(
ªt
)

1739 
îr‹
;

1741 
ªt
 = 
	`iwl_£nd_phy_cfg_cmd
(
mvm
);

1742 i‡(
ªt
)

1743 
îr‹
;

1746 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

1747 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
i
], 
NULL
);

1748 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_lök_°a
[
i
], 
NULL
);

1751 i‡(!
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
)) {

1760 
ªt
 = 
	`iwl_mvm_add_aux_°a
(
mvm
, 
MAC_INDEX_AUX
);

1761 i‡(
ªt
)

1762 
îr‹
;

1766 
îr‹
:

1767 
	`iwl_mvm_°›_devi˚
(
mvm
);

1768  
ªt
;

1769 
	}
}

1771 
	$iwl_mvm_rx_mfu¨t_nŸif
(
iwl_mvm
 *
mvm
,

1772 
iwl_rx_cmd_buf„r
 *
rxb
)

1774 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1775 
iwl_mfu¨t_lﬂd_nŸif
 *
mfu¨t_nŸif
 = (*)
pkt
->
d©a
;

1777 
	`IWL_DEBUG_INFO
(
mvm
,

1779 
	`À32_to_˝u
(
mfu¨t_nŸif
->
ö°ÆÀd_vî
),

1780 
	`À32_to_˝u
(
mfu¨t_nŸif
->
exã∫Æ_vî
),

1781 
	`À32_to_˝u
(
mfu¨t_nŸif
->
°©us
),

1782 
	`À32_to_˝u
(
mfu¨t_nŸif
->
duøti⁄
));

1784 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë=(*
mfu¨t_nŸif
))

1785 
	`IWL_DEBUG_INFO
(
mvm
,

1787 
	`À32_to_˝u
(
mfu¨t_nŸif
->
image_size
));

1788 
	}
}

	@mvm/iwlmvm.mod.c

1 
	~<löux/moduÀ.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<löux/buûd-ß….h
>

4 
	~<löux/ñ‚Ÿe-…o.h
>

5 
	~<löux/exp‹t-öã∫Æ.h
>

6 
	~<löux/vîmagic.h
>

7 
	~<löux/compûî.h
>

9 #ifde‡
CONFIG_UNWINDER_ORC


10 
	~<asm/‹c_hódî.h
>

11 
	gORC_HEADER
;

14 
	gBUILD_SALT
;

15 
	gBUILD_LTO_INFO
;

17 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

18 
MODULE_INFO
(
«me
, 
KBUILD_MODNAME
);

20 
__visibÀ
 
moduÀ
 
__this_moduÀ


21 
__£˘i⁄
(".gnu.linkonce.this_module") = {

22 .
«me
 = 
KBUILD_MODNAME
,

23 .
	göô
 = 
öô_moduÀ
,

24 #ifde‡
CONFIG_MODULE_UNLOAD


25 .
	gexô
 = 
˛ónup_moduÀ
,

27 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

30 #ifde‡
CONFIG_MITIGATION_RETPOLINE


31 
MODULE_INFO
(
ªçﬁöe
, "Y");

36 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

37 
__u£d
 
__£˘i⁄
("__versions") = {

379 
MODULE_INFO
(
dïíds
, "mac80211,cfg80211,iwlwifi");

382 
MODULE_INFO
(
§cvîsi⁄
, "3C39E19F83402FF21488F25");

	@mvm/led.c

6 
	~<löux/Àds.h
>

7 
	~"iwl-io.h
"

8 
	~"iwl-c§.h
"

9 
	~"mvm.h
"

11 
	$iwl_mvm_£nd_Àd_fw_cmd
(
iwl_mvm
 *
mvm
, 
boﬁ
 
⁄
)

13 
iwl_Àd_cmd
 
Àd_cmd
 = {

14 .
°©us
 = 
	`˝u_to_À32
(
⁄
),

16 
iwl_ho°_cmd
 
cmd
 = {

17 .
id
 = 
	`WIDE_ID
(
LONG_GROUP
, 
LEDS_CMD
),

18 .
Àn
 = { (
Àd_cmd
), },

19 .
d©a
 = { &
Àd_cmd
, },

20 .
Êags
 = 
CMD_ASYNC
,

22 
îr
;

24 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
))

27 
îr
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

29 i‡(
îr
)

30 
	`IWL_WARN
(
mvm
, "LED comm™d faûed: %d\n", 
îr
);

31 
	}
}

33 
	$iwl_mvm_Àd_£t
(
iwl_mvm
 *
mvm
, 
boﬁ
 
⁄
)

35 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

36 
IWL_UCODE_TLV_CAPA_LED_CMD_SUPPORT
)) {

37 
	`iwl_mvm_£nd_Àd_fw_cmd
(
mvm
, 
⁄
);

41 
	`iwl_wrôe32
(
mvm
->
å™s
, 
CSR_LED_REG
,

42 
⁄
 ? 
CSR_LED_REG_TURN_ON
 : 
CSR_LED_REG_TURN_OFF
);

43 
	}
}

45 
	$iwl_Àd_brighäess_£t
(
Àd_˛assdev
 *
Àd_cdev
,

46 
Àd_brighäess
 
brighäess
)

48 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
Àd_cdev
, iwl_mvm, 
Àd
);

50 
	`iwl_mvm_Àd_£t
(
mvm
, 
brighäess
 > 0);

51 
	}
}

53 
	$iwl_mvm_Àds_öô
(
iwl_mvm
 *
mvm
)

55 
mode
 = 
iwlwifi_mod_∑øms
.
Àd_mode
;

56 
ªt
;

58 
mode
) {

59 
IWL_LED_BLINK
:

60 
	`IWL_ERR
(
mvm
, "BlinkÜed modeÇot supported, used default\n");

61 
ÁŒthrough
;

62 
IWL_LED_DEFAULT
:

63 
IWL_LED_RF_STATE
:

64 
mode
 = 
IWL_LED_RF_STATE
;

66 
IWL_LED_DISABLE
:

67 
	`IWL_INFO
(
mvm
, "Led disabled\n");

70  -
EINVAL
;

73 
mvm
->
Àd
.
«me
 = 
	`ka•rötf
(
GFP_KERNEL
, "%s-led",

74 
	`wùhy_«me
(
mvm
->
hw
->
wùhy
));

75 i‡(!
mvm
->
Àd
.
«me
)

76  -
ENOMEM
;

78 
mvm
->
Àd
.
brighäess_£t
 = 
iwl_Àd_brighäess_£t
;

79 
mvm
->
Àd
.
max_brighäess
 = 1;

81 i‡(
mode
 =
IWL_LED_RF_STATE
)

82 
mvm
->
Àd
.
deÁu…_åiggî
 =

83 
	`õì80211_gë_ødio_Àd_«me
(
mvm
->
hw
);

85 
ªt
 = 
	`Àd_˛assdev_ªgi°î
(
mvm
->
å™s
->
dev
, &mvm->
Àd
);

86 i‡(
ªt
) {

87 
	`k‰ì
(
mvm
->
Àd
.
«me
);

88 
	`IWL_INFO
(
mvm
, "FailedÅoÉnableÜed\n");

89  
ªt
;

92 
mvm
->
öô_°©us
 |
IWL_MVM_INIT_STATUS_LEDS_INIT_COMPLETE
;

94 
	}
}

96 
	$iwl_mvm_Àds_sync
(
iwl_mvm
 *
mvm
)

98 i‡(!(
mvm
->
öô_°©us
 & 
IWL_MVM_INIT_STATUS_LEDS_INIT_COMPLETE
))

105 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_8000
)

108 
	`iwl_mvm_Àd_£t
(
mvm
, mvm->
Àd
.
brighäess
 > 0);

109 
	}
}

111 
	$iwl_mvm_Àds_exô
(
iwl_mvm
 *
mvm
)

113 i‡(!(
mvm
->
öô_°©us
 & 
IWL_MVM_INIT_STATUS_LEDS_INIT_COMPLETE
))

116 
	`Àd_˛assdev_uƒegi°î
(&
mvm
->
Àd
);

117 
	`k‰ì
(
mvm
->
Àd
.
«me
);

118 
mvm
->
öô_°©us
 &~
IWL_MVM_INIT_STATUS_LEDS_INIT_COMPLETE
;

119 
	}
}

	@mvm/link.c

5 
	~"mvm.h
"

6 
	~"time-evít.h
"

8 
u32
 
	$iwl_mvm_gë_‰ì_fw_lök_id
(
iwl_mvm
 *
mvm
,

9 
iwl_mvm_vif
 *
mvm_vif
)

11 
u32
 
lök_id
;

13 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

15 
lök_id
 = 
	`ffz
(
mvm
->
fw_lök_ids_m≠
);

18 i‡(
lök_id
 > 
IWL_MVM_FW_MAX_LINK_ID
)

19  
IWL_MVM_FW_LINK_ID_INVALID
;

21 
mvm
->
fw_lök_ids_m≠
 |
	`BIT
(
lök_id
);

22  
lök_id
;

23 
	}
}

25 
	$iwl_mvm_ªÀa£_fw_lök_id
(
iwl_mvm
 *
mvm
, 
u32
 
lök_id
)

27 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

29 i‡(!
	`WARN_ON
(
lök_id
 > 
IWL_MVM_FW_MAX_LINK_ID
))

30 
mvm
->
fw_lök_ids_m≠
 &~
	`BIT
(
lök_id
);

31 
	}
}

33 
	$iwl_mvm_lök_cmd_£nd
(
iwl_mvm
 *
mvm
,

34 
iwl_lök_c⁄fig_cmd
 *
cmd
,

35 
iwl_˘xt_a˘i⁄
 
a˘i⁄
)

37 
ªt
;

39 
cmd
->
a˘i⁄
 = 
	`˝u_to_À32
(action);

40 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

41 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
LINK_CONFIG_CMD
), 0,

42 (*
cmd
), cmd);

43 i‡(
ªt
)

44 
	`IWL_ERR
(
mvm
, "FailedÅo send LINK_CONFIG_CMD (action:%d): %d\n",

45 
a˘i⁄
, 
ªt
);

46  
ªt
;

47 
	}
}

49 
	$iwl_mvm_£t_lök_m≠pög
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

50 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

52 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

53 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 =

54 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

56 i‡(
lök_öfo
->
fw_lök_id
 =
IWL_MVM_FW_LINK_ID_INVALID
) {

57 
lök_öfo
->
fw_lök_id
 = 
	`iwl_mvm_gë_‰ì_fw_lök_id
(
mvm
,

58 
mvmvif
);

59 i‡(
lök_öfo
->
fw_lök_id
 >=

60 
	`ARRAY_SIZE
(
mvm
->
lök_id_to_lök_c⁄f
))

61  -
EINVAL
;

63 
	`rcu_assign_poöãr
(
mvm
->
lök_id_to_lök_c⁄f
[
lök_öfo
->
fw_lök_id
],

64 
lök_c⁄f
);

68 
	}
}

70 
	$iwl_mvm_add_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

71 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

73 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

74 
lök_id
 = 
lök_c⁄f
->link_id;

75 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

76 
iwl_lök_c⁄fig_cmd
 
cmd
 = {};

77 
cmd_id
 = 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
LINK_CONFIG_CMD
);

78 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
, 1);

79 
ªt
;

81 i‡(
	`WARN_ON_ONCE
(!
lök_öfo
))

82  -
EINVAL
;

84 
ªt
 = 
	`iwl_mvm_£t_lök_m≠pög
(
mvm
, 
vif
, 
lök_c⁄f
);

85 i‡(
ªt
)

86  
ªt
;

91 i‡(
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
))

92  -
EINVAL
;

94 
cmd
.
lök_id
 = 
	`˝u_to_À32
(
lök_öfo
->
fw_lök_id
);

95 
cmd
.
mac_id
 = 
	`˝u_to_À32
(
mvmvif
->
id
);

96 
cmd
.
•ec_lök_id
 = 
lök_c⁄f
->
lök_id
;

97 
	`WARN_ON_ONCE
(
lök_öfo
->
phy_˘xt
);

98 
cmd
.
phy_id
 = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

100 
	`mem˝y
(
cmd
.
loˇl_lök_addr
, 
lök_c⁄f
->
addr
, 
ETH_ALEN
);

102 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
 && 
lök_c⁄f
->
bssid
)

103 
	`mem˝y
(
cmd
.
ibss_bssid_addr
, 
lök_c⁄f
->
bssid
, 
ETH_ALEN
);

105 i‡(
cmd_vî
 < 2)

106 
cmd
.
li°í_lmac
 = 
	`˝u_to_À32
(
lök_öfo
->listen_lmac);

108  
	`iwl_mvm_lök_cmd_£nd
(
mvm
, &
cmd
, 
FW_CTXT_ACTION_ADD
);

109 
	}
}

111 
	$iwl_mvm_lök_ch™ged
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

112 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

113 
u32
 
ch™ges
, 
boﬁ
 
a˘ive
)

115 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

116 
lök_id
 = 
lök_c⁄f
->link_id;

117 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

118 
iwl_mvm_phy_˘xt
 *
phy˘xt
;

119 
iwl_lök_c⁄fig_cmd
 
cmd
 = {};

120 
u32
 
ht_Êag
, 
Êags
 = 0, 
Êags_mask
 = 0;

121 
ªt
;

122 
cmd_id
 = 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
LINK_CONFIG_CMD
);

123 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
, 1);

125 i‡(
	`WARN_ON_ONCE
(!
lök_öfo
 ||

126 
lök_öfo
->
fw_lök_id
 =
IWL_MVM_FW_LINK_ID_INVALID
))

127  -
EINVAL
;

129 i‡(
ch™ges
 & 
LINK_CONTEXT_MODIFY_ACTIVE
) {

136 i‡(!
lök_öfo
->
phy_˘xt
)

142 
	`WARN_ON_ONCE
(
a˘ive
 =
lök_öfo
->active);

147 i‡(!
a˘ive
 && 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

148 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

151 
cmd
.
lök_id
 = 
	`˝u_to_À32
(
lök_öfo
->
fw_lök_id
);

156 
phy˘xt
 = 
lök_öfo
->
phy_˘xt
;

157 i‡(
phy˘xt
)

158 
cmd
.
phy_id
 = 
	`˝u_to_À32
(
phy˘xt
->
id
);

160 
cmd
.
phy_id
 = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

161 
cmd
.
mac_id
 = 
	`˝u_to_À32
(
mvmvif
->
id
);

163 
	`mem˝y
(
cmd
.
loˇl_lök_addr
, 
lök_c⁄f
->
addr
, 
ETH_ALEN
);

165 
cmd
.
a˘ive
 = 
	`˝u_to_À32
(active);

167 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
 && 
lök_c⁄f
->
bssid
)

168 
	`mem˝y
(
cmd
.
ibss_bssid_addr
, 
lök_c⁄f
->
bssid
, 
ETH_ALEN
);

170 
	`iwl_mvm_£t_fw_basic_øãs
(
mvm
, 
vif
, 
lök_c⁄f
,

171 &
cmd
.
cck_øãs
, &cmd.
ofdm_øãs
);

173 
cmd
.
cck_sh‹t_¥ómbÀ
 = 
	`˝u_to_À32
(
lök_c⁄f
->
u£_sh‹t_¥ómbÀ
);

174 
cmd
.
sh‹t_¶Ÿ
 = 
	`˝u_to_À32
(
lök_c⁄f
->
u£_sh‹t_¶Ÿ
);

177 
ht_Êag
 = 
LINK_PROT_FLG_HT_PROT
 | 
LINK_PROT_FLG_FAT_PROT
;

178 
	`iwl_mvm_£t_fw_¥Ÿe˘i⁄_Êags
(
mvm
, 
vif
, 
lök_c⁄f
,

179 &
cmd
.
¥Ÿe˘i⁄_Êags
,

180 
ht_Êag
, 
LINK_PROT_FLG_TGG_PROTECT
);

182 
	`iwl_mvm_£t_fw_qos_∑øms
(
mvm
, 
vif
, 
lök_c⁄f
, 
cmd
.
ac
,

183 &
cmd
.
qos_Êags
);

186 
cmd
.
bi
 = 
	`˝u_to_À32
(
lök_c⁄f
->
bóc⁄_öt
);

187 
cmd
.
dtim_öãrvÆ
 = 
	`˝u_to_À32
(
lök_c⁄f
->
bóc⁄_öt
 *

188 
lök_c⁄f
->
dtim_≥riod
);

190 i‡(!
lök_c⁄f
->
he_suµ‹t
 || 
iwlwifi_mod_∑øms
.
dißbÀ_11ax
 ||

191 (
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
cfg
.
assoc
)) {

192 
ch™ges
 &~
LINK_CONTEXT_MODIFY_HE_PARAMS
;

193 
£nd_cmd
;

196 
cmd
.
htc_åig_ba£d_pkt_ext
 = 
lök_c⁄f
->htc_trig_based_pkt_ext;

198 i‡(
lök_c⁄f
->
u‹a_exi°s
) {

199 
cmd
.
ønd_Æloc_ecwmö
 =

200 
lök_c⁄f
->
u‹a_ocw_ønge
 & 0x7;

201 
cmd
.
ønd_Æloc_ecwmax
 =

202 (
lök_c⁄f
->
u‹a_ocw_ønge
 >> 3) & 0x7;

207 i‡(
	`iwl_mvm_£t_fw_mu_edˇ_∑øms
(
mvm
, 
mvmvif
->
lök
[
lök_id
],

208 &
cmd
.
åig_ba£d_txf
[0])) {

209 
Êags
 |
LINK_FLG_MU_EDCA_CW
;

210 
Êags_mask
 |
LINK_FLG_MU_EDCA_CW
;

213 i‡(
ch™ges
 & 
LINK_CONTEXT_MODIFY_EHT_PARAMS
) {

214 
õì80211_ch™˘x_c⁄f
 *
˘x
;

215 
cfg80211_ch™_def
 *
def
 = 
NULL
;

217 
	`rcu_ªad_lock
();

218 
˘x
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->
ch™˘x_c⁄f
);

219 i‡(
˘x
)

220 
def
 = 
	`iwl_mvm_ch™˘x_def
(
mvm
, 
˘x
);

222 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11be
 ||

223 !
lök_c⁄f
->
eht_suµ‹t
 || !
def
 ||

224 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
PHY_CONTEXT_CMD
, 1) >= 6)

225 
ch™ges
 &~
LINK_CONTEXT_MODIFY_EHT_PARAMS
;

227 
cmd
.
pun˘uª_mask
 = 
	`˝u_to_À16
(
def
->
pun˘uªd
);

228 
	`rcu_ªad_u∆ock
();

231 
cmd
.
bss_cﬁ‹
 = 
lök_c⁄f
->
he_bss_cﬁ‹
.
cﬁ‹
;

233 i‡(!
lök_c⁄f
->
he_bss_cﬁ‹
.
íabÀd
) {

234 
Êags
 |
LINK_FLG_BSS_COLOR_DIS
;

235 
Êags_mask
 |
LINK_FLG_BSS_COLOR_DIS
;

238 
cmd
.
‰ame_time_πs_th
 = 
	`˝u_to_À16
(
lök_c⁄f
->frame_time_rts_th);

241 i‡(
lök_öfo
->
he_ru_2mhz_block
) {

242 
Êags
 |
LINK_FLG_RU_2MHZ_BLOCK
;

243 
Êags_mask
 |
LINK_FLG_RU_2MHZ_BLOCK
;

246 i‡(
lök_c⁄f
->
n⁄å™smôãd
) {

247 
	`ëhî_addr_c›y
(
cmd
.
ªf_bssid_addr
,

248 
lök_c⁄f
->
å™smôãr_bssid
);

249 
cmd
.
bssid_ödex
 = 
lök_c⁄f
->bssid_index;

252 
£nd_cmd
:

253 
cmd
.
modify_mask
 = 
	`˝u_to_À32
(
ch™ges
);

254 
cmd
.
Êags
 = 
	`˝u_to_À32
(flags);

255 
cmd
.
Êags_mask
 = 
	`˝u_to_À32
(flags_mask);

256 
cmd
.
•ec_lök_id
 = 
lök_c⁄f
->
lök_id
;

257 i‡(
cmd_vî
 < 2)

258 
cmd
.
li°í_lmac
 = 
	`˝u_to_À32
(
lök_öfo
->listen_lmac);

260 
ªt
 = 
	`iwl_mvm_lök_cmd_£nd
(
mvm
, &
cmd
, 
FW_CTXT_ACTION_MODIFY
);

261 i‡(!
ªt
 && (
ch™ges
 & 
LINK_CONTEXT_MODIFY_ACTIVE
))

262 
lök_öfo
->
a˘ive
 =áctive;

264  
ªt
;

265 
	}
}

267 
	$iwl_mvm_un£t_lök_m≠pög
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

268 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

270 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

271 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 =

272 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

275 i‡(
	`WARN_ON
(!
lök_öfo
 ||

276 
lök_öfo
->
fw_lök_id
 >=

277 
	`ARRAY_SIZE
(
mvm
->
lök_id_to_lök_c⁄f
)))

278  -
EINVAL
;

280 
	`RCU_INIT_POINTER
(
mvm
->
lök_id_to_lök_c⁄f
[
lök_öfo
->
fw_lök_id
],

281 
NULL
);

282 
	`iwl_mvm_ªÀa£_fw_lök_id
(
mvm
, 
lök_öfo
->
fw_lök_id
);

284 
	}
}

286 
	$iwl_mvm_ªmove_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

287 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

289 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

290 
lök_id
 = 
lök_c⁄f
->link_id;

291 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

292 
iwl_lök_c⁄fig_cmd
 
cmd
 = {};

293 
ªt
;

295 
ªt
 = 
	`iwl_mvm_un£t_lök_m≠pög
(
mvm
, 
vif
, 
lök_c⁄f
);

296 i‡(
ªt
)

299 
cmd
.
lök_id
 = 
	`˝u_to_À32
(
lök_öfo
->
fw_lök_id
);

300 
lök_öfo
->
fw_lök_id
 = 
IWL_MVM_FW_LINK_ID_INVALID
;

301 
cmd
.
•ec_lök_id
 = 
lök_c⁄f
->
lök_id
;

302 
cmd
.
phy_id
 = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

304 
ªt
 = 
	`iwl_mvm_lök_cmd_£nd
(
mvm
, &
cmd
, 
FW_CTXT_ACTION_REMOVE
);

306 i‡(!
ªt
)

307 i‡(
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
åue
))

308 
	`IWL_ERR
(
mvm
, "FailedÅo update SF state\n");

310  
ªt
;

311 
	}
}

316 
	$iwl_mvm_dißbÀ_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

317 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

319 
ªt
;

321 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
,

322 
LINK_CONTEXT_MODIFY_ACTIVE
, 
Ál£
);

323 i‡(
ªt
)

324  
ªt
;

326 
ªt
 = 
	`iwl_mvm_ªmove_lök
(
mvm
, 
vif
, 
lök_c⁄f
);

327 i‡(
ªt
)

328  
ªt
;

330  
ªt
;

331 
	}
}

	@mvm/mac-ctxt.c

7 
	~<löux/ëhîdevi˚.h
>

8 
	~<löux/¸c32.h
>

9 
	~<√t/mac80211.h
>

10 
	~"iwl-io.h
"

11 
	~"iwl-¥ph.h
"

12 
	~"fw-≠i.h
"

13 
	~"mvm.h
"

14 
	~"time-evít.h
"

16 c⁄° 
u8
 
	giwl_mvm_ac_to_tx_fifo
[] = {

17 
IWL_MVM_TX_FIFO_VO
,

18 
IWL_MVM_TX_FIFO_VI
,

19 
IWL_MVM_TX_FIFO_BE
,

20 
IWL_MVM_TX_FIFO_BK
,

23 c⁄° 
u8
 
	giwl_mvm_ac_to_gí2_tx_fifo
[] = {

24 
IWL_GEN2_EDCA_TX_FIFO_VO
,

25 
IWL_GEN2_EDCA_TX_FIFO_VI
,

26 
IWL_GEN2_EDCA_TX_FIFO_BE
,

27 
IWL_GEN2_EDCA_TX_FIFO_BK
,

28 
IWL_GEN2_TRIG_TX_FIFO_VO
,

29 
IWL_GEN2_TRIG_TX_FIFO_VI
,

30 
IWL_GEN2_TRIG_TX_FIFO_BE
,

31 
IWL_GEN2_TRIG_TX_FIFO_BK
,

34 c⁄° 
u8
 
	giwl_mvm_ac_to_bz_tx_fifo
[] = {

35 
IWL_BZ_EDCA_TX_FIFO_VO
,

36 
IWL_BZ_EDCA_TX_FIFO_VI
,

37 
IWL_BZ_EDCA_TX_FIFO_BE
,

38 
IWL_BZ_EDCA_TX_FIFO_BK
,

39 
IWL_BZ_TRIG_TX_FIFO_VO
,

40 
IWL_BZ_TRIG_TX_FIFO_VI
,

41 
IWL_BZ_TRIG_TX_FIFO_BE
,

42 
IWL_BZ_TRIG_TX_FIFO_BK
,

45 
	siwl_mvm_mac_iÁ˚_ôî©‹_d©a
 {

46 
iwl_mvm
 *
	mmvm
;

47 
õì80211_vif
 *
	mvif
;

48 
	mavaûabÀ_mac_ids
[
BITS_TO_LONGS
(
NUM_MAC_INDEX_DRIVER
)];

49 
	mavaûabÀ_tsf_ids
[
BITS_TO_LONGS
(
NUM_TSF_IDS
)];

50 
iwl_tsf_id
 
	m¥e„ºed_tsf
;

51 
boﬁ
 
	mfound_vif
;

54 
	$iwl_mvm_mac_tsf_id_ôî
(*
_d©a
, 
u8
 *
mac
,

55 
õì80211_vif
 *
vif
)

57 
iwl_mvm_mac_iÁ˚_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

58 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

59 
u16
 
mö_bi
;

62 i‡(
vif
 =
d©a
->vif)

81 
d©a
->
vif
->
ty≥
) {

82 
NL80211_IFTYPE_STATION
:

91 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 ||

92 
d©a
->
¥e„ºed_tsf
 !
NUM_TSF_IDS
 ||

93 !
	`ã°_bô
(
mvmvif
->
tsf_id
, 
d©a
->
avaûabÀ_tsf_ids
))

96 
mö_bi
 = 
	`mö
(
d©a
->
vif
->
bss_c⁄f
.
bóc⁄_öt
,

97 
vif
->
bss_c⁄f
.
bóc⁄_öt
);

99 i‡(!
mö_bi
)

102 i‡((
d©a
->
vif
->
bss_c⁄f
.
bóc⁄_öt
 -

103 
vif
->
bss_c⁄f
.
bóc⁄_öt
Ë% 
mö_bi
 == 0) {

104 
d©a
->
¥e„ºed_tsf
 = 
mvmvif
->
tsf_id
;

109 
NL80211_IFTYPE_AP
:

119 i‡((
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 &&

120 
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
) ||

121 
d©a
->
¥e„ºed_tsf
 !
NUM_TSF_IDS
 ||

122 !
	`ã°_bô
(
mvmvif
->
tsf_id
, 
d©a
->
avaûabÀ_tsf_ids
))

125 
mö_bi
 = 
	`mö
(
d©a
->
vif
->
bss_c⁄f
.
bóc⁄_öt
,

126 
vif
->
bss_c⁄f
.
bóc⁄_öt
);

128 i‡(!
mö_bi
)

131 i‡((
d©a
->
vif
->
bss_c⁄f
.
bóc⁄_öt
 -

132 
vif
->
bss_c⁄f
.
bóc⁄_öt
Ë% 
mö_bi
 == 0) {

133 
d©a
->
¥e„ºed_tsf
 = 
mvmvif
->
tsf_id
;

154 
	`__˛ór_bô
(
mvmvif
->
tsf_id
, 
d©a
->
avaûabÀ_tsf_ids
);

156 i‡(
d©a
->
¥e„ºed_tsf
 =
mvmvif
->
tsf_id
)

157 
d©a
->
¥e„ºed_tsf
 = 
NUM_TSF_IDS
;

158 
	}
}

160 
	$iwl_mvm_mac_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

161 
õì80211_vif
 *
vif
)

163 
iwl_mvm_mac_iÁ˚_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

164 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

167 i‡(
vif
 =
d©a
->vif) {

168 
d©a
->
found_vif
 = 
åue
;

178 
	`__˛ór_bô
(
mvmvif
->
id
, 
d©a
->
avaûabÀ_mac_ids
);

181 
	`iwl_mvm_mac_tsf_id_ôî
(
_d©a
, 
mac
, 
vif
);

182 
	}
}

184 
	$iwl_mvm_mac_˘xt_ªˇlc_tsf_id
(
iwl_mvm
 *
mvm
,

185 
õì80211_vif
 *
vif
)

187 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

188 
iwl_mvm_mac_iÁ˚_ôî©‹_d©a
 
d©a
 = {

189 .
mvm
 = mvm,

190 .
vif
 = vif,

191 .
avaûabÀ_tsf_ids
 = { (1 << 
NUM_TSF_IDS
) - 1 },

193 .
¥e„ºed_tsf
 = 
NUM_TSF_IDS
,

196 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

197 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

198 
iwl_mvm_mac_tsf_id_ôî
, &
d©a
);

200 i‡(
d©a
.
¥e„ºed_tsf
 !
NUM_TSF_IDS
)

201 
mvmvif
->
tsf_id
 = 
d©a
.
¥e„ºed_tsf
;

202 i‡(!
	`ã°_bô
(
mvmvif
->
tsf_id
, 
d©a
.
avaûabÀ_tsf_ids
))

203 
mvmvif
->
tsf_id
 = 
	`föd_fú°_bô
(
d©a
.
avaûabÀ_tsf_ids
,

204 
NUM_TSF_IDS
);

205 
	}
}

207 
	$iwl_mvm_mac_˘xt_öô
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

209 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

210 
iwl_mvm_mac_iÁ˚_ôî©‹_d©a
 
d©a
 = {

211 .
mvm
 = mvm,

212 .
vif
 = vif,

213 .
avaûabÀ_mac_ids
 = { (1 << 
NUM_MAC_INDEX_DRIVER
) - 1 },

214 .
avaûabÀ_tsf_ids
 = { (1 << 
NUM_TSF_IDS
) - 1 },

216 .
¥e„ºed_tsf
 = 
NUM_TSF_IDS
,

217 .
found_vif
 = 
Ál£
,

219 
ªt
, 
i
;

221 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

242 i‡(!
mvm
->
mld_≠i_is_u£d
) {

243 
vif
->
ty≥
) {

244 
NL80211_IFTYPE_ADHOC
:

246 
NL80211_IFTYPE_STATION
:

247 i‡(!
vif
->
p2p
)

249 
ÁŒthrough
;

251 
	`__˛ór_bô
(0, 
d©a
.
avaûabÀ_mac_ids
);

255 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

256 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

257 
iwl_mvm_mac_iÁ˚_ôî©‹
, &
d©a
);

269 i‡(
d©a
.
found_vif
)

273 i‡(
	`WARN_ON_ONCE
(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)))

274  -
EBUSY
;

276 
mvmvif
->
id
 = 
	`föd_fú°_bô
(
d©a
.
avaûabÀ_mac_ids
,

277 
NUM_MAC_INDEX_DRIVER
);

278 i‡(
mvmvif
->
id
 =
NUM_MAC_INDEX_DRIVER
) {

279 
	`IWL_ERR
(
mvm
, "FailedÅo init MAC context -Ço free ID!\n");

280 
ªt
 = -
EIO
;

281 
exô_Áû
;

284 i‡(
d©a
.
¥e„ºed_tsf
 !
NUM_TSF_IDS
)

285 
mvmvif
->
tsf_id
 = 
d©a
.
¥e„ºed_tsf
;

287 
mvmvif
->
tsf_id
 = 
	`föd_fú°_bô
(
d©a
.
avaûabÀ_tsf_ids
,

288 
NUM_TSF_IDS
);

289 i‡(
mvmvif
->
tsf_id
 =
NUM_TSF_IDS
) {

290 
	`IWL_ERR
(
mvm
, "FailedÅo init MAC context -Ço free TSF!\n");

291 
ªt
 = -
EIO
;

292 
exô_Áû
;

295 
mvmvif
->
cﬁ‹
 = 0;

297 
	`INIT_LIST_HEAD
(&
mvmvif
->
time_evít_d©a
.
li°
);

298 
mvmvif
->
time_evít_d©a
.
id
 = 
TE_MAX
;

300 
mvmvif
->
deÊök
.
bˇ°_°a
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

301 
mvmvif
->
deÊök
.
mˇ°_°a
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

302 
mvmvif
->
deÊök
.
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

305 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
)

309 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

310 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

315 
mvmvif
->
deÊök
.
ˇb_queue
 = 
IWL_MVM_DQA_GCAST_QUEUE
;

318 
i
 = 0; i < 
NUM_IWL_MVM_SMPS_REQ
; i++)

319 
mvmvif
->
deÊök
.
smps_ªque°s
[
i
] = 
IEEE80211_SMPS_AUTOMATIC
;

323 
exô_Áû
:

324 
	`mem£t
(
mvmvif
, 0, (
iwl_mvm_vif
));

325  
ªt
;

326 
	}
}

328 
	$iwl_mvm_ack_øãs
(
iwl_mvm
 *
mvm
,

329 
õì80211_vif
 *
vif
,

330 
∆80211_b™d
 
b™d
,

331 
u8
 *
cck_øãs
, u8 *
ofdm_øãs
)

333 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

334 
basic
 = 
vif
->
bss_c⁄f
.
basic_øãs
;

335 
lowe°_¥e£¡_ofdm
 = 100;

336 
lowe°_¥e£¡_cck
 = 100;

337 
u8
 
cck
 = 0;

338 
u8
 
ofdm
 = 0;

339 
i
;

341 
sb™d
 = 
mvm
->
hw
->
wùhy
->
b™ds
[
b™d
];

343 
	`f‹_óch_£t_bô
(
i
, &
basic
, 
BITS_PER_LONG
) {

344 
hw
 = 
sb™d
->
bôøãs
[
i
].
hw_vÆue
;

345 i‡(
hw
 >
IWL_FIRST_OFDM_RATE
) {

346 
ofdm
 |
	`BIT
(
hw
 - 
IWL_FIRST_OFDM_RATE
);

347 i‡(
lowe°_¥e£¡_ofdm
 > 
hw
)

348 
lowe°_¥e£¡_ofdm
 = 
hw
;

350 
	`BUILD_BUG_ON
(
IWL_FIRST_CCK_RATE
 != 0);

352 
cck
 |
	`BIT
(
hw
);

353 i‡(
lowe°_¥e£¡_cck
 > 
hw
)

354 
lowe°_¥e£¡_cck
 = 
hw
;

381 i‡(
IWL_RATE_24M_INDEX
 < 
lowe°_¥e£¡_ofdm
)

382 
ofdm
 |
	`IWL_RATE_BIT_MSK
(24Ë>> 
IWL_FIRST_OFDM_RATE
;

383 i‡(
IWL_RATE_12M_INDEX
 < 
lowe°_¥e£¡_ofdm
)

384 
ofdm
 |
	`IWL_RATE_BIT_MSK
(12Ë>> 
IWL_FIRST_OFDM_RATE
;

386 
ofdm
 |
	`IWL_RATE_BIT_MSK
(6Ë>> 
IWL_FIRST_OFDM_RATE
;

401 i‡(
IWL_RATE_11M_INDEX
 < 
lowe°_¥e£¡_cck
)

402 
cck
 |
	`IWL_RATE_BIT_MSK
(11Ë>> 
IWL_FIRST_CCK_RATE
;

403 i‡(
IWL_RATE_5M_INDEX
 < 
lowe°_¥e£¡_cck
)

404 
cck
 |
	`IWL_RATE_BIT_MSK
(5Ë>> 
IWL_FIRST_CCK_RATE
;

405 i‡(
IWL_RATE_2M_INDEX
 < 
lowe°_¥e£¡_cck
)

406 
cck
 |
	`IWL_RATE_BIT_MSK
(2Ë>> 
IWL_FIRST_CCK_RATE
;

408 
cck
 |
	`IWL_RATE_BIT_MSK
(1Ë>> 
IWL_FIRST_CCK_RATE
;

410 *
cck_øãs
 = 
cck
;

411 *
ofdm_øãs
 = 
ofdm
;

412 
	}
}

414 
	$iwl_mvm_£t_fw_basic_øãs
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

415 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

416 
__À32
 *
cck_øãs
, __À32 *
ofdm_øãs
)

418 
õì80211_ch™˘x_c⁄f
 *
ch™˘x
;

419 
u8
 
cck_ack_øãs
 = 0, 
ofdm_ack_øãs
 = 0;

421 
	`rcu_ªad_lock
();

422 
ch™˘x
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->
ch™˘x_c⁄f
);

423 
	`iwl_mvm_ack_øãs
(
mvm
, 
vif
, 
ch™˘x
 ? ch™˘x->
def
.
ch™
->
b™d


424 : 
NL80211_BAND_2GHZ
,

425 &
cck_ack_øãs
, &
ofdm_ack_øãs
);

427 
	`rcu_ªad_u∆ock
();

429 *
cck_øãs
 = 
	`˝u_to_À32
((
u32
)
cck_ack_øãs
);

430 *
ofdm_øãs
 = 
	`˝u_to_À32
((
u32
)
ofdm_ack_øãs
);

431 
	}
}

433 
	$iwl_mvm_£t_fw_¥Ÿe˘i⁄_Êags
(
iwl_mvm
 *
mvm
,

434 
õì80211_vif
 *
vif
,

435 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

436 
__À32
 *
¥Ÿe˘i⁄_Êags
, 
u32
 
ht_Êag
,

437 
u32
 
tgg_Êag
)

440 
u8
 
¥Ÿe˘i⁄_mode
 = 
lök_c⁄f
->
ht_›î©i⁄_mode
 &

441 
IEEE80211_HT_OP_MODE_PROTECTION
;

442 
boﬁ
 
ht_íabÀd
 = !!(
lök_c⁄f
->
ht_›î©i⁄_mode
 &

443 
IEEE80211_HT_OP_MODE_PROTECTION
);

445 i‡(
lök_c⁄f
->
u£_˘s_¥Ÿ
)

446 *
¥Ÿe˘i⁄_Êags
 |
	`˝u_to_À32
(
tgg_Êag
);

448 
	`IWL_DEBUG_RATE
(
mvm
, "use_cts_prot %d, ht_operation_mode %d\n",

449 
lök_c⁄f
->
u£_˘s_¥Ÿ
,

450 
lök_c⁄f
->
ht_›î©i⁄_mode
);

452 i‡(!
ht_íabÀd
)

455 
	`IWL_DEBUG_RATE
(
mvm
, "¥Ÿe˘i⁄ modê£àtÿ%d\n", 
¥Ÿe˘i⁄_mode
);

460 
¥Ÿe˘i⁄_mode
) {

461 
IEEE80211_HT_OP_MODE_PROTECTION_NONE
:

463 
IEEE80211_HT_OP_MODE_PROTECTION_NONMEMBER
:

464 
IEEE80211_HT_OP_MODE_PROTECTION_NONHT_MIXED
:

465 *
¥Ÿe˘i⁄_Êags
 |
	`˝u_to_À32
(
ht_Êag
);

467 
IEEE80211_HT_OP_MODE_PROTECTION_20MHZ
:

469 i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
width
 > 
NL80211_CHAN_WIDTH_20
)

470 *
¥Ÿe˘i⁄_Êags
 |
	`˝u_to_À32
(
ht_Êag
);

473 
	`IWL_ERR
(
mvm
, "IllegalÖrotection mode %d\n",

474 
¥Ÿe˘i⁄_mode
);

477 
	}
}

479 
	$iwl_mvm_£t_fw_qos_∑øms
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

480 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

481 
iwl_ac_qos
 *
ac
, 
__À32
 *
qos_Êags
)

483 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

484 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 =

485 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

486 
i
;

488 i‡(!
mvm_lök
)

491 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

492 
u8
 
txf
 = 
	`iwl_mvm_mac_ac_to_tx_fifo
(
mvm
, 
i
);

493 
u8
 
ucode_ac
 = 
	`iwl_mvm_mac80211_ac_to_ucode_ac
(
i
);

495 
ac
[
ucode_ac
].
cw_mö
 =

496 
	`˝u_to_À16
(
mvm_lök
->
queue_∑øms
[
i
].
cw_mö
);

497 
ac
[
ucode_ac
].
cw_max
 =

498 
	`˝u_to_À16
(
mvm_lök
->
queue_∑øms
[
i
].
cw_max
);

499 
ac
[
ucode_ac
].
edˇ_tx›
 =

500 
	`˝u_to_À16
(
mvm_lök
->
queue_∑øms
[
i
].
tx›
 * 32);

501 
ac
[
ucode_ac
].
aif¢
 = 
mvm_lök
->
queue_∑øms
[
i
].
aifs
;

502 
ac
[
ucode_ac
].
fifos_mask
 = 
	`BIT
(
txf
);

505 i‡(
lök_c⁄f
->
qos
)

506 *
qos_Êags
 |
	`˝u_to_À32
(
MAC_QOS_FLG_UPDATE_EDCA
);

508 i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
width
 !
NL80211_CHAN_WIDTH_20_NOHT
)

509 *
qos_Êags
 |
	`˝u_to_À32
(
MAC_QOS_FLG_TGN
);

510 
	}
}

512 
	$iwl_mvm_gë_mac_ty≥
(
õì80211_vif
 *
vif
)

514 
u32
 
mac_ty≥
 = 
FW_MAC_TYPE_BSS_STA
;

516 
vif
->
ty≥
) {

517 
NL80211_IFTYPE_STATION
:

518 i‡(
vif
->
p2p
)

519 
mac_ty≥
 = 
FW_MAC_TYPE_P2P_STA
;

521 
mac_ty≥
 = 
FW_MAC_TYPE_BSS_STA
;

523 
NL80211_IFTYPE_AP
:

524 
mac_ty≥
 = 
FW_MAC_TYPE_GO
;

526 
NL80211_IFTYPE_MONITOR
:

527 
mac_ty≥
 = 
FW_MAC_TYPE_LISTENER
;

529 
NL80211_IFTYPE_P2P_DEVICE
:

530 
mac_ty≥
 = 
FW_MAC_TYPE_P2P_DEVICE
;

532 
NL80211_IFTYPE_ADHOC
:

533 
mac_ty≥
 = 
FW_MAC_TYPE_IBSS
;

536 
	`WARN_ON_ONCE
(1);

538  
mac_ty≥
;

539 
	}
}

541 
	$iwl_mvm_mac_˘xt_cmd_comm⁄
(
iwl_mvm
 *
mvm
,

542 
õì80211_vif
 *
vif
,

543 
iwl_mac_˘x_cmd
 *
cmd
,

544 c⁄° 
u8
 *
bssid_ovîride
,

545 
u32
 
a˘i⁄
)

547 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

548 c⁄° 
u8
 *
bssid
 = 
bssid_ovîride
 ?: 
vif
->
bss_c⁄f
.bssid;

549 
u32
 
ht_Êag
;

551 
cmd
->
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

552 
mvmvif
->
cﬁ‹
));

553 
cmd
->
a˘i⁄
 = 
	`˝u_to_À32
(action);

554 
cmd
->
mac_ty≥
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_mac_ty≥
(
vif
));

556 
cmd
->
tsf_id
 = 
	`˝u_to_À32
(
mvmvif
->tsf_id);

558 
	`mem˝y
(
cmd
->
node_addr
, 
vif
->
addr
, 
ETH_ALEN
);

560 i‡(
bssid
)

561 
	`mem˝y
(
cmd
->
bssid_addr
, 
bssid
, 
ETH_ALEN
);

563 
	`ëh_brﬂdˇ°_addr
(
cmd
->
bssid_addr
);

565 
	`iwl_mvm_£t_fw_basic_øãs
(
mvm
, 
vif
, &vif->
bss_c⁄f
, &
cmd
->
cck_øãs
,

566 &
cmd
->
ofdm_øãs
);

568 
cmd
->
cck_sh‹t_¥ómbÀ
 =

569 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
u£_sh‹t_¥ómbÀ
 ?

570 
MAC_FLG_SHORT_PREAMBLE
 : 0);

571 
cmd
->
sh‹t_¶Ÿ
 =

572 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
u£_sh‹t_¶Ÿ
 ?

573 
MAC_FLG_SHORT_SLOT
 : 0);

575 
cmd
->
fûãr_Êags
 = 0;

577 
	`iwl_mvm_£t_fw_qos_∑øms
(
mvm
, 
vif
, &vif->
bss_c⁄f
, 
cmd
->
ac
,

578 &
cmd
->
qos_Êags
);

581 
ht_Êag
 = 
MAC_PROT_FLG_HT_PROT
 | 
MAC_PROT_FLG_FAT_PROT
;

582 
	`iwl_mvm_£t_fw_¥Ÿe˘i⁄_Êags
(
mvm
, 
vif
, &vif->
bss_c⁄f
,

583 &
cmd
->
¥Ÿe˘i⁄_Êags
,

584 
ht_Êag
, 
MAC_PROT_FLG_TGG_PROTECT
);

585 
	}
}

587 
	$iwl_mvm_mac_˘xt_£nd_cmd
(
iwl_mvm
 *
mvm
,

588 
iwl_mac_˘x_cmd
 *
cmd
)

590 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
MAC_CONTEXT_CMD
, 0,

591 (*
cmd
), cmd);

592 i‡(
ªt
)

593 
	`IWL_ERR
(
mvm
, "FailedÅo send MAC_CONTEXT_CMD (action:%d): %d\n",

594 
	`À32_to_˝u
(
cmd
->
a˘i⁄
), 
ªt
);

595  
ªt
;

596 
	}
}

598 
	$iwl_mvm_£t_fw_dtim_tbâ
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

599 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

600 
__À64
 *
dtim_tsf
, 
__À32
 *
dtim_time
,

601 
__À32
 *
assoc_bóc⁄_¨rive_time
)

603 
u32
 
dtim_offs
;

620 
dtim_offs
 = 
lök_c⁄f
->
sync_dtim_cou¡
 *

621 
lök_c⁄f
->
bóc⁄_öt
;

623 
dtim_offs
 *= 1024;

625 *
dtim_tsf
 =

626 
	`˝u_to_À64
(
lök_c⁄f
->
sync_tsf
 + 
dtim_offs
);

627 *
dtim_time
 =

628 
	`˝u_to_À32
(
lök_c⁄f
->
sync_devi˚_ts
 + 
dtim_offs
);

629 *
assoc_bóc⁄_¨rive_time
 =

630 
	`˝u_to_À32
(
lök_c⁄f
->
sync_devi˚_ts
);

632 
	`IWL_DEBUG_INFO
(
mvm
, "DTIM TBTT is 0x%llx/0x%x, offset %d\n",

633 
	`À64_to_˝u
(*
dtim_tsf
),

634 
	`À32_to_˝u
(*
dtim_time
),

635 
dtim_offs
);

636 
	}
}

638 
__À32
 
	$iwl_mvm_mac_˘xt_cmd_p2p_°a_gë_›µs_˘wö
(
iwl_mvm
 *
mvm
,

639 
õì80211_vif
 *
vif
)

641 
õì80211_p2p_nﬂ_©å
 *
nﬂ
 =

642 &
vif
->
bss_c⁄f
.
p2p_nﬂ_©å
;

644  
	`˝u_to_À32
(
nﬂ
->
›µs_˘wödow
 &

645 
IEEE80211_P2P_OPPPS_CTWINDOW_MASK
);

646 
	}
}

648 
u32
 
	$iwl_mvm_mac_˘xt_cmd_°a_gë_twt_pﬁicy
(
iwl_mvm
 *
mvm
,

649 
õì80211_vif
 *
vif
)

651 
u32
 
twt_pﬁicy
 = 0;

653 i‡(
vif
->
bss_c⁄f
.
twt_ªque°î
 && 
IWL_MVM_USE_TWT
)

654 
twt_pﬁicy
 |
TWT_SUPPORTED
;

655 i‡(
vif
->
bss_c⁄f
.
twt_¥Ÿe˘ed
)

656 
twt_pﬁicy
 |
PROTECTED_TWT_SUPPORTED
;

657 i‡(
vif
->
bss_c⁄f
.
twt_brﬂdˇ°
)

658 
twt_pﬁicy
 |
BROADCAST_TWT_SUPPORTED
;

660  
twt_pﬁicy
;

661 
	}
}

663 
	$iwl_mvm_mac_˘xt_cmd_°a
(
iwl_mvm
 *
mvm
,

664 
õì80211_vif
 *
vif
,

665 
u32
 
a˘i⁄
, 
boﬁ
 
f‹˚_assoc_off
,

666 c⁄° 
u8
 *
bssid_ovîride
)

668 
iwl_mac_˘x_cmd
 
cmd
 = {};

669 
iwl_mac_d©a_°a
 *
˘xt_°a
;

671 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
);

674 
	`iwl_mvm_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
bssid_ovîride
, 
a˘i⁄
);

680 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_FILTER_ACCEPT_GRP
);

682 i‡(
vif
->
p2p
) {

683 
cmd
.
p2p_°a
.
˘wö
 =

684 
	`iwl_mvm_mac_˘xt_cmd_p2p_°a_gë_›µs_˘wö
(
mvm
, 
vif
);

686 
˘xt_°a
 = &
cmd
.
p2p_°a
.
°a
;

688 
˘xt_°a
 = &
cmd
.
°a
;

692 i‡(
vif
->
cfg
.
assoc
 && vif->
bss_c⁄f
.
dtim_≥riod
 &&

693 !
f‹˚_assoc_off
) {

694 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

696 
	`iwl_mvm_£t_fw_dtim_tbâ
(
mvm
, 
vif
, &vif->
bss_c⁄f
,

697 &
˘xt_°a
->
dtim_tsf
,

698 &
˘xt_°a
->
dtim_time
,

699 &
˘xt_°a
->
assoc_bóc⁄_¨rive_time
);

701 
˘xt_°a
->
is_assoc
 = 
	`˝u_to_À32
(1);

703 i‡(!
mvmvif
->
auth‹ized
 &&

704 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

705 
IWL_UCODE_TLV_CAPA_COEX_HIGH_PRIO
))

706 
˘xt_°a
->
d©a_pﬁicy
 |=

707 
	`˝u_to_À32
(
COEX_HIGH_PRIORITY_ENABLE
);

709 
˘xt_°a
->
is_assoc
 = 
	`˝u_to_À32
(0);

714 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_FILTER_IN_BEACON
);

717 
˘xt_°a
->
bi
 = 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
bóc⁄_öt
);

718 
˘xt_°a
->
dtim_öãrvÆ
 = 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
bóc⁄_öt
 *

719 
vif
->
bss_c⁄f
.
dtim_≥riod
);

721 
˘xt_°a
->
li°í_öãrvÆ
 = 
	`˝u_to_À32
(
mvm
->
hw
->
c⁄f
.listen_interval);

722 
˘xt_°a
->
assoc_id
 = 
	`˝u_to_À32
(
vif
->
cfg
.
aid
);

724 i‡(
vif
->
¥obe_ªq_ªg
 && vif->
cfg
.
assoc
 && vif->
p2p
)

725 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_FILTER_IN_PROBE_REQUEST
);

727 i‡(
vif
->
bss_c⁄f
.
he_suµ‹t
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
) {

728 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_FILTER_IN_11AX
);

729 
˘xt_°a
->
d©a_pﬁicy
 |=

730 
	`˝u_to_À32
(
	`iwl_mvm_mac_˘xt_cmd_°a_gë_twt_pﬁicy
(
mvm
, 
vif
));

734  
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

735 
	}
}

737 
	$iwl_mvm_mac_˘xt_cmd_li°íî
(
iwl_mvm
 *
mvm
,

738 
õì80211_vif
 *
vif
,

739 
u32
 
a˘i⁄
)

741 
iwl_mac_˘x_cmd
 
cmd
 = {};

742 
u32
 
tfd_queue_msk
 = 0;

743 
ªt
;

745 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_MONITOR
);

747 
	`iwl_mvm_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
NULL
, 
a˘i⁄
);

749 
cmd
.
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_FILTER_IN_PROMISC
 |

750 
MAC_FILTER_IN_CONTROL_AND_MGMT
 |

751 
MAC_FILTER_IN_BEACON
 |

752 
MAC_FILTER_IN_PROBE_REQUEST
 |

753 
MAC_FILTER_IN_CRC32
 |

754 
MAC_FILTER_ACCEPT_GRP
);

755 
	`õì80211_hw_£t
(
mvm
->
hw
, 
RX_INCLUDES_FCS
);

762 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

763 
tfd_queue_msk
 = 
	`BIT
(
mvm
->
¢if_queue
);

766 
ªt
 = 
	`iwl_mvm_Æloˇã_öt_°a
(
mvm
, &mvm->
¢if_°a
, 
tfd_queue_msk
,

767 
vif
->
ty≥
, 
IWL_STA_GENERAL_PURPOSE
);

768 i‡(
ªt
)

769  
ªt
;

771  
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

772 
	}
}

774 
	$iwl_mvm_mac_˘xt_cmd_ibss
(
iwl_mvm
 *
mvm
,

775 
õì80211_vif
 *
vif
,

776 
u32
 
a˘i⁄
)

778 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

779 
iwl_mac_˘x_cmd
 
cmd
 = {};

781 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_ADHOC
);

783 
	`iwl_mvm_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
NULL
, 
a˘i⁄
);

785 
cmd
.
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_FILTER_IN_BEACON
 |

786 
MAC_FILTER_IN_PROBE_REQUEST
 |

787 
MAC_FILTER_ACCEPT_GRP
);

790 
cmd
.
ibss
.
bi
 = 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
bóc⁄_öt
);

793 
cmd
.
ibss
.
bóc⁄_ãm∂©e
 = 
	`˝u_to_À32
(
mvmvif
->
id
);

795  
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

796 
	}
}

798 
	siwl_mvm_go_ôî©‹_d©a
 {

799 
boﬁ
 
	mgo_a˘ive
;

802 
	$iwl_mvm_go_ôî©‹
(*
_d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

804 
iwl_mvm_go_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

805 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

807 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && vif->
p2p
 &&

808 
mvmvif
->
≠_ibss_a˘ive
)

809 
d©a
->
go_a˘ive
 = 
åue
;

810 
	}
}

812 
__À32
 
	$iwl_mac_˘xt_p2p_dev_has_exãnded_disc
(
iwl_mvm
 *
mvm
,

813 
õì80211_vif
 *
vif
)

815 
iwl_mvm_go_ôî©‹_d©a
 
d©a
 = {};

825 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

826 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

827 
iwl_mvm_go_ôî©‹
, &
d©a
);

829  
	`˝u_to_À32
(
d©a
.
go_a˘ive
 ? 1 : 0);

830 
	}
}

832 
	$iwl_mvm_mac_˘xt_cmd_p2p_devi˚
(
iwl_mvm
 *
mvm
,

833 
õì80211_vif
 *
vif
,

834 
u32
 
a˘i⁄
)

836 
iwl_mac_˘x_cmd
 
cmd
 = {};

838 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
);

840 
	`iwl_mvm_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
NULL
, 
a˘i⁄
);

842 
cmd
.
p2p_dev
.
is_disc_exãnded
 =

843 
	`iwl_mac_˘xt_p2p_dev_has_exãnded_disc
(
mvm
, 
vif
);

846 
cmd
.
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_FILTER_IN_PROBE_REQUEST
);

848  
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

849 
	}
}

851 
	$iwl_mvm_mac_˘xt_£t_tim
(
iwl_mvm
 *
mvm
,

852 
__À32
 *
tim_ödex
, __À32 *
tim_size
,

853 
u8
 *
bóc⁄
, 
u32
 
‰ame_size
)

855 
u32
 
tim_idx
;

856 
õì80211_mgmt
 *
mgmt
 = (õì80211_mgmà*)
bóc⁄
;

860 
tim_idx
 = 
mgmt
->
u
.
bóc⁄
.
v¨übÀ
 - beacon;

863 (
tim_idx
 < (
‰ame_size
 - 2)) &&

864 (
bóc⁄
[
tim_idx
] !
WLAN_EID_TIM
))

865 
tim_idx
 +
bóc⁄
[tim_idx+1] + 2;

868 i‡((
tim_idx
 < (
‰ame_size
 - 1)Ë&& (
bóc⁄
[tim_idx] =
WLAN_EID_TIM
)) {

869 *
tim_ödex
 = 
	`˝u_to_À32
(
tim_idx
);

870 *
tim_size
 = 
	`˝u_to_À32
((
u32
)
bóc⁄
[
tim_idx
 + 1]);

872 
	`IWL_WARN
(
mvm
, "UnableÅo find TIM Element in beacon\n");

874 
	}
}

876 
u32
 
	$iwl_mvm_föd_õ_off£t
(
u8
 *
bóc⁄
, u8 
eid
, 
u32
 
‰ame_size
)

878 
õì80211_mgmt
 *
mgmt
 = (*)
bóc⁄
;

879 c⁄° 
u8
 *
õ
;

881 i‡(
	`WARN_ON_ONCE
(
‰ame_size
 <(
mgmt
->
u
.
bóc⁄
.
v¨übÀ
 - beacon)))

884 
‰ame_size
 -
mgmt
->
u
.
bóc⁄
.
v¨übÀ
 - beacon;

886 
õ
 = 
	`cfg80211_föd_õ
(
eid
, 
mgmt
->
u
.
bóc⁄
.
v¨übÀ
, 
‰ame_size
);

887 i‡(!
õ
)

890  
õ
 - 
bóc⁄
;

891 
	}
}

893 
u8
 
	$iwl_mvm_mac_˘xt_gë_lowe°_øã
(
iwl_mvm
 *
mvm
,

894 
õì80211_tx_öfo
 *
öfo
,

895 
õì80211_vif
 *
vif
)

897 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

898 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

899 
basic
 = 
vif
->
bss_c⁄f
.
basic_øãs
;

900 
u16
 
lowe°_cck
 = 
IWL_RATE_COUNT
, 
lowe°_ofdm
 = IWL_RATE_COUNT;

901 
u32
 
lök_id
 = 
	`u32_gë_bôs
(
öfo
->
c⁄åﬁ
.
Êags
,

902 
IEEE80211_TX_CTRL_MLO_LINK
);

903 
u8
 
b™d
 = 
öfo
->band;

904 
u8
 
øã
;

905 
u32
 
i
;

907 i‡(
lök_id
 =
IEEE80211_LINK_UNSPECIFIED
 && 
	`õì80211_vif_is_mld
(
vif
)) {

908 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvmvif
->
lök
); i++) {

909 i‡(!
mvmvif
->
lök
[
i
])

912 
	`WARN_ON_ONCE
(
lök_id
 !
IEEE80211_LINK_UNSPECIFIED
);

913 
lök_id
 = 
i
;

917 i‡(
lök_id
 < 
IEEE80211_LINK_UNSPECIFIED
) {

918 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

920 
	`rcu_ªad_lock
();

921 
lök_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->lök_c⁄f[
lök_id
]);

922 i‡(
lök_c⁄f
) {

923 
basic
 = 
lök_c⁄f
->
basic_øãs
;

924 i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
)

925 
b™d
 = 
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->band;

927 
	`rcu_ªad_u∆ock
();

930 
sb™d
 = 
mvm
->
hw
->
wùhy
->
b™ds
[
b™d
];

931 
	`f‹_óch_£t_bô
(
i
, &
basic
, 
BITS_PER_LONG
) {

932 
u16
 
hw
 = 
sb™d
->
bôøãs
[
i
].
hw_vÆue
;

934 i‡(
hw
 >
IWL_FIRST_OFDM_RATE
) {

935 i‡(
lowe°_ofdm
 > 
hw
)

936 
lowe°_ofdm
 = 
hw
;

937 } i‡(
lowe°_cck
 > 
hw
) {

938 
lowe°_cck
 = 
hw
;

942 i‡(
b™d
 =
NL80211_BAND_2GHZ
 && !
vif
->
p2p
 &&

943 
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
 &&

944 !(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_CCK_RATE
)) {

945 i‡(
lowe°_cck
 !
IWL_RATE_COUNT
)

946 
øã
 = 
lowe°_cck
;

947 i‡(
lowe°_ofdm
 !
IWL_RATE_COUNT
)

948 
øã
 = 
lowe°_ofdm
;

950 
øã
 = 
IWL_RATE_1M_INDEX
;

951 } i‡(
lowe°_ofdm
 !
IWL_RATE_COUNT
) {

952 
øã
 = 
lowe°_ofdm
;

954 
øã
 = 
IWL_RATE_6M_INDEX
;

957  
øã
;

958 
	}
}

960 
u16
 
	$iwl_mvm_mac_˘xt_gë_bóc⁄_Êags
(c⁄° 
iwl_fw
 *
fw
, 
u8
 
øã_idx
)

962 
u16
 
Êags
 = 
	`iwl_mvm_mac80211_idx_to_hwøã
(
fw
, 
øã_idx
);

963 
boﬁ
 
is_√w_øã
 = 
	`iwl_fw_lookup_cmd_vî
(
fw
, 
BEACON_TEMPLATE_CMD
, 0) > 10;

965 i‡(
øã_idx
 <
IWL_FIRST_CCK_RATE
)

966 
Êags
 |
is_√w_øã
 ? 
IWL_MAC_BEACON_CCK


967 : 
IWL_MAC_BEACON_CCK_V1
;

969  
Êags
;

970 
	}
}

972 
u8
 
	$iwl_mvm_mac_˘xt_gë_bóc⁄_øã
(
iwl_mvm
 *
mvm
,

973 
õì80211_tx_öfo
 *
öfo
,

974 
õì80211_vif
 *
vif
)

976 
õì80211_suµ‹ãd_b™d
 *
sb™d
 =

977 
mvm
->
hw
->
wùhy
->
b™ds
[
öfo
->
b™d
];

978 
u32
 
Àgacy
 = 
vif
->
bss_c⁄f
.
bóc⁄_tx_øã
.
c⁄åﬁ
[
öfo
->
b™d
].legacy;

981 i‡(
	`hweight32
(
Àgacy
) == 1) {

982 
u32
 
øã
 = 
	`ffs
(
Àgacy
) - 1;

984  
sb™d
->
bôøãs
[
øã
].
hw_vÆue
;

987  
	`iwl_mvm_mac_˘xt_gë_lowe°_øã
(
mvm
, 
öfo
, 
vif
);

988 
	}
}

990 
	$iwl_mvm_mac_˘xt_£t_tx
(
iwl_mvm
 *
mvm
,

991 
õì80211_vif
 *
vif
,

992 
sk_buff
 *
bóc⁄
,

993 
iwl_tx_cmd
 *
tx
)

995 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

996 
õì80211_tx_öfo
 *
öfo
;

997 
u8
 
øã
;

998 
u32
 
tx_Êags
;

1000 
öfo
 = 
	`IEEE80211_SKB_CB
(
bóc⁄
);

1003 
tx
->
Àn
 = 
	`˝u_to_À16
((
u16
)
bóc⁄
->len);

1004 
tx
->
°a_id
 = 
mvmvif
->
deÊök
.
bˇ°_°a
.sta_id;

1005 
tx
->
li„_time
 = 
	`˝u_to_À32
(
TX_CMD_LIFE_TIME_INFINITE
);

1006 
tx_Êags
 = 
TX_CMD_FLG_SEQ_CTL
 | 
TX_CMD_FLG_TSF
;

1007 
tx_Êags
 |=

1008 
	`iwl_mvm_bt_c€x_tx_¥io
(
mvm
, (*)
bóc⁄
->
d©a
, 
öfo
, 0) <<

1009 
TX_CMD_FLG_BT_PRIO_POS
;

1010 
tx
->
tx_Êags
 = 
	`˝u_to_À32
(tx_flags);

1012 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1013 
IWL_UCODE_TLV_CAPA_BEACON_ANT_SELECTION
))

1014 
	`iwl_mvm_toggÀ_tx_™t
(
mvm
, &mvm->
mgmt_œ°_™ã¬a_idx
);

1016 
tx
->
øã_n_Êags
 =

1017 
	`˝u_to_À32
(
	`BIT
(
mvm
->
mgmt_œ°_™ã¬a_idx
) <<

1018 
RATE_MCS_ANT_POS
);

1020 
øã
 = 
	`iwl_mvm_mac_˘xt_gë_bóc⁄_øã
(
mvm
, 
öfo
, 
vif
);

1022 
tx
->
øã_n_Êags
 |=

1023 
	`˝u_to_À32
(
	`iwl_mvm_mac80211_idx_to_hwøã
(
mvm
->
fw
, 
øã
));

1024 i‡(
øã
 =
IWL_FIRST_CCK_RATE
)

1025 
tx
->
øã_n_Êags
 |
	`˝u_to_À32
(
RATE_MCS_CCK_MSK_V1
);

1027 
	}
}

1029 
	$iwl_mvm_mac_˘xt_£nd_bóc⁄_cmd
(
iwl_mvm
 *
mvm
,

1030 
sk_buff
 *
bóc⁄
,

1031 *
d©a
, 
Àn
)

1033 
iwl_ho°_cmd
 
cmd
 = {

1034 .
id
 = 
BEACON_TEMPLATE_CMD
,

1035 .
Êags
 = 
CMD_ASYNC
,

1038 
cmd
.
Àn
[0] =Üen;

1039 
cmd
.
d©a
[0] = data;

1040 
cmd
.
d©aÊags
[0] = 0;

1041 
cmd
.
Àn
[1] = 
bóc⁄
->len;

1042 
cmd
.
d©a
[1] = 
bóc⁄
->data;

1043 
cmd
.
d©aÊags
[1] = 
IWL_HCMD_DFL_DUP
;

1045  
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

1046 
	}
}

1048 
	$iwl_mvm_mac_˘xt_£nd_bóc⁄_v6
(
iwl_mvm
 *
mvm
,

1049 
õì80211_vif
 *
vif
,

1050 
sk_buff
 *
bóc⁄
)

1052 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1053 
iwl_mac_bóc⁄_cmd_v6
 
bóc⁄_cmd
 = {};

1055 
	`iwl_mvm_mac_˘xt_£t_tx
(
mvm
, 
vif
, 
bóc⁄
, &
bóc⁄_cmd
.
tx
);

1057 
bóc⁄_cmd
.
ãm∂©e_id
 = 
	`˝u_to_À32
((
u32
)
mvmvif
->
id
);

1059 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

1060 
	`iwl_mvm_mac_˘xt_£t_tim
(
mvm
, &
bóc⁄_cmd
.
tim_idx
,

1061 &
bóc⁄_cmd
.
tim_size
,

1062 
bóc⁄
->
d©a
, bóc⁄->
Àn
);

1064  
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_cmd
(
mvm
, 
bóc⁄
, &
bóc⁄_cmd
,

1065 (
bóc⁄_cmd
));

1066 
	}
}

1068 
	$iwl_mvm_mac_˘xt_£nd_bóc⁄_v7
(
iwl_mvm
 *
mvm
,

1069 
õì80211_vif
 *
vif
,

1070 
sk_buff
 *
bóc⁄
)

1072 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1073 
iwl_mac_bóc⁄_cmd_v7
 
bóc⁄_cmd
 = {};

1075 
	`iwl_mvm_mac_˘xt_£t_tx
(
mvm
, 
vif
, 
bóc⁄
, &
bóc⁄_cmd
.
tx
);

1077 
bóc⁄_cmd
.
ãm∂©e_id
 = 
	`˝u_to_À32
((
u32
)
mvmvif
->
id
);

1079 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

1080 
	`iwl_mvm_mac_˘xt_£t_tim
(
mvm
, &
bóc⁄_cmd
.
tim_idx
,

1081 &
bóc⁄_cmd
.
tim_size
,

1082 
bóc⁄
->
d©a
, bóc⁄->
Àn
);

1084 
bóc⁄_cmd
.
cß_off£t
 =

1085 
	`˝u_to_À32
(
	`iwl_mvm_föd_õ_off£t
(
bóc⁄
->
d©a
,

1086 
WLAN_EID_CHANNEL_SWITCH
,

1087 
bóc⁄
->
Àn
));

1088 
bóc⁄_cmd
.
ecß_off£t
 =

1089 
	`˝u_to_À32
(
	`iwl_mvm_föd_õ_off£t
(
bóc⁄
->
d©a
,

1090 
WLAN_EID_EXT_CHANSWITCH_ANN
,

1091 
bóc⁄
->
Àn
));

1093  
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_cmd
(
mvm
, 
bóc⁄
, &
bóc⁄_cmd
,

1094 (
bóc⁄_cmd
));

1095 
	}
}

1097 
boﬁ
 
	$iwl_mvm_íabÀ_fûs
(
iwl_mvm
 *
mvm
,

1098 
õì80211_ch™˘x_c⁄f
 *
˘x
)

1100 i‡(
IWL_MVM_DISABLE_AP_FILS
)

1101  
Ál£
;

1103 i‡(
	`cfg80211_ch™√l_is_psc
(
˘x
->
def
.
ch™
))

1104  
åue
;

1106  (
˘x
->
def
.
ch™
->
b™d
 =
NL80211_BAND_6GHZ
 &&

1107 
˘x
->
def
.
width
 >
NL80211_CHAN_WIDTH_80
);

1108 
	}
}

1110 
	$iwl_mvm_mac_˘xt_£nd_bóc⁄_v9
(
iwl_mvm
 *
mvm
,

1111 
õì80211_vif
 *
vif
,

1112 
sk_buff
 *
bóc⁄
,

1113 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

1115 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1116 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
bóc⁄
);

1117 
iwl_mac_bóc⁄_cmd
 
bóc⁄_cmd
 = {};

1118 
u8
 
øã
 = 
	`iwl_mvm_mac_˘xt_gë_bóc⁄_øã
(
mvm
, 
öfo
, 
vif
);

1119 
u16
 
Êags
;

1120 
õì80211_ch™˘x_c⁄f
 *
˘x
;

1121 
ch™√l
;

1122 
Êags
 = 
	`iwl_mvm_mac_˘xt_gë_bóc⁄_Êags
(
mvm
->
fw
, 
øã
);

1125 
	`rcu_ªad_lock
();

1126 
˘x
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->
ch™˘x_c⁄f
);

1127 
ch™√l
 = 
	`õì80211_‰equícy_to_ch™√l
(
˘x
->
def
.
ch™
->
˚¡î_‰eq
);

1128 
	`WARN_ON
(
ch™√l
 == 0);

1129 i‡(
	`iwl_mvm_íabÀ_fûs
(
mvm
, 
˘x
)) {

1130 
Êags
 |
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
BEACON_TEMPLATE_CMD
,

1132 
IWL_MAC_BEACON_FILS
 :

1133 
IWL_MAC_BEACON_FILS_V1
;

1134 
bóc⁄_cmd
.
sh‹t_ssid
 =

1135 
	`˝u_to_À32
(~
	`¸c32_À
(~0, 
vif
->
cfg
.
ssid
,

1136 
vif
->
cfg
.
ssid_Àn
));

1138 
	`rcu_ªad_u∆ock
();

1140 
bóc⁄_cmd
.
Êags
 = 
	`˝u_to_À16
(flags);

1141 
bóc⁄_cmd
.
byã_˙t
 = 
	`˝u_to_À16
((
u16
)
bóc⁄
->
Àn
);

1143 i‡(
	`WARN_ON
(!
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
]))

1144  -
EINVAL
;

1146 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
BEACON_TEMPLATE_CMD
, 0) > 12)

1147 
bóc⁄_cmd
.
lök_id
 =

1148 
	`˝u_to_À32
(
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
]->
fw_lök_id
);

1150 
bóc⁄_cmd
.
lök_id
 = 
	`˝u_to_À32
((
u32
)
mvmvif
->
id
);

1152 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

1153 
	`iwl_mvm_mac_˘xt_£t_tim
(
mvm
, &
bóc⁄_cmd
.
tim_idx
,

1154 &
bóc⁄_cmd
.
tim_size
,

1155 
bóc⁄
->
d©a
, bóc⁄->
Àn
);

1157 
bóc⁄_cmd
.
cß_off£t
 =

1158 
	`˝u_to_À32
(
	`iwl_mvm_föd_õ_off£t
(
bóc⁄
->
d©a
,

1159 
WLAN_EID_CHANNEL_SWITCH
,

1160 
bóc⁄
->
Àn
));

1161 
bóc⁄_cmd
.
ecß_off£t
 =

1162 
	`˝u_to_À32
(
	`iwl_mvm_föd_õ_off£t
(
bóc⁄
->
d©a
,

1163 
WLAN_EID_EXT_CHANSWITCH_ANN
,

1164 
bóc⁄
->
Àn
));

1166  
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_cmd
(
mvm
, 
bóc⁄
, &
bóc⁄_cmd
,

1167 (
bóc⁄_cmd
));

1168 
	}
}

1170 
	$iwl_mvm_mac_˘xt_£nd_bóc⁄
(
iwl_mvm
 *
mvm
,

1171 
õì80211_vif
 *
vif
,

1172 
sk_buff
 *
bóc⁄
,

1173 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

1175 i‡(
	`WARN_ON
(!
bóc⁄
))

1176  -
EINVAL
;

1178 i‡(
IWL_MVM_NON_TRANSMITTING_AP
)

1181 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1182 
IWL_UCODE_TLV_CAPA_CSA_AND_TBTT_OFFLOAD
))

1183  
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_v6
(
mvm
, 
vif
, 
bóc⁄
);

1185 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1186 
IWL_UCODE_TLV_API_NEW_BEACON_TEMPLATE
))

1187  
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_v9
(
mvm
, 
vif
, 
bóc⁄
,

1188 
lök_c⁄f
);

1190  
	`iwl_mvm_mac_˘xt_£nd_bóc⁄_v7
(
mvm
, 
vif
, 
bóc⁄
);

1191 
	}
}

1194 
	$iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
iwl_mvm
 *
mvm
,

1195 
õì80211_vif
 *
vif
,

1196 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

1198 
sk_buff
 *
bóc⁄
;

1199 
ªt
;

1201 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 &&

1202 
vif
->
ty≥
 !
NL80211_IFTYPE_ADHOC
);

1204 
bóc⁄
 = 
	`õì80211_bóc⁄_gë_ãm∂©e
(
mvm
->
hw
, 
vif
, 
NULL
,

1205 
lök_c⁄f
->
lök_id
);

1206 i‡(!
bóc⁄
)

1207  -
ENOMEM
;

1209 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1210 i‡(
mvm
->
bóc⁄_öje˘_a˘ive
) {

1211 
	`dev_k‰ì_skb
(
bóc⁄
);

1212  -
EBUSY
;

1216 
ªt
 = 
	`iwl_mvm_mac_˘xt_£nd_bóc⁄
(
mvm
, 
vif
, 
bóc⁄
, 
lök_c⁄f
);

1217 
	`dev_k‰ì_skb
(
bóc⁄
);

1218  
ªt
;

1219 
	}
}

1221 
	siwl_mvm_mac_≠_ôî©‹_d©a
 {

1222 
iwl_mvm
 *
	mmvm
;

1223 
õì80211_vif
 *
	mvif
;

1224 
u32
 
	mbóc⁄_devi˚_ts
;

1225 
u16
 
	mbóc⁄_öt
;

1229 
	$iwl_mvm_mac_≠_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

1230 
õì80211_vif
 *
vif
)

1232 
iwl_mvm_mac_≠_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

1234 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || !vif->
cfg
.
assoc
)

1238 i‡(
vif
->
p2p
 && 
d©a
->
bóc⁄_devi˚_ts
)

1241 
d©a
->
bóc⁄_devi˚_ts
 = 
vif
->
bss_c⁄f
.
sync_devi˚_ts
;

1242 
d©a
->
bóc⁄_öt
 = 
vif
->
bss_c⁄f
.beacon_int;

1243 
	}
}

1248 
	$iwl_mvm_mac_˘xt_cmd_≠_£t_fûãr_Êags
(
iwl_mvm
 *
mvm
,

1249 
iwl_mvm_vif
 *
mvmvif
,

1250 
__À32
 *
fûãr_Êags
,

1251 
ac˚±_¥obe_ªq_Êag
,

1252 
ac˚±_bóc⁄_Êag
)

1260 *
fûãr_Êags
 |
	`˝u_to_À32
(
ac˚±_¥obe_ªq_Êag
);

1261 i‡(
mvmvif
->
≠_assoc_°a_cou¡
 || !
mvm
->
dr›_b˙_≠_mode
) {

1262 *
fûãr_Êags
 |
	`˝u_to_À32
(
ac˚±_bóc⁄_Êag
);

1263 
	`IWL_DEBUG_HC
(
mvm
, "Asking FWÅoÖass beacons\n");

1265 
	`IWL_DEBUG_HC
(
mvm
, "NoÇeedÅoÑeceive beacons\n");

1267 
	}
}

1272 
	$iwl_mvm_mac_˘xt_cmd_fûl_≠
(
iwl_mvm
 *
mvm
,

1273 
õì80211_vif
 *
vif
,

1274 
iwl_mac_˘x_cmd
 *
cmd
,

1275 
iwl_mac_d©a_≠
 *
˘xt_≠
,

1276 
boﬁ
 
add
)

1278 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1279 
iwl_mvm_mac_≠_ôî©‹_d©a
 
d©a
 = {

1280 .
mvm
 = mvm,

1281 .
vif
 = vif,

1282 .
bóc⁄_devi˚_ts
 = 0

1286 
cmd
->
ac
[
IWL_MVM_TX_FIFO_VO
].
fifos_mask
 |
	`BIT
(
IWL_MVM_TX_FIFO_MCAST
);

1288 
	`iwl_mvm_mac_˘xt_cmd_≠_£t_fûãr_Êags
(
mvm
, 
mvmvif
,

1289 &
cmd
->
fûãr_Êags
,

1290 
MAC_FILTER_IN_PROBE_REQUEST
,

1291 
MAC_FILTER_IN_BEACON
);

1293 
˘xt_≠
->
bi
 = 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
bóc⁄_öt
);

1294 
˘xt_≠
->
dtim_öãrvÆ
 = 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
bóc⁄_öt
 *

1295 
vif
->
bss_c⁄f
.
dtim_≥riod
);

1297 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1298 
IWL_UCODE_TLV_API_STA_TYPE
))

1299 
˘xt_≠
->
mˇ°_qid
 = 
	`˝u_to_À32
(
mvmvif
->
deÊök
.
ˇb_queue
);

1306 i‡(
add
) {

1312 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

1313 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_RESUME_ALL
,

1314 
iwl_mvm_mac_≠_ôî©‹
, &
d©a
);

1316 i‡(
d©a
.
bóc⁄_devi˚_ts
) {

1317 
u32
 
ønd
 = 
	`gë_øndom_u32_ö˛usive
(36, 63);

1318 
mvmvif
->
≠_bóc⁄_time
 = 
d©a
.
bóc⁄_devi˚_ts
 +

1319 
	`õì80211_tu_to_u£c
(
d©a
.
bóc⁄_öt
 * 
ønd
 /

1322 
mvmvif
->
≠_bóc⁄_time
 = 
	`iwl_mvm_gë_sy°ime
(
mvm
);

1326 
˘xt_≠
->
bóc⁄_time
 = 
	`˝u_to_À32
(
mvmvif
->
≠_bóc⁄_time
);

1327 
˘xt_≠
->
bóc⁄_tsf
 = 0;

1330 
˘xt_≠
->
bóc⁄_ãm∂©e
 = 
	`˝u_to_À32
(
mvmvif
->
id
);

1331 
	}
}

1333 
	$iwl_mvm_mac_˘xt_cmd_≠
(
iwl_mvm
 *
mvm
,

1334 
õì80211_vif
 *
vif
,

1335 
u32
 
a˘i⁄
)

1337 
iwl_mac_˘x_cmd
 
cmd
 = {};

1339 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 || vif->
p2p
);

1342 
	`iwl_mvm_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
NULL
, 
a˘i⁄
);

1345 
	`iwl_mvm_mac_˘xt_cmd_fûl_≠
(
mvm
, 
vif
, &
cmd
, &cmd.
≠
,

1346 
a˘i⁄
 =
FW_CTXT_ACTION_ADD
);

1348  
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

1349 
	}
}

1351 
	$iwl_mvm_mac_˘xt_cmd_go
(
iwl_mvm
 *
mvm
,

1352 
õì80211_vif
 *
vif
,

1353 
u32
 
a˘i⁄
)

1355 
iwl_mac_˘x_cmd
 
cmd
 = {};

1356 
õì80211_p2p_nﬂ_©å
 *
nﬂ
 = &
vif
->
bss_c⁄f
.
p2p_nﬂ_©å
;

1358 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 || !vif->
p2p
);

1361 
	`iwl_mvm_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
NULL
, 
a˘i⁄
);

1364 
	`iwl_mvm_mac_˘xt_cmd_fûl_≠
(
mvm
, 
vif
, &
cmd
, &cmd.
go
.
≠
,

1365 
a˘i⁄
 =
FW_CTXT_ACTION_ADD
);

1367 
cmd
.
go
.
˘wö
 = 
	`˝u_to_À32
(
nﬂ
->
›µs_˘wödow
 &

1368 
IEEE80211_P2P_OPPPS_CTWINDOW_MASK
);

1369 
cmd
.
go
.
›p_ps_íabÀd
 =

1370 
	`˝u_to_À32
(!!(
nﬂ
->
›µs_˘wödow
 &

1371 
IEEE80211_P2P_OPPPS_ENABLE_BIT
));

1373  
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

1374 
	}
}

1376 
	$iwl_mvm_mac_˘x_£nd
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1377 
u32
 
a˘i⁄
, 
boﬁ
 
f‹˚_assoc_off
,

1378 c⁄° 
u8
 *
bssid_ovîride
)

1380 
vif
->
ty≥
) {

1381 
NL80211_IFTYPE_STATION
:

1382  
	`iwl_mvm_mac_˘xt_cmd_°a
(
mvm
, 
vif
, 
a˘i⁄
,

1383 
f‹˚_assoc_off
,

1384 
bssid_ovîride
);

1385 
NL80211_IFTYPE_AP
:

1386 i‡(!
vif
->
p2p
)

1387  
	`iwl_mvm_mac_˘xt_cmd_≠
(
mvm
, 
vif
, 
a˘i⁄
);

1389  
	`iwl_mvm_mac_˘xt_cmd_go
(
mvm
, 
vif
, 
a˘i⁄
);

1390 
NL80211_IFTYPE_MONITOR
:

1391  
	`iwl_mvm_mac_˘xt_cmd_li°íî
(
mvm
, 
vif
, 
a˘i⁄
);

1392 
NL80211_IFTYPE_P2P_DEVICE
:

1393  
	`iwl_mvm_mac_˘xt_cmd_p2p_devi˚
(
mvm
, 
vif
, 
a˘i⁄
);

1394 
NL80211_IFTYPE_ADHOC
:

1395  
	`iwl_mvm_mac_˘xt_cmd_ibss
(
mvm
, 
vif
, 
a˘i⁄
);

1400  -
EOPNOTSUPP
;

1401 
	}
}

1403 
	$iwl_mvm_mac_˘xt_add
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

1405 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1406 
ªt
;

1408 i‡(
	`WARN_ONCE
(
mvmvif
->
u∂ﬂded
, "Addingáctive MAC %pM/%d\n",

1409 
vif
->
addr
, 
	`õì80211_vif_ty≥_p2p
(vif)))

1410  -
EIO
;

1412 
ªt
 = 
	`iwl_mvm_mac_˘x_£nd
(
mvm
, 
vif
, 
FW_CTXT_ACTION_ADD
,

1413 
åue
, 
NULL
);

1414 i‡(
ªt
)

1415  
ªt
;

1418 
	`iwl_mvm_£t_œ°_n⁄qos_£q
(
mvm
, 
vif
);

1420 
mvmvif
->
u∂ﬂded
 = 
åue
;

1422 
	}
}

1424 
	$iwl_mvm_mac_˘xt_ch™ged
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1425 
boﬁ
 
f‹˚_assoc_off
, c⁄° 
u8
 *
bssid_ovîride
)

1427 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1429 i‡(
	`WARN_ONCE
(!
mvmvif
->
u∂ﬂded
, "Changing inactive MAC %pM/%d\n",

1430 
vif
->
addr
, 
	`õì80211_vif_ty≥_p2p
(vif)))

1431  -
EIO
;

1433  
	`iwl_mvm_mac_˘x_£nd
(
mvm
, 
vif
, 
FW_CTXT_ACTION_MODIFY
,

1434 
f‹˚_assoc_off
, 
bssid_ovîride
);

1435 
	}
}

1437 
	$iwl_mvm_mac_˘xt_ªmove
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

1439 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1440 
iwl_mac_˘x_cmd
 
cmd
;

1441 
ªt
;

1443 i‡(
	`WARN_ONCE
(!
mvmvif
->
u∂ﬂded
, "Removing inactive MAC %pM/%d\n",

1444 
vif
->
addr
, 
	`õì80211_vif_ty≥_p2p
(vif)))

1445  -
EIO
;

1447 
	`mem£t
(&
cmd
, 0, (cmd));

1449 
cmd
.
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

1450 
mvmvif
->
cﬁ‹
));

1451 
cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
);

1453 
ªt
 = 
	`iwl_mvm_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

1454 i‡(
ªt
)

1455  
ªt
;

1457 
mvmvif
->
u∂ﬂded
 = 
Ál£
;

1459 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

1460 
	`__˛ór_bô
(
IEEE80211_HW_RX_INCLUDES_FCS
, 
mvm
->
hw
->
Êags
);

1461 
	`iwl_mvm_dóŒoc_¢if_°a
(
mvm
);

1465 
	}
}

1467 
	$iwl_mvm_cß_cou¡_down
(
iwl_mvm
 *
mvm
,

1468 
õì80211_vif
 *
cß_vif
, 
u32
 
gp2
,

1469 
boﬁ
 
tx_suc˚ss
)

1471 
iwl_mvm_vif
 *
mvmvif
 =

1472 
	`iwl_mvm_vif_‰om_mac80211
(
cß_vif
);

1475 i‡(!
tx_suc˚ss
 && !
mvmvif
->
cß_cou¡down
)

1478 
mvmvif
->
cß_cou¡down
 = 
åue
;

1480 i‡(!
	`õì80211_bóc⁄_˙tdwn_is_com∂ëe
(
cß_vif
, 0)) {

1481 
c
 = 
	`õì80211_bóc⁄_upd©e_˙tdwn
(
cß_vif
, 0);

1483 
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
cß_vif
,

1484 &
cß_vif
->
bss_c⁄f
);

1485 i‡(
cß_vif
->
p2p
 &&

1486 !
	`iwl_mvm_ã_scheduÀd
(&
mvmvif
->
time_evít_d©a
Ë&& 
gp2
 &&

1487 
tx_suc˚ss
) {

1488 
u32
 
ªl_time
 = (
c
 + 1) *

1489 
cß_vif
->
bss_c⁄f
.
bóc⁄_öt
 -

1490 
IWL_MVM_CHANNEL_SWITCH_TIME_GO
;

1491 
u32
 
≠∂y_time
 = 
gp2
 + 
ªl_time
 * 1024;

1493 
	`iwl_mvm_scheduÀ_cß_≥riod
(
mvm
, 
cß_vif
,

1494 
IWL_MVM_CHANNEL_SWITCH_TIME_GO
 -

1495 
IWL_MVM_CHANNEL_SWITCH_MARGIN
,

1496 
≠∂y_time
);

1498 } i‡(!
	`iwl_mvm_ã_scheduÀd
(&
mvmvif
->
time_evít_d©a
)) {

1500 
	`õì80211_cß_föish
(
cß_vif
, 0);

1501 
	`RCU_INIT_POINTER
(
mvm
->
cß_vif
, 
NULL
);

1503 
	}
}

1505 
	$iwl_mvm_rx_bóc⁄_nŸif
(
iwl_mvm
 *
mvm
,

1506 
iwl_rx_cmd_buf„r
 *
rxb
)

1508 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1509 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1510 
iwl_exãnded_bóc⁄_nŸif
 *
bóc⁄
 = (*)
pkt
->
d©a
;

1511 
iwl_exãnded_bóc⁄_nŸif_v5
 *
bóc⁄_v5
 = (*)
pkt
->
d©a
;

1512 
õì80211_vif
 *
cß_vif
;

1513 
õì80211_vif
 *
tx_blocked_vif
;

1514 
agg_tx_°©us
 *
agg_°©us
;

1515 
u16
 
°©us
;

1517 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1519 
mvm
->
≠_œ°_bóc⁄_gp2
 = 
	`À32_to_˝u
(
bóc⁄
->
gp2
);

1521 i‡(!
	`iwl_mvm_is_sh‹t_bóc⁄_nŸif_suµ‹ãd
(
mvm
)) {

1522 
iwl_mvm_tx_ª•
 *
bóc⁄_nŸify_hdr
 =

1523 &
bóc⁄_v5
->
bóc⁄_nŸify_hdr
;

1525 i‡(
	`u∆ikñy
(
pkt_Àn
 < (*
bóc⁄_v5
)))

1528 
mvm
->
ibss_m™agî
 = 
bóc⁄_v5
->
ibss_mgr_°©us
 != 0;

1529 
agg_°©us
 = 
	`iwl_mvm_gë_agg_°©us
(
mvm
, 
bóc⁄_nŸify_hdr
);

1530 
°©us
 = 
	`À16_to_˝u
(
agg_°©us
->°©usË& 
TX_STATUS_MSK
;

1531 
	`IWL_DEBUG_RX
(
mvm
,

1533 
°©us
, 
bóc⁄_nŸify_hdr
->
Áûuª_‰ame
,

1534 
	`À64_to_˝u
(
bóc⁄
->
tsf
),

1535 
mvm
->
≠_œ°_bóc⁄_gp2
,

1536 
	`À32_to_˝u
(
bóc⁄_nŸify_hdr
->
öôül_øã
));

1538 i‡(
	`u∆ikñy
(
pkt_Àn
 < (*
bóc⁄
)))

1541 
mvm
->
ibss_m™agî
 = 
bóc⁄
->
ibss_mgr_°©us
 != 0;

1542 
°©us
 = 
	`À32_to_˝u
(
bóc⁄
->°©usË& 
TX_STATUS_MSK
;

1543 
	`IWL_DEBUG_RX
(
mvm
,

1545 
°©us
, 
	`À64_to_˝u
(
bóc⁄
->
tsf
),

1546 
mvm
->
≠_œ°_bóc⁄_gp2
);

1549 
cß_vif
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->csa_vif,

1550 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1551 i‡(
	`u∆ikñy
(
cß_vif
 && cß_vif->
bss_c⁄f
.
cß_a˘ive
))

1552 
	`iwl_mvm_cß_cou¡_down
(
mvm
, 
cß_vif
, mvm->
≠_œ°_bóc⁄_gp2
,

1553 (
°©us
 =
TX_STATUS_SUCCESS
));

1555 
tx_blocked_vif
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
cß_tx_blocked_vif
,

1556 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1557 i‡(
	`u∆ikñy
(
tx_blocked_vif
)) {

1558 
iwl_mvm_vif
 *
mvmvif
 =

1559 
	`iwl_mvm_vif_‰om_mac80211
(
tx_blocked_vif
);

1566 i‡(!
mvm
->
cß_tx_block_b˙_timeout
)

1567 
mvm
->
cß_tx_block_b˙_timeout
 =

1568 
IWL_MVM_CS_UNBLOCK_TX_TIMEOUT
;

1570 
mvm
->
cß_tx_block_b˙_timeout
--;

1573 i‡(
mvm
->
cß_tx_block_b˙_timeout
 == 0) {

1574 
	`iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
mvm
, 
mvmvif
, 
Ál£
);

1575 
	`RCU_INIT_POINTER
(
mvm
->
cß_tx_blocked_vif
, 
NULL
);

1578 
	}
}

1580 
	$iwl_mvm_rx_mis£d_bóc⁄s_nŸif
(
iwl_mvm
 *
mvm
,

1581 
iwl_rx_cmd_buf„r
 *
rxb
)

1583 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1584 
iwl_mis£d_bóc⁄s_nŸif
 *
mb
 = (*)
pkt
->
d©a
;

1585 
iwl_fw_dbg_åiggî_mis£d_bc⁄
 *
bc⁄_åig
;

1586 
iwl_fw_dbg_åiggî_év
 *
åiggî
;

1587 
u32
 
°›_åig_mis£d_bc⁄
, 
°›_åig_mis£d_bc⁄_sö˚_rx
;

1588 
u32
 
rx_mis£d_bc⁄
, 
rx_mis£d_bc⁄_sö˚_rx
;

1589 
õì80211_vif
 *
vif
;

1591 
u32
 
id
 = 
	`À32_to_˝u
(
mb
->
lök_id
);

1592 
iwl_dbg_év_ç_d©a
 
ç_d©a
 = { .
fw_pkt
 = 
pkt
 };

1593 
u32
 
mac_ty≥
;

1594 
u8
 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

1595 
MISSED_BEACONS_NOTIFICATION
,

1598 
	`rcu_ªad_lock
();

1601 i‡(
nŸif_vî
 < 4) {

1602 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
id
, 
åue
);

1604 
õì80211_bss_c⁄f
 *
bss_c⁄f
 =

1605 
	`iwl_mvm_rcu_fw_lök_id_to_lök_c⁄f
(
mvm
, 
id
, 
åue
);

1607 i‡(!
bss_c⁄f
)

1608 
out
;

1610 
vif
 = 
bss_c⁄f
->vif;

1613 
	`IWL_DEBUG_INFO
(
mvm
,

1615 
nŸif_vî
 < 4 ? "mac" : "link",

1616 
id
,

1617 
	`À32_to_˝u
(
mb
->
c⁄£c_mis£d_bóc⁄s
),

1618 
	`À32_to_˝u
(
mb
->
c⁄£c_mis£d_bóc⁄s_sö˚_œ°_rx
),

1619 
	`À32_to_˝u
(
mb
->
num_ªcvd_bóc⁄s
),

1620 
	`À32_to_˝u
(
mb
->
num_ex≥˘ed_bóc⁄s
));

1622 i‡(!
vif
)

1623 
out
;

1625 
mac_ty≥
 = 
	`iwl_mvm_gë_mac_ty≥
(
vif
);

1627 
	`IWL_DEBUG_INFO
(
mvm
, "mis£d bóc⁄ mac_ty≥=%u,\n", 
mac_ty≥
);

1629 
mvm
->
å™s
->
dbg
.
dump_fûe_«me_ext_vÆid
 = 
åue
;

1630 
	`¢¥ötf
(
mvm
->
å™s
->
dbg
.
dump_fûe_«me_ext
, 
IWL_FW_INI_MAX_NAME
,

1631 "MacId_%d_MacTy≥_%d", 
id
, 
mac_ty≥
);

1633 
rx_mis£d_bc⁄
 = 
	`À32_to_˝u
(
mb
->
c⁄£c_mis£d_bóc⁄s
);

1634 
rx_mis£d_bc⁄_sö˚_rx
 =

1635 
	`À32_to_˝u
(
mb
->
c⁄£c_mis£d_bóc⁄s_sö˚_œ°_rx
);

1640 i‡(
rx_mis£d_bc⁄
 >
IWL_MVM_MISSED_BEACONS_THRESHOLD_LONG
) {

1641 i‡(
rx_mis£d_bc⁄_sö˚_rx
 >
IWL_MVM_MISSED_BEACONS_SINCE_RX_THOLD
) {

1642 
	`iwl_mvm_c⁄√˘i⁄_loss
(
mvm
, 
vif
, "missed beacons");

1644 
	`IWL_WARN
(
mvm
,

1646 
	`IWL_WARN
(
mvm
,

1648 
rx_mis£d_bc⁄
, 
rx_mis£d_bc⁄_sö˚_rx
);

1650 } i‡(
rx_mis£d_bc⁄_sö˚_rx
 > 
IWL_MVM_MISSED_BEACONS_THRESHOLD
) {

1651 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1652 
	`õì80211_bóc⁄_loss
(
vif
);

1654 
	`õì80211_cqm_bóc⁄_loss_nŸify
(
vif
, 
GFP_ATOMIC
);

1657 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

1658 
IWL_FW_INI_TIME_POINT_MISSED_BEACONS
, &
ç_d©a
);

1660 
åiggî
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

1661 
FW_DBG_TRIGGER_MISSED_BEACONS
);

1662 i‡(!
åiggî
)

1663 
out
;

1665 
bc⁄_åig
 = (*)
åiggî
->
d©a
;

1666 
°›_åig_mis£d_bc⁄
 = 
	`À32_to_˝u
(
bc⁄_åig
->
°›_c⁄£c_mis£d_bc⁄
);

1667 
°›_åig_mis£d_bc⁄_sö˚_rx
 =

1668 
	`À32_to_˝u
(
bc⁄_åig
->
°›_c⁄£c_mis£d_bc⁄_sö˚_rx
);

1672 i‡(
rx_mis£d_bc⁄_sö˚_rx
 >
°›_åig_mis£d_bc⁄_sö˚_rx
 ||

1673 
rx_mis£d_bc⁄
 >
°›_åig_mis£d_bc⁄
)

1674 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åiggî
, 
NULL
);

1676 
out
:

1677 
	`rcu_ªad_u∆ock
();

1678 
	}
}

1680 
	$iwl_mvm_rx_°‹ed_bóc⁄_nŸif
(
iwl_mvm
 *
mvm
,

1681 
iwl_rx_cmd_buf„r
 *
rxb
)

1683 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1684 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1685 
iwl_°‹ed_bóc⁄_nŸif_comm⁄
 *
sb
 = (*)
pkt
->
d©a
;

1686 
õì80211_rx_°©us
 
rx_°©us
;

1687 
sk_buff
 *
skb
;

1688 
u8
 *
d©a
;

1689 
u32
 
size
 = 
	`À32_to_˝u
(
sb
->
byã_cou¡
);

1690 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1691 
	`WIDE_ID
(
PROT_OFFLOAD_GROUP
, 
STORED_BEACON_NTF
),

1694 i‡(
size
 == 0)

1698 i‡(
vî
 <= 2) {

1699 
iwl_°‹ed_bóc⁄_nŸif_v2
 *
sb_v2
 = (*)
pkt
->
d©a
;

1701 i‡(
pkt_Àn
 < 
	`°ru˘_size
(
sb_v2
, 
d©a
, 
size
))

1704 
d©a
 = 
sb_v2
->data;

1706 
iwl_°‹ed_bóc⁄_nŸif_v3
 *
sb_v3
 = (*)
pkt
->
d©a
;

1708 i‡(
pkt_Àn
 < 
	`°ru˘_size
(
sb_v3
, 
d©a
, 
size
))

1711 
d©a
 = 
sb_v3
->data;

1714 
skb
 = 
	`Æloc_skb
(
size
, 
GFP_ATOMIC
);

1715 i‡(!
skb
) {

1716 
	`IWL_ERR
(
mvm
, "alloc_skb failed\n");

1721 
	`mem£t
(&
rx_°©us
, 0, (rx_status));

1722 
rx_°©us
.
ma˘ime
 = 
	`À64_to_˝u
(
sb
->
tsf
);

1724 
rx_°©us
.
Êag
 |
RX_FLAG_MACTIME_PLCP_START
;

1725 
rx_°©us
.
devi˚_time°amp
 = 
	`À32_to_˝u
(
sb
->
sy°em_time
);

1726 
rx_°©us
.
b™d
 =

1727 (
sb
->
b™d
 & 
	`˝u_to_À16
(
RX_RES_PHY_FLAGS_BAND_24
)) ?

1728 
NL80211_BAND_2GHZ
 : 
NL80211_BAND_5GHZ
;

1729 
rx_°©us
.
‰eq
 =

1730 
	`õì80211_ch™√l_to_‰equícy
(
	`À16_to_˝u
(
sb
->
ch™√l
),

1731 
rx_°©us
.
b™d
);

1734 
	`skb_put_d©a
(
skb
, 
d©a
, 
size
);

1735 
	`mem˝y
(
	`IEEE80211_SKB_RXCB
(
skb
), &
rx_°©us
, (rx_status));

1738 
	`õì80211_rx_«pi
(
mvm
->
hw
, 
NULL
, 
skb
, NULL);

1739 
	}
}

1741 
	$iwl_mvm_¥obe_ª•_d©a_nŸif
(
iwl_mvm
 *
mvm
,

1742 
iwl_rx_cmd_buf„r
 *
rxb
)

1744 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1745 
iwl_¥obe_ª•_d©a_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

1746 
iwl_¥obe_ª•_d©a
 *
ﬁd_d©a
, *
√w_d©a
;

1747 
u32
 
id
 = 
	`À32_to_˝u
(
nŸif
->
mac_id
);

1748 
õì80211_vif
 *
vif
;

1749 
iwl_mvm_vif
 *
mvmvif
;

1751 
	`IWL_DEBUG_INFO
(
mvm
, "ProbeÑesponse dataÇotif:Çoa %d, csa %d\n",

1752 
nŸif
->
nﬂ_a˘ive
,ÇŸif->
cß_cou¡î
);

1754 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
id
, 
Ál£
);

1755 i‡(!
vif
)

1758 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1760 
√w_d©a
 = 
	`kzÆloc
((*√w_d©a), 
GFP_KERNEL
);

1761 i‡(!
√w_d©a
)

1764 
	`mem˝y
(&
√w_d©a
->
nŸif
,Çotif, (new_data->notif));

1767 
√w_d©a
->
nﬂ_Àn
 = (
õì80211_víd‹_õ
) +

1768 (
√w_d©a
->
nŸif
.
nﬂ_©å
) - 1;

1774 i‡(
√w_d©a
->
nŸif
.
nﬂ_©å
.
Àn_low
 ==

1775 (
õì80211_p2p_nﬂ_desc
) + 2)

1776 
√w_d©a
->
nﬂ_Àn
 -(
õì80211_p2p_nﬂ_desc
);

1778 
ﬁd_d©a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
,

1779 
	`lockdï_is_hñd
(&
mvmvif
->
mvm
->
muãx
));

1780 
	`rcu_assign_poöãr
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
, 
√w_d©a
);

1782 i‡(
ﬁd_d©a
)

1783 
	`k‰ì_rcu
(
ﬁd_d©a
, 
rcu_hód
);

1785 i‡(
nŸif
->
cß_cou¡î
 !
IWL_PROBE_RESP_DATA_NO_CSA
 &&

1786 
nŸif
->
cß_cou¡î
 >= 1)

1787 
	`õì80211_bóc⁄_£t_˙tdwn
(
vif
, 
nŸif
->
cß_cou¡î
);

1788 
	}
}

1790 
	$iwl_mvm_ch™√l_swôch_°¨t_nŸif
(
iwl_mvm
 *
mvm
,

1791 
iwl_rx_cmd_buf„r
 *
rxb
)

1793 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1794 
õì80211_vif
 *
cß_vif
, *
vif
;

1795 
iwl_mvm_vif
 *
mvmvif
, *
cß_mvmvif
;

1796 
u32
 
id_n_cﬁ‹
, 
cß_id
;

1798 
u32
 
id
;

1799 
u32
 
mac_lök_id
 = 0;

1800 
u8
 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
MAC_CONF_GROUP
,

1801 
CHANNEL_SWITCH_START_NOTIF
, 0);

1802 
boﬁ
 
cß_a˘ive
;

1804 
	`rcu_ªad_lock
();

1806 i‡(
nŸif_vî
 < 3) {

1807 
iwl_ch™√l_swôch_°¨t_nŸif_v1
 *
nŸif
 = (*)
pkt
->
d©a
;

1808 
u32
 
mac_id
;

1810 
id_n_cﬁ‹
 = 
	`À32_to_˝u
(
nŸif
->
id_™d_cﬁ‹
);

1811 
mac_id
 = 
id_n_cﬁ‹
 & 
FW_CTXT_ID_MSK
;

1813 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
mac_id
, 
åue
);

1814 i‡(!
vif
)

1815 
out_u∆ock
;

1817 
id
 = 
mac_id
;

1818 
cß_a˘ive
 = 
vif
->
bss_c⁄f
.csa_active;

1820 
iwl_ch™√l_swôch_°¨t_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

1821 
u32
 
lök_id
 = 
	`À32_to_˝u
(
nŸif
->link_id);

1822 
õì80211_bss_c⁄f
 *
bss_c⁄f
 =

1823 
	`iwl_mvm_rcu_fw_lök_id_to_lök_c⁄f
(
mvm
, 
lök_id
, 
åue
);

1825 i‡(!
bss_c⁄f
)

1826 
out_u∆ock
;

1828 
id
 = 
lök_id
;

1829 
mac_lök_id
 = 
bss_c⁄f
->
lök_id
;

1830 
vif
 = 
bss_c⁄f
->vif;

1831 
cß_a˘ive
 = 
bss_c⁄f
->csa_active;

1834 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1835 i‡(
nŸif_vî
 >= 3)

1836 
id_n_cﬁ‹
 = 
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
);

1838 
vif
->
ty≥
) {

1839 
NL80211_IFTYPE_AP
:

1840 
cß_vif
 = 
	`rcu_dîe„ªn˚
(
mvm
->csa_vif);

1841 i‡(
	`WARN_ON
(!
cß_vif
 || !cß_vif->
bss_c⁄f
.
cß_a˘ive
 ||

1842 
cß_vif
 !
vif
))

1843 
out_u∆ock
;

1845 
cß_mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
cß_vif
);

1846 
cß_id
 = 
	`FW_CMD_ID_AND_COLOR
(
cß_mvmvif
->
id
, cß_mvmvif->
cﬁ‹
);

1847 i‡(
	`WARN
(
cß_id
 !
id_n_cﬁ‹
,

1849 
cß_id
, 
id_n_cﬁ‹
))

1850 
out_u∆ock
;

1852 
	`IWL_DEBUG_INFO
(
mvm
, "Channel Switch Started Notification\n");

1854 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
cs_tx_unblock_dw‹k
,

1855 
	`m£cs_to_jiffõs
(
IWL_MVM_CS_UNBLOCK_TX_TIMEOUT
 *

1856 
cß_vif
->
bss_c⁄f
.
bóc⁄_öt
));

1858 
	`õì80211_cß_föish
(
cß_vif
, 0);

1860 
	`rcu_ªad_u∆ock
();

1862 
	`RCU_INIT_POINTER
(
mvm
->
cß_vif
, 
NULL
);

1864 
NL80211_IFTYPE_STATION
:

1869 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
MAC_CONF_GROUP
,

1870 
CHANNEL_SWITCH_ERROR_NOTIF
,

1871 0Ë&& !
cß_a˘ive
) {

1872 
	`IWL_DEBUG_INFO
(
mvm
, "Channel Switch was canceled\n");

1873 
	`iwl_mvm_ˇn˚l_ch™√l_swôch
(
mvm
, 
vif
, 
id
);

1877 
	`iwl_mvm_cß_˛õ¡_ab£¡
(
mvm
, 
vif
);

1878 
	`ˇn˚l_dñayed_w‹k
(&
mvmvif
->
cß_w‹k
);

1879 
	`õì80211_chswôch_d⁄e
(
vif
, 
åue
, 
mac_lök_id
);

1883 
	`WARN_ON_ONCE
(1);

1886 
out_u∆ock
:

1887 
	`rcu_ªad_u∆ock
();

1888 
	}
}

1890 
	$iwl_mvm_ch™√l_swôch_îr‹_nŸif
(
iwl_mvm
 *
mvm
,

1891 
iwl_rx_cmd_buf„r
 *
rxb
)

1893 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1894 
iwl_ch™√l_swôch_îr‹_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

1895 
õì80211_vif
 *
vif
;

1896 
u32
 
id
 = 
	`À32_to_˝u
(
nŸif
->
lök_id
);

1897 
u32
 
cß_îr_mask
 = 
	`À32_to_˝u
(
nŸif
->csa_err_mask);

1899 
	`rcu_ªad_lock
();

1900 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
id
, 
åue
);

1901 i‡(!
vif
) {

1902 
	`rcu_ªad_u∆ock
();

1906 
	`IWL_DEBUG_INFO
(
mvm
, "FWÑeports CSAÉrror: id=%u, csa_err_mask=%u\n",

1907 
id
, 
cß_îr_mask
);

1908 i‡(
cß_îr_mask
 & (
CS_ERR_COUNT_ERROR
 |

1909 
CS_ERR_LONG_DELAY_AFTER_CS
 |

1910 
CS_ERR_TX_BLOCK_TIMER_EXPIRED
))

1911 
	`õì80211_ch™√l_swôch_disc⁄√˘
(
vif
, 
åue
);

1912 
	`rcu_ªad_u∆ock
();

1913 
	}
}

1915 
	$iwl_mvm_rx_mis£d_v≠_nŸif
(
iwl_mvm
 *
mvm
,

1916 
iwl_rx_cmd_buf„r
 *
rxb
)

1918 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1919 
iwl_mis£d_v≠_nŸif
 *
mb
 = (*)
pkt
->
d©a
;

1920 
õì80211_vif
 *
vif
;

1921 
u32
 
id
 = 
	`À32_to_˝u
(
mb
->
mac_id
);

1923 
	`IWL_DEBUG_INFO
(
mvm
,

1925 
	`À32_to_˝u
(
mb
->
mac_id
),

1926 
mb
->
num_bóc⁄_öãrvÆs_ñ≠£d
,

1927 
mb
->
¥ofûe_≥riodicôy
);

1929 
	`rcu_ªad_lock
();

1931 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
id
, 
åue
);

1932 i‡(
vif
)

1933 
	`iwl_mvm_c⁄√˘i⁄_loss
(
mvm
, 
vif
, "missed vap beacon");

1935 
	`rcu_ªad_u∆ock
();

1936 
	}
}

	@mvm/mac80211.c

7 
	~<löux/kî√l.h
>

8 
	~<löux/¶ab.h
>

9 
	~<löux/skbuff.h
>

10 
	~<löux/√tdevi˚.h
>

11 
	~<löux/ëhîdevi˚.h
>

12 
	~<löux/ù.h
>

13 
	~<löux/if_¨p.h
>

14 
	~<löux/time.h
>

15 
	~<√t/mac80211.h
>

16 
	~<√t/õì80211_ødiŸ≠.h
>

17 
	~<√t/t˝.h
>

19 
	~"iwl-drv.h
"

20 
	~"iwl-›-mode.h
"

21 
	~"iwl-io.h
"

22 
	~"mvm.h
"

23 
	~"°a.h
"

24 
	~"time-evít.h
"

25 
	~"iwl-ì¥om-∑r£.h
"

26 
	~"iwl-phy-db.h
"

27 
	~"ã°mode.h
"

28 
	~"fw/îr‹-dump.h
"

29 
	~"iwl-¥ph.h
"

30 
	~"iwl-nvm-∑r£.h
"

31 
	~"time-sync.h
"

33 c⁄° 
õì80211_iÁ˚_limô
 
	giwl_mvm_limôs
[] = {

35 .
max
 = 1,

36 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

39 .
	gmax
 = 1,

40 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_AP
) |

41 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

42 
BIT
(
NL80211_IFTYPE_P2P_GO
),

45 .
	gmax
 = 1,

46 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_DEVICE
),

50 c⁄° 
õì80211_iÁ˚_combö©i⁄
 
	giwl_mvm_iÁ˚_combö©i⁄s
[] = {

52 .
num_dif„ª¡_ch™√ls
 = 2,

53 .
	gmax_öãrÁ˚s
 = 3,

54 .
	glimôs
 = 
iwl_mvm_limôs
,

55 .
	gn_limôs
 = 
ARRAY_SIZE
(
iwl_mvm_limôs
),

59 c⁄° 
cfg80211_pm§_ˇ∑bûôõs
 
	giwl_mvm_pm§_ˇ∑
 = {

60 .
max_≥îs
 = 
IWL_MVM_TOF_MAX_APS
,

61 .
	gªp‹t_≠_tsf
 = 1,

62 .
	gøndomize_mac_addr
 = 1,

64 .
	g·m
 = {

65 .
suµ‹ãd
 = 1,

66 .
	gaßp
 = 1,

67 .
	gn⁄_aßp
 = 1,

68 .
	gªque°_lci
 = 1,

69 .
	gªque°_civi˛oc
 = 1,

70 .
	gåiggî_ba£d
 = 1,

71 .
	gn⁄_åiggî_ba£d
 = 1,

72 .
	gmax_bur°s_exp⁄ít
 = -1,

73 .
	gmax_·ms_≥r_bur°
 = 0,

74 .
	gb™dwidths
 = 
BIT
(
NL80211_CHAN_WIDTH_20_NOHT
) |

75 
BIT
(
NL80211_CHAN_WIDTH_20
) |

76 
BIT
(
NL80211_CHAN_WIDTH_40
) |

77 
BIT
(
NL80211_CHAN_WIDTH_80
) |

78 
BIT
(
NL80211_CHAN_WIDTH_160
),

79 .
	g¥ómbÀs
 = 
BIT
(
NL80211_PREAMBLE_LEGACY
) |

80 
BIT
(
NL80211_PREAMBLE_HT
) |

81 
BIT
(
NL80211_PREAMBLE_VHT
) |

82 
BIT
(
NL80211_PREAMBLE_HE
),

86 
__iwl_mvm_mac_£t_key
(
õì80211_hw
 *
hw
,

87 
£t_key_cmd
 
cmd
,

88 
õì80211_vif
 *
vif
,

89 
õì80211_°a
 *
°a
,

90 
õì80211_key_c⁄f
 *
key
);

92 
	$iwl_mvm_ª£t_phy_˘xts
(
iwl_mvm
 *
mvm
)

94 
i
;

96 
	`mem£t
(
mvm
->
phy_˘xts
, 0, (mvm->phy_ctxts));

97 
i
 = 0; i < 
NUM_PHY_CTX
; i++) {

98 
mvm
->
phy_˘xts
[
i
].
id
 = i;

99 
mvm
->
phy_˘xts
[
i
].
ªf
 = 0;

101 
	}
}

103 
õì80211_ªgdomaö
 *
	$iwl_mvm_gë_ªgdomaö
(
wùhy
 *wiphy,

104 c⁄° *
Æpha2
,

105 
iwl_mcc_sour˚
 
§c_id
,

106 
boﬁ
 *
ch™ged
)

108 
õì80211_ªgdomaö
 *
ªgd
 = 
NULL
;

109 
õì80211_hw
 *
hw
 = 
	`wùhy_to_õì80211_hw
(
wùhy
);

110 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

111 
iwl_mcc_upd©e_ª•_v8
 *
ª•
;

112 
u8
 
ª•_vî
;

114 
	`IWL_DEBUG_LAR
(
mvm
, "GëtögÑegdomaö d©®f‹ %†‰om FW\n", 
Æpha2
);

116 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

118 
ª•
 = 
	`iwl_mvm_upd©e_mcc
(
mvm
, 
Æpha2
, 
§c_id
);

119 i‡(
	`IS_ERR_OR_NULL
(
ª•
)) {

120 
	`IWL_DEBUG_LAR
(
mvm
, "CouldÇot get update from FW %d\n",

121 
	`PTR_ERR_OR_ZERO
(
ª•
));

122 
ª•
 = 
NULL
;

123 
out
;

126 i‡(
ch™ged
) {

127 
u32
 
°©us
 = 
	`À32_to_˝u
(
ª•
->status);

129 *
ch™ged
 = (
°©us
 =
MCC_RESP_NEW_CHAN_PROFILE
 ||

130 
°©us
 =
MCC_RESP_ILLEGAL
);

132 
ª•_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
IWL_ALWAYS_LONG_GROUP
,

133 
MCC_UPDATE_CMD
, 0);

134 
	`IWL_DEBUG_LAR
(
mvm
, "MCC upd©êª•⁄£ vîsi⁄: %d\n", 
ª•_vî
);

136 
ªgd
 = 
	`iwl_∑r£_nvm_mcc_öfo
(
mvm
->
å™s
->
dev
, mvm->
cfg
,

137 
	`__À32_to_˝u
(
ª•
->
n_ch™√ls
),

138 
ª•
->
ch™√ls
,

139 
	`__À16_to_˝u
(
ª•
->
mcc
),

140 
	`__À16_to_˝u
(
ª•
->
geo_öfo
),

141 
	`À32_to_˝u
(
ª•
->
ˇp
), 
ª•_vî
,

142 
mvm
->
fwπ
.
u©s_íabÀd
);

144 
§c_id
 = 
ª•
->
sour˚_id
;

145 i‡(
	`IS_ERR_OR_NULL
(
ªgd
)) {

146 
	`IWL_DEBUG_LAR
(
mvm
, "CouldÇot getÖarse update from FW %d\n",

147 
	`PTR_ERR_OR_ZERO
(
ªgd
));

148 
out
;

151 
	`IWL_DEBUG_LAR
(
mvm
, "settingálpha2 from FWÅo %s (0x%x, 0x%x) src=%d\n",

152 
ªgd
->
Æpha2
,Ñegd->Æpha2[0],Ñegd->Æpha2[1], 
§c_id
);

153 
mvm
->
œr_ªgdom_£t
 = 
åue
;

154 
mvm
->
mcc_§c
 = 
§c_id
;

160 i‡(
ª•
->
mcc
 =
	`˝u_to_À16
(
IWL_MCC_US
) ||

161 
ª•
->
mcc
 =
	`˝u_to_À16
(
IWL_MCC_CANADA
))

162 
	`õì80211_hw_£t
(
mvm
->
hw
, 
DISALLOW_PUNCTURING
);

164 
	`__˛ór_bô
(
IEEE80211_HW_DISALLOW_PUNCTURING
, 
mvm
->
hw
->
Êags
);

166 
	`iwl_mei_£t_cou¡ry_code
(
	`__À16_to_˝u
(
ª•
->
mcc
));

168 
out
:

169 
	`k‰ì
(
ª•
);

170  
ªgd
;

171 
	}
}

173 
	$iwl_mvm_upd©e_ch™ged_ªgdom
(
iwl_mvm
 *
mvm
)

175 
boﬁ
 
ch™ged
;

176 
õì80211_ªgdomaö
 *
ªgd
;

178 i‡(!
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
))

181 
ªgd
 = 
	`iwl_mvm_gë_cuºít_ªgdomaö
(
mvm
, &
ch™ged
);

182 i‡(!
	`IS_ERR_OR_NULL
(
ªgd
)) {

184 i‡(
ch™ged
)

185 
	`ªguœt‹y_£t_wùhy_ªgd
(
mvm
->
hw
->
wùhy
, 
ªgd
);

187 
	`k‰ì
(
ªgd
);

189 
	}
}

191 
õì80211_ªgdomaö
 *
	$iwl_mvm_gë_cuºít_ªgdomaö
(
iwl_mvm
 *
mvm
,

192 
boﬁ
 *
ch™ged
)

194  
	`iwl_mvm_gë_ªgdomaö
(
mvm
->
hw
->
wùhy
, "ZZ",

195 
	`iwl_mvm_is_wifi_mcc_suµ‹ãd
(
mvm
) ?

196 
MCC_SOURCE_GET_CURRENT
 :

197 
MCC_SOURCE_OLD_FW
, 
ch™ged
);

198 
	}
}

200 
	$iwl_mvm_öô_fw_ªgd
(
iwl_mvm
 *
mvm
, 
boﬁ
 
f‹˚_ªgd_sync
)

202 
iwl_mcc_sour˚
 
u£d_§c
;

203 
õì80211_ªgdomaö
 *
ªgd
;

204 
ªt
;

205 
boﬁ
 
ch™ged
;

206 c⁄° 
õì80211_ªgdomaö
 *
r
 =

207 
	`wùhy_dîe„ªn˚
(
mvm
->
hw
->
wùhy
, mvm->hw->wùhy->
ªgd
);

209 i‡(!
r
)

210  -
ENOENT
;

213 
u£d_§c
 = 
mvm
->
mcc_§c
;

214 i‡(
	`iwl_mvm_is_wifi_mcc_suµ‹ãd
(
mvm
)) {

216 
ªgd
 = 
	`iwl_mvm_gë_cuºít_ªgdomaö
(
mvm
, 
NULL
);

217 i‡(!
	`IS_ERR_OR_NULL
(
ªgd
))

218 
	`k‰ì
(
ªgd
);

222 
ªgd
 = 
	`iwl_mvm_gë_ªgdomaö
(
mvm
->
hw
->
wùhy
, 
r
->
Æpha2
, 
u£d_§c
,

223 &
ch™ged
);

224 i‡(
	`IS_ERR_OR_NULL
(
ªgd
))

225  -
EIO
;

230 i‡(
ch™ged
 || 
f‹˚_ªgd_sync
)

231 
ªt
 = 
	`ªguœt‹y_£t_wùhy_ªgd_sync
(
mvm
->
hw
->
wùhy
, 
ªgd
);

233 
ªt
 = 0;

235 
	`k‰ì
(
ªgd
);

236  
ªt
;

237 
	}
}

240 c⁄° 
u8
 
	ghe_if_ty≥s_ext_ˇ∑_°a
[] = {

241 [0] = 
WLAN_EXT_CAPA1_EXT_CHANNEL_SWITCHING
,

242 [2] = 
WLAN_EXT_CAPA3_MULTI_BSSID_SUPPORT
,

243 [7] = 
WLAN_EXT_CAPA8_OPMODE_NOTIF
 |

244 
WLAN_EXT_CAPA8_MAX_MSDU_IN_AMSDU_LSB
,

245 [8] = 
WLAN_EXT_CAPA9_MAX_MSDU_IN_AMSDU_MSB
,

248 c⁄° 
u8
 
	gtm_if_ty≥s_ext_ˇ∑_°a
[] = {

249 [0] = 
WLAN_EXT_CAPA1_EXT_CHANNEL_SWITCHING
,

250 [2] = 
WLAN_EXT_CAPA3_MULTI_BSSID_SUPPORT
 |

251 
WLAN_EXT_CAPA3_TIMING_MEASUREMENT_SUPPORT
,

252 [7] = 
WLAN_EXT_CAPA8_OPMODE_NOTIF
 |

253 
WLAN_EXT_CAPA8_MAX_MSDU_IN_AMSDU_LSB
,

254 [8] = 
WLAN_EXT_CAPA9_MAX_MSDU_IN_AMSDU_MSB
,

255 [9] = 
WLAN_EXT_CAPA10_TWT_REQUESTER_SUPPORT
,

262 
	#IWL_MVM_EMLSR_CAPA
 (
IEEE80211_EML_CAP_EMLSR_SUPP
 | \

263 
IEEE80211_EML_CAP_EMLSR_PADDING_DELAY_32US
 << \

264 
	`__bf_shf
(
IEEE80211_EML_CAP_EMLSR_PADDING_DELAY
) | \

265 
IEEE80211_EML_CAP_EMLSR_TRANSITION_DELAY_64US
 << \

266 
	`__bf_shf
(
IEEE80211_EML_CAP_EMLSR_TRANSITION_DELAY
))

	)

267 
	#IWL_MVM_MLD_CAPA_OPS
 
	`FIELD_PREP_CONST
( \

268 
IEEE80211_MLD_CAP_OP_TID_TO_LINK_MAP_NEG_SUPP
, \

269 
IEEE80211_MLD_CAP_OP_TID_TO_LINK_MAP_NEG_SUPP_SAME
)

	)

271 c⁄° 
wùhy_i·y≥_ext_ˇ∑b
 
	gadd_i·y≥s_ext_ˇ∑
[] = {

273 .
i·y≥
 = 
NL80211_IFTYPE_STATION
,

274 .
	gexãnded_ˇ∑bûôõs
 = 
he_if_ty≥s_ext_ˇ∑_°a
,

275 .
	gexãnded_ˇ∑bûôõs_mask
 = 
he_if_ty≥s_ext_ˇ∑_°a
,

276 .
	gexãnded_ˇ∑bûôõs_Àn
 = (
he_if_ty≥s_ext_ˇ∑_°a
),

278 .
	geml_ˇ∑bûôõs
 = 
IWL_MVM_EMLSR_CAPA
,

279 .
	gmld_ˇ∑_™d_›s
 = 
IWL_MVM_MLD_CAPA_OPS
,

282 .
	gi·y≥
 = 
NL80211_IFTYPE_STATION
,

283 .
	gexãnded_ˇ∑bûôõs
 = 
tm_if_ty≥s_ext_ˇ∑_°a
,

284 .
	gexãnded_ˇ∑bûôõs_mask
 = 
tm_if_ty≥s_ext_ˇ∑_°a
,

285 .
	gexãnded_ˇ∑bûôõs_Àn
 = (
tm_if_ty≥s_ext_ˇ∑_°a
),

287 .
	geml_ˇ∑bûôõs
 = 
IWL_MVM_EMLSR_CAPA
,

288 .
	gmld_ˇ∑_™d_›s
 = 
IWL_MVM_MLD_CAPA_OPS
,

292 
	$iwl_mvm_›_gë_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 *
tx_™t
, u32 *
rx_™t
)

294 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

295 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

296 *
tx_™t
 = 
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
);

297 *
rx_™t
 = 
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
);

298 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

300 
	}
}

302 
	$iwl_mvm_›_£t_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 
tx_™t
, u32 
rx_™t
)

304 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

306 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

309 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 !
IWL_DEVICE_FAMILY_9000
 &&

310 
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 !
IWL_DEVICE_FAMILY_22000
) {

311 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

312  -
EOPNOTSUPP
;

315 i‡(!
mvm
->
nvm_d©a
) {

316 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

317  -
EBUSY
;

324 
mvm
->
£t_tx_™t
 = 
tx_™t
;

325 
mvm
->
£t_rx_™t
 = 
rx_™t
;

327 
	`iwl_ªöô_ˇb
(
mvm
->
å™s
, mvm->
nvm_d©a
, 
tx_™t
, 
rx_™t
, mvm->
fw
);

329 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

331 
	}
}

333 
	$iwl_mvm_mac_£tup_ªgi°î
(
iwl_mvm
 *
mvm
)

335 
õì80211_hw
 *
hw
 = 
mvm
->hw;

336 
num_mac
, 
ªt
, 
i
;

337 c⁄° 
u32
 
mvm_cùhîs
[] = {

338 
WLAN_CIPHER_SUITE_WEP40
,

339 
WLAN_CIPHER_SUITE_WEP104
,

340 
WLAN_CIPHER_SUITE_TKIP
,

341 
WLAN_CIPHER_SUITE_CCMP
,

343 #ifde‡
CONFIG_PM_SLEEP


344 
boﬁ
 
unifõd
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

345 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

347 
u32
 
£c_key_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SEC_KEY_CMD
);

348 
u8
 
£c_key_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
£c_key_id
, 0);

351 
	`õì80211_hw_£t
(
hw
, 
SIGNAL_DBM
);

352 
	`õì80211_hw_£t
(
hw
, 
SPECTRUM_MGMT
);

353 
	`õì80211_hw_£t
(
hw
, 
REPORTS_TX_ACK_STATUS
);

354 
	`õì80211_hw_£t
(
hw
, 
WANT_MONITOR_VIF
);

355 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_PS
);

356 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_DYNAMIC_PS
);

357 
	`õì80211_hw_£t
(
hw
, 
AMPDU_AGGREGATION
);

358 
	`õì80211_hw_£t
(
hw
, 
CONNECTION_MONITOR
);

359 
	`õì80211_hw_£t
(
hw
, 
CHANCTX_STA_CSA
);

360 
	`õì80211_hw_£t
(
hw
, 
SUPPORT_FAST_XMIT
);

361 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_CLONED_SKBS
);

362 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_AMSDU_IN_AMPDU
);

363 
	`õì80211_hw_£t
(
hw
, 
NEEDS_UNIQUE_STA_ADDR
);

364 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_VHT_EXT_NSS_BW
);

365 
	`õì80211_hw_£t
(
hw
, 
BUFF_MMPDU_TXQ
);

366 
	`õì80211_hw_£t
(
hw
, 
STA_MMPDU_TXQ
);

369 i‡(
mvm
->
mld_≠i_is_u£d
 && mvm->
nvm_d©a
->
sku_ˇp_11be_íabÀ
 &&

370 !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
 &&

371 !
iwlwifi_mod_∑øms
.
dißbÀ_11be
)

372 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_DISABLE_WEXT
;

377 i‡(!
mvm
->
mld_≠i_is_u£d
)

378 
	`õì80211_hw_£t
(
hw
, 
TIMING_BEACON_ONLY
);

383 i‡(!(
hw
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_MLO
))

384 
	`õì80211_hw_£t
(
hw
, 
DEAUTH_NEED_MGD_TX_PREP
);

397 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_9000
)

398 
	`õì80211_hw_£t
(
hw
, 
TX_AMSDU
);

399 
	`õì80211_hw_£t
(
hw
, 
TX_FRAG_LIST
);

401 i‡(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)) {

402 
	`õì80211_hw_£t
(
hw
, 
TX_AMPDU_SETUP_IN_HW
);

403 
	`õì80211_hw_£t
(
hw
, 
HAS_RATE_CONTROL
);

407 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
) &&

408 
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 > 
IWL_DEVICE_FAMILY_9000
)

409 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_REORDERING_BUFFER
);

411 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

412 
IWL_UCODE_TLV_CAPA_STA_PM_NOTIF
)) {

413 
	`õì80211_hw_£t
(
hw
, 
AP_LINK_PS
);

414 } i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))) {

420  -
EINVAL
;

423 i‡(
mvm
->
å™s
->
num_rx_queues
 > 1)

424 
	`õì80211_hw_£t
(
hw
, 
USES_RSS
);

426 i‡(
mvm
->
å™s
->
max_skb_‰ags
)

427 
hw
->
√tdev_„©uªs
 = 
NETIF_F_HIGHDMA
 | 
NETIF_F_SG
;

429 
hw
->
queues
 = 
IEEE80211_NUM_ACS
;

430 
hw
->
offch™√l_tx_hw_queue
 = 
IWL_MVM_OFFCHANNEL_QUEUE
;

431 
hw
->
ødiŸ≠_mcs_dëaûs
 |
IEEE80211_RADIOTAP_MCS_HAVE_FEC
 |

432 
IEEE80211_RADIOTAP_MCS_HAVE_STBC
;

433 
hw
->
ødiŸ≠_vht_dëaûs
 |
IEEE80211_RADIOTAP_VHT_KNOWN_STBC
 |

434 
IEEE80211_RADIOTAP_VHT_KNOWN_BEAMFORMED
;

436 
hw
->
ødiŸ≠_time°amp
.
unôs_pos
 =

437 
IEEE80211_RADIOTAP_TIMESTAMP_UNIT_US
 |

438 
IEEE80211_RADIOTAP_TIMESTAMP_SPOS_PLCP_SIG_ACQ
;

440 
hw
->
ødiŸ≠_time°amp
.
accuøcy
 = 22;

442 i‡(!
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
))

443 
hw
->
øã_c⁄åﬁ_Æg‹ôhm
 = 
RS_NAME
;

445 
hw
->
u≠sd_queues
 = 
IWL_MVM_UAPSD_QUEUES
;

446 
hw
->
u≠sd_max_•_Àn
 = 
IWL_UAPSD_MAX_SP
;

447 
hw
->
max_tx_‰agmíts
 = 
mvm
->
å™s
->
max_skb_‰ags
;

449 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
mvm
->
cùhîs
Ë< ARRAY_SIZE(
mvm_cùhîs
) + 6);

450 
	`mem˝y
(
mvm
->
cùhîs
, 
mvm_cùhîs
, (mvm_ciphers));

451 
hw
->
wùhy
->
n_cùhî_suôes
 = 
	`ARRAY_SIZE
(
mvm_cùhîs
);

452 
hw
->
wùhy
->
cùhî_suôes
 = 
mvm
->
cùhîs
;

454 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

455 
mvm
->
cùhîs
[
hw
->
wùhy
->
n_cùhî_suôes
] =

456 
WLAN_CIPHER_SUITE_GCMP
;

457 
hw
->
wùhy
->
n_cùhî_suôes
++;

458 
mvm
->
cùhîs
[
hw
->
wùhy
->
n_cùhî_suôes
] =

459 
WLAN_CIPHER_SUITE_GCMP_256
;

460 
hw
->
wùhy
->
n_cùhî_suôes
++;

463 i‡(
iwlwifi_mod_∑øms
.
sw¸y±o
)

464 
	`IWL_ERR
(
mvm
,

466 i‡(!
iwlwifi_mod_∑øms
.
bt_c€x_a˘ive
)

467 
	`IWL_ERR
(
mvm
,

470 
	`õì80211_hw_£t
(
hw
, 
MFP_CAPABLE
);

471 
mvm
->
cùhîs
[
hw
->
wùhy
->
n_cùhî_suôes
] = 
WLAN_CIPHER_SUITE_AES_CMAC
;

472 
hw
->
wùhy
->
n_cùhî_suôes
++;

473 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

474 
mvm
->
cùhîs
[
hw
->
wùhy
->
n_cùhî_suôes
] =

475 
WLAN_CIPHER_SUITE_BIP_GMAC_128
;

476 
hw
->
wùhy
->
n_cùhî_suôes
++;

477 
mvm
->
cùhîs
[
hw
->
wùhy
->
n_cùhî_suôes
] =

478 
WLAN_CIPHER_SUITE_BIP_GMAC_256
;

479 
hw
->
wùhy
->
n_cùhî_suôes
++;

482 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

483 
NL80211_EXT_FEATURE_BEACON_RATE_LEGACY
);

484 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

485 
NL80211_EXT_FEATURE_SCAN_MIN_PREQ_CONTENT
);

487 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

488 
IWL_UCODE_TLV_CAPA_FTM_CALIBRATED
)) {

489 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

490 
NL80211_EXT_FEATURE_ENABLE_FTM_RESPONDER
);

491 
hw
->
wùhy
->
pm§_ˇ∑
 = &
iwl_mvm_pm§_ˇ∑
;

494 i‡(
£c_key_vî
 &&

495 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

496 
IWL_UCODE_TLV_CAPA_BIGTK_TX_SUPPORT
))

497 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

498 
NL80211_EXT_FEATURE_BEACON_PROTECTION
);

499 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

500 
IWL_UCODE_TLV_CAPA_BIGTK_SUPPORT
))

501 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

502 
NL80211_EXT_FEATURE_BEACON_PROTECTION_CLIENT
);

504 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

505 
IWL_UCODE_TLV_CAPA_TIME_SYNC_BOTH_FTM_TM
))

506 
hw
->
wùhy
->
hw_time°amp_max_≥îs
 = 1;

508 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

509 
IWL_UCODE_TLV_CAPA_SPP_AMSDU_SUPPORT
))

510 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

511 
NL80211_EXT_FEATURE_SPP_AMSDU_SUPPORT
);

513 
	`õì80211_hw_£t
(
hw
, 
SINGLE_SCAN_ON_ALL_BANDS
);

514 
hw
->
wùhy
->
„©uªs
 |=

515 
NL80211_FEATURE_SCHED_SCAN_RANDOM_MAC_ADDR
 |

516 
NL80211_FEATURE_SCAN_RANDOM_MAC_ADDR
 |

517 
NL80211_FEATURE_ND_RANDOM_MAC_ADDR
;

519 
hw
->
°a_d©a_size
 = (
iwl_mvm_°a
);

520 
hw
->
vif_d©a_size
 = (
iwl_mvm_vif
);

521 
hw
->
ch™˘x_d©a_size
 = (
u16
);

522 
hw
->
txq_d©a_size
 = (
iwl_mvm_txq
);

524 
hw
->
wùhy
->
öãrÁ˚_modes
 = 
	`BIT
(
NL80211_IFTYPE_STATION
) |

525 
	`BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

526 
	`BIT
(
NL80211_IFTYPE_AP
) |

527 
	`BIT
(
NL80211_IFTYPE_P2P_GO
) |

528 
	`BIT
(
NL80211_IFTYPE_P2P_DEVICE
) |

529 
	`BIT
(
NL80211_IFTYPE_ADHOC
);

531 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_IBSS_RSN
;

532 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
, 
NL80211_EXT_FEATURE_VHT_IBSS
);

538 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

539 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

540 
NL80211_EXT_FEATURE_EXT_KEY_ID
);

541 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_HT_IBSS
;

543 
hw
->
wùhy
->
ªguœt‹y_Êags
 |
REGULATORY_ENABLE_RELAX_NO_IR
;

544 i‡(
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
))

545 
hw
->
wùhy
->
ªguœt‹y_Êags
 |
REGULATORY_WIPHY_SELF_MANAGED
;

547 
hw
->
wùhy
->
ªguœt‹y_Êags
 |
REGULATORY_CUSTOM_REG
 |

548 
REGULATORY_DISABLE_BEACON_HINTS
;

550 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

551 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

552 
NL80211_EXT_FEATURE_DFS_CONCURRENT
);

554 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_AP_UAPSD
;

555 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_HAS_CHANNEL_SWITCH
;

556 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_SPLIT_SCAN_6GHZ
;

558 
hw
->
wùhy
->
iÁ˚_combö©i⁄s
 = 
iwl_mvm_iÁ˚_combö©i⁄s
;

559 
hw
->
wùhy
->
n_iÁ˚_combö©i⁄s
 =

560 
	`ARRAY_SIZE
(
iwl_mvm_iÁ˚_combö©i⁄s
);

562 
hw
->
wùhy
->
max_ªmaö_⁄_ch™√l_duøti⁄
 = 10000;

563 
hw
->
max_li°í_öãrvÆ
 = 
IWL_MVM_CONN_LISTEN_INTERVAL
;

566 
	`mem˝y
(
mvm
->
addªs£s
[0].
addr
, mvm->
nvm_d©a
->
hw_addr
, 
ETH_ALEN
);

567 
hw
->
wùhy
->
addªs£s
 = 
mvm
->addresses;

568 
hw
->
wùhy
->
n_addªs£s
 = 1;

571 
num_mac
 = (
mvm
->
nvm_d©a
->
n_hw_addrs
 > 1) ?

572 
	`mö
(
IWL_MVM_MAX_ADDRESSES
, 
mvm
->
nvm_d©a
->
n_hw_addrs
) : 1;

574 
i
 = 1; i < 
num_mac
; i++) {

575 
	`mem˝y
(
mvm
->
addªs£s
[
i
].
addr
, mvm->addresses[i-1].addr,

576 
ETH_ALEN
);

577 
mvm
->
addªs£s
[
i
].
addr
[5]++;

578 
hw
->
wùhy
->
n_addªs£s
++;

581 
	`iwl_mvm_ª£t_phy_˘xts
(
mvm
);

583 
hw
->
wùhy
->
max_sˇn_õ_Àn
 = 
	`iwl_mvm_max_sˇn_õ_Àn
(
mvm
);

585 
hw
->
wùhy
->
max_sˇn_ssids
 = 
PROBE_OPTION_MAX
;

587 
	`BUILD_BUG_ON
(
IWL_MVM_SCAN_STOPPING_MASK
 & 
IWL_MVM_SCAN_MASK
);

588 
	`BUILD_BUG_ON
(
IWL_MVM_MAX_UMAC_SCANS
 > 
	`HWEIGHT32
(
IWL_MVM_SCAN_MASK
) ||

589 
IWL_MVM_MAX_LMAC_SCANS
 > 
	`HWEIGHT32
(
IWL_MVM_SCAN_MASK
));

591 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
))

592 
mvm
->
max_sˇns
 = 
IWL_MVM_MAX_UMAC_SCANS
;

594 
mvm
->
max_sˇns
 = 
IWL_MVM_MAX_LMAC_SCANS
;

596 i‡(
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
].
n_ch™√ls
)

597 
hw
->
wùhy
->
b™ds
[
NL80211_BAND_2GHZ
] =

598 &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

599 i‡(
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
].
n_ch™√ls
) {

600 
hw
->
wùhy
->
b™ds
[
NL80211_BAND_5GHZ
] =

601 &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

603 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

604 
IWL_UCODE_TLV_CAPA_BEAMFORMER
) &&

605 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

606 
IWL_UCODE_TLV_API_LQ_SS_PARAMS
))

607 
hw
->
wùhy
->
b™ds
[
NL80211_BAND_5GHZ
]->
vht_ˇp
.
ˇp
 |=

608 
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
;

610 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

611 
IWL_UCODE_TLV_CAPA_PSC_CHAN_SUPPORT
) &&

612 
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_6GHZ
].
n_ch™√ls
)

613 
hw
->
wùhy
->
b™ds
[
NL80211_BAND_6GHZ
] =

614 &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_6GHZ
];

616 
hw
->
wùhy
->
hw_vîsi⁄
 = 
mvm
->
å™s
->
hw_id
;

618 i‡(
iwlmvm_mod_∑øms
.
powî_scheme
 !
IWL_POWER_SCHEME_CAM
)

619 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_PS_ON_BY_DEFAULT
;

621 
hw
->
wùhy
->
Êags
 &~
WIPHY_FLAG_PS_ON_BY_DEFAULT
;

623 
hw
->
wùhy
->
max_sched_sˇn_ªqs
 = 1;

624 
hw
->
wùhy
->
max_sched_sˇn_ssids
 = 
PROBE_OPTION_MAX
;

625 
hw
->
wùhy
->
max_m©ch_£ts
 = 
	`iwl_umac_sˇn_gë_max_¥ofûes
(
mvm
->
fw
);

627 
hw
->
wùhy
->
max_sched_sˇn_õ_Àn
 =

628 
SCAN_OFFLOAD_PROBE_REQ_SIZE
 - 24 - 2;

629 
hw
->
wùhy
->
max_sched_sˇn_∂™s
 = 
IWL_MAX_SCHED_SCAN_PLANS
;

630 
hw
->
wùhy
->
max_sched_sˇn_∂™_öãrvÆ
 = 
U16_MAX
;

636 
hw
->
wùhy
->
max_sched_sˇn_∂™_ôî©i⁄s
 = 254;

638 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_P2P_GO_CTWIN
 |

639 
NL80211_FEATURE_LOW_PRIORITY_SCAN
 |

640 
NL80211_FEATURE_P2P_GO_OPPPS
 |

641 
NL80211_FEATURE_AP_MODE_CHAN_WIDTH_CHANGE
 |

642 
NL80211_FEATURE_DYNAMIC_SMPS
 |

643 
NL80211_FEATURE_STATIC_SMPS
 |

644 
NL80211_FEATURE_SUPPORTS_WMM_ADMISSION
;

646 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

647 
IWL_UCODE_TLV_CAPA_TXPOWER_INSERTION_SUPPORT
))

648 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_TX_POWER_INSERTION
;

649 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

650 
IWL_UCODE_TLV_CAPA_QUIET_PERIOD_SUPPORT
))

651 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_QUIET
;

653 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

654 
IWL_UCODE_TLV_CAPA_DS_PARAM_SET_IE_SUPPORT
))

655 
hw
->
wùhy
->
„©uªs
 |=

656 
NL80211_FEATURE_DS_PARAM_SET_IE_IN_PROBES
;

658 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

659 
IWL_UCODE_TLV_CAPA_WFA_TPC_REP_IE_SUPPORT
))

660 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_WFA_TPC_IE_IN_PROBES
;

662 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
WOWLAN_KEK_KCK_MATERIAL
,

663 
IWL_FW_CMD_VER_UNKNOWN
) == 3)

664 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_EXT_KEK_KCK
;

666 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

667 
IWL_UCODE_TLV_API_SCAN_TSF_REPORT
)) {

668 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

669 
NL80211_EXT_FEATURE_SCAN_START_TIME
);

670 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

671 
NL80211_EXT_FEATURE_BSS_PARENT_TSF
);

674 i‡(
	`iwl_mvm_is_o˚_suµ‹ãd
(
mvm
)) {

675 
u8
 
sˇn_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
SCAN_REQ_UMAC
, 0);

677 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

678 
NL80211_EXT_FEATURE_ACCEPT_BCAST_PROBE_RESP
);

679 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

680 
NL80211_EXT_FEATURE_FILS_MAX_CHANNEL_TIME
);

681 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

682 
NL80211_EXT_FEATURE_OCE_PROBE_REQ_HIGH_TX_RATE
);

685 i‡(
sˇn_vî
 < 15)

686 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

687 
NL80211_EXT_FEATURE_OCE_PROBE_REQ_DEFERRAL_SUPPRESSION
);

690 
hw
->
wùhy
->
i·y≥_ext_ˇ∑b
 = 
NULL
;

691 
hw
->
wùhy
->
num_i·y≥_ext_ˇ∑b
 = 0;

693 i‡(
mvm
->
nvm_d©a
->
sku_ˇp_11ax_íabÀ
 &&

694 !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
) {

695 
hw
->
wùhy
->
i·y≥_ext_ˇ∑b
 = 
add_i·y≥s_ext_ˇ∑
;

696 
hw
->
wùhy
->
num_i·y≥_ext_ˇ∑b
 =

697 
	`ARRAY_SIZE
(
add_i·y≥s_ext_ˇ∑
) - 1;

699 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_MULTI_BSSID
);

700 
	`õì80211_hw_£t
(
hw
, 
SUPPORTS_ONLY_HE_MULTI_BSSID
);

703 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

704 
	`WIDE_ID
(
DATA_PATH_GROUP
,

705 
WNM_80211V_TIMING_MEASUREMENT_CONFIG_CMD
),

706 
IWL_FW_CMD_VER_UNKNOWN
) >= 1) {

707 
	`IWL_DEBUG_INFO
(
mvm
->
å™s
, "Timing measurement supported\n");

709 i‡(!
hw
->
wùhy
->
i·y≥_ext_ˇ∑b
) {

710 
hw
->
wùhy
->
num_i·y≥_ext_ˇ∑b
 = 1;

711 
hw
->
wùhy
->
i·y≥_ext_ˇ∑b
 = 
add_i·y≥s_ext_ˇ∑
 +

712 
	`ARRAY_SIZE
(
add_i·y≥s_ext_ˇ∑
) - 1;

714 
hw
->
wùhy
->
i·y≥_ext_ˇ∑b
 = 
add_i·y≥s_ext_ˇ∑
 + 1;

718 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
	`WIDE_ID
(
LOCATION_GROUP
,

719 
TOF_RANGE_REQ_CMD
),

720 
IWL_FW_CMD_VER_UNKNOWN
) >= 11) {

721 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

722 
NL80211_EXT_FEATURE_PROT_RANGE_NEGO_AND_MEASURE
);

724 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

725 
IWL_UCODE_TLV_CAPA_SECURE_LTF_SUPPORT
))

726 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

727 
NL80211_EXT_FEATURE_SECURE_LTF
);

730 
mvm
->
πs_thªshﬁd
 = 
IEEE80211_MAX_RTS_THRESHOLD
;

732 #ifde‡
CONFIG_PM_SLEEP


733 i‡((
unifõd
 || 
mvm
->
fw
->
img
[
IWL_UCODE_WOWLAN
].
num_£c
) &&

734 
mvm
->
å™s
->
›s
->
d3_su•íd
 &&

735 
mvm
->
å™s
->
›s
->
d3_ªsume
 &&

736 
	`devi˚_ˇn_wakeup
(
mvm
->
å™s
->
dev
)) {

737 
mvm
->
wowœn
.
Êags
 |
WIPHY_WOWLAN_MAGIC_PKT
 |

738 
WIPHY_WOWLAN_DISCONNECT
 |

739 
WIPHY_WOWLAN_EAP_IDENTITY_REQ
 |

740 
WIPHY_WOWLAN_RFKILL_RELEASE
 |

741 
WIPHY_WOWLAN_NET_DETECT
;

742 
mvm
->
wowœn
.
Êags
 |
WIPHY_WOWLAN_SUPPORTS_GTK_REKEY
 |

743 
WIPHY_WOWLAN_GTK_REKEY_FAILURE
 |

744 
WIPHY_WOWLAN_4WAY_HANDSHAKE
;

746 
mvm
->
wowœn
.
n_∑âîns
 = 
IWL_WOWLAN_MAX_PATTERNS
;

747 
mvm
->
wowœn
.
∑âîn_mö_Àn
 = 
IWL_WOWLAN_MIN_PATTERN_LEN
;

748 
mvm
->
wowœn
.
∑âîn_max_Àn
 = 
IWL_WOWLAN_MAX_PATTERN_LEN
;

749 
mvm
->
wowœn
.
max_nd_m©ch_£ts
 =

750 
	`iwl_umac_sˇn_gë_max_¥ofûes
(
mvm
->
fw
);

751 
hw
->
wùhy
->
wowœn
 = &
mvm
->wowlan;

755 
ªt
 = 
	`iwl_mvm_Àds_öô
(
mvm
);

756 i‡(
ªt
)

757  
ªt
;

759 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

760 
IWL_UCODE_TLV_CAPA_TDLS_SUPPORT
)) {

761 
	`IWL_DEBUG_TDLS
(
mvm
, "TDLS supported\n");

762 
hw
->
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_TDLS
;

763 
	`õì80211_hw_£t
(
hw
, 
TDLS_WIDER_BW
);

766 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

767 
IWL_UCODE_TLV_CAPA_TDLS_CHANNEL_SWITCH
)) {

768 
	`IWL_DEBUG_TDLS
(
mvm
, "TDLS channel switch supported\n");

769 
hw
->
wùhy
->
„©uªs
 |
NL80211_FEATURE_TDLS_CHANNEL_SWITCH
;

772 
hw
->
√tdev_„©uªs
 |
mvm
->
cfg
->
„©uªs
;

773 i‡(!
	`iwl_mvm_is_csum_suµ‹ãd
(
mvm
))

774 
hw
->
√tdev_„©uªs
 &~
IWL_CSUM_NETIF_FLAGS_MASK
;

776 i‡(
mvm
->
cfg
->
vht_mu_mimo_suµ‹ãd
)

777 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

778 
NL80211_EXT_FEATURE_MU_MIMO_AIR_SNIFFER
);

780 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_PROTECTED_TWT
))

781 
	`wùhy_ext_„©uª_£t
(
hw
->
wùhy
,

782 
NL80211_EXT_FEATURE_PROTECTED_TWT
);

784 
	`iwl_mvm_víd‹_cmds_ªgi°î
(
mvm
);

786 
hw
->
wùhy
->
avaûabÀ_™ã¬as_tx
 = 
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
);

787 
hw
->
wùhy
->
avaûabÀ_™ã¬as_rx
 = 
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
);

789 
ªt
 = 
	`õì80211_ªgi°î_hw
(
mvm
->
hw
);

790 i‡(
ªt
) {

791 
	`iwl_mvm_Àds_exô
(
mvm
);

794  
ªt
;

795 
	}
}

797 
	$iwl_mvm_tx_skb
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

798 
õì80211_°a
 *
°a
)

800 i‡(
	`likñy
(
°a
)) {

801 i‡(
	`likñy
(
	`iwl_mvm_tx_skb_°a
(
mvm
, 
skb
, 
°a
) == 0))

804 i‡(
	`likñy
(
	`iwl_mvm_tx_skb_n⁄_°a
(
mvm
, 
skb
) == 0))

808 
	`õì80211_‰ì_txskb
(
mvm
->
hw
, 
skb
);

809 
	}
}

811 
	$iwl_mvm_mac_tx
(
õì80211_hw
 *
hw
,

812 
õì80211_tx_c⁄åﬁ
 *
c⁄åﬁ
, 
sk_buff
 *
skb
)

814 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

815 
õì80211_°a
 *
°a
 = 
c⁄åﬁ
->sta;

816 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

817 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

818 
boﬁ
 
offch™√l
 = 
	`IEEE80211_SKB_CB
(
skb
)->
Êags
 &

819 
IEEE80211_TX_CTL_TX_OFFCHAN
;

820 
u32
 
lök_id
 = 
	`u32_gë_bôs
(
öfo
->
c⁄åﬁ
.
Êags
,

821 
IEEE80211_TX_CTRL_MLO_LINK
);

822 
õì80211_°a
 *
tmp_°a
 = 
°a
;

824 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

826 i‡(
	`iwl_mvm_is_ødio_kûÀd
(
mvm
)) {

827 
	`IWL_DEBUG_DROP
(
mvm
, "Dropping - RF/CT KILL\n");

828 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

829 
dr›
;

832 i‡(
offch™√l
 &&

833 !
	`ã°_bô
(
IWL_MVM_STATUS_ROC_RUNNING
, &
mvm
->
°©us
) &&

834 !
	`ã°_bô
(
IWL_MVM_STATUS_ROC_AUX_RUNNING
, &
mvm
->
°©us
)) {

835 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

836 
dr›
;

843 i‡(
	`õì80211_is_mgmt
(
hdr
->
‰ame_c⁄åﬁ
))

844 
°a
 = 
NULL
;

847 i‡(!
°a
 && 
öfo
->
c⁄åﬁ
.
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

848 !
offch™√l
) {

849 
iwl_mvm_vif
 *
mvmvif
 =

850 
	`iwl_mvm_vif_‰om_mac80211
(
öfo
->
c⁄åﬁ
.
vif
);

851 
u8
 
≠_°a_id
 = 
	`READ_ONCE
(
mvmvif
->
deÊök
.ap_sta_id);

853 i‡(
≠_°a_id
 < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
) {

855 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
≠_°a_id
]);

856 i‡(
	`IS_ERR_OR_NULL
(
°a
)) {

857 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

858 
dr›
;

863 i‡(
tmp_°a
 && !
°a
 && 
lök_id
 !
IEEE80211_LINK_UNSPECIFIED
 &&

864 !
	`õì80211_is_¥obe_ª•
(
hdr
->
‰ame_c⁄åﬁ
)) {

866 
õì80211_lök_°a
 *
lök_°a
 =

867 
	`rcu_dîe„ªn˚
(
tmp_°a
->
lök
[
lök_id
]);

868 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

869 
	`rcu_dîe„ªn˚
(
öfo
->
c⁄åﬁ
.
vif
->
lök_c⁄f
[
lök_id
]);

870 
õì80211_mgmt
 *
mgmt
;

872 i‡(
	`WARN_ON
(!
lök_°a
 || !
lök_c⁄f
)) {

873 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

874 
dr›
;

878 
mgmt
 = (*)
hdr
;

879 
	`mem˝y
(
mgmt
->
da
, 
lök_°a
->
addr
, 
ETH_ALEN
);

880 
	`mem˝y
(
mgmt
->
ß
, 
lök_c⁄f
->
addr
, 
ETH_ALEN
);

881 
	`mem˝y
(
mgmt
->
bssid
, 
lök_c⁄f
->bssid, 
ETH_ALEN
);

884 
	`iwl_mvm_tx_skb
(
mvm
, 
skb
, 
°a
);

885 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

887 
dr›
:

888 
	`õì80211_‰ì_txskb
(
hw
, 
skb
);

889 
	}
}

891 
	$iwl_mvm_mac_ôxq_xmô
(
õì80211_hw
 *
hw
, 
õì80211_txq
 *
txq
)

893 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

894 
iwl_mvm_txq
 *
mvmtxq
 = 
	`iwl_mvm_txq_‰om_mac80211
(
txq
);

895 
sk_buff
 *
skb
 = 
NULL
;

916 i‡(
	`©omic_„tch_add_u∆ess
(&
mvmtxq
->
tx_ªque°
, 1, 2))

919 
	`rcu_ªad_lock
();

921 
	`likñy
(!
	`ã°_bô
(
IWL_MVM_TXQ_STATE_STOP_FULL
,

922 &
mvmtxq
->
°©e
) &&

923 !
	`ã°_bô
(
IWL_MVM_TXQ_STATE_STOP_REDIRECT
,

924 &
mvmtxq
->
°©e
) &&

925 !
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
))) {

926 
skb
 = 
	`õì80211_tx_dequeue
(
hw
, 
txq
);

928 i‡(!
skb
) {

929 i‡(
txq
->
°a
)

930 
	`IWL_DEBUG_TX
(
mvm
,

932 
txq
->
°a
->
addr
,

933 
txq
->
tid
);

937 
	`iwl_mvm_tx_skb
(
mvm
, 
skb
, 
txq
->
°a
);

939 } 
	`©omic_dec_ªtu∫
(&
mvmtxq
->
tx_ªque°
));

940 
	`rcu_ªad_u∆ock
();

941 
	}
}

943 
	$iwl_mvm_mac_wake_tx_queue
(
õì80211_hw
 *
hw
,

944 
õì80211_txq
 *
txq
)

946 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

947 
iwl_mvm_txq
 *
mvmtxq
 = 
	`iwl_mvm_txq_‰om_mac80211
(
txq
);

949 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

951 i‡(
	`likñy
(
	`ã°_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
)) ||

952 !
txq
->
°a
) {

953 
	`iwl_mvm_mac_ôxq_xmô
(
hw
, 
txq
);

954 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

962 
	`•ö_lock_bh
(&
mvm
->
add_°ªam_lock
);

964 i‡(
	`li°_em±y
(&
mvmtxq
->
li°
) &&

966 !
	`ã°_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
)) {

967 
	`li°_add_èû
(&
mvmtxq
->
li°
, &
mvm
->
add_°ªam_txqs
);

968 
	`scheduÀ_w‹k
(&
mvm
->
add_°ªam_wk
);

970 
	`•ö_u∆ock_bh
(&
mvm
->
add_°ªam_lock
);

971 
	}
}

973 
	#CHECK_BA_TRIGGER
(
_mvm
, 
_åig
, 
_tid_bm
, 
_tid
, 
_fmt
...) \

975 i‡(!(
	`À16_to_˝u
(
_tid_bm
Ë& 
	`BIT
(
_tid
))) \

977 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&(
_mvm
)->
fwπ
, 
_åig
, 
_fmt
); \

978 } 0)

	)

981 
	$iwl_mvm_ampdu_check_åiggî
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

982 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 
rx_ba_s¢
,

983 
õì80211_ampdu_mlme_a˘i⁄
 
a˘i⁄
)

985 
iwl_fw_dbg_åiggî_év
 *
åig
;

986 
iwl_fw_dbg_åiggî_ba
 *
ba_åig
;

988 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

989 
FW_DBG_TRIGGER_BA
);

990 i‡(!
åig
)

993 
ba_åig
 = (*)
åig
->
d©a
;

995 
a˘i⁄
) {

996 
IEEE80211_AMPDU_TX_OPERATIONAL
: {

997 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

998 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

1000 
	`CHECK_BA_TRIGGER
(
mvm
, 
åig
, 
ba_åig
->
tx_ba_°¨t
, 
tid
,

1002 
°a
->
addr
, 
tid
, 
tid_d©a
->
s¢
);

1005 
IEEE80211_AMPDU_TX_STOP_CONT
:

1006 
	`CHECK_BA_TRIGGER
(
mvm
, 
åig
, 
ba_åig
->
tx_ba_°›
, 
tid
,

1008 
°a
->
addr
, 
tid
);

1010 
IEEE80211_AMPDU_RX_START
:

1011 
	`CHECK_BA_TRIGGER
(
mvm
, 
åig
, 
ba_åig
->
rx_ba_°¨t
, 
tid
,

1013 
°a
->
addr
, 
tid
, 
rx_ba_s¢
);

1015 
IEEE80211_AMPDU_RX_STOP
:

1016 
	`CHECK_BA_TRIGGER
(
mvm
, 
åig
, 
ba_åig
->
rx_ba_°›
, 
tid
,

1018 
°a
->
addr
, 
tid
);

1023 
	}
}

1025 
	$iwl_mvm_mac_ampdu_a˘i⁄
(
õì80211_hw
 *
hw
,

1026 
õì80211_vif
 *
vif
,

1027 
õì80211_ampdu_∑øms
 *
∑øms
)

1029 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1030 
ªt
;

1031 
õì80211_°a
 *
°a
 = 
∑øms
->sta;

1032 
õì80211_ampdu_mlme_a˘i⁄
 
a˘i⁄
 = 
∑øms
->action;

1033 
u16
 
tid
 = 
∑øms
->tid;

1034 
u16
 *
s¢
 = &
∑øms
->ssn;

1035 
u16
 
buf_size
 = 
∑øms
->buf_size;

1036 
boﬁ
 
amsdu
 = 
∑øms
->amsdu;

1037 
u16
 
timeout
 = 
∑øms
->timeout;

1039 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1041 
	`IWL_DEBUG_HT
(
mvm
, "A-MPDUáction onáddr %pMÅid %d:áction %d\n",

1042 
°a
->
addr
, 
tid
, 
a˘i⁄
);

1044 i‡(!(
mvm
->
nvm_d©a
->
sku_ˇp_11n_íabÀ
)) {

1045 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1046  -
EACCES
;

1049 
	`muãx_lock
(&
mvm
->
muãx
);

1051 
a˘i⁄
) {

1052 
IEEE80211_AMPDU_RX_START
:

1053 i‡(
	`iwl_mvm_vif_‰om_mac80211
(
vif
)->
deÊök
.
≠_°a_id
 ==

1054 
	`iwl_mvm_°a_‰om_mac80211
(
°a
)->
deÊök
.
°a_id
) {

1055 
iwl_mvm_vif
 *
mvmvif
;

1056 
u16
 
macid
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
)->
id
;

1057 
iwl_mvm_tcm_mac
 *
md©a
 = &
mvm
->
tcm
.
d©a
[
macid
];

1059 
md©a
->
›íed_rx_ba_£ssi⁄s
 = 
åue
;

1060 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1061 
	`ˇn˚l_dñayed_w‹k
(&
mvmvif
->
u≠sd_n⁄agg_dëe˘ed_wk
);

1063 i‡(!
	`iwl_íabÀ_rx_ampdu
()) {

1064 
ªt
 = -
EINVAL
;

1065 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1068 
ªt
 = 
	`iwl_mvm_°a_rx_agg
(
mvm
, 
°a
, 
tid
, *
s¢
, 
åue
, 
buf_size
,

1069 
timeout
);

1070 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1072 
IEEE80211_AMPDU_RX_STOP
:

1073 
ªt
 = 
	`iwl_mvm_°a_rx_agg
(
mvm
, 
°a
, 
tid
, 0, 
Ál£
, 
buf_size
,

1074 
timeout
);

1075 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1077 
IEEE80211_AMPDU_TX_START
:

1078 i‡(!
	`iwl_íabÀ_tx_ampdu
()) {

1079 
ªt
 = -
EINVAL
;

1080 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1083 
ªt
 = 
	`iwl_mvm_°a_tx_agg_°¨t
(
mvm
, 
vif
, 
°a
, 
tid
, 
s¢
);

1084 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1086 
IEEE80211_AMPDU_TX_STOP_CONT
:

1087 
ªt
 = 
	`iwl_mvm_°a_tx_agg_°›
(
mvm
, 
vif
, 
°a
, 
tid
);

1088 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1090 
IEEE80211_AMPDU_TX_STOP_FLUSH
:

1091 
IEEE80211_AMPDU_TX_STOP_FLUSH_CONT
:

1092 
ªt
 = 
	`iwl_mvm_°a_tx_agg_Êush
(
mvm
, 
vif
, 
°a
, 
tid
);

1093 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1095 
IEEE80211_AMPDU_TX_OPERATIONAL
:

1096 
ªt
 = 
	`iwl_mvm_°a_tx_agg_›î
(
mvm
, 
vif
, 
°a
, 
tid
,

1097 
buf_size
, 
amsdu
);

1098 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1101 
	`WARN_ON_ONCE
(1);

1102 
ªt
 = -
EINVAL
;

1103 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1107 i‡(!
ªt
) {

1108 
u16
 
rx_ba_s¢
 = 0;

1110 i‡(
a˘i⁄
 =
IEEE80211_AMPDU_RX_START
)

1111 
rx_ba_s¢
 = *
s¢
;

1113 
	`iwl_mvm_ampdu_check_åiggî
(
mvm
, 
vif
, 
°a
, 
tid
,

1114 
rx_ba_s¢
, 
a˘i⁄
);

1116 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1118 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1119  
ªt
;

1120 
	}
}

1122 
	$iwl_mvm_˛ónup_ôî©‹
(*
d©a
, 
u8
 *
mac
,

1123 
õì80211_vif
 *
vif
)

1125 
iwl_mvm
 *
mvm
 = 
d©a
;

1126 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1127 
iwl_¥obe_ª•_d©a
 *
¥obe_d©a
;

1128 
lök_id
;

1130 
mvmvif
->
u∂ﬂded
 = 
Ál£
;

1132 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

1133 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, &
mvmvif
->
time_evít_d©a
);

1134 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1136 
	`mem£t
(&
mvmvif
->
bf_d©a
, 0, (mvmvif->bf_data));

1137 
mvmvif
->
≠_°a
 = 
NULL
;

1139 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
lök_id
) {

1140 
mvmvif
->
lök
[
lök_id
]->
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

1141 
mvmvif
->
lök
[
lök_id
]->
fw_lök_id
 = 
IWL_MVM_FW_LINK_ID_INVALID
;

1142 
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
 = 
NULL
;

1143 
mvmvif
->
lök
[
lök_id
]->
a˘ive
 = 0;

1144 
mvmvif
->
lök
[
lök_id
]->
igtk
 = 
NULL
;

1147 
¥obe_d©a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
,

1148 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1149 i‡(
¥obe_d©a
)

1150 
	`k‰ì_rcu
(
¥obe_d©a
, 
rcu_hód
);

1151 
	`RCU_INIT_POINTER
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
, 
NULL
);

1152 
	}
}

1154 
	$iwl_mvm_ª°¨t_˛ónup
(
iwl_mvm
 *
mvm
)

1156 
	`iwl_mvm_°›_devi˚
(
mvm
);

1158 
mvm
->
cur_aid
 = 0;

1160 
mvm
->
sˇn_°©us
 = 0;

1161 
mvm
->
ps_dißbÀd
 = 
Ál£
;

1162 
mvm
->
rfkûl_ß„_öô_d⁄e
 = 
Ál£
;

1165 
	`iwl_mvm_˛ónup_roc_ã
(
mvm
);

1166 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
mvm
->
hw
);

1168 
	`iwl_mvm_·m_ª°¨t
(
mvm
);

1174 
	`õì80211_ôî©e_öãrÁ˚s
(
mvm
->
hw
, 0, 
iwl_mvm_˛ónup_ôî©‹
, mvm);

1176 
mvm
->
p2p_devi˚_vif
 = 
NULL
;

1178 
	`iwl_mvm_ª£t_phy_˘xts
(
mvm
);

1179 
	`mem£t
(
mvm
->
fw_key_èbÀ
, 0, (mvm->fw_key_table));

1180 
	`mem£t
(&
mvm
->
œ°_bt_nŸif
, 0, (mvm->last_bt_notif));

1181 
	`mem£t
(&
mvm
->
œ°_bt_ci_cmd
, 0, (mvm->last_bt_ci_cmd));

1183 
	`õì80211_wake_queues
(
mvm
->
hw
);

1185 
mvm
->
rx_ba_£ssi⁄s
 = 0;

1186 
mvm
->
fwπ
.
dump
.
c⁄f
 = 
FW_DBG_INVALID
;

1187 
mvm
->
m⁄ô‹_⁄
 = 
Ál£
;

1188 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1189 
mvm
->
bóc⁄_öje˘_a˘ive
 = 
Ál£
;

1193 
	`iwl_mvm_accu_ødio_°©s
(
mvm
);

1194 
	}
}

1196 
	$__iwl_mvm_mac_°¨t
(
iwl_mvm
 *
mvm
)

1198 
ªt
;

1200 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1202 
ªt
 = 
	`iwl_mvm_mei_gë_ow√rshù
(
mvm
);

1203 i‡(
ªt
)

1204  
ªt
;

1206 i‡(
mvm
->
mei_nvm_d©a
) {

1208 
	`k‰ì
(
mvm
->
mei_nvm_d©a
);

1209 
mvm
->
mei_nvm_d©a
 = 
NULL
;

1219 
mvm
->
ãmp_nvm_d©a
 = mvm->
nvm_d©a
;

1220 
mvm
->
nvm_d©a
 = 
NULL
;

1223 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
, &
mvm
->
°©us
)) {

1228 
	`£t_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
);

1229 
	`˛ór_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
, &
mvm
->
°©us
);

1231 
	`iwl_mvm_ª°¨t_˛ónup
(
mvm
);

1233 
ªt
 = 
	`iwl_mvm_up
(
mvm
);

1235 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_POST_INIT
,

1236 
NULL
);

1237 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
IWL_FW_INI_TIME_POINT_PERIODIC
,

1238 
NULL
);

1240 
mvm
->
œ°_ª£t_‹_ªsume_time_jiffõs
 = 
jiffõs
;

1242 i‡(
ªt
 && 
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

1247 
	`˛ór_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
);

1250  
ªt
;

1251 
	}
}

1253 
	$iwl_mvm_mac_°¨t
(
õì80211_hw
 *
hw
)

1255 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1256 
ªt
;

1258 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1260 
	`muãx_lock
(&
mvm
->
muãx
);

1263 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
, &
mvm
->
°©us
) &&

1264 
iwlwifi_mod_∑øms
.
fw_ª°¨t
) {

1269 
	`£t_bô
(
IWL_MVM_STATUS_STARTING
, &
mvm
->
°©us
);

1272 
ªt
 = 
	`__iwl_mvm_mac_°¨t
(
mvm
);

1273 
	`˛ór_bô
(
IWL_MVM_STATUS_STARTING
, &
mvm
->
°©us
);

1275 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1277 
	`iwl_mvm_mei_£t_sw_rfkûl_°©e
(
mvm
);

1279 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1280  
ªt
;

1281 
	}
}

1283 
	$iwl_mvm_ª°¨t_com∂ëe
(
iwl_mvm
 *
mvm
)

1285 
ªt
;

1287 
	`muãx_lock
(&
mvm
->
muãx
);

1289 
	`˛ór_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
);

1291 
ªt
 = 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
åue
, 
NULL
);

1292 i‡(
ªt
)

1293 
	`IWL_ERR
(
mvm
, "FailedÅo update quotasáfterÑestart (%d)\n",

1294 
ªt
);

1296 
	`iwl_mvm_£nd_ªcovîy_cmd
(
mvm
, 
ERROR_RECOVERY_END_OF_RECOVERY
);

1302 
	`iwl_mvm_ã¨down_tdls_≥îs
(
mvm
);

1304 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1305 
	}
}

1307 
	$iwl_mvm_mac_ªc⁄fig_com∂ëe
(
õì80211_hw
 *
hw
,

1308 
õì80211_ªc⁄fig_ty≥
 
ªc⁄fig_ty≥
)

1310 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1312 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1314 
ªc⁄fig_ty≥
) {

1315 
IEEE80211_RECONFIG_TYPE_RESTART
:

1316 
	`iwl_mvm_ª°¨t_com∂ëe
(
mvm
);

1317 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1319 
IEEE80211_RECONFIG_TYPE_SUSPEND
:

1320 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1323 
	}
}

1325 
	$__iwl_mvm_mac_°›
(
iwl_mvm
 *
mvm
)

1327 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1329 
	`iwl_mvm_·m_öôüt‹_smoŸh_°›
(
mvm
);

1334 
	`mem£t
(&
mvm
->
accu_ødio_°©s
, 0, (mvm->accu_radio_stats));

1338 i‡(!
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
))

1339 
	`iwl_mvm_rm_aux_°a
(
mvm
);

1341 
	`iwl_mvm_°›_devi˚
(
mvm
);

1343 
	`iwl_mvm_async_h™dÀrs_purge
(
mvm
);

1353 i‡(
	`ã°_™d_˛ór_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) ||

1354 
	`ã°_™d_˛ór_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
,

1355 &
mvm
->
°©us
))

1356 
	`õì80211_ôî©e_öãrÁ˚s
(
mvm
->
hw
, 0,

1357 
iwl_mvm_˛ónup_ôî©‹
, 
mvm
);

1362 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
)) {

1363 
i
;

1365 
i
 = 0; i < 
mvm
->
max_sˇns
; i++) {

1366 i‡(
	`WARN_ONCE
(
mvm
->
sˇn_uid_°©us
[
i
],

1368 
i
))

1369 
mvm
->
sˇn_uid_°©us
[
i
] = 0;

1372 
	}
}

1374 
	$iwl_mvm_mac_°›
(
õì80211_hw
 *
hw
)

1376 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1378 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1380 
	`Êush_w‹k
(&
mvm
->
async_h™dÀrs_wk
);

1381 
	`Êush_w‹k
(&
mvm
->
add_°ªam_wk
);

1391 
	`˛ór_bô
(
IWL_MVM_STATUS_FIRMWARE_RUNNING
, &
mvm
->
°©us
);

1393 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvm
->
cs_tx_unblock_dw‹k
);

1394 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvm
->
sˇn_timeout_dw‹k
);

1400 
	`Êush_w‹k
(&
mvm
->
roc_d⁄e_wk
);

1402 
	`iwl_mvm_mei_£t_sw_rfkûl_°©e
(
mvm
);

1404 
	`muãx_lock
(&
mvm
->
muãx
);

1405 
	`__iwl_mvm_mac_°›
(
mvm
);

1406 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1412 
	`ˇn˚l_w‹k_sync
(&
mvm
->
async_h™dÀrs_wk
);

1413 
	`wùhy_w‹k_ˇn˚l
(
hw
->
wùhy
, &
mvm
->
async_h™dÀrs_wùhy_wk
);

1414 
	}
}

1416 
iwl_mvm_phy_˘xt
 *
	$iwl_mvm_gë_‰ì_phy_˘xt
(
iwl_mvm
 *
mvm
)

1418 
u16
 
i
;

1420 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1422 
i
 = 0; i < 
NUM_PHY_CTX
; i++)

1423 i‡(!
mvm
->
phy_˘xts
[
i
].
ªf
)

1424  &
mvm
->
phy_˘xts
[
i
];

1426 
	`IWL_ERR
(
mvm
, "Noávailable PHY context\n");

1427  
NULL
;

1428 
	}
}

1430 
	$iwl_mvm_£t_tx_powî
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1431 
s16
 
tx_powî
)

1433 
u32
 
cmd_id
 = 
REDUCE_TX_POWER_CMD
;

1434 
Àn
;

1435 
iwl_dev_tx_powî_cmd
 
cmd
 = {

1436 .
comm⁄
.
£t_mode
 = 
	`˝u_to_À32
(
IWL_TX_POWER_MODE_SET_MAC
),

1437 .
comm⁄
.
mac_c⁄ãxt_id
 =

1438 
	`˝u_to_À32
(
	`iwl_mvm_vif_‰om_mac80211
(
vif
)->
id
),

1439 .
comm⁄
.
pwr_ª°ri˘i⁄
 = 
	`˝u_to_À16
(8 * 
tx_powî
),

1441 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

1442 
IWL_FW_CMD_VER_UNKNOWN
);

1444 i‡(
tx_powî
 =
IWL_DEFAULT_MAX_TX_POWER
)

1445 
cmd
.
comm⁄
.
pwr_ª°ri˘i⁄
 = 
	`˝u_to_À16
(
IWL_DEV_MAX_TX_POWER
);

1447 i‡(
cmd_vî
 == 7)

1448 
Àn
 = (
cmd
.
v7
);

1449 i‡(
cmd_vî
 == 6)

1450 
Àn
 = (
cmd
.
v6
);

1451 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1452 
IWL_UCODE_TLV_API_REDUCE_TX_POWER
))

1453 
Àn
 = (
cmd
.
v5
);

1454 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1455 
IWL_UCODE_TLV_CAPA_TX_POWER_ACK
))

1456 
Àn
 = (
cmd
.
v4
);

1458 
Àn
 = (
cmd
.
v3
);

1461 
Àn
 +(
cmd
.
comm⁄
);

1463  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
Àn
, &
cmd
);

1464 
	}
}

1466 
	$iwl_mvm_po°_ch™√l_swôch
(
õì80211_hw
 *
hw
,

1467 
õì80211_vif
 *
vif
,

1468 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

1470 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1471 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1472 
ªt
;

1474 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1476 
	`muãx_lock
(&
mvm
->
muãx
);

1478 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

1479 
iwl_mvm_°a
 *
mvm°a
;

1480 
lök_id
 = 
lök_c⁄f
->link_id;

1481 
u8
 
≠_°a_id
 = 
mvmvif
->
lök
[
lök_id
]->ap_sta_id;

1483 
mvmvif
->
cß_b˙_≥ndög
 = 
Ál£
;

1484 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 
≠_°a_id
);

1486 i‡(
	`WARN_ON
(!
mvm°a
)) {

1487 
ªt
 = -
EIO
;

1488 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1489 
out_u∆ock
;

1492 
	`iwl_mvm_°a_modify_dißbÀ_tx
(
mvm
, 
mvm°a
, 
Ál£
);

1493 i‡(
mvm
->
mld_≠i_is_u£d
)

1494 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

1496 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
);

1498 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1499 
IWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
)) {

1500 
ªt
 = 
	`iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

1501 i‡(
ªt
) {

1502 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1503 
out_u∆ock
;

1506 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

1510 
mvmvif
->
ps_dißbÀd
 = 
Ál£
;

1512 
ªt
 = 
	`iwl_mvm_powî_upd©e_ps
(
mvm
);

1514 
out_u∆ock
:

1515 i‡(
mvmvif
->
cß_Áûed
)

1516 
ªt
 = -
EIO
;

1517 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1519 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1520  
ªt
;

1521 
	}
}

1523 
	$iwl_mvm_ab‹t_ch™√l_swôch
(
õì80211_hw
 *
hw
,

1524 
õì80211_vif
 *
vif
,

1525 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

1527 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1528 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1529 
iwl_ch™_swôch_ã_cmd
 
cmd
 = {

1530 .
mac_id
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

1531 
mvmvif
->
cﬁ‹
)),

1532 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
),

1535 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1541 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
MAC_CONF_GROUP
,

1542 
CHANNEL_SWITCH_ERROR_NOTIF
, 0)) {

1543 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1547 
	`IWL_DEBUG_MAC80211
(
mvm
, "Ab‹àCSA o¿ma¯%d\n", 
mvmvif
->
id
);

1549 
	`muãx_lock
(&
mvm
->
muãx
);

1550 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1551 
IWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
))

1552 
	`iwl_mvm_ªmove_cß_≥riod
(
mvm
, 
vif
);

1554 
	`WARN_ON
(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1555 
	`WIDE_ID
(
MAC_CONF_GROUP
,

1556 
CHANNEL_SWITCH_TIME_EVENT_CMD
),

1557 0, (
cmd
), &cmd));

1558 
mvmvif
->
cß_Áûed
 = 
åue
;

1559 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1562 
	`iwl_mvm_po°_ch™√l_swôch
(
hw
, 
vif
, &vif->
bss_c⁄f
);

1563 
	}
}

1565 
	$iwl_mvm_ch™√l_swôch_disc⁄√˘_wk
(
w‹k_°ru˘
 *
wk
)

1567 
iwl_mvm_vif
 *
mvmvif
;

1568 
õì80211_vif
 *
vif
;

1570 
mvmvif
 = 
	`c⁄èöî_of
(
wk
, 
iwl_mvm_vif
, 
cß_w‹k
.
w‹k
);

1571 
vif
 = 
	`c⁄èöî_of
((*)
mvmvif
, 
õì80211_vif
, 
drv_¥iv
);

1574 
	`õì80211_chswôch_d⁄e
(
vif
, 
Ál£
, 0);

1575 
	}
}

1577 
u8


1578 
	$iwl_mvm_ch™def_gë_¥im¨y_80
(
cfg80211_ch™_def
 *
ch™def
)

1580 
d©a_°¨t
;

1581 
c⁄åﬁ_°¨t
;

1582 
bw
;

1584 i‡(
ch™def
->
width
 =
NL80211_CHAN_WIDTH_320
)

1585 
bw
 = 320;

1586 i‡(
ch™def
->
width
 =
NL80211_CHAN_WIDTH_160
)

1587 
bw
 = 160;

1592 
d©a_°¨t
 = 
ch™def
->
˚¡î_‰eq1
 - 
bw
 / 2;

1594 
c⁄åﬁ_°¨t
 = 
ch™def
->
ch™
->
˚¡î_‰eq
 - 10;

1596  (
c⁄åﬁ_°¨t
 - 
d©a_°¨t
) / 80;

1597 
	}
}

1599 
	$iwl_mvm_Æloc_bˇ°_mˇ°_°a
(
iwl_mvm
 *
mvm
,

1600 
õì80211_vif
 *
vif
)

1602 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1603 
ªt
;

1605 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1607 
ªt
 = 
	`iwl_mvm_Æloc_bˇ°_°a
(
mvm
, 
vif
);

1608 i‡(
ªt
) {

1609 
	`IWL_ERR
(
mvm
, "FailedÅoállocate bcast sta\n");

1610  
ªt
;

1616  
	`iwl_mvm_Æloˇã_öt_°a
(
mvm
, &
mvmvif
->
deÊök
.
mˇ°_°a
, 0,

1617 
vif
->
ty≥
,

1618 
IWL_STA_MULTICAST
);

1619 
	}
}

1621 
	$iwl_mvm_mac_add_öãrÁ˚
(
õì80211_hw
 *
hw
,

1622 
õì80211_vif
 *
vif
)

1624 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1625 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1626 
ªt
;

1627 
i
;

1629 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1631 
	`muãx_lock
(&
mvm
->
muãx
);

1633 
mvmvif
->
mvm
 = mvm;

1636 
mvmvif
->
deÊök
.
fw_lök_id
 = 
IWL_MVM_FW_LINK_ID_INVALID
;

1637 
mvmvif
->
deÊök
.
a˘ive
 = 0;

1638 
mvmvif
->
lök
[0] = &mvmvif->
deÊök
;

1640 
ªt
 = 
	`iwl_mvm_£t_lök_m≠pög
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

1641 i‡(
ªt
) {

1642 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1643 
out
;

1653 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

1654 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
)

1655 
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
.
accu_num_bóc⁄s
 +=

1656 
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
.
num_bóc⁄s
;

1659 
ªt
 = 
	`iwl_mvm_mac_˘xt_öô
(
mvm
, 
vif
);

1660 i‡(
ªt
) {

1661 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1662 
out
;

1665 
	`rcu_assign_poöãr
(
mvm
->
vif_id_to_mac
[
mvmvif
->
id
], 
vif
);

1668 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_NAN
) {

1669 
ªt
 = 0;

1670 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1671 
out
;

1685 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1686 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

1687 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

1688 
	`iwl_mvm_vif_dbgfs_add_lök
(
mvm
, 
vif
);

1689 
ªt
 = 0;

1690 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1691 
out
;

1694 
mvmvif
->
„©uªs
 |
hw
->
√tdev_„©uªs
;

1696 
ªt
 = 
	`iwl_mvm_mac_˘xt_add
(
mvm
, 
vif
);

1697 i‡(
ªt
) {

1698 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1699 
out_u∆ock
;

1702 
ªt
 = 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

1703 i‡(
ªt
) {

1704 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1705 
out_ªmove_mac
;

1709 
ªt
 = 
	`iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

1710 i‡(
ªt
) {

1711 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1712 
out_ªmove_mac
;

1715 i‡(!
mvm
->
bf_Ælowed_vif
 &&

1716 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
p2p
) {

1717 
mvm
->
bf_Ælowed_vif
 = 
mvmvif
;

1718 
vif
->
drivî_Êags
 |
IEEE80211_VIF_BEACON_FILTER
 |

1719 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
;

1722 i‡(
vif
->
p2p
 || 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
PHY_CONTEXT_CMD
, 1) < 5)

1723 
vif
->
drivî_Êags
 |
IEEE80211_VIF_IGNORE_OFDMA_WIDER_BW
;

1725 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
)

1726 
mvm
->
p2p_devi˚_vif
 = 
vif
;

1728 
	`iwl_mvm_tcm_add_vif
(
mvm
, 
vif
);

1729 
	`INIT_DELAYED_WORK
(&
mvmvif
->
cß_w‹k
,

1730 
iwl_mvm_ch™√l_swôch_disc⁄√˘_wk
);

1732 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

1733 
mvm
->
m⁄ô‹_⁄
 = 
åue
;

1734 
mvm
->
m⁄ô‹_p80
 =

1735 
	`iwl_mvm_ch™def_gë_¥im¨y_80
(&
vif
->
bss_c⁄f
.
ch™ªq
.
›î
);

1738 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

1739 
	`iwl_mvm_vif_dbgfs_add_lök
(
mvm
, 
vif
);

1741 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

1742 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
p2p
 &&

1743 !
mvm
->
csme_vif
 && mvm->
mei_ªgi°îed
) {

1744 
	`iwl_mei_£t_nic_öfo
(
vif
->
addr
, 
mvm
->
nvm_d©a
->
hw_addr
);

1745 
	`iwl_mei_£t_√tdev
(
	`õì80211_vif_to_wdev
(
vif
)->
√tdev
);

1746 
mvm
->
csme_vif
 = 
vif
;

1749 
out
:

1750 i‡(!
ªt
 && (
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1751 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
))

1752 
ªt
 = 
	`iwl_mvm_Æloc_bˇ°_mˇ°_°a
(
mvm
, 
vif
);

1754 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1755 
out_u∆ock
;

1757 
out_ªmove_mac
:

1758 
mvmvif
->
deÊök
.
phy_˘xt
 = 
NULL
;

1759 
	`iwl_mvm_mac_˘xt_ªmove
(
mvm
, 
vif
);

1760 
out_u∆ock
:

1761 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1763 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1764  
ªt
;

1765 
	}
}

1767 
	$iwl_mvm_¥ï¨e_mac_ªmovÆ
(
iwl_mvm
 *
mvm
,

1768 
õì80211_vif
 *
vif
)

1770 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

1776 
	`Êush_w‹k
(&
mvm
->
roc_d⁄e_wk
);

1778 
	}
}

1784 
boﬁ
 
	$iwl_mvm_mac_ªmove_öãrÁ˚_comm⁄
(
õì80211_hw
 *
hw
,

1785 
õì80211_vif
 *
vif
)

1787 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1788 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1789 
iwl_¥obe_ª•_d©a
 *
¥obe_d©a
;

1791 
	`iwl_mvm_¥ï¨e_mac_ªmovÆ
(
mvm
, 
vif
);

1793 i‡(!(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1794 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
))

1795 
	`iwl_mvm_tcm_rm_vif
(
mvm
, 
vif
);

1797 
	`muãx_lock
(&
mvm
->
muãx
);

1799 i‡(
vif
 =
mvm
->
csme_vif
) {

1800 
	`iwl_mei_£t_√tdev
(
NULL
);

1801 
mvm
->
csme_vif
 = 
NULL
;

1804 
¥obe_d©a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
,

1805 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1806 
	`RCU_INIT_POINTER
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
, 
NULL
);

1807 i‡(
¥obe_d©a
)

1808 
	`k‰ì_rcu
(
¥obe_d©a
, 
rcu_hód
);

1810 i‡(
mvm
->
bf_Ælowed_vif
 =
mvmvif
) {

1811 
mvm
->
bf_Ælowed_vif
 = 
NULL
;

1812 
vif
->
drivî_Êags
 &~(
IEEE80211_VIF_BEACON_FILTER
 |

1813 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
);

1816 i‡(
vif
->
bss_c⁄f
.
·m_ª•⁄dî
)

1817 
	`mem£t
(&
mvm
->
·m_ª•_°©s
, 0, (mvm->ftm_resp_stats));

1819 
	`iwl_mvm_vif_dbgfs_rm_lök
(
mvm
, 
vif
);

1825 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1826 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

1827 #ifde‡
CONFIG_NL80211_TESTMODE


1828 i‡(
vif
 =
mvm
->
nﬂ_vif
) {

1829 
mvm
->
nﬂ_vif
 = 
NULL
;

1830 
mvm
->
nﬂ_duøti⁄
 = 0;

1833  
åue
;

1836 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

1837  
Ál£
;

1838 
	}
}

1840 
	$iwl_mvm_mac_ªmove_öãrÁ˚
(
õì80211_hw
 *
hw
,

1841 
õì80211_vif
 *
vif
)

1843 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1844 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1846 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1848 i‡(
	`iwl_mvm_mac_ªmove_öãrÁ˚_comm⁄
(
hw
, 
vif
)) {

1849 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1850 
out
;

1858 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

1859 i‡(
mvmvif
->
deÊök
.
phy_˘xt
) {

1860 
	`iwl_mvm_phy_˘xt_uƒef
(
mvm
, 
mvmvif
->
deÊök
.
phy_˘xt
);

1861 
mvmvif
->
deÊök
.
phy_˘xt
 = 
NULL
;

1863 
mvm
->
p2p_devi˚_vif
 = 
NULL
;

1866 
	`iwl_mvm_un£t_lök_m≠pög
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

1867 
	`iwl_mvm_mac_˘xt_ªmove
(
mvm
, 
vif
);

1869 
	`RCU_INIT_POINTER
(
mvm
->
vif_id_to_mac
[
mvmvif
->
id
], 
NULL
);

1871 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
)

1872 
mvm
->
m⁄ô‹_⁄
 = 
Ál£
;

1874 
out
:

1875 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

1876 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

1877 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, &
mvmvif
->
deÊök
.
mˇ°_°a
);

1878 
	`iwl_mvm_dóŒoc_bˇ°_°a
(
mvm
, 
vif
);

1881 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1882 
	}
}

1884 
	siwl_mvm_mc_ôî_d©a
 {

1885 
iwl_mvm
 *
	mmvm
;

1886 
	mp‹t_id
;

1889 
	$iwl_mvm_mc_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

1890 
õì80211_vif
 *
vif
)

1892 
iwl_mvm_mc_ôî_d©a
 *
d©a
 = 
_d©a
;

1893 
iwl_mvm
 *
mvm
 = 
d©a
->mvm;

1894 
iwl_mˇ°_fûãr_cmd
 *
cmd
 = 
mvm
->
mˇ°_fûãr_cmd
;

1895 
iwl_ho°_cmd
 
hcmd
 = {

1896 .
id
 = 
MCAST_FILTER_CMD
,

1897 .
Êags
 = 
CMD_ASYNC
,

1898 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

1900 
ªt
, 
Àn
;

1903 i‡(
	`WARN_ON_ONCE
(
d©a
->
p‹t_id
 >
MAX_PORT_ID_NUM
))

1906 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 ||

1907 !
vif
->
cfg
.
assoc
)

1910 
cmd
->
p‹t_id
 = 
d©a
->port_id++;

1911 
	`mem˝y
(
cmd
->
bssid
, 
vif
->
bss_c⁄f
.bssid, 
ETH_ALEN
);

1912 
Àn
 = 
	`roundup
((*
cmd
Ë+ cmd->
cou¡
 * 
ETH_ALEN
, 4);

1914 
hcmd
.
Àn
[0] =Üen;

1915 
hcmd
.
d©a
[0] = 
cmd
;

1917 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

1918 i‡(
ªt
)

1919 
	`IWL_ERR
(
mvm
, "mˇ° fûã∏cmdÉº‹.Ñë=%d\n", 
ªt
);

1920 
	}
}

1922 
	$iwl_mvm_ªˇlc_mu…iˇ°
(
iwl_mvm
 *
mvm
)

1924 
iwl_mvm_mc_ôî_d©a
 
ôî_d©a
 = {

1925 .
mvm
 = mvm,

1927 
ªt
;

1929 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1931 i‡(
	`WARN_ON_ONCE
(!
mvm
->
mˇ°_fûãr_cmd
))

1934 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

1935 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

1936 
iwl_mvm_mc_iÁ˚_ôî©‹
, &
ôî_d©a
);

1950 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ECHO_CMD
, 0, 0, 
NULL
);

1951 i‡(
ªt
)

1952 
	`IWL_ERR
(
mvm
, "FailedÅo synchronize multicast groups update\n");

1953 
	}
}

1955 
u64
 
	$iwl_mvm_¥ï¨e_mu…iˇ°
(
õì80211_hw
 *
hw
,

1956 
√tdev_hw_addr_li°
 *
mc_li°
)

1958 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1959 
iwl_mˇ°_fûãr_cmd
 *
cmd
;

1960 
√tdev_hw_addr
 *
addr
;

1961 
addr_cou¡
;

1962 
boﬁ
 
∑ss_Æl
;

1963 
Àn
;

1965 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

1967 
addr_cou¡
 = 
	`√tdev_hw_addr_li°_cou¡
(
mc_li°
);

1968 
∑ss_Æl
 = 
addr_cou¡
 > 
MAX_MCAST_FILTERING_ADDRESSES
 ||

1969 
IWL_MVM_FW_MCAST_FILTER_PASS_ALL
;

1970 i‡(
∑ss_Æl
)

1971 
addr_cou¡
 = 0;

1973 
Àn
 = 
	`roundup
((*
cmd
Ë+ 
addr_cou¡
 * 
ETH_ALEN
, 4);

1974 
cmd
 = 
	`kzÆloc
(
Àn
, 
GFP_ATOMIC
);

1975 i‡(!
cmd
) {

1976 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1980 i‡(
∑ss_Æl
) {

1981 
cmd
->
∑ss_Æl
 = 1;

1982 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1983  (
u64
)()
cmd
;

1986 
	`√tdev_hw_addr_li°_f‹_óch
(
addr
, 
mc_li°
) {

1987 
	`IWL_DEBUG_MAC80211
(
mvm
, "mcastáddr (%d): %pM\n",

1988 
cmd
->
cou¡
, 
addr
->addr);

1989 
	`mem˝y
(&
cmd
->
addr_li°
[cmd->
cou¡
 * 
ETH_ALEN
],

1990 
addr
->addr, 
ETH_ALEN
);

1991 
cmd
->
cou¡
++;

1994 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

1995  (
u64
)()
cmd
;

1996 
	}
}

1998 
	$iwl_mvm_c⁄figuª_fûãr
(
õì80211_hw
 *
hw
,

1999 
ch™ged_Êags
,

2000 *
tŸÆ_Êags
, 
u64
 
mu…iˇ°
)

2002 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

2003 
iwl_mˇ°_fûãr_cmd
 *
cmd
 = (*)()
mu…iˇ°
;

2005 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

2007 
	`muãx_lock
(&
mvm
->
muãx
);

2010 
	`k‰ì
(
mvm
->
mˇ°_fûãr_cmd
);

2011 
mvm
->
mˇ°_fûãr_cmd
 = 
cmd
;

2013 i‡(!
cmd
) {

2014 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

2015 
out
;

2018 i‡(
ch™ged_Êags
 & 
FIF_ALLMULTI
)

2019 
cmd
->
∑ss_Æl
 = !!(*
tŸÆ_Êags
 & 
FIF_ALLMULTI
);

2021 i‡(
cmd
->
∑ss_Æl
)

2022 
cmd
->
cou¡
 = 0;

2024 
	`iwl_mvm_ªˇlc_mu…iˇ°
(
mvm
);

2025 
out
:

2026 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2027 *
tŸÆ_Êags
 = 0;

2028 
	}
}

2030 
	$iwl_mvm_c⁄fig_iÁ˚_fûãr
(
õì80211_hw
 *
hw
,

2031 
õì80211_vif
 *
vif
,

2032 
fûãr_Êags
,

2033 
ch™ged_Êags
)

2035 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

2037 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

2040 i‡(!(
ch™ged_Êags
 & 
FIF_PROBE_REQ
)) {

2041 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

2046 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || !vif->
cfg
.
assoc
 ||

2047 !
vif
->
p2p
) {

2048 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

2052 
	`muãx_lock
(&
mvm
->
muãx
);

2053 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
);

2054 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2055 
	}
}

2057 
	$iwl_mvm_upd©e_mu_groups
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2059 
iwl_mu_group_mgmt_cmd
 
cmd
 = {};

2061 
	`mem˝y
(
cmd
.
membîshù_°©us
, 
vif
->
bss_c⁄f
.
mu_group
.
membîshù
,

2062 
WLAN_MEMBERSHIP_LEN
);

2063 
	`mem˝y
(
cmd
.
u£r_posôi⁄
, 
vif
->
bss_c⁄f
.
mu_group
.
posôi⁄
,

2064 
WLAN_USER_POSITION_LEN
);

2066  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

2067 
	`WIDE_ID
(
DATA_PATH_GROUP
,

2068 
UPDATE_MU_GROUPS_CMD
),

2069 0, (
cmd
), &cmd);

2070 
	}
}

2072 
	$iwl_mvm_mu_mimo_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

2073 
õì80211_vif
 *
vif
)

2075 i‡(
vif
->
bss_c⁄f
.
mu_mimo_ow√r
) {

2076 
iwl_mu_group_mgmt_nŸif
 *
nŸif
 = 
_d©a
;

2083 
	`õì80211_upd©e_mu_groups
(
vif
, 0,

2084 (
u8
 *)&
nŸif
->
membîshù_°©us
,

2085 (
u8
 *)&
nŸif
->
u£r_posôi⁄
);

2087 
	}
}

2089 
	$iwl_mvm_mu_mimo_gΩ_nŸif
(
iwl_mvm
 *
mvm
,

2090 
iwl_rx_cmd_buf„r
 *
rxb
)

2092 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2093 
iwl_mu_group_mgmt_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

2095 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

2096 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

2097 
iwl_mvm_mu_mimo_iÁ˚_ôî©‹
, 
nŸif
);

2098 
	}
}

2100 
u8
 
	$iwl_mvm_he_gë_µe_vÆ
(
u8
 *
µe
, u8 
µe_pos_bô
)

2102 
u8
 
byã_num
 = 
µe_pos_bô
 / 8;

2103 
u8
 
bô_num
 = 
µe_pos_bô
 % 8;

2104 
u8
 
ªsidue_bôs
;

2105 
u8
 
ªs
;

2107 i‡(
bô_num
 <= 5)

2108  (
µe
[
byã_num
] >> 
bô_num
) &

2109 (
	`BIT
(
IEEE80211_PPE_THRES_INFO_PPET_SIZE
) - 1);

2117 
ªsidue_bôs
 = 8 - 
bô_num
;

2119 
ªs
 = (
µe
[
byã_num
 + 1] &

2120 (
	`BIT
(
IEEE80211_PPE_THRES_INFO_PPET_SIZE
 - 
ªsidue_bôs
) - 1)) <<

2121 
ªsidue_bôs
;

2122 
ªs
 +(
µe
[
byã_num
] >> 
bô_num
Ë& (
	`BIT
(
ªsidue_bôs
) - 1);

2124  
ªs
;

2125 
	}
}

2127 
	$iwl_mvm_∑r£_µe
(
iwl_mvm
 *
mvm
,

2128 
iwl_he_pkt_ext_v2
 *
pkt_ext
, 
u8
 
nss
,

2129 
u8
 
ru_ödex_bôm≠
, u8 *
µe
, u8 
µe_pos_bô
,

2130 
boﬁ
 
öhîô™˚
)

2132 
i
;

2140 i‡(
nss
 > 
MAX_HE_SUPP_NSS
) {

2141 
	`IWL_DEBUG_INFO
(
mvm
, "GŸ NSS = %d -ÅrimmögÅÿ%d\n", 
nss
,

2142 
MAX_HE_SUPP_NSS
);

2143 
nss
 = 
MAX_HE_SUPP_NSS
;

2146 
i
 = 0; i < 
nss
; i++) {

2147 
u8
 
ru_ödex_tmp
 = 
ru_ödex_bôm≠
 << 1;

2148 
u8
 
low_th
 = 
IWL_HE_PKT_EXT_NONE
, 
high_th
 = IWL_HE_PKT_EXT_NONE;

2149 
u8
 
bw
;

2151 
bw
 = 0;

2152 
bw
 < 
	`ARRAY_SIZE
(
pkt_ext
->
pkt_ext_qam_th
[
i
]);

2153 
bw
++) {

2154 
ru_ödex_tmp
 >>= 1;

2162 i‡(!(
ru_ödex_tmp
 & 1)) {

2163 i‡(
öhîô™˚
)

2164 
£t_thªshﬁds
;

2169 
high_th
 = 
	`iwl_mvm_he_gë_µe_vÆ
(
µe
, 
µe_pos_bô
);

2170 
µe_pos_bô
 +
IEEE80211_PPE_THRES_INFO_PPET_SIZE
;

2171 
low_th
 = 
	`iwl_mvm_he_gë_µe_vÆ
(
µe
, 
µe_pos_bô
);

2172 
µe_pos_bô
 +
IEEE80211_PPE_THRES_INFO_PPET_SIZE
;

2174 
£t_thªshﬁds
:

2175 
pkt_ext
->
pkt_ext_qam_th
[
i
][
bw
][0] = 
low_th
;

2176 
pkt_ext
->
pkt_ext_qam_th
[
i
][
bw
][1] = 
high_th
;

2179 
	}
}

2181 
	$iwl_mvm_£t_pkt_ext_‰om_he_µe
(
iwl_mvm
 *
mvm
,

2182 
õì80211_lök_°a
 *
lök_°a
,

2183 
iwl_he_pkt_ext_v2
 *
pkt_ext
,

2184 
boﬁ
 
öhîô™˚
)

2186 
u8
 
nss
 = (
lök_°a
->
he_ˇp
.
µe_thªs
[0] &

2187 
IEEE80211_PPE_THRES_NSS_MASK
) + 1;

2188 
u8
 *
µe
 = &
lök_°a
->
he_ˇp
.
µe_thªs
[0];

2189 
u8
 
ru_ödex_bôm≠
 =

2190 
	`u8_gë_bôs
(*
µe
,

2191 
IEEE80211_PPE_THRES_RU_INDEX_BITMASK_MASK
);

2193 
u8
 
µe_pos_bô
 = 
IEEE80211_HE_PPE_THRES_INFO_HEADER_SIZE
;

2195 
	`iwl_mvm_∑r£_µe
(
mvm
, 
pkt_ext
, 
nss
, 
ru_ödex_bôm≠
, 
µe
, 
µe_pos_bô
,

2196 
öhîô™˚
);

2197 
	}
}

2200 
	$iwl_mvm_£t_pkt_ext_‰om_nomöÆ_∑ddög
(
iwl_he_pkt_ext_v2
 *
pkt_ext
,

2201 
u8
 
nomöÆ_∑ddög
)

2203 
low_th
 = -1;

2204 
high_th
 = -1;

2205 
i
;

2208 
nomöÆ_∑ddög
) {

2209 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_0US
:

2210 
low_th
 = 
IWL_HE_PKT_EXT_NONE
;

2211 
high_th
 = 
IWL_HE_PKT_EXT_NONE
;

2213 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_8US
:

2214 
low_th
 = 
IWL_HE_PKT_EXT_BPSK
;

2215 
high_th
 = 
IWL_HE_PKT_EXT_NONE
;

2217 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_16US
:

2218 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_20US
:

2219 
low_th
 = 
IWL_HE_PKT_EXT_NONE
;

2220 
high_th
 = 
IWL_HE_PKT_EXT_BPSK
;

2224 i‡(
low_th
 < 0 || 
high_th
 < 0)

2225  -
EINVAL
;

2228 
i
 = 0; i < 
MAX_HE_SUPP_NSS
; i++) {

2229 
u8
 
bw
;

2231 
bw
 = 0;

2232 
bw
 < 
	`ARRAY_SIZE
(
pkt_ext
->
pkt_ext_qam_th
[
i
]);

2233 
bw
++) {

2234 
pkt_ext
->
pkt_ext_qam_th
[
i
][
bw
][0] = 
low_th
;

2235 
pkt_ext
->
pkt_ext_qam_th
[
i
][
bw
][1] = 
high_th
;

2240 
	}
}

2242 
	$iwl_mvm_gë_›timÆ_µe_öfo
(
iwl_he_pkt_ext_v2
 *
pkt_ext
,

2243 
u8
 
nomöÆ_∑ddög
)

2245 
i
;

2247 
i
 = 0; i < 
MAX_HE_SUPP_NSS
; i++) {

2248 
u8
 
bw
;

2250 
bw
 = 0; bw < 
	`ARRAY_SIZE
(
pkt_ext
->
pkt_ext_qam_th
[
i
]);

2251 
bw
++) {

2252 
u8
 *
qam_th
 = &
pkt_ext
->
pkt_ext_qam_th
[
i
][
bw
][0];

2254 i‡(
nomöÆ_∑ddög
 >

2255 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_8US
 &&

2256 
qam_th
[1] =
IWL_HE_PKT_EXT_NONE
)

2257 
qam_th
[1] = 
IWL_HE_PKT_EXT_4096QAM
;

2258 i‡(
nomöÆ_∑ddög
 ==

2259 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_8US
 &&

2260 
qam_th
[0] =
IWL_HE_PKT_EXT_NONE
 &&

2261 
qam_th
[1] =
IWL_HE_PKT_EXT_NONE
)

2262 
qam_th
[0] = 
IWL_HE_PKT_EXT_4096QAM
;

2265 
	}
}

2268 
	$iwl_mvm_£t_°a_pkt_ext
(
iwl_mvm
 *
mvm
,

2269 
õì80211_lök_°a
 *
lök_°a
,

2270 
iwl_he_pkt_ext_v2
 *
pkt_ext
)

2272 
u8
 
nomöÆ_∑ddög
;

2273 
i
, 
ªt
 = 0;

2275 i‡(
	`WARN_ON
(!
lök_°a
))

2276  -
EINVAL
;

2281 
	`mem£t
(
pkt_ext
, 
IWL_HE_PKT_EXT_NONE
,

2282 (
iwl_he_pkt_ext_v2
));

2284 i‡(
lök_°a
->
eht_ˇp
.
has_eht
) {

2285 
nomöÆ_∑ddög
 =

2286 
	`u8_gë_bôs
(
lök_°a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[5],

2287 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_MASK
);

2292 i‡(
lök_°a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[5] &

2293 
IEEE80211_EHT_PHY_CAP5_PPE_THRESHOLD_PRESENT
) {

2294 
u8
 
nss
 = (
lök_°a
->
eht_ˇp
.
eht_µe_thªs
[0] &

2295 
IEEE80211_EHT_PPE_THRES_NSS_MASK
) + 1;

2296 
u8
 *
µe
 = &
lök_°a
->
eht_ˇp
.
eht_µe_thªs
[0];

2297 
u8
 
ru_ödex_bôm≠
 =

2298 
	`u16_gë_bôs
(*
µe
,

2299 
IEEE80211_EHT_PPE_THRES_RU_INDEX_BITMASK_MASK
);

2301 
u8
 
µe_pos_bô
 = 
IEEE80211_EHT_PPE_THRES_INFO_HEADER_SIZE
;

2303 
	`iwl_mvm_∑r£_µe
(
mvm
, 
pkt_ext
, 
nss
, 
ru_ödex_bôm≠
,

2304 
µe
, 
µe_pos_bô
, 
åue
);

2308 } i‡(
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[6] &

2309 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
) {

2315 
	`iwl_mvm_£t_pkt_ext_‰om_he_µe
(
mvm
, 
lök_°a
, 
pkt_ext
,

2316 
åue
);

2322 
	`iwl_mvm_gë_›timÆ_µe_öfo
(
pkt_ext
, 
nomöÆ_∑ddög
);

2328 
ªt
 = 
	`iwl_mvm_£t_pkt_ext_‰om_nomöÆ_∑ddög
(
pkt_ext
,

2329 
nomöÆ_∑ddög
);

2331 } i‡(
lök_°a
->
he_ˇp
.
has_he
) {

2333 i‡(
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[6] &

2334 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
) {

2335 
	`iwl_mvm_£t_pkt_ext_‰om_he_µe
(
mvm
, 
lök_°a
, 
pkt_ext
,

2336 
Ál£
);

2341 
nomöÆ_∑ddög
 =

2342 
	`u8_gë_bôs
(
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[9],

2343 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_MASK
);

2344 i‡(
nomöÆ_∑ddög
 !
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_RESERVED
)

2345 
ªt
 = 
	`iwl_mvm_£t_pkt_ext_‰om_nomöÆ_∑ddög
(
pkt_ext
,

2346 
nomöÆ_∑ddög
);

2350 
i
 = 0; i < 
MAX_HE_SUPP_NSS
; i++) {

2351 
bw
;

2353 
bw
 = 0;

2354 
bw
 < 
	`ARRAY_SIZE
(*
pkt_ext
->
pkt_ext_qam_th
[
i
]);

2355 
bw
++) {

2356 
u8
 *
qam_th
 =

2357 &
pkt_ext
->
pkt_ext_qam_th
[
i
][
bw
][0];

2359 
	`IWL_DEBUG_HT
(
mvm
,

2361 
i
, 
bw
, 
qam_th
[0], qam_th[1]);

2364  
ªt
;

2365 
	}
}

2371 
boﬁ
 
	$iwl_mvm_£t_fw_mu_edˇ_∑øms
(
iwl_mvm
 *
mvm
,

2372 c⁄° 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
,

2373 
iwl_he_backoff_c⁄f
 *
åig_ba£d_txf
)

2375 
i
;

2377 
boﬁ
 
mu_edˇ_íabÀd
 = 
åue
;

2379 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

2380 c⁄° 
õì80211_he_mu_edˇ_∑øm_ac_ªc
 *
mu_edˇ
 =

2381 &
lök_öfo
->
queue_∑øms
[
i
].
mu_edˇ_∑øm_ªc
;

2382 
u8
 
ac
 = 
	`iwl_mvm_mac80211_ac_to_ucode_ac
(
i
);

2384 i‡(!
lök_öfo
->
queue_∑øms
[
i
].
mu_edˇ
) {

2385 
mu_edˇ_íabÀd
 = 
Ál£
;

2389 
åig_ba£d_txf
[
ac
].
cwmö
 =

2390 
	`˝u_to_À16
(
mu_edˇ
->
ecw_mö_max
 & 0xf);

2391 
åig_ba£d_txf
[
ac
].
cwmax
 =

2392 
	`˝u_to_À16
((
mu_edˇ
->
ecw_mö_max
 & 0xf0) >> 4);

2393 
åig_ba£d_txf
[
ac
].
aif¢
 =

2394 
	`˝u_to_À16
(
mu_edˇ
->
aif¢
 & 0xf);

2395 
åig_ba£d_txf
[
ac
].
mu_time
 =

2396 
	`˝u_to_À16
(
mu_edˇ
->
mu_edˇ_timî
);

2399  
mu_edˇ_íabÀd
;

2400 
	}
}

2402 
boﬁ
 
	$iwl_mvm_is_nic_ack_íabÀd
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2404 c⁄° 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

2405 c⁄° 
õì80211_°a_he_ˇp
 *
own_he_ˇp
 = 
NULL
;

2410 
sb™d
 = 
mvm
->
hw
->
wùhy
->
b™ds
[
NL80211_BAND_2GHZ
];

2411 
own_he_ˇp
 = 
	`õì80211_gë_he_i·y≥_ˇp_vif
(
sb™d
, 
vif
);

2413  (
own_he_ˇp
 && (own_he_ˇp->
he_ˇp_ñem
.
mac_ˇp_öfo
[2] &

2414 
IEEE80211_HE_MAC_CAP2_ACK_EN
));

2415 
	}
}

2417 
__À32
 
	$iwl_mvm_gë_°a_htc_Êags
(
õì80211_°a
 *
°a
,

2418 
õì80211_lök_°a
 *
lök_°a
)

2420 
u8
 *
mac_ˇp_öfo
 =

2421 &
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[0];

2422 
__À32
 
htc_Êags
 = 0;

2424 i‡(
mac_ˇp_öfo
[0] & 
IEEE80211_HE_MAC_CAP0_HTC_HE
)

2425 
htc_Êags
 |
	`˝u_to_À32
(
IWL_HE_HTC_SUPPORT
);

2426 i‡((
mac_ˇp_öfo
[1] & 
IEEE80211_HE_MAC_CAP1_LINK_ADAPTATION
) ||

2427 (
mac_ˇp_öfo
[2] & 
IEEE80211_HE_MAC_CAP2_LINK_ADAPTATION
)) {

2428 
u8
 
lök_ad≠
 =

2429 ((
mac_ˇp_öfo
[2] &

2430 
IEEE80211_HE_MAC_CAP2_LINK_ADAPTATION
) << 1) +

2431 (
mac_ˇp_öfo
[1] &

2432 
IEEE80211_HE_MAC_CAP1_LINK_ADAPTATION
);

2434 i‡(
lök_ad≠
 == 2)

2435 
htc_Êags
 |=

2436 
	`˝u_to_À32
(
IWL_HE_HTC_LINK_ADAP_UNSOLICITED
);

2437 i‡(
lök_ad≠
 == 3)

2438 
htc_Êags
 |
	`˝u_to_À32
(
IWL_HE_HTC_LINK_ADAP_BOTH
);

2440 i‡(
mac_ˇp_öfo
[2] & 
IEEE80211_HE_MAC_CAP2_BSR
)

2441 
htc_Êags
 |
	`˝u_to_À32
(
IWL_HE_HTC_BSR_SUPP
);

2442 i‡(
mac_ˇp_öfo
[3] & 
IEEE80211_HE_MAC_CAP3_OMI_CONTROL
)

2443 
htc_Êags
 |
	`˝u_to_À32
(
IWL_HE_HTC_OMI_SUPP
);

2444 i‡(
mac_ˇp_öfo
[4] & 
IEEE80211_HE_MAC_CAP4_BQR
)

2445 
htc_Êags
 |
	`˝u_to_À32
(
IWL_HE_HTC_BQR_SUPP
);

2447  
htc_Êags
;

2448 
	}
}

2450 
	$iwl_mvm_cfg_he_°a
(
iwl_mvm
 *
mvm
,

2451 
õì80211_vif
 *
vif
, 
u8
 
°a_id
)

2453 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2454 
iwl_he_°a_c⁄ãxt_cmd_v3
 
°a_˘xt_cmd
 = {

2455 .
°a_id
 = sta_id,

2456 .
tid_limô
 = 
IWL_MAX_TID_COUNT
,

2457 .
bss_cﬁ‹
 = 
vif
->
bss_c⁄f
.
he_bss_cﬁ‹
.
cﬁ‹
,

2458 .
htc_åig_ba£d_pkt_ext
 = 
vif
->
bss_c⁄f
.htc_trig_based_pkt_ext,

2459 .
‰ame_time_πs_th
 =

2460 
	`˝u_to_À16
(
vif
->
bss_c⁄f
.
‰ame_time_πs_th
),

2462 
iwl_he_°a_c⁄ãxt_cmd_v2
 
°a_˘xt_cmd_v2
 = {};

2463 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
STA_HE_CTXT_CMD
);

2464 
u8
 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
, 2);

2465 
size
;

2466 
õì80211_°a
 *
°a
;

2467 
u32
 
Êags
;

2468 
i
;

2469 *
cmd
;

2471 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_MBSSID_HE
))

2472 
vî
 = 1;

2474 
vî
) {

2477 
cmd
 = &
°a_˘xt_cmd_v2
;

2478 
size
 = (
iwl_he_°a_c⁄ãxt_cmd_v1
);

2481 
cmd
 = &
°a_˘xt_cmd_v2
;

2482 
size
 = (
iwl_he_°a_c⁄ãxt_cmd_v2
);

2485 
cmd
 = &
°a_˘xt_cmd
;

2486 
size
 = (
iwl_he_°a_c⁄ãxt_cmd_v3
);

2489 
	`IWL_ERR
(
mvm
, "bad STA_HE_CTXT_CMD vîsi⁄ %d\n", 
vî
);

2493 
	`rcu_ªad_lock
();

2495 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_˘xt_cmd
.
°a_id
]);

2496 i‡(
	`IS_ERR_OR_NULL
(
°a
)) {

2497 
	`rcu_ªad_u∆ock
();

2498 
	`WARN
(1, "Can't find STAÅo configure HE\n");

2502 i‡(!
°a
->
deÊök
.
he_ˇp
.
has_he
) {

2503 
	`rcu_ªad_u∆ock
();

2507 
Êags
 = 0;

2510 i‡(
mvmvif
->
deÊök
.
he_ru_2mhz_block
)

2511 
Êags
 |
STA_CTXT_HE_RU_2MHZ_BLOCK
;

2514 
°a_˘xt_cmd
.
htc_Êags
 = 
	`iwl_mvm_gë_°a_htc_Êags
(
°a
, &°a->
deÊök
);

2517 i‡(!
	`iwl_mvm_£t_°a_pkt_ext
(
mvm
, &
°a
->
deÊök
, &
°a_˘xt_cmd
.
pkt_ext
))

2518 
Êags
 |
STA_CTXT_HE_PACKET_EXT
;

2520 i‡(
°a
->
deÊök
.
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[2] &

2521 
IEEE80211_HE_MAC_CAP2_32BIT_BA_BITMAP
)

2522 
Êags
 |
STA_CTXT_HE_32BIT_BA_BITMAP
;

2524 i‡(
°a
->
deÊök
.
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[2] &

2525 
IEEE80211_HE_MAC_CAP2_ACK_EN
)

2526 
Êags
 |
STA_CTXT_HE_ACK_ENABLED
;

2528 
	`rcu_ªad_u∆ock
();

2530 i‡(
	`iwl_mvm_£t_fw_mu_edˇ_∑øms
(
mvm
, &
mvmvif
->
deÊök
,

2531 &
°a_˘xt_cmd
.
åig_ba£d_txf
[0]))

2532 
Êags
 |
STA_CTXT_HE_MU_EDCA_CW
;

2534 i‡(
vif
->
bss_c⁄f
.
u‹a_exi°s
) {

2535 
Êags
 |
STA_CTXT_HE_TRIG_RND_ALLOC
;

2537 
°a_˘xt_cmd
.
ønd_Æloc_ecwmö
 =

2538 
vif
->
bss_c⁄f
.
u‹a_ocw_ønge
 & 0x7;

2539 
°a_˘xt_cmd
.
ønd_Æloc_ecwmax
 =

2540 (
vif
->
bss_c⁄f
.
u‹a_ocw_ønge
 >> 3) & 0x7;

2543 i‡(!
	`iwl_mvm_is_nic_ack_íabÀd
(
mvm
, 
vif
))

2544 
Êags
 |
STA_CTXT_HE_NIC_NOT_ACK_ENABLED
;

2546 i‡(
vif
->
bss_c⁄f
.
n⁄å™smôãd
) {

2547 
Êags
 |
STA_CTXT_HE_REF_BSSID_VALID
;

2548 
	`ëhî_addr_c›y
(
°a_˘xt_cmd
.
ªf_bssid_addr
,

2549 
vif
->
bss_c⁄f
.
å™smôãr_bssid
);

2550 
°a_˘xt_cmd
.
max_bssid_ödiˇt‹
 =

2551 
vif
->
bss_c⁄f
.
bssid_ödiˇt‹
;

2552 
°a_˘xt_cmd
.
bssid_ödex
 = 
vif
->
bss_c⁄f
.bssid_index;

2553 
°a_˘xt_cmd
.
ema_≠
 = 
vif
->
bss_c⁄f
.ema_ap;

2554 
°a_˘xt_cmd
.
¥ofûe_≥riodicôy
 =

2555 
vif
->
bss_c⁄f
.
¥ofûe_≥riodicôy
;

2558 
°a_˘xt_cmd
.
Êags
 = 
	`˝u_to_À32
(flags);

2560 i‡(
vî
 < 3) {

2562 
	`BUILD_BUG_ON
(
	`off£tof
(
	`ty≥of
(
°a_˘xt_cmd
), 
pkt_ext
) !=

2563 
	`off£tof
(
	`ty≥of
(
°a_˘xt_cmd_v2
), 
pkt_ext
));

2564 
	`mem˝y
(&
°a_˘xt_cmd_v2
, &
°a_˘xt_cmd
,

2565 
	`off£tof
(
	`ty≥of
(
°a_˘xt_cmd
), 
pkt_ext
));

2568 
i
 = 0;

2569 
i
 < 
	`ARRAY_SIZE
(
°a_˘xt_cmd_v2
.
pkt_ext
.
pkt_ext_qam_th
);

2570 
i
++) {

2571 
u8
 
bw
;

2573 
bw
 = 0;

2574 
bw
 < 
	`ARRAY_SIZE
(
°a_˘xt_cmd_v2
.
pkt_ext
.
pkt_ext_qam_th
[
i
]);

2575 
bw
++) {

2576 
	`BUILD_BUG_ON
((
°a_˘xt_cmd
.
pkt_ext
.
pkt_ext_qam_th
[
i
][
bw
]) !=

2577 (
°a_˘xt_cmd_v2
.
pkt_ext
.
pkt_ext_qam_th
[
i
][
bw
]));

2579 
	`mem˝y
(&
°a_˘xt_cmd_v2
.
pkt_ext
.
pkt_ext_qam_th
[
i
][
bw
],

2580 &
°a_˘xt_cmd
.
pkt_ext
.
pkt_ext_qam_th
[
i
][
bw
],

2581 (
°a_˘xt_cmd
.
pkt_ext
.
pkt_ext_qam_th
[
i
][
bw
]));

2586 
	`BUILD_BUG_ON
((
°a_˘xt_cmd
) -

2587 
	`off£to„nd
(
	`ty≥of
(
°a_˘xt_cmd
), 
pkt_ext
) !=

2588 (
°a_˘xt_cmd_v2
) -

2589 
	`off£to„nd
(
	`ty≥of
(
°a_˘xt_cmd_v2
), 
pkt_ext
));

2590 
	`mem˝y
((
u8
 *)&
°a_˘xt_cmd_v2
 +

2591 
	`off£to„nd
(
	`ty≥of
(
°a_˘xt_cmd_v2
), 
pkt_ext
),

2592 (
u8
 *)&
°a_˘xt_cmd
 +

2593 
	`off£to„nd
(
	`ty≥of
(
°a_˘xt_cmd
), 
pkt_ext
),

2594 (
°a_˘xt_cmd
) -

2595 
	`off£to„nd
(
	`ty≥of
(
°a_˘xt_cmd
), 
pkt_ext
));

2596 
°a_˘xt_cmd_v2
.
ª£rved3
 = 0;

2599 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, 
size
, 
cmd
))

2600 
	`IWL_ERR
(
mvm
, "FailedÅo config FWÅo work HE!\n");

2601 
	}
}

2603 
	$iwl_mvm_¥Ÿe˘_assoc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2604 
u32
 
duøti⁄_ovîride
, 
lök_id
)

2606 
u32
 
duøti⁄
 = 
IWL_MVM_TE_SESSION_PROTECTION_MAX_TIME_MS
;

2607 
u32
 
mö_duøti⁄
 = 
IWL_MVM_TE_SESSION_PROTECTION_MIN_TIME_MS
;

2609 i‡(
duøti⁄_ovîride
 > 
duøti⁄
)

2610 
duøti⁄
 = 
duøti⁄_ovîride
;

2621 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2622 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
))

2623 
	`iwl_mvm_scheduÀ_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
, 900,

2624 
mö_duøti⁄
, 
Ál£
,

2625 
lök_id
);

2627 
	`iwl_mvm_¥Ÿe˘_£ssi⁄
(
mvm
, 
vif
, 
duøti⁄
,

2628 
mö_duøti⁄
, 500, 
Ál£
);

2629 
	}
}

2632 
	$iwl_mvm_bss_öfo_ch™ged_°©i⁄_assoc
(
iwl_mvm
 *
mvm
,

2633 
õì80211_vif
 *
vif
,

2634 
u64
 
ch™ges
)

2636 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2637 
ªt
;

2642 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

2643 (
ch™ges
 & 
BSS_CHANGED_MU_GROUPS
Ë&& 
vif
->
bss_c⁄f
.
mu_mimo_ow√r
) {

2644 
ªt
 = 
	`iwl_mvm_upd©e_mu_groups
(
mvm
, 
vif
);

2645 i‡(
ªt
)

2646 
	`IWL_ERR
(
mvm
,

2650 
	`iwl_mvm_ªˇlc_mu…iˇ°
(
mvm
);

2653 
mvmvif
->
bf_d©a
.
ave_bóc⁄_sig«l
 = 0;

2655 
	`iwl_mvm_bt_c€x_vif_ch™ge
(
mvm
);

2656 
	`iwl_mvm_upd©e_smps_⁄_a˘ive_löks
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_TT
,

2657 
IEEE80211_SMPS_AUTOMATIC
);

2658 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2659 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
))

2660 
	`iwl_mvm_c⁄fig_sˇn
(
mvm
);

2661 
	}
}

2665 
	$iwl_mvm_bss_öfo_ch™ged_°©i⁄_comm⁄
(
iwl_mvm
 *
mvm
,

2666 
õì80211_vif
 *
vif
,

2667 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

2668 
u64
 
ch™ges
)

2670 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2671 
ªt
;

2673 i‡(
ch™ges
 & 
BSS_CHANGED_BEACON_INFO
) {

2677 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

2679 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

2680 
	`WARN_ON
(
	`iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
));

2683 i‡(
ch™ges
 & (
BSS_CHANGED_PS
 | 
BSS_CHANGED_P2P_PS
 | 
BSS_CHANGED_QOS
 |

2687 
BSS_CHANGED_BEACON_INFO
)) {

2688 
ªt
 = 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

2689 i‡(
ªt
)

2690 
	`IWL_ERR
(
mvm
, "failedÅo updateÖower mode\n");

2693 i‡(
ch™ges
 & 
BSS_CHANGED_CQM
) {

2694 
	`IWL_DEBUG_MAC80211
(
mvm
, "cqm info_changed\n");

2696 
mvmvif
->
bf_d©a
.
œ°_cqm_evít
 = 0;

2697 i‡(
mvmvif
->
bf_d©a
.
bf_íabÀd
) {

2701 
ªt
 = 
	`iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

2702 i‡(
ªt
)

2703 
	`IWL_ERR
(
mvm
,

2708 i‡(
ch™ges
 & 
BSS_CHANGED_BANDWIDTH
)

2709 
	`iwl_mvm_upd©e_lök_smps
(
vif
, 
lök_c⁄f
);

2710 
	}
}

2712 
	$iwl_mvm_bss_öfo_ch™ged_°©i⁄
(
iwl_mvm
 *
mvm
,

2713 
õì80211_vif
 *
vif
,

2714 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

2715 
u64
 
ch™ges
)

2717 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2718 
ªt
;

2719 
i
;

2726 i‡(
ch™ges
 & 
BSS_CHANGED_ASSOC
 && 
vif
->
cfg
.
assoc
) {

2727 i‡((
vif
->
bss_c⁄f
.
he_suµ‹t
 &&

2728 !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
))

2729 
	`iwl_mvm_cfg_he_°a
(
mvm
, 
vif
, 
mvmvif
->
deÊök
.
≠_°a_id
);

2731 
	`iwl_mvm_mac_˘xt_ªˇlc_tsf_id
(
mvm
, 
vif
);

2735 i‡(
ch™ges
 & 
BSS_CHANGED_QOS
 && 
mvmvif
->
assocüãd
 &&

2736 
vif
->
cfg
.
assoc
 &&

2737 (
vif
->
bss_c⁄f
.
he_suµ‹t
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
))

2738 
	`iwl_mvm_cfg_he_°a
(
mvm
, 
vif
, 
mvmvif
->
deÊök
.
≠_°a_id
);

2746 i‡(
ch™ges
 & 
BSS_CHANGED_BSSID
 && !
mvmvif
->
assocüãd
)

2747 
	`mem˝y
(
mvmvif
->
deÊök
.
bssid
, 
bss_c⁄f
->bssid, 
ETH_ALEN
);

2749 
ªt
 = 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
mvmvif
->
deÊök
.
bssid
);

2750 i‡(
ªt
)

2751 
	`IWL_ERR
(
mvm
, "ÁûedÅÿupd©êMAC %pM\n", 
vif
->
addr
);

2754 
	`mem˝y
(
mvmvif
->
deÊök
.
bssid
, 
bss_c⁄f
->bssid, 
ETH_ALEN
);

2755 
mvmvif
->
assocüãd
 = 
vif
->
cfg
.
assoc
;

2757 i‡(
ch™ges
 & 
BSS_CHANGED_ASSOC
) {

2758 i‡(
vif
->
cfg
.
assoc
) {

2760 
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
åue
);

2761 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
)

2762 
	`mem£t
(&
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
, 0,

2763 (
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
));

2766 
ªt
 = 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
åue
, 
NULL
);

2767 i‡(
ªt
) {

2768 
	`IWL_ERR
(
mvm
, "failedÅo update quotas\n");

2772 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
,

2773 &
mvm
->
°©us
) &&

2774 !
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2775 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
)) {

2794 
u32
 
dur
 = (11 * 
vif
->
bss_c⁄f
.
bóc⁄_öt
) / 10;

2795 
	`iwl_mvm_¥Ÿe˘_£ssi⁄
(
mvm
, 
vif
, 
dur
, dur,

2796 5 * 
dur
, 
Ál£
);

2797 } i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
,

2798 &
mvm
->
°©us
) &&

2799 !
vif
->
bss_c⁄f
.
dtim_≥riod
) {

2810 
	`iwl_mvm_¥Ÿe˘_assoc
(
mvm
, 
vif
, 0, 0);

2813 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

2814 
	`iwl_mvm_powî_vif_assoc
(
mvm
, 
vif
);

2815 i‡(
vif
->
p2p
) {

2816 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
,

2817 
IWL_MVM_SMPS_REQ_PROT
,

2818 
IEEE80211_SMPS_DYNAMIC
, 0);

2820 } i‡(
mvmvif
->
deÊök
.
≠_°a_id
 !
IWL_MVM_INVALID_STA
) {

2821 
	`iwl_mvm_mei_ho°_dißssocüãd
(
mvm
);

2826 
ªt
 = 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

2827 
	`WARN_ONCE
(
ªt
 &&

2828 !
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
,

2829 &
mvm
->
°©us
),

2840 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
,

2841 &
mvm
->
°©us
)) {

2843 
	`iwl_mvm_£c_key_ªmove_≠
(
mvm
, 
vif
,

2844 &
mvmvif
->
deÊök
, 0);

2850 
ªt
 = 
	`iwl_mvm_rm_°a_id
(
mvm
, 
vif
,

2851 
mvmvif
->
deÊök
.
≠_°a_id
);

2852 i‡(
ªt
)

2853 
	`IWL_ERR
(
mvm
,

2856 
mvmvif
->
deÊök
.
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

2860 
ªt
 = 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

2861 i‡(
ªt
)

2862 
	`IWL_ERR
(
mvm
, "failedÅo update quotas\n");

2865 
ªt
 = 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
);

2866 i‡(
ªt
)

2867 
	`IWL_ERR
(
mvm
,

2869 
vif
->
addr
);

2872 
	`iwl_mvm_bss_öfo_ch™ged_°©i⁄_assoc
(
mvm
, 
vif
, 
ch™ges
);

2875 
	`iwl_mvm_bss_öfo_ch™ged_°©i⁄_comm⁄
(
mvm
, 
vif
, &vif->
bss_c⁄f
,

2876 
ch™ges
);

2877 
	}
}

2879 
boﬁ
 
	$iwl_mvm_°¨t_≠_ibss_comm⁄
(
õì80211_hw
 *
hw
,

2880 
õì80211_vif
 *
vif
,

2881 *
ªt
)

2883 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

2884 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2885 
i
;

2887 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2889 
mvmvif
->
≠_assoc_°a_cou¡
 = 0;

2892 
mvmvif
->
≠_ibss_a˘ive
 = 
åue
;

2895 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvmvif
->
≠_óæy_keys
); i++) {

2896 
õì80211_key_c⁄f
 *
key
 = 
mvmvif
->
≠_óæy_keys
[
i
];

2898 i‡(!
key
)

2901 
mvmvif
->
≠_óæy_keys
[
i
] = 
NULL
;

2903 *
ªt
 = 
	`__iwl_mvm_mac_£t_key
(
hw
, 
SET_KEY
, 
vif
, 
NULL
, 
key
);

2904 i‡(*
ªt
)

2905  
åue
;

2908 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && !vif->
p2p
) {

2909 
	`iwl_mvm_vif_£t_low_œãncy
(
mvmvif
, 
åue
,

2910 
LOW_LATENCY_VIF_TYPE
);

2911 
	`iwl_mvm_£nd_low_œãncy_cmd
(
mvm
, 
åue
, 
mvmvif
->
id
);

2915 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

2917  
Ál£
;

2918 
	}
}

2920 
	$iwl_mvm_°¨t_≠_ibss
(
õì80211_hw
 *
hw
,

2921 
õì80211_vif
 *
vif
,

2922 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

2924 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

2925 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2926 
ªt
;

2928 
	`muãx_lock
(&
mvm
->
muãx
);

2935 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

2936 
	`iwl_mvm_mac_˘xt_ªˇlc_tsf_id
(
mvm
, 
vif
);

2942 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 > 
IWL_DEVICE_FAMILY_22000
) {

2944 
ªt
 = 
	`iwl_mvm_mac_˘xt_add
(
mvm
, 
vif
);

2945 i‡(
ªt
)

2946 
out_u∆ock
;

2949 
ªt
 = 
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
);

2950 i‡(
ªt
)

2951 
out_u∆ock
;

2954 
ªt
 = 
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
);

2955 i‡(
ªt
)

2956 
out_u∆ock
;

2959 
ªt
 = 
	`iwl_mvm_mac_˘xt_add
(
mvm
, 
vif
);

2960 i‡(
ªt
)

2961 
out_u∆ock
;

2965 
ªt
 = 
	`iwl_mvm_bödög_add_vif
(
mvm
, 
vif
);

2966 i‡(
ªt
)

2967 
out_ªmove
;

2976 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
)) {

2977 
ªt
 = 
	`iwl_mvm_add_mˇ°_°a
(
mvm
, 
vif
);

2978 i‡(
ªt
)

2979 
out_unböd
;

2984 
ªt
 = 
	`iwl_mvm_£nd_add_bˇ°_°a
(
mvm
, 
vif
);

2985 i‡(
ªt
) {

2986 
	`iwl_mvm_rm_mˇ°_°a
(
mvm
, 
vif
);

2987 
out_unböd
;

2994 
ªt
 = 
	`iwl_mvm_£nd_add_bˇ°_°a
(
mvm
, 
vif
);

2995 i‡(
ªt
)

2996 
out_unböd
;

2997 
ªt
 = 
	`iwl_mvm_add_mˇ°_°a
(
mvm
, 
vif
);

2998 i‡(
ªt
) {

2999 
	`iwl_mvm_£nd_rm_bˇ°_°a
(
mvm
, 
vif
);

3000 
out_unböd
;

3004 i‡(
	`iwl_mvm_°¨t_≠_ibss_comm⁄
(
hw
, 
vif
, &
ªt
))

3005 
out_Áûed
;

3007 
ªt
 = 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

3008 i‡(
ªt
)

3009 
out_Áûed
;

3012 i‡(
vif
->
p2p
 && 
mvm
->
p2p_devi˚_vif
)

3013 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, mvm->
p2p_devi˚_vif
, 
Ál£
, 
NULL
);

3015 
	`iwl_mvm_bt_c€x_vif_ch™ge
(
mvm
);

3018 i‡(
	`iwl_mvm_phy_˘x_cou¡
(
mvm
) > 1)

3019 
	`iwl_mvm_ã¨down_tdls_≥îs
(
mvm
);

3021 
	`iwl_mvm_·m_ª°¨t_ª•⁄dî
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

3023 
out_u∆ock
;

3025 
out_Áûed
:

3026 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

3027 
mvmvif
->
≠_ibss_a˘ive
 = 
Ál£
;

3028 
	`iwl_mvm_£nd_rm_bˇ°_°a
(
mvm
, 
vif
);

3029 
	`iwl_mvm_rm_mˇ°_°a
(
mvm
, 
vif
);

3030 
out_unböd
:

3031 
	`iwl_mvm_bödög_ªmove_vif
(
mvm
, 
vif
);

3032 
out_ªmove
:

3033 
	`iwl_mvm_mac_˘xt_ªmove
(
mvm
, 
vif
);

3034 
out_u∆ock
:

3035 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3036  
ªt
;

3037 
	}
}

3039 
	$iwl_mvm_°¨t_≠
(
õì80211_hw
 *
hw
,

3040 
õì80211_vif
 *
vif
,

3041 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

3043 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3044 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3045  
	`iwl_mvm_°¨t_≠_ibss
(
hw
, 
vif
, 
lök_c⁄f
);

3046 
	}
}

3048 
	$iwl_mvm_°¨t_ibss
(
õì80211_hw
 *
hw
,

3049 
õì80211_vif
 *
vif
)

3051 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3052 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3053  
	`iwl_mvm_°¨t_≠_ibss
(
hw
, 
vif
, &vif->
bss_c⁄f
);

3054 
	}
}

3057 
	$iwl_mvm_°›_≠_ibss_comm⁄
(
iwl_mvm
 *
mvm
,

3058 
õì80211_vif
 *
vif
)

3060 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3062 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3064 
	`iwl_mvm_¥ï¨e_mac_ªmovÆ
(
mvm
, 
vif
);

3067 i‡(
	`rcu_ac˚ss_poöãr
(
mvm
->
cß_vif
Ë=
vif
) {

3068 
	`iwl_mvm_ªmove_time_evít
(
mvm
, 
mvmvif
,

3069 &
mvmvif
->
time_evít_d©a
);

3070 
	`RCU_INIT_POINTER
(
mvm
->
cß_vif
, 
NULL
);

3071 
mvmvif
->
cß_cou¡down
 = 
Ál£
;

3074 i‡(
	`rcu_ac˚ss_poöãr
(
mvm
->
cß_tx_blocked_vif
Ë=
vif
) {

3075 
	`RCU_INIT_POINTER
(
mvm
->
cß_tx_blocked_vif
, 
NULL
);

3076 
mvm
->
cß_tx_block_b˙_timeout
 = 0;

3079 
mvmvif
->
≠_ibss_a˘ive
 = 
Ál£
;

3080 
mvm
->
≠_œ°_bóc⁄_gp2
 = 0;

3082 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && !vif->
p2p
) {

3083 
	`iwl_mvm_vif_£t_low_œãncy
(
mvmvif
, 
Ál£
,

3084 
LOW_LATENCY_VIF_TYPE
);

3085 
	`iwl_mvm_£nd_low_œãncy_cmd
(
mvm
, 
Ál£
, 
mvmvif
->
id
);

3088 
	`iwl_mvm_bt_c€x_vif_ch™ge
(
mvm
);

3089 
	}
}

3091 
	$iwl_mvm_°›_≠_ibss
(
õì80211_hw
 *
hw
,

3092 
õì80211_vif
 *
vif
,

3093 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

3095 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3097 
	`muãx_lock
(&
mvm
->
muãx
);

3099 
	`iwl_mvm_°›_≠_ibss_comm⁄
(
mvm
, 
vif
);

3102 i‡(
vif
->
p2p
 && 
mvm
->
p2p_devi˚_vif
)

3103 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, mvm->
p2p_devi˚_vif
, 
Ál£
, 
NULL
);

3105 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

3107 
	`iwl_mvm_·m_ª•⁄dî_˛ór
(
mvm
, 
vif
);

3117 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
))

3118 
	`iwl_mvm_rm_mˇ°_°a
(
mvm
, 
vif
);

3119 
	`iwl_mvm_£nd_rm_bˇ°_°a
(
mvm
, 
vif
);

3120 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
))

3121 
	`iwl_mvm_rm_mˇ°_°a
(
mvm
, 
vif
);

3122 
	`iwl_mvm_bödög_ªmove_vif
(
mvm
, 
vif
);

3124 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

3126 
	`iwl_mvm_mac_˘xt_ªmove
(
mvm
, 
vif
);

3128 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3129 
	}
}

3131 
	$iwl_mvm_°›_≠
(
õì80211_hw
 *
hw
,

3132 
õì80211_vif
 *
vif
,

3133 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

3135 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3136 
	`iwl_mvm_°›_≠_ibss
(
hw
, 
vif
, 
lök_c⁄f
);

3137 
	}
}

3139 
	$iwl_mvm_°›_ibss
(
õì80211_hw
 *
hw
,

3140 
õì80211_vif
 *
vif
)

3142 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3143 
	`iwl_mvm_°›_≠_ibss
(
hw
, 
vif
, &vif->
bss_c⁄f
);

3144 
	}
}

3147 
	$iwl_mvm_bss_öfo_ch™ged_≠_ibss
(
iwl_mvm
 *
mvm
,

3148 
õì80211_vif
 *
vif
,

3149 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

3150 
u64
 
ch™ges
)

3152 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3155 i‡(!
mvmvif
->
≠_ibss_a˘ive
)

3158 i‡(
ch™ges
 & (
BSS_CHANGED_ERP_CTS_PROT
 | 
BSS_CHANGED_HT
 |

3159 
BSS_CHANGED_BANDWIDTH
 | 
BSS_CHANGED_QOS
) &&

3160 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
))

3161 
	`IWL_ERR
(
mvm
, "ÁûedÅÿupd©êMAC %pM\n", 
vif
->
addr
);

3164 i‡(
ch™ges
 & 
BSS_CHANGED_BEACON
 &&

3165 
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
vif
, &vif->
bss_c⁄f
))

3166 
	`IWL_WARN
(
mvm
, "Failed updating beacon data\n");

3168 i‡(
ch™ges
 & 
BSS_CHANGED_FTM_RESPONDER
) {

3169 
ªt
 = 
	`iwl_mvm_·m_°¨t_ª•⁄dî
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

3171 i‡(
ªt
)

3172 
	`IWL_WARN
(
mvm
, "FailedÅoÉnable FTMÑesponder (%d)\n",

3173 
ªt
);

3176 
	}
}

3178 
	$iwl_mvm_bss_öfo_ch™ged
(
õì80211_hw
 *
hw
,

3179 
õì80211_vif
 *
vif
,

3180 
õì80211_bss_c⁄f
 *
bss_c⁄f
,

3181 
u64
 
ch™ges
)

3183 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3185 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3187 
	`muãx_lock
(&
mvm
->
muãx
);

3189 i‡(
ch™ges
 & 
BSS_CHANGED_IDLE
 && !
vif
->
cfg
.
idÀ
)

3190 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_SCHED
, 
åue
);

3192 
vif
->
ty≥
) {

3193 
NL80211_IFTYPE_STATION
:

3194 
	`iwl_mvm_bss_öfo_ch™ged_°©i⁄
(
mvm
, 
vif
, 
bss_c⁄f
, 
ch™ges
);

3195 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3197 
NL80211_IFTYPE_AP
:

3198 
NL80211_IFTYPE_ADHOC
:

3199 
	`iwl_mvm_bss_öfo_ch™ged_≠_ibss
(
mvm
, 
vif
, 
bss_c⁄f
, 
ch™ges
);

3200 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3202 
NL80211_IFTYPE_MONITOR
:

3203 i‡(
ch™ges
 & 
BSS_CHANGED_MU_GROUPS
)

3204 
	`iwl_mvm_upd©e_mu_groups
(
mvm
, 
vif
);

3205 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3209 
	`WARN_ON_ONCE
(1);

3212 i‡(
ch™ges
 & 
BSS_CHANGED_TXPOWER
) {

3213 
	`IWL_DEBUG_CALIB
(
mvm
, "Changing TX PowerÅo %d dBm\n",

3214 
bss_c⁄f
->
txpowî
);

3215 
	`iwl_mvm_£t_tx_powî
(
mvm
, 
vif
, 
bss_c⁄f
->
txpowî
);

3218 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3219 
	}
}

3221 
	$iwl_mvm_mac_hw_sˇn
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

3222 
õì80211_sˇn_ªque°
 *
hw_ªq
)

3224 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3225 
ªt
;

3227 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3229 i‡(
hw_ªq
->
ªq
.
n_ch™√ls
 == 0 ||

3230 
hw_ªq
->
ªq
.
n_ch™√ls
 > 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
) {

3231 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3232  -
EINVAL
;

3235 
	`muãx_lock
(&
mvm
->
muãx
);

3236 
ªt
 = 
	`iwl_mvm_ªg_sˇn_°¨t
(
mvm
, 
vif
, &
hw_ªq
->
ªq
, &hw_ªq->
õs
);

3237 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3239 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3240  
ªt
;

3241 
	}
}

3243 
	$iwl_mvm_mac_ˇn˚l_hw_sˇn
(
õì80211_hw
 *
hw
,

3244 
õì80211_vif
 *
vif
)

3246 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3248 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3250 
	`muãx_lock
(&
mvm
->
muãx
);

3259 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_REGULAR
)

3260 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_REGULAR
, 
åue
);

3262 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3263 
	}
}

3266 
	$iwl_mvm_mac_Ælow_buf„ªd_‰ames
(
õì80211_hw
 *
hw
,

3267 
õì80211_°a
 *
°a
, 
u16
 
tids
,

3268 
num_‰ames
,

3269 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

3270 
boﬁ
 
m‹e_d©a
)

3272 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3274 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3277 
	`iwl_mvm_°a_modify_¶ìp_tx_cou¡
(
mvm
, 
°a
, 
ªas⁄
, 
num_‰ames
,

3278 
tids
, 
m‹e_d©a
, 
Ál£
);

3279 
	}
}

3282 
	$iwl_mvm_mac_ªÀa£_buf„ªd_‰ames
(
õì80211_hw
 *
hw
,

3283 
õì80211_°a
 *
°a
, 
u16
 
tids
,

3284 
num_‰ames
,

3285 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

3286 
boﬁ
 
m‹e_d©a
)

3288 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3290 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3293 
	`iwl_mvm_°a_modify_¶ìp_tx_cou¡
(
mvm
, 
°a
, 
ªas⁄
, 
num_‰ames
,

3294 
tids
, 
m‹e_d©a
, 
åue
);

3295 
	}
}

3297 
	$__iwl_mvm_mac_°a_nŸify
(
õì80211_hw
 *
hw
,

3298 
°a_nŸify_cmd
 
cmd
,

3299 
õì80211_°a
 *
°a
)

3301 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3302 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3303 
txqs
 = 0, 
tids
 = 0;

3304 
tid
;

3311 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

3314 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

3315 
tid
 = 0;Åid < 
	`ARRAY_SIZE
(
mvm°a
->
tid_d©a
);Åid++) {

3316 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

3318 i‡(
tid_d©a
->
txq_id
 =
IWL_MVM_INVALID_QUEUE
)

3321 
	`__£t_bô
(
tid_d©a
->
txq_id
, &
txqs
);

3323 i‡(
	`iwl_mvm_tid_queued
(
mvm
, 
tid_d©a
) == 0)

3326 
	`__£t_bô
(
tid
, &
tids
);

3329 
cmd
) {

3330 
STA_NOTIFY_SLEEP
:

3331 
	`f‹_óch_£t_bô
(
tid
, &
tids
, 
IWL_MAX_TID_COUNT
)

3332 
	`õì80211_°a_£t_buf„ªd
(
°a
, 
tid
, 
åue
);

3334 i‡(
txqs
)

3335 
	`iwl_å™s_‰ìze_txq_timî
(
mvm
->
å™s
, 
txqs
, 
åue
);

3342 
STA_NOTIFY_AWAKE
:

3343 i‡(
	`WARN_ON
(
mvm°a
->
deÊök
.
°a_id
 =
IWL_MVM_INVALID_STA
))

3346 i‡(
txqs
)

3347 
	`iwl_å™s_‰ìze_txq_timî
(
mvm
->
å™s
, 
txqs
, 
Ál£
);

3348 
	`iwl_mvm_°a_modify_ps_wake
(
mvm
, 
°a
);

3353 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

3354 
	}
}

3356 
	$iwl_mvm_mac_°a_nŸify
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

3357 
°a_nŸify_cmd
 
cmd
, 
õì80211_°a
 *
°a
)

3359 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3360 
	`__iwl_mvm_mac_°a_nŸify
(
hw
, 
cmd
, 
°a
);

3361 
	}
}

3363 
	$iwl_mvm_°a_pm_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

3365 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

3366 
iwl_mvm_pm_°©e_nŸifiˇti⁄
 *
nŸif
 = (*)
pkt
->
d©a
;

3367 
õì80211_°a
 *
°a
;

3368 
iwl_mvm_°a
 *
mvm°a
;

3369 
boﬁ
 
¶ìpög
 = (
nŸif
->
ty≥
 !
IWL_MVM_PM_EVENT_AWAKE
);

3371 i‡(
	`WARN_ON
(
nŸif
->
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
))

3374 
	`rcu_ªad_lock
();

3375 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
nŸif
->
°a_id
]);

3376 i‡(
	`WARN_ON
(
	`IS_ERR_OR_NULL
(
°a
))) {

3377 
	`rcu_ªad_u∆ock
();

3381 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3383 i‡(!
mvm°a
->
vif
 ||

3384 
mvm°a
->
vif
->
ty≥
 !
NL80211_IFTYPE_AP
) {

3385 
	`rcu_ªad_u∆ock
();

3389 i‡(
mvm°a
->
¶ìpög
 != sleeping) {

3390 
mvm°a
->
¶ìpög
 = sleeping;

3391 
	`__iwl_mvm_mac_°a_nŸify
(
mvm
->
hw
,

3392 
¶ìpög
 ? 
STA_NOTIFY_SLEEP
 : 
STA_NOTIFY_AWAKE
,

3393 
°a
);

3394 
	`õì80211_°a_ps_å™sôi⁄
(
°a
, 
¶ìpög
);

3397 i‡(
¶ìpög
) {

3398 
nŸif
->
ty≥
) {

3399 
IWL_MVM_PM_EVENT_AWAKE
:

3400 
IWL_MVM_PM_EVENT_ASLEEP
:

3402 
IWL_MVM_PM_EVENT_UAPSD
:

3403 
	`õì80211_°a_u≠sd_åiggî
(
°a
, 
IEEE80211_NUM_TIDS
);

3405 
IWL_MVM_PM_EVENT_PS_POLL
:

3406 
	`õì80211_°a_p•ﬁl
(
°a
);

3413 
	`rcu_ªad_u∆ock
();

3414 
	}
}

3416 
	$iwl_mvm_°a_¥e_rcu_ªmove
(
õì80211_hw
 *
hw
,

3417 
õì80211_vif
 *
vif
,

3418 
õì80211_°a
 *
°a
)

3420 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

3421 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3422 
lök_id
;

3424 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3436 
	`muãx_lock
(&
mvm
->
muãx
);

3437 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
mvm_°a
->
lök
);Üink_id++) {

3438 
iwl_mvm_lök_°a
 *
lök_°a
;

3439 
u32
 
°a_id
;

3441 i‡(!
mvm_°a
->
lök
[
lök_id
])

3444 
lök_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

3445 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

3446 
°a_id
 = 
lök_°a
->sta_id;

3447 i‡(
°a
 =
	`rcu_ac˚ss_poöãr
(
mvm
->
fw_id_to_mac_id
[
°a_id
])) {

3448 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

3449 
	`ERR_PTR
(-
ENOENT
));

3450 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_lök_°a
[
°a_id
], 
NULL
);

3453 
	`muãx_u∆ock
(&
mvm
->
muãx
);

3454 
	}
}

3456 
	$iwl_mvm_check_u≠sd
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

3457 c⁄° 
u8
 *
bssid
)

3459 
i
;

3461 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

3462 
iwl_mvm_tcm_mac
 *
md©a
;

3464 
md©a
 = &
mvm
->
tcm
.
d©a
[
	`iwl_mvm_vif_‰om_mac80211
(
vif
)->
id
];

3465 
	`ewma_øã_öô
(&
md©a
->
u≠sd_n⁄agg_dëe˘
.
øã
);

3466 
md©a
->
›íed_rx_ba_£ssi⁄s
 = 
Ál£
;

3469 i‡(!(
mvm
->
fw
->
ucode_ˇ∑
.
Êags
 & 
IWL_UCODE_TLV_FLAGS_UAPSD_SUPPORT
))

3472 i‡(
vif
->
p2p
 && !
	`iwl_mvm_is_p2p_scm_u≠sd_suµ‹ãd
(
mvm
)) {

3473 
vif
->
drivî_Êags
 &~
IEEE80211_VIF_SUPPORTS_UAPSD
;

3477 i‡(!
vif
->
p2p
 &&

3478 (
iwlwifi_mod_∑øms
.
u≠sd_dißbÀ
 & 
IWL_DISABLE_UAPSD_BSS
)) {

3479 
vif
->
drivî_Êags
 &~
IEEE80211_VIF_SUPPORTS_UAPSD
;

3483 
i
 = 0; i < 
IWL_MVM_UAPSD_NOAGG_LIST_LEN
; i++) {

3484 i‡(
	`ëhî_addr_equÆ
(
mvm
->
u≠sd_nﬂgg_bssids
[
i
].
addr
, 
bssid
)) {

3485 
vif
->
drivî_Êags
 &~
IEEE80211_VIF_SUPPORTS_UAPSD
;

3490 
vif
->
drivî_Êags
 |
IEEE80211_VIF_SUPPORTS_UAPSD
;

3491 
	}
}

3494 
	$iwl_mvm_tdls_check_åiggî
(
iwl_mvm
 *
mvm
,

3495 
õì80211_vif
 *
vif
, 
u8
 *
≥î_addr
,

3496 
∆80211_tdls_›î©i⁄
 
a˘i⁄
)

3498 
iwl_fw_dbg_åiggî_év
 *
åig
;

3499 
iwl_fw_dbg_åiggî_tdls
 *
tdls_åig
;

3501 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

3502 
FW_DBG_TRIGGER_TDLS
);

3503 i‡(!
åig
)

3506 
tdls_åig
 = (*)
åig
->
d©a
;

3508 i‡(!(
tdls_åig
->
a˘i⁄_bôm≠
 & 
	`BIT
(
a˘i⁄
)))

3511 i‡(
tdls_åig
->
≥î_mode
 &&

3512 
	`memcmp
(
tdls_åig
->
≥î
, 
≥î_addr
, 
ETH_ALEN
) != 0)

3515 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

3517 
≥î_addr
, 
a˘i⁄
);

3518 
	}
}

3520 
	siwl_mvm_he_obss_«ºow_bw_ru_d©a
 {

3521 
boﬁ
 
	mtﬁî©ed
;

3524 
	$iwl_mvm_check_he_obss_«ºow_bw_ru_ôî
(
wùhy
 *wiphy,

3525 
cfg80211_bss
 *
bss
,

3526 *
_d©a
)

3528 
iwl_mvm_he_obss_«ºow_bw_ru_d©a
 *
d©a
 = 
_d©a
;

3529 c⁄° 
cfg80211_bss_õs
 *
õs
;

3530 c⁄° 
ñemít
 *
ñem
;

3532 
	`rcu_ªad_lock
();

3533 
õs
 = 
	`rcu_dîe„ªn˚
(
bss
->ies);

3534 
ñem
 = 
	`cfg80211_föd_ñem
(
WLAN_EID_EXT_CAPABILITY
, 
õs
->
d©a
,

3535 
õs
->
Àn
);

3537 i‡(!
ñem
 ||ÉÀm->
d©Æí
 < 10 ||

3538 !(
ñem
->
d©a
[10] &

3539 
WLAN_EXT_CAPA10_OBSS_NARROW_BW_RU_TOLERANCE_SUPPORT
)) {

3540 
d©a
->
tﬁî©ed
 = 
Ál£
;

3542 
	`rcu_ªad_u∆ock
();

3543 
	}
}

3546 
	$iwl_mvm_check_he_obss_«ºow_bw_ru
(
õì80211_hw
 *
hw
,

3547 
õì80211_vif
 *
vif
,

3548 
lök_id
,

3549 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

3551 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3552 
iwl_mvm_he_obss_«ºow_bw_ru_d©a
 
ôî_d©a
 = {

3553 .
tﬁî©ed
 = 
åue
,

3556 i‡(
	`WARN_ON_ONCE
(!
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
 ||

3557 !
mvmvif
->
lök
[
lök_id
]))

3560 i‡(!(
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->
Êags
 & 
IEEE80211_CHAN_RADAR
)) {

3561 
mvmvif
->
lök
[
lök_id
]->
he_ru_2mhz_block
 = 
Ál£
;

3565 
	`cfg80211_bss_ôî
(
hw
->
wùhy
, &
lök_c⁄f
->
ch™ªq
.
›î
,

3566 
iwl_mvm_check_he_obss_«ºow_bw_ru_ôî
,

3567 &
ôî_d©a
);

3573 
mvmvif
->
lök
[
lök_id
]->
he_ru_2mhz_block
 = !
ôî_d©a
.
tﬁî©ed
;

3574 
	}
}

3576 
	$iwl_mvm_ª£t_cˇ_40mhz_w‹k¨ound
(
iwl_mvm
 *
mvm
,

3577 
õì80211_vif
 *
vif
)

3579 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

3580 c⁄° 
õì80211_°a_he_ˇp
 *
he_ˇp
;

3582 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

3585 i‡(!
mvm
->
cˇ_40mhz_w‹k¨ound
)

3589 
mvm
->
cˇ_40mhz_w‹k¨ound
--;

3590 i‡(
mvm
->
cˇ_40mhz_w‹k¨ound
)

3593 
sb™d
 = 
mvm
->
hw
->
wùhy
->
b™ds
[
NL80211_BAND_2GHZ
];

3595 
sb™d
->
ht_ˇp
.
ˇp
 |
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

3597 
he_ˇp
 = 
	`õì80211_gë_he_i·y≥_ˇp_vif
(
sb™d
, 
vif
);

3599 i‡(
he_ˇp
) {

3601 
õì80211_°a_he_ˇp
 *
he
 = (*)(
uöçå_t
)
he_ˇp
;

3603 
he
->
he_ˇp_ñem
.
phy_ˇp_öfo
[0] |=

3604 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
;

3606 
	}
}

3608 
	$iwl_mvm_mei_ho°_assocüãd
(
iwl_mvm
 *
mvm
,

3609 
õì80211_vif
 *
vif
,

3610 
iwl_mvm_°a
 *
mvm_°a
)

3612 #i‡
	`IS_ENABLED
(
CONFIG_IWLMEI
)

3613 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3614 
iwl_mei_c⁄n_öfo
 
c⁄n_öfo
 = {

3615 .
ssid_Àn
 = 
vif
->
cfg
.ssid_len,

3618 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

3621 i‡(!
mvm
->
mei_ªgi°îed
)

3625 i‡(!
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
ch™
)

3628 
c⁄n_öfo
.
ch™√l
 = 
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
ch™
->
hw_vÆue
;

3630 
mvm_°a
->
∑úwi£_cùhî
) {

3631 
WLAN_CIPHER_SUITE_TKIP
:

3632 
c⁄n_öfo
.
∑úwi£_cùhî
 = 
IWL_MEI_CIPHER_TKIP
;

3634 
WLAN_CIPHER_SUITE_CCMP
:

3635 
c⁄n_öfo
.
∑úwi£_cùhî
 = 
IWL_MEI_CIPHER_CCMP
;

3637 
WLAN_CIPHER_SUITE_GCMP
:

3638 
c⁄n_öfo
.
∑úwi£_cùhî
 = 
IWL_MEI_CIPHER_GCMP
;

3640 
WLAN_CIPHER_SUITE_GCMP_256
:

3641 
c⁄n_öfo
.
∑úwi£_cùhî
 = 
IWL_MEI_CIPHER_GCMP_256
;

3651 
mvmvif
->
ªkey_d©a
.
akm
) {

3652 
WLAN_AKM_SUITE_SAE
 & 0xff:

3653 
c⁄n_öfo
.
auth_mode
 = 
IWL_MEI_AKM_AUTH_SAE
;

3655 
WLAN_AKM_SUITE_PSK
 & 0xff:

3656 
c⁄n_öfo
.
auth_mode
 = 
IWL_MEI_AKM_AUTH_RSNA_PSK
;

3658 
WLAN_AKM_SUITE_8021X
 & 0xff:

3659 
c⁄n_öfo
.
auth_mode
 = 
IWL_MEI_AKM_AUTH_RSNA
;

3663 
c⁄n_öfo
.
auth_mode
 = 
IWL_MEI_AKM_AUTH_OPEN
;

3671 
	`mem˝y
(
c⁄n_öfo
.
ssid
, 
vif
->
cfg
.ssid, vif->cfg.
ssid_Àn
);

3672 
	`mem˝y
(
c⁄n_öfo
.
bssid
, 
vif
->
bss_c⁄f
.bssid, 
ETH_ALEN
);

3675 
	`iwl_mei_ho°_assocüãd
(&
c⁄n_öfo
, 
NULL
);

3677 
	}
}

3679 
	$iwl_mvm_mac_˘xt_ch™ged_wøµî
(
iwl_mvm
 *
mvm
,

3680 
õì80211_vif
 *
vif
,

3681 
boﬁ
 
f‹˚_assoc_off
)

3683  
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
f‹˚_assoc_off
, 
NULL
);

3684 
	}
}

3686 
	$iwl_mvm_mac_°a_°©e
(
õì80211_hw
 *
hw
,

3687 
õì80211_vif
 *
vif
,

3688 
õì80211_°a
 *
°a
,

3689 
õì80211_°a_°©e
 
ﬁd_°©e
,

3690 
õì80211_°a_°©e
 
√w_°©e
)

3692 c⁄° 
iwl_mvm_°a_°©e_›s
 
ˇŒbacks
 = {

3693 .
add_°a
 = 
iwl_mvm_add_°a
,

3694 .
upd©e_°a
 = 
iwl_mvm_upd©e_°a
,

3695 .
rm_°a
 = 
iwl_mvm_rm_°a
,

3696 .
mac_˘xt_ch™ged
 = 
iwl_mvm_mac_˘xt_ch™ged_wøµî
,

3699 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

3701 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

3702  
	`iwl_mvm_mac_°a_°©e_comm⁄
(
hw
, 
vif
, 
°a
, 
ﬁd_°©e
, 
√w_°©e
,

3703 &
ˇŒbacks
);

3704 
	}
}

3711 
	$iwl_mvm_rs_øã_öô_Æl_löks
(
iwl_mvm
 *
mvm
,

3712 
õì80211_vif
 *
vif
,

3713 
õì80211_°a
 *
°a
)

3715 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3716 
lök_id
;

3718 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
lök_id
) {

3719 
õì80211_bss_c⁄f
 *
c⁄f
 =

3720 
	`lök_c⁄f_dîe„ªn˚_check
(
vif
, 
lök_id
);

3721 
õì80211_lök_°a
 *
lök_°a
 =

3722 
	`lök_°a_dîe„ªn˚_check
(
°a
, 
lök_id
);

3724 i‡(!
c⁄f
 || !
lök_°a
 || !
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
)

3727 
	`iwl_mvm_rs_øã_öô
(
mvm
, 
vif
, 
°a
, 
c⁄f
, 
lök_°a
,

3728 
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
->
ch™√l
->
b™d
);

3730 
	}
}

3732 
	#IWL_MVM_MIN_BEACON_INTERVAL_TU
 16

	)

3734 
boﬁ
 
	$iwl_mvm_vif_c⁄f_‰om_°a
(
iwl_mvm
 *
mvm
,

3735 
õì80211_vif
 *
vif
,

3736 
õì80211_°a
 *
°a
)

3738 
õì80211_lök_°a
 *
lök_°a
;

3739 
lök_id
;

3748 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

3749 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

3750 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

3752 i‡(!
lök_c⁄f
)

3755 i‡(
lök_c⁄f
->
bóc⁄_öt
 < 
IWL_MVM_MIN_BEACON_INTERVAL_TU
) {

3756 
	`IWL_ERR
(
mvm
,

3758 
lök_c⁄f
->
bóc⁄_öt
, 
lök_°a
->
addr
);

3759  
Ál£
;

3762 
lök_c⁄f
->
he_suµ‹t
 = 
lök_°a
->
he_ˇp
.
has_he
;

3765  
åue
;

3766 
	}
}

3768 
	$iwl_mvm_vif_£t_he_suµ‹t
(
õì80211_hw
 *
hw
,

3769 
õì80211_vif
 *
vif
,

3770 
õì80211_°a
 *
°a
,

3771 
boﬁ
 
is_°a
)

3773 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3774 
õì80211_lök_°a
 *
lök_°a
;

3775 
lök_id
;

3777 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

3778 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

3779 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

3781 i‡(!
lök_c⁄f
 || !
mvmvif
->
lök
[
lök_id
])

3784 
lök_c⁄f
->
he_suµ‹t
 = 
lök_°a
->
he_ˇp
.
has_he
;

3786 i‡(
is_°a
) {

3787 
mvmvif
->
lök
[
lök_id
]->
he_ru_2mhz_block
 = 
Ál£
;

3788 i‡(
lök_°a
->
he_ˇp
.
has_he
)

3789 
	`iwl_mvm_check_he_obss_«ºow_bw_ru
(
hw
, 
vif
,

3790 
lök_id
,

3791 
lök_c⁄f
);

3794 
	}
}

3797 
	$iwl_mvm_°a_°©e_nŸexi°_to_n⁄e
(
iwl_mvm
 *
mvm
,

3798 
õì80211_vif
 *
vif
,

3799 
õì80211_°a
 *
°a
,

3800 c⁄° 
iwl_mvm_°a_°©e_›s
 *
ˇŒbacks
)

3802 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3803 
õì80211_lök_°a
 *
lök_°a
;

3804 
i
;

3805 
ªt
;

3807 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3809 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

3810 !
	`iwl_mvm_vif_c⁄f_‰om_°a
(
mvm
, 
vif
, 
°a
))

3811  -
EINVAL
;

3813 i‡(
°a
->
tdls
 &&

3814 (
vif
->
p2p
 ||

3815 
	`iwl_mvm_tdls_°a_cou¡
(
mvm
, 
NULL
Ë=
IWL_MVM_TDLS_STA_COUNT
 ||

3816 
	`iwl_mvm_phy_˘x_cou¡
(
mvm
) > 1)) {

3817 
	`IWL_DEBUG_MAC80211
(
mvm
, "refusing TDLS sta\n");

3818  -
EBUSY
;

3821 
ªt
 = 
ˇŒbacks
->
	`add_°a
(
mvm
, 
vif
, 
°a
);

3822 i‡(
°a
->
tdls
 && 
ªt
 == 0) {

3823 
	`iwl_mvm_ªˇlc_tdls_°©e
(
mvm
, 
vif
, 
åue
);

3824 
	`iwl_mvm_tdls_check_åiggî
(
mvm
, 
vif
, 
°a
->
addr
,

3825 
NL80211_TDLS_SETUP
);

3828 i‡(
ªt
)

3829  
ªt
;

3831 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
i
)

3832 
lök_°a
->
agg
.
max_rc_amsdu_Àn
 = 1;

3834 
	`õì80211_°a_ªˇlc_aggªg©es
(
°a
);

3836 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !
°a
->
tdls
)

3837 
mvmvif
->
≠_°a
 = 
°a
;

3850 
	`iwl_mvm_rs_øã_öô_Æl_löks
(
mvm
, 
vif
, 
°a
);

3853 
	}
}

3856 
	$iwl_mvm_°a_°©e_auth_to_assoc
(
õì80211_hw
 *
hw
,

3857 
iwl_mvm
 *
mvm
,

3858 
õì80211_vif
 *
vif
,

3859 
õì80211_°a
 *
°a
,

3860 c⁄° 
iwl_mvm_°a_°©e_›s
 *
ˇŒbacks
)

3862 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3863 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3864 
õì80211_lök_°a
 *
lök_°a
;

3865 
lök_id
;

3867 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3869 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

3870 
	`iwl_mvm_vif_£t_he_suµ‹t
(
hw
, 
vif
, 
°a
, 
Ál£
);

3871 
mvmvif
->
≠_assoc_°a_cou¡
++;

3872 
ˇŒbacks
->
	`mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

3877 i‡(!
mvm
->
mld_≠i_is_u£d
 &&

3878 (
vif
->
bss_c⁄f
.
he_suµ‹t
 &&

3879 !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
))

3880 
	`iwl_mvm_cfg_he_°a
(
mvm
, 
vif
, 
mvm_°a
->
deÊök
.
°a_id
);

3881 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

3882 
	`iwl_mvm_vif_£t_he_suµ‹t
(
hw
, 
vif
, 
°a
, 
åue
);

3884 
ˇŒbacks
->
	`mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

3886 i‡(!
mvm
->
mld_≠i_is_u£d
)

3887 
out
;

3889 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

3890 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

3891 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

3893 i‡(
	`WARN_ON
(!
lök_c⁄f
))

3894  -
EINVAL
;

3895 i‡(!
mvmvif
->
lök
[
lök_id
])

3898 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
,

3899 
LINK_CONTEXT_MODIFY_ALL
 &

3900 ~
LINK_CONTEXT_MODIFY_ACTIVE
,

3901 
åue
);

3905 
out
:

3906 
	`iwl_mvm_rs_øã_öô_Æl_löks
(
mvm
, 
vif
, 
°a
);

3908  
ˇŒbacks
->
	`upd©e_°a
(
mvm
, 
vif
, 
°a
);

3909 
	}
}

3912 
	$iwl_mvm_°a_°©e_assoc_to_auth‹ized
(
iwl_mvm
 *
mvm
,

3913 
õì80211_vif
 *
vif
,

3914 
õì80211_°a
 *
°a
,

3915 c⁄° 
iwl_mvm_°a_°©e_›s
 *
ˇŒbacks
)

3917 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3918 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3920 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3923 i‡(
	`iwl_mvm_phy_˘x_cou¡
(
mvm
) > 1)

3924 
	`iwl_mvm_ã¨down_tdls_≥îs
(
mvm
);

3926 i‡(
°a
->
tdls
) {

3927 
	`iwl_mvm_tdls_check_åiggî
(
mvm
, 
vif
, 
°a
->
addr
,

3928 
NL80211_TDLS_ENABLE_LINK
);

3931 
	`WARN_ON
(
	`iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
));

3933 
mvmvif
->
auth‹ized
 = 1;

3935 
ˇŒbacks
->
	`mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

3936 
	`iwl_mvm_mei_ho°_assocüãd
(
mvm
, 
vif
, 
mvm_°a
);

3941 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

3942 !
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

3943 
	`iwl_mvm_mld_£À˘_löks
(
mvm
, 
vif
, 
Ál£
);

3946 
mvm_°a
->
auth‹ized
 = 
åue
;

3951 i‡(!
°a
->
mÂ
) {

3952 
ªt
 = 
ˇŒbacks
->
	`upd©e_°a
(
mvm
, 
vif
, 
°a
);

3954 i‡(
ªt
)

3955  
ªt
;

3958 
	`iwl_mvm_rs_øã_öô_Æl_löks
(
mvm
, 
vif
, 
°a
);

3961 
	}
}

3964 
	$iwl_mvm_°a_°©e_auth‹ized_to_assoc
(
iwl_mvm
 *
mvm
,

3965 
õì80211_vif
 *
vif
,

3966 
õì80211_°a
 *
°a
,

3967 c⁄° 
iwl_mvm_°a_°©e_›s
 *
ˇŒbacks
)

3969 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3970 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3972 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3974 
mvm°a
->
auth‹ized
 = 
Ál£
;

3979 
	`iwl_mvm_rs_øã_öô_Æl_löks
(
mvm
, 
vif
, 
°a
);

3981 i‡(!
°a
->
tdls
) {

3986 
mvmvif
->
auth‹ized
 = 0;

3989 
	`iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

3993 
	}
}

3996 
	$iwl_mvm_mac_°a_°©e_comm⁄
(
õì80211_hw
 *
hw
,

3997 
õì80211_vif
 *
vif
,

3998 
õì80211_°a
 *
°a
,

3999 
õì80211_°a_°©e
 
ﬁd_°©e
,

4000 
õì80211_°a_°©e
 
√w_°©e
,

4001 c⁄° 
iwl_mvm_°a_°©e_›s
 *
ˇŒbacks
)

4003 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4004 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4005 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4006 
õì80211_lök_°a
 *
lök_°a
;

4007 
lök_id
;

4008 
ªt
;

4010 
	`IWL_DEBUG_MAC80211
(
mvm
, "station %pM state change %d->%d\n",

4011 
°a
->
addr
, 
ﬁd_°©e
, 
√w_°©e
);

4026 i‡(
ﬁd_°©e
 =
IEEE80211_STA_NONE
 &&

4027 
√w_°©e
 =
IEEE80211_STA_NOTEXIST
) {

4028 
	`Êush_w‹k
(&
mvm
->
add_°ªam_wk
);

4039 
	`iwl_mvm_ª£t_cˇ_40mhz_w‹k¨ound
(
mvm
, 
vif
);

4042 
	`k‰ì
(
mvm_°a
->
dup_d©a
);

4045 
	`muãx_lock
(&
mvm
->
muãx
);

4052 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

4053 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
lök
[
lök_id
] ||

4054 !
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
)) {

4055 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4056  
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
,

4057 &
mvm
->
°©us
Ë? 0 : -
EINVAL
;

4062 
mvm_°a
->
°a_°©e
 = 
√w_°©e
;

4064 i‡(
ﬁd_°©e
 =
IEEE80211_STA_NOTEXIST
 &&

4065 
√w_°©e
 =
IEEE80211_STA_NONE
) {

4066 
ªt
 = 
	`iwl_mvm_°a_°©e_nŸexi°_to_n⁄e
(
mvm
, 
vif
, 
°a
,

4067 
ˇŒbacks
);

4068 i‡(
ªt
 < 0)

4069 
out_u∆ock
;

4070 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_NONE
 &&

4071 
√w_°©e
 =
IEEE80211_STA_AUTH
) {

4076 
mvm
->
œ°_ebs_suc˚ssful
 = 
åue
;

4077 
	`iwl_mvm_check_u≠sd
(
mvm
, 
vif
, 
°a
->
addr
);

4078 
ªt
 = 0;

4079 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_AUTH
 &&

4080 
√w_°©e
 =
IEEE80211_STA_ASSOC
) {

4081 
ªt
 = 
	`iwl_mvm_°a_°©e_auth_to_assoc
(
hw
, 
mvm
, 
vif
, 
°a
,

4082 
ˇŒbacks
);

4083 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_ASSOC
 &&

4084 
√w_°©e
 =
IEEE80211_STA_AUTHORIZED
) {

4085 
ªt
 = 
	`iwl_mvm_°a_°©e_assoc_to_auth‹ized
(
mvm
, 
vif
, 
°a
,

4086 
ˇŒbacks
);

4087 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_AUTHORIZED
 &&

4088 
√w_°©e
 =
IEEE80211_STA_ASSOC
) {

4089 
ªt
 = 
	`iwl_mvm_°a_°©e_auth‹ized_to_assoc
(
mvm
, 
vif
, 
°a
,

4090 
ˇŒbacks
);

4091 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_ASSOC
 &&

4092 
√w_°©e
 =
IEEE80211_STA_AUTH
) {

4093 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

4094 
mvmvif
->
≠_assoc_°a_cou¡
--;

4095 
ˇŒbacks
->
	`mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

4096 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !
°a
->
tdls
)

4097 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

4098 
ªt
 = 0;

4099 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_AUTH
 &&

4100 
√w_°©e
 =
IEEE80211_STA_NONE
) {

4101 
ªt
 = 0;

4102 } i‡(
ﬁd_°©e
 =
IEEE80211_STA_NONE
 &&

4103 
√w_°©e
 =
IEEE80211_STA_NOTEXIST
) {

4104 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !
°a
->
tdls
) {

4105 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

4106 
mvmvif
->
≠_°a
 = 
NULL
;

4108 
ªt
 = 
ˇŒbacks
->
	`rm_°a
(
mvm
, 
vif
, 
°a
);

4109 i‡(
°a
->
tdls
) {

4110 
	`iwl_mvm_ªˇlc_tdls_°©e
(
mvm
, 
vif
, 
Ál£
);

4111 
	`iwl_mvm_tdls_check_åiggî
(
mvm
, 
vif
, 
°a
->
addr
,

4112 
NL80211_TDLS_DISABLE_LINK
);

4115 i‡(
	`u∆ikñy
(
ªt
 &&

4116 
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
,

4117 &
mvm
->
°©us
)))

4118 
ªt
 = 0;

4120 
ªt
 = -
EIO
;

4122 
out_u∆ock
:

4123 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4125 i‡(
°a
->
tdls
 && 
ªt
 == 0) {

4126 i‡(
ﬁd_°©e
 =
IEEE80211_STA_NOTEXIST
 &&

4127 
√w_°©e
 =
IEEE80211_STA_NONE
)

4128 
	`õì80211_ª£rve_tid
(
°a
, 
IWL_MVM_TDLS_FW_TID
);

4129 i‡(
ﬁd_°©e
 =
IEEE80211_STA_NONE
 &&

4130 
√w_°©e
 =
IEEE80211_STA_NOTEXIST
)

4131 
	`õì80211_uƒe£rve_tid
(
°a
, 
IWL_MVM_TDLS_FW_TID
);

4134  
ªt
;

4135 
	}
}

4137 
	$iwl_mvm_mac_£t_πs_thªshﬁd
(
õì80211_hw
 *
hw
, 
u32
 
vÆue
)

4139 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4141 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4143 
mvm
->
πs_thªshﬁd
 = 
vÆue
;

4145 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4147 
	}
}

4149 
	$iwl_mvm_°a_rc_upd©e
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

4150 
õì80211_°a
 *
°a
, 
u32
 
ch™ged
)

4152 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4154 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4156 i‡(
ch™ged
 & (
IEEE80211_RC_BW_CHANGED
 |

4157 
IEEE80211_RC_SUPP_RATES_CHANGED
 |

4158 
IEEE80211_RC_NSS_CHANGED
))

4159 
	`iwl_mvm_rs_øã_öô_Æl_löks
(
mvm
, 
vif
, 
°a
);

4161 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

4162 
ch™ged
 & 
IEEE80211_RC_NSS_CHANGED
)

4163 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

4164 
	}
}

4166 
	$iwl_mvm_mac_c⁄f_tx
(
õì80211_hw
 *
hw
,

4167 
õì80211_vif
 *
vif
,

4168 
lök_id
, 
u16
 
ac
,

4169 c⁄° 
õì80211_tx_queue_∑øms
 *
∑øms
)

4171 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4172 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4174 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4176 
mvmvif
->
deÊök
.
queue_∑øms
[
ac
] = *
∑øms
;

4182 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

4183 
ªt
;

4185 
	`muãx_lock
(&
mvm
->
muãx
);

4186 
ªt
 = 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
);

4187 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4188 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4189  
ªt
;

4191 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4193 
	}
}

4195 
	$iwl_mvm_mac_mgd_¥ï¨e_tx
(
õì80211_hw
 *
hw
,

4196 
õì80211_vif
 *
vif
,

4197 
õì80211_¥ï_tx_öfo
 *
öfo
)

4199 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4201 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4203 
	`muãx_lock
(&
mvm
->
muãx
);

4204 
	`iwl_mvm_¥Ÿe˘_assoc
(
mvm
, 
vif
, 
öfo
->
duøti⁄
, info->
lök_id
);

4205 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4206 
	}
}

4208 
	$iwl_mvm_mac_mgd_com∂ëe_tx
(
õì80211_hw
 *
hw
,

4209 
õì80211_vif
 *
vif
,

4210 
õì80211_¥ï_tx_öfo
 *
öfo
)

4212 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4214 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4217 i‡(
öfo
->
suc˚ss
) {

4218 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4222 
	`muãx_lock
(&
mvm
->
muãx
);

4223 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

4224 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4225 
	}
}

4227 
	$iwl_mvm_mac_sched_sˇn_°¨t
(
õì80211_hw
 *
hw
,

4228 
õì80211_vif
 *
vif
,

4229 
cfg80211_sched_sˇn_ªque°
 *
ªq
,

4230 
õì80211_sˇn_õs
 *
õs
)

4232 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4234 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4235 
ªt
;

4237 
	`muãx_lock
(&
mvm
->
muãx
);

4239 i‡(!
vif
->
cfg
.
idÀ
) {

4240 
ªt
 = -
EBUSY
;

4241 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4242 
out
;

4245 
ªt
 = 
	`iwl_mvm_sched_sˇn_°¨t
(
mvm
, 
vif
, 
ªq
, 
õs
, 
IWL_MVM_SCAN_SCHED
);

4247 
out
:

4248 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4249 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4250  
ªt
;

4251 
	}
}

4253 
	$iwl_mvm_mac_sched_sˇn_°›
(
õì80211_hw
 *
hw
,

4254 
õì80211_vif
 *
vif
)

4256 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4257 
ªt
;

4259 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4261 
	`muãx_lock
(&
mvm
->
muãx
);

4271 i‡(!(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_SCHED
)) {

4272 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4273 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4277 
ªt
 = 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_SCHED
, 
Ál£
);

4278 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4279 
	`iwl_mvm_waô_f‹_async_h™dÀrs
(
mvm
);

4281 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4282  
ªt
;

4283 
	}
}

4285 
	$__iwl_mvm_mac_£t_key
(
õì80211_hw
 *
hw
,

4286 
£t_key_cmd
 
cmd
,

4287 
õì80211_vif
 *
vif
,

4288 
õì80211_°a
 *
°a
,

4289 
õì80211_key_c⁄f
 *
key
)

4291 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4292 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4293 
iwl_mvm_°a
 *
mvm°a
 = 
NULL
;

4294 
iwl_mvm_key_≤
 *
±k_≤
 = 
NULL
;

4295 
keyidx
 = 
key
->keyidx;

4296 
u32
 
£c_key_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SEC_KEY_CMD
);

4297 
u8
 
£c_key_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
£c_key_id
, 0);

4298 
ªt
, 
i
;

4299 
u8
 
key_off£t
;

4301 i‡(
°a
)

4302 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4304 
key
->
cùhî
) {

4305 
WLAN_CIPHER_SUITE_TKIP
:

4306 i‡(!
mvm
->
å™s
->
å™s_cfg
->
gí2
) {

4307 
key
->
Êags
 |
IEEE80211_KEY_FLAG_GENERATE_MMIC
;

4308 
key
->
Êags
 |
IEEE80211_KEY_FLAG_PUT_IV_SPACE
;

4309 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

4310 
key
->
Êags
 |
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
;

4312 
	`IWL_DEBUG_MAC80211
(
mvm
, "Use SWÉncryption for TKIP\n");

4313  -
EOPNOTSUPP
;

4316 
WLAN_CIPHER_SUITE_CCMP
:

4317 
WLAN_CIPHER_SUITE_GCMP
:

4318 
WLAN_CIPHER_SUITE_GCMP_256
:

4319 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

4320 
key
->
Êags
 |
IEEE80211_KEY_FLAG_PUT_IV_SPACE
;

4322 
WLAN_CIPHER_SUITE_AES_CMAC
:

4323 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

4324 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

4325 
	`WARN_ON_ONCE
(!
	`õì80211_hw_check
(
hw
, 
MFP_CAPABLE
));

4327 
WLAN_CIPHER_SUITE_WEP40
:

4328 
WLAN_CIPHER_SUITE_WEP104
:

4329 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

4331 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

4332  -
EOPNOTSUPP
;

4336  -
EOPNOTSUPP
;

4339 
cmd
) {

4340 
SET_KEY
:

4341 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

4342 (
keyidx
 == 6 || keyidx == 7))

4343 
	`rcu_assign_poöãr
(
mvmvif
->
b˙_¥Ÿ
.
keys
[
keyidx
 - 6],

4344 
key
);

4346 i‡((
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
 ||

4347 
vif
->
ty≥
 =
NL80211_IFTYPE_AP
Ë&& !
°a
) {

4365 i‡(!
	`wùhy_ext_„©uª_is£t
(
hw
->
wùhy
,

4366 
NL80211_EXT_FEATURE_BEACON_PROTECTION
) &&

4367 (
key
->
cùhî
 =
WLAN_CIPHER_SUITE_AES_CMAC
 ||

4368 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_128
 ||

4369 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_256
)) {

4370 
ªt
 = -
EOPNOTSUPP
;

4374 i‡(
key
->
cùhî
 !
WLAN_CIPHER_SUITE_GCMP
 &&

4375 
key
->
cùhî
 !
WLAN_CIPHER_SUITE_GCMP_256
 &&

4376 !
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

4377 
key
->
hw_key_idx
 = 
STA_KEY_IDX_INVALID
;

4378 
ªt
 = 0;

4382 i‡(!
mvmvif
->
≠_ibss_a˘ive
) {

4383 
i
 = 0;

4384 
i
 < 
	`ARRAY_SIZE
(
mvmvif
->
≠_óæy_keys
);

4385 
i
++) {

4386 i‡(!
mvmvif
->
≠_óæy_keys
[
i
]) {

4387 
mvmvif
->
≠_óæy_keys
[
i
] = 
key
;

4392 i‡(
i
 >
	`ARRAY_SIZE
(
mvmvif
->
≠_óæy_keys
))

4393 
ªt
 = -
ENOSPC
;

4395 
ªt
 = 0;

4404 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

4405 
key
->
hw_key_idx
 =
STA_KEY_IDX_INVALID
) {

4406 
	`IWL_DEBUG_MAC80211
(
mvm
,

4408 
ªt
 = 0;

4412 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

4413 
mvm°a
 && 
	`iwl_mvm_has_√w_rx_≠i
(
mvm
) &&

4414 
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
 &&

4415 (
key
->
cùhî
 =
WLAN_CIPHER_SUITE_CCMP
 ||

4416 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_GCMP
 ||

4417 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_GCMP_256
)) {

4418 
õì80211_key_£q
 
£q
;

4419 
tid
, 
q
;

4421 
	`WARN_ON
(
	`rcu_ac˚ss_poöãr
(
mvm°a
->
±k_≤
[
keyidx
]));

4422 
±k_≤
 = 
	`kzÆloc
(
	`°ru˘_size
’tk_≤, 
q
,

4423 
mvm
->
å™s
->
num_rx_queues
),

4424 
GFP_KERNEL
);

4425 i‡(!
±k_≤
) {

4426 
ªt
 = -
ENOMEM
;

4430 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++) {

4431 
	`õì80211_gë_key_rx_£q
(
key
, 
tid
, &
£q
);

4432 
q
 = 0; q < 
mvm
->
å™s
->
num_rx_queues
; q++)

4433 
	`mem˝y
(
±k_≤
->
q
[q].
≤
[
tid
],

4434 
£q
.
ccmp
.
≤
,

4435 
IEEE80211_CCMP_PN_LEN
);

4438 
	`rcu_assign_poöãr
(
mvm°a
->
±k_≤
[
keyidx
],Ötk_pn);

4442 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

4443 
key_off£t
 = 
key
->
hw_key_idx
;

4445 
key_off£t
 = 
STA_KEY_IDX_INVALID
;

4447 i‡(
mvm°a
 && 
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)

4448 
mvm°a
->
∑úwi£_cùhî
 = 
key
->
cùhî
;

4450 
	`IWL_DEBUG_MAC80211
(
mvm
, "set hwcrypto key (sta:%pM, id:%d)\n",

4451 
°a
 ? sè->
addr
 : 
NULL
, 
key
->
keyidx
);

4453 i‡(
£c_key_vî
)

4454 
ªt
 = 
	`iwl_mvm_£c_key_add
(
mvm
, 
vif
, 
°a
, 
key
);

4456 
ªt
 = 
	`iwl_mvm_£t_°a_key
(
mvm
, 
vif
, 
°a
, 
key
, 
key_off£t
);

4458 i‡(
ªt
) {

4459 
	`IWL_WARN
(
mvm
, "set key failed\n");

4460 
key
->
hw_key_idx
 = 
STA_KEY_IDX_INVALID
;

4461 i‡(
±k_≤
) {

4462 
	`RCU_INIT_POINTER
(
mvm°a
->
±k_≤
[
keyidx
], 
NULL
);

4463 
	`k‰ì
(
±k_≤
);

4471 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

4472 
ªt
 = -
EOPNOTSUPP
;

4474 
ªt
 = 0;

4478 
DISABLE_KEY
:

4479 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

4480 (
keyidx
 == 6 || keyidx == 7))

4481 
	`RCU_INIT_POINTER
(
mvmvif
->
b˙_¥Ÿ
.
keys
[
keyidx
 - 6],

4482 
NULL
);

4484 
ªt
 = -
ENOENT
;

4485 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvmvif
->
≠_óæy_keys
); i++) {

4486 i‡(
mvmvif
->
≠_óæy_keys
[
i
] =
key
) {

4487 
mvmvif
->
≠_óæy_keys
[
i
] = 
NULL
;

4488 
ªt
 = 0;

4493 i‡(
ªt
 == 0)

4496 i‡(
key
->
hw_key_idx
 =
STA_KEY_IDX_INVALID
) {

4497 
ªt
 = 0;

4501 i‡(
mvm°a
 && 
	`iwl_mvm_has_√w_rx_≠i
(
mvm
) &&

4502 
key
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
 &&

4503 (
key
->
cùhî
 =
WLAN_CIPHER_SUITE_CCMP
 ||

4504 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_GCMP
 ||

4505 
key
->
cùhî
 =
WLAN_CIPHER_SUITE_GCMP_256
)) {

4506 
±k_≤
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

4507 
mvm°a
->
±k_≤
[
keyidx
],

4508 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

4509 
	`RCU_INIT_POINTER
(
mvm°a
->
±k_≤
[
keyidx
], 
NULL
);

4510 i‡(
±k_≤
)

4511 
	`k‰ì_rcu
(
±k_≤
, 
rcu_hód
);

4514 
	`IWL_DEBUG_MAC80211
(
mvm
, "disable hwcrypto key\n");

4515 i‡(
£c_key_vî
)

4516 
ªt
 = 
	`iwl_mvm_£c_key_dñ
(
mvm
, 
vif
, 
°a
, 
key
);

4518 
ªt
 = 
	`iwl_mvm_ªmove_°a_key
(
mvm
, 
vif
, 
°a
, 
key
);

4521 
ªt
 = -
EINVAL
;

4524  
ªt
;

4525 
	}
}

4527 
	$iwl_mvm_mac_£t_key
(
õì80211_hw
 *
hw
, 
£t_key_cmd
 
cmd
,

4528 
õì80211_vif
 *
vif
, 
õì80211_°a
 *
°a
,

4529 
õì80211_key_c⁄f
 *
key
)

4531 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4532 
ªt
;

4534 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4536 
	`muãx_lock
(&
mvm
->
muãx
);

4537 
ªt
 = 
	`__iwl_mvm_mac_£t_key
(
hw
, 
cmd
, 
vif
, 
°a
, 
key
);

4538 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4540 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4541  
ªt
;

4542 
	}
}

4544 
	$iwl_mvm_mac_upd©e_tkù_key
(
õì80211_hw
 *
hw
,

4545 
õì80211_vif
 *
vif
,

4546 
õì80211_key_c⁄f
 *
keyc⁄f
,

4547 
õì80211_°a
 *
°a
,

4548 
u32
 
iv32
, 
u16
 *
pha£1key
)

4550 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4552 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4554 i‡(
keyc⁄f
->
hw_key_idx
 =
STA_KEY_IDX_INVALID
) {

4555 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4559 
	`iwl_mvm_upd©e_tkù_key
(
mvm
, 
vif
, 
keyc⁄f
, 
°a
, 
iv32
, 
pha£1key
);

4560 
	}
}

4563 
boﬁ
 
	$iwl_mvm_rx_aux_roc
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

4564 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

4566 
iwl_mvm
 *
mvm
 =

4567 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

4568 
iwl_hs20_roc_ªs
 *
ª•
;

4569 
ª•_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

4570 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = 
d©a
;

4572 i‡(
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
HOT_SPOT_CMD
))

4573  
åue
;

4575 i‡(
	`WARN_ON_ONCE
(
ª•_Àn
 !(*
ª•
))) {

4576 
	`IWL_ERR
(
mvm
, "Invalid HOT_SPOT_CMDÑesponse\n");

4577  
åue
;

4580 
ª•
 = (*)
pkt
->
d©a
;

4582 
	`IWL_DEBUG_TE
(
mvm
,

4584 
ª•
->
°©us
,Ñe•->
evít_unique_id
);

4586 
ã_d©a
->
uid
 = 
	`À32_to_˝u
(
ª•
->
evít_unique_id
);

4587 
	`IWL_DEBUG_TE
(
mvm
, "TIME_EVENT_CMDÑesponse - UID = 0x%x\n",

4588 
ã_d©a
->
uid
);

4590 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

4591 
	`li°_add_èû
(&
ã_d©a
->
li°
, &
mvm
->
aux_roc_ã_li°
);

4592 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

4594  
åue
;

4595 
	}
}

4597 
	$iwl_mvm_£nd_aux_roc_cmd
(
iwl_mvm
 *
mvm
,

4598 
õì80211_ch™√l
 *
ch™√l
,

4599 
õì80211_vif
 *
vif
,

4600 
duøti⁄
)

4602 
ªs
;

4603 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4604 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
hs_time_evít_d©a
;

4605 c⁄° 
u16
 
time_evít_ª•⁄£
[] = { 
HOT_SPOT_CMD
 };

4606 
iwl_nŸifiˇti⁄_waô
 
waô_time_evít
;

4607 
u32
 
ªq_dur
, 
dñay
;

4608 
iwl_hs20_roc_ªq
 
aux_roc_ªq
 = {

4609 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
),

4610 .
id_™d_cﬁ‹
 =

4611 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
MAC_INDEX_AUX
, 0)),

4612 .
°a_id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
mvm
->
aux_°a
.
°a_id
),

4614 
iwl_hs20_roc_ªq_èû
 *
èû
 = 
	`iwl_mvm_ch™_öfo_cmd_èû
(
mvm
,

4615 &
aux_roc_ªq
.
ch™√l_öfo
);

4616 
u16
 
Àn
 = (
aux_roc_ªq
Ë- 
	`iwl_mvm_ch™_öfo_∑ddög
(
mvm
);

4619 
	`iwl_mvm_£t_ch™_öfo
(
mvm
, &
aux_roc_ªq
.
ch™√l_öfo
, 
ch™√l
->
hw_vÆue
,

4620 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
ch™√l
->
b™d
),

4621 
IWL_PHY_CHANNEL_MODE20
,

4625 
èû
->
≠∂y_time
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_sy°ime
(
mvm
));

4627 
	`iwl_mvm_roc_duøti⁄_™d_dñay
(
vif
, 
duøti⁄
, &
ªq_dur
, &
dñay
);

4628 
èû
->
duøti⁄
 = 
	`˝u_to_À32
(
ªq_dur
);

4629 
èû
->
≠∂y_time_max_dñay
 = 
	`˝u_to_À32
(
dñay
);

4631 
	`IWL_DEBUG_TE
(
mvm
,

4633 
ch™√l
->
hw_vÆue
, 
ªq_dur
);

4634 
	`IWL_DEBUG_TE
(
mvm
,

4636 
duøti⁄
, 
dñay
);

4639 
	`mem˝y
(
èû
->
node_addr
, 
vif
->
addr
, 
ETH_ALEN
);

4641 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4643 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

4645 i‡(
	`WARN_ON
(
ã_d©a
->
id
 =
HOT_SPOT_CMD
)) {

4646 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

4647  -
EIO
;

4650 
ã_d©a
->
vif
 = vif;

4651 
ã_d©a
->
duøti⁄
 = duration;

4652 
ã_d©a
->
id
 = 
HOT_SPOT_CMD
;

4654 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

4665 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_time_evít
,

4666 
time_evít_ª•⁄£
,

4667 
	`ARRAY_SIZE
(
time_evít_ª•⁄£
),

4668 
iwl_mvm_rx_aux_roc
, 
ã_d©a
);

4670 
ªs
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
HOT_SPOT_CMD
, 0, 
Àn
,

4671 &
aux_roc_ªq
);

4673 i‡(
ªs
) {

4674 
	`IWL_ERR
(
mvm
, "Couldn'à£nd HOT_SPOT_CMD: %d\n", 
ªs
);

4675 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_time_evít
);

4676 
out_˛ór_ã
;

4680 
ªs
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_time_evít
, 1);

4682 
	`WARN_ON_ONCE
(
ªs
);

4684 i‡(
ªs
) {

4685 
out_˛ór_ã
:

4686 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

4687 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

4688 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

4691  
ªs
;

4692 
	}
}

4694 
	$iwl_mvm_add_aux_°a_f‹_hs20
(
iwl_mvm
 *
mvm
, 
u32
 
lmac_id
)

4696 
ªt
 = 0;

4698 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4700 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

4701 
IWL_UCODE_TLV_CAPA_HOTSPOT_SUPPORT
)) {

4702 
	`IWL_ERR
(
mvm
, "hotspotÇot supported\n");

4703  -
EINVAL
;

4706 i‡(
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
)) {

4707 
ªt
 = 
	`iwl_mvm_add_aux_°a
(
mvm
, 
lmac_id
);

4708 
	`WARN
(
ªt
, "FailedÅoállocateáux station");

4711  
ªt
;

4712 
	}
}

4714 
	$iwl_mvm_roc_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

4716 
ªt
;

4718 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4720 
ªt
 = 
	`iwl_mvm_bödög_add_vif
(
mvm
, 
vif
);

4721 i‡(
	`WARN
(
ªt
, "Failed binding P2P_DEVICE\n"))

4722  
ªt
;

4727  
	`iwl_mvm_add_p2p_bˇ°_°a
(
mvm
, 
vif
);

4728 
	}
}

4730 
	$iwl_mvm_roc
(
õì80211_hw
 *
hw
,

4731 
õì80211_vif
 *
vif
,

4732 
õì80211_ch™√l
 *
ch™√l
,

4733 
duøti⁄
,

4734 
õì80211_roc_ty≥
 
ty≥
)

4736 c⁄° 
iwl_mvm_roc_›s
 
›s
 = {

4737 .
add_aux_°a_f‹_hs20
 = 
iwl_mvm_add_aux_°a_f‹_hs20
,

4738 .
lök
 = 
iwl_mvm_roc_lök
,

4741 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4743 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4744  
	`iwl_mvm_roc_comm⁄
(
hw
, 
vif
, 
ch™√l
, 
duøti⁄
, 
ty≥
, &
›s
);

4745 
	}
}

4747 
	$iwl_mvm_roc_°©i⁄
(
iwl_mvm
 *
mvm
,

4748 
õì80211_ch™√l
 *
ch™√l
,

4749 
õì80211_vif
 *
vif
,

4750 
duøti⁄
)

4752 
ªt
;

4753 
u32
 
cmd_id
 = 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
ROC_CMD
);

4754 
u8
 
fw_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

4755 
IWL_FW_CMD_VER_UNKNOWN
);

4757 i‡(
fw_vî
 =
IWL_FW_CMD_VER_UNKNOWN
) {

4758 
ªt
 = 
	`iwl_mvm_£nd_aux_roc_cmd
(
mvm
, 
ch™√l
, 
vif
, 
duøti⁄
);

4759 } i‡(
fw_vî
 == 3) {

4760 
ªt
 = 
	`iwl_mvm_roc_add_cmd
(
mvm
, 
ch™√l
, 
vif
, 
duøti⁄
,

4761 
ROC_ACTIVITY_HOTSPOT
);

4763 
ªt
 = -
EOPNOTSUPP
;

4764 
	`IWL_ERR
(
mvm
, "ROC comm™d vîsi⁄ %d mism©ch!\n", 
fw_vî
);

4767  
ªt
;

4768 
	}
}

4770 
	$iwl_mvm_p2p_föd_phy_˘xt
(
iwl_mvm
 *
mvm
,

4771 
õì80211_vif
 *
vif
,

4772 
õì80211_ch™√l
 *
ch™√l
)

4774 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4775 
cfg80211_ch™_def
 
ch™def
;

4776 
i
;

4778 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4780 i‡(
mvmvif
->
deÊök
.
phy_˘xt
 &&

4781 
ch™√l
 =
mvmvif
->
deÊök
.
phy_˘xt
->channel)

4785 
i
 = 0; i < 
NUM_PHY_CTX
; i++) {

4786 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = &
mvm
->
phy_˘xts
[
i
];

4788 i‡(!
phy_˘xt
->
ªf
 || 
mvmvif
->
deÊök
.phy_ctxt ==Öhy_ctxt)

4791 i‡(
ch™√l
 =
phy_˘xt
->channel) {

4792 i‡(
mvmvif
->
deÊök
.
phy_˘xt
)

4793 
	`iwl_mvm_phy_˘xt_uƒef
(
mvm
,

4794 
mvmvif
->
deÊök
.
phy_˘xt
);

4796 
mvmvif
->
deÊök
.
phy_˘xt
 =Öhy_ctxt;

4797 
	`iwl_mvm_phy_˘xt_ªf
(
mvm
, 
mvmvif
->
deÊök
.
phy_˘xt
);

4803 i‡(
mvmvif
->
deÊök
.
phy_˘xt
)

4804 
	`iwl_mvm_phy_˘xt_uƒef
(
mvm
, 
mvmvif
->
deÊök
.
phy_˘xt
);

4806 
mvmvif
->
deÊök
.
phy_˘xt
 = 
	`iwl_mvm_gë_‰ì_phy_˘xt
(
mvm
);

4807 i‡(!
mvmvif
->
deÊök
.
phy_˘xt
)

4808  -
ENOSPC
;

4810 
	`cfg80211_ch™def_¸óã
(&
ch™def
, 
ch™√l
, 
NL80211_CHAN_NO_HT
);

4812  
	`iwl_mvm_phy_˘xt_add
(
mvm
, 
mvmvif
->
deÊök
.
phy_˘xt
,

4813 &
ch™def
, 
NULL
, 1, 1);

4814 
	}
}

4817 
	$iwl_mvm_roc_comm⁄
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

4818 
õì80211_ch™√l
 *
ch™√l
, 
duøti⁄
,

4819 
õì80211_roc_ty≥
 
ty≥
,

4820 c⁄° 
iwl_mvm_roc_›s
 *
›s
)

4822 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4823 
u32
 
lmac_id
;

4824 
ªt
;

4826 
	`IWL_DEBUG_MAC80211
(
mvm
, "íã∏(%d, %d, %d)\n", 
ch™√l
->
hw_vÆue
,

4827 
duøti⁄
, 
ty≥
);

4833 
	`Êush_w‹k
(&
mvm
->
roc_d⁄e_wk
);

4835 
	`muãx_lock
(&
mvm
->
muãx
);

4837 
vif
->
ty≥
) {

4838 
NL80211_IFTYPE_STATION
:

4839 
lmac_id
 = 
	`iwl_mvm_gë_lmac_id
(
mvm
, 
ch™√l
->
b™d
);

4842 
ªt
 = 
›s
->
	`add_aux_°a_f‹_hs20
(
mvm
, 
lmac_id
);

4843 i‡(!
ªt
)

4844 
ªt
 = 
	`iwl_mvm_roc_°©i⁄
(
mvm
, 
ch™√l
, 
vif
, 
duøti⁄
);

4845 
out_u∆ock
;

4846 
NL80211_IFTYPE_P2P_DEVICE
:

4850 
	`IWL_ERR
(
mvm
, "ROC: InvÆid vi‡ty≥=%u\n", 
vif
->
ty≥
);

4851 
ªt
 = -
EINVAL
;

4852 
out_u∆ock
;

4856 
ªt
 = 
	`iwl_mvm_p2p_föd_phy_˘xt
(
mvm
, 
vif
, 
ch™√l
);

4857 i‡(
ªt
)

4858 
out_u∆ock
;

4860 
ªt
 = 
›s
->
	`lök
(
mvm
, 
vif
);

4861 i‡(
ªt
)

4862 
out_u∆ock
;

4864 
ªt
 = 
	`iwl_mvm_°¨t_p2p_roc
(
mvm
, 
vif
, 
duøti⁄
, 
ty≥
);

4865 
out_u∆ock
:

4866 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4867 
	`IWL_DEBUG_MAC80211
(
mvm
, "leave\n");

4868  
ªt
;

4869 
	}
}

4871 
	$iwl_mvm_ˇn˚l_roc
(
õì80211_hw
 *
hw
,

4872 
õì80211_vif
 *
vif
)

4874 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4876 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4878 
	`IWL_DEBUG_MAC80211
(
mvm
, "enter\n");

4880 
	`muãx_lock
(&
mvm
->
muãx
);

4881 
	`iwl_mvm_°›_roc
(
mvm
, 
vif
);

4882 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4884 
	`IWL_DEBUG_MAC80211
(
mvm
, "leave\n");

4885 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4887 
	}
}

4889 
	siwl_mvm_·m_ª•⁄dî_ôî_d©a
 {

4890 
boﬁ
 
	mª•⁄dî
;

4891 
õì80211_ch™˘x_c⁄f
 *
	m˘x
;

4894 
	$iwl_mvm_·m_ª•⁄dî_ch™˘x_ôî
(*
_d©a
, 
u8
 *
mac
,

4895 
õì80211_vif
 *
vif
)

4897 
iwl_mvm_·m_ª•⁄dî_ôî_d©a
 *
d©a
 = 
_d©a
;

4899 i‡(
	`rcu_ac˚ss_poöãr
(
vif
->
bss_c⁄f
.
ch™˘x_c⁄f
Ë=
d©a
->
˘x
 &&

4900 
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && vif->
bss_c⁄f
.
·mr_∑øms
)

4901 
d©a
->
ª•⁄dî
 = 
åue
;

4902 
	}
}

4904 
boﬁ
 
	$iwl_mvm_is_·m_ª•⁄dî_ch™˘x
(
iwl_mvm
 *
mvm
,

4905 
õì80211_ch™˘x_c⁄f
 *
˘x
)

4907 
iwl_mvm_·m_ª•⁄dî_ôî_d©a
 
d©a
 = {

4908 .
ª•⁄dî
 = 
Ál£
,

4909 .
˘x
 = ctx,

4912 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

4913 
IEEE80211_IFACE_ITER_NORMAL
,

4914 
iwl_mvm_·m_ª•⁄dî_ch™˘x_ôî
,

4915 &
d©a
);

4916  
d©a
.
ª•⁄dî
;

4917 
	}
}

4919 
	$__iwl_mvm_add_ch™˘x
(
iwl_mvm
 *
mvm
,

4920 
õì80211_ch™˘x_c⁄f
 *
˘x
)

4922 
u16
 *
phy_˘xt_id
 = (u16 *)
˘x
->
drv_¥iv
;

4923 
iwl_mvm_phy_˘xt
 *
phy_˘xt
;

4924 
cfg80211_ch™_def
 *
def
 = 
	`iwl_mvm_ch™˘x_def
(
mvm
, 
˘x
);

4925 
ªt
;

4927 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4929 
	`IWL_DEBUG_MAC80211
(
mvm
, "Add channel context\n");

4931 
phy_˘xt
 = 
	`iwl_mvm_gë_‰ì_phy_˘xt
(
mvm
);

4932 i‡(!
phy_˘xt
) {

4933 
ªt
 = -
ENOSPC
;

4934 
out
;

4937 
ªt
 = 
	`iwl_mvm_phy_˘xt_add
(
mvm
, 
phy_˘xt
, 
def
, &
˘x
->
≠
,

4938 
˘x
->
rx_chaös_°©ic
,

4939 
˘x
->
rx_chaös_dy«mic
);

4940 i‡(
ªt
) {

4941 
	`IWL_ERR
(
mvm
, "FailedÅoádd PHY context\n");

4942 
out
;

4945 *
phy_˘xt_id
 = 
phy_˘xt
->
id
;

4946 
out
:

4947  
ªt
;

4948 
	}
}

4950 
	$iwl_mvm_add_ch™˘x
(
õì80211_hw
 *
hw
,

4951 
õì80211_ch™˘x_c⁄f
 *
˘x
)

4953 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4954 
ªt
;

4956 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4958 
	`muãx_lock
(&
mvm
->
muãx
);

4959 
ªt
 = 
	`__iwl_mvm_add_ch™˘x
(
mvm
, 
˘x
);

4960 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4962 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

4963  
ªt
;

4964 
	}
}

4966 
	$__iwl_mvm_ªmove_ch™˘x
(
iwl_mvm
 *
mvm
,

4967 
õì80211_ch™˘x_c⁄f
 *
˘x
)

4969 
u16
 *
phy_˘xt_id
 = (u16 *)
˘x
->
drv_¥iv
;

4970 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = &
mvm
->
phy_˘xts
[*
phy_˘xt_id
];

4972 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4974 
	`iwl_mvm_phy_˘xt_uƒef
(
mvm
, 
phy_˘xt
);

4975 
	}
}

4977 
	$iwl_mvm_ªmove_ch™˘x
(
õì80211_hw
 *
hw
,

4978 
õì80211_ch™˘x_c⁄f
 *
˘x
)

4980 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4982 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4984 
	`muãx_lock
(&
mvm
->
muãx
);

4985 
	`__iwl_mvm_ªmove_ch™˘x
(
mvm
, 
˘x
);

4986 
	`muãx_u∆ock
(&
mvm
->
muãx
);

4987 
	}
}

4989 
	$iwl_mvm_ch™ge_ch™˘x
(
õì80211_hw
 *
hw
,

4990 
õì80211_ch™˘x_c⁄f
 *
˘x
, 
u32
 
ch™ged
)

4992 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

4993 
u16
 *
phy_˘xt_id
 = (u16 *)
˘x
->
drv_¥iv
;

4994 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = &
mvm
->
phy_˘xts
[*
phy_˘xt_id
];

4995 
cfg80211_ch™_def
 *
def
 = 
	`iwl_mvm_ch™˘x_def
(
mvm
, 
˘x
);

4997 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

4999 i‡(
	`WARN_ONCE
((
phy_˘xt
->
ªf
 > 1) &&

5000 (
ch™ged
 & ~(
IEEE80211_CHANCTX_CHANGE_WIDTH
 |

5001 
IEEE80211_CHANCTX_CHANGE_RX_CHAINS
 |

5002 
IEEE80211_CHANCTX_CHANGE_RADAR
 |

5003 
IEEE80211_CHANCTX_CHANGE_MIN_WIDTH
)),

5005 
phy_˘xt
->
ªf
, 
ch™ged
)) {

5006 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5010 
	`muãx_lock
(&
mvm
->
muãx
);

5013 i‡(
ch™ged
 =
IEEE80211_CHANCTX_CHANGE_MIN_WIDTH
) {

5014 i‡(
phy_˘xt
->
width
 =
def
->width) {

5015 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5016 
out_u∆ock
;

5020 i‡(
phy_˘xt
->
width
 <
NL80211_CHAN_WIDTH_20
 &&

5021 
def
->
width
 <
NL80211_CHAN_WIDTH_20
) {

5022 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5023 
out_u∆ock
;

5027 
	`iwl_mvm_bt_c€x_vif_ch™ge
(
mvm
);

5028 
	`iwl_mvm_phy_˘xt_ch™ged
(
mvm
, 
phy_˘xt
, 
def
, &
˘x
->
≠
,

5029 
˘x
->
rx_chaös_°©ic
,

5030 
˘x
->
rx_chaös_dy«mic
);

5032 
out_u∆ock
:

5033 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5034 
	}
}

5042 
boﬁ


5043 
	$__iwl_mvm_assign_vif_ch™˘x_comm⁄
(
iwl_mvm
 *
mvm
,

5044 
õì80211_vif
 *
vif
,

5045 
õì80211_ch™˘x_c⁄f
 *
˘x
,

5046 
boﬁ
 
swôchög_ch™˘x
, *
ªt
)

5048 
u16
 *
phy_˘xt_id
 = (u16 *)
˘x
->
drv_¥iv
;

5049 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = &
mvm
->
phy_˘xts
[*
phy_˘xt_id
];

5050 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5052 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

5054 
mvmvif
->
deÊök
.
phy_˘xt
 =Öhy_ctxt;

5056 
vif
->
ty≥
) {

5057 
NL80211_IFTYPE_AP
:

5059 i‡(
swôchög_ch™˘x
) {

5060 
mvmvif
->
≠_ibss_a˘ive
 = 
åue
;

5063 
ÁŒthrough
;

5064 
NL80211_IFTYPE_ADHOC
:

5069 *
ªt
 = 0;

5070  
åue
;

5071 
NL80211_IFTYPE_STATION
:

5073 
NL80211_IFTYPE_MONITOR
:

5075 
mvmvif
->
ps_dißbÀd
 = 
åue
;

5078 *
ªt
 = -
EINVAL
;

5079  
åue
;

5081  
Ál£
;

5082 
	}
}

5084 
	$__iwl_mvm_assign_vif_ch™˘x
(
iwl_mvm
 *
mvm
,

5085 
õì80211_vif
 *
vif
,

5086 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

5087 
õì80211_ch™˘x_c⁄f
 *
˘x
,

5088 
boﬁ
 
swôchög_ch™˘x
)

5090 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5091 
ªt
;

5093 i‡(
	`WARN_ON
(!
lök_c⁄f
))

5094  -
EINVAL
;

5096 i‡(
	`__iwl_mvm_assign_vif_ch™˘x_comm⁄
(
mvm
, 
vif
, 
˘x
,

5097 
swôchög_ch™˘x
, &
ªt
))

5098 
out
;

5100 
ªt
 = 
	`iwl_mvm_bödög_add_vif
(
mvm
, 
vif
);

5101 i‡(
ªt
)

5102 
out
;

5108 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

5114 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

5115 
mvmvif
->
m⁄ô‹_a˘ive
 = 
åue
;

5116 
ªt
 = 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

5117 i‡(
ªt
)

5118 
out_ªmove_bödög
;

5120 
ªt
 = 
	`iwl_mvm_add_¢if_°a
(
mvm
, 
vif
);

5121 i‡(
ªt
)

5122 
out_ªmove_bödög
;

5127 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

5128 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

5129 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
, 
NULL
);

5132 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

5133 i‡(!
swôchög_ch™˘x
) {

5134 
mvmvif
->
cß_b˙_≥ndög
 = 
Ál£
;

5135 
out
;

5138 
mvmvif
->
cß_b˙_≥ndög
 = 
åue
;

5140 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

5141 
IWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
)) {

5142 
u32
 
duøti⁄
 = 5 * 
vif
->
bss_c⁄f
.
bóc⁄_öt
;

5147 
	`iwl_mvm_¥Ÿe˘_£ssi⁄
(
mvm
, 
vif
, 
duøti⁄
, duration,

5148 
vif
->
bss_c⁄f
.
bóc⁄_öt
 / 2,

5149 
åue
);

5152 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

5155 
out
;

5157 
out_ªmove_bödög
:

5158 
	`iwl_mvm_bödög_ªmove_vif
(
mvm
, 
vif
);

5159 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

5160 
out
:

5161 i‡(
ªt
)

5162 
mvmvif
->
deÊök
.
phy_˘xt
 = 
NULL
;

5163  
ªt
;

5164 
	}
}

5166 
	$iwl_mvm_assign_vif_ch™˘x
(
õì80211_hw
 *
hw
,

5167 
õì80211_vif
 *
vif
,

5168 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

5169 
õì80211_ch™˘x_c⁄f
 *
˘x
)

5171 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5172 
ªt
;

5174 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5176 
	`muãx_lock
(&
mvm
->
muãx
);

5177 
ªt
 = 
	`__iwl_mvm_assign_vif_ch™˘x
(
mvm
, 
vif
, 
lök_c⁄f
, 
˘x
, 
Ál£
);

5178 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5180 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5181  
ªt
;

5182 
	}
}

5190 
boﬁ
 
	$__iwl_mvm_u«ssign_vif_ch™˘x_comm⁄
(
iwl_mvm
 *
mvm
,

5191 
õì80211_vif
 *
vif
,

5192 
boﬁ
 
swôchög_ch™˘x
)

5194 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5196 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

5197 
	`iwl_mvm_ªmove_time_evít
(
mvm
, 
mvmvif
,

5198 &
mvmvif
->
time_evít_d©a
);

5200 
vif
->
ty≥
) {

5201 
NL80211_IFTYPE_ADHOC
:

5202  
åue
;

5203 
NL80211_IFTYPE_MONITOR
:

5204 
mvmvif
->
m⁄ô‹_a˘ive
 = 
Ál£
;

5205 
mvmvif
->
ps_dißbÀd
 = 
Ál£
;

5207 
NL80211_IFTYPE_AP
:

5209 i‡(!
swôchög_ch™˘x
 || !
mvmvif
->
≠_ibss_a˘ive
)

5210  
åue
;

5212 
mvmvif
->
cß_cou¡down
 = 
Ál£
;

5215 
	`iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
mvm
, 
mvmvif
, 
åue
);

5218 
	`rcu_assign_poöãr
(
mvm
->
cß_tx_blocked_vif
, 
vif
);

5220 
mvmvif
->
≠_ibss_a˘ive
 = 
Ál£
;

5225  
Ál£
;

5226 
	}
}

5228 
	$__iwl_mvm_u«ssign_vif_ch™˘x
(
iwl_mvm
 *
mvm
,

5229 
õì80211_vif
 *
vif
,

5230 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

5231 
õì80211_ch™˘x_c⁄f
 *
˘x
,

5232 
boﬁ
 
swôchög_ch™˘x
)

5234 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5235 
õì80211_vif
 *
dißbÀd_vif
 = 
NULL
;

5237 i‡(
	`__iwl_mvm_u«ssign_vif_ch™˘x_comm⁄
(
mvm
, 
vif
, 
swôchög_ch™˘x
))

5238 
out
;

5240 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
)

5241 
	`iwl_mvm_rm_¢if_°a
(
mvm
, 
vif
);

5244 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && 
swôchög_ch™˘x
) {

5245 
dißbÀd_vif
 = 
vif
;

5246 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

5247 
IWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
))

5248 
	`iwl_mvm_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
åue
, 
NULL
);

5251 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
dißbÀd_vif
);

5252 
	`iwl_mvm_bödög_ªmove_vif
(
mvm
, 
vif
);

5254 
out
:

5255 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
) &&

5256 
swôchög_ch™˘x
)

5258 
mvmvif
->
deÊök
.
phy_˘xt
 = 
NULL
;

5259 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

5260 
	}
}

5262 
	$iwl_mvm_u«ssign_vif_ch™˘x
(
õì80211_hw
 *
hw
,

5263 
õì80211_vif
 *
vif
,

5264 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

5265 
õì80211_ch™˘x_c⁄f
 *
˘x
)

5267 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5269 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5271 
	`muãx_lock
(&
mvm
->
muãx
);

5272 
	`__iwl_mvm_u«ssign_vif_ch™˘x
(
mvm
, 
vif
, 
lök_c⁄f
, 
˘x
, 
Ál£
);

5273 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5274 
	}
}

5277 
	$iwl_mvm_swôch_vif_ch™˘x_sw≠
(
iwl_mvm
 *
mvm
,

5278 
õì80211_vif_ch™˘x_swôch
 *
vifs
,

5279 c⁄° 
iwl_mvm_swôch_vif_ch™˘x_›s
 *
›s
)

5281 
ªt
;

5283 
	`muãx_lock
(&
mvm
->
muãx
);

5284 
›s
->
	`__u«ssign_vif_ch™˘x
(
mvm
, 
vifs
[0].
vif
, vifs[0].
lök_c⁄f
,

5285 
vifs
[0].
ﬁd_˘x
, 
åue
);

5286 
	`__iwl_mvm_ªmove_ch™˘x
(
mvm
, 
vifs
[0].
ﬁd_˘x
);

5288 
ªt
 = 
	`__iwl_mvm_add_ch™˘x
(
mvm
, 
vifs
[0].
√w_˘x
);

5289 i‡(
ªt
) {

5290 
	`IWL_ERR
(
mvm
, "failedÅoáddÇew_ctx during channel switch\n");

5291 
out_ªassign
;

5294 
ªt
 = 
›s
->
	`__assign_vif_ch™˘x
(
mvm
, 
vifs
[0].
vif
, vifs[0].
lök_c⁄f
,

5295 
vifs
[0].
√w_˘x
, 
åue
);

5296 i‡(
ªt
) {

5297 
	`IWL_ERR
(
mvm
,

5299 
out_ªmove
;

5303 i‡(
	`iwl_mvm_phy_˘x_cou¡
(
mvm
) > 1)

5304 
	`iwl_mvm_ã¨down_tdls_≥îs
(
mvm
);

5306 
out
;

5308 
out_ªmove
:

5309 
	`__iwl_mvm_ªmove_ch™˘x
(
mvm
, 
vifs
[0].
√w_˘x
);

5311 
out_ªassign
:

5312 i‡(
	`__iwl_mvm_add_ch™˘x
(
mvm
, 
vifs
[0].
ﬁd_˘x
)) {

5313 
	`IWL_ERR
(
mvm
, "failedÅoádd old_ctx backáfter failure.\n");

5314 
out_ª°¨t
;

5317 i‡(
›s
->
	`__assign_vif_ch™˘x
(
mvm
, 
vifs
[0].
vif
, vifs[0].
lök_c⁄f
,

5318 
vifs
[0].
ﬁd_˘x
, 
åue
)) {

5319 
	`IWL_ERR
(
mvm
, "failedÅoÑeassign old_ctxáfter failure.\n");

5320 
out_ª°¨t
;

5323 
out
;

5325 
out_ª°¨t
:

5327 
	`iwl_mvm_nic_ª°¨t
(
mvm
, 
Ál£
);

5329 
out
:

5330 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5332  
ªt
;

5333 
	}
}

5336 
	$iwl_mvm_swôch_vif_ch™˘x_ªassign
(
iwl_mvm
 *
mvm
,

5337 
õì80211_vif_ch™˘x_swôch
 *
vifs
,

5338 c⁄° 
iwl_mvm_swôch_vif_ch™˘x_›s
 *
›s
)

5340 
ªt
;

5342 
	`muãx_lock
(&
mvm
->
muãx
);

5343 
›s
->
	`__u«ssign_vif_ch™˘x
(
mvm
, 
vifs
[0].
vif
, vifs[0].
lök_c⁄f
,

5344 
vifs
[0].
ﬁd_˘x
, 
åue
);

5346 
ªt
 = 
›s
->
	`__assign_vif_ch™˘x
(
mvm
, 
vifs
[0].
vif
, vifs[0].
lök_c⁄f
,

5347 
vifs
[0].
√w_˘x
, 
åue
);

5348 i‡(
ªt
) {

5349 
	`IWL_ERR
(
mvm
,

5351 
out_ªassign
;

5354 
out
;

5356 
out_ªassign
:

5357 i‡(
›s
->
	`__assign_vif_ch™˘x
(
mvm
, 
vifs
[0].
vif
, vifs[0].
lök_c⁄f
,

5358 
vifs
[0].
ﬁd_˘x
, 
åue
)) {

5359 
	`IWL_ERR
(
mvm
, "failedÅoÑeassign old_ctxáfter failure.\n");

5360 
out_ª°¨t
;

5363 
out
;

5365 
out_ª°¨t
:

5367 
	`iwl_mvm_nic_ª°¨t
(
mvm
, 
Ál£
);

5369 
out
:

5370 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5372  
ªt
;

5373 
	}
}

5377 
	$iwl_mvm_swôch_vif_ch™˘x_comm⁄
(
õì80211_hw
 *
hw
,

5378 
õì80211_vif_ch™˘x_swôch
 *
vifs
,

5379 
n_vifs
,

5380 
õì80211_ch™˘x_swôch_mode
 
mode
,

5381 c⁄° 
iwl_mvm_swôch_vif_ch™˘x_›s
 *
›s
)

5383 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5384 
ªt
;

5387 i‡(
n_vifs
 > 1)

5388  -
EOPNOTSUPP
;

5390 
mode
) {

5391 
CHANCTX_SWMODE_SWAP_CONTEXTS
:

5392 
ªt
 = 
	`iwl_mvm_swôch_vif_ch™˘x_sw≠
(
mvm
, 
vifs
, 
›s
);

5394 
CHANCTX_SWMODE_REASSIGN_VIF
:

5395 
ªt
 = 
	`iwl_mvm_swôch_vif_ch™˘x_ªassign
(
mvm
, 
vifs
, 
›s
);

5398 
ªt
 = -
EOPNOTSUPP
;

5402  
ªt
;

5403 
	}
}

5405 
	$iwl_mvm_swôch_vif_ch™˘x
(
õì80211_hw
 *
hw
,

5406 
õì80211_vif_ch™˘x_swôch
 *
vifs
,

5407 
n_vifs
,

5408 
õì80211_ch™˘x_swôch_mode
 
mode
)

5410 c⁄° 
iwl_mvm_swôch_vif_ch™˘x_›s
 
›s
 = {

5411 .
__assign_vif_ch™˘x
 = 
__iwl_mvm_assign_vif_ch™˘x
,

5412 .
__u«ssign_vif_ch™˘x
 = 
__iwl_mvm_u«ssign_vif_ch™˘x
,

5415 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5416 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5417  
	`iwl_mvm_swôch_vif_ch™˘x_comm⁄
(
hw
, 
vifs
, 
n_vifs
, 
mode
, &
›s
);

5418 
	}
}

5420 
	$iwl_mvm_tx_œ°_bóc⁄
(
õì80211_hw
 *
hw
)

5422 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5424 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5425 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5426  
mvm
->
ibss_m™agî
;

5427 
	}
}

5429 
	$iwl_mvm_£t_tim
(
õì80211_hw
 *
hw
, 
õì80211_°a
 *
°a
,

5430 
boﬁ
 
£t
)

5432 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5433 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

5435 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5437 i‡(!
mvm_°a
 || !mvm_°a->
vif
) {

5438 
	`IWL_ERR
(
mvm
, "Station isÇotássociatedÅoá vif\n");

5439 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5440  -
EINVAL
;

5443 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5444  
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
mvm_°a
->
vif
,

5445 &
mvm_°a
->
vif
->
bss_c⁄f
);

5446 
	}
}

5448 #ifde‡
CONFIG_NL80211_TESTMODE


5449 c⁄° 
∆a_pﬁicy
 
	giwl_mvm_tm_pﬁicy
[
IWL_MVM_TM_ATTR_MAX
 + 1] = {

5450 [
IWL_MVM_TM_ATTR_CMD
] = { .
ty≥
 = 
NLA_U32
 },

5451 [
IWL_MVM_TM_ATTR_NOA_DURATION
] = { .
ty≥
 = 
NLA_U32
 },

5452 [
IWL_MVM_TM_ATTR_BEACON_FILTER_STATE
] = { .
ty≥
 = 
NLA_U32
 },

5455 
	$__iwl_mvm_mac_ã°mode_cmd
(
iwl_mvm
 *
mvm
,

5456 
õì80211_vif
 *
vif
,

5457 *
d©a
, 
Àn
)

5459 
∆©å
 *
tb
[
IWL_MVM_TM_ATTR_MAX
 + 1];

5460 
îr
;

5461 
u32
 
nﬂ_duøti⁄
;

5463 
îr
 = 
	`∆a_∑r£_dïªˇãd
(
tb
, 
IWL_MVM_TM_ATTR_MAX
, 
d©a
, 
Àn
,

5464 
iwl_mvm_tm_pﬁicy
, 
NULL
);

5465 i‡(
îr
)

5466  
îr
;

5468 i‡(!
tb
[
IWL_MVM_TM_ATTR_CMD
])

5469  -
EINVAL
;

5471 
	`∆a_gë_u32
(
tb
[
IWL_MVM_TM_ATTR_CMD
])) {

5472 
IWL_MVM_TM_CMD_SET_NOA
:

5473 i‡(!
vif
 || vif->
ty≥
 !
NL80211_IFTYPE_AP
 || !vif->
p2p
 ||

5474 !
vif
->
bss_c⁄f
.
íabÀ_bóc⁄
 ||

5475 !
tb
[
IWL_MVM_TM_ATTR_NOA_DURATION
])

5476  -
EINVAL
;

5478 
nﬂ_duøti⁄
 = 
	`∆a_gë_u32
(
tb
[
IWL_MVM_TM_ATTR_NOA_DURATION
]);

5479 i‡(
nﬂ_duøti⁄
 >
vif
->
bss_c⁄f
.
bóc⁄_öt
)

5480  -
EINVAL
;

5482 
mvm
->
nﬂ_duøti⁄
 =Çoa_duration;

5483 
mvm
->
nﬂ_vif
 = 
vif
;

5485  
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
åue
, 
NULL
);

5486 
IWL_MVM_TM_CMD_SET_BEACON_FILTER
:

5488 i‡(!
vif
 || vif->
ty≥
 !
NL80211_IFTYPE_STATION
 ||

5489 !
vif
->
cfg
.
assoc
 || !vif->
bss_c⁄f
.
dtim_≥riod
 ||

5490 !
tb
[
IWL_MVM_TM_ATTR_BEACON_FILTER_STATE
])

5491  -
EINVAL
;

5493 i‡(
	`∆a_gë_u32
(
tb
[
IWL_MVM_TM_ATTR_BEACON_FILTER_STATE
]))

5494  
	`iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

5495  
	`iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

5498  -
EOPNOTSUPP
;

5499 
	}
}

5501 
	$iwl_mvm_mac_ã°mode_cmd
(
õì80211_hw
 *
hw
,

5502 
õì80211_vif
 *
vif
,

5503 *
d©a
, 
Àn
)

5505 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5506 
îr
;

5508 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5510 
	`muãx_lock
(&
mvm
->
muãx
);

5511 
îr
 = 
	`__iwl_mvm_mac_ã°mode_cmd
(
mvm
, 
vif
, 
d©a
, 
Àn
);

5512 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5514 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5515  
îr
;

5516 
	}
}

5519 
	$iwl_mvm_ch™√l_swôch
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

5520 
õì80211_ch™√l_swôch
 *
chsw
)

5528 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5529 
	`IWL_DEBUG_MAC80211
(
	`IWL_MAC80211_GET_MVM
(
hw
),

5531 
	}
}

5533 
	$iwl_mvm_scheduÀ_˛õ¡_cß
(
iwl_mvm
 *
mvm
,

5534 
õì80211_vif
 *
vif
,

5535 
õì80211_ch™√l_swôch
 *
chsw
)

5537 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5538 
iwl_ch™_swôch_ã_cmd
 
cmd
 = {

5539 .
mac_id
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

5540 
mvmvif
->
cﬁ‹
)),

5541 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
),

5542 .
tsf
 = 
	`˝u_to_À32
(
chsw
->
time°amp
),

5543 .
cs_cou¡
 = 
chsw
->
cou¡
,

5544 .
cs_mode
 = 
chsw
->
block_tx
,

5547 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

5549 i‡(
chsw
->
dñay
)

5550 
cmd
.
cs_dñayed_b˙_cou¡
 =

5551 
	`DIV_ROUND_UP
(
chsw
->
dñay
, 
vif
->
bss_c⁄f
.
bóc⁄_öt
);

5553  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

5554 
	`WIDE_ID
(
MAC_CONF_GROUP
,

5555 
CHANNEL_SWITCH_TIME_EVENT_CMD
),

5556 0, (
cmd
), &cmd);

5557 
	}
}

5559 
	$iwl_mvm_ﬁd_¥e_ch™_sw_°a
(
iwl_mvm
 *
mvm
,

5560 
õì80211_vif
 *
vif
,

5561 
õì80211_ch™√l_swôch
 *
chsw
)

5563 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5564 
u32
 
≠∂y_time
;

5572 i‡(
chsw
->
cou¡
 <= 1)

5573 
≠∂y_time
 = 0;

5575 
≠∂y_time
 = 
chsw
->
devi˚_time°amp
 +

5576 ((
vif
->
bss_c⁄f
.
bóc⁄_öt
 * (
chsw
->
cou¡
 - 1) -

5577 
IWL_MVM_CHANNEL_SWITCH_TIME_CLIENT
) * 1024);

5579 i‡(
chsw
->
block_tx
)

5580 
	`iwl_mvm_cß_˛õ¡_ab£¡
(
mvm
, 
vif
);

5582 i‡(
mvmvif
->
bf_d©a
.
bf_íabÀd
) {

5583 
ªt
 = 
	`iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

5585 i‡(
ªt
)

5586  
ªt
;

5589 
	`iwl_mvm_scheduÀ_cß_≥riod
(
mvm
, 
vif
, vif->
bss_c⁄f
.
bóc⁄_öt
,

5590 
≠∂y_time
);

5593 
	}
}

5595 
	#IWL_MAX_CSA_BLOCK_TX
 1500

	)

5596 
	$iwl_mvm_¥e_ch™√l_swôch
(
õì80211_hw
 *
hw
,

5597 
õì80211_vif
 *
vif
,

5598 
õì80211_ch™√l_swôch
 *
chsw
)

5600 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5601 
õì80211_vif
 *
cß_vif
;

5602 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5603 
ªt
;

5605 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5607 
	`muãx_lock
(&
mvm
->
muãx
);

5609 
mvmvif
->
cß_Áûed
 = 
Ál£
;

5611 
	`IWL_DEBUG_MAC80211
(
mvm
, "pre CSAÅo freq %d\n",

5612 
chsw
->
ch™def
.
˚¡î_‰eq1
);

5614 
	`iwl_fw_dbg_åiggî_sim∂e_°›
(&
mvm
->
fwπ
,

5615 
	`õì80211_vif_to_wdev
(
vif
),

5616 
FW_DBG_TRIGGER_CHANNEL_SWITCH
);

5618 
vif
->
ty≥
) {

5619 
NL80211_IFTYPE_AP
:

5620 
cß_vif
 =

5621 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
cß_vif
,

5622 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

5623 i‡(
	`WARN_ONCE
(
cß_vif
 && cß_vif->
bss_c⁄f
.
cß_a˘ive
,

5625 
ªt
 = -
EBUSY
;

5626 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5627 
out_u∆ock
;

5631 i‡(
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
cß_tx_blocked_vif
,

5632 
	`lockdï_is_hñd
(&
mvm
->
muãx
))) {

5633 
ªt
 = -
EBUSY
;

5634 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5635 
out_u∆ock
;

5638 
	`rcu_assign_poöãr
(
mvm
->
cß_vif
, 
vif
);

5640 i‡(
	`WARN_ONCE
(
mvmvif
->
cß_cou¡down
,

5642 
ªt
 = -
EBUSY
;

5643 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5644 
out_u∆ock
;

5647 
mvmvif
->
cß_èrgë_‰eq
 = 
chsw
->
ch™def
.
ch™
->
˚¡î_‰eq
;

5649 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5651 
NL80211_IFTYPE_STATION
:

5656 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
MAC_CONF_GROUP
,

5657 
CHANNEL_SWITCH_ERROR_NOTIF
,

5659 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5668 i‡(!
vif
->
cfg
.
assoc
 || !vif->
bss_c⁄f
.
dtim_≥riod
) {

5669 
ªt
 = -
EBUSY
;

5670 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5671 
out_u∆ock
;

5674 i‡(
chsw
->
dñay
 > 
IWL_MAX_CSA_BLOCK_TX
 &&

5675 
	`hweight16
(
vif
->
vÆid_löks
) <= 1)

5676 
	`scheduÀ_dñayed_w‹k
(&
mvmvif
->
cß_w‹k
, 0);

5678 i‡(
chsw
->
block_tx
) {

5683 i‡(!
chsw
->
cou¡
 ||

5684 
chsw
->
cou¡
 * 
vif
->
bss_c⁄f
.
bóc⁄_öt
 >

5685 
IWL_MAX_CSA_BLOCK_TX
)

5686 
	`scheduÀ_dñayed_w‹k
(&
mvmvif
->
cß_w‹k
,

5687 
	`m£cs_to_jiffõs
(
IWL_MAX_CSA_BLOCK_TX
));

5690 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

5691 
IWL_UCODE_TLV_CAPA_CHANNEL_SWITCH_CMD
)) {

5692 
ªt
 = 
	`iwl_mvm_ﬁd_¥e_ch™_sw_°a
(
mvm
, 
vif
, 
chsw
);

5693 i‡(
ªt
) {

5694 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5695 
out_u∆ock
;

5698 
	`iwl_mvm_scheduÀ_˛õ¡_cß
(
mvm
, 
vif
, 
chsw
);

5701 
mvmvif
->
cß_cou¡
 = 
chsw
->
cou¡
;

5702 
mvmvif
->
cß_misbehave
 = 
Ál£
;

5703 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5706 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5710 
mvmvif
->
ps_dißbÀd
 = 
åue
;

5712 
ªt
 = 
	`iwl_mvm_powî_upd©e_ps
(
mvm
);

5713 i‡(
ªt
) {

5714 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5715 
out_u∆ock
;

5719 
	`iwl_mvm_ã¨down_tdls_≥îs
(
mvm
);

5721 
out_u∆ock
:

5722 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5724 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5725  
ªt
;

5726 
	}
}

5728 
	$iwl_mvm_ch™√l_swôch_rx_bóc⁄
(
õì80211_hw
 *
hw
,

5729 
õì80211_vif
 *
vif
,

5730 
õì80211_ch™√l_swôch
 *
chsw
)

5732 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5733 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5734 
iwl_ch™_swôch_ã_cmd
 
cmd
 = {

5735 .
mac_id
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

5736 
mvmvif
->
cﬁ‹
)),

5737 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_MODIFY
),

5738 .
tsf
 = 
	`˝u_to_À32
(
chsw
->
time°amp
),

5739 .
cs_cou¡
 = 
chsw
->
cou¡
,

5740 .
cs_mode
 = 
chsw
->
block_tx
,

5743 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5749 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
MAC_CONF_GROUP
,

5750 
CHANNEL_SWITCH_ERROR_NOTIF
, 0)) {

5751 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5755 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_CS_MODIFY
)) {

5756 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5760 
	`IWL_DEBUG_MAC80211
(
mvm
, "Modify CSA on mac %d count = %d (old %d) mode = %d\n",

5761 
mvmvif
->
id
, 
chsw
->
cou¡
, mvmvif->
cß_cou¡
, chsw->
block_tx
);

5763 i‡(
chsw
->
cou¡
 >
mvmvif
->
cß_cou¡
 && chsw->
block_tx
) {

5764 i‡(
mvmvif
->
cß_misbehave
) {

5765 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

5769 
lök_c⁄f
 = 
	`wùhy_dîe„ªn˚
(
hw
->
wùhy
,

5770 
vif
->
lök_c⁄f
[
chsw
->
lök_id
]);

5771 i‡(
	`WARN_ON
(!
lök_c⁄f
)) {

5772 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5776 
	`iwl_mvm_ab‹t_ch™√l_swôch
(
hw
, 
vif
, 
lök_c⁄f
);

5777 
	`õì80211_chswôch_d⁄e
(
vif
, 
Ál£
, 0);

5778 
mvmvif
->
cß_misbehave
 = 
Ál£
;

5779 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5782 
mvmvif
->
cß_misbehave
 = 
åue
;

5784 
mvmvif
->
cß_cou¡
 = 
chsw
->
cou¡
;

5786 
	`muãx_lock
(&
mvm
->
muãx
);

5787 i‡(
mvmvif
->
cß_Áûed
) {

5788 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5789 
out_u∆ock
;

5792 
	`WARN_ON
(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

5793 
	`WIDE_ID
(
MAC_CONF_GROUP
,

5794 
CHANNEL_SWITCH_TIME_EVENT_CMD
),

5795 0, (
cmd
), &cmd));

5796 
out_u∆ock
:

5797 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5798 
	}
}

5800 
	$iwl_mvm_Êush_no_vif
(
iwl_mvm
 *
mvm
, 
u32
 
queues
, 
boﬁ
 
dr›
)

5802 
i
;

5804 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

5805 i‡(
dr›
) {

5806 
	`muãx_lock
(&
mvm
->
muãx
);

5807 
	`iwl_mvm_Êush_tx_∑th
(
mvm
,

5808 
	`iwl_mvm_ÊushabÀ_queues
(
mvm
Ë& 
queues
);

5809 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5811 
	`iwl_å™s_waô_tx_queues_em±y
(
mvm
->
å™s
, 
queues
);

5816 
	`muãx_lock
(&
mvm
->
muãx
);

5817 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

5818 
õì80211_°a
 *
°a
;

5820 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
i
],

5821 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

5822 i‡(
	`IS_ERR_OR_NULL
(
°a
))

5825 i‡(
dr›
)

5826 
	`iwl_mvm_Êush_°a_tids
(
mvm
, 
i
, 0xFFFF);

5828 
	`iwl_mvm_waô_°a_queues_em±y
(
mvm
,

5829 
	`iwl_mvm_°a_‰om_mac80211
(
°a
));

5831 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5832 
	}
}

5834 
	$iwl_mvm_mac_Êush
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

5835 
u32
 
queues
, 
boﬁ
 
dr›
)

5837 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5838 
iwl_mvm_vif
 *
mvmvif
;

5839 
iwl_mvm_°a
 *
mvm°a
;

5840 
õì80211_°a
 *
°a
;

5841 
boﬁ
 
≠_°a_d⁄e
 = 
Ál£
;

5842 
i
;

5843 
u32
 
msk
 = 0;

5845 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5847 i‡(!
vif
) {

5848 
	`iwl_mvm_Êush_no_vif
(
mvm
, 
queues
, 
dr›
);

5849 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5854 
	`Êush_w‹k
(&
mvm
->
add_°ªam_wk
);

5856 
	`muãx_lock
(&
mvm
->
muãx
);

5857 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

5860 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

5861 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
i
],

5862 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

5863 i‡(
	`IS_ERR_OR_NULL
(
°a
))

5866 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

5867 i‡(
mvm°a
->
vif
 != vif)

5870 i‡(
°a
 =
mvmvif
->
≠_°a
) {

5871 i‡(
≠_°a_d⁄e
)

5873 
≠_°a_d⁄e
 = 
åue
;

5876 i‡(
dr›
) {

5877 i‡(
	`iwl_mvm_Êush_°a
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
,

5878 
mvm°a
->
tfd_queue_msk
))

5879 
	`IWL_ERR
(
mvm
, "flushÑequest fail\n");

5881 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

5882 
	`iwl_mvm_waô_°a_queues_em±y
(
mvm
, 
mvm°a
);

5884 
msk
 |
mvm°a
->
tfd_queue_msk
;

5888 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5893 i‡(!
dr›
 && !
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

5894 
	`iwl_å™s_waô_tx_queues_em±y
(
mvm
->
å™s
, 
msk
);

5895 
	}
}

5897 
	$iwl_mvm_mac_Êush_°a
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

5898 
õì80211_°a
 *
°a
)

5900 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

5901 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5902 
iwl_mvm_lök_°a
 *
mvm_lök_°a
;

5903 
õì80211_lök_°a
 *
lök_°a
;

5904 
lök_id
;

5906 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5908 
	`muãx_lock
(&
mvm
->
muãx
);

5909 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

5910 
mvm_lök_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm°a
->
lök
[
lök_id
],

5911 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

5912 i‡(!
mvm_lök_°a
)

5915 i‡(
	`iwl_mvm_Êush_°a
(
mvm
, 
mvm_lök_°a
->
°a_id
,

5916 
mvm°a
->
tfd_queue_msk
))

5917 
	`IWL_ERR
(
mvm
, "flushÑequest fail\n");

5919 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5920 
	}
}

5922 
	$iwl_mvm_mac_gë_survey
(
õì80211_hw
 *
hw
, 
idx
,

5923 
survey_öfo
 *
survey
)

5925 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

5926 
ªt
 = 0;

5927 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

5928 
	`WIDE_ID
(
SYSTEM_GROUP
,

5929 
SYSTEM_STATISTICS_CMD
),

5930 
IWL_FW_CMD_VER_UNKNOWN
);

5932 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

5934 
	`mem£t
(
survey
, 0, (*survey));

5937 i‡(
idx
 != 0) {

5938 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5939  -
ENOENT
;

5942 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

5943 
IWL_UCODE_TLV_CAPA_RADIO_BEACON_STATS
)) {

5944 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5945  -
ENOENT
;

5948 
	`muãx_lock
(&
mvm
->
muãx
);

5950 i‡(
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
)) {

5951 
ªt
 = 
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
Ál£
);

5952 i‡(
ªt
) {

5953 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5954 
out
;

5958 
survey
->
fûÀd
 = 
SURVEY_INFO_TIME_RX
 |

5959 
SURVEY_INFO_TIME_TX
;

5961 
survey
->
time_rx
 = 
mvm
->
accu_ødio_°©s
.
rx_time
 +

5962 
mvm
->
ødio_°©s
.
rx_time
;

5963 
	`do_div
(
survey
->
time_rx
, 
USEC_PER_MSEC
);

5965 
survey
->
time_tx
 = 
mvm
->
accu_ødio_°©s
.
tx_time
 +

5966 
mvm
->
ødio_°©s
.
tx_time
;

5967 
	`do_div
(
survey
->
time_tx
, 
USEC_PER_MSEC
);

5970 i‡(
cmd_vî
 !
IWL_FW_CMD_VER_UNKNOWN
) {

5971 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5972 
out
;

5975 
survey
->
fûÀd
 |
SURVEY_INFO_TIME
 |

5976 
SURVEY_INFO_TIME_SCAN
;

5977 
survey
->
time
 = 
mvm
->
accu_ødio_°©s
.
⁄_time_rf
 +

5978 
mvm
->
ødio_°©s
.
⁄_time_rf
;

5979 
	`do_div
(
survey
->
time
, 
USEC_PER_MSEC
);

5981 
survey
->
time_sˇn
 = 
mvm
->
accu_ødio_°©s
.
⁄_time_sˇn
 +

5982 
mvm
->
ødio_°©s
.
⁄_time_sˇn
;

5983 
	`do_div
(
survey
->
time_sˇn
, 
USEC_PER_MSEC
);

5985 
out
:

5986 
	`muãx_u∆ock
(&
mvm
->
muãx
);

5987 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

5988  
ªt
;

5989 
	}
}

5991 
	$iwl_mvm_£t_°a_øã
(
u32
 
øã_n_Êags
, 
øã_öfo
 *
röfo
)

5993 
u32
 
f‹m©
 = 
øã_n_Êags
 & 
RATE_MCS_MOD_TYPE_MSK
;

5994 
u32
 
gi_…f
;

5996 
øã_n_Êags
 & 
RATE_MCS_CHAN_WIDTH_MSK
) {

5997 
RATE_MCS_CHAN_WIDTH_20
:

5998 
röfo
->
bw
 = 
RATE_INFO_BW_20
;

6000 
RATE_MCS_CHAN_WIDTH_40
:

6001 
röfo
->
bw
 = 
RATE_INFO_BW_40
;

6003 
RATE_MCS_CHAN_WIDTH_80
:

6004 
röfo
->
bw
 = 
RATE_INFO_BW_80
;

6006 
RATE_MCS_CHAN_WIDTH_160
:

6007 
röfo
->
bw
 = 
RATE_INFO_BW_160
;

6009 
RATE_MCS_CHAN_WIDTH_320
:

6010 
röfo
->
bw
 = 
RATE_INFO_BW_320
;

6014 i‡(
f‹m©
 =
RATE_MCS_CCK_MSK
 ||

6015 
f‹m©
 =
RATE_MCS_LEGACY_OFDM_MSK
) {

6016 
øã
 = 
	`u32_gë_bôs
(
øã_n_Êags
, 
RATE_LEGACY_RATE_MSK
);

6019 i‡(
f‹m©
 =
RATE_MCS_LEGACY_OFDM_MSK
)

6020 
øã
 +
IWL_FIRST_OFDM_RATE
;

6022 
øã
) {

6023 
IWL_RATE_1M_INDEX
:

6024 
röfo
->
Àgacy
 = 10;

6026 
IWL_RATE_2M_INDEX
:

6027 
röfo
->
Àgacy
 = 20;

6029 
IWL_RATE_5M_INDEX
:

6030 
röfo
->
Àgacy
 = 55;

6032 
IWL_RATE_11M_INDEX
:

6033 
röfo
->
Àgacy
 = 110;

6035 
IWL_RATE_6M_INDEX
:

6036 
röfo
->
Àgacy
 = 60;

6038 
IWL_RATE_9M_INDEX
:

6039 
röfo
->
Àgacy
 = 90;

6041 
IWL_RATE_12M_INDEX
:

6042 
röfo
->
Àgacy
 = 120;

6044 
IWL_RATE_18M_INDEX
:

6045 
röfo
->
Àgacy
 = 180;

6047 
IWL_RATE_24M_INDEX
:

6048 
röfo
->
Àgacy
 = 240;

6050 
IWL_RATE_36M_INDEX
:

6051 
röfo
->
Àgacy
 = 360;

6053 
IWL_RATE_48M_INDEX
:

6054 
röfo
->
Àgacy
 = 480;

6056 
IWL_RATE_54M_INDEX
:

6057 
röfo
->
Àgacy
 = 540;

6062 
röfo
->
nss
 = 
	`u32_gë_bôs
(
øã_n_Êags
,

6063 
RATE_MCS_NSS_MSK
) + 1;

6064 
röfo
->
mcs
 = 
f‹m©
 =
RATE_MCS_HT_MSK
 ?

6065 
	`RATE_HT_MCS_INDEX
(
øã_n_Êags
) :

6066 
	`u32_gë_bôs
(
øã_n_Êags
, 
RATE_MCS_CODE_MSK
);

6068 i‡(
øã_n_Êags
 & 
RATE_MCS_SGI_MSK
)

6069 
röfo
->
Êags
 |
RATE_INFO_FLAGS_SHORT_GI
;

6071 
f‹m©
) {

6072 
RATE_MCS_EHT_MSK
:

6074 
röfo
->
Êags
 |
RATE_INFO_FLAGS_EHT_MCS
;

6076 
RATE_MCS_HE_MSK
:

6077 
gi_…f
 = 
	`u32_gë_bôs
(
øã_n_Êags
, 
RATE_MCS_HE_GI_LTF_MSK
);

6079 
röfo
->
Êags
 |
RATE_INFO_FLAGS_HE_MCS
;

6081 i‡(
øã_n_Êags
 & 
RATE_MCS_HE_106T_MSK
) {

6082 
röfo
->
bw
 = 
RATE_INFO_BW_HE_RU
;

6083 
röfo
->
he_ru_Æloc
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_106
;

6086 
øã_n_Êags
 & 
RATE_MCS_HE_TYPE_MSK
) {

6087 
RATE_MCS_HE_TYPE_SU
:

6088 
RATE_MCS_HE_TYPE_EXT_SU
:

6089 i‡(
gi_…f
 == 0 || gi_ltf == 1)

6090 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_0_8
;

6091 i‡(
gi_…f
 == 2)

6092 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_1_6
;

6093 i‡(
gi_…f
 == 3)

6094 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_3_2
;

6096 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_0_8
;

6098 
RATE_MCS_HE_TYPE_MU
:

6099 i‡(
gi_…f
 == 0 || gi_ltf == 1)

6100 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_0_8
;

6101 i‡(
gi_…f
 == 2)

6102 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_1_6
;

6104 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_3_2
;

6106 
RATE_MCS_HE_TYPE_TRIG
:

6107 i‡(
gi_…f
 == 0 || gi_ltf == 1)

6108 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_1_6
;

6110 
röfo
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_3_2
;

6114 i‡(
øã_n_Êags
 & 
RATE_HE_DUAL_CARRIER_MODE_MSK
)

6115 
röfo
->
he_dcm
 = 1;

6117 
RATE_MCS_HT_MSK
:

6118 
röfo
->
Êags
 |
RATE_INFO_FLAGS_MCS
;

6120 
RATE_MCS_VHT_MSK
:

6121 
röfo
->
Êags
 |
RATE_INFO_FLAGS_VHT_MCS
;

6124 
	}
}

6126 
	$iwl_mvm_mac_°a_°©i°ics
(
õì80211_hw
 *
hw
,

6127 
õì80211_vif
 *
vif
,

6128 
õì80211_°a
 *
°a
,

6129 
°©i⁄_öfo
 *
söfo
)

6131 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6132 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

6133 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

6134 
i
;

6136 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6138 i‡(
mvm°a
->
deÊök
.
avg_íîgy
) {

6139 
söfo
->
sig«l_avg
 = -(
s8
)
mvm°a
->
deÊök
.
avg_íîgy
;

6140 
söfo
->
fûÀd
 |
	`BIT_ULL
(
NL80211_STA_INFO_SIGNAL_AVG
);

6143 i‡(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)) {

6144 
iwl_lq_°a_rs_fw
 *
lq_°a
 = &
mvm°a
->
deÊök
.lq_°a.
rs_fw
;

6146 
	`iwl_mvm_£t_°a_øã
(
lq_°a
->
œ°_øã_n_Êags
, &
söfo
->
txøã
);

6147 
söfo
->
fûÀd
 |
	`BIT_ULL
(
NL80211_STA_INFO_TX_BITRATE
);

6151 i‡(!(
vif
->
drivî_Êags
 & 
IEEE80211_VIF_BEACON_FILTER
)) {

6152 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6156 i‡(!
vif
->
cfg
.
assoc
) {

6157 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6161 
	`muãx_lock
(&
mvm
->
muãx
);

6163 i‡(
mvmvif
->
deÊök
.
≠_°a_id
 !
mvm°a
->deÊök.
°a_id
) {

6164 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6165 
u∆ock
;

6168 i‡(
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
Ál£
)) {

6169 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6170 
u∆ock
;

6173 
söfo
->
rx_bóc⁄
 = 0;

6174 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
)

6175 
söfo
->
rx_bóc⁄
 +
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
.
num_bóc⁄s
 +

6176 
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
.
accu_num_bóc⁄s
;

6178 
söfo
->
fûÀd
 |
	`BIT_ULL
(
NL80211_STA_INFO_BEACON_RX
);

6179 i‡(
mvmvif
->
deÊök
.
bóc⁄_°©s
.
avg_sig«l
) {

6181 
söfo
->
rx_bóc⁄_sig«l_avg
 =

6182 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
avg_sig«l
;

6183 
söfo
->
fûÀd
 |
	`BIT_ULL
(
NL80211_STA_INFO_BEACON_SIGNAL_AVG
);

6185 
u∆ock
:

6186 
	`muãx_u∆ock
(&
mvm
->
muãx
);

6187 
	}
}

6189 
	$iwl_mvm_evít_mlme_ˇŒback_öi
(
iwl_mvm
 *
mvm
,

6190 
õì80211_vif
 *
vif
,

6191 c⁄° 
õì80211_mlme_evít
 *
mlme
)

6193 i‡((
mlme
->
d©a
 =
ASSOC_EVENT
 || mlme->d©®=
AUTH_EVENT
) &&

6194 (
mlme
->
°©us
 =
MLME_DENIED
 || mlme->°©u†=
MLME_TIMEOUT
)) {

6195 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

6196 
IWL_FW_INI_TIME_POINT_ASSOC_FAILED
,

6197 
NULL
);

6201 i‡(
mlme
->
d©a
 =
DEAUTH_RX_EVENT
 || mlme->d©®=
DEAUTH_TX_EVENT
) {

6202 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

6203 
IWL_FW_INI_TIME_POINT_DEASSOC
,

6204 
NULL
);

6207 
	}
}

6209 
	$iwl_mvm_evít_mlme_ˇŒback
(
iwl_mvm
 *
mvm
,

6210 
õì80211_vif
 *
vif
,

6211 c⁄° 
õì80211_evít
 *
evít
)

6213 
	#CHECK_MLME_TRIGGER
(
_˙t
, 
_fmt
...) \

6215 i‡((
åig_mlme
->
_˙t
) && --(trig_mlme->_cnt)) \

6217 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&(
mvm
)->
fwπ
, 
åig
, 
_fmt
); \

6218 } 0)

	)

6220 
iwl_fw_dbg_åiggî_év
 *
åig
;

6221 
iwl_fw_dbg_åiggî_mlme
 *
åig_mlme
;

6223 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
mvm
->
å™s
)) {

6224 
	`iwl_mvm_evít_mlme_ˇŒback_öi
(
mvm
, 
vif
, &
evít
->
u
.
mlme
);

6228 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

6229 
FW_DBG_TRIGGER_MLME
);

6230 i‡(!
åig
)

6233 
åig_mlme
 = (*)
åig
->
d©a
;

6235 i‡(
evít
->
u
.
mlme
.
d©a
 =
ASSOC_EVENT
) {

6236 i‡(
evít
->
u
.
mlme
.
°©us
 =
MLME_DENIED
)

6237 
	`CHECK_MLME_TRIGGER
(
°›_assoc_díõd
,

6239 
evít
->
u
.
mlme
.
ªas⁄
);

6240 i‡(
evít
->
u
.
mlme
.
°©us
 =
MLME_TIMEOUT
)

6241 
	`CHECK_MLME_TRIGGER
(
°›_assoc_timeout
,

6243 } i‡(
evít
->
u
.
mlme
.
d©a
 =
AUTH_EVENT
) {

6244 i‡(
evít
->
u
.
mlme
.
°©us
 =
MLME_DENIED
)

6245 
	`CHECK_MLME_TRIGGER
(
°›_auth_díõd
,

6247 
evít
->
u
.
mlme
.
ªas⁄
);

6248 i‡(
evít
->
u
.
mlme
.
°©us
 =
MLME_TIMEOUT
)

6249 
	`CHECK_MLME_TRIGGER
(
°›_auth_timeout
,

6251 } i‡(
evít
->
u
.
mlme
.
d©a
 =
DEAUTH_RX_EVENT
) {

6252 
	`CHECK_MLME_TRIGGER
(
°›_rx_dóuth
,

6253 "DEAUTH RX %d", 
evít
->
u
.
mlme
.
ªas⁄
);

6254 } i‡(
evít
->
u
.
mlme
.
d©a
 =
DEAUTH_TX_EVENT
) {

6255 
	`CHECK_MLME_TRIGGER
(
°›_tx_dóuth
,

6256 "DEAUTH TX %d", 
evít
->
u
.
mlme
.
ªas⁄
);

6258 #unde‡
CHECK_MLME_TRIGGER


6259 
	}
}

6261 
	$iwl_mvm_evít_b¨_rx_ˇŒback
(
iwl_mvm
 *
mvm
,

6262 
õì80211_vif
 *
vif
,

6263 c⁄° 
õì80211_evít
 *
evít
)

6265 
iwl_fw_dbg_åiggî_év
 *
åig
;

6266 
iwl_fw_dbg_åiggî_ba
 *
ba_åig
;

6268 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

6269 
FW_DBG_TRIGGER_BA
);

6270 i‡(!
åig
)

6273 
ba_åig
 = (*)
åig
->
d©a
;

6275 i‡(!(
	`À16_to_˝u
(
ba_åig
->
rx_b¨
Ë& 
	`BIT
(
evít
->
u
.
ba
.
tid
)))

6278 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

6280 
evít
->
u
.
ba
.
°a
->
addr
,Évít->u.ba.
tid
,

6281 
evít
->
u
.
ba
.
s¢
);

6282 
	}
}

6284 
	$iwl_mvm_mac_evít_ˇŒback
(
õì80211_hw
 *
hw
,

6285 
õì80211_vif
 *
vif
,

6286 c⁄° 
õì80211_evít
 *
evít
)

6288 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6290 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6291 
evít
->
ty≥
) {

6292 
MLME_EVENT
:

6293 
	`iwl_mvm_evít_mlme_ˇŒback
(
mvm
, 
vif
, 
evít
);

6294 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6296 
BAR_RX_EVENT
:

6297 
	`iwl_mvm_evít_b¨_rx_ˇŒback
(
mvm
, 
vif
, 
evít
);

6298 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6300 
BA_FRAME_TIMEOUT
:

6301 
	`iwl_mvm_evít_‰ame_timeout_ˇŒback
(
mvm
, 
vif
, 
evít
->
u
.
ba
.
°a
,

6302 
evít
->
u
.
ba
.
tid
);

6303 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6306 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6309 
	}
}

6311 
	#SYNC_RX_QUEUE_TIMEOUT
 (
HZ
)

	)

6312 
	$iwl_mvm_sync_rx_queues_öã∫Æ
(
iwl_mvm
 *
mvm
,

6313 
iwl_mvm_rxq_nŸif_ty≥
 
ty≥
,

6314 
boﬁ
 
sync
,

6315 c⁄° *
d©a
, 
u32
 
size
)

6318 
iwl_rxq_sync_cmd
 
cmd
;

6319 
iwl_mvm_öã∫Æ_rxq_nŸif
 
nŸif
;

6320 } 
__∑cked
 
cmd
 = {

6321 .
cmd
.
rxq_mask
 = 
	`˝u_to_À32
(
	`BIT
(
mvm
->
å™s
->
num_rx_queues
) - 1),

6322 .
cmd
.
cou¡
 =

6323 
	`˝u_to_À32
((
iwl_mvm_öã∫Æ_rxq_nŸif
) +

6324 
size
),

6325 .
nŸif
.
ty≥
 =Åype,

6326 .
nŸif
.
sync
 = sync,

6328 
iwl_ho°_cmd
 
hcmd
 = {

6329 .
id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
TRIGGER_RX_QUEUES_NOTIF_CMD
),

6330 .
d©a
[0] = &
cmd
,

6331 .
Àn
[0] = (
cmd
),

6332 .
d©a
[1] = data,

6333 .
Àn
[1] = 
size
,

6334 .
Êags
 = 
sync
 ? 0 : 
CMD_ASYNC
,

6336 
ªt
;

6339 i‡(
	`WARN_ON
(
cmd
.cmd.
cou¡
 & 
	`˝u_to_À32
(3)))

6342 i‡(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
))

6345 i‡(
sync
) {

6346 
cmd
.
nŸif
.
cookõ
 = 
mvm
->
queue_sync_cookõ
;

6347 
mvm
->
queue_sync_°©e
 = (1 << mvm->
å™s
->
num_rx_queues
) - 1;

6350 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

6351 i‡(
ªt
) {

6352 
	`IWL_ERR
(
mvm
, "FaûedÅÿåiggî RX queue†syn¯(%d)\n", 
ªt
);

6353 
out
;

6356 i‡(
sync
) {

6357 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

6358 
ªt
 = 
	`waô_evít_timeout
(
mvm
->
rx_sync_waôq
,

6359 
	`READ_ONCE
(
mvm
->
queue_sync_°©e
) == 0 ||

6360 
	`iwl_mvm_is_ødio_hw_kûÀd
(
mvm
),

6361 
SYNC_RX_QUEUE_TIMEOUT
);

6362 
	`WARN_ONCE
(!
ªt
 && !
	`iwl_mvm_is_ødio_hw_kûÀd
(
mvm
),

6364 
mvm
->
queue_sync_°©e
,

6365 
mvm
->
queue_sync_cookõ
);

6368 
out
:

6369 i‡(
sync
) {

6370 
mvm
->
queue_sync_°©e
 = 0;

6371 
mvm
->
queue_sync_cookõ
++;

6373 
	}
}

6375 
	$iwl_mvm_sync_rx_queues
(
õì80211_hw
 *
hw
)

6377 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6379 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6380 
	`muãx_lock
(&
mvm
->
muãx
);

6381 
	`iwl_mvm_sync_rx_queues_öã∫Æ
(
mvm
, 
IWL_MVM_RXQ_EMPTY
, 
åue
, 
NULL
, 0);

6382 
	`muãx_u∆ock
(&
mvm
->
muãx
);

6383 
	}
}

6386 
	$iwl_mvm_mac_gë_·m_ª•⁄dî_°©s
(
õì80211_hw
 *
hw
,

6387 
õì80211_vif
 *
vif
,

6388 
cfg80211_·m_ª•⁄dî_°©s
 *
°©s
)

6390 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6391 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

6393 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6395 i‡(
vif
->
p2p
 || vif->
ty≥
 !
NL80211_IFTYPE_AP
 ||

6396 !
mvmvif
->
≠_ibss_a˘ive
 || !
vif
->
bss_c⁄f
.
·m_ª•⁄dî
) {

6397 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6398  -
EINVAL
;

6401 
	`muãx_lock
(&
mvm
->
muãx
);

6402 *
°©s
 = 
mvm
->
·m_ª•_°©s
;

6403 
	`muãx_u∆ock
(&
mvm
->
muãx
);

6405 
°©s
->
fûÀd
 = 
	`BIT
(
NL80211_FTM_STATS_SUCCESS_NUM
) |

6406 
	`BIT
(
NL80211_FTM_STATS_PARTIAL_NUM
) |

6407 
	`BIT
(
NL80211_FTM_STATS_FAILED_NUM
) |

6408 
	`BIT
(
NL80211_FTM_STATS_ASAP_NUM
) |

6409 
	`BIT
(
NL80211_FTM_STATS_NON_ASAP_NUM
) |

6410 
	`BIT
(
NL80211_FTM_STATS_TOTAL_DURATION_MSEC
) |

6411 
	`BIT
(
NL80211_FTM_STATS_UNKNOWN_TRIGGERS_NUM
) |

6412 
	`BIT
(
NL80211_FTM_STATS_RESCHEDULE_REQUESTS_NUM
) |

6413 
	`BIT
(
NL80211_FTM_STATS_OUT_OF_WINDOW_TRIGGERS_NUM
);

6415 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6417 
	}
}

6419 
	$iwl_mvm_°¨t_pm§
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

6420 
cfg80211_pm§_ªque°
 *
ªque°
)

6422 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6423 
ªt
;

6425 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6427 
	`muãx_lock
(&
mvm
->
muãx
);

6428 
ªt
 = 
	`iwl_mvm_·m_°¨t
(
mvm
, 
vif
, 
ªque°
);

6429 
	`muãx_u∆ock
(&
mvm
->
muãx
);

6431 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6432  
ªt
;

6433 
	}
}

6435 
	$iwl_mvm_ab‹t_pm§
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

6436 
cfg80211_pm§_ªque°
 *
ªque°
)

6438 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6440 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6441 
	`muãx_lock
(&
mvm
->
muãx
);

6442 
	`iwl_mvm_·m_ab‹t
(
mvm
, 
ªque°
);

6443 
	`muãx_u∆ock
(&
mvm
->
muãx
);

6444 
	}
}

6446 
boﬁ
 
	$iwl_mvm_ˇn_hw_csum
(
sk_buff
 *
skb
)

6448 
u8
 
¥Ÿocﬁ
 = 
	`ù_hdr
(
skb
)->protocol;

6450 i‡(!
	`IS_ENABLED
(
CONFIG_INET
))

6451  
Ál£
;

6453  
¥Ÿocﬁ
 =
IPPROTO_TCP
 ||ÖrŸocﬁ =
IPPROTO_UDP
;

6454 
	}
}

6456 
boﬁ
 
	$iwl_mvm_mac_ˇn_aggªg©e
(
õì80211_hw
 *
hw
,

6457 
sk_buff
 *
hód
,

6458 
sk_buff
 *
skb
)

6460 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6462 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6464 i‡(
skb
->
¥Ÿocﬁ
 !
	`ht⁄s
(
ETH_P_IP
)) {

6465 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6466  
Ál£
;

6469 i‡(!
	`iwl_mvm_is_csum_suµ‹ãd
(
mvm
)) {

6470 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6471  
åue
;

6474 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6475  
	`iwl_mvm_ˇn_hw_csum
(
skb
Ë=iwl_mvm_ˇn_hw_csum(
hód
);

6476 
	}
}

6478 
	$iwl_mvm_£t_hw_time°amp
(
õì80211_hw
 *
hw
,

6479 
õì80211_vif
 *
vif
,

6480 
cfg80211_£t_hw_time°amp
 *
hwts
)

6482 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

6483 
u32
 
¥Ÿocﬁs
 = 0;

6484 
ªt
;

6486 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

6489 i‡(!
hwts
->
maˇddr
) {

6490 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6491  -
EOPNOTSUPP
;

6494 i‡(
hwts
->
íabÀ
)

6495 
¥Ÿocﬁs
 =

6496 
IWL_TIME_SYNC_PROTOCOL_TM
 | 
IWL_TIME_SYNC_PROTOCOL_FTM
;

6498 
	`muãx_lock
(&
mvm
->
muãx
);

6499 
ªt
 = 
	`iwl_mvm_time_sync_c⁄fig
(
mvm
, 
hwts
->
maˇddr
, 
¥Ÿocﬁs
);

6500 
	`muãx_u∆ock
(&
mvm
->
muãx
);

6502 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

6503  
ªt
;

6504 
	}
}

6506 c⁄° 
õì80211_›s
 
	giwl_mvm_hw_›s
 = {

6507 .
tx
 = 
iwl_mvm_mac_tx
,

6508 .
	gwake_tx_queue
 = 
iwl_mvm_mac_wake_tx_queue
,

6509 .
	gampdu_a˘i⁄
 = 
iwl_mvm_mac_ampdu_a˘i⁄
,

6510 .
	ggë_™ã¬a
 = 
iwl_mvm_›_gë_™ã¬a
,

6511 .
	g£t_™ã¬a
 = 
iwl_mvm_›_£t_™ã¬a
,

6512 .
	g°¨t
 = 
iwl_mvm_mac_°¨t
,

6513 .
	gªc⁄fig_com∂ëe
 = 
iwl_mvm_mac_ªc⁄fig_com∂ëe
,

6514 .
	g°›
 = 
iwl_mvm_mac_°›
,

6515 .
	gadd_öãrÁ˚
 = 
iwl_mvm_mac_add_öãrÁ˚
,

6516 .
	gªmove_öãrÁ˚
 = 
iwl_mvm_mac_ªmove_öãrÁ˚
,

6517 .
	gc⁄fig
 = 
iwl_mvm_mac_c⁄fig
,

6518 .
	g¥ï¨e_mu…iˇ°
 = 
iwl_mvm_¥ï¨e_mu…iˇ°
,

6519 .
	gc⁄figuª_fûãr
 = 
iwl_mvm_c⁄figuª_fûãr
,

6520 .
	gc⁄fig_iÁ˚_fûãr
 = 
iwl_mvm_c⁄fig_iÁ˚_fûãr
,

6521 .
	gbss_öfo_ch™ged
 = 
iwl_mvm_bss_öfo_ch™ged
,

6522 .
	ghw_sˇn
 = 
iwl_mvm_mac_hw_sˇn
,

6523 .
	gˇn˚l_hw_sˇn
 = 
iwl_mvm_mac_ˇn˚l_hw_sˇn
,

6524 .
	g°a_¥e_rcu_ªmove
 = 
iwl_mvm_°a_¥e_rcu_ªmove
,

6525 .
	g°a_°©e
 = 
iwl_mvm_mac_°a_°©e
,

6526 .
	g°a_nŸify
 = 
iwl_mvm_mac_°a_nŸify
,

6527 .
	gÆlow_buf„ªd_‰ames
 = 
iwl_mvm_mac_Ælow_buf„ªd_‰ames
,

6528 .
	gªÀa£_buf„ªd_‰ames
 = 
iwl_mvm_mac_ªÀa£_buf„ªd_‰ames
,

6529 .
	g£t_πs_thªshﬁd
 = 
iwl_mvm_mac_£t_πs_thªshﬁd
,

6530 .
	g°a_rc_upd©e
 = 
iwl_mvm_°a_rc_upd©e
,

6531 .
	gc⁄f_tx
 = 
iwl_mvm_mac_c⁄f_tx
,

6532 .
	gmgd_¥ï¨e_tx
 = 
iwl_mvm_mac_mgd_¥ï¨e_tx
,

6533 .
	gmgd_com∂ëe_tx
 = 
iwl_mvm_mac_mgd_com∂ëe_tx
,

6534 .
	gmgd_¥Ÿe˘_tdls_discovî
 = 
iwl_mvm_mac_mgd_¥Ÿe˘_tdls_discovî
,

6535 .
	gÊush
 = 
iwl_mvm_mac_Êush
,

6536 .
	gÊush_°a
 = 
iwl_mvm_mac_Êush_°a
,

6537 .
	gsched_sˇn_°¨t
 = 
iwl_mvm_mac_sched_sˇn_°¨t
,

6538 .
	gsched_sˇn_°›
 = 
iwl_mvm_mac_sched_sˇn_°›
,

6539 .
	g£t_key
 = 
iwl_mvm_mac_£t_key
,

6540 .
	gupd©e_tkù_key
 = 
iwl_mvm_mac_upd©e_tkù_key
,

6541 .
	gªmaö_⁄_ch™√l
 = 
iwl_mvm_roc
,

6542 .
	gˇn˚l_ªmaö_⁄_ch™√l
 = 
iwl_mvm_ˇn˚l_roc
,

6543 .
	gadd_ch™˘x
 = 
iwl_mvm_add_ch™˘x
,

6544 .
	gªmove_ch™˘x
 = 
iwl_mvm_ªmove_ch™˘x
,

6545 .
	gch™ge_ch™˘x
 = 
iwl_mvm_ch™ge_ch™˘x
,

6546 .
	gassign_vif_ch™˘x
 = 
iwl_mvm_assign_vif_ch™˘x
,

6547 .
	gu«ssign_vif_ch™˘x
 = 
iwl_mvm_u«ssign_vif_ch™˘x
,

6548 .
	gswôch_vif_ch™˘x
 = 
iwl_mvm_swôch_vif_ch™˘x
,

6550 .
	g°¨t_≠
 = 
iwl_mvm_°¨t_≠
,

6551 .
	g°›_≠
 = 
iwl_mvm_°›_≠
,

6552 .
	gjoö_ibss
 = 
iwl_mvm_°¨t_ibss
,

6553 .
	gÀave_ibss
 = 
iwl_mvm_°›_ibss
,

6555 .
	gtx_œ°_bóc⁄
 = 
iwl_mvm_tx_œ°_bóc⁄
,

6557 .
	g£t_tim
 = 
iwl_mvm_£t_tim
,

6559 .
	gch™√l_swôch
 = 
iwl_mvm_ch™√l_swôch
,

6560 .
	g¥e_ch™√l_swôch
 = 
iwl_mvm_¥e_ch™√l_swôch
,

6561 .
	gpo°_ch™√l_swôch
 = 
iwl_mvm_po°_ch™√l_swôch
,

6562 .
	gab‹t_ch™√l_swôch
 = 
iwl_mvm_ab‹t_ch™√l_swôch
,

6563 .
	gch™√l_swôch_rx_bóc⁄
 = 
iwl_mvm_ch™√l_swôch_rx_bóc⁄
,

6565 .
	gtdls_ch™√l_swôch
 = 
iwl_mvm_tdls_ch™√l_swôch
,

6566 .
	gtdls_ˇn˚l_ch™√l_swôch
 = 
iwl_mvm_tdls_ˇn˚l_ch™√l_swôch
,

6567 .
	gtdls_ªcv_ch™√l_swôch
 = 
iwl_mvm_tdls_ªcv_ch™√l_swôch
,

6569 .
	gevít_ˇŒback
 = 
iwl_mvm_mac_evít_ˇŒback
,

6571 .
	gsync_rx_queues
 = 
iwl_mvm_sync_rx_queues
,

6573 
CFG80211_TESTMODE_CMD
(
iwl_mvm_mac_ã°mode_cmd
)

6575 #ifde‡
CONFIG_PM_SLEEP


6577 .
	gsu•íd
 = 
iwl_mvm_su•íd
,

6578 .
	gªsume
 = 
iwl_mvm_ªsume
,

6579 .
	g£t_wakeup
 = 
iwl_mvm_£t_wakeup
,

6580 .
	g£t_ªkey_d©a
 = 
iwl_mvm_£t_ªkey_d©a
,

6581 #i‡
IS_ENABLED
(
CONFIG_IPV6
)

6582 .
	gùv6_addr_ch™ge
 = 
iwl_mvm_ùv6_addr_ch™ge
,

6584 .
	g£t_deÁu…_uniˇ°_key
 = 
iwl_mvm_£t_deÁu…_uniˇ°_key
,

6586 .
	ggë_survey
 = 
iwl_mvm_mac_gë_survey
,

6587 .
	g°a_°©i°ics
 = 
iwl_mvm_mac_°a_°©i°ics
,

6588 .
	ggë_·m_ª•⁄dî_°©s
 = 
iwl_mvm_mac_gë_·m_ª•⁄dî_°©s
,

6589 .
	g°¨t_pm§
 = 
iwl_mvm_°¨t_pm§
,

6590 .
	gab‹t_pm§
 = 
iwl_mvm_ab‹t_pm§
,

6592 .
	gˇn_aggªg©e_ö_amsdu
 = 
iwl_mvm_mac_ˇn_aggªg©e
,

6593 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


6594 .
	gvif_add_debugfs
 = 
iwl_mvm_vif_add_debugfs
,

6595 .
	glök_°a_add_debugfs
 = 
iwl_mvm_lök_°a_add_debugfs
,

6597 .
	g£t_hw_time°amp
 = 
iwl_mvm_£t_hw_time°amp
,

	@mvm/mld-key.c

5 
	~<löux/kî√l.h
>

6 
	~<√t/mac80211.h
>

7 
	~"mvm.h
"

8 
	~"fw/≠i/c⁄ãxt.h
"

9 
	~"fw/≠i/d©≠©h.h
"

11 
u32
 
	$iwl_mvm_gë_£c_°a_mask
(
iwl_mvm
 *
mvm
,

12 
õì80211_vif
 *
vif
,

13 
õì80211_°a
 *
°a
,

14 
õì80211_key_c⁄f
 *
keyc⁄f
)

16 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

17 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = &
mvmvif
->
deÊök
;

19 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

21 i‡(
keyc⁄f
->
lök_id
 >= 0) {

22 
lök_öfo
 = 
mvmvif
->
lök
[
keyc⁄f
->
lök_id
];

23 i‡(!
lök_öfo
)

28 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 &&

29 !(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

31 i‡(
keyc⁄f
->
keyidx
 >= 4)

32  
	`BIT
(
lök_öfo
->
bˇ°_°a
.
°a_id
);

34  
	`BIT
(
lök_öfo
->
mˇ°_°a
.
°a_id
);

38 i‡(!
°a
 && 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

39 
°a
 = 
mvmvif
->
≠_°a
;

50 i‡(!
°a
 && (
keyc⁄f
->
lök_id
 >0 || !
	`õì80211_vif_is_mld
(
vif
)))

51  
	`BIT
(
lök_öfo
->
≠_°a_id
);

56  
	`iwl_mvm_°a_fw_id_mask
(
mvm
, 
°a
, 
keyc⁄f
->
lök_id
);

57 
	}
}

59 
u32
 
	$iwl_mvm_gë_£c_Êags
(
iwl_mvm
 *
mvm
,

60 
õì80211_vif
 *
vif
,

61 
õì80211_°a
 *
°a
,

62 
õì80211_key_c⁄f
 *
keyc⁄f
)

64 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

65 
boﬁ
 
∑úwi£
 = 
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
;

66 
boﬁ
 
igtk
 = 
keyc⁄f
->
keyidx
 == 4 || keyconf->keyidx == 5;

67 
u32
 
Êags
 = 0;

69 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

71 i‡(!
∑úwi£
)

72 
Êags
 |
IWL_SEC_KEY_FLAG_MCAST_KEY
;

74 
keyc⁄f
->
cùhî
) {

75 
WLAN_CIPHER_SUITE_WEP104
:

76 
Êags
 |
IWL_SEC_KEY_FLAG_KEY_SIZE
;

77 
ÁŒthrough
;

78 
WLAN_CIPHER_SUITE_WEP40
:

79 
Êags
 |
IWL_SEC_KEY_FLAG_CIPHER_WEP
;

81 
WLAN_CIPHER_SUITE_TKIP
:

82 
Êags
 |
IWL_SEC_KEY_FLAG_CIPHER_TKIP
;

84 
WLAN_CIPHER_SUITE_AES_CMAC
:

85 
WLAN_CIPHER_SUITE_CCMP
:

86 
Êags
 |
IWL_SEC_KEY_FLAG_CIPHER_CCMP
;

88 
WLAN_CIPHER_SUITE_GCMP_256
:

89 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

90 
Êags
 |
IWL_SEC_KEY_FLAG_KEY_SIZE
;

91 
ÁŒthrough
;

92 
WLAN_CIPHER_SUITE_GCMP
:

93 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

94 
Êags
 |
IWL_SEC_KEY_FLAG_CIPHER_GCMP
;

98 i‡(!
°a
 && 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

99 
°a
 = 
mvmvif
->
≠_°a
;

108 i‡((!
	`IS_ERR_OR_NULL
(
°a
Ë&& sè->
mÂ
 && 
∑úwi£
Ë|| 
igtk
)

109 
Êags
 |
IWL_SEC_KEY_FLAG_MFP
;

111 i‡(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_SPP_AMSDU
)

112 
Êags
 |
IWL_SEC_KEY_FLAG_SPP_AMSDU
;

114  
Êags
;

115 
	}
}

117 
	siwl_mvm_°a_key_upd©e_d©a
 {

118 
õì80211_°a
 *
	m°a
;

119 
u32
 
	mﬁd_°a_mask
;

120 
u32
 
	m√w_°a_mask
;

121 
	mîr
;

124 
	$iwl_mvm_mld_upd©e_°a_key
(
õì80211_hw
 *
hw
,

125 
õì80211_vif
 *
vif
,

126 
õì80211_°a
 *
°a
,

127 
õì80211_key_c⁄f
 *
key
,

128 *
_d©a
)

130 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SEC_KEY_CMD
);

131 
iwl_mvm_°a_key_upd©e_d©a
 *
d©a
 = 
_d©a
;

132 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

133 
iwl_£c_key_cmd
 
cmd
 = {

134 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_MODIFY
),

135 .
u
.
modify
.
ﬁd_°a_mask
 = 
	`˝u_to_À32
(
d©a
->old_sta_mask),

136 .
u
.
modify
.
√w_°a_mask
 = 
	`˝u_to_À32
(
d©a
->new_sta_mask),

137 .
u
.
modify
.
key_id
 = 
	`˝u_to_À32
(
key
->
keyidx
),

138 .
u
.
modify
.
key_Êags
 =

139 
	`˝u_to_À32
(
	`iwl_mvm_gë_£c_Êags
(
mvm
, 
vif
, 
°a
, 
key
)),

141 
îr
;

144 i‡(
°a
 !
d©a
->°®|| 
key
->
lök_id
 >= 0)

147 
îr
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 
CMD_ASYNC
, (
cmd
), &cmd);

149 i‡(
îr
)

150 
d©a
->
îr
 =Érr;

151 
	}
}

153 
	$iwl_mvm_mld_upd©e_°a_keys
(
iwl_mvm
 *
mvm
,

154 
õì80211_vif
 *
vif
,

155 
õì80211_°a
 *
°a
,

156 
u32
 
ﬁd_°a_mask
,

157 
u32
 
√w_°a_mask
)

159 
iwl_mvm_°a_key_upd©e_d©a
 
d©a
 = {

160 .
°a
 = sta,

161 .
ﬁd_°a_mask
 = old_sta_mask,

162 .
√w_°a_mask
 =Çew_sta_mask,

165 
	`õì80211_ôî_keys_rcu
(
mvm
->
hw
, 
vif
, 
iwl_mvm_mld_upd©e_°a_key
,

166 &
d©a
);

167  
d©a
.
îr
;

168 
	}
}

170 
	$__iwl_mvm_£c_key_dñ
(
iwl_mvm
 *
mvm
, 
u32
 
°a_mask
,

171 
u32
 
key_Êags
, u32 
keyidx
, u32 
Êags
)

173 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SEC_KEY_CMD
);

174 
iwl_£c_key_cmd
 
cmd
 = {

175 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
),

176 .
u
.
ªmove
.
°a_mask
 = 
	`˝u_to_À32
(sta_mask),

177 .
u
.
ªmove
.
key_id
 = 
	`˝u_to_À32
(
keyidx
),

178 .
u
.
ªmove
.
key_Êags
 = 
	`˝u_to_À32
(key_flags),

181  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 
Êags
, (
cmd
), &cmd);

182 
	}
}

184 
	$iwl_mvm_mld_£nd_key
(
iwl_mvm
 *
mvm
, 
u32
 
°a_mask
, u32 
key_Êags
,

185 
õì80211_key_c⁄f
 *
keyc⁄f
)

187 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SEC_KEY_CMD
);

188 
iwl_£c_key_cmd
 
cmd
 = {

189 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
),

190 .
u
.
add
.
°a_mask
 = 
	`˝u_to_À32
(sta_mask),

191 .
u
.
add
.
key_id
 = 
	`˝u_to_À32
(
keyc⁄f
->
keyidx
),

192 .
u
.
add
.
key_Êags
 = 
	`˝u_to_À32
(key_flags),

193 .
u
.
add
.
tx_£q
 = 
	`˝u_to_À64
(
	`©omic64_ªad
(&
keyc⁄f
->
tx_≤
)),

195 
max_key_Àn
 = (
cmd
.
u
.
add
.
key
);

196 
ªt
;

198 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

199 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
)

200 
max_key_Àn
 -
IWL_SEC_WEP_KEY_OFFSET
;

202 i‡(
	`WARN_ON
(
keyc⁄f
->
keyÀn
 > 
max_key_Àn
))

203  -
EINVAL
;

205 i‡(
	`WARN_ON
(!
°a_mask
))

206  -
EINVAL
;

208 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

209 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
)

210 
	`mem˝y
(
cmd
.
u
.
add
.
key
 + 
IWL_SEC_WEP_KEY_OFFSET
, 
keyc⁄f
->key,

211 
keyc⁄f
->
keyÀn
);

213 
	`mem˝y
(
cmd
.
u
.
add
.
key
, 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

215 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
) {

216 
	`mem˝y
(
cmd
.
u
.
add
.
tkù_mic_rx_key
,

217 
keyc⁄f
->
key
 + 
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
,

219 
	`mem˝y
(
cmd
.
u
.
add
.
tkù_mic_tx_key
,

220 
keyc⁄f
->
key
 + 
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
,

224 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, (
cmd
), &cmd);

225 i‡(
ªt
)

226  
ªt
;

232 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

233 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
) {

234 
cmd
.
u
.
add
.
key_Êags
 ^
	`˝u_to_À32
(
IWL_SEC_KEY_FLAG_MCAST_KEY
);

235 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, (
cmd
), &cmd);

236 i‡(
ªt
)

237 
	`__iwl_mvm_£c_key_dñ
(
mvm
, 
°a_mask
, 
key_Êags
,

238 
keyc⁄f
->
keyidx
, 0);

241  
ªt
;

242 
	}
}

244 
	$iwl_mvm_£c_key_add
(
iwl_mvm
 *
mvm
,

245 
õì80211_vif
 *
vif
,

246 
õì80211_°a
 *
°a
,

247 
õì80211_key_c⁄f
 *
keyc⁄f
)

249 
u32
 
°a_mask
 = 
	`iwl_mvm_gë_£c_°a_mask
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
);

250 
u32
 
key_Êags
 = 
	`iwl_mvm_gë_£c_Êags
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
);

251 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

252 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 = 
NULL
;

253 
ªt
;

255 i‡(
keyc⁄f
->
keyidx
 == 4 || keyconf->keyidx == 5) {

256 
lök_id
 = 0;

259 i‡(
keyc⁄f
->
lök_id
 >= 0)

260 
lök_id
 = 
keyc⁄f
->link_id;

262 
mvm_lök
 = 
mvmvif
->
lök
[
lök_id
];

263 i‡(
	`WARN_ON
(!
mvm_lök
))

264  -
EINVAL
;

266 i‡(
mvm_lök
->
igtk
) {

267 
	`IWL_DEBUG_MAC80211
(
mvm
, "remove old IGTK %d\n",

268 
mvm_lök
->
igtk
->
keyidx
);

269 
ªt
 = 
	`iwl_mvm_£c_key_dñ
(
mvm
, 
vif
, 
°a
,

270 
mvm_lök
->
igtk
);

271 i‡(
ªt
)

272 
	`IWL_ERR
(
mvm
,

274 
ªt
);

277 
	`WARN_ON
(
mvm_lök
->
igtk
);

280 
ªt
 = 
	`iwl_mvm_mld_£nd_key
(
mvm
, 
°a_mask
, 
key_Êags
, 
keyc⁄f
);

281 i‡(
ªt
)

282  
ªt
;

284 i‡(
mvm_lök
)

285 
mvm_lök
->
igtk
 = 
keyc⁄f
;

291 
keyc⁄f
->
hw_key_idx
 = 0;

294 
	}
}

296 
	$_iwl_mvm_£c_key_dñ
(
iwl_mvm
 *
mvm
,

297 
õì80211_vif
 *
vif
,

298 
õì80211_°a
 *
°a
,

299 
õì80211_key_c⁄f
 *
keyc⁄f
,

300 
u32
 
Êags
)

302 
u32
 
°a_mask
 = 
	`iwl_mvm_gë_£c_°a_mask
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
);

303 
u32
 
key_Êags
 = 
	`iwl_mvm_gë_£c_Êags
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
);

304 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

305 
ªt
;

307 i‡(
	`WARN_ON
(!
°a_mask
))

308  -
EINVAL
;

310 i‡(
keyc⁄f
->
keyidx
 == 4 || keyconf->keyidx == 5) {

311 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
;

312 
lök_id
 = 0;

315 i‡(
keyc⁄f
->
lök_id
 >= 0)

316 
lök_id
 = 
keyc⁄f
->link_id;

318 
mvm_lök
 = 
mvmvif
->
lök
[
lök_id
];

319 i‡(
	`WARN_ON
(!
mvm_lök
))

320  -
EINVAL
;

322 i‡(
mvm_lök
->
igtk
 =
keyc⁄f
) {

324 
mvm_lök
->
igtk
->
hw_key_idx
 = 
STA_KEY_IDX_INVALID
;

325 
mvm_lök
->
igtk
 = 
NULL
;

329 
ªt
 = 
	`__iwl_mvm_£c_key_dñ
(
mvm
, 
°a_mask
, 
key_Êags
, 
keyc⁄f
->
keyidx
,

330 
Êags
);

331 i‡(
ªt
)

332  
ªt
;

335 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

336 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
) {

337 
key_Êags
 ^
IWL_SEC_KEY_FLAG_MCAST_KEY
;

338 
ªt
 = 
	`__iwl_mvm_£c_key_dñ
(
mvm
, 
°a_mask
, 
key_Êags
,

339 
keyc⁄f
->
keyidx
, 
Êags
);

342  
ªt
;

343 
	}
}

345 
	$iwl_mvm_£c_key_dñ_∑¢
(
iwl_mvm
 *
mvm
,

346 
õì80211_vif
 *
vif
,

347 
u32
 
°a_mask
,

348 
õì80211_key_c⁄f
 *
keyc⁄f
)

350 
u32
 
key_Êags
 = 
	`iwl_mvm_gë_£c_Êags
(
mvm
, 
vif
, 
NULL
, 
keyc⁄f
) |

351 
IWL_SEC_KEY_FLAG_MFP
;

353 i‡(
	`WARN_ON
(!
°a_mask
))

354  -
EINVAL
;

356  
	`__iwl_mvm_£c_key_dñ
(
mvm
, 
°a_mask
, 
key_Êags
, 
keyc⁄f
->
keyidx
,

358 
	}
}

360 
	$iwl_mvm_£c_key_dñ
(
iwl_mvm
 *
mvm
,

361 
õì80211_vif
 *
vif
,

362 
õì80211_°a
 *
°a
,

363 
õì80211_key_c⁄f
 *
keyc⁄f
)

365  
	`_iwl_mvm_£c_key_dñ
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
, 0);

366 
	}
}

368 
	$iwl_mvm_£c_key_ªmove_≠_ôî
(
õì80211_hw
 *
hw
,

369 
õì80211_vif
 *
vif
,

370 
õì80211_°a
 *
°a
,

371 
õì80211_key_c⁄f
 *
key
,

372 *
d©a
)

374 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

375 
lök_id
 = (
uöçå_t
)
d©a
;

377 i‡(
key
->
hw_key_idx
 =
STA_KEY_IDX_INVALID
)

380 i‡(
°a
)

383 i‡(
key
->
lök_id
 >= 0 && key->link_id !=Üink_id)

386 
	`_iwl_mvm_£c_key_dñ
(
mvm
, 
vif
, 
NULL
, 
key
, 
CMD_ASYNC
);

387 
key
->
hw_key_idx
 = 
STA_KEY_IDX_INVALID
;

388 
	}
}

390 
	$iwl_mvm_£c_key_ªmove_≠
(
iwl_mvm
 *
mvm
,

391 
õì80211_vif
 *
vif
,

392 
iwl_mvm_vif_lök_öfo
 *
lök
,

393 
lök_id
)

395 
u32
 
£c_key_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SEC_KEY_CMD
);

396 
u8
 
£c_key_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
£c_key_id
, 0);

398 i‡(
	`WARN_ON_ONCE
(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 ||

399 
lök
->
≠_°a_id
 =
IWL_MVM_INVALID_STA
))

402 i‡(!
£c_key_vî
)

405 
	`õì80211_ôî_keys_rcu
(
mvm
->
hw
, 
vif
,

406 
iwl_mvm_£c_key_ªmove_≠_ôî
,

407 (*)(
uöçå_t
)
lök_id
);

408 
	}
}

	@mvm/mld-mac.c

5 
	~"mvm.h
"

7 
	$iwl_mvm_mld_£t_he_suµ‹t
(
iwl_mvm
 *
mvm
,

8 
õì80211_vif
 *
vif
,

9 
iwl_mac_c⁄fig_cmd
 *
cmd
)

11 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

12 
cmd
->
he_≠_suµ‹t
 = 
	`˝u_to_À16
(1);

14 
cmd
->
he_suµ‹t
 = 
	`˝u_to_À16
(1);

15 
	}
}

17 
	$iwl_mvm_mld_mac_˘xt_cmd_comm⁄
(
iwl_mvm
 *
mvm
,

18 
õì80211_vif
 *
vif
,

19 
iwl_mac_c⁄fig_cmd
 *
cmd
,

20 
u32
 
a˘i⁄
)

22 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

23 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

24 
lök_id
;

26 
cmd
->
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
mvmvif
->
id
);

27 
cmd
->
a˘i⁄
 = 
	`˝u_to_À32
(action);

29 
cmd
->
mac_ty≥
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_mac_ty≥
(
vif
));

31 
	`mem˝y
(
cmd
->
loˇl_mld_addr
, 
vif
->
addr
, 
ETH_ALEN
);

33 
cmd
->
he_suµ‹t
 = 0;

34 
cmd
->
eht_suµ‹t
 = 0;

37 
cmd
->
fûãr_Êags
 = 0;

39 
cmd
->
nic_nŸ_ack_íabÀd
 =

40 
	`˝u_to_À32
(!
	`iwl_mvm_is_nic_ack_íabÀd
(
mvm
, 
vif
));

42 i‡(
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

53 i‡(
	`õì80211_vif_is_mld
(
vif
)) {

54 
	`iwl_mvm_mld_£t_he_suµ‹t
(
mvm
, 
vif
, 
cmd
);

55 
cmd
->
eht_suµ‹t
 = 
	`˝u_to_À32
(1);

59 
	`rcu_ªad_lock
();

60 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
((
vif
)->
lök_c⁄f
);Üink_id++) {

61 
lök_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->lök_c⁄f[
lök_id
]);

62 i‡(!
lök_c⁄f
)

65 i‡(
lök_c⁄f
->
he_suµ‹t
)

66 
	`iwl_mvm_mld_£t_he_suµ‹t
(
mvm
, 
vif
, 
cmd
);

71 i‡(!
lök_c⁄f
->
he_suµ‹t
 &&Üök_c⁄f->
eht_suµ‹t
)

74 i‡(
lök_c⁄f
->
eht_suµ‹t
) {

75 
cmd
->
eht_suµ‹t
 = 
	`˝u_to_À32
(1);

79 
	`rcu_ªad_u∆ock
();

80 
	}
}

82 
	$iwl_mvm_mld_mac_˘xt_£nd_cmd
(
iwl_mvm
 *
mvm
,

83 
iwl_mac_c⁄fig_cmd
 *
cmd
)

85 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

86 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
MAC_CONFIG_CMD
),

87 0, (*
cmd
), cmd);

88 i‡(
ªt
)

89 
	`IWL_ERR
(
mvm
, "FailedÅo send MAC_CONFIG_CMD (action:%d): %d\n",

90 
	`À32_to_˝u
(
cmd
->
a˘i⁄
), 
ªt
);

91  
ªt
;

92 
	}
}

94 
	$iwl_mvm_mld_mac_˘xt_cmd_°a
(
iwl_mvm
 *
mvm
,

95 
õì80211_vif
 *
vif
,

96 
u32
 
a˘i⁄
, 
boﬁ
 
f‹˚_assoc_off
)

98 
iwl_mac_c⁄fig_cmd
 
cmd
 = {};

99 
u16
 
e§_å™sôi⁄_timeout
;

101 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
);

104 
	`iwl_mvm_mld_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
a˘i⁄
);

110 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_CFG_FILTER_ACCEPT_GRP
);

112 i‡(
vif
->
p2p
)

113 
cmd
.
˛õ¡
.
˘wö
 =

114 
	`iwl_mvm_mac_˘xt_cmd_p2p_°a_gë_›µs_˘wö
(
mvm
, 
vif
);

116 i‡(
vif
->
cfg
.
assoc
 && !
f‹˚_assoc_off
) {

117 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

119 
cmd
.
˛õ¡
.
is_assoc
 = 1;

121 i‡(!
mvmvif
->
auth‹ized
 &&

122 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

123 
IWL_UCODE_TLV_CAPA_COEX_HIGH_PRIO
))

124 
cmd
.
˛õ¡
.
d©a_pﬁicy
 |=

125 
	`˝u_to_À16
(
COEX_HIGH_PRIORITY_ENABLE
);

128 
cmd
.
˛õ¡
.
is_assoc
 = 0;

133 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_CFG_FILTER_ACCEPT_BEACON
);

136 
cmd
.
˛õ¡
.
assoc_id
 = 
	`˝u_to_À16
(
vif
->
cfg
.
aid
);

137 i‡(
	`õì80211_vif_is_mld
(
vif
)) {

138 
e§_å™sôi⁄_timeout
 =

139 
	`u16_gë_bôs
(
vif
->
cfg
.
eml_ˇp
,

140 
IEEE80211_EML_CAP_TRANSITION_TIMEOUT
);

142 
cmd
.
˛õ¡
.
e§_å™sôi⁄_timeout
 =

143 
	`mö_t
(
u16
, 
IEEE80211_EML_CAP_TRANSITION_TIMEOUT_128TU
,

144 
e§_å™sôi⁄_timeout
);

145 
cmd
.
˛õ¡
.
medium_sync_dñay
 =

146 
	`˝u_to_À16
(
vif
->
cfg
.
eml_med_sync_dñay
);

149 i‡(
vif
->
¥obe_ªq_ªg
 && vif->
cfg
.
assoc
 && vif->
p2p
)

150 
cmd
.
fûãr_Êags
 |
	`˝u_to_À32
(
MAC_CFG_FILTER_ACCEPT_PROBE_REQ
);

152 i‡(
vif
->
bss_c⁄f
.
he_suµ‹t
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

153 
cmd
.
˛õ¡
.
d©a_pﬁicy
 |=

154 
	`˝u_to_À16
(
	`iwl_mvm_mac_˘xt_cmd_°a_gë_twt_pﬁicy
(
mvm
, 
vif
));

156  
	`iwl_mvm_mld_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

157 
	}
}

159 
	$iwl_mvm_mld_mac_˘xt_cmd_li°íî
(
iwl_mvm
 *
mvm
,

160 
õì80211_vif
 *
vif
,

161 
u32
 
a˘i⁄
)

163 
iwl_mac_c⁄fig_cmd
 
cmd
 = {};

165 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_MONITOR
);

167 
	`iwl_mvm_mld_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
a˘i⁄
);

169 
cmd
.
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_CFG_FILTER_PROMISC
 |

170 
MAC_CFG_FILTER_ACCEPT_CONTROL_AND_MGMT
 |

171 
MAC_CFG_FILTER_ACCEPT_BEACON
 |

172 
MAC_CFG_FILTER_ACCEPT_PROBE_REQ
 |

173 
MAC_CFG_FILTER_ACCEPT_GRP
);

175  
	`iwl_mvm_mld_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

176 
	}
}

178 
	$iwl_mvm_mld_mac_˘xt_cmd_ibss
(
iwl_mvm
 *
mvm
,

179 
õì80211_vif
 *
vif
,

180 
u32
 
a˘i⁄
)

182 
iwl_mac_c⁄fig_cmd
 
cmd
 = {};

184 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_ADHOC
);

186 
	`iwl_mvm_mld_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
a˘i⁄
);

188 
cmd
.
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_CFG_FILTER_ACCEPT_BEACON
 |

189 
MAC_CFG_FILTER_ACCEPT_PROBE_REQ
 |

190 
MAC_CFG_FILTER_ACCEPT_GRP
);

192  
	`iwl_mvm_mld_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

193 
	}
}

195 
	$iwl_mvm_mld_mac_˘xt_cmd_p2p_devi˚
(
iwl_mvm
 *
mvm
,

196 
õì80211_vif
 *
vif
,

197 
u32
 
a˘i⁄
)

199 
iwl_mac_c⁄fig_cmd
 
cmd
 = {};

201 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
);

203 
	`iwl_mvm_mld_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
a˘i⁄
);

205 
cmd
.
p2p_dev
.
is_disc_exãnded
 =

206 
	`iwl_mac_˘xt_p2p_dev_has_exãnded_disc
(
mvm
, 
vif
);

212 
cmd
.
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_CFG_FILTER_ACCEPT_CONTROL_AND_MGMT
);

214  
	`iwl_mvm_mld_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

215 
	}
}

217 
	$iwl_mvm_mld_mac_˘xt_cmd_≠_go
(
iwl_mvm
 *
mvm
,

218 
õì80211_vif
 *
vif
,

219 
u32
 
a˘i⁄
)

221 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

222 
iwl_mac_c⁄fig_cmd
 
cmd
 = {};

224 
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
);

227 
	`iwl_mvm_mld_mac_˘xt_cmd_comm⁄
(
mvm
, 
vif
, &
cmd
, 
a˘i⁄
);

229 
	`iwl_mvm_mac_˘xt_cmd_≠_£t_fûãr_Êags
(
mvm
, 
mvmvif
,

230 &
cmd
.
fûãr_Êags
,

231 
MAC_CFG_FILTER_ACCEPT_PROBE_REQ
,

232 
MAC_CFG_FILTER_ACCEPT_BEACON
);

234  
	`iwl_mvm_mld_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

235 
	}
}

237 
	$iwl_mvm_mld_mac_˘x_£nd
(
iwl_mvm
 *
mvm
,

238 
õì80211_vif
 *
vif
,

239 
u32
 
a˘i⁄
, 
boﬁ
 
f‹˚_assoc_off
)

241 
vif
->
ty≥
) {

242 
NL80211_IFTYPE_STATION
:

243  
	`iwl_mvm_mld_mac_˘xt_cmd_°a
(
mvm
, 
vif
, 
a˘i⁄
,

244 
f‹˚_assoc_off
);

245 
NL80211_IFTYPE_AP
:

246  
	`iwl_mvm_mld_mac_˘xt_cmd_≠_go
(
mvm
, 
vif
, 
a˘i⁄
);

247 
NL80211_IFTYPE_MONITOR
:

248  
	`iwl_mvm_mld_mac_˘xt_cmd_li°íî
(
mvm
, 
vif
, 
a˘i⁄
);

249 
NL80211_IFTYPE_P2P_DEVICE
:

250  
	`iwl_mvm_mld_mac_˘xt_cmd_p2p_devi˚
(
mvm
, 
vif
, 
a˘i⁄
);

251 
NL80211_IFTYPE_ADHOC
:

252  
	`iwl_mvm_mld_mac_˘xt_cmd_ibss
(
mvm
, 
vif
, 
a˘i⁄
);

257  -
EOPNOTSUPP
;

258 
	}
}

260 
	$iwl_mvm_mld_mac_˘xt_add
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

262 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

263 
ªt
;

265 i‡(
	`WARN_ON_ONCE
(
vif
->
ty≥
 =
NL80211_IFTYPE_NAN
))

266  -
EOPNOTSUPP
;

268 i‡(
	`WARN_ONCE
(
mvmvif
->
u∂ﬂded
, "Addingáctive MAC %pM/%d\n",

269 
vif
->
addr
, 
	`õì80211_vif_ty≥_p2p
(vif)))

270  -
EIO
;

272 
ªt
 = 
	`iwl_mvm_mld_mac_˘x_£nd
(
mvm
, 
vif
, 
FW_CTXT_ACTION_ADD
,

273 
åue
);

274 i‡(
ªt
)

275  
ªt
;

278 
	`iwl_mvm_£t_œ°_n⁄qos_£q
(
mvm
, 
vif
);

280 
mvmvif
->
u∂ﬂded
 = 
åue
;

282 
	}
}

284 
	$iwl_mvm_mld_mac_˘xt_ch™ged
(
iwl_mvm
 *
mvm
,

285 
õì80211_vif
 *
vif
,

286 
boﬁ
 
f‹˚_assoc_off
)

288 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

290 i‡(
	`WARN_ON_ONCE
(
vif
->
ty≥
 =
NL80211_IFTYPE_NAN
))

291  -
EOPNOTSUPP
;

293 i‡(
	`WARN_ONCE
(!
mvmvif
->
u∂ﬂded
, "Changing inactive MAC %pM/%d\n",

294 
vif
->
addr
, 
	`õì80211_vif_ty≥_p2p
(vif)))

295  -
EIO
;

297  
	`iwl_mvm_mld_mac_˘x_£nd
(
mvm
, 
vif
, 
FW_CTXT_ACTION_MODIFY
,

298 
f‹˚_assoc_off
);

299 
	}
}

301 
	$iwl_mvm_mld_mac_˘xt_ªmove
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

303 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

304 
iwl_mac_c⁄fig_cmd
 
cmd
 = {

305 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
),

306 .
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
mvmvif
->
id
),

308 
ªt
;

310 i‡(
	`WARN_ON_ONCE
(
vif
->
ty≥
 =
NL80211_IFTYPE_NAN
))

311  -
EOPNOTSUPP
;

313 i‡(
	`WARN_ONCE
(!
mvmvif
->
u∂ﬂded
, "Removing inactive MAC %pM/%d\n",

314 
vif
->
addr
, 
	`õì80211_vif_ty≥_p2p
(vif)))

315  -
EIO
;

317 
ªt
 = 
	`iwl_mvm_mld_mac_˘xt_£nd_cmd
(
mvm
, &
cmd
);

318 i‡(
ªt
)

319  
ªt
;

321 
mvmvif
->
u∂ﬂded
 = 
Ál£
;

324 
	}
}

	@mvm/mld-mac80211.c

5 
	~"mvm.h
"

7 
	$iwl_mvm_mld_mac_add_öãrÁ˚
(
õì80211_hw
 *
hw
,

8 
õì80211_vif
 *
vif
)

10 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

11 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

12 
ªt
;

13 
i
;

15 
	`muãx_lock
(&
mvm
->
muãx
);

17 
mvmvif
->
mvm
 = mvm;

25 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

26 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
)

27 
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
.
accu_num_bóc⁄s
 +=

28 
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
.
num_bóc⁄s
;

31 
ªt
 = 
	`iwl_mvm_mac_˘xt_öô
(
mvm
, 
vif
);

32 i‡(
ªt
)

33 
out_u∆ock
;

35 
	`rcu_assign_poöãr
(
mvm
->
vif_id_to_mac
[
mvmvif
->
id
], 
vif
);

37 
mvmvif
->
„©uªs
 |
hw
->
√tdev_„©uªs
;

40 
mvmvif
->
deÊök
.
fw_lök_id
 = 
IWL_MVM_FW_LINK_ID_INVALID
;

41 
mvmvif
->
deÊök
.
a˘ive
 = 0;

43 
mvmvif
->
lök
[0] = &mvmvif->
deÊök
;

45 
ªt
 = 
	`iwl_mvm_mld_mac_˘xt_add
(
mvm
, 
vif
);

46 i‡(
ªt
)

47 
out_u∆ock
;

50 
ªt
 = 
	`iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

51 i‡(
ªt
)

52 
out_ªmove_mac
;

54 i‡(!
mvm
->
bf_Ælowed_vif
 &&

55 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
p2p
) {

56 
mvm
->
bf_Ælowed_vif
 = 
mvmvif
;

57 
vif
->
drivî_Êags
 |
IEEE80211_VIF_BEACON_FILTER
 |

58 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
;

61 
ªt
 = 
	`iwl_mvm_add_lök
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

62 i‡(
ªt
)

63 
out_‰ì_bf
;

68 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
)

69 
mvm
->
p2p_devi˚_vif
 = 
vif
;

71 
ªt
 = 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

72 i‡(
ªt
)

73 
out_‰ì_bf
;

75 
	`iwl_mvm_tcm_add_vif
(
mvm
, 
vif
);

76 
	`INIT_DELAYED_WORK
(&
mvmvif
->
cß_w‹k
,

77 
iwl_mvm_ch™√l_swôch_disc⁄√˘_wk
);

79 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

80 
mvm
->
m⁄ô‹_⁄
 = 
åue
;

81 
	`õì80211_hw_£t
(
mvm
->
hw
, 
RX_INCLUDES_FCS
);

84 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

85 
	`iwl_mvm_vif_dbgfs_add_lök
(
mvm
, 
vif
);

87 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

88 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 && !vif->
p2p
 &&

89 !
mvm
->
csme_vif
 && mvm->
mei_ªgi°îed
) {

90 
	`iwl_mei_£t_nic_öfo
(
vif
->
addr
, 
mvm
->
nvm_d©a
->
hw_addr
);

91 
	`iwl_mei_£t_√tdev
(
	`õì80211_vif_to_wdev
(
vif
)->
√tdev
);

92 
mvm
->
csme_vif
 = 
vif
;

95 
out_u∆ock
;

97 
out_‰ì_bf
:

98 i‡(
mvm
->
bf_Ælowed_vif
 =
mvmvif
) {

99 
mvm
->
bf_Ælowed_vif
 = 
NULL
;

100 
vif
->
drivî_Êags
 &~(
IEEE80211_VIF_BEACON_FILTER
 |

101 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
);

103 
out_ªmove_mac
:

104 
mvmvif
->
lök
[0] = 
NULL
;

105 
	`iwl_mvm_mld_mac_˘xt_ªmove
(
mvm
, 
vif
);

106 
out_u∆ock
:

107 
	`muãx_u∆ock
(&
mvm
->
muãx
);

109  
ªt
;

110 
	}
}

112 
	$iwl_mvm_mld_mac_ªmove_öãrÁ˚
(
õì80211_hw
 *
hw
,

113 
õì80211_vif
 *
vif
)

115 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

116 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

117 
iwl_¥obe_ª•_d©a
 *
¥obe_d©a
;

119 
	`iwl_mvm_¥ï¨e_mac_ªmovÆ
(
mvm
, 
vif
);

121 i‡(!(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

122 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
))

123 
	`iwl_mvm_tcm_rm_vif
(
mvm
, 
vif
);

125 
	`muãx_lock
(&
mvm
->
muãx
);

127 i‡(
vif
 =
mvm
->
csme_vif
) {

128 
	`iwl_mei_£t_√tdev
(
NULL
);

129 
mvm
->
csme_vif
 = 
NULL
;

132 i‡(
mvm
->
bf_Ælowed_vif
 =
mvmvif
) {

133 
mvm
->
bf_Ælowed_vif
 = 
NULL
;

134 
vif
->
drivî_Êags
 &~(
IEEE80211_VIF_BEACON_FILTER
 |

135 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
);

138 i‡(
vif
->
bss_c⁄f
.
·m_ª•⁄dî
)

139 
	`mem£t
(&
mvm
->
·m_ª•_°©s
, 0, (mvm->ftm_resp_stats));

141 
	`iwl_mvm_vif_dbgfs_rm_lök
(
mvm
, 
vif
);

146 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

147 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

148 #ifde‡
CONFIG_NL80211_TESTMODE


149 i‡(
vif
 =
mvm
->
nﬂ_vif
) {

150 
mvm
->
nﬂ_vif
 = 
NULL
;

151 
mvm
->
nﬂ_duøti⁄
 = 0;

156 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

163 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

164 i‡(
mvmvif
->
deÊök
.
phy_˘xt
) {

165 
	`iwl_mvm_phy_˘xt_uƒef
(
mvm
, 
mvmvif
->
deÊök
.
phy_˘xt
);

166 
mvmvif
->
deÊök
.
phy_˘xt
 = 
NULL
;

168 
mvm
->
p2p_devi˚_vif
 = 
NULL
;

169 
	`iwl_mvm_ªmove_lök
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

171 
	`iwl_mvm_dißbÀ_lök
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

174 
	`iwl_mvm_mld_mac_˘xt_ªmove
(
mvm
, 
vif
);

176 
	`RCU_INIT_POINTER
(
mvm
->
vif_id_to_mac
[
mvmvif
->
id
], 
NULL
);

178 
¥obe_d©a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
,

179 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

180 
	`RCU_INIT_POINTER
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
, 
NULL
);

181 i‡(
¥obe_d©a
)

182 
	`k‰ì_rcu
(
¥obe_d©a
, 
rcu_hód
);

184 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

185 
mvm
->
m⁄ô‹_⁄
 = 
Ál£
;

186 
	`__˛ór_bô
(
IEEE80211_HW_RX_INCLUDES_FCS
, 
mvm
->
hw
->
Êags
);

189 
	`muãx_u∆ock
(&
mvm
->
muãx
);

190 
	}
}

192 
	$iwl_mvm_mld_cou¡_a˘ive_löks
(
õì80211_vif
 *
vif
)

194 
n_a˘ive
 = 0;

195 
i
;

197 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++) {

198 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

200 
lök_c⁄f
 = 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
i
);

201 i‡(
lök_c⁄f
 &&

202 
	`rcu_ac˚ss_poöãr
(
lök_c⁄f
->
ch™˘x_c⁄f
))

203 
n_a˘ive
++;

206  
n_a˘ive
;

207 
	}
}

209 
	$iwl_mvm_e§_mode_a˘ive
(
iwl_mvm
 *
mvm
,

210 
õì80211_vif
 *
vif
)

212 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

213 
lök_id
, 
ªt
 = 0;

215 
mvmvif
->
e§_a˘ive
 = 
åue
;

218 
vif
->
drivî_Êags
 |
IEEE80211_VIF_EML_ACTIVE
;

220 
	`iwl_mvm_upd©e_smps_⁄_a˘ive_löks
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_FW
,

221 
IEEE80211_SMPS_OFF
);

223 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
lök_id
) {

224 
iwl_mvm_vif_lök_öfo
 *
lök
 = 
mvmvif
->lök[
lök_id
];

226 i‡(!
lök
->
phy_˘xt
)

229 
ªt
 = 
	`iwl_mvm_phy_£nd_æc
(
mvm
, 
lök
->
phy_˘xt
, 2, 2);

230 i‡(
ªt
)

233 
lök
->
phy_˘xt
->
æc_dißbÀd
 = 
åue
;

236  
ªt
;

237 
	}
}

240 
	$__iwl_mvm_mld_assign_vif_ch™˘x
(
iwl_mvm
 *
mvm
,

241 
õì80211_vif
 *
vif
,

242 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

243 
õì80211_ch™˘x_c⁄f
 *
˘x
,

244 
boﬁ
 
swôchög_ch™˘x
)

246 
u16
 *
phy_˘xt_id
 = (u16 *)
˘x
->
drv_¥iv
;

247 
iwl_mvm_phy_˘xt
 *
phy_˘xt
 = &
mvm
->
phy_˘xts
[*
phy_˘xt_id
];

248 
n_a˘ive
 = 
	`iwl_mvm_mld_cou¡_a˘ive_löks
(
vif
);

249 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

250 
lök_id
 = 
lök_c⁄f
->link_id;

251 
ªt
;

254 i‡(!
	`rcu_ac˚ss_poöãr
(
lök_c⁄f
->
ch™˘x_c⁄f
))

255 
n_a˘ive
++;

257 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
lök
[
lök_id
]))

258  -
EINVAL
;

264 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
) {

265 
ªt
 = 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

266 i‡(
ªt
) {

267 
	`IWL_ERR
(
mvm
, "ÁûedÅÿupd©êMAC %pM\n", 
vif
->
addr
);

268  -
EINVAL
;

272 
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
 =Öhy_ctxt;

274 i‡(
	`iwl_mvm_is_e§_suµ‹ãd
(
mvm
->
fwπ
.
å™s
Ë&& 
n_a˘ive
 > 1) {

275 
mvmvif
->
lök
[
lök_id
]->
li°í_lmac
 = 
åue
;

276 
ªt
 = 
	`iwl_mvm_e§_mode_a˘ive
(
mvm
, 
vif
);

277 i‡(
ªt
) {

278 
	`IWL_ERR
(
mvm
, "ÁûedÅÿa˘iv©êESR modê(%d)\n", 
ªt
);

279 
out
;

283 i‡(
swôchög_ch™˘x
) {

285 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

286 
mvmvif
->
≠_ibss_a˘ive
 = 
åue
;

290 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
, 0, 
Ál£
);

291 i‡(
ªt
)

292 
out
;

304 i‡(
mvmvif
->
≠_°a
 &&

305 !
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

306 
õì80211_lök_°a
 *
lök_°a
;

308 
	`rcu_ªad_lock
();

309 
lök_°a
 = 
	`rcu_dîe„ªn˚
(
mvmvif
->
≠_°a
->
lök
[
lök_id
]);

311 i‡(!
	`WARN_ON_ONCE
(!
lök_°a
))

312 
	`iwl_mvm_rs_øã_öô
(
mvm
, 
vif
, 
mvmvif
->
≠_°a
,

313 
lök_c⁄f
, 
lök_°a
,

314 
phy_˘xt
->
ch™√l
->
b™d
);

315 
	`rcu_ªad_u∆ock
();

319 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
,

320 
LINK_CONTEXT_MODIFY_ACTIVE
 |

321 
LINK_CONTEXT_MODIFY_RATES_INFO
,

322 
åue
);

323 i‡(
ªt
)

324 
out
;

330 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

332 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

333 
ªt
 = 
	`iwl_mvm_mld_add_¢if_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

334 i‡(
ªt
)

335 
dó˘iv©e
;

340 
dó˘iv©e
:

341 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
, 
LINK_CONTEXT_MODIFY_ACTIVE
,

342 
Ál£
);

343 
out
:

344 
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
 = 
NULL
;

345 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

346  
ªt
;

347 
	}
}

349 
	$iwl_mvm_mld_assign_vif_ch™˘x
(
õì80211_hw
 *
hw
,

350 
õì80211_vif
 *
vif
,

351 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

352 
õì80211_ch™˘x_c⁄f
 *
˘x
)

354 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

355 
ªt
;

357 
	`muãx_lock
(&
mvm
->
muãx
);

358 
ªt
 = 
	`__iwl_mvm_mld_assign_vif_ch™˘x
(
mvm
, 
vif
, 
lök_c⁄f
, 
˘x
, 
Ál£
);

359 
	`muãx_u∆ock
(&
mvm
->
muãx
);

361  
ªt
;

362 
	}
}

364 
	$iwl_mvm_e§_mode_öa˘ive
(
iwl_mvm
 *
mvm
,

365 
õì80211_vif
 *
vif
)

367 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

368 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

369 
lök_id
, 
ªt
 = 0;

371 
mvmvif
->
e§_a˘ive
 = 
Ál£
;

373 
vif
->
drivî_Êags
 &~
IEEE80211_VIF_EML_ACTIVE
;

375 
	`iwl_mvm_upd©e_smps_⁄_a˘ive_löks
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_FW
,

376 
IEEE80211_SMPS_AUTOMATIC
);

378 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
) {

379 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

380 
iwl_mvm_phy_˘xt
 *
phy_˘xt
;

381 
u8
 
°©ic_chaös
, 
dy«mic_chaös
;

383 
mvmvif
->
lök
[
lök_id
]->
li°í_lmac
 = 
Ál£
;

385 
	`rcu_ªad_lock
();

387 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->chanctx_conf);

388 
phy_˘xt
 = 
mvmvif
->
lök
[
lök_id
]->phy_ctxt;

390 i‡(!
ch™˘x_c⁄f
 || !
phy_˘xt
) {

391 
	`rcu_ªad_u∆ock
();

395 
phy_˘xt
->
æc_dißbÀd
 = 
Ál£
;

396 
°©ic_chaös
 = 
ch™˘x_c⁄f
->
rx_chaös_°©ic
;

397 
dy«mic_chaös
 = 
ch™˘x_c⁄f
->
rx_chaös_dy«mic
;

399 
	`rcu_ªad_u∆ock
();

401 
ªt
 = 
	`iwl_mvm_phy_£nd_æc
(
mvm
, 
phy_˘xt
, 
°©ic_chaös
,

402 
dy«mic_chaös
);

403 i‡(
ªt
)

407  
ªt
;

408 
	}
}

411 
	$__iwl_mvm_mld_u«ssign_vif_ch™˘x
(
iwl_mvm
 *
mvm
,

412 
õì80211_vif
 *
vif
,

413 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

414 
õì80211_ch™˘x_c⁄f
 *
˘x
,

415 
boﬁ
 
swôchög_ch™˘x
)

418 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

419 
n_a˘ive
 = 
	`iwl_mvm_mld_cou¡_a˘ive_löks
(
vif
);

420 
lök_id
 = 
lök_c⁄f
->link_id;

423 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
lök
[
lök_id
]))

426 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && 
swôchög_ch™˘x
) {

427 
mvmvif
->
cß_cou¡down
 = 
Ál£
;

430 
	`iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
mvm
, 
mvmvif
, 
åue
);

433 
	`rcu_assign_poöãr
(
mvm
->
cß_tx_blocked_vif
, 
vif
);

435 
mvmvif
->
≠_ibss_a˘ive
 = 
Ál£
;

438 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
,

439 
LINK_CONTEXT_MODIFY_ACTIVE
, 
Ál£
);

441 i‡(
	`iwl_mvm_is_e§_suµ‹ãd
(
mvm
->
fwπ
.
å™s
Ë&& 
n_a˘ive
 > 1) {

442 
ªt
 = 
	`iwl_mvm_e§_mode_öa˘ive
(
mvm
, 
vif
);

444 i‡(
ªt
)

445 
	`IWL_ERR
(
mvm
, "failedÅo deactivate ESR mode (%d)\n",

446 
ªt
);

449 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
)

450 
	`iwl_mvm_mld_rm_¢if_°a
(
mvm
, 
vif
);

452 i‡(
swôchög_ch™˘x
)

454 
mvmvif
->
lök
[
lök_id
]->
phy_˘xt
 = 
NULL
;

455 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

456 
	}
}

458 
	$iwl_mvm_mld_u«ssign_vif_ch™˘x
(
õì80211_hw
 *
hw
,

459 
õì80211_vif
 *
vif
,

460 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

461 
õì80211_ch™˘x_c⁄f
 *
˘x
)

463 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

464 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

466 
	`muãx_lock
(&
mvm
->
muãx
);

467 
	`__iwl_mvm_mld_u«ssign_vif_ch™˘x
(
mvm
, 
vif
, 
lök_c⁄f
, 
˘x
, 
Ál£
);

469 i‡(!
	`õì80211_vif_is_mld
(
vif
Ë&& !
mvmvif
->
≠_°a
 &&

470 !
	`WARN_ON_ONCE
(
vif
->
cfg
.
assoc
)) {

471 
	`iwl_mvm_ªmove_lök
(
mvm
, 
vif
, 
lök_c⁄f
);

472 
	`iwl_mvm_add_lök
(
mvm
, 
vif
, 
lök_c⁄f
);

474 
	`muãx_u∆ock
(&
mvm
->
muãx
);

475 
	}
}

477 
	$iwl_mvm_mld_°¨t_≠_ibss
(
õì80211_hw
 *
hw
,

478 
õì80211_vif
 *
vif
,

479 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

481 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

482 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

483 
ªt
;

485 
	`muãx_lock
(&
mvm
->
muãx
);

487 
ªt
 = 
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
);

488 i‡(
ªt
)

489 
out_u∆ock
;

492 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
,

493 
LINK_CONTEXT_MODIFY_ALL
 &

494 ~
LINK_CONTEXT_MODIFY_ACTIVE
,

495 
åue
);

496 i‡(
ªt
)

497 
out_u∆ock
;

499 
ªt
 = 
	`iwl_mvm_mld_add_mˇ°_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

500 i‡(
ªt
)

501 
out_u∆ock
;

506 
ªt
 = 
	`iwl_mvm_mld_add_bˇ°_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

507 i‡(
ªt
)

508 
out_rm_mˇ°
;

510 i‡(
	`iwl_mvm_°¨t_≠_ibss_comm⁄
(
hw
, 
vif
, &
ªt
))

511 
out_Áûed
;

514 i‡(
vif
->
p2p
 && 
mvm
->
p2p_devi˚_vif
)

515 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, mvm->
p2p_devi˚_vif
, 
Ál£
);

517 
	`iwl_mvm_bt_c€x_vif_ch™ge
(
mvm
);

520 i‡(
	`iwl_mvm_phy_˘x_cou¡
(
mvm
) > 1)

521 
	`iwl_mvm_ã¨down_tdls_≥îs
(
mvm
);

523 
	`iwl_mvm_·m_ª°¨t_ª•⁄dî
(
mvm
, 
vif
, 
lök_c⁄f
);

525 
out_u∆ock
;

527 
out_Áûed
:

528 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

529 
mvmvif
->
≠_ibss_a˘ive
 = 
Ál£
;

530 
	`iwl_mvm_mld_rm_bˇ°_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

531 
out_rm_mˇ°
:

532 
	`iwl_mvm_mld_rm_mˇ°_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

533 
out_u∆ock
:

534 
	`muãx_u∆ock
(&
mvm
->
muãx
);

535  
ªt
;

536 
	}
}

538 
	$iwl_mvm_mld_°¨t_≠
(
õì80211_hw
 *
hw
,

539 
õì80211_vif
 *
vif
,

540 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

542  
	`iwl_mvm_mld_°¨t_≠_ibss
(
hw
, 
vif
, 
lök_c⁄f
);

543 
	}
}

545 
	$iwl_mvm_mld_°¨t_ibss
(
õì80211_hw
 *
hw
,

546 
õì80211_vif
 *
vif
)

548  
	`iwl_mvm_mld_°¨t_≠_ibss
(
hw
, 
vif
, &vif->
bss_c⁄f
);

549 
	}
}

551 
	$iwl_mvm_mld_°›_≠_ibss
(
õì80211_hw
 *
hw
,

552 
õì80211_vif
 *
vif
,

553 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

555 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

557 
	`muãx_lock
(&
mvm
->
muãx
);

559 
	`iwl_mvm_°›_≠_ibss_comm⁄
(
mvm
, 
vif
);

562 i‡(
vif
->
p2p
 && 
mvm
->
p2p_devi˚_vif
)

563 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, mvm->
p2p_devi˚_vif
, 
Ál£
);

565 
	`iwl_mvm_·m_ª•⁄dî_˛ór
(
mvm
, 
vif
);

567 
	`iwl_mvm_mld_rm_bˇ°_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

568 
	`iwl_mvm_mld_rm_mˇ°_°a
(
mvm
, 
vif
, 
lök_c⁄f
);

570 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

571 
	`muãx_u∆ock
(&
mvm
->
muãx
);

572 
	}
}

574 
	$iwl_mvm_mld_°›_≠
(
õì80211_hw
 *
hw
,

575 
õì80211_vif
 *
vif
,

576 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

578 
	`iwl_mvm_mld_°›_≠_ibss
(
hw
, 
vif
, 
lök_c⁄f
);

579 
	}
}

581 
	$iwl_mvm_mld_°›_ibss
(
õì80211_hw
 *
hw
,

582 
õì80211_vif
 *
vif
)

584 
	`iwl_mvm_mld_°›_≠_ibss
(
hw
, 
vif
, &vif->
bss_c⁄f
);

585 
	}
}

587 
	$iwl_mvm_mld_mac_°a_°©e
(
õì80211_hw
 *
hw
,

588 
õì80211_vif
 *
vif
,

589 
õì80211_°a
 *
°a
,

590 
õì80211_°a_°©e
 
ﬁd_°©e
,

591 
õì80211_°a_°©e
 
√w_°©e
)

593 c⁄° 
iwl_mvm_°a_°©e_›s
 
ˇŒbacks
 = {

594 .
add_°a
 = 
iwl_mvm_mld_add_°a
,

595 .
upd©e_°a
 = 
iwl_mvm_mld_upd©e_°a
,

596 .
rm_°a
 = 
iwl_mvm_mld_rm_°a
,

597 .
mac_˘xt_ch™ged
 = 
iwl_mvm_mld_mac_˘xt_ch™ged
,

600  
	`iwl_mvm_mac_°a_°©e_comm⁄
(
hw
, 
vif
, 
°a
, 
ﬁd_°©e
, 
√w_°©e
,

601 &
ˇŒbacks
);

602 
	}
}

604 
	siwl_mvm_lök_£l_d©a
 {

605 
u8
 
	mlök_id
;

606 
∆80211_b™d
 
	mb™d
;

607 
∆80211_ch™_width
 
	mwidth
;

608 
boﬁ
 
	ma˘ive
;

611 
boﬁ
 
	$iwl_mvm_mld_vÆid_lök_∑ú
(
iwl_mvm_lök_£l_d©a
 *
a
,

612 
iwl_mvm_lök_£l_d©a
 *
b
)

614  
a
->
b™d
 !
b
->band;

615 
	}
}

617 
	$iwl_mvm_mld_£À˘_löks
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

618 
boﬁ
 
vÆid_löks_ch™ged
)

620 
iwl_mvm_lök_£l_d©a
 
d©a
[
IEEE80211_MLD_MAX_NUM_LINKS
];

621 
ußbÀ_löks
 = 
	`õì80211_vif_ußbÀ_löks
(
vif
);

622 
u32
 
max_a˘ive_löks
 = 
	`iwl_mvm_max_a˘ive_löks
(
mvm
, 
vif
);

623 
u16
 
√w_a˘ive_löks
;

624 
u8
 
lök_id
, 
n_d©a
 = 0, 
i
, 
j
;

626 i‡(!
IWL_MVM_AUTO_EML_ENABLE
)

629 i‡(!
	`õì80211_vif_is_mld
(
vif
Ë|| 
ußbÀ_löks
 == 1)

635 
	`WARN_ON_ONCE
(
max_a˘ive_löks
 > 2);

640 i‡(
max_a˘ive_löks
 =1 && !
vÆid_löks_ch™ged
)

646 i‡(
	`hweight16
(
vif
->
a˘ive_löks
Ë=
max_a˘ive_löks
)

649 
	`rcu_ªad_lock
();

651 
	`f‹_óch_£t_bô
(
lök_id
, &
ußbÀ_löks
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

652 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

653 
	`rcu_dîe„ªn˚
(
vif
->
lök_c⁄f
[
lök_id
]);

655 i‡(
	`WARN_ON_ONCE
(!
lök_c⁄f
))

658 
d©a
[
n_d©a
].
lök_id
 =Üink_id;

659 
d©a
[
n_d©a
].
b™d
 = 
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->band;

660 
d©a
[
n_d©a
].
width
 = 
lök_c⁄f
->
ch™ªq
.
›î
.width;

661 
d©a
[
n_d©a
].
a˘ive
 = 
vif
->
a˘ive_löks
 & 
	`BIT
(
lök_id
);

662 
n_d©a
++;

665 
	`rcu_ªad_u∆ock
();

668 i‡(
n_d©a
 == 1)

671 
√w_a˘ive_löks
 = 0;

676 i‡(!
vÆid_löks_ch™ged
) {

677 
i
 = 0; i < 
n_d©a
; i++) {

678 i‡(
d©a
[
i
].
a˘ive
)

682 i‡(
	`WARN_ON_ONCE
(
i
 =
n_d©a
))

685 
j
 = 0; j < 
n_d©a
; j++) {

686 i‡(
i
 =
j
)

689 i‡(
	`iwl_mvm_mld_vÆid_lök_∑ú
(&
d©a
[
i
], &d©a[
j
]))

693 i‡(
j
 !
n_d©a
)

694 
√w_a˘ive_löks
 = 
	`BIT
(
d©a
[
i
].
lök_id
) |

695 
	`BIT
(
d©a
[
j
].
lök_id
);

700 
i
 = 0; i < 
n_d©a
; i++) {

701 
j
 = 0; j < 
n_d©a
; j++) {

702 i‡(
i
 =
j
)

705 i‡(
	`iwl_mvm_mld_vÆid_lök_∑ú
(&
d©a
[
i
],

706 &
d©a
[
j
]))

711 i‡(
j
 !
n_d©a
) {

712 
√w_a˘ive_löks
 = 
	`BIT
(
d©a
[
i
].
lök_id
) |

713 
	`BIT
(
d©a
[
j
].
lök_id
);

719 i‡(!
√w_a˘ive_löks
)

722 i‡(
vif
->
a˘ive_löks
 !
√w_a˘ive_löks
)

723 
	`õì80211_£t_a˘ive_löks_async
(
vif
, 
√w_a˘ive_löks
);

724 
	}
}

727 
	$iwl_mvm_mld_lök_öfo_ch™ged_°©i⁄
(
iwl_mvm
 *
mvm
,

728 
õì80211_vif
 *
vif
,

729 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

730 
u64
 
ch™ges
)

732 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

733 
boﬁ
 
has_he
, 
has_eht
;

734 
u32
 
lök_ch™ges
 = 0;

735 
ªt
;

737 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
]))

740 
has_he
 = 
lök_c⁄f
->
he_suµ‹t
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
;

741 
has_eht
 = 
lök_c⁄f
->
eht_suµ‹t
 && !
iwlwifi_mod_∑øms
.
dißbÀ_11be
;

744 i‡(
ch™ges
 & 
BSS_CHANGED_QOS
 && 
vif
->
cfg
.
assoc
 && 
lök_c⁄f
->
qos
)

745 
lök_ch™ges
 |
LINK_CONTEXT_MODIFY_QOS_PARAMS
;

747 i‡(
ch™ges
 & 
BSS_CHANGED_ERP_SLOT
)

748 
lök_ch™ges
 |
LINK_CONTEXT_MODIFY_RATES_INFO
;

750 i‡(
vif
->
cfg
.
assoc
 && (
has_he
 || 
has_eht
)) {

751 
	`IWL_DEBUG_MAC80211
(
mvm
, "Associated in HE mode\n");

752 
lök_ch™ges
 |
LINK_CONTEXT_MODIFY_HE_PARAMS
;

756 i‡(
vif
->
cfg
.
assoc
)

757 
lök_ch™ges
 |
LINK_CONTEXT_MODIFY_EHT_PARAMS
;

759 i‡(
lök_ch™ges
) {

760 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
, 
lök_ch™ges
,

761 
åue
);

762 i‡(
ªt
)

763 
	`IWL_ERR
(
mvm
, "failedÅo updateÜink\n");

766 
ªt
 = 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

767 i‡(
ªt
)

768 
	`IWL_ERR
(
mvm
, "ÁûedÅÿupd©êMAC %pM\n", 
vif
->
addr
);

770 i‡(
ch™ges
 & 
BSS_CHANGED_MLD_VALID_LINKS
)

771 
	`iwl_mvm_mld_£À˘_löks
(
mvm
, 
vif
, 
åue
);

773 
	`mem˝y
(
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
]->
bssid
,Üink_conf->bssid,

774 
ETH_ALEN
);

776 
	`iwl_mvm_bss_öfo_ch™ged_°©i⁄_comm⁄
(
mvm
, 
vif
, 
lök_c⁄f
, 
ch™ges
);

777 
	}
}

779 
boﬁ
 
	$iwl_mvm_mld_vif_have_vÆid_≠_°a
(
iwl_mvm_vif
 *
mvmvif
)

781 
i
;

783 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
) {

784 i‡(
mvmvif
->
lök
[
i
]->
≠_°a_id
 !
IWL_MVM_INVALID_STA
)

785  
åue
;

788  
Ál£
;

789 
	}
}

791 
	$iwl_mvm_mld_vif_dñëe_Æl_°as
(
iwl_mvm
 *
mvm
,

792 
õì80211_vif
 *
vif
)

794 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

795 
i
, 
ªt
;

797 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

800 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
) {

801 
iwl_mvm_vif_lök_öfo
 *
lök
 = 
mvmvif
->lök[
i
];

803 i‡(!
lök
)

806 
	`iwl_mvm_£c_key_ªmove_≠
(
mvm
, 
vif
, 
lök
, 
i
);

807 
ªt
 = 
	`iwl_mvm_mld_rm_°a_id
(
mvm
, 
lök
->
≠_°a_id
);

808 i‡(
ªt
)

809 
	`IWL_ERR
(
mvm
, "failedÅoÑemove AP station\n");

811 
lök
->
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

813 
	}
}

815 
	$iwl_mvm_mld_vif_cfg_ch™ged_°©i⁄
(
iwl_mvm
 *
mvm
,

816 
õì80211_vif
 *
vif
,

817 
u64
 
ch™ges
)

819 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

820 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

821 
boﬁ
 
¥Ÿe˘
 = 
Ál£
;

822 
i
;

823 
ªt
;

828 i‡(
ch™ges
 =
BSS_CHANGED_IDLE
)

831 
ªt
 = 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

832 i‡(
ªt
)

833 
	`IWL_ERR
(
mvm
, "ÁûedÅÿupd©êMAC %pM\n", 
vif
->
addr
);

835 
mvmvif
->
assocüãd
 = 
vif
->
cfg
.
assoc
;

837 i‡(
ch™ges
 & 
BSS_CHANGED_ASSOC
) {

838 i‡(
vif
->
cfg
.
assoc
) {

840 
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
åue
);

841 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

842 
	`iwl_mvm_powî_vif_assoc
(
mvm
, 
vif
);

844 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
) {

845 
	`mem£t
(&
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
, 0,

846 (
mvmvif
->
lök
[
i
]->
bóc⁄_°©s
));

848 i‡(
vif
->
p2p
) {

849 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
,

850 
IWL_MVM_SMPS_REQ_PROT
,

851 
IEEE80211_SMPS_DYNAMIC
, 
i
);

854 
	`rcu_ªad_lock
();

855 
lök_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->lök_c⁄f[
i
]);

856 i‡(
lök_c⁄f
 && !lök_c⁄f->
dtim_≥riod
)

857 
¥Ÿe˘
 = 
åue
;

858 
	`rcu_ªad_u∆ock
();

861 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

862 
¥Ÿe˘
) {

866 
lök_id
 =

867 
	`ffs
(
vif
->
a˘ive_löks
) - 1;

878 
	`iwl_mvm_¥Ÿe˘_assoc
(
mvm
, 
vif
, 0, 
lök_id
);

881 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

884 
	`iwl_mvm_powî_vif_assoc
(
mvm
, 
vif
);

885 } i‡(
	`iwl_mvm_mld_vif_have_vÆid_≠_°a
(
mvmvif
)) {

886 
	`iwl_mvm_mei_ho°_dißssocüãd
(
mvm
);

891 
ªt
 = 
	`iwl_mvm_sf_upd©e
(
mvm
, 
vif
, 
Ál£
);

892 
	`WARN_ONCE
(
ªt
 &&

893 !
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
,

894 &
mvm
->
°©us
),

904 
	`iwl_mvm_mld_vif_dñëe_Æl_°as
(
mvm
, 
vif
);

907 
	`iwl_mvm_bss_öfo_ch™ged_°©i⁄_assoc
(
mvm
, 
vif
, 
ch™ges
);

910 i‡(
ch™ges
 & 
BSS_CHANGED_PS
) {

911 
ªt
 = 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

912 i‡(
ªt
)

913 
	`IWL_ERR
(
mvm
, "failedÅo updateÖower mode\n");

915 
	}
}

918 
	$iwl_mvm_mld_lök_öfo_ch™ged_≠_ibss
(
iwl_mvm
 *
mvm
,

919 
õì80211_vif
 *
vif
,

920 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

921 
u64
 
ch™ges
)

923 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

924 
u32
 
lök_ch™ges
 = 
LINK_CONTEXT_MODIFY_PROTECT_FLAGS
 |

925 
LINK_CONTEXT_MODIFY_QOS_PARAMS
;

928 i‡(!
mvmvif
->
≠_ibss_a˘ive
)

931 i‡(
lök_c⁄f
->
he_suµ‹t
)

932 
lök_ch™ges
 |
LINK_CONTEXT_MODIFY_HE_PARAMS
;

934 i‡(
ch™ges
 & 
BSS_CHANGED_ERP_SLOT
)

935 
lök_ch™ges
 |
LINK_CONTEXT_MODIFY_RATES_INFO
;

937 i‡(
ch™ges
 & (
BSS_CHANGED_ERP_CTS_PROT
 | 
BSS_CHANGED_ERP_SLOT
 |

938 
BSS_CHANGED_HT
 |

939 
BSS_CHANGED_BANDWIDTH
 | 
BSS_CHANGED_QOS
 |

940 
BSS_CHANGED_HE_BSS_COLOR
) &&

941 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
,

942 
lök_ch™ges
, 
åue
))

943 
	`IWL_ERR
(
mvm
, "ÁûedÅÿupd©êMAC %pM\n", 
vif
->
addr
);

946 i‡(
ch™ges
 & 
BSS_CHANGED_BEACON
 &&

947 
	`iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
mvm
, 
vif
, 
lök_c⁄f
))

948 
	`IWL_WARN
(
mvm
, "Failed updating beacon data\n");

951 i‡(
ch™ges
 & 
BSS_CHANGED_FTM_RESPONDER
) {

952 
ªt
 = 
	`iwl_mvm_·m_°¨t_ª•⁄dî
(
mvm
, 
vif
, 
lök_c⁄f
);

954 i‡(
ªt
)

955 
	`IWL_WARN
(
mvm
, "FailedÅoÉnable FTMÑesponder (%d)\n",

956 
ªt
);

958 
	}
}

960 
	$iwl_mvm_mld_lök_öfo_ch™ged
(
õì80211_hw
 *
hw
,

961 
õì80211_vif
 *
vif
,

962 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

963 
u64
 
ch™ges
)

965 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

967 
	`muãx_lock
(&
mvm
->
muãx
);

969 
vif
->
ty≥
) {

970 
NL80211_IFTYPE_STATION
:

971 
	`iwl_mvm_mld_lök_öfo_ch™ged_°©i⁄
(
mvm
, 
vif
, 
lök_c⁄f
,

972 
ch™ges
);

974 
NL80211_IFTYPE_AP
:

975 
NL80211_IFTYPE_ADHOC
:

976 
	`iwl_mvm_mld_lök_öfo_ch™ged_≠_ibss
(
mvm
, 
vif
, 
lök_c⁄f
,

977 
ch™ges
);

979 
NL80211_IFTYPE_MONITOR
:

980 i‡(
ch™ges
 & 
BSS_CHANGED_MU_GROUPS
)

981 
	`iwl_mvm_upd©e_mu_groups
(
mvm
, 
vif
);

985 
	`WARN_ON_ONCE
(1);

988 i‡(
ch™ges
 & 
BSS_CHANGED_TXPOWER
) {

989 
	`IWL_DEBUG_CALIB
(
mvm
, "Changing TX PowerÅo %d dBm\n",

990 
lök_c⁄f
->
txpowî
);

991 
	`iwl_mvm_£t_tx_powî
(
mvm
, 
vif
, 
lök_c⁄f
->
txpowî
);

994 
	`muãx_u∆ock
(&
mvm
->
muãx
);

995 
	}
}

997 
	$iwl_mvm_mld_vif_cfg_ch™ged
(
õì80211_hw
 *
hw
,

998 
õì80211_vif
 *
vif
,

999 
u64
 
ch™ges
)

1001 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1003 
	`muãx_lock
(&
mvm
->
muãx
);

1005 i‡(
ch™ges
 & 
BSS_CHANGED_IDLE
 && !
vif
->
cfg
.
idÀ
)

1006 
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_SCHED
, 
åue
);

1008 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

1009 
	`iwl_mvm_mld_vif_cfg_ch™ged_°©i⁄
(
mvm
, 
vif
, 
ch™ges
);

1011 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1012 
	}
}

1015 
	$iwl_mvm_mld_swôch_vif_ch™˘x
(
õì80211_hw
 *
hw
,

1016 
õì80211_vif_ch™˘x_swôch
 *
vifs
,

1017 
n_vifs
,

1018 
õì80211_ch™˘x_swôch_mode
 
mode
)

1020 c⁄° 
iwl_mvm_swôch_vif_ch™˘x_›s
 
›s
 = {

1021 .
__assign_vif_ch™˘x
 = 
__iwl_mvm_mld_assign_vif_ch™˘x
,

1022 .
__u«ssign_vif_ch™˘x
 = 
__iwl_mvm_mld_u«ssign_vif_ch™˘x
,

1025  
	`iwl_mvm_swôch_vif_ch™˘x_comm⁄
(
hw
, 
vifs
, 
n_vifs
, 
mode
, &
›s
);

1026 
	}
}

1028 
	$iwl_mvm_mld_c⁄fig_iÁ˚_fûãr
(
õì80211_hw
 *
hw
,

1029 
õì80211_vif
 *
vif
,

1030 
fûãr_Êags
,

1031 
ch™ged_Êags
)

1033 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1036 i‡(!(
ch™ged_Êags
 & 
FIF_PROBE_REQ
))

1040 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || !vif->
cfg
.
assoc
 ||

1041 !
vif
->
p2p
)

1044 
	`muãx_lock
(&
mvm
->
muãx
);

1045 
	`iwl_mvm_mld_mac_˘xt_ch™ged
(
mvm
, 
vif
, 
Ál£
);

1046 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1047 
	}
}

1050 
	$iwl_mvm_mld_mac_c⁄f_tx
(
õì80211_hw
 *
hw
,

1051 
õì80211_vif
 *
vif
,

1052 
lök_id
, 
u16
 
ac
,

1053 c⁄° 
õì80211_tx_queue_∑øms
 *
∑øms
)

1055 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1056 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1057 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 = 
mvmvif
->
lök
[
lök_id
];

1059 i‡(!
mvm_lök
)

1060  -
EINVAL
;

1062 
mvm_lök
->
queue_∑øms
[
ac
] = *
∑øms
;

1067 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

1068 
ªt
;

1070 
	`muãx_lock
(&
mvm
->
muãx
);

1071 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, &vif->
bss_c⁄f
,

1072 
LINK_CONTEXT_MODIFY_QOS_PARAMS
,

1073 
åue
);

1074 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1075  
ªt
;

1078 
	}
}

1080 
	$iwl_mvm_mld_roc_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

1082 
ªt
;

1084 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1087 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, &vif->
bss_c⁄f
, 0, 
Ál£
);

1088 i‡(
	`WARN
(
ªt
, "FailedÅo set PHY context ID\n"))

1089  
ªt
;

1091 
ªt
 = 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, &vif->
bss_c⁄f
,

1092 
LINK_CONTEXT_MODIFY_ACTIVE
 |

1093 
LINK_CONTEXT_MODIFY_RATES_INFO
,

1094 
åue
);

1096 i‡(
	`WARN
(
ªt
, "FailedÜinking P2P_DEVICE\n"))

1097  
ªt
;

1102  
	`iwl_mvm_mld_add_bˇ°_°a
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

1103 
	}
}

1105 
	$iwl_mvm_mld_roc
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

1106 
õì80211_ch™√l
 *
ch™√l
, 
duøti⁄
,

1107 
õì80211_roc_ty≥
 
ty≥
)

1109 c⁄° 
iwl_mvm_roc_›s
 
›s
 = {

1110 .
add_aux_°a_f‹_hs20
 = 
iwl_mvm_mld_add_aux_°a
,

1111 .
lök
 = 
iwl_mvm_mld_roc_lök
,

1114  
	`iwl_mvm_roc_comm⁄
(
hw
, 
vif
, 
ch™√l
, 
duøti⁄
, 
ty≥
, &
›s
);

1115 
	}
}

1118 
	$iwl_mvm_mld_ch™ge_vif_löks
(
õì80211_hw
 *
hw
,

1119 
õì80211_vif
 *
vif
,

1120 
u16
 
ﬁd_löks
, u16 
√w_löks
,

1121 
õì80211_bss_c⁄f
 *
ﬁd
[
IEEE80211_MLD_MAX_NUM_LINKS
])

1123 
iwl_mvm_vif_lök_öfo
 *
√w_lök
[
IEEE80211_MLD_MAX_NUM_LINKS
] = {};

1124 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1125 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1126 
u16
 
ªmoved
 = 
ﬁd_löks
 & ~
√w_löks
;

1127 
u16
 
added
 = 
√w_löks
 & ~
ﬁd_löks
;

1128 
îr
, 
i
;

1130 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++) {

1131 
r
;

1133 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

1136 i‡(!(
added
 & 
	`BIT
(
i
)))

1138 
√w_lök
[
i
] = 
	`kzÆloc
((*√w_lök[i]), 
GFP_KERNEL
);

1139 i‡(!
√w_lök
[
i
]) {

1140 
îr
 = -
ENOMEM
;

1141 
‰ì
;

1144 
√w_lök
[
i
]->
bˇ°_°a
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

1145 
√w_lök
[
i
]->
mˇ°_°a
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

1146 
√w_lök
[
i
]->
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

1147 
√w_lök
[
i
]->
fw_lök_id
 = 
IWL_MVM_FW_LINK_ID_INVALID
;

1149 
r
 = 0;Ñ < 
NUM_IWL_MVM_SMPS_REQ
;Ñ++)

1150 
√w_lök
[
i
]->
smps_ªque°s
[
r
] =

1151 
IEEE80211_SMPS_AUTOMATIC
;

1154 
	`muãx_lock
(&
mvm
->
muãx
);

1156 i‡(
ﬁd_löks
 == 0) {

1157 
îr
 = 
	`iwl_mvm_dißbÀ_lök
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

1158 i‡(
îr
)

1159 
out_îr
;

1160 
mvmvif
->
lök
[0] = 
NULL
;

1163 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++) {

1164 i‡(
ªmoved
 & 
	`BIT
(
i
)) {

1165 
õì80211_bss_c⁄f
 *
lök_c⁄f
 = 
ﬁd
[
i
];

1167 
îr
 = 
	`iwl_mvm_dißbÀ_lök
(
mvm
, 
vif
, 
lök_c⁄f
);

1168 i‡(
îr
)

1169 
out_îr
;

1170 
	`k‰ì
(
mvmvif
->
lök
[
i
]);

1171 
mvmvif
->
lök
[
i
] = 
NULL
;

1172 } i‡(
added
 & 
	`BIT
(
i
)) {

1173 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

1175 
lök_c⁄f
 = 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
i
);

1176 i‡(
	`WARN_ON
(!
lök_c⁄f
))

1179 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
,

1180 &
mvm
->
°©us
))

1181 
mvmvif
->
lök
[
i
] = 
√w_lök
[i];

1182 
√w_lök
[
i
] = 
NULL
;

1183 
îr
 = 
	`iwl_mvm_add_lök
(
mvm
, 
vif
, 
lök_c⁄f
);

1184 i‡(
îr
)

1185 
out_îr
;

1189 
îr
 = 0;

1190 i‡(
√w_löks
 == 0) {

1191 
mvmvif
->
lök
[0] = &mvmvif->
deÊök
;

1192 
îr
 = 
	`iwl_mvm_add_lök
(
mvm
, 
vif
, &vif->
bss_c⁄f
);

1195 
out_îr
:

1197 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1199 
‰ì
:

1200 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++)

1201 
	`k‰ì
(
√w_lök
[
i
]);

1202  
îr
;

1203 
	}
}

1206 
	$iwl_mvm_mld_ch™ge_°a_löks
(
õì80211_hw
 *
hw
,

1207 
õì80211_vif
 *
vif
,

1208 
õì80211_°a
 *
°a
,

1209 
u16
 
ﬁd_löks
, u16 
√w_löks
)

1211 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1212 
ªt
;

1214 
	`muãx_lock
(&
mvm
->
muãx
);

1215 
ªt
 = 
	`iwl_mvm_mld_upd©e_°a_löks
(
mvm
, 
vif
, 
°a
, 
ﬁd_löks
, 
√w_löks
);

1216 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1218  
ªt
;

1219 
	}
}

1226 
	$iwl_mvm_mld_gë_¥im¨y_lök
(
iwl_mvm
 *
mvm
,

1227 
õì80211_vif
 *
vif
,

1228 
ußbÀ_löks
)

1230 
iwl_mvm_lök_£l_d©a
 
d©a
[
IEEE80211_MLD_MAX_NUM_LINKS
];

1231 
u8
 
lök_id
, 
n_d©a
 = 0;

1233 i‡(!
	`õì80211_vif_is_mld
(
vif
Ë|| !vif->
cfg
.
assoc
)

1236 
	`f‹_óch_£t_bô
(
lök_id
, &
ußbÀ_löks
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1237 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

1238 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

1240 i‡(
	`WARN_ON_ONCE
(!
lök_c⁄f
))

1243 
d©a
[
n_d©a
].
lök_id
 =Üink_id;

1244 
d©a
[
n_d©a
].
b™d
 = 
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->band;

1245 
d©a
[
n_d©a
].
width
 = 
lök_c⁄f
->
ch™ªq
.
›î
.width;

1246 
d©a
[
n_d©a
].
a˘ive
 = 
åue
;

1247 
n_d©a
++;

1250 i‡(
n_d©a
 <= 1)

1254 
	`WARN_ON_ONCE
(
n_d©a
 > 2);

1257 i‡(
d©a
[0].
width
 > data[1].width)

1258  
d©a
[0].
lök_id
;

1259 i‡(
d©a
[0].
width
 < data[1].width)

1260  
d©a
[1].
lök_id
;

1261 i‡(
d©a
[0].
b™d
 >= data[1].band)

1262  
d©a
[0].
lök_id
;

1264  
d©a
[1].
lök_id
;

1265 
	}
}

1271 
boﬁ
 
	$iwl_mvm_ˇn_íãr_e§
(
iwl_mvm
 *
mvm
,

1272 
õì80211_vif
 *
vif
,

1273 
desúed_löks
)

1275 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1276 
¥im¨y_lök
 = 
	`iwl_mvm_mld_gë_¥im¨y_lök
(
mvm
, 
vif
,

1277 
desúed_löks
);

1278 c⁄° 
wùhy_i·y≥_ext_ˇ∑b
 *
ext_ˇ∑
;

1279 
boﬁ
 
ªt
 = 
åue
;

1280 
lök_id
;

1282 i‡(
¥im¨y_lök
 < 0)

1283  
Ál£
;

1285 i‡(!(
vif
->
cfg
.
eml_ˇp
 & 
IEEE80211_EML_CAP_EMLSR_SUPP
))

1286  
Ál£
;

1288 
ext_ˇ∑
 = 
	`cfg80211_gë_i·y≥_ext_ˇ∑
(
mvm
->
hw
->
wùhy
,

1289 
	`õì80211_vif_ty≥_p2p
(
vif
));

1290 i‡(!
ext_ˇ∑
 ||

1291 !(
ext_ˇ∑
->
eml_ˇ∑bûôõs
 & 
IEEE80211_EML_CAP_EMLSR_SUPP
))

1292  
Ál£
;

1294 
	`f‹_óch_£t_bô
(
lök_id
, &
desúed_löks
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1295 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

1296 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

1298 i‡(
	`WARN_ON_ONCE
(!
lök_c⁄f
))

1302 i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->
b™d
 !
NL80211_BAND_2GHZ
)

1305 
ªt
 = 
	`iwl_mvm_bt_c€x_ˇlcuœã_e§_mode
(
mvm
, 
vif
, 
lök_id
,

1306 
¥im¨y_lök
);

1308 i‡(!
ªt
)

1309 
mvmvif
->
bt_c€x_e§_dißbÀd
 = 
åue
;

1313  
ªt
;

1314 
	}
}

1316 
boﬁ
 
	$iwl_mvm_mld_ˇn_a˘iv©e_löks
(
õì80211_hw
 *
hw
,

1317 
õì80211_vif
 *
vif
,

1318 
u16
 
desúed_löks
)

1320 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

1321 
n_löks
 = 
	`hweight16
(
desúed_löks
);

1322 
boﬁ
 
ªt
 = 
åue
;

1324 i‡(
n_löks
 <= 1)

1325  
åue
;

1327 
	`muãx_lock
(&
mvm
->
muãx
);

1330 i‡(
n_löks
 > 
	`iwl_mvm_max_a˘ive_löks
(
mvm
, 
vif
)) {

1331 
ªt
 = 
Ál£
;

1332 
u∆ock
;

1336 i‡(
	`iwl_mvm_is_e§_suµ‹ãd
(
mvm
->
fwπ
.
å™s
))

1337 
ªt
 = 
	`iwl_mvm_ˇn_íãr_e§
(
mvm
, 
vif
, 
desúed_löks
);

1338 
u∆ock
:

1339 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1340  
ªt
;

1341 
	}
}

1343 
õì80211_√g_âlm_ªs


1344 
	$iwl_mvm_mld_ˇn_√g_âlm
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

1345 
õì80211_√g_âlm
 *
√g_âlm
)

1347 
u16
 
m≠
;

1348 
u8
 
i
;

1351 
m≠
 = 
√g_âlm
->
dow∆ök
[0];

1352 
i
 = 0; i < 
IEEE80211_TTLM_NUM_TIDS
; i++) {

1353 i‡(
√g_âlm
->
dow∆ök
[
i
] !√g_âlm->
u∂ök
[i] ||

1354 
√g_âlm
->
u∂ök
[
i
] !
m≠
)

1355  
NEG_TTLM_RES_REJECT
;

1358  
NEG_TTLM_RES_ACCEPT
;

1359 
	}
}

1361 c⁄° 
õì80211_›s
 
	giwl_mvm_mld_hw_›s
 = {

1362 .
tx
 = 
iwl_mvm_mac_tx
,

1363 .
	gwake_tx_queue
 = 
iwl_mvm_mac_wake_tx_queue
,

1364 .
	gampdu_a˘i⁄
 = 
iwl_mvm_mac_ampdu_a˘i⁄
,

1365 .
	ggë_™ã¬a
 = 
iwl_mvm_›_gë_™ã¬a
,

1366 .
	g£t_™ã¬a
 = 
iwl_mvm_›_£t_™ã¬a
,

1367 .
	g°¨t
 = 
iwl_mvm_mac_°¨t
,

1368 .
	gªc⁄fig_com∂ëe
 = 
iwl_mvm_mac_ªc⁄fig_com∂ëe
,

1369 .
	g°›
 = 
iwl_mvm_mac_°›
,

1370 .
	gadd_öãrÁ˚
 = 
iwl_mvm_mld_mac_add_öãrÁ˚
,

1371 .
	gªmove_öãrÁ˚
 = 
iwl_mvm_mld_mac_ªmove_öãrÁ˚
,

1372 .
	gc⁄fig
 = 
iwl_mvm_mac_c⁄fig
,

1373 .
	g¥ï¨e_mu…iˇ°
 = 
iwl_mvm_¥ï¨e_mu…iˇ°
,

1374 .
	gc⁄figuª_fûãr
 = 
iwl_mvm_c⁄figuª_fûãr
,

1375 .
	gc⁄fig_iÁ˚_fûãr
 = 
iwl_mvm_mld_c⁄fig_iÁ˚_fûãr
,

1376 .
	glök_öfo_ch™ged
 = 
iwl_mvm_mld_lök_öfo_ch™ged
,

1377 .
	gvif_cfg_ch™ged
 = 
iwl_mvm_mld_vif_cfg_ch™ged
,

1378 .
	ghw_sˇn
 = 
iwl_mvm_mac_hw_sˇn
,

1379 .
	gˇn˚l_hw_sˇn
 = 
iwl_mvm_mac_ˇn˚l_hw_sˇn
,

1380 .
	g°a_¥e_rcu_ªmove
 = 
iwl_mvm_°a_¥e_rcu_ªmove
,

1381 .
	g°a_°©e
 = 
iwl_mvm_mld_mac_°a_°©e
,

1382 .
	g°a_nŸify
 = 
iwl_mvm_mac_°a_nŸify
,

1383 .
	gÆlow_buf„ªd_‰ames
 = 
iwl_mvm_mac_Ælow_buf„ªd_‰ames
,

1384 .
	gªÀa£_buf„ªd_‰ames
 = 
iwl_mvm_mac_ªÀa£_buf„ªd_‰ames
,

1385 .
	g£t_πs_thªshﬁd
 = 
iwl_mvm_mac_£t_πs_thªshﬁd
,

1386 .
	g°a_rc_upd©e
 = 
iwl_mvm_°a_rc_upd©e
,

1387 .
	gc⁄f_tx
 = 
iwl_mvm_mld_mac_c⁄f_tx
,

1388 .
	gmgd_¥ï¨e_tx
 = 
iwl_mvm_mac_mgd_¥ï¨e_tx
,

1389 .
	gmgd_com∂ëe_tx
 = 
iwl_mvm_mac_mgd_com∂ëe_tx
,

1390 .
	gmgd_¥Ÿe˘_tdls_discovî
 = 
iwl_mvm_mac_mgd_¥Ÿe˘_tdls_discovî
,

1391 .
	gÊush
 = 
iwl_mvm_mac_Êush
,

1392 .
	gÊush_°a
 = 
iwl_mvm_mac_Êush_°a
,

1393 .
	gsched_sˇn_°¨t
 = 
iwl_mvm_mac_sched_sˇn_°¨t
,

1394 .
	gsched_sˇn_°›
 = 
iwl_mvm_mac_sched_sˇn_°›
,

1395 .
	g£t_key
 = 
iwl_mvm_mac_£t_key
,

1396 .
	gupd©e_tkù_key
 = 
iwl_mvm_mac_upd©e_tkù_key
,

1397 .
	gªmaö_⁄_ch™√l
 = 
iwl_mvm_mld_roc
,

1398 .
	gˇn˚l_ªmaö_⁄_ch™√l
 = 
iwl_mvm_ˇn˚l_roc
,

1399 .
	gadd_ch™˘x
 = 
iwl_mvm_add_ch™˘x
,

1400 .
	gªmove_ch™˘x
 = 
iwl_mvm_ªmove_ch™˘x
,

1401 .
	gch™ge_ch™˘x
 = 
iwl_mvm_ch™ge_ch™˘x
,

1402 .
	gassign_vif_ch™˘x
 = 
iwl_mvm_mld_assign_vif_ch™˘x
,

1403 .
	gu«ssign_vif_ch™˘x
 = 
iwl_mvm_mld_u«ssign_vif_ch™˘x
,

1404 .
	gswôch_vif_ch™˘x
 = 
iwl_mvm_mld_swôch_vif_ch™˘x
,

1406 .
	g°¨t_≠
 = 
iwl_mvm_mld_°¨t_≠
,

1407 .
	g°›_≠
 = 
iwl_mvm_mld_°›_≠
,

1408 .
	gjoö_ibss
 = 
iwl_mvm_mld_°¨t_ibss
,

1409 .
	gÀave_ibss
 = 
iwl_mvm_mld_°›_ibss
,

1411 .
	gtx_œ°_bóc⁄
 = 
iwl_mvm_tx_œ°_bóc⁄
,

1413 .
	gch™√l_swôch
 = 
iwl_mvm_ch™√l_swôch
,

1414 .
	g¥e_ch™√l_swôch
 = 
iwl_mvm_¥e_ch™√l_swôch
,

1415 .
	gpo°_ch™√l_swôch
 = 
iwl_mvm_po°_ch™√l_swôch
,

1416 .
	gab‹t_ch™√l_swôch
 = 
iwl_mvm_ab‹t_ch™√l_swôch
,

1417 .
	gch™√l_swôch_rx_bóc⁄
 = 
iwl_mvm_ch™√l_swôch_rx_bóc⁄
,

1419 .
	gtdls_ch™√l_swôch
 = 
iwl_mvm_tdls_ch™√l_swôch
,

1420 .
	gtdls_ˇn˚l_ch™√l_swôch
 = 
iwl_mvm_tdls_ˇn˚l_ch™√l_swôch
,

1421 .
	gtdls_ªcv_ch™√l_swôch
 = 
iwl_mvm_tdls_ªcv_ch™√l_swôch
,

1423 .
	gevít_ˇŒback
 = 
iwl_mvm_mac_evít_ˇŒback
,

1425 .
	gsync_rx_queues
 = 
iwl_mvm_sync_rx_queues
,

1427 
CFG80211_TESTMODE_CMD
(
iwl_mvm_mac_ã°mode_cmd
)

1429 #ifde‡
CONFIG_PM_SLEEP


1431 .
	gsu•íd
 = 
iwl_mvm_su•íd
,

1432 .
	gªsume
 = 
iwl_mvm_ªsume
,

1433 .
	g£t_wakeup
 = 
iwl_mvm_£t_wakeup
,

1434 .
	g£t_ªkey_d©a
 = 
iwl_mvm_£t_ªkey_d©a
,

1435 #i‡
IS_ENABLED
(
CONFIG_IPV6
)

1436 .
	gùv6_addr_ch™ge
 = 
iwl_mvm_ùv6_addr_ch™ge
,

1438 .
	g£t_deÁu…_uniˇ°_key
 = 
iwl_mvm_£t_deÁu…_uniˇ°_key
,

1440 .
	ggë_survey
 = 
iwl_mvm_mac_gë_survey
,

1441 .
	g°a_°©i°ics
 = 
iwl_mvm_mac_°a_°©i°ics
,

1442 .
	ggë_·m_ª•⁄dî_°©s
 = 
iwl_mvm_mac_gë_·m_ª•⁄dî_°©s
,

1443 .
	g°¨t_pm§
 = 
iwl_mvm_°¨t_pm§
,

1444 .
	gab‹t_pm§
 = 
iwl_mvm_ab‹t_pm§
,

1446 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1447 .
	gvif_add_debugfs
 = 
iwl_mvm_vif_add_debugfs
,

1448 .
	glök_add_debugfs
 = 
iwl_mvm_lök_add_debugfs
,

1449 .
	glök_°a_add_debugfs
 = 
iwl_mvm_lök_°a_add_debugfs
,

1451 .
	g£t_hw_time°amp
 = 
iwl_mvm_£t_hw_time°amp
,

1453 .
	gch™ge_vif_löks
 = 
iwl_mvm_mld_ch™ge_vif_löks
,

1454 .
	gch™ge_°a_löks
 = 
iwl_mvm_mld_ch™ge_°a_löks
,

1455 .
	gˇn_a˘iv©e_löks
 = 
iwl_mvm_mld_ˇn_a˘iv©e_löks
,

1456 .
	gˇn_√g_âlm
 = 
iwl_mvm_mld_ˇn_√g_âlm
,

	@mvm/mld-sta.c

5 
	~"mvm.h
"

6 
	~"time-sync.h
"

7 
	~"°a.h
"

9 
u32
 
	$iwl_mvm_°a_fw_id_mask
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

10 
fûãr_lök_id
)

12 
iwl_mvm_°a
 *
mvm°a
;

13 
lök_id
;

14 
u32
 
ªsu…
 = 0;

16 i‡(!
°a
)

19 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

22 i‡(!
°a
->
vÆid_löks
)

23  
	`BIT
(
mvm°a
->
deÊök
.
°a_id
);

26 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
mvm°a
->
lök
);Üink_id++) {

27 
iwl_mvm_lök_°a
 *
lök_°a
;

30 i‡(
fûãr_lök_id
 >0 && 
lök_id
 != filter_link_id)

33 
lök_°a
 =

34 
	`rcu_dîe„ªn˚_check
(
mvm°a
->
lök
[
lök_id
],

35 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

36 i‡(!
lök_°a
)

39 
ªsu…
 |
	`BIT
(
lök_°a
->
°a_id
);

42  
ªsu…
;

43 
	}
}

45 
	$iwl_mvm_mld_£nd_°a_cmd
(
iwl_mvm
 *
mvm
,

46 
iwl_mvm_°a_cfg_cmd
 *
cmd
)

48 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

49 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
STA_CONFIG_CMD
),

50 0, (*
cmd
), cmd);

51 i‡(
ªt
)

52 
	`IWL_ERR
(
mvm
, "STA_CONFIG_CMD síd faûed,Ñë=0x%x\n", 
ªt
);

53  
ªt
;

54 
	}
}

59 
	$iwl_mvm_mld_add_öt_°a_to_fw
(
iwl_mvm
 *
mvm
,

60 
iwl_mvm_öt_°a
 *
°a
,

61 c⁄° 
u8
 *
addr
, 
lök_id
)

63 
iwl_mvm_°a_cfg_cmd
 
cmd
;

65 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

67 
	`mem£t
(&
cmd
, 0, (cmd));

68 
cmd
.
°a_id
 = 
	`˝u_to_À32
((
u8
)
°a
->sta_id);

70 
cmd
.
lök_id
 = 
	`˝u_to_À32
(link_id);

72 
cmd
.
°©i⁄_ty≥
 = 
	`˝u_to_À32
(
°a
->
ty≥
);

74 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

75 
IWL_UCODE_TLV_CAPA_STA_EXP_MFP_SUPPORT
) &&

76 
°a
->
ty≥
 =
STATION_TYPE_BCAST_MGMT
)

77 
cmd
.
mÂ
 = 
	`˝u_to_À32
(1);

79 i‡(
addr
) {

80 
	`mem˝y
(
cmd
.
≥î_mld_addªss
, 
addr
, 
ETH_ALEN
);

81 
	`mem˝y
(
cmd
.
≥î_lök_addªss
, 
addr
, 
ETH_ALEN
);

84  
	`iwl_mvm_mld_£nd_°a_cmd
(
mvm
, &
cmd
);

85 
	}
}

92 
	$iwl_mvm_mld_rm_°a_‰om_fw
(
iwl_mvm
 *
mvm
, 
u32
 
°a_id
)

94 
iwl_mvm_ªmove_°a_cmd
 
rm_°a_cmd
 = {

95 .
°a_id
 = 
	`˝u_to_À32
(sta_id),

97 
ªt
;

100 i‡(!
	`rcu_ac˚ss_poöãr
(
mvm
->
fw_id_to_mac_id
[
°a_id
])) {

101 
	`IWL_ERR
(
mvm
, "InvÆid sèti⁄ id %d\n", 
°a_id
);

102  -
EINVAL
;

105 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
STA_REMOVE_CMD
),

106 0, (
rm_°a_cmd
), &rm_sta_cmd);

107 i‡(
ªt
) {

108 
	`IWL_ERR
(
mvm
, "FaûedÅÿªmovê°©i⁄. Id=%d\n", 
°a_id
);

109  
ªt
;

113 
	}
}

115 
	$iwl_mvm_add_aux_°a_to_fw
(
iwl_mvm
 *
mvm
,

116 
iwl_mvm_öt_°a
 *
°a
,

117 
u32
 
lmac_id
)

119 
ªt
;

121 
iwl_mvm_aux_°a_cmd
 
cmd
 = {

122 .
°a_id
 = 
	`˝u_to_À32
(
°a
->sta_id),

123 .
lmac_id
 = 
	`˝u_to_À32
(lmac_id),

126 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
AUX_STA_CMD
),

127 0, (
cmd
), &cmd);

128 i‡(
ªt
)

129 
	`IWL_ERR
(
mvm
, "FailedÅo send AUX_STA_CMD\n");

130  
ªt
;

131 
	}
}

136 
	$iwl_mvm_mld_add_öt_°a_wôh_queue
(
iwl_mvm
 *
mvm
,

137 
iwl_mvm_öt_°a
 *
°a
,

138 c⁄° 
u8
 *
addr
, 
lök_id
,

139 
u16
 *
queue
, 
u8
 
tid
,

140 *
_wdg_timeout
)

142 
ªt
, 
txq
;

143 
wdg_timeout
 = 
_wdg_timeout
 ? *_wdg_timeout :

144 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
wd_timeout
;

146 i‡(
	`WARN_ON_ONCE
(
°a
->
°a_id
 =
IWL_MVM_INVALID_STA
))

147  -
ENOSPC
;

149 i‡(
°a
->
ty≥
 =
STATION_TYPE_AUX
)

150 
ªt
 = 
	`iwl_mvm_add_aux_°a_to_fw
(
mvm
, 
°a
, 
lök_id
);

152 
ªt
 = 
	`iwl_mvm_mld_add_öt_°a_to_fw
(
mvm
, 
°a
, 
addr
, 
lök_id
);

153 i‡(
ªt
)

154  
ªt
;

160 
txq
 = 
	`iwl_mvm_tvqm_íabÀ_txq
(
mvm
, 
NULL
, 
°a
->
°a_id
, 
tid
,

161 
wdg_timeout
);

162 i‡(
txq
 < 0) {

163 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
, 
°a
->
°a_id
);

164  
txq
;

166 *
queue
 = 
txq
;

169 
	}
}

175 
	$iwl_mvm_mld_add_öt_°a
(
iwl_mvm
 *
mvm
,

176 
iwl_mvm_öt_°a
 *
öt_°a
, 
u16
 *
queue
,

177 
∆80211_i·y≥
 
i·y≥
,

178 
iwl_fw_°a_ty≥
 
°a_ty≥
,

179 
lök_id
, c⁄° 
u8
 *
addr
, u8 
tid
,

180 *
wdg_timeout
)

182 
ªt
;

184 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

187 
ªt
 = 
	`iwl_mvm_Æloˇã_öt_°a
(
mvm
, 
öt_°a
, 0, 
i·y≥
,

188 
°a_ty≥
);

189 i‡(
ªt
)

190  
ªt
;

192 
ªt
 = 
	`iwl_mvm_mld_add_öt_°a_wôh_queue
(
mvm
, 
öt_°a
, 
addr
, 
lök_id
,

193 
queue
, 
tid
, 
wdg_timeout
);

194 i‡(
ªt
) {

195 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, 
öt_°a
);

196  
ªt
;

200 
	}
}

206 
	$iwl_mvm_mld_add_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

207 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

209 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

210 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 =

211 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

212 
iwl_mvm_öt_°a
 *
b°a
 = &
mvm_lök
->
bˇ°_°a
;

213 c⁄° 
u8
 
_baddr
[] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

214 c⁄° 
u8
 *
baddr
 = 
_baddr
;

215 
wdg_timeout
 =

216 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
vif
, 
Ál£
, false);

217 
u16
 *
queue
;

219 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

221 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
)

222 
baddr
 = 
lök_c⁄f
->
bssid
;

224 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

225 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

226 
queue
 = &
mvm_lök
->
mgmt_queue
;

227 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

228 
queue
 = &
mvm
->
p2p_dev_queue
;

230 
	`WARN
(1, "MissingÑequired TXQ forádding bcast STA\n");

231  -
EINVAL
;

234  
	`iwl_mvm_mld_add_öt_°a
(
mvm
, 
b°a
, 
queue
,

235 
	`õì80211_vif_ty≥_p2p
(
vif
),

236 
STATION_TYPE_BCAST_MGMT
,

237 
mvm_lök
->
fw_lök_id
, 
baddr
,

238 
IWL_MAX_TID_COUNT
, &
wdg_timeout
);

239 
	}
}

245 
	$iwl_mvm_mld_add_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

246 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

248 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

249 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 =

250 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

251 
iwl_mvm_öt_°a
 *
m°a
 = &
mvm_lök
->
mˇ°_°a
;

252 c⁄° 
u8
 
_maddr
[] = {0x03, 0x00, 0x00, 0x00, 0x00, 0x00};

253 c⁄° 
u8
 *
maddr
 = 
_maddr
;

254 
timeout
 = 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
vif
, 
Ál£
, false);

256 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

258 i‡(
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 &&

259 
vif
->
ty≥
 !
NL80211_IFTYPE_ADHOC
))

260  -
EOPNOTSUPP
;

267 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
)

268 
mvm_lök
->
ˇb_queue
 = 
IWL_MVM_DQA_GCAST_QUEUE
;

270  
	`iwl_mvm_mld_add_öt_°a
(
mvm
, 
m°a
, &
mvm_lök
->
ˇb_queue
,

271 
vif
->
ty≥
, 
STATION_TYPE_MCAST
,

272 
mvm_lök
->
fw_lök_id
, 
maddr
, 0,

273 &
timeout
);

274 
	}
}

279 
	$iwl_mvm_mld_add_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

280 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

282 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

283 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 =

284 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

286 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

288  
	`iwl_mvm_mld_add_öt_°a
(
mvm
, &mvm->
¢if_°a
, &mvm->
¢if_queue
,

289 
vif
->
ty≥
, 
STATION_TYPE_BCAST_MGMT
,

290 
mvm_lök
->
fw_lök_id
, 
NULL
,

291 
IWL_MAX_TID_COUNT
, 
NULL
);

292 
	}
}

294 
	$iwl_mvm_mld_add_aux_°a
(
iwl_mvm
 *
mvm
, 
u32
 
lmac_id
)

296 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

301  
	`iwl_mvm_mld_add_öt_°a
(
mvm
, &mvm->
aux_°a
, &mvm->
aux_queue
,

302 
NL80211_IFTYPE_UNSPECIFIED
,

303 
STATION_TYPE_AUX
, 
lmac_id
, 
NULL
,

304 
IWL_MAX_TID_COUNT
, 
NULL
);

305 
	}
}

307 
	$iwl_mvm_mld_dißbÀ_txq
(
iwl_mvm
 *
mvm
, 
u32
 
°a_mask
,

308 
u16
 *
queuïå
, 
u8
 
tid
)

310 
queue
 = *
queuïå
;

311 
ªt
 = 0;

313 i‡(
tid
 =
IWL_MAX_TID_COUNT
)

314 
tid
 = 
IWL_MGMT_TID
;

316 i‡(
mvm
->
°a_ªmove_ªquúes_queue_ªmove
) {

317 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
,

318 
SCD_QUEUE_CONFIG_CMD
);

319 
iwl_scd_queue_cfg_cmd
 
ªmove_cmd
 = {

320 .
›î©i⁄
 = 
	`˝u_to_À32
(
IWL_SCD_QUEUE_REMOVE
),

321 .
u
.
ªmove
.
tid
 = 
	`˝u_to_À32
(tid),

322 .
u
.
ªmove
.
°a_mask
 = 
	`˝u_to_À32
(sta_mask),

325 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0,

326 (
ªmove_cmd
),

327 &
ªmove_cmd
);

330 
	`iwl_å™s_txq_‰ì
(
mvm
->
å™s
, 
queue
);

331 *
queuïå
 = 
IWL_MVM_INVALID_QUEUE
;

333  
ªt
;

334 
	}
}

338 
	$iwl_mvm_mld_rm_öt_°a
(
iwl_mvm
 *
mvm
,

339 
iwl_mvm_öt_°a
 *
öt_°a
,

340 
boﬁ
 
Êush
, 
u8
 
tid
, 
u16
 *
queu±r
)

342 
ªt
;

344 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

346 i‡(
	`WARN_ON_ONCE
(
öt_°a
->
°a_id
 =
IWL_MVM_INVALID_STA
))

347  -
EINVAL
;

349 i‡(
Êush
)

350 
	`iwl_mvm_Êush_°a
(
mvm
, 
öt_°a
->
°a_id
, i¡_°a->
tfd_queue_msk
);

352 
	`iwl_mvm_mld_dißbÀ_txq
(
mvm
, 
	`BIT
(
öt_°a
->
°a_id
), 
queu±r
, 
tid
);

354 
ªt
 = 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
, 
öt_°a
->
°a_id
);

355 i‡(
ªt
)

356 
	`IWL_WARN
(
mvm
, "Failed sendingÑemove station\n");

358 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, 
öt_°a
);

360  
ªt
;

361 
	}
}

363 
	$iwl_mvm_mld_rm_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

364 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

366 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

367 
iwl_mvm_vif_lök_öfo
 *
lök
 = 
mvmvif
->lök[
lök_c⁄f
->
lök_id
];

368 
u16
 *
queuïå
;

370 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

372 i‡(
	`WARN_ON
(!
lök
))

373  -
EIO
;

375 
vif
->
ty≥
) {

376 
NL80211_IFTYPE_AP
:

377 
NL80211_IFTYPE_ADHOC
:

378 
queuïå
 = &
lök
->
mgmt_queue
;

380 
NL80211_IFTYPE_P2P_DEVICE
:

381 
queuïå
 = &
mvm
->
p2p_dev_queue
;

384 
	`WARN
(1, "Can't free bcast queue on vifÅype %d\n",

385 
vif
->
ty≥
);

386  -
EINVAL
;

389  
	`iwl_mvm_mld_rm_öt_°a
(
mvm
, &
lök
->
bˇ°_°a
,

390 
åue
, 
IWL_MAX_TID_COUNT
, 
queuïå
);

391 
	}
}

396 
	$iwl_mvm_mld_rm_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

397 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

399 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

400 
iwl_mvm_vif_lök_öfo
 *
lök
 = 
mvmvif
->lök[
lök_c⁄f
->
lök_id
];

402 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

404 i‡(
	`WARN_ON
(!
lök
))

405  -
EIO
;

407  
	`iwl_mvm_mld_rm_öt_°a
(
mvm
, &
lök
->
mˇ°_°a
, 
åue
, 0,

408 &
lök
->
ˇb_queue
);

409 
	}
}

411 
	$iwl_mvm_mld_rm_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

413 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

415  
	`iwl_mvm_mld_rm_öt_°a
(
mvm
, &mvm->
¢if_°a
, 
Ál£
,

416 
IWL_MAX_TID_COUNT
, &
mvm
->
¢if_queue
);

417 
	}
}

419 
	$iwl_mvm_mld_rm_aux_°a
(
iwl_mvm
 *
mvm
)

421 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

423  
	`iwl_mvm_mld_rm_öt_°a
(
mvm
, &mvm->
aux_°a
, 
Ál£
,

424 
IWL_MAX_TID_COUNT
, &
mvm
->
aux_queue
);

425 
	}
}

428 
	$iwl_mvm_mld_cfg_°a
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

429 
õì80211_vif
 *
vif
,

430 
õì80211_lök_°a
 *
lök_°a
,

431 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

432 
iwl_mvm_lök_°a
 *
mvm_lök_°a
)

434 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

435 
iwl_mvm_vif
 *
mvm_vif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

436 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 =

437 
mvm_vif
->
lök
[
lök_c⁄f
->
lök_id
];

438 
iwl_mvm_°a_cfg_cmd
 
cmd
 = {

439 .
°a_id
 = 
	`˝u_to_À32
(
mvm_lök_°a
->sta_id),

440 .
°©i⁄_ty≥
 = 
	`˝u_to_À32
(
mvm_°a
->
°a_ty≥
),

442 
u32
 
agg_size
 = 0, 
mpdu_dís
 = 0;

445 i‡(
	`WARN_ON
(
lök_öfo
->
fw_lök_id
 =
IWL_MVM_FW_LINK_ID_INVALID
))

446  -
EINVAL
;

448 
cmd
.
lök_id
 = 
	`˝u_to_À32
(
lök_öfo
->
fw_lök_id
);

450 
	`mem˝y
(&
cmd
.
≥î_mld_addªss
, 
°a
->
addr
, 
ETH_ALEN
);

451 
	`mem˝y
(&
cmd
.
≥î_lök_addªss
, 
lök_°a
->
addr
, 
ETH_ALEN
);

453 i‡(
mvm_°a
->
°a_°©e
 >
IEEE80211_STA_ASSOC
)

454 
cmd
.
assoc_id
 = 
	`˝u_to_À32
(
°a
->
aid
);

456 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

457 
IWL_UCODE_TLV_CAPA_STA_EXP_MFP_SUPPORT
) &&

458 (
°a
->
mÂ
 || 
mvm_°a
->
°a_°©e
 < 
IEEE80211_STA_AUTHORIZED
))

459 
cmd
.
mÂ
 = 
	`˝u_to_À32
(1);

461 
lök_°a
->
rx_nss
) {

463 
cmd
.
mimo
 = 
	`˝u_to_À32
(0);

466 
cmd
.
mimo
 = 
	`˝u_to_À32
(1);

470 
°a
->
deÊök
.
smps_mode
) {

471 
IEEE80211_SMPS_AUTOMATIC
:

472 
IEEE80211_SMPS_NUM_MODES
:

473 
	`WARN_ON
(1);

475 
IEEE80211_SMPS_STATIC
:

477 
cmd
.
mimo
 = 
	`˝u_to_À32
(0);

479 
IEEE80211_SMPS_DYNAMIC
:

480 
cmd
.
mimo_¥Ÿe˘i⁄
 = 
	`˝u_to_À32
(1);

482 
IEEE80211_SMPS_OFF
:

487 
mpdu_dís
 = 
	`iwl_mvm_gë_°a_ampdu_dís
(
lök_°a
, 
lök_c⁄f
, &
agg_size
);

488 
cmd
.
tx_ampdu_•acög
 = 
	`˝u_to_À32
(
mpdu_dís
);

489 
cmd
.
tx_ampdu_max_size
 = 
	`˝u_to_À32
(
agg_size
);

491 i‡(
°a
->
wme
) {

492 
cmd
.
•_Àngth
 =

493 
	`˝u_to_À32
(
°a
->
max_•
 ? sta->max_sp * 2 : 128);

494 
cmd
.
u≠sd_acs
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_°a_u≠sd_acs
(
°a
));

497 i‡(
lök_°a
->
he_ˇp
.
has_he
) {

498 
cmd
.
åig_∫d_Æloc
 =

499 
	`˝u_to_À32
(
lök_c⁄f
->
u‹a_exi°s
 ? 1 : 0);

502 
	`iwl_mvm_£t_°a_pkt_ext
(
mvm
, 
lök_°a
, &
cmd
.
pkt_ext
);

505 
cmd
.
htc_Êags
 = 
	`iwl_mvm_gë_°a_htc_Êags
(
°a
, 
lök_°a
);

507 i‡(
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[2] &

508 
IEEE80211_HE_MAC_CAP2_ACK_EN
)

509 
cmd
.
ack_íabÀd
 = 
	`˝u_to_À32
(1);

512  
	`iwl_mvm_mld_£nd_°a_cmd
(
mvm
, &
cmd
);

513 
	}
}

515 
	$iwl_mvm_mld_‰ì_°a_lök
(
iwl_mvm
 *
mvm
,

516 
iwl_mvm_°a
 *
mvm_°a
,

517 
iwl_mvm_lök_°a
 *
mvm_°a_lök
,

518 
lök_id
,

519 
boﬁ
 
is_ö_fw
)

521 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
mvm_°a_lök
->
°a_id
],

522 
is_ö_fw
 ? 
	`ERR_PTR
(-
EINVAL
Ë: 
NULL
);

523 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_lök_°a
[
mvm_°a_lök
->
°a_id
], 
NULL
);

524 
	`RCU_INIT_POINTER
(
mvm_°a
->
lök
[
lök_id
], 
NULL
);

526 i‡(
mvm_°a_lök
 !&
mvm_°a
->
deÊök
)

527 
	`k‰ì_rcu
(
mvm_°a_lök
, 
rcu_hód
);

528 
	}
}

530 
	$iwl_mvm_mld_°a_rm_Æl_°a_löks
(
iwl_mvm
 *
mvm
,

531 
iwl_mvm_°a
 *
mvm_°a
)

533 
lök_id
;

535 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
mvm_°a
->
lök
);Üink_id++) {

536 
iwl_mvm_lök_°a
 *
lök
 =

537 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

538 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

540 i‡(!
lök
)

543 
	`iwl_mvm_mld_‰ì_°a_lök
(
mvm
, 
mvm_°a
, 
lök
, 
lök_id
, 
Ál£
);

545 
	}
}

547 
	$iwl_mvm_mld_Æloc_°a_lök
(
iwl_mvm
 *
mvm
,

548 
õì80211_vif
 *
vif
,

549 
õì80211_°a
 *
°a
,

550 
lök_id
)

552 
õì80211_lök_°a
 *
lök_°a
 =

553 
	`lök_°a_dîe„ªn˚_¥Ÿe˘ed
(
°a
, 
lök_id
);

554 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

555 
iwl_mvm_lök_°a
 *
lök
;

556 
u32
 
°a_id
 = 
	`iwl_mvm_föd_‰ì_°a_id
(
mvm
,

557 
	`õì80211_vif_ty≥_p2p
(
vif
));

559 i‡(
°a_id
 =
IWL_MVM_INVALID_STA
)

560  -
ENOSPC
;

562 i‡(
	`rcu_ac˚ss_poöãr
(
°a
->
lök
[
lök_id
]Ë=&°a->
deÊök
) {

563 
lök
 = &
mvm_°a
->
deÊök
;

565 
lök
 = 
	`kzÆloc
((*lök), 
GFP_KERNEL
);

566 i‡(!
lök
)

567  -
ENOMEM
;

570 
lök
->
°a_id
 = sta_id;

571 
	`rcu_assign_poöãr
(
mvm_°a
->
lök
[
lök_id
],Üink);

572 
	`rcu_assign_poöãr
(
mvm
->
fw_id_to_mac_id
[
lök
->
°a_id
], 
°a
);

573 
	`rcu_assign_poöãr
(
mvm
->
fw_id_to_lök_°a
[
lök
->
°a_id
],

574 
lök_°a
);

577 
	}
}

580 
	$iwl_mvm_mld_Æloc_°a_löks
(
iwl_mvm
 *
mvm
,

581 
õì80211_vif
 *
vif
,

582 
õì80211_°a
 *
°a
)

584 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

585 
lök_id
;

586 
ªt
;

588 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

590 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
°a
->
lök
);Üink_id++) {

591 i‡(!
	`rcu_ac˚ss_poöãr
(
°a
->
lök
[
lök_id
]) ||

592 
mvm_°a
->
lök
[
lök_id
])

595 
ªt
 = 
	`iwl_mvm_mld_Æloc_°a_lök
(
mvm
, 
vif
, 
°a
, 
lök_id
);

596 i‡(
ªt
)

597 
îr
;

602 
îr
:

603 
	`iwl_mvm_mld_°a_rm_Æl_°a_löks
(
mvm
, 
mvm_°a
);

604  
ªt
;

605 
	}
}

607 
	$iwl_mvm_mld_£t_≠_°a_id
(
õì80211_°a
 *
°a
,

608 
iwl_mvm_vif_lök_öfo
 *
vif_lök
,

609 
iwl_mvm_lök_°a
 *
°a_lök
)

611 i‡(!
°a
->
tdls
) {

612 
	`WARN_ON
(
vif_lök
->
≠_°a_id
 !
IWL_MVM_INVALID_STA
);

613 
vif_lök
->
≠_°a_id
 = 
°a_lök
->
°a_id
;

615 
	`WARN_ON
(
vif_lök
->
≠_°a_id
 =
IWL_MVM_INVALID_STA
);

617 
	}
}

622 
	$iwl_mvm_Æloc_°a_a·î_ª°¨t
(
iwl_mvm
 *
mvm
,

623 
õì80211_vif
 *
vif
,

624 
õì80211_°a
 *
°a
)

626 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

627 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

628 
õì80211_lök_°a
 *
lök_°a
;

629 
lök_id
;

631 
ªt
 = -
EINVAL
;

632 
°a_id
;

638 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

639 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
;

640 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

641 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

642 
iwl_mvm_lök_°a
 *
mvm_lök_°a
 =

643 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

644 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

646 i‡(!
lök_c⁄f
)

649 
mvm_lök
 = 
mvmvif
->
lök
[
lök_c⁄f
->
lök_id
];

651 i‡(!
mvm_lök
 || !
mvm_lök_°a
)

654 
°a_id
 = 
mvm_lök_°a
->sta_id;

655 
ªt
 = 
	`iwl_mvm_mld_cfg_°a
(
mvm
, 
°a
, 
vif
, 
lök_°a
,

656 
lök_c⁄f
, 
mvm_lök_°a
);

657 i‡(
ªt
)

658  
ªt
;

660 
	`rcu_assign_poöãr
(
mvm
->
fw_id_to_mac_id
[
°a_id
], 
°a
);

661 
	`rcu_assign_poöãr
(
mvm
->
fw_id_to_lök_°a
[
°a_id
], 
lök_°a
);

662 
ªt
 = 0;

665 
	`iwl_mvm_ªÆloc_queues_a·î_ª°¨t
(
mvm
, 
°a
);

667  
ªt
;

668 
	}
}

670 
	$iwl_mvm_mld_add_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

671 
õì80211_°a
 *
°a
)

673 
iwl_mvm_vif
 *
mvm_vif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

674 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

675 
lök_°a_added_to_fw
 = 0;

676 
õì80211_lök_°a
 *
lök_°a
;

677 
ªt
 = 0;

678 
lök_id
;

680 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

682 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

683 
ªt
 = 
	`iwl_mvm_mld_Æloc_°a_löks
(
mvm
, 
vif
, 
°a
);

684 i‡(
ªt
)

685  
ªt
;

687 
	`•ö_lock_öô
(&
mvm_°a
->
lock
);

689 
ªt
 = 
	`iwl_mvm_°a_öô
(
mvm
, 
vif
, 
°a
, 
IWL_MVM_INVALID_STA
,

690 
STATION_TYPE_PEER
);

692 
ªt
 = 
	`iwl_mvm_Æloc_°a_a·î_ª°¨t
(
mvm
, 
vif
, 
°a
);

695 i‡(
ªt
)

696 
îr
;

699 
ªt
 = 
	`iwl_mvm_mld_upd©e_°a
(
mvm
, 
vif
, 
°a
);

700 i‡(
ªt
)

701 
îr
;

703 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

704 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

705 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

706 
iwl_mvm_lök_°a
 *
mvm_lök_°a
 =

707 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

708 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

710 i‡(
	`WARN_ON
(!
lök_c⁄f
 || !
mvm_lök_°a
)) {

711 
ªt
 = -
EINVAL
;

712 
îr
;

715 
ªt
 = 
	`iwl_mvm_mld_cfg_°a
(
mvm
, 
°a
, 
vif
, 
lök_°a
, 
lök_c⁄f
,

716 
mvm_lök_°a
);

717 i‡(
ªt
)

718 
îr
;

720 
lök_°a_added_to_fw
 |
	`BIT
(
lök_id
);

722 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

723 
	`iwl_mvm_mld_£t_≠_°a_id
(
°a
, 
mvm_vif
->
lök
[
lök_id
],

724 
mvm_lök_°a
);

729 
îr
:

731 
	`f‹_óch_£t_bô
(
lök_id
, &
lök_°a_added_to_fw
,

732 
IEEE80211_MLD_MAX_NUM_LINKS
) {

733 
iwl_mvm_lök_°a
 *
mvm_lök_°a
 =

734 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

735 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

737 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
, 
mvm_lök_°a
->
°a_id
);

741 
	`iwl_mvm_mld_°a_rm_Æl_°a_löks
(
mvm
, 
mvm_°a
);

742  
ªt
;

743 
	}
}

745 
	$iwl_mvm_mld_upd©e_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

746 
õì80211_°a
 *
°a
)

748 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

749 
õì80211_lök_°a
 *
lök_°a
;

750 
lök_id
;

751 
ªt
 = -
EINVAL
;

753 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

755 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

756 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

757 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

758 
iwl_mvm_lök_°a
 *
mvm_lök_°a
 =

759 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

760 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

762 i‡(
	`WARN_ON
(!
lök_c⁄f
 || !
mvm_lök_°a
))

763  -
EINVAL
;

765 
ªt
 = 
	`iwl_mvm_mld_cfg_°a
(
mvm
, 
°a
, 
vif
, 
lök_°a
, 
lök_c⁄f
,

766 
mvm_lök_°a
);

768 i‡(
ªt
) {

769 
	`IWL_ERR
(
mvm
, "FaûedÅÿupd©ê°®lök %d\n", 
lök_id
);

774  
ªt
;

775 
	}
}

777 
	$iwl_mvm_mld_dißbÀ_°a_queues
(
iwl_mvm
 *
mvm
,

778 
õì80211_vif
 *
vif
,

779 
õì80211_°a
 *
°a
)

781 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

782 
u32
 
°a_mask
 = 
	`iwl_mvm_°a_fw_id_mask
(
mvm
, 
°a
, -1);

783 
i
;

785 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

787 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvm_°a
->
tid_d©a
); i++) {

788 i‡(
mvm_°a
->
tid_d©a
[
i
].
txq_id
 =
IWL_MVM_INVALID_QUEUE
)

791 
	`iwl_mvm_mld_dißbÀ_txq
(
mvm
, 
°a_mask
,

792 &
mvm_°a
->
tid_d©a
[
i
].
txq_id
, i);

793 
mvm_°a
->
tid_d©a
[
i
].
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

796 
i
 = 0; i < 
	`ARRAY_SIZE
(
°a
->
txq
); i++) {

797 
iwl_mvm_txq
 *
mvmtxq
 =

798 
	`iwl_mvm_txq_‰om_mac80211
(
°a
->
txq
[
i
]);

800 
mvmtxq
->
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

802 
	}
}

804 
	$iwl_mvm_mld_rm_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

805 
õì80211_°a
 *
°a
)

807 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

808 
õì80211_lök_°a
 *
lök_°a
;

809 
lök_id
;

810 
ªt
;

812 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

815 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

816 
iwl_mvm_lök_°a
 *
mvm_lök_°a
 =

817 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

818 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

820 i‡(
	`WARN_ON
(!
mvm_lök_°a
))

821  -
EINVAL
;

823 
ªt
 = 
	`iwl_mvm_Êush_°a_tids
(
mvm
, 
mvm_lök_°a
->
°a_id
,

825 i‡(
ªt
)

826  
ªt
;

829 
ªt
 = 
	`iwl_mvm_waô_°a_queues_em±y
(
mvm
, 
mvm_°a
);

830 i‡(
ªt
)

831  
ªt
;

833 
	`iwl_mvm_mld_dißbÀ_°a_queues
(
mvm
, 
vif
, 
°a
);

835 
	`f‹_óch_°a_a˘ive_lök
(
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

836 
iwl_mvm_lök_°a
 *
mvm_lök_°a
 =

837 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

838 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

839 
boﬁ
 
°ay_ö_fw
;

841 
°ay_ö_fw
 = 
	`iwl_mvm_°a_dñ
(
mvm
, 
vif
, 
°a
, 
lök_°a
, &
ªt
);

842 i‡(
ªt
)

845 i‡(!
°ay_ö_fw
)

846 
ªt
 = 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
,

847 
mvm_lök_°a
->
°a_id
);

849 
	`iwl_mvm_mld_‰ì_°a_lök
(
mvm
, 
mvm_°a
, 
mvm_lök_°a
,

850 
lök_id
, 
°ay_ö_fw
);

853  
ªt
;

854 
	}
}

856 
	$iwl_mvm_mld_rm_°a_id
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
)

858 
ªt
;

860 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

862 i‡(
	`WARN_ON
(
°a_id
 =
IWL_MVM_INVALID_STA
))

865 
ªt
 = 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
, 
°a_id
);

867 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
°a_id
], 
NULL
);

868 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_lök_°a
[
°a_id
], 
NULL
);

869  
ªt
;

870 
	}
}

872 
	$iwl_mvm_mld_°a_modify_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

873 
iwl_mvm_°a
 *
mvm°a
,

874 
boﬁ
 
dißbÀ
)

876 
iwl_mvm_°a_dißbÀ_tx_cmd
 
cmd
;

877 
ªt
;

879 
cmd
.
°a_id
 = 
	`˝u_to_À32
(
mvm°a
->
deÊök
.sta_id);

880 
cmd
.
dißbÀ
 = 
	`˝u_to_À32
(disable);

882 i‡(
	`WARN_ON
(
	`iwl_mvm_has_no_ho°_dißbÀ_tx
(
mvm
)))

885 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

886 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
STA_DISABLE_TX_CMD
),

887 
CMD_ASYNC
, (
cmd
), &cmd);

888 i‡(
ªt
)

889 
	`IWL_ERR
(
mvm
,

891 
ªt
);

892 
	}
}

894 
	$iwl_mvm_mld_°a_modify_dißbÀ_tx_≠
(
iwl_mvm
 *
mvm
,

895 
õì80211_°a
 *
°a
,

896 
boﬁ
 
dißbÀ
)

898 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

900 
	`•ö_lock_bh
(&
mvm_°a
->
lock
);

902 i‡(
mvm_°a
->
dißbÀ_tx
 =
dißbÀ
) {

903 
	`•ö_u∆ock_bh
(&
mvm_°a
->
lock
);

907 
	`iwl_mvm_mld_°a_modify_dißbÀ_tx
(
mvm
, 
mvm_°a
, 
dißbÀ
);

909 
	`•ö_u∆ock_bh
(&
mvm_°a
->
lock
);

910 
	}
}

912 
	$iwl_mvm_mld_modify_Æl_°a_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

913 
iwl_mvm_vif
 *
mvmvif
,

914 
boﬁ
 
dißbÀ
)

916 
õì80211_°a
 *
°a
;

917 
iwl_mvm_°a
 *
mvm_°a
;

918 
i
;

920 
	`rcu_ªad_lock
();

923 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

924 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
i
]);

925 i‡(
	`IS_ERR_OR_NULL
(
°a
))

928 
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

929 i‡(
mvm_°a
->
mac_id_n_cﬁ‹
 !=

930 
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
))

933 
	`iwl_mvm_mld_°a_modify_dißbÀ_tx
(
mvm
, 
mvm_°a
, 
dißbÀ
);

936 
	`rcu_ªad_u∆ock
();

937 
	}
}

939 
	$iwl_mvm_mld_upd©e_°a_queues
(
iwl_mvm
 *
mvm
,

940 
õì80211_°a
 *
°a
,

941 
u32
 
ﬁd_°a_mask
,

942 
u32
 
√w_°a_mask
)

944 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

945 
iwl_scd_queue_cfg_cmd
 
cmd
 = {

946 .
›î©i⁄
 = 
	`˝u_to_À32
(
IWL_SCD_QUEUE_MODIFY
),

947 .
u
.
modify
.
ﬁd_°a_mask
 = 
	`˝u_to_À32
(old_sta_mask),

948 .
u
.
modify
.
√w_°a_mask
 = 
	`˝u_to_À32
(new_sta_mask),

950 
iwl_ho°_cmd
 
hcmd
 = {

951 .
id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SCD_QUEUE_CONFIG_CMD
),

952 .
Àn
[0] = (
cmd
),

953 .
d©a
[0] = &
cmd


955 
tid
;

956 
ªt
;

958 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

960 
tid
 = 0;Åid <
IWL_MAX_TID_COUNT
;Åid++) {

961 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm_°a
->tid_d©a[
tid
];

962 
txq_id
 = 
tid_d©a
->txq_id;

964 i‡(
txq_id
 =
IWL_MVM_INVALID_QUEUE
)

967 i‡(
tid
 =
IWL_MAX_TID_COUNT
)

968 
cmd
.
u
.
modify
.
tid
 = 
	`˝u_to_À32
(
IWL_MGMT_TID
);

970 
cmd
.
u
.
modify
.
tid
 = 
	`˝u_to_À32
(tid);

972 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

973 i‡(
ªt
)

974  
ªt
;

978 
	}
}

980 
	$iwl_mvm_mld_upd©e_°a_baids
(
iwl_mvm
 *
mvm
,

981 
u32
 
ﬁd_°a_mask
,

982 
u32
 
√w_°a_mask
)

984 
iwl_rx_baid_cfg_cmd
 
cmd
 = {

985 .
a˘i⁄
 = 
	`˝u_to_À32
(
IWL_RX_BAID_ACTION_MODIFY
),

986 .
modify
.
ﬁd_°a_id_mask
 = 
	`˝u_to_À32
(
ﬁd_°a_mask
),

987 .
modify
.
√w_°a_id_mask
 = 
	`˝u_to_À32
(
√w_°a_mask
),

989 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
RX_BAID_ALLOCATION_CONFIG_CMD
);

990 
baid
;

992 
	`BUILD_BUG_ON
((
iwl_rx_baid_cfg_ª•
Ë!(
baid
));

994 
baid
 = 0; baid < 
	`ARRAY_SIZE
(
mvm
->
baid_m≠
); baid++) {

995 
iwl_mvm_baid_d©a
 *
d©a
;

996 
ªt
;

998 
d©a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
baid_m≠
[
baid
],

999 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1000 i‡(!
d©a
)

1003 i‡(!(
d©a
->
°a_mask
 & 
ﬁd_°a_mask
))

1006 
	`WARN_ONCE
(
d©a
->
°a_mask
 !
ﬁd_°a_mask
,

1008 
baid
, 
ﬁd_°a_mask
, 
d©a
->
°a_mask
);

1010 
cmd
.
modify
.
tid
 = 
	`˝u_to_À32
(
d©a
->tid);

1012 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0, (
cmd
), &cmd);

1013 
d©a
->
°a_mask
 = 
√w_°a_mask
;

1014 i‡(
ªt
)

1015  
ªt
;

1019 
	}
}

1021 
	$iwl_mvm_mld_upd©e_°a_ªsour˚s
(
iwl_mvm
 *
mvm
,

1022 
õì80211_vif
 *
vif
,

1023 
õì80211_°a
 *
°a
,

1024 
u32
 
ﬁd_°a_mask
,

1025 
u32
 
√w_°a_mask
)

1027 
ªt
;

1029 
ªt
 = 
	`iwl_mvm_mld_upd©e_°a_queues
(
mvm
, 
°a
,

1030 
ﬁd_°a_mask
,

1031 
√w_°a_mask
);

1032 i‡(
ªt
)

1033  
ªt
;

1035 
ªt
 = 
	`iwl_mvm_mld_upd©e_°a_keys
(
mvm
, 
vif
, 
°a
,

1036 
ﬁd_°a_mask
,

1037 
√w_°a_mask
);

1038 i‡(
ªt
)

1039  
ªt
;

1041  
	`iwl_mvm_mld_upd©e_°a_baids
(
mvm
, 
ﬁd_°a_mask
, 
√w_°a_mask
);

1042 
	}
}

1044 
	$iwl_mvm_mld_upd©e_°a_löks
(
iwl_mvm
 *
mvm
,

1045 
õì80211_vif
 *
vif
,

1046 
õì80211_°a
 *
°a
,

1047 
u16
 
ﬁd_löks
, u16 
√w_löks
)

1049 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1050 
iwl_mvm_vif
 *
mvm_vif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1051 
iwl_mvm_lök_°a
 *
mvm_°a_lök
;

1052 
iwl_mvm_vif_lök_öfo
 *
mvm_vif_lök
;

1053 
löks_to_add
 = ~
ﬁd_löks
 & 
√w_löks
;

1054 
löks_to_ªm
 = 
ﬁd_löks
 & ~
√w_löks
;

1055 
ﬁd_löks_l⁄g
 = 
ﬁd_löks
;

1056 
u32
 
cuºít_°a_mask
 = 0, 
°a_mask_added
 = 0, 
°a_mask_to_ªm
 = 0;

1057 
lök_°a_added_to_fw
 = 0, 
lök_°a_Æloˇãd
 = 0;

1058 
lök_id
;

1059 
ªt
;

1061 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1063 
	`f‹_óch_£t_bô
(
lök_id
, &
ﬁd_löks_l⁄g
,

1064 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1065 
mvm_°a_lök
 =

1066 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

1067 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1069 i‡(
	`WARN_ON
(!
mvm_°a_lök
)) {

1070 
ªt
 = -
EINVAL
;

1071 
îr
;

1074 
cuºít_°a_mask
 |
	`BIT
(
mvm_°a_lök
->
°a_id
);

1075 i‡(
löks_to_ªm
 & 
	`BIT
(
lök_id
))

1076 
°a_mask_to_ªm
 |
	`BIT
(
mvm_°a_lök
->
°a_id
);

1079 i‡(
°a_mask_to_ªm
) {

1080 
ªt
 = 
	`iwl_mvm_mld_upd©e_°a_ªsour˚s
(
mvm
, 
vif
, 
°a
,

1081 
cuºít_°a_mask
,

1082 
cuºít_°a_mask
 &

1083 ~
°a_mask_to_ªm
);

1084 i‡(
	`WARN_ON
(
ªt
))

1085 
îr
;

1087 
cuºít_°a_mask
 &~
°a_mask_to_ªm
;

1090 
	`f‹_óch_£t_bô
(
lök_id
, &
löks_to_ªm
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1091 
mvm_°a_lök
 =

1092 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

1093 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1094 
mvm_vif_lök
 = 
mvm_vif
->
lök
[
lök_id
];

1096 i‡(
	`WARN_ON
(!
mvm_°a_lök
 || !
mvm_vif_lök
)) {

1097 
ªt
 = -
EINVAL
;

1098 
îr
;

1101 
ªt
 = 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
, 
mvm_°a_lök
->
°a_id
);

1102 i‡(
	`WARN_ON
(
ªt
))

1103 
îr
;

1105 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

1106 
mvm_vif_lök
->
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

1108 
	`iwl_mvm_mld_‰ì_°a_lök
(
mvm
, 
mvm_°a
, 
mvm_°a_lök
, 
lök_id
,

1109 
Ál£
);

1112 
	`f‹_óch_£t_bô
(
lök_id
, &
löks_to_add
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1113 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

1114 
	`lök_c⁄f_dîe„ªn˚_¥Ÿe˘ed
(
vif
, 
lök_id
);

1115 
õì80211_lök_°a
 *
lök_°a
 =

1116 
	`lök_°a_dîe„ªn˚_¥Ÿe˘ed
(
°a
, 
lök_id
);

1117 
mvm_vif_lök
 = 
mvm_vif
->
lök
[
lök_id
];

1119 i‡(
	`WARN_ON
(!
mvm_vif_lök
 || !
lök_c⁄f
 || !
lök_°a
)) {

1120 
ªt
 = -
EINVAL
;

1121 
îr
;

1124 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

1125 i‡(
	`WARN_ON
(!
mvm_°a
->
lök
[
lök_id
])) {

1126 
ªt
 = -
EINVAL
;

1127 
îr
;

1130 i‡(
	`WARN_ON
(
mvm_°a
->
lök
[
lök_id
])) {

1131 
ªt
 = -
EINVAL
;

1132 
îr
;

1134 
ªt
 = 
	`iwl_mvm_mld_Æloc_°a_lök
(
mvm
, 
vif
, 
°a
,

1135 
lök_id
);

1136 i‡(
	`WARN_ON
(
ªt
))

1137 
îr
;

1140 
lök_°a
->
agg
.
max_rc_amsdu_Àn
 = 1;

1141 
	`õì80211_°a_ªˇlc_aggªg©es
(
°a
);

1143 
mvm_°a_lök
 =

1144 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

1145 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1147 i‡(
	`WARN_ON
(!
mvm_°a_lök
)) {

1148 
ªt
 = -
EINVAL
;

1149 
îr
;

1152 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
)

1153 
	`iwl_mvm_mld_£t_≠_°a_id
(
°a
, 
mvm_vif_lök
,

1154 
mvm_°a_lök
);

1156 
lök_°a_Æloˇãd
 |
	`BIT
(
lök_id
);

1158 
°a_mask_added
 |
	`BIT
(
mvm_°a_lök
->
°a_id
);

1160 
ªt
 = 
	`iwl_mvm_mld_cfg_°a
(
mvm
, 
°a
, 
vif
, 
lök_°a
, 
lök_c⁄f
,

1161 
mvm_°a_lök
);

1162 i‡(
	`WARN_ON
(
ªt
))

1163 
îr
;

1165 
lök_°a_added_to_fw
 |
	`BIT
(
lök_id
);

1167 
	`iwl_mvm_rs_add_°a_lök
(
mvm
, 
mvm_°a_lök
);

1170 i‡(
°a_mask_added
) {

1171 
ªt
 = 
	`iwl_mvm_mld_upd©e_°a_ªsour˚s
(
mvm
, 
vif
, 
°a
,

1172 
cuºít_°a_mask
,

1173 
cuºít_°a_mask
 |

1174 
°a_mask_added
);

1175 i‡(
	`WARN_ON
(
ªt
))

1176 
îr
;

1181 
îr
:

1183 
	`f‹_óch_£t_bô
(
lök_id
, &
lök_°a_added_to_fw
,

1184 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1185 
mvm_°a_lök
 =

1186 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

1187 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1189 
	`iwl_mvm_mld_rm_°a_‰om_fw
(
mvm
, 
mvm_°a_lök
->
°a_id
);

1193 
	`f‹_óch_£t_bô
(
lök_id
, &
lök_°a_Æloˇãd
,

1194 
IEEE80211_MLD_MAX_NUM_LINKS
) {

1195 
mvm_°a_lök
 =

1196 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_id
],

1197 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1199 
	`iwl_mvm_mld_‰ì_°a_lök
(
mvm
, 
mvm_°a
, 
mvm_°a_lök
, 
lök_id
,

1200 
Ál£
);

1203  
ªt
;

1204 
	}
}

	@mvm/mvm.h

7 #i‚de‡
__IWL_MVM_H__


8 
	#__IWL_MVM_H__


	)

10 
	~<löux/li°.h
>

11 
	~<löux/•ölock.h
>

12 
	~<löux/Àds.h
>

13 
	~<löux/ö6.h
>

15 #ifde‡
CONFIG_THERMAL


16 
	~<löux/thîmÆ.h
>

19 
	~<löux/±p_˛ock_kî√l.h
>

21 
	~<löux/ktime.h
>

23 
	~"iwl-›-mode.h
"

24 
	~"iwl-å™s.h
"

25 
	~"fw/nŸif-waô.h
"

26 
	~"iwl-ì¥om-∑r£.h
"

27 
	~"fw/fûe.h
"

28 
	~"iwl-c⁄fig.h
"

29 
	~"°a.h
"

30 
	~"fw-≠i.h
"

31 
	~"c⁄°™ts.h
"

32 
	~"fw/ru¡ime.h
"

33 
	~"fw/dbg.h
"

34 
	~"fw/a˝i.h
"

35 
	~"mei/iwl-mei.h
"

36 
	~"iwl-nvm-∑r£.h
"

38 
	~<löux/avîage.h
>

40 
	#IWL_MVM_MAX_ADDRESSES
 5

	)

42 
	#IWL_RSSI_OFFSET
 50

	)

43 
	#IWL_MVM_MISSED_BEACONS_SINCE_RX_THOLD
 4

	)

44 
	#IWL_MVM_MISSED_BEACONS_THRESHOLD
 8

	)

45 
	#IWL_MVM_MISSED_BEACONS_THRESHOLD_LONG
 19

	)

48 
	#MSEC_TO_TU
(
_m£c
Ë(_m£c*1000/1024)

	)

54 
	#IWL_MVM_CHANNEL_SWITCH_TIME_GO
 40

	)

60 
	#IWL_MVM_CHANNEL_SWITCH_TIME_CLIENT
 10

	)

66 
	#IWL_MVM_CHANNEL_SWITCH_MARGIN
 4

	)

72 
	#IWL_MVM_CS_UNBLOCK_TX_TIMEOUT
 3

	)

75 
	#IWL_MVM_OFFCHANNEL_QUEUE
 0

	)

78 
	#IWL_MVM_FW_LINK_ID_INVALID
 0xff

	)

80 c⁄° 
õì80211_›s
 
iwl_mvm_hw_›s
;

81 c⁄° 
õì80211_›s
 
iwl_mvm_mld_hw_›s
;

91 
	siwl_mvm_mod_∑øms
 {

92 
boﬁ
 
	möô_dbg
;

93 
	mpowî_scheme
;

95 
iwl_mvm_mod_∑øms
 
iwlmvm_mod_∑øms
;

97 
	siwl_mvm_phy_˘xt
 {

98 
u16
 
	mid
;

99 
u16
 
	mcﬁ‹
;

100 
u32
 
	mªf
;

102 
∆80211_ch™_width
 
	mwidth
;

104 
õì80211_ch™√l
 *
	mch™√l
;

107 
u32
 
	m˚¡î_‰eq1
;

108 
boﬁ
 
	mæc_dißbÀd
;

109 
u32
 
	mch™√l_lﬂd_by_us
;

112 
	siwl_mvm_time_evít_d©a
 {

113 
õì80211_vif
 *
	mvif
;

114 
li°_hód
 
	mli°
;

115 
	míd_jiffõs
;

116 
u32
 
	mduøti⁄
;

117 
boﬁ
 
	mru¬ög
;

118 
u32
 
	muid
;

125 
u32
 
	mid
;

126 
s8
 
	mlök_id
;

137 
	eiwl_powî_scheme
 {

138 
	mIWL_POWER_SCHEME_CAM
 = 1,

139 
	mIWL_POWER_SCHEME_BPS
,

140 
	mIWL_POWER_SCHEME_LP


143 
	#IWL_UAPSD_MAX_SP
 
IEEE80211_WMM_IE_STA_QOSINFO_SP_ALL


	)

145 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


146 
	eiwl_dbgfs_pm_mask
 {

147 
	mMVM_DEBUGFS_PM_KEEP_ALIVE
 = 
BIT
(0),

148 
	mMVM_DEBUGFS_PM_SKIP_OVER_DTIM
 = 
BIT
(1),

149 
	mMVM_DEBUGFS_PM_SKIP_DTIM_PERIODS
 = 
BIT
(2),

150 
	mMVM_DEBUGFS_PM_RX_DATA_TIMEOUT
 = 
BIT
(3),

151 
	mMVM_DEBUGFS_PM_TX_DATA_TIMEOUT
 = 
BIT
(4),

152 
	mMVM_DEBUGFS_PM_LPRX_ENA
 = 
BIT
(6),

153 
	mMVM_DEBUGFS_PM_LPRX_RSSI_THRESHOLD
 = 
BIT
(7),

154 
	mMVM_DEBUGFS_PM_SNOOZE_ENABLE
 = 
BIT
(8),

155 
	mMVM_DEBUGFS_PM_UAPSD_MISBEHAVING
 = 
BIT
(9),

156 
	mMVM_DEBUGFS_PM_USE_PS_POLL
 = 
BIT
(10),

159 
	siwl_dbgfs_pm
 {

160 
u16
 
	mkìp_Æive_£c⁄ds
;

161 
u32
 
	mrx_d©a_timeout
;

162 
u32
 
	mtx_d©a_timeout
;

163 
boﬁ
 
	mskù_ovî_dtim
;

164 
u8
 
	mskù_dtim_≥riods
;

165 
boﬁ
 
	mÕrx_ía
;

166 
u32
 
	mÕrx_rssi_thªshﬁd
;

167 
boﬁ
 
	m¢ooze_ía
;

168 
boﬁ
 
	mu≠sd_misbehavög
;

169 
boﬁ
 
	mu£_ps_pﬁl
;

170 
	mmask
;

175 
	eiwl_dbgfs_bf_mask
 {

176 
	mMVM_DEBUGFS_BF_ENERGY_DELTA
 = 
BIT
(0),

177 
	mMVM_DEBUGFS_BF_ROAMING_ENERGY_DELTA
 = 
BIT
(1),

178 
	mMVM_DEBUGFS_BF_ROAMING_STATE
 = 
BIT
(2),

179 
	mMVM_DEBUGFS_BF_TEMP_THRESHOLD
 = 
BIT
(3),

180 
	mMVM_DEBUGFS_BF_TEMP_FAST_FILTER
 = 
BIT
(4),

181 
	mMVM_DEBUGFS_BF_TEMP_SLOW_FILTER
 = 
BIT
(5),

182 
	mMVM_DEBUGFS_BF_ENABLE_BEACON_FILTER
 = 
BIT
(6),

183 
	mMVM_DEBUGFS_BF_DEBUG_FLAG
 = 
BIT
(7),

184 
	mMVM_DEBUGFS_BF_ESCAPE_TIMER
 = 
BIT
(8),

185 
	mMVM_DEBUGFS_BA_ESCAPE_TIMER
 = 
BIT
(9),

186 
	mMVM_DEBUGFS_BA_ENABLE_BEACON_ABORT
 = 
BIT
(10),

189 
	siwl_dbgfs_bf
 {

190 
u32
 
	mbf_íîgy_dñè
;

191 
u32
 
	mbf_rﬂmög_íîgy_dñè
;

192 
u32
 
	mbf_rﬂmög_°©e
;

193 
u32
 
	mbf_ãmp_thªshﬁd
;

194 
u32
 
	mbf_ãmp_Á°_fûãr
;

195 
u32
 
	mbf_ãmp_¶ow_fûãr
;

196 
u32
 
	mbf_íabÀ_bóc⁄_fûãr
;

197 
u32
 
	mbf_debug_Êag
;

198 
u32
 
	mbf_esˇ≥_timî
;

199 
u32
 
	mba_esˇ≥_timî
;

200 
u32
 
	mba_íabÀ_bóc⁄_ab‹t
;

201 
	mmask
;

205 
	eiwl_mvm_smps_ty≥_ªque°
 {

206 
	mIWL_MVM_SMPS_REQ_BT_COEX
,

207 
	mIWL_MVM_SMPS_REQ_TT
,

208 
	mIWL_MVM_SMPS_REQ_PROT
,

209 
	mIWL_MVM_SMPS_REQ_FW
,

210 
	mNUM_IWL_MVM_SMPS_REQ
,

213 
	eiwl_bt_f‹˚_™t_mode
 {

214 
	mBT_FORCE_ANT_DIS
 = 0,

215 
	mBT_FORCE_ANT_AUTO
,

216 
	mBT_FORCE_ANT_BT
,

217 
	mBT_FORCE_ANT_WIFI
,

219 
	mBT_FORCE_ANT_MAX
,

229 
	eiwl_mvm_low_œãncy_f‹˚
 {

230 
	mLOW_LATENCY_FORCE_UNSET
,

231 
	mLOW_LATENCY_FORCE_ON
,

232 
	mLOW_LATENCY_FORCE_OFF
,

233 
	mNUM_LOW_LATENCY_FORCE


248 
	eiwl_mvm_low_œãncy_ˇu£
 {

249 
	mLOW_LATENCY_TRAFFIC
 = 
BIT
(0),

250 
	mLOW_LATENCY_DEBUGFS
 = 
BIT
(1),

251 
	mLOW_LATENCY_VCMD
 = 
BIT
(2),

252 
	mLOW_LATENCY_VIF_TYPE
 = 
BIT
(3),

253 
	mLOW_LATENCY_DEBUGFS_FORCE_ENABLE
 = 
BIT
(4),

254 
	mLOW_LATENCY_DEBUGFS_FORCE
 = 
BIT
(5),

267 
	siwl_mvm_vif_bf_d©a
 {

268 
boﬁ
 
	mbf_íabÀd
;

269 
boﬁ
 
	mba_íabÀd
;

270 
	mave_bóc⁄_sig«l
;

271 
	mœ°_cqm_evít
;

272 
	mbt_c€x_mö_thﬁd
;

273 
	mbt_c€x_max_thﬁd
;

274 
	mœ°_bt_c€x_evít
;

283 
	siwl_¥obe_ª•_d©a
 {

284 
rcu_hód
 
	mrcu_hód
;

285 
iwl_¥obe_ª•_d©a_nŸif
 
	mnŸif
;

286 
	mnﬂ_Àn
;

313 
	siwl_mvm_vif_lök_öfo
 {

314 
u8
 
	mbssid
[
ETH_ALEN
];

315 
u8
 
	m≠_°a_id
;

316 
u8
 
	mfw_lök_id
;

318 
iwl_mvm_öt_°a
 
	mbˇ°_°a
;

319 
iwl_mvm_öt_°a
 
	mmˇ°_°a
;

322 
u32
 
	mnum_bóc⁄s
, 
	maccu_num_bóc⁄s
;

323 
u8
 
	mavg_sig«l
;

324 } 
	mbóc⁄_°©s
;

326 
õì80211_smps_mode
 
	msmps_ªque°s
[
NUM_IWL_MVM_SMPS_REQ
];

327 
iwl_¥obe_ª•_d©a
 
__rcu
 *
	m¥obe_ª•_d©a
;

329 
õì80211_key_c⁄f
 *
	migtk
;

331 
boﬁ
 
	mhe_ru_2mhz_block
;

332 
boﬁ
 
	ma˘ive
;

333 
boﬁ
 
	mli°í_lmac
;

335 
u16
 
	mˇb_queue
;

339 
iwl_mvm_phy_˘xt
 *
	mphy_˘xt
;

344 
õì80211_tx_queue_∑øms
 
	mqueue_∑øms
[
IEEE80211_NUM_ACS
];

346 
u16
 
	mmgmt_queue
;

383 
	siwl_mvm_vif
 {

384 
iwl_mvm
 *
	mmvm
;

385 
u16
 
	mid
;

386 
u16
 
	mcﬁ‹
;

388 
boﬁ
 
	massocüãd
;

389 
u8
 
	m≠_assoc_°a_cou¡
;

390 
boﬁ
 
	mu∂ﬂded
;

391 
boﬁ
 
	m≠_ibss_a˘ive
;

392 
boﬁ
 
	mpm_íabÀd
;

393 
boﬁ
 
	mm⁄ô‹_a˘ive
;

394 
boﬁ
 
	me§_a˘ive
;

395 
boﬁ
 
	mbt_c€x_e§_dißbÀd
;

397 
u8
 
	mlow_œãncy
: 6;

398 
u8
 
	mlow_œãncy_a˘uÆ
: 1;

400 
u8
 
	mauth‹ized
:1;

401 
boﬁ
 
	mps_dißbÀd
;

403 
u32
 
	m≠_bóc⁄_time
;

404 
iwl_mvm_vif_bf_d©a
 
	mbf_d©a
;

406 #ifde‡
CONFIG_PM


409 
u8
 
	mkck
[
NL80211_KCK_EXT_LEN
];

410 
u8
 
	mkek
[
NL80211_KEK_EXT_LEN
];

411 
size_t
 
	mkek_Àn
;

412 
size_t
 
	mkck_Àn
;

413 
u32
 
	makm
;

414 
__À64
 
	mª∂ay_˘r
;

415 
boﬁ
 
	mvÆid
;

416 } 
	mªkey_d©a
;

418 
	mtx_key_idx
;

420 
boﬁ
 
	m£qno_vÆid
;

421 
u16
 
	m£qno
;

424 #i‡
IS_ENABLED
(
CONFIG_IPV6
)

426 
ö6_addr
 
	mèrgë_ùv6_addrs
[
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_MAX
];

427 
	mã¡©ive_addrs
[
BITS_TO_LONGS
(
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_MAX
)];

428 
	mnum_èrgë_ùv6_addrs
;

431 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


432 
díåy
 *
	mdbgfs_dú
;

433 
díåy
 *
	mdbgfs_¶ök
;

434 
iwl_dbgfs_pm
 
	mdbgfs_pm
;

435 
iwl_dbgfs_bf
 
	mdbgfs_bf
;

436 
iwl_mac_powî_cmd
 
	mmac_pwr_cmd
;

437 
	mdbgfs_quŸa_mö
;

441 
u8
 
	mu≠sd_misbehavög_≠_addr
[
ETH_ALEN
] 
__Æig√d
(2);

442 
dñayed_w‹k
 
	mu≠sd_n⁄agg_dëe˘ed_wk
;

444 
boﬁ
 
	mcß_cou¡down
;

445 
boﬁ
 
	mcß_Áûed
;

446 
boﬁ
 
	mcß_b˙_≥ndög
;

447 
u16
 
	mcß_èrgë_‰eq
;

448 
u16
 
	mcß_cou¡
;

449 
u16
 
	mcß_misbehave
;

450 
dñayed_w‹k
 
	mcß_w‹k
;

452 
iwl_tsf_id
 
	mtsf_id
;

454 
iwl_mvm_time_evít_d©a
 
	mtime_evít_d©a
;

455 
iwl_mvm_time_evít_d©a
 
	mhs_time_evít_d©a
;

458 
√tdev_„©uªs_t
 
	m„©uªs
;

460 
õì80211_°a
 *
	m≠_°a
;

463 
õì80211_key_c⁄f
 *
	m≠_óæy_keys
[4];

466 
õì80211_key_c⁄f
 
__rcu
 *
	mkeys
[2];

467 } 
	mb˙_¥Ÿ
;

469 
iwl_mvm_vif_lök_öfo
 
	mdeÊök
;

470 
iwl_mvm_vif_lök_öfo
 *
	mlök
[
IEEE80211_MLD_MAX_NUM_LINKS
];

473 
	#f‹_óch_mvm_vif_vÆid_lök
(
mvm_vif
, 
lök_id
) \

474 
lök_id
 = 0; \

475 
lök_id
 < 
	`ARRAY_SIZE
((
mvm_vif
)->
lök
); \

476 
lök_id
++) \

477 i‡((
mvm_vif
)->
lök
[
lök_id
])

	)

479 
ölöe
 
iwl_mvm_vif
 *

480 
	$iwl_mvm_vif_‰om_mac80211
(
õì80211_vif
 *
vif
)

482  (*)
vif
->
drv_¥iv
;

483 
	}
}

485 c⁄° 
u8
 
tid_to_mac80211_ac
[];

487 
	#IWL_MVM_SCAN_STOPPING_SHIFT
 8

	)

489 
	eiwl_sˇn_°©us
 {

490 
	mIWL_MVM_SCAN_REGULAR
 = 
BIT
(0),

491 
	mIWL_MVM_SCAN_SCHED
 = 
BIT
(1),

492 
	mIWL_MVM_SCAN_NETDETECT
 = 
BIT
(2),

494 
	mIWL_MVM_SCAN_STOPPING_REGULAR
 = 
BIT
(8),

495 
	mIWL_MVM_SCAN_STOPPING_SCHED
 = 
BIT
(9),

496 
	mIWL_MVM_SCAN_STOPPING_NETDETECT
 = 
BIT
(10),

498 
	mIWL_MVM_SCAN_REGULAR_MASK
 = 
IWL_MVM_SCAN_REGULAR
 |

499 
IWL_MVM_SCAN_STOPPING_REGULAR
,

500 
	mIWL_MVM_SCAN_SCHED_MASK
 = 
IWL_MVM_SCAN_SCHED
 |

501 
IWL_MVM_SCAN_STOPPING_SCHED
,

502 
	mIWL_MVM_SCAN_NETDETECT_MASK
 = 
IWL_MVM_SCAN_NETDETECT
 |

503 
IWL_MVM_SCAN_STOPPING_NETDETECT
,

505 
	mIWL_MVM_SCAN_STOPPING_MASK
 = 0xf‡<< 
IWL_MVM_SCAN_STOPPING_SHIFT
,

506 
	mIWL_MVM_SCAN_MASK
 = 0xff,

509 
	eiwl_mvm_sˇn_ty≥
 {

510 
	mIWL_SCAN_TYPE_NOT_SET
,

511 
	mIWL_SCAN_TYPE_UNASSOC
,

512 
	mIWL_SCAN_TYPE_WILD
,

513 
	mIWL_SCAN_TYPE_MILD
,

514 
	mIWL_SCAN_TYPE_FRAGMENTED
,

515 
	mIWL_SCAN_TYPE_FAST_BALANCE
,

518 
	eiwl_mvm_sched_sˇn_∑ss_Æl_°©es
 {

519 
	mSCHED_SCAN_PASS_ALL_DISABLED
,

520 
	mSCHED_SCAN_PASS_ALL_ENABLED
,

521 
	mSCHED_SCAN_PASS_ALL_FOUND
,

533 
	siwl_mvm_â_mgmt
 {

534 
dñayed_w‹k
 
	m˘_kûl_exô
;

535 
boﬁ
 
	mdy«mic_smps
;

536 
u32
 
	mtx_backoff
;

537 
u32
 
	mmö_backoff
;

538 
iwl_â_∑øms
 
	m∑øms
;

539 
boﬁ
 
	mthrŸée
;

542 #ifde‡
CONFIG_THERMAL


548 
	siwl_mvm_thîmÆ_devi˚
 {

549 
thîmÆ_åù
 
	måùs
[
IWL_MAX_DTS_TRIPS
];

550 
thîmÆ_z⁄e_devi˚
 *
	mtz⁄e
;

558 
	siwl_mvm_coﬁög_devi˚
 {

559 
u32
 
	mcur_°©e
;

560 
thîmÆ_coﬁög_devi˚
 *
	mcdev
;

564 
	#IWL_MVM_NUM_LAST_FRAMES_UCODE_RATES
 8

	)

566 
	siwl_mvm_‰ame_°©s
 {

567 
u32
 
	mÀgacy_‰ames
;

568 
u32
 
	mht_‰ames
;

569 
u32
 
	mvht_‰ames
;

570 
u32
 
	mbw_20_‰ames
;

571 
u32
 
	mbw_40_‰ames
;

572 
u32
 
	mbw_80_‰ames
;

573 
u32
 
	mbw_160_‰ames
;

574 
u32
 
	msgi_‰ames
;

575 
u32
 
	mngi_‰ames
;

576 
u32
 
	msiso_‰ames
;

577 
u32
 
	mmimo2_‰ames
;

578 
u32
 
	magg_‰ames
;

579 
u32
 
	mampdu_cou¡
;

580 
u32
 
	msuc˚ss_‰ames
;

581 
u32
 
	mÁû_‰ames
;

582 
u32
 
	mœ°_øãs
[
IWL_MVM_NUM_LAST_FRAMES_UCODE_RATES
];

583 
	mœ°_‰ame_idx
;

586 
	#IWL_MVM_DEBUG_SET_TEMPERATURE_DISABLE
 0xff

	)

587 
	#IWL_MVM_DEBUG_SET_TEMPERATURE_MIN
 -100

	)

588 
	#IWL_MVM_DEBUG_SET_TEMPERATURE_MAX
 200

	)

590 
	eiwl_mvm_tdls_cs_°©e
 {

591 
	mIWL_MVM_TDLS_SW_IDLE
 = 0,

592 
	mIWL_MVM_TDLS_SW_REQ_SENT
,

593 
	mIWL_MVM_TDLS_SW_RESP_RCVD
,

594 
	mIWL_MVM_TDLS_SW_REQ_RCVD
,

595 
	mIWL_MVM_TDLS_SW_ACTIVE
,

598 
	eiwl_mvm_åaffic_lﬂd
 {

599 
	mIWL_MVM_TRAFFIC_LOW
,

600 
	mIWL_MVM_TRAFFIC_MEDIUM
,

601 
	mIWL_MVM_TRAFFIC_HIGH
,

604 
	$DECLARE_EWMA
(
øã
, 16, 16)

606 
	siwl_mvm_tcm_mac
 {

608 
u32
 
pkts
[
IEEE80211_NUM_ACS
];

609 
u32
 
aútime
;

610 } 
tx
;

612 
u32
 
pkts
[
IEEE80211_NUM_ACS
];

613 
u32
 
aútime
;

614 
u32
 
œ°_ampdu_ªf
;

615 } 
rx
;

618 
u64
 
rx_byãs
;

619 
ewma_øã
 
øã
;

620 
boﬁ
 
dëe˘ed
;

621 } 
u≠sd_n⁄agg_dëe˘
;

622 
boﬁ
 
›íed_rx_ba_£ssi⁄s
;

625 
	siwl_mvm_tcm
 {

626 
dñayed_w‹k
 
w‹k
;

627 
•ölock_t
 
lock
;

628 
ts
;

629 
Œ_ts
;

630 
u≠sd_n⁄agg_ts
;

631 
boﬁ
 
∑u£d
;

632 
iwl_mvm_tcm_mac
 
d©a
[
NUM_MAC_INDEX_DRIVER
];

634 
u32
 
ñ≠£d
;

635 
u32
 
aútime
[
NUM_MAC_INDEX_DRIVER
];

636 
iwl_mvm_åaffic_lﬂd
 
lﬂd
[
NUM_MAC_INDEX_DRIVER
];

637 
iwl_mvm_åaffic_lﬂd
 
b™d_lﬂd
[
NUM_NL80211_BANDS
];

638 
iwl_mvm_åaffic_lﬂd
 
globÆ_lﬂd
;

639 
boﬁ
 
low_œãncy
[
NUM_MAC_INDEX_DRIVER
];

640 
boﬁ
 
ch™ge
[
NUM_MAC_INDEX_DRIVER
];

641 } 
ªsu…
;

656 
	siwl_mvm_ª‹dî_buf„r
 {

657 
u16
 
hód_¢
;

658 
u16
 
num_°‹ed
;

659 
u16
 
buf_size
;

660 
queue
;

661 
u16
 
œ°_amsdu
;

662 
u8
 
œ°_sub_ödex
;

663 
boﬁ
 
vÆid
;

664 
•ölock_t
 
lock
;

665 
iwl_mvm
 *
mvm
;

666 } 
____ˇchñöe_Æig√d_ö_smp
;

672 
	siwl_mvm_ª‹dî_buf_íåy
 {

673 
sk_buff_hód
 
‰ames
;

675 #i‚de‡
__CHECKER__


677 
	`__Æig√d
(
	`roundup_pow_of_two
((
sk_buff_hód
)))

697 
	siwl_mvm_baid_d©a
 {

698 
rcu_hód
Ñcu_head;

699 
u32
 
°a_mask
;

700 
u8
 
tid
;

701 
u8
 
baid
;

702 
u16
 
timeout
;

703 
u16
 
íåõs_≥r_queue
;

704 
œ°_rx
;

705 
timî_li°
 
£ssi⁄_timî
;

706 
iwl_mvm_baid_d©a
 
__rcu
 **
rcu_±r
;

707 
iwl_mvm
 *
mvm
;

708 
iwl_mvm_ª‹dî_buf„r
 
ª‹dî_buf
[
IWL_MAX_RX_HW_QUEUES
];

709 
iwl_mvm_ª‹dî_buf_íåy
 
íåõs
[];

712 
ölöe
 
iwl_mvm_baid_d©a
 *

713 
	$iwl_mvm_baid_d©a_‰om_ª‹dî_buf
(
iwl_mvm_ª‹dî_buf„r
 *
buf
)

715  (*)((
u8
 *)
buf
 -

716 
	`off£tof
(
iwl_mvm_baid_d©a
, 
ª‹dî_buf
) -

717 (*
buf
Ë* buf->
queue
);

718 
	}
}

740 
	eiwl_mvm_queue_°©us
 {

741 
	mIWL_MVM_QUEUE_FREE
,

742 
	mIWL_MVM_QUEUE_RESERVED
,

743 
	mIWL_MVM_QUEUE_READY
,

744 
	mIWL_MVM_QUEUE_SHARED
,

747 
	#IWL_MVM_DQA_QUEUE_TIMEOUT
 (5 * 
HZ
)

	)

748 
	#IWL_MVM_INVALID_QUEUE
 0xFFFF

	)

750 
	#IWL_MVM_NUM_CIPHERS
 10

	)

753 
	siwl_mvm_txq
 {

754 
li°_hód
 
	mli°
;

755 
u16
 
	mtxq_id
;

756 
©omic_t
 
	mtx_ªque°
;

757 
	#IWL_MVM_TXQ_STATE_STOP_FULL
 0

	)

758 
	#IWL_MVM_TXQ_STATE_STOP_REDIRECT
 1

	)

759 
	#IWL_MVM_TXQ_STATE_READY
 2

	)

760 
	m°©e
;

763 
ölöe
 
iwl_mvm_txq
 *

764 
	$iwl_mvm_txq_‰om_mac80211
(
õì80211_txq
 *
txq
)

766  (*)
txq
->
drv_¥iv
;

767 
	}
}

769 
ölöe
 
iwl_mvm_txq
 *

770 
	$iwl_mvm_txq_‰om_tid
(
õì80211_°a
 *
°a
, 
u8
 
tid
)

772 i‡(
tid
 =
IWL_MAX_TID_COUNT
)

773 
tid
 = 
IEEE80211_NUM_TIDS
;

775  (*)
°a
->
txq
[
tid
]->
drv_¥iv
;

776 
	}
}

784 
	siwl_mvm_tvqm_txq_öfo
 {

785 
u8
 
	m°a_id
;

786 
u8
 
	mtxq_tid
;

789 
	siwl_mvm_dqa_txq_öfo
 {

790 
u8
 
	mø_°a_id
;

791 
boﬁ
 
	mª£rved
;

792 
u8
 
	mmac80211_ac
;

793 
u8
 
	mtxq_tid
;

794 
u16
 
	mtid_bôm≠
;

796 
	mœ°_‰ame_time
[
IWL_MAX_TID_COUNT
 + 1];

797 
iwl_mvm_queue_°©us
 
	m°©us
;

800 
	s±p_d©a
 {

801 
±p_˛ock
 *
	m±p_˛ock
;

802 
±p_˛ock_öfo
 
	m±p_˛ock_öfo
;

804 
dñayed_w‹k
 
	mdw‹k
;

807 
u32
 
	mœ°_gp2
;

810 
u32
 
	mwøp_cou¡î
;

813 
u32
 
	msˇÀ_upd©e_gp2
;

816 
u64
 
	msˇÀ_upd©e_adj_time_ns
;

819 
u64
 
	msˇÀd_‰eq
;

822 
s64
 
	mdñè
;

825 
	siwl_time_sync_d©a
 {

826 
sk_buff_hód
 
	m‰ame_li°
;

827 
u8
 
	m≥î_addr
[
ETH_ALEN
];

828 
boﬁ
 
	ma˘ive
;

831 
	siwl_mei_sˇn_fûãr
 {

832 
boﬁ
 
	mis_mei_limôed_sˇn
;

833 
sk_buff_hód
 
	msˇn_ªs
;

834 
w‹k_°ru˘
 
	msˇn_w‹k
;

837 
	siwl_mvm
 {

839 
devi˚
 *
	mdev
;

841 
iwl_å™s
 *
	må™s
;

842 c⁄° 
iwl_fw
 *
	mfw
;

843 c⁄° 
iwl_cfg
 *
	mcfg
;

844 
iwl_phy_db
 *
	mphy_db
;

845 
õì80211_hw
 *
	mhw
;

848 
muãx
 
	mmuãx
;

849 
li°_hód
 
	masync_h™dÀrs_li°
;

850 
•ölock_t
 
	masync_h™dÀrs_lock
;

851 
w‹k_°ru˘
 
	masync_h™dÀrs_wk
;

854 
wùhy_w‹k
 
	masync_h™dÀrs_wùhy_wk
;

856 
w‹k_°ru˘
 
	mroc_d⁄e_wk
;

858 
	möô_°©us
;

860 
	m°©us
;

862 
u32
 
	mqueue_sync_cookõ
;

863 
	mqueue_sync_°©e
;

868 
iwl_mvm_vif
 *
	mbf_Ælowed_vif
;

870 
boﬁ
 
	mhw_ªgi°îed
;

871 
boﬁ
 
	mrfkûl_ß„_öô_d⁄e
;

873 
u8
 
	mcˇ_40mhz_w‹k¨ound
;

875 
u32
 
	mampdu_ªf
;

876 
boﬁ
 
	mampdu_toggÀ
;

878 
iwl_nŸif_waô_d©a
 
	mnŸif_waô
;

881 
mvm_°©i°ics_rx_v3
 
	mrx_°©s_v3
;

882 
mvm_°©i°ics_rx
 
	mrx_°©s
;

886 
u64
 
	mrx_time
;

887 
u64
 
	mtx_time
;

888 
u64
 
	m⁄_time_rf
;

889 
u64
 
	m⁄_time_sˇn
;

890 } 
	mødio_°©s
, 
	maccu_ødio_°©s
;

892 
li°_hód
 
	madd_°ªam_txqs
;

894 
iwl_mvm_dqa_txq_öfo
 
	mqueue_öfo
[
IWL_MAX_HW_QUEUES
];

895 
iwl_mvm_tvqm_txq_öfo
 
	mtvqm_öfo
[
IWL_MAX_TVQM_QUEUES
];

897 
w‹k_°ru˘
 
	madd_°ªam_wk
;

898 
•ölock_t
 
	madd_°ªam_lock
;

900 c⁄° *
	mnvm_fûe_«me
;

901 
iwl_nvm_d©a
 *
	mnvm_d©a
;

902 
iwl_mei_nvm
 *
	mmei_nvm_d©a
;

903 
iwl_mvm_csme_c⁄n_öfo
 
__rcu
 *
	mcsme_c⁄n_öfo
;

904 
boﬁ
 
	mmei_rfkûl_blocked
;

905 
boﬁ
 
	mmei_ªgi°îed
;

906 
w‹k_°ru˘
 
	mßp_c⁄√˘ed_wk
;

912 
iwl_nvm_d©a
 *
	mãmp_nvm_d©a
;

915 
iwl_nvm_£˘i⁄
 
	mnvm_£˘i⁄s
[
NVM_MAX_NUM_SECTIONS
];

917 
iwl_fw_ru¡ime
 
	mfwπ
;

920 
mac_addªss
 
	maddªs£s
[
IWL_MVM_MAX_ADDRESSES
];

923 
iwl_rx_phy_öfo
 
	mœ°_phy_öfo
;

924 
õì80211_°a
 
__rcu
 *
	mfw_id_to_mac_id
[
IWL_MVM_STATION_COUNT_MAX
];

925 
õì80211_lök_°a
 
__rcu
 *
	mfw_id_to_lök_°a
[
IWL_MVM_STATION_COUNT_MAX
];

926 
	mfw_lök_ids_m≠
;

927 
u8
 
	mrx_ba_£ssi⁄s
;

930 
u32
 
	mπs_thªshﬁd
;

933 
	msˇn_°©us
;

934 
size_t
 
	msˇn_cmd_size
;

935 *
	msˇn_cmd
;

936 
iwl_mˇ°_fûãr_cmd
 *
	mmˇ°_fûãr_cmd
;

938 
iwl_mvm_sˇn_ty≥
 
	msˇn_ty≥
;

939 
iwl_mvm_sˇn_ty≥
 
	mhb_sˇn_ty≥
;

941 
iwl_mvm_sched_sˇn_∑ss_Æl_°©es
 
	msched_sˇn_∑ss_Æl
;

942 
dñayed_w‹k
 
	msˇn_timeout_dw‹k
;

945 
	mmax_sˇns
;

948 
u32
 
	msˇn_uid_°©us
[
IWL_MVM_MAX_UMAC_SCANS
];

951 
u64
 
	msˇn_°¨t
;

954 
iwl_mvm_vif
 *
	msˇn_vif
;

955 
u8
 
	msˇn_lök_id
;

958 
u8
 
	msˇn_rx_™t
;

961 
iwl_mvm_öt_°a
 
	maux_°a
;

962 
iwl_mvm_öt_°a
 
	m¢if_°a
;

964 
boﬁ
 
	mœ°_ebs_suc˚ssful
;

966 
u8
 
	msˇn_œ°_™ã¬a_idx
;

967 
u8
 
	mmgmt_œ°_™ã¬a_idx
;

969 
u8
 
	m£t_tx_™t
;

970 
u8
 
	m£t_rx_™t
;

973 
iwl_sf_°©e
 
	msf_°©e
;

979 
díåy
 *
	mdebugfs_dú
;

980 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


981 
u32
 
	mdbgfs_§am_off£t
, 
	mdbgfs_§am_Àn
;

982 
u32
 
	mdbgfs_¥ph_ªg_addr
;

983 
boﬁ
 
	mdißbÀ_powî_off
;

984 
boﬁ
 
	mdißbÀ_powî_off_d3
;

985 
boﬁ
 
	mbóc⁄_öje˘_a˘ive
;

987 
boﬁ
 
	msˇn_ôî_nŸif_íabÀd
;

989 
debugfs_blob_wøµî
 
	mnvm_hw_blob
;

990 
debugfs_blob_wøµî
 
	mnvm_sw_blob
;

991 
debugfs_blob_wøµî
 
	mnvm_ˇlib_blob
;

992 
debugfs_blob_wøµî
 
	mnvm_¥od_blob
;

993 
debugfs_blob_wøµî
 
	mnvm_phy_sku_blob
;

994 
debugfs_blob_wøµî
 
	mnvm_ªg_blob
;

996 
iwl_mvm_‰ame_°©s
 
	mdrv_rx_°©s
;

997 
•ölock_t
 
	mdrv_°©s_lock
;

998 
u16
 
	mdbgfs_rx_phyöfo
;

1001 
iwl_mvm_phy_˘xt
 
	mphy_˘xts
[
NUM_PHY_CTX
];

1003 
li°_hód
 
	mtime_evít_li°
;

1004 
•ölock_t
 
	mtime_evít_lock
;

1010 
	mfw_key_èbÀ
[
BITS_TO_LONGS
(
STA_KEY_MAX_NUM
)];

1011 
u8
 
	mfw_key_dñëed
[
STA_KEY_MAX_NUM
];

1013 
õì80211_vif
 
__rcu
 *
	mvif_id_to_mac
[
NUM_MAC_INDEX_DRIVER
];

1015 
õì80211_bss_c⁄f
 
__rcu
 *
	mlök_id_to_lök_c⁄f
[
IWL_MVM_FW_MAX_LINK_ID
 + 1];

1018 
s8
 
	mfw_ª°¨t
;

1019 
u8
 *
	mîr‹_ªcovîy_buf
;

1021 #ifde‡
CONFIG_IWLWIFI_LEDS


1022 
Àd_˛assdev
 
	mÀd
;

1025 
õì80211_vif
 *
	mp2p_devi˚_vif
;

1027 #ifde‡
CONFIG_PM


1028 
wùhy_wowœn_suµ‹t
 
	mwowœn
;

1029 
	mgtk_ivÀn
, 
	mgtk_icvÀn
, 
	m±k_ivÀn
, 
	m±k_icvÀn
;

1032 
õì80211_sˇn_õs
 
	mnd_õs
;

1033 
cfg80211_m©ch_£t
 *
	mnd_m©ch_£ts
;

1034 
	mn_nd_m©ch_£ts
;

1035 
õì80211_ch™√l
 **
	mnd_ch™√ls
;

1036 
	mn_nd_ch™√ls
;

1037 
boﬁ
 
	m√t_dëe˘
;

1038 
u8
 
	mofÊﬂd_tid
;

1039 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


1040 
boﬁ
 
	md3_wake_syßs£π
;

1041 
boﬁ
 
	md3_ã°_a˘ive
;

1042 
u32
 
	md3_ã°_pme_±r
;

1043 
õì80211_vif
 *
	mkìp_vif
;

1044 
u32
 
	mœ°_√tdëe˘_sˇns
;

1048 
waô_queue_hód_t
 
	mrx_sync_waôq
;

1051 
iwl_bt_c€x_¥ofûe_nŸif
 
	mœ°_bt_nŸif
;

1052 
iwl_bt_c€x_ci_cmd
 
	mœ°_bt_ci_cmd
;

1054 
u8
 
	mbt_tx_¥io
;

1055 
iwl_bt_f‹˚_™t_mode
 
	mbt_f‹˚_™t_mode
;

1058 
li°_hód
 
	maux_roc_ã_li°
;

1061 
iwl_mvm_â_mgmt
 
	mthîmÆ_thrŸée
;

1062 #ifde‡
CONFIG_THERMAL


1063 
iwl_mvm_thîmÆ_devi˚
 
	mtz_devi˚
;

1064 
iwl_mvm_coﬁög_devi˚
 
	mcoﬁög_dev
;

1067 
s32
 
	mãm≥øtuª
;

1073 
boﬁ
 
	mãm≥øtuª_ã°
;

1075 
boﬁ
 
	mfw_°©ic_smps_ªque°
;

1077 
	mbt_c€x_œ°_tcm_ts
;

1078 
iwl_mvm_tcm
 
	mtcm
;

1080 
u8
 
	mu≠sd_nﬂgg_bssid_wrôe_idx
;

1081 
mac_addªss
 
	mu≠sd_nﬂgg_bssids
[
IWL_MVM_UAPSD_NOAGG_BSSIDS_NUM
]

1082 
__Æig√d
(2);

1084 
iwl_time_quŸa_cmd
 
	mœ°_quŸa_cmd
;

1086 #ifde‡
CONFIG_NL80211_TESTMODE


1087 
u32
 
	mnﬂ_duøti⁄
;

1088 
õì80211_vif
 *
	mnﬂ_vif
;

1092 
u16
 
	maux_queue
;

1093 
u16
 
	m¢if_queue
;

1094 
u16
 
	m¥obe_queue
;

1095 
u16
 
	mp2p_dev_queue
;

1098 
u8
 
	mps_dißbÀd
;

1100 
u32
 
	mext_˛ock_vÆid
;

1103 
õì80211_vif
 *
	mcsme_vif
;

1104 
õì80211_vif
 
__rcu
 *
	mcß_vif
;

1105 
õì80211_vif
 
__rcu
 *
	mcß_tx_blocked_vif
;

1106 
u8
 
	mcß_tx_block_b˙_timeout
;

1109 
u32
 
	m≠_œ°_bóc⁄_gp2
;

1112 
boﬁ
 
	mibss_m™agî
;

1114 
boﬁ
 
	mœr_ªgdom_£t
;

1115 
iwl_mcc_sour˚
 
	mmcc_§c
;

1119 
dñayed_w‹k
 
	mdw‹k
;

1120 
iwl_mvm_tdls_cs_°©e
 
	m°©e
;

1126 
u8
 
	mcur_°a_id
;

1130 
u8
 
	m°a_id
;

1131 
u8
 
	m›_˛ass
;

1132 
boﬁ
 
	möôüt‹
;

1133 
cfg80211_ch™_def
 
	mch™def
;

1134 
sk_buff
 *
	mskb
;

1135 
u32
 
	mch_sw_tm_õ
;

1138 
u32
 
	m£¡_time°amp
;

1139 } 
	m≥î
;

1140 } 
	mtdls_cs
;

1143 
u32
 
	mcùhîs
[
IWL_MVM_NUM_CIPHERS
];

1145 
cfg80211_·m_ª•⁄dî_°©s
 
	m·m_ª•_°©s
;

1147 
cfg80211_pm§_ªque°
 *
	mªq
;

1148 
wúñess_dev
 *
	mªq_wdev
;

1149 
li°_hód
 
	mloc_li°
;

1150 
	mª•⁄£s
[
IWL_MVM_TOF_MAX_APS
];

1152 
li°_hód
 
	mª•
;

1153 } 
	msmoŸh
;

1154 
li°_hód
 
	m∑¢_li°
;

1155 } 
	m·m_öôüt‹
;

1157 
li°_hód
 
	mª•_∑¢_li°
;

1159 
±p_d©a
 
	m±p_d©a
;

1162 
u8
 
	mønge_ª•
;

1163 } 
	mcmd_vî
;

1165 
õì80211_vif
 *
	m«n_vif
;

1166 
iwl_mvm_baid_d©a
 
__rcu
 *
	mbaid_m≠
[
IWL_MAX_BAID
];

1172 
boﬁ
 
	mdr›_b˙_≠_mode
;

1174 
dñayed_w‹k
 
	mcs_tx_unblock_dw‹k
;

1177 
boﬁ
 
	mm⁄ô‹_⁄
;

1182 
u8
 
	mm⁄ô‹_p80
;

1185 
__À16
 
	mcur_aid
;

1186 
u8
 
	mcur_bssid
[
ETH_ALEN
];

1188 #ifde‡
CONFIG_ACPI


1189 
iwl_phy_•ecific_cfg
 
	mphy_fûãrs
;

1192 
	mœ°_6ghz_∑ssive_sˇn_jiffõs
;

1193 
	mœ°_ª£t_‹_ªsume_time_jiffõs
;

1195 
boﬁ
 
	m°a_ªmove_ªquúes_queue_ªmove
;

1196 
boﬁ
 
	mmld_≠i_is_u£d
;

1198 
boﬁ
 
	m∂dr_sync
;

1200 
iwl_time_sync_d©a
 
	mtime_sync
;

1202 
iwl_mei_sˇn_fûãr
 
	mmei_sˇn_fûãr
;

1204 
boﬁ
 
	m°©i°ics_˛ór
;

1208 
	#IWL_OP_MODE_GET_MVM
(
_iwl_›_mode
) \

1209 ((
iwl_mvm
 *)(
_iwl_›_mode
)->
›_mode_•ecific
)

	)

1211 
	#IWL_MAC80211_GET_MVM
(
_hw
) \

1212 
	`IWL_OP_MODE_GET_MVM
((
iwl_›_mode
 *)((
_hw
)->
¥iv
))

	)

1229 
	eiwl_mvm_°©us
 {

1230 
	mIWL_MVM_STATUS_HW_RFKILL
,

1231 
	mIWL_MVM_STATUS_HW_CTKILL
,

1232 
	mIWL_MVM_STATUS_ROC_RUNNING
,

1233 
	mIWL_MVM_STATUS_HW_RESTART_REQUESTED
,

1234 
	mIWL_MVM_STATUS_IN_HW_RESTART
,

1235 
	mIWL_MVM_STATUS_ROC_AUX_RUNNING
,

1236 
	mIWL_MVM_STATUS_FIRMWARE_RUNNING
,

1237 
	mIWL_MVM_STATUS_IN_D3
,

1238 
	mIWL_MVM_STATUS_SUPPRESS_ERROR_LOG_ONCE
,

1239 
	mIWL_MVM_STATUS_STARTING
,

1242 
	siwl_mvm_csme_c⁄n_öfo
 {

1243 
rcu_hód
 
	mrcu_hód
;

1244 
iwl_mei_c⁄n_öfo
 
	mc⁄n_öfo
;

1248 
	eiwl_mvm_öô_°©us
 {

1249 
	mIWL_MVM_INIT_STATUS_THERMAL_INIT_COMPLETE
 = 
BIT
(0),

1250 
	mIWL_MVM_INIT_STATUS_LEDS_INIT_COMPLETE
 = 
BIT
(1),

1253 
ölöe
 
boﬁ
 
	$iwl_mvm_is_ødio_kûÀd
(
iwl_mvm
 *
mvm
)

1255  
	`ã°_bô
(
IWL_MVM_STATUS_HW_RFKILL
, &
mvm
->
°©us
) ||

1256 
	`ã°_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
);

1257 
	}
}

1259 
ölöe
 
boﬁ
 
	$iwl_mvm_is_ødio_hw_kûÀd
(
iwl_mvm
 *
mvm
)

1261  
	`ã°_bô
(
IWL_MVM_STATUS_HW_RFKILL
, &
mvm
->
°©us
);

1262 
	}
}

1264 
ölöe
 
boﬁ
 
	$iwl_mvm_fúmw¨e_ru¬ög
(
iwl_mvm
 *
mvm
)

1266  
	`ã°_bô
(
IWL_MVM_STATUS_FIRMWARE_RUNNING
, &
mvm
->
°©us
);

1267 
	}
}

1272 
ölöe
 
iwl_mvm_°a
 *

1273 
	$iwl_mvm_°a_‰om_°aid_rcu
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
)

1275 
õì80211_°a
 *
°a
;

1277 i‡(
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
)

1278  
NULL
;

1280 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

1283 i‡(
	`IS_ERR_OR_NULL
(
°a
))

1284  
NULL
;

1286  
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1287 
	}
}

1289 
ölöe
 
iwl_mvm_°a
 *

1290 
	$iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
)

1292 
õì80211_°a
 *
°a
;

1294 i‡(
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
)

1295  
NULL
;

1297 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

1298 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1301 i‡(
	`IS_ERR_OR_NULL
(
°a
))

1302  
NULL
;

1304  
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1305 
	}
}

1307 
ölöe
 
õì80211_vif
 *

1308 
	$iwl_mvm_rcu_dîe„ªn˚_vif_id
(
iwl_mvm
 *
mvm
, 
u8
 
vif_id
, 
boﬁ
 
rcu
)

1310 i‡(
	`WARN_ON
(
vif_id
 >
	`ARRAY_SIZE
(
mvm
->
vif_id_to_mac
)))

1311  
NULL
;

1313 i‡(
rcu
)

1314  
	`rcu_dîe„ªn˚
(
mvm
->
vif_id_to_mac
[
vif_id
]);

1316  
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
vif_id_to_mac
[
vif_id
],

1317 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1318 
	}
}

1320 
ölöe
 
õì80211_bss_c⁄f
 *

1321 
	$iwl_mvm_rcu_fw_lök_id_to_lök_c⁄f
(
iwl_mvm
 *
mvm
, 
u8
 
lök_id
, 
boﬁ
 
rcu
)

1323 i‡(
	`WARN_ON
(
lök_id
 >
	`ARRAY_SIZE
(
mvm
->
lök_id_to_lök_c⁄f
)))

1324  
NULL
;

1326 i‡(
rcu
)

1327  
	`rcu_dîe„ªn˚
(
mvm
->
lök_id_to_lök_c⁄f
[
lök_id
]);

1329  
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
lök_id_to_lök_c⁄f
[
lök_id
],

1330 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1331 
	}
}

1333 
ölöe
 
boﬁ
 
	$iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1335  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1336 
IWL_UCODE_TLV_API_ADAPTIVE_DWELL
);

1337 
	}
}

1339 
ölöe
 
boﬁ
 
	$iwl_mvm_is_ad≠tive_dwñl_v2_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1341  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1342 
IWL_UCODE_TLV_API_ADAPTIVE_DWELL_V2
);

1343 
	}
}

1345 
ölöe
 
boﬁ
 
	$iwl_mvm_is_adwñl_hb_≠_num_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1347  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1348 
IWL_UCODE_TLV_API_ADWELL_HB_DEF_N_AP
);

1349 
	}
}

1351 
ölöe
 
boﬁ
 
	$iwl_mvm_is_o˚_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1354  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_OCE
);

1355 
	}
}

1357 
ölöe
 
boﬁ
 
	$iwl_mvm_is_‰ag_ebs_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1359  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_FRAG_EBS
);

1360 
	}
}

1362 
ölöe
 
boﬁ
 
	$iwl_mvm_is_sh‹t_bóc⁄_nŸif_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1364  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1365 
IWL_UCODE_TLV_API_SHORT_BEACON_NOTIF
);

1366 
	}
}

1368 
ölöe
 
boﬁ
 
	$iwl_mvm_is_dqa_d©a_queue
(
iwl_mvm
 *
mvm
, 
u8
 
queue
)

1370  (
queue
 >
IWL_MVM_DQA_MIN_DATA_QUEUE
) &&

1371 (
queue
 <
IWL_MVM_DQA_MAX_DATA_QUEUE
);

1372 
	}
}

1374 
ölöe
 
boﬁ
 
	$iwl_mvm_is_dqa_mgmt_queue
(
iwl_mvm
 *
mvm
, 
u8
 
queue
)

1376  (
queue
 >
IWL_MVM_DQA_MIN_MGMT_QUEUE
) &&

1377 (
queue
 <
IWL_MVM_DQA_MAX_MGMT_QUEUE
);

1378 
	}
}

1380 
ölöe
 
boﬁ
 
	$iwl_mvm_is_œr_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1382 
boﬁ
 
nvm_œr
 = 
mvm
->
nvm_d©a
->
œr_íabÀd
;

1383 
boﬁ
 
év_œr
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1384 
IWL_UCODE_TLV_CAPA_LAR_SUPPORT
);

1390 i‡(
mvm
->
cfg
->
nvm_ty≥
 =
IWL_NVM_EXT
)

1391  
nvm_œr
 && 
év_œr
;

1393  
év_œr
;

1394 
	}
}

1396 
ölöe
 
boﬁ
 
	$iwl_mvm_is_wifi_mcc_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1398  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1399 
IWL_UCODE_TLV_API_WIFI_MCC_UPDATE
) ||

1400 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1401 
IWL_UCODE_TLV_CAPA_LAR_MULTI_MCC
);

1402 
	}
}

1404 
ölöe
 
boﬁ
 
	$iwl_mvm_bt_is_ºc_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1406  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1407 
IWL_UCODE_TLV_CAPA_BT_COEX_RRC
) &&

1408 
IWL_MVM_BT_COEX_RRC
;

1409 
	}
}

1411 
ölöe
 
boﬁ
 
	$iwl_mvm_is_csum_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1413  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1414 
IWL_UCODE_TLV_CAPA_CSUM_SUPPORT
) &&

1415 !
IWL_MVM_HW_CSUM_DISABLE
;

1416 
	}
}

1418 
ölöe
 
boﬁ
 
	$iwl_mvm_is_m∂ut_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1420  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1421 
IWL_UCODE_TLV_CAPA_BT_MPLUT_SUPPORT
) &&

1422 
IWL_MVM_BT_COEX_MPLUT
;

1423 
	}
}

1425 
ölöe


1426 
boﬁ
 
	$iwl_mvm_is_p2p_scm_u≠sd_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1428  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1429 
IWL_UCODE_TLV_CAPA_P2P_SCM_UAPSD
) &&

1430 !(
iwlwifi_mod_∑øms
.
u≠sd_dißbÀ
 &

1431 
IWL_DISABLE_UAPSD_P2P_CLIENT
);

1432 
	}
}

1434 
ölöe
 
boﬁ
 
	$iwl_mvm_has_√w_rx_≠i
(
iwl_mvm
 *
mvm
)

1436  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1437 
IWL_UCODE_TLV_CAPA_MULTI_QUEUE_RX_SUPPORT
);

1438 
	}
}

1440 
ölöe
 
boﬁ
 
	$iwl_mvm_has_mld_≠i
(c⁄° 
iwl_fw
 *
fw
)

1442  
	`fw_has_ˇ∑
(&
fw
->
ucode_ˇ∑
,

1443 
IWL_UCODE_TLV_CAPA_MLD_API_SUPPORT
);

1444 
	}
}

1446 
ölöe
 
boﬁ
 
	$iwl_mvm_has_√w_°©i⁄_≠i
(c⁄° 
iwl_fw
 *
fw
)

1448  
	`iwl_mvm_has_mld_≠i
(
fw
) ||

1449 
	`iwl_fw_lookup_cmd_vî
(
fw
, 
ADD_STA
, 0) >= 12;

1450 
	}
}

1452 
ölöe
 
boﬁ
 
	$iwl_mvm_has_√w_tx_≠i
(
iwl_mvm
 *
mvm
)

1455  
mvm
->
å™s
->
å™s_cfg
->
gí2
;

1456 
	}
}

1458 
ölöe
 
boﬁ
 
	$iwl_mvm_has_unifõd_ucode
(
iwl_mvm
 *
mvm
)

1461  
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
;

1462 
	}
}

1464 
ölöe
 
boﬁ
 
	$iwl_mvm_is_cdb_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1475  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1476 
IWL_UCODE_TLV_CAPA_CDB_SUPPORT
);

1477 
	}
}

1479 
ölöe
 
boﬁ
 
	$iwl_mvm_cdb_sˇn_≠i
(
iwl_mvm
 *
mvm
)

1486  
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
;

1487 
	}
}

1489 
ölöe
 
boﬁ
 
	$iwl_mvm_is_sˇn_ext_ch™_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1491  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1492 
IWL_UCODE_TLV_API_SCAN_EXT_CHAN_VER
);

1493 
	}
}

1496 
ölöe
 
boﬁ
 
	$iwl_mvm_is_ªdu˚d_c⁄fig_sˇn_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1498  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1499 
IWL_UCODE_TLV_API_REDUCED_SCAN_CONFIG
);

1500 
	}
}

1502 
ölöe
 
boﬁ
 
	$iwl_mvm_is_b™d_ö_rx_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1504  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1505 
IWL_UCODE_TLV_API_BAND_IN_RX_DATA
);

1506 
	}
}

1508 
ölöe
 
boﬁ
 
	$iwl_mvm_has_√w_rx_°©s_≠i
(
iwl_mvm
 *
mvm
)

1510  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1511 
IWL_UCODE_TLV_API_NEW_RX_STATS
);

1512 
	}
}

1514 
ölöe
 
boﬁ
 
	$iwl_mvm_has_quŸa_low_œãncy
(
iwl_mvm
 *
mvm
)

1516  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1517 
IWL_UCODE_TLV_API_QUOTA_LOW_LATENCY
);

1518 
	}
}

1520 
ölöe
 
boﬁ
 
	$iwl_mvm_has_no_ho°_dißbÀ_tx
(
iwl_mvm
 *
mvm
)

1522  
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

1523 
IWL_UCODE_TLV_API_NO_HOST_DISABLE_TX
);

1524 
	}
}

1526 
ölöe
 
boﬁ
 
	$iwl_mvm_has_éc_ofÊﬂd
(c⁄° 
iwl_mvm
 *
mvm
)

1528  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1529 
IWL_UCODE_TLV_CAPA_TLC_OFFLOAD
);

1530 
	}
}

1532 
ölöe
 
agg_tx_°©us
 *

1533 
	$iwl_mvm_gë_agg_°©us
(
iwl_mvm
 *
mvm
, *
tx_ª•
)

1535 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1536  &((
iwl_mvm_tx_ª•
 *)
tx_ª•
)->
°©us
;

1538  ((
iwl_mvm_tx_ª•_v3
 *)
tx_ª•
)->
°©us
;

1539 
	}
}

1541 
ölöe
 
boﬁ
 
	$iwl_mvm_is_â_ö_fw
(
iwl_mvm
 *
mvm
)

1547  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1548 
IWL_UCODE_TLV_CAPA_CT_KILL_BY_FW
) &&

1549 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1550 
IWL_UCODE_TLV_CAPA_TEMP_THS_REPORT_SUPPORT
);

1551 
	}
}

1553 
ölöe
 
boﬁ
 
	$iwl_mvm_is_˘dp_suµ‹ãd
(
iwl_mvm
 *
mvm
)

1555  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1556 
IWL_UCODE_TLV_CAPA_CTDP_SUPPORT
);

1557 
	}
}

1559 
ölöe
 
boﬁ
 
	$iwl_mvm_is_e§_suµ‹ãd
(
iwl_å™s
 *
å™s
)

1561 i‡((
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
Ë=
IWL_CFG_RF_TYPE_FM
) &&

1562 !
	`CSR_HW_RFID_IS_CDB
(
å™s
->
hw_rf_id
))

1564  
	`CSR_HW_RFID_STEP
(
å™s
->
hw_rf_id
);

1566  
Ál£
;

1567 
	}
}

1569 
ölöe
 
	$iwl_mvm_max_a˘ive_löks
(
iwl_mvm
 *
mvm
,

1570 
õì80211_vif
 *
vif
)

1572 
iwl_å™s
 *
å™s
 = 
mvm
->
fwπ
.trans;

1573 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1575 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1577 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

1578  
mvm
->
fw
->
ucode_ˇ∑
.
num_bóc⁄s
;

1580 i‡((
	`iwl_mvm_is_e§_suµ‹ãd
(
å™s
) &&

1581 !
mvmvif
->
bt_c€x_e§_dißbÀd
) ||

1582 ((
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
Ë=
IWL_CFG_RF_TYPE_FM
 &&

1583 
	`CSR_HW_RFID_IS_CDB
(
å™s
->
hw_rf_id
))))

1584  
IWL_MVM_FW_MAX_ACTIVE_LINKS_NUM
;

1587 
	}
}

1589 c⁄° 
u8
 
iwl_mvm_ac_to_tx_fifo
[];

1590 c⁄° 
u8
 
iwl_mvm_ac_to_gí2_tx_fifo
[];

1591 c⁄° 
u8
 
iwl_mvm_ac_to_bz_tx_fifo
[];

1593 
ölöe
 
u8
 
	$iwl_mvm_mac_ac_to_tx_fifo
(
iwl_mvm
 *
mvm
,

1594 
õì80211_ac_numbîs
 
ac
)

1596 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

1597  
iwl_mvm_ac_to_bz_tx_fifo
[
ac
];

1598 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1599  
iwl_mvm_ac_to_gí2_tx_fifo
[
ac
];

1600  
iwl_mvm_ac_to_tx_fifo
[
ac
];

1601 
	}
}

1603 
	siwl_øã_öfo
 {

1604 
u8
 
	m∂˝
;

1605 
u8
 
	m∂˝_siso
;

1606 
u8
 
	m∂˝_mimo2
;

1607 
u8
 
	m∂˝_mimo3
;

1608 
u8
 
	mõì
;

1611 
__iwl_mvm_mac_°›
(
iwl_mvm
 *
mvm
);

1612 
__iwl_mvm_mac_°¨t
(
iwl_mvm
 *
mvm
);

1618 
iwl_run_öô_mvm_ucode
(
iwl_mvm
 *
mvm
);

1621 
iwl_mvm_Àgacy_hw_idx_to_mac80211_idx
(
u32
 
øã_n_Êags
,

1622 
∆80211_b™d
 
b™d
);

1623 
iwl_mvm_Àgacy_øã_to_mac80211_idx
(
u32
 
øã_n_Êags
,

1624 
∆80211_b™d
 
b™d
);

1625 
iwl_mvm_hwøã_to_tx_øã
(
u32
 
øã_n_Êags
,

1626 
∆80211_b™d
 
b™d
,

1627 
õì80211_tx_øã
 *
r
);

1628 
iwl_mvm_hwøã_to_tx_øã_v1
(
u32
 
øã_n_Êags
,

1629 
∆80211_b™d
 
b™d
,

1630 
õì80211_tx_øã
 *
r
);

1631 
u8
 
iwl_mvm_mac80211_idx_to_hwøã
(c⁄° 
iwl_fw
 *
fw
, 
øã_idx
);

1632 
u8
 
iwl_mvm_mac80211_ac_to_ucode_ac
(
õì80211_ac_numbîs
 
ac
);

1633 
boﬁ
 
iwl_mvm_is_nic_ack_íabÀd
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1635 
ölöe
 
	$iwl_mvm_dump_nic_îr‹_log
(
iwl_mvm
 *
mvm
)

1637 
	`iwl_fwπ_dump_îr‹_logs
(&
mvm
->
fwπ
);

1638 
	}
}

1640 
u8
 
fú°_™ã¬a
(u8 
mask
);

1641 
u8
 
iwl_mvm_√xt_™ã¬a
(
iwl_mvm
 *
mvm
, u8 
vÆid
, u8 
œ°_idx
);

1642 
iwl_mvm_gë_sync_time
(
iwl_mvm
 *
mvm
, 
˛ock_ty≥
, 
u32
 *
gp2
,

1643 
u64
 *
boŸtime
, 
ktime_t
 *
ªÆtime
);

1644 
u32
 
iwl_mvm_gë_sy°ime
(
iwl_mvm
 *
mvm
);

1647 
__mu°_check
 
iwl_mvm_£nd_cmd
(
iwl_mvm
 *
mvm
,

1648 
iwl_ho°_cmd
 *
cmd
);

1649 
__mu°_check
 
iwl_mvm_£nd_cmd_pdu
(
iwl_mvm
 *
mvm
, 
u32
 
id
,

1650 
u32
 
Êags
, 
u16
 
Àn
, c⁄° *
d©a
);

1651 
__mu°_check
 
iwl_mvm_£nd_cmd_°©us
(
iwl_mvm
 *
mvm
,

1652 
iwl_ho°_cmd
 *
cmd
,

1653 
u32
 *
°©us
);

1654 
__mu°_check
 
iwl_mvm_£nd_cmd_pdu_°©us
(
iwl_mvm
 *
mvm
, 
u32
 
id
,

1655 
u16
 
Àn
, c⁄° *
d©a
,

1656 
u32
 *
°©us
);

1657 
iwl_mvm_tx_skb_°a
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1658 
õì80211_°a
 *
°a
);

1659 
iwl_mvm_tx_skb_n⁄_°a
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
);

1660 
iwl_mvm_£t_tx_cmd
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1661 
iwl_tx_cmd
 *
tx_cmd
,

1662 
õì80211_tx_öfo
 *
öfo
, 
u8
 
°a_id
);

1663 
iwl_mvm_£t_tx_cmd_øã
(
iwl_mvm
 *
mvm
, 
iwl_tx_cmd
 *
tx_cmd
,

1664 
õì80211_tx_öfo
 *
öfo
,

1665 
õì80211_°a
 *
°a
, 
__À16
 
fc
);

1666 
iwl_mvm_mac_ôxq_xmô
(
õì80211_hw
 *
hw
, 
õì80211_txq
 *
txq
);

1667 
iwl_mvm_max_amsdu_size
(
iwl_mvm
 *
mvm
,

1668 
õì80211_°a
 *
°a
,

1669 
tid
);

1671 #ifde‡
CONFIG_IWLWIFI_DEBUG


1672 c⁄° *
iwl_mvm_gë_tx_Áû_ªas⁄
(
u32
 
°©us
);

1674 
ölöe
 c⁄° *
	$iwl_mvm_gë_tx_Áû_ªas⁄
(
u32
 
°©us
Ë{  ""; 
	}
}

1676 
iwl_mvm_Êush_tx_∑th
(
iwl_mvm
 *
mvm
, 
u32
 
tfd_msk
);

1677 
iwl_mvm_Êush_°a
(
iwl_mvm
 *
mvm
, 
u32
 
°a_id
, u32 
tfd_queue_mask
);

1678 
iwl_mvm_Êush_°a_tids
(
iwl_mvm
 *
mvm
, 
u32
 
°a_id
, 
u16
 
tids
);

1681 
__À32
 
iwl_mvm_gë_°a_htc_Êags
(
õì80211_°a
 *
°a
,

1682 
õì80211_lök_°a
 *
lök_°a
);

1683 
u8
 
iwl_mvm_gë_°a_u≠sd_acs
(
õì80211_°a
 *
°a
);

1684 
u32
 
iwl_mvm_gë_°a_ampdu_dís
(
õì80211_lök_°a
 *
lök_°a
,

1685 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1686 
u32
 *
_agg_size
);

1687 
iwl_mvm_£t_°a_pkt_ext
(
iwl_mvm
 *
mvm
,

1688 
õì80211_lök_°a
 *
lök_°a
,

1689 
iwl_he_pkt_ext_v2
 *
pkt_ext
);

1691 
iwl_mvm_async_h™dÀrs_purge
(
iwl_mvm
 *
mvm
);

1693 
ölöe
 
	$iwl_mvm_£t_tx_cmd_ccmp
(
õì80211_tx_öfo
 *
öfo
,

1694 
iwl_tx_cmd
 *
tx_cmd
)

1696 
õì80211_key_c⁄f
 *
keyc⁄f
 = 
öfo
->
c⁄åﬁ
.
hw_key
;

1698 
tx_cmd
->
£c_˘l
 = 
TX_CMD_SEC_CCM
;

1699 
	`mem˝y
(
tx_cmd
->
key
, 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

1700 
	}
}

1702 
ölöe
 
	$iwl_mvm_waô_f‹_async_h™dÀrs
(
iwl_mvm
 *
mvm
)

1704 
	`Êush_w‹k
(&
mvm
->
async_h™dÀrs_wk
);

1705 
	}
}

1708 
iwl_mvm_h™dÀ_rx_sy°em_›î_°©s
(
iwl_mvm
 *
mvm
,

1709 
iwl_rx_cmd_buf„r
 *
rxb
);

1710 
iwl_mvm_h™dÀ_rx_sy°em_›î_∑π1_°©s
(
iwl_mvm
 *
mvm
,

1711 
iwl_rx_cmd_buf„r
 *
rxb
);

1712 
ölöe
 

1713 
	$iwl_mvm_h™dÀ_rx_sy°em_íd_°©s_nŸif
(
iwl_mvm
 *
mvm
,

1714 
iwl_rx_cmd_buf„r
 *
rxb
)

1716 
	}
}

1718 
iwl_mvm_h™dÀ_rx_°©i°ics
(
iwl_mvm
 *
mvm
,

1719 
iwl_rx_∑ckë
 *
pkt
);

1720 
iwl_mvm_rx_°©i°ics
(
iwl_mvm
 *
mvm
,

1721 
iwl_rx_cmd_buf„r
 *
rxb
);

1722 
iwl_mvm_ªque°_°©i°ics
(
iwl_mvm
 *
mvm
, 
boﬁ
 
˛ór
);

1723 
iwl_mvm_accu_ødio_°©s
(
iwl_mvm
 *
mvm
);

1726 
iwl_nvm_öô
(
iwl_mvm
 *
mvm
);

1727 
iwl_mvm_lﬂd_nvm_to_nic
(
iwl_mvm
 *
mvm
);

1729 
ölöe
 
u8
 
	$iwl_mvm_gë_vÆid_tx_™t
(
iwl_mvm
 *
mvm
)

1731 
u8
 
tx_™t
 = 
mvm
->
fw
->
vÆid_tx_™t
;

1733 i‡(
mvm
->
nvm_d©a
 && mvm->nvm_d©a->
vÆid_tx_™t
)

1734 
tx_™t
 &
mvm
->
nvm_d©a
->
vÆid_tx_™t
;

1736 i‡(
mvm
->
£t_tx_™t
)

1737 
tx_™t
 &
mvm
->
£t_tx_™t
;

1739  
tx_™t
;

1740 
	}
}

1742 
ölöe
 
u8
 
	$iwl_mvm_gë_vÆid_rx_™t
(
iwl_mvm
 *
mvm
)

1744 
u8
 
rx_™t
 = 
mvm
->
fw
->
vÆid_tx_™t
;

1746 i‡(
mvm
->
nvm_d©a
 && mvm->nvm_d©a->
vÆid_rx_™t
)

1747 
rx_™t
 &
mvm
->
nvm_d©a
->
vÆid_tx_™t
;

1749 i‡(
mvm
->
£t_rx_™t
)

1750 
rx_™t
 &
mvm
->
£t_rx_™t
;

1752  
rx_™t
;

1754 
	}
}

1756 
ölöe
 
	$iwl_mvm_toggÀ_tx_™t
(
iwl_mvm
 *
mvm
, 
u8
 *
™t
)

1758 *
™t
 = 
	`iwl_mvm_√xt_™ã¬a
(
mvm
, 
	`iwl_mvm_gë_vÆid_tx_™t
(mvm), *ant);

1759 
	}
}

1761 
ölöe
 
u32
 
	$iwl_mvm_gë_phy_c⁄fig
(
iwl_mvm
 *
mvm
)

1763 
u32
 
phy_c⁄fig
 = ~(
FW_PHY_CFG_TX_CHAIN
 |

1764 
FW_PHY_CFG_RX_CHAIN
);

1765 
u32
 
vÆid_rx_™t
 = 
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
);

1766 
u32
 
vÆid_tx_™t
 = 
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
);

1768 
phy_c⁄fig
 |
vÆid_tx_™t
 << 
FW_PHY_CFG_TX_CHAIN_POS
 |

1769 
vÆid_rx_™t
 << 
FW_PHY_CFG_RX_CHAIN_POS
;

1771  
mvm
->
fw
->
phy_c⁄fig
 &Öhy_config;

1772 
	}
}

1774 
iwl_mvm_up
(
iwl_mvm
 *
mvm
);

1775 
iwl_mvm_lﬂd_d3_fw
(
iwl_mvm
 *
mvm
);

1777 
iwl_mvm_mac_£tup_ªgi°î
(
iwl_mvm
 *
mvm
);

1783 
iwl_mvm_rx_mq
(
iwl_›_mode
 *
›_mode
,

1784 
«pi_°ru˘
 *
«pi
,

1785 
iwl_rx_cmd_buf„r
 *
rxb
);

1786 
iwl_mvm_rx_rx_phy_cmd
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

1787 
iwl_mvm_rx_rx_mpdu
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

1788 
iwl_rx_cmd_buf„r
 *
rxb
);

1789 
iwl_mvm_rx_mpdu_mq
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

1790 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
);

1791 
iwl_mvm_rx_m⁄ô‹_no_d©a
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

1792 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
);

1793 
iwl_mvm_rx_‰ame_ªÀa£
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

1794 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
);

1795 
iwl_mvm_rx_b¨_‰ame_ªÀa£
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

1796 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
);

1797 
iwl_mvm_rx_queue_nŸif
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

1798 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
);

1799 
iwl_mvm_rx_tx_cmd
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

1800 
iwl_mvm_mfu_as£π_dump_nŸif
(
iwl_mvm
 *
mvm
,

1801 
iwl_rx_cmd_buf„r
 *
rxb
);

1802 
iwl_mvm_£nd_ªcovîy_cmd
(
iwl_mvm
 *
mvm
, 
u32
 
Êags
);

1803 
iwl_mvm_rx_ba_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

1804 
iwl_mvm_rx_™t_cou∂ög_nŸif
(
iwl_mvm
 *
mvm
,

1805 
iwl_rx_cmd_buf„r
 *
rxb
);

1806 
iwl_mvm_rx_fw_îr‹
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

1807 
iwl_mvm_rx_mfu¨t_nŸif
(
iwl_mvm
 *
mvm
,

1808 
iwl_rx_cmd_buf„r
 *
rxb
);

1809 
iwl_mvm_rx_sh¨ed_mem_cfg_nŸif
(
iwl_mvm
 *
mvm
,

1810 
iwl_rx_cmd_buf„r
 *
rxb
);

1813 
iwl_mvm_phy_˘xt
 *
iwl_mvm_gë_‰ì_phy_˘xt
(
iwl_mvm
 *
mvm
);

1814 
iwl_mvm_phy_˘xt_add
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
,

1815 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

1816 c⁄° 
cfg80211_ch™_def
 *
≠
,

1817 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
);

1818 
iwl_mvm_phy_˘xt_ch™ged
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
,

1819 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

1820 c⁄° 
cfg80211_ch™_def
 *
≠
,

1821 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
);

1822 
iwl_mvm_phy_˘xt_ªf
(
iwl_mvm
 *
mvm
,

1823 
iwl_mvm_phy_˘xt
 *
˘xt
);

1824 
iwl_mvm_phy_˘xt_uƒef
(
iwl_mvm
 *
mvm
,

1825 
iwl_mvm_phy_˘xt
 *
˘xt
);

1826 
iwl_mvm_phy_˘x_cou¡
(
iwl_mvm
 *
mvm
);

1827 
u8
 
iwl_mvm_gë_ch™√l_width
(c⁄° 
cfg80211_ch™_def
 *
ch™def
);

1828 
u8
 
iwl_mvm_gë_˘æ_pos
(c⁄° 
cfg80211_ch™_def
 *
ch™def
);

1829 
iwl_mvm_phy_£nd_æc
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
,

1830 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
);

1834 
iwl_mvm_¥ï¨e_mac_ªmovÆ
(
iwl_mvm
 *
mvm
,

1835 
õì80211_vif
 *
vif
);

1836 
iwl_mvm_£t_fw_basic_øãs
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1837 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1838 
__À32
 *
cck_øãs
, __À32 *
ofdm_øãs
);

1839 
iwl_mvm_£t_fw_¥Ÿe˘i⁄_Êags
(
iwl_mvm
 *
mvm
,

1840 
õì80211_vif
 *
vif
,

1841 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1842 
__À32
 *
¥Ÿe˘i⁄_Êags
, 
u32
 
ht_Êag
,

1843 
u32
 
tgg_Êag
);

1844 
iwl_mvm_£t_fw_qos_∑øms
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1845 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1846 
iwl_ac_qos
 *
ac
, 
__À32
 *
qos_Êags
);

1847 
boﬁ
 
iwl_mvm_£t_fw_mu_edˇ_∑øms
(
iwl_mvm
 *
mvm
,

1848 c⁄° 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
,

1849 
iwl_he_backoff_c⁄f
 *
åig_ba£d_txf
);

1850 
iwl_mvm_£t_fw_dtim_tbâ
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1851 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1852 
__À64
 *
dtim_tsf
, 
__À32
 *
dtim_time
,

1853 
__À32
 *
assoc_bóc⁄_¨rive_time
);

1854 
__À32
 
iwl_mac_˘xt_p2p_dev_has_exãnded_disc
(
iwl_mvm
 *
mvm
,

1855 
õì80211_vif
 *
vif
);

1856 
iwl_mvm_mac_˘xt_cmd_≠_£t_fûãr_Êags
(
iwl_mvm
 *
mvm
,

1857 
iwl_mvm_vif
 *
mvmvif
,

1858 
__À32
 *
fûãr_Êags
,

1859 
ac˚±_¥obe_ªq_Êag
,

1860 
ac˚±_bóc⁄_Êag
);

1861 
iwl_mvm_gë_mac_ty≥
(
õì80211_vif
 *
vif
);

1862 
__À32
 
iwl_mvm_mac_˘xt_cmd_p2p_°a_gë_›µs_˘wö
(
iwl_mvm
 *
mvm
,

1863 
õì80211_vif
 *
vif
);

1864 
u32
 
iwl_mvm_mac_˘xt_cmd_°a_gë_twt_pﬁicy
(
iwl_mvm
 *
mvm
,

1865 
õì80211_vif
 *
vif
);

1866 
iwl_mvm_mld_mac_˘xt_add
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1867 
iwl_mvm_mld_mac_˘xt_ch™ged
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1868 
boﬁ
 
f‹˚_assoc_off
);

1869 
iwl_mvm_mld_mac_˘xt_ªmove
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1870 
iwl_mvm_mac_˘xt_öô
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1871 
iwl_mvm_mac_˘xt_add
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1872 
iwl_mvm_mac_˘xt_ch™ged
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1873 
boﬁ
 
f‹˚_assoc_off
, c⁄° 
u8
 *
bssid_ovîride
);

1874 
iwl_mvm_mac_˘xt_ªmove
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1875 
iwl_mvm_mac_˘xt_bóc⁄_ch™ged
(
iwl_mvm
 *
mvm
,

1876 
õì80211_vif
 *
vif
,

1877 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

1878 
iwl_mvm_mac_˘xt_£nd_bóc⁄_cmd
(
iwl_mvm
 *
mvm
,

1879 
sk_buff
 *
bóc⁄
,

1880 *
d©a
, 
Àn
);

1881 
u8
 
iwl_mvm_mac_˘xt_gë_bóc⁄_øã
(
iwl_mvm
 *
mvm
,

1882 
õì80211_tx_öfo
 *
öfo
,

1883 
õì80211_vif
 *
vif
);

1884 
u8
 
iwl_mvm_mac_˘xt_gë_lowe°_øã
(
iwl_mvm
 *
mvm
,

1885 
õì80211_tx_öfo
 *
öfo
,

1886 
õì80211_vif
 *
vif
);

1887 
u16
 
iwl_mvm_mac_˘xt_gë_bóc⁄_Êags
(c⁄° 
iwl_fw
 *
fw
,

1888 
u8
 
øã_idx
);

1889 
iwl_mvm_mac_˘xt_£t_tim
(
iwl_mvm
 *
mvm
,

1890 
__À32
 *
tim_ödex
, __À32 *
tim_size
,

1891 
u8
 *
bóc⁄
, 
u32
 
‰ame_size
);

1892 
iwl_mvm_rx_bóc⁄_nŸif
(
iwl_mvm
 *
mvm
,

1893 
iwl_rx_cmd_buf„r
 *
rxb
);

1894 
iwl_mvm_rx_mis£d_bóc⁄s_nŸif
(
iwl_mvm
 *
mvm
,

1895 
iwl_rx_cmd_buf„r
 *
rxb
);

1896 
iwl_mvm_rx_°‹ed_bóc⁄_nŸif
(
iwl_mvm
 *
mvm
,

1897 
iwl_rx_cmd_buf„r
 *
rxb
);

1898 
iwl_mvm_mu_mimo_gΩ_nŸif
(
iwl_mvm
 *
mvm
,

1899 
iwl_rx_cmd_buf„r
 *
rxb
);

1900 
iwl_mvm_°a_pm_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

1901 
iwl_mvm_wödow_°©us_nŸif
(
iwl_mvm
 *
mvm
,

1902 
iwl_rx_cmd_buf„r
 *
rxb
);

1903 
iwl_mvm_mac_˘xt_ªˇlc_tsf_id
(
iwl_mvm
 *
mvm
,

1904 
õì80211_vif
 *
vif
);

1905 
iwl_mvm_¥obe_ª•_d©a_nŸif
(
iwl_mvm
 *
mvm
,

1906 
iwl_rx_cmd_buf„r
 *
rxb
);

1907 
iwl_mvm_rx_mis£d_v≠_nŸif
(
iwl_mvm
 *
mvm
,

1908 
iwl_rx_cmd_buf„r
 *
rxb
);

1909 
iwl_mvm_ch™√l_swôch_°¨t_nŸif
(
iwl_mvm
 *
mvm
,

1910 
iwl_rx_cmd_buf„r
 *
rxb
);

1911 
iwl_mvm_ch™√l_swôch_îr‹_nŸif
(
iwl_mvm
 *
mvm
,

1912 
iwl_rx_cmd_buf„r
 *
rxb
);

1914 
iwl_mvm_bödög_add_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1915 
iwl_mvm_bödög_ªmove_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

1916 
u32
 
iwl_mvm_gë_lmac_id
(
iwl_mvm
 *
mvm
, 
∆80211_b™d
 
b™d
);

1919 
iwl_mvm_£t_lök_m≠pög
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1920 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

1921 
iwl_mvm_add_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1922 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

1923 
iwl_mvm_lök_ch™ged
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1924 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1925 
u32
 
ch™ges
, 
boﬁ
 
a˘ive
);

1926 
iwl_mvm_un£t_lök_m≠pög
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1927 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

1928 
iwl_mvm_ªmove_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1929 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

1930 
iwl_mvm_dißbÀ_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1931 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

1934 
boﬁ
 
iwl_mvm_°¨t_≠_ibss_comm⁄
(
õì80211_hw
 *
hw
,

1935 
õì80211_vif
 *
vif
, *
ªt
);

1936 
iwl_mvm_°›_≠_ibss_comm⁄
(
iwl_mvm
 *
mvm
,

1937 
õì80211_vif
 *
vif
);

1940 
iwl_mvm_bss_öfo_ch™ged_°©i⁄_comm⁄
(
iwl_mvm
 *
mvm
,

1941 
õì80211_vif
 *
vif
,

1942 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

1943 
u64
 
ch™ges
);

1944 
iwl_mvm_bss_öfo_ch™ged_°©i⁄_assoc
(
iwl_mvm
 *
mvm
,

1945 
õì80211_vif
 *
vif
,

1946 
u64
 
ch™ges
);

1962 
	siwl_mvm_roc_›s
 {

1963 (*
	madd_aux_°a_f‹_hs20
)(
iwl_mvm
 *
	mmvm
, 
u32
 
	mlmac_id
);

1964 (*
	mlök
)(
iwl_mvm
 *
	mmvm
, 
õì80211_vif
 *
	mvif
);

1967 
iwl_mvm_roc_comm⁄
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

1968 
õì80211_ch™√l
 *
ch™√l
, 
duøti⁄
,

1969 
õì80211_roc_ty≥
 
ty≥
,

1970 c⁄° 
iwl_mvm_roc_›s
 *
›s
);

1971 
iwl_mvm_ˇn˚l_roc
(
õì80211_hw
 *
hw
,

1972 
õì80211_vif
 *
vif
);

1974 
iwl_mvm_¥Ÿe˘_assoc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1975 
u32
 
duøti⁄_ovîride
, 
lök_id
);

1978 
ölöe
 
size_t
 
	$iwl_mvm_quŸa_cmd_size
(
iwl_mvm
 *
mvm
)

1980  
	`iwl_mvm_has_quŸa_low_œãncy
(
mvm
) ?

1981 (
iwl_time_quŸa_cmd
) :

1982 (
iwl_time_quŸa_cmd_v1
);

1983 
	}
}

1985 
ölöe
 
iwl_time_quŸa_d©a


1986 *
	$iwl_mvm_quŸa_cmd_gë_quŸa
(
iwl_mvm
 *
mvm
,

1987 
iwl_time_quŸa_cmd
 *
cmd
,

1988 
i
)

1990 
iwl_time_quŸa_d©a_v1
 *
quŸas
;

1992 i‡(
	`iwl_mvm_has_quŸa_low_œãncy
(
mvm
))

1993  &
cmd
->
quŸas
[
i
];

1995 
quŸas
 = (
iwl_time_quŸa_d©a_v1
 *)
cmd
->quotas;

1996  (
iwl_time_quŸa_d©a
 *)&
quŸas
[
i
];

1997 
	}
}

1999 
iwl_mvm_upd©e_quŸas
(
iwl_mvm
 *
mvm
, 
boﬁ
 
f‹˚_u∂ﬂd
,

2000 
õì80211_vif
 *
dißbÀd_vif
);

2003 
iwl_mvm_ªg_sˇn_°¨t
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2004 
cfg80211_sˇn_ªque°
 *
ªq
,

2005 
õì80211_sˇn_õs
 *
õs
);

2006 
size_t
 
iwl_mvm_sˇn_size
(
iwl_mvm
 *
mvm
);

2007 
iwl_mvm_sˇn_°›
(
iwl_mvm
 *
mvm
, 
ty≥
, 
boﬁ
 
nŸify
);

2008 
iwl_mvm_max_sˇn_õ_Àn
(
iwl_mvm
 *
mvm
);

2009 
iwl_mvm_ªp‹t_sˇn_ab‹ãd
(
iwl_mvm
 *
mvm
);

2010 
iwl_mvm_sˇn_timeout_wk
(
w‹k_°ru˘
 *
w‹k
);

2013 
iwl_mvm_rx_lmac_sˇn_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

2014 
iwl_rx_cmd_buf„r
 *
rxb
);

2015 
iwl_mvm_rx_lmac_sˇn_ôî_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

2016 
iwl_rx_cmd_buf„r
 *
rxb
);

2017 
iwl_mvm_sched_sˇn_°¨t
(
iwl_mvm
 *
mvm
,

2018 
õì80211_vif
 *
vif
,

2019 
cfg80211_sched_sˇn_ªque°
 *
ªq
,

2020 
õì80211_sˇn_õs
 *
õs
,

2021 
ty≥
);

2022 
iwl_mvm_rx_sˇn_m©ch_found
(
iwl_mvm
 *
mvm
,

2023 
iwl_rx_cmd_buf„r
 *
rxb
);

2026 
iwl_mvm_c⁄fig_sˇn
(
iwl_mvm
 *
mvm
);

2027 
iwl_mvm_rx_umac_sˇn_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

2028 
iwl_rx_cmd_buf„r
 *
rxb
);

2029 
iwl_mvm_rx_umac_sˇn_ôî_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

2030 
iwl_rx_cmd_buf„r
 *
rxb
);

2033 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2034 
iwl_mvm_dbgfs_ªgi°î
(
iwl_mvm
 *
mvm
);

2035 
iwl_mvm_vif_add_debugfs
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
);

2036 
iwl_mvm_vif_dbgfs_add_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2037 
iwl_mvm_vif_dbgfs_rm_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2039 
ölöe
 
	$iwl_mvm_dbgfs_ªgi°î
(
iwl_mvm
 *
mvm
)

2041 
	}
}

2042 
ölöe
 

2043 
	$iwl_mvm_vif_dbgfs_add_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2045 
	}
}

2046 
ölöe
 

2047 
	$iwl_mvm_vif_dbgfs_rm_lök
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2049 
	}
}

2053 
iwl_mvm_£nd_lq_cmd
(
iwl_mvm
 *
mvm
, 
iwl_lq_cmd
 *
lq
);

2054 
iwl_mvm_upd©e_‰ame_°©s
(
iwl_mvm
 *
mvm
, 
u32
 
øã
, 
boﬁ
 
agg
);

2055 
rs_¥ëty_¥öt_øã_v1
(*
buf
, 
bufsz
, c⁄° 
u32
 
øã
);

2056 
rs_upd©e_œ°_rssi
(
iwl_mvm
 *
mvm
,

2057 
iwl_mvm_°a
 *
mvm°a
,

2058 
õì80211_rx_°©us
 *
rx_°©us
);

2061 
iwl_mvm_powî_upd©e_devi˚
(
iwl_mvm
 *
mvm
);

2062 
iwl_mvm_powî_upd©e_mac
(
iwl_mvm
 *
mvm
);

2063 
iwl_mvm_powî_upd©e_ps
(
iwl_mvm
 *
mvm
);

2064 
iwl_mvm_powî_mac_dbgfs_ªad
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2065 *
buf
, 
bufsz
);

2067 
iwl_mvm_powî_vif_assoc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2068 
iwl_mvm_powî_u≠sd_misbehavög_≠_nŸif
(
iwl_mvm
 *
mvm
,

2069 
iwl_rx_cmd_buf„r
 *
rxb
);

2071 #ifde‡
CONFIG_IWLWIFI_LEDS


2072 
iwl_mvm_Àds_öô
(
iwl_mvm
 *
mvm
);

2073 
iwl_mvm_Àds_exô
(
iwl_mvm
 *
mvm
);

2074 
iwl_mvm_Àds_sync
(
iwl_mvm
 *
mvm
);

2076 
ölöe
 
	$iwl_mvm_Àds_öô
(
iwl_mvm
 *
mvm
)

2079 
	}
}

2080 
ölöe
 
	$iwl_mvm_Àds_exô
(
iwl_mvm
 *
mvm
)

2082 
	}
}

2083 
ölöe
 
	$iwl_mvm_Àds_sync
(
iwl_mvm
 *
mvm
)

2085 
	}
}

2089 
iwl_mvm_su•íd
(
õì80211_hw
 *
hw
, 
cfg80211_wowœn
 *
wowœn
);

2090 
iwl_mvm_ªsume
(
õì80211_hw
 *
hw
);

2091 
iwl_mvm_£t_wakeup
(
õì80211_hw
 *
hw
, 
boﬁ
 
íabÀd
);

2092 
iwl_mvm_£t_ªkey_d©a
(
õì80211_hw
 *
hw
,

2093 
õì80211_vif
 *
vif
,

2094 
cfg80211_gtk_ªkey_d©a
 *
d©a
);

2095 
iwl_mvm_ùv6_addr_ch™ge
(
õì80211_hw
 *
hw
,

2096 
õì80211_vif
 *
vif
,

2097 
öë6_dev
 *
idev
);

2098 
iwl_mvm_£t_deÁu…_uniˇ°_key
(
õì80211_hw
 *
hw
,

2099 
õì80211_vif
 *
vif
, 
idx
);

2100 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_d3_ã°_›s
;

2101 #ifde‡
CONFIG_PM


2102 
iwl_mvm_£t_œ°_n⁄qos_£q
(
iwl_mvm
 *
mvm
,

2103 
õì80211_vif
 *
vif
);

2105 
ölöe
 

2106 
	$iwl_mvm_£t_œ°_n⁄qos_£q
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2108 
	}
}

2110 
iwl_mvm_£t_wowœn_qos_£q
(
iwl_mvm_°a
 *
mvm_≠_°a
,

2111 
iwl_wowœn_c⁄fig_cmd
 *
cmd
);

2112 
iwl_mvm_£nd_¥Ÿo_ofÊﬂd
(
iwl_mvm
 *
mvm
,

2113 
õì80211_vif
 *
vif
,

2114 
boﬁ
 
dißbÀ_ofÊﬂdög
,

2115 
boﬁ
 
ofÊﬂd_ns
,

2116 
u32
 
cmd_Êags
);

2119 
iwl_mvm_£nd_bt_öô_c⁄f
(
iwl_mvm
 *
mvm
);

2120 
iwl_mvm_rx_bt_c€x_nŸif
(
iwl_mvm
 *
mvm
,

2121 
iwl_rx_cmd_buf„r
 *
rxb
);

2122 
iwl_mvm_bt_rssi_evít
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2123 
õì80211_rssi_evít_d©a
);

2124 
iwl_mvm_bt_c€x_vif_ch™ge
(
iwl_mvm
 *
mvm
);

2125 
u16
 
iwl_mvm_c€x_agg_time_limô
(
iwl_mvm
 *
mvm
,

2126 
õì80211_°a
 *
°a
);

2127 
boﬁ
 
iwl_mvm_bt_c€x_is_mimo_Ælowed
(
iwl_mvm
 *
mvm
,

2128 
õì80211_°a
 *
°a
);

2129 
boﬁ
 
iwl_mvm_bt_c€x_is_™t_avaû
(
iwl_mvm
 *
mvm
, 
u8
 
™t
);

2130 
boﬁ
 
iwl_mvm_bt_c€x_is_sh¨ed_™t_avaû
(
iwl_mvm
 *
mvm
);

2131 
boﬁ
 
iwl_mvm_bt_c€x_is_çc_Ælowed
(
iwl_mvm
 *
mvm
,

2132 
∆80211_b™d
 
b™d
);

2133 
u8
 
iwl_mvm_bt_c€x_gë_sögÀ_™t_msk
(
iwl_mvm
 *
mvm
, u8 
íabÀd_™ts
);

2134 
u8
 
iwl_mvm_bt_c€x_tx_¥io
(
iwl_mvm
 *
mvm
, 
õì80211_hdr
 *
hdr
,

2135 
õì80211_tx_öfo
 *
öfo
, 
u8
 
ac
);

2136 
boﬁ
 
iwl_mvm_bt_c€x_ˇlcuœã_e§_mode
(
iwl_mvm
 *
mvm
,

2137 
õì80211_vif
 *
vif
,

2138 
lök_id
, 
¥im¨y_lök
);

2139 
iwl_mvm_bt_c€x_upd©e_vif_e§
(
iwl_mvm
 *
mvm
,

2140 
õì80211_vif
 *
vif
,

2141 
lök_id
);

2144 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2146 
iwl_mvm_bóc⁄_fûãr_debugfs_∑ømëîs
(
õì80211_vif
 *
vif
,

2147 
iwl_bóc⁄_fûãr_cmd
 *
cmd
);

2149 
ölöe
 

2150 
	$iwl_mvm_bóc⁄_fûãr_debugfs_∑ømëîs
(
õì80211_vif
 *
vif
,

2151 
iwl_bóc⁄_fûãr_cmd
 *
cmd
)

2152 {
	}
}

2154 
iwl_mvm_íabÀ_bóc⁄_fûãr
(
iwl_mvm
 *
mvm
,

2155 
õì80211_vif
 *
vif
);

2156 
iwl_mvm_dißbÀ_bóc⁄_fûãr
(
iwl_mvm
 *
mvm
,

2157 
õì80211_vif
 *
vif
);

2159 
iwl_mvm_upd©e_smps
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2160 
iwl_mvm_smps_ty≥_ªque°
 
ªq_ty≥
,

2161 
õì80211_smps_mode
 
smps_ªque°
,

2162 
lök_id
);

2164 
iwl_mvm_upd©e_smps_⁄_a˘ive_löks
(
iwl_mvm
 *
mvm
,

2165 
õì80211_vif
 *
vif
,

2166 
iwl_mvm_smps_ty≥_ªque°
 
ªq_ty≥
,

2167 
õì80211_smps_mode
 
smps_ªque°
);

2168 
boﬁ
 
iwl_mvm_rx_divîsôy_Ælowed
(
iwl_mvm
 *
mvm
,

2169 
iwl_mvm_phy_˘xt
 *
˘xt
);

2170 
iwl_mvm_upd©e_lök_smps
(
õì80211_vif
 *
vif
,

2171 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

2174 
iwl_mvm_upd©e_low_œãncy
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2175 
boﬁ
 
low_œãncy
,

2176 
iwl_mvm_low_œãncy_ˇu£
 
ˇu£
);

2178 
boﬁ
 
iwl_mvm_low_œãncy
(
iwl_mvm
 *
mvm
);

2179 
boﬁ
 
iwl_mvm_low_œãncy_b™d
(
iwl_mvm
 *
mvm
, 
∆80211_b™d
 
b™d
);

2180 
iwl_mvm_£nd_low_œãncy_cmd
(
iwl_mvm
 *
mvm
, 
boﬁ
 
low_œãncy
,

2181 
u16
 
mac_id
);

2184 
ölöe
 
boﬁ
 
	$iwl_mvm_vif_low_œãncy
(
iwl_mvm_vif
 *
mvmvif
)

2196  
mvmvif
->
low_œãncy_a˘uÆ
;

2197 
	}
}

2199 
ölöe


2200 
	$iwl_mvm_vif_£t_low_œãncy
(
iwl_mvm_vif
 *
mvmvif
, 
boﬁ
 
£t
,

2201 
iwl_mvm_low_œãncy_ˇu£
 
ˇu£
)

2203 
u8
 
√w_°©e
;

2205 i‡(
£t
)

2206 
mvmvif
->
low_œãncy
 |
ˇu£
;

2208 
mvmvif
->
low_œãncy
 &~
ˇu£
;

2214 i‡(
mvmvif
->
low_œãncy
 & 
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
 &&

2215 
ˇu£
 !
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
)

2218 i‡(
ˇu£
 =
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
 && 
£t
)

2222 
√w_°©e
 = !!(
mvmvif
->
low_œãncy
 &

2223 
LOW_LATENCY_DEBUGFS_FORCE
);

2228 
√w_°©e
 = !!(
mvmvif
->
low_œãncy
 &

2229 ~(
LOW_LATENCY_DEBUGFS_FORCE_ENABLE
 |

2230 
LOW_LATENCY_DEBUGFS_FORCE
));

2232 
mvmvif
->
low_œãncy_a˘uÆ
 = 
√w_°©e
;

2233 
	}
}

2238 
ölöe
 
u32
 
	$iwl_mvm_ÊushabÀ_queues
(
iwl_mvm
 *
mvm
)

2240  ((
	`BIT
(
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
) - 1) &

2241 ~
	`BIT
(
IWL_MVM_DQA_CMD_QUEUE
));

2242 
	}
}

2244 
iwl_mvm_°›_devi˚
(
iwl_mvm
 *
mvm
);

2247 
iwl_mvm_â_tx_backoff
(
iwl_mvm
 *
mvm
, 
u32
 
backoff
);

2248 
iwl_mvm_ãmp_nŸif
(
iwl_mvm
 *
mvm
,

2249 
iwl_rx_cmd_buf„r
 *
rxb
);

2250 
iwl_mvm_â_h™dÀr
(
iwl_mvm
 *
mvm
);

2251 
iwl_mvm_thîmÆ_öôülize
(
iwl_mvm
 *
mvm
, 
u32
 
mö_backoff
);

2252 
iwl_mvm_thîmÆ_exô
(
iwl_mvm
 *
mvm
);

2253 
iwl_mvm_£t_hw_˘kûl_°©e
(
iwl_mvm
 *
mvm
, 
boﬁ
 
°©e
);

2254 
iwl_mvm_gë_ãmp
(
iwl_mvm
 *
mvm
, 
s32
 *
ãmp
);

2255 
iwl_mvm_˘_kûl_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

2256 
iwl_mvm_íãr_˘kûl
(
iwl_mvm
 *
mvm
);

2257 
iwl_mvm_£nd_ãmp_ªp‹t_ths_cmd
(
iwl_mvm
 *
mvm
);

2258 
iwl_mvm_˘dp_comm™d
(
iwl_mvm
 *
mvm
, 
u32
 
›
, u32 
budgë
);

2260 #i‡
IS_ENABLED
(
CONFIG_IWLMEI
)

2263 
iwl_mvm_víd‹_cmds_ªgi°î
(
iwl_mvm
 *
mvm
);

2267 
ölöe
 
	$iwl_mvm_víd‹_cmds_ªgi°î
(
iwl_mvm
 *
mvm
Ë{
	}
}

2272 
iwl_mcc_upd©e_ª•_v8
 *

2273 
iwl_mvm_upd©e_mcc
(
iwl_mvm
 *
mvm
, c⁄° *
Æpha2
,

2274 
iwl_mcc_sour˚
 
§c_id
);

2275 
iwl_mvm_öô_mcc
(
iwl_mvm
 *
mvm
);

2276 
iwl_mvm_rx_chub_upd©e_mcc
(
iwl_mvm
 *
mvm
,

2277 
iwl_rx_cmd_buf„r
 *
rxb
);

2278 
õì80211_ªgdomaö
 *
iwl_mvm_gë_ªgdomaö
(
wùhy
 *wiphy,

2279 c⁄° *
Æpha2
,

2280 
iwl_mcc_sour˚
 
§c_id
,

2281 
boﬁ
 *
ch™ged
);

2282 
õì80211_ªgdomaö
 *
iwl_mvm_gë_cuºít_ªgdomaö
(
iwl_mvm
 *
mvm
,

2283 
boﬁ
 *
ch™ged
);

2284 
iwl_mvm_öô_fw_ªgd
(
iwl_mvm
 *
mvm
, 
boﬁ
 
f‹˚_ªgd_sync
);

2285 
iwl_mvm_upd©e_ch™ged_ªgdom
(
iwl_mvm
 *
mvm
);

2288 
iwl_mvm_sf_upd©e
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2289 
boﬁ
 
added_vif
);

2292 
iwl_mvm_·m_°¨t_ª•⁄dî
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2293 
õì80211_bss_c⁄f
 *
bss_c⁄f
);

2294 
iwl_mvm_·m_ª°¨t_ª•⁄dî
(
iwl_mvm
 *
mvm
,

2295 
õì80211_vif
 *
vif
,

2296 
õì80211_bss_c⁄f
 *
bss_c⁄f
);

2297 
iwl_mvm_·m_ª•⁄dî_°©s
(
iwl_mvm
 *
mvm
,

2298 
iwl_rx_cmd_buf„r
 *
rxb
);

2299 
iwl_mvm_·m_ª•_ªmove_∑¢_°a
(
iwl_mvm
 *
mvm
,

2300 
õì80211_vif
 *
vif
, 
u8
 *
addr
);

2301 
iwl_mvm_·m_ª•odî_add_∑¢_°a
(
iwl_mvm
 *
mvm
,

2302 
õì80211_vif
 *
vif
,

2303 
u8
 *
addr
, 
u32
 
cùhî
, u8 *
tk
, u32 
tk_Àn
,

2304 
u8
 *
h…k
, 
u32
 
h…k_Àn
);

2305 
iwl_mvm_·m_ª•⁄dî_˛ór
(
iwl_mvm
 *
mvm
,

2306 
õì80211_vif
 *
vif
);

2309 
iwl_mvm_·m_ª°¨t
(
iwl_mvm
 *
mvm
);

2310 
iwl_mvm_·m_ønge_ª•
(
iwl_mvm
 *
mvm
,

2311 
iwl_rx_cmd_buf„r
 *
rxb
);

2312 
iwl_mvm_·m_lc_nŸif
(
iwl_mvm
 *
mvm
,

2313 
iwl_rx_cmd_buf„r
 *
rxb
);

2314 
iwl_mvm_·m_°¨t
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2315 
cfg80211_pm§_ªque°
 *
ªque°
);

2316 
iwl_mvm_·m_ab‹t
(
iwl_mvm
 *
mvm
, 
cfg80211_pm§_ªque°
 *
ªq
);

2317 
iwl_mvm_·m_öôüt‹_smoŸh_c⁄fig
(
iwl_mvm
 *
mvm
);

2318 
iwl_mvm_·m_öôüt‹_smoŸh_°›
(
iwl_mvm
 *
mvm
);

2319 
iwl_mvm_·m_add_∑¢_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2320 
u8
 *
addr
, 
u32
 
cùhî
, u8 *
tk
, u32 
tk_Àn
,

2321 
u8
 *
h…k
, 
u32
 
h…k_Àn
);

2322 
iwl_mvm_·m_ªmove_∑¢_°a
(
iwl_mvm
 *
mvm
, 
u8
 *
addr
);

2330 
	#IWL_MVM_TDLS_FW_TID
 4

	)

2332 
iwl_mvm_tdls_°a_cou¡
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2333 
iwl_mvm_ã¨down_tdls_≥îs
(
iwl_mvm
 *
mvm
);

2334 
iwl_mvm_ªˇlc_tdls_°©e
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2335 
boﬁ
 
°a_added
);

2336 
iwl_mvm_mac_mgd_¥Ÿe˘_tdls_discovî
(
õì80211_hw
 *
hw
,

2337 
õì80211_vif
 *
vif
,

2338 
lök_id
);

2339 
iwl_mvm_tdls_ch™√l_swôch
(
õì80211_hw
 *
hw
,

2340 
õì80211_vif
 *
vif
,

2341 
õì80211_°a
 *
°a
, 
u8
 
›î_˛ass
,

2342 
cfg80211_ch™_def
 *
ch™def
,

2343 
sk_buff
 *
tm∂_skb
, 
u32
 
ch_sw_tm_õ
);

2344 
iwl_mvm_tdls_ªcv_ch™√l_swôch
(
õì80211_hw
 *
hw
,

2345 
õì80211_vif
 *
vif
,

2346 
õì80211_tdls_ch_sw_∑øms
 *
∑øms
);

2347 
iwl_mvm_tdls_ˇn˚l_ch™√l_swôch
(
õì80211_hw
 *
hw
,

2348 
õì80211_vif
 *
vif
,

2349 
õì80211_°a
 *
°a
);

2350 
iwl_mvm_rx_tdls_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
);

2351 
iwl_mvm_tdls_ch_swôch_w‹k
(
w‹k_°ru˘
 *
w‹k
);

2353 
iwl_mvm_sync_rx_queues_öã∫Æ
(
iwl_mvm
 *
mvm
,

2354 
iwl_mvm_rxq_nŸif_ty≥
 
ty≥
,

2355 
boﬁ
 
sync
,

2356 c⁄° *
d©a
, 
u32
 
size
);

2357 
õì80211_vif
 *
iwl_mvm_gë_bss_vif
(
iwl_mvm
 *
mvm
);

2358 
õì80211_vif
 *
iwl_mvm_gë_vif_by_macid
(
iwl_mvm
 *
mvm
, 
u32
 
macid
);

2359 
boﬁ
 
iwl_mvm_is_vif_assoc
(
iwl_mvm
 *
mvm
);

2361 
	#MVM_TCM_PERIOD_MSEC
 500

	)

2362 
	#MVM_TCM_PERIOD
 (
HZ
 * 
MVM_TCM_PERIOD_MSEC
 / 1000)

	)

2363 
	#MVM_LL_PERIOD
 (10 * 
HZ
)

	)

2364 
iwl_mvm_tcm_w‹k
(
w‹k_°ru˘
 *
w‹k
);

2365 
iwl_mvm_ªˇlc_tcm
(
iwl_mvm
 *
mvm
);

2366 
iwl_mvm_∑u£_tcm
(
iwl_mvm
 *
mvm
, 
boﬁ
 
wôh_ˇn˚l
);

2367 
iwl_mvm_ªsume_tcm
(
iwl_mvm
 *
mvm
);

2368 
iwl_mvm_tcm_add_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2369 
iwl_mvm_tcm_rm_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2370 
u8
 
iwl_mvm_tcm_lﬂd_≥r˚¡age
(
u32
 
aútime
, u32 
ñ≠£d
);

2372 
iwl_mvm_nic_ª°¨t
(
iwl_mvm
 *
mvm
, 
boﬁ
 
fw_îr‹
);

2373 
iwl_mvm_gë_wd_timeout
(
iwl_mvm
 *
mvm
,

2374 
õì80211_vif
 *
vif
,

2375 
boﬁ
 
tdls
, boﬁ 
cmd_q
);

2376 
iwl_mvm_c⁄√˘i⁄_loss
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2377 c⁄° *
îrmsg
);

2378 
iwl_mvm_evít_‰ame_timeout_ˇŒback
(
iwl_mvm
 *
mvm
,

2379 
õì80211_vif
 *
vif
,

2380 c⁄° 
õì80211_°a
 *
°a
,

2381 
u16
 
tid
);

2382 
iwl_mvm_mei_sˇn_fûãr_öô
(
iwl_mei_sˇn_fûãr
 *
mei_sˇn_fûãr
);

2384 
iwl_mvm_±p_öô
(
iwl_mvm
 *
mvm
);

2385 
iwl_mvm_±p_ªmove
(
iwl_mvm
 *
mvm
);

2386 
u64
 
iwl_mvm_±p_gë_adj_time
(
iwl_mvm
 *
mvm
, u64 
ba£_time
);

2387 
iwl_mvm_ßr_£À˘_¥ofûe
(
iwl_mvm
 *
mvm
, 
¥of_a
, 
¥of_b
);

2388 
iwl_mvm_gë_ßr_geo_¥ofûe
(
iwl_mvm
 *
mvm
);

2389 
iwl_mvm_µag_£nd_cmd
(
iwl_mvm
 *
mvm
);

2390 
iwl_mvm_gë_bios_èbÀs
(
iwl_mvm
 *
mvm
);

2391 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2392 
iwl_mvm_lök_°a_add_debugfs
(
õì80211_hw
 *
hw
,

2393 
õì80211_vif
 *
vif
,

2394 
õì80211_lök_°a
 *
lök_°a
,

2395 
díåy
 *
dú
);

2396 
iwl_mvm_lök_add_debugfs
(
õì80211_hw
 *
hw
,

2397 
õì80211_vif
 *
vif
,

2398 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

2399 
díåy
 *
dú
);

2403 
iwl_mvm_£c_key_add
(
iwl_mvm
 *
mvm
,

2404 
õì80211_vif
 *
vif
,

2405 
õì80211_°a
 *
°a
,

2406 
õì80211_key_c⁄f
 *
keyc⁄f
);

2407 
iwl_mvm_£c_key_dñ
(
iwl_mvm
 *
mvm
,

2408 
õì80211_vif
 *
vif
,

2409 
õì80211_°a
 *
°a
,

2410 
õì80211_key_c⁄f
 *
keyc⁄f
);

2411 
iwl_mvm_£c_key_dñ_∑¢
(
iwl_mvm
 *
mvm
,

2412 
õì80211_vif
 *
vif
,

2413 
u32
 
°a_mask
,

2414 
õì80211_key_c⁄f
 *
keyc⁄f
);

2415 
iwl_mvm_£c_key_ªmove_≠
(
iwl_mvm
 *
mvm
,

2416 
õì80211_vif
 *
vif
,

2417 
iwl_mvm_vif_lök_öfo
 *
lök
,

2418 
lök_id
);

2419 
iwl_mvm_mld_upd©e_°a_keys
(
iwl_mvm
 *
mvm
,

2420 
õì80211_vif
 *
vif
,

2421 
õì80211_°a
 *
°a
,

2422 
u32
 
ﬁd_°a_mask
,

2423 
u32
 
√w_°a_mask
);

2424 
iwl_mvm_mld_£nd_key
(
iwl_mvm
 *
mvm
, 
u32
 
°a_mask
, u32 
key_Êags
,

2425 
õì80211_key_c⁄f
 *
keyc⁄f
);

2426 
u32
 
iwl_mvm_gë_£c_Êags
(
iwl_mvm
 *
mvm
,

2427 
õì80211_vif
 *
vif
,

2428 
õì80211_°a
 *
°a
,

2429 
õì80211_key_c⁄f
 *
keyc⁄f
);

2431 
boﬁ
 
iwl_rfi_suµ‹ãd
(
iwl_mvm
 *
mvm
);

2432 
iwl_rfi_£nd_c⁄fig_cmd
(
iwl_mvm
 *
mvm
,

2433 
iwl_rfi_lut_íåy
 *
rfi_èbÀ
);

2434 
iwl_rfi_‰eq_èbÀ_ª•_cmd
 *
iwl_rfi_gë_‰eq_èbÀ
(
iwl_mvm
 *
mvm
);

2435 
iwl_rfi_dó˘iv©e_nŸif_h™dÀr
(
iwl_mvm
 *
mvm
,

2436 
iwl_rx_cmd_buf„r
 *
rxb
);

2438 
ölöe
 
u8
 
	$iwl_mvm_phy_b™d_‰om_∆80211
(
∆80211_b™d
 
b™d
)

2440 
b™d
) {

2441 
NL80211_BAND_2GHZ
:

2442  
PHY_BAND_24
;

2443 
NL80211_BAND_5GHZ
:

2444  
PHY_BAND_5
;

2445 
NL80211_BAND_6GHZ
:

2446  
PHY_BAND_6
;

2448 
	`WARN_ONCE
(1, "Unsuµ‹ãd b™d (%u)\n", 
b™d
);

2449  
PHY_BAND_5
;

2451 
	}
}

2454 
iwl_mvm_ch™√l_swôch_disc⁄√˘_wk
(
w‹k_°ru˘
 *
wk
);

2455 
iwl_mvm_po°_ch™√l_swôch
(
õì80211_hw
 *
hw
,

2456 
õì80211_vif
 *
vif
,

2457 
õì80211_bss_c⁄f
 *
lök
);

2473 
	siwl_mvm_swôch_vif_ch™˘x_›s
 {

2474 (*
	m__assign_vif_ch™˘x
)(
iwl_mvm
 *
	mmvm
,

2475 
õì80211_vif
 *
	mvif
,

2476 
õì80211_bss_c⁄f
 *
	mlök_c⁄f
,

2477 
õì80211_ch™˘x_c⁄f
 *
	m˘x
,

2478 
boﬁ
 
	mswôchög_ch™˘x
);

2479 (*
	m__u«ssign_vif_ch™˘x
)(
iwl_mvm
 *
	mmvm
,

2480 
õì80211_vif
 *
	mvif
,

2481 
õì80211_bss_c⁄f
 *
	mlök_c⁄f
,

2482 
õì80211_ch™˘x_c⁄f
 *
	m˘x
,

2483 
boﬁ
 
	mswôchög_ch™˘x
);

2487 
iwl_mvm_swôch_vif_ch™˘x_comm⁄
(
õì80211_hw
 *
hw
,

2488 
õì80211_vif_ch™˘x_swôch
 *
vifs
,

2489 
n_vifs
,

2490 
õì80211_ch™˘x_swôch_mode
 
mode
,

2491 c⁄° 
iwl_mvm_swôch_vif_ch™˘x_›s
 *
›s
);

2494 
ölöe
 
boﬁ
 
	$iwl_mvm_has_u…ø_hb_ch™√l
(
iwl_mvm
 *
mvm
)

2496  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2497 
IWL_UCODE_TLV_CAPA_ULTRA_HB_CHANNELS
);

2498 
	}
}

2500 
ölöe
 *
	$iwl_mvm_ch™_öfo_cmd_èû
(
iwl_mvm
 *
mvm
,

2501 
iwl_fw_ch™√l_öfo
 *
ci
)

2503  (
u8
 *)
ci
 + (
	`iwl_mvm_has_u…ø_hb_ch™√l
(
mvm
) ?

2504 (
iwl_fw_ch™√l_öfo
) :

2505 (
iwl_fw_ch™√l_öfo_v1
));

2506 
	}
}

2508 
ölöe
 
size_t
 
	$iwl_mvm_ch™_öfo_∑ddög
(
iwl_mvm
 *
mvm
)

2510  
	`iwl_mvm_has_u…ø_hb_ch™√l
(
mvm
) ? 0 :

2511 (
iwl_fw_ch™√l_öfo
) -

2512 (
iwl_fw_ch™√l_öfo_v1
);

2513 
	}
}

2515 
ölöe
 
	$iwl_mvm_£t_ch™_öfo
(
iwl_mvm
 *
mvm
,

2516 
iwl_fw_ch™√l_öfo
 *
ci
,

2517 
u32
 
ch™
, 
u8
 
b™d
, u8 
width
,

2518 
u8
 
˘æ_pos
)

2520 i‡(
	`iwl_mvm_has_u…ø_hb_ch™√l
(
mvm
)) {

2521 
ci
->
ch™√l
 = 
	`˝u_to_À32
(
ch™
);

2522 
ci
->
b™d
 = band;

2523 
ci
->
width
 = width;

2524 
ci
->
˘æ_pos
 = ctrl_pos;

2526 
iwl_fw_ch™√l_öfo_v1
 *
ci_v1
 =

2527 (
iwl_fw_ch™√l_öfo_v1
 *)
ci
;

2529 
ci_v1
->
ch™√l
 = 
ch™
;

2530 
ci_v1
->
b™d
 = band;

2531 
ci_v1
->
width
 = width;

2532 
ci_v1
->
˘æ_pos
 = ctrl_pos;

2534 
	}
}

2536 
ölöe
 

2537 
	$iwl_mvm_£t_ch™_öfo_ch™def
(
iwl_mvm
 *
mvm
,

2538 
iwl_fw_ch™√l_öfo
 *
ci
,

2539 c⁄° 
cfg80211_ch™_def
 *
ch™def
)

2541 
∆80211_b™d
 
b™d
 = 
ch™def
->
ch™
->band;

2543 
	`iwl_mvm_£t_ch™_öfo
(
mvm
, 
ci
, 
ch™def
->
ch™
->
hw_vÆue
,

2544 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
b™d
),

2545 
	`iwl_mvm_gë_ch™√l_width
(
ch™def
),

2546 
	`iwl_mvm_gë_˘æ_pos
(
ch™def
));

2547 
	}
}

2549 
ölöe
 
	$iwl_umac_sˇn_gë_max_¥ofûes
(c⁄° 
iwl_fw
 *
fw
)

2551 
u8
 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
fw
, 
SCAN_OFFLOAD_UPDATE_PROFILES_CMD
,

2552 
IWL_FW_CMD_VER_UNKNOWN
);

2553  (
vî
 =
IWL_FW_CMD_VER_UNKNOWN
 || ver < 3) ?

2554 
IWL_SCAN_MAX_PROFILES
 : 
IWL_SCAN_MAX_PROFILES_V2
;

2555 
	}
}

2557 
ölöe


2558 
iwl_loˇti⁄_cùhî
 
	$iwl_mvm_cùhî_to_loˇti⁄_cùhî
(
u32
 
cùhî
)

2560 
cùhî
) {

2561 
WLAN_CIPHER_SUITE_CCMP
:

2562  
IWL_LOCATION_CIPHER_CCMP_128
;

2563 
WLAN_CIPHER_SUITE_GCMP
:

2564  
IWL_LOCATION_CIPHER_GCMP_128
;

2565 
WLAN_CIPHER_SUITE_GCMP_256
:

2566  
IWL_LOCATION_CIPHER_GCMP_256
;

2568  
IWL_LOCATION_CIPHER_INVALID
;

2570 
	}
}

2572 
iwl_mvm_csme_c⁄n_öfo
 *
iwl_mvm_gë_csme_c⁄n_öfo
(
iwl_mvm
 *
mvm
);

2573 
ölöe
 
	$iwl_mvm_mei_gë_ow√rshù
(
iwl_mvm
 *
mvm
)

2575 i‡(
mvm
->
mei_ªgi°îed
)

2576  
	`iwl_mei_gë_ow√rshù
();

2578 
	}
}

2580 
ölöe
 
	$iwl_mvm_mei_tx_c›y_to_csme
(
iwl_mvm
 *
mvm
,

2581 
sk_buff
 *
skb
,

2582 
ivÀn
)

2584 i‡(
mvm
->
mei_ªgi°îed
)

2585 
	`iwl_mei_tx_c›y_to_csme
(
skb
, 
ivÀn
);

2586 
	}
}

2588 
ölöe
 
	$iwl_mvm_mei_ho°_dißssocüãd
(
iwl_mvm
 *
mvm
)

2590 i‡(
mvm
->
mei_ªgi°îed
)

2591 
	`iwl_mei_ho°_dißssocüãd
();

2592 
	}
}

2594 
ölöe
 
	$iwl_mvm_mei_devi˚_°©e
(
iwl_mvm
 *
mvm
, 
boﬁ
 
up
)

2596 i‡(
mvm
->
mei_ªgi°îed
)

2597 
	`iwl_mei_devi˚_°©e
(
up
);

2598 
	}
}

2600 
ölöe
 
	$iwl_mvm_mei_£t_sw_rfkûl_°©e
(
iwl_mvm
 *
mvm
)

2602 
boﬁ
 
sw_rfkûl
 =

2603 
mvm
->
hw_ªgi°îed
 ? 
	`rfkûl_so·_blocked
(mvm->
hw
->
wùhy
->
rfkûl
Ë: 
Ál£
;

2605 i‡(
mvm
->
mei_ªgi°îed
)

2606 
	`iwl_mei_£t_rfkûl_°©e
(
	`iwl_mvm_is_ødio_kûÀd
(
mvm
),

2607 
sw_rfkûl
);

2608 
	}
}

2610 
ölöe
 
boﬁ
 
	$iwl_mvm_mei_fûãr_sˇn
(
iwl_mvm
 *
mvm
,

2611 
sk_buff
 *
skb
)

2613 
õì80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

2615 i‡(
mvm
->
mei_sˇn_fûãr
.
is_mei_limôed_sˇn
 &&

2616 (
	`õì80211_is_¥obe_ª•
(
mgmt
->
‰ame_c⁄åﬁ
) ||

2617 
	`õì80211_is_bóc⁄
(
mgmt
->
‰ame_c⁄åﬁ
))) {

2618 
	`skb_queue_èû
(&
mvm
->
mei_sˇn_fûãr
.
sˇn_ªs
, 
skb
);

2619 
	`scheduÀ_w‹k
(&
mvm
->
mei_sˇn_fûãr
.
sˇn_w‹k
);

2620  
åue
;

2623  
Ál£
;

2624 
	}
}

2626 
iwl_mvm_£nd_rﬂmög_f‹biddí_evít
(
iwl_mvm
 *
mvm
,

2627 
õì80211_vif
 *
vif
,

2628 
boﬁ
 
f‹biddí
);

2631 
iwl_mvm_mac_tx
(
õì80211_hw
 *
hw
,

2632 
õì80211_tx_c⁄åﬁ
 *
c⁄åﬁ
, 
sk_buff
 *
skb
);

2633 
iwl_mvm_mac_wake_tx_queue
(
õì80211_hw
 *
hw
,

2634 
õì80211_txq
 *
txq
);

2636 
iwl_mvm_mac_ampdu_a˘i⁄
(
õì80211_hw
 *
hw
,

2637 
õì80211_vif
 *
vif
,

2638 
õì80211_ampdu_∑øms
 *
∑øms
);

2639 
iwl_mvm_›_gë_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 *
tx_™t
, u32 *
rx_™t
);

2640 
iwl_mvm_›_£t_™ã¬a
(
õì80211_hw
 *
hw
, 
u32
 
tx_™t
, u32 
rx_™t
);

2641 
iwl_mvm_mac_°¨t
(
õì80211_hw
 *
hw
);

2642 
iwl_mvm_mac_ªc⁄fig_com∂ëe
(
õì80211_hw
 *
hw
,

2643 
õì80211_ªc⁄fig_ty≥
 
ªc⁄fig_ty≥
);

2644 
iwl_mvm_mac_°›
(
õì80211_hw
 *
hw
);

2645 
ölöe
 
	$iwl_mvm_mac_c⁄fig
(
õì80211_hw
 *
hw
, 
u32
 
ch™ged
)

2647 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

2648 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

2650 
	}
}

2652 
u64
 
iwl_mvm_¥ï¨e_mu…iˇ°
(
õì80211_hw
 *
hw
,

2653 
√tdev_hw_addr_li°
 *
mc_li°
);

2655 
iwl_mvm_c⁄figuª_fûãr
(
õì80211_hw
 *
hw
,

2656 
ch™ged_Êags
,

2657 *
tŸÆ_Êags
, 
u64
 
mu…iˇ°
);

2658 
iwl_mvm_mac_hw_sˇn
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2659 
õì80211_sˇn_ªque°
 *
hw_ªq
);

2660 
iwl_mvm_mac_ˇn˚l_hw_sˇn
(
õì80211_hw
 *
hw
,

2661 
õì80211_vif
 *
vif
);

2662 
iwl_mvm_°a_¥e_rcu_ªmove
(
õì80211_hw
 *
hw
,

2663 
õì80211_vif
 *
vif
,

2664 
õì80211_°a
 *
°a
);

2665 
iwl_mvm_mac_°a_nŸify
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2666 
°a_nŸify_cmd
 
cmd
,

2667 
õì80211_°a
 *
°a
);

2669 
iwl_mvm_mac_Ælow_buf„ªd_‰ames
(
õì80211_hw
 *
hw
,

2670 
õì80211_°a
 *
°a
, 
u16
 
tids
,

2671 
num_‰ames
,

2672 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

2673 
boﬁ
 
m‹e_d©a
);

2675 
iwl_mvm_mac_ªÀa£_buf„ªd_‰ames
(
õì80211_hw
 *
hw
,

2676 
õì80211_°a
 *
°a
, 
u16
 
tids
,

2677 
num_‰ames
,

2678 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

2679 
boﬁ
 
m‹e_d©a
);

2680 
iwl_mvm_mac_£t_πs_thªshﬁd
(
õì80211_hw
 *
hw
, 
u32
 
vÆue
);

2681 
iwl_mvm_°a_rc_upd©e
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2682 
õì80211_°a
 *
°a
, 
u32
 
ch™ged
);

2683 
iwl_mvm_mac_mgd_¥ï¨e_tx
(
õì80211_hw
 *
hw
,

2684 
õì80211_vif
 *
vif
,

2685 
õì80211_¥ï_tx_öfo
 *
öfo
);

2686 
iwl_mvm_mac_mgd_com∂ëe_tx
(
õì80211_hw
 *
hw
,

2687 
õì80211_vif
 *
vif
,

2688 
õì80211_¥ï_tx_öfo
 *
öfo
);

2689 
iwl_mvm_mac_Êush
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2690 
u32
 
queues
, 
boﬁ
 
dr›
);

2691 
iwl_mvm_mac_Êush_°a
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2692 
õì80211_°a
 *
°a
);

2693 
iwl_mvm_mac_sched_sˇn_°¨t
(
õì80211_hw
 *
hw
,

2694 
õì80211_vif
 *
vif
,

2695 
cfg80211_sched_sˇn_ªque°
 *
ªq
,

2696 
õì80211_sˇn_õs
 *
õs
);

2697 
iwl_mvm_mac_sched_sˇn_°›
(
õì80211_hw
 *
hw
,

2698 
õì80211_vif
 *
vif
);

2699 
iwl_mvm_mac_£t_key
(
õì80211_hw
 *
hw
, 
£t_key_cmd
 
cmd
,

2700 
õì80211_vif
 *
vif
, 
õì80211_°a
 *
°a
,

2701 
õì80211_key_c⁄f
 *
key
);

2702 
iwl_mvm_mac_upd©e_tkù_key
(
õì80211_hw
 *
hw
,

2703 
õì80211_vif
 *
vif
,

2704 
õì80211_key_c⁄f
 *
keyc⁄f
,

2705 
õì80211_°a
 *
°a
,

2706 
u32
 
iv32
, 
u16
 *
pha£1key
);

2707 
iwl_mvm_add_ch™˘x
(
õì80211_hw
 *
hw
,

2708 
õì80211_ch™˘x_c⁄f
 *
˘x
);

2709 
iwl_mvm_ªmove_ch™˘x
(
õì80211_hw
 *
hw
,

2710 
õì80211_ch™˘x_c⁄f
 *
˘x
);

2711 
iwl_mvm_ch™ge_ch™˘x
(
õì80211_hw
 *
hw
,

2712 
õì80211_ch™˘x_c⁄f
 *
˘x
, 
u32
 
ch™ged
);

2713 
iwl_mvm_tx_œ°_bóc⁄
(
õì80211_hw
 *
hw
);

2714 
iwl_mvm_ch™√l_swôch
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2715 
õì80211_ch™√l_swôch
 *
chsw
);

2716 
iwl_mvm_¥e_ch™√l_swôch
(
õì80211_hw
 *
hw
,

2717 
õì80211_vif
 *
vif
,

2718 
õì80211_ch™√l_swôch
 *
chsw
);

2719 
iwl_mvm_ab‹t_ch™√l_swôch
(
õì80211_hw
 *
hw
,

2720 
õì80211_vif
 *
vif
,

2721 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

2722 
iwl_mvm_ch™√l_swôch_rx_bóc⁄
(
õì80211_hw
 *
hw
,

2723 
õì80211_vif
 *
vif
,

2724 
õì80211_ch™√l_swôch
 *
chsw
);

2725 
iwl_mvm_mac_evít_ˇŒback
(
õì80211_hw
 *
hw
,

2726 
õì80211_vif
 *
vif
,

2727 c⁄° 
õì80211_evít
 *
evít
);

2728 
iwl_mvm_sync_rx_queues
(
õì80211_hw
 *
hw
);

2729 
iwl_mvm_mac_ã°mode_cmd
(
õì80211_hw
 *
hw
,

2730 
õì80211_vif
 *
vif
,

2731 *
d©a
, 
Àn
);

2732 
iwl_mvm_mac_gë_survey
(
õì80211_hw
 *
hw
, 
idx
,

2733 
survey_öfo
 *
survey
);

2734 
iwl_mvm_mac_°a_°©i°ics
(
õì80211_hw
 *
hw
,

2735 
õì80211_vif
 *
vif
,

2736 
õì80211_°a
 *
°a
,

2737 
°©i⁄_öfo
 *
söfo
);

2739 
iwl_mvm_mac_gë_·m_ª•⁄dî_°©s
(
õì80211_hw
 *
hw
,

2740 
õì80211_vif
 *
vif
,

2741 
cfg80211_·m_ª•⁄dî_°©s
 *
°©s
);

2742 
iwl_mvm_°¨t_pm§
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2743 
cfg80211_pm§_ªque°
 *
ªque°
);

2744 
iwl_mvm_ab‹t_pm§
(
õì80211_hw
 *
hw
, 
õì80211_vif
 *
vif
,

2745 
cfg80211_pm§_ªque°
 *
ªque°
);

2747 
boﬁ
 
iwl_mvm_have_löks_ßme_ch™√l
(
iwl_mvm_vif
 *
vif1
,

2748 
iwl_mvm_vif
 *
vif2
);

2749 
boﬁ
 
iwl_mvm_vif_is_a˘ive
(
iwl_mvm_vif
 *
mvmvif
);

2750 
iwl_mvm_£t_tx_powî
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2751 
s16
 
tx_powî
);

2752 
iwl_mvm_£t_hw_time°amp
(
õì80211_hw
 *
hw
,

2753 
õì80211_vif
 *
vif
,

2754 
cfg80211_£t_hw_time°amp
 *
hwts
);

2755 
iwl_mvm_upd©e_mu_groups
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

2756 
boﬁ
 
iwl_mvm_íabÀ_fûs
(
iwl_mvm
 *
mvm
,

2757 
õì80211_ch™˘x_c⁄f
 *
˘x
);

2758 
iwl_mvm_mld_£À˘_löks
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2759 
boﬁ
 
vÆid_löks_ch™ged
);

2760 
iwl_mvm_mld_gë_¥im¨y_lök
(
iwl_mvm
 *
mvm
,

2761 
õì80211_vif
 *
vif
,

2762 
ußbÀ_löks
);

2764 
boﬁ
 
iwl_mvm_is_·m_ª•⁄dî_ch™˘x
(
iwl_mvm
 *
mvm
,

2765 
õì80211_ch™˘x_c⁄f
 *
˘x
);

2767 
ölöe
 
cfg80211_ch™_def
 *

2768 
	$iwl_mvm_ch™˘x_def
(
iwl_mvm
 *
mvm
, 
õì80211_ch™˘x_c⁄f
 *
˘x
)

2770 
boﬁ
 
u£_def
 = 
	`iwl_mvm_is_·m_ª•⁄dî_ch™˘x
(
mvm
, 
˘x
) ||

2771 
	`iwl_mvm_íabÀ_fûs
(
mvm
, 
˘x
);

2773  
u£_def
 ? &
˘x
->
def
 : &˘x->
mö_def
;

2774 
	}
}

2776 
iwl_mvm_roc_duøti⁄_™d_dñay
(
õì80211_vif
 *
vif
,

2777 
u32
 
duøti⁄_ms
,

2778 
u32
 *
duøti⁄_tu
,

2779 
u32
 *
dñay
);

2780 
iwl_mvm_roc_add_cmd
(
iwl_mvm
 *
mvm
,

2781 
õì80211_ch™√l
 *
ch™√l
,

2782 
õì80211_vif
 *
vif
,

2783 
duøti⁄
, 
u32
 
a˘ivôy
);

	@mvm/nvm.c

7 
	~<löux/fúmw¨e.h
>

8 
	~<löux/π√éök.h
>

9 
	~"iwl-å™s.h
"

10 
	~"iwl-c§.h
"

11 
	~"mvm.h
"

12 
	~"iwl-ì¥om-∑r£.h
"

13 
	~"iwl-ì¥om-ªad.h
"

14 
	~"iwl-nvm-∑r£.h
"

15 
	~"iwl-¥ph.h
"

16 
	~"fw/a˝i.h
"

19 
	#IWL_NVM_DEFAULT_CHUNK_SIZE
 (2 * 1024)

	)

21 
	#NVM_WRITE_OPCODE
 1

	)

22 
	#NVM_READ_OPCODE
 0

	)

26 
	mREAD_NVM_CHUNK_SUCCEED
 = 0,

27 
	mREAD_NVM_CHUNK_NOT_VALID_ADDRESS
 = 1

34 
	$iwl_nvm_wrôe_chunk
(
iwl_mvm
 *
mvm
, 
u16
 
£˘i⁄
,

35 
u16
 
off£t
, u16 
Àngth
, c⁄° 
u8
 *
d©a
)

37 
iwl_nvm_ac˚ss_cmd
 
nvm_ac˚ss_cmd
 = {

38 .
off£t
 = 
	`˝u_to_À16
(offset),

39 .
Àngth
 = 
	`˝u_to_À16
(length),

40 .
ty≥
 = 
	`˝u_to_À16
(
£˘i⁄
),

41 .
›_code
 = 
NVM_WRITE_OPCODE
,

43 
iwl_ho°_cmd
 
cmd
 = {

44 .
id
 = 
NVM_ACCESS_CMD
,

45 .
Àn
 = { (
iwl_nvm_ac˚ss_cmd
), 
Àngth
 },

46 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
,

47 .
d©a
 = { &
nvm_ac˚ss_cmd
, data },

49 .
d©aÊags
 = { 0, 
IWL_HCMD_DFL_DUP
 },

51 
iwl_rx_∑ckë
 *
pkt
;

52 
iwl_nvm_ac˚ss_ª•
 *
nvm_ª•
;

53 
ªt
;

55 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

56 i‡(
ªt
)

57  
ªt
;

59 
pkt
 = 
cmd
.
ª•_pkt
;

61 
nvm_ª•
 = (*)
pkt
->
d©a
;

62 i‡(
	`À16_to_˝u
(
nvm_ª•
->
°©us
Ë!
READ_NVM_CHUNK_SUCCEED
) {

63 
	`IWL_ERR
(
mvm
,

65 
£˘i⁄
, 
	`À16_to_˝u
(
nvm_ª•
->
°©us
));

66 
ªt
 = -
EIO
;

69 
	`iwl_‰ì_ª•
(&
cmd
);

70  
ªt
;

71 
	}
}

73 
	$iwl_nvm_ªad_chunk
(
iwl_mvm
 *
mvm
, 
u16
 
£˘i⁄
,

74 
u16
 
off£t
, u16 
Àngth
, 
u8
 *
d©a
)

76 
iwl_nvm_ac˚ss_cmd
 
nvm_ac˚ss_cmd
 = {

77 .
off£t
 = 
	`˝u_to_À16
(offset),

78 .
Àngth
 = 
	`˝u_to_À16
(length),

79 .
ty≥
 = 
	`˝u_to_À16
(
£˘i⁄
),

80 .
›_code
 = 
NVM_READ_OPCODE
,

82 
iwl_nvm_ac˚ss_ª•
 *
nvm_ª•
;

83 
iwl_rx_∑ckë
 *
pkt
;

84 
iwl_ho°_cmd
 
cmd
 = {

85 .
id
 = 
NVM_ACCESS_CMD
,

86 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
,

87 .
d©a
 = { &
nvm_ac˚ss_cmd
, },

89 
ªt
, 
byãs_ªad
, 
off£t_ªad
;

90 
u8
 *
ª•_d©a
;

92 
cmd
.
Àn
[0] = (
iwl_nvm_ac˚ss_cmd
);

94 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

95 i‡(
ªt
)

96  
ªt
;

98 
pkt
 = 
cmd
.
ª•_pkt
;

101 
nvm_ª•
 = (*)
pkt
->
d©a
;

102 
ªt
 = 
	`À16_to_˝u
(
nvm_ª•
->
°©us
);

103 
byãs_ªad
 = 
	`À16_to_˝u
(
nvm_ª•
->
Àngth
);

104 
off£t_ªad
 = 
	`À16_to_˝u
(
nvm_ª•
->
off£t
);

105 
ª•_d©a
 = 
nvm_ª•
->
d©a
;

106 i‡(
ªt
) {

107 i‡((
off£t
 != 0) &&

108 (
ªt
 =
READ_NVM_CHUNK_NOT_VALID_ADDRESS
)) {

117 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
,

119 
off£t
);

120 
ªt
 = 0;

122 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
,

124 
ªt
, 
mvm
->
å™s
->
«me
);

125 
ªt
 = -
ENODATA
;

127 
exô
;

130 i‡(
off£t_ªad
 !
off£t
) {

131 
	`IWL_ERR
(
mvm
, "NVM ACCESSÑesponse with invalid offset %d\n",

132 
off£t_ªad
);

133 
ªt
 = -
EINVAL
;

134 
exô
;

138 
	`mem˝y
(
d©a
 + 
off£t
, 
ª•_d©a
, 
byãs_ªad
);

139 
ªt
 = 
byãs_ªad
;

141 
exô
:

142 
	`iwl_‰ì_ª•
(&
cmd
);

143  
ªt
;

144 
	}
}

146 
	$iwl_nvm_wrôe_£˘i⁄
(
iwl_mvm
 *
mvm
, 
u16
 
£˘i⁄
,

147 c⁄° 
u8
 *
d©a
, 
u16
 
Àngth
)

149 
off£t
 = 0;

153 
off£t
 < 
Àngth
) {

154 
chunk_size
, 
ªt
;

156 
chunk_size
 = 
	`mö
(
IWL_NVM_DEFAULT_CHUNK_SIZE
,

157 
Àngth
 - 
off£t
);

159 
ªt
 = 
	`iwl_nvm_wrôe_chunk
(
mvm
, 
£˘i⁄
, 
off£t
,

160 
chunk_size
, 
d©a
 + 
off£t
);

161 i‡(
ªt
 < 0)

162  
ªt
;

164 
off£t
 +
chunk_size
;

168 
	}
}

180 
	$iwl_nvm_ªad_£˘i⁄
(
iwl_mvm
 *
mvm
, 
u16
 
£˘i⁄
,

181 
u8
 *
d©a
, 
u32
 
size_ªad
)

183 
u16
 
Àngth
, 
off£t
 = 0;

184 
ªt
;

187 
Àngth
 = 
IWL_NVM_DEFAULT_CHUNK_SIZE
;

189 
ªt
 = 
Àngth
;

192 
ªt
 =
Àngth
) {

194 i‡((
size_ªad
 + 
off£t
 + 
Àngth
) >

195 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
ì¥om_size
) {

196 
	`IWL_ERR
(
mvm
, "EEPROM size isÅoo small for NVM\n");

197  -
ENOBUFS
;

200 
ªt
 = 
	`iwl_nvm_ªad_chunk
(
mvm
, 
£˘i⁄
, 
off£t
, 
Àngth
, 
d©a
);

201 i‡(
ªt
 < 0) {

202 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
,

204 
£˘i⁄
, 
off£t
, 
Àngth
);

205  
ªt
;

207 
off£t
 +
ªt
;

210 
	`iwl_nvm_fixups
(
mvm
->
å™s
->
hw_id
, 
£˘i⁄
, 
d©a
, 
off£t
);

212 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
,

213 "NVM se˘i⁄ %dÑód com∂ëed\n", 
£˘i⁄
);

214  
off£t
;

215 
	}
}

217 
iwl_nvm_d©a
 *

218 
	$iwl_∑r£_nvm_£˘i⁄s
(
iwl_mvm
 *
mvm
)

220 
iwl_nvm_£˘i⁄
 *
£˘i⁄s
 = 
mvm
->
nvm_£˘i⁄s
;

221 c⁄° 
__be16
 *
hw
;

222 c⁄° 
__À16
 *
sw
, *
ˇlib
, *
ªguœt‹y
, *
mac_ovîride
, *
phy_sku
;

223 
u8
 
tx_™t
 = 
mvm
->
fw
->
vÆid_tx_™t
;

224 
u8
 
rx_™t
 = 
mvm
->
fw
->
vÆid_rx_™t
;

225 
ªguœt‹y_ty≥
;

228 i‡(
mvm
->
å™s
->
cfg
->
nvm_ty≥
 =
IWL_NVM
) {

229 i‡(!
mvm
->
nvm_£˘i⁄s
[
NVM_SECTION_TYPE_SW
].
d©a
 ||

230 !
mvm
->
nvm_£˘i⁄s
[mvm->
cfg
->
nvm_hw_£˘i⁄_num
].
d©a
) {

231 
	`IWL_ERR
(
mvm
, "Can'tÖarseÉmpty OTP/NVM sections\n");

232  
NULL
;

235 i‡(
mvm
->
å™s
->
cfg
->
nvm_ty≥
 =
IWL_NVM_SDP
)

236 
ªguœt‹y_ty≥
 = 
NVM_SECTION_TYPE_REGULATORY_SDP
;

238 
ªguœt‹y_ty≥
 = 
NVM_SECTION_TYPE_REGULATORY
;

241 i‡(!
mvm
->
nvm_£˘i⁄s
[
NVM_SECTION_TYPE_SW
].
d©a
 ||

242 !
mvm
->
nvm_£˘i⁄s
[
ªguœt‹y_ty≥
].
d©a
) {

243 
	`IWL_ERR
(
mvm
,

245  
NULL
;

248 i‡(!
mvm
->
nvm_£˘i⁄s
[mvm->
cfg
->
nvm_hw_£˘i⁄_num
].
d©a
 &&

249 !
mvm
->
nvm_£˘i⁄s
[
NVM_SECTION_TYPE_MAC_OVERRIDE
].
d©a
) {

250 
	`IWL_ERR
(
mvm
,

252  
NULL
;

256 i‡(
mvm
->
å™s
->
cfg
->
nvm_ty≥
 =
IWL_NVM_EXT
 &&

257 !
mvm
->
nvm_£˘i⁄s
[
NVM_SECTION_TYPE_PHY_SKU
].
d©a
) {

258 
	`IWL_ERR
(
mvm
,

260  
NULL
;

264 
hw
 = (c⁄° 
__be16
 *)
£˘i⁄s
[
mvm
->
cfg
->
nvm_hw_£˘i⁄_num
].
d©a
;

265 
sw
 = (c⁄° 
__À16
 *)
£˘i⁄s
[
NVM_SECTION_TYPE_SW
].
d©a
;

266 
ˇlib
 = (c⁄° 
__À16
 *)
£˘i⁄s
[
NVM_SECTION_TYPE_CALIBRATION
].
d©a
;

267 
mac_ovîride
 =

268 (c⁄° 
__À16
 *)
£˘i⁄s
[
NVM_SECTION_TYPE_MAC_OVERRIDE
].
d©a
;

269 
phy_sku
 = (c⁄° 
__À16
 *)
£˘i⁄s
[
NVM_SECTION_TYPE_PHY_SKU
].
d©a
;

271 
ªguœt‹y
 = 
mvm
->
å™s
->
cfg
->
nvm_ty≥
 =
IWL_NVM_SDP
 ?

272 (c⁄° 
__À16
 *)
£˘i⁄s
[
NVM_SECTION_TYPE_REGULATORY_SDP
].
d©a
 :

273 (c⁄° 
__À16
 *)
£˘i⁄s
[
NVM_SECTION_TYPE_REGULATORY
].
d©a
;

275 i‡(
mvm
->
£t_tx_™t
)

276 
tx_™t
 &
mvm
->
£t_tx_™t
;

278 i‡(
mvm
->
£t_rx_™t
)

279 
rx_™t
 &
mvm
->
£t_rx_™t
;

281  
	`iwl_∑r£_nvm_d©a
(
mvm
->
å™s
, mvm->
cfg
, mvm->
fw
, 
hw
, 
sw
, 
ˇlib
,

282 
ªguœt‹y
, 
mac_ovîride
, 
phy_sku
,

283 
tx_™t
, 
rx_™t
);

284 
	}
}

287 
	$iwl_mvm_lﬂd_nvm_to_nic
(
iwl_mvm
 *
mvm
)

289 
i
, 
ªt
 = 0;

290 
iwl_nvm_£˘i⁄
 *
£˘i⁄s
 = 
mvm
->
nvm_£˘i⁄s
;

292 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
, "'WriteÅo NVM\n");

294 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvm
->
nvm_£˘i⁄s
); i++) {

295 i‡(!
mvm
->
nvm_£˘i⁄s
[
i
].
d©a
 || !mvm->nvm_£˘i⁄s[i].
Àngth
)

297 
ªt
 = 
	`iwl_nvm_wrôe_£˘i⁄
(
mvm
, 
i
, 
£˘i⁄s
[i].
d©a
,

298 
£˘i⁄s
[
i
].
Àngth
);

299 i‡(
ªt
 < 0) {

300 
	`IWL_ERR
(
mvm
, "iwl_mvm_£nd_cmd faûed: %d\n", 
ªt
);

304  
ªt
;

305 
	}
}

307 
	$iwl_nvm_öô
(
iwl_mvm
 *
mvm
)

309 
ªt
, 
£˘i⁄
;

310 
u32
 
size_ªad
 = 0;

311 
u8
 *
nvm_buf„r
, *
ãmp
;

312 c⁄° *
nvm_fûe_C
 = 
mvm
->
cfg
->
deÁu…_nvm_fûe_C_°ï
;

314 i‡(
	`WARN_ON_ONCE
(
mvm
->
cfg
->
nvm_hw_£˘i⁄_num
 >
NVM_MAX_NUM_SECTIONS
))

315  -
EINVAL
;

319 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
, "Read from NVM\n");

321 
nvm_buf„r
 = 
	`kmÆloc
(
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
ì¥om_size
,

322 
GFP_KERNEL
);

323 i‡(!
nvm_buf„r
)

324  -
ENOMEM
;

325 
£˘i⁄
 = 0; se˘i⁄ < 
NVM_MAX_NUM_SECTIONS
; section++) {

327 
ªt
 = 
	`iwl_nvm_ªad_£˘i⁄
(
mvm
, 
£˘i⁄
, 
nvm_buf„r
,

328 
size_ªad
);

329 i‡(
ªt
 =-
ENODATA
) {

330 
ªt
 = 0;

333 i‡(
ªt
 < 0)

335 
size_ªad
 +
ªt
;

336 
ãmp
 = 
	`kmemdup
(
nvm_buf„r
, 
ªt
, 
GFP_KERNEL
);

337 i‡(!
ãmp
) {

338 
ªt
 = -
ENOMEM
;

342 
	`iwl_nvm_fixups
(
mvm
->
å™s
->
hw_id
, 
£˘i⁄
, 
ãmp
, 
ªt
);

344 
mvm
->
nvm_£˘i⁄s
[
£˘i⁄
].
d©a
 = 
ãmp
;

345 
mvm
->
nvm_£˘i⁄s
[
£˘i⁄
].
Àngth
 = 
ªt
;

347 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


348 
£˘i⁄
) {

349 
NVM_SECTION_TYPE_SW
:

350 
mvm
->
nvm_sw_blob
.
d©a
 = 
ãmp
;

351 
mvm
->
nvm_sw_blob
.
size
 = 
ªt
;

353 
NVM_SECTION_TYPE_CALIBRATION
:

354 
mvm
->
nvm_ˇlib_blob
.
d©a
 = 
ãmp
;

355 
mvm
->
nvm_ˇlib_blob
.
size
 = 
ªt
;

357 
NVM_SECTION_TYPE_PRODUCTION
:

358 
mvm
->
nvm_¥od_blob
.
d©a
 = 
ãmp
;

359 
mvm
->
nvm_¥od_blob
.
size
 = 
ªt
;

361 
NVM_SECTION_TYPE_PHY_SKU
:

362 
mvm
->
nvm_phy_sku_blob
.
d©a
 = 
ãmp
;

363 
mvm
->
nvm_phy_sku_blob
.
size
 = 
ªt
;

365 
NVM_SECTION_TYPE_REGULATORY_SDP
:

366 
NVM_SECTION_TYPE_REGULATORY
:

367 
mvm
->
nvm_ªg_blob
.
d©a
 = 
ãmp
;

368 
mvm
->
nvm_ªg_blob
.
size
 = 
ªt
;

371 i‡(
£˘i⁄
 =
mvm
->
cfg
->
nvm_hw_£˘i⁄_num
) {

372 
mvm
->
nvm_hw_blob
.
d©a
 = 
ãmp
;

373 
mvm
->
nvm_hw_blob
.
size
 = 
ªt
;

379 i‡(!
size_ªad
)

380 
	`IWL_ERR
(
mvm
, "OTP is blank\n");

381 
	`k‰ì
(
nvm_buf„r
);

384 i‡(
mvm
->
nvm_fûe_«me
) {

386 
ªt
 = 
	`iwl_ªad_exã∫Æ_nvm
(
mvm
->
å™s
, mvm->
nvm_fûe_«me
,

387 
mvm
->
nvm_£˘i⁄s
);

388 i‡(
ªt
) {

389 
mvm
->
nvm_fûe_«me
 = 
nvm_fûe_C
;

391 i‡((
ªt
 =-
EFAULT
 ||Ñë =-
ENOENT
) &&

392 
mvm
->
nvm_fûe_«me
) {

394 
ªt
 = 
	`iwl_ªad_exã∫Æ_nvm
(
mvm
->
å™s
,

395 
mvm
->
nvm_fûe_«me
,

396 
mvm
->
nvm_£˘i⁄s
);

397 i‡(
ªt
)

398  
ªt
;

400  
ªt
;

406 
mvm
->
nvm_d©a
 = 
	`iwl_∑r£_nvm_£˘i⁄s
(mvm);

407 i‡(!
mvm
->
nvm_d©a
)

408  -
ENODATA
;

409 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
, "nvm version = %x\n",

410 
mvm
->
nvm_d©a
->
nvm_vîsi⁄
);

412  
ªt
 < 0 ?Ñet : 0;

413 
	}
}

415 
iwl_mcc_upd©e_ª•_v8
 *

416 
	$iwl_mvm_upd©e_mcc
(
iwl_mvm
 *
mvm
, c⁄° *
Æpha2
,

417 
iwl_mcc_sour˚
 
§c_id
)

419 
iwl_mcc_upd©e_cmd
 
mcc_upd©e_cmd
 = {

420 .
mcc
 = 
	`˝u_to_À16
(
Æpha2
[0] << 8 |álpha2[1]),

421 .
sour˚_id
 = (
u8
)
§c_id
,

423 
iwl_mcc_upd©e_ª•_v8
 *
ª•_˝
;

424 
iwl_rx_∑ckë
 *
pkt
;

425 
iwl_ho°_cmd
 
cmd
 = {

426 .
id
 = 
MCC_UPDATE_CMD
,

427 .
Êags
 = 
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
,

428 .
d©a
 = { &
mcc_upd©e_cmd
 },

431 
ªt
, 
ª•_vî
;

432 
u32
 
°©us
;

433 
ª•_Àn
, 
n_ch™√ls
;

434 
u16
 
mcc
;

436 i‡(
	`WARN_ON_ONCE
(!
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
)))

437  
	`ERR_PTR
(-
EOPNOTSUPP
);

439 
cmd
.
Àn
[0] = (
iwl_mcc_upd©e_cmd
);

441 
	`IWL_DEBUG_LAR
(
mvm
, "send MCC updateÅo FW with '%c%c' src = %d\n",

442 
Æpha2
[0],áÕha2[1], 
§c_id
);

444 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

445 i‡(
ªt
)

446  
	`ERR_PTR
(
ªt
);

448 
pkt
 = 
cmd
.
ª•_pkt
;

450 
ª•_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
IWL_ALWAYS_LONG_GROUP
,

451 
MCC_UPDATE_CMD
, 0);

454 i‡(
ª•_vî
 >= 8) {

455 
iwl_mcc_upd©e_ª•_v8
 *
mcc_ª•_v8
 = (*)
pkt
->
d©a
;

457 
n_ch™√ls
 = 
	`__À32_to_˝u
(
mcc_ª•_v8
->n_channels);

458 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
) !=

459 
	`°ru˘_size
(
mcc_ª•_v8
, 
ch™√ls
, 
n_ch™√ls
)) {

460 
ª•_˝
 = 
	`ERR_PTR
(-
EINVAL
);

461 
exô
;

463 
ª•_Àn
 = 
	`°ru˘_size
(
ª•_˝
, 
ch™√ls
, 
n_ch™√ls
);

464 
ª•_˝
 = 
	`kzÆloc
(
ª•_Àn
, 
GFP_KERNEL
);

465 i‡(!
ª•_˝
) {

466 
ª•_˝
 = 
	`ERR_PTR
(-
ENOMEM
);

467 
exô
;

469 
ª•_˝
->
°©us
 = 
mcc_ª•_v8
->status;

470 
ª•_˝
->
mcc
 = 
mcc_ª•_v8
->mcc;

471 
ª•_˝
->
ˇp
 = 
mcc_ª•_v8
->cap;

472 
ª•_˝
->
sour˚_id
 = 
mcc_ª•_v8
->source_id;

473 
ª•_˝
->
time
 = 
mcc_ª•_v8
->time;

474 
ª•_˝
->
geo_öfo
 = 
mcc_ª•_v8
->geo_info;

475 
ª•_˝
->
n_ch™√ls
 = 
mcc_ª•_v8
->n_channels;

476 
	`mem˝y
(
ª•_˝
->
ch™√ls
, 
mcc_ª•_v8
->channels,

477 
n_ch™√ls
 * (
__À32
));

478 } i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

479 
IWL_UCODE_TLV_CAPA_MCC_UPDATE_11AX_SUPPORT
)) {

480 
iwl_mcc_upd©e_ª•_v4
 *
mcc_ª•_v4
 = (*)
pkt
->
d©a
;

482 
n_ch™√ls
 = 
	`__À32_to_˝u
(
mcc_ª•_v4
->n_channels);

483 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
) !=

484 
	`°ru˘_size
(
mcc_ª•_v4
, 
ch™√ls
, 
n_ch™√ls
)) {

485 
ª•_˝
 = 
	`ERR_PTR
(-
EINVAL
);

486 
exô
;

488 
ª•_Àn
 = 
	`°ru˘_size
(
ª•_˝
, 
ch™√ls
, 
n_ch™√ls
);

489 
ª•_˝
 = 
	`kzÆloc
(
ª•_Àn
, 
GFP_KERNEL
);

490 i‡(!
ª•_˝
) {

491 
ª•_˝
 = 
	`ERR_PTR
(-
ENOMEM
);

492 
exô
;

495 
ª•_˝
->
°©us
 = 
mcc_ª•_v4
->status;

496 
ª•_˝
->
mcc
 = 
mcc_ª•_v4
->mcc;

497 
ª•_˝
->
ˇp
 = 
	`˝u_to_À32
(
	`À16_to_˝u
(
mcc_ª•_v4
->cap));

498 
ª•_˝
->
sour˚_id
 = 
mcc_ª•_v4
->source_id;

499 
ª•_˝
->
time
 = 
mcc_ª•_v4
->time;

500 
ª•_˝
->
geo_öfo
 = 
mcc_ª•_v4
->geo_info;

501 
ª•_˝
->
n_ch™√ls
 = 
mcc_ª•_v4
->n_channels;

502 
	`mem˝y
(
ª•_˝
->
ch™√ls
, 
mcc_ª•_v4
->channels,

503 
n_ch™√ls
 * (
__À32
));

505 
iwl_mcc_upd©e_ª•_v3
 *
mcc_ª•_v3
 = (*)
pkt
->
d©a
;

507 
n_ch™√ls
 = 
	`__À32_to_˝u
(
mcc_ª•_v3
->n_channels);

508 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
) !=

509 
	`°ru˘_size
(
mcc_ª•_v3
, 
ch™√ls
, 
n_ch™√ls
)) {

510 
ª•_˝
 = 
	`ERR_PTR
(-
EINVAL
);

511 
exô
;

513 
ª•_Àn
 = 
	`°ru˘_size
(
ª•_˝
, 
ch™√ls
, 
n_ch™√ls
);

514 
ª•_˝
 = 
	`kzÆloc
(
ª•_Àn
, 
GFP_KERNEL
);

515 i‡(!
ª•_˝
) {

516 
ª•_˝
 = 
	`ERR_PTR
(-
ENOMEM
);

517 
exô
;

520 
ª•_˝
->
°©us
 = 
mcc_ª•_v3
->status;

521 
ª•_˝
->
mcc
 = 
mcc_ª•_v3
->mcc;

522 
ª•_˝
->
ˇp
 = 
	`˝u_to_À32
(
mcc_ª•_v3
->cap);

523 
ª•_˝
->
sour˚_id
 = 
mcc_ª•_v3
->source_id;

524 
ª•_˝
->
time
 = 
mcc_ª•_v3
->time;

525 
ª•_˝
->
geo_öfo
 = 
mcc_ª•_v3
->geo_info;

526 
ª•_˝
->
n_ch™√ls
 = 
mcc_ª•_v3
->n_channels;

527 
	`mem˝y
(
ª•_˝
->
ch™√ls
, 
mcc_ª•_v3
->channels,

528 
n_ch™√ls
 * (
__À32
));

531 
°©us
 = 
	`À32_to_˝u
(
ª•_˝
->status);

533 
mcc
 = 
	`À16_to_˝u
(
ª•_˝
->mcc);

536 i‡(
mcc
 == 0) {

537 
mcc
 = 0x3030;

538 
ª•_˝
->
mcc
 = 
	`˝u_to_À16
(mcc);

541 
	`IWL_DEBUG_LAR
(
mvm
,

543 
°©us
, 
mcc
, mc¯>> 8, mc¯& 0xff, 
n_ch™√ls
);

545 
exô
:

546 
	`iwl_‰ì_ª•
(&
cmd
);

547  
ª•_˝
;

548 
	}
}

550 
	$iwl_mvm_öô_mcc
(
iwl_mvm
 *
mvm
)

552 
boﬁ
 
év_œr
;

553 
boﬁ
 
nvm_œr
;

554 
ªtvÆ
;

555 
õì80211_ªgdomaö
 *
ªgd
;

556 
mcc
[3];

558 i‡(
mvm
->
cfg
->
nvm_ty≥
 =
IWL_NVM_EXT
) {

559 
év_œr
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

560 
IWL_UCODE_TLV_CAPA_LAR_SUPPORT
);

561 
nvm_œr
 = 
mvm
->
nvm_d©a
->
œr_íabÀd
;

562 i‡(
év_œr
 !
nvm_œr
)

563 
	`IWL_INFO
(
mvm
,

565 
év_œr
 ? "enabled" : "disabled",

566 
nvm_œr
 ? "enabled" : "disabled");

569 i‡(!
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
))

576 
ªtvÆ
 = 
	`iwl_mvm_öô_fw_ªgd
(
mvm
, 
åue
);

577 i‡(
ªtvÆ
 !-
ENOENT
)

578  
ªtvÆ
;

586 
mvm
->
œr_ªgdom_£t
 = 
Ál£
;

588 
ªgd
 = 
	`iwl_mvm_gë_cuºít_ªgdomaö
(
mvm
, 
NULL
);

589 i‡(
	`IS_ERR_OR_NULL
(
ªgd
))

590  -
EIO
;

592 i‡(
	`iwl_mvm_is_wifi_mcc_suµ‹ãd
(
mvm
) &&

593 !
	`iwl_bios_gë_mcc
(&
mvm
->
fwπ
, 
mcc
)) {

594 
	`k‰ì
(
ªgd
);

595 
ªgd
 = 
	`iwl_mvm_gë_ªgdomaö
(
mvm
->
hw
->
wùhy
, 
mcc
,

596 
MCC_SOURCE_BIOS
, 
NULL
);

597 i‡(
	`IS_ERR_OR_NULL
(
ªgd
))

598  -
EIO
;

601 
ªtvÆ
 = 
	`ªguœt‹y_£t_wùhy_ªgd_sync
(
mvm
->
hw
->
wùhy
, 
ªgd
);

602 
	`k‰ì
(
ªgd
);

603  
ªtvÆ
;

604 
	}
}

606 
	$iwl_mvm_rx_chub_upd©e_mcc
(
iwl_mvm
 *
mvm
,

607 
iwl_rx_cmd_buf„r
 *
rxb
)

609 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

610 
iwl_mcc_chub_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

611 
iwl_mcc_sour˚
 
§c
;

612 
mcc
[3];

613 
õì80211_ªgdomaö
 *
ªgd
;

614 
wgds_tbl_idx
;

616 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

618 i‡(
	`iwl_mvm_is_vif_assoc
(
mvm
Ë&& 
nŸif
->
sour˚_id
 =
MCC_SOURCE_WIFI
) {

619 
	`IWL_DEBUG_LAR
(
mvm
, "Ignore mcc update whileássociated\n");

623 i‡(
	`WARN_ON_ONCE
(!
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
)))

626 
mcc
[0] = 
	`À16_to_˝u
(
nŸif
->mcc) >> 8;

627 
mcc
[1] = 
	`À16_to_˝u
(
nŸif
->mcc) & 0xff;

628 
mcc
[2] = '\0';

629 
§c
 = 
nŸif
->
sour˚_id
;

631 
	`IWL_DEBUG_LAR
(
mvm
,

633 
mcc
, 
§c
);

634 
ªgd
 = 
	`iwl_mvm_gë_ªgdomaö
(
mvm
->
hw
->
wùhy
, 
mcc
, 
§c
, 
NULL
);

635 i‡(
	`IS_ERR_OR_NULL
(
ªgd
))

638 
wgds_tbl_idx
 = 
	`iwl_mvm_gë_ßr_geo_¥ofûe
(
mvm
);

639 i‡(
wgds_tbl_idx
 < 1)

640 
	`IWL_DEBUG_INFO
(
mvm
,

642 
wgds_tbl_idx
);

644 
	`IWL_DEBUG_INFO
(
mvm
, "SAR WGDS: geoÖrofile %d is configured\n",

645 
wgds_tbl_idx
);

647 
	`ªguœt‹y_£t_wùhy_ªgd
(
mvm
->
hw
->
wùhy
, 
ªgd
);

648 
	`k‰ì
(
ªgd
);

649 
	}
}

	@mvm/offloading.c

7 
	~<√t/ùv6.h
>

8 
	~<√t/addrc⁄f.h
>

9 
	~<löux/bô›s.h
>

10 
	~"mvm.h
"

12 
	$iwl_mvm_£t_wowœn_qos_£q
(
iwl_mvm_°a
 *
mvm_≠_°a
,

13 
iwl_wowœn_c⁄fig_cmd
 *
cmd
)

15 
i
;

22 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

23 
u16
 
£q
 = 
mvm_≠_°a
->
tid_d©a
[
i
].
£q_numbî
;

24 
£q
 -= 0x10;

25 
cmd
->
qos_£q
[
i
] = 
	`˝u_to_À16
(
£q
);

27 
	}
}

29 
	$iwl_mvm_£nd_¥Ÿo_ofÊﬂd
(
iwl_mvm
 *
mvm
,

30 
õì80211_vif
 *
vif
,

31 
boﬁ
 
dißbÀ_ofÊﬂdög
,

32 
boﬁ
 
ofÊﬂd_ns
,

33 
u32
 
cmd_Êags
)

36 
iwl_¥Ÿo_ofÊﬂd_cmd_v1
 
v1
;

37 
iwl_¥Ÿo_ofÊﬂd_cmd_v2
 
v2
;

38 
iwl_¥Ÿo_ofÊﬂd_cmd_v3_smÆl
 
v3s
;

39 
iwl_¥Ÿo_ofÊﬂd_cmd_v4
 
v4
;

40 } 
cmd
 = {};

41 
iwl_ho°_cmd
 
hcmd
 = {

42 .
id
 = 
PROT_OFFLOAD_CONFIG_CMD
,

43 .
Êags
 = 
cmd_Êags
,

44 .
d©a
[0] = &
cmd
,

45 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

47 
iwl_¥Ÿo_ofÊﬂd_cmd_comm⁄
 *
comm⁄
;

48 
u32
 
íabÀd
 = 0, 
size
;

49 
u32
 
ˇ∑_Êags
 = 
mvm
->
fw
->
ucode_ˇ∑
.
Êags
;

50 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
hcmd
.
id
, 0);

52 #i‡
	`IS_ENABLED
(
CONFIG_IPV6
)

53 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

54 
i
;

61 
boﬁ
 
skù_ã¡©ive
 = 
ofÊﬂd_ns
;

63 i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEW_NSOFFL_SMALL
 ||

64 
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEW_NSOFFL_LARGE
) {

65 
iwl_ns_c⁄fig
 *
nsc
;

66 
iwl_èrg_addr
 *
addrs
;

67 
n_nsc
, 
n_addrs
;

68 
c
;

69 
num_skù≥d
 = 0;

71 i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEW_NSOFFL_SMALL
) {

72 
nsc
 = 
cmd
.
v3s
.
ns_c⁄fig
;

73 
n_nsc
 = 
IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3S
;

74 
addrs
 = 
cmd
.
v3s
.
èrg_addrs
;

75 
n_addrs
 = 
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3S
;

77 
nsc
 = 
cmd
.
v4
.
ns_c⁄fig
;

78 
n_nsc
 = 
IWL_PROTO_OFFLOAD_NUM_NS_CONFIG_V3L
;

79 
addrs
 = 
cmd
.
v4
.
èrg_addrs
;

80 
n_addrs
 = 
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V3L
;

88 
i
 = 0, 
c
 = 0;

89 
i
 < 
mvmvif
->
num_èrgë_ùv6_addrs
 &&

90 
i
 < 
n_addrs
 && 
c
 < 
n_nsc
; i++) {

91 
ö6_addr
 
sﬁicôed_addr
;

92 
j
;

94 i‡(
skù_ã¡©ive
 &&

95 
	`ã°_bô
(
i
, 
mvmvif
->
ã¡©ive_addrs
)) {

96 
num_skù≥d
++;

100 
	`addrc⁄f_addr_sﬁi˘_mu…
(&
mvmvif
->
èrgë_ùv6_addrs
[
i
],

101 &
sﬁicôed_addr
);

102 
j
 = 0; j < 
c
; j++)

103 i‡(
	`ùv6_addr_cmp
(&
nsc
[
j
].
de°_ùv6_addr
,

104 &
sﬁicôed_addr
) == 0)

106 i‡(
j
 =
c
)

107 
c
++;

108 
addrs
[
i
].
addr
 = 
mvmvif
->
èrgë_ùv6_addrs
[i];

109 
addrs
[
i
].
c⁄fig_num
 = 
	`˝u_to_À32
(
j
);

110 
nsc
[
j
].
de°_ùv6_addr
 = 
sﬁicôed_addr
;

111 
	`mem˝y
(
nsc
[
j
].
èrgë_mac_addr
, 
vif
->
addr
, 
ETH_ALEN
);

114 i‡(
mvmvif
->
num_èrgë_ùv6_addrs
 - 
num_skù≥d
)

115 
íabÀd
 |
IWL_D3_PROTO_IPV6_VALID
;

117 i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEW_NSOFFL_SMALL
)

118 
cmd
.
v3s
.
num_vÆid_ùv6_addrs
 =

119 
	`˝u_to_À32
(
i
 - 
num_skù≥d
);

121 
cmd
.
v4
.
num_vÆid_ùv6_addrs
 =

122 
	`˝u_to_À32
(
i
 - 
num_skù≥d
);

123 } i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_D3_6_IPV6_ADDRS
) {

124 
boﬁ
 
found
 = 
Ál£
;

126 
	`BUILD_BUG_ON
((
cmd
.
v2
.
èrgë_ùv6_addr
[0]) !=

127 (
mvmvif
->
èrgë_ùv6_addrs
[0]));

129 
i
 = 0; i < 
	`mö
(
mvmvif
->
num_èrgë_ùv6_addrs
,

130 
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V2
); 
i
++) {

131 i‡(
skù_ã¡©ive
 &&

132 
	`ã°_bô
(
i
, 
mvmvif
->
ã¡©ive_addrs
))

135 
	`mem˝y
(
cmd
.
v2
.
èrgë_ùv6_addr
[
i
],

136 &
mvmvif
->
èrgë_ùv6_addrs
[
i
],

137 (
cmd
.
v2
.
èrgë_ùv6_addr
[
i
]));

139 
found
 = 
åue
;

141 i‡(
found
) {

142 
íabÀd
 |
IWL_D3_PROTO_IPV6_VALID
;

143 
	`mem˝y
(
cmd
.
v2
.
ndp_mac_addr
, 
vif
->
addr
, 
ETH_ALEN
);

146 
boﬁ
 
found
 = 
Ál£
;

147 
	`BUILD_BUG_ON
((
cmd
.
v1
.
èrgë_ùv6_addr
[0]) !=

148 (
mvmvif
->
èrgë_ùv6_addrs
[0]));

150 
i
 = 0; i < 
	`mö
(
mvmvif
->
num_èrgë_ùv6_addrs
,

151 
IWL_PROTO_OFFLOAD_NUM_IPV6_ADDRS_V1
); 
i
++) {

152 i‡(
skù_ã¡©ive
 &&

153 
	`ã°_bô
(
i
, 
mvmvif
->
ã¡©ive_addrs
))

156 
	`mem˝y
(
cmd
.
v1
.
èrgë_ùv6_addr
[
i
],

157 &
mvmvif
->
èrgë_ùv6_addrs
[
i
],

158 (
cmd
.
v1
.
èrgë_ùv6_addr
[
i
]));

160 
found
 = 
åue
;

163 i‡(
found
) {

164 
íabÀd
 |
IWL_D3_PROTO_IPV6_VALID
;

165 
	`mem˝y
(
cmd
.
v1
.
ndp_mac_addr
, 
vif
->
addr
, 
ETH_ALEN
);

169 i‡(
ofÊﬂd_ns
 && (
íabÀd
 & 
IWL_D3_PROTO_IPV6_VALID
))

170 
íabÀd
 |
IWL_D3_PROTO_OFFLOAD_NS
;

172 i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEW_NSOFFL_SMALL
) {

173 
comm⁄
 = &
cmd
.
v3s
.common;

174 
size
 = (
cmd
.
v3s
);

175 } i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_NEW_NSOFFL_LARGE
) {

176 
comm⁄
 = &
cmd
.
v4
.common;

177 
size
 = (
cmd
.
v4
);

178 i‡(
vî
 < 4) {

184 
size
 -(
cmd
.
v4
.
°a_id
);

185 
hcmd
.
d©a
[0] = 
comm⁄
;

187 } i‡(
ˇ∑_Êags
 & 
IWL_UCODE_TLV_FLAGS_D3_6_IPV6_ADDRS
) {

188 
comm⁄
 = &
cmd
.
v2
.common;

189 
size
 = (
cmd
.
v2
);

191 
comm⁄
 = &
cmd
.
v1
.common;

192 
size
 = (
cmd
.
v1
);

195 i‡(
vif
->
cfg
.
¨p_addr_˙t
) {

196 
íabÀd
 |
IWL_D3_PROTO_OFFLOAD_ARP
 | 
IWL_D3_PROTO_IPV4_VALID
;

197 
comm⁄
->
ho°_ùv4_addr
 = 
vif
->
cfg
.
¨p_addr_li°
[0];

198 
	`mem˝y
(
comm⁄
->
¨p_mac_addr
, 
vif
->
addr
, 
ETH_ALEN
);

201 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

202 
IWL_UCODE_TLV_CAPA_OFFLOAD_BTM_SUPPORT
))

203 
íabÀd
 |
IWL_D3_PROTO_OFFLOAD_BTM
;

205 i‡(!
dißbÀ_ofÊﬂdög
)

206 
comm⁄
->
íabÀd
 = 
	`˝u_to_À32
(enabled);

208 
hcmd
.
Àn
[0] = 
size
;

209  
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

210 
	}
}

	@mvm/ops.c

7 
	~<löux/moduÀ.h
>

8 
	~<löux/π√éök.h
>

9 
	~<löux/vmÆloc.h
>

10 
	~<√t/mac80211.h
>

12 
	~"fw/nŸif-waô.h
"

13 
	~"iwl-å™s.h
"

14 
	~"iwl-›-mode.h
"

15 
	~"fw/img.h
"

16 
	~"iwl-debug.h
"

17 
	~"iwl-drv.h
"

18 
	~"iwl-mod∑øms.h
"

19 
	~"mvm.h
"

20 
	~"iwl-phy-db.h
"

21 
	~"iwl-ì¥om-∑r£.h
"

22 
	~"iwl-c§.h
"

23 
	~"iwl-io.h
"

24 
	~"iwl-¥ph.h
"

25 
	~"rs.h
"

26 
	~"fw/≠i/sˇn.h
"

27 
	~"fw/≠i/rfi.h
"

28 
	~"time-evít.h
"

29 
	~"fw-≠i.h
"

30 
	~"fw/a˝i.h
"

31 
	~"fw/uefi.h
"

32 
	~"time-sync.h
"

34 
	#DRV_DESCRIPTION
 "Thê√w I¡ñ(RËwúñes†AGN drivî f‹ Löux"

	)

35 
MODULE_DESCRIPTION
(
DRV_DESCRIPTION
);

36 
MODULE_LICENSE
("GPL");

37 
MODULE_IMPORT_NS
(
IWLWIFI
);

39 c⁄° 
iwl_›_mode_›s
 
	giwl_mvm_›s
;

40 c⁄° 
iwl_›_mode_›s
 
	giwl_mvm_›s_mq
;

42 
iwl_mvm_mod_∑øms
 
	giwlmvm_mod_∑øms
 = {

43 .
powî_scheme
 = 
IWL_POWER_SCHEME_BPS
,

47 
moduÀ_∑øm_«med
(
öô_dbg
, 
iwlmvm_mod_∑øms
.öô_dbg, 
boﬁ
, 0444);

48 
MODULE_PARM_DESC
(
öô_dbg
,

50 
moduÀ_∑øm_«med
(
powî_scheme
, 
iwlmvm_mod_∑øms
.power_scheme, , 0444);

51 
MODULE_PARM_DESC
(
powî_scheme
,

57 
__öô
 
	$iwl_mvm_öô
()

59 
ªt
;

61 
ªt
 = 
	`iwl_mvm_øã_c⁄åﬁ_ªgi°î
();

62 i‡(
ªt
) {

63 
	`¥_îr
("U«bÀÅÿªgi°îÑ©êc⁄åﬁálg‹ôhm: %d\n", 
ªt
);

64  
ªt
;

67 
ªt
 = 
	`iwl_›mode_ªgi°î
("iwlmvm", &
iwl_mvm_›s
);

68 i‡(
ªt
)

69 
	`¥_îr
("U«bÀÅÿªgi°î MVM op_mode: %d\n", 
ªt
);

71  
ªt
;

72 
	}
}

73 
moduÀ_öô
(
iwl_mvm_öô
);

75 
__exô
 
	$iwl_mvm_exô
()

77 
	`iwl_›mode_dîegi°î
("iwlmvm");

78 
	`iwl_mvm_øã_c⁄åﬁ_uƒegi°î
();

79 
	}
}

80 
moduÀ_exô
(
iwl_mvm_exô
);

82 
	$iwl_mvm_nic_c⁄fig
(
iwl_›_mode
 *
›_mode
)

84 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

85 
u8
 
ødio_cfg_ty≥
, 
ødio_cfg_°ï
, 
ødio_cfg_dash
;

86 
u32
 
ªg_vÆ
;

87 
u32
 
phy_c⁄fig
 = 
	`iwl_mvm_gë_phy_c⁄fig
(
mvm
);

89 
ødio_cfg_ty≥
 = (
phy_c⁄fig
 & 
FW_PHY_CFG_RADIO_TYPE
) >>

90 
FW_PHY_CFG_RADIO_TYPE_POS
;

91 
ødio_cfg_°ï
 = (
phy_c⁄fig
 & 
FW_PHY_CFG_RADIO_STEP
) >>

92 
FW_PHY_CFG_RADIO_STEP_POS
;

93 
ødio_cfg_dash
 = (
phy_c⁄fig
 & 
FW_PHY_CFG_RADIO_DASH
) >>

94 
FW_PHY_CFG_RADIO_DASH_POS
;

96 
	`IWL_DEBUG_INFO
(
mvm
, "Radiÿty≥=0x%x-0x%x-0x%x\n", 
ødio_cfg_ty≥
,

97 
ødio_cfg_°ï
, 
ødio_cfg_dash
);

99 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

103 
ªg_vÆ
 = 
	`CSR_HW_REV_STEP_DASH
(
mvm
->
å™s
->
hw_ªv
);

106 
ªg_vÆ
 |
ødio_cfg_ty≥
 << 
CSR_HW_IF_CONFIG_REG_POS_PHY_TYPE
;

107 
ªg_vÆ
 |
ødio_cfg_°ï
 << 
CSR_HW_IF_CONFIG_REG_POS_PHY_STEP
;

108 
ªg_vÆ
 |
ødio_cfg_dash
 << 
CSR_HW_IF_CONFIG_REG_POS_PHY_DASH
;

110 
	`WARN_ON
((
ødio_cfg_ty≥
 << 
CSR_HW_IF_CONFIG_REG_POS_PHY_TYPE
) &

111 ~
CSR_HW_IF_CONFIG_REG_MSK_PHY_TYPE
);

121 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_8000
)

122 
ªg_vÆ
 |
CSR_HW_IF_CONFIG_REG_BIT_RADIO_SI
;

124 i‡(
	`iwl_fw_dbg_is_d3_debug_íabÀd
(&
mvm
->
fwπ
))

125 
ªg_vÆ
 |
CSR_HW_IF_CONFIG_REG_D3_DEBUG
;

127 
	`iwl_å™s_£t_bôs_mask
(
mvm
->
å™s
, 
CSR_HW_IF_CONFIG_REG
,

128 
CSR_HW_IF_CONFIG_REG_MSK_MAC_STEP_DASH
 |

129 
CSR_HW_IF_CONFIG_REG_MSK_PHY_TYPE
 |

130 
CSR_HW_IF_CONFIG_REG_MSK_PHY_STEP
 |

131 
CSR_HW_IF_CONFIG_REG_MSK_PHY_DASH
 |

132 
CSR_HW_IF_CONFIG_REG_BIT_RADIO_SI
 |

133 
CSR_HW_IF_CONFIG_REG_BIT_MAC_SI
 |

134 
CSR_HW_IF_CONFIG_REG_D3_DEBUG
,

135 
ªg_vÆ
);

142 i‡(!
mvm
->
å™s
->
cfg
->
≠mg_nŸ_suµ‹ãd
)

143 
	`iwl_£t_bôs_mask_¥ph
(
mvm
->
å™s
, 
APMG_PS_CTRL_REG
,

144 
APMG_PS_CTRL_EARLY_PWR_OFF_RESET_DIS
,

145 ~
APMG_PS_CTRL_EARLY_PWR_OFF_RESET_DIS
);

146 
	}
}

148 
	$iwl_mvm_rx_m⁄ô‹_nŸif
(
iwl_mvm
 *
mvm
,

149 
iwl_rx_cmd_buf„r
 *
rxb
)

151 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

152 
iwl_d©≠©h_m⁄ô‹_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

153 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

154 c⁄° 
õì80211_°a_he_ˇp
 *
he_ˇp
;

155 
õì80211_vif
 *
vif
;

157 i‡(
nŸif
->
ty≥
 !
	`˝u_to_À32
(
IWL_DP_MON_NOTIF_TYPE_EXT_CCA
))

160 
vif
 = 
	`iwl_mvm_gë_vif_by_macid
(
mvm
, 
nŸif
->
mac_id
);

161 i‡(!
vif
 || vif->
ty≥
 !
NL80211_IFTYPE_STATION
)

164 i‡(!
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
ch™
 ||

165 
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
ch™
->
b™d
 !
NL80211_BAND_2GHZ
 ||

166 
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
width
 < 
NL80211_CHAN_WIDTH_40
)

169 i‡(!
vif
->
cfg
.
assoc
)

173 i‡(
mvm
->
cˇ_40mhz_w‹k¨ound
)

180 
mvm
->
cˇ_40mhz_w‹k¨ound
 = 2;

189 
sb™d
 = 
mvm
->
hw
->
wùhy
->
b™ds
[
NL80211_BAND_2GHZ
];

191 
	`WARN_ON
(!
sb™d
->
ht_ˇp
.
ht_suµ‹ãd
);

192 
	`WARN_ON
(!(
sb™d
->
ht_ˇp
.
ˇp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
));

193 
sb™d
->
ht_ˇp
.
ˇp
 &~
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

195 
he_ˇp
 = 
	`õì80211_gë_he_i·y≥_ˇp_vif
(
sb™d
, 
vif
);

197 i‡(
he_ˇp
) {

199 
õì80211_°a_he_ˇp
 *
he
 = (*)(
uöçå_t
)
he_ˇp
;

201 
	`WARN_ON
(!
he
->
has_he
);

202 
	`WARN_ON
(!(
he
->
he_ˇp_ñem
.
phy_ˇp_öfo
[0] &

203 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
));

204 
he
->
he_ˇp_ñem
.
phy_ˇp_öfo
[0] &=

205 ~
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
;

208 
	`õì80211_disc⁄√˘
(
vif
, 
åue
);

209 
	}
}

211 
	$iwl_mvm_upd©e_lök_smps
(
õì80211_vif
 *
vif
,

212 
õì80211_bss_c⁄f
 *
lök_c⁄f
)

214 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

215 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

216 
õì80211_smps_mode
 
mode
 = 
IEEE80211_SMPS_AUTOMATIC
;

218 i‡(!
lök_c⁄f
)

221 i‡(
mvm
->
fw_°©ic_smps_ªque°
 &&

222 
lök_c⁄f
->
ch™ªq
.
›î
.
width
 =
NL80211_CHAN_WIDTH_160
 &&

223 
lök_c⁄f
->
he_suµ‹t
)

224 
mode
 = 
IEEE80211_SMPS_STATIC
;

226 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_FW
, 
mode
,

227 
lök_c⁄f
->
lök_id
);

228 
	}
}

230 
	$iwl_mvm_ötf_duÆ_chaö_ªq
(*
d©a
, 
u8
 *
mac
,

231 
õì80211_vif
 *
vif
)

233 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

234 
lök_id
;

236 
	`rcu_ªad_lock
();

238 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
)

239 
	`iwl_mvm_upd©e_lök_smps
(
vif
, 
lök_c⁄f
);

241 
	`rcu_ªad_u∆ock
();

242 
	}
}

244 
	$iwl_mvm_rx_thîmÆ_duÆ_chaö_ªq
(
iwl_mvm
 *
mvm
,

245 
iwl_rx_cmd_buf„r
 *
rxb
)

247 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

248 
iwl_thîmÆ_duÆ_chaö_ªque°
 *
ªq
 = (*)
pkt
->
d©a
;

254 
mvm
->
fw_°©ic_smps_ªque°
 =

255 
ªq
->
evít
 =
	`˝u_to_À32
(
THERMAL_DUAL_CHAIN_REQ_DISABLE
);

256 
	`õì80211_ôî©e_öãrÁ˚s
(
mvm
->
hw
,

257 
IEEE80211_IFACE_SKIP_SDATA_NOT_IN_DRIVER
,

258 
iwl_mvm_ötf_duÆ_chaö_ªq
, 
NULL
);

259 
	}
}

274 
	eiwl_rx_h™dÀr_c⁄ãxt
 {

275 
	mRX_HANDLER_SYNC
,

276 
	mRX_HANDLER_ASYNC_LOCKED
,

277 
	mRX_HANDLER_ASYNC_UNLOCKED
,

278 
	mRX_HANDLER_ASYNC_LOCKED_WIPHY
,

288 
	siwl_rx_h™dÀrs
 {

289 
u16
 
	mcmd_id
, 
	mmö_size
;

290 
iwl_rx_h™dÀr_c⁄ãxt
 
	mc⁄ãxt
;

291 (*
	m‚
)(
iwl_mvm
 *
	mmvm
, 
iwl_rx_cmd_buf„r
 *
	mrxb
);

294 
	#RX_HANDLER_NO_SIZE
(
_cmd_id
, 
_‚
, 
_c⁄ãxt
) \

295 { .
cmd_id
 = 
_cmd_id
, .
‚
 = 
_‚
, .
c⁄ãxt
 = 
_c⁄ãxt
, }

	)

296 
	#RX_HANDLER_GRP_NO_SIZE
(
_gΩ
, 
_cmd
, 
_‚
, 
_c⁄ãxt
) \

297 { .
cmd_id
 = 
	`WIDE_ID
(
_gΩ
, 
_cmd
), .
‚
 = 
_‚
, .
c⁄ãxt
 = 
_c⁄ãxt
, }

	)

298 
	#RX_HANDLER
(
_cmd_id
, 
_‚
, 
_c⁄ãxt
, 
_°ru˘
) \

299 { .
cmd_id
 = 
_cmd_id
, .
‚
 = 
_‚
, \

300 .
c⁄ãxt
 = 
_c⁄ãxt
, .
mö_size
 = (
_°ru˘
), }

	)

301 
	#RX_HANDLER_GRP
(
_gΩ
, 
_cmd
, 
_‚
, 
_c⁄ãxt
, 
_°ru˘
) \

302 { .
cmd_id
 = 
	`WIDE_ID
(
_gΩ
, 
_cmd
), .
‚
 = 
_‚
, \

303 .
c⁄ãxt
 = 
_c⁄ãxt
, .
mö_size
 = (
_°ru˘
), }

	)

312 c⁄° 
iwl_rx_h™dÀrs
 
	giwl_mvm_rx_h™dÀrs
[] = {

313 
RX_HANDLER
(
TX_CMD
, 
iwl_mvm_rx_tx_cmd
, 
RX_HANDLER_SYNC
,

314 
iwl_mvm_tx_ª•
),

315 
RX_HANDLER
(
BA_NOTIF
, 
iwl_mvm_rx_ba_nŸif
, 
RX_HANDLER_SYNC
,

316 
iwl_mvm_ba_nŸif
),

318 
RX_HANDLER_GRP
(
DATA_PATH_GROUP
, 
TLC_MNG_UPDATE_NOTIF
,

319 
iwl_mvm_éc_upd©e_nŸif
, 
RX_HANDLER_SYNC
,

320 
iwl_éc_upd©e_nŸif
),

322 
RX_HANDLER
(
BT_PROFILE_NOTIFICATION
, 
iwl_mvm_rx_bt_c€x_nŸif
,

323 
RX_HANDLER_ASYNC_LOCKED_WIPHY
,

324 
iwl_bt_c€x_¥ofûe_nŸif
),

325 
RX_HANDLER_NO_SIZE
(
BEACON_NOTIFICATION
, 
iwl_mvm_rx_bóc⁄_nŸif
,

326 
RX_HANDLER_ASYNC_LOCKED
),

327 
RX_HANDLER_NO_SIZE
(
STATISTICS_NOTIFICATION
, 
iwl_mvm_rx_°©i°ics
,

328 
RX_HANDLER_ASYNC_LOCKED
),

330 
RX_HANDLER_GRP
(
STATISTICS_GROUP
, 
STATISTICS_OPER_NOTIF
,

331 
iwl_mvm_h™dÀ_rx_sy°em_›î_°©s
,

332 
RX_HANDLER_ASYNC_LOCKED_WIPHY
,

333 
iwl_sy°em_°©i°ics_nŸif_›î
),

334 
RX_HANDLER_GRP
(
STATISTICS_GROUP
, 
STATISTICS_OPER_PART1_NOTIF
,

335 
iwl_mvm_h™dÀ_rx_sy°em_›î_∑π1_°©s
,

336 
RX_HANDLER_ASYNC_LOCKED
,

337 
iwl_sy°em_°©i°ics_∑π1_nŸif_›î
),

338 
RX_HANDLER_GRP
(
SYSTEM_GROUP
, 
SYSTEM_STATISTICS_END_NOTIF
,

339 
iwl_mvm_h™dÀ_rx_sy°em_íd_°©s_nŸif
,

340 
RX_HANDLER_ASYNC_LOCKED
,

341 
iwl_sy°em_°©i°ics_íd_nŸif
),

343 
RX_HANDLER
(
BA_WINDOW_STATUS_NOTIFICATION_ID
,

344 
iwl_mvm_wödow_°©us_nŸif
, 
RX_HANDLER_SYNC
,

345 
iwl_ba_wödow_°©us_nŸif
),

347 
RX_HANDLER
(
TIME_EVENT_NOTIFICATION
, 
iwl_mvm_rx_time_evít_nŸif
,

348 
RX_HANDLER_SYNC
, 
iwl_time_evít_nŸif
),

349 
RX_HANDLER_GRP
(
MAC_CONF_GROUP
, 
SESSION_PROTECTION_NOTIF
,

350 
iwl_mvm_rx_£ssi⁄_¥Ÿe˘_nŸif
, 
RX_HANDLER_SYNC
,

351 
iwl_mvm_£ssi⁄_¥Ÿ_nŸif
),

352 
RX_HANDLER
(
MCC_CHUB_UPDATE_CMD
, 
iwl_mvm_rx_chub_upd©e_mcc
,

353 
RX_HANDLER_ASYNC_LOCKED
, 
iwl_mcc_chub_nŸif
),

355 
RX_HANDLER
(
EOSP_NOTIFICATION
, 
iwl_mvm_rx_eo•_nŸif
, 
RX_HANDLER_SYNC
,

356 
iwl_mvm_eo•_nŸifiˇti⁄
),

358 
RX_HANDLER
(
SCAN_ITERATION_COMPLETE
,

359 
iwl_mvm_rx_lmac_sˇn_ôî_com∂ëe_nŸif
, 
RX_HANDLER_SYNC
,

360 
iwl_lmac_sˇn_com∂ëe_nŸif
),

361 
RX_HANDLER
(
SCAN_OFFLOAD_COMPLETE
,

362 
iwl_mvm_rx_lmac_sˇn_com∂ëe_nŸif
,

363 
RX_HANDLER_ASYNC_LOCKED
, 
iwl_≥riodic_sˇn_com∂ëe
),

364 
RX_HANDLER_NO_SIZE
(
MATCH_FOUND_NOTIFICATION
,

365 
iwl_mvm_rx_sˇn_m©ch_found
,

366 
RX_HANDLER_SYNC
),

367 
RX_HANDLER
(
SCAN_COMPLETE_UMAC
, 
iwl_mvm_rx_umac_sˇn_com∂ëe_nŸif
,

368 
RX_HANDLER_ASYNC_LOCKED
, 
iwl_umac_sˇn_com∂ëe
),

369 
RX_HANDLER
(
SCAN_ITERATION_COMPLETE_UMAC
,

370 
iwl_mvm_rx_umac_sˇn_ôî_com∂ëe_nŸif
, 
RX_HANDLER_SYNC
,

371 
iwl_umac_sˇn_ôî_com∂ëe_nŸif
),

373 
RX_HANDLER
(
MISSED_BEACONS_NOTIFICATION
, 
iwl_mvm_rx_mis£d_bóc⁄s_nŸif
,

374 
RX_HANDLER_SYNC
, 
iwl_mis£d_bóc⁄s_nŸif
),

376 
RX_HANDLER
(
REPLY_ERROR
, 
iwl_mvm_rx_fw_îr‹
, 
RX_HANDLER_SYNC
,

377 
iwl_îr‹_ª•
),

378 
RX_HANDLER
(
PSM_UAPSD_AP_MISBEHAVING_NOTIFICATION
,

379 
iwl_mvm_powî_u≠sd_misbehavög_≠_nŸif
, 
RX_HANDLER_SYNC
,

380 
iwl_u≠sd_misbehavög_≠_nŸif
),

381 
RX_HANDLER_NO_SIZE
(
DTS_MEASUREMENT_NOTIFICATION
, 
iwl_mvm_ãmp_nŸif
,

382 
RX_HANDLER_ASYNC_LOCKED
),

383 
RX_HANDLER_GRP_NO_SIZE
(
PHY_OPS_GROUP
, 
DTS_MEASUREMENT_NOTIF_WIDE
,

384 
iwl_mvm_ãmp_nŸif
, 
RX_HANDLER_ASYNC_UNLOCKED
),

385 
RX_HANDLER_GRP
(
PHY_OPS_GROUP
, 
CT_KILL_NOTIFICATION
,

386 
iwl_mvm_˘_kûl_nŸif
, 
RX_HANDLER_SYNC
,

387 
˘_kûl_nŸif
),

389 
RX_HANDLER
(
TDLS_CHANNEL_SWITCH_NOTIFICATION
, 
iwl_mvm_rx_tdls_nŸif
,

390 
RX_HANDLER_ASYNC_LOCKED
,

391 
iwl_tdls_ch™√l_swôch_nŸif
),

392 
RX_HANDLER
(
MFUART_LOAD_NOTIFICATION
, 
iwl_mvm_rx_mfu¨t_nŸif
,

393 
RX_HANDLER_SYNC
, 
iwl_mfu¨t_lﬂd_nŸif_v1
),

394 
RX_HANDLER_GRP
(
LOCATION_GROUP
, 
TOF_RESPONDER_STATS
,

395 
iwl_mvm_·m_ª•⁄dî_°©s
, 
RX_HANDLER_ASYNC_LOCKED
,

396 
iwl_·m_ª•⁄dî_°©s
),

398 
RX_HANDLER_GRP_NO_SIZE
(
LOCATION_GROUP
, 
TOF_RANGE_RESPONSE_NOTIF
,

399 
iwl_mvm_·m_ønge_ª•
, 
RX_HANDLER_ASYNC_LOCKED
),

400 
RX_HANDLER_GRP_NO_SIZE
(
LOCATION_GROUP
, 
TOF_LC_NOTIF
,

401 
iwl_mvm_·m_lc_nŸif
, 
RX_HANDLER_ASYNC_LOCKED
),

403 
RX_HANDLER_GRP
(
DEBUG_GROUP
, 
MFU_ASSERT_DUMP_NTF
,

404 
iwl_mvm_mfu_as£π_dump_nŸif
, 
RX_HANDLER_SYNC
,

405 
iwl_mfu_as£π_dump_nŸif
),

406 
RX_HANDLER_GRP
(
PROT_OFFLOAD_GROUP
, 
STORED_BEACON_NTF
,

407 
iwl_mvm_rx_°‹ed_bóc⁄_nŸif
, 
RX_HANDLER_SYNC
,

408 
iwl_°‹ed_bóc⁄_nŸif_v2
),

409 
RX_HANDLER_GRP
(
DATA_PATH_GROUP
, 
MU_GROUP_MGMT_NOTIF
,

410 
iwl_mvm_mu_mimo_gΩ_nŸif
, 
RX_HANDLER_SYNC
,

411 
iwl_mu_group_mgmt_nŸif
),

412 
RX_HANDLER_GRP
(
DATA_PATH_GROUP
, 
STA_PM_NOTIF
,

413 
iwl_mvm_°a_pm_nŸif
, 
RX_HANDLER_SYNC
,

414 
iwl_mvm_pm_°©e_nŸifiˇti⁄
),

415 
RX_HANDLER_GRP
(
MAC_CONF_GROUP
, 
PROBE_RESPONSE_DATA_NOTIF
,

416 
iwl_mvm_¥obe_ª•_d©a_nŸif
,

417 
RX_HANDLER_ASYNC_LOCKED
,

418 
iwl_¥obe_ª•_d©a_nŸif
),

419 
RX_HANDLER_GRP
(
MAC_CONF_GROUP
, 
CHANNEL_SWITCH_START_NOTIF
,

420 
iwl_mvm_ch™√l_swôch_°¨t_nŸif
,

421 
RX_HANDLER_SYNC
, 
iwl_ch™√l_swôch_°¨t_nŸif
),

422 
RX_HANDLER_GRP
(
MAC_CONF_GROUP
, 
CHANNEL_SWITCH_ERROR_NOTIF
,

423 
iwl_mvm_ch™√l_swôch_îr‹_nŸif
,

424 
RX_HANDLER_ASYNC_UNLOCKED
,

425 
iwl_ch™√l_swôch_îr‹_nŸif
),

426 
RX_HANDLER_GRP
(
DATA_PATH_GROUP
, 
MONITOR_NOTIF
,

427 
iwl_mvm_rx_m⁄ô‹_nŸif
, 
RX_HANDLER_ASYNC_LOCKED
,

428 
iwl_d©≠©h_m⁄ô‹_nŸif
),

430 
RX_HANDLER_GRP
(
DATA_PATH_GROUP
, 
THERMAL_DUAL_CHAIN_REQUEST
,

431 
iwl_mvm_rx_thîmÆ_duÆ_chaö_ªq
,

432 
RX_HANDLER_ASYNC_LOCKED
,

433 
iwl_thîmÆ_duÆ_chaö_ªque°
),

435 
RX_HANDLER_GRP
(
SYSTEM_GROUP
, 
RFI_DEACTIVATE_NOTIF
,

436 
iwl_rfi_dó˘iv©e_nŸif_h™dÀr
, 
RX_HANDLER_ASYNC_UNLOCKED
,

437 
iwl_rfi_dó˘iv©e_nŸif
),

439 
RX_HANDLER_GRP
(
LEGACY_GROUP
,

440 
WNM_80211V_TIMING_MEASUREMENT_NOTIFICATION
,

441 
iwl_mvm_time_sync_msmt_evít
, 
RX_HANDLER_SYNC
,

442 
iwl_time_msmt_nŸify
),

443 
RX_HANDLER_GRP
(
LEGACY_GROUP
,

444 
WNM_80211V_TIMING_MEASUREMENT_CONFIRM_NOTIFICATION
,

445 
iwl_mvm_time_sync_msmt_c⁄fúm_evít
, 
RX_HANDLER_SYNC
,

446 
iwl_time_msmt_cfm_nŸify
),

447 
RX_HANDLER_GRP
(
MAC_CONF_GROUP
, 
ROC_NOTIF
,

448 
iwl_mvm_rx_roc_nŸif
, 
RX_HANDLER_SYNC
,

449 
iwl_roc_nŸif
),

451 #unde‡
RX_HANDLER


452 #unde‡
RX_HANDLER_GRP


457 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_Àgacy_«mes
[] = {

458 
HCMD_NAME
(
UCODE_ALIVE_NTFY
),

459 
HCMD_NAME
(
REPLY_ERROR
),

460 
HCMD_NAME
(
ECHO_CMD
),

461 
HCMD_NAME
(
INIT_COMPLETE_NOTIF
),

462 
HCMD_NAME
(
PHY_CONTEXT_CMD
),

463 
HCMD_NAME
(
DBG_CFG
),

464 
HCMD_NAME
(
SCAN_CFG_CMD
),

465 
HCMD_NAME
(
SCAN_REQ_UMAC
),

466 
HCMD_NAME
(
SCAN_ABORT_UMAC
),

467 
HCMD_NAME
(
SCAN_COMPLETE_UMAC
),

468 
HCMD_NAME
(
BA_WINDOW_STATUS_NOTIFICATION_ID
),

469 
HCMD_NAME
(
ADD_STA_KEY
),

470 
HCMD_NAME
(
ADD_STA
),

471 
HCMD_NAME
(
REMOVE_STA
),

472 
HCMD_NAME
(
TX_CMD
),

473 
HCMD_NAME
(
SCD_QUEUE_CFG
),

474 
HCMD_NAME
(
TXPATH_FLUSH
),

475 
HCMD_NAME
(
MGMT_MCAST_KEY
),

476 
HCMD_NAME
(
WEP_KEY
),

477 
HCMD_NAME
(
SHARED_MEM_CFG
),

478 
HCMD_NAME
(
TDLS_CHANNEL_SWITCH_CMD
),

479 
HCMD_NAME
(
MAC_CONTEXT_CMD
),

480 
HCMD_NAME
(
TIME_EVENT_CMD
),

481 
HCMD_NAME
(
TIME_EVENT_NOTIFICATION
),

482 
HCMD_NAME
(
BINDING_CONTEXT_CMD
),

483 
HCMD_NAME
(
TIME_QUOTA_CMD
),

484 
HCMD_NAME
(
NON_QOS_TX_COUNTER_CMD
),

485 
HCMD_NAME
(
LEDS_CMD
),

486 
HCMD_NAME
(
LQ_CMD
),

487 
HCMD_NAME
(
FW_PAGING_BLOCK_CMD
),

488 
HCMD_NAME
(
SCAN_OFFLOAD_REQUEST_CMD
),

489 
HCMD_NAME
(
SCAN_OFFLOAD_ABORT_CMD
),

490 
HCMD_NAME
(
HOT_SPOT_CMD
),

491 
HCMD_NAME
(
SCAN_OFFLOAD_PROFILES_QUERY_CMD
),

492 
HCMD_NAME
(
BT_COEX_UPDATE_REDUCED_TXP
),

493 
HCMD_NAME
(
BT_COEX_CI
),

494 
HCMD_NAME
(
WNM_80211V_TIMING_MEASUREMENT_NOTIFICATION
),

495 
HCMD_NAME
(
WNM_80211V_TIMING_MEASUREMENT_CONFIRM_NOTIFICATION
),

496 
HCMD_NAME
(
PHY_CONFIGURATION_CMD
),

497 
HCMD_NAME
(
CALIB_RES_NOTIF_PHY_DB
),

498 
HCMD_NAME
(
PHY_DB_CMD
),

499 
HCMD_NAME
(
SCAN_OFFLOAD_COMPLETE
),

500 
HCMD_NAME
(
SCAN_OFFLOAD_UPDATE_PROFILES_CMD
),

501 
HCMD_NAME
(
POWER_TABLE_CMD
),

502 
HCMD_NAME
(
PSM_UAPSD_AP_MISBEHAVING_NOTIFICATION
),

503 
HCMD_NAME
(
REPLY_THERMAL_MNG_BACKOFF
),

504 
HCMD_NAME
(
NVM_ACCESS_CMD
),

505 
HCMD_NAME
(
BEACON_NOTIFICATION
),

506 
HCMD_NAME
(
BEACON_TEMPLATE_CMD
),

507 
HCMD_NAME
(
TX_ANT_CONFIGURATION_CMD
),

508 
HCMD_NAME
(
BT_CONFIG
),

509 
HCMD_NAME
(
STATISTICS_CMD
),

510 
HCMD_NAME
(
STATISTICS_NOTIFICATION
),

511 
HCMD_NAME
(
EOSP_NOTIFICATION
),

512 
HCMD_NAME
(
REDUCE_TX_POWER_CMD
),

513 
HCMD_NAME
(
MISSED_BEACONS_NOTIFICATION
),

514 
HCMD_NAME
(
TDLS_CONFIG_CMD
),

515 
HCMD_NAME
(
MAC_PM_POWER_TABLE
),

516 
HCMD_NAME
(
TDLS_CHANNEL_SWITCH_NOTIFICATION
),

517 
HCMD_NAME
(
MFUART_LOAD_NOTIFICATION
),

518 
HCMD_NAME
(
RSS_CONFIG_CMD
),

519 
HCMD_NAME
(
SCAN_ITERATION_COMPLETE_UMAC
),

520 
HCMD_NAME
(
REPLY_RX_PHY_CMD
),

521 
HCMD_NAME
(
REPLY_RX_MPDU_CMD
),

522 
HCMD_NAME
(
BAR_FRAME_RELEASE
),

523 
HCMD_NAME
(
FRAME_RELEASE
),

524 
HCMD_NAME
(
BA_NOTIF
),

525 
HCMD_NAME
(
MCC_UPDATE_CMD
),

526 
HCMD_NAME
(
MCC_CHUB_UPDATE_CMD
),

527 
HCMD_NAME
(
MARKER_CMD
),

528 
HCMD_NAME
(
BT_PROFILE_NOTIFICATION
),

529 
HCMD_NAME
(
MCAST_FILTER_CMD
),

530 
HCMD_NAME
(
REPLY_SF_CFG_CMD
),

531 
HCMD_NAME
(
REPLY_BEACON_FILTERING_CMD
),

532 
HCMD_NAME
(
D3_CONFIG_CMD
),

533 
HCMD_NAME
(
PROT_OFFLOAD_CONFIG_CMD
),

534 
HCMD_NAME
(
MATCH_FOUND_NOTIFICATION
),

535 
HCMD_NAME
(
DTS_MEASUREMENT_NOTIFICATION
),

536 
HCMD_NAME
(
WOWLAN_PATTERNS
),

537 
HCMD_NAME
(
WOWLAN_CONFIGURATION
),

538 
HCMD_NAME
(
WOWLAN_TSC_RSC_PARAM
),

539 
HCMD_NAME
(
WOWLAN_TKIP_PARAM
),

540 
HCMD_NAME
(
WOWLAN_KEK_KCK_MATERIAL
),

541 
HCMD_NAME
(
WOWLAN_GET_STATUSES
),

542 
HCMD_NAME
(
SCAN_ITERATION_COMPLETE
),

543 
HCMD_NAME
(
D0I3_END_CMD
),

544 
HCMD_NAME
(
LTR_CONFIG
),

545 
HCMD_NAME
(
LDBG_CONFIG_CMD
),

551 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_sy°em_«mes
[] = {

552 
HCMD_NAME
(
SHARED_MEM_CFG_CMD
),

553 
HCMD_NAME
(
INIT_EXTENDED_CFG_CMD
),

554 
HCMD_NAME
(
FW_ERROR_RECOVERY_CMD
),

555 
HCMD_NAME
(
RFI_CONFIG_CMD
),

556 
HCMD_NAME
(
RFI_GET_FREQ_TABLE_CMD
),

557 
HCMD_NAME
(
SYSTEM_FEATURES_CONTROL_CMD
),

558 
HCMD_NAME
(
SYSTEM_STATISTICS_CMD
),

559 
HCMD_NAME
(
SYSTEM_STATISTICS_END_NOTIF
),

560 
HCMD_NAME
(
RFI_DEACTIVATE_NOTIF
),

566 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_mac_c⁄f_«mes
[] = {

567 
HCMD_NAME
(
CHANNEL_SWITCH_TIME_EVENT_CMD
),

568 
HCMD_NAME
(
SESSION_PROTECTION_CMD
),

569 
HCMD_NAME
(
MAC_CONFIG_CMD
),

570 
HCMD_NAME
(
LINK_CONFIG_CMD
),

571 
HCMD_NAME
(
STA_CONFIG_CMD
),

572 
HCMD_NAME
(
AUX_STA_CMD
),

573 
HCMD_NAME
(
STA_REMOVE_CMD
),

574 
HCMD_NAME
(
STA_DISABLE_TX_CMD
),

575 
HCMD_NAME
(
ROC_CMD
),

576 
HCMD_NAME
(
ROC_NOTIF
),

577 
HCMD_NAME
(
SESSION_PROTECTION_NOTIF
),

578 
HCMD_NAME
(
CHANNEL_SWITCH_START_NOTIF
),

584 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_phy_«mes
[] = {

585 
HCMD_NAME
(
CMD_DTS_MEASUREMENT_TRIGGER_WIDE
),

586 
HCMD_NAME
(
CTDP_CONFIG_CMD
),

587 
HCMD_NAME
(
TEMP_REPORTING_THRESHOLDS_CMD
),

588 
HCMD_NAME
(
PER_CHAIN_LIMIT_OFFSET_CMD
),

589 
HCMD_NAME
(
CT_KILL_NOTIFICATION
),

590 
HCMD_NAME
(
DTS_MEASUREMENT_NOTIF_WIDE
),

596 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_d©a_∑th_«mes
[] = {

597 
HCMD_NAME
(
DQA_ENABLE_CMD
),

598 
HCMD_NAME
(
UPDATE_MU_GROUPS_CMD
),

599 
HCMD_NAME
(
TRIGGER_RX_QUEUES_NOTIF_CMD
),

600 
HCMD_NAME
(
STA_HE_CTXT_CMD
),

601 
HCMD_NAME
(
RLC_CONFIG_CMD
),

602 
HCMD_NAME
(
RFH_QUEUE_CONFIG_CMD
),

603 
HCMD_NAME
(
TLC_MNG_CONFIG_CMD
),

604 
HCMD_NAME
(
CHEST_COLLECTOR_FILTER_CONFIG_CMD
),

605 
HCMD_NAME
(
SCD_QUEUE_CONFIG_CMD
),

606 
HCMD_NAME
(
SEC_KEY_CMD
),

607 
HCMD_NAME
(
MONITOR_NOTIF
),

608 
HCMD_NAME
(
THERMAL_DUAL_CHAIN_REQUEST
),

609 
HCMD_NAME
(
STA_PM_NOTIF
),

610 
HCMD_NAME
(
MU_GROUP_MGMT_NOTIF
),

611 
HCMD_NAME
(
RX_QUEUES_NOTIFICATION
),

617 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_°©i°ics_«mes
[] = {

618 
HCMD_NAME
(
STATISTICS_OPER_NOTIF
),

619 
HCMD_NAME
(
STATISTICS_OPER_PART1_NOTIF
),

625 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_sˇn_«mes
[] = {

626 
HCMD_NAME
(
OFFLOAD_MATCH_INFO_NOTIF
),

632 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_loˇti⁄_«mes
[] = {

633 
HCMD_NAME
(
TOF_RANGE_REQ_CMD
),

634 
HCMD_NAME
(
TOF_CONFIG_CMD
),

635 
HCMD_NAME
(
TOF_RANGE_ABORT_CMD
),

636 
HCMD_NAME
(
TOF_RANGE_REQ_EXT_CMD
),

637 
HCMD_NAME
(
TOF_RESPONDER_CONFIG_CMD
),

638 
HCMD_NAME
(
TOF_RESPONDER_DYN_CONFIG_CMD
),

639 
HCMD_NAME
(
TOF_LC_NOTIF
),

640 
HCMD_NAME
(
TOF_RESPONDER_STATS
),

641 
HCMD_NAME
(
TOF_MCSI_DEBUG_NOTIF
),

642 
HCMD_NAME
(
TOF_RANGE_RESPONSE_NOTIF
),

648 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_¥Ÿ_ofÊﬂd_«mes
[] = {

649 
HCMD_NAME
(
WOWLAN_WAKE_PKT_NOTIFICATION
),

650 
HCMD_NAME
(
WOWLAN_INFO_NOTIFICATION
),

651 
HCMD_NAME
(
D3_END_NOTIFICATION
),

652 
HCMD_NAME
(
STORED_BEACON_NTF
),

658 c⁄° 
iwl_hcmd_«mes
 
	giwl_mvm_ªguœt‹y_™d_nvm_«mes
[] = {

659 
HCMD_NAME
(
NVM_ACCESS_COMPLETE
),

660 
HCMD_NAME
(
NVM_GET_INFO
),

661 
HCMD_NAME
(
TAS_CONFIG
),

664 c⁄° 
iwl_hcmd_¨r
 
	giwl_mvm_groups
[] = {

665 [
LEGACY_GROUP
] = 
HCMD_ARR
(
iwl_mvm_Àgacy_«mes
),

666 [
LONG_GROUP
] = 
HCMD_ARR
(
iwl_mvm_Àgacy_«mes
),

667 [
SYSTEM_GROUP
] = 
HCMD_ARR
(
iwl_mvm_sy°em_«mes
),

668 [
MAC_CONF_GROUP
] = 
HCMD_ARR
(
iwl_mvm_mac_c⁄f_«mes
),

669 [
PHY_OPS_GROUP
] = 
HCMD_ARR
(
iwl_mvm_phy_«mes
),

670 [
DATA_PATH_GROUP
] = 
HCMD_ARR
(
iwl_mvm_d©a_∑th_«mes
),

671 [
SCAN_GROUP
] = 
HCMD_ARR
(
iwl_mvm_sˇn_«mes
),

672 [
LOCATION_GROUP
] = 
HCMD_ARR
(
iwl_mvm_loˇti⁄_«mes
),

673 [
PROT_OFFLOAD_GROUP
] = 
HCMD_ARR
(
iwl_mvm_¥Ÿ_ofÊﬂd_«mes
),

674 [
REGULATORY_AND_NVM_GROUP
] =

675 
HCMD_ARR
(
iwl_mvm_ªguœt‹y_™d_nvm_«mes
),

676 [
STATISTICS_GROUP
] = 
HCMD_ARR
(
iwl_mvm_°©i°ics_«mes
),

680 
iwl_mvm_async_h™dÀrs_wk
(
w‹k_°ru˘
 *
wk
);

681 
iwl_mvm_async_h™dÀrs_wùhy_wk
(
wùhy
 *wiphy,

682 
wùhy_w‹k
 *
w‹k
);

684 
u32
 
	$iwl_mvm_mö_backoff
(
iwl_mvm
 *
mvm
)

686 c⁄° 
iwl_pwr_tx_backoff
 *
backoff
 = 
mvm
->
cfg
->
pwr_tx_backoffs
;

687 
u64
 
dÊt_pwr_limô
;

689 i‡(!
backoff
)

692 
	`iwl_bios_gë_pwr_limô
(&
mvm
->
fwπ
, &
dÊt_pwr_limô
);

694 
backoff
->
pwr
) {

695 i‡(
dÊt_pwr_limô
 >
backoff
->
pwr
)

696  
backoff
->backoff;

698 
backoff
++;

702 
	}
}

704 
	$iwl_mvm_tx_unblock_dw‹k
(
w‹k_°ru˘
 *
w‹k
)

706 
iwl_mvm
 *
mvm
 =

707 
	`c⁄èöî_of
(
w‹k
, 
iwl_mvm
, 
cs_tx_unblock_dw‹k
.work);

708 
õì80211_vif
 *
tx_blocked_vif
;

709 
iwl_mvm_vif
 *
mvmvif
;

711 
	`muãx_lock
(&
mvm
->
muãx
);

713 
tx_blocked_vif
 =

714 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
cß_tx_blocked_vif
,

715 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

717 i‡(!
tx_blocked_vif
)

718 
u∆ock
;

720 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
tx_blocked_vif
);

721 
	`iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
mvm
, 
mvmvif
, 
Ál£
);

722 
	`RCU_INIT_POINTER
(
mvm
->
cß_tx_blocked_vif
, 
NULL
);

723 
u∆ock
:

724 
	`muãx_u∆ock
(&
mvm
->
muãx
);

725 
	}
}

727 
	$iwl_mvm_fwπ_dump_°¨t
(*
˘x
)

729 
iwl_mvm
 *
mvm
 = 
˘x
;

731 
	`muãx_lock
(&
mvm
->
muãx
);

732 
	}
}

734 
	$iwl_mvm_fwπ_dump_íd
(*
˘x
)

736 
iwl_mvm
 *
mvm
 = 
˘x
;

738 
	`muãx_u∆ock
(&
mvm
->
muãx
);

739 
	}
}

741 
boﬁ
 
	$iwl_mvm_fwπ_fw_ru¬ög
(*
˘x
)

743  
	`iwl_mvm_fúmw¨e_ru¬ög
(
˘x
);

744 
	}
}

746 
	$iwl_mvm_fwπ_£nd_hcmd
(*
˘x
, 
iwl_ho°_cmd
 *
ho°_cmd
)

748 
iwl_mvm
 *
mvm
 = (iwl_mvm *)
˘x
;

749 
ªt
;

751 
	`muãx_lock
(&
mvm
->
muãx
);

752 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, 
ho°_cmd
);

753 
	`muãx_u∆ock
(&
mvm
->
muãx
);

755  
ªt
;

756 
	}
}

758 
boﬁ
 
	$iwl_mvm_d3_debug_íabÀ
(*
˘x
)

760  
IWL_MVM_D3_DEBUG
;

761 
	}
}

763 c⁄° 
iwl_fw_ru¡ime_›s
 
	giwl_mvm_fwπ_›s
 = {

764 .
dump_°¨t
 = 
iwl_mvm_fwπ_dump_°¨t
,

765 .
	gdump_íd
 = 
iwl_mvm_fwπ_dump_íd
,

766 .
	gfw_ru¬ög
 = 
iwl_mvm_fwπ_fw_ru¬ög
,

767 .
	g£nd_hcmd
 = 
iwl_mvm_fwπ_£nd_hcmd
,

768 .
	gd3_debug_íabÀ
 = 
iwl_mvm_d3_debug_íabÀ
,

771 
	$iwl_mvm_°¨t_gë_nvm
(
iwl_mvm
 *
mvm
)

773 
iwl_å™s
 *
å™s
 = 
mvm
->trans;

774 
ªt
;

776 i‡(
å™s
->
csme_own
) {

777 i‡(
	`WARN
(!
mvm
->
mei_ªgi°îed
,

779 
gë_nvm_‰om_fw
;

781 
mvm
->
mei_nvm_d©a
 = 
	`iwl_mei_gë_nvm
();

782 i‡(
mvm
->
mei_nvm_d©a
) {

788 
mvm
->
nvm_d©a
 =

789 
	`iwl_∑r£_mei_nvm_d©a
(
å™s
,Åøns->
cfg
,

790 
mvm
->
mei_nvm_d©a
,

791 
mvm
->
fw
,

792 
mvm
->
£t_tx_™t
,

793 
mvm
->
£t_rx_™t
);

797 
	`IWL_ERR
(
mvm
,

801 
gë_nvm_‰om_fw
:

802 
	`π∆_lock
();

803 
	`wùhy_lock
(
mvm
->
hw
->
wùhy
);

804 
	`muãx_lock
(&
mvm
->
muãx
);

806 
ªt
 = 
	`iwl_å™s_°¨t_hw
(
mvm
->
å™s
);

807 i‡(
ªt
) {

808 
	`muãx_u∆ock
(&
mvm
->
muãx
);

809 
	`wùhy_u∆ock
(
mvm
->
hw
->
wùhy
);

810 
	`π∆_u∆ock
();

811  
ªt
;

814 
ªt
 = 
	`iwl_run_öô_mvm_ucode
(
mvm
);

815 i‡(
ªt
 &&Ñë !-
ERFKILL
)

816 
	`iwl_fw_dbg_îr‹_cﬁÀ˘
(&
mvm
->
fwπ
, 
FW_DBG_TRIGGER_DRIVER
);

817 i‡(!
ªt
 && 
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
)) {

818 
mvm
->
hw
->
wùhy
->
ªguœt‹y_Êags
 |
REGULATORY_WIPHY_SELF_MANAGED
;

819 
ªt
 = 
	`iwl_mvm_öô_mcc
(
mvm
);

822 i‡(!
iwlmvm_mod_∑øms
.
öô_dbg
 || !
ªt
)

823 
	`iwl_mvm_°›_devi˚
(
mvm
);

825 
	`muãx_u∆ock
(&
mvm
->
muãx
);

826 
	`wùhy_u∆ock
(
mvm
->
hw
->
wùhy
);

827 
	`π∆_u∆ock
();

829 i‡(
ªt
)

830 
	`IWL_ERR
(
mvm
, "FaûedÅÿru¿INIT ucode: %d\n", 
ªt
);

833 
mvm
->
∂dr_sync
 = 
Ál£
;

835  
ªt
;

836 
	}
}

838 
	$iwl_mvm_°¨t_po°_nvm
(
iwl_mvm
 *
mvm
)

840 
iwl_mvm_csme_c⁄n_öfo
 *
csme_c⁄n_öfo
 
__maybe_unu£d
;

841 
ªt
;

843 
	`iwl_mvm_toggÀ_tx_™t
(
mvm
, &mvm->
mgmt_œ°_™ã¬a_idx
);

845 
ªt
 = 
	`iwl_mvm_mac_£tup_ªgi°î
(
mvm
);

846 i‡(
ªt
)

847  
ªt
;

849 
mvm
->
hw_ªgi°îed
 = 
åue
;

851 
	`iwl_mvm_dbgfs_ªgi°î
(
mvm
);

853 
	`wùhy_rfkûl_£t_hw_°©e_ªas⁄
(
mvm
->
hw
->
wùhy
,

854 
mvm
->
mei_rfkûl_blocked
,

855 
RFKILL_HARD_BLOCK_NOT_OWNER
);

857 
	`iwl_mvm_mei_£t_sw_rfkûl_°©e
(
mvm
);

860 
	}
}

862 
	siwl_mvm_‰ob_txf_d©a
 {

863 
u8
 *
	mbuf
;

864 
size_t
 
	mbuÊí
;

867 
	$iwl_mvm_‰ob_txf_key_ôî
(
õì80211_hw
 *
hw
,

868 
õì80211_vif
 *
vif
,

869 
õì80211_°a
 *
°a
,

870 
õì80211_key_c⁄f
 *
key
,

871 *
d©a
)

873 
iwl_mvm_‰ob_txf_d©a
 *
txf
 = 
d©a
;

874 
u8
 
keyÀn
, 
m©ch
, 
m©chíd
;

875 
u8
 *
keyd©a
;

876 
size_t
 
i
;

878 
key
->
cùhî
) {

879 
WLAN_CIPHER_SUITE_CCMP
:

880 
keyd©a
 = 
key
->key;

881 
keyÀn
 = 
key
->keylen;

883 
WLAN_CIPHER_SUITE_WEP40
:

884 
WLAN_CIPHER_SUITE_WEP104
:

885 
WLAN_CIPHER_SUITE_TKIP
:

892 
	`mem£t
(
txf
->
buf
, 0xBB,Åxf->
buÊí
);

899 
m©ch
 = 0;

900 
i
 = 0; i < 
txf
->
buÊí
; i++) {

901 i‡(
txf
->
buf
[
i
] !
keyd©a
[
m©ch
]) {

902 
m©ch
 = 0;

905 
m©ch
++;

906 i‡(
m©ch
 =
keyÀn
) {

907 
	`mem£t
(
txf
->
buf
 + 
i
 - 
keyÀn
, 0xAA, keylen);

908 
m©ch
 = 0;

913 
m©chíd
 = 
m©ch
;

914 
i
 = 0; 
m©ch
 && i < 
keyÀn
 - match; i++) {

915 i‡(
txf
->
buf
[
i
] !
keyd©a
[
m©ch
])

917 
m©ch
++;

918 i‡(
m©ch
 =
keyÀn
) {

919 
	`mem£t
(
txf
->
buf
, 0xAA, 
i
 + 1);

920 
	`mem£t
(
txf
->
buf
 +Åxf->
buÊí
 - 
m©chíd
, 0xAA,

921 
m©chíd
);

925 
	}
}

927 
	$iwl_mvm_‰ob_txf
(*
˘x
, *
buf
, 
size_t
 
buÊí
)

929 
iwl_mvm_‰ob_txf_d©a
 
txf
 = {

930 .
buf
 = buf,

931 .
buÊí
 = buflen,

933 
iwl_mvm
 *
mvm
 = 
˘x
;

936 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

939 
	`rcu_ªad_lock
();

940 
	`õì80211_ôî_keys_rcu
(
mvm
->
hw
, 
NULL
, 
iwl_mvm_‰ob_txf_key_ôî
, &
txf
);

941 
	`rcu_ªad_u∆ock
();

942 
	}
}

944 
	$iwl_mvm_‰ob_hcmd
(*
˘x
, *
hcmd
, 
size_t
 
Àn
)

947 
iwl_cmd_hódî_wide
 *
hdr
 = 
hcmd
;

948 
‰ob_°¨t
 = (*
hdr
), 
‰ob_íd
 = 0;

950 i‡(
Àn
 < (
hdr
))

954 i‡(
hdr
->
group_id
 !
LONG_GROUP
)

957 
hdr
->
cmd
) {

958 
WEP_KEY
:

959 
WOWLAN_TKIP_PARAM
:

960 
WOWLAN_KEK_KCK_MATERIAL
:

961 
ADD_STA_KEY
:

966 
‰ob_íd
 = 
INT_MAX
;

968 
MGMT_MCAST_KEY
:

969 
‰ob_°¨t
 = 
	`off£tof
(
iwl_mvm_mgmt_mˇ°_key_cmd
, 
igtk
);

970 
	`BUILD_BUG_ON
(
	`off£tof
(
iwl_mvm_mgmt_mˇ°_key_cmd
, 
igtk
) !=

971 
	`off£tof
(
iwl_mvm_mgmt_mˇ°_key_cmd_v1
, 
igtk
));

973 
‰ob_íd
 = 
	`off£to„nd
(
iwl_mvm_mgmt_mˇ°_key_cmd
, 
igtk
);

974 
	`BUILD_BUG_ON
(
	`off£tof
(
iwl_mvm_mgmt_mˇ°_key_cmd
, 
igtk
) <

975 
	`off£tof
(
iwl_mvm_mgmt_mˇ°_key_cmd_v1
, 
igtk
));

979 i‡(
‰ob_°¨t
 >
‰ob_íd
)

982 i‡(
‰ob_íd
 > 
Àn
)

983 
‰ob_íd
 = 
Àn
;

985 
	`mem£t
((
u8
 *)
hcmd
 + 
‰ob_°¨t
, 0xAA, 
‰ob_íd
 - frob_start);

986 
	}
}

988 
	$iwl_mvm_‰ob_mem
(*
˘x
, 
u32
 
mem_addr
, *
mem
, 
size_t
 
buÊí
)

990 c⁄° 
iwl_dump_ex˛ude
 *
ex˛
;

991 
iwl_mvm
 *
mvm
 = 
˘x
;

992 
i
;

994 
mvm
->
fwπ
.
cur_fw_img
) {

995 
IWL_UCODE_INIT
:

999 
IWL_UCODE_REGULAR
:

1000 
IWL_UCODE_REGULAR_USNIFFER
:

1001 
ex˛
 = 
mvm
->
fw
->
dump_ex˛
;

1003 
IWL_UCODE_WOWLAN
:

1004 
ex˛
 = 
mvm
->
fw
->
dump_ex˛_wowœn
;

1008 
	`BUILD_BUG_ON
((
mvm
->
fw
->
dump_ex˛
) !=

1009 (
mvm
->
fw
->
dump_ex˛_wowœn
));

1011 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvm
->
fw
->
dump_ex˛
); i++) {

1012 
u32
 
°¨t
, 
íd
;

1014 i‡(!
ex˛
[
i
].
addr
 || !ex˛[i].
size
)

1017 
°¨t
 = 
ex˛
[
i
].
addr
;

1018 
íd
 = 
°¨t
 + 
ex˛
[
i
].
size
;

1020 i‡(
íd
 <
mem_addr
 || 
°¨t
 >mem_add∏+ 
buÊí
)

1023 i‡(
°¨t
 < 
mem_addr
)

1024 
°¨t
 = 
mem_addr
;

1026 i‡(
íd
 > 
mem_addr
 + 
buÊí
)

1027 
íd
 = 
mem_addr
 + 
buÊí
;

1029 
	`mem£t
((
u8
 *)
mem
 + 
°¨t
 - 
mem_addr
, 0xAA, 
íd
 - start);

1031 
	}
}

1033 c⁄° 
iwl_dump_ßnôize_›s
 
	giwl_mvm_ßnôize_›s
 = {

1034 .
‰ob_txf
 = 
iwl_mvm_‰ob_txf
,

1035 .
	g‰ob_hcmd
 = 
iwl_mvm_‰ob_hcmd
,

1036 .
	g‰ob_mem
 = 
iwl_mvm_‰ob_mem
,

1039 
	$iwl_mvm_me_c⁄n_°©us
(*
¥iv
, c⁄° 
iwl_mei_c⁄n_öfo
 *
c⁄n_öfo
)

1041 
iwl_mvm
 *
mvm
 = 
¥iv
;

1042 
iwl_mvm_csme_c⁄n_öfo
 *
¥ev_c⁄n_öfo
, *
cuº_c⁄n_öfo
;

1048 
¥ev_c⁄n_öfo
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
csme_c⁄n_öfo
, 
åue
);

1050 
cuº_c⁄n_öfo
 = 
	`kzÆloc
((*cuº_c⁄n_öfo), 
GFP_KERNEL
);

1051 i‡(!
cuº_c⁄n_öfo
)

1054 
cuº_c⁄n_öfo
->
c⁄n_öfo
 = *conn_info;

1056 
	`rcu_assign_poöãr
(
mvm
->
csme_c⁄n_öfo
, 
cuº_c⁄n_öfo
);

1058 i‡(
¥ev_c⁄n_öfo
)

1059 
	`k‰ì_rcu
(
¥ev_c⁄n_öfo
, 
rcu_hód
);

1060 
	}
}

1062 
	$iwl_mvm_mei_rfkûl
(*
¥iv
, 
boﬁ
 
blocked
,

1063 
boﬁ
 
csme_èkög_ow√rshù
)

1065 
iwl_mvm
 *
mvm
 = 
¥iv
;

1067 i‡(
blocked
 && !
csme_èkög_ow√rshù
)

1070 
mvm
->
mei_rfkûl_blocked
 = 
blocked
;

1071 i‡(!
mvm
->
hw_ªgi°îed
)

1074 
	`wùhy_rfkûl_£t_hw_°©e_ªas⁄
(
mvm
->
hw
->
wùhy
,

1075 
mvm
->
mei_rfkûl_blocked
,

1076 
RFKILL_HARD_BLOCK_NOT_OWNER
);

1077 
	}
}

1079 
	$iwl_mvm_mei_rﬂmög_f‹biddí
(*
¥iv
, 
boﬁ
 
f‹biddí
)

1081 
iwl_mvm
 *
mvm
 = 
¥iv
;

1083 i‡(!
mvm
->
hw_ªgi°îed
 || !mvm->
csme_vif
)

1086 
	`iwl_mvm_£nd_rﬂmög_f‹biddí_evít
(
mvm
, mvm->
csme_vif
, 
f‹biddí
);

1087 
	}
}

1089 
	$iwl_mvm_ßp_c⁄√˘ed_wk
(
w‹k_°ru˘
 *
wk
)

1091 
iwl_mvm
 *
mvm
 =

1092 
	`c⁄èöî_of
(
wk
, 
iwl_mvm
, 
ßp_c⁄√˘ed_wk
);

1093 
ªt
;

1095 
ªt
 = 
	`iwl_mvm_°¨t_gë_nvm
(
mvm
);

1096 i‡(
ªt
)

1097 
out_‰ì
;

1099 
ªt
 = 
	`iwl_mvm_°¨t_po°_nvm
(
mvm
);

1100 i‡(
ªt
)

1101 
out_‰ì
;

1105 
out_‰ì
:

1106 
	`IWL_ERR
(
mvm
, "Couldn't get started...\n");

1107 
	`iwl_mei_°¨t_uƒegi°î
();

1108 
	`iwl_mei_uƒegi°î_com∂ëe
();

1109 
	`iwl_fw_Êush_dumps
(&
mvm
->
fwπ
);

1110 
	`iwl_mvm_thîmÆ_exô
(
mvm
);

1111 
	`iwl_fw_ru¡ime_‰ì
(&
mvm
->
fwπ
);

1112 
	`iwl_phy_db_‰ì
(
mvm
->
phy_db
);

1113 
	`k‰ì
(
mvm
->
sˇn_cmd
);

1114 
	`iwl_å™s_›_mode_Àave
(
mvm
->
å™s
);

1115 
	`k‰ì
(
mvm
->
nvm_d©a
);

1116 
	`k‰ì
(
mvm
->
mei_nvm_d©a
);

1118 
	`õì80211_‰ì_hw
(
mvm
->
hw
);

1119 
	}
}

1121 
	$iwl_mvm_mei_ßp_c⁄√˘ed
(*
¥iv
)

1123 
iwl_mvm
 *
mvm
 = 
¥iv
;

1125 i‡(!
mvm
->
hw_ªgi°îed
)

1126 
	`scheduÀ_w‹k
(&
mvm
->
ßp_c⁄√˘ed_wk
);

1127 
	}
}

1129 
	$iwl_mvm_mei_nic_°ﬁí
(*
¥iv
)

1131 
iwl_mvm
 *
mvm
 = 
¥iv
;

1133 
	`π∆_lock
();

1134 
	`cfg80211_shutdown_Æl_öãrÁ˚s
(
mvm
->
hw
->
wùhy
);

1135 
	`π∆_u∆ock
();

1136 
	}
}

1138 c⁄° 
iwl_mei_›s
 
	gmei_›s
 = {

1139 .
me_c⁄n_°©us
 = 
iwl_mvm_me_c⁄n_°©us
,

1140 .
	grfkûl
 = 
iwl_mvm_mei_rfkûl
,

1141 .
	grﬂmög_f‹biddí
 = 
iwl_mvm_mei_rﬂmög_f‹biddí
,

1142 .
	gßp_c⁄√˘ed
 = 
iwl_mvm_mei_ßp_c⁄√˘ed
,

1143 .
	gnic_°ﬁí
 = 
iwl_mvm_mei_nic_°ﬁí
,

1146 
iwl_›_mode
 *

1147 
	$iwl_›_mode_mvm_°¨t
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_cfg
 *
cfg
,

1148 c⁄° 
iwl_fw
 *
fw
, 
díåy
 *
dbgfs_dú
)

1150 
õì80211_hw
 *
hw
;

1151 
iwl_›_mode
 *
›_mode
;

1152 
iwl_mvm
 *
mvm
;

1153 
iwl_å™s_c⁄fig
 
å™s_cfg
 = {};

1154 c⁄° 
u8
 
no_ª˛aim_cmds
[] = {

1155 
TX_CMD
,

1157 
u32
 
max_agg
;

1158 
size_t
 
sˇn_size
;

1159 
u32
 
mö_backoff
;

1160 
iwl_mvm_csme_c⁄n_öfo
 *
csme_c⁄n_öfo
 
__maybe_unu£d
;

1167 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
mvm
->
fw_id_to_mac_id
) !=

1168 
IWL_MVM_STATION_COUNT_MAX
);

1173 
hw
 = 
	`õì80211_Æloc_hw
((
iwl_›_mode
) +

1174 (
iwl_mvm
),

1175 
	`iwl_mvm_has_mld_≠i
(
fw
Ë? &
iwl_mvm_mld_hw_›s
 :

1176 &
iwl_mvm_hw_›s
);

1177 i‡(!
hw
)

1178  
NULL
;

1180 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

1181 
max_agg
 = 512;

1183 
max_agg
 = 
IEEE80211_MAX_AMPDU_BUF_HE
;

1185 
hw
->
max_rx_aggªg©i⁄_sub‰ames
 = 
max_agg
;

1187 i‡(
cfg
->
max_tx_agg_size
)

1188 
hw
->
max_tx_aggªg©i⁄_sub‰ames
 = 
cfg
->
max_tx_agg_size
;

1190 
hw
->
max_tx_aggªg©i⁄_sub‰ames
 = 
max_agg
;

1192 
›_mode
 = 
hw
->
¥iv
;

1194 
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1195 
mvm
->
dev
 = 
å™s
->dev;

1196 
mvm
->
å™s
 =Årans;

1197 
mvm
->
cfg
 = cfg;

1198 
mvm
->
fw
 = fw;

1199 
mvm
->
hw
 = hw;

1201 
	`iwl_fw_ru¡ime_öô
(&
mvm
->
fwπ
, 
å™s
, 
fw
, &
iwl_mvm_fwπ_›s
, mvm,

1202 &
iwl_mvm_ßnôize_›s
, 
mvm
, 
dbgfs_dú
);

1204 
	`iwl_mvm_gë_bios_èbÀs
(
mvm
);

1205 
	`iwl_uefi_gë_sgom_èbÀ
(
å™s
, &
mvm
->
fwπ
);

1206 
	`iwl_uefi_gë_°ï_èbÀ
(
å™s
);

1208 
mvm
->
öô_°©us
 = 0;

1210 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

1211 
›_mode
->
›s
 = &
iwl_mvm_›s_mq
;

1212 
å™s
->
rx_mpdu_cmd_hdr_size
 =

1213 (
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

1214 
IWL_DEVICE_FAMILY_AX210
) ?

1215 (
iwl_rx_mpdu_desc
) :

1216 
IWL_RX_DESC_SIZE_V1
;

1218 
›_mode
->
›s
 = &
iwl_mvm_›s
;

1219 
å™s
->
rx_mpdu_cmd_hdr_size
 =

1220 (
iwl_rx_mpdu_ªs_°¨t
);

1222 i‡(
	`WARN_ON
(
å™s
->
num_rx_queues
 > 1))

1223 
out_‰ì
;

1226 
mvm
->
fw_ª°¨t
 = 
iwlwifi_mod_∑øms
.fw_restart ? -1 : 0;

1228 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

1238 
mvm
->
aux_queue
 = 
IWL_MVM_INVALID_QUEUE
;

1239 
mvm
->
¢if_queue
 = 
IWL_MVM_INVALID_QUEUE
;

1240 
mvm
->
¥obe_queue
 = 
IWL_MVM_INVALID_QUEUE
;

1241 
mvm
->
p2p_dev_queue
 = 
IWL_MVM_INVALID_QUEUE
;

1243 
mvm
->
aux_queue
 = 
IWL_MVM_DQA_AUX_QUEUE
;

1244 
mvm
->
¢if_queue
 = 
IWL_MVM_DQA_INJECT_MONITOR_QUEUE
;

1245 
mvm
->
¥obe_queue
 = 
IWL_MVM_DQA_AP_PROBE_RESP_QUEUE
;

1246 
mvm
->
p2p_dev_queue
 = 
IWL_MVM_DQA_P2P_DEVICE_QUEUE
;

1249 
mvm
->
sf_°©e
 = 
SF_UNINIT
;

1250 i‡(
	`iwl_mvm_has_unifõd_ucode
(
mvm
))

1251 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
IWL_UCODE_REGULAR
);

1253 
	`iwl_fw_£t_cuºít_image
(&
mvm
->
fwπ
, 
IWL_UCODE_INIT
);

1254 
mvm
->
dr›_b˙_≠_mode
 = 
åue
;

1256 
	`muãx_öô
(&
mvm
->
muãx
);

1257 
	`•ö_lock_öô
(&
mvm
->
async_h™dÀrs_lock
);

1258 
	`INIT_LIST_HEAD
(&
mvm
->
time_evít_li°
);

1259 
	`INIT_LIST_HEAD
(&
mvm
->
aux_roc_ã_li°
);

1260 
	`INIT_LIST_HEAD
(&
mvm
->
async_h™dÀrs_li°
);

1261 
	`•ö_lock_öô
(&
mvm
->
time_evít_lock
);

1262 
	`INIT_LIST_HEAD
(&
mvm
->
·m_öôüt‹
.
loc_li°
);

1263 
	`INIT_LIST_HEAD
(&
mvm
->
·m_öôüt‹
.
∑¢_li°
);

1264 
	`INIT_LIST_HEAD
(&
mvm
->
ª•_∑¢_li°
);

1266 
	`INIT_WORK
(&
mvm
->
async_h™dÀrs_wk
, 
iwl_mvm_async_h™dÀrs_wk
);

1267 
	`INIT_WORK
(&
mvm
->
roc_d⁄e_wk
, 
iwl_mvm_roc_d⁄e_wk
);

1268 
	`INIT_WORK
(&
mvm
->
ßp_c⁄√˘ed_wk
, 
iwl_mvm_ßp_c⁄√˘ed_wk
);

1269 
	`INIT_DELAYED_WORK
(&
mvm
->
tdls_cs
.
dw‹k
, 
iwl_mvm_tdls_ch_swôch_w‹k
);

1270 
	`INIT_DELAYED_WORK
(&
mvm
->
sˇn_timeout_dw‹k
, 
iwl_mvm_sˇn_timeout_wk
);

1271 
	`INIT_WORK
(&
mvm
->
add_°ªam_wk
, 
iwl_mvm_add_√w_dqa_°ªam_wk
);

1272 
	`INIT_LIST_HEAD
(&
mvm
->
add_°ªam_txqs
);

1273 
	`•ö_lock_öô
(&
mvm
->
add_°ªam_lock
);

1275 
	`wùhy_w‹k_öô
(&
mvm
->
async_h™dÀrs_wùhy_wk
,

1276 
iwl_mvm_async_h™dÀrs_wùhy_wk
);

1277 
	`öô_waôqueue_hód
(&
mvm
->
rx_sync_waôq
);

1279 
mvm
->
queue_sync_°©e
 = 0;

1281 
	`SET_IEEE80211_DEV
(
mvm
->
hw
, mvm->
å™s
->
dev
);

1283 
	`•ö_lock_öô
(&
mvm
->
tcm
.
lock
);

1284 
	`INIT_DELAYED_WORK
(&
mvm
->
tcm
.
w‹k
, 
iwl_mvm_tcm_w‹k
);

1285 
mvm
->
tcm
.
ts
 = 
jiffõs
;

1286 
mvm
->
tcm
.
Œ_ts
 = 
jiffõs
;

1287 
mvm
->
tcm
.
u≠sd_n⁄agg_ts
 = 
jiffõs
;

1289 
	`INIT_DELAYED_WORK
(&
mvm
->
cs_tx_unblock_dw‹k
, 
iwl_mvm_tx_unblock_dw‹k
);

1291 
mvm
->
cmd_vî
.
ønge_ª•
 =

1292 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LOCATION_GROUP
,

1293 
TOF_RANGE_RESPONSE_NOTIF
, 5);

1295 i‡(
	`WARN_ON_ONCE
(
mvm
->
cmd_vî
.
ønge_ª•
 > 9))

1296 
out_‰ì
;

1302 
å™s_cfg
.
›_mode
 = op_mode;

1303 
å™s_cfg
.
no_ª˛aim_cmds
 =Ço_reclaim_cmds;

1304 
å™s_cfg
.
n_no_ª˛aim_cmds
 = 
	`ARRAY_SIZE
(
no_ª˛aim_cmds
);

1306 
iwlwifi_mod_∑øms
.
amsdu_size
) {

1307 
IWL_AMSDU_DEF
:

1308 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_4K
;

1310 
IWL_AMSDU_4K
:

1311 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_4K
;

1313 
IWL_AMSDU_8K
:

1314 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_8K
;

1316 
IWL_AMSDU_12K
:

1317 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_12K
;

1320 
	`¥_îr
("%s: Unsuµ‹ãdámsdu_size: %d\n", 
KBUILD_MODNAME
,

1321 
iwlwifi_mod_∑øms
.
amsdu_size
);

1322 
å™s_cfg
.
rx_buf_size
 = 
IWL_AMSDU_4K
;

1325 
å™s
->
wide_cmd_hódî
 = 
åue
;

1326 
å™s_cfg
.
bc_èbÀ_dw‹d
 =

1327 
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
;

1329 
å™s_cfg
.
comm™d_groups
 = 
iwl_mvm_groups
;

1330 
å™s_cfg
.
comm™d_groups_size
 = 
	`ARRAY_SIZE
(
iwl_mvm_groups
);

1332 
å™s_cfg
.
cmd_queue
 = 
IWL_MVM_DQA_CMD_QUEUE
;

1333 
å™s_cfg
.
cmd_fifo
 = 
IWL_MVM_TX_FIFO_CMD
;

1334 
å™s_cfg
.
scd_£t_a˘ive
 = 
åue
;

1336 
å™s_cfg
.
cb_d©a_offs
 = 
	`off£tof
(
õì80211_tx_öfo
,

1337 
drivî_d©a
[2]);

1340 
å™s_cfg
.
cmd_q_wdg_timeout
 =

1341 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
NULL
, 
Ál£
, 
åue
);

1343 
	`¢¥ötf
(
mvm
->
hw
->
wùhy
->
fw_vîsi⁄
,

1344 (
mvm
->
hw
->
wùhy
->
fw_vîsi⁄
),

1345 "%.31s", 
fw
->
fw_vîsi⁄
);

1347 
å™s_cfg
.
fw_ª£t_h™dshake
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1348 
IWL_UCODE_TLV_CAPA_FW_RESET_HANDSHAKE
);

1350 
å™s_cfg
.
queue_Æloc_cmd_vî
 =

1351 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1352 
	`WIDE_ID
(
DATA_PATH_GROUP
,

1353 
SCD_QUEUE_CONFIG_CMD
),

1355 
mvm
->
°a_ªmove_ªquúes_queue_ªmove
 =

1356 
å™s_cfg
.
queue_Æloc_cmd_vî
 > 0;

1358 
mvm
->
mld_≠i_is_u£d
 = 
	`iwl_mvm_has_mld_≠i
(mvm->
fw
);

1361 
	`iwl_å™s_c⁄figuª
(
mvm
->
å™s
, &
å™s_cfg
);

1363 
å™s
->
rx_mpdu_cmd
 = 
REPLY_RX_MPDU_CMD
;

1364 
å™s
->
dbg
.
de°_év
 = 
mvm
->
fw
->dbg.dest_tlv;

1365 
å™s
->
dbg
.
n_de°_ªg
 = 
mvm
->
fw
->dbg.n_dest_reg;

1366 
	`mem˝y
(
å™s
->
dbg
.
c⁄f_év
, 
mvm
->
fw
->dbg.conf_tlv,

1367 (
å™s
->
dbg
.
c⁄f_év
));

1368 
å™s
->
dbg
.
åiggî_év
 = 
mvm
->
fw
->dbg.trigger_tlv;

1370 
å™s
->
iml
 = 
mvm
->
fw
->iml;

1371 
å™s
->
iml_Àn
 = 
mvm
->
fw
->iml_len;

1374 
	`iwl_nŸifiˇti⁄_waô_öô
(&
mvm
->
nŸif_waô
);

1377 
mvm
->
phy_db
 = 
	`iwl_phy_db_öô
(
å™s
);

1378 i‡(!
mvm
->
phy_db
) {

1379 
	`IWL_ERR
(
mvm
, "Cannot initÖhy_db\n");

1380 
out_‰ì
;

1383 
	`IWL_INFO
(
mvm
, "Detected %s, REV=0x%X\n",

1384 
mvm
->
å™s
->
«me
, mvm->å™s->
hw_ªv
);

1386 i‡(
iwlwifi_mod_∑øms
.
nvm_fûe
)

1387 
mvm
->
nvm_fûe_«me
 = 
iwlwifi_mod_∑øms
.
nvm_fûe
;

1389 
	`IWL_DEBUG_EEPROM
(
mvm
->
å™s
->
dev
,

1392 
sˇn_size
 = 
	`iwl_mvm_sˇn_size
(
mvm
);

1394 
mvm
->
sˇn_cmd
 = 
	`kmÆloc
(
sˇn_size
, 
GFP_KERNEL
);

1395 i‡(!
mvm
->
sˇn_cmd
)

1396 
out_‰ì
;

1397 
mvm
->
sˇn_cmd_size
 = 
sˇn_size
;

1400 
mvm
->
aux_°a
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

1401 
mvm
->
¢if_°a
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

1404 
mvm
->
œ°_ebs_suc˚ssful
 = 
åue
;

1406 
mö_backoff
 = 
	`iwl_mvm_mö_backoff
(
mvm
);

1407 
	`iwl_mvm_thîmÆ_öôülize
(
mvm
, 
mö_backoff
);

1409 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
))

1410 
	`mem£t
(&
mvm
->
rx_°©s_v3
, 0,

1411 (
mvm_°©i°ics_rx_v3
));

1413 
	`mem£t
(&
mvm
->
rx_°©s
, 0, (
mvm_°©i°ics_rx
));

1415 
	`iwl_mvm_·m_öôüt‹_smoŸh_c⁄fig
(
mvm
);

1417 
	`iwl_mvm_öô_time_sync
(&
mvm
->
time_sync
);

1419 
mvm
->
debugfs_dú
 = 
dbgfs_dú
;

1421 
mvm
->
mei_ªgi°îed
 = !
	`iwl_mei_ªgi°î
(mvm, &
mei_›s
);

1423 
	`iwl_mvm_mei_sˇn_fûãr_öô
(&
mvm
->
mei_sˇn_fûãr
);

1425 i‡(
	`iwl_mvm_°¨t_gë_nvm
(
mvm
)) {

1431 i‡(
å™s
->
csme_own
 && 
mvm
->
mei_ªgi°îed
)

1432  
›_mode
;

1434 
out_thîmÆ_exô
;

1438 i‡(
	`iwl_mvm_°¨t_po°_nvm
(
mvm
))

1439 
out_thîmÆ_exô
;

1441  
›_mode
;

1443 
out_thîmÆ_exô
:

1444 
	`iwl_mvm_thîmÆ_exô
(
mvm
);

1445 i‡(
mvm
->
mei_ªgi°îed
) {

1446 
	`iwl_mei_°¨t_uƒegi°î
();

1447 
	`iwl_mei_uƒegi°î_com∂ëe
();

1449 
out_‰ì
:

1450 
	`iwl_fw_Êush_dumps
(&
mvm
->
fwπ
);

1451 
	`iwl_fw_ru¡ime_‰ì
(&
mvm
->
fwπ
);

1453 i‡(
iwlmvm_mod_∑øms
.
öô_dbg
)

1454  
›_mode
;

1455 
	`iwl_phy_db_‰ì
(
mvm
->
phy_db
);

1456 
	`k‰ì
(
mvm
->
sˇn_cmd
);

1457 
	`iwl_å™s_›_mode_Àave
(
å™s
);

1459 
	`õì80211_‰ì_hw
(
mvm
->
hw
);

1460  
NULL
;

1461 
	}
}

1463 
	$iwl_mvm_°›_devi˚
(
iwl_mvm
 *
mvm
)

1465 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1467 
	`iwl_fw_ˇn˚l_time°amp
(&
mvm
->
fwπ
);

1469 
	`˛ór_bô
(
IWL_MVM_STATUS_FIRMWARE_RUNNING
, &
mvm
->
°©us
);

1471 
	`iwl_fw_dbg_°›_sync
(&
mvm
->
fwπ
);

1472 
	`iwl_å™s_°›_devi˚
(
mvm
->
å™s
);

1473 
	`iwl_‰ì_fw_∑gög
(&
mvm
->
fwπ
);

1474 
	`iwl_fw_dump_c⁄f_˛ór
(&
mvm
->
fwπ
);

1475 
	`iwl_mvm_mei_devi˚_°©e
(
mvm
, 
Ál£
);

1476 
	}
}

1478 
	$iwl_›_mode_mvm_°›
(
iwl_›_mode
 *
›_mode
)

1480 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1481 
i
;

1483 i‡(
mvm
->
mei_ªgi°îed
) {

1484 
	`π∆_lock
();

1485 
	`iwl_mei_£t_√tdev
(
NULL
);

1486 
	`π∆_u∆ock
();

1487 
	`iwl_mei_°¨t_uƒegi°î
();

1494 
	`ˇn˚l_w‹k_sync
(&
mvm
->
ßp_c⁄√˘ed_wk
);

1496 
	`iwl_mvm_Àds_exô
(
mvm
);

1498 
	`iwl_mvm_thîmÆ_exô
(
mvm
);

1508 i‡(
mvm
->
hw_ªgi°îed
)

1509 
	`õì80211_uƒegi°î_hw
(
mvm
->
hw
);

1511 
	`k‰ì
(
mvm
->
sˇn_cmd
);

1512 
	`k‰ì
(
mvm
->
mˇ°_fûãr_cmd
);

1513 
mvm
->
mˇ°_fûãr_cmd
 = 
NULL
;

1515 
	`k‰ì
(
mvm
->
îr‹_ªcovîy_buf
);

1516 
mvm
->
îr‹_ªcovîy_buf
 = 
NULL
;

1518 
	`iwl_mvm_±p_ªmove
(
mvm
);

1520 
	`iwl_å™s_›_mode_Àave
(
mvm
->
å™s
);

1522 
	`iwl_phy_db_‰ì
(
mvm
->
phy_db
);

1523 
mvm
->
phy_db
 = 
NULL
;

1525 
	`k‰ì
(
mvm
->
nvm_d©a
);

1526 
	`k‰ì
(
mvm
->
mei_nvm_d©a
);

1527 
	`k‰ì
(
	`rcu_ac˚ss_poöãr
(
mvm
->
csme_c⁄n_öfo
));

1528 
	`k‰ì
(
mvm
->
ãmp_nvm_d©a
);

1529 
i
 = 0; i < 
NVM_MAX_NUM_SECTIONS
; i++)

1530 
	`k‰ì
(
mvm
->
nvm_£˘i⁄s
[
i
].
d©a
);

1532 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvm
->
tcm
.
w‹k
);

1534 
	`iwl_fw_ru¡ime_‰ì
(&
mvm
->
fwπ
);

1535 
	`muãx_de°roy
(&
mvm
->
muãx
);

1537 i‡(
mvm
->
mei_ªgi°îed
)

1538 
	`iwl_mei_uƒegi°î_com∂ëe
();

1540 
	`õì80211_‰ì_hw
(
mvm
->
hw
);

1541 
	}
}

1543 
	siwl_async_h™dÀr_íåy
 {

1544 
li°_hód
 
	mli°
;

1545 
iwl_rx_cmd_buf„r
 
	mrxb
;

1546 
iwl_rx_h™dÀr_c⁄ãxt
 
	mc⁄ãxt
;

1547 (*
	m‚
)(
iwl_mvm
 *
	mmvm
, 
iwl_rx_cmd_buf„r
 *
	mrxb
);

1550 
	$iwl_mvm_async_h™dÀrs_purge
(
iwl_mvm
 *
mvm
)

1552 
iwl_async_h™dÀr_íåy
 *
íåy
, *
tmp
;

1554 
	`•ö_lock_bh
(&
mvm
->
async_h™dÀrs_lock
);

1555 
	`li°_f‹_óch_íåy_ß„
(
íåy
, 
tmp
, &
mvm
->
async_h™dÀrs_li°
, 
li°
) {

1556 
	`iwl_‰ì_rxb
(&
íåy
->
rxb
);

1557 
	`li°_dñ
(&
íåy
->
li°
);

1558 
	`k‰ì
(
íåy
);

1560 
	`•ö_u∆ock_bh
(&
mvm
->
async_h™dÀrs_lock
);

1561 
	}
}

1567 
	$iwl_mvm_async_h™dÀrs_by_c⁄ãxt
(
iwl_mvm
 *
mvm
,

1568 
u8
 
c⁄ãxts
)

1570 
iwl_async_h™dÀr_íåy
 *
íåy
, *
tmp
;

1571 
	`LIST_HEAD
(
loˇl_li°
);

1578 
	`•ö_lock_bh
(&
mvm
->
async_h™dÀrs_lock
);

1579 
	`li°_f‹_óch_íåy_ß„
(
íåy
, 
tmp
, &
mvm
->
async_h™dÀrs_li°
, 
li°
) {

1580 i‡(!(
	`BIT
(
íåy
->
c⁄ãxt
Ë& 
c⁄ãxts
))

1582 
	`li°_dñ
(&
íåy
->
li°
);

1583 
	`li°_add_èû
(&
íåy
->
li°
, &
loˇl_li°
);

1585 
	`•ö_u∆ock_bh
(&
mvm
->
async_h™dÀrs_lock
);

1587 
	`li°_f‹_óch_íåy_ß„
(
íåy
, 
tmp
, &
loˇl_li°
, 
li°
) {

1588 i‡(
íåy
->
c⁄ãxt
 !
RX_HANDLER_ASYNC_UNLOCKED
)

1589 
	`muãx_lock
(&
mvm
->
muãx
);

1590 
íåy
->
	`‚
(
mvm
, &íåy->
rxb
);

1591 
	`iwl_‰ì_rxb
(&
íåy
->
rxb
);

1592 
	`li°_dñ
(&
íåy
->
li°
);

1593 i‡(
íåy
->
c⁄ãxt
 !
RX_HANDLER_ASYNC_UNLOCKED
)

1594 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1595 
	`k‰ì
(
íåy
);

1597 
	}
}

1599 
	$iwl_mvm_async_h™dÀrs_wùhy_wk
(
wùhy
 *wiphy,

1600 
wùhy_w‹k
 *
wk
)

1602 
iwl_mvm
 *
mvm
 =

1603 
	`c⁄èöî_of
(
wk
, 
iwl_mvm
, 
async_h™dÀrs_wùhy_wk
);

1604 
u8
 
c⁄ãxts
 = 
	`BIT
(
RX_HANDLER_ASYNC_LOCKED_WIPHY
);

1606 
	`iwl_mvm_async_h™dÀrs_by_c⁄ãxt
(
mvm
, 
c⁄ãxts
);

1607 
	}
}

1609 
	$iwl_mvm_async_h™dÀrs_wk
(
w‹k_°ru˘
 *
wk
)

1611 
iwl_mvm
 *
mvm
 =

1612 
	`c⁄èöî_of
(
wk
, 
iwl_mvm
, 
async_h™dÀrs_wk
);

1613 
u8
 
c⁄ãxts
 = 
	`BIT
(
RX_HANDLER_ASYNC_LOCKED
) |

1614 
	`BIT
(
RX_HANDLER_ASYNC_UNLOCKED
);

1616 
	`iwl_mvm_async_h™dÀrs_by_c⁄ãxt
(
mvm
, 
c⁄ãxts
);

1617 
	}
}

1619 
ölöe
 
	$iwl_mvm_rx_check_åiggî
(
iwl_mvm
 *
mvm
,

1620 
iwl_rx_∑ckë
 *
pkt
)

1622 
iwl_fw_dbg_åiggî_év
 *
åig
;

1623 
iwl_fw_dbg_åiggî_cmd
 *
cmds_åig
;

1624 
i
;

1626 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
NULL
,

1627 
FW_DBG_TRIGGER_FW_NOTIF
);

1628 i‡(!
åig
)

1631 
cmds_åig
 = (*)
åig
->
d©a
;

1633 
i
 = 0; i < 
	`ARRAY_SIZE
(
cmds_åig
->
cmds
); i++) {

1635 i‡(!
cmds_åig
->
cmds
[
i
].
cmd_id
)

1638 i‡(
cmds_åig
->
cmds
[
i
].
cmd_id
 !
pkt
->
hdr
.
cmd
 ||

1639 
cmds_åig
->
cmds
[
i
].
group_id
 !
pkt
->
hdr
.group_id)

1642 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

1644 
pkt
->
hdr
.
group_id
,Ökt->hdr.
cmd
);

1647 
	}
}

1649 
	$iwl_mvm_rx_comm⁄
(
iwl_mvm
 *
mvm
,

1650 
iwl_rx_cmd_buf„r
 *
rxb
,

1651 
iwl_rx_∑ckë
 *
pkt
)

1653 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1654 
i
;

1655 
iwl_dbg_év_ç_d©a
 
ç_d©a
 = { .
fw_pkt
 = 
pkt
 };

1657 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

1658 
IWL_FW_INI_TIME_POINT_FW_RSP_OR_NOTIF
, &
ç_d©a
);

1659 
	`iwl_mvm_rx_check_åiggî
(
mvm
, 
pkt
);

1666 
	`iwl_nŸifiˇti⁄_waô_nŸify
(&
mvm
->
nŸif_waô
, 
pkt
);

1668 
i
 = 0; i < 
	`ARRAY_SIZE
(
iwl_mvm_rx_h™dÀrs
); i++) {

1669 c⁄° 
iwl_rx_h™dÀrs
 *
rx_h
 = &
iwl_mvm_rx_h™dÀrs
[
i
];

1670 
iwl_async_h™dÀr_íåy
 *
íåy
;

1672 i‡(
rx_h
->
cmd_id
 !
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.
cmd
))

1675 i‡(
	`IWL_FW_CHECK
(
mvm
, 
pkt_Àn
 < 
rx_h
->
mö_size
,

1677 
rx_h
->
cmd_id
, 
pkt_Àn
,Ñx_h->
mö_size
))

1680 i‡(
rx_h
->
c⁄ãxt
 =
RX_HANDLER_SYNC
) {

1681 
rx_h
->
	`‚
(
mvm
, 
rxb
);

1685 
íåy
 = 
	`kzÆloc
((*íåy), 
GFP_ATOMIC
);

1687 i‡(!
íåy
)

1690 
íåy
->
rxb
.
_∑ge
 = 
	`rxb_°ól_∑ge
(rxb);

1691 
íåy
->
rxb
.
_off£t
 =Ñxb->_offset;

1692 
íåy
->
rxb
.
_rx_∑ge_‹dî
 =Ñxb->_rx_page_order;

1693 
íåy
->
‚
 = 
rx_h
->fn;

1694 
íåy
->
c⁄ãxt
 = 
rx_h
->context;

1695 
	`•ö_lock
(&
mvm
->
async_h™dÀrs_lock
);

1696 
	`li°_add_èû
(&
íåy
->
li°
, &
mvm
->
async_h™dÀrs_li°
);

1697 
	`•ö_u∆ock
(&
mvm
->
async_h™dÀrs_lock
);

1698 i‡(
rx_h
->
c⁄ãxt
 =
RX_HANDLER_ASYNC_LOCKED_WIPHY
)

1699 
	`wùhy_w‹k_queue
(
mvm
->
hw
->
wùhy
,

1700 &
mvm
->
async_h™dÀrs_wùhy_wk
);

1702 
	`scheduÀ_w‹k
(&
mvm
->
async_h™dÀrs_wk
);

1705 
	}
}

1707 
	$iwl_mvm_rx
(
iwl_›_mode
 *
›_mode
,

1708 
«pi_°ru˘
 *
«pi
,

1709 
iwl_rx_cmd_buf„r
 *
rxb
)

1711 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1712 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1713 
u16
 
cmd
 = 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.cmd);

1715 i‡(
	`likñy
(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
REPLY_RX_MPDU_CMD
)))

1716 
	`iwl_mvm_rx_rx_mpdu
(
mvm
, 
«pi
, 
rxb
);

1717 i‡(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
REPLY_RX_PHY_CMD
))

1718 
	`iwl_mvm_rx_rx_phy_cmd
(
mvm
, 
rxb
);

1720 
	`iwl_mvm_rx_comm⁄
(
mvm
, 
rxb
, 
pkt
);

1721 
	}
}

1723 
	$iwl_mvm_rx_mq
(
iwl_›_mode
 *
›_mode
,

1724 
«pi_°ru˘
 *
«pi
,

1725 
iwl_rx_cmd_buf„r
 *
rxb
)

1727 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1728 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1729 
u16
 
cmd
 = 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.cmd);

1731 i‡(
	`likñy
(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
REPLY_RX_MPDU_CMD
)))

1732 
	`iwl_mvm_rx_mpdu_mq
(
mvm
, 
«pi
, 
rxb
, 0);

1733 i‡(
	`u∆ikñy
(
cmd
 =
	`WIDE_ID
(
DATA_PATH_GROUP
,

1734 
RX_QUEUES_NOTIFICATION
)))

1735 
	`iwl_mvm_rx_queue_nŸif
(
mvm
, 
«pi
, 
rxb
, 0);

1736 i‡(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
FRAME_RELEASE
))

1737 
	`iwl_mvm_rx_‰ame_ªÀa£
(
mvm
, 
«pi
, 
rxb
, 0);

1738 i‡(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
BAR_FRAME_RELEASE
))

1739 
	`iwl_mvm_rx_b¨_‰ame_ªÀa£
(
mvm
, 
«pi
, 
rxb
, 0);

1740 i‡(
cmd
 =
	`WIDE_ID
(
DATA_PATH_GROUP
, 
RX_NO_DATA_NOTIF
))

1741 
	`iwl_mvm_rx_m⁄ô‹_no_d©a
(
mvm
, 
«pi
, 
rxb
, 0);

1743 
	`iwl_mvm_rx_comm⁄
(
mvm
, 
rxb
, 
pkt
);

1744 
	}
}

1746 
	$iwl_mvm_is_°©ic_queue
(
iwl_mvm
 *
mvm
, 
queue
)

1748  
queue
 =
mvm
->
aux_queue
 || queuê=mvm->
¥obe_queue
 ||

1749 
queue
 =
mvm
->
p2p_dev_queue
 || queuê=mvm->
¢if_queue
;

1750 
	}
}

1752 
	$iwl_mvm_queue_°©e_ch™ge
(
iwl_›_mode
 *
›_mode
,

1753 
hw_queue
, 
boﬁ
 
°¨t
)

1755 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1756 
õì80211_°a
 *
°a
;

1757 
õì80211_txq
 *
txq
;

1758 
iwl_mvm_txq
 *
mvmtxq
;

1759 
i
;

1760 
tid_bôm≠
;

1761 
iwl_mvm_°a
 *
mvm°a
;

1762 
u8
 
°a_id
;

1764 
°a_id
 = 
	`iwl_mvm_has_√w_tx_≠i
(
mvm
) ?

1765 
mvm
->
tvqm_öfo
[
hw_queue
].
°a_id
 :

1766 
mvm
->
queue_öfo
[
hw_queue
].
ø_°a_id
;

1768 i‡(
	`WARN_ON_ONCE
(
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
))

1771 
	`rcu_ªad_lock
();

1773 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

1774 i‡(
	`IS_ERR_OR_NULL
(
°a
))

1775 
out
;

1776 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1778 i‡(
	`iwl_mvm_is_°©ic_queue
(
mvm
, 
hw_queue
)) {

1779 i‡(!
°¨t
)

1780 
	`õì80211_°›_queues
(
mvm
->
hw
);

1781 i‡(
mvm°a
->
°a_°©e
 !
IEEE80211_STA_NOTEXIST
)

1782 
	`õì80211_wake_queues
(
mvm
->
hw
);

1784 
out
;

1787 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

1788 
tid
 = 
mvm
->
tvqm_öfo
[
hw_queue
].
txq_tid
;

1790 
tid_bôm≠
 = 
	`BIT
(
tid
);

1792 
tid_bôm≠
 = 
mvm
->
queue_öfo
[
hw_queue
].tid_bitmap;

1795 
	`f‹_óch_£t_bô
(
i
, &
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1) {

1796 
tid
 = 
i
;

1798 i‡(
tid
 =
IWL_MAX_TID_COUNT
)

1799 
tid
 = 
IEEE80211_NUM_TIDS
;

1801 
txq
 = 
°a
->txq[
tid
];

1802 
mvmtxq
 = 
	`iwl_mvm_txq_‰om_mac80211
(
txq
);

1803 i‡(
°¨t
)

1804 
	`˛ór_bô
(
IWL_MVM_TXQ_STATE_STOP_FULL
, &
mvmtxq
->
°©e
);

1806 
	`£t_bô
(
IWL_MVM_TXQ_STATE_STOP_FULL
, &
mvmtxq
->
°©e
);

1808 i‡(
°¨t
 && 
mvm°a
->
°a_°©e
 !
IEEE80211_STA_NOTEXIST
) {

1809 
	`loˇl_bh_dißbÀ
();

1810 
	`iwl_mvm_mac_ôxq_xmô
(
mvm
->
hw
, 
txq
);

1811 
	`loˇl_bh_íabÀ
();

1815 
out
:

1816 
	`rcu_ªad_u∆ock
();

1817 
	}
}

1819 
	$iwl_mvm_°›_sw_queue
(
iwl_›_mode
 *
›_mode
, 
hw_queue
)

1821 
	`iwl_mvm_queue_°©e_ch™ge
(
›_mode
, 
hw_queue
, 
Ál£
);

1822 
	}
}

1824 
	$iwl_mvm_wake_sw_queue
(
iwl_›_mode
 *
›_mode
, 
hw_queue
)

1826 
	`iwl_mvm_queue_°©e_ch™ge
(
›_mode
, 
hw_queue
, 
åue
);

1827 
	}
}

1829 
	$iwl_mvm_£t_rfkûl_°©e
(
iwl_mvm
 *
mvm
)

1831 
	`wùhy_rfkûl_£t_hw_°©e
(
mvm
->
hw
->
wùhy
,

1832 
	`iwl_mvm_is_ødio_kûÀd
(
mvm
));

1833 
	}
}

1835 
	$iwl_mvm_£t_hw_˘kûl_°©e
(
iwl_mvm
 *
mvm
, 
boﬁ
 
°©e
)

1837 i‡(
°©e
)

1838 
	`£t_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
);

1840 
	`˛ór_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
);

1842 
	`iwl_mvm_£t_rfkûl_°©e
(
mvm
);

1843 
	}
}

1845 
iwl_mvm_csme_c⁄n_öfo
 *
	$iwl_mvm_gë_csme_c⁄n_öfo
(
iwl_mvm
 *
mvm
)

1847  
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
csme_c⁄n_öfo
,

1848 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1849 
	}
}

1851 
boﬁ
 
	$iwl_mvm_£t_hw_rfkûl_°©e
(
iwl_›_mode
 *
›_mode
, 
boﬁ
 
°©e
)

1853 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1854 
boﬁ
 
rfkûl_ß„_öô_d⁄e
 = 
	`READ_ONCE
(
mvm
->rfkill_safe_init_done);

1855 
boﬁ
 
unifõd
 = 
	`iwl_mvm_has_unifõd_ucode
(
mvm
);

1857 i‡(
°©e
) {

1858 
	`£t_bô
(
IWL_MVM_STATUS_HW_RFKILL
, &
mvm
->
°©us
);

1859 
	`wake_up
(&
mvm
->
rx_sync_waôq
);

1861 
	`˛ór_bô
(
IWL_MVM_STATUS_HW_RFKILL
, &
mvm
->
°©us
);

1864 
	`iwl_mvm_£t_rfkûl_°©e
(
mvm
);

1867 i‡(
rfkûl_ß„_öô_d⁄e
)

1868 
	`iwl_ab‹t_nŸifiˇti⁄_waôs
(&
mvm
->
nŸif_waô
);

1874 i‡(
unifõd
)

1875  
Ál£
;

1881  
°©e
 && 
rfkûl_ß„_öô_d⁄e
;

1882 
	}
}

1884 
	$iwl_mvm_‰ì_skb
(
iwl_›_mode
 *
›_mode
, 
sk_buff
 *
skb
)

1886 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1887 
õì80211_tx_öfo
 *
öfo
;

1889 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1890 
	`iwl_å™s_‰ì_tx_cmd
(
mvm
->
å™s
, 
öfo
->
drivî_d©a
[1]);

1891 
	`õì80211_‰ì_txskb
(
mvm
->
hw
, 
skb
);

1892 
	}
}

1894 
	siwl_mvm_ª¥obe
 {

1895 
devi˚
 *
	mdev
;

1896 
w‹k_°ru˘
 
	mw‹k
;

1899 
	$iwl_mvm_ª¥obe_wk
(
w‹k_°ru˘
 *
wk
)

1901 
iwl_mvm_ª¥obe
 *
ª¥obe
;

1903 
ª¥obe
 = 
	`c⁄èöî_of
(
wk
, 
iwl_mvm_ª¥obe
, 
w‹k
);

1904 i‡(
	`devi˚_ª¥obe
(
ª¥obe
->
dev
))

1905 
	`dev_îr
(
ª¥obe
->
dev
, "reprobe failed!\n");

1906 
	`put_devi˚
(
ª¥obe
->
dev
);

1907 
	`k‰ì
(
ª¥obe
);

1908 
	`moduÀ_put
(
THIS_MODULE
);

1909 
	}
}

1911 
	$iwl_mvm_nic_ª°¨t
(
iwl_mvm
 *
mvm
, 
boﬁ
 
fw_îr‹
)

1913 
	`iwl_ab‹t_nŸifiˇti⁄_waôs
(&
mvm
->
nŸif_waô
);

1914 
	`iwl_dbg_év_dñ_timîs
(
mvm
->
å™s
);

1926 
	`iwl_mvm_ªp‹t_sˇn_ab‹ãd
(
mvm
);

1934 i‡(!
mvm
->
fw_ª°¨t
 && 
fw_îr‹
) {

1935 
	`iwl_fw_îr‹_cﬁÀ˘
(&
mvm
->
fwπ
, 
Ál£
);

1936 } i‡(
	`ã°_bô
(
IWL_MVM_STATUS_STARTING
,

1937 &
mvm
->
°©us
)) {

1938 
	`IWL_ERR
(
mvm
, "Starting mac,Ñetry will beÅriggeredányway\n");

1939 } i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

1940 
iwl_mvm_ª¥obe
 *
ª¥obe
;

1942 
	`IWL_ERR
(
mvm
,

1950 i‡(!
	`åy_moduÀ_gë
(
THIS_MODULE
)) {

1951 
	`IWL_ERR
(
mvm
, "Module is being unloaded -ábort\n");

1955 
ª¥obe
 = 
	`kzÆloc
((*ª¥obe), 
GFP_ATOMIC
);

1956 i‡(!
ª¥obe
) {

1957 
	`moduÀ_put
(
THIS_MODULE
);

1960 
ª¥obe
->
dev
 = 
	`gë_devi˚
(
mvm
->
å™s
->dev);

1961 
	`INIT_WORK
(&
ª¥obe
->
w‹k
, 
iwl_mvm_ª¥obe_wk
);

1962 
	`scheduÀ_w‹k
(&
ª¥obe
->
w‹k
);

1963 } i‡(
	`ã°_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
,

1964 &
mvm
->
°©us
)) {

1965 
	`IWL_ERR
(
mvm
, "HWÑestartálreadyÑequested, butÇot started\n");

1966 } i‡(
mvm
->
fwπ
.
cur_fw_img
 =
IWL_UCODE_REGULAR
 &&

1967 
mvm
->
hw_ªgi°îed
 &&

1968 !
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
mvm
->
å™s
->
°©us
)) {

1973 
	`£t_bô
(
IWL_MVM_STATUS_HW_RESTART_REQUESTED
, &
mvm
->
°©us
);

1975 i‡(
mvm
->
fw
->
ucode_ˇ∑
.
îr‹_log_size
) {

1976 
u32
 
§c_size
 = 
mvm
->
fw
->
ucode_ˇ∑
.
îr‹_log_size
;

1977 
u32
 
§c_addr
 = 
mvm
->
fw
->
ucode_ˇ∑
.
îr‹_log_addr
;

1978 
u8
 *
ªcovî_buf
 = 
	`kzÆloc
(
§c_size
, 
GFP_ATOMIC
);

1980 i‡(
ªcovî_buf
) {

1981 
mvm
->
îr‹_ªcovîy_buf
 = 
ªcovî_buf
;

1982 
	`iwl_å™s_ªad_mem_byãs
(
mvm
->
å™s
,

1983 
§c_addr
,

1984 
ªcovî_buf
,

1985 
§c_size
);

1989 
	`iwl_fw_îr‹_cﬁÀ˘
(&
mvm
->
fwπ
, 
Ál£
);

1991 i‡(
fw_îr‹
 && 
mvm
->
fw_ª°¨t
 > 0) {

1992 
mvm
->
fw_ª°¨t
--;

1993 
	`õì80211_ª°¨t_hw
(
mvm
->
hw
);

1994 } i‡(
mvm
->
fwπ
.
å™s
->
dbg
.
ª°¨t_ªquúed
) {

1995 
	`IWL_DEBUG_INFO
(
mvm
, "FWÑestartÑequestedáfter debug collection\n");

1996 
mvm
->
fwπ
.
å™s
->
dbg
.
ª°¨t_ªquúed
 = 
Ál£
;

1997 
	`õì80211_ª°¨t_hw
(
mvm
->
hw
);

1998 } i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 <
IWL_DEVICE_FAMILY_8000
) {

1999 
	`õì80211_ª°¨t_hw
(
mvm
->
hw
);

2002 
	}
}

2004 
	$iwl_mvm_nic_îr‹
(
iwl_›_mode
 *
›_mode
, 
boﬁ
 
sync
)

2006 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

2008 i‡(!
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
mvm
->
å™s
->
°©us
) &&

2009 !
	`ã°_™d_˛ór_bô
(
IWL_MVM_STATUS_SUPPRESS_ERROR_LOG_ONCE
,

2010 &
mvm
->
°©us
))

2011 
	`iwl_mvm_dump_nic_îr‹_log
(
mvm
);

2013 i‡(
sync
) {

2014 
	`iwl_fw_îr‹_cﬁÀ˘
(&
mvm
->
fwπ
, 
åue
);

2028 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_FIRMWARE_RUNNING
, &
mvm
->
°©us
))

2031 
	`iwl_mvm_nic_ª°¨t
(
mvm
, 
Ál£
);

2032 
	}
}

2034 
	$iwl_mvm_cmd_queue_fuŒ
(
iwl_›_mode
 *
›_mode
)

2036 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

2038 
	`WARN_ON
(1);

2039 
	`iwl_mvm_nic_ª°¨t
(
mvm
, 
åue
);

2040 
	}
}

2042 
	$iwl_›_mode_mvm_time_poöt
(
iwl_›_mode
 *
›_mode
,

2043 
iwl_fw_öi_time_poöt
 
ç_id
,

2044 
iwl_dbg_év_ç_d©a
 *
ç_d©a
)

2046 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

2048 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
, 
ç_id
, 
ç_d©a
);

2049 
	}
}

2051 
	#IWL_MVM_COMMON_OPS
 \

2053 .
queue_fuŒ
 = 
iwl_mvm_°›_sw_queue
, \

2054 .
queue_nŸ_fuŒ
 = 
iwl_mvm_wake_sw_queue
, \

2055 .
hw_rf_kûl
 = 
iwl_mvm_£t_hw_rfkûl_°©e
, \

2056 .
‰ì_skb
 = 
iwl_mvm_‰ì_skb
, \

2057 .
nic_îr‹
 = 
iwl_mvm_nic_îr‹
, \

2058 .
cmd_queue_fuŒ
 = 
iwl_mvm_cmd_queue_fuŒ
, \

2059 .
nic_c⁄fig
 = 
iwl_mvm_nic_c⁄fig
, \

2061 .
°¨t
 = 
iwl_›_mode_mvm_°¨t
, \

2062 .
°›
 = 
iwl_›_mode_mvm_°›
, \

2063 .
time_poöt
 = 
iwl_›_mode_mvm_time_poöt


	)

2065 c⁄° 
iwl_›_mode_›s
 
	giwl_mvm_›s
 = {

2066 
IWL_MVM_COMMON_OPS
,

2067 .
rx
 = 
iwl_mvm_rx
,

2070 
	$iwl_mvm_rx_mq_rss
(
iwl_›_mode
 *
›_mode
,

2071 
«pi_°ru˘
 *
«pi
,

2072 
iwl_rx_cmd_buf„r
 *
rxb
,

2073 
queue
)

2075 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

2076 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2077 
u16
 
cmd
 = 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.cmd);

2079 i‡(
	`u∆ikñy
(
queue
 >
mvm
->
å™s
->
num_rx_queues
))

2082 i‡(
	`u∆ikñy
(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
FRAME_RELEASE
)))

2083 
	`iwl_mvm_rx_‰ame_ªÀa£
(
mvm
, 
«pi
, 
rxb
, 
queue
);

2084 i‡(
	`u∆ikñy
(
cmd
 =
	`WIDE_ID
(
DATA_PATH_GROUP
,

2085 
RX_QUEUES_NOTIFICATION
)))

2086 
	`iwl_mvm_rx_queue_nŸif
(
mvm
, 
«pi
, 
rxb
, 
queue
);

2087 i‡(
	`likñy
(
cmd
 =
	`WIDE_ID
(
LEGACY_GROUP
, 
REPLY_RX_MPDU_CMD
)))

2088 
	`iwl_mvm_rx_mpdu_mq
(
mvm
, 
«pi
, 
rxb
, 
queue
);

2089 
	}
}

2091 c⁄° 
iwl_›_mode_›s
 
	giwl_mvm_›s_mq
 = {

2092 
IWL_MVM_COMMON_OPS
,

2093 .
rx
 = 
iwl_mvm_rx_mq
,

2094 .
	grx_rss
 = 
iwl_mvm_rx_mq_rss
,

	@mvm/phy-ctxt.c

7 
	~<√t/mac80211.h
>

8 
	~"fw-≠i.h
"

9 
	~"mvm.h
"

12 
u8
 
	$iwl_mvm_gë_ch™√l_width
(c⁄° 
cfg80211_ch™_def
 *
ch™def
)

14 
ch™def
->
width
) {

15 
NL80211_CHAN_WIDTH_20_NOHT
:

16 
NL80211_CHAN_WIDTH_20
:

17  
IWL_PHY_CHANNEL_MODE20
;

18 
NL80211_CHAN_WIDTH_40
:

19  
IWL_PHY_CHANNEL_MODE40
;

20 
NL80211_CHAN_WIDTH_80
:

21  
IWL_PHY_CHANNEL_MODE80
;

22 
NL80211_CHAN_WIDTH_160
:

23  
IWL_PHY_CHANNEL_MODE160
;

24 
NL80211_CHAN_WIDTH_320
:

25  
IWL_PHY_CHANNEL_MODE320
;

27 
	`WARN
(1, "InvÆid ch™√»width=%u", 
ch™def
->
width
);

28  
IWL_PHY_CHANNEL_MODE20
;

30 
	}
}

36 
u8
 
	$iwl_mvm_gë_˘æ_pos
(c⁄° 
cfg80211_ch™_def
 *
ch™def
)

38 
offs
 = 
ch™def
->
ch™
->
˚¡î_‰eq
 - ch™def->
˚¡î_‰eq1
;

39 
abs_offs
 = 
	`abs
(
offs
);

40 
u8
 
ªt
;

42 i‡(
offs
 == 0) {

52 
ªt
 = (
abs_offs
 - 10) / 20;

58 
ªt
 = (ªà& 
IWL_PHY_CTRL_POS_OFFS_MSK
) |

59 ((
ªt
 & 
	`BIT
(2)) << 1);

61 
ªt
 |(
offs
 > 0Ë* 
IWL_PHY_CTRL_POS_ABOVE
;

63  
ªt
;

64 
	}
}

69 
	$iwl_mvm_phy_˘xt_cmd_hdr
(
iwl_mvm_phy_˘xt
 *
˘xt
,

70 
iwl_phy_c⁄ãxt_cmd
 *
cmd
,

71 
u32
 
a˘i⁄
)

73 
cmd
->
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
˘xt
->
id
,

74 
˘xt
->
cﬁ‹
));

75 
cmd
->
a˘i⁄
 = 
	`˝u_to_À32
(action);

76 
	}
}

78 
	$iwl_mvm_phy_˘xt_£t_rxchaö
(
iwl_mvm
 *
mvm
,

79 
iwl_mvm_phy_˘xt
 *
˘xt
,

80 
__À32
 *
rxchaö_öfo
,

81 
u8
 
chaös_°©ic
,

82 
u8
 
chaös_dy«mic
)

84 
u8
 
a˘ive_˙t
, 
idÀ_˙t
;

87 
idÀ_˙t
 = 
chaös_°©ic
;

88 
a˘ive_˙t
 = 
chaös_dy«mic
;

97 i‡(
a˘ive_˙t
 =1 && 
	`iwl_mvm_rx_divîsôy_Ælowed
(
mvm
, 
˘xt
)) {

98 
idÀ_˙t
 = 2;

99 
a˘ive_˙t
 = 2;

102 *
rxchaö_öfo
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
) <<

103 
PHY_RX_CHAIN_VALID_POS
);

104 *
rxchaö_öfo
 |
	`˝u_to_À32
(
idÀ_˙t
 << 
PHY_RX_CHAIN_CNT_POS
);

105 *
rxchaö_öfo
 |
	`˝u_to_À32
(
a˘ive_˙t
 <<

106 
PHY_RX_CHAIN_MIMO_CNT_POS
);

107 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


108 i‡(
	`u∆ikñy
(
mvm
->
dbgfs_rx_phyöfo
))

109 *
rxchaö_öfo
 = 
	`˝u_to_À32
(
mvm
->
dbgfs_rx_phyöfo
);

111 
	}
}

116 
	$iwl_mvm_phy_˘xt_cmd_d©a_v1
(
iwl_mvm
 *
mvm
,

117 
iwl_mvm_phy_˘xt
 *
˘xt
,

118 
iwl_phy_c⁄ãxt_cmd_v1
 *
cmd
,

119 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

120 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
)

122 
iwl_phy_c⁄ãxt_cmd_èû
 *
èû
 =

123 
	`iwl_mvm_ch™_öfo_cmd_èû
(
mvm
, &
cmd
->
ci
);

126 
	`iwl_mvm_£t_ch™_öfo_ch™def
(
mvm
, &
cmd
->
ci
, 
ch™def
);

128 
	`iwl_mvm_phy_˘xt_£t_rxchaö
(
mvm
, 
˘xt
, &
èû
->
rxchaö_öfo
,

129 
chaös_°©ic
, 
chaös_dy«mic
);

131 
èû
->
txchaö_öfo
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
));

132 
	}
}

137 
	$iwl_mvm_phy_˘xt_cmd_d©a
(
iwl_mvm
 *
mvm
,

138 
iwl_mvm_phy_˘xt
 *
˘xt
,

139 
iwl_phy_c⁄ãxt_cmd
 *
cmd
,

140 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

141 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
)

143 
cmd
->
lmac_id
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_lmac_id
(
mvm
,

144 
ch™def
->
ch™
->
b™d
));

147 
	`iwl_mvm_£t_ch™_öfo_ch™def
(
mvm
, &
cmd
->
ci
, 
ch™def
);

150 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
RLC_CONFIG_CMD
), 0) < 2)

151 
	`iwl_mvm_phy_˘xt_£t_rxchaö
(
mvm
, 
˘xt
, &
cmd
->
rxchaö_öfo
,

152 
chaös_°©ic
, 
chaös_dy«mic
);

153 
	}
}

155 
	$iwl_mvm_phy_£nd_æc
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
,

156 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
)

158 
iwl_æc_c⁄fig_cmd
 
cmd
 = {

159 .
phy_id
 = 
	`˝u_to_À32
(
˘xt
->
id
),

162 i‡(
˘xt
->
æc_dißbÀd
)

165 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
	`WIDE_ID
(
DATA_PATH_GROUP
,

166 
RLC_CONFIG_CMD
), 0) < 2)

169 
	`BUILD_BUG_ON
(
IWL_RLC_CHAIN_INFO_DRIVER_FORCE
 !=

170 
PHY_RX_CHAIN_DRIVER_FORCE_MSK
);

171 
	`BUILD_BUG_ON
(
IWL_RLC_CHAIN_INFO_VALID
 !=

172 
PHY_RX_CHAIN_VALID_MSK
);

173 
	`BUILD_BUG_ON
(
IWL_RLC_CHAIN_INFO_FORCE
 !=

174 
PHY_RX_CHAIN_FORCE_SEL_MSK
);

175 
	`BUILD_BUG_ON
(
IWL_RLC_CHAIN_INFO_FORCE_MIMO
 !=

176 
PHY_RX_CHAIN_FORCE_MIMO_SEL_MSK
);

177 
	`BUILD_BUG_ON
(
IWL_RLC_CHAIN_INFO_COUNT
 !
PHY_RX_CHAIN_CNT_MSK
);

178 
	`BUILD_BUG_ON
(
IWL_RLC_CHAIN_INFO_MIMO_COUNT
 !=

179 
PHY_RX_CHAIN_MIMO_CNT_MSK
);

181 
	`iwl_mvm_phy_˘xt_£t_rxchaö
(
mvm
, 
˘xt
, &
cmd
.
æc
.
rx_chaö_öfo
,

182 
chaös_°©ic
, 
chaös_dy«mic
);

184 
	`IWL_DEBUG_FW
(
mvm
, "Send RLC command:Öhy=%d,Ñx_chain_info=0x%x\n",

185 
˘xt
->
id
, 
cmd
.
æc
.
rx_chaö_öfo
);

187  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`iwl_cmd_id
(
RLC_CONFIG_CMD
,

188 
DATA_PATH_GROUP
, 2),

189 0, (
cmd
), &cmd);

190 
	}
}

198 
	$iwl_mvm_phy_˘xt_≠∂y
(
iwl_mvm
 *
mvm
,

199 
iwl_mvm_phy_˘xt
 *
˘xt
,

200 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

201 c⁄° 
cfg80211_ch™_def
 *
≠
,

202 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
,

203 
u32
 
a˘i⁄
)

205 
ªt
;

206 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
PHY_CONTEXT_CMD
, 1);

208 i‡(
vî
 < 5 || !
≠
 || !≠->
ch™
)

209 
≠
 = 
NULL
;

211 i‡(
vî
 >= 3 && ver <= 6) {

212 
iwl_phy_c⁄ãxt_cmd
 
cmd
 = {};

215 
	`iwl_mvm_phy_˘xt_cmd_hdr
(
˘xt
, &
cmd
, 
a˘i⁄
);

218 
	`iwl_mvm_phy_˘xt_cmd_d©a
(
mvm
, 
˘xt
, &
cmd
, 
ch™def
,

219 
chaös_°©ic
,

220 
chaös_dy«mic
);

222 i‡(
≠
) {

223 
cmd
.
sbb_b™dwidth
 = 
	`iwl_mvm_gë_ch™√l_width
(
≠
);

224 
cmd
.
sbb_˘æ_ch™√l_loc
 = 
	`iwl_mvm_gë_˘æ_pos
(
≠
);

227 i‡(
vî
 == 6)

228 
cmd
.
pun˘uª_mask
 = 
	`˝u_to_À16
(
ch™def
->
pun˘uªd
);

230 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
PHY_CONTEXT_CMD
,

231 0, (
cmd
), &cmd);

232 } i‡(
vî
 < 3) {

233 
iwl_phy_c⁄ãxt_cmd_v1
 
cmd
 = {};

234 
u16
 
Àn
 = (
cmd
Ë- 
	`iwl_mvm_ch™_öfo_∑ddög
(
mvm
);

237 
	`iwl_mvm_phy_˘xt_cmd_hdr
(
˘xt
,

238 (
iwl_phy_c⁄ãxt_cmd
 *)&
cmd
,

239 
a˘i⁄
);

242 
	`iwl_mvm_phy_˘xt_cmd_d©a_v1
(
mvm
, 
˘xt
, &
cmd
, 
ch™def
,

243 
chaös_°©ic
,

244 
chaös_dy«mic
);

245 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
PHY_CONTEXT_CMD
,

246 0, 
Àn
, &
cmd
);

248 
	`IWL_ERR
(
mvm
, "PHY ctxàcmdÉº‹ vî %dÇŸ suµ‹ãd\n", 
vî
);

249  -
EOPNOTSUPP
;

253 i‡(
ªt
) {

254 
	`IWL_ERR
(
mvm
, "PHY ctxàcmdÉº‹.Ñë=%d\n", 
ªt
);

255  
ªt
;

258 i‡(
a˘i⁄
 !
FW_CTXT_ACTION_REMOVE
)

259  
	`iwl_mvm_phy_£nd_æc
(
mvm
, 
˘xt
, 
chaös_°©ic
,

260 
chaös_dy«mic
);

263 
	}
}

268 
	$iwl_mvm_phy_˘xt_add
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
,

269 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

270 c⁄° 
cfg80211_ch™_def
 *
≠
,

271 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
)

273 
ªt
;

275 
	`WARN_ON
(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) &&

276 
˘xt
->
ªf
);

277 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

279 
˘xt
->
ch™√l
 = 
ch™def
->
ch™
;

280 
˘xt
->
width
 = 
ch™def
->width;

281 
˘xt
->
˚¡î_‰eq1
 = 
ch™def
->center_freq1;

283 
ªt
 = 
	`iwl_mvm_phy_˘xt_≠∂y
(
mvm
, 
˘xt
, 
ch™def
, 
≠
,

284 
chaös_°©ic
, 
chaös_dy«mic
,

285 
FW_CTXT_ACTION_ADD
);

287 i‡(
ªt
)

288  
ªt
;

290 
˘xt
->
ªf
++;

293 
	}
}

299 
	$iwl_mvm_phy_˘xt_ªf
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
)

301 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

306 
	`WARN_ON
(!
˘xt
->
ªf
);

307 
˘xt
->
ªf
++;

308 
	}
}

315 
	$iwl_mvm_phy_˘xt_ch™ged
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
,

316 c⁄° 
cfg80211_ch™_def
 *
ch™def
,

317 c⁄° 
cfg80211_ch™_def
 *
≠
,

318 
u8
 
chaös_°©ic
, u8 
chaös_dy«mic
)

320 
iwl_˘xt_a˘i⁄
 
a˘i⁄
 = 
FW_CTXT_ACTION_MODIFY
;

322 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

324 i‡(
	`WARN_ON_ONCE
(!
˘xt
->
ªf
))

325  -
EINVAL
;

327 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
	`WIDE_ID
(
DATA_PATH_GROUP
,

328 
RLC_CONFIG_CMD
), 0) >= 2 &&

329 
˘xt
->
ch™√l
 =
ch™def
->
ch™
 &&

330 
˘xt
->
width
 =
ch™def
->width &&

331 
˘xt
->
˚¡î_‰eq1
 =
ch™def
->center_freq1)

332  
	`iwl_mvm_phy_£nd_æc
(
mvm
, 
˘xt
, 
chaös_°©ic
,

333 
chaös_dy«mic
);

335 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

336 
IWL_UCODE_TLV_CAPA_BINDING_CDB_SUPPORT
) &&

337 
˘xt
->
ch™√l
->
b™d
 !
ch™def
->
ch™
->band) {

338 
ªt
;

341 
ªt
 = 
	`iwl_mvm_phy_˘xt_≠∂y
(
mvm
, 
˘xt
, 
ch™def
, 
NULL
,

342 
chaös_°©ic
, 
chaös_dy«mic
,

343 
FW_CTXT_ACTION_REMOVE
);

344 i‡(
ªt
)

345  
ªt
;

348 
a˘i⁄
 = 
FW_CTXT_ACTION_ADD
;

351 
˘xt
->
ch™√l
 = 
ch™def
->
ch™
;

352 
˘xt
->
width
 = 
ch™def
->width;

353 
˘xt
->
˚¡î_‰eq1
 = 
ch™def
->center_freq1;

355  
	`iwl_mvm_phy_˘xt_≠∂y
(
mvm
, 
˘xt
, 
ch™def
, 
≠
,

356 
chaös_°©ic
, 
chaös_dy«mic
,

357 
a˘i⁄
);

358 
	}
}

360 
	$iwl_mvm_phy_˘xt_uƒef
(
iwl_mvm
 *
mvm
, 
iwl_mvm_phy_˘xt
 *
˘xt
)

362 
cfg80211_ch™_def
 
ch™def
;

363 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

365 i‡(
	`WARN_ON_ONCE
(!
˘xt
))

368 
˘xt
->
ªf
--;

370 i‡(
˘xt
->
ªf
)

373 
	`cfg80211_ch™def_¸óã
(&
ch™def
, 
˘xt
->
ch™√l
, 
NL80211_CHAN_NO_HT
);

375 
	`iwl_mvm_phy_˘xt_≠∂y
(
mvm
, 
˘xt
, &
ch™def
, 
NULL
, 1, 1,

376 
FW_CTXT_ACTION_REMOVE
);

377 
	}
}

379 
	$iwl_mvm_bödög_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

380 
õì80211_vif
 *
vif
)

382 *
d©a
 = 
_d©a
;

383 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

385 i‡(!
mvmvif
->
deÊök
.
phy_˘xt
)

388 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 ||

389 
vif
->
ty≥
 =
NL80211_IFTYPE_AP
)

390 
	`__£t_bô
(
mvmvif
->
deÊök
.
phy_˘xt
->
id
, 
d©a
);

391 
	}
}

393 
	$iwl_mvm_phy_˘x_cou¡
(
iwl_mvm
 *
mvm
)

395 
phy_˘xt_cou¡î
 = 0;

397 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

398 
IEEE80211_IFACE_ITER_NORMAL
,

399 
iwl_mvm_bödög_ôî©‹
,

400 &
phy_˘xt_cou¡î
);

402  
	`hweight8
(
phy_˘xt_cou¡î
);

403 
	}
}

	@mvm/power.c

7 
	~<löux/kî√l.h
>

8 
	~<löux/moduÀ.h
>

9 
	~<löux/¶ab.h
>

10 
	~<löux/ëhîdevi˚.h
>

12 
	~<√t/mac80211.h
>

14 
	~"iwl-debug.h
"

15 
	~"mvm.h
"

16 
	~"iwl-mod∑øms.h
"

17 
	~"fw/≠i/powî.h
"

19 
	#POWER_KEEP_ALIVE_PERIOD_SEC
 25

	)

22 
	$iwl_mvm_bóc⁄_fûãr_£nd_cmd
(
iwl_mvm
 *
mvm
,

23 
iwl_bóc⁄_fûãr_cmd
 *
cmd
)

25 
u16
 
Àn
;

27 
	`IWL_DEBUG_POWER
(
mvm
, "ba_enable_beacon_abort is: %d\n",

28 
	`À32_to_˝u
(
cmd
->
ba_íabÀ_bóc⁄_ab‹t
));

29 
	`IWL_DEBUG_POWER
(
mvm
, "ba_escape_timer is: %d\n",

30 
	`À32_to_˝u
(
cmd
->
ba_esˇ≥_timî
));

31 
	`IWL_DEBUG_POWER
(
mvm
, "bf_debug_flag is: %d\n",

32 
	`À32_to_˝u
(
cmd
->
bf_debug_Êag
));

33 
	`IWL_DEBUG_POWER
(
mvm
, "bf_enable_beacon_filter is: %d\n",

34 
	`À32_to_˝u
(
cmd
->
bf_íabÀ_bóc⁄_fûãr
));

35 
	`IWL_DEBUG_POWER
(
mvm
, "bf_energy_delta is: %d\n",

36 
	`À32_to_˝u
(
cmd
->
bf_íîgy_dñè
));

37 
	`IWL_DEBUG_POWER
(
mvm
, "bf_escape_timer is: %d\n",

38 
	`À32_to_˝u
(
cmd
->
bf_esˇ≥_timî
));

39 
	`IWL_DEBUG_POWER
(
mvm
, "bf_roaming_energy_delta is: %d\n",

40 
	`À32_to_˝u
(
cmd
->
bf_rﬂmög_íîgy_dñè
));

41 
	`IWL_DEBUG_POWER
(
mvm
, "bf_roaming_state is: %d\n",

42 
	`À32_to_˝u
(
cmd
->
bf_rﬂmög_°©e
));

43 
	`IWL_DEBUG_POWER
(
mvm
, "bf_temp_threshold is: %d\n",

44 
	`À32_to_˝u
(
cmd
->
bf_ãmp_thªshﬁd
));

45 
	`IWL_DEBUG_POWER
(
mvm
, "bf_temp_fast_filter is: %d\n",

46 
	`À32_to_˝u
(
cmd
->
bf_ãmp_Á°_fûãr
));

47 
	`IWL_DEBUG_POWER
(
mvm
, "bf_temp_slow_filter is: %d\n",

48 
	`À32_to_˝u
(
cmd
->
bf_ãmp_¶ow_fûãr
));

49 
	`IWL_DEBUG_POWER
(
mvm
, "bf_threshold_absolute_low is: %d, %d\n",

50 
	`À32_to_˝u
(
cmd
->
bf_thªshﬁd_absﬁuã_low
[0]),

51 
	`À32_to_˝u
(
cmd
->
bf_thªshﬁd_absﬁuã_low
[1]));

53 
	`IWL_DEBUG_POWER
(
mvm
, "bf_threshold_absolute_high is: %d, %d\n",

54 
	`À32_to_˝u
(
cmd
->
bf_thªshﬁd_absﬁuã_high
[0]),

55 
	`À32_to_˝u
(
cmd
->
bf_thªshﬁd_absﬁuã_high
[1]));

57 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

58 
IWL_UCODE_TLV_API_BEACON_FILTER_V4
))

59 
Àn
 = (
iwl_bóc⁄_fûãr_cmd
);

61 
Àn
 = 
	`off£tof
(
iwl_bóc⁄_fûãr_cmd
,

62 
bf_thªshﬁd_absﬁuã_low
);

64  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
REPLY_BEACON_FILTERING_CMD
, 0,

65 
Àn
, 
cmd
);

66 
	}
}

69 
	$iwl_mvm_bóc⁄_fûãr_£t_cqm_∑øms
(
iwl_mvm
 *
mvm
,

70 
õì80211_vif
 *
vif
,

71 
iwl_bóc⁄_fûãr_cmd
 *
cmd
)

73 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

75 i‡(
vif
->
bss_c⁄f
.
cqm_rssi_thﬁd
) {

76 
cmd
->
bf_íîgy_dñè
 =

77 
	`˝u_to_À32
(
vif
->
bss_c⁄f
.
cqm_rssi_hy°
);

79 
cmd
->
bf_rﬂmög_°©e
 =

80 
	`˝u_to_À32
(-
vif
->
bss_c⁄f
.
cqm_rssi_thﬁd
);

82 
cmd
->
ba_íabÀ_bóc⁄_ab‹t
 = 
	`˝u_to_À32
(
mvmvif
->
bf_d©a
.
ba_íabÀd
);

83 
	}
}

85 
	$iwl_mvm_powî_log
(
iwl_mvm
 *
mvm
,

86 
iwl_mac_powî_cmd
 *
cmd
)

88 
	`IWL_DEBUG_POWER
(
mvm
,

90 
cmd
->
id_™d_cﬁ‹
, 
iwlmvm_mod_∑øms
.
powî_scheme
,

91 
	`À16_to_˝u
(
cmd
->
Êags
));

92 
	`IWL_DEBUG_POWER
(
mvm
, "Keepálive = %u sec\n",

93 
	`À16_to_˝u
(
cmd
->
kìp_Æive_£c⁄ds
));

95 i‡(!(
cmd
->
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_POWER_MANAGEMENT_ENA_MSK
))) {

96 
	`IWL_DEBUG_POWER
(
mvm
, "DisableÖower management\n");

100 
	`IWL_DEBUG_POWER
(
mvm
, "RxÅimeout = %u usec\n",

101 
	`À32_to_˝u
(
cmd
->
rx_d©a_timeout
));

102 
	`IWL_DEBUG_POWER
(
mvm
, "TxÅimeout = %u usec\n",

103 
	`À32_to_˝u
(
cmd
->
tx_d©a_timeout
));

104 i‡(
cmd
->
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_SKIP_OVER_DTIM_MSK
))

105 
	`IWL_DEBUG_POWER
(
mvm
, "DTIMÖeriodsÅo skip = %u\n",

106 
cmd
->
skù_dtim_≥riods
);

107 i‡(
cmd
->
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_LPRX_ENA_MSK
))

108 
	`IWL_DEBUG_POWER
(
mvm
, "LP RX RSSIÅhreshold = %u\n",

109 
cmd
->
Õrx_rssi_thªshﬁd
);

110 i‡(
cmd
->
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_ADVANCE_PM_ENA_MSK
)) {

111 
	`IWL_DEBUG_POWER
(
mvm
, "uAPSDÉnabled\n");

112 
	`IWL_DEBUG_POWER
(
mvm
, "RxÅimeout (uAPSD) = %u usec\n",

113 
	`À32_to_˝u
(
cmd
->
rx_d©a_timeout_u≠sd
));

114 
	`IWL_DEBUG_POWER
(
mvm
, "TxÅimeout (uAPSD) = %u usec\n",

115 
	`À32_to_˝u
(
cmd
->
tx_d©a_timeout_u≠sd
));

116 
	`IWL_DEBUG_POWER
(
mvm
, "QNDP TID = %d\n", 
cmd
->
qndp_tid
);

117 
	`IWL_DEBUG_POWER
(
mvm
, "AC†Êag†0x%x\n", 
cmd
->
u≠sd_ac_Êags
);

118 
	`IWL_DEBUG_POWER
(
mvm
, "Max SP = %d\n", 
cmd
->
u≠sd_max_•
);

120 
	}
}

122 
	$iwl_mvm_powî_c⁄figuª_u≠sd
(
iwl_mvm
 *
mvm
,

123 
õì80211_vif
 *
vif
,

124 
iwl_mac_powî_cmd
 *
cmd
)

126 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

127 
õì80211_ac_numbîs
 
ac
;

128 
boﬁ
 
tid_found
 = 
Ál£
;

130 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
) ||

131 
cmd
->
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_SNOOZE_ENA_MSK
)) {

132 
cmd
->
rx_d©a_timeout_u≠sd
 =

133 
	`˝u_to_À32
(
IWL_MVM_WOWLAN_PS_RX_DATA_TIMEOUT
);

134 
cmd
->
tx_d©a_timeout_u≠sd
 =

135 
	`˝u_to_À32
(
IWL_MVM_WOWLAN_PS_TX_DATA_TIMEOUT
);

137 
cmd
->
rx_d©a_timeout_u≠sd
 =

138 
	`˝u_to_À32
(
IWL_MVM_UAPSD_RX_DATA_TIMEOUT
);

139 
cmd
->
tx_d©a_timeout_u≠sd
 =

140 
	`˝u_to_À32
(
IWL_MVM_UAPSD_TX_DATA_TIMEOUT
);

143 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


145 i‡(
mvmvif
->
dbgfs_pm
.
u£_ps_pﬁl
) {

146 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_ADVANCE_PM_ENA_MSK
);

151 
ac
 = 
IEEE80211_AC_VO
;á¯<
IEEE80211_AC_BK
;ác++) {

152 i‡(!
mvmvif
->
deÊök
.
queue_∑øms
[
ac
].
u≠sd
)

155 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
))

156 
cmd
->
Êags
 |=

157 
	`˝u_to_À16
(
POWER_FLAGS_ADVANCE_PM_ENA_MSK
);

159 
cmd
->
u≠sd_ac_Êags
 |
	`BIT
(
ac
);

162 i‡(!
tid_found
 && !
mvmvif
->
deÊök
.
queue_∑øms
[
ac
].
acm
) {

163 
tid_found
 = 
åue
;

164 
ac
) {

165 
IEEE80211_AC_VO
:

166 
cmd
->
qndp_tid
 = 6;

168 
IEEE80211_AC_VI
:

169 
cmd
->
qndp_tid
 = 5;

171 
IEEE80211_AC_BE
:

172 
cmd
->
qndp_tid
 = 0;

174 
IEEE80211_AC_BK
:

175 
cmd
->
qndp_tid
 = 1;

181 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_UAPSD_MISBEHAVING_ENA_MSK
);

183 i‡(
cmd
->
u≠sd_ac_Êags
 =(
	`BIT
(
IEEE80211_AC_VO
) |

184 
	`BIT
(
IEEE80211_AC_VI
) |

185 
	`BIT
(
IEEE80211_AC_BE
) |

186 
	`BIT
(
IEEE80211_AC_BK
))) {

187 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_SNOOZE_ENA_MSK
);

188 
cmd
->
¢ooze_öãrvÆ
 = 
	`˝u_to_À16
(
IWL_MVM_PS_SNOOZE_INTERVAL
);

189 
cmd
->
¢ooze_wödow
 =

190 
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
) ?

191 
	`˝u_to_À16
(
IWL_MVM_WOWLAN_PS_SNOOZE_WINDOW
) :

192 
	`˝u_to_À16
(
IWL_MVM_PS_SNOOZE_WINDOW
);

195 
cmd
->
u≠sd_max_•
 = 
mvm
->
hw
->
u≠sd_max_•_Àn
;

197 i‡(
cmd
->
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_SNOOZE_ENA_MSK
)) {

198 
cmd
->
hóvy_tx_thld_∑ckës
 =

199 
IWL_MVM_PS_SNOOZE_HEAVY_TX_THLD_PACKETS
;

200 
cmd
->
hóvy_rx_thld_∑ckës
 =

201 
IWL_MVM_PS_SNOOZE_HEAVY_RX_THLD_PACKETS
;

203 
cmd
->
hóvy_tx_thld_∑ckës
 =

204 
IWL_MVM_PS_HEAVY_TX_THLD_PACKETS
;

205 
cmd
->
hóvy_rx_thld_∑ckës
 =

206 
IWL_MVM_PS_HEAVY_RX_THLD_PACKETS
;

208 
cmd
->
hóvy_tx_thld_≥r˚¡age
 =

209 
IWL_MVM_PS_HEAVY_TX_THLD_PERCENT
;

210 
cmd
->
hóvy_rx_thld_≥r˚¡age
 =

211 
IWL_MVM_PS_HEAVY_RX_THLD_PERCENT
;

212 
	}
}

214 
	$iwl_mvm_p2p_°™dÆ⁄e_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

215 
õì80211_vif
 *
vif
)

217 
boﬁ
 *
is_p2p_°™dÆ⁄e
 = 
_d©a
;

219 
	`õì80211_vif_ty≥_p2p
(
vif
)) {

220 
NL80211_IFTYPE_P2P_GO
:

221 
NL80211_IFTYPE_AP
:

222 *
is_p2p_°™dÆ⁄e
 = 
Ál£
;

224 
NL80211_IFTYPE_STATION
:

225 i‡(
vif
->
cfg
.
assoc
)

226 *
is_p2p_°™dÆ⁄e
 = 
Ál£
;

232 
	}
}

234 
boﬁ
 
	$iwl_mvm_powî_Ælow_u≠sd
(
iwl_mvm
 *
mvm
,

235 
õì80211_vif
 *
vif
)

237 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

239 i‡(
	`ëhî_addr_equÆ
(
mvmvif
->
u≠sd_misbehavög_≠_addr
,

240 
vif
->
cfg
.
≠_addr
))

241  
Ál£
;

247 i‡(
vif
->
p2p
 &&

248 (
vif
->
bss_c⁄f
.
p2p_nﬂ_©å
.
›µs_˘wödow
 &

249 
IEEE80211_P2P_OPPPS_ENABLE_BIT
))

250  
Ál£
;

256 i‡(
	`iwl_mvm_phy_˘x_cou¡
(
mvm
) >= 2)

257  
Ál£
;

259 i‡(
vif
->
p2p
) {

261 
boﬁ
 
is_p2p_°™dÆ⁄e
 = 
åue
;

263 i‡(!
	`iwl_mvm_is_p2p_scm_u≠sd_suµ‹ãd
(
mvm
))

264  
Ál£
;

266 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

267 
IEEE80211_IFACE_ITER_NORMAL
,

268 
iwl_mvm_p2p_°™dÆ⁄e_ôî©‹
,

269 &
is_p2p_°™dÆ⁄e
);

271 i‡(!
is_p2p_°™dÆ⁄e
)

272  
Ál£
;

275  
åue
;

276 
	}
}

278 
boﬁ
 
	$iwl_mvm_powî_is_ød¨
(
õì80211_vif
 *
vif
)

280 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

281 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

282 
boﬁ
 
ød¨_dëe˘
 = 
Ál£
;

283 
lök_id
;

285 
	`rcu_ªad_lock
();

286 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
) {

287 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
lök_c⁄f
->chanctx_conf);

289 i‡(!
ch™˘x_c⁄f
)

292 
ød¨_dëe˘
 = !!(
ch™˘x_c⁄f
->
def
.
ch™
->
Êags
 &

293 
IEEE80211_CHAN_RADAR
);

294 i‡(
ød¨_dëe˘
)

295 
out
;

298 
out
:

299 
	`rcu_ªad_u∆ock
();

300  
ød¨_dëe˘
;

301 
	}
}

303 
	$iwl_mvm_powî_c⁄fig_skù_dtim
(
iwl_mvm
 *
mvm
,

304 
õì80211_vif
 *
vif
,

305 
iwl_mac_powî_cmd
 *
cmd
)

307 
dtim≥r
 = 
vif
->
bss_c⁄f
.
dtim_≥riod
 ?: 1;

308 
skù
;

311 
cmd
->
skù_dtim_≥riods
 = 0;

312 
cmd
->
Êags
 &~
	`˝u_to_À16
(
POWER_FLAGS_SKIP_OVER_DTIM_MSK
);

314 i‡(
	`iwl_mvm_powî_is_ød¨
(
vif
))

317 i‡(
dtim≥r
 >= 10)

320 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
)) {

321 i‡(
iwlmvm_mod_∑øms
.
powî_scheme
 !
IWL_POWER_SCHEME_LP
)

323 
skù
 = 2;

325 
dtim≥r_tu
 = 
dtim≥r
 * 
vif
->
bss_c⁄f
.
bóc⁄_öt
;

327 i‡(
	`WARN_ON
(!
dtim≥r_tu
))

330 
skù
 = 
	`max_t
(
u8
, 1, 900 / 
dtim≥r_tu
);

333 
cmd
->
skù_dtim_≥riods
 = 
skù
;

334 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_SKIP_OVER_DTIM_MSK
);

335 
	}
}

337 
	$iwl_mvm_powî_buûd_cmd
(
iwl_mvm
 *
mvm
,

338 
õì80211_vif
 *
vif
,

339 
iwl_mac_powî_cmd
 *
cmd
)

341 
dtim≥r
, 
bi
;

342 
kìp_Æive
;

343 
iwl_mvm_vif
 *
mvmvif
 
__maybe_unu£d
 =

344 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

346 
cmd
->
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

347 
mvmvif
->
cﬁ‹
));

348 
dtim≥r
 = 
vif
->
bss_c⁄f
.
dtim_≥riod
;

349 
bi
 = 
vif
->
bss_c⁄f
.
bóc⁄_öt
;

357 
kìp_Æive
 = 
	`DIV_ROUND_UP
(
	`õì80211_tu_to_u£c
(3 * 
dtim≥r
 * 
bi
),

358 
USEC_PER_SEC
);

359 
kìp_Æive
 = 
	`max
(kìp_Æive, 
POWER_KEEP_ALIVE_PERIOD_SEC
);

360 
cmd
->
kìp_Æive_£c⁄ds
 = 
	`˝u_to_À16
(
kìp_Æive
);

362 i‡(
mvm
->
ps_dißbÀd
)

365 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_POWER_SAVE_ENA_MSK
);

367 i‡(!
vif
->
cfg
.
ps
 || !
mvmvif
->
pm_íabÀd
)

370 i‡(
	`iwl_mvm_vif_low_œãncy
(
mvmvif
Ë&& 
vif
->
p2p
 &&

371 (!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

372 
IWL_UCODE_TLV_CAPA_SHORT_PM_TIMEOUTS
) ||

373 !
IWL_MVM_P2P_LOWLATENCY_PS_ENABLE
))

376 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_POWER_MANAGEMENT_ENA_MSK
);

378 i‡(
vif
->
bss_c⁄f
.
bóc⁄_øã
 &&

379 (
vif
->
bss_c⁄f
.
bóc⁄_øã
->
bôøã
 == 10 ||

380 
vif
->
bss_c⁄f
.
bóc⁄_øã
->
bôøã
 == 60)) {

381 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_LPRX_ENA_MSK
);

382 
cmd
->
Õrx_rssi_thªshﬁd
 = 
POWER_LPRX_RSSI_THRESHOLD
;

385 
	`iwl_mvm_powî_c⁄fig_skù_dtim
(
mvm
, 
vif
, 
cmd
);

387 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
)) {

388 
cmd
->
rx_d©a_timeout
 =

389 
	`˝u_to_À32
(
IWL_MVM_WOWLAN_PS_RX_DATA_TIMEOUT
);

390 
cmd
->
tx_d©a_timeout
 =

391 
	`˝u_to_À32
(
IWL_MVM_WOWLAN_PS_TX_DATA_TIMEOUT
);

392 } i‡(
	`iwl_mvm_vif_low_œãncy
(
mvmvif
Ë&& 
vif
->
p2p
 &&

393 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

394 
IWL_UCODE_TLV_CAPA_SHORT_PM_TIMEOUTS
)) {

395 
cmd
->
tx_d©a_timeout
 =

396 
	`˝u_to_À32
(
IWL_MVM_SHORT_PS_TX_DATA_TIMEOUT
);

397 
cmd
->
rx_d©a_timeout
 =

398 
	`˝u_to_À32
(
IWL_MVM_SHORT_PS_RX_DATA_TIMEOUT
);

400 
cmd
->
rx_d©a_timeout
 =

401 
	`˝u_to_À32
(
IWL_MVM_DEFAULT_PS_RX_DATA_TIMEOUT
);

402 
cmd
->
tx_d©a_timeout
 =

403 
	`˝u_to_À32
(
IWL_MVM_DEFAULT_PS_TX_DATA_TIMEOUT
);

406 i‡(
	`iwl_mvm_powî_Ælow_u≠sd
(
mvm
, 
vif
))

407 
	`iwl_mvm_powî_c⁄figuª_u≠sd
(
mvm
, 
vif
, 
cmd
);

409 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


410 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_KEEP_ALIVE
)

411 
cmd
->
kìp_Æive_£c⁄ds
 =

412 
	`˝u_to_À16
(
mvmvif
->
dbgfs_pm
.
kìp_Æive_£c⁄ds
);

413 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_SKIP_OVER_DTIM
) {

414 i‡(
mvmvif
->
dbgfs_pm
.
skù_ovî_dtim
)

415 
cmd
->
Êags
 |=

416 
	`˝u_to_À16
(
POWER_FLAGS_SKIP_OVER_DTIM_MSK
);

418 
cmd
->
Êags
 &=

419 
	`˝u_to_À16
(~
POWER_FLAGS_SKIP_OVER_DTIM_MSK
);

421 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_RX_DATA_TIMEOUT
)

422 
cmd
->
rx_d©a_timeout
 =

423 
	`˝u_to_À32
(
mvmvif
->
dbgfs_pm
.
rx_d©a_timeout
);

424 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_TX_DATA_TIMEOUT
)

425 
cmd
->
tx_d©a_timeout
 =

426 
	`˝u_to_À32
(
mvmvif
->
dbgfs_pm
.
tx_d©a_timeout
);

427 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_SKIP_DTIM_PERIODS
)

428 
cmd
->
skù_dtim_≥riods
 = 
mvmvif
->
dbgfs_pm
.skip_dtim_periods;

429 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_LPRX_ENA
) {

430 i‡(
mvmvif
->
dbgfs_pm
.
Õrx_ía
)

431 
cmd
->
Êags
 |
	`˝u_to_À16
(
POWER_FLAGS_LPRX_ENA_MSK
);

433 
cmd
->
Êags
 &
	`˝u_to_À16
(~
POWER_FLAGS_LPRX_ENA_MSK
);

435 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_LPRX_RSSI_THRESHOLD
)

436 
cmd
->
Õrx_rssi_thªshﬁd
 = 
mvmvif
->
dbgfs_pm
.lprx_rssi_threshold;

437 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_SNOOZE_ENABLE
) {

438 i‡(
mvmvif
->
dbgfs_pm
.
¢ooze_ía
)

439 
cmd
->
Êags
 |=

440 
	`˝u_to_À16
(
POWER_FLAGS_SNOOZE_ENA_MSK
);

442 
cmd
->
Êags
 &=

443 
	`˝u_to_À16
(~
POWER_FLAGS_SNOOZE_ENA_MSK
);

445 i‡(
mvmvif
->
dbgfs_pm
.
mask
 & 
MVM_DEBUGFS_PM_UAPSD_MISBEHAVING
) {

446 
u16
 
Êag
 = 
POWER_FLAGS_UAPSD_MISBEHAVING_ENA_MSK
;

447 i‡(
mvmvif
->
dbgfs_pm
.
u≠sd_misbehavög
)

448 
cmd
->
Êags
 |
	`˝u_to_À16
(
Êag
);

450 
cmd
->
Êags
 &
	`˝u_to_À16
(
Êag
);

453 
	}
}

455 
	$iwl_mvm_powî_£nd_cmd
(
iwl_mvm
 *
mvm
,

456 
õì80211_vif
 *
vif
)

458 
iwl_mac_powî_cmd
 
cmd
 = {};

460 
	`iwl_mvm_powî_buûd_cmd
(
mvm
, 
vif
, &
cmd
);

461 
	`iwl_mvm_powî_log
(
mvm
, &
cmd
);

462 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


463 
	`mem˝y
(&
	`iwl_mvm_vif_‰om_mac80211
(
vif
)->
mac_pwr_cmd
, &
cmd
, (cmd));

466  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
MAC_PM_POWER_TABLE
, 0,

467 (
cmd
), &cmd);

468 
	}
}

470 
	$iwl_mvm_powî_upd©e_devi˚
(
iwl_mvm
 *
mvm
)

472 
iwl_devi˚_powî_cmd
 
cmd
 = {

473 .
Êags
 = 0,

476 i‡(
iwlmvm_mod_∑øms
.
powî_scheme
 =
IWL_POWER_SCHEME_CAM
)

477 
mvm
->
ps_dißbÀd
 = 
åue
;

479 i‡(!
mvm
->
ps_dißbÀd
)

480 
cmd
.
Êags
 |
	`˝u_to_À16
(
DEVICE_POWER_FLAGS_POWER_SAVE_ENA_MSK
);

482 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


483 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
) ?

484 
mvm
->
dißbÀ_powî_off_d3
 : mvm->
dißbÀ_powî_off
)

485 
cmd
.
Êags
 &=

486 
	`˝u_to_À16
(~
DEVICE_POWER_FLAGS_POWER_SAVE_ENA_MSK
);

488 i‡(
mvm
->
ext_˛ock_vÆid
)

489 
cmd
.
Êags
 |
	`˝u_to_À16
(
DEVICE_POWER_FLAGS_32K_CLK_VALID_MSK
);

491 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
POWER_TABLE_CMD
, 0) >= 7 &&

492 
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
))

493 
cmd
.
Êags
 |=

494 
	`˝u_to_À16
(
DEVICE_POWER_FLAGS_NO_SLEEP_TILL_D3_MSK
);

496 
	`IWL_DEBUG_POWER
(
mvm
,

498 
cmd
.
Êags
);

500  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
POWER_TABLE_CMD
, 0, (
cmd
),

501 &
cmd
);

502 
	}
}

504 
	$iwl_mvm_powî_vif_assoc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

506 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

508 i‡(!
	`ëhî_addr_equÆ
(
mvmvif
->
u≠sd_misbehavög_≠_addr
,

509 
vif
->
cfg
.
≠_addr
))

510 
	`ëh_zîo_addr
(
mvmvif
->
u≠sd_misbehavög_≠_addr
);

511 
	}
}

513 
	$iwl_mvm_powî_u≠sd_misbehav_≠_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

514 
õì80211_vif
 *
vif
)

516 
u8
 *
≠_°a_id
 = 
_d©a
;

517 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

518 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

519 
lök_id
;

521 
	`rcu_ªad_lock
();

522 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
) {

523 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

528 i‡(
lök_öfo
->
≠_°a_id
 == *ap_sta_id) {

529 
	`ëhî_addr_c›y
(
mvmvif
->
u≠sd_misbehavög_≠_addr
,

530 
vif
->
cfg
.
≠_addr
);

534 
	`rcu_ªad_u∆ock
();

535 
	}
}

537 
	$iwl_mvm_powî_u≠sd_misbehavög_≠_nŸif
(
iwl_mvm
 *
mvm
,

538 
iwl_rx_cmd_buf„r
 *
rxb
)

540 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

541 
iwl_u≠sd_misbehavög_≠_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

542 
u8
 
≠_°a_id
 = 
	`À32_to_˝u
(
nŸif
->
°a_id
);

544 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

545 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

546 
iwl_mvm_powî_u≠sd_misbehav_≠_ôî©‹
, &
≠_°a_id
);

547 
	}
}

549 
	siwl_powî_vifs
 {

550 
iwl_mvm
 *
	mmvm
;

551 
õì80211_vif
 *
	mbss_vif
;

552 
õì80211_vif
 *
	mp2p_vif
;

553 
õì80211_vif
 *
	m≠_vif
;

554 
õì80211_vif
 *
	mm⁄ô‹_vif
;

555 
boﬁ
 
	mp2p_a˘ive
;

556 
boﬁ
 
	mbss_a˘ive
;

557 
boﬁ
 
	m≠_a˘ive
;

558 
boﬁ
 
	mm⁄ô‹_a˘ive
;

561 
	$iwl_mvm_powî_dißbÀ_pm_ôî©‹
(*
_d©a
, 
u8
* 
mac
,

562 
õì80211_vif
 *
vif
)

564 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

566 
mvmvif
->
pm_íabÀd
 = 
Ál£
;

567 
	}
}

569 
	$iwl_mvm_powî_ps_dißbÀd_ôî©‹
(*
_d©a
, 
u8
* 
mac
,

570 
õì80211_vif
 *
vif
)

572 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

573 
boﬁ
 *
dißbÀ_ps
 = 
_d©a
;

575 i‡(
	`iwl_mvm_vif_is_a˘ive
(
mvmvif
))

576 *
dißbÀ_ps
 |
mvmvif
->
ps_dißbÀd
;

577 
	}
}

579 
	$iwl_mvm_powî_gë_vifs_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

580 
õì80211_vif
 *
vif
)

582 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

583 
iwl_powî_vifs
 *
powî_ôî©‹
 = 
_d©a
;

584 
boﬁ
 
a˘ive
;

586 i‡(!
mvmvif
->
u∂ﬂded
)

589 
a˘ive
 = 
	`iwl_mvm_vif_is_a˘ive
(
mvmvif
);

591 
	`õì80211_vif_ty≥_p2p
(
vif
)) {

592 
NL80211_IFTYPE_P2P_DEVICE
:

595 
NL80211_IFTYPE_P2P_GO
:

596 
NL80211_IFTYPE_AP
:

598 
	`WARN_ON
(
powî_ôî©‹
->
≠_vif
);

599 
powî_ôî©‹
->
≠_vif
 = 
vif
;

600 i‡(
a˘ive
)

601 
powî_ôî©‹
->
≠_a˘ive
 = 
åue
;

604 
NL80211_IFTYPE_MONITOR
:

606 
	`WARN_ON
(
powî_ôî©‹
->
m⁄ô‹_vif
);

607 
powî_ôî©‹
->
m⁄ô‹_vif
 = 
vif
;

608 i‡(
a˘ive
)

609 
powî_ôî©‹
->
m⁄ô‹_a˘ive
 = 
åue
;

612 
NL80211_IFTYPE_P2P_CLIENT
:

614 
	`WARN_ON
(
powî_ôî©‹
->
p2p_vif
);

615 
powî_ôî©‹
->
p2p_vif
 = 
vif
;

616 i‡(
a˘ive
)

617 
powî_ôî©‹
->
p2p_a˘ive
 = 
åue
;

620 
NL80211_IFTYPE_STATION
:

621 
powî_ôî©‹
->
bss_vif
 = 
vif
;

622 i‡(
a˘ive
)

623 
powî_ôî©‹
->
bss_a˘ive
 = 
åue
;

629 
	}
}

631 
	$iwl_mvm_powî_£t_pm
(
iwl_mvm
 *
mvm
,

632 
iwl_powî_vifs
 *
vifs
)

634 
iwl_mvm_vif
 *
bss_mvmvif
 = 
NULL
;

635 
iwl_mvm_vif
 *
p2p_mvmvif
 = 
NULL
;

636 
iwl_mvm_vif
 *
≠_mvmvif
 = 
NULL
;

637 
boﬁ
 
˛õ¡_ßme_ch™√l
 = 
Ál£
;

638 
boﬁ
 
≠_ßme_ch™√l
 = 
Ál£
;

640 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

643 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

644 
IEEE80211_IFACE_ITER_NORMAL
,

645 
iwl_mvm_powî_dißbÀ_pm_ôî©‹
,

646 
NULL
);

648 i‡(
vifs
->
bss_vif
)

649 
bss_mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vifs
->
bss_vif
);

651 i‡(
vifs
->
p2p_vif
)

652 
p2p_mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vifs
->
p2p_vif
);

654 i‡(
vifs
->
≠_vif
)

655 
≠_mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vifs
->
≠_vif
);

658 i‡(
	`iwl_mvm_tdls_°a_cou¡
(
mvm
, 
NULL
))

662 i‡(
bss_mvmvif
 && 
vifs
->
bss_a˘ive
 && !vifs->
p2p_a˘ive
 &&

663 !
vifs
->
≠_a˘ive
) {

664 
bss_mvmvif
->
pm_íabÀd
 = 
åue
;

669 i‡(
p2p_mvmvif
 && 
vifs
->
p2p_a˘ive
 && !vifs->
bss_a˘ive
 &&

670 !
vifs
->
≠_a˘ive
) {

671 
p2p_mvmvif
->
pm_íabÀd
 = 
åue
;

675 i‡(
p2p_mvmvif
 && 
bss_mvmvif
 && 
vifs
->
bss_a˘ive
 && vifs->
p2p_a˘ive
)

676 
˛õ¡_ßme_ch™√l
 =

677 
	`iwl_mvm_have_löks_ßme_ch™√l
(
bss_mvmvif
, 
p2p_mvmvif
);

679 i‡(
bss_mvmvif
 && 
≠_mvmvif
 && 
vifs
->
bss_a˘ive
 && vifs->
≠_a˘ive
)

680 
≠_ßme_ch™√l
 =

681 
	`iwl_mvm_have_löks_ßme_ch™√l
(
bss_mvmvif
, 
≠_mvmvif
);

684 i‡(!(
˛õ¡_ßme_ch™√l
 || 
≠_ßme_ch™√l
)) {

685 i‡(
bss_mvmvif
 && 
vifs
->
bss_a˘ive
)

686 
bss_mvmvif
->
pm_íabÀd
 = 
åue
;

687 i‡(
p2p_mvmvif
 && 
vifs
->
p2p_a˘ive
)

688 
p2p_mvmvif
->
pm_íabÀd
 = 
åue
;

696 i‡(
˛õ¡_ßme_ch™√l
 && !
vifs
->
≠_a˘ive
) {

698 
bss_mvmvif
->
pm_íabÀd
 = 
åue
;

699 
p2p_mvmvif
->
pm_íabÀd
 = 
åue
;

701 
	}
}

703 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


704 
	$iwl_mvm_powî_mac_dbgfs_ªad
(
iwl_mvm
 *
mvm
,

705 
õì80211_vif
 *
vif
, *
buf
,

706 
bufsz
)

708 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

709 
iwl_mac_powî_cmd
 
cmd
 = {};

710 
pos
 = 0;

712 
	`muãx_lock
(&
mvm
->
muãx
);

713 
	`mem˝y
(&
cmd
, &
mvmvif
->
mac_pwr_cmd
, (cmd));

714 
	`muãx_u∆ock
(&
mvm
->
muãx
);

716 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "power_scheme = %d\n",

717 
iwlmvm_mod_∑øms
.
powî_scheme
);

718 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "flags = 0x%x\n",

719 
	`À16_to_˝u
(
cmd
.
Êags
));

720 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "keep_alive = %d\n",

721 
	`À16_to_˝u
(
cmd
.
kìp_Æive_£c⁄ds
));

723 i‡(!(
cmd
.
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_POWER_MANAGEMENT_ENA_MSK
)))

724  
pos
;

726 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "skip_over_dtim = %d\n",

727 (
cmd
.
Êags
 &

728 
	`˝u_to_À16
(
POWER_FLAGS_SKIP_OVER_DTIM_MSK
)) ? 1 : 0);

729 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "skip_dtim_periods = %d\n",

730 
cmd
.
skù_dtim_≥riods
);

731 i‡(!(
cmd
.
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_ADVANCE_PM_ENA_MSK
))) {

732 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "rx_data_timeout = %d\n",

733 
	`À32_to_˝u
(
cmd
.
rx_d©a_timeout
));

734 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "tx_data_timeout = %d\n",

735 
	`À32_to_˝u
(
cmd
.
tx_d©a_timeout
));

737 i‡(
cmd
.
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_LPRX_ENA_MSK
))

738 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos,

740 
cmd
.
Õrx_rssi_thªshﬁd
);

742 i‡(!(
cmd
.
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_ADVANCE_PM_ENA_MSK
)))

743  
pos
;

745 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "rx_data_timeout_uapsd = %d\n",

746 
	`À32_to_˝u
(
cmd
.
rx_d©a_timeout_u≠sd
));

747 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "tx_data_timeout_uapsd = %d\n",

748 
	`À32_to_˝u
(
cmd
.
tx_d©a_timeout_u≠sd
));

749 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "qndp_tid = %d\n", 
cmd
.
qndp_tid
);

750 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "uapsd_ac_flags = 0x%x\n",

751 
cmd
.
u≠sd_ac_Êags
);

752 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "uapsd_max_sp = %d\n",

753 
cmd
.
u≠sd_max_•
);

754 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "heavy_tx_thld_packets = %d\n",

755 
cmd
.
hóvy_tx_thld_∑ckës
);

756 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "heavy_rx_thld_packets = %d\n",

757 
cmd
.
hóvy_rx_thld_∑ckës
);

758 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "heavy_tx_thld_percentage = %d\n",

759 
cmd
.
hóvy_tx_thld_≥r˚¡age
);

760 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "heavy_rx_thld_percentage = %d\n",

761 
cmd
.
hóvy_rx_thld_≥r˚¡age
);

762 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "uapsd_misbehaving_enable = %d\n",

763 (
cmd
.
Êags
 &

764 
	`˝u_to_À16
(
POWER_FLAGS_UAPSD_MISBEHAVING_ENA_MSK
)) ?

767 i‡(!(
cmd
.
Êags
 & 
	`˝u_to_À16
(
POWER_FLAGS_SNOOZE_ENA_MSK
)))

768  
pos
;

770 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "snooze_interval = %d\n",

771 
cmd
.
¢ooze_öãrvÆ
);

772 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "snooze_window = %d\n",

773 
cmd
.
¢ooze_wödow
);

775  
pos
;

776 
	}
}

779 
	$iwl_mvm_bóc⁄_fûãr_debugfs_∑ømëîs
(
õì80211_vif
 *
vif
,

780 
iwl_bóc⁄_fûãr_cmd
 *
cmd
)

782 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

783 
iwl_dbgfs_bf
 *
dbgfs_bf
 = &
mvmvif
->dbgfs_bf;

785 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_ENERGY_DELTA
)

786 
cmd
->
bf_íîgy_dñè
 = 
	`˝u_to_À32
(
dbgfs_bf
->bf_energy_delta);

787 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_ROAMING_ENERGY_DELTA
)

788 
cmd
->
bf_rﬂmög_íîgy_dñè
 =

789 
	`˝u_to_À32
(
dbgfs_bf
->
bf_rﬂmög_íîgy_dñè
);

790 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_ROAMING_STATE
)

791 
cmd
->
bf_rﬂmög_°©e
 = 
	`˝u_to_À32
(
dbgfs_bf
->bf_roaming_state);

792 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_TEMP_THRESHOLD
)

793 
cmd
->
bf_ãmp_thªshﬁd
 =

794 
	`˝u_to_À32
(
dbgfs_bf
->
bf_ãmp_thªshﬁd
);

795 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_TEMP_FAST_FILTER
)

796 
cmd
->
bf_ãmp_Á°_fûãr
 =

797 
	`˝u_to_À32
(
dbgfs_bf
->
bf_ãmp_Á°_fûãr
);

798 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_TEMP_SLOW_FILTER
)

799 
cmd
->
bf_ãmp_¶ow_fûãr
 =

800 
	`˝u_to_À32
(
dbgfs_bf
->
bf_ãmp_¶ow_fûãr
);

801 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_DEBUG_FLAG
)

802 
cmd
->
bf_debug_Êag
 = 
	`˝u_to_À32
(
dbgfs_bf
->bf_debug_flag);

803 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BF_ESCAPE_TIMER
)

804 
cmd
->
bf_esˇ≥_timî
 = 
	`˝u_to_À32
(
dbgfs_bf
->bf_escape_timer);

805 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BA_ESCAPE_TIMER
)

806 
cmd
->
ba_esˇ≥_timî
 = 
	`˝u_to_À32
(
dbgfs_bf
->ba_escape_timer);

807 i‡(
dbgfs_bf
->
mask
 & 
MVM_DEBUGFS_BA_ENABLE_BEACON_ABORT
)

808 
cmd
->
ba_íabÀ_bóc⁄_ab‹t
 =

809 
	`˝u_to_À32
(
dbgfs_bf
->
ba_íabÀ_bóc⁄_ab‹t
);

810 
	}
}

813 
	$_iwl_mvm_íabÀ_bóc⁄_fûãr
(
iwl_mvm
 *
mvm
,

814 
õì80211_vif
 *
vif
,

815 
iwl_bóc⁄_fûãr_cmd
 *
cmd
)

817 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

818 
ªt
;

820 i‡(
mvmvif
 !
mvm
->
bf_Ælowed_vif
 || !
vif
->
bss_c⁄f
.
dtim_≥riod
 ||

821 
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || vif->
p2p
)

824 
	`iwl_mvm_bóc⁄_fûãr_£t_cqm_∑øms
(
mvm
, 
vif
, 
cmd
);

825 
	`iwl_mvm_bóc⁄_fûãr_debugfs_∑ømëîs
(
vif
, 
cmd
);

826 
ªt
 = 
	`iwl_mvm_bóc⁄_fûãr_£nd_cmd
(
mvm
, 
cmd
);

828 i‡(!
ªt
)

829 
mvmvif
->
bf_d©a
.
bf_íabÀd
 = 
åue
;

831  
ªt
;

832 
	}
}

834 
	$iwl_mvm_íabÀ_bóc⁄_fûãr
(
iwl_mvm
 *
mvm
,

835 
õì80211_vif
 *
vif
)

837 
iwl_bóc⁄_fûãr_cmd
 
cmd
 = {

838 
IWL_BF_CMD_CONFIG_DEFAULTS
,

839 .
bf_íabÀ_bóc⁄_fûãr
 = 
	`˝u_to_À32
(1),

842  
	`_iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
, &
cmd
);

843 
	}
}

845 
	$_iwl_mvm_dißbÀ_bóc⁄_fûãr
(
iwl_mvm
 *
mvm
,

846 
õì80211_vif
 *
vif
)

848 
iwl_bóc⁄_fûãr_cmd
 
cmd
 = {};

849 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

850 
ªt
;

852 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || vif->
p2p
)

855 
ªt
 = 
	`iwl_mvm_bóc⁄_fûãr_£nd_cmd
(
mvm
, &
cmd
);

857 i‡(!
ªt
)

858 
mvmvif
->
bf_d©a
.
bf_íabÀd
 = 
Ál£
;

860  
ªt
;

861 
	}
}

863 
	$iwl_mvm_dißbÀ_bóc⁄_fûãr
(
iwl_mvm
 *
mvm
,

864 
õì80211_vif
 *
vif
)

866  
	`_iwl_mvm_dißbÀ_bóc⁄_fûãr
(
mvm
, 
vif
);

867 
	}
}

869 
	$iwl_mvm_powî_£t_ps
(
iwl_mvm
 *
mvm
)

871 
boﬁ
 
dißbÀ_ps
;

872 
ªt
;

875 
dißbÀ_ps
 = (
iwlmvm_mod_∑øms
.
powî_scheme
 =
IWL_POWER_SCHEME_CAM
);

877 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

878 
IEEE80211_IFACE_ITER_NORMAL
,

879 
iwl_mvm_powî_ps_dißbÀd_ôî©‹
,

880 &
dißbÀ_ps
);

883 i‡(
mvm
->
ps_dißbÀd
 !
dißbÀ_ps
) {

884 
boﬁ
 
ﬁd_ps_dißbÀd
 = 
mvm
->
ps_dißbÀd
;

886 
mvm
->
ps_dißbÀd
 = 
dißbÀ_ps
;

887 
ªt
 = 
	`iwl_mvm_powî_upd©e_devi˚
(
mvm
);

888 i‡(
ªt
) {

889 
mvm
->
ps_dißbÀd
 = 
ﬁd_ps_dißbÀd
;

890  
ªt
;

895 
	}
}

897 
	$iwl_mvm_powî_£t_ba
(
iwl_mvm
 *
mvm
,

898 
õì80211_vif
 *
vif
)

900 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

901 
iwl_bóc⁄_fûãr_cmd
 
cmd
 = {

902 
IWL_BF_CMD_CONFIG_DEFAULTS
,

903 .
bf_íabÀ_bóc⁄_fûãr
 = 
	`˝u_to_À32
(1),

906 i‡(!
mvmvif
->
bf_d©a
.
bf_íabÀd
)

909 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_D3
, &
mvm
->
°©us
))

910 
cmd
.
ba_esˇ≥_timî
 = 
	`˝u_to_À32
(
IWL_BA_ESCAPE_TIMER_D3
);

912 
mvmvif
->
bf_d©a
.
ba_íabÀd
 = !(!mvmvif->
pm_íabÀd
 ||

913 
mvm
->
ps_dißbÀd
 ||

914 !
vif
->
cfg
.
ps
 ||

915 
	`iwl_mvm_vif_low_œãncy
(
mvmvif
));

917  
	`_iwl_mvm_íabÀ_bóc⁄_fûãr
(
mvm
, 
vif
, &
cmd
);

918 
	}
}

920 
	$iwl_mvm_powî_upd©e_ps
(
iwl_mvm
 *
mvm
)

922 
iwl_powî_vifs
 
vifs
 = {

923 .
mvm
 = mvm,

925 
ªt
;

927 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

930 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

931 
IEEE80211_IFACE_ITER_NORMAL
,

932 
iwl_mvm_powî_gë_vifs_ôî©‹
, &
vifs
);

934 
ªt
 = 
	`iwl_mvm_powî_£t_ps
(
mvm
);

935 i‡(
ªt
)

936  
ªt
;

938 i‡(
vifs
.
bss_vif
)

939  
	`iwl_mvm_powî_£t_ba
(
mvm
, 
vifs
.
bss_vif
);

942 
	}
}

944 
	$iwl_mvm_powî_upd©e_mac
(
iwl_mvm
 *
mvm
)

946 
iwl_powî_vifs
 
vifs
 = {

947 .
mvm
 = mvm,

949 
ªt
;

951 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

954 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

955 
IEEE80211_IFACE_ITER_NORMAL
,

956 
iwl_mvm_powî_gë_vifs_ôî©‹
, &
vifs
);

958 
	`iwl_mvm_powî_£t_pm
(
mvm
, &
vifs
);

960 
ªt
 = 
	`iwl_mvm_powî_£t_ps
(
mvm
);

961 i‡(
ªt
)

962  
ªt
;

964 i‡(
vifs
.
bss_vif
) {

965 
ªt
 = 
	`iwl_mvm_powî_£nd_cmd
(
mvm
, 
vifs
.
bss_vif
);

966 i‡(
ªt
)

967  
ªt
;

970 i‡(
vifs
.
p2p_vif
) {

971 
ªt
 = 
	`iwl_mvm_powî_£nd_cmd
(
mvm
, 
vifs
.
p2p_vif
);

972 i‡(
ªt
)

973  
ªt
;

976 i‡(
vifs
.
bss_vif
)

977  
	`iwl_mvm_powî_£t_ba
(
mvm
, 
vifs
.
bss_vif
);

980 
	}
}

	@mvm/ptp.c

6 
	~"mvm.h
"

7 
	~"iwl-debug.h
"

8 
	~<löux/timekìpög.h
>

9 
	~<löux/m©h64.h
>

11 
	#IWL_PTP_GP2_WRAP
 0x100000000ULL

	)

12 
	#IWL_PTP_WRAP_TIME
 (3600 * 
HZ
)

	)

18 
	#SCALE_FACTOR
 65536000000ULL

	)

19 
	#IWL_PTP_WRAP_THRESHOLD_USEC
 (5000)

	)

21 
	#IWL_PTP_GET_CROSS_TS_NUM
 5

	)

23 
	$iwl_mvm_±p_upd©e_√w_ªad
(
iwl_mvm
 *
mvm
, 
u32
 
gp2
)

28 i‡(
gp2
 < 
mvm
->
±p_d©a
.
œ°_gp2
 &&

29 
mvm
->
±p_d©a
.
œ°_gp2
 - 
gp2
 < 
IWL_PTP_WRAP_THRESHOLD_USEC
) {

30 
	`IWL_DEBUG_INFO
(
mvm
,

32 
gp2
, 
mvm
->
±p_d©a
.
œ°_gp2
);

36 i‡(
gp2
 < 
mvm
->
±p_d©a
.
œ°_gp2
) {

37 
mvm
->
±p_d©a
.
wøp_cou¡î
++;

38 
	`IWL_DEBUG_INFO
(
mvm
,

40 
mvm
->
±p_d©a
.
wøp_cou¡î
);

43 
mvm
->
±p_d©a
.
œ°_gp2
 = 
gp2
;

44 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
±p_d©a
.
dw‹k
, 
IWL_PTP_WRAP_TIME
);

45 
	}
}

47 
u64
 
	$iwl_mvm_±p_gë_adj_time
(
iwl_mvm
 *
mvm
, 
u64
 
ba£_time_ns
)

49 
±p_d©a
 *
d©a
 = &
mvm
->ptp_data;

50 
u64
 
œ°_gp2_ns
 = 
mvm
->
±p_d©a
.
sˇÀ_upd©e_gp2
 * 
NSEC_PER_USEC
;

51 
u64
 
ªs
;

52 
u64
 
diff
;

54 
	`iwl_mvm_±p_upd©e_√w_ªad
(
mvm
,

55 
	`div64_u64
(
ba£_time_ns
, 
NSEC_PER_USEC
));

57 
	`IWL_DEBUG_INFO
(
mvm
, "base_time_ns=%llu, wrap_counter=%u\n",

58 ()
ba£_time_ns
, 
d©a
->
wøp_cou¡î
);

60 
ba£_time_ns
 = base_time_ns +

61 (
d©a
->
wøp_cou¡î
 * 
IWL_PTP_GP2_WRAP
 * 
NSEC_PER_USEC
);

66 i‡(
ba£_time_ns
 < 
œ°_gp2_ns
) {

67 
	`IWL_DEBUG_INFO
(
mvm
, "Time before scale update - ignore\n");

71 
diff
 = 
ba£_time_ns
 - 
œ°_gp2_ns
;

72 
	`IWL_DEBUG_INFO
(
mvm
, "dif‡ns=%Œu\n", ()
diff
);

74 
diff
 = 
	`mul_u64_u64_div_u64
(diff, 
d©a
->
sˇÀd_‰eq
,

75 
SCALE_FACTOR
);

76 
	`IWL_DEBUG_INFO
(
mvm
, "sˇÀd dif‡ns=%Œu\n", ()
diff
);

78 
ªs
 = 
d©a
->
sˇÀ_upd©e_adj_time_ns
 + d©a->
dñè
 + 
diff
;

80 
	`IWL_DEBUG_INFO
(
mvm
, "base=%llu delta=%lldádj=%llu\n",

81 ()
ba£_time_ns
, ()
d©a
->
dñè
,

82 ()
ªs
);

83  
ªs
;

84 
	}
}

87 
	$iwl_mvm_gë_¸os°ime°amp_fw
(
iwl_mvm
 *
mvm
, 
u32
 *
gp2
, 
u64
 *
sys_time
)

89 
iwl_syn˚d_time_cmd
 
syn˚d_time_cmd
 = {

90 .
›î©i⁄
 = 
	`˝u_to_À32
(
IWL_SYNCED_TIME_OPERATION_READ_BOTH
)

92 
iwl_ho°_cmd
 
cmd
 = {

93 .
id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
WNM_PLATFORM_PTM_REQUEST_CMD
),

94 .
Êags
 = 
CMD_WANT_SKB
,

95 .
d©a
[0] = &
syn˚d_time_cmd
,

96 .
Àn
[0] = (
syn˚d_time_cmd
),

98 
iwl_syn˚d_time_r•
 *
ª•
;

99 
iwl_rx_∑ckë
 *
pkt
;

100 
ªt
;

101 
u64
 
gp2_10ns
;

103 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

104 i‡(
ªt
)

105  
ªt
;

107 
pkt
 = 
cmd
.
ª•_pkt
;

109 i‡(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë!(*
ª•
)) {

110 
	`IWL_ERR
(
mvm
, "PTP: Invalid commandÑesponse\n");

111 
	`iwl_‰ì_ª•
(&
cmd
);

112  -
EIO
;

115 
ª•
 = (*)
pkt
->
d©a
;

117 
gp2_10ns
 = (
u64
)
	`À32_to_˝u
(
ª•
->
gp2_time°amp_hi
) << 32 |

118 
	`À32_to_˝u
(
ª•
->
gp2_time°amp_lo
);

119 *
gp2
 = 
	`div_u64
(
gp2_10ns
, 100);

121 *
sys_time
 = (
u64
)
	`À32_to_˝u
(
ª•
->
∂©f‹m_time°amp_hi
) << 32 |

122 
	`À32_to_˝u
(
ª•
->
∂©f‹m_time°amp_lo
);

124  
ªt
;

125 
	}
}

127 
	$iwl_mvm_phc_gë_¸os°ime°amp_lo›
(
iwl_mvm
 *
mvm
,

128 
ktime_t
 *
sys_time
, 
u32
 *
gp2
)

130 
u64
 
diff
 = 0, 
√w_diff
;

131 
u64
 
tmp_sys_time
;

132 
u32
 
tmp_gp2
;

133 
i
;

135 
i
 = 0; i < 
IWL_PTP_GET_CROSS_TS_NUM
; i++) {

136 
	`iwl_mvm_gë_sync_time
(
mvm
, 
CLOCK_REALTIME
, &
tmp_gp2
, 
NULL
,

137 &
tmp_sys_time
);

138 
√w_diff
 = 
tmp_sys_time
 - ((
u64
)
tmp_gp2
 * 
NSEC_PER_USEC
);

139 i‡(!
diff
 || 
√w_diff
 < diff) {

140 *
sys_time
 = 
tmp_sys_time
;

141 *
gp2
 = 
tmp_gp2
;

142 
diff
 = 
√w_diff
;

143 
	`IWL_DEBUG_INFO
(
mvm
, "PTP:ÇewÅimes: gp2=%u sys=%lld\n",

144 *
gp2
, *
sys_time
);

147 
	}
}

150 
	$iwl_mvm_phc_gë_¸os°ime°amp
(
±p_˛ock_öfo
 *
±p
,

151 
sy°em_devi˚_¸os°°amp
 *
xt°amp
)

153 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
±p
, iwl_mvm,

154 
±p_d©a
.
±p_˛ock_öfo
);

155 
ªt
 = 0;

157 
u32
 
gp2
;

159 
s64
 
gp2_ns
;

161 
ktime_t
 
sys_time
;

163 
	`mem£t
(
xt°amp
, 0, (
sy°em_devi˚_¸os°°amp
));

165 i‡(!
mvm
->
±p_d©a
.
±p_˛ock
) {

166 
	`IWL_ERR
(
mvm
, "No PHC clockÑegistered\n");

167  -
ENODEV
;

170 
	`muãx_lock
(&
mvm
->
muãx
);

171 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_SYNCED_TIME
)) {

172 
ªt
 = 
	`iwl_mvm_gë_¸os°ime°amp_fw
(
mvm
, &
gp2
, &
sys_time
);

174 i‡(
ªt
)

175 
out
;

177 
	`iwl_mvm_phc_gë_¸os°ime°amp_lo›
(
mvm
, &
sys_time
, &
gp2
);

180 
gp2_ns
 = 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, (
u64
)
gp2
 * 
NSEC_PER_USEC
);

182 
	`IWL_INFO
(
mvm
, "Got Sync Time: GP2:%u,Üast_GP2: %u, GP2_ns: %lld, sys_time: %lld\n",

183 
gp2
, 
mvm
->
±p_d©a
.
œ°_gp2
, 
gp2_ns
, (
s64
)
sys_time
);

186 
xt°amp
->
devi˚
 = (
ktime_t
)
gp2_ns
;

187 
xt°amp
->
sys_ªÆtime
 = 
sys_time
;

189 
out
:

190 
	`muãx_u∆ock
(&
mvm
->
muãx
);

191  
ªt
;

192 
	}
}

194 
	$iwl_mvm_±p_w‹k
(
w‹k_°ru˘
 *
wk
)

196 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
wk
, iwl_mvm,

197 
±p_d©a
.
dw‹k
.
w‹k
);

198 
u32
 
gp2
;

200 
	`muãx_lock
(&
mvm
->
muãx
);

201 
gp2
 = 
	`iwl_mvm_gë_sy°ime
(
mvm
);

202 
	`iwl_mvm_±p_upd©e_√w_ªad
(
mvm
, 
gp2
);

203 
	`muãx_u∆ock
(&
mvm
->
muãx
);

204 
	}
}

206 
	$iwl_mvm_±p_gëtime
(
±p_˛ock_öfo
 *
±p
,

207 
time•ec64
 *
ts
)

209 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
±p
, iwl_mvm,

210 
±p_d©a
.
±p_˛ock_öfo
);

211 
u64
 
gp2
;

212 
u64
 
ns
;

214 
	`muãx_lock
(&
mvm
->
muãx
);

215 
gp2
 = 
	`iwl_mvm_gë_sy°ime
(
mvm
);

216 
ns
 = 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, 
gp2
 * 
NSEC_PER_USEC
);

217 
	`muãx_u∆ock
(&
mvm
->
muãx
);

219 *
ts
 = 
	`ns_to_time•ec64
(
ns
);

221 
	}
}

223 
	$iwl_mvm_±p_adjtime
(
±p_˛ock_öfo
 *
±p
, 
s64
 
dñè
)

225 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
±p
, iwl_mvm,

226 
±p_d©a
.
±p_˛ock_öfo
);

227 
±p_d©a
 *
d©a
 = 
	`c⁄èöî_of
(
±p
, ptp_data,

228 
±p_˛ock_öfo
);

230 
	`muãx_lock
(&
mvm
->
muãx
);

231 
d©a
->
dñè
 += delta;

232 
	`IWL_DEBUG_INFO
(
mvm
, "dñè=%Œd,Çew dñè=%Œd\n", ()
dñè
,

233 ()
d©a
->
dñè
);

234 
	`muãx_u∆ock
(&
mvm
->
muãx
);

236 
	}
}

238 
	$iwl_mvm_±p_adjföe
(
±p_˛ock_öfo
 *
±p
, 
sˇÀd_µm
)

240 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
±p
, iwl_mvm,

241 
±p_d©a
.
±p_˛ock_öfo
);

242 
±p_d©a
 *
d©a
 = &
mvm
->ptp_data;

243 
u32
 
gp2
;

245 
	`muãx_lock
(&
mvm
->
muãx
);

251 
gp2
 = 
	`iwl_mvm_gë_sy°ime
(
mvm
);

252 
d©a
->
sˇÀ_upd©e_adj_time_ns
 =

253 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, 
gp2
 * 
NSEC_PER_USEC
);

254 
d©a
->
sˇÀ_upd©e_gp2
 = 
gp2
;

255 
d©a
->
wøp_cou¡î
 = 0;

256 
d©a
->
dñè
 = 0;

258 
d©a
->
sˇÀd_‰eq
 = 
SCALE_FACTOR
 + 
sˇÀd_µm
;

259 
	`IWL_DEBUG_INFO
(
mvm
, "adjfine: scaled_ppm=%ldÇew=%llu\n",

260 
sˇÀd_µm
, ()
d©a
->
sˇÀd_‰eq
);

262 
	`muãx_u∆ock
(&
mvm
->
muãx
);

264 
	}
}

271 
	$iwl_mvm_±p_öô
(
iwl_mvm
 *
mvm
)

274 i‡(
	`WARN_ON
(
mvm
->
±p_d©a
.
±p_˛ock
))

277 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
ow√r
 = 
THIS_MODULE
;

278 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
max_adj
 = 0x7fffffff;

279 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
gë¸os°°amp
 =

280 
iwl_mvm_phc_gë_¸os°ime°amp
;

281 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
adjföe
 = 
iwl_mvm_±p_adjföe
;

282 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
adjtime
 = 
iwl_mvm_±p_adjtime
;

283 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
gëtime64
 = 
iwl_mvm_±p_gëtime
;

284 
mvm
->
±p_d©a
.
sˇÀd_‰eq
 = 
SCALE_FACTOR
;

287 
	`¢¥ötf
(
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
«me
,

288 (
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
«me
),

291 
	`INIT_DELAYED_WORK
(&
mvm
->
±p_d©a
.
dw‹k
, 
iwl_mvm_±p_w‹k
);

293 
mvm
->
±p_d©a
.
±p_˛ock
 =

294 
	`±p_˛ock_ªgi°î
(&
mvm
->
±p_d©a
.
±p_˛ock_öfo
, mvm->
dev
);

296 i‡(
	`IS_ERR
(
mvm
->
±p_d©a
.
±p_˛ock
)) {

297 
	`IWL_ERR
(
mvm
, "FailedÅoÑegister PHC clock (%ld)\n",

298 
	`PTR_ERR
(
mvm
->
±p_d©a
.
±p_˛ock
));

299 
mvm
->
±p_d©a
.
±p_˛ock
 = 
NULL
;

300 } i‡(
mvm
->
±p_d©a
.
±p_˛ock
) {

301 
	`IWL_INFO
(
mvm
, "Registered PHC clock: %s, with index: %d\n",

302 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
«me
,

303 
	`±p_˛ock_ödex
(
mvm
->
±p_d©a
.
±p_˛ock
));

305 
	}
}

312 
	$iwl_mvm_±p_ªmove
(
iwl_mvm
 *
mvm
)

314 i‡(
mvm
->
±p_d©a
.
±p_˛ock
) {

315 
	`IWL_INFO
(
mvm
, "Unregistering PHC clock: %s, with index: %d\n",

316 
mvm
->
±p_d©a
.
±p_˛ock_öfo
.
«me
,

317 
	`±p_˛ock_ödex
(
mvm
->
±p_d©a
.
±p_˛ock
));

319 
	`±p_˛ock_uƒegi°î
(
mvm
->
±p_d©a
.
±p_˛ock
);

320 
mvm
->
±p_d©a
.
±p_˛ock
 = 
NULL
;

321 
	`mem£t
(&
mvm
->
±p_d©a
.
±p_˛ock_öfo
, 0,

322 (
mvm
->
±p_d©a
.
±p_˛ock_öfo
));

323 
mvm
->
±p_d©a
.
œ°_gp2
 = 0;

324 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvm
->
±p_d©a
.
dw‹k
);

326 
	}
}

	@mvm/quota.c

7 
	~<√t/mac80211.h
>

8 
	~"fw-≠i.h
"

9 
	~"mvm.h
"

11 
	#QUOTA_100
 
IWL_MVM_MAX_QUOTA


	)

12 
	#QUOTA_LOWLAT_MIN
 ((
QUOTA_100
 * 
IWL_MVM_LOWLAT_QUOTA_MIN_PERCENT
Ë/ 100)

	)

14 
	siwl_mvm_quŸa_ôî©‹_d©a
 {

15 
	mn_öãrÁ˚s
[
MAX_BINDINGS
];

16 
	mcﬁ‹s
[
MAX_BINDINGS
];

17 
	mlow_œãncy
[
MAX_BINDINGS
];

18 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


19 
	mdbgfs_mö
[
MAX_BINDINGS
];

21 
	mn_low_œãncy_bödögs
;

22 
õì80211_vif
 *
	mdißbÀd_vif
;

25 
	$iwl_mvm_quŸa_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

26 
õì80211_vif
 *
vif
)

28 
iwl_mvm_quŸa_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

29 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

30 
u16
 
id
;

33 i‡(
vif
 =
d©a
->
dißbÀd_vif
)

36 i‡(!
mvmvif
->
deÊök
.
phy_˘xt
)

40 
id
 = 
mvmvif
->
deÊök
.
phy_˘xt
->id;

43 
	`BUILD_BUG_ON
(
NUM_PHY_CTX
 > 
MAX_BINDINGS
);

45 i‡(
	`WARN_ON_ONCE
(
id
 >
MAX_BINDINGS
))

48 
vif
->
ty≥
) {

49 
NL80211_IFTYPE_STATION
:

50 i‡(
vif
->
cfg
.
assoc
)

53 
NL80211_IFTYPE_AP
:

54 
NL80211_IFTYPE_ADHOC
:

55 i‡(
mvmvif
->
≠_ibss_a˘ive
)

58 
NL80211_IFTYPE_MONITOR
:

59 i‡(
mvmvif
->
m⁄ô‹_a˘ive
)

62 
NL80211_IFTYPE_P2P_DEVICE
:

65 
	`WARN_ON_ONCE
(1);

69 i‡(
d©a
->
cﬁ‹s
[
id
] < 0)

70 
d©a
->
cﬁ‹s
[
id
] = 
mvmvif
->
deÊök
.
phy_˘xt
->
cﬁ‹
;

72 
	`WARN_ON_ONCE
(
d©a
->
cﬁ‹s
[
id
] !=

73 
mvmvif
->
deÊök
.
phy_˘xt
->
cﬁ‹
);

75 
d©a
->
n_öãrÁ˚s
[
id
]++;

77 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


78 i‡(
mvmvif
->
dbgfs_quŸa_mö
)

79 
d©a
->
dbgfs_mö
[
id
] = 
	`max
(data->dbgfs_min[id],

80 
mvmvif
->
dbgfs_quŸa_mö
);

83 i‡(
	`iwl_mvm_vif_low_œãncy
(
mvmvif
Ë&& !
d©a
->
low_œãncy
[
id
]) {

84 
d©a
->
n_low_œãncy_bödögs
++;

85 
d©a
->
low_œãncy
[
id
] = 
åue
;

87 
	}
}

89 
	$iwl_mvm_adju°_quŸa_f‹_nﬂ
(
iwl_mvm
 *
mvm
,

90 
iwl_time_quŸa_cmd
 *
cmd
)

92 #ifde‡
CONFIG_NL80211_TESTMODE


93 
iwl_mvm_vif
 *
mvmvif
;

94 
i
, 
phy_id
 = -1, 
bóc⁄_öt
 = 0;

96 i‡(!
mvm
->
nﬂ_duøti⁄
 || !mvm->
nﬂ_vif
)

99 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm
->
nﬂ_vif
);

100 i‡(!
mvmvif
->
≠_ibss_a˘ive
)

103 
phy_id
 = 
mvmvif
->
deÊök
.
phy_˘xt
->
id
;

104 
bóc⁄_öt
 = 
mvm
->
nﬂ_vif
->
bss_c⁄f
.beacon_int;

106 
i
 = 0; i < 
MAX_BINDINGS
; i++) {

107 
iwl_time_quŸa_d©a
 *
d©a
 =

108 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, 
cmd
,

109 
i
);

110 
u32
 
id_n_c
 = 
	`À32_to_˝u
(
d©a
->
id_™d_cﬁ‹
);

111 
u32
 
id
 = (
id_n_c
 & 
FW_CTXT_ID_MSK
Ë>> 
FW_CTXT_ID_POS
;

112 
u32
 
quŸa
 = 
	`À32_to_˝u
(
d©a
->quota);

114 i‡(
id
 !
phy_id
)

117 
quŸa
 *(
bóc⁄_öt
 - 
mvm
->
nﬂ_duøti⁄
);

118 
quŸa
 /
bóc⁄_öt
;

120 
	`IWL_DEBUG_QUOTA
(
mvm
, "quota:ádjust for NoA from %dÅo %d\n",

121 
	`À32_to_˝u
(
d©a
->
quŸa
), quota);

123 
d©a
->
quŸa
 = 
	`˝u_to_À32
(quota);

126 
	}
}

128 
	$iwl_mvm_upd©e_quŸas
(
iwl_mvm
 *
mvm
,

129 
boﬁ
 
f‹˚_upd©e
,

130 
õì80211_vif
 *
dißbÀd_vif
)

132 
iwl_time_quŸa_cmd
 
cmd
 = {};

133 
i
, 
idx
, 
îr
, 
num_a˘ive_macs
, 
quŸa
, 
quŸa_ªm
, 
n_n⁄_lowœt
;

134 
iwl_mvm_quŸa_ôî©‹_d©a
 
d©a
 = {

135 .
n_öãrÁ˚s
 = {},

136 .
cﬁ‹s
 = { -1, -1, -1, -1 },

137 .
dißbÀd_vif
 = disabled_vif,

139 
iwl_time_quŸa_cmd
 *
œ°
 = &
mvm
->
œ°_quŸa_cmd
;

140 
iwl_time_quŸa_d©a
 *
qd©a
, *
œ°_d©a
;

141 
boﬁ
 
£nd
 = 
Ál£
;

143 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

145 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

146 
IWL_UCODE_TLV_CAPA_DYNAMIC_QUOTA
))

150 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

154 
	`BUILD_BUG_ON
(
MAX_BINDINGS
 != 4);

156 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

157 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

158 
iwl_mvm_quŸa_ôî©‹
, &
d©a
);

165 
num_a˘ive_macs
 = 0;

166 
i
 = 0; i < 
MAX_BINDINGS
; i++) {

167 
qd©a
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, &
cmd
, 
i
);

168 
qd©a
->
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
FW_CTXT_INVALID
);

169 
num_a˘ive_macs
 +
d©a
.
n_öãrÁ˚s
[
i
];

172 
n_n⁄_lowœt
 = 
num_a˘ive_macs
;

174 i‡(
d©a
.
n_low_œãncy_bödögs
 == 1) {

175 
i
 = 0; i < 
MAX_BINDINGS
; i++) {

176 i‡(
d©a
.
low_œãncy
[
i
]) {

177 
n_n⁄_lowœt
 -
d©a
.
n_öãrÁ˚s
[
i
];

183 i‡(
d©a
.
n_low_œãncy_bödögs
 =1 && 
n_n⁄_lowœt
) {

190 
quŸa
 = (
QUOTA_100
 - 
QUOTA_LOWLAT_MIN
Ë/ 
n_n⁄_lowœt
;

191 
quŸa_ªm
 = 
QUOTA_100
 - 
n_n⁄_lowœt
 * 
quŸa
 -

192 
QUOTA_LOWLAT_MIN
;

193 
	`IWL_DEBUG_QUOTA
(
mvm
,

195 
quŸa
);

196 } i‡(
num_a˘ive_macs
) {

202 
quŸa
 = 
QUOTA_100
 / 
num_a˘ive_macs
;

203 
quŸa_ªm
 = 
QUOTA_100
 % 
num_a˘ive_macs
;

204 
	`IWL_DEBUG_QUOTA
(
mvm
,

206 
quŸa
);

209 
quŸa
 = 0;

210 
quŸa_ªm
 = 0;

213 
idx
 = 0, 
i
 = 0; i < 
MAX_BINDINGS
; i++) {

214 i‡(
d©a
.
cﬁ‹s
[
i
] < 0)

217 
qd©a
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, &
cmd
, 
idx
);

219 
qd©a
->
id_™d_cﬁ‹
 =

220 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
i
, 
d©a
.
cﬁ‹s
[i]));

222 i‡(
d©a
.
n_öãrÁ˚s
[
i
] <= 0)

223 
qd©a
->
quŸa
 = 
	`˝u_to_À32
(0);

224 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


225 i‡(
d©a
.
dbgfs_mö
[
i
])

226 
qd©a
->
quŸa
 =

227 
	`˝u_to_À32
(
d©a
.
dbgfs_mö
[
i
] * 
QUOTA_100
 / 100);

229 i‡(
d©a
.
n_low_œãncy_bödögs
 =1 && 
n_n⁄_lowœt
 &&

230 
d©a
.
low_œãncy
[
i
])

237 
qd©a
->
quŸa
 = 
	`˝u_to_À32
(
QUOTA_LOWLAT_MIN
);

239 
qd©a
->
quŸa
 =

240 
	`˝u_to_À32
(
quŸa
 * 
d©a
.
n_öãrÁ˚s
[
i
]);

242 
	`WARN_ONCE
(
	`À32_to_˝u
(
qd©a
->
quŸa
Ë> 
QUOTA_100
,

244 
idx
, 
	`À32_to_˝u
(
qd©a
->
quŸa
), 
QUOTA_100
);

246 
qd©a
->
max_duøti⁄
 = 
	`˝u_to_À32
(0);

248 
idx
++;

252 
i
 = 0; i < 
MAX_BINDINGS
; i++) {

253 
qd©a
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, &
cmd
, 
i
);

254 i‡(
	`À32_to_˝u
(
qd©a
->
quŸa
) != 0) {

255 
	`À32_add_˝u
(&
qd©a
->
quŸa
, 
quŸa_ªm
);

256 
	`IWL_DEBUG_QUOTA
(
mvm
,

258 
quŸa_ªm
, 
i
);

263 
	`iwl_mvm_adju°_quŸa_f‹_nﬂ
(
mvm
, &
cmd
);

266 
i
 = 0; i < 
MAX_BINDINGS
; i++) {

267 
qd©a
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, &
cmd
, 
i
);

268 
œ°_d©a
 = 
	`iwl_mvm_quŸa_cmd_gë_quŸa
(
mvm
, 
œ°
, 
i
);

269 i‡(
qd©a
->
id_™d_cﬁ‹
 !
œ°_d©a
->id_and_color)

270 
£nd
 = 
åue
;

271 i‡(
qd©a
->
max_duøti⁄
 !
œ°_d©a
->max_duration)

272 
£nd
 = 
åue
;

273 i‡(
	`abs
(()
	`À32_to_˝u
(
qd©a
->
quŸa
) -

274 ()
	`À32_to_˝u
(
œ°_d©a
->
quŸa
))

275 > 
IWL_MVM_QUOTA_THRESHOLD
)

276 
£nd
 = 
åue
;

277 i‡(
qd©a
->
id_™d_cﬁ‹
 =
	`˝u_to_À32
(
FW_CTXT_INVALID
))

279 
	`WARN_ONCE
(
qd©a
->
quŸa
 == 0,

280 "zîÿquŸ®⁄ bödög %d\n", 
i
);

283 i‡(!
£nd
 && !
f‹˚_upd©e
) {

291 
îr
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TIME_QUOTA_CMD
, 0,

292 
	`iwl_mvm_quŸa_cmd_size
(
mvm
), &
cmd
);

294 i‡(
îr
)

295 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd quŸa: %d\n", 
îr
);

297 
mvm
->
œ°_quŸa_cmd
 = 
cmd
;

298  
îr
;

299 
	}
}

	@mvm/rfi.c

6 
	~"mvm.h
"

7 
	~"fw/≠i/comm™ds.h
"

8 
	~"fw/≠i/phy-˘xt.h
"

14 c⁄° 
iwl_rfi_lut_íåy
 
	giwl_rfi_èbÀ
[
IWL_RFI_LUT_SIZE
] = {

16 {
˝u_to_À16
(160), {50, 58, 60, 62, 64, 52, 54, 56},

17 {
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

18 
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5,}},

21 {
˝u_to_À16
(176), {149, 151, 153, 157, 159, 161, 165, 163, 167, 169,

23 {
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

24 
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

25 
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5,}},

28 {
˝u_to_À16
(192), {79, 81, 83, 85, 87, 89, 91, 93},

29 {
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,

30 
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6,}},

33 {
˝u_to_À16
(223), {114, 116, 118, 120, 122, 106, 110, 124, 126},

34 {
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

35 
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,}},

38 {
˝u_to_À16
(240), {114, 151, 155, 157, 159, 161, 165},

39 {
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

40 
PHY_BAND_5
, PHY_BAND_5,}},

43 {
˝u_to_À16
(256), {79, 83, 85, 87, 89, 91, 93,},

44 {
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,

45 
PHY_BAND_6
, PHY_BAND_6,}},

48 {
˝u_to_À16
(264), {111, 119, 123, 125, 129, 131, 133, 135, 143,},

49 {
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,

50 
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,}},

53 {
˝u_to_À16
(312), {36, 38, 40, 42, 44, 46, 50,},

54 {
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

55 
PHY_BAND_5
, PHY_BAND_5,}},

58 {
˝u_to_À16
(336), {106, 110, 112, 114, 116, 118, 120, 122},

59 {
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,

60 
PHY_BAND_5
, PHY_BAND_5, PHY_BAND_5,}},

63 {
˝u_to_À16
(360), {3, 5, 7, 9, 11, 13, 15,},

64 {
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,

65 
PHY_BAND_6
, PHY_BAND_6,}},

68 {
˝u_to_À16
(384), {79, 83, 85, 87, 89, 91, 93,},

69 {
PHY_BAND_6
, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,

70 
PHY_BAND_6
, PHY_BAND_6,}},

73 
boﬁ
 
	$iwl_rfi_suµ‹ãd
(
iwl_mvm
 *
mvm
)

80  
Ál£
;

81 
	}
}

83 
	$iwl_rfi_£nd_c⁄fig_cmd
(
iwl_mvm
 *
mvm
, 
iwl_rfi_lut_íåy
 *
rfi_èbÀ
)

85 
ªt
;

86 
iwl_rfi_c⁄fig_cmd
 
cmd
;

87 
iwl_ho°_cmd
 
hcmd
 = {

88 .
id
 = 
	`WIDE_ID
(
SYSTEM_GROUP
, 
RFI_CONFIG_CMD
),

89 .
d©aÊags
[0] = 
IWL_HCMD_DFL_DUP
,

90 .
d©a
[0] = &
cmd
,

91 .
Àn
[0] = (
cmd
),

94 i‡(!
	`iwl_rfi_suµ‹ãd
(
mvm
))

95  -
EOPNOTSUPP
;

97 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

100 i‡(!
rfi_èbÀ
) {

101 
	`mem˝y
(
cmd
.
èbÀ
, 
iwl_rfi_èbÀ
, (cmd.table));

103 
	`mem˝y
(
cmd
.
èbÀ
, 
rfi_èbÀ
, (cmd.table));

105 
cmd
.
€m
 = 1;

108 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

110 i‡(
ªt
)

111 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd RFI c⁄fig cmd %d\n", 
ªt
);

113  
ªt
;

114 
	}
}

116 
iwl_rfi_‰eq_èbÀ_ª•_cmd
 *
	$iwl_rfi_gë_‰eq_èbÀ
(
iwl_mvm
 *
mvm
)

118 
iwl_rfi_‰eq_èbÀ_ª•_cmd
 *
ª•
;

119 
ª•_size
 = (*
ª•
);

120 
ªt
;

121 
iwl_ho°_cmd
 
cmd
 = {

122 .
id
 = 
	`WIDE_ID
(
SYSTEM_GROUP
, 
RFI_GET_FREQ_TABLE_CMD
),

123 .
Êags
 = 
CMD_WANT_SKB
,

126 i‡(!
	`iwl_rfi_suµ‹ãd
(
mvm
))

127  
	`ERR_PTR
(-
EOPNOTSUPP
);

129 
	`muãx_lock
(&
mvm
->
muãx
);

130 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

131 
	`muãx_u∆ock
(&
mvm
->
muãx
);

132 i‡(
ªt
)

133  
	`ERR_PTR
(
ªt
);

135 i‡(
	`WARN_ON_ONCE
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
cmd
.
ª•_pkt
) !=

136 
ª•_size
)) {

137 
	`iwl_‰ì_ª•
(&
cmd
);

138  
	`ERR_PTR
(-
EIO
);

141 
ª•
 = 
	`kmemdup
(
cmd
.
ª•_pkt
->
d©a
, 
ª•_size
, 
GFP_KERNEL
);

142 
	`iwl_‰ì_ª•
(&
cmd
);

144 i‡(!
ª•
)

145  
	`ERR_PTR
(-
ENOMEM
);

147  
ª•
;

148 
	}
}

150 
	$iwl_rfi_dó˘iv©e_nŸif_h™dÀr
(
iwl_mvm
 *
mvm
,

151 
iwl_rx_cmd_buf„r
 *
rxb
)

153 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

154 
iwl_rfi_dó˘iv©e_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

156 
	`IWL_INFO
(
mvm
, "RFIm i†dó˘iv©ed,Ñós⁄ = %d\n", 
nŸif
->
ªas⁄
);

157 
	}
}

	@mvm/rs-fw.c

6 
	~"rs.h
"

7 
	~"fw-≠i.h
"

8 
	~"°a.h
"

9 
	~"iwl-›-mode.h
"

10 
	~"mvm.h
"

12 
u8
 
	$rs_fw_bw_‰om_°a_bw
(c⁄° 
õì80211_lök_°a
 *
lök_°a
)

14 
lök_°a
->
b™dwidth
) {

15 
IEEE80211_STA_RX_BW_320
:

16  
IWL_TLC_MNG_CH_WIDTH_320MHZ
;

17 
IEEE80211_STA_RX_BW_160
:

18  
IWL_TLC_MNG_CH_WIDTH_160MHZ
;

19 
IEEE80211_STA_RX_BW_80
:

20  
IWL_TLC_MNG_CH_WIDTH_80MHZ
;

21 
IEEE80211_STA_RX_BW_40
:

22  
IWL_TLC_MNG_CH_WIDTH_40MHZ
;

23 
IEEE80211_STA_RX_BW_20
:

25  
IWL_TLC_MNG_CH_WIDTH_20MHZ
;

27 
	}
}

29 
u8
 
	$rs_fw_£t_a˘ive_chaös
(
u8
 
chaös
)

31 
u8
 
fw_chaös
 = 0;

33 i‡(
chaös
 & 
ANT_A
)

34 
fw_chaös
 |
IWL_TLC_MNG_CHAIN_A_MSK
;

35 i‡(
chaös
 & 
ANT_B
)

36 
fw_chaös
 |
IWL_TLC_MNG_CHAIN_B_MSK
;

38  
fw_chaös
;

39 
	}
}

41 
u8
 
	$rs_fw_sgi_cw_suµ‹t
(
õì80211_lök_°a
 *
lök_°a
)

43 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
lök_°a
->ht_cap;

44 
õì80211_°a_vht_ˇp
 *
vht_ˇp
 = &
lök_°a
->vht_cap;

45 
õì80211_°a_he_ˇp
 *
he_ˇp
 = &
lök_°a
->he_cap;

46 
u8
 
suµ
 = 0;

48 i‡(
he_ˇp
->
has_he
)

51 i‡(
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_SGI_20
)

52 
suµ
 |
	`BIT
(
IWL_TLC_MNG_CH_WIDTH_20MHZ
);

53 i‡(
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_SGI_40
)

54 
suµ
 |
	`BIT
(
IWL_TLC_MNG_CH_WIDTH_40MHZ
);

55 i‡(
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_SHORT_GI_80
)

56 
suµ
 |
	`BIT
(
IWL_TLC_MNG_CH_WIDTH_80MHZ
);

57 i‡(
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_SHORT_GI_160
)

58 
suµ
 |
	`BIT
(
IWL_TLC_MNG_CH_WIDTH_160MHZ
);

60  
suµ
;

61 
	}
}

63 
u16
 
	$rs_fw_gë_c⁄fig_Êags
(
iwl_mvm
 *
mvm
,

64 
õì80211_vif
 *
vif
,

65 
õì80211_lök_°a
 *
lök_°a
,

66 c⁄° 
õì80211_°a_he_ˇp
 *
sb™d_he_ˇp
)

68 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
lök_°a
->ht_cap;

69 
õì80211_°a_vht_ˇp
 *
vht_ˇp
 = &
lök_°a
->vht_cap;

70 
õì80211_°a_he_ˇp
 *
he_ˇp
 = &
lök_°a
->he_cap;

71 
boﬁ
 
vht_ía
 = 
vht_ˇp
->
vht_suµ‹ãd
;

72 
u16
 
Êags
 = 0;

75 i‡(
mvm
->
cfg
->
ht_∑øms
->
°bc
 &&

76 (
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
)) > 1)) {

77 i‡(
he_ˇp
->
has_he
 && he_ˇp->
he_ˇp_ñem
.
phy_ˇp_öfo
[2] &

78 
IEEE80211_HE_PHY_CAP2_STBC_RX_UNDER_80MHZ
)

79 
Êags
 |
IWL_TLC_MNG_CFG_FLAGS_STBC_MSK
;

80 i‡(
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_RXSTBC_MASK
)

81 
Êags
 |
IWL_TLC_MNG_CFG_FLAGS_STBC_MSK
;

82 i‡(
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_RX_STBC
)

83 
Êags
 |
IWL_TLC_MNG_CFG_FLAGS_STBC_MSK
;

86 i‡(
mvm
->
cfg
->
ht_∑øms
->
ldpc
 &&

87 ((
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_LDPC_CODING
) ||

88 (
vht_ía
 && (
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_RXLDPC
))))

89 
Êags
 |
IWL_TLC_MNG_CFG_FLAGS_LDPC_MSK
;

92 i‡(
he_ˇp
->
has_he
 && (he_ˇp->
he_ˇp_ñem
.
phy_ˇp_öfo
[1] &

93 
IEEE80211_HE_PHY_CAP1_LDPC_CODING_IN_PAYLOAD
))

94 
Êags
 |
IWL_TLC_MNG_CFG_FLAGS_LDPC_MSK
;

96 i‡(
sb™d_he_ˇp
 &&

97 !(
sb™d_he_ˇp
->
he_ˇp_ñem
.
phy_ˇp_öfo
[1] &

98 
IEEE80211_HE_PHY_CAP1_LDPC_CODING_IN_PAYLOAD
))

99 
Êags
 &~
IWL_TLC_MNG_CFG_FLAGS_LDPC_MSK
;

101 i‡(
he_ˇp
->
has_he
 &&

102 (
he_ˇp
->
he_ˇp_ñem
.
phy_ˇp_öfo
[3] &

103 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_MASK
 &&

104 
sb™d_he_ˇp
 &&

105 
sb™d_he_ˇp
->
he_ˇp_ñem
.
phy_ˇp_öfo
[3] &

106 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_MASK
))

107 
Êags
 |
IWL_TLC_MNG_CFG_FLAGS_HE_DCM_NSS_1_MSK
;

109  
Êags
;

110 
	}
}

113 
	$rs_fw_vht_highe°_rx_mcs_ödex
(c⁄° 
õì80211_°a_vht_ˇp
 *
vht_ˇp
,

114 
nss
)

116 
u16
 
rx_mcs
 = 
	`À16_to_˝u
(
vht_ˇp
->
vht_mcs
.
rx_mcs_m≠
) &

117 (0x3 << (2 * (
nss
 - 1)));

118 
rx_mcs
 >>(2 * (
nss
 - 1));

120 
rx_mcs
) {

121 
IEEE80211_VHT_MCS_SUPPORT_0_7
:

122  
IWL_TLC_MNG_HT_RATE_MCS7
;

123 
IEEE80211_VHT_MCS_SUPPORT_0_8
:

124  
IWL_TLC_MNG_HT_RATE_MCS8
;

125 
IEEE80211_VHT_MCS_SUPPORT_0_9
:

126  
IWL_TLC_MNG_HT_RATE_MCS9
;

128 
	`WARN_ON_ONCE
(1);

133 
	}
}

136 
	$rs_fw_vht_£t_íabÀd_øãs
(c⁄° 
õì80211_lök_°a
 *
lök_°a
,

137 c⁄° 
õì80211_°a_vht_ˇp
 *
vht_ˇp
,

138 
iwl_éc_c⁄fig_cmd_v4
 *
cmd
)

140 
u16
 
suµ
;

141 
i
, 
highe°_mcs
;

142 
u8
 
max_nss
 = 
lök_°a
->
rx_nss
;

143 
õì80211_vht_ˇp
 
õì_vht_ˇp
 = {

144 .
vht_ˇp_öfo
 = 
	`˝u_to_À32
(
vht_ˇp
->
ˇp
),

145 .
suµ_mcs
 = 
vht_ˇp
->
vht_mcs
,

149 i‡(
lök_°a
->
smps_mode
 =
IEEE80211_SMPS_STATIC
)

150 
max_nss
 = 1;

152 
i
 = 0; i < 
max_nss
 && i < 
IWL_TLC_NSS_MAX
; i++) {

153 
nss
 = 
i
 + 1;

155 
highe°_mcs
 = 
	`rs_fw_vht_highe°_rx_mcs_ödex
(
vht_ˇp
, 
nss
);

156 i‡(!
highe°_mcs
)

159 
suµ
 = 
	`BIT
(
highe°_mcs
 + 1) - 1;

160 i‡(
lök_°a
->
b™dwidth
 =
IEEE80211_STA_RX_BW_20
)

161 
suµ
 &~
	`BIT
(
IWL_TLC_MNG_HT_RATE_MCS9
);

163 
cmd
->
ht_øãs
[
i
][
IWL_TLC_MCS_PER_BW_80
] = 
	`˝u_to_À16
(
suµ
);

169 i‡(
lök_°a
->
b™dwidth
 =
IEEE80211_STA_RX_BW_160
 &&

170 
	`õì80211_gë_vht_max_nss
(&
õì_vht_ˇp
,

171 
IEEE80211_VHT_CHANWIDTH_160MHZ
,

172 0, 
åue
, 
nss
) >=Çss)

173 
cmd
->
ht_øãs
[
i
][
IWL_TLC_MCS_PER_BW_160
] =

174 
cmd
->
ht_øãs
[
i
][
IWL_TLC_MCS_PER_BW_80
];

176 
	}
}

178 
u16
 
	$rs_fw_he_õì80211_mcs_to_rs_mcs
(
u16
 
mcs
)

180 
mcs
) {

181 
IEEE80211_HE_MCS_SUPPORT_0_7
:

182  
	`BIT
(
IWL_TLC_MNG_HT_RATE_MCS7
 + 1) - 1;

183 
IEEE80211_HE_MCS_SUPPORT_0_9
:

184  
	`BIT
(
IWL_TLC_MNG_HT_RATE_MCS9
 + 1) - 1;

185 
IEEE80211_HE_MCS_SUPPORT_0_11
:

186  
	`BIT
(
IWL_TLC_MNG_HT_RATE_MCS11
 + 1) - 1;

187 
IEEE80211_HE_MCS_NOT_SUPPORTED
:

191 
	`WARN
(1, "övÆid HE MCS %d\n", 
mcs
);

193 
	}
}

196 
	$rs_fw_he_£t_íabÀd_øãs
(c⁄° 
õì80211_lök_°a
 *
lök_°a
,

197 c⁄° 
õì80211_°a_he_ˇp
 *
sb™d_he_ˇp
,

198 
iwl_éc_c⁄fig_cmd_v4
 *
cmd
)

200 c⁄° 
õì80211_°a_he_ˇp
 *
he_ˇp
 = &
lök_°a
->he_cap;

201 
u16
 
mcs_160
 = 
	`À16_to_˝u
(
he_ˇp
->
he_mcs_nss_suµ
.
rx_mcs_160
);

202 
u16
 
mcs_80
 = 
	`À16_to_˝u
(
he_ˇp
->
he_mcs_nss_suµ
.
rx_mcs_80
);

203 
u16
 
tx_mcs_80
 = 
	`À16_to_˝u
(
sb™d_he_ˇp
->
he_mcs_nss_suµ
.tx_mcs_80);

204 
u16
 
tx_mcs_160
 = 
	`À16_to_˝u
(
sb™d_he_ˇp
->
he_mcs_nss_suµ
.tx_mcs_160);

205 
i
;

206 
u8
 
nss
 = 
lök_°a
->
rx_nss
;

209 i‡(
lök_°a
->
smps_mode
 =
IEEE80211_SMPS_STATIC
)

210 
nss
 = 1;

212 
i
 = 0; i < 
nss
 && i < 
IWL_TLC_NSS_MAX
; i++) {

213 
u16
 
_mcs_160
 = (
mcs_160
 >> (2 * 
i
)) & 0x3;

214 
u16
 
_mcs_80
 = (
mcs_80
 >> (2 * 
i
)) & 0x3;

215 
u16
 
_tx_mcs_160
 = (
tx_mcs_160
 >> (2 * 
i
)) & 0x3;

216 
u16
 
_tx_mcs_80
 = (
tx_mcs_80
 >> (2 * 
i
)) & 0x3;

219 i‡(
_mcs_80
 =
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

220 
_tx_mcs_80
 =
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

221 
_mcs_80
 = 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

222 
_tx_mcs_80
 = 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

224 i‡(
_mcs_80
 > 
_tx_mcs_80
)

225 
_mcs_80
 = 
_tx_mcs_80
;

226 
cmd
->
ht_øãs
[
i
][
IWL_TLC_MCS_PER_BW_80
] =

227 
	`˝u_to_À16
(
	`rs_fw_he_õì80211_mcs_to_rs_mcs
(
_mcs_80
));

230 i‡(
_mcs_160
 =
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

231 
_tx_mcs_160
 =
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

232 
_mcs_160
 = 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

233 
_tx_mcs_160
 = 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

235 i‡(
_mcs_160
 > 
_tx_mcs_160
)

236 
_mcs_160
 = 
_tx_mcs_160
;

237 
cmd
->
ht_øãs
[
i
][
IWL_TLC_MCS_PER_BW_160
] =

238 
	`˝u_to_À16
(
	`rs_fw_he_õì80211_mcs_to_rs_mcs
(
_mcs_160
));

240 
	}
}

242 
u8
 
	$rs_fw_eht_max_nss
(
u8
 
rx_nss
, u8 
tx_nss
)

244 
u8
 
tx
 = 
	`u8_gë_bôs
(
tx_nss
, 
IEEE80211_EHT_MCS_NSS_TX
);

245 
u8
 
rx
 = 
	`u8_gë_bôs
(
rx_nss
, 
IEEE80211_EHT_MCS_NSS_RX
);

249  
	`mö
(
tx
, 
rx
);

250 
	}
}

252 
	#MAX_NSS_MCS
(
mcs_num
, 
rx
, 
tx
) \

253 
	`rs_fw_eht_max_nss
((
rx
)->
rx_tx_mcs
 ##
mcs_num
## 
_max_nss
, \

254 (
tx
)->
rx_tx_mcs
 ##
mcs_num
## 
_max_nss
)

	)

256 
	$rs_fw_£t_eht_mcs_nss
(
__À16
 
ht_øãs
[][3],

257 
IWL_TLC_MCS_PER_BW
 
bw
,

258 
u8
 
max_nss
, 
u16
 
mcs_msk
)

260 i‡(
max_nss
 >= 2)

261 
ht_øãs
[
IWL_TLC_NSS_2
][
bw
] |
	`˝u_to_À16
(
mcs_msk
);

263 i‡(
max_nss
 >= 1)

264 
ht_øãs
[
IWL_TLC_NSS_1
][
bw
] |
	`˝u_to_À16
(
mcs_msk
);

265 
	}
}

268 
õì80211_eht_mcs_nss_suµ_bw
 *

269 
	$rs_fw_rs_mcs2eht_mcs
(
IWL_TLC_MCS_PER_BW
 
bw
,

270 c⁄° 
õì80211_eht_mcs_nss_suµ
 *
eht_mcs
)

272 
bw
) {

273 
IWL_TLC_MCS_PER_BW_80
:

274  &
eht_mcs
->
bw
.
_80
;

275 
IWL_TLC_MCS_PER_BW_160
:

276  &
eht_mcs
->
bw
.
_160
;

277 
IWL_TLC_MCS_PER_BW_320
:

278  &
eht_mcs
->
bw
.
_320
;

280  
NULL
;

282 
	}
}

285 
	$rs_fw_eht_£t_íabÀd_øãs
(
õì80211_vif
 *
vif
,

286 c⁄° 
õì80211_lök_°a
 *
lök_°a
,

287 c⁄° 
õì80211_°a_he_ˇp
 *
sb™d_he_ˇp
,

288 c⁄° 
õì80211_°a_eht_ˇp
 *
sb™d_eht_ˇp
,

289 
iwl_éc_c⁄fig_cmd_v4
 *
cmd
)

292 c⁄° 
õì80211_eht_mcs_nss_suµ
 *
eht_rx_mcs
 =

293 &
lök_°a
->
eht_ˇp
.
eht_mcs_nss_suµ
;

295 c⁄° 
õì80211_eht_mcs_nss_suµ
 *
eht_tx_mcs
 =

296 &
sb™d_eht_ˇp
->
eht_mcs_nss_suµ
;

298 
IWL_TLC_MCS_PER_BW
 
bw
;

299 
õì80211_eht_mcs_nss_suµ_20mhz_⁄ly
 
mcs_rx_20
;

300 
õì80211_eht_mcs_nss_suµ_20mhz_⁄ly
 
mcs_tx_20
;

303 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 &&

304 !(
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
phy_ˇp_öfo
[0] &

305 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_MASK_ALL
)) {

306 
mcs_rx_20
 = 
eht_rx_mcs
->
⁄ly_20mhz
;

308 
mcs_rx_20
.
rx_tx_mcs7_max_nss
 = 
eht_rx_mcs
->
bw
.
_80
.
rx_tx_mcs9_max_nss
;

309 
mcs_rx_20
.
rx_tx_mcs9_max_nss
 = 
eht_rx_mcs
->
bw
.
_80
.rx_tx_mcs9_max_nss;

310 
mcs_rx_20
.
rx_tx_mcs11_max_nss
 = 
eht_rx_mcs
->
bw
.
_80
.rx_tx_mcs11_max_nss;

311 
mcs_rx_20
.
rx_tx_mcs13_max_nss
 = 
eht_rx_mcs
->
bw
.
_80
.rx_tx_mcs13_max_nss;

315 i‡(!(
sb™d_he_ˇp
->
he_ˇp_ñem
.
phy_ˇp_öfo
[0] &

316 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_MASK_ALL
)) {

317 
mcs_tx_20
 = 
eht_tx_mcs
->
⁄ly_20mhz
;

319 
mcs_tx_20
.
rx_tx_mcs7_max_nss
 = 
eht_tx_mcs
->
bw
.
_80
.
rx_tx_mcs9_max_nss
;

320 
mcs_tx_20
.
rx_tx_mcs9_max_nss
 = 
eht_tx_mcs
->
bw
.
_80
.rx_tx_mcs9_max_nss;

321 
mcs_tx_20
.
rx_tx_mcs11_max_nss
 = 
eht_tx_mcs
->
bw
.
_80
.rx_tx_mcs11_max_nss;

322 
mcs_tx_20
.
rx_tx_mcs13_max_nss
 = 
eht_tx_mcs
->
bw
.
_80
.rx_tx_mcs13_max_nss;

326 
bw
 = 
IWL_TLC_MCS_PER_BW_80
;

327 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

328 
	`MAX_NSS_MCS
(7, &
mcs_rx_20
, &
mcs_tx_20
), 
	`GENMASK
(7, 0));

329 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

330 
	`MAX_NSS_MCS
(9, &
mcs_rx_20
, &
mcs_tx_20
), 
	`GENMASK
(9, 8));

331 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

332 
	`MAX_NSS_MCS
(11, &
mcs_rx_20
, &
mcs_tx_20
), 
	`GENMASK
(11, 10));

333 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

334 
	`MAX_NSS_MCS
(13, &
mcs_rx_20
, &
mcs_tx_20
), 
	`GENMASK
(13, 12));

337 
bw
 = 
IWL_TLC_MCS_PER_BW_160
; bw <
IWL_TLC_MCS_PER_BW_320
; bw++) {

338 c⁄° 
õì80211_eht_mcs_nss_suµ_bw
 *
mcs_rx
 =

339 
	`rs_fw_rs_mcs2eht_mcs
(
bw
, 
eht_rx_mcs
);

340 c⁄° 
õì80211_eht_mcs_nss_suµ_bw
 *
mcs_tx
 =

341 
	`rs_fw_rs_mcs2eht_mcs
(
bw
, 
eht_tx_mcs
);

344 i‡(!
mcs_rx
 || !
mcs_tx
)

348 i‡(
cmd
->
max_ch_width
 < (
bw
 + 
IWL_TLC_MNG_CH_WIDTH_80MHZ
))

351 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

352 
	`MAX_NSS_MCS
(9, 
mcs_rx
, 
mcs_tx
), 
	`GENMASK
(9, 0));

353 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

354 
	`MAX_NSS_MCS
(11, 
mcs_rx
, 
mcs_tx
), 
	`GENMASK
(11, 10));

355 
	`rs_fw_£t_eht_mcs_nss
(
cmd
->
ht_øãs
, 
bw
,

356 
	`MAX_NSS_MCS
(13, 
mcs_rx
, 
mcs_tx
), 
	`GENMASK
(13, 12));

360 i‡(
lök_°a
->
smps_mode
 =
IEEE80211_SMPS_STATIC
 ||

361 
lök_°a
->
rx_nss
 < 2)

362 
	`mem£t
(
cmd
->
ht_øãs
[
IWL_TLC_NSS_2
], 0,

363 (
cmd
->
ht_øãs
[
IWL_TLC_NSS_2
]));

364 
	}
}

366 
	$rs_fw_£t_suµ_øãs
(
õì80211_vif
 *
vif
,

367 
õì80211_lök_°a
 *
lök_°a
,

368 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

369 c⁄° 
õì80211_°a_he_ˇp
 *
sb™d_he_ˇp
,

370 c⁄° 
õì80211_°a_eht_ˇp
 *
sb™d_eht_ˇp
,

371 
iwl_éc_c⁄fig_cmd_v4
 *
cmd
)

373 
i
;

374 
u16
 
suµ
 = 0;

375 
tmp
;

376 c⁄° 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
lök_°a
->ht_cap;

377 c⁄° 
õì80211_°a_vht_ˇp
 *
vht_ˇp
 = &
lök_°a
->vht_cap;

378 c⁄° 
õì80211_°a_he_ˇp
 *
he_ˇp
 = &
lök_°a
->he_cap;

381 
tmp
 = 
lök_°a
->
suµ_øãs
[
sb™d
->
b™d
];

382 
	`f‹_óch_£t_bô
(
i
, &
tmp
, 
BITS_PER_LONG
)

383 
suµ
 |
	`BIT
(
sb™d
->
bôøãs
[
i
].
hw_vÆue
);

385 
cmd
->
n⁄_ht_øãs
 = 
	`˝u_to_À16
(
suµ
);

386 
cmd
->
mode
 = 
IWL_TLC_MNG_MODE_NON_HT
;

389 i‡(
lök_°a
->
eht_ˇp
.
has_eht
 && 
sb™d_he_ˇp
 && 
sb™d_eht_ˇp
) {

390 
cmd
->
mode
 = 
IWL_TLC_MNG_MODE_EHT
;

391 
	`rs_fw_eht_£t_íabÀd_øãs
(
vif
, 
lök_°a
, 
sb™d_he_ˇp
,

392 
sb™d_eht_ˇp
, 
cmd
);

393 } i‡(
he_ˇp
->
has_he
 && 
sb™d_he_ˇp
) {

394 
cmd
->
mode
 = 
IWL_TLC_MNG_MODE_HE
;

395 
	`rs_fw_he_£t_íabÀd_øãs
(
lök_°a
, 
sb™d_he_ˇp
, 
cmd
);

396 } i‡(
vht_ˇp
->
vht_suµ‹ãd
) {

397 
cmd
->
mode
 = 
IWL_TLC_MNG_MODE_VHT
;

398 
	`rs_fw_vht_£t_íabÀd_øãs
(
lök_°a
, 
vht_ˇp
, 
cmd
);

399 } i‡(
ht_ˇp
->
ht_suµ‹ãd
) {

400 
cmd
->
mode
 = 
IWL_TLC_MNG_MODE_HT
;

401 
cmd
->
ht_øãs
[
IWL_TLC_NSS_1
][
IWL_TLC_MCS_PER_BW_80
] =

402 
	`˝u_to_À16
(
ht_ˇp
->
mcs
.
rx_mask
[0]);

405 i‡(
lök_°a
->
smps_mode
 =
IEEE80211_SMPS_STATIC
)

406 
cmd
->
ht_øãs
[
IWL_TLC_NSS_2
][
IWL_TLC_MCS_PER_BW_80
] =

409 
cmd
->
ht_øãs
[
IWL_TLC_NSS_2
][
IWL_TLC_MCS_PER_BW_80
] =

410 
	`˝u_to_À16
(
ht_ˇp
->
mcs
.
rx_mask
[1]);

412 
	}
}

414 
	$iwl_mvm_éc_upd©e_nŸif
(
iwl_mvm
 *
mvm
,

415 
iwl_rx_cmd_buf„r
 *
rxb
)

417 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

418 
iwl_éc_upd©e_nŸif
 *
nŸif
;

419 
õì80211_°a
 *
°a
;

420 
õì80211_lök_°a
 *
lök_°a
;

421 
iwl_mvm_°a
 *
mvm°a
;

422 
iwl_mvm_lök_°a
 *
mvm_lök_°a
;

423 
iwl_lq_°a_rs_fw
 *
lq_°a
;

424 
u32
 
Êags
;

426 
	`rcu_ªad_lock
();

428 
nŸif
 = (*)
pkt
->
d©a
;

429 
lök_°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_lök_°a
[
nŸif
->
°a_id
]);

430 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
nŸif
->
°a_id
]);

431 i‡(
	`IS_ERR_OR_NULL
(
°a
Ë|| !
lök_°a
) {

435 
	`IWL_DEBUG_RATE
(
mvm
,

437 
nŸif
->
°a_id
);

438 
out
;

441 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

443 i‡(!
mvm°a
) {

444 
	`IWL_ERR
(
mvm
, "Invalid sta id (%d) in FW TLCÇotification\n",

445 
nŸif
->
°a_id
);

446 
out
;

449 
Êags
 = 
	`À32_to_˝u
(
nŸif
->flags);

451 
mvm_lök_°a
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->
lök
[
lök_°a
->
lök_id
]);

452 i‡(!
mvm_lök_°a
) {

453 
	`IWL_DEBUG_RATE
(
mvm
,

455 
lök_°a
->
lök_id
, 
nŸif
->
°a_id
);

456 
out
;

458 
lq_°a
 = &
mvm_lök_°a
->lq_°a.
rs_fw
;

460 i‡(
Êags
 & 
IWL_TLC_NOTIF_FLAG_RATE
) {

461 
¥ëty_øã
[100];

463 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
DATA_PATH_GROUP
,

464 
TLC_MNG_UPDATE_NOTIF
, 0) < 3) {

465 
	`rs_¥ëty_¥öt_øã_v1
(
¥ëty_øã
,

466 (
¥ëty_øã
),

467 
	`À32_to_˝u
(
nŸif
->
øã
));

468 
	`IWL_DEBUG_RATE
(
mvm
,

470 
¥ëty_øã
);

471 
lq_°a
->
œ°_øã_n_Êags
 =

472 
	`iwl_√w_øã_‰om_v1
(
	`À32_to_˝u
(
nŸif
->
øã
));

474 
lq_°a
->
œ°_øã_n_Êags
 = 
	`À32_to_˝u
(
nŸif
->
øã
);

476 
	`rs_¥ëty_¥öt_øã
(
¥ëty_øã
, (pretty_rate),

477 
lq_°a
->
œ°_øã_n_Êags
);

478 
	`IWL_DEBUG_RATE
(
mvm
, "√wÑ©e: %s\n", 
¥ëty_øã
);

481 i‡(
Êags
 & 
IWL_TLC_NOTIF_FLAG_AMSDU
 && !
mvm_lök_°a
->
‹ig_amsdu_Àn
) {

482 
u32
 
íabÀd
 = 
	`À32_to_˝u
(
nŸif
->
amsdu_íabÀd
);

483 
u16
 
size
 = 
	`À32_to_˝u
(
nŸif
->
amsdu_size
);

484 
i
;

486 i‡(
size
 < 2000) {

487 
size
 = 0;

488 
íabÀd
 = 0;

491 i‡(
lök_°a
->
agg
.
max_amsdu_Àn
 < 
size
) {

497 
	`WARN_ON
(
mvm_lök_°a
->
‹ig_amsdu_Àn
 < 
size
);

498 
out
;

501 
mvm°a
->
amsdu_íabÀd
 = 
íabÀd
;

502 
mvm°a
->
max_amsdu_Àn
 = 
size
;

503 
lök_°a
->
agg
.
max_rc_amsdu_Àn
 = 
mvm°a
->
max_amsdu_Àn
;

505 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

506 i‡(
mvm°a
->
amsdu_íabÀd
 & 
	`BIT
(
i
))

507 
lök_°a
->
agg
.
max_tid_amsdu_Àn
[
i
] =

508 
	`iwl_mvm_max_amsdu_size
(
mvm
, 
°a
, 
i
);

514 
lök_°a
->
agg
.
max_tid_amsdu_Àn
[
i
] = 1;

517 
	`IWL_DEBUG_RATE
(
mvm
,

519 
	`À32_to_˝u
(
nŸif
->
amsdu_size
), 
size
,

520 
mvm°a
->
amsdu_íabÀd
);

522 
out
:

523 
	`rcu_ªad_u∆ock
();

524 
	}
}

526 
u16
 
	$rs_fw_gë_max_amsdu_Àn
(
õì80211_°a
 *
°a
,

527 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

528 
õì80211_lök_°a
 *
lök_°a
)

530 c⁄° 
õì80211_°a_vht_ˇp
 *
vht_ˇp
 = &
lök_°a
->vht_cap;

531 c⁄° 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
lök_°a
->ht_cap;

532 c⁄° 
õì80211_°a_eht_ˇp
 *
eht_ˇp
 = &
lök_°a
->eht_cap;

534 i‡(
	`WARN_ON_ONCE
(!
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
))

535  
IEEE80211_MAX_MPDU_LEN_VHT_3895
;

537 i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->
b™d
 =
NL80211_BAND_6GHZ
) {

538 
	`À16_gë_bôs
(
lök_°a
->
he_6ghz_ˇ∑
.
ˇ∑
,

539 
IEEE80211_HE_6GHZ_CAP_MAX_MPDU_LEN
)) {

540 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
:

541  
IEEE80211_MAX_MPDU_LEN_VHT_11454
;

542 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991
:

543  
IEEE80211_MAX_MPDU_LEN_VHT_7991
;

545  
IEEE80211_MAX_MPDU_LEN_VHT_3895
;

547 } i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->
b™d
 =
NL80211_BAND_2GHZ
 &&

548 
eht_ˇp
->
has_eht
) {

549 
	`u8_gë_bôs
(
eht_ˇp
->
eht_ˇp_ñem
.
mac_ˇp_öfo
[0],

550 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_MASK
)) {

551 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_11454
:

552  
IEEE80211_MAX_MPDU_LEN_VHT_11454
;

553 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_7991
:

554  
IEEE80211_MAX_MPDU_LEN_VHT_7991
;

556  
IEEE80211_MAX_MPDU_LEN_VHT_3895
;

558 } i‡(
vht_ˇp
->
vht_suµ‹ãd
) {

559 
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_MAX_MPDU_MASK
) {

560 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
:

561  
IEEE80211_MAX_MPDU_LEN_VHT_11454
;

562 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991
:

563  
IEEE80211_MAX_MPDU_LEN_VHT_7991
;

565  
IEEE80211_MAX_MPDU_LEN_VHT_3895
;

567 } i‡(
ht_ˇp
->
ht_suµ‹ãd
) {

568 i‡(
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_MAX_AMSDU
)

574  
IEEE80211_MAX_MPDU_LEN_HT_BA
;

576  
IEEE80211_MAX_MPDU_LEN_HT_3839
;

581 
	}
}

583 
	$iwl_mvm_rs_fw_øã_öô
(
iwl_mvm
 *
mvm
,

584 
õì80211_vif
 *
vif
,

585 
õì80211_°a
 *
°a
,

586 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

587 
õì80211_lök_°a
 *
lök_°a
,

588 
∆80211_b™d
 
b™d
)

590 
õì80211_hw
 *
hw
 = 
mvm
->hw;

591 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

592 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
TLC_MNG_CONFIG_CMD
);

593 
õì80211_suµ‹ãd_b™d
 *
sb™d
 = 
hw
->
wùhy
->
b™ds
[
b™d
];

594 
u16
 
max_amsdu_Àn
 = 
	`rs_fw_gë_max_amsdu_Àn
(
°a
, 
lök_c⁄f
, 
lök_°a
);

595 c⁄° 
õì80211_°a_he_ˇp
 *
sb™d_he_ˇp
 =

596 
	`õì80211_gë_he_i·y≥_ˇp_vif
(
sb™d
, 
vif
);

597 c⁄° 
õì80211_°a_eht_ˇp
 *
sb™d_eht_ˇp
 =

598 
	`õì80211_gë_eht_i·y≥_ˇp_vif
(
sb™d
, 
vif
);

599 
iwl_mvm_lök_°a
 *
mvm_lök_°a
;

600 
iwl_lq_°a_rs_fw
 *
lq_°a
;

601 
iwl_éc_c⁄fig_cmd_v4
 
cfg_cmd
 = {

602 .
max_ch_width
 = 
mvm°a
->
auth‹ized
 ?

603 
	`rs_fw_bw_‰om_°a_bw
(
lök_°a
Ë: 
IWL_TLC_MNG_CH_WIDTH_20MHZ
,

604 .
Êags
 = 
	`˝u_to_À16
(
	`rs_fw_gë_c⁄fig_Êags
(
mvm
, 
vif
, 
lök_°a
,

605 
sb™d_he_ˇp
)),

606 .
chaös
 = 
	`rs_fw_£t_a˘ive_chaös
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
)),

607 .
sgi_ch_width_suµ
 = 
	`rs_fw_sgi_cw_suµ‹t
(
lök_°a
),

608 .
max_mpdu_Àn
 = 
	`iwl_mvm_is_csum_suµ‹ãd
(
mvm
) ?

609 
	`˝u_to_À16
(
max_amsdu_Àn
) : 0,

611 
lök_id
 = 
lök_c⁄f
->link_id;

612 
cmd_vî
;

613 
ªt
;

618 i‡(
	`CSR_HW_REV_TYPE
(
mvm
->
å™s
->
hw_ªv
Ë=
IWL_CFG_MAC_TYPE_GL
 &&

619 
sb™d_eht_ˇp
 &&

620 
sb™d_eht_ˇp
->
eht_ˇp_ñem
.
phy_ˇp_öfo
[5] &

621 
IEEE80211_EHT_PHY_CAP5_SUPP_EXTRA_EHT_LTF
 &&

622 
lök_°a
->
eht_ˇp
.
has_eht
 &&

623 
lök_°a
->
eht_ˇp
.
eht_ˇp_ñem
.
phy_ˇp_öfo
[5] &

624 
IEEE80211_EHT_PHY_CAP5_SUPP_EXTRA_EHT_LTF
) {

625 
	`IWL_DEBUG_RATE
(
mvm
, "Set support for Extra EHT LTF\n");

626 
cfg_cmd
.
Êags
 |=

627 
	`˝u_to_À16
(
IWL_TLC_MNG_CFG_FLAGS_EHT_EXTRA_LTF_MSK
);

630 
	`rcu_ªad_lock
();

631 
mvm_lök_°a
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->
lök
[
lök_id
]);

632 i‡(
	`WARN_ON_ONCE
(!
mvm_lök_°a
)) {

633 
	`rcu_ªad_u∆ock
();

637 
cfg_cmd
.
°a_id
 = 
mvm_lök_°a
->sta_id;

639 
lq_°a
 = &
mvm_lök_°a
->lq_°a.
rs_fw
;

640 
	`mem£t
(
lq_°a
, 0, 
	`off£tof
(
	`ty≥of
(*lq_°a), 
≥rs
));

642 
	`rcu_ªad_u∆ock
();

644 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


645 
	`iwl_mvm_ª£t_‰ame_°©s
(
mvm
);

647 
	`rs_fw_£t_suµ_øãs
(
vif
, 
lök_°a
, 
sb™d
,

648 
sb™d_he_ˇp
, 
sb™d_eht_ˇp
,

649 &
cfg_cmd
);

655 
°a
->
deÊök
.
agg
.
max_amsdu_Àn
 = max_amsdu_len;

657 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

658 
	`WIDE_ID
(
DATA_PATH_GROUP
,

659 
TLC_MNG_CONFIG_CMD
),

661 
	`IWL_DEBUG_RATE
(
mvm
, "TLC CONFIG CMD, sta_id=%d, max_ch_width=%d, mode=%d\n",

662 
cfg_cmd
.
°a_id
, cfg_cmd.
max_ch_width
, cfg_cmd.
mode
);

663 
	`IWL_DEBUG_RATE
(
mvm
, "TLC CONFIG CMD, chains=0x%X, ch_wid_supp=%d, flags=0x%X\n",

664 
cfg_cmd
.
chaös
, cfg_cmd.
sgi_ch_width_suµ
, cfg_cmd.
Êags
);

665 
	`IWL_DEBUG_RATE
(
mvm
, "TLC CONFIG CMD, mpdu_len=%d,Ço_ht_rate=0x%X,Åx_op=%d\n",

666 
cfg_cmd
.
max_mpdu_Àn
, cfg_cmd.
n⁄_ht_øãs
, cfg_cmd.
max_tx_›
);

667 
	`IWL_DEBUG_RATE
(
mvm
, "TLC CONFIG CMD, ht_rate[0][0]=0x%X, ht_rate[1][0]=0x%X\n",

668 
cfg_cmd
.
ht_øãs
[0][0], cfg_cmd.ht_rates[1][0]);

669 
	`IWL_DEBUG_RATE
(
mvm
, "TLC CONFIG CMD, ht_rate[0][1]=0x%X, ht_rate[1][1]=0x%X\n",

670 
cfg_cmd
.
ht_øãs
[0][1], cfg_cmd.ht_rates[1][1]);

671 
	`IWL_DEBUG_RATE
(
mvm
, "TLC CONFIG CMD, ht_rate[0][2]=0x%X, ht_rate[1][2]=0x%X\n",

672 
cfg_cmd
.
ht_øãs
[0][2], cfg_cmd.ht_rates[1][2]);

673 i‡(
cmd_vî
 == 4) {

674 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 
CMD_ASYNC
,

675 (
cfg_cmd
), &cfg_cmd);

676 } i‡(
cmd_vî
 < 4) {

677 
iwl_éc_c⁄fig_cmd_v3
 
cfg_cmd_v3
 = {

678 .
°a_id
 = 
cfg_cmd
.sta_id,

679 .
max_ch_width
 = 
cfg_cmd
.max_ch_width,

680 .
mode
 = 
cfg_cmd
.mode,

681 .
chaös
 = 
cfg_cmd
.chains,

682 .
amsdu
 = !!
cfg_cmd
.
max_mpdu_Àn
,

683 .
Êags
 = 
cfg_cmd
.flags,

684 .
n⁄_ht_øãs
 = 
cfg_cmd
.non_ht_rates,

685 .
ht_øãs
[0][0] = 
cfg_cmd
.ht_rates[0][0],

686 .
ht_øãs
[0][1] = 
cfg_cmd
.ht_rates[0][1],

687 .
ht_øãs
[1][0] = 
cfg_cmd
.ht_rates[1][0],

688 .
ht_øãs
[1][1] = 
cfg_cmd
.ht_rates[1][1],

689 .
sgi_ch_width_suµ
 = 
cfg_cmd
.sgi_ch_width_supp,

690 .
max_mpdu_Àn
 = 
cfg_cmd
.max_mpdu_len,

693 
u16
 
cmd_size
 = (
cfg_cmd_v3
);

696 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

697 
	`WIDE_ID
(
DATA_PATH_GROUP
,

698 
TLC_MNG_CONFIG_CMD
), 0) < 3)

699 
cmd_size
 -= 4;

701 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 
CMD_ASYNC
, 
cmd_size
,

702 &
cfg_cmd_v3
);

704 
ªt
 = -
EINVAL
;

707 i‡(
ªt
)

708 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£ndÑ©êsˇÀ c⁄fig (%d)\n", 
ªt
);

709 
	}
}

711 
	$rs_fw_tx_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

712 
boﬁ
 
íabÀ
)

715 
	`IWL_DEBUG_RATE
(
mvm
, "txÖrotection -Çot implemented yet.\n");

717 
	}
}

719 
	$iwl_mvm_rs_add_°a_lök
(
iwl_mvm
 *
mvm
,

720 
iwl_mvm_lök_°a
 *
lök_°a
)

722 
iwl_lq_°a_rs_fw
 *
lq_°a
;

724 
lq_°a
 = &
lök_°a
->lq_°a.
rs_fw
;

726 
lq_°a
->
≥rs
.
drv
 = 
mvm
;

727 
lq_°a
->
≥rs
.
°a_id
 = 
lök_°a
->sta_id;

728 
lq_°a
->
≥rs
.
chaös
 = 0;

729 
	`mem£t
(
lq_°a
->
≥rs
.
chaö_sig«l
, 0,

730 (
lq_°a
->
≥rs
.
chaö_sig«l
));

731 
lq_°a
->
≥rs
.
œ°_rssi
 = 
S8_MIN
;

732 
lq_°a
->
œ°_øã_n_Êags
 = 0;

734 #ifde‡
CONFIG_MAC80211_DEBUGFS


735 
lq_°a
->
≥rs
.
dbg_fixed_øã
 = 0;

737 
	}
}

739 
	$iwl_mvm_rs_add_°a
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
)

741 
lök_id
;

743 
	`IWL_DEBUG_RATE
(
mvm
, "create stationÑate scale window\n");

745 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
mvm°a
->
lök
);Üink_id++) {

746 
iwl_mvm_lök_°a
 *
lök
 =

747 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm°a
->
lök
[
lök_id
],

748 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

749 i‡(!
lök
)

752 
	`iwl_mvm_rs_add_°a_lök
(
mvm
, 
lök
);

754 
	}
}

	@mvm/rs.c

8 
	~<löux/kî√l.h
>

9 
	~<löux/skbuff.h
>

10 
	~<löux/¶ab.h
>

11 
	~<√t/mac80211.h
>

13 
	~<löux/√tdevi˚.h
>

14 
	~<löux/ëhîdevi˚.h
>

15 
	~<löux/dñay.h
>

17 
	~<löux/w‹kqueue.h
>

18 
	~"rs.h
"

19 
	~"fw-≠i.h
"

20 
	~"°a.h
"

21 
	~"iwl-›-mode.h
"

22 
	~"mvm.h
"

23 
	~"debugfs.h
"

25 
	#IWL_RATE_MAX_WINDOW
 62

	)

30 
	#RS_PERCENT
(
x
Ë(128 * x)

	)

32 
u8
 
	grs_ht_to_Àgacy
[] = {

33 [
IWL_RATE_MCS_0_INDEX
] = 
IWL_RATE_6M_INDEX
,

34 [
IWL_RATE_MCS_1_INDEX
] = 
IWL_RATE_9M_INDEX
,

35 [
IWL_RATE_MCS_2_INDEX
] = 
IWL_RATE_12M_INDEX
,

36 [
IWL_RATE_MCS_3_INDEX
] = 
IWL_RATE_18M_INDEX
,

37 [
IWL_RATE_MCS_4_INDEX
] = 
IWL_RATE_24M_INDEX
,

38 [
IWL_RATE_MCS_5_INDEX
] = 
IWL_RATE_36M_INDEX
,

39 [
IWL_RATE_MCS_6_INDEX
] = 
IWL_RATE_48M_INDEX
,

40 [
IWL_RATE_MCS_7_INDEX
] = 
IWL_RATE_54M_INDEX
,

41 [
IWL_RATE_MCS_8_INDEX
] = 
IWL_RATE_54M_INDEX
,

42 [
IWL_RATE_MCS_9_INDEX
] = 
IWL_RATE_54M_INDEX
,

45 c⁄° 
u8
 
	g™t_toggÀ_lookup
[] = {

46 [
ANT_NONE
] = ANT_NONE,

47 [
ANT_A
] = 
ANT_B
,

48 [
ANT_B
] = 
ANT_A
,

49 [
ANT_AB
] = ANT_AB,

52 
	#IWL_DECLARE_RATE_INFO
(
r
, 
s
, 
Ω
, 
∫
) \

53 [
IWL_RATE_
##
r
##
M_INDEX
] = { IWL_RATE_##r##
M_PLCP
, \

54 
IWL_RATE_HT_SISO_MCS_
##
s
##
_PLCP
, \

55 
IWL_RATE_HT_MIMO2_MCS_
##
s
##
_PLCP
, \

56 
IWL_RATE_VHT_SISO_MCS_
##
s
##
_PLCP
, \

57 
IWL_RATE_VHT_MIMO2_MCS_
##
s
##
_PLCP
,\

58 
IWL_RATE_
##
Ω
##
M_INDEX
, \

59 
IWL_RATE_
##
∫
##
M_INDEX
 }

	)

61 
	#IWL_DECLARE_MCS_RATE
(
s
) \

62 [
IWL_RATE_MCS_
##
s
##
_INDEX
] = { 
IWL_RATE_INVM_PLCP
, \

63 
IWL_RATE_HT_SISO_MCS_
##
s
##
_PLCP
, \

64 
IWL_RATE_HT_MIMO2_MCS_
##
s
##
_PLCP
, \

65 
IWL_RATE_VHT_SISO_MCS_
##
s
##
_PLCP
, \

66 
IWL_RATE_VHT_MIMO2_MCS_
##
s
##
_PLCP
, \

67 
IWL_RATE_INVM_INDEX
, \

68 
IWL_RATE_INVM_INDEX
 }

	)

78 c⁄° 
iwl_rs_øã_öfo
 
	giwl_øãs
[
IWL_RATE_COUNT
] = {

79 
IWL_DECLARE_RATE_INFO
(1, 
INV
, INV, 2),

80 
IWL_DECLARE_RATE_INFO
(2, 
INV
, 1, 5),

81 
IWL_DECLARE_RATE_INFO
(5, 
INV
, 2, 11),

82 
IWL_DECLARE_RATE_INFO
(11, 
INV
, 9, 12),

83 
IWL_DECLARE_RATE_INFO
(6, 0, 5, 11),

84 
IWL_DECLARE_RATE_INFO
(9, 
INV
, 6, 11),

85 
IWL_DECLARE_RATE_INFO
(12, 1, 11, 18),

86 
IWL_DECLARE_RATE_INFO
(18, 2, 12, 24),

87 
IWL_DECLARE_RATE_INFO
(24, 3, 18, 36),

88 
IWL_DECLARE_RATE_INFO
(36, 4, 24, 48),

89 
IWL_DECLARE_RATE_INFO
(48, 5, 36, 54),

90 
IWL_DECLARE_RATE_INFO
(54, 6, 48, 
INV
),

91 
IWL_DECLARE_MCS_RATE
(7),

92 
IWL_DECLARE_MCS_RATE
(8),

93 
IWL_DECLARE_MCS_RATE
(9),

96 
	ers_a˘i⁄
 {

97 
	mRS_ACTION_STAY
 = 0,

98 
	mRS_ACTION_DOWNSCALE
 = -1,

99 
	mRS_ACTION_UPSCALE
 = 1,

102 
	ers_cﬁumn_mode
 {

103 
	mRS_INVALID
 = 0,

104 
	mRS_LEGACY
,

105 
	mRS_SISO
,

106 
	mRS_MIMO2
,

109 
	#MAX_NEXT_COLUMNS
 7

	)

110 
	#MAX_COLUMN_CHECKS
 3

	)

112 
	grs_tx_cﬁumn
;

114 
	$boﬁ
 (*
	tÆlow_cﬁumn_func_t
Ë(
	tiwl_mvm
 *
	tmvm
,

115 
	tõì80211_°a
 *
	t°a
,

116 
	trs_øã
 *
	tøã
,

117 c⁄° 
	trs_tx_cﬁumn
 *
	t√xt_cﬁ
);

119 
	srs_tx_cﬁumn
 {

120 
rs_cﬁumn_mode
 
mode
;

121 
u8
 
™t
;

122 
boﬁ
 
sgi
;

123 
rs_cﬁumn
 
√xt_cﬁumns
[
MAX_NEXT_COLUMNS
];

124 
Ælow_cﬁumn_func_t
 
checks
[
MAX_COLUMN_CHECKS
];

127 
boﬁ
 
	$rs_™t_Ælow
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

128 
rs_øã
 *
øã
,

129 c⁄° 
rs_tx_cﬁumn
 *
√xt_cﬁ
)

131  
	`iwl_mvm_bt_c€x_is_™t_avaû
(
mvm
, 
√xt_cﬁ
->
™t
);

132 
	}
}

134 
boﬁ
 
	$rs_mimo_Ælow
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

135 
rs_øã
 *
øã
,

136 c⁄° 
rs_tx_cﬁumn
 *
√xt_cﬁ
)

138 i‡(!
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
)

139  
Ál£
;

141 i‡(
°a
->
deÊök
.
smps_mode
 =
IEEE80211_SMPS_STATIC
)

142  
Ál£
;

144 i‡(
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
)) < 2)

145  
Ál£
;

147 i‡(!
	`iwl_mvm_bt_c€x_is_mimo_Ælowed
(
mvm
, 
°a
))

148  
Ál£
;

150 i‡(
mvm
->
nvm_d©a
->
sku_ˇp_mimo_dißbÀd
)

151  
Ál£
;

153  
åue
;

154 
	}
}

156 
boﬁ
 
	$rs_siso_Ælow
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

157 
rs_øã
 *
øã
,

158 c⁄° 
rs_tx_cﬁumn
 *
√xt_cﬁ
)

160 i‡(!
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
)

161  
Ál£
;

163  
åue
;

164 
	}
}

166 
boﬁ
 
	$rs_sgi_Ælow
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

167 
rs_øã
 *
øã
,

168 c⁄° 
rs_tx_cﬁumn
 *
√xt_cﬁ
)

170 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

171 
õì80211_°a_vht_ˇp
 *
vht_ˇp
 = &
°a
->
deÊök
.vht_cap;

173 i‡(
	`is_ht20
(
øã
Ë&& (
ht_ˇp
->
ˇp
 &

174 
IEEE80211_HT_CAP_SGI_20
))

175  
åue
;

176 i‡(
	`is_ht40
(
øã
Ë&& (
ht_ˇp
->
ˇp
 &

177 
IEEE80211_HT_CAP_SGI_40
))

178  
åue
;

179 i‡(
	`is_ht80
(
øã
Ë&& (
vht_ˇp
->
ˇp
 &

180 
IEEE80211_VHT_CAP_SHORT_GI_80
))

181  
åue
;

182 i‡(
	`is_ht160
(
øã
Ë&& (
vht_ˇp
->
ˇp
 &

183 
IEEE80211_VHT_CAP_SHORT_GI_160
))

184  
åue
;

186  
Ál£
;

187 
	}
}

189 c⁄° 
rs_tx_cﬁumn
 
	grs_tx_cﬁumns
[] = {

190 [
RS_COLUMN_LEGACY_ANT_A
] = {

191 .
mode
 = 
RS_LEGACY
,

192 .
	g™t
 = 
ANT_A
,

193 .
	g√xt_cﬁumns
 = {

194 
RS_COLUMN_LEGACY_ANT_B
,

195 
RS_COLUMN_SISO_ANT_A
,

196 
RS_COLUMN_MIMO2
,

197 
RS_COLUMN_INVALID
,

198 
RS_COLUMN_INVALID
,

199 
RS_COLUMN_INVALID
,

200 
RS_COLUMN_INVALID
,

202 .
	gchecks
 = {

203 
rs_™t_Ælow
,

206 [
RS_COLUMN_LEGACY_ANT_B
] = {

207 .
mode
 = 
RS_LEGACY
,

208 .
	g™t
 = 
ANT_B
,

209 .
	g√xt_cﬁumns
 = {

210 
RS_COLUMN_LEGACY_ANT_A
,

211 
RS_COLUMN_SISO_ANT_B
,

212 
RS_COLUMN_MIMO2
,

213 
RS_COLUMN_INVALID
,

214 
RS_COLUMN_INVALID
,

215 
RS_COLUMN_INVALID
,

216 
RS_COLUMN_INVALID
,

218 .
	gchecks
 = {

219 
rs_™t_Ælow
,

222 [
RS_COLUMN_SISO_ANT_A
] = {

223 .
mode
 = 
RS_SISO
,

224 .
	g™t
 = 
ANT_A
,

225 .
	g√xt_cﬁumns
 = {

226 
RS_COLUMN_SISO_ANT_B
,

227 
RS_COLUMN_MIMO2
,

228 
RS_COLUMN_SISO_ANT_A_SGI
,

229 
RS_COLUMN_LEGACY_ANT_A
,

230 
RS_COLUMN_LEGACY_ANT_B
,

231 
RS_COLUMN_INVALID
,

232 
RS_COLUMN_INVALID
,

234 .
	gchecks
 = {

235 
rs_siso_Ælow
,

236 
rs_™t_Ælow
,

239 [
RS_COLUMN_SISO_ANT_B
] = {

240 .
mode
 = 
RS_SISO
,

241 .
	g™t
 = 
ANT_B
,

242 .
	g√xt_cﬁumns
 = {

243 
RS_COLUMN_SISO_ANT_A
,

244 
RS_COLUMN_MIMO2
,

245 
RS_COLUMN_SISO_ANT_B_SGI
,

246 
RS_COLUMN_LEGACY_ANT_A
,

247 
RS_COLUMN_LEGACY_ANT_B
,

248 
RS_COLUMN_INVALID
,

249 
RS_COLUMN_INVALID
,

251 .
	gchecks
 = {

252 
rs_siso_Ælow
,

253 
rs_™t_Ælow
,

256 [
RS_COLUMN_SISO_ANT_A_SGI
] = {

257 .
mode
 = 
RS_SISO
,

258 .
	g™t
 = 
ANT_A
,

259 .
	gsgi
 = 
åue
,

260 .
	g√xt_cﬁumns
 = {

261 
RS_COLUMN_SISO_ANT_B_SGI
,

262 
RS_COLUMN_MIMO2_SGI
,

263 
RS_COLUMN_SISO_ANT_A
,

264 
RS_COLUMN_LEGACY_ANT_A
,

265 
RS_COLUMN_LEGACY_ANT_B
,

266 
RS_COLUMN_INVALID
,

267 
RS_COLUMN_INVALID
,

269 .
	gchecks
 = {

270 
rs_siso_Ælow
,

271 
rs_™t_Ælow
,

272 
rs_sgi_Ælow
,

275 [
RS_COLUMN_SISO_ANT_B_SGI
] = {

276 .
mode
 = 
RS_SISO
,

277 .
	g™t
 = 
ANT_B
,

278 .
	gsgi
 = 
åue
,

279 .
	g√xt_cﬁumns
 = {

280 
RS_COLUMN_SISO_ANT_A_SGI
,

281 
RS_COLUMN_MIMO2_SGI
,

282 
RS_COLUMN_SISO_ANT_B
,

283 
RS_COLUMN_LEGACY_ANT_A
,

284 
RS_COLUMN_LEGACY_ANT_B
,

285 
RS_COLUMN_INVALID
,

286 
RS_COLUMN_INVALID
,

288 .
	gchecks
 = {

289 
rs_siso_Ælow
,

290 
rs_™t_Ælow
,

291 
rs_sgi_Ælow
,

294 [
RS_COLUMN_MIMO2
] = {

295 .
mode
 = 
RS_MIMO2
,

296 .
	g™t
 = 
ANT_AB
,

297 .
	g√xt_cﬁumns
 = {

298 
RS_COLUMN_SISO_ANT_A
,

299 
RS_COLUMN_MIMO2_SGI
,

300 
RS_COLUMN_LEGACY_ANT_A
,

301 
RS_COLUMN_LEGACY_ANT_B
,

302 
RS_COLUMN_INVALID
,

303 
RS_COLUMN_INVALID
,

304 
RS_COLUMN_INVALID
,

306 .
	gchecks
 = {

307 
rs_mimo_Ælow
,

310 [
RS_COLUMN_MIMO2_SGI
] = {

311 .
mode
 = 
RS_MIMO2
,

312 .
	g™t
 = 
ANT_AB
,

313 .
	gsgi
 = 
åue
,

314 .
	g√xt_cﬁumns
 = {

315 
RS_COLUMN_SISO_ANT_A_SGI
,

316 
RS_COLUMN_MIMO2
,

317 
RS_COLUMN_LEGACY_ANT_A
,

318 
RS_COLUMN_LEGACY_ANT_B
,

319 
RS_COLUMN_INVALID
,

320 
RS_COLUMN_INVALID
,

321 
RS_COLUMN_INVALID
,

323 .
	gchecks
 = {

324 
rs_mimo_Ælow
,

325 
rs_sgi_Ælow
,

330 
ölöe
 
u8
 
	$rs_exåa˘_øã
(
u32
 
øã_n_Êags
)

333  (
u8
)(
øã_n_Êags
 & 
RATE_LEGACY_RATE_MSK_V1
);

334 
	}
}

336 
	$iwl_hwøã_to_∂˝_idx
(
u32
 
øã_n_Êags
)

338 
idx
 = 0;

340 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK_V1
) {

341 
idx
 = 
øã_n_Êags
 & 
RATE_HT_MCS_RATE_CODE_MSK_V1
;

342 
idx
 +
IWL_RATE_MCS_0_INDEX
;

345 i‡(
idx
 >
IWL_RATE_9M_INDEX
)

346 
idx
 += 1;

347 i‡((
idx
 >
IWL_FIRST_HT_RATE
Ë&& (idx <
IWL_LAST_HT_RATE
))

348  
idx
;

349 } i‡(
øã_n_Êags
 & 
RATE_MCS_VHT_MSK_V1
 ||

350 
øã_n_Êags
 & 
RATE_MCS_HE_MSK_V1
) {

351 
idx
 = 
øã_n_Êags
 & 
RATE_VHT_MCS_RATE_CODE_MSK
;

352 
idx
 +
IWL_RATE_MCS_0_INDEX
;

355 i‡(
idx
 >
IWL_RATE_9M_INDEX
)

356 
idx
++;

357 i‡((
idx
 >
IWL_FIRST_VHT_RATE
Ë&& (idx <
IWL_LAST_VHT_RATE
))

358  
idx
;

359 i‡((
øã_n_Êags
 & 
RATE_MCS_HE_MSK_V1
) &&

360 
idx
 <
IWL_LAST_HE_RATE
)

361  
idx
;

365 
u8
 
Àgacy_øã
 = 
	`rs_exåa˘_øã
(
øã_n_Êags
);

366 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
iwl_øãs
); idx++)

367 i‡(
iwl_øãs
[
idx
].
∂˝
 =
Àgacy_øã
)

368  
idx
;

371  
IWL_RATE_INVALID
;

372 
	}
}

374 
rs_øã_sˇÀ_≥rf‹m
(
iwl_mvm
 *
mvm
,

375 
õì80211_°a
 *
°a
,

376 
iwl_lq_°a
 *
lq_°a
,

377 
tid
, 
boﬁ
 
ndp
);

378 
rs_fûl_lq_cmd
(
iwl_mvm
 *
mvm
,

379 
õì80211_°a
 *
°a
,

380 
iwl_lq_°a
 *
lq_°a
,

381 c⁄° 
rs_øã
 *
öôül_øã
);

382 
rs_°ay_ö_èbÀ
(
iwl_lq_°a
 *
lq_°a
, 
boﬁ
 
f‹˚_£¨ch
);

394 c⁄° 
u16
 
	gex≥˘ed_çt_Àgacy
[
IWL_RATE_COUNT
] = {

401 c⁄° 
u16
 
	gex≥˘ed_çt_siso_20MHz
[4][
IWL_RATE_COUNT
] = {

408 c⁄° 
u16
 
	gex≥˘ed_çt_siso_40MHz
[4][
IWL_RATE_COUNT
] = {

415 c⁄° 
u16
 
	gex≥˘ed_çt_siso_80MHz
[4][
IWL_RATE_COUNT
] = {

422 c⁄° 
u16
 
	gex≥˘ed_çt_siso_160MHz
[4][
IWL_RATE_COUNT
] = {

429 c⁄° 
u16
 
	gex≥˘ed_çt_mimo2_20MHz
[4][
IWL_RATE_COUNT
] = {

436 c⁄° 
u16
 
	gex≥˘ed_çt_mimo2_40MHz
[4][
IWL_RATE_COUNT
] = {

443 c⁄° 
u16
 
	gex≥˘ed_çt_mimo2_80MHz
[4][
IWL_RATE_COUNT
] = {

450 c⁄° 
u16
 
	gex≥˘ed_çt_mimo2_160MHz
[4][
IWL_RATE_COUNT
] = {

457 c⁄° *
	$rs_¥ëty_lq_ty≥
(
iwl_èbÀ_ty≥
 
ty≥
)

459 c⁄° * c⁄° 
lq_ty≥s
[] = {

460 [
LQ_NONE
] = "NONE",

461 [
LQ_LEGACY_A
] = "LEGACY_A",

462 [
LQ_LEGACY_G
] = "LEGACY_G",

463 [
LQ_HT_SISO
] = "HT SISO",

464 [
LQ_HT_MIMO2
] = "HT MIMO",

465 [
LQ_VHT_SISO
] = "VHT SISO",

466 [
LQ_VHT_MIMO2
] = "VHT MIMO",

467 [
LQ_HE_SISO
] = "HE SISO",

468 [
LQ_HE_MIMO2
] = "HE MIMO",

471 i‡(
ty≥
 < 
LQ_NONE
 ||Åy≥ >
LQ_MAX
)

474  
lq_ty≥s
[
ty≥
];

475 
	}
}

477 *
	$rs_¥ëty_øã
(c⁄° 
rs_øã
 *
øã
)

479 
buf
[40];

480 c⁄° * c⁄° 
Àgacy_øãs
[] = {

481 [
IWL_RATE_1M_INDEX
] = "1M",

482 [
IWL_RATE_2M_INDEX
] = "2M",

483 [
IWL_RATE_5M_INDEX
] = "5.5M",

484 [
IWL_RATE_11M_INDEX
] = "11M",

485 [
IWL_RATE_6M_INDEX
] = "6M",

486 [
IWL_RATE_9M_INDEX
] = "9M",

487 [
IWL_RATE_12M_INDEX
] = "12M",

488 [
IWL_RATE_18M_INDEX
] = "18M",

489 [
IWL_RATE_24M_INDEX
] = "24M",

490 [
IWL_RATE_36M_INDEX
] = "36M",

491 [
IWL_RATE_48M_INDEX
] = "48M",

492 [
IWL_RATE_54M_INDEX
] = "54M",

494 c⁄° *c⁄° 
ht_vht_øãs
[] = {

495 [
IWL_RATE_MCS_0_INDEX
] = "MCS0",

496 [
IWL_RATE_MCS_1_INDEX
] = "MCS1",

497 [
IWL_RATE_MCS_2_INDEX
] = "MCS2",

498 [
IWL_RATE_MCS_3_INDEX
] = "MCS3",

499 [
IWL_RATE_MCS_4_INDEX
] = "MCS4",

500 [
IWL_RATE_MCS_5_INDEX
] = "MCS5",

501 [
IWL_RATE_MCS_6_INDEX
] = "MCS6",

502 [
IWL_RATE_MCS_7_INDEX
] = "MCS7",

503 [
IWL_RATE_MCS_8_INDEX
] = "MCS8",

504 [
IWL_RATE_MCS_9_INDEX
] = "MCS9",

506 c⁄° *
øã_°r
;

508 i‡(
	`is_ty≥_Àgacy
(
øã
->
ty≥
Ë&& (øã->
ödex
 <
IWL_RATE_54M_INDEX
))

509 
øã_°r
 = 
Àgacy_øãs
[
øã
->
ödex
];

510 i‡((
	`is_ty≥_ht
(
øã
->
ty≥
Ë|| 
	`is_ty≥_vht
(rate->type)) &&

511 (
øã
->
ödex
 >
IWL_RATE_MCS_0_INDEX
) &&

512 (
øã
->
ödex
 <
IWL_RATE_MCS_9_INDEX
))

513 
øã_°r
 = 
ht_vht_øãs
[
øã
->
ödex
];

515 
øã_°r
 = 
NULL
;

517 
	`•rötf
(
buf
, "(%s|%s|%s)", 
	`rs_¥ëty_lq_ty≥
(
øã
->
ty≥
),

518 
	`iwl_rs_¥ëty_™t
(
øã
->
™t
), 
øã_°r
 ?: "BAD_RATE");

519  
buf
;

520 
	}
}

522 
ölöe
 
	$rs_dump_øã
(
iwl_mvm
 *
mvm
, c⁄° 
rs_øã
 *
øã
,

523 c⁄° *
¥efix
)

525 
	`IWL_DEBUG_RATE
(
mvm
,

527 
¥efix
, 
	`rs_¥ëty_øã
(
øã
),Ñ©e->
bw
,

528 
øã
->
sgi
,Ñ©e->
ldpc
,Ñ©e->
°bc
);

529 
	}
}

531 
	$rs_øã_sˇÀ_˛ór_wödow
(
iwl_øã_sˇÀ_d©a
 *
wödow
)

533 
wödow
->
d©a
 = 0;

534 
wödow
->
suc˚ss_cou¡î
 = 0;

535 
wödow
->
suc˚ss_øtio
 = 
IWL_INVALID_VALUE
;

536 
wödow
->
cou¡î
 = 0;

537 
wödow
->
avîage_çt
 = 
IWL_INVALID_VALUE
;

538 
	}
}

540 
	$rs_øã_sˇÀ_˛ór_tbl_wödows
(
iwl_mvm
 *
mvm
,

541 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

543 
i
;

545 
	`IWL_DEBUG_RATE
(
mvm
, "Clearing up window stats\n");

546 
i
 = 0; i < 
IWL_RATE_COUNT
; i++)

547 
	`rs_øã_sˇÀ_˛ór_wödow
(&
tbl
->
wö
[
i
]);

549 
i
 = 0; i < 
	`ARRAY_SIZE
(
tbl
->
çc_wö
); i++)

550 
	`rs_øã_sˇÀ_˛ór_wödow
(&
tbl
->
çc_wö
[
i
]);

551 
	}
}

553 
ölöe
 
u8
 
	$rs_is_vÆid_™t
(
u8
 
vÆid_™ã¬a
, u8 
™t_ty≥
)

555  (
™t_ty≥
 & 
vÆid_™ã¬a
) ==ánt_type;

556 
	}
}

558 
	$rs_é_tu∫_⁄_agg_f‹_tid
(
iwl_mvm
 *
mvm
,

559 
iwl_lq_°a
 *
lq_d©a
, 
u8
 
tid
,

560 
õì80211_°a
 *
°a
)

562 
ªt
;

564 
	`IWL_DEBUG_HT
(
mvm
, "Starting Txágg: STA: %pMÅid: %d\n",

565 
°a
->
addr
, 
tid
);

568 
ªt
 = 
	`õì80211_°¨t_tx_ba_£ssi⁄
(
°a
, 
tid
, 0);

569 i‡(
ªt
 =-
EAGAIN
) {

575 
	`IWL_ERR
(
mvm
, "Fail start Txágg onÅid: %d\n",

576 
tid
);

577 
	`õì80211_°›_tx_ba_£ssi⁄
(
°a
, 
tid
);

579  
ªt
;

580 
	}
}

582 
	$rs_é_tu∫_⁄_agg
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

583 
u8
 
tid
, 
iwl_lq_°a
 *
lq_°a
,

584 
õì80211_°a
 *
°a
)

586 
iwl_mvm_tid_d©a
 *
tid_d©a
;

592 i‡(
	`WARN_ON_ONCE
(
tid
 > 
IWL_MAX_TID_COUNT
)) {

593 
	`IWL_ERR
(
mvm
, "tidÉxceeds max TID count: %d/%d\n",

594 
tid
, 
IWL_MAX_TID_COUNT
);

596 } i‡(
tid
 =
IWL_MAX_TID_COUNT
) {

600 
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

601 i‡(
mvm°a
->
°a_°©e
 >
IEEE80211_STA_AUTHORIZED
 &&

602 
tid_d©a
->
°©e
 =
IWL_AGG_OFF
 &&

603 (
lq_°a
->
tx_agg_tid_í
 & 
	`BIT
(
tid
)) &&

604 
tid_d©a
->
tx_cou¡_œ°
 >
IWL_MVM_RS_AGG_START_THRESHOLD
) {

605 
	`IWL_DEBUG_RATE
(
mvm
, "åyÅÿaggªg©êtid %d\n", 
tid
);

606 i‡(
	`rs_é_tu∫_⁄_agg_f‹_tid
(
mvm
, 
lq_°a
, 
tid
, 
°a
) == 0)

607 
tid_d©a
->
°©e
 = 
IWL_AGG_QUEUED
;

609 
	}
}

611 
ölöe
 
	$gë_num_of_™t_‰om_øã
(
u32
 
øã_n_Êags
)

613  !!(
øã_n_Êags
 & 
RATE_MCS_ANT_A_MSK
) +

614 !!(
øã_n_Êags
 & 
RATE_MCS_ANT_B_MSK
);

615 
	}
}

621 
s32
 
	$gë_ex≥˘ed_çt
(
iwl_sˇÀ_tbl_öfo
 *
tbl
, 
rs_ödex
)

623 i‡(
tbl
->
ex≥˘ed_çt
)

624  
tbl
->
ex≥˘ed_çt
[
rs_ödex
];

626 
	}
}

635 
	$_rs_cﬁÀ˘_tx_d©a
(
iwl_mvm
 *
mvm
,

636 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

637 
sˇÀ_ödex
, 
©ãm±s
, 
suc˚s£s
,

638 
iwl_øã_sˇÀ_d©a
 *
wödow
)

640 c⁄° 
u64
 
mask
 = (((u64)1Ë<< (
IWL_RATE_MAX_WINDOW
 - 1));

641 
s32
 
Áû_cou¡
, 
çt
;

644 
çt
 = 
	`gë_ex≥˘ed_çt
(
tbl
, 
sˇÀ_ödex
);

654 
©ãm±s
 > 0) {

655 i‡(
wödow
->
cou¡î
 >
IWL_RATE_MAX_WINDOW
) {

657 
wödow
->
cou¡î
 = 
IWL_RATE_MAX_WINDOW
 - 1;

659 i‡(
wödow
->
d©a
 & 
mask
) {

660 
wödow
->
d©a
 &~
mask
;

661 
wödow
->
suc˚ss_cou¡î
--;

666 
wödow
->
cou¡î
++;

669 
wödow
->
d©a
 <<= 1;

672 i‡(
suc˚s£s
 > 0) {

673 
wödow
->
suc˚ss_cou¡î
++;

674 
wödow
->
d©a
 |= 0x1;

675 
suc˚s£s
--;

678 
©ãm±s
--;

682 i‡(
wödow
->
cou¡î
 > 0)

683 
wödow
->
suc˚ss_øtio
 = 128 * (100 * wödow->
suc˚ss_cou¡î
)

684 / 
wödow
->
cou¡î
;

686 
wödow
->
suc˚ss_øtio
 = 
IWL_INVALID_VALUE
;

688 
Áû_cou¡
 = 
wödow
->
cou¡î
 - wödow->
suc˚ss_cou¡î
;

691 i‡((
Áû_cou¡
 >
IWL_MVM_RS_RATE_MIN_FAILURE_TH
) ||

692 (
wödow
->
suc˚ss_cou¡î
 >
IWL_MVM_RS_RATE_MIN_SUCCESS_TH
))

693 
wödow
->
avîage_çt
 = (wödow->
suc˚ss_øtio
 * 
çt
 + 64) / 128;

695 
wödow
->
avîage_çt
 = 
IWL_INVALID_VALUE
;

698 
	}
}

700 
	$rs_cﬁÀ˘_çc_d©a
(
iwl_mvm
 *
mvm
,

701 
iwl_lq_°a
 *
lq_°a
,

702 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

703 
sˇÀ_ödex
, 
©ãm±s
, 
suc˚s£s
,

704 
u8
 
ªdu˚d_txp
)

706 
iwl_øã_sˇÀ_d©a
 *
wödow
 = 
NULL
;

708 i‡(
	`WARN_ON_ONCE
(
ªdu˚d_txp
 > 
TPC_MAX_REDUCTION
))

709  -
EINVAL
;

711 
wödow
 = &
tbl
->
çc_wö
[
ªdu˚d_txp
];

712  
	`_rs_cﬁÀ˘_tx_d©a
(
mvm
, 
tbl
, 
sˇÀ_ödex
, 
©ãm±s
, 
suc˚s£s
,

713 
wödow
);

714 
	}
}

716 
	$rs_upd©e_tid_çt_°©s
(
iwl_mvm
 *
mvm
,

717 
iwl_mvm_°a
 *
mvm°a
,

718 
u8
 
tid
, 
suc˚s£s
)

720 
iwl_mvm_tid_d©a
 *
tid_d©a
;

722 i‡(
tid
 >
IWL_MAX_TID_COUNT
)

725 
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

733 i‡(
tid_d©a
->
°©e
 !
IWL_AGG_OFF
)

736 i‡(
	`time_is_bef‹e_jiffõs
(
tid_d©a
->
çt_mós_°¨t
 + 
HZ
) ||

737 (
tid_d©a
->
tx_cou¡
 >
IWL_MVM_RS_AGG_START_THRESHOLD
)) {

738 
tid_d©a
->
tx_cou¡_œ°
 =Åid_d©a->
tx_cou¡
;

739 
tid_d©a
->
tx_cou¡
 = 0;

740 
tid_d©a
->
çt_mós_°¨t
 = 
jiffõs
;

742 
tid_d©a
->
tx_cou¡
 +
suc˚s£s
;

744 
	}
}

746 
	$rs_cﬁÀ˘_éc_d©a
(
iwl_mvm
 *
mvm
,

747 
iwl_mvm_°a
 *
mvm°a
, 
u8
 
tid
,

748 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

749 
sˇÀ_ödex
, 
©ãm±s
, 
suc˚s£s
)

751 
iwl_øã_sˇÀ_d©a
 *
wödow
 = 
NULL
;

753 i‡(
sˇÀ_ödex
 < 0 || sˇÀ_ödex >
IWL_RATE_COUNT
)

754  -
EINVAL
;

756 i‡(
tbl
->
cﬁumn
 !
RS_COLUMN_INVALID
) {

757 
lq_°a_≥rs
 *
≥rs
 = &
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.pers;

759 
≥rs
->
tx_°©s
[
tbl
->
cﬁumn
][
sˇÀ_ödex
].
tŸÆ
 +
©ãm±s
;

760 
≥rs
->
tx_°©s
[
tbl
->
cﬁumn
][
sˇÀ_ödex
].
suc˚ss
 +
suc˚s£s
;

763 
	`rs_upd©e_tid_çt_°©s
(
mvm
, 
mvm°a
, 
tid
, 
suc˚s£s
);

766 
wödow
 = &(
tbl
->
wö
[
sˇÀ_ödex
]);

767  
	`_rs_cﬁÀ˘_tx_d©a
(
mvm
, 
tbl
, 
sˇÀ_ödex
, 
©ãm±s
, 
suc˚s£s
,

768 
wödow
);

769 
	}
}

772 
u32
 
	$ucode_øã_‰om_rs_øã
(
iwl_mvm
 *
mvm
,

773 
rs_øã
 *
øã
)

775 
u32
 
ucode_øã
 = 0;

776 
ödex
 = 
øã
->index;

778 
ucode_øã
 |((
øã
->
™t
 << 
RATE_MCS_ANT_POS
) &

779 
RATE_MCS_ANT_AB_MSK
);

781 i‡(
	`is_Àgacy
(
øã
)) {

782 
ucode_øã
 |
iwl_øãs
[
ödex
].
∂˝
;

783 i‡(
ödex
 >
IWL_FIRST_CCK_RATE
 && index <
IWL_LAST_CCK_RATE
)

784 
ucode_øã
 |
RATE_MCS_CCK_MSK_V1
;

785  
ucode_øã
;

792 
ucode_øã
 |
RATE_MCS_RTS_REQUIRED_MSK
;

794 i‡(
	`is_ht
(
øã
)) {

795 i‡(
ödex
 < 
IWL_FIRST_HT_RATE
 || index > 
IWL_LAST_HT_RATE
) {

796 
	`IWL_ERR
(
mvm
, "InvÆid HTÑ©êödex %d\n", 
ödex
);

797 
ödex
 = 
IWL_LAST_HT_RATE
;

799 
ucode_øã
 |
RATE_MCS_HT_MSK_V1
;

801 i‡(
	`is_ht_siso
(
øã
))

802 
ucode_øã
 |
iwl_øãs
[
ödex
].
∂˝_ht_siso
;

803 i‡(
	`is_ht_mimo2
(
øã
))

804 
ucode_øã
 |
iwl_øãs
[
ödex
].
∂˝_ht_mimo2
;

806 
	`WARN_ON_ONCE
(1);

807 } i‡(
	`is_vht
(
øã
)) {

808 i‡(
ödex
 < 
IWL_FIRST_VHT_RATE
 || index > 
IWL_LAST_VHT_RATE
) {

809 
	`IWL_ERR
(
mvm
, "InvÆid VHTÑ©êödex %d\n", 
ödex
);

810 
ödex
 = 
IWL_LAST_VHT_RATE
;

812 
ucode_øã
 |
RATE_MCS_VHT_MSK_V1
;

813 i‡(
	`is_vht_siso
(
øã
))

814 
ucode_øã
 |
iwl_øãs
[
ödex
].
∂˝_vht_siso
;

815 i‡(
	`is_vht_mimo2
(
øã
))

816 
ucode_øã
 |
iwl_øãs
[
ödex
].
∂˝_vht_mimo2
;

818 
	`WARN_ON_ONCE
(1);

821 
	`IWL_ERR
(
mvm
, "InvÆidÑ©e->ty≥ %d\n", 
øã
->
ty≥
);

824 i‡(
	`is_siso
(
øã
Ë&&Ñ©e->
°bc
) {

826 
ucode_øã
 |
RATE_MCS_ANT_AB_MSK
;

827 
ucode_øã
 |
RATE_MCS_STBC_MSK
;

830 
ucode_øã
 |
øã
->
bw
;

831 i‡(
øã
->
sgi
)

832 
ucode_øã
 |
RATE_MCS_SGI_MSK_V1
;

833 i‡(
øã
->
ldpc
)

834 
ucode_øã
 |
RATE_MCS_LDPC_MSK_V1
;

836  
ucode_øã
;

837 
	}
}

840 
	$rs_øã_‰om_ucode_øã
(c⁄° 
u32
 
ucode_øã
,

841 
∆80211_b™d
 
b™d
,

842 
rs_øã
 *
øã
)

844 
u32
 
™t_msk
 = 
ucode_øã
 & 
RATE_MCS_ANT_AB_MSK
;

845 
u8
 
num_of_™t
 = 
	`gë_num_of_™t_‰om_øã
(
ucode_øã
);

846 
u8
 
nss
;

848 
	`mem£t
(
øã
, 0, (*rate));

849 
øã
->
ödex
 = 
	`iwl_hwøã_to_∂˝_idx
(
ucode_øã
);

851 i‡(
øã
->
ödex
 =
IWL_RATE_INVALID
)

852  -
EINVAL
;

854 
øã
->
™t
 = (
™t_msk
 >> 
RATE_MCS_ANT_POS
);

857 i‡(!(
ucode_øã
 & 
RATE_MCS_HT_MSK_V1
) &&

858 !(
ucode_øã
 & 
RATE_MCS_VHT_MSK_V1
) &&

859 !(
ucode_øã
 & 
RATE_MCS_HE_MSK_V1
)) {

860 i‡(
num_of_™t
 == 1) {

861 i‡(
b™d
 =
NL80211_BAND_5GHZ
)

862 
øã
->
ty≥
 = 
LQ_LEGACY_A
;

864 
øã
->
ty≥
 = 
LQ_LEGACY_G
;

871 i‡(
ucode_øã
 & 
RATE_MCS_SGI_MSK_V1
)

872 
øã
->
sgi
 = 
åue
;

873 i‡(
ucode_øã
 & 
RATE_MCS_LDPC_MSK_V1
)

874 
øã
->
ldpc
 = 
åue
;

875 i‡(
ucode_øã
 & 
RATE_MCS_STBC_MSK
)

876 
øã
->
°bc
 = 
åue
;

877 i‡(
ucode_øã
 & 
RATE_MCS_BF_MSK
)

878 
øã
->
b„r
 = 
åue
;

880 
øã
->
bw
 = 
ucode_øã
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
;

882 i‡(
ucode_øã
 & 
RATE_MCS_HT_MSK_V1
) {

883 
nss
 = ((
ucode_øã
 & 
RATE_HT_MCS_NSS_MSK_V1
) >>

884 
RATE_HT_MCS_NSS_POS_V1
) + 1;

886 i‡(
nss
 == 1) {

887 
øã
->
ty≥
 = 
LQ_HT_SISO
;

888 
	`WARN_ONCE
(!
øã
->
°bc
 && !øã->
b„r
 && 
num_of_™t
 != 1,

890 
øã
->
°bc
,Ñ©e->
b„r
);

891 } i‡(
nss
 == 2) {

892 
øã
->
ty≥
 = 
LQ_HT_MIMO2
;

893 
	`WARN_ON_ONCE
(
num_of_™t
 != 2);

895 
	`WARN_ON_ONCE
(1);

897 } i‡(
ucode_øã
 & 
RATE_MCS_VHT_MSK_V1
) {

898 
nss
 = 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
ucode_øã
) + 1;

900 i‡(
nss
 == 1) {

901 
øã
->
ty≥
 = 
LQ_VHT_SISO
;

902 
	`WARN_ONCE
(!
øã
->
°bc
 && !øã->
b„r
 && 
num_of_™t
 != 1,

904 
øã
->
°bc
,Ñ©e->
b„r
);

905 } i‡(
nss
 == 2) {

906 
øã
->
ty≥
 = 
LQ_VHT_MIMO2
;

907 
	`WARN_ON_ONCE
(
num_of_™t
 != 2);

909 
	`WARN_ON_ONCE
(1);

911 } i‡(
ucode_øã
 & 
RATE_MCS_HE_MSK_V1
) {

912 
nss
 = 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
ucode_øã
) + 1;

914 i‡(
nss
 == 1) {

915 
øã
->
ty≥
 = 
LQ_HE_SISO
;

916 
	`WARN_ONCE
(!
øã
->
°bc
 && !øã->
b„r
 && 
num_of_™t
 != 1,

917 "°b¯%d b„∏%d", 
øã
->
°bc
,Ñ©e->
b„r
);

918 } i‡(
nss
 == 2) {

919 
øã
->
ty≥
 = 
LQ_HE_MIMO2
;

920 
	`WARN_ON_ONCE
(
num_of_™t
 != 2);

922 
	`WARN_ON_ONCE
(1);

926 
	`WARN_ON_ONCE
(
øã
->
bw
 =
RATE_MCS_CHAN_WIDTH_80
 &&

927 !
	`is_he
(
øã
Ë&& !
	`is_vht
(rate));

930 
	}
}

934 
	$rs_toggÀ_™ã¬a
(
u32
 
vÆid_™t
, 
rs_øã
 *
øã
)

936 
u8
 
√w_™t_ty≥
;

938 i‡(!
	`rs_is_vÆid_™t
(
vÆid_™t
, 
øã
->
™t
))

941 
√w_™t_ty≥
 = 
™t_toggÀ_lookup
[
øã
->
™t
];

943 (
√w_™t_ty≥
 !
øã
->
™t
) &&

944 !
	`rs_is_vÆid_™t
(
vÆid_™t
, 
√w_™t_ty≥
))

945 
√w_™t_ty≥
 = 
™t_toggÀ_lookup
[new_ant_type];

947 i‡(
√w_™t_ty≥
 =
øã
->
™t
)

950 
øã
->
™t
 = 
√w_™t_ty≥
;

953 
	}
}

955 
u16
 
	$rs_gë_suµ‹ãd_øãs
(
iwl_lq_°a
 *
lq_°a
,

956 
rs_øã
 *
øã
)

958 i‡(
	`is_Àgacy
(
øã
))

959  
lq_°a
->
a˘ive_Àgacy_øã
;

960 i‡(
	`is_siso
(
øã
))

961  
lq_°a
->
a˘ive_siso_øã
;

962 i‡(
	`is_mimo2
(
øã
))

963  
lq_°a
->
a˘ive_mimo2_øã
;

965 
	`WARN_ON_ONCE
(1);

967 
	}
}

969 
u16
 
	$rs_gë_adja˚¡_øã
(
iwl_mvm
 *
mvm
, 
u8
 
ödex
, 
u16
 
øã_mask
,

970 
øã_ty≥
)

972 
u8
 
high
 = 
IWL_RATE_INVALID
;

973 
u8
 
low
 = 
IWL_RATE_INVALID
;

977 i‡(
	`is_ty≥_a_b™d
(
øã_ty≥
Ë|| !
	`is_ty≥_Àgacy
(rate_type)) {

978 
i
;

979 
u32
 
mask
;

982 
i
 = 
ödex
 - 1;

983 i‡(
i
 >= 0)

984 
mask
 = 
	`BIT
(
i
);

985 ; 
i
 >0; i--, 
mask
 >>= 1) {

986 i‡(
øã_mask
 & 
mask
) {

987 
low
 = 
i
;

993 
i
 = 
ödex
 + 1;

994 
mask
 = (1 << 
i
); i < 
IWL_RATE_COUNT
; i++, mask <<= 1) {

995 i‡(
øã_mask
 & 
mask
) {

996 
high
 = 
i
;

1001  (
high
 << 8Ë| 
low
;

1004 
low
 = 
ödex
;

1005 
low
 !
IWL_RATE_INVALID
) {

1006 
low
 = 
iwl_øãs
[low].
¥ev_rs
;

1007 i‡(
low
 =
IWL_RATE_INVALID
)

1009 i‡(
øã_mask
 & (1 << 
low
))

1013 
high
 = 
ödex
;

1014 
high
 !
IWL_RATE_INVALID
) {

1015 
high
 = 
iwl_øãs
[high].
√xt_rs
;

1016 i‡(
high
 =
IWL_RATE_INVALID
)

1018 i‡(
øã_mask
 & (1 << 
high
))

1022  (
high
 << 8Ë| 
low
;

1023 
	}
}

1025 
ölöe
 
boﬁ
 
	$rs_øã_suµ‹ãd
(
iwl_lq_°a
 *
lq_°a
,

1026 
rs_øã
 *
øã
)

1028  
	`BIT
(
øã
->
ödex
Ë& 
	`rs_gë_suµ‹ãd_øãs
(
lq_°a
,Ñate);

1029 
	}
}

1034 
boﬁ
 
	$rs_gë_lowî_øã_ö_cﬁumn
(
iwl_lq_°a
 *
lq_°a
,

1035 
rs_øã
 *
øã
)

1037 
u8
 
low
;

1038 
u16
 
high_low
;

1039 
u16
 
øã_mask
;

1040 
iwl_mvm
 *
mvm
 = 
lq_°a
->
≥rs
.
drv
;

1042 
øã_mask
 = 
	`rs_gë_suµ‹ãd_øãs
(
lq_°a
, 
øã
);

1043 
high_low
 = 
	`rs_gë_adja˚¡_øã
(
mvm
, 
øã
->
ödex
, 
øã_mask
,

1044 
øã
->
ty≥
);

1045 
low
 = 
high_low
 & 0xff;

1048 i‡(
low
 =
IWL_RATE_INVALID
)

1049  
åue
;

1051 
øã
->
ödex
 = 
low
;

1052  
Ál£
;

1053 
	}
}

1056 
	$rs_gë_lowî_øã_down_cﬁumn
(
iwl_lq_°a
 *
lq_°a
,

1057 
rs_øã
 *
øã
)

1059 
iwl_mvm
 *
mvm
 = 
lq_°a
->
≥rs
.
drv
;

1061 i‡(
	`is_Àgacy
(
øã
)) {

1064 } i‡(
	`is_siso
(
øã
)) {

1066 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
)

1067 
øã
->
ty≥
 = 
LQ_LEGACY_A
;

1069 
øã
->
ty≥
 = 
LQ_LEGACY_G
;

1071 
øã
->
bw
 = 
RATE_MCS_CHAN_WIDTH_20
;

1073 i‡(
	`WARN_ON_ONCE
(
øã
->
ödex
 < 
IWL_RATE_MCS_0_INDEX
))

1074 
øã
->
ödex
 = 
rs_ht_to_Àgacy
[
IWL_RATE_MCS_0_INDEX
];

1075 i‡(
	`WARN_ON_ONCE
(
øã
->
ödex
 > 
IWL_RATE_MCS_9_INDEX
))

1076 
øã
->
ödex
 = 
rs_ht_to_Àgacy
[
IWL_RATE_MCS_9_INDEX
];

1078 
øã
->
ödex
 = 
rs_ht_to_Àgacy
[rate->index];

1080 
øã
->
ldpc
 = 
Ál£
;

1083 
øã
->
ty≥
 = 
	`is_vht_mimo2
(rate) ?

1084 
LQ_VHT_SISO
 : 
LQ_HT_SISO
;

1087 i‡(
	`num_of_™t
(
øã
->
™t
) > 1)

1088 
øã
->
™t
 = 
	`fú°_™ã¬a
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
));

1091 
øã
->
sgi
 = 
Ál£
;

1093 i‡(!
	`rs_øã_suµ‹ãd
(
lq_°a
, 
øã
))

1094 
	`rs_gë_lowî_øã_ö_cﬁumn
(
lq_°a
, 
øã
);

1095 
	}
}

1098 
ölöe
 
boﬁ
 
	$rs_øã_cﬁumn_m©ch
(
rs_øã
 *
a
,

1099 
rs_øã
 *
b
)

1101 
boﬁ
 
™t_m©ch
;

1103 i‡(
a
->
°bc
 ||á->
b„r
)

1104 
™t_m©ch
 = (
b
->
™t
 =
ANT_A
 || b->™à=
ANT_B
);

1106 
™t_m©ch
 = (
a
->
™t
 =
b
->ant);

1108  (
a
->
ty≥
 =
b
->ty≥Ë&& (a->
bw
 =b->bwË&& (a->
sgi
 == b->sgi)

1109 && 
™t_m©ch
;

1110 
	}
}

1112 
ölöe
 
rs_cﬁumn
 
	$rs_gë_cﬁumn_‰om_øã
(
rs_øã
 *
øã
)

1114 i‡(
	`is_Àgacy
(
øã
)) {

1115 i‡(
øã
->
™t
 =
ANT_A
)

1116  
RS_COLUMN_LEGACY_ANT_A
;

1118 i‡(
øã
->
™t
 =
ANT_B
)

1119  
RS_COLUMN_LEGACY_ANT_B
;

1121 
îr
;

1124 i‡(
	`is_siso
(
øã
)) {

1125 i‡(
øã
->
™t
 =
ANT_A
 ||Ñ©e->
°bc
 ||Ñ©e->
b„r
)

1126  
øã
->
sgi
 ? 
RS_COLUMN_SISO_ANT_A_SGI
 :

1127 
RS_COLUMN_SISO_ANT_A
;

1129 i‡(
øã
->
™t
 =
ANT_B
)

1130  
øã
->
sgi
 ? 
RS_COLUMN_SISO_ANT_B_SGI
 :

1131 
RS_COLUMN_SISO_ANT_B
;

1133 
îr
;

1136 i‡(
	`is_mimo
(
øã
))

1137  
øã
->
sgi
 ? 
RS_COLUMN_MIMO2_SGI
 : 
RS_COLUMN_MIMO2
;

1139 
îr
:

1140  
RS_COLUMN_INVALID
;

1141 
	}
}

1143 
u8
 
	$rs_gë_tid
(
õì80211_hdr
 *
hdr
)

1145 
u8
 
tid
 = 
IWL_MAX_TID_COUNT
;

1147 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
)) {

1148 
u8
 *
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

1149 
tid
 = 
qc
[0] & 0xf;

1152 i‡(
	`u∆ikñy
(
tid
 > 
IWL_MAX_TID_COUNT
))

1153 
tid
 = 
IWL_MAX_TID_COUNT
;

1155  
tid
;

1156 
	}
}

1161 
	$rs_drv_mac80211_tx_°©us
(*
mvm_r
,

1162 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

1163 
õì80211_°a
 *
°a
, *
¥iv_°a
,

1164 
sk_buff
 *
skb
)

1166 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

1167 
iwl_›_mode
 *
›_mode
 = 
mvm_r
;

1168 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

1169 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1170 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1172 i‡(!
mvm°a
->
vif
)

1175 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) ||

1176 
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
)

1179 
	`iwl_mvm_rs_tx_°©us
(
mvm
, 
°a
, 
	`rs_gë_tid
(
hdr
), 
öfo
,

1180 
	`õì80211_is_qos_nuŒfunc
(
hdr
->
‰ame_c⁄åﬁ
));

1181 
	}
}

1191 
	$rs_£t_°ay_ö_èbÀ
(
iwl_mvm
 *
mvm
, 
u8
 
is_Àgacy
,

1192 
iwl_lq_°a
 *
lq_°a
)

1194 
	`IWL_DEBUG_RATE
(
mvm
, "MovingÅo RS_STATE_STAY_IN_COLUMN\n");

1195 
lq_°a
->
rs_°©e
 = 
RS_STATE_STAY_IN_COLUMN
;

1196 i‡(
is_Àgacy
) {

1197 
lq_°a
->
èbÀ_cou¡_limô
 = 
IWL_MVM_RS_LEGACY_TABLE_COUNT
;

1198 
lq_°a
->
max_Áûuª_limô
 = 
IWL_MVM_RS_LEGACY_FAILURE_LIMIT
;

1199 
lq_°a
->
max_suc˚ss_limô
 = 
IWL_MVM_RS_LEGACY_SUCCESS_LIMIT
;

1201 
lq_°a
->
èbÀ_cou¡_limô
 = 
IWL_MVM_RS_NON_LEGACY_TABLE_COUNT
;

1202 
lq_°a
->
max_Áûuª_limô
 = 
IWL_MVM_RS_NON_LEGACY_FAILURE_LIMIT
;

1203 
lq_°a
->
max_suc˚ss_limô
 = 
IWL_MVM_RS_NON_LEGACY_SUCCESS_LIMIT
;

1205 
lq_°a
->
èbÀ_cou¡
 = 0;

1206 
lq_°a
->
tŸÆ_Áûed
 = 0;

1207 
lq_°a
->
tŸÆ_suc˚ss
 = 0;

1208 
lq_°a
->
Êush_timî
 = 
jiffõs
;

1209 
lq_°a
->
visôed_cﬁumns
 = 0;

1210 
	}
}

1212 
ölöe
 
	$rs_gë_max_øã_‰om_mask
(
øã_mask
)

1214 i‡(
øã_mask
)

1215  
	`föd_œ°_bô
(&
øã_mask
, 
BITS_PER_LONG
);

1216  
IWL_RATE_INVALID
;

1217 
	}
}

1219 
	$rs_gë_max_Ælowed_øã
(
iwl_lq_°a
 *
lq_°a
,

1220 c⁄° 
rs_tx_cﬁumn
 *
cﬁumn
)

1222 
cﬁumn
->
mode
) {

1223 
RS_LEGACY
:

1224  
lq_°a
->
max_Àgacy_øã_idx
;

1225 
RS_SISO
:

1226  
lq_°a
->
max_siso_øã_idx
;

1227 
RS_MIMO2
:

1228  
lq_°a
->
max_mimo2_øã_idx
;

1230 
	`WARN_ON_ONCE
(1);

1233  
lq_°a
->
max_Àgacy_øã_idx
;

1234 
	}
}

1236 c⁄° 
u16
 *
	$rs_gë_ex≥˘ed_çt_èbÀ
(
iwl_lq_°a
 *
lq_°a
,

1237 c⁄° 
rs_tx_cﬁumn
 *
cﬁumn
,

1238 
u32
 
bw
)

1241 c⁄° 
	`u16
 (*
ht_tbl_poöãr
)[
IWL_RATE_COUNT
];

1243 i‡(
	`WARN_ON_ONCE
(
cﬁumn
->
mode
 !
RS_LEGACY
 &&

1244 
cﬁumn
->
mode
 !
RS_SISO
 &&

1245 
cﬁumn
->
mode
 !
RS_MIMO2
))

1246  
ex≥˘ed_çt_Àgacy
;

1249 i‡(
cﬁumn
->
mode
 =
RS_LEGACY
)

1250  
ex≥˘ed_çt_Àgacy
;

1252 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_20MHz
;

1256 i‡(
cﬁumn
->
mode
 =
RS_SISO
) {

1257 
bw
) {

1258 
RATE_MCS_CHAN_WIDTH_20
:

1259 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_siso_20MHz
;

1261 
RATE_MCS_CHAN_WIDTH_40
:

1262 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_siso_40MHz
;

1264 
RATE_MCS_CHAN_WIDTH_80
:

1265 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_siso_80MHz
;

1267 
RATE_MCS_CHAN_WIDTH_160
:

1268 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_siso_160MHz
;

1271 
	`WARN_ON_ONCE
(1);

1273 } i‡(
cﬁumn
->
mode
 =
RS_MIMO2
) {

1274 
bw
) {

1275 
RATE_MCS_CHAN_WIDTH_20
:

1276 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_20MHz
;

1278 
RATE_MCS_CHAN_WIDTH_40
:

1279 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_40MHz
;

1281 
RATE_MCS_CHAN_WIDTH_80
:

1282 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_80MHz
;

1284 
RATE_MCS_CHAN_WIDTH_160
:

1285 
ht_tbl_poöãr
 = 
ex≥˘ed_çt_mimo2_160MHz
;

1288 
	`WARN_ON_ONCE
(1);

1291 
	`WARN_ON_ONCE
(1);

1294 i‡(!
cﬁumn
->
sgi
 && !
lq_°a
->
is_agg
)

1295  
ht_tbl_poöãr
[0];

1296 i‡(
cﬁumn
->
sgi
 && !
lq_°a
->
is_agg
)

1297  
ht_tbl_poöãr
[1];

1298 i‡(!
cﬁumn
->
sgi
 && 
lq_°a
->
is_agg
)

1299  
ht_tbl_poöãr
[2];

1301  
ht_tbl_poöãr
[3];

1302 
	}
}

1304 
	$rs_£t_ex≥˘ed_çt_èbÀ
(
iwl_lq_°a
 *
lq_°a
,

1305 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

1307 
rs_øã
 *
øã
 = &
tbl
->rate;

1308 c⁄° 
rs_tx_cﬁumn
 *
cﬁumn
 = &
rs_tx_cﬁumns
[
tbl
->column];

1310 
tbl
->
ex≥˘ed_çt
 = 
	`rs_gë_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
cﬁumn
, 
øã
->
bw
);

1311 
	}
}

1320 
ölöe
 
u8
 
	$rs_£¨ch_tbl
(
u8
 
a˘ive_tbl
)

1322  (
a˘ive_tbl
 ^ 1) & 1;

1323 
	}
}

1325 
s32
 
	$rs_gë_be°_øã
(
iwl_mvm
 *
mvm
,

1326 
iwl_lq_°a
 *
lq_°a
,

1327 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

1328 
øã_mask
, 
s8
 
ödex
)

1330 
iwl_sˇÀ_tbl_öfo
 *
a˘ive_tbl
 =

1331 &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

1332 
s32
 
suc˚ss_øtio
 = 
a˘ive_tbl
->
wö
[
ödex
].success_ratio;

1333 
u16
 
ex≥˘ed_cuºít_çt
 = 
a˘ive_tbl
->
ex≥˘ed_çt
[
ödex
];

1334 c⁄° 
u16
 *
çt_tbl
 = 
tbl
->
ex≥˘ed_çt
;

1335 
u16
 
high_low
;

1336 
u32
 
èrgë_çt
;

1337 
øã_idx
;

1339 i‡(
suc˚ss_øtio
 >
	`RS_PERCENT
(
IWL_MVM_RS_SR_NO_DECREASE
)) {

1340 
èrgë_çt
 = 100 * 
ex≥˘ed_cuºít_çt
;

1341 
	`IWL_DEBUG_RATE
(
mvm
,

1343 
suc˚ss_øtio
, 
èrgë_çt
);

1345 
èrgë_çt
 = 
lq_°a
->
œ°_çt
;

1346 
	`IWL_DEBUG_RATE
(
mvm
,

1348 
suc˚ss_øtio
, 
èrgë_çt
);

1351 
øã_idx
 = 
	`föd_fú°_bô
(&
øã_mask
, 
BITS_PER_LONG
);

1353 
øã_idx
 !
IWL_RATE_INVALID
) {

1354 i‡(
èrgë_çt
 < (100 * 
çt_tbl
[
øã_idx
]))

1357 
high_low
 = 
	`rs_gë_adja˚¡_øã
(
mvm
, 
øã_idx
, 
øã_mask
,

1358 
tbl
->
øã
.
ty≥
);

1360 
øã_idx
 = (
high_low
 >> 8) & 0xff;

1363 
	`IWL_DEBUG_RATE
(
mvm
, "BestÑate found %dÅarget_tp %dÉxpected_new %d\n",

1364 
øã_idx
, 
èrgë_çt
,

1365 
øã_idx
 !
IWL_RATE_INVALID
 ?

1366 100 * 
çt_tbl
[
øã_idx
] : 
IWL_INVALID_VALUE
);

1368  
øã_idx
;

1369 
	}
}

1371 
u32
 
	$rs_bw_‰om_°a_bw
(
õì80211_°a
 *
°a
)

1373 
õì80211_°a_vht_ˇp
 *
°a_vht_ˇp
 = &
°a
->
deÊök
.
vht_ˇp
;

1374 
õì80211_vht_ˇp
 
vht_ˇp
 = {

1375 .
vht_ˇp_öfo
 = 
	`˝u_to_À32
(
°a_vht_ˇp
->
ˇp
),

1376 .
suµ_mcs
 = 
°a_vht_ˇp
->
vht_mcs
,

1379 
°a
->
deÊök
.
b™dwidth
) {

1380 
IEEE80211_STA_RX_BW_160
:

1389 i‡(
	`õì80211_gë_vht_max_nss
(&
vht_ˇp
,

1390 
IEEE80211_VHT_CHANWIDTH_160MHZ
,

1391 0, 
åue
,

1392 
°a
->
deÊök
.
rx_nss
) < sta->deflink.rx_nss)

1393  
RATE_MCS_CHAN_WIDTH_80
;

1394  
RATE_MCS_CHAN_WIDTH_160
;

1395 
IEEE80211_STA_RX_BW_80
:

1396  
RATE_MCS_CHAN_WIDTH_80
;

1397 
IEEE80211_STA_RX_BW_40
:

1398  
RATE_MCS_CHAN_WIDTH_40
;

1399 
IEEE80211_STA_RX_BW_20
:

1401  
RATE_MCS_CHAN_WIDTH_20
;

1403 
	}
}

1412 
	$rs_°ay_ö_èbÀ
(
iwl_lq_°a
 *
lq_°a
, 
boﬁ
 
f‹˚_£¨ch
)

1414 
iwl_sˇÀ_tbl_öfo
 *
tbl
;

1415 
a˘ive_tbl
;

1416 
Êush_öãrvÆ_∑s£d
 = 0;

1417 
iwl_mvm
 *
mvm
;

1419 
mvm
 = 
lq_°a
->
≥rs
.
drv
;

1420 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

1422 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

1425 i‡(
lq_°a
->
rs_°©e
 =
RS_STATE_STAY_IN_COLUMN
) {

1427 i‡(
lq_°a
->
Êush_timî
)

1428 
Êush_öãrvÆ_∑s£d
 =

1429 
	`time_a·î
(
jiffõs
,

1430 ()(
lq_°a
->
Êush_timî
 +

1431 (
IWL_MVM_RS_STAY_IN_COLUMN_TIMEOUT
 * 
HZ
)));

1441 i‡(
f‹˚_£¨ch
 ||

1442 (
lq_°a
->
tŸÆ_Áûed
 >Üq_°a->
max_Áûuª_limô
) ||

1443 (
lq_°a
->
tŸÆ_suc˚ss
 >Üq_°a->
max_suc˚ss_limô
) ||

1444 ((!
lq_°a
->
£¨ch_bëãr_tbl
) &&

1445 (
lq_°a
->
Êush_timî
Ë&& (
Êush_öãrvÆ_∑s£d
))) {

1446 
	`IWL_DEBUG_RATE
(
mvm
,

1448 
lq_°a
->
tŸÆ_Áûed
,

1449 
lq_°a
->
tŸÆ_suc˚ss
,

1450 
Êush_öãrvÆ_∑s£d
);

1453 
lq_°a
->
rs_°©e
 = 
RS_STATE_SEARCH_CYCLE_STARTED
;

1454 
	`IWL_DEBUG_RATE
(
mvm
,

1456 
lq_°a
->
tŸÆ_Áûed
 = 0;

1457 
lq_°a
->
tŸÆ_suc˚ss
 = 0;

1458 
lq_°a
->
Êush_timî
 = 0;

1460 
lq_°a
->
visôed_cﬁumns
 = 
	`BIT
(
tbl
->
cﬁumn
);

1468 
lq_°a
->
èbÀ_cou¡
++;

1469 i‡(
lq_°a
->
èbÀ_cou¡
 >=

1470 
lq_°a
->
èbÀ_cou¡_limô
) {

1471 
lq_°a
->
èbÀ_cou¡
 = 0;

1473 
	`IWL_DEBUG_RATE
(
mvm
,

1475 
	`rs_øã_sˇÀ_˛ór_tbl_wödows
(
mvm
, 
tbl
);

1482 i‡(
lq_°a
->
rs_°©e
 =
RS_STATE_SEARCH_CYCLE_STARTED
) {

1483 
	`rs_øã_sˇÀ_˛ór_tbl_wödows
(
mvm
, 
tbl
);

1486 
	}
}

1488 
	$rs_£t_amsdu_Àn
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

1489 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

1490 
rs_a˘i⁄
 
sˇÀ_a˘i⁄
)

1492 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1493 
õì80211_bss_c⁄f
 *
bss_c⁄f
 = &
mvm°a
->
vif
->bss_conf;

1494 
i
;

1496 
°a
->
deÊök
.
agg
.
max_amsdu_Àn
 =

1497 
	`rs_fw_gë_max_amsdu_Àn
(
°a
, 
bss_c⁄f
, &°a->
deÊök
);

1503 i‡((!
	`is_vht
(&
tbl
->
øã
Ë&& !
	`is_ht
(&tbl->rate)) ||

1504 
tbl
->
øã
.
ödex
 < 
IWL_RATE_MCS_5_INDEX
 ||

1505 
sˇÀ_a˘i⁄
 =
RS_ACTION_DOWNSCALE
)

1506 
mvm°a
->
amsdu_íabÀd
 = 0;

1508 
mvm°a
->
amsdu_íabÀd
 = 0xFFFF;

1510 i‡(
bss_c⁄f
->
he_suµ‹t
 &&

1511 !
iwlwifi_mod_∑øms
.
dißbÀ_11ax
)

1512 
mvm°a
->
max_amsdu_Àn
 = 
°a
->
deÊök
.
agg
.max_amsdu_len;

1514 
mvm°a
->
max_amsdu_Àn
 =

1515 
	`mö_t
(, 
°a
->
deÊök
.
agg
.
max_amsdu_Àn
, 8500);

1517 
°a
->
deÊök
.
agg
.
max_rc_amsdu_Àn
 = 
mvm°a
->
max_amsdu_Àn
;

1519 
i
 = 0; i < 
IWL_MAX_TID_COUNT
; i++) {

1520 i‡(
mvm°a
->
amsdu_íabÀd
)

1521 
°a
->
deÊök
.
agg
.
max_tid_amsdu_Àn
[
i
] =

1522 
	`iwl_mvm_max_amsdu_size
(
mvm
, 
°a
, 
i
);

1528 
°a
->
deÊök
.
agg
.
max_tid_amsdu_Àn
[
i
] = 1;

1530 
	}
}

1535 
	$rs_upd©e_øã_tbl
(
iwl_mvm
 *
mvm
,

1536 
õì80211_°a
 *
°a
,

1537 
iwl_lq_°a
 *
lq_°a
,

1538 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

1540 
	`rs_fûl_lq_cmd
(
mvm
, 
°a
, 
lq_°a
, &
tbl
->
øã
);

1541 
	`iwl_mvm_£nd_lq_cmd
(
mvm
, &
lq_°a
->
lq
);

1542 
	}
}

1544 
boﬁ
 
	$rs_twók_øã_tbl
(
iwl_mvm
 *
mvm
,

1545 
õì80211_°a
 *
°a
,

1546 
iwl_lq_°a
 *
lq_°a
,

1547 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

1548 
rs_a˘i⁄
 
sˇÀ_a˘i⁄
)

1550 i‡(
	`rs_bw_‰om_°a_bw
(
°a
Ë!
RATE_MCS_CHAN_WIDTH_80
)

1551  
Ál£
;

1553 i‡(!
	`is_vht_siso
(&
tbl
->
øã
))

1554  
Ál£
;

1556 i‡((
tbl
->
øã
.
bw
 =
RATE_MCS_CHAN_WIDTH_80
) &&

1557 (
tbl
->
øã
.
ödex
 =
IWL_RATE_MCS_0_INDEX
) &&

1558 (
sˇÀ_a˘i⁄
 =
RS_ACTION_DOWNSCALE
)) {

1559 
tbl
->
øã
.
bw
 = 
RATE_MCS_CHAN_WIDTH_20
;

1560 
tbl
->
øã
.
ödex
 = 
IWL_RATE_MCS_4_INDEX
;

1561 
	`IWL_DEBUG_RATE
(
mvm
, "Switch 80Mhz SISO MCS0 -> 20Mhz MCS4\n");

1562 
twóked
;

1570 i‡((
tbl
->
øã
.
bw
 =
RATE_MCS_CHAN_WIDTH_20
) &&

1571 (((
tbl
->
øã
.
ödex
 =
IWL_RATE_MCS_5_INDEX
) &&

1572 (
sˇÀ_a˘i⁄
 =
RS_ACTION_STAY
)) ||

1573 ((
tbl
->
øã
.
ödex
 > 
IWL_RATE_MCS_5_INDEX
) &&

1574 (
sˇÀ_a˘i⁄
 =
RS_ACTION_UPSCALE
)))) {

1575 
tbl
->
øã
.
bw
 = 
RATE_MCS_CHAN_WIDTH_80
;

1576 
tbl
->
øã
.
ödex
 = 
IWL_RATE_MCS_1_INDEX
;

1577 
	`IWL_DEBUG_RATE
(
mvm
, "Switch 20Mhz SISO MCS5 -> 80Mhz MCS1\n");

1578 
twóked
;

1581  
Ál£
;

1583 
twóked
:

1584 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

1585 
	`rs_øã_sˇÀ_˛ór_tbl_wödows
(
mvm
, 
tbl
);

1586  
åue
;

1587 
	}
}

1589 
rs_cﬁumn
 
	$rs_gë_√xt_cﬁumn
(
iwl_mvm
 *
mvm
,

1590 
iwl_lq_°a
 *
lq_°a
,

1591 
õì80211_°a
 *
°a
,

1592 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

1594 
i
, 
j
, 
max_øã
;

1595 
rs_cﬁumn
 
√xt_cﬁ_id
;

1596 c⁄° 
rs_tx_cﬁumn
 *
cuº_cﬁ
 = &
rs_tx_cﬁumns
[
tbl
->
cﬁumn
];

1597 c⁄° 
rs_tx_cﬁumn
 *
√xt_cﬁ
;

1598 
Ælow_cﬁumn_func_t
 
Ælow_func
;

1599 
u8
 
vÆid_™ts
 = 
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
);

1600 c⁄° 
u16
 *
ex≥˘ed_çt_tbl
;

1601 
u16
 
çt
, 
max_ex≥˘ed_çt
;

1603 
i
 = 0; i < 
MAX_NEXT_COLUMNS
; i++) {

1604 
√xt_cﬁ_id
 = 
cuº_cﬁ
->
√xt_cﬁumns
[
i
];

1606 i‡(
√xt_cﬁ_id
 =
RS_COLUMN_INVALID
)

1609 i‡(
lq_°a
->
visôed_cﬁumns
 & 
	`BIT
(
√xt_cﬁ_id
)) {

1610 
	`IWL_DEBUG_RATE
(
mvm
, "Skipálready visited column %d\n",

1611 
√xt_cﬁ_id
);

1615 
√xt_cﬁ
 = &
rs_tx_cﬁumns
[
√xt_cﬁ_id
];

1617 i‡(!
	`rs_is_vÆid_™t
(
vÆid_™ts
, 
√xt_cﬁ
->
™t
)) {

1618 
	`IWL_DEBUG_RATE
(
mvm
,

1620 
√xt_cﬁ_id
, 
vÆid_™ts
, 
√xt_cﬁ
->
™t
);

1624 
j
 = 0; j < 
MAX_COLUMN_CHECKS
; j++) {

1625 
Ælow_func
 = 
√xt_cﬁ
->
checks
[
j
];

1626 i‡(
Ælow_func
 && !
	`Ælow_func
(
mvm
, 
°a
, &
tbl
->
øã
,

1627 
√xt_cﬁ
))

1631 i‡(
j
 !
MAX_COLUMN_CHECKS
) {

1632 
	`IWL_DEBUG_RATE
(
mvm
,

1634 
√xt_cﬁ_id
, 
j
);

1639 
çt
 = 
lq_°a
->
œ°_çt
 / 100;

1640 
ex≥˘ed_çt_tbl
 = 
	`rs_gë_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
√xt_cﬁ
,

1641 
	`rs_bw_‰om_°a_bw
(
°a
));

1642 i‡(
	`WARN_ON_ONCE
(!
ex≥˘ed_çt_tbl
))

1645 
max_øã
 = 
	`rs_gë_max_Ælowed_øã
(
lq_°a
, 
√xt_cﬁ
);

1646 i‡(
max_øã
 =
IWL_RATE_INVALID
) {

1647 
	`IWL_DEBUG_RATE
(
mvm
,

1649 
√xt_cﬁ_id
);

1653 
max_ex≥˘ed_çt
 = 
ex≥˘ed_çt_tbl
[
max_øã
];

1654 i‡(
çt
 >
max_ex≥˘ed_çt
) {

1655 
	`IWL_DEBUG_RATE
(
mvm
,

1657 
√xt_cﬁ_id
, 
max_ex≥˘ed_çt
, 
çt
);

1661 
	`IWL_DEBUG_RATE
(
mvm
,

1663 
√xt_cﬁ_id
, 
max_ex≥˘ed_çt
, 
çt
);

1667 i‡(
i
 =
MAX_NEXT_COLUMNS
)

1668  
RS_COLUMN_INVALID
;

1670  
√xt_cﬁ_id
;

1671 
	}
}

1673 
	$rs_swôch_to_cﬁumn
(
iwl_mvm
 *
mvm
,

1674 
iwl_lq_°a
 *
lq_°a
,

1675 
õì80211_°a
 *
°a
,

1676 
rs_cﬁumn
 
cﬁ_id
)

1678 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
];

1679 
iwl_sˇÀ_tbl_öfo
 *
£¨ch_tbl
 =

1680 &
lq_°a
->
lq_öfo
[
	`rs_£¨ch_tbl
÷q_°a->
a˘ive_tbl
)];

1681 
rs_øã
 *
øã
 = &
£¨ch_tbl
->rate;

1682 c⁄° 
rs_tx_cﬁumn
 *
cﬁumn
 = &
rs_tx_cﬁumns
[
cﬁ_id
];

1683 c⁄° 
rs_tx_cﬁumn
 *
cuº_cﬁumn
 = &
rs_tx_cﬁumns
[
tbl
->
cﬁumn
];

1684 
øã_mask
 = 0;

1685 
u32
 
øã_idx
 = 0;

1687 
	`mem˝y
(
£¨ch_tbl
, 
tbl
, 
	`off£tof
(
iwl_sˇÀ_tbl_öfo
, 
wö
));

1689 
øã
->
sgi
 = 
cﬁumn
->sgi;

1690 
øã
->
™t
 = 
cﬁumn
->ant;

1692 i‡(
cﬁumn
->
mode
 =
RS_LEGACY
) {

1693 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
)

1694 
øã
->
ty≥
 = 
LQ_LEGACY_A
;

1696 
øã
->
ty≥
 = 
LQ_LEGACY_G
;

1698 
øã
->
bw
 = 
RATE_MCS_CHAN_WIDTH_20
;

1699 
øã
->
ldpc
 = 
Ál£
;

1700 
øã_mask
 = 
lq_°a
->
a˘ive_Àgacy_øã
;

1701 } i‡(
cﬁumn
->
mode
 =
RS_SISO
) {

1702 
øã
->
ty≥
 = 
lq_°a
->
is_vht
 ? 
LQ_VHT_SISO
 : 
LQ_HT_SISO
;

1703 
øã_mask
 = 
lq_°a
->
a˘ive_siso_øã
;

1704 } i‡(
cﬁumn
->
mode
 =
RS_MIMO2
) {

1705 
øã
->
ty≥
 = 
lq_°a
->
is_vht
 ? 
LQ_VHT_MIMO2
 : 
LQ_HT_MIMO2
;

1706 
øã_mask
 = 
lq_°a
->
a˘ive_mimo2_øã
;

1708 
	`WARN_ONCE
(1, "Bad column mode");

1711 i‡(
cﬁumn
->
mode
 !
RS_LEGACY
) {

1712 
øã
->
bw
 = 
	`rs_bw_‰om_°a_bw
(
°a
);

1713 
øã
->
ldpc
 = 
lq_°a
->ldpc;

1716 
£¨ch_tbl
->
cﬁumn
 = 
cﬁ_id
;

1717 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
£¨ch_tbl
);

1719 
lq_°a
->
visôed_cﬁumns
 |
	`BIT
(
cﬁ_id
);

1724 i‡(
cuº_cﬁumn
->
mode
 !
cﬁumn
->mode) {

1725 
øã_idx
 = 
	`rs_gë_be°_øã
(
mvm
, 
lq_°a
, 
£¨ch_tbl
,

1726 
øã_mask
, 
øã
->
ödex
);

1728 i‡((
øã_idx
 =
IWL_RATE_INVALID
) ||

1729 !(
	`BIT
(
øã_idx
Ë& 
øã_mask
)) {

1730 
	`IWL_DEBUG_RATE
(
mvm
,

1733 
øã_idx
, 
øã_mask
);

1735 
îr
;

1738 
øã
->
ödex
 = 
øã_idx
;

1741 
	`IWL_DEBUG_RATE
(
mvm
, "SwitchedÅo column %d: Index %d\n",

1742 
cﬁ_id
, 
øã
->
ödex
);

1746 
îr
:

1747 
øã
->
ty≥
 = 
LQ_NONE
;

1749 
	}
}

1751 
rs_a˘i⁄
 
	$rs_gë_øã_a˘i⁄
(
iwl_mvm
 *
mvm
,

1752 
iwl_sˇÀ_tbl_öfo
 *
tbl
,

1753 
s32
 
§
, 
low
, 
high
,

1754 
cuºít_çt
,

1755 
low_çt
, 
high_çt
)

1757 
rs_a˘i⁄
 
a˘i⁄
 = 
RS_ACTION_STAY
;

1759 i‡((
§
 <
	`RS_PERCENT
(
IWL_MVM_RS_SR_FORCE_DECREASE
)) ||

1760 (
cuºít_çt
 == 0)) {

1761 
	`IWL_DEBUG_RATE
(
mvm
,

1763  
RS_ACTION_DOWNSCALE
;

1766 i‡((
low_çt
 =
IWL_INVALID_VALUE
) &&

1767 (
high_çt
 =
IWL_INVALID_VALUE
) &&

1768 (
high
 !
IWL_RATE_INVALID
)) {

1769 
	`IWL_DEBUG_RATE
(
mvm
,

1771  
RS_ACTION_UPSCALE
;

1774 i‡((
high_çt
 =
IWL_INVALID_VALUE
) &&

1775 (
high
 !
IWL_RATE_INVALID
) &&

1776 (
low_çt
 !
IWL_INVALID_VALUE
) &&

1777 (
low_çt
 < 
cuºít_çt
)) {

1778 
	`IWL_DEBUG_RATE
(
mvm
,

1780  
RS_ACTION_UPSCALE
;

1783 i‡((
high_çt
 !
IWL_INVALID_VALUE
) &&

1784 (
high_çt
 > 
cuºít_çt
)) {

1785 
	`IWL_DEBUG_RATE
(
mvm
,

1787  
RS_ACTION_UPSCALE
;

1790 i‡((
low_çt
 !
IWL_INVALID_VALUE
) &&

1791 (
high_çt
 !
IWL_INVALID_VALUE
) &&

1792 (
low_çt
 < 
cuºít_çt
) &&

1793 (
high_çt
 < 
cuºít_çt
)) {

1794 
	`IWL_DEBUG_RATE
(
mvm
,

1796  
RS_ACTION_STAY
;

1799 i‡((
low_çt
 !
IWL_INVALID_VALUE
) &&

1800 (
low_çt
 > 
cuºít_çt
)) {

1801 
	`IWL_DEBUG_RATE
(
mvm
,

1803 
a˘i⁄
 = 
RS_ACTION_DOWNSCALE
;

1804 
out
;

1807 i‡((
low_çt
 =
IWL_INVALID_VALUE
) &&

1808 (
low
 !
IWL_RATE_INVALID
)) {

1809 
	`IWL_DEBUG_RATE
(
mvm
,

1811 
a˘i⁄
 = 
RS_ACTION_DOWNSCALE
;

1812 
out
;

1815 
	`IWL_DEBUG_RATE
(
mvm
, "MaintainÑate\n");

1817 
out
:

1818 i‡((
a˘i⁄
 =
RS_ACTION_DOWNSCALE
Ë&& (
low
 !
IWL_RATE_INVALID
)) {

1819 i‡(
§
 >
	`RS_PERCENT
(
IWL_MVM_RS_SR_NO_DECREASE
)) {

1820 
	`IWL_DEBUG_RATE
(
mvm
,

1822 
a˘i⁄
 = 
RS_ACTION_STAY
;

1823 } i‡(
cuºít_çt
 > (100 * 
tbl
->
ex≥˘ed_çt
[
low
])) {

1824 
	`IWL_DEBUG_RATE
(
mvm
,

1826 
a˘i⁄
 = 
RS_ACTION_STAY
;

1828 
	`IWL_DEBUG_RATE
(
mvm
, "DecreaseÑate\n");

1832  
a˘i⁄
;

1833 
	}
}

1835 
boﬁ
 
	$rs_°bc_Ælow
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

1836 
iwl_lq_°a
 *
lq_°a
)

1841 i‡(!
lq_°a
->
°bc_ˇ∑bÀ
)

1842  
Ál£
;

1844 i‡(!
	`iwl_mvm_bt_c€x_is_mimo_Ælowed
(
mvm
, 
°a
))

1845  
Ál£
;

1847  
åue
;

1848 
	}
}

1850 
	$rs_gë_adja˚¡_txp
(
iwl_mvm
 *
mvm
, 
ödex
,

1851 *
wókî
, *
°r⁄gî
)

1853 *
wókî
 = 
ödex
 + 
IWL_MVM_RS_TPC_TX_POWER_STEP
;

1854 i‡(*
wókî
 > 
TPC_MAX_REDUCTION
)

1855 *
wókî
 = 
TPC_INVALID
;

1857 *
°r⁄gî
 = 
ödex
 - 
IWL_MVM_RS_TPC_TX_POWER_STEP
;

1858 i‡(*
°r⁄gî
 < 0)

1859 *
°r⁄gî
 = 
TPC_INVALID
;

1860 
	}
}

1862 
boﬁ
 
	$rs_çc_Ælowed
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1863 
rs_øã
 *
øã
, 
∆80211_b™d
 
b™d
)

1865 
ödex
 = 
øã
->index;

1866 
boﬁ
 
ˇm
 = (
iwlmvm_mod_∑øms
.
powî_scheme
 =
IWL_POWER_SCHEME_CAM
);

1867 
boﬁ
 
°a_ps_dißbÀd
 = (
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

1868 !
vif
->
cfg
.
ps
);

1870 
	`IWL_DEBUG_RATE
(
mvm
, "cam: %d sta_ps_disabled %d\n",

1871 
ˇm
, 
°a_ps_dißbÀd
);

1876 i‡((
ˇm
 || 
°a_ps_dißbÀd
) &&

1877 !
	`iwl_mvm_bt_c€x_is_çc_Ælowed
(
mvm
, 
b™d
))

1878  
Ál£
;

1880 
	`IWL_DEBUG_RATE
(
mvm
, "checkÑ©e,ÅabÀÅy≥: %d\n", 
øã
->
ty≥
);

1881 i‡(
	`is_Àgacy
(
øã
))

1882  
ödex
 =
IWL_RATE_54M_INDEX
;

1883 i‡(
	`is_ht
(
øã
))

1884  
ödex
 =
IWL_RATE_MCS_7_INDEX
;

1885 i‡(
	`is_vht
(
øã
))

1886  
ödex
 =
IWL_RATE_MCS_9_INDEX
;

1888 
	`WARN_ON_ONCE
(1);

1889  
Ál£
;

1890 
	}
}

1892 
	eçc_a˘i⁄
 {

1893 
	mTPC_ACTION_STAY
,

1894 
	mTPC_ACTION_DECREASE
,

1895 
	mTPC_ACTION_INCREASE
,

1896 
	mTPC_ACTION_NO_RESTIRCTION
,

1899 
çc_a˘i⁄
 
	$rs_gë_çc_a˘i⁄
(
iwl_mvm
 *
mvm
,

1900 
s32
 
§
, 
wók
, 
°r⁄g
,

1901 
cuºít_çt
,

1902 
wók_çt
, 
°r⁄g_çt
)

1905 i‡(
cuºít_çt
 =
IWL_INVALID_VALUE
) {

1906 
	`IWL_DEBUG_RATE
(
mvm
, "no currentÅpt. stay.\n");

1907  
TPC_ACTION_STAY
;

1911 i‡(
§
 <
	`RS_PERCENT
(
IWL_MVM_RS_TPC_SR_FORCE_INCREASE
) ||

1912 
cuºít_çt
 == 0) {

1913 
	`IWL_DEBUG_RATE
(
mvm
, "increaseÅxp because of weak SR\n");

1914  
TPC_ACTION_NO_RESTIRCTION
;

1918 i‡(
§
 >
	`RS_PERCENT
(
IWL_MVM_RS_TPC_SR_NO_INCREASE
) &&

1919 
wók
 !
TPC_INVALID
) {

1920 i‡(
wók_çt
 =
IWL_INVALID_VALUE
 &&

1921 (
°r⁄g_çt
 =
IWL_INVALID_VALUE
 ||

1922 
cuºít_çt
 >
°r⁄g_çt
)) {

1923 
	`IWL_DEBUG_RATE
(
mvm
,

1925  
TPC_ACTION_DECREASE
;

1928 i‡(
wók_çt
 > 
cuºít_çt
) {

1929 
	`IWL_DEBUG_RATE
(
mvm
,

1931  
TPC_ACTION_DECREASE
;

1936 i‡(
§
 < 
	`RS_PERCENT
(
IWL_MVM_RS_TPC_SR_NO_INCREASE
) &&

1937 
°r⁄g
 !
TPC_INVALID
) {

1938 i‡(
wók_çt
 =
IWL_INVALID_VALUE
 &&

1939 
°r⁄g_çt
 !
IWL_INVALID_VALUE
 &&

1940 
cuºít_çt
 < 
°r⁄g_çt
) {

1941 
	`IWL_DEBUG_RATE
(
mvm
,

1943  
TPC_ACTION_INCREASE
;

1946 i‡(
wók_çt
 < 
cuºít_çt
 &&

1947 (
°r⁄g_çt
 =
IWL_INVALID_VALUE
 ||

1948 
°r⁄g_çt
 > 
cuºít_çt
)) {

1949 
	`IWL_DEBUG_RATE
(
mvm
,

1951  
TPC_ACTION_INCREASE
;

1955 
	`IWL_DEBUG_RATE
(
mvm
, "noÇeedÅo increase or decreaseÅxp - stay\n");

1956  
TPC_ACTION_STAY
;

1957 
	}
}

1959 
boﬁ
 
	$rs_çc_≥rf‹m
(
iwl_mvm
 *
mvm
,

1960 
õì80211_°a
 *
°a
,

1961 
iwl_lq_°a
 *
lq_°a
,

1962 
iwl_sˇÀ_tbl_öfo
 *
tbl
)

1964 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1965 
õì80211_vif
 *
vif
 = 
mvm_°a
->vif;

1966 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
;

1967 
∆80211_b™d
 
b™d
;

1968 
iwl_øã_sˇÀ_d©a
 *
wödow
;

1969 
rs_øã
 *
øã
 = &
tbl
->rate;

1970 
çc_a˘i⁄
 
a˘i⁄
;

1971 
s32
 
§
;

1972 
u8
 
cur
 = 
lq_°a
->
lq
.
ªdu˚d_çc
;

1973 
cuºít_çt
;

1974 
wók
, 
°r⁄g
;

1975 
wók_çt
 = 
IWL_INVALID_VALUE
, 
°r⁄g_çt
 = IWL_INVALID_VALUE;

1977 #ifde‡
CONFIG_MAC80211_DEBUGFS


1978 i‡(
lq_°a
->
≥rs
.
dbg_fixed_txp_ªdu˘i⁄
 <
TPC_MAX_REDUCTION
) {

1979 
	`IWL_DEBUG_RATE
(
mvm
, "fixedÅpc: %d\n",

1980 
lq_°a
->
≥rs
.
dbg_fixed_txp_ªdu˘i⁄
);

1981 
lq_°a
->
lq
.
ªdu˚d_çc
 =Üq_°a->
≥rs
.
dbg_fixed_txp_ªdu˘i⁄
;

1982  
cur
 !
lq_°a
->
≥rs
.
dbg_fixed_txp_ªdu˘i⁄
;

1986 
	`rcu_ªad_lock
();

1987 
ch™˘x_c⁄f
 = 
	`rcu_dîe„ªn˚
(
vif
->
bss_c⁄f
.chanctx_conf);

1988 i‡(
	`WARN_ON
(!
ch™˘x_c⁄f
))

1989 
b™d
 = 
NUM_NL80211_BANDS
;

1991 
b™d
 = 
ch™˘x_c⁄f
->
def
.
ch™
->band;

1992 
	`rcu_ªad_u∆ock
();

1994 i‡(!
	`rs_çc_Ælowed
(
mvm
, 
vif
, 
øã
, 
b™d
)) {

1995 
	`IWL_DEBUG_RATE
(
mvm
,

1997 
lq_°a
->
lq
.
ªdu˚d_çc
 = 
TPC_NO_REDUCTION
;

1998  
cur
 !
TPC_NO_REDUCTION
;

2001 
	`rs_gë_adja˚¡_txp
(
mvm
, 
cur
, &
wók
, &
°r⁄g
);

2004 
wödow
 = 
tbl
->
çc_wö
;

2005 
§
 = 
wödow
[
cur
].
suc˚ss_øtio
;

2006 
cuºít_çt
 = 
wödow
[
cur
].
avîage_çt
;

2007 i‡(
wók
 !
TPC_INVALID
)

2008 
wók_çt
 = 
wödow
[
wók
].
avîage_çt
;

2009 i‡(
°r⁄g
 !
TPC_INVALID
)

2010 
°r⁄g_çt
 = 
wödow
[
°r⁄g
].
avîage_çt
;

2012 
	`IWL_DEBUG_RATE
(
mvm
,

2014 
cur
, 
cuºít_çt
, 
§
, 
wók
, 
°r⁄g
,

2015 
wók_çt
, 
°r⁄g_çt
);

2017 
a˘i⁄
 = 
	`rs_gë_çc_a˘i⁄
(
mvm
, 
§
, 
wók
, 
°r⁄g
,

2018 
cuºít_çt
, 
wók_çt
, 
°r⁄g_çt
);

2021 i‡(
wók
 =
TPC_INVALID
 && 
a˘i⁄
 =
TPC_ACTION_DECREASE
) {

2022 
	`IWL_DEBUG_RATE
(
mvm
, "already inÜowestÅxp, stay\n");

2023 
a˘i⁄
 = 
TPC_ACTION_STAY
;

2024 } i‡(
°r⁄g
 =
TPC_INVALID
 &&

2025 (
a˘i⁄
 =
TPC_ACTION_INCREASE
 ||

2026 
a˘i⁄
 =
TPC_ACTION_NO_RESTIRCTION
)) {

2027 
	`IWL_DEBUG_RATE
(
mvm
, "already in highestÅxp, stay\n");

2028 
a˘i⁄
 = 
TPC_ACTION_STAY
;

2031 
a˘i⁄
) {

2032 
TPC_ACTION_DECREASE
:

2033 
lq_°a
->
lq
.
ªdu˚d_çc
 = 
wók
;

2034  
åue
;

2035 
TPC_ACTION_INCREASE
:

2036 
lq_°a
->
lq
.
ªdu˚d_çc
 = 
°r⁄g
;

2037  
åue
;

2038 
TPC_ACTION_NO_RESTIRCTION
:

2039 
lq_°a
->
lq
.
ªdu˚d_çc
 = 
TPC_NO_REDUCTION
;

2040  
åue
;

2041 
TPC_ACTION_STAY
:

2045  
Ál£
;

2046 
	}
}

2051 
	$rs_øã_sˇÀ_≥rf‹m
(
iwl_mvm
 *
mvm
,

2052 
õì80211_°a
 *
°a
,

2053 
iwl_lq_°a
 *
lq_°a
,

2054 
tid
, 
boﬁ
 
ndp
)

2056 
low
 = 
IWL_RATE_INVALID
;

2057 
high
 = 
IWL_RATE_INVALID
;

2058 
ödex
;

2059 
iwl_øã_sˇÀ_d©a
 *
wödow
 = 
NULL
;

2060 
cuºít_çt
 = 
IWL_INVALID_VALUE
;

2061 
low_çt
 = 
IWL_INVALID_VALUE
;

2062 
high_çt
 = 
IWL_INVALID_VALUE
;

2063 
u32
 
Áû_cou¡
;

2064 
rs_a˘i⁄
 
sˇÀ_a˘i⁄
 = 
RS_ACTION_STAY
;

2065 
u16
 
øã_mask
;

2066 
u8
 
upd©e_lq
 = 0;

2067 
iwl_sˇÀ_tbl_öfo
 *
tbl
, *
tbl1
;

2068 
u8
 
a˘ive_tbl
 = 0;

2069 
u8
 
d⁄e_£¨ch
 = 0;

2070 
u16
 
high_low
;

2071 
s32
 
§
;

2072 
u8
 
¥ev_agg
 = 
lq_°a
->
is_agg
;

2073 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2074 
rs_øã
 *
øã
;

2076 
lq_°a
->
is_agg
 = !!
mvm°a
->
agg_tids
;

2083 i‡(!
lq_°a
->
£¨ch_bëãr_tbl
)

2084 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2086 
a˘ive_tbl
 = 
	`rs_£¨ch_tbl
(
lq_°a
->active_tbl);

2088 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2089 
øã
 = &
tbl
->rate;

2091 i‡(
¥ev_agg
 !
lq_°a
->
is_agg
) {

2092 
	`IWL_DEBUG_RATE
(
mvm
,

2094 
¥ev_agg
, 
lq_°a
->
is_agg
);

2095 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

2096 
	`rs_øã_sˇÀ_˛ór_tbl_wödows
(
mvm
, 
tbl
);

2100 
ödex
 = 
øã
->index;

2103 
øã_mask
 = 
	`rs_gë_suµ‹ãd_øãs
(
lq_°a
, 
øã
);

2105 i‡(!(
	`BIT
(
ödex
Ë& 
øã_mask
)) {

2106 
	`IWL_ERR
(
mvm
, "Current Rate isÇot valid\n");

2107 i‡(
lq_°a
->
£¨ch_bëãr_tbl
) {

2109 
øã
->
ty≥
 = 
LQ_NONE
;

2110 
lq_°a
->
£¨ch_bëãr_tbl
 = 0;

2111 
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

2112 
	`rs_upd©e_øã_tbl
(
mvm
, 
°a
, 
lq_°a
, 
tbl
);

2118 i‡(!
tbl
->
ex≥˘ed_çt
) {

2119 
	`IWL_ERR
(
mvm
, "tbl->expected_tpt is NULL\n");

2124 
wödow
 = &(
tbl
->
wö
[
ödex
]);

2133 
Áû_cou¡
 = 
wödow
->
cou¡î
 - wödow->
suc˚ss_cou¡î
;

2134 i‡((
Áû_cou¡
 < 
IWL_MVM_RS_RATE_MIN_FAILURE_TH
) &&

2135 (
wödow
->
suc˚ss_cou¡î
 < 
IWL_MVM_RS_RATE_MIN_SUCCESS_TH
)) {

2136 
	`IWL_DEBUG_RATE
(
mvm
,

2138 
	`rs_¥ëty_øã
(
øã
),

2139 
wödow
->
suc˚ss_cou¡î
, wödow->
cou¡î
);

2142 
wödow
->
avîage_çt
 = 
IWL_INVALID_VALUE
;

2146 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
Ál£
);

2152 i‡(
lq_°a
->
£¨ch_bëãr_tbl
) {

2156 i‡(
wödow
->
avîage_çt
 > 
lq_°a
->
œ°_çt
) {

2157 
	`IWL_DEBUG_RATE
(
mvm
,

2160 
wödow
->
suc˚ss_øtio
,

2161 
wödow
->
avîage_çt
,

2162 
lq_°a
->
œ°_çt
);

2165 
lq_°a
->
a˘ive_tbl
 =áctive_tbl;

2166 
cuºít_çt
 = 
wödow
->
avîage_çt
;

2169 
	`IWL_DEBUG_RATE
(
mvm
,

2172 
wödow
->
suc˚ss_øtio
,

2173 
wödow
->
avîage_çt
,

2174 
lq_°a
->
œ°_çt
);

2177 
øã
->
ty≥
 = 
LQ_NONE
;

2180 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2181 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2184 
ödex
 = 
tbl
->
øã
.index;

2185 
cuºít_çt
 = 
lq_°a
->
œ°_çt
;

2188 
upd©e_lq
 = 1;

2193 
lq_°a
->
£¨ch_bëãr_tbl
 = 0;

2194 
d⁄e_£¨ch
 = 1;

2195 
lq_upd©e
;

2200 
high_low
 = 
	`rs_gë_adja˚¡_øã
(
mvm
, 
ödex
, 
øã_mask
, 
øã
->
ty≥
);

2201 
low
 = 
high_low
 & 0xff;

2202 
high
 = (
high_low
 >> 8) & 0xff;

2206 
§
 = 
wödow
->
suc˚ss_øtio
;

2209 
cuºít_çt
 = 
wödow
->
avîage_çt
;

2210 i‡(
low
 !
IWL_RATE_INVALID
)

2211 
low_çt
 = 
tbl
->
wö
[
low
].
avîage_çt
;

2212 i‡(
high
 !
IWL_RATE_INVALID
)

2213 
high_çt
 = 
tbl
->
wö
[
high
].
avîage_çt
;

2215 
	`IWL_DEBUG_RATE
(
mvm
,

2217 
	`rs_¥ëty_øã
(
øã
), 
cuºít_çt
, 
§
,

2218 
low
, 
high
, 
low_çt
, 
high_çt
);

2220 
sˇÀ_a˘i⁄
 = 
	`rs_gë_øã_a˘i⁄
(
mvm
, 
tbl
, 
§
, 
low
, 
high
,

2221 
cuºít_çt
, 
low_çt
, 
high_çt
);

2224 i‡(
	`is_mimo
(
øã
) &&

2225 !
	`iwl_mvm_bt_c€x_is_mimo_Ælowed
(
mvm
, 
°a
)) {

2226 
	`IWL_DEBUG_RATE
(
mvm
,

2228 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
åue
);

2229 
lq_upd©e
;

2232 
sˇÀ_a˘i⁄
) {

2233 
RS_ACTION_DOWNSCALE
:

2235 i‡(
low
 !
IWL_RATE_INVALID
) {

2236 
upd©e_lq
 = 1;

2237 
ödex
 = 
low
;

2239 
	`IWL_DEBUG_RATE
(
mvm
,

2244 
RS_ACTION_UPSCALE
:

2246 i‡(
high
 !
IWL_RATE_INVALID
) {

2247 
upd©e_lq
 = 1;

2248 
ödex
 = 
high
;

2250 
	`IWL_DEBUG_RATE
(
mvm
,

2255 
RS_ACTION_STAY
:

2257 i‡(
lq_°a
->
rs_°©e
 =
RS_STATE_STAY_IN_COLUMN
)

2258 
upd©e_lq
 = 
	`rs_çc_≥rf‹m
(
mvm
, 
°a
, 
lq_°a
, 
tbl
);

2264 
lq_upd©e
:

2266 i‡(
upd©e_lq
) {

2267 
tbl
->
øã
.
ödex
 = index;

2268 i‡(
IWL_MVM_RS_80_20_FAR_RANGE_TWEAK
)

2269 
	`rs_twók_øã_tbl
(
mvm
, 
°a
, 
lq_°a
, 
tbl
, 
sˇÀ_a˘i⁄
);

2270 
	`rs_£t_amsdu_Àn
(
mvm
, 
°a
, 
tbl
, 
sˇÀ_a˘i⁄
);

2271 
	`rs_upd©e_øã_tbl
(
mvm
, 
°a
, 
lq_°a
, 
tbl
);

2274 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
Ál£
);

2282 i‡(!
upd©e_lq
 && !
d⁄e_£¨ch
 &&

2283 
lq_°a
->
rs_°©e
 =
RS_STATE_SEARCH_CYCLE_STARTED


2284 && 
wödow
->
cou¡î
) {

2285 
rs_cﬁumn
 
√xt_cﬁumn
;

2288 
lq_°a
->
œ°_çt
 = 
cuºít_çt
;

2290 
	`IWL_DEBUG_RATE
(
mvm
,

2292 
upd©e_lq
, 
d⁄e_£¨ch
, 
lq_°a
->
rs_°©e
,

2293 
wödow
->
cou¡î
);

2295 
√xt_cﬁumn
 = 
	`rs_gë_√xt_cﬁumn
(
mvm
, 
lq_°a
, 
°a
, 
tbl
);

2296 i‡(
√xt_cﬁumn
 !
RS_COLUMN_INVALID
) {

2297 
ªt
 = 
	`rs_swôch_to_cﬁumn
(
mvm
, 
lq_°a
, 
°a
,

2298 
√xt_cﬁumn
);

2299 i‡(!
ªt
)

2300 
lq_°a
->
£¨ch_bëãr_tbl
 = 1;

2302 
	`IWL_DEBUG_RATE
(
mvm
,

2304 
lq_°a
->
rs_°©e
 = 
RS_STATE_SEARCH_CYCLE_ENDED
;

2308 i‡(
lq_°a
->
£¨ch_bëãr_tbl
) {

2310 
tbl
 = &
lq_°a
->
lq_öfo
[
	`rs_£¨ch_tbl
÷q_°a->
a˘ive_tbl
)];

2311 
	`rs_øã_sˇÀ_˛ór_tbl_wödows
(
mvm
, 
tbl
);

2314 
ödex
 = 
tbl
->
øã
.index;

2316 
	`rs_dump_øã
(
mvm
, &
tbl
->
øã
,

2318 
	`rs_upd©e_øã_tbl
(
mvm
, 
°a
, 
lq_°a
, 
tbl
);

2320 
d⁄e_£¨ch
 = 1;

2324 i‡(!
ndp
)

2325 
	`rs_é_tu∫_⁄_agg
(
mvm
, 
mvm°a
, 
tid
, 
lq_°a
, 
°a
);

2327 i‡(
d⁄e_£¨ch
 && 
lq_°a
->
rs_°©e
 =
RS_STATE_SEARCH_CYCLE_ENDED
) {

2328 
tbl1
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

2329 
	`rs_£t_°ay_ö_èbÀ
(
mvm
, 
	`is_Àgacy
(&
tbl1
->
øã
), 
lq_°a
);

2331 
	}
}

2333 
	srs_öô_øã_öfo
 {

2334 
s8
 
	mrssi
;

2335 
u8
 
	møã_idx
;

2338 c⁄° 
rs_öô_øã_öfo
 
	grs_›timÆ_øãs_24ghz_Àgacy
[] = {

2339 { -60, 
IWL_RATE_54M_INDEX
 },

2340 { -64, 
IWL_RATE_48M_INDEX
 },

2341 { -68, 
IWL_RATE_36M_INDEX
 },

2342 { -80, 
IWL_RATE_24M_INDEX
 },

2343 { -84, 
IWL_RATE_18M_INDEX
 },

2344 { -85, 
IWL_RATE_12M_INDEX
 },

2345 { -86, 
IWL_RATE_11M_INDEX
 },

2346 { -88, 
IWL_RATE_5M_INDEX
 },

2347 { -90, 
IWL_RATE_2M_INDEX
 },

2348 { 
S8_MIN
, 
IWL_RATE_1M_INDEX
 },

2351 c⁄° 
rs_öô_øã_öfo
 
	grs_›timÆ_øãs_5ghz_Àgacy
[] = {

2352 { -60, 
IWL_RATE_54M_INDEX
 },

2353 { -64, 
IWL_RATE_48M_INDEX
 },

2354 { -72, 
IWL_RATE_36M_INDEX
 },

2355 { -80, 
IWL_RATE_24M_INDEX
 },

2356 { -84, 
IWL_RATE_18M_INDEX
 },

2357 { -85, 
IWL_RATE_12M_INDEX
 },

2358 { -87, 
IWL_RATE_9M_INDEX
 },

2359 { 
S8_MIN
, 
IWL_RATE_6M_INDEX
 },

2362 c⁄° 
rs_öô_øã_öfo
 
	grs_›timÆ_øãs_ht
[] = {

2363 { -60, 
IWL_RATE_MCS_7_INDEX
 },

2364 { -64, 
IWL_RATE_MCS_6_INDEX
 },

2365 { -68, 
IWL_RATE_MCS_5_INDEX
 },

2366 { -72, 
IWL_RATE_MCS_4_INDEX
 },

2367 { -80, 
IWL_RATE_MCS_3_INDEX
 },

2368 { -84, 
IWL_RATE_MCS_2_INDEX
 },

2369 { -85, 
IWL_RATE_MCS_1_INDEX
 },

2370 { 
S8_MIN
, 
IWL_RATE_MCS_0_INDEX
},

2376 c⁄° 
rs_öô_øã_öfo
 
	grs_›timÆ_øãs_vht_20mhz
[] = {

2377 { -60, 
IWL_RATE_MCS_8_INDEX
 },

2378 { -64, 
IWL_RATE_MCS_7_INDEX
 },

2379 { -68, 
IWL_RATE_MCS_6_INDEX
 },

2380 { -72, 
IWL_RATE_MCS_5_INDEX
 },

2381 { -80, 
IWL_RATE_MCS_4_INDEX
 },

2382 { -84, 
IWL_RATE_MCS_3_INDEX
 },

2383 { -85, 
IWL_RATE_MCS_2_INDEX
 },

2384 { -87, 
IWL_RATE_MCS_1_INDEX
 },

2385 { 
S8_MIN
, 
IWL_RATE_MCS_0_INDEX
},

2388 c⁄° 
rs_öô_øã_öfo
 
	grs_›timÆ_øãs_vht
[] = {

2389 { -60, 
IWL_RATE_MCS_9_INDEX
 },

2390 { -64, 
IWL_RATE_MCS_8_INDEX
 },

2391 { -68, 
IWL_RATE_MCS_7_INDEX
 },

2392 { -72, 
IWL_RATE_MCS_6_INDEX
 },

2393 { -80, 
IWL_RATE_MCS_5_INDEX
 },

2394 { -84, 
IWL_RATE_MCS_4_INDEX
 },

2395 { -85, 
IWL_RATE_MCS_3_INDEX
 },

2396 { -87, 
IWL_RATE_MCS_2_INDEX
 },

2397 { -88, 
IWL_RATE_MCS_1_INDEX
 },

2398 { 
S8_MIN
, 
IWL_RATE_MCS_0_INDEX
 },

2401 
	#IWL_RS_LOW_RSSI_THRESHOLD
 (-76Ë

	)

2407 
	$rs_öô_›timÆ_øã
(
iwl_mvm
 *
mvm
,

2408 
õì80211_°a
 *
°a
,

2409 
iwl_lq_°a
 *
lq_°a
)

2411 
rs_øã
 *
øã
 = &
lq_°a
->
›timÆ_øã
;

2413 i‡(
lq_°a
->
max_mimo2_øã_idx
 !
IWL_RATE_INVALID
)

2414 
øã
->
ty≥
 = 
lq_°a
->
is_vht
 ? 
LQ_VHT_MIMO2
 : 
LQ_HT_MIMO2
;

2415 i‡(
lq_°a
->
max_siso_øã_idx
 !
IWL_RATE_INVALID
)

2416 
øã
->
ty≥
 = 
lq_°a
->
is_vht
 ? 
LQ_VHT_SISO
 : 
LQ_HT_SISO
;

2417 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
)

2418 
øã
->
ty≥
 = 
LQ_LEGACY_A
;

2420 
øã
->
ty≥
 = 
LQ_LEGACY_G
;

2422 
øã
->
bw
 = 
	`rs_bw_‰om_°a_bw
(
°a
);

2423 
øã
->
sgi
 = 
	`rs_sgi_Ælow
(
mvm
, 
°a
,Ñ©e, 
NULL
);

2427 i‡(
	`is_mimo
(
øã
)) {

2428 
lq_°a
->
›timÆ_øã_mask
 =Üq_°a->
a˘ive_mimo2_øã
;

2429 } i‡(
	`is_siso
(
øã
)) {

2430 
lq_°a
->
›timÆ_øã_mask
 =Üq_°a->
a˘ive_siso_øã
;

2432 
lq_°a
->
›timÆ_øã_mask
 =Üq_°a->
a˘ive_Àgacy_øã
;

2434 i‡(
lq_°a
->
b™d
 =
NL80211_BAND_5GHZ
) {

2435 
lq_°a
->
›timÆ_øãs
 = 
rs_›timÆ_øãs_5ghz_Àgacy
;

2436 
lq_°a
->
›timÆ_√¡rõs
 =

2437 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_5ghz_Àgacy
);

2439 
lq_°a
->
›timÆ_øãs
 = 
rs_›timÆ_øãs_24ghz_Àgacy
;

2440 
lq_°a
->
›timÆ_√¡rõs
 =

2441 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_24ghz_Àgacy
);

2445 i‡(
	`is_vht
(
øã
)) {

2446 i‡(
øã
->
bw
 =
RATE_MCS_CHAN_WIDTH_20
) {

2447 
lq_°a
->
›timÆ_øãs
 = 
rs_›timÆ_øãs_vht_20mhz
;

2448 
lq_°a
->
›timÆ_√¡rõs
 =

2449 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_vht_20mhz
);

2451 
lq_°a
->
›timÆ_øãs
 = 
rs_›timÆ_øãs_vht
;

2452 
lq_°a
->
›timÆ_√¡rõs
 =

2453 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_vht
);

2455 } i‡(
	`is_ht
(
øã
)) {

2456 
lq_°a
->
›timÆ_øãs
 = 
rs_›timÆ_øãs_ht
;

2457 
lq_°a
->
›timÆ_√¡rõs
 = 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_ht
);

2459 
	}
}

2462 
rs_øã
 *
	$rs_gë_›timÆ_øã
(
iwl_mvm
 *
mvm
,

2463 
iwl_lq_°a
 *
lq_°a
)

2465 
rs_øã
 *
øã
 = &
lq_°a
->
›timÆ_øã
;

2466 
i
;

2468 
øã
->
ödex
 = 
	`föd_fú°_bô
(&
lq_°a
->
›timÆ_øã_mask
,

2469 
BITS_PER_LONG
);

2471 
i
 = 0; i < 
lq_°a
->
›timÆ_√¡rõs
; i++) {

2472 
øã_idx
 = 
lq_°a
->
›timÆ_øãs
[
i
].rate_idx;

2474 i‡((
lq_°a
->
≥rs
.
œ°_rssi
 >lq_°a->
›timÆ_øãs
[
i
].
rssi
) &&

2475 (
	`BIT
(
øã_idx
Ë& 
lq_°a
->
›timÆ_øã_mask
)) {

2476 
øã
->
ödex
 = 
øã_idx
;

2481  
øã
;

2482 
	}
}

2487 
	$rs_gë_öôül_øã
(
iwl_mvm
 *
mvm
,

2488 
õì80211_°a
 *
°a
,

2489 
iwl_lq_°a
 *
lq_°a
,

2490 
∆80211_b™d
 
b™d
,

2491 
rs_øã
 *
øã
)

2493 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2494 
i
, 
√¡rõs
;

2495 
a˘ive_øã
;

2496 
s8
 
be°_rssi
 = 
S8_MIN
;

2497 
u8
 
be°_™t
 = 
ANT_NONE
;

2498 
u8
 
vÆid_tx_™t
 = 
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
);

2499 c⁄° 
rs_öô_øã_öfo
 *
öôül_øãs
;

2501 
i
 = 0; i < 
	`ARRAY_SIZE
(
lq_°a
->
≥rs
.
chaö_sig«l
); i++) {

2502 i‡(!(
lq_°a
->
≥rs
.
chaös
 & 
	`BIT
(
i
)))

2505 i‡(
lq_°a
->
≥rs
.
chaö_sig«l
[
i
] > 
be°_rssi
) {

2506 
be°_rssi
 = 
lq_°a
->
≥rs
.
chaö_sig«l
[
i
];

2507 
be°_™t
 = 
	`BIT
(
i
);

2511 
	`IWL_DEBUG_RATE
(
mvm
, "Best ANT: %s Best RSSI: %d\n",

2512 
	`iwl_rs_¥ëty_™t
(
be°_™t
), 
be°_rssi
);

2514 i‡(
be°_™t
 !
ANT_A
 && be°_™à!
ANT_B
)

2515 
øã
->
™t
 = 
	`fú°_™ã¬a
(
vÆid_tx_™t
);

2517 
øã
->
™t
 = 
be°_™t
;

2519 
øã
->
sgi
 = 
Ál£
;

2520 
øã
->
ldpc
 = 
Ál£
;

2521 
øã
->
bw
 = 
RATE_MCS_CHAN_WIDTH_20
;

2523 
øã
->
ödex
 = 
	`föd_fú°_bô
(&
lq_°a
->
a˘ive_Àgacy_øã
,

2524 
BITS_PER_LONG
);

2526 i‡(
b™d
 =
NL80211_BAND_5GHZ
) {

2527 
øã
->
ty≥
 = 
LQ_LEGACY_A
;

2528 
öôül_øãs
 = 
rs_›timÆ_øãs_5ghz_Àgacy
;

2529 
√¡rõs
 = 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_5ghz_Àgacy
);

2531 
øã
->
ty≥
 = 
LQ_LEGACY_G
;

2532 
öôül_øãs
 = 
rs_›timÆ_øãs_24ghz_Àgacy
;

2533 
√¡rõs
 = 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_24ghz_Àgacy
);

2536 i‡(!
IWL_MVM_RS_RSSI_BASED_INIT_RATE
)

2537 
out
;

2544 i‡(
°a
->
deÊök
.
vht_ˇp
.
vht_suµ‹ãd
 &&

2545 
be°_rssi
 > 
IWL_RS_LOW_RSSI_THRESHOLD
) {

2555 
u32
 
bw
 = 
mvm°a
->
°a_°©e
 < 
IEEE80211_STA_AUTHORIZED
 ?

2556 
RATE_MCS_CHAN_WIDTH_20
 : 
	`rs_bw_‰om_°a_bw
(
°a
);

2558 
bw
) {

2559 
RATE_MCS_CHAN_WIDTH_40
:

2560 
RATE_MCS_CHAN_WIDTH_80
:

2561 
RATE_MCS_CHAN_WIDTH_160
:

2562 
öôül_øãs
 = 
rs_›timÆ_øãs_vht
;

2563 
√¡rõs
 = 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_vht
);

2565 
RATE_MCS_CHAN_WIDTH_20
:

2566 
öôül_øãs
 = 
rs_›timÆ_øãs_vht_20mhz
;

2567 
√¡rõs
 = 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_vht_20mhz
);

2570 
	`IWL_ERR
(
mvm
, "Invalid BW %d\n",

2571 
°a
->
deÊök
.
b™dwidth
);

2572 
out
;

2575 
a˘ive_øã
 = 
lq_°a
->
a˘ive_siso_øã
;

2576 
øã
->
ty≥
 = 
LQ_VHT_SISO
;

2577 
øã
->
bw
 = bw;

2578 } i‡(
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
 &&

2579 
be°_rssi
 > 
IWL_RS_LOW_RSSI_THRESHOLD
) {

2580 
öôül_øãs
 = 
rs_›timÆ_øãs_ht
;

2581 
√¡rõs
 = 
	`ARRAY_SIZE
(
rs_›timÆ_øãs_ht
);

2582 
a˘ive_øã
 = 
lq_°a
->
a˘ive_siso_øã
;

2583 
øã
->
ty≥
 = 
LQ_HT_SISO
;

2585 
a˘ive_øã
 = 
lq_°a
->
a˘ive_Àgacy_øã
;

2588 
i
 = 0; i < 
√¡rõs
; i++) {

2589 
øã_idx
 = 
öôül_øãs
[
i
].rate_idx;

2591 i‡((
be°_rssi
 >
öôül_øãs
[
i
].
rssi
) &&

2592 (
	`BIT
(
øã_idx
Ë& 
a˘ive_øã
)) {

2593 
øã
->
ödex
 = 
øã_idx
;

2598 
out
:

2599 
	`rs_dump_øã
(
mvm
, 
øã
, "INITIAL");

2600 
	}
}

2603 
	$rs_upd©e_œ°_rssi
(
iwl_mvm
 *
mvm
,

2604 
iwl_mvm_°a
 *
mvm°a
,

2605 
õì80211_rx_°©us
 *
rx_°©us
)

2607 
iwl_lq_°a
 *
lq_°a
 = &
mvm°a
->
deÊök
.lq_°a.
rs_drv
;

2608 
i
;

2610 
lq_°a
->
≥rs
.
chaös
 = 
rx_°©us
->chains;

2611 
lq_°a
->
≥rs
.
chaö_sig«l
[0] = 
rx_°©us
->chain_signal[0];

2612 
lq_°a
->
≥rs
.
chaö_sig«l
[1] = 
rx_°©us
->chain_signal[1];

2613 
lq_°a
->
≥rs
.
œ°_rssi
 = 
S8_MIN
;

2615 
i
 = 0; i < 
	`ARRAY_SIZE
(
lq_°a
->
≥rs
.
chaö_sig«l
); i++) {

2616 i‡(!(
lq_°a
->
≥rs
.
chaös
 & 
	`BIT
(
i
)))

2619 i‡(
lq_°a
->
≥rs
.
chaö_sig«l
[
i
] >Üq_°a->≥rs.
œ°_rssi
)

2620 
lq_°a
->
≥rs
.
œ°_rssi
 =Üq_°a->≥rs.
chaö_sig«l
[
i
];

2622 
	}
}

2638 
	$rs_öôülize_lq
(
iwl_mvm
 *
mvm
,

2639 
õì80211_°a
 *
°a
,

2640 
iwl_lq_°a
 *
lq_°a
,

2641 
∆80211_b™d
 
b™d
)

2643 
iwl_sˇÀ_tbl_öfo
 *
tbl
;

2644 
rs_øã
 *
øã
;

2645 
u8
 
a˘ive_tbl
 = 0;

2647 i‡(!
°a
 || !
lq_°a
)

2650 i‡(!
lq_°a
->
£¨ch_bëãr_tbl
)

2651 
a˘ive_tbl
 = 
lq_°a
->active_tbl;

2653 
a˘ive_tbl
 = 
	`rs_£¨ch_tbl
(
lq_°a
->active_tbl);

2655 
tbl
 = &(
lq_°a
->
lq_öfo
[
a˘ive_tbl
]);

2656 
øã
 = &
tbl
->rate;

2658 
	`rs_gë_öôül_øã
(
mvm
, 
°a
, 
lq_°a
, 
b™d
, 
øã
);

2659 
	`rs_öô_›timÆ_øã
(
mvm
, 
°a
, 
lq_°a
);

2661 
	`WARN_ONCE
(
øã
->
™t
 !
ANT_A
 &&Ñ©e->™à!
ANT_B
,

2663 
øã
->
™t
, 
lq_°a
->
≥rs
.
chaös
, 
mvm
->
fw
->
vÆid_tx_™t
,

2664 
mvm
->
nvm_d©a
 ? mvm->nvm_d©a->
vÆid_tx_™t
 : 
ANT_INVALID
);

2666 
tbl
->
cﬁumn
 = 
	`rs_gë_cﬁumn_‰om_øã
(
øã
);

2668 
	`rs_£t_ex≥˘ed_çt_èbÀ
(
lq_°a
, 
tbl
);

2669 
	`rs_fûl_lq_cmd
(
mvm
, 
°a
, 
lq_°a
, 
øã
);

2671 
	`iwl_mvm_£nd_lq_cmd
(
mvm
, &
lq_°a
->
lq
);

2672 
	}
}

2674 
	$rs_drv_gë_øã
(*
mvm_r
, 
õì80211_°a
 *
°a
,

2675 *
mvm_°a
,

2676 
õì80211_tx_øã_c⁄åﬁ
 *
txrc
)

2678 
iwl_›_mode
 *
›_mode
 = 
mvm_r
;

2679 
iwl_mvm
 *
mvm
 
__maybe_unu£d
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

2680 
sk_buff
 *
skb
 = 
txrc
->skb;

2681 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2682 
iwl_lq_°a
 *
lq_°a
;

2683 
rs_øã
 *
›timÆ_øã
;

2684 
u32
 
œ°_ucode_øã
;

2686 i‡(
°a
 && !
	`iwl_mvm_°a_‰om_mac80211
(°a)->
vif
) {

2690 
mvm_°a
 = 
NULL
;

2693 i‡(!
mvm_°a
)

2696 
lq_°a
 = 
mvm_°a
;

2698 
	`•ö_lock_bh
(&
lq_°a
->
≥rs
.
lock
);

2699 
	`iwl_mvm_hwøã_to_tx_øã_v1
(
lq_°a
->
œ°_øã_n_Êags
,

2700 
öfo
->
b™d
, &öfo->
c⁄åﬁ
.
øãs
[0]);

2701 
öfo
->
c⁄åﬁ
.
øãs
[0].
cou¡
 = 1;

2706 i‡(
lq_°a
->
rs_°©e
 !
RS_STATE_STAY_IN_COLUMN
) {

2707 
›timÆ_øã
 = 
	`rs_gë_›timÆ_øã
(
mvm
, 
lq_°a
);

2708 
œ°_ucode_øã
 = 
	`ucode_øã_‰om_rs_øã
(
mvm
,

2709 
›timÆ_øã
);

2710 
	`iwl_mvm_hwøã_to_tx_øã_v1
(
œ°_ucode_øã
, 
öfo
->
b™d
,

2711 &
txrc
->
ªp‹ãd_øã
);

2713 
	`•ö_u∆ock_bh
(&
lq_°a
->
≥rs
.
lock
);

2714 
	}
}

2716 *
	$rs_drv_Æloc_°a
(*
mvm_øã
, 
õì80211_°a
 *
°a
,

2717 
gÂ_t
 
gÂ
)

2719 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2720 
iwl_›_mode
 *
›_mode
 = (iwl_›_modê*)
mvm_øã
;

2721 
iwl_mvm
 *
mvm
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

2722 
iwl_lq_°a
 *
lq_°a
 = &
mvm°a
->
deÊök
.lq_°a.
rs_drv
;

2724 
	`IWL_DEBUG_RATE
(
mvm
, "create stationÑate scale window\n");

2726 
lq_°a
->
≥rs
.
drv
 = 
mvm
;

2727 #ifde‡
CONFIG_MAC80211_DEBUGFS


2728 
lq_°a
->
≥rs
.
dbg_fixed_øã
 = 0;

2729 
lq_°a
->
≥rs
.
dbg_fixed_txp_ªdu˘i⁄
 = 
TPC_INVALID
;

2730 
lq_°a
->
≥rs
.
ss_f‹˚
 = 
RS_SS_FORCE_NONE
;

2732 
lq_°a
->
≥rs
.
chaös
 = 0;

2733 
	`mem£t
(
lq_°a
->
≥rs
.
chaö_sig«l
, 0, (lq_sta->pers.chain_signal));

2734 
lq_°a
->
≥rs
.
œ°_rssi
 = 
S8_MIN
;

2736  
lq_°a
;

2737 
	}
}

2739 
	$rs_vht_highe°_rx_mcs_ödex
(
õì80211_°a_vht_ˇp
 *
vht_ˇp
,

2740 
nss
)

2742 
u16
 
rx_mcs
 = 
	`À16_to_˝u
(
vht_ˇp
->
vht_mcs
.
rx_mcs_m≠
) &

2743 (0x3 << (2 * (
nss
 - 1)));

2744 
rx_mcs
 >>(2 * (
nss
 - 1));

2746 i‡(
rx_mcs
 =
IEEE80211_VHT_MCS_SUPPORT_0_7
)

2747  
IWL_RATE_MCS_7_INDEX
;

2748 i‡(
rx_mcs
 =
IEEE80211_VHT_MCS_SUPPORT_0_8
)

2749  
IWL_RATE_MCS_8_INDEX
;

2750 i‡(
rx_mcs
 =
IEEE80211_VHT_MCS_SUPPORT_0_9
)

2751  
IWL_RATE_MCS_9_INDEX
;

2753 
	`WARN_ON_ONCE
(
rx_mcs
 !
IEEE80211_VHT_MCS_NOT_SUPPORTED
);

2755 
	}
}

2757 
	$rs_vht_£t_íabÀd_øãs
(
õì80211_°a
 *
°a
,

2758 
õì80211_°a_vht_ˇp
 *
vht_ˇp
,

2759 
iwl_lq_°a
 *
lq_°a
)

2761 
i
;

2762 
highe°_mcs
 = 
	`rs_vht_highe°_rx_mcs_ödex
(
vht_ˇp
, 1);

2764 i‡(
highe°_mcs
 >
IWL_RATE_MCS_0_INDEX
) {

2765 
i
 = 
IWL_RATE_MCS_0_INDEX
; i <
highe°_mcs
; i++) {

2766 i‡(
i
 =
IWL_RATE_9M_INDEX
)

2770 i‡(
i
 =
IWL_RATE_MCS_9_INDEX
 &&

2771 
°a
->
deÊök
.
b™dwidth
 =
IEEE80211_STA_RX_BW_20
)

2774 
lq_°a
->
a˘ive_siso_øã
 |
	`BIT
(
i
);

2778 i‡(
°a
->
deÊök
.
rx_nss
 < 2)

2781 
highe°_mcs
 = 
	`rs_vht_highe°_rx_mcs_ödex
(
vht_ˇp
, 2);

2782 i‡(
highe°_mcs
 >
IWL_RATE_MCS_0_INDEX
) {

2783 
i
 = 
IWL_RATE_MCS_0_INDEX
; i <
highe°_mcs
; i++) {

2784 i‡(
i
 =
IWL_RATE_9M_INDEX
)

2788 i‡(
i
 =
IWL_RATE_MCS_9_INDEX
 &&

2789 
°a
->
deÊök
.
b™dwidth
 =
IEEE80211_STA_RX_BW_20
)

2792 
lq_°a
->
a˘ive_mimo2_øã
 |
	`BIT
(
i
);

2795 
	}
}

2797 
	$rs_ht_öô
(
iwl_mvm
 *
mvm
,

2798 
õì80211_°a
 *
°a
,

2799 
iwl_lq_°a
 *
lq_°a
,

2800 
õì80211_°a_ht_ˇp
 *
ht_ˇp
)

2806 
lq_°a
->
a˘ive_siso_øã
 = 
ht_ˇp
->
mcs
.
rx_mask
[0] << 1;

2807 
lq_°a
->
a˘ive_siso_øã
 |
ht_ˇp
->
mcs
.
rx_mask
[0] & 0x1;

2808 
lq_°a
->
a˘ive_siso_øã
 &~((
u16
)0x2);

2809 
lq_°a
->
a˘ive_siso_øã
 <<
IWL_FIRST_OFDM_RATE
;

2811 
lq_°a
->
a˘ive_mimo2_øã
 = 
ht_ˇp
->
mcs
.
rx_mask
[1] << 1;

2812 
lq_°a
->
a˘ive_mimo2_øã
 |
ht_ˇp
->
mcs
.
rx_mask
[1] & 0x1;

2813 
lq_°a
->
a˘ive_mimo2_øã
 &~((
u16
)0x2);

2814 
lq_°a
->
a˘ive_mimo2_øã
 <<
IWL_FIRST_OFDM_RATE
;

2816 i‡(
mvm
->
cfg
->
ht_∑øms
->
ldpc
 &&

2817 (
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_LDPC_CODING
))

2818 
lq_°a
->
ldpc
 = 
åue
;

2820 i‡(
mvm
->
cfg
->
ht_∑øms
->
°bc
 &&

2821 (
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
)) > 1) &&

2822 (
ht_ˇp
->
ˇp
 & 
IEEE80211_HT_CAP_RX_STBC
))

2823 
lq_°a
->
°bc_ˇ∑bÀ
 = 
åue
;

2825 
lq_°a
->
is_vht
 = 
Ál£
;

2826 
	}
}

2828 
	$rs_vht_öô
(
iwl_mvm
 *
mvm
,

2829 
õì80211_°a
 *
°a
,

2830 
iwl_lq_°a
 *
lq_°a
,

2831 
õì80211_°a_vht_ˇp
 *
vht_ˇp
)

2833 
	`rs_vht_£t_íabÀd_øãs
(
°a
, 
vht_ˇp
, 
lq_°a
);

2835 i‡(
mvm
->
cfg
->
ht_∑øms
->
ldpc
 &&

2836 (
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_RXLDPC
))

2837 
lq_°a
->
ldpc
 = 
åue
;

2839 i‡(
mvm
->
cfg
->
ht_∑øms
->
°bc
 &&

2840 (
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
)) > 1) &&

2841 (
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_RXSTBC_MASK
))

2842 
lq_°a
->
°bc_ˇ∑bÀ
 = 
åue
;

2844 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_BEAMFORMER
) &&

2845 (
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
)) > 1) &&

2846 (
vht_ˇp
->
ˇp
 & 
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
))

2847 
lq_°a
->
b„r_ˇ∑bÀ
 = 
åue
;

2849 
lq_°a
->
is_vht
 = 
åue
;

2850 
	}
}

2852 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2853 
	$iwl_mvm_ª£t_‰ame_°©s
(
iwl_mvm
 *
mvm
)

2855 
	`•ö_lock_bh
(&
mvm
->
drv_°©s_lock
);

2856 
	`mem£t
(&
mvm
->
drv_rx_°©s
, 0, (mvm->drv_rx_stats));

2857 
	`•ö_u∆ock_bh
(&
mvm
->
drv_°©s_lock
);

2858 
	}
}

2860 
	$iwl_mvm_upd©e_‰ame_°©s
(
iwl_mvm
 *
mvm
, 
u32
 
øã
, 
boﬁ
 
agg
)

2862 
u8
 
nss
 = 0;

2864 
	`•ö_lock
(&
mvm
->
drv_°©s_lock
);

2866 i‡(
agg
)

2867 
mvm
->
drv_rx_°©s
.
agg_‰ames
++;

2869 
mvm
->
drv_rx_°©s
.
suc˚ss_‰ames
++;

2871 
øã
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
) {

2872 
RATE_MCS_CHAN_WIDTH_20
:

2873 
mvm
->
drv_rx_°©s
.
bw_20_‰ames
++;

2875 
RATE_MCS_CHAN_WIDTH_40
:

2876 
mvm
->
drv_rx_°©s
.
bw_40_‰ames
++;

2878 
RATE_MCS_CHAN_WIDTH_80
:

2879 
mvm
->
drv_rx_°©s
.
bw_80_‰ames
++;

2881 
RATE_MCS_CHAN_WIDTH_160
:

2882 
mvm
->
drv_rx_°©s
.
bw_160_‰ames
++;

2885 
	`WARN_ONCE
(1, "bad BW.Ñ©ê0x%x", 
øã
);

2888 i‡(
øã
 & 
RATE_MCS_HT_MSK_V1
) {

2889 
mvm
->
drv_rx_°©s
.
ht_‰ames
++;

2890 
nss
 = ((
øã
 & 
RATE_HT_MCS_NSS_MSK_V1
Ë>> 
RATE_HT_MCS_NSS_POS_V1
) + 1;

2891 } i‡(
øã
 & 
RATE_MCS_VHT_MSK_V1
) {

2892 
mvm
->
drv_rx_°©s
.
vht_‰ames
++;

2893 
nss
 = 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã
) + 1;

2895 
mvm
->
drv_rx_°©s
.
Àgacy_‰ames
++;

2898 i‡(
nss
 == 1)

2899 
mvm
->
drv_rx_°©s
.
siso_‰ames
++;

2900 i‡(
nss
 == 2)

2901 
mvm
->
drv_rx_°©s
.
mimo2_‰ames
++;

2903 i‡(
øã
 & 
RATE_MCS_SGI_MSK_V1
)

2904 
mvm
->
drv_rx_°©s
.
sgi_‰ames
++;

2906 
mvm
->
drv_rx_°©s
.
ngi_‰ames
++;

2908 
mvm
->
drv_rx_°©s
.
œ°_øãs
[mvm->drv_rx_°©s.
œ°_‰ame_idx
] = 
øã
;

2909 
mvm
->
drv_rx_°©s
.
œ°_‰ame_idx
 =

2910 (
mvm
->
drv_rx_°©s
.
œ°_‰ame_idx
 + 1) %

2911 
	`ARRAY_SIZE
(
mvm
->
drv_rx_°©s
.
œ°_øãs
);

2913 
	`•ö_u∆ock
(&
mvm
->
drv_°©s_lock
);

2914 
	}
}

2920 
	$rs_drv_øã_öô
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

2921 
∆80211_b™d
 
b™d
)

2923 
i
, 
j
;

2924 
õì80211_hw
 *
hw
 = 
mvm
->hw;

2925 
õì80211_°a_ht_ˇp
 *
ht_ˇp
 = &
°a
->
deÊök
.ht_cap;

2926 
õì80211_°a_vht_ˇp
 *
vht_ˇp
 = &
°a
->
deÊök
.vht_cap;

2927 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2928 
iwl_lq_°a
 *
lq_°a
 = &
mvm°a
->
deÊök
.lq_°a.
rs_drv
;

2929 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

2930 
suµ
;

2932 
	`lockdï_as£π_hñd
(&
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
lock
);

2935 
	`mem£t
(
lq_°a
, 0, 
	`off£tof
(
	`ty≥of
(*lq_°a), 
≥rs
));

2937 
sb™d
 = 
hw
->
wùhy
->
b™ds
[
b™d
];

2939 
lq_°a
->
lq
.
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

2940 
mvm°a
->
amsdu_íabÀd
 = 0;

2941 
mvm°a
->
max_amsdu_Àn
 = 
°a
->
cur
->max_amsdu_len;

2943 
j
 = 0; j < 
LQ_SIZE
; j++)

2944 
	`rs_øã_sˇÀ_˛ór_tbl_wödows
(
mvm
, &
lq_°a
->
lq_öfo
[
j
]);

2946 
lq_°a
->
Êush_timî
 = 0;

2947 
lq_°a
->
œ°_tx
 = 
jiffõs
;

2949 
	`IWL_DEBUG_RATE
(
mvm
,

2951 
mvm°a
->
deÊök
.
°a_id
);

2957 
lq_°a
->
mis£d_øã_cou¡î
 = 
IWL_MVM_RS_MISSED_RATE_MAX
;

2958 
lq_°a
->
b™d
 = 
sb™d
->band;

2962 
suµ
 = 
°a
->
deÊök
.
suµ_øãs
[
sb™d
->
b™d
];

2963 
lq_°a
->
a˘ive_Àgacy_øã
 = 0;

2964 
	`f‹_óch_£t_bô
(
i
, &
suµ
, 
BITS_PER_LONG
)

2965 
lq_°a
->
a˘ive_Àgacy_øã
 |
	`BIT
(
sb™d
->
bôøãs
[
i
].
hw_vÆue
);

2968 i‡(!
vht_ˇp
 || !vht_ˇp->
vht_suµ‹ãd
)

2969 
	`rs_ht_öô
(
mvm
, 
°a
, 
lq_°a
, 
ht_ˇp
);

2971 
	`rs_vht_öô
(
mvm
, 
°a
, 
lq_°a
, 
vht_ˇp
);

2973 
lq_°a
->
max_Àgacy_øã_idx
 =

2974 
	`rs_gë_max_øã_‰om_mask
(
lq_°a
->
a˘ive_Àgacy_øã
);

2975 
lq_°a
->
max_siso_øã_idx
 =

2976 
	`rs_gë_max_øã_‰om_mask
(
lq_°a
->
a˘ive_siso_øã
);

2977 
lq_°a
->
max_mimo2_øã_idx
 =

2978 
	`rs_gë_max_øã_‰om_mask
(
lq_°a
->
a˘ive_mimo2_øã
);

2980 
	`IWL_DEBUG_RATE
(
mvm
,

2982 
lq_°a
->
a˘ive_Àgacy_øã
,

2983 
lq_°a
->
a˘ive_siso_øã
,

2984 
lq_°a
->
a˘ive_mimo2_øã
,

2985 
lq_°a
->
is_vht
,Üq_°a->
ldpc
,Üq_°a->
°bc_ˇ∑bÀ
,

2986 
lq_°a
->
b„r_ˇ∑bÀ
);

2987 
	`IWL_DEBUG_RATE
(
mvm
, "MAX RATE: LEGACY=%d SISO=%d MIMO2=%d\n",

2988 
lq_°a
->
max_Àgacy_øã_idx
,

2989 
lq_°a
->
max_siso_øã_idx
,

2990 
lq_°a
->
max_mimo2_øã_idx
);

2993 
lq_°a
->
lq
.
sögÀ_°ªam_™t_msk
 =

2994 
	`iwl_mvm_bt_c€x_gë_sögÀ_™t_msk
(
mvm
, 
	`iwl_mvm_gë_vÆid_tx_™t
(mvm));

2995 
lq_°a
->
lq
.
duÆ_°ªam_™t_msk
 = 
ANT_AB
;

2998 
lq_°a
->
tx_agg_tid_í
 = 
IWL_AGG_ALL_TID
;

2999 
lq_°a
->
is_agg
 = 0;

3000 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3001 
	`iwl_mvm_ª£t_‰ame_°©s
(
mvm
);

3003 
	`rs_öôülize_lq
(
mvm
, 
°a
, 
lq_°a
, 
b™d
);

3004 
	}
}

3006 
	$rs_drv_øã_upd©e
(*
mvm_r
,

3007 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

3008 
cfg80211_ch™_def
 *
ch™def
,

3009 
õì80211_°a
 *
°a
,

3010 *
¥iv_°a
, 
u32
 
ch™ged
)

3012 
iwl_›_mode
 *
›_mode
 = 
mvm_r
;

3013 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3014 
iwl_mvm
 *
mvm
 
__maybe_unu£d
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

3015 
u8
 
tid
;

3017 i‡(!
mvm°a
->
vif
)

3021 
tid
 = 0;Åid < 
IWL_MAX_TID_COUNT
;Åid++)

3022 
	`õì80211_°›_tx_ba_£ssi⁄
(
°a
, 
tid
);

3024 
	`iwl_mvm_rs_øã_öô
(
mvm
, 
mvm°a
->
vif
, 
°a
,

3025 &
mvm°a
->
vif
->
bss_c⁄f
, &
°a
->
deÊök
,

3026 
sb™d
->
b™d
);

3027 
	}
}

3029 
	$__iwl_mvm_rs_tx_°©us
(
iwl_mvm
 *
mvm
,

3030 
õì80211_°a
 *
°a
,

3031 
tid
, 
õì80211_tx_öfo
 *
öfo
,

3032 
boﬁ
 
ndp
)

3034 
Àgacy_suc˚ss
;

3035 
ªåõs
;

3036 
i
;

3037 
iwl_lq_cmd
 *
èbÀ
;

3038 
u32
 
lq_hwøã
;

3039 
rs_øã
 
lq_øã
, 
tx_ª•_øã
;

3040 
iwl_sˇÀ_tbl_öfo
 *
cuº_tbl
, *
Ÿhî_tbl
, *
tmp_tbl
;

3041 
u32
 
éc_öfo
 = (
uöçå_t
)
öfo
->
°©us
.
°©us_drivî_d©a
[0];

3042 
u8
 
ªdu˚d_txp
 = 
éc_öfo
 & 
RS_DRV_DATA_TXP_MSK
;

3043 
u8
 
lq_cﬁ‹
 = 
	`RS_DRV_DATA_LQ_COLOR_GET
(
éc_öfo
);

3044 
u32
 
tx_ª•_hwøã
 = (
uöçå_t
)
öfo
->
°©us
.
°©us_drivî_d©a
[1];

3045 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3046 
iwl_lq_°a
 *
lq_°a
 = &
mvm°a
->
deÊök
.lq_°a.
rs_drv
;

3048 i‡(!
lq_°a
->
≥rs
.
drv
) {

3049 
	`IWL_DEBUG_RATE
(
mvm
, "Rate scalingÇot initialized yet.\n");

3054 i‡((
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
) &&

3055 !(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_AMPDU
))

3058 i‡(
	`rs_øã_‰om_ucode_øã
(
tx_ª•_hwøã
, 
öfo
->
b™d
,

3059 &
tx_ª•_øã
)) {

3060 
	`WARN_ON_ONCE
(1);

3064 #ifde‡
CONFIG_MAC80211_DEBUGFS


3068 i‡(
lq_°a
->
≥rs
.
dbg_fixed_øã
) {

3069 
ödex
 = 
tx_ª•_øã
.index;

3070 
rs_cﬁumn
 
cﬁumn
;

3071 
©ãm±s
, 
suc˚ss
;

3073 
cﬁumn
 = 
	`rs_gë_cﬁumn_‰om_øã
(&
tx_ª•_øã
);

3074 i‡(
	`WARN_ONCE
(
cﬁumn
 =
RS_COLUMN_INVALID
,

3076 
tx_ª•_hwøã
))

3079 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_AMPDU
) {

3080 
©ãm±s
 = 
öfo
->
°©us
.
ampdu_Àn
;

3081 
suc˚ss
 = 
öfo
->
°©us
.
ampdu_ack_Àn
;

3083 
©ãm±s
 = 
öfo
->
°©us
.
øãs
[0].
cou¡
;

3084 
suc˚ss
 = !!(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_ACK
);

3087 
lq_°a
->
≥rs
.
tx_°©s
[
cﬁumn
][
ödex
].
tŸÆ
 +
©ãm±s
;

3088 
lq_°a
->
≥rs
.
tx_°©s
[
cﬁumn
][
ödex
].
suc˚ss
 += success;

3090 
	`IWL_DEBUG_RATE
(
mvm
, "FixedÑate 0x%x success %dáttempts %d\n",

3091 
tx_ª•_hwøã
, 
suc˚ss
, 
©ãm±s
);

3096 i‡(
	`time_a·î
(
jiffõs
,

3097 ()(
lq_°a
->
œ°_tx
 +

3098 (
IWL_MVM_RS_IDLE_TIMEOUT
 * 
HZ
)))) {

3099 
	`IWL_DEBUG_RATE
(
mvm
, "Tx idle forÅooÜong.ÑeinitÑs\n");

3103 
	`rs_drv_øã_öô
(
mvm
, 
°a
, 
öfo
->
b™d
);

3106 
lq_°a
->
œ°_tx
 = 
jiffõs
;

3115 
èbÀ
 = &
lq_°a
->
lq
;

3116 
lq_hwøã
 = 
	`À32_to_˝u
(
èbÀ
->
rs_èbÀ
[0]);

3117 i‡(
	`rs_øã_‰om_ucode_øã
(
lq_hwøã
, 
öfo
->
b™d
, &
lq_øã
)) {

3118 
	`WARN_ON_ONCE
(1);

3123 i‡(
lq_cﬁ‹
 !
	`LQ_FLAG_COLOR_GET
(
èbÀ
->
Êags
)) {

3124 
	`IWL_DEBUG_RATE
(
mvm
,

3126 
lq_cﬁ‹
, 
	`LQ_FLAG_COLOR_GET
(
èbÀ
->
Êags
));

3132 
lq_°a
->
mis£d_øã_cou¡î
++;

3133 i‡(
lq_°a
->
mis£d_øã_cou¡î
 > 
IWL_MVM_RS_MISSED_RATE_MAX
) {

3134 
lq_°a
->
mis£d_øã_cou¡î
 = 0;

3135 
	`IWL_DEBUG_RATE
(
mvm
,

3137 
lq_°a
->
rs_°©e
);

3138 
	`iwl_mvm_£nd_lq_cmd
(
mvm
, &
lq_°a
->
lq
);

3145 
lq_°a
->
mis£d_øã_cou¡î
 = 0;

3147 i‡(!
lq_°a
->
£¨ch_bëãr_tbl
) {

3148 
cuº_tbl
 = &
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
];

3149 
Ÿhî_tbl
 = &
lq_°a
->
lq_öfo
[
	`rs_£¨ch_tbl
÷q_°a->
a˘ive_tbl
)];

3151 
cuº_tbl
 = &
lq_°a
->
lq_öfo
[
	`rs_£¨ch_tbl
÷q_°a->
a˘ive_tbl
)];

3152 
Ÿhî_tbl
 = &
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
];

3155 i‡(
	`WARN_ON_ONCE
(!
	`rs_øã_cﬁumn_m©ch
(&
lq_øã
, &
cuº_tbl
->
øã
))) {

3156 
	`IWL_DEBUG_RATE
(
mvm
,

3158 
tmp_tbl
 = &
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
];

3159 
	`rs_dump_øã
(
mvm
, &
tmp_tbl
->
øã
, "ACTIVE");

3160 
tmp_tbl
 = &
lq_°a
->
lq_öfo
[
	`rs_£¨ch_tbl
÷q_°a->
a˘ive_tbl
)];

3161 
	`rs_dump_øã
(
mvm
, &
tmp_tbl
->
øã
, "SEARCH");

3162 
	`rs_dump_øã
(
mvm
, &
lq_øã
, "ACTUAL");

3167 
	`rs_°ay_ö_èbÀ
(
lq_°a
, 
åue
);

3168 
d⁄e
;

3177 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_AMPDU
) {

3178 
	`rs_cﬁÀ˘_çc_d©a
(
mvm
, 
lq_°a
, 
cuº_tbl
, 
tx_ª•_øã
.
ödex
,

3179 
öfo
->
°©us
.
ampdu_Àn
,

3180 
öfo
->
°©us
.
ampdu_ack_Àn
,

3181 
ªdu˚d_txp
);

3196 i‡(
öfo
->
°©us
.
ampdu_ack_Àn
 == 0)

3197 
öfo
->
°©us
.
ampdu_Àn
 = 1;

3199 
	`rs_cﬁÀ˘_éc_d©a
(
mvm
, 
mvm°a
, 
tid
, 
cuº_tbl
,

3200 
tx_ª•_øã
.
ödex
,

3201 
öfo
->
°©us
.
ampdu_Àn
,

3202 
öfo
->
°©us
.
ampdu_ack_Àn
);

3205 i‡(
lq_°a
->
rs_°©e
 =
RS_STATE_STAY_IN_COLUMN
) {

3206 
lq_°a
->
tŸÆ_suc˚ss
 +
öfo
->
°©us
.
ampdu_ack_Àn
;

3207 
lq_°a
->
tŸÆ_Áûed
 +(
öfo
->
°©us
.
ampdu_Àn
 -

3208 
öfo
->
°©us
.
ampdu_ack_Àn
);

3212 
ªåõs
 = 
öfo
->
°©us
.
øãs
[0].
cou¡
 - 1;

3214 
ªåõs
 = 
	`mö
(retries, 15);

3217 
Àgacy_suc˚ss
 = !!(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_ACK
);

3219 
i
 = 0; i <
ªåõs
; ++i) {

3220 
lq_hwøã
 = 
	`À32_to_˝u
(
èbÀ
->
rs_èbÀ
[
i
]);

3221 i‡(
	`rs_øã_‰om_ucode_øã
(
lq_hwøã
, 
öfo
->
b™d
,

3222 &
lq_øã
)) {

3223 
	`WARN_ON_ONCE
(1);

3230 i‡(
	`rs_øã_cﬁumn_m©ch
(&
lq_øã
, &
cuº_tbl
->
øã
))

3231 
tmp_tbl
 = 
cuº_tbl
;

3232 i‡(
	`rs_øã_cﬁumn_m©ch
(&
lq_øã
,

3233 &
Ÿhî_tbl
->
øã
))

3234 
tmp_tbl
 = 
Ÿhî_tbl
;

3238 
	`rs_cﬁÀ˘_çc_d©a
(
mvm
, 
lq_°a
, 
tmp_tbl
,

3239 
tx_ª•_øã
.
ödex
, 1,

3240 
i
 < 
ªåõs
 ? 0 : 
Àgacy_suc˚ss
,

3241 
ªdu˚d_txp
);

3242 
	`rs_cﬁÀ˘_éc_d©a
(
mvm
, 
mvm°a
, 
tid
, 
tmp_tbl
,

3243 
tx_ª•_øã
.
ödex
, 1,

3244 
i
 < 
ªåõs
 ? 0 : 
Àgacy_suc˚ss
);

3248 i‡(
lq_°a
->
rs_°©e
 =
RS_STATE_STAY_IN_COLUMN
) {

3249 
lq_°a
->
tŸÆ_suc˚ss
 +
Àgacy_suc˚ss
;

3250 
lq_°a
->
tŸÆ_Áûed
 +
ªåõs
 + (1 - 
Àgacy_suc˚ss
);

3254 
lq_°a
->
œ°_øã_n_Êags
 = 
lq_hwøã
;

3255 
	`IWL_DEBUG_RATE
(
mvm
, "ªdu˚dÅxpowî: %d\n", 
ªdu˚d_txp
);

3256 
d⁄e
:

3258 i‡(
°a
->
deÊök
.
suµ_øãs
[
öfo
->
b™d
])

3259 
	`rs_øã_sˇÀ_≥rf‹m
(
mvm
, 
°a
, 
lq_°a
, 
tid
, 
ndp
);

3260 
	}
}

3262 
	$iwl_mvm_rs_tx_°©us
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

3263 
tid
, 
õì80211_tx_öfo
 *
öfo
, 
boﬁ
 
ndp
)

3265 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3270 i‡(!
	`•ö_åylock_bh
(&
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
lock
))

3273 
	`__iwl_mvm_rs_tx_°©us
(
mvm
, 
°a
, 
tid
, 
öfo
, 
ndp
);

3274 
	`•ö_u∆ock_bh
(&
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
lock
);

3275 
	}
}

3277 #ifde‡
CONFIG_MAC80211_DEBUGFS


3278 
	$rs_buûd_øãs_èbÀ_‰om_fixed
(
iwl_mvm
 *
mvm
,

3279 
iwl_lq_cmd
 *
lq_cmd
,

3280 
∆80211_b™d
 
b™d
,

3281 
u32
 
ucode_øã
)

3283 
rs_øã
 
øã
;

3284 
i
;

3285 
num_øãs
 = 
	`ARRAY_SIZE
(
lq_cmd
->
rs_èbÀ
);

3286 
__À32
 
ucode_øã_À32
 = 
	`˝u_to_À32
(
ucode_øã
);

3287 
u8
 
™t
 = (
ucode_øã
 & 
RATE_MCS_ANT_AB_MSK
Ë>> 
RATE_MCS_ANT_POS
;

3289 
i
 = 0; i < 
num_øãs
; i++)

3290 
lq_cmd
->
rs_èbÀ
[
i
] = 
ucode_øã_À32
;

3292 i‡(
	`rs_øã_‰om_ucode_øã
(
ucode_øã
, 
b™d
, &
øã
)) {

3293 
	`WARN_ON_ONCE
(1);

3297 i‡(
	`is_mimo
(&
øã
))

3298 
lq_cmd
->
mimo_dñim
 = 
num_øãs
 - 1;

3300 
lq_cmd
->
mimo_dñim
 = 0;

3302 
lq_cmd
->
ªdu˚d_çc
 = 0;

3304 i‡(
	`num_of_™t
(
™t
) == 1)

3305 
lq_cmd
->
sögÀ_°ªam_™t_msk
 = 
™t
;

3307 i‡(!
mvm
->
å™s
->
å™s_cfg
->
gí2
)

3308 
lq_cmd
->
agg_‰ame_˙t_limô
 = 
LINK_QUAL_AGG_FRAME_LIMIT_DEF
;

3310 
lq_cmd
->
agg_‰ame_˙t_limô
 =

3311 
LINK_QUAL_AGG_FRAME_LIMIT_GEN2_DEF
;

3312 
	}
}

3315 
	$rs_fûl_øãs_f‹_cﬁumn
(
iwl_mvm
 *
mvm
,

3316 
iwl_lq_°a
 *
lq_°a
,

3317 
rs_øã
 *
øã
,

3318 
__À32
 *
rs_èbÀ
, *
rs_èbÀ_ödex
,

3319 
num_øãs
, 
num_ªåõs
,

3320 
u8
 
vÆid_tx_™t
, 
boﬁ
 
toggÀ_™t
)

3322 
i
, 
j
;

3323 
__À32
 
ucode_øã
;

3324 
boﬁ
 
bŸtom_ªached
 = 
Ál£
;

3325 
¥ev_øã_idx
 = 
øã
->
ödex
;

3326 
íd
 = 
LINK_QUAL_MAX_RETRY_NUM
;

3327 
ödex
 = *
rs_èbÀ_ödex
;

3329 
i
 = 0; i < 
num_øãs
 && 
ödex
 < 
íd
; i++) {

3330 
j
 = 0; j < 
num_ªåõs
 && 
ödex
 < 
íd
; j++, index++) {

3331 
ucode_øã
 = 
	`˝u_to_À32
(
	`ucode_øã_‰om_rs_øã
(
mvm
,

3332 
øã
));

3333 
rs_èbÀ
[
ödex
] = 
ucode_øã
;

3334 i‡(
toggÀ_™t
)

3335 
	`rs_toggÀ_™ã¬a
(
vÆid_tx_™t
, 
øã
);

3338 
¥ev_øã_idx
 = 
øã
->
ödex
;

3339 
bŸtom_ªached
 = 
	`rs_gë_lowî_øã_ö_cﬁumn
(
lq_°a
, 
øã
);

3340 i‡(
bŸtom_ªached
 && !
	`is_Àgacy
(
øã
))

3344 i‡(!
bŸtom_ªached
 && !
	`is_Àgacy
(
øã
))

3345 
øã
->
ödex
 = 
¥ev_øã_idx
;

3347 *
rs_èbÀ_ödex
 = 
ödex
;

3348 
	}
}

3370 
	$rs_buûd_øãs_èbÀ
(
iwl_mvm
 *
mvm
,

3371 
õì80211_°a
 *
°a
,

3372 
iwl_lq_°a
 *
lq_°a
,

3373 c⁄° 
rs_øã
 *
öôül_øã
)

3375 
rs_øã
 
øã
;

3376 
num_øãs
, 
num_ªåõs
, 
ödex
 = 0;

3377 
u8
 
vÆid_tx_™t
 = 0;

3378 
iwl_lq_cmd
 *
lq_cmd
 = &
lq_°a
->
lq
;

3379 
boﬁ
 
toggÀ_™t
 = 
Ál£
;

3380 
u32
 
cﬁ‹
;

3382 
	`mem˝y
(&
øã
, 
öôül_øã
, (rate));

3384 
vÆid_tx_™t
 = 
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
);

3387 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_LQ_SS_PARAMS
) &&

3388 
	`rs_°bc_Ælow
(
mvm
, 
°a
, 
lq_°a
))

3389 
øã
.
°bc
 = 
åue
;

3391 i‡(
	`is_siso
(&
øã
)) {

3392 
num_øãs
 = 
IWL_MVM_RS_INITIAL_SISO_NUM_RATES
;

3393 
num_ªåõs
 = 
IWL_MVM_RS_HT_VHT_RETRIES_PER_RATE
;

3394 } i‡(
	`is_mimo
(&
øã
)) {

3395 
num_øãs
 = 
IWL_MVM_RS_INITIAL_MIMO_NUM_RATES
;

3396 
num_ªåõs
 = 
IWL_MVM_RS_HT_VHT_RETRIES_PER_RATE
;

3398 
num_øãs
 = 
IWL_MVM_RS_INITIAL_LEGACY_NUM_RATES
;

3399 
num_ªåõs
 = 
IWL_MVM_RS_INITIAL_LEGACY_RETRIES
;

3400 
toggÀ_™t
 = 
åue
;

3403 
	`rs_fûl_øãs_f‹_cﬁumn
(
mvm
, 
lq_°a
, &
øã
, 
lq_cmd
->
rs_èbÀ
, &
ödex
,

3404 
num_øãs
, 
num_ªåõs
, 
vÆid_tx_™t
,

3405 
toggÀ_™t
);

3407 
	`rs_gë_lowî_øã_down_cﬁumn
(
lq_°a
, &
øã
);

3409 i‡(
	`is_siso
(&
øã
)) {

3410 
num_øãs
 = 
IWL_MVM_RS_SECONDARY_SISO_NUM_RATES
;

3411 
num_ªåõs
 = 
IWL_MVM_RS_SECONDARY_SISO_RETRIES
;

3412 
lq_cmd
->
mimo_dñim
 = 
ödex
;

3413 } i‡(
	`is_Àgacy
(&
øã
)) {

3414 
num_øãs
 = 
IWL_MVM_RS_SECONDARY_LEGACY_NUM_RATES
;

3415 
num_ªåõs
 = 
IWL_MVM_RS_SECONDARY_LEGACY_RETRIES
;

3417 
	`WARN_ON_ONCE
(1);

3420 
toggÀ_™t
 = 
åue
;

3422 
	`rs_fûl_øãs_f‹_cﬁumn
(
mvm
, 
lq_°a
, &
øã
, 
lq_cmd
->
rs_èbÀ
, &
ödex
,

3423 
num_øãs
, 
num_ªåõs
, 
vÆid_tx_™t
,

3424 
toggÀ_™t
);

3426 
	`rs_gë_lowî_øã_down_cﬁumn
(
lq_°a
, &
øã
);

3428 
num_øãs
 = 
IWL_MVM_RS_SECONDARY_LEGACY_NUM_RATES
;

3429 
num_ªåõs
 = 
IWL_MVM_RS_SECONDARY_LEGACY_RETRIES
;

3431 
	`rs_fûl_øãs_f‹_cﬁumn
(
mvm
, 
lq_°a
, &
øã
, 
lq_cmd
->
rs_èbÀ
, &
ödex
,

3432 
num_øãs
, 
num_ªåõs
, 
vÆid_tx_™t
,

3433 
toggÀ_™t
);

3436 
cﬁ‹
 = 
	`LQ_FLAGS_COLOR_INC
(
	`LQ_FLAG_COLOR_GET
(
lq_cmd
->
Êags
));

3437 
lq_cmd
->
Êags
 = 
	`LQ_FLAG_COLOR_SET
÷q_cmd->Êags, 
cﬁ‹
);

3438 
	}
}

3440 
	srs_b„r_a˘ive_ôî_d©a
 {

3441 
õì80211_°a
 *
	mex˛ude_°a
;

3442 
iwl_mvm_°a
 *
	mb„r_mvm°a
;

3445 
	$rs_b„r_a˘ive_ôî
(*
_d©a
,

3446 
õì80211_°a
 *
°a
)

3448 
rs_b„r_a˘ive_ôî_d©a
 *
d©a
 = 
_d©a
;

3449 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3450 
iwl_lq_cmd
 *
lq_cmd
 = &
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
lq
;

3451 
u32
 
ss_∑øms
 = 
	`À32_to_˝u
(
lq_cmd
->ss_params);

3453 i‡(
°a
 =
d©a
->
ex˛ude_°a
)

3457 i‡(
ss_∑øms
 & 
LQ_SS_BFER_ALLOWED
) {

3458 
	`WARN_ON_ONCE
(
d©a
->
b„r_mvm°a
 !
NULL
);

3460 
d©a
->
b„r_mvm°a
 = 
mvm°a
;

3462 
	}
}

3464 
	$rs_b„r_¥i‹ôy
(
iwl_mvm_°a
 *
°a
)

3466 
¥io
 = -1;

3467 
∆80211_i·y≥
 
vi·y≥
 = 
	`õì80211_vif_ty≥_p2p
(
°a
->
vif
);

3469 
vi·y≥
) {

3470 
NL80211_IFTYPE_AP
:

3471 
NL80211_IFTYPE_P2P_GO
:

3472 
¥io
 = 3;

3474 
NL80211_IFTYPE_P2P_CLIENT
:

3475 
¥io
 = 2;

3477 
NL80211_IFTYPE_STATION
:

3478 
¥io
 = 1;

3481 
	`WARN_ONCE
(
åue
, "vi·y≥ %d sè_id %d", 
vi·y≥
,

3482 
°a
->
deÊök
.
°a_id
);

3483 
¥io
 = -1;

3486  
¥io
;

3487 
	}
}

3490 
	$rs_b„r_¥i‹ôy_cmp
(
iwl_mvm_°a
 *
°a1
,

3491 
iwl_mvm_°a
 *
°a2
)

3493 
¥io1
 = 
	`rs_b„r_¥i‹ôy
(
°a1
);

3494 
¥io2
 = 
	`rs_b„r_¥i‹ôy
(
°a2
);

3496 i‡(
¥io1
 > 
¥io2
)

3498 i‡(
¥io1
 < 
¥io2
)

3501 
	}
}

3503 
	$rs_£t_lq_ss_∑øms
(
iwl_mvm
 *
mvm
,

3504 
õì80211_°a
 *
°a
,

3505 
iwl_lq_°a
 *
lq_°a
,

3506 c⁄° 
rs_øã
 *
öôül_øã
)

3508 
iwl_lq_cmd
 *
lq_cmd
 = &
lq_°a
->
lq
;

3509 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3510 
rs_b„r_a˘ive_ôî_d©a
 
d©a
 = {

3511 .
ex˛ude_°a
 = 
°a
,

3512 .
b„r_mvm°a
 = 
NULL
,

3514 
iwl_mvm_°a
 *
b„r_mvm°a
 = 
NULL
;

3515 
u32
 
ss_∑øms
 = 
LQ_SS_PARAMS_VALID
;

3517 i‡(!
	`iwl_mvm_bt_c€x_is_mimo_Ælowed
(
mvm
, 
°a
))

3518 
out
;

3520 #ifde‡
CONFIG_MAC80211_DEBUGFS


3524 i‡(
lq_°a
->
≥rs
.
ss_f‹˚
 =
RS_SS_FORCE_STBC
)

3525 
ss_∑øms
 |(
LQ_SS_STBC_1SS_ALLOWED
 | 
LQ_SS_FORCE
);

3526 i‡(
lq_°a
->
≥rs
.
ss_f‹˚
 =
RS_SS_FORCE_BFER
)

3527 
ss_∑øms
 |(
LQ_SS_BFER_ALLOWED
 | 
LQ_SS_FORCE
);

3529 i‡(
lq_°a
->
≥rs
.
ss_f‹˚
 !
RS_SS_FORCE_NONE
) {

3530 
	`IWL_DEBUG_RATE
(
mvm
, "Forcing single stream Tx decision %d\n",

3531 
lq_°a
->
≥rs
.
ss_f‹˚
);

3532 
out
;

3536 i‡(
lq_°a
->
°bc_ˇ∑bÀ
)

3537 
ss_∑øms
 |
LQ_SS_STBC_1SS_ALLOWED
;

3539 i‡(!
lq_°a
->
b„r_ˇ∑bÀ
)

3540 
out
;

3542 
	`õì80211_ôî©e_°©i⁄s_©omic
(
mvm
->
hw
,

3543 
rs_b„r_a˘ive_ôî
,

3544 &
d©a
);

3545 
b„r_mvm°a
 = 
d©a
.bfer_mvmsta;

3551 i‡(!
b„r_mvm°a
) {

3552 
	`IWL_DEBUG_RATE
(
mvm
, "No sta with BFERállowed found. Allow\n");

3554 
ss_∑øms
 |
LQ_SS_BFER_ALLOWED
;

3555 
out
;

3558 
	`IWL_DEBUG_RATE
(
mvm
, "FoundÉxisting sta %d with BFERáctivated\n",

3559 
b„r_mvm°a
->
deÊök
.
°a_id
);

3562 i‡(
	`rs_b„r_¥i‹ôy_cmp
(
mvm°a
, 
b„r_mvm°a
) > 0) {

3563 
iwl_lq_cmd
 *
b„r°a_lq_cmd
 =

3564 &
b„r_mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
lq
;

3565 
u32
 
b„r°a_ss_∑øms
 = 
	`À32_to_˝u
(
b„r°a_lq_cmd
->
ss_∑øms
);

3567 
b„r°a_ss_∑øms
 &~
LQ_SS_BFER_ALLOWED
;

3568 
b„r°a_lq_cmd
->
ss_∑øms
 = 
	`˝u_to_À32
(
b„r°a_ss_∑øms
);

3569 
	`iwl_mvm_£nd_lq_cmd
(
mvm
, 
b„r°a_lq_cmd
);

3571 
ss_∑øms
 |
LQ_SS_BFER_ALLOWED
;

3572 
	`IWL_DEBUG_RATE
(
mvm
,

3574 
b„r_mvm°a
->
deÊök
.
°a_id
);

3576 
out
:

3577 
lq_cmd
->
ss_∑øms
 = 
	`˝u_to_À32
(ss_params);

3578 
	}
}

3580 
	$rs_fûl_lq_cmd
(
iwl_mvm
 *
mvm
,

3581 
õì80211_°a
 *
°a
,

3582 
iwl_lq_°a
 *
lq_°a
,

3583 c⁄° 
rs_øã
 *
öôül_øã
)

3585 
iwl_lq_cmd
 *
lq_cmd
 = &
lq_°a
->
lq
;

3586 
iwl_mvm_°a
 *
mvm°a
;

3587 
iwl_mvm_vif
 *
mvmvif
;

3589 
lq_cmd
->
agg_dißbÀ_°¨t_th
 = 
IWL_MVM_RS_AGG_DISABLE_START
;

3590 
lq_cmd
->
agg_time_limô
 =

3591 
	`˝u_to_À16
(
IWL_MVM_RS_AGG_TIME_LIMIT
);

3593 #ifde‡
CONFIG_MAC80211_DEBUGFS


3594 i‡(
lq_°a
->
≥rs
.
dbg_fixed_øã
) {

3595 
	`rs_buûd_øãs_èbÀ_‰om_fixed
(
mvm
, 
lq_cmd
,

3596 
lq_°a
->
b™d
,

3597 
lq_°a
->
≥rs
.
dbg_fixed_øã
);

3601 i‡(
	`WARN_ON_ONCE
(!
°a
 || !
öôül_øã
))

3604 
	`rs_buûd_øãs_èbÀ
(
mvm
, 
°a
, 
lq_°a
, 
öôül_øã
);

3606 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_LQ_SS_PARAMS
))

3607 
	`rs_£t_lq_ss_∑øms
(
mvm
, 
°a
, 
lq_°a
, 
öôül_øã
);

3609 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3610 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

3612 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_COEX_SCHEMA_2
) &&

3613 
	`num_of_™t
(
öôül_øã
->
™t
) == 1)

3614 
lq_cmd
->
sögÀ_°ªam_™t_msk
 = 
öôül_øã
->
™t
;

3616 
lq_cmd
->
agg_‰ame_˙t_limô
 = 
lq_°a
->
≥rs
.
max_agg_bufsize
;

3623 i‡(
	`iwl_mvm_vif_low_œãncy
(
mvmvif
))

3624 
lq_cmd
->
agg_‰ame_˙t_limô
--;

3626 i‡(
mvm°a
->
vif
->
p2p
)

3627 
lq_cmd
->
Êags
 |
LQ_FLAG_USE_RTS_MSK
;

3629 
lq_cmd
->
agg_time_limô
 =

3630 
	`˝u_to_À16
(
	`iwl_mvm_c€x_agg_time_limô
(
mvm
, 
°a
));

3631 
	}
}

3633 *
	$rs_Æloc
(
õì80211_hw
 *
hw
)

3635  
hw
->
¥iv
;

3636 
	}
}

3639 
	$rs_‰ì
(*
mvm_øã
)

3642 
	}
}

3644 
	$rs_‰ì_°a
(*
mvm_r
, 
õì80211_°a
 *
°a
, *
mvm_°a
)

3646 
iwl_›_mode
 *
›_mode
 
__maybe_unu£d
 = 
mvm_r
;

3647 
iwl_mvm
 *
mvm
 
__maybe_unu£d
 = 
	`IWL_OP_MODE_GET_MVM
(
›_mode
);

3649 
	`IWL_DEBUG_RATE
(
mvm
, "enter\n");

3650 
	`IWL_DEBUG_RATE
(
mvm
, "leave\n");

3651 
	}
}

3653 
	$rs_¥ëty_¥öt_øã_v1
(*
buf
, 
bufsz
, c⁄° 
u32
 
øã
)

3656 *
ty≥
;

3657 
u8
 
mcs
 = 0, 
nss
 = 0;

3658 
u8
 
™t
 = (
øã
 & 
RATE_MCS_ANT_AB_MSK
Ë>> 
RATE_MCS_ANT_POS
;

3659 
u32
 
bw
 = (
øã
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
) >>

3660 
RATE_MCS_CHAN_WIDTH_POS
;

3662 i‡(!(
øã
 & 
RATE_MCS_HT_MSK_V1
) &&

3663 !(
øã
 & 
RATE_MCS_VHT_MSK_V1
) &&

3664 !(
øã
 & 
RATE_MCS_HE_MSK_V1
)) {

3665 
ödex
 = 
	`iwl_hwøã_to_∂˝_idx
(
øã
);

3667  
	`s˙¥ötf
(
buf
, 
bufsz
, "Legacy | ANT: %s Rate: %s Mbps",

3668 
	`iwl_rs_¥ëty_™t
(
™t
),

3669 
ödex
 =
IWL_RATE_INVALID
 ? "BAD" :

3670 
	`iwl_øã_mcs
(
ödex
)->
mbps
);

3673 i‡(
øã
 & 
RATE_MCS_VHT_MSK_V1
) {

3674 
ty≥
 = "VHT";

3675 
mcs
 = 
øã
 & 
RATE_VHT_MCS_RATE_CODE_MSK
;

3676 
nss
 = 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã
) + 1;

3677 } i‡(
øã
 & 
RATE_MCS_HT_MSK_V1
) {

3678 
ty≥
 = "HT";

3679 
mcs
 = 
øã
 & 
RATE_HT_MCS_INDEX_MSK_V1
;

3680 
nss
 = ((
øã
 & 
RATE_HT_MCS_NSS_MSK_V1
)

3681 >> 
RATE_HT_MCS_NSS_POS_V1
) + 1;

3682 } i‡(
øã
 & 
RATE_MCS_HE_MSK_V1
) {

3683 
ty≥
 = "HE";

3684 
mcs
 = 
øã
 & 
RATE_VHT_MCS_RATE_CODE_MSK
;

3685 
nss
 = 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã
) + 1;

3687 
ty≥
 = "Unknown";

3690  
	`s˙¥ötf
(
buf
, 
bufsz
,

3692 
øã
, 
ty≥
, 
	`iwl_rs_¥ëty_™t
(
™t
), 
	`iwl_rs_¥ëty_bw
(
bw
), 
mcs
, 
nss
,

3693 (
øã
 & 
RATE_MCS_SGI_MSK_V1
) ? "SGI " : "NGI ",

3694 (
øã
 & 
RATE_MCS_STBC_MSK
) ? "STBC " : "",

3695 (
øã
 & 
RATE_MCS_LDPC_MSK_V1
) ? "LDPC " : "",

3696 (
øã
 & 
RATE_HE_DUAL_CARRIER_MODE_MSK
) ? "DCM " : "",

3697 (
øã
 & 
RATE_MCS_BF_MSK
) ? "BF " : "");

3698 
	}
}

3700 #ifde‡
CONFIG_MAC80211_DEBUGFS


3707 
	$rs_¥ogøm_fix_øã
(
iwl_mvm
 *
mvm
,

3708 
iwl_lq_°a
 *
lq_°a
)

3710 
lq_°a
->
a˘ive_Àgacy_øã
 = 0x0FFF;

3711 
lq_°a
->
a˘ive_siso_øã
 = 0x1FD0;

3712 
lq_°a
->
a˘ive_mimo2_øã
 = 0x1FD0;

3714 
	`IWL_DEBUG_RATE
(
mvm
, "sta_id %dÑate 0x%X\n",

3715 
lq_°a
->
lq
.
°a_id
,Üq_°a->
≥rs
.
dbg_fixed_øã
);

3717 i‡(
lq_°a
->
≥rs
.
dbg_fixed_øã
) {

3718 
	`rs_fûl_lq_cmd
(
mvm
, 
NULL
, 
lq_°a
, NULL);

3719 
	`iwl_mvm_£nd_lq_cmd
(
lq_°a
->
≥rs
.
drv
, &lq_°a->
lq
);

3721 
	}
}

3723 
ssize_t
 
	$rs_°a_dbgfs_sˇÀ_èbÀ_wrôe
(
fûe
 *file,

3724 c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3726 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3727 
iwl_mvm
 *
mvm
;

3728 
buf
[64];

3729 
size_t
 
buf_size
;

3730 
u32
 
∑r£d_øã
;

3732 
mvm
 = 
lq_°a
->
≥rs
.
drv
;

3733 
	`mem£t
(
buf
, 0, (buf));

3734 
buf_size
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3735 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

3736  -
EFAULT
;

3738 i‡(
	`ssˇnf
(
buf
, "%x", &
∑r£d_øã
) == 1)

3739 
lq_°a
->
≥rs
.
dbg_fixed_øã
 = 
∑r£d_øã
;

3741 
lq_°a
->
≥rs
.
dbg_fixed_øã
 = 0;

3743 
	`rs_¥ogøm_fix_øã
(
mvm
, 
lq_°a
);

3745  
cou¡
;

3746 
	}
}

3748 
ssize_t
 
	$rs_°a_dbgfs_sˇÀ_èbÀ_ªad
(
fûe
 *file,

3749 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3751 *
buff
;

3752 
desc
 = 0;

3753 
i
 = 0;

3754 
ssize_t
 
ªt
;

3755 c⁄° 
size_t
 
bufsz
 = 2048;

3757 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3758 
iwl_mvm_°a
 *
mvm°a
 =

3759 
	`c⁄èöî_of
(
lq_°a
, 
iwl_mvm_°a
, 
deÊök
.lq_°a.
rs_drv
);

3760 
iwl_mvm
 *
mvm
;

3761 
iwl_sˇÀ_tbl_öfo
 *
tbl
 = &(
lq_°a
->
lq_öfo
[lq_°a->
a˘ive_tbl
]);

3762 
rs_øã
 *
øã
 = &
tbl
->rate;

3763 
u32
 
ss_∑øms
;

3765 
mvm
 = 
lq_°a
->
≥rs
.
drv
;

3766 
buff
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

3767 i‡(!
buff
)

3768  -
ENOMEM
;

3770 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3771 "°a_id %d\n", 
lq_°a
->
lq
.
°a_id
);

3772 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3774 
lq_°a
->
tŸÆ_Áûed
,Üq_°a->
tŸÆ_suc˚ss
,

3775 
lq_°a
->
a˘ive_Àgacy_øã
);

3776 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, "fixedÑate 0x%X\n",

3777 
lq_°a
->
≥rs
.
dbg_fixed_øã
);

3778 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, "valid_tx_ant %s%s\n",

3779 (
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
Ë& 
ANT_A
) ? "ANT_A," : "",

3780 (
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
Ë& 
ANT_B
) ? "ANT_B," : "");

3781 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, "lqÅype %s\n",

3782 (
	`is_Àgacy
(
øã
)) ? "legacy" :

3783 
	`is_vht
(
øã
) ? "VHT" : "HT");

3784 i‡(!
	`is_Àgacy
(
øã
)) {

3785 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, " %s",

3786 (
	`is_siso
(
øã
)) ? "SISO" : "MIMO2");

3787 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, " %s",

3788 (
	`is_ht20
(
øã
)) ? "20MHz" :

3789 (
	`is_ht40
(
øã
)) ? "40MHz" :

3790 (
	`is_ht80
(
øã
)) ? "80MHz" :

3791 (
	`is_ht160
(
øã
)) ? "160MHz" : "BAD BW");

3792 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, " %s %s %s %s\n",

3793 (
øã
->
sgi
) ? "SGI" : "NGI",

3794 (
øã
->
ldpc
) ? "LDPC" : "BCC",

3795 (
lq_°a
->
is_agg
) ? "AGG on" : "",

3796 (
mvm°a
->
amsdu_íabÀd
) ? "AMSDU on" : "");

3798 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, "lastÅxÑate=0x%X\n",

3799 
lq_°a
->
œ°_øã_n_Êags
);

3800 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3802 
lq_°a
->
lq
.
Êags
,

3803 
lq_°a
->
lq
.
mimo_dñim
,

3804 
lq_°a
->
lq
.
sögÀ_°ªam_™t_msk
,

3805 
lq_°a
->
lq
.
duÆ_°ªam_™t_msk
);

3807 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3809 
	`À16_to_˝u
(
lq_°a
->
lq
.
agg_time_limô
),

3810 
lq_°a
->
lq
.
agg_dißbÀ_°¨t_th
,

3811 
lq_°a
->
lq
.
agg_‰ame_˙t_limô
);

3813 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc, "reducedÅpc=%d\n",

3814 
lq_°a
->
lq
.
ªdu˚d_çc
);

3815 
ss_∑øms
 = 
	`À32_to_˝u
(
lq_°a
->
lq
.ss_params);

3816 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3818 (
ss_∑øms
 & 
LQ_SS_PARAMS_VALID
) ?

3820 (
ss_∑øms
 & 
LQ_SS_BFER_ALLOWED
) ?

3822 (
ss_∑øms
 & 
LQ_SS_STBC_1SS_ALLOWED
) ?

3824 (
ss_∑øms
 & 
LQ_SS_FORCE
) ?

3826 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3828 
lq_°a
->
lq
.
öôül_øã_ödex
[0],

3829 
lq_°a
->
lq
.
öôül_øã_ödex
[1],

3830 
lq_°a
->
lq
.
öôül_øã_ödex
[2],

3831 
lq_°a
->
lq
.
öôül_øã_ödex
[3]);

3833 
i
 = 0; i < 
LINK_QUAL_MAX_RETRY_NUM
; i++) {

3834 
u32
 
r
 = 
	`À32_to_˝u
(
lq_°a
->
lq
.
rs_èbÀ
[
i
]);

3836 
desc
 +
	`s˙¥ötf
(
buff
 + desc, 
bufsz
 - desc,

3837 "Ñ©e[%d] 0x%X ", 
i
, 
r
);

3838 
desc
 +
	`rs_¥ëty_¥öt_øã_v1
(
buff
 + desc, 
bufsz
 - desc, 
r
);

3839 i‡(
desc
 < 
bufsz
 - 1)

3840 
buff
[
desc
++] = '\n';

3843 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
desc
);

3844 
	`k‰ì
(
buff
);

3845  
ªt
;

3846 
	}
}

3848 c⁄° 
fûe_›î©i⁄s
 
	grs_°a_dbgfs_sˇÀ_èbÀ_›s
 = {

3849 .
wrôe
 = 
rs_°a_dbgfs_sˇÀ_èbÀ_wrôe
,

3850 .
	gªad
 = 
rs_°a_dbgfs_sˇÀ_èbÀ_ªad
,

3851 .
	g›í
 = 
sim∂e_›í
,

3852 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3854 
ssize_t
 
	$rs_°a_dbgfs_°©s_èbÀ_ªad
(
fûe
 *file,

3855 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3857 *
buff
;

3858 
desc
 = 0;

3859 
i
, 
j
;

3860 
ssize_t
 
ªt
;

3861 
iwl_sˇÀ_tbl_öfo
 *
tbl
;

3862 
rs_øã
 *
øã
;

3863 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3865 
buff
 = 
	`kmÆloc
(1024, 
GFP_KERNEL
);

3866 i‡(!
buff
)

3867  -
ENOMEM
;

3869 
i
 = 0; i < 
LQ_SIZE
; i++) {

3870 
tbl
 = &(
lq_°a
->
lq_öfo
[
i
]);

3871 
øã
 = &
tbl
->rate;

3872 
desc
 +
	`•rötf
(
buff
+desc,

3875 
lq_°a
->
a˘ive_tbl
 =
i
 ? "*" : "x",

3876 
øã
->
ty≥
,

3877 
øã
->
sgi
,

3878 
	`is_ht20
(
øã
) ? "20MHz" :

3879 
	`is_ht40
(
øã
) ? "40MHz" :

3880 
	`is_ht80
(
øã
) ? "80MHz" :

3881 
	`is_ht160
(
øã
) ? "160MHz" : "ERR",

3882 
øã
->
ödex
);

3883 
j
 = 0; j < 
IWL_RATE_COUNT
; j++) {

3884 
desc
 +
	`•rötf
(
buff
+desc,

3886 
tbl
->
wö
[
j
].
cou¡î
,

3887 
tbl
->
wö
[
j
].
suc˚ss_cou¡î
,

3888 
tbl
->
wö
[
j
].
suc˚ss_øtio
);

3891 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
desc
);

3892 
	`k‰ì
(
buff
);

3893  
ªt
;

3894 
	}
}

3896 c⁄° 
fûe_›î©i⁄s
 
	grs_°a_dbgfs_°©s_èbÀ_›s
 = {

3897 .
ªad
 = 
rs_°a_dbgfs_°©s_èbÀ_ªad
,

3898 .
	g›í
 = 
sim∂e_›í
,

3899 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3902 
ssize_t
 
	$rs_°a_dbgfs_drv_tx_°©s_ªad
(
fûe
 *file,

3903 
__u£r
 *
u£r_buf
,

3904 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3906 c⁄° * c⁄° 
cﬁumn_«me
[] = {

3907 [
RS_COLUMN_LEGACY_ANT_A
] = "LEGACY_ANT_A",

3908 [
RS_COLUMN_LEGACY_ANT_B
] = "LEGACY_ANT_B",

3909 [
RS_COLUMN_SISO_ANT_A
] = "SISO_ANT_A",

3910 [
RS_COLUMN_SISO_ANT_B
] = "SISO_ANT_B",

3911 [
RS_COLUMN_SISO_ANT_A_SGI
] = "SISO_ANT_A_SGI",

3912 [
RS_COLUMN_SISO_ANT_B_SGI
] = "SISO_ANT_B_SGI",

3913 [
RS_COLUMN_MIMO2
] = "MIMO2",

3914 [
RS_COLUMN_MIMO2_SGI
] = "MIMO2_SGI",

3917 c⁄° * c⁄° 
øã_«me
[] = {

3918 [
IWL_RATE_1M_INDEX
] = "1M",

3919 [
IWL_RATE_2M_INDEX
] = "2M",

3920 [
IWL_RATE_5M_INDEX
] = "5.5M",

3921 [
IWL_RATE_11M_INDEX
] = "11M",

3922 [
IWL_RATE_6M_INDEX
] = "6M|MCS0",

3923 [
IWL_RATE_9M_INDEX
] = "9M",

3924 [
IWL_RATE_12M_INDEX
] = "12M|MCS1",

3925 [
IWL_RATE_18M_INDEX
] = "18M|MCS2",

3926 [
IWL_RATE_24M_INDEX
] = "24M|MCS3",

3927 [
IWL_RATE_36M_INDEX
] = "36M|MCS4",

3928 [
IWL_RATE_48M_INDEX
] = "48M|MCS5",

3929 [
IWL_RATE_54M_INDEX
] = "54M|MCS6",

3930 [
IWL_RATE_MCS_7_INDEX
] = "MCS7",

3931 [
IWL_RATE_MCS_8_INDEX
] = "MCS8",

3932 [
IWL_RATE_MCS_9_INDEX
] = "MCS9",

3933 [
IWL_RATE_MCS_10_INDEX
] = "MCS10",

3934 [
IWL_RATE_MCS_11_INDEX
] = "MCS11",

3937 *
buff
, *
pos
, *
ídpos
;

3938 
cﬁ
, 
øã
;

3939 
ssize_t
 
ªt
;

3940 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3941 
rs_øã_°©s
 *
°©s
;

3942 c⁄° 
size_t
 
bufsz
 = 1024;

3944 
buff
 = 
	`kmÆloc
(
bufsz
, 
GFP_KERNEL
);

3945 i‡(!
buff
)

3946  -
ENOMEM
;

3948 
pos
 = 
buff
;

3949 
ídpos
 = 
pos
 + 
bufsz
;

3951 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "COLUMN,");

3952 
øã
 = 0;Ñ©ê< 
IWL_RATE_COUNT
;Ñate++)

3953 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "%s,", 
øã_«me
[
øã
]);

3954 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "\n");

3956 
cﬁ
 = 0; cﬁ < 
RS_COLUMN_COUNT
; col++) {

3957 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

3958 "%s,", 
cﬁumn_«me
[
cﬁ
]);

3960 
øã
 = 0;Ñ©ê< 
IWL_RATE_COUNT
;Ñate++) {

3961 
°©s
 = &(
lq_°a
->
≥rs
.
tx_°©s
[
cﬁ
][
øã
]);

3962 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos,

3964 
°©s
->
suc˚ss
,

3965 
°©s
->
tŸÆ
);

3967 
pos
 +
	`s˙¥ötf
’os, 
ídpos
 -Öos, "\n");

3970 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buff
, 
pos
 - buff);

3971 
	`k‰ì
(
buff
);

3972  
ªt
;

3973 
	}
}

3975 
ssize_t
 
	$rs_°a_dbgfs_drv_tx_°©s_wrôe
(
fûe
 *file,

3976 c⁄° 
__u£r
 *
u£r_buf
,

3977 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3979 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3980 
	`mem£t
(
lq_°a
->
≥rs
.
tx_°©s
, 0, (lq_sta->pers.tx_stats));

3982  
cou¡
;

3983 
	}
}

3985 c⁄° 
fûe_›î©i⁄s
 
	grs_°a_dbgfs_drv_tx_°©s_›s
 = {

3986 .
ªad
 = 
rs_°a_dbgfs_drv_tx_°©s_ªad
,

3987 .
	gwrôe
 = 
rs_°a_dbgfs_drv_tx_°©s_wrôe
,

3988 .
	g›í
 = 
sim∂e_›í
,

3989 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3992 
ssize_t
 
	$iwl_dbgfs_ss_f‹˚_ªad
(
fûe
 *file,

3993 
__u£r
 *
u£r_buf
,

3994 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3996 
iwl_lq_°a
 *
lq_°a
 = 
fûe
->
¥iv©e_d©a
;

3997 
buf
[12];

3998 
bufsz
 = (
buf
);

3999 
pos
 = 0;

4000 c⁄° * c⁄° 
ss_f‹˚_«me
[] = {

4001 [
RS_SS_FORCE_NONE
] = "none",

4002 [
RS_SS_FORCE_STBC
] = "stbc",

4003 [
RS_SS_FORCE_BFER
] = "bfer",

4004 [
RS_SS_FORCE_SISO
] = "siso",

4007 
pos
 +
	`s˙¥ötf
(
buf
+pos, 
bufsz
-pos, "%s\n",

4008 
ss_f‹˚_«me
[
lq_°a
->
≥rs
.
ss_f‹˚
]);

4009  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

4010 
	}
}

4012 
ssize_t
 
	$iwl_dbgfs_ss_f‹˚_wrôe
(
iwl_lq_°a
 *
lq_°a
, *
buf
,

4013 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4015 
iwl_mvm
 *
mvm
 = 
lq_°a
->
≥rs
.
drv
;

4016 
ªt
 = 0;

4018 i‡(!
	`°∫cmp
("n⁄e", 
buf
, 4)) {

4019 
lq_°a
->
≥rs
.
ss_f‹˚
 = 
RS_SS_FORCE_NONE
;

4020 } i‡(!
	`°∫cmp
("siso", 
buf
, 4)) {

4021 
lq_°a
->
≥rs
.
ss_f‹˚
 = 
RS_SS_FORCE_SISO
;

4022 } i‡(!
	`°∫cmp
("°bc", 
buf
, 4)) {

4023 i‡(
lq_°a
->
°bc_ˇ∑bÀ
) {

4024 
lq_°a
->
≥rs
.
ss_f‹˚
 = 
RS_SS_FORCE_STBC
;

4026 
	`IWL_ERR
(
mvm
,

4028 
ªt
 = -
EINVAL
;

4030 } i‡(!
	`°∫cmp
("b„r", 
buf
, 4)) {

4031 i‡(
lq_°a
->
b„r_ˇ∑bÀ
) {

4032 
lq_°a
->
≥rs
.
ss_f‹˚
 = 
RS_SS_FORCE_BFER
;

4034 
	`IWL_ERR
(
mvm
,

4036 
ªt
 = -
EINVAL
;

4039 
	`IWL_ERR
(
mvm
, "valid valuesÇone|siso|stbc|bfer\n");

4040 
ªt
 = -
EINVAL
;

4042  
ªt
 ?: 
cou¡
;

4043 
	}
}

4045 
	#MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
) \

4046 
	`_MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
«me
, 
bufsz
, 
iwl_lq_°a
)

	)

4047 
	#MVM_DEBUGFS_ADD_FILE_RS
(
«me
, 
∑ª¡
, 
mode
) do { \

4048 
	`debugfs_¸óã_fûe
(#«me, 
mode
, 
∑ª¡
, 
lq_°a
, \

4049 &
iwl_dbgfs_
##
«me
##
_›s
); \

4050 } 0)

	)

4052 
MVM_DEBUGFS_READ_WRITE_FILE_OPS
(
ss_f‹˚
, 32);

4054 
	$rs_drv_add_°a_debugfs
(*
mvm
, *
¥iv_°a
,

4055 
díåy
 *
dú
)

4057 
iwl_lq_°a
 *
lq_°a
 = 
¥iv_°a
;

4058 
iwl_mvm_°a
 *
mvm°a
;

4060 
mvm°a
 = 
	`c⁄èöî_of
(
lq_°a
, 
iwl_mvm_°a
,

4061 
deÊök
.
lq_°a
.
rs_drv
);

4063 i‡(!
mvm°a
->
vif
)

4066 
	`debugfs_¸óã_fûe
("øã_sˇÀ_èbÀ", 0600, 
dú
,

4067 
lq_°a
, &
rs_°a_dbgfs_sˇÀ_èbÀ_›s
);

4068 
	`debugfs_¸óã_fûe
("øã_°©s_èbÀ", 0400, 
dú
,

4069 
lq_°a
, &
rs_°a_dbgfs_°©s_èbÀ_›s
);

4070 
	`debugfs_¸óã_fûe
("drv_tx_°©s", 0600, 
dú
,

4071 
lq_°a
, &
rs_°a_dbgfs_drv_tx_°©s_›s
);

4072 
	`debugfs_¸óã_u8
("tx_agg_tid_íabÀ", 0600, 
dú
,

4073 &
lq_°a
->
tx_agg_tid_í
);

4074 
	`debugfs_¸óã_u8
("ªdu˚d_çc", 0600, 
dú
,

4075 &
lq_°a
->
≥rs
.
dbg_fixed_txp_ªdu˘i⁄
);

4077 
	`MVM_DEBUGFS_ADD_FILE_RS
(
ss_f‹˚
, 
dú
, 0600);

4078 
	}
}

4086 
	$rs_øã_öô_›s
(*
mvm_r
,

4087 
õì80211_suµ‹ãd_b™d
 *
sb™d
,

4088 
cfg80211_ch™_def
 *
ch™def
,

4089 
õì80211_°a
 *
°a
, *
mvm_°a
)

4091 
	}
}

4094 c⁄° 
øã_c⁄åﬁ_›s
 
	grs_mvm_›s_drv
 = {

4095 .
«me
 = 
RS_NAME
,

4096 .
	gtx_°©us
 = 
rs_drv_mac80211_tx_°©us
,

4097 .
	ggë_øã
 = 
rs_drv_gë_øã
,

4098 .
	gøã_öô
 = 
rs_øã_öô_›s
,

4099 .
	gÆloc
 = 
rs_Æloc
,

4100 .
	g‰ì
 = 
rs_‰ì
,

4101 .
	gÆloc_°a
 = 
rs_drv_Æloc_°a
,

4102 .
	g‰ì_°a
 = 
rs_‰ì_°a
,

4103 .
	gøã_upd©e
 = 
rs_drv_øã_upd©e
,

4104 #ifde‡
CONFIG_MAC80211_DEBUGFS


4105 .
	gadd_°a_debugfs
 = 
rs_drv_add_°a_debugfs
,

4107 .
	gˇ∑
 = 
RATE_CTRL_CAPA_VHT_EXT_NSS_BW
,

4110 
	$iwl_mvm_rs_øã_öô
(
iwl_mvm
 *
mvm
,

4111 
õì80211_vif
 *
vif
,

4112 
õì80211_°a
 *
°a
,

4113 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

4114 
õì80211_lök_°a
 *
lök_°a
,

4115 
∆80211_b™d
 
b™d
)

4117 i‡(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)) {

4118 
	`iwl_mvm_rs_fw_øã_öô
(
mvm
, 
vif
, 
°a
, 
lök_c⁄f
,

4119 
lök_°a
, 
b™d
);

4121 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4123 
	`•ö_lock_bh
(&
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
lock
);

4124 
	`rs_drv_øã_öô
(
mvm
, 
°a
, 
b™d
);

4125 
	`•ö_u∆ock_bh
(&
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
lock
);

4127 
	}
}

4129 
	$iwl_mvm_øã_c⁄åﬁ_ªgi°î
()

4131  
	`õì80211_øã_c⁄åﬁ_ªgi°î
(&
rs_mvm_›s_drv
);

4132 
	}
}

4134 
	$iwl_mvm_øã_c⁄åﬁ_uƒegi°î
()

4136 
	`õì80211_øã_c⁄åﬁ_uƒegi°î
(&
rs_mvm_›s_drv
);

4137 
	}
}

4139 
	$rs_drv_tx_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

4140 
boﬁ
 
íabÀ
)

4142 
iwl_lq_cmd
 *
lq
 = &
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.lq;

4144 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

4146 i‡(
íabÀ
) {

4147 i‡(
mvm°a
->
tx_¥Ÿe˘i⁄
 == 0)

4148 
lq
->
Êags
 |
LQ_FLAG_USE_RTS_MSK
;

4149 
mvm°a
->
tx_¥Ÿe˘i⁄
++;

4151 
mvm°a
->
tx_¥Ÿe˘i⁄
--;

4152 i‡(
mvm°a
->
tx_¥Ÿe˘i⁄
 == 0)

4153 
lq
->
Êags
 &~
LQ_FLAG_USE_RTS_MSK
;

4156  
	`iwl_mvm_£nd_lq_cmd
(
mvm
, 
lq
);

4157 
	}
}

4167 
	$iwl_mvm_tx_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

4168 
boﬁ
 
íabÀ
)

4170 i‡(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
))

4171  
	`rs_fw_tx_¥Ÿe˘i⁄
(
mvm
, 
mvm°a
, 
íabÀ
);

4173  
	`rs_drv_tx_¥Ÿe˘i⁄
(
mvm
, 
mvm°a
, 
íabÀ
);

4174 
	}
}

	@mvm/rs.h

9 #i‚de‡
__rs_h__


10 
	#__rs_h__


	)

12 
	~<√t/mac80211.h
>

14 
	~"iwl-c⁄fig.h
"

16 
	~"fw-≠i.h
"

17 
	~"iwl-å™s.h
"

19 
	#RS_NAME
 "iwl-mvm-rs"

	)

21 
	siwl_rs_øã_öfo
 {

22 
u8
 
	m∂˝
;

23 
u8
 
	m∂˝_ht_siso
;

24 
u8
 
	m∂˝_ht_mimo2
;

25 
u8
 
	m∂˝_vht_siso
;

26 
u8
 
	m∂˝_vht_mimo2
;

27 
u8
 
	m¥ev_rs
;

28 
u8
 
	m√xt_rs
;

31 
	#IWL_RATE_60M_PLCP
 3

	)

33 
	#LINK_QUAL_MAX_RETRY_NUM
 16

	)

36 
	mIWL_RATE_6M_INDEX_TABLE
 = 0,

37 
	mIWL_RATE_9M_INDEX_TABLE
,

38 
	mIWL_RATE_12M_INDEX_TABLE
,

39 
	mIWL_RATE_18M_INDEX_TABLE
,

40 
	mIWL_RATE_24M_INDEX_TABLE
,

41 
	mIWL_RATE_36M_INDEX_TABLE
,

42 
	mIWL_RATE_48M_INDEX_TABLE
,

43 
	mIWL_RATE_54M_INDEX_TABLE
,

44 
	mIWL_RATE_1M_INDEX_TABLE
,

45 
	mIWL_RATE_2M_INDEX_TABLE
,

46 
	mIWL_RATE_5M_INDEX_TABLE
,

47 
	mIWL_RATE_11M_INDEX_TABLE
,

48 
	mIWL_RATE_INVM_INDEX_TABLE
 = 
IWL_RATE_INVM_INDEX
 - 1,

52 
	#IWL_RATE_6M_MASK
 (1 << 
IWL_RATE_6M_INDEX
)

	)

53 
	#IWL_RATE_9M_MASK
 (1 << 
IWL_RATE_9M_INDEX
)

	)

54 
	#IWL_RATE_12M_MASK
 (1 << 
IWL_RATE_12M_INDEX
)

	)

55 
	#IWL_RATE_18M_MASK
 (1 << 
IWL_RATE_18M_INDEX
)

	)

56 
	#IWL_RATE_24M_MASK
 (1 << 
IWL_RATE_24M_INDEX
)

	)

57 
	#IWL_RATE_36M_MASK
 (1 << 
IWL_RATE_36M_INDEX
)

	)

58 
	#IWL_RATE_48M_MASK
 (1 << 
IWL_RATE_48M_INDEX
)

	)

59 
	#IWL_RATE_54M_MASK
 (1 << 
IWL_RATE_54M_INDEX
)

	)

60 
	#IWL_RATE_60M_MASK
 (1 << 
IWL_RATE_60M_INDEX
)

	)

61 
	#IWL_RATE_1M_MASK
 (1 << 
IWL_RATE_1M_INDEX
)

	)

62 
	#IWL_RATE_2M_MASK
 (1 << 
IWL_RATE_2M_INDEX
)

	)

63 
	#IWL_RATE_5M_MASK
 (1 << 
IWL_RATE_5M_INDEX
)

	)

64 
	#IWL_RATE_11M_MASK
 (1 << 
IWL_RATE_11M_INDEX
)

	)

69 
	mIWL_RATE_HT_SISO_MCS_0_PLCP
 = 0,

70 
	mIWL_RATE_HT_SISO_MCS_1_PLCP
 = 1,

71 
	mIWL_RATE_HT_SISO_MCS_2_PLCP
 = 2,

72 
	mIWL_RATE_HT_SISO_MCS_3_PLCP
 = 3,

73 
	mIWL_RATE_HT_SISO_MCS_4_PLCP
 = 4,

74 
	mIWL_RATE_HT_SISO_MCS_5_PLCP
 = 5,

75 
	mIWL_RATE_HT_SISO_MCS_6_PLCP
 = 6,

76 
	mIWL_RATE_HT_SISO_MCS_7_PLCP
 = 7,

77 
	mIWL_RATE_HT_MIMO2_MCS_0_PLCP
 = 0x8,

78 
	mIWL_RATE_HT_MIMO2_MCS_1_PLCP
 = 0x9,

79 
	mIWL_RATE_HT_MIMO2_MCS_2_PLCP
 = 0xA,

80 
	mIWL_RATE_HT_MIMO2_MCS_3_PLCP
 = 0xB,

81 
	mIWL_RATE_HT_MIMO2_MCS_4_PLCP
 = 0xC,

82 
	mIWL_RATE_HT_MIMO2_MCS_5_PLCP
 = 0xD,

83 
	mIWL_RATE_HT_MIMO2_MCS_6_PLCP
 = 0xE,

84 
	mIWL_RATE_HT_MIMO2_MCS_7_PLCP
 = 0xF,

85 
	mIWL_RATE_VHT_SISO_MCS_0_PLCP
 = 0,

86 
	mIWL_RATE_VHT_SISO_MCS_1_PLCP
 = 1,

87 
	mIWL_RATE_VHT_SISO_MCS_2_PLCP
 = 2,

88 
	mIWL_RATE_VHT_SISO_MCS_3_PLCP
 = 3,

89 
	mIWL_RATE_VHT_SISO_MCS_4_PLCP
 = 4,

90 
	mIWL_RATE_VHT_SISO_MCS_5_PLCP
 = 5,

91 
	mIWL_RATE_VHT_SISO_MCS_6_PLCP
 = 6,

92 
	mIWL_RATE_VHT_SISO_MCS_7_PLCP
 = 7,

93 
	mIWL_RATE_VHT_SISO_MCS_8_PLCP
 = 8,

94 
	mIWL_RATE_VHT_SISO_MCS_9_PLCP
 = 9,

95 
	mIWL_RATE_VHT_MIMO2_MCS_0_PLCP
 = 0x10,

96 
	mIWL_RATE_VHT_MIMO2_MCS_1_PLCP
 = 0x11,

97 
	mIWL_RATE_VHT_MIMO2_MCS_2_PLCP
 = 0x12,

98 
	mIWL_RATE_VHT_MIMO2_MCS_3_PLCP
 = 0x13,

99 
	mIWL_RATE_VHT_MIMO2_MCS_4_PLCP
 = 0x14,

100 
	mIWL_RATE_VHT_MIMO2_MCS_5_PLCP
 = 0x15,

101 
	mIWL_RATE_VHT_MIMO2_MCS_6_PLCP
 = 0x16,

102 
	mIWL_RATE_VHT_MIMO2_MCS_7_PLCP
 = 0x17,

103 
	mIWL_RATE_VHT_MIMO2_MCS_8_PLCP
 = 0x18,

104 
	mIWL_RATE_VHT_MIMO2_MCS_9_PLCP
 = 0x19,

105 
	mIWL_RATE_HT_SISO_MCS_INV_PLCP
,

106 
	mIWL_RATE_HT_MIMO2_MCS_INV_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

107 
	mIWL_RATE_VHT_SISO_MCS_INV_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

108 
	mIWL_RATE_VHT_MIMO2_MCS_INV_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

109 
	mIWL_RATE_HT_SISO_MCS_8_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

110 
	mIWL_RATE_HT_SISO_MCS_9_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

111 
	mIWL_RATE_HT_MIMO2_MCS_8_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

112 
	mIWL_RATE_HT_MIMO2_MCS_9_PLCP
 = 
IWL_RATE_HT_SISO_MCS_INV_PLCP
,

115 
	#IWL_RATES_MASK
 ((1 << 
IWL_RATE_COUNT
Ë- 1)

	)

117 
	#IWL_INVALID_VALUE
 -1

	)

119 
	#TPC_MAX_REDUCTION
 15

	)

120 
	#TPC_NO_REDUCTION
 0

	)

121 
	#TPC_INVALID
 0xff

	)

123 
	#LINK_QUAL_AGG_FRAME_LIMIT_DEF
 (63)

	)

124 
	#LINK_QUAL_AGG_FRAME_LIMIT_MAX
 (63)

	)

130 
	#LINK_QUAL_AGG_FRAME_LIMIT_GEN2_DEF
 (255)

	)

131 
	#LINK_QUAL_AGG_FRAME_LIMIT_GEN2_MAX
 (255)

	)

132 
	#LINK_QUAL_AGG_FRAME_LIMIT_MIN
 (0)

	)

134 
	#LQ_SIZE
 2

	)

137 
	#IWL_AGG_TPT_THREHOLD
 0

	)

138 
	#IWL_AGG_ALL_TID
 0xff

	)

140 
	eiwl_èbÀ_ty≥
 {

141 
	mLQ_NONE
,

142 
	mLQ_LEGACY_G
,

143 
	mLQ_LEGACY_A
,

144 
	mLQ_HT_SISO
,

145 
	mLQ_HT_MIMO2
,

146 
	mLQ_VHT_SISO
,

147 
	mLQ_VHT_MIMO2
,

148 
	mLQ_HE_SISO
,

149 
	mLQ_HE_MIMO2
,

150 
	mLQ_MAX
,

153 
	srs_øã
 {

154 
	mödex
;

155 
iwl_èbÀ_ty≥
 
	mty≥
;

156 
u8
 
	m™t
;

157 
u32
 
	mbw
;

158 
boﬁ
 
	msgi
;

159 
boﬁ
 
	mldpc
;

160 
boﬁ
 
	m°bc
;

161 
boﬁ
 
	mb„r
;

165 
	#is_ty≥_Àgacy
(
ty≥
Ë((—y≥Ë=
LQ_LEGACY_G
) || \

166 ((
ty≥
Ë=
LQ_LEGACY_A
))

	)

167 
	#is_ty≥_ht_siso
(
ty≥
Ë(—y≥Ë=
LQ_HT_SISO
)

	)

168 
	#is_ty≥_ht_mimo2
(
ty≥
Ë(—y≥Ë=
LQ_HT_MIMO2
)

	)

169 
	#is_ty≥_vht_siso
(
ty≥
Ë(—y≥Ë=
LQ_VHT_SISO
)

	)

170 
	#is_ty≥_vht_mimo2
(
ty≥
Ë(—y≥Ë=
LQ_VHT_MIMO2
)

	)

171 
	#is_ty≥_he_siso
(
ty≥
Ë(—y≥Ë=
LQ_HE_SISO
)

	)

172 
	#is_ty≥_he_mimo2
(
ty≥
Ë(—y≥Ë=
LQ_HE_MIMO2
)

	)

173 
	#is_ty≥_siso
(
ty≥
Ë(
	`is_ty≥_ht_siso
—y≥Ë|| 
	`is_ty≥_vht_siso
(type) || \

174 
	`is_ty≥_he_siso
(
ty≥
))

	)

175 
	#is_ty≥_mimo2
(
ty≥
Ë(
	`is_ty≥_ht_mimo2
(type) || \

176 
	`is_ty≥_vht_mimo2
(
ty≥
Ë|| 
	`is_ty≥_he_mimo2
—y≥))

	)

177 
	#is_ty≥_mimo
(
ty≥
Ë(
	`is_ty≥_mimo2
—y≥))

	)

178 
	#is_ty≥_ht
(
ty≥
Ë(
	`is_ty≥_ht_siso
—y≥Ë|| 
	`is_ty≥_ht_mimo2
—y≥))

	)

179 
	#is_ty≥_vht
(
ty≥
Ë(
	`is_ty≥_vht_siso
—y≥Ë|| 
	`is_ty≥_vht_mimo2
—y≥))

	)

180 
	#is_ty≥_he
(
ty≥
Ë(
	`is_ty≥_he_siso
—y≥Ë|| 
	`is_ty≥_he_mimo2
—y≥))

	)

181 
	#is_ty≥_a_b™d
(
ty≥
Ë(—y≥Ë=
LQ_LEGACY_A
)

	)

182 
	#is_ty≥_g_b™d
(
ty≥
Ë(—y≥Ë=
LQ_LEGACY_G
)

	)

184 
	#is_Àgacy
(
øã
Ë
	`is_ty≥_Àgacy
(‘©e)->
ty≥
)

	)

185 
	#is_ht_siso
(
øã
Ë
	`is_ty≥_ht_siso
(‘©e)->
ty≥
)

	)

186 
	#is_ht_mimo2
(
øã
Ë
	`is_ty≥_ht_mimo2
(‘©e)->
ty≥
)

	)

187 
	#is_vht_siso
(
øã
Ë
	`is_ty≥_vht_siso
(‘©e)->
ty≥
)

	)

188 
	#is_vht_mimo2
(
øã
Ë
	`is_ty≥_vht_mimo2
(‘©e)->
ty≥
)

	)

189 
	#is_siso
(
øã
Ë
	`is_ty≥_siso
(‘©e)->
ty≥
)

	)

190 
	#is_mimo2
(
øã
Ë
	`is_ty≥_mimo2
(‘©e)->
ty≥
)

	)

191 
	#is_mimo
(
øã
Ë
	`is_ty≥_mimo
(‘©e)->
ty≥
)

	)

192 
	#is_ht
(
øã
Ë
	`is_ty≥_ht
(‘©e)->
ty≥
)

	)

193 
	#is_vht
(
øã
Ë
	`is_ty≥_vht
(‘©e)->
ty≥
)

	)

194 
	#is_he
(
øã
Ë
	`is_ty≥_he
(‘©e)->
ty≥
)

	)

195 
	#is_a_b™d
(
øã
Ë
	`is_ty≥_a_b™d
(‘©e)->
ty≥
)

	)

196 
	#is_g_b™d
(
øã
Ë
	`is_ty≥_g_b™d
(‘©e)->
ty≥
)

	)

198 
	#is_ht20
(
øã
Ë(‘©e)->
bw
 =
RATE_MCS_CHAN_WIDTH_20
)

	)

199 
	#is_ht40
(
øã
Ë(‘©e)->
bw
 =
RATE_MCS_CHAN_WIDTH_40
)

	)

200 
	#is_ht80
(
øã
Ë(‘©e)->
bw
 =
RATE_MCS_CHAN_WIDTH_80
)

	)

201 
	#is_ht160
(
øã
Ë(‘©e)->
bw
 =
RATE_MCS_CHAN_WIDTH_160
)

	)

212 
	siwl_lq_°a_rs_fw
 {

214 
u32
 
	mœ°_øã_n_Êags
;

217 
	slq_°a_≥rs_rs_fw
 {

218 
u32
 
	m°a_id
;

219 #ifde‡
CONFIG_MAC80211_DEBUGFS


223 
u32
 
	mdbg_fixed_øã
;

228 
u16
 
	mdbg_agg_‰ame_cou¡_lim
;

230 
u8
 
	mchaös
;

231 
s8
 
	mchaö_sig«l
[
IEEE80211_MAX_CHAINS
];

232 
s8
 
	mœ°_rssi
;

233 
iwl_mvm
 *
	mdrv
;

234 } 
	m≥rs
;

240 
	siwl_øã_sˇÀ_d©a
 {

241 
u64
 
	md©a
;

242 
s32
 
	msuc˚ss_cou¡î
;

243 
s32
 
	msuc˚ss_øtio
;

244 
s32
 
	mcou¡î
;

245 
s32
 
	mavîage_çt
;

251 
	ers_cﬁumn
 {

252 
	mRS_COLUMN_LEGACY_ANT_A
 = 0,

253 
	mRS_COLUMN_LEGACY_ANT_B
,

254 
	mRS_COLUMN_SISO_ANT_A
,

255 
	mRS_COLUMN_SISO_ANT_B
,

256 
	mRS_COLUMN_SISO_ANT_A_SGI
,

257 
	mRS_COLUMN_SISO_ANT_B_SGI
,

258 
	mRS_COLUMN_MIMO2
,

259 
	mRS_COLUMN_MIMO2_SGI
,

261 
	mRS_COLUMN_LAST
 = 
RS_COLUMN_MIMO2_SGI
,

262 
	mRS_COLUMN_COUNT
 = 
RS_COLUMN_LAST
 + 1,

263 
	mRS_COLUMN_INVALID
,

266 
	ers_ss_f‹˚_›t
 {

267 
	mRS_SS_FORCE_NONE
 = 0,

268 
	mRS_SS_FORCE_STBC
,

269 
	mRS_SS_FORCE_BFER
,

270 
	mRS_SS_FORCE_SISO
,

274 
	srs_øã_°©s
 {

275 
u64
 
	msuc˚ss
;

276 
u64
 
	mtŸÆ
;

285 
	siwl_sˇÀ_tbl_öfo
 {

286 
rs_øã
 
	møã
;

287 
rs_cﬁumn
 
	mcﬁumn
;

288 c⁄° 
u16
 *
	mex≥˘ed_çt
;

289 
iwl_øã_sˇÀ_d©a
 
	mwö
[
IWL_RATE_COUNT
];

291 
iwl_øã_sˇÀ_d©a
 
	mçc_wö
[
TPC_MAX_REDUCTION
 + 1];

295 
	mRS_STATE_SEARCH_CYCLE_STARTED
,

296 
	mRS_STATE_SEARCH_CYCLE_ENDED
,

297 
	mRS_STATE_STAY_IN_COLUMN
,

305 
	siwl_lq_°a
 {

306 
u8
 
	ma˘ive_tbl
;

307 
u8
 
	mrs_°©e
;

308 
u8
 
	m£¨ch_bëãr_tbl
;

309 
s32
 
	mœ°_çt
;

312 
u32
 
	mèbÀ_cou¡_limô
;

313 
u32
 
	mmax_Áûuª_limô
;

314 
u32
 
	mmax_suc˚ss_limô
;

315 
u32
 
	mèbÀ_cou¡
;

316 
u32
 
	mtŸÆ_Áûed
;

317 
u32
 
	mtŸÆ_suc˚ss
;

318 
u64
 
	mÊush_timî
;

320 
u32
 
	mvisôed_cﬁumns
;

323 
u64
 
	mœ°_tx
;

324 
boﬁ
 
	mis_vht
;

325 
boﬁ
 
	mldpc
;

326 
boﬁ
 
	m°bc_ˇ∑bÀ
;

327 
boﬁ
 
	mb„r_ˇ∑bÀ
;

329 
∆80211_b™d
 
	mb™d
;

332 
	ma˘ive_Àgacy_øã
;

333 
	ma˘ive_siso_øã
;

334 
	ma˘ive_mimo2_øã
;

337 
u8
 
	mmax_Àgacy_øã_idx
;

338 
u8
 
	mmax_siso_øã_idx
;

339 
u8
 
	mmax_mimo2_øã_idx
;

344 
rs_øã
 
	m›timÆ_øã
;

345 
	m›timÆ_øã_mask
;

346 c⁄° 
rs_öô_øã_öfo
 *
	m›timÆ_øãs
;

347 
	m›timÆ_√¡rõs
;

349 
u8
 
	mmis£d_øã_cou¡î
;

351 
iwl_lq_cmd
 
	mlq
;

352 
iwl_sˇÀ_tbl_öfo
 
	mlq_öfo
[
LQ_SIZE
];

353 
u8
 
	mtx_agg_tid_í
;

356 
u32
 
	mœ°_øã_n_Êags
;

359 
u8
 
	mis_agg
;

362 
	mçc_ªdu˚
;

365 
	slq_°a_≥rs
 {

366 #ifde‡
CONFIG_MAC80211_DEBUGFS


367 
u32
 
	mdbg_fixed_øã
;

368 
u8
 
	mdbg_fixed_txp_ªdu˘i⁄
;

371 
rs_ss_f‹˚_›t
 
	mss_f‹˚
;

373 
u8
 
	mchaös
;

374 
s8
 
	mchaö_sig«l
[
IEEE80211_MAX_CHAINS
];

375 
s8
 
	mœ°_rssi
;

376 
u16
 
	mmax_agg_bufsize
;

377 
rs_øã_°©s
 
	mtx_°©s
[
RS_COLUMN_COUNT
][
IWL_RATE_COUNT
];

378 
iwl_mvm
 *
	mdrv
;

379 
•ölock_t
 
	mlock
;

380 } 
	m≥rs
;

388 
	#RS_DRV_DATA_TXP_MSK
 0xff

	)

389 
	#RS_DRV_DATA_LQ_COLOR_POS
 8

	)

390 
	#RS_DRV_DATA_LQ_COLOR_MSK
 (7 << 
RS_DRV_DATA_LQ_COLOR_POS
)

	)

391 
	#RS_DRV_DATA_LQ_COLOR_GET
(
_f
Ë(((_fË& 
RS_DRV_DATA_LQ_COLOR_MSK
) >>\

392 
RS_DRV_DATA_LQ_COLOR_POS
)

	)

393 
	#RS_DRV_DATA_PACK
(
_c
, 
_p
Ë((*)(
uöçå_t
)\

394 (((
uöçå_t
)
_p
) |\

395 ((
_c
Ë<< 
RS_DRV_DATA_LQ_COLOR_POS
)))

	)

398 
iwl_mvm_rs_øã_öô
(
iwl_mvm
 *
mvm
,

399 
õì80211_vif
 *
vif
,

400 
õì80211_°a
 *
°a
,

401 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

402 
õì80211_lök_°a
 *
lök_°a
,

403 
∆80211_b™d
 
b™d
);

406 
iwl_mvm_rs_tx_°©us
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

407 
tid
, 
õì80211_tx_öfo
 *
öfo
, 
boﬁ
 
ndp
);

419 
iwl_mvm_øã_c⁄åﬁ_ªgi°î
();

427 
iwl_mvm_øã_c⁄åﬁ_uƒegi°î
();

429 
	giwl_mvm_°a
;

431 
iwl_mvm_tx_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

432 
boﬁ
 
íabÀ
);

434 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


435 
iwl_mvm_ª£t_‰ame_°©s
(
iwl_mvm
 *
mvm
);

438 
	giwl_mvm_lök_°a
;

440 
iwl_mvm_rs_add_°a
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
);

441 
iwl_mvm_rs_add_°a_lök
(
iwl_mvm
 *
mvm
,

442 
iwl_mvm_lök_°a
 *
lök_°a
);

444 
iwl_mvm_rs_fw_øã_öô
(
iwl_mvm
 *
mvm
,

445 
õì80211_vif
 *
vif
,

446 
õì80211_°a
 *
°a
,

447 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

448 
õì80211_lök_°a
 *
lök_°a
,

449 
∆80211_b™d
 
b™d
);

450 
rs_fw_tx_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

451 
boﬁ
 
íabÀ
);

452 
iwl_mvm_éc_upd©e_nŸif
(
iwl_mvm
 *
mvm
,

453 
iwl_rx_cmd_buf„r
 *
rxb
);

455 
u16
 
rs_fw_gë_max_amsdu_Àn
(
õì80211_°a
 *
°a
,

456 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

457 
õì80211_lök_°a
 *
lök_°a
);

	@mvm/rx.c

7 
	~<asm/u«lig√d.h
>

8 
	~<löux/ëhîdevi˚.h
>

9 
	~<löux/skbuff.h
>

10 
	~"iwl-å™s.h
"

11 
	~"mvm.h
"

12 
	~"fw-≠i.h
"

20 
	$iwl_mvm_rx_rx_phy_cmd
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

22 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

23 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

25 i‡(
	`u∆ikñy
(
pkt_Àn
 < (
mvm
->
œ°_phy_öfo
)))

28 
	`mem˝y
(&
mvm
->
œ°_phy_öfo
, 
pkt
->
d©a
, (mvm->last_phy_info));

29 
mvm
->
ampdu_ªf
++;

31 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


32 i‡(
mvm
->
œ°_phy_öfo
.
phy_Êags
 & 
	`˝u_to_À16
(
RX_RES_PHY_FLAGS_AGG
)) {

33 
	`•ö_lock
(&
mvm
->
drv_°©s_lock
);

34 
mvm
->
drv_rx_°©s
.
ampdu_cou¡
++;

35 
	`•ö_u∆ock
(&
mvm
->
drv_°©s_lock
);

38 
	}
}

45 
	$iwl_mvm_∑ss_∑ckë_to_mac80211
(
iwl_mvm
 *
mvm
,

46 
õì80211_°a
 *
°a
,

47 
«pi_°ru˘
 *
«pi
,

48 
sk_buff
 *
skb
,

49 
õì80211_hdr
 *
hdr
, 
u16
 
Àn
,

50 
u8
 
¸y±_Àn
,

51 
iwl_rx_cmd_buf„r
 *
rxb
)

53 
hdæí
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

54 
‰agÀn
;

66 
	`skb_ª£rve
(
skb
, 
hdæí
 & 3);

80 
hdæí
 = (
Àn
 <
	`skb_èûroom
(
skb
)Ë?Üí : hdæí + 
¸y±_Àn
 + 8;

82 
	`skb_put_d©a
(
skb
, 
hdr
, 
hdæí
);

83 
‰agÀn
 = 
Àn
 - 
hdæí
;

85 i‡(
‰agÀn
) {

86 
off£t
 = (
u8
 *)
hdr
 + 
hdæí
 -

87 (
u8
 *)
	`rxb_addr
(
rxb
Ë+ 
	`rxb_off£t
(rxb);

89 
	`skb_add_rx_‰ag
(
skb
, 0, 
	`rxb_°ól_∑ge
(
rxb
), 
off£t
,

90 
‰agÀn
, 
rxb
->
åuesize
);

93 
	`õì80211_rx_«pi
(
mvm
->
hw
, 
°a
, 
skb
, 
«pi
);

94 
	}
}

102 
	$iwl_mvm_gë_sig«l_°ªngth
(
iwl_mvm
 *
mvm
,

103 
iwl_rx_phy_öfo
 *
phy_öfo
,

104 
õì80211_rx_°©us
 *
rx_°©us
)

106 
íîgy_a
, 
íîgy_b
, 
max_íîgy
;

107 
u32
 
vÆ
;

109 
vÆ
 =

110 
	`À32_to_˝u
(
phy_öfo
->
n⁄_cfg_phy
[
IWL_RX_INFO_ENERGY_ANT_ABC_IDX
]);

111 
íîgy_a
 = (
vÆ
 & 
IWL_RX_INFO_ENERGY_ANT_A_MSK
) >>

112 
IWL_RX_INFO_ENERGY_ANT_A_POS
;

113 
íîgy_a
 =É√rgy_®? -íîgy_®: 
S8_MIN
;

114 
íîgy_b
 = (
vÆ
 & 
IWL_RX_INFO_ENERGY_ANT_B_MSK
) >>

115 
IWL_RX_INFO_ENERGY_ANT_B_POS
;

116 
íîgy_b
 =É√rgy_b ? -íîgy_b : 
S8_MIN
;

117 
max_íîgy
 = 
	`max
(
íîgy_a
, 
íîgy_b
);

119 
	`IWL_DEBUG_STATS
(
mvm
, "energy In A %d B %d ,ánd max %d\n",

120 
íîgy_a
, 
íîgy_b
, 
max_íîgy
);

122 
rx_°©us
->
sig«l
 = 
max_íîgy
;

123 
rx_°©us
->
chaös
 = (
	`À16_to_˝u
(
phy_öfo
->
phy_Êags
) &

124 
RX_RES_PHY_FLAGS_ANTENNA
)

125 >> 
RX_RES_PHY_FLAGS_ANTENNA_POS
;

126 
rx_°©us
->
chaö_sig«l
[0] = 
íîgy_a
;

127 
rx_°©us
->
chaö_sig«l
[1] = 
íîgy_b
;

128 
	}
}

139 
u32
 
	$iwl_mvm_£t_mac80211_rx_Êag
(
iwl_mvm
 *
mvm
,

140 
õì80211_hdr
 *
hdr
,

141 
õì80211_rx_°©us
 *
°©s
,

142 
u32
 
rx_pkt_°©us
,

143 
u8
 *
¸y±_Àn
)

145 i‡(!
	`õì80211_has_¥Ÿe˘ed
(
hdr
->
‰ame_c⁄åﬁ
) ||

146 (
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_SEC_ENC_MSK
) ==

147 
RX_MPDU_RES_STATUS_SEC_NO_ENC
)

151 i‡((
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_SEC_ENC_MSK
) ==

152 
RX_MPDU_RES_STATUS_SEC_ENC_ERR
)

155 
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_SEC_ENC_MSK
) {

156 
RX_MPDU_RES_STATUS_SEC_CCM_ENC
:

158 i‡(!(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_MIC_OK
))

161 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

162 *
¸y±_Àn
 = 
IEEE80211_CCMP_HDR_LEN
;

165 
RX_MPDU_RES_STATUS_SEC_TKIP_ENC
:

167 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

168 
IWL_UCODE_TLV_API_DEPRECATE_TTAK
) &&

169 !(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_TTAK_OK
))

171 *
¸y±_Àn
 = 
IEEE80211_TKIP_IV_LEN
;

172 
ÁŒthrough
;

174 
RX_MPDU_RES_STATUS_SEC_WEP_ENC
:

175 i‡(!(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_ICV_OK
))

178 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

179 i‡((
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_SEC_ENC_MSK
) ==

180 
RX_MPDU_RES_STATUS_SEC_WEP_ENC
)

181 *
¸y±_Àn
 = 
IEEE80211_WEP_IV_LEN
;

184 
RX_MPDU_RES_STATUS_SEC_EXT_ENC
:

185 i‡(!(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_MIC_OK
))

187 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

192 i‡(!
mvm
->
m⁄ô‹_⁄
)

193 
	`IWL_WARN
(
mvm
, "Unh™dÀdálg: 0x%x\n", 
rx_pkt_°©us
);

197 
	}
}

199 
	$iwl_mvm_rx_h™dÀ_tcm
(
iwl_mvm
 *
mvm
,

200 
õì80211_°a
 *
°a
,

201 
õì80211_hdr
 *
hdr
, 
u32
 
Àn
,

202 
iwl_rx_phy_öfo
 *
phy_öfo
,

203 
u32
 
øã_n_Êags
)

205 
iwl_mvm_°a
 *
mvm°a
;

206 
iwl_mvm_tcm_mac
 *
md©a
;

207 
mac
;

208 
ac
 = 
IEEE80211_AC_BE
;

209 
iwl_mvm_vif
 *
mvmvif
;

211 c⁄° 
u8
 
thªsh_çt
[] = {

214 
u16
 
thr
;

216 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
)) {

217 
u8
 
tid
 = 
	`õì80211_gë_tid
(
hdr
);

219 i‡(
tid
 < 
IWL_MAX_TID_COUNT
)

220 
ac
 = 
tid_to_mac80211_ac
[
tid
];

223 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

224 
mac
 = 
mvm°a
->
mac_id_n_cﬁ‹
 & 
FW_CTXT_ID_MSK
;

226 i‡(
	`time_a·î
(
jiffõs
, 
mvm
->
tcm
.
ts
 + 
MVM_TCM_PERIOD
))

227 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tcm
.
w‹k
, 0);

228 
md©a
 = &
mvm
->
tcm
.
d©a
[
mac
];

229 
md©a
->
rx
.
pkts
[
ac
]++;

232 i‡(
md©a
->
rx
.
œ°_ampdu_ªf
 !
mvm
->
ampdu_ªf
) {

233 
md©a
->
rx
.
œ°_ampdu_ªf
 = 
mvm
->
ampdu_ªf
;

234 
md©a
->
rx
.
aútime
 +
	`À16_to_˝u
(
phy_öfo
->
‰ame_time
);

237 i‡(!(
øã_n_Êags
 & (
RATE_MCS_HT_MSK_V1
 | 
RATE_MCS_VHT_MSK_V1
)))

240 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

242 i‡(
md©a
->
›íed_rx_ba_£ssi⁄s
 ||

243 
md©a
->
u≠sd_n⁄agg_dëe˘
.
dëe˘ed
 ||

244 (!
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_VO
].
u≠sd
 &&

245 !
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_VI
].
u≠sd
 &&

246 !
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_BE
].
u≠sd
 &&

247 !
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_BK
].
u≠sd
) ||

248 
mvm°a
->
deÊök
.
°a_id
 !
mvmvif
->deÊök.
≠_°a_id
)

251 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK_V1
) {

252 
thr
 = 
thªsh_çt
[
øã_n_Êags
 & 
RATE_HT_MCS_RATE_CODE_MSK_V1
];

253 
thr
 *1 + ((
øã_n_Êags
 & 
RATE_HT_MCS_NSS_MSK_V1
) >>

254 
RATE_HT_MCS_NSS_POS_V1
);

256 i‡(
	`WARN_ON
((
øã_n_Êags
 & 
RATE_VHT_MCS_RATE_CODE_MSK
) >=

257 
	`ARRAY_SIZE
(
thªsh_çt
)))

259 
thr
 = 
thªsh_çt
[
øã_n_Êags
 & 
RATE_VHT_MCS_RATE_CODE_MSK
];

260 
thr
 *1 + 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã_n_Êags
);

263 
thr
 <<((
øã_n_Êags
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
) >>

264 
RATE_MCS_CHAN_WIDTH_POS
);

266 
md©a
->
u≠sd_n⁄agg_dëe˘
.
rx_byãs
 +
Àn
;

267 
	`ewma_øã_add
(&
md©a
->
u≠sd_n⁄agg_dëe˘
.
øã
, 
thr
);

268 
	}
}

270 
	$iwl_mvm_rx_csum
(
õì80211_°a
 *
°a
,

271 
sk_buff
 *
skb
,

272 
u32
 
°©us
)

274 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

275 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

277 i‡(
mvmvif
->
„©uªs
 & 
NETIF_F_RXCSUM
 &&

278 
°©us
 & 
RX_MPDU_RES_STATUS_CSUM_DONE
 &&

279 
°©us
 & 
RX_MPDU_RES_STATUS_CSUM_OK
)

280 
skb
->
ù_summed
 = 
CHECKSUM_UNNECESSARY
;

281 
	}
}

288 
	$iwl_mvm_rx_rx_mpdu
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

289 
iwl_rx_cmd_buf„r
 *
rxb
)

291 
õì80211_hdr
 *
hdr
;

292 
õì80211_rx_°©us
 *
rx_°©us
;

293 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

294 
iwl_rx_phy_öfo
 *
phy_öfo
;

295 
iwl_rx_mpdu_ªs_°¨t
 *
rx_ªs
;

296 
õì80211_°a
 *
°a
 = 
NULL
;

297 
sk_buff
 *
skb
;

298 
u32
 
Àn
, 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

299 
u32
 
øã_n_Êags
;

300 
u32
 
rx_pkt_°©us
;

301 
u8
 
¸y±_Àn
 = 0;

303 i‡(
	`u∆ikñy
(
pkt_Àn
 < (*
rx_ªs
))) {

304 
	`IWL_DEBUG_DROP
(
mvm
, "Bad REPLY_RX_MPDU_CMD size\n");

308 
phy_öfo
 = &
mvm
->
œ°_phy_öfo
;

309 
rx_ªs
 = (
iwl_rx_mpdu_ªs_°¨t
 *)
pkt
->
d©a
;

310 
hdr
 = (
õì80211_hdr
 *)(
pkt
->
d©a
 + (*
rx_ªs
));

311 
Àn
 = 
	`À16_to_˝u
(
rx_ªs
->
byã_cou¡
);

313 i‡(
	`u∆ikñy
(
Àn
 + (*
rx_ªs
Ë+ (
__À32
Ë> 
pkt_Àn
)) {

314 
	`IWL_DEBUG_DROP
(
mvm
, "FWÜiedáboutÖacketÜen\n");

318 
rx_pkt_°©us
 = 
	`gë_u«lig√d_À32
((
__À32
 *)

319 (
pkt
->
d©a
 + (*
rx_ªs
Ë+ 
Àn
));

324 
skb
 = 
	`Æloc_skb
(128, 
GFP_ATOMIC
);

325 i‡(!
skb
) {

326 
	`IWL_ERR
(
mvm
, "alloc_skb failed\n");

330 
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

336 i‡(!(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_CRC_OK
) ||

337 !(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_OVERRUN_OK
)) {

338 
	`IWL_DEBUG_RX
(
mvm
, "Bad CRC o∏FIFO: 0x%08X.\n", 
rx_pkt_°©us
);

339 
rx_°©us
->
Êag
 |
RX_FLAG_FAILED_FCS_CRC
;

343 
øã_n_Êags
 = 
	`À32_to_˝u
(
phy_öfo
->rate_n_flags);

346 
rx_°©us
->
ma˘ime
 = 
	`À64_to_˝u
(
phy_öfo
->
time°amp
);

347 
rx_°©us
->
devi˚_time°amp
 = 
	`À32_to_˝u
(
phy_öfo
->
sy°em_time°amp
);

348 
rx_°©us
->
b™d
 =

349 (
phy_öfo
->
phy_Êags
 & 
	`˝u_to_À16
(
RX_RES_PHY_FLAGS_BAND_24
)) ?

350 
NL80211_BAND_2GHZ
 : 
NL80211_BAND_5GHZ
;

351 
rx_°©us
->
‰eq
 =

352 
	`õì80211_ch™√l_to_‰equícy
(
	`À16_to_˝u
(
phy_öfo
->
ch™√l
),

353 
rx_°©us
->
b™d
);

356 
rx_°©us
->
Êag
 |
RX_FLAG_MACTIME_PLCP_START
;

358 
	`iwl_mvm_gë_sig«l_°ªngth
(
mvm
, 
phy_öfo
, 
rx_°©us
);

360 
	`IWL_DEBUG_STATS_LIMIT
(
mvm
, "Rssò%d, TSF %Œu\n", 
rx_°©us
->
sig«l
,

361 ()
rx_°©us
->
ma˘ime
);

363 
	`rcu_ªad_lock
();

364 i‡(
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_SRC_STA_FOUND
) {

365 
u32
 
id
 = 
rx_pkt_°©us
 & 
RX_MPDU_RES_STATUS_STA_ID_MSK
;

367 
id
 >>
RX_MDPU_RES_STATUS_STA_ID_SHIFT
;

369 i‡(!
	`WARN_ON_ONCE
(
id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
)) {

370 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
id
]);

371 i‡(
	`IS_ERR
(
°a
))

372 
°a
 = 
NULL
;

374 } i‡(!
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr2
)) {

378 
°a
 = 
	`õì80211_föd_°a_by_iÁddr
(
mvm
->
hw
, 
hdr
->
addr2
, 
NULL
);

381 i‡(
°a
) {

382 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

383 
õì80211_vif
 *
vif
 = 
mvm°a
->vif;

384 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

390 i‡(
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
) &&

391 
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

392 !
mvmvif
->
auth‹ized
 &&

393 
	`õì80211_has_¥Ÿe˘ed
(
hdr
->
‰ame_c⁄åﬁ
)) {

394 
	`IWL_DEBUG_DROP
(
mvm
, "MCAST beforeÅhe vif isáuthorized\n");

395 
	`k‰ì_skb
(
skb
);

396 
	`rcu_ªad_u∆ock
();

404 i‡(
	`iwl_mvm_£t_mac80211_rx_Êag
(
mvm
, 
hdr
, 
rx_°©us
, 
rx_pkt_°©us
,

405 &
¸y±_Àn
)) {

406 
	`IWL_DEBUG_DROP
(
mvm
, "Bad decryptionÑesults 0x%08x\n",

407 
rx_pkt_°©us
);

408 
	`k‰ì_skb
(
skb
);

409 
	`rcu_ªad_u∆ock
();

413 i‡(
°a
) {

414 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

415 
õì80211_vif
 *
tx_blocked_vif
 =

416 
	`rcu_dîe„ªn˚
(
mvm
->
cß_tx_blocked_vif
);

417 
iwl_fw_dbg_åiggî_év
 *
åig
;

418 
õì80211_vif
 *
vif
 = 
mvm°a
->vif;

424 i‡(
	`u∆ikñy
(
tx_blocked_vif
Ë&& 
vif
 ==Åx_blocked_vif) {

425 
iwl_mvm_vif
 *
mvmvif
 =

426 
	`iwl_mvm_vif_‰om_mac80211
(
tx_blocked_vif
);

428 i‡(
mvmvif
->
cß_èrgë_‰eq
 =
rx_°©us
->
‰eq
)

429 
	`iwl_mvm_°a_modify_dißbÀ_tx_≠
(
mvm
, 
°a
,

430 
Ál£
);

433 
	`rs_upd©e_œ°_rssi
(
mvm
, 
mvm°a
, 
rx_°©us
);

435 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
,

436 
	`õì80211_vif_to_wdev
(
vif
),

437 
FW_DBG_TRIGGER_RSSI
);

439 i‡(
åig
 && 
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
)) {

440 
iwl_fw_dbg_åiggî_low_rssi
 *
rssi_åig
;

441 
s32
 
rssi
;

443 
rssi_åig
 = (*)
åig
->
d©a
;

444 
rssi
 = 
	`À32_to_˝u
(
rssi_åig
->rssi);

446 i‡(
rx_°©us
->
sig«l
 < 
rssi
)

447 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

448 
NULL
);

451 i‡(!
mvm
->
tcm
.
∑u£d
 && 
Àn
 >(*
hdr
) &&

452 !
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
) &&

453 
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

454 
	`iwl_mvm_rx_h™dÀ_tcm
(
mvm
, 
°a
, 
hdr
, 
Àn
, 
phy_öfo
,

455 
øã_n_Êags
);

457 i‡(
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

458 
	`iwl_mvm_rx_csum
(
°a
, 
skb
, 
rx_pkt_°©us
);

460 
	`rcu_ªad_u∆ock
();

463 i‡(
phy_öfo
->
phy_Êags
 & 
	`˝u_to_À16
(
RX_RES_PHY_FLAGS_SHORT_PREAMBLE
))

464 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_SHORTPRE
;

466 i‡(
phy_öfo
->
phy_Êags
 & 
	`˝u_to_À16
(
RX_RES_PHY_FLAGS_AGG
)) {

472 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_DETAILS
;

473 
rx_°©us
->
ampdu_ª„ªn˚
 = 
mvm
->
ampdu_ªf
;

477 
øã_n_Êags
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
) {

478 
RATE_MCS_CHAN_WIDTH_20
:

480 
RATE_MCS_CHAN_WIDTH_40
:

481 
rx_°©us
->
bw
 = 
RATE_INFO_BW_40
;

483 
RATE_MCS_CHAN_WIDTH_80
:

484 
rx_°©us
->
bw
 = 
RATE_INFO_BW_80
;

486 
RATE_MCS_CHAN_WIDTH_160
:

487 
rx_°©us
->
bw
 = 
RATE_INFO_BW_160
;

490 i‡(!(
øã_n_Êags
 & 
RATE_MCS_CCK_MSK_V1
) &&

491 
øã_n_Êags
 & 
RATE_MCS_SGI_MSK_V1
)

492 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_SHORT_GI
;

493 i‡(
øã_n_Êags
 & 
RATE_HT_MCS_GF_MSK
)

494 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_HT_GF
;

495 i‡(
øã_n_Êags
 & 
RATE_MCS_LDPC_MSK_V1
)

496 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_LDPC
;

497 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK_V1
) {

498 
u8
 
°bc
 = (
øã_n_Êags
 & 
RATE_MCS_STBC_MSK
) >>

499 
RATE_MCS_STBC_POS
;

500 
rx_°©us
->
ícodög
 = 
RX_ENC_HT
;

501 
rx_°©us
->
øã_idx
 = 
øã_n_Êags
 & 
RATE_HT_MCS_INDEX_MSK_V1
;

502 
rx_°©us
->
íc_Êags
 |
°bc
 << 
RX_ENC_FLAG_STBC_SHIFT
;

503 } i‡(
øã_n_Êags
 & 
RATE_MCS_VHT_MSK_V1
) {

504 
u8
 
°bc
 = (
øã_n_Êags
 & 
RATE_MCS_STBC_MSK
) >>

505 
RATE_MCS_STBC_POS
;

506 
rx_°©us
->
nss
 =

507 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã_n_Êags
) + 1;

508 
rx_°©us
->
øã_idx
 = 
øã_n_Êags
 & 
RATE_VHT_MCS_RATE_CODE_MSK
;

509 
rx_°©us
->
ícodög
 = 
RX_ENC_VHT
;

510 
rx_°©us
->
íc_Êags
 |
°bc
 << 
RX_ENC_FLAG_STBC_SHIFT
;

511 i‡(
øã_n_Êags
 & 
RATE_MCS_BF_MSK
)

512 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_BF
;

514 
øã
 = 
	`iwl_mvm_Àgacy_øã_to_mac80211_idx
(
øã_n_Êags
,

515 
rx_°©us
->
b™d
);

517 i‡(
	`WARN
(
øã
 < 0 ||Ñate > 0xFF,

519 
øã_n_Êags
, 
rx_°©us
->
b™d
)) {

520 
	`k‰ì_skb
(
skb
);

523 
rx_°©us
->
øã_idx
 = 
øã
;

526 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


527 
	`iwl_mvm_upd©e_‰ame_°©s
(
mvm
, 
øã_n_Êags
,

528 
rx_°©us
->
Êag
 & 
RX_FLAG_AMPDU_DETAILS
);

531 i‡(
	`u∆ikñy
((
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
) ||

532 
	`õì80211_is_¥obe_ª•
(
hdr
->
‰ame_c⁄åﬁ
)) &&

533 
mvm
->
sched_sˇn_∑ss_Æl
 =
SCHED_SCAN_PASS_ALL_ENABLED
))

534 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_FOUND
;

536 i‡(
	`u∆ikñy
(
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
) ||

537 
	`õì80211_is_¥obe_ª•
(
hdr
->
‰ame_c⁄åﬁ
)))

538 
rx_°©us
->
boŸtime_ns
 = 
	`ktime_gë_boŸtime_ns
();

540 
	`iwl_mvm_∑ss_∑ckë_to_mac80211
(
mvm
, 
°a
, 
«pi
, 
skb
, 
hdr
, 
Àn
,

541 
¸y±_Àn
, 
rxb
);

542 
	}
}

544 
	siwl_mvm_°©_d©a
 {

545 
iwl_mvm
 *
	mmvm
;

546 
__À32
 
	mÊags
;

547 
__À32
 
	mmac_id
;

548 
u8
 
	mbóc⁄_fûãr_avîage_íîgy
;

549 
__À32
 *
	mbóc⁄_cou¡î
;

550 
u8
 *
	mbóc⁄_avîage_íîgy
;

553 
	siwl_mvm_°©_d©a_Æl_macs
 {

554 
iwl_mvm
 *
	mmvm
;

555 
__À32
 
	mÊags
;

556 
iwl_°©s_¡fy_≥r_mac
 *
	m≥r_mac
;

559 
	$iwl_mvm_upd©e_vif_sig
(
õì80211_vif
 *
vif
, 
sig
)

561 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

562 
iwl_mvm
 *
mvm
 = 
mvmvif
->mvm;

563 
thﬁd
 = 
vif
->
bss_c⁄f
.
cqm_rssi_thﬁd
;

564 
hy°
 = 
vif
->
bss_c⁄f
.
cqm_rssi_hy°
;

565 
œ°_evít
;

567 i‡(
sig
 == 0) {

568 
	`IWL_DEBUG_RX
(
mvm
, "RSSI is 0 - skip signal based decision\n");

572 
mvmvif
->
bf_d©a
.
ave_bóc⁄_sig«l
 = 
sig
;

575 i‡(
mvmvif
->
bf_d©a
.
bt_c€x_mö_thﬁd
 !=

576 
mvmvif
->
bf_d©a
.
bt_c€x_max_thﬁd
) {

577 
œ°_evít
 = 
mvmvif
->
bf_d©a
.
œ°_bt_c€x_evít
;

578 i‡(
sig
 > 
mvmvif
->
bf_d©a
.
bt_c€x_max_thﬁd
 &&

579 (
œ°_evít
 <
mvmvif
->
bf_d©a
.
bt_c€x_mö_thﬁd
 ||

580 
œ°_evít
 == 0)) {

581 
mvmvif
->
bf_d©a
.
œ°_bt_c€x_evít
 = 
sig
;

582 
	`IWL_DEBUG_RX
(
mvm
, "cqm_iterator bt coex high %d\n",

583 
sig
);

584 
	`iwl_mvm_bt_rssi_evít
(
mvm
, 
vif
, 
RSSI_EVENT_HIGH
);

585 } i‡(
sig
 < 
mvmvif
->
bf_d©a
.
bt_c€x_mö_thﬁd
 &&

586 (
œ°_evít
 >
mvmvif
->
bf_d©a
.
bt_c€x_max_thﬁd
 ||

587 
œ°_evít
 == 0)) {

588 
mvmvif
->
bf_d©a
.
œ°_bt_c€x_evít
 = 
sig
;

589 
	`IWL_DEBUG_RX
(
mvm
, "cqm_iterator bt coexÜow %d\n",

590 
sig
);

591 
	`iwl_mvm_bt_rssi_evít
(
mvm
, 
vif
, 
RSSI_EVENT_LOW
);

595 i‡(!(
vif
->
drivî_Êags
 & 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
))

599 
œ°_evít
 = 
mvmvif
->
bf_d©a
.
œ°_cqm_evít
;

600 i‡(
thﬁd
 && 
sig
 <Åhﬁd && (
œ°_evít
 == 0 ||

601 
sig
 < 
œ°_evít
 - 
hy°
)) {

602 
mvmvif
->
bf_d©a
.
œ°_cqm_evít
 = 
sig
;

603 
	`IWL_DEBUG_RX
(
mvm
, "cqm_iterator cqmÜow %d\n",

604 
sig
);

605 
	`õì80211_cqm_rssi_nŸify
(

606 
vif
,

607 
NL80211_CQM_RSSI_THRESHOLD_EVENT_LOW
,

608 
sig
,

609 
GFP_KERNEL
);

610 } i‡(
sig
 > 
thﬁd
 &&

611 (
œ°_evít
 =0 || 
sig
 >Üa°_evíà+ 
hy°
)) {

612 
mvmvif
->
bf_d©a
.
œ°_cqm_evít
 = 
sig
;

613 
	`IWL_DEBUG_RX
(
mvm
, "cqm_iterator cqm high %d\n",

614 
sig
);

615 
	`õì80211_cqm_rssi_nŸify
(

616 
vif
,

617 
NL80211_CQM_RSSI_THRESHOLD_EVENT_HIGH
,

618 
sig
,

619 
GFP_KERNEL
);

621 
	}
}

623 
	$iwl_mvm_°©_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

624 
õì80211_vif
 *
vif
)

626 
iwl_mvm_°©_d©a
 *
d©a
 = 
_d©a
;

627 
sig
 = -
d©a
->
bóc⁄_fûãr_avîage_íîgy
;

628 
u16
 
id
 = 
	`À32_to_˝u
(
d©a
->
mac_id
);

629 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

630 
u16
 
vif_id
 = 
mvmvif
->
id
;

636 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
num_bóc⁄s
 =

637 
	`À32_to_˝u
(
d©a
->
bóc⁄_cou¡î
[
vif_id
]);

638 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
avg_sig«l
 =

639 -
d©a
->
bóc⁄_avîage_íîgy
[
vif_id
];

641 i‡(
mvmvif
->
id
 != id)

644 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

650 i‡(
	`À32_to_˝u
(
d©a
->
Êags
Ë& 
IWL_STATISTICS_REPLY_FLG_CLEAR
)

651 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
accu_num_bóc⁄s
 +=

652 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
num_bóc⁄s
;

654 
	`iwl_mvm_upd©e_vif_sig
(
vif
, 
sig
);

655 
	}
}

657 
	$iwl_mvm_°©_ôî©‹_Æl_macs
(*
_d©a
, 
u8
 *
mac
,

658 
õì80211_vif
 *
vif
)

660 
iwl_mvm_°©_d©a_Æl_macs
 *
d©a
 = 
_d©a
;

661 
iwl_°©s_¡fy_≥r_mac
 *
mac_°©s
;

662 
sig
;

663 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

664 
u16
 
vif_id
 = 
mvmvif
->
id
;

666 i‡(
	`WARN_ONCE
(
vif_id
 >
MAC_INDEX_AUX
, "invalid vif id: %d", vif_id))

669 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

672 
mac_°©s
 = &
d©a
->
≥r_mac
[
vif_id
];

674 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
num_bóc⁄s
 =

675 
	`À32_to_˝u
(
mac_°©s
->
bóc⁄_cou¡î
);

676 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
avg_sig«l
 =

677 -
	`À32_to_˝u
(
mac_°©s
->
bóc⁄_avîage_íîgy
);

682 i‡(
	`À32_to_˝u
(
d©a
->
Êags
Ë& 
IWL_STATISTICS_REPLY_FLG_CLEAR
)

683 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
accu_num_bóc⁄s
 +=

684 
mvmvif
->
deÊök
.
bóc⁄_°©s
.
num_bóc⁄s
;

686 
sig
 = -
	`À32_to_˝u
(
mac_°©s
->
bóc⁄_fûãr_avîage_íîgy
);

687 
	`iwl_mvm_upd©e_vif_sig
(
vif
, 
sig
);

688 
	}
}

690 
ölöe
 

691 
	$iwl_mvm_rx_°©s_check_åiggî
(
iwl_mvm
 *
mvm
, 
iwl_rx_∑ckë
 *
pkt
)

693 
iwl_fw_dbg_åiggî_év
 *
åig
;

694 
iwl_fw_dbg_åiggî_°©s
 *
åig_°©s
;

695 
u32
 
åig_off£t
, 
åig_thﬁd
;

697 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
NULL
, 
FW_DBG_TRIGGER_STATS
);

698 i‡(!
åig
)

701 
åig_°©s
 = (*)
åig
->
d©a
;

703 
åig_off£t
 = 
	`À32_to_˝u
(
åig_°©s
->
°›_off£t
);

704 
åig_thﬁd
 = 
	`À32_to_˝u
(
åig_°©s
->
°›_thªshﬁd
);

706 i‡(
	`WARN_ON_ONCE
(
åig_off£t
 >
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
)))

709 i‡(
	`À32_to_˝up
((
__À32
 *Ë(
pkt
->
d©a
 + 
åig_off£t
)Ë< 
åig_thﬁd
)

712 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
, 
NULL
);

713 
	}
}

715 
	$iwl_mvm_°©s_íîgy_ôî
(*
_d©a
,

716 
õì80211_°a
 *
°a
)

718 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

719 
u8
 *
íîgy
 = 
_d©a
;

720 
u32
 
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

722 i‡(
	`WARN_ONCE
(
°a_id
 >
IWL_MVM_STATION_COUNT_MAX
, "sta_id %d >= %d",

723 
°a_id
, 
IWL_MVM_STATION_COUNT_MAX
))

726 i‡(
íîgy
[
°a_id
])

727 
mvm°a
->
deÊök
.
avg_íîgy
 = 
íîgy
[
°a_id
];

729 
	}
}

732 
	$iwl_mvm_upd©e_tcm_‰om_°©s
(
iwl_mvm
 *
mvm
, 
__À32
 *
aú_time_À
,

733 
__À32
 *
rx_byãs_À
)

735 
i
;

737 
	`•ö_lock
(&
mvm
->
tcm
.
lock
);

738 
i
 = 0; i < 
NUM_MAC_INDEX_DRIVER
; i++) {

739 
iwl_mvm_tcm_mac
 *
md©a
 = &
mvm
->
tcm
.
d©a
[
i
];

740 
u32
 
rx_byãs
 = 
	`À32_to_˝u
(
rx_byãs_À
[
i
]);

741 
u32
 
aútime
 = 
	`À32_to_˝u
(
aú_time_À
[
i
]);

743 
md©a
->
rx
.
aútime
 +=áirtime;

744 
md©a
->
u≠sd_n⁄agg_dëe˘
.
rx_byãs
 +=Ñx_bytes;

745 i‡(
aútime
) {

747 
	`ewma_øã_öô
(&
md©a
->
u≠sd_n⁄agg_dëe˘
.
øã
);

748 
	`ewma_øã_add
(&
md©a
->
u≠sd_n⁄agg_dëe˘
.
øã
,

749 
rx_byãs
 * 8 / 
aútime
);

752 
	`•ö_u∆ock
(&
mvm
->
tcm
.
lock
);

753 
	}
}

755 
	$iwl_mvm_h™dÀ_≥r_phy_°©s
(
iwl_mvm
 *
mvm
,

756 
iwl_°©s_¡fy_≥r_phy
 *
≥r_phy
)

758 
i
;

760 
i
 = 0; i < 
NUM_PHY_CTX
; i++) {

761 i‡(!
mvm
->
phy_˘xts
[
i
].
ªf
)

763 
mvm
->
phy_˘xts
[
i
].
ch™√l_lﬂd_by_us
 =

764 
	`À32_to_˝u
(
≥r_phy
[
i
].
ch™√l_lﬂd_by_us
);

766 
	}
}

769 
	$iwl_mvm_°©s_vî_15
(
iwl_mvm
 *
mvm
,

770 
iwl_°©i°ics_›î©i⁄Æ_¡fy
 *
°©s
)

772 
iwl_mvm_°©_d©a_Æl_macs
 
d©a
 = {

773 .
mvm
 = mvm,

774 .
Êags
 = 
°©s
->flags,

775 .
≥r_mac
 = 
°©s
->per_mac,

778 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s
(
mvm
->
hw
,

779 
IEEE80211_IFACE_ITER_NORMAL
,

780 
iwl_mvm_°©_ôî©‹_Æl_macs
,

781 &
d©a
);

782 
	`iwl_mvm_h™dÀ_≥r_phy_°©s
(
mvm
, 
°©s
->
≥r_phy
);

783 
	}
}

786 
	$iwl_mvm_°©s_vî_14
(
iwl_mvm
 *
mvm
,

787 
iwl_°©i°ics_›î©i⁄Æ_¡fy_vî_14
 *
°©s
)

789 
iwl_mvm_°©_d©a
 
d©a
 = {

790 .
mvm
 = mvm,

793 
u8
 
bóc⁄_avîage_íîgy
[
MAC_INDEX_AUX
];

794 
__À32
 
Êags
;

795 
i
;

797 
Êags
 = 
°©s
->flags;

799 
d©a
.
mac_id
 = 
°©s
->mac_id;

800 
d©a
.
bóc⁄_fûãr_avîage_íîgy
 =

801 
	`À32_to_˝u
(
°©s
->
bóc⁄_fûãr_avîage_íîgy
);

802 
d©a
.
Êags
 = flags;

803 
d©a
.
bóc⁄_cou¡î
 = 
°©s
->beacon_counter;

805 
i
 = 0; i < 
	`ARRAY_SIZE
(
bóc⁄_avîage_íîgy
); i++)

806 
bóc⁄_avîage_íîgy
[
i
] =

807 
	`À32_to_˝u
(
°©s
->
bóc⁄_avîage_íîgy
[
i
]);

809 
d©a
.
bóc⁄_avîage_íîgy
 = beacon_average_energy;

811 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s
(
mvm
->
hw
,

812 
IEEE80211_IFACE_ITER_NORMAL
,

813 
iwl_mvm_°©_ôî©‹
,

814 &
d©a
);

815 
	}
}

817 
boﬁ
 
	$iwl_mvm_vîify_°©s_Àn
(
iwl_mvm
 *
mvm
,

818 
iwl_rx_∑ckë
 *
pkt
,

819 
u32
 
ex≥˘ed_size
)

821 
iwl_°©i°ics_¡fy_hdr
 *
hdr
;

823 i‡(
	`WARN_ONCE
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë< 
ex≥˘ed_size
,

825 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
), 
ex≥˘ed_size
))

826  
Ál£
;

828 
hdr
 = (*)&
pkt
->
d©a
;

830 i‡(
	`WARN_ONCE
((
hdr
->
ty≥
 & 
IWL_STATISTICS_TYPE_MSK
Ë!
FW_STATISTICS_OPERATIONAL
 ||

831 
hdr
->
vîsi⁄
 !=

832 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
, 
STATISTICS_NOTIFICATION
, 0),

834 
hdr
->
ty≥
, hdr->
vîsi⁄
))

835  
Ál£
;

837 i‡(
	`WARN_ONCE
(
	`À16_to_˝u
(
hdr
->
size
Ë!
ex≥˘ed_size
,

839 
	`À16_to_˝u
(
hdr
->
size
), 
ex≥˘ed_size
))

840  
Ál£
;

842  
åue
;

843 
	}
}

846 
	$iwl_mvm_°©_ôî©‹_Æl_löks
(
iwl_mvm
 *
mvm
,

847 
iwl_°©s_¡fy_≥r_lök
 *
≥r_lök
)

849 
u32
 
aú_time
[
MAC_INDEX_AUX
] = {};

850 
u32
 
rx_byãs
[
MAC_INDEX_AUX
] = {};

851 
fw_lök_id
;

853 
fw_lök_id
 = 0; fw_lök_id < 
	`ARRAY_SIZE
(
mvm
->
lök_id_to_lök_c⁄f
);

854 
fw_lök_id
++) {

855 
iwl_°©s_¡fy_≥r_lök
 *
lök_°©s
;

856 
õì80211_bss_c⁄f
 *
bss_c⁄f
;

857 
iwl_mvm_vif
 *
mvmvif
;

858 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
;

859 
lök_id
;

860 
sig
;

862 
bss_c⁄f
 = 
	`iwl_mvm_rcu_fw_lök_id_to_lök_c⁄f
(
mvm
, 
fw_lök_id
,

863 
Ál£
);

864 i‡(!
bss_c⁄f
)

867 i‡(
bss_c⁄f
->
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

870 
lök_id
 = 
bss_c⁄f
->link_id;

871 i‡(
lök_id
 >
	`ARRAY_SIZE
(
mvmvif
->
lök
))

874 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
bss_c⁄f
->
vif
);

875 
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

876 i‡(!
lök_öfo
)

879 
lök_°©s
 = &
≥r_lök
[
fw_lök_id
];

881 
lök_öfo
->
bóc⁄_°©s
.
num_bóc⁄s
 =

882 
	`À32_to_˝u
(
lök_°©s
->
bóc⁄_cou¡î
);

887 
lök_öfo
->
bóc⁄_°©s
.
avg_sig«l
 =

888 -
	`À32_to_˝u
(
lök_°©s
->
bóc⁄_avîage_íîgy
);

890 i‡(
lök_öfo
->
phy_˘xt
 &&

891 
lök_öfo
->
phy_˘xt
->
ch™√l
->
b™d
 =
NL80211_BAND_2GHZ
)

892 
	`iwl_mvm_bt_c€x_upd©e_vif_e§
(
mvm
, 
bss_c⁄f
->
vif
,

893 
lök_id
);

898 i‡(
mvm
->
°©i°ics_˛ór
)

899 
mvmvif
->
lök
[
lök_id
]->
bóc⁄_°©s
.
accu_num_bóc⁄s
 +=

900 
mvmvif
->
lök
[
lök_id
]->
bóc⁄_°©s
.
num_bóc⁄s
;

902 
sig
 = -
	`À32_to_˝u
(
lök_°©s
->
bóc⁄_fûãr_avîage_íîgy
);

903 
	`iwl_mvm_upd©e_vif_sig
(
bss_c⁄f
->
vif
, 
sig
);

905 i‡(
	`WARN_ONCE
(
mvmvif
->
id
 >
MAC_INDEX_AUX
,

906 "övÆid mvmvi‡id: %d", 
mvmvif
->
id
))

909 
aú_time
[
mvmvif
->
id
] +=

910 
	`À32_to_˝u
(
≥r_lök
[
fw_lök_id
].
aú_time
);

911 
rx_byãs
[
mvmvif
->
id
] +=

912 
	`À32_to_˝u
(
≥r_lök
[
fw_lök_id
].
rx_byãs
);

919 i‡(
mvm
->
°©i°ics_˛ór
) {

920 
__À32
 
aú_time_À
[
MAC_INDEX_AUX
];

921 
__À32
 
rx_byãs_À
[
MAC_INDEX_AUX
];

922 
vif_id
;

924 
vif_id
 = 0; vif_id < 
	`ARRAY_SIZE
(
aú_time_À
); vif_id++) {

925 
aú_time_À
[
vif_id
] = 
	`˝u_to_À32
(
aú_time
[vif_id]);

926 
rx_byãs_À
[
vif_id
] = 
	`˝u_to_À32
(
rx_byãs
[vif_id]);

929 
	`iwl_mvm_upd©e_tcm_‰om_°©s
(
mvm
, 
aú_time_À
, 
rx_byãs_À
);

931 
	}
}

933 
	$iwl_mvm_h™dÀ_rx_sy°em_›î_°©s
(
iwl_mvm
 *
mvm
,

934 
iwl_rx_cmd_buf„r
 *
rxb
)

936 
u8
 
avîage_íîgy
[
IWL_MVM_STATION_COUNT_MAX
];

937 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

938 
iwl_sy°em_°©i°ics_nŸif_›î
 *
°©s
;

939 
i
;

940 
u32
 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
STATISTICS_GROUP
,

941 
STATISTICS_OPER_NOTIF
, 0);

943 i‡(
nŸif_vî
 != 3) {

944 
	`IWL_FW_CHECK_FAILED
(
mvm
,

946 
nŸif_vî
);

950 
°©s
 = (*)&
pkt
->
d©a
;

951 
	`iwl_mvm_°©_ôî©‹_Æl_löks
(
mvm
, 
°©s
->
≥r_lök
);

953 
i
 = 0; i < 
	`ARRAY_SIZE
(
avîage_íîgy
); i++)

954 
avîage_íîgy
[
i
] =

955 
	`À32_to_˝u
(
°©s
->
≥r_°a
[
i
].
avîage_íîgy
);

957 
	`õì80211_ôî©e_°©i⁄s_©omic
(
mvm
->
hw
, 
iwl_mvm_°©s_íîgy_ôî
,

958 
avîage_íîgy
);

959 
	`iwl_mvm_h™dÀ_≥r_phy_°©s
(
mvm
, 
°©s
->
≥r_phy
);

960 
	}
}

962 
	$iwl_mvm_h™dÀ_rx_sy°em_›î_∑π1_°©s
(
iwl_mvm
 *
mvm
,

963 
iwl_rx_cmd_buf„r
 *
rxb
)

965 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

966 
iwl_sy°em_°©i°ics_∑π1_nŸif_›î
 *
∑π1_°©s
;

967 
i
;

968 
u32
 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
STATISTICS_GROUP
,

969 
STATISTICS_OPER_PART1_NOTIF
, 0);

971 i‡(
nŸif_vî
 != 4) {

972 
	`IWL_FW_CHECK_FAILED
(
mvm
,

974 
nŸif_vî
);

978 
∑π1_°©s
 = (*)&
pkt
->
d©a
;

979 
mvm
->
ødio_°©s
.
rx_time
 = 0;

980 
mvm
->
ødio_°©s
.
tx_time
 = 0;

981 
i
 = 0; i < 
	`ARRAY_SIZE
(
∑π1_°©s
->
≥r_lök
); i++) {

982 
mvm
->
ødio_°©s
.
rx_time
 +=

983 
	`À64_to_˝u
(
∑π1_°©s
->
≥r_lök
[
i
].
rx_time
);

984 
mvm
->
ødio_°©s
.
tx_time
 +=

985 
	`À64_to_˝u
(
∑π1_°©s
->
≥r_lök
[
i
].
tx_time
);

987 
	}
}

990 
	$iwl_mvm_h™dÀ_rx_°©i°ics_év
(
iwl_mvm
 *
mvm
,

991 
iwl_rx_∑ckë
 *
pkt
)

993 
u8
 
avîage_íîgy
[
IWL_MVM_STATION_COUNT_MAX
];

994 
__À32
 
aú_time
[
MAC_INDEX_AUX
];

995 
__À32
 
rx_byãs
[
MAC_INDEX_AUX
];

996 
__À32
 
Êags
 = 0;

997 
i
;

998 
u32
 
nŸif_vî
 = 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

999 
STATISTICS_NOTIFICATION
, 0);

1001 i‡(
	`WARN_ONCE
(
nŸif_vî
 > 15,

1002 "övÆid sèti°ic†vîsi⁄ id: %d\n", 
nŸif_vî
))

1005 i‡(
nŸif_vî
 == 14) {

1006 
iwl_°©i°ics_›î©i⁄Æ_¡fy_vî_14
 *
°©s
 =

1007 (*)
pkt
->
d©a
;

1009 i‡(!
	`iwl_mvm_vîify_°©s_Àn
(
mvm
, 
pkt
, (*
°©s
)))

1012 
	`iwl_mvm_°©s_vî_14
(
mvm
, 
°©s
);

1014 
Êags
 = 
°©s
->flags;

1015 
mvm
->
ødio_°©s
.
rx_time
 = 
	`À64_to_˝u
(
°©s
->rx_time);

1016 
mvm
->
ødio_°©s
.
tx_time
 = 
	`À64_to_˝u
(
°©s
->tx_time);

1017 
mvm
->
ødio_°©s
.
⁄_time_rf
 = 
	`À64_to_˝u
(
°©s
->on_time_rf);

1018 
mvm
->
ødio_°©s
.
⁄_time_sˇn
 =

1019 
	`À64_to_˝u
(
°©s
->
⁄_time_sˇn
);

1021 
i
 = 0; i < 
	`ARRAY_SIZE
(
avîage_íîgy
); i++)

1022 
avîage_íîgy
[
i
] = 
	`À32_to_˝u
(
°©s
->average_energy[i]);

1024 
i
 = 0; i < 
	`ARRAY_SIZE
(
aú_time
); i++) {

1025 
aú_time
[
i
] = 
°©s
->air_time[i];

1026 
rx_byãs
[
i
] = 
°©s
->rx_bytes[i];

1030 i‡(
nŸif_vî
 == 15) {

1031 
iwl_°©i°ics_›î©i⁄Æ_¡fy
 *
°©s
 =

1032 (*)
pkt
->
d©a
;

1034 i‡(!
	`iwl_mvm_vîify_°©s_Àn
(
mvm
, 
pkt
, (*
°©s
)))

1037 
	`iwl_mvm_°©s_vî_15
(
mvm
, 
°©s
);

1039 
Êags
 = 
°©s
->flags;

1040 
mvm
->
ødio_°©s
.
rx_time
 = 
	`À64_to_˝u
(
°©s
->rx_time);

1041 
mvm
->
ødio_°©s
.
tx_time
 = 
	`À64_to_˝u
(
°©s
->tx_time);

1042 
mvm
->
ødio_°©s
.
⁄_time_rf
 = 
	`À64_to_˝u
(
°©s
->on_time_rf);

1043 
mvm
->
ødio_°©s
.
⁄_time_sˇn
 =

1044 
	`À64_to_˝u
(
°©s
->
⁄_time_sˇn
);

1046 
i
 = 0; i < 
	`ARRAY_SIZE
(
avîage_íîgy
); i++)

1047 
avîage_íîgy
[
i
] =

1048 
	`À32_to_˝u
(
°©s
->
≥r_°a
[
i
].
avîage_íîgy
);

1050 
i
 = 0; i < 
	`ARRAY_SIZE
(
aú_time
); i++) {

1051 
aú_time
[
i
] = 
°©s
->
≥r_mac
[i].air_time;

1052 
rx_byãs
[
i
] = 
°©s
->
≥r_mac
[i].rx_bytes;

1056 
	`iwl_mvm_rx_°©s_check_åiggî
(
mvm
, 
pkt
);

1058 
	`õì80211_ôî©e_°©i⁄s_©omic
(
mvm
->
hw
, 
iwl_mvm_°©s_íîgy_ôî
,

1059 
avîage_íîgy
);

1065 i‡(
	`À32_to_˝u
(
Êags
Ë& 
IWL_STATISTICS_REPLY_FLG_CLEAR
)

1066 
	`iwl_mvm_upd©e_tcm_‰om_°©s
(
mvm
, 
aú_time
, 
rx_byãs
);

1067 
	}
}

1069 
	$iwl_mvm_h™dÀ_rx_°©i°ics
(
iwl_mvm
 *
mvm
,

1070 
iwl_rx_∑ckë
 *
pkt
)

1072 
iwl_mvm_°©_d©a
 
d©a
 = {

1073 .
mvm
 = mvm,

1075 
__À32
 *
byãs
, *
aú_time
, 
Êags
;

1076 
ex≥˘ed_size
;

1077 
u8
 *
íîgy
;

1078 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

1079 
	`WIDE_ID
(
SYSTEM_GROUP
,

1080 
SYSTEM_STATISTICS_CMD
),

1081 
IWL_FW_CMD_VER_UNKNOWN
);

1083 i‡(
cmd_vî
 !
IWL_FW_CMD_VER_UNKNOWN
)

1087 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

1088 
STATISTICS_NOTIFICATION
, 0) >= 14)

1089  
	`iwl_mvm_h™dÀ_rx_°©i°ics_év
(
mvm
, 
pkt
);

1091 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1092 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
))

1093 
ex≥˘ed_size
 = (
iwl_nŸif_°©i°ics_v11
);

1095 
ex≥˘ed_size
 = (
iwl_nŸif_°©i°ics_v10
);

1097 
ex≥˘ed_size
 = (
iwl_nŸif_°©i°ics
);

1100 i‡(
	`WARN_ONCE
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë!
ex≥˘ed_size
,

1102 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
)))

1105 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1106 
iwl_nŸif_°©i°ics_v11
 *
°©s
 = (*)&
pkt
->
d©a
;

1108 
d©a
.
mac_id
 = 
°©s
->
rx
.
gíîÆ
.mac_id;

1109 
d©a
.
bóc⁄_fûãr_avîage_íîgy
 =

1110 
°©s
->
gíîÆ
.
comm⁄
.
bóc⁄_fûãr_avîage_íîgy
;

1112 
mvm
->
rx_°©s_v3
 = 
°©s
->
rx
;

1114 
mvm
->
ødio_°©s
.
rx_time
 =

1115 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
rx_time
);

1116 
mvm
->
ødio_°©s
.
tx_time
 =

1117 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
tx_time
);

1118 
mvm
->
ødio_°©s
.
⁄_time_rf
 =

1119 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
⁄_time_rf
);

1120 
mvm
->
ødio_°©s
.
⁄_time_sˇn
 =

1121 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
⁄_time_sˇn
);

1123 
d©a
.
bóc⁄_cou¡î
 = 
°©s
->
gíîÆ
.beacon_counter;

1124 
d©a
.
bóc⁄_avîage_íîgy
 =

1125 
°©s
->
gíîÆ
.
bóc⁄_avîage_íîgy
;

1126 
Êags
 = 
°©s
->
Êag
;

1128 
iwl_nŸif_°©i°ics
 *
°©s
 = (*)&
pkt
->
d©a
;

1130 
d©a
.
mac_id
 = 
°©s
->
rx
.
gíîÆ
.mac_id;

1131 
d©a
.
bóc⁄_fûãr_avîage_íîgy
 =

1132 
°©s
->
gíîÆ
.
comm⁄
.
bóc⁄_fûãr_avîage_íîgy
;

1134 
mvm
->
rx_°©s
 = 
°©s
->
rx
;

1136 
mvm
->
ødio_°©s
.
rx_time
 =

1137 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
rx_time
);

1138 
mvm
->
ødio_°©s
.
tx_time
 =

1139 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
tx_time
);

1140 
mvm
->
ødio_°©s
.
⁄_time_rf
 =

1141 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
⁄_time_rf
);

1142 
mvm
->
ødio_°©s
.
⁄_time_sˇn
 =

1143 
	`À64_to_˝u
(
°©s
->
gíîÆ
.
comm⁄
.
⁄_time_sˇn
);

1145 
d©a
.
bóc⁄_cou¡î
 = 
°©s
->
gíîÆ
.beacon_counter;

1146 
d©a
.
bóc⁄_avîage_íîgy
 =

1147 
°©s
->
gíîÆ
.
bóc⁄_avîage_íîgy
;

1148 
Êags
 = 
°©s
->
Êag
;

1150 
d©a
.
Êags
 = flags;

1152 
	`iwl_mvm_rx_°©s_check_åiggî
(
mvm
, 
pkt
);

1154 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s
(
mvm
->
hw
,

1155 
IEEE80211_IFACE_ITER_NORMAL
,

1156 
iwl_mvm_°©_ôî©‹
,

1157 &
d©a
);

1159 i‡(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
))

1162 i‡(!
	`iwl_mvm_has_√w_rx_°©s_≠i
(
mvm
)) {

1163 
iwl_nŸif_°©i°ics_v11
 *
v11
 = (*)&
pkt
->
d©a
;

1165 
íîgy
 = (*)&
v11
->
lﬂd_°©s
.
avg_íîgy
;

1166 
byãs
 = (*)&
v11
->
lﬂd_°©s
.
byã_cou¡
;

1167 
aú_time
 = (*)&
v11
->
lﬂd_°©s
.air_time;

1169 
iwl_nŸif_°©i°ics
 *
°©s
 = (*)&
pkt
->
d©a
;

1171 
íîgy
 = (*)&
°©s
->
lﬂd_°©s
.
avg_íîgy
;

1172 
byãs
 = (*)&
°©s
->
lﬂd_°©s
.
byã_cou¡
;

1173 
aú_time
 = (*)&
°©s
->
lﬂd_°©s
.air_time;

1175 
	`õì80211_ôî©e_°©i⁄s_©omic
(
mvm
->
hw
, 
iwl_mvm_°©s_íîgy_ôî
,

1176 
íîgy
);

1183 i‡(
	`À32_to_˝u
(
Êags
Ë& 
IWL_STATISTICS_REPLY_FLG_CLEAR
)

1184 
	`iwl_mvm_upd©e_tcm_‰om_°©s
(
mvm
, 
aú_time
, 
byãs
);

1186 
	}
}

1188 
	$iwl_mvm_rx_°©i°ics
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

1190 
	`iwl_mvm_h™dÀ_rx_°©i°ics
(
mvm
, 
	`rxb_addr
(
rxb
));

1191 
	}
}

1193 
	$iwl_mvm_wödow_°©us_nŸif
(
iwl_mvm
 *
mvm
,

1194 
iwl_rx_cmd_buf„r
 *
rxb
)

1196 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1197 
iwl_ba_wödow_°©us_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

1198 
i
;

1200 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
nŸif
->
ø_tid
Ë!
BA_WINDOW_STREAMS_MAX
);

1201 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
nŸif
->
mpdu_rx_cou¡
Ë!
BA_WINDOW_STREAMS_MAX
);

1202 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
nŸif
->
bôm≠
Ë!
BA_WINDOW_STREAMS_MAX
);

1203 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
nŸif
->
°¨t_£q_num
Ë!
BA_WINDOW_STREAMS_MAX
);

1205 
	`rcu_ªad_lock
();

1206 
i
 = 0; i < 
BA_WINDOW_STREAMS_MAX
; i++) {

1207 
õì80211_°a
 *
°a
;

1208 
u8
 
°a_id
, 
tid
;

1209 
u64
 
bôm≠
;

1210 
u32
 
s¢
;

1211 
u16
 
øtid
;

1212 
u16
 
ª˚ived_mpdu
;

1214 
øtid
 = 
	`À16_to_˝u
(
nŸif
->
ø_tid
[
i
]);

1216 i‡(!(
øtid
 & 
BA_WINDOW_STATUS_VALID_MSK
))

1219 
ª˚ived_mpdu
 = 
	`À16_to_˝u
(
nŸif
->
mpdu_rx_cou¡
[
i
]);

1220 i‡(
ª˚ived_mpdu
 == 0)

1223 
tid
 = 
øtid
 & 
BA_WINDOW_STATUS_TID_MSK
;

1225 
°a_id
 = (
øtid
 & 
BA_WINDOW_STATUS_STA_ID_MSK
)

1226 >> 
BA_WINDOW_STATUS_STA_ID_POS
;

1227 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

1228 i‡(
	`IS_ERR_OR_NULL
(
°a
))

1230 
bôm≠
 = 
	`À64_to_˝u
(
nŸif
->bôm≠[
i
]);

1231 
s¢
 = 
	`À32_to_˝u
(
nŸif
->
°¨t_£q_num
[
i
]);

1234 
	`õì80211_m¨k_rx_ba_fûãªd_‰ames
(
°a
, 
tid
, 
s¢
, 
bôm≠
,

1235 
ª˚ived_mpdu
);

1237 
	`rcu_ªad_u∆ock
();

1238 
	}
}

	@mvm/rxmq.c

7 
	~<löux/ëhîdevi˚.h
>

8 
	~<löux/skbuff.h
>

9 
	~"iwl-å™s.h
"

10 
	~"mvm.h
"

11 
	~"fw-≠i.h
"

12 
	~"time-sync.h
"

14 
ölöe
 
	$iwl_mvm_check_≤
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

15 
queue
, 
õì80211_°a
 *
°a
)

17 
iwl_mvm_°a
 *
mvm°a
;

18 
õì80211_hdr
 *
hdr
 = (*)
	`skb_mac_hódî
(
skb
);

19 
õì80211_rx_°©us
 *
°©s
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

20 
iwl_mvm_key_≤
 *
±k_≤
;

21 
ªs
;

22 
u8
 
tid
, 
keyidx
;

23 
u8
 
≤
[
IEEE80211_CCMP_PN_LEN
];

24 
u8
 *
extiv
;

29 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) ||

30 
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
))

34 i‡(!(
°©s
->
Êag
 & 
RX_FLAG_DECRYPTED
))

42 i‡(
queue
 == 0)

46 i‡(
	`IS_ERR_OR_NULL
(
°a
)) {

47 
	`IWL_DEBUG_DROP
(
mvm
,

52 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

54 
extiv
 = (
u8
 *)
hdr
 + 
	`õì80211_hdæí
(hdr->
‰ame_c⁄åﬁ
);

55 
keyidx
 = 
extiv
[3] >> 6;

57 
±k_≤
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->±k_≤[
keyidx
]);

58 i‡(!
±k_≤
)

61 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
))

62 
tid
 = 
	`õì80211_gë_tid
(
hdr
);

64 
tid
 = 0;

67 i‡(
tid
 >
IWL_MAX_TID_COUNT
)

71 
≤
[0] = 
extiv
[7];

72 
≤
[1] = 
extiv
[6];

73 
≤
[2] = 
extiv
[5];

74 
≤
[3] = 
extiv
[4];

75 
≤
[4] = 
extiv
[1];

76 
≤
[5] = 
extiv
[0];

78 
ªs
 = 
	`memcmp
(
≤
, 
±k_≤
->
q
[
queue
].≤[
tid
], 
IEEE80211_CCMP_PN_LEN
);

79 i‡(
ªs
 < 0)

81 i‡(!
ªs
 && !(
°©s
->
Êag
 & 
RX_FLAG_ALLOW_SAME_PN
))

84 
	`mem˝y
(
±k_≤
->
q
[
queue
].
≤
[
tid
],Ön, 
IEEE80211_CCMP_PN_LEN
);

85 
°©s
->
Êag
 |
RX_FLAG_PN_VALIDATED
;

88 
	}
}

91 
	$iwl_mvm_¸óã_skb
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

92 
õì80211_hdr
 *
hdr
, 
u16
 
Àn
, 
u8
 
¸y±_Àn
,

93 
iwl_rx_cmd_buf„r
 *
rxb
)

95 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

96 
iwl_rx_mpdu_desc
 *
desc
 = (*)
pkt
->
d©a
;

97 
hódÀn
, 
‰agÀn
, 
∑d_Àn
 = 0;

98 
hdæí
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

99 
u8
 
mic_¸c_Àn
 = 
	`u8_gë_bôs
(
desc
->
mac_Êags1
,

100 
IWL_RX_MPDU_MFLG1_MIC_CRC_LEN_MASK
) << 1;

102 i‡(
desc
->
mac_Êags2
 & 
IWL_RX_MPDU_MFLG2_PAD
) {

103 
Àn
 -= 2;

104 
∑d_Àn
 = 2;

113 i‡(
Àn
 > 
mic_¸c_Àn
 && !
	`õì80211_hw_check
(
mvm
->
hw
, 
RX_INCLUDES_FCS
))

114 
Àn
 -
mic_¸c_Àn
;

128 
hódÀn
 = (
Àn
 <
	`skb_èûroom
(
skb
)) ?Üen :

129 
hdæí
 + 
¸y±_Àn
 + 8;

136 
hdæí
 +
¸y±_Àn
;

138 i‡(
	`u∆ikñy
(
hódÀn
 < 
hdæí
))

139  -
EINVAL
;

144 
	`skb_£t_mac_hódî
(
skb
, skb->
Àn
);

145 
	`skb_put_d©a
(
skb
, 
hdr
, 
hdæí
);

146 
	`skb_put_d©a
(
skb
, (
u8
 *)
hdr
 + 
hdæí
 + 
∑d_Àn
, 
hódÀn
 - hdrlen);

159 i‡(
skb
->
ù_summed
 =
CHECKSUM_COMPLETE
) {

161 
u8
 
hdr
[6];

162 
__be16
 
ty≥
;

163 } 
__∑cked
 *
shdr
 = (*)((
u8
 *)
hdr
 + 
hdæí
 + 
∑d_Àn
);

165 i‡(
	`u∆ikñy
(
hódÀn
 - 
hdæí
 < (*
shdr
) ||

166 !
	`ëhî_addr_equÆ
(
shdr
->
hdr
, 
rfc1042_hódî
) ||

167 (
shdr
->
ty≥
 !
	`ht⁄s
(
ETH_P_IP
) &&

168 
shdr
->
ty≥
 !
	`ht⁄s
(
ETH_P_ARP
) &&

169 
shdr
->
ty≥
 !
	`ht⁄s
(
ETH_P_IPV6
) &&

170 
shdr
->
ty≥
 !
	`ht⁄s
(
ETH_P_8021Q
) &&

171 
shdr
->
ty≥
 !
	`ht⁄s
(
ETH_P_PAE
) &&

172 
shdr
->
ty≥
 !
	`ht⁄s
(
ETH_P_TDLS
))))

173 
skb
->
ù_summed
 = 
CHECKSUM_NONE
;

174 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_BZ
)

176 
	`skb_po°push_rcsum
(
skb
, 
shdr
, (*shdr));

179 
‰agÀn
 = 
Àn
 - 
hódÀn
;

181 i‡(
‰agÀn
) {

182 
off£t
 = (
u8
 *)
hdr
 + 
hódÀn
 + 
∑d_Àn
 -

183 (
u8
 *)
	`rxb_addr
(
rxb
Ë+ 
	`rxb_off£t
(rxb);

185 
	`skb_add_rx_‰ag
(
skb
, 0, 
	`rxb_°ól_∑ge
(
rxb
), 
off£t
,

186 
‰agÀn
, 
rxb
->
åuesize
);

190 
	}
}

197 
	$iwl_mvm_ødiŸ≠_put_év
(
sk_buff
 *
skb
, 
u16
 
ty≥
, u16 
Àn
)

199 
õì80211_ødiŸ≠_év
 *
év
;

201 
év
 = 
	`skb_put
(
skb
, (*tlv));

202 
év
->
ty≥
 = 
	`˝u_to_À16
(type);

203 
év
->
Àn
 = 
	`˝u_to_À16
(len);

204  
	`skb_put_zîo
(
skb
, 
	`ALIGN
(
Àn
, 4));

205 
	}
}

207 
	$iwl_mvm_add_π≠_¢if„r_c⁄fig
(
iwl_mvm
 *
mvm
,

208 
sk_buff
 *
skb
)

210 
õì80211_rx_°©us
 *
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

211 
õì80211_ødiŸ≠_víd‹_c⁄ã¡
 *
ødiŸ≠
;

212 c⁄° 
u16
 
víd‹_d©a_Àn
 = (
mvm
->
cur_aid
);

214 i‡(!
mvm
->
cur_aid
)

217 
ødiŸ≠
 = 
	`iwl_mvm_ødiŸ≠_put_év
(
skb
,

218 
IEEE80211_RADIOTAP_VENDOR_NAMESPACE
,

219 (*
ødiŸ≠
Ë+ 
víd‹_d©a_Àn
);

222 
ødiŸ≠
->
oui
[0] = 0xf6;

223 
ødiŸ≠
->
oui
[1] = 0x54;

224 
ødiŸ≠
->
oui
[2] = 0x25;

226 
ødiŸ≠
->
oui_subty≥
 = 1;

227 
ødiŸ≠
->
víd‹_ty≥
 = 0;

230 
	`mem˝y
(
ødiŸ≠
->
d©a
, &
mvm
->
cur_aid
, (mvm->cur_aid));

232 
rx_°©us
->
Êag
 |
RX_FLAG_RADIOTAP_TLV_AT_END
;

233 
	}
}

236 
	$iwl_mvm_∑ss_∑ckë_to_mac80211
(
iwl_mvm
 *
mvm
,

237 
«pi_°ru˘
 *
«pi
,

238 
sk_buff
 *
skb
, 
queue
,

239 
õì80211_°a
 *
°a
)

241 i‡(
	`u∆ikñy
(
	`iwl_mvm_check_≤
(
mvm
, 
skb
, 
queue
, 
°a
))) {

242 
	`k‰ì_skb
(
skb
);

246 
	`õì80211_rx_«pi
(
mvm
->
hw
, 
°a
, 
skb
, 
«pi
);

247 
	}
}

249 
	$iwl_mvm_gë_sig«l_°ªngth
(
iwl_mvm
 *
mvm
,

250 
õì80211_rx_°©us
 *
rx_°©us
,

251 
u32
 
øã_n_Êags
, 
íîgy_a
,

252 
íîgy_b
)

254 
max_íîgy
;

255 
u32
 
øã_Êags
 = 
øã_n_Êags
;

257 
íîgy_a
 =É√rgy_®? -íîgy_®: 
S8_MIN
;

258 
íîgy_b
 =É√rgy_b ? -íîgy_b : 
S8_MIN
;

259 
max_íîgy
 = 
	`max
(
íîgy_a
, 
íîgy_b
);

261 
	`IWL_DEBUG_STATS
(
mvm
, "energy In A %d B %d,ánd max %d\n",

262 
íîgy_a
, 
íîgy_b
, 
max_íîgy
);

264 
rx_°©us
->
sig«l
 = 
max_íîgy
;

265 
rx_°©us
->
chaös
 =

266 (
øã_Êags
 & 
RATE_MCS_ANT_AB_MSK
Ë>> 
RATE_MCS_ANT_POS
;

267 
rx_°©us
->
chaö_sig«l
[0] = 
íîgy_a
;

268 
rx_°©us
->
chaö_sig«l
[1] = 
íîgy_b
;

269 
	}
}

271 
	$iwl_mvm_rx_mgmt_¥Ÿ
(
õì80211_°a
 *
°a
,

272 
õì80211_hdr
 *
hdr
,

273 
iwl_rx_mpdu_desc
 *
desc
,

274 
u32
 
°©us
,

275 
õì80211_rx_°©us
 *
°©s
)

277 
wúñess_dev
 *
wdev
;

278 
iwl_mvm_°a
 *
mvm°a
;

279 
iwl_mvm_vif
 *
mvmvif
;

280 
u8
 
keyid
;

281 
õì80211_key_c⁄f
 *
key
;

282 
u32
 
Àn
 = 
	`À16_to_˝u
(
desc
->
mpdu_Àn
);

283 c⁄° 
u8
 *
‰ame
 = (*)
hdr
;

285 i‡((
°©us
 & 
IWL_RX_MPDU_STATUS_SEC_MASK
Ë=
IWL_RX_MPDU_STATUS_SEC_NONE
)

296 i‡(!
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
))

299 i‡(!
°a
)

302 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

303 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

306 i‡(!(
°©us
 & 
IWL_RX_MPDU_STATUS_KEY_VALID
))

307 
ªp‹t
;

310 i‡(
	`likñy
(
°©us
 & 
IWL_RX_MPDU_STATUS_MIC_OK
 &&

311 !(
°©us
 & 
IWL_RX_MPDU_STATUS_REPLAY_ERROR
))) {

312 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

320 
key
 = 
	`rcu_dîe„ªn˚
(
mvmvif
->
b˙_¥Ÿ
.
keys
[0]);

321 i‡(!
key
) {

322 
key
 = 
	`rcu_dîe„ªn˚
(
mvmvif
->
b˙_¥Ÿ
.
keys
[1]);

323 i‡(!
key
)

324 
ªp‹t
;

327 i‡(
Àn
 < 
key
->
icv_Àn
 + 
IEEE80211_GMAC_PN_LEN
 + 2)

328 
ªp‹t
;

331 
keyid
 = 
‰ame
[
Àn
 - 
key
->
icv_Àn
 - 
IEEE80211_GMAC_PN_LEN
 - 2];

333 i‡(
keyid
 !
key
->
keyidx
) {

338 i‡(
keyid
 != 6 && keyid != 7)

340 
key
 = 
	`rcu_dîe„ªn˚
(
mvmvif
->
b˙_¥Ÿ
.
keys
[
keyid
 - 6]);

341 i‡(!
key
)

342 
ªp‹t
;

346 i‡(!(
°©us
 & 
IWL_RX_MPDU_STATUS_MIC_OK
))

347 
	`õì80211_key_mic_Áûuª
(
key
);

348 i‡(
°©us
 & 
IWL_RX_MPDU_STATUS_REPLAY_ERROR
)

349 
	`õì80211_key_ª∂ay
(
key
);

350 
ªp‹t
:

351 
wdev
 = 
	`õì80211_vif_to_wdev
(
mvm°a
->
vif
);

352 i‡(
wdev
->
√tdev
)

353 
	`cfg80211_rx_u≈rŸ_mlme_mgmt
(
wdev
->
√tdev
, (*)
hdr
, 
Àn
);

356 
	}
}

358 
	$iwl_mvm_rx_¸y±o
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

359 
õì80211_hdr
 *
hdr
,

360 
õì80211_rx_°©us
 *
°©s
, 
u16
 
phy_öfo
,

361 
iwl_rx_mpdu_desc
 *
desc
,

362 
u32
 
pkt_Êags
, 
queue
, 
u8
 *
¸y±_Àn
)

364 
u32
 
°©us
 = 
	`À32_to_˝u
(
desc
->status);

373 i‡(
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU
 &&

374 (
°©us
 & 
IWL_RX_MPDU_STATUS_SEC_MASK
) ==

375 
IWL_RX_MPDU_STATUS_SEC_UNKNOWN
 && !
mvm
->
m⁄ô‹_⁄
) {

376 
	`IWL_DEBUG_DROP
(
mvm
, "DroppingÖackets, badÉnc status\n");

380 i‡(
	`u∆ikñy
(
	`õì80211_is_mgmt
(
hdr
->
‰ame_c⁄åﬁ
) &&

381 !
	`õì80211_has_¥Ÿe˘ed
(
hdr
->
‰ame_c⁄åﬁ
)))

382  
	`iwl_mvm_rx_mgmt_¥Ÿ
(
°a
, 
hdr
, 
desc
, 
°©us
, 
°©s
);

384 i‡(!
	`õì80211_has_¥Ÿe˘ed
(
hdr
->
‰ame_c⁄åﬁ
) ||

385 (
°©us
 & 
IWL_RX_MPDU_STATUS_SEC_MASK
) ==

386 
IWL_RX_MPDU_STATUS_SEC_NONE
)

391 
°©us
 & 
IWL_RX_MPDU_STATUS_SEC_MASK
) {

392 
IWL_RX_MPDU_STATUS_SEC_CCM
:

393 
IWL_RX_MPDU_STATUS_SEC_GCM
:

394 
	`BUILD_BUG_ON
(
IEEE80211_CCMP_PN_LEN
 !
IEEE80211_GCMP_PN_LEN
);

396 i‡(!(
°©us
 & 
IWL_RX_MPDU_STATUS_MIC_OK
)) {

397 
	`IWL_DEBUG_DROP
(
mvm
,

402 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
 | 
RX_FLAG_MIC_STRIPPED
;

403 *
¸y±_Àn
 = 
IEEE80211_CCMP_HDR_LEN
;

405 
IWL_RX_MPDU_STATUS_SEC_TKIP
:

407 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

408 
IWL_UCODE_TLV_API_DEPRECATE_TTAK
) &&

409 !(
°©us
 & 
IWL_RX_MPDU_RES_STATUS_TTAK_OK
))

412 i‡(
mvm
->
å™s
->
å™s_cfg
->
gí2
 &&

413 !(
°©us
 & 
RX_MPDU_RES_STATUS_MIC_OK
))

414 
°©s
->
Êag
 |
RX_FLAG_MMIC_ERROR
;

416 *
¸y±_Àn
 = 
IEEE80211_TKIP_IV_LEN
;

417 
ÁŒthrough
;

418 
IWL_RX_MPDU_STATUS_SEC_WEP
:

419 i‡(!(
°©us
 & 
IWL_RX_MPDU_STATUS_ICV_OK
))

422 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

423 i‡((
°©us
 & 
IWL_RX_MPDU_STATUS_SEC_MASK
) ==

424 
IWL_RX_MPDU_STATUS_SEC_WEP
)

425 *
¸y±_Àn
 = 
IEEE80211_WEP_IV_LEN
;

427 i‡(
pkt_Êags
 & 
FH_RSCSR_RADA_EN
) {

428 
°©s
->
Êag
 |
RX_FLAG_ICV_STRIPPED
;

429 i‡(
mvm
->
å™s
->
å™s_cfg
->
gí2
)

430 
°©s
->
Êag
 |
RX_FLAG_MMIC_STRIPPED
;

434 
IWL_RX_MPDU_STATUS_SEC_EXT_ENC
:

435 i‡(!(
°©us
 & 
IWL_RX_MPDU_STATUS_MIC_OK
))

437 
°©s
->
Êag
 |
RX_FLAG_DECRYPTED
;

439 
RX_MPDU_RES_STATUS_SEC_CMAC_GMAC_ENC
:

450 i‡(!
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
) &&

451 !
mvm
->
m⁄ô‹_⁄
 && 
	`√t_øãlimô
())

452 
	`IWL_WARN
(
mvm
, "Unh™dÀdálg: 0x%x\n", 
°©us
);

456 
	}
}

458 
	$iwl_mvm_rx_csum
(
iwl_mvm
 *
mvm
,

459 
õì80211_°a
 *
°a
,

460 
sk_buff
 *
skb
,

461 
iwl_rx_∑ckë
 *
pkt
)

463 
iwl_rx_mpdu_desc
 *
desc
 = (*)
pkt
->
d©a
;

465 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

466 i‡(
pkt
->
Àn_n_Êags
 & 
	`˝u_to_À32
(
FH_RSCSR_RPA_EN
)) {

467 
u16
 
hwsum
 = 
	`be16_to_˝u
(
desc
->
v3
.
øw_xsum
);

469 
skb
->
ù_summed
 = 
CHECKSUM_COMPLETE
;

470 
skb
->
csum
 = 
	`csum_unfﬁd
(~(
__f‹˚
 
__sum16
)
hwsum
);

473 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

474 
iwl_mvm_vif
 *
mvmvif
;

475 
u16
 
Êags
 = 
	`À16_to_˝u
(
desc
->
l3l4_Êags
);

476 
u8
 
l3_¥Ÿ
 = (u8)((
Êags
 & 
IWL_RX_L3L4_L3_PROTO_MASK
) >>

477 
IWL_RX_L3_PROTO_POS
);

479 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
mvm°a
->
vif
);

481 i‡(
mvmvif
->
„©uªs
 & 
NETIF_F_RXCSUM
 &&

482 
Êags
 & 
IWL_RX_L3L4_TCP_UDP_CSUM_OK
 &&

483 (
Êags
 & 
IWL_RX_L3L4_IP_HDR_CSUM_OK
 ||

484 
l3_¥Ÿ
 =
IWL_RX_L3_TYPE_IPV6
 ||

485 
l3_¥Ÿ
 =
IWL_RX_L3_TYPE_IPV6_FRAG
))

486 
skb
->
ù_summed
 = 
CHECKSUM_UNNECESSARY
;

488 
	}
}

494 
boﬁ
 
	$iwl_mvm_is_dup
(
õì80211_°a
 *
°a
, 
queue
,

495 
õì80211_rx_°©us
 *
rx_°©us
,

496 
õì80211_hdr
 *
hdr
,

497 
iwl_rx_mpdu_desc
 *
desc
)

499 
iwl_mvm_°a
 *
mvm_°a
;

500 
iwl_mvm_rxq_dup_d©a
 *
dup_d©a
;

501 
u8
 
tid
, 
sub_‰ame_idx
;

503 i‡(
	`WARN_ON
(
	`IS_ERR_OR_NULL
(
°a
)))

504  
Ál£
;

506 
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

508 i‡(
	`WARN_ON_ONCE
(!
mvm_°a
->
dup_d©a
))

509  
Ál£
;

511 
dup_d©a
 = &
mvm_°a
->dup_d©a[
queue
];

517 i‡(
	`õì80211_is_˘l
(
hdr
->
‰ame_c⁄åﬁ
) ||

518 
	`õì80211_is_™y_nuŒfunc
(
hdr
->
‰ame_c⁄åﬁ
) ||

519 
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
))

520  
Ál£
;

522 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
)) {

524 
tid
 = 
	`õì80211_gë_tid
(
hdr
);

525 i‡(
tid
 >
IWL_MAX_TID_COUNT
)

526  
åue
;

528 
tid
 = 
IWL_MAX_TID_COUNT
;

532 
sub_‰ame_idx
 = 
desc
->
amsdu_öfo
 &

533 
IWL_RX_MPDU_AMSDU_SUBFRAME_IDX_MASK
;

535 i‡(
	`u∆ikñy
(
	`õì80211_has_ªåy
(
hdr
->
‰ame_c⁄åﬁ
) &&

536 
dup_d©a
->
œ°_£q
[
tid
] =
hdr
->
£q_˘æ
 &&

537 
dup_d©a
->
œ°_sub_‰ame
[
tid
] >
sub_‰ame_idx
))

538  
åue
;

541 i‡(
dup_d©a
->
œ°_£q
[
tid
] =
hdr
->
£q_˘æ
 &&

542 
sub_‰ame_idx
 > 
dup_d©a
->
œ°_sub_‰ame
[
tid
] &&

543 
desc
->
mac_Êags2
 & 
IWL_RX_MPDU_MFLG2_AMSDU
)

544 
rx_°©us
->
Êag
 |
RX_FLAG_ALLOW_SAME_PN
;

546 
dup_d©a
->
œ°_£q
[
tid
] = 
hdr
->
£q_˘æ
;

547 
dup_d©a
->
œ°_sub_‰ame
[
tid
] = 
sub_‰ame_idx
;

549 
rx_°©us
->
Êag
 |
RX_FLAG_DUP_VALIDATED
;

551  
Ál£
;

552 
	}
}

554 
	$iwl_mvm_ªÀa£_‰ames
(
iwl_mvm
 *
mvm
,

555 
õì80211_°a
 *
°a
,

556 
«pi_°ru˘
 *
«pi
,

557 
iwl_mvm_baid_d©a
 *
baid_d©a
,

558 
iwl_mvm_ª‹dî_buf„r
 *
ª‹dî_buf
,

559 
u16
 
ns¢
)

561 
iwl_mvm_ª‹dî_buf_íåy
 *
íåõs
 =

562 &
baid_d©a
->
íåõs
[
ª‹dî_buf
->
queue
 *

563 
baid_d©a
->
íåõs_≥r_queue
];

564 
u16
 
s¢
 = 
ª‹dî_buf
->
hód_¢
;

566 
	`lockdï_as£π_hñd
(&
ª‹dî_buf
->
lock
);

568 
	`õì80211_¢_Àss
(
s¢
, 
ns¢
)) {

569 
ödex
 = 
s¢
 % 
ª‹dî_buf
->
buf_size
;

570 
sk_buff_hód
 *
skb_li°
 = &
íåõs
[
ödex
].
‰ames
;

571 
sk_buff
 *
skb
;

573 
s¢
 = 
	`õì80211_¢_öc
(ssn);

580 (
skb
 = 
	`__skb_dequeue
(
skb_li°
))) {

581 
	`iwl_mvm_∑ss_∑ckë_to_mac80211
(
mvm
, 
«pi
, 
skb
,

582 
ª‹dî_buf
->
queue
,

583 
°a
);

584 
ª‹dî_buf
->
num_°‹ed
--;

587 
ª‹dî_buf
->
hód_¢
 = 
ns¢
;

588 
	}
}

590 
	$iwl_mvm_dñ_ba
(
iwl_mvm
 *
mvm
, 
queue
,

591 
iwl_mvm_dñba_d©a
 *
d©a
)

593 
iwl_mvm_baid_d©a
 *
ba_d©a
;

594 
õì80211_°a
 *
°a
;

595 
iwl_mvm_ª‹dî_buf„r
 *
ª‹dî_buf
;

596 
u8
 
baid
 = 
d©a
->baid;

597 
u32
 
°a_id
;

599 i‡(
	`WARN_ONCE
(
baid
 >
IWL_MAX_BAID
, "invalid BAID: %x\n", baid))

602 
	`rcu_ªad_lock
();

604 
ba_d©a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
baid_m≠
[
baid
]);

605 i‡(
	`WARN_ON_ONCE
(!
ba_d©a
))

606 
out
;

609 
°a_id
 = 
	`ffs
(
ba_d©a
->
°a_mask
) - 1;

610 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

611 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
)))

612 
out
;

614 
ª‹dî_buf
 = &
ba_d©a
->ª‹dî_buf[
queue
];

617 
	`•ö_lock_bh
(&
ª‹dî_buf
->
lock
);

618 
	`iwl_mvm_ªÀa£_‰ames
(
mvm
, 
°a
, 
NULL
, 
ba_d©a
, 
ª‹dî_buf
,

619 
	`õì80211_¢_add
(
ª‹dî_buf
->
hód_¢
,

620 
ª‹dî_buf
->
buf_size
));

621 
	`•ö_u∆ock_bh
(&
ª‹dî_buf
->
lock
);

623 
out
:

624 
	`rcu_ªad_u∆ock
();

625 
	}
}

627 
	$iwl_mvm_ªÀa£_‰ames_‰om_nŸif
(
iwl_mvm
 *
mvm
,

628 
«pi_°ru˘
 *
«pi
,

629 
u8
 
baid
, 
u16
 
ns¢
, 
queue
)

631 
õì80211_°a
 *
°a
;

632 
iwl_mvm_ª‹dî_buf„r
 *
ª‹dî_buf
;

633 
iwl_mvm_baid_d©a
 *
ba_d©a
;

634 
u32
 
°a_id
;

636 
	`IWL_DEBUG_HT
(
mvm
, "FrameÑeleaseÇotification for BAID %u, NSSN %d\n",

637 
baid
, 
ns¢
);

639 i‡(
	`WARN_ON_ONCE
(
baid
 =
IWL_RX_REORDER_DATA_INVALID_BAID
 ||

640 
baid
 >
	`ARRAY_SIZE
(
mvm
->
baid_m≠
)))

643 
	`rcu_ªad_lock
();

645 
ba_d©a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
baid_m≠
[
baid
]);

646 i‡(
	`WARN
(!
ba_d©a
, "BAID %dÇŸ found i¿m≠\n", 
baid
))

647 
out
;

650 
°a_id
 = 
	`ffs
(
ba_d©a
->
°a_mask
) - 1;

651 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

652 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
)))

653 
out
;

655 
ª‹dî_buf
 = &
ba_d©a
->ª‹dî_buf[
queue
];

657 
	`•ö_lock_bh
(&
ª‹dî_buf
->
lock
);

658 
	`iwl_mvm_ªÀa£_‰ames
(
mvm
, 
°a
, 
«pi
, 
ba_d©a
,

659 
ª‹dî_buf
, 
ns¢
);

660 
	`•ö_u∆ock_bh
(&
ª‹dî_buf
->
lock
);

662 
out
:

663 
	`rcu_ªad_u∆ock
();

664 
	}
}

666 
	$iwl_mvm_rx_queue_nŸif
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

667 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
)

669 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

670 
iwl_rxq_sync_nŸifiˇti⁄
 *
nŸif
;

671 
iwl_mvm_öã∫Æ_rxq_nŸif
 *
öã∫Æ_nŸif
;

672 
u32
 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

674 
nŸif
 = (*)
pkt
->
d©a
;

675 
öã∫Æ_nŸif
 = (*)
nŸif
->
∑ylﬂd
;

677 i‡(
	`WARN_ONCE
(
Àn
 < (*
nŸif
Ë+ (*
öã∫Æ_nŸif
),

679 
Àn
, ()((*
nŸif
Ë+ (*
öã∫Æ_nŸif
))))

681 
Àn
 -(*
nŸif
Ë+ (*
öã∫Æ_nŸif
);

683 i‡(
	`WARN_ONCE
(
öã∫Æ_nŸif
->
sync
 &&

684 
mvm
->
queue_sync_cookõ
 !
öã∫Æ_nŸif
->
cookõ
,

686 
öã∫Æ_nŸif
->
cookõ
, 
mvm
->
queue_sync_cookõ
, 
queue
))

689 
öã∫Æ_nŸif
->
ty≥
) {

690 
IWL_MVM_RXQ_EMPTY
:

691 
	`WARN_ONCE
(
Àn
, "invalidÉmptyÇotification size %d",Üen);

693 
IWL_MVM_RXQ_NOTIF_DEL_BA
:

694 i‡(
	`WARN_ONCE
(
Àn
 !(
iwl_mvm_dñba_d©a
),

696 
Àn
, ()(
iwl_mvm_dñba_d©a
)))

698 
	`iwl_mvm_dñ_ba
(
mvm
, 
queue
, (*)
öã∫Æ_nŸif
->
d©a
);

701 
	`WARN_ONCE
(1, "InvÆid idítifõ∏%d", 
öã∫Æ_nŸif
->
ty≥
);

704 i‡(
öã∫Æ_nŸif
->
sync
) {

705 
	`WARN_ONCE
(!
	`ã°_™d_˛ór_bô
(
queue
, &
mvm
->
queue_sync_°©e
),

707 
queue
);

708 i‡(
	`READ_ONCE
(
mvm
->
queue_sync_°©e
) == 0)

709 
	`wake_up
(&
mvm
->
rx_sync_waôq
);

711 
	}
}

717 
boﬁ
 
	$iwl_mvm_ª‹dî
(
iwl_mvm
 *
mvm
,

718 
«pi_°ru˘
 *
«pi
,

719 
queue
,

720 
õì80211_°a
 *
°a
,

721 
sk_buff
 *
skb
,

722 
iwl_rx_mpdu_desc
 *
desc
)

724 
õì80211_hdr
 *
hdr
 = (*)
	`skb_mac_hódî
(
skb
);

725 
iwl_mvm_baid_d©a
 *
baid_d©a
;

726 
iwl_mvm_ª‹dî_buf„r
 *
buf„r
;

727 
u32
 
ª‹dî
 = 
	`À32_to_˝u
(
desc
->
ª‹dî_d©a
);

728 
boﬁ
 
amsdu
 = 
desc
->
mac_Êags2
 & 
IWL_RX_MPDU_MFLG2_AMSDU
;

729 
boﬁ
 
œ°_sub‰ame
 =

730 
desc
->
amsdu_öfo
 & 
IWL_RX_MPDU_AMSDU_LAST_SUBFRAME
;

731 
u8
 
tid
 = 
	`õì80211_gë_tid
(
hdr
);

732 
u8
 
sub_‰ame_idx
 = 
desc
->
amsdu_öfo
 &

733 
IWL_RX_MPDU_AMSDU_SUBFRAME_IDX_MASK
;

734 
iwl_mvm_ª‹dî_buf_íåy
 *
íåõs
;

735 
u32
 
°a_mask
;

736 
ödex
;

737 
u16
 
ns¢
, 
¢
;

738 
u8
 
baid
;

740 
baid
 = (
ª‹dî
 & 
IWL_RX_MPDU_REORDER_BAID_MASK
) >>

741 
IWL_RX_MPDU_REORDER_BAID_SHIFT
;

743 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_9000
)

744  
Ál£
;

753 i‡(
baid
 =
IWL_RX_REORDER_DATA_INVALID_BAID
)

754  
Ál£
;

757 i‡(
	`WARN_ONCE
(
	`IS_ERR_OR_NULL
(
°a
),

759  
Ál£
;

762 i‡(!
	`õì80211_is_back_ªq
(
hdr
->
‰ame_c⁄åﬁ
) &&

763 (!
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
) ||

764 
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
)))

765  
Ál£
;

767 i‡(
	`u∆ikñy
(!
	`õì80211_is_d©a_¥e£¡
(
hdr
->
‰ame_c⁄åﬁ
)))

768  
Ál£
;

770 
baid_d©a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
baid_m≠
[
baid
]);

771 i‡(!
baid_d©a
) {

772 
	`IWL_DEBUG_RX
(
mvm
,

774 
baid
, 
ª‹dî
);

775  
Ál£
;

778 
	`rcu_ªad_lock
();

779 
°a_mask
 = 
	`iwl_mvm_°a_fw_id_mask
(
mvm
, 
°a
, -1);

780 
	`rcu_ªad_u∆ock
();

782 i‡(
	`IWL_FW_CHECK
(
mvm
,

783 
tid
 !
baid_d©a
->tid ||

784 !(
°a_mask
 & 
baid_d©a
->sta_mask),

786 
baid
, 
baid_d©a
->
°a_mask
, baid_d©a->
tid
,

787 
°a_mask
, 
tid
))

788  
Ál£
;

790 
ns¢
 = 
ª‹dî
 & 
IWL_RX_MPDU_REORDER_NSSN_MASK
;

791 
¢
 = (
ª‹dî
 & 
IWL_RX_MPDU_REORDER_SN_MASK
) >>

792 
IWL_RX_MPDU_REORDER_SN_SHIFT
;

794 
buf„r
 = &
baid_d©a
->
ª‹dî_buf
[
queue
];

795 
íåõs
 = &
baid_d©a
->íåõs[
queue
 * baid_d©a->
íåõs_≥r_queue
];

797 
	`•ö_lock_bh
(&
buf„r
->
lock
);

799 i‡(!
buf„r
->
vÆid
) {

800 i‡(
ª‹dî
 & 
IWL_RX_MPDU_REORDER_BA_OLD_SN
) {

801 
	`•ö_u∆ock_bh
(&
buf„r
->
lock
);

802  
Ál£
;

804 
buf„r
->
vÆid
 = 
åue
;

808 i‡(
desc
->
°©us
 & 
	`˝u_to_À32
(
IWL_RX_MPDU_STATUS_DUPLICATE
))

809 
dr›
;

812 i‡(
ª‹dî
 & 
IWL_RX_MPDU_REORDER_BA_OLD_SN
)

813 
dr›
;

816 i‡(!
buf„r
->
num_°‹ed
 && 
	`õì80211_¢_Àss
(
¢
, 
ns¢
)) {

817 i‡(!
amsdu
 || 
œ°_sub‰ame
)

818 
buf„r
->
hód_¢
 = 
ns¢
;

820 
	`•ö_u∆ock_bh
(&
buf„r
->
lock
);

821  
Ál£
;

832 i‡(!
buf„r
->
num_°‹ed
 && 
¢
 =buf„r->
hód_¢
) {

833 i‡(!
amsdu
 || 
œ°_sub‰ame
)

834 
buf„r
->
hód_¢
 = 
	`õì80211_¢_öc
(buffer->head_sn);

837 
	`•ö_u∆ock_bh
(&
buf„r
->
lock
);

838  
Ál£
;

842 
ödex
 = 
¢
 % 
buf„r
->
buf_size
;

843 
	`__skb_queue_èû
(&
íåõs
[
ödex
].
‰ames
, 
skb
);

844 
buf„r
->
num_°‹ed
++;

846 i‡(
amsdu
) {

847 
buf„r
->
œ°_amsdu
 = 
¢
;

848 
buf„r
->
œ°_sub_ödex
 = 
sub_‰ame_idx
;

862 i‡(!
amsdu
 || 
œ°_sub‰ame
)

863 
	`iwl_mvm_ªÀa£_‰ames
(
mvm
, 
°a
, 
«pi
, 
baid_d©a
,

864 
buf„r
, 
ns¢
);

866 
	`•ö_u∆ock_bh
(&
buf„r
->
lock
);

867  
åue
;

869 
dr›
:

870 
	`k‰ì_skb
(
skb
);

871 
	`•ö_u∆ock_bh
(&
buf„r
->
lock
);

872  
åue
;

873 
	}
}

875 
	$iwl_mvm_agg_rx_ª˚ived
(
iwl_mvm
 *
mvm
,

876 
u32
 
ª‹dî_d©a
, 
u8
 
baid
)

878 
now
 = 
jiffõs
;

879 
timeout
;

880 
iwl_mvm_baid_d©a
 *
d©a
;

882 
	`rcu_ªad_lock
();

884 
d©a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
baid_m≠
[
baid
]);

885 i‡(!
d©a
) {

886 
	`IWL_DEBUG_RX
(
mvm
,

888 
baid
, 
ª‹dî_d©a
);

889 
out
;

892 i‡(!
d©a
->
timeout
)

893 
out
;

895 
timeout
 = 
d©a
->timeout;

902 i‡(
	`time_bef‹e
(
d©a
->
œ°_rx
 + 
	`TU_TO_JIFFIES
(
timeout
), 
now
))

904 
d©a
->
œ°_rx
 = 
now
;

906 
out
:

907 
	`rcu_ªad_u∆ock
();

908 
	}
}

910 
	$iwl_mvm_Êù_addªss
(
u8
 *
addr
)

912 
i
;

913 
u8
 
mac_addr
[
ETH_ALEN
];

915 
i
 = 0; i < 
ETH_ALEN
; i++)

916 
mac_addr
[
i
] = 
addr
[
ETH_ALEN
 - i - 1];

917 
	`ëhî_addr_c›y
(
addr
, 
mac_addr
);

918 
	}
}

920 
	siwl_mvm_rx_phy_d©a
 {

921 
iwl_rx_phy_öfo_ty≥
 
	möfo_ty≥
;

922 
__À32
 
	md0
, 
	md1
, 
	md2
, 
	md3
, 
	meht_d4
, 
	md5
;

923 
__À16
 
	md4
;

924 
boﬁ
 
	mwôh_d©a
;

925 
boﬁ
 
	mfú°_sub‰ame
;

926 
__À32
 
	mrx_vec
[4];

928 
u32
 
	møã_n_Êags
;

929 
u32
 
	mgp2_⁄_aú_ri£
;

930 
u16
 
	mphy_öfo
;

931 
u8
 
	míîgy_a
, 
	míîgy_b
;

932 
u8
 
	mch™√l
;

935 
	$iwl_mvm_decode_he_mu_ext
(
iwl_mvm
 *
mvm
,

936 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

937 
õì80211_ødiŸ≠_he_mu
 *
he_mu
)

939 
u32
 
phy_d©a2
 = 
	`À32_to_˝u
(
phy_d©a
->
d2
);

940 
u32
 
phy_d©a3
 = 
	`À32_to_˝u
(
phy_d©a
->
d3
);

941 
u16
 
phy_d©a4
 = 
	`À16_to_˝u
(
phy_d©a
->
d4
);

942 
u32
 
øã_n_Êags
 = 
phy_d©a
->rate_n_flags;

944 i‡(
	`FIELD_GET
(
IWL_RX_PHY_DATA4_HE_MU_EXT_CH1_CRC_OK
, 
phy_d©a4
)) {

945 
he_mu
->
Êags1
 |=

946 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_MU_FLAGS1_CH1_RU_KNOWN
 |

947 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_CH1_CTR_26T_RU_KNOWN
);

949 
he_mu
->
Êags1
 |=

950 
	`À16_ícode_bôs
(
	`FIELD_GET
(
IWL_RX_PHY_DATA4_HE_MU_EXT_CH1_CTR_RU
,

951 
phy_d©a4
),

952 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_CH1_CTR_26T_RU
);

954 
he_mu
->
ru_ch1
[0] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA2_HE_MU_EXT_CH1_RU0
,

955 
phy_d©a2
);

956 
he_mu
->
ru_ch1
[1] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA3_HE_MU_EXT_CH1_RU1
,

957 
phy_d©a3
);

958 
he_mu
->
ru_ch1
[2] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA2_HE_MU_EXT_CH1_RU2
,

959 
phy_d©a2
);

960 
he_mu
->
ru_ch1
[3] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA3_HE_MU_EXT_CH1_RU3
,

961 
phy_d©a3
);

964 i‡(
	`FIELD_GET
(
IWL_RX_PHY_DATA4_HE_MU_EXT_CH2_CRC_OK
, 
phy_d©a4
) &&

965 (
øã_n_Êags
 & 
RATE_MCS_CHAN_WIDTH_MSK_V1
Ë!
RATE_MCS_CHAN_WIDTH_20
) {

966 
he_mu
->
Êags1
 |=

967 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_MU_FLAGS1_CH2_RU_KNOWN
 |

968 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_CH2_CTR_26T_RU_KNOWN
);

970 
he_mu
->
Êags2
 |=

971 
	`À16_ícode_bôs
(
	`FIELD_GET
(
IWL_RX_PHY_DATA4_HE_MU_EXT_CH2_CTR_RU
,

972 
phy_d©a4
),

973 
IEEE80211_RADIOTAP_HE_MU_FLAGS2_CH2_CTR_26T_RU
);

975 
he_mu
->
ru_ch2
[0] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA2_HE_MU_EXT_CH2_RU0
,

976 
phy_d©a2
);

977 
he_mu
->
ru_ch2
[1] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA3_HE_MU_EXT_CH2_RU1
,

978 
phy_d©a3
);

979 
he_mu
->
ru_ch2
[2] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA2_HE_MU_EXT_CH2_RU2
,

980 
phy_d©a2
);

981 
he_mu
->
ru_ch2
[3] = 
	`FIELD_GET
(
IWL_RX_PHY_DATA3_HE_MU_EXT_CH2_RU3
,

982 
phy_d©a3
);

984 
	}
}

987 
	$iwl_mvm_decode_he_phy_ru_Æloc
(
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

988 
õì80211_ødiŸ≠_he
 *
he
,

989 
õì80211_ødiŸ≠_he_mu
 *
he_mu
,

990 
õì80211_rx_°©us
 *
rx_°©us
)

1000 
u8
 
ru
 = 
	`À32_gë_bôs
(
phy_d©a
->
d1
, 
IWL_RX_PHY_DATA1_HE_RU_ALLOC_MASK
);

1001 
u32
 
øã_n_Êags
 = 
phy_d©a
->rate_n_flags;

1002 
u32
 
he_ty≥
 = 
øã_n_Êags
 & 
RATE_MCS_HE_TYPE_MSK_V1
;

1003 
u8
 
offs
 = 0;

1005 
rx_°©us
->
bw
 = 
RATE_INFO_BW_HE_RU
;

1007 
he
->
d©a1
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_BW_RU_ALLOC_KNOWN
);

1009 
ru
) {

1011 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_26
;

1012 
offs
 = 
ru
;

1015 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_52
;

1016 
offs
 = 
ru
 - 37;

1019 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_106
;

1020 
offs
 = 
ru
 - 53;

1023 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_242
;

1024 
offs
 = 
ru
 - 61;

1027 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_484
;

1028 
offs
 = 
ru
 - 65;

1031 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_996
;

1034 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_2x996
;

1037 
he
->
d©a2
 |
	`À16_ícode_bôs
(
offs
,

1038 
IEEE80211_RADIOTAP_HE_DATA2_RU_OFFSET
);

1039 
he
->
d©a2
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA2_PRISEC_80_KNOWN
 |

1040 
IEEE80211_RADIOTAP_HE_DATA2_RU_OFFSET_KNOWN
);

1041 i‡(
phy_d©a
->
d1
 & 
	`˝u_to_À32
(
IWL_RX_PHY_DATA1_HE_RU_ALLOC_SEC80
))

1042 
he
->
d©a2
 |=

1043 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA2_PRISEC_80_SEC
);

1045 
	#CHECK_BW
(
bw
) \

1046 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_MU_FLAGS2_BW_FROM_SIG_A_BW_
 ## 
bw
 ## 
MHZ
 != \

1047 
RATE_MCS_CHAN_WIDTH_
##
bw
 >> 
RATE_MCS_CHAN_WIDTH_POS
); \

1048 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA6_TB_PPDU_BW_
 ## 
bw
 ## 
MHZ
 != \

1049 
RATE_MCS_CHAN_WIDTH_
##
bw
 >> 
RATE_MCS_CHAN_WIDTH_POS
)

	)

1050 
	`CHECK_BW
(20);

1051 
	`CHECK_BW
(40);

1052 
	`CHECK_BW
(80);

1053 
	`CHECK_BW
(160);

1055 i‡(
he_mu
)

1056 
he_mu
->
Êags2
 |=

1057 
	`À16_ícode_bôs
(
	`FIELD_GET
(
RATE_MCS_CHAN_WIDTH_MSK_V1
,

1058 
øã_n_Êags
),

1059 
IEEE80211_RADIOTAP_HE_MU_FLAGS2_BW_FROM_SIG_A_BW
);

1060 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_TRIG_V1
)

1061 
he
->
d©a6
 |=

1062 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA6_TB_PPDU_BW_KNOWN
) |

1063 
	`À16_ícode_bôs
(
	`FIELD_GET
(
RATE_MCS_CHAN_WIDTH_MSK_V1
,

1064 
øã_n_Êags
),

1065 
IEEE80211_RADIOTAP_HE_DATA6_TB_PPDU_BW
);

1066 
	}
}

1068 
	$iwl_mvm_decode_he_phy_d©a
(
iwl_mvm
 *
mvm
,

1069 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1070 
õì80211_ødiŸ≠_he
 *
he
,

1071 
õì80211_ødiŸ≠_he_mu
 *
he_mu
,

1072 
õì80211_rx_°©us
 *
rx_°©us
,

1073 
queue
)

1075 
phy_d©a
->
öfo_ty≥
) {

1076 
IWL_RX_PHY_INFO_TYPE_NONE
:

1077 
IWL_RX_PHY_INFO_TYPE_CCK
:

1078 
IWL_RX_PHY_INFO_TYPE_OFDM_LGCY
:

1079 
IWL_RX_PHY_INFO_TYPE_HT
:

1080 
IWL_RX_PHY_INFO_TYPE_VHT_SU
:

1081 
IWL_RX_PHY_INFO_TYPE_VHT_MU
:

1082 
IWL_RX_PHY_INFO_TYPE_EHT_MU
:

1083 
IWL_RX_PHY_INFO_TYPE_EHT_TB
:

1084 
IWL_RX_PHY_INFO_TYPE_EHT_MU_EXT
:

1085 
IWL_RX_PHY_INFO_TYPE_EHT_TB_EXT
:

1087 
IWL_RX_PHY_INFO_TYPE_HE_TB_EXT
:

1088 
he
->
d©a1
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_SPTL_REUSE_KNOWN
 |

1089 
IEEE80211_RADIOTAP_HE_DATA1_SPTL_REUSE2_KNOWN
 |

1090 
IEEE80211_RADIOTAP_HE_DATA1_SPTL_REUSE3_KNOWN
 |

1091 
IEEE80211_RADIOTAP_HE_DATA1_SPTL_REUSE4_KNOWN
);

1092 
he
->
d©a4
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d2
,

1093 
IWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE1
),

1094 
IEEE80211_RADIOTAP_HE_DATA4_TB_SPTL_REUSE1
);

1095 
he
->
d©a4
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d2
,

1096 
IWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE2
),

1097 
IEEE80211_RADIOTAP_HE_DATA4_TB_SPTL_REUSE2
);

1098 
he
->
d©a4
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d2
,

1099 
IWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE3
),

1100 
IEEE80211_RADIOTAP_HE_DATA4_TB_SPTL_REUSE3
);

1101 
he
->
d©a4
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d2
,

1102 
IWL_RX_PHY_DATA2_HE_TB_EXT_SPTL_REUSE4
),

1103 
IEEE80211_RADIOTAP_HE_DATA4_TB_SPTL_REUSE4
);

1104 
ÁŒthrough
;

1105 
IWL_RX_PHY_INFO_TYPE_HE_SU
:

1106 
IWL_RX_PHY_INFO_TYPE_HE_MU
:

1107 
IWL_RX_PHY_INFO_TYPE_HE_MU_EXT
:

1108 
IWL_RX_PHY_INFO_TYPE_HE_TB
:

1110 
he
->
d©a1
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_LDPC_XSYMSEG_KNOWN
 |

1111 
IEEE80211_RADIOTAP_HE_DATA1_DOPPLER_KNOWN
 |

1112 
IEEE80211_RADIOTAP_HE_DATA1_BSS_COLOR_KNOWN
);

1113 
he
->
d©a2
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA2_PRE_FEC_PAD_KNOWN
 |

1114 
IEEE80211_RADIOTAP_HE_DATA2_PE_DISAMBIG_KNOWN
 |

1115 
IEEE80211_RADIOTAP_HE_DATA2_TXOP_KNOWN
 |

1116 
IEEE80211_RADIOTAP_HE_DATA2_NUM_LTF_SYMS_KNOWN
);

1117 
he
->
d©a3
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1118 
IWL_RX_PHY_DATA0_HE_BSS_COLOR_MASK
),

1119 
IEEE80211_RADIOTAP_HE_DATA3_BSS_COLOR
);

1120 i‡(
phy_d©a
->
öfo_ty≥
 !
IWL_RX_PHY_INFO_TYPE_HE_TB
 &&

1121 
phy_d©a
->
öfo_ty≥
 !
IWL_RX_PHY_INFO_TYPE_HE_TB_EXT
) {

1122 
he
->
d©a1
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_UL_DL_KNOWN
);

1123 
he
->
d©a3
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1124 
IWL_RX_PHY_DATA0_HE_UPLINK
),

1125 
IEEE80211_RADIOTAP_HE_DATA3_UL_DL
);

1127 
he
->
d©a3
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1128 
IWL_RX_PHY_DATA0_HE_LDPC_EXT_SYM
),

1129 
IEEE80211_RADIOTAP_HE_DATA3_LDPC_XSYMSEG
);

1130 
he
->
d©a5
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1131 
IWL_RX_PHY_DATA0_HE_PRE_FEC_PAD_MASK
),

1132 
IEEE80211_RADIOTAP_HE_DATA5_PRE_FEC_PAD
);

1133 
he
->
d©a5
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1134 
IWL_RX_PHY_DATA0_HE_PE_DISAMBIG
),

1135 
IEEE80211_RADIOTAP_HE_DATA5_PE_DISAMBIG
);

1136 
he
->
d©a5
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d1
,

1137 
IWL_RX_PHY_DATA1_HE_LTF_NUM_MASK
),

1138 
IEEE80211_RADIOTAP_HE_DATA5_NUM_LTF_SYMS
);

1139 
he
->
d©a6
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1140 
IWL_RX_PHY_DATA0_HE_TXOP_DUR_MASK
),

1141 
IEEE80211_RADIOTAP_HE_DATA6_TXOP
);

1142 
he
->
d©a6
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1143 
IWL_RX_PHY_DATA0_HE_DOPPLER
),

1144 
IEEE80211_RADIOTAP_HE_DATA6_DOPPLER
);

1148 
phy_d©a
->
öfo_ty≥
) {

1149 
IWL_RX_PHY_INFO_TYPE_HE_MU_EXT
:

1150 
IWL_RX_PHY_INFO_TYPE_HE_MU
:

1151 
IWL_RX_PHY_INFO_TYPE_HE_SU
:

1152 
he
->
d©a1
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_SPTL_REUSE_KNOWN
);

1153 
he
->
d©a4
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1154 
IWL_RX_PHY_DATA0_HE_SPATIAL_REUSE_MASK
),

1155 
IEEE80211_RADIOTAP_HE_DATA4_SU_MU_SPTL_REUSE
);

1162 
phy_d©a
->
öfo_ty≥
) {

1163 
IWL_RX_PHY_INFO_TYPE_HE_MU_EXT
:

1164 
he_mu
->
Êags1
 |=

1165 
	`À16_ícode_bôs
(
	`À16_gë_bôs
(
phy_d©a
->
d4
,

1166 
IWL_RX_PHY_DATA4_HE_MU_EXT_SIGB_DCM
),

1167 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_DCM
);

1168 
he_mu
->
Êags1
 |=

1169 
	`À16_ícode_bôs
(
	`À16_gë_bôs
(
phy_d©a
->
d4
,

1170 
IWL_RX_PHY_DATA4_HE_MU_EXT_SIGB_MCS_MASK
),

1171 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_MCS
);

1172 
he_mu
->
Êags2
 |=

1173 
	`À16_ícode_bôs
(
	`À16_gë_bôs
(
phy_d©a
->
d4
,

1174 
IWL_RX_PHY_DATA4_HE_MU_EXT_PREAMBLE_PUNC_TYPE_MASK
),

1175 
IEEE80211_RADIOTAP_HE_MU_FLAGS2_PUNC_FROM_SIG_A_BW
);

1176 
	`iwl_mvm_decode_he_mu_ext
(
mvm
, 
phy_d©a
, 
he_mu
);

1177 
ÁŒthrough
;

1178 
IWL_RX_PHY_INFO_TYPE_HE_MU
:

1179 
he_mu
->
Êags2
 |=

1180 
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d1
,

1181 
IWL_RX_PHY_DATA1_HE_MU_SIBG_SYM_OR_USER_NUM_MASK
),

1182 
IEEE80211_RADIOTAP_HE_MU_FLAGS2_SIG_B_SYMS_USERS
);

1183 
he_mu
->
Êags2
 |=

1184 
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d1
,

1185 
IWL_RX_PHY_DATA1_HE_MU_SIGB_COMPRESSION
),

1186 
IEEE80211_RADIOTAP_HE_MU_FLAGS2_SIG_B_COMP
);

1187 
ÁŒthrough
;

1188 
IWL_RX_PHY_INFO_TYPE_HE_TB
:

1189 
IWL_RX_PHY_INFO_TYPE_HE_TB_EXT
:

1190 
	`iwl_mvm_decode_he_phy_ru_Æloc
(
phy_d©a
, 
he
, 
he_mu
, 
rx_°©us
);

1192 
IWL_RX_PHY_INFO_TYPE_HE_SU
:

1193 
he
->
d©a1
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_BEAM_CHANGE_KNOWN
);

1194 
he
->
d©a3
 |
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d0
,

1195 
IWL_RX_PHY_DATA0_HE_BEAM_CHNG
),

1196 
IEEE80211_RADIOTAP_HE_DATA3_BEAM_CHANGE
);

1202 
	}
}

1204 
	#LE32_DEC_ENC
(
vÆue
, 
dec_bôs
, 
íc_bôs
) \

1205 
	`À32_ícode_bôs
(
	`À32_gë_bôs
(
vÆue
, 
dec_bôs
), 
íc_bôs
)

	)

1207 
	#IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
ö_vÆue
, 
dec_bôs
, 
íc_bôs
) do { \

1208 
	`ty≥of
(
íc_bôs
Ë
_íc_bôs
 =Énc_bits; \

1209 
	`ty≥of
(
usig
Ë
_usig
 = usig; \

1210 (
_usig
)->
mask
 |
	`˝u_to_À32
(
_íc_bôs
); \

1211 (
_usig
)->
vÆue
 |
	`LE32_DEC_ENC
(
ö_vÆue
, 
dec_bôs
, 
_íc_bôs
); \

1212 } 0)

	)

1214 
	#__IWL_MVM_ENC_EHT_RU
(
π_d©a
, 
π_ru
, 
fw_d©a
, 
fw_ru
) \

1215 
eht
->
d©a
[(
π_d©a
)] |= \

1216 (
˝u_to_À32
 \

1217 (
IEEE80211_RADIOTAP_EHT_DATA
 ## 
π_d©a
 ## 
_RU_ALLOC_CC_
 ## 
π_ru
 ## 
_KNOWN
) | \

1218 
	`LE32_DEC_ENC
(
d©a
 ## 
fw_d©a
, \

1219 
IWL_RX_PHY_DATA
 ## 
fw_d©a
 ## 
_EHT_MU_EXT_RU_ALLOC_
 ## 
fw_ru
, \

1220 
IEEE80211_RADIOTAP_EHT_DATA
 ## 
π_d©a
 ## 
_RU_ALLOC_CC_
 ## 
π_ru
))

	)

1222 
	#_IWL_MVM_ENC_EHT_RU
(
π_d©a
, 
π_ru
, 
fw_d©a
, 
fw_ru
) \

1223 
	`__IWL_MVM_ENC_EHT_RU
(
π_d©a
, 
π_ru
, 
fw_d©a
, 
fw_ru
)

	)

1225 
	#IEEE80211_RADIOTAP_RU_DATA_1_1_1
 1

	)

1226 
	#IEEE80211_RADIOTAP_RU_DATA_2_1_1
 2

	)

1227 
	#IEEE80211_RADIOTAP_RU_DATA_1_1_2
 2

	)

1228 
	#IEEE80211_RADIOTAP_RU_DATA_2_1_2
 2

	)

1229 
	#IEEE80211_RADIOTAP_RU_DATA_1_2_1
 3

	)

1230 
	#IEEE80211_RADIOTAP_RU_DATA_2_2_1
 3

	)

1231 
	#IEEE80211_RADIOTAP_RU_DATA_1_2_2
 3

	)

1232 
	#IEEE80211_RADIOTAP_RU_DATA_2_2_2
 4

	)

1234 
	#IWL_RX_RU_DATA_A1
 2

	)

1235 
	#IWL_RX_RU_DATA_A2
 2

	)

1236 
	#IWL_RX_RU_DATA_B1
 2

	)

1237 
	#IWL_RX_RU_DATA_B2
 4

	)

1238 
	#IWL_RX_RU_DATA_C1
 3

	)

1239 
	#IWL_RX_RU_DATA_C2
 3

	)

1240 
	#IWL_RX_RU_DATA_D1
 4

	)

1241 
	#IWL_RX_RU_DATA_D2
 4

	)

1243 
	#IWL_MVM_ENC_EHT_RU
(
π_ru
, 
fw_ru
) \

1244 
	`_IWL_MVM_ENC_EHT_RU
(
IEEE80211_RADIOTAP_RU_DATA_
 ## 
π_ru
, \

1245 
π_ru
, \

1246 
IWL_RX_RU_DATA_
 ## 
fw_ru
, \

1247 
fw_ru
)

	)

1249 
	$iwl_mvm_decode_eht_ext_mu
(
iwl_mvm
 *
mvm
,

1250 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1251 
õì80211_rx_°©us
 *
rx_°©us
,

1252 
õì80211_ødiŸ≠_eht
 *
eht
,

1253 
õì80211_ødiŸ≠_eht_usig
 *
usig
)

1255 i‡(
phy_d©a
->
wôh_d©a
) {

1256 
__À32
 
d©a1
 = 
phy_d©a
->
d1
;

1257 
__À32
 
d©a2
 = 
phy_d©a
->
d2
;

1258 
__À32
 
d©a3
 = 
phy_d©a
->
d3
;

1259 
__À32
 
d©a4
 = 
phy_d©a
->
eht_d4
;

1260 
__À32
 
d©a5
 = 
phy_d©a
->
d5
;

1261 
u32
 
phy_bw
 = 
phy_d©a
->
øã_n_Êags
 & 
RATE_MCS_CHAN_WIDTH_MSK
;

1263 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
d©a5
,

1264 
IWL_RX_PHY_DATA5_EHT_TYPE_AND_COMP
,

1265 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B0_B1_PPDU_TYPE
);

1266 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
d©a5
,

1267 
IWL_RX_PHY_DATA5_EHT_MU_PUNC_CH_CODE
,

1268 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B3_B7_PUNCTURED_INFO
);

1269 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
d©a4
,

1270 
IWL_RX_PHY_DATA4_EHT_MU_EXT_SIGB_MCS
,

1271 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B9_B10_SIG_MCS
);

1272 
IWL_MVM_ENC_USIG_VALUE_MASK


1273 (
usig
, 
d©a1
, 
IWL_RX_PHY_DATA1_EHT_MU_NUM_SIG_SYM_USIGA2
,

1274 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B11_B15_EHT_SIG_SYMBOLS
);

1276 
eht
->
u£r_öfo
[0] |=

1277 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USER_INFO_STA_ID_KNOWN
) |

1278 
	`LE32_DEC_ENC
(
d©a5
, 
IWL_RX_PHY_DATA5_EHT_MU_STA_ID_USR
,

1279 
IEEE80211_RADIOTAP_EHT_USER_INFO_STA_ID
);

1281 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_NR_NON_OFDMA_USERS_M
);

1282 
eht
->
d©a
[7] |
LE32_DEC_ENC


1283 (
d©a5
, 
IWL_RX_PHY_DATA5_EHT_MU_NUM_USR_NON_OFDMA
,

1284 
IEEE80211_RADIOTAP_EHT_DATA7_NUM_OF_NON_OFDMA_USERS
);

1300 
phy_bw
) {

1301 
RATE_MCS_CHAN_WIDTH_320
:

1303 
RATE_MCS_CHAN_WIDTH_160
:

1305 
	`IWL_MVM_ENC_EHT_RU
(1
_2_1
, 
A2
);

1306 
	`IWL_MVM_ENC_EHT_RU
(1
_2_2
, 
C2
);

1308 
	`IWL_MVM_ENC_EHT_RU
(2
_2_1
, 
B2
);

1309 
	`IWL_MVM_ENC_EHT_RU
(2
_2_2
, 
D2
);

1310 
ÁŒthrough
;

1311 
RATE_MCS_CHAN_WIDTH_80
:

1313 
	`IWL_MVM_ENC_EHT_RU
(1
_1_2
, 
C1
);

1315 
	`IWL_MVM_ENC_EHT_RU
(2
_1_2
, 
D1
);

1316 
ÁŒthrough
;

1317 
RATE_MCS_CHAN_WIDTH_40
:

1319 
	`IWL_MVM_ENC_EHT_RU
(2
_1_1
, 
B1
);

1320 
ÁŒthrough
;

1321 
RATE_MCS_CHAN_WIDTH_20
:

1322 
	`IWL_MVM_ENC_EHT_RU
(1
_1_1
, 
A1
);

1326 
__À32
 
usig_a1
 = 
phy_d©a
->
rx_vec
[0];

1327 
__À32
 
usig_a2
 = 
phy_d©a
->
rx_vec
[1];

1329 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a1
,

1330 
IWL_RX_USIG_A1_DISREGARD
,

1331 
IEEE80211_RADIOTAP_EHT_USIG1_MU_B20_B24_DISREGARD
);

1332 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a1
,

1333 
IWL_RX_USIG_A1_VALIDATE
,

1334 
IEEE80211_RADIOTAP_EHT_USIG1_MU_B25_VALIDATE
);

1335 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1336 
IWL_RX_USIG_A2_EHT_PPDU_TYPE
,

1337 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B0_B1_PPDU_TYPE
);

1338 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1339 
IWL_RX_USIG_A2_EHT_USIG2_VALIDATE_B2
,

1340 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B2_VALIDATE
);

1341 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1342 
IWL_RX_USIG_A2_EHT_PUNC_CHANNEL
,

1343 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B3_B7_PUNCTURED_INFO
);

1344 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1345 
IWL_RX_USIG_A2_EHT_USIG2_VALIDATE_B8
,

1346 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B8_VALIDATE
);

1347 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1348 
IWL_RX_USIG_A2_EHT_SIG_MCS
,

1349 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B9_B10_SIG_MCS
);

1350 
IWL_MVM_ENC_USIG_VALUE_MASK


1351 (
usig
, 
usig_a2
, 
IWL_RX_USIG_A2_EHT_SIG_SYM_NUM
,

1352 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B11_B15_EHT_SIG_SYMBOLS
);

1353 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1354 
IWL_RX_USIG_A2_EHT_CRC_OK
,

1355 
IEEE80211_RADIOTAP_EHT_USIG2_MU_B16_B19_CRC
);

1357 
	}
}

1359 
	$iwl_mvm_decode_eht_ext_tb
(
iwl_mvm
 *
mvm
,

1360 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1361 
õì80211_rx_°©us
 *
rx_°©us
,

1362 
õì80211_ødiŸ≠_eht
 *
eht
,

1363 
õì80211_ødiŸ≠_eht_usig
 *
usig
)

1365 i‡(
phy_d©a
->
wôh_d©a
) {

1366 
__À32
 
d©a5
 = 
phy_d©a
->
d5
;

1368 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
d©a5
,

1369 
IWL_RX_PHY_DATA5_EHT_TYPE_AND_COMP
,

1370 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B0_B1_PPDU_TYPE
);

1371 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
d©a5
,

1372 
IWL_RX_PHY_DATA5_EHT_TB_SPATIAL_REUSE1
,

1373 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B3_B6_SPATIAL_REUSE_1
);

1375 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
d©a5
,

1376 
IWL_RX_PHY_DATA5_EHT_TB_SPATIAL_REUSE2
,

1377 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B7_B10_SPATIAL_REUSE_2
);

1379 
__À32
 
usig_a1
 = 
phy_d©a
->
rx_vec
[0];

1380 
__À32
 
usig_a2
 = 
phy_d©a
->
rx_vec
[1];

1382 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a1
,

1383 
IWL_RX_USIG_A1_DISREGARD
,

1384 
IEEE80211_RADIOTAP_EHT_USIG1_TB_B20_B25_DISREGARD
);

1385 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1386 
IWL_RX_USIG_A2_EHT_PPDU_TYPE
,

1387 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B0_B1_PPDU_TYPE
);

1388 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1389 
IWL_RX_USIG_A2_EHT_USIG2_VALIDATE_B2
,

1390 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B2_VALIDATE
);

1391 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1392 
IWL_RX_USIG_A2_EHT_TRIG_SPATIAL_REUSE_1
,

1393 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B3_B6_SPATIAL_REUSE_1
);

1394 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1395 
IWL_RX_USIG_A2_EHT_TRIG_SPATIAL_REUSE_2
,

1396 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B7_B10_SPATIAL_REUSE_2
);

1397 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1398 
IWL_RX_USIG_A2_EHT_TRIG_USIG2_DISREGARD
,

1399 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B11_B15_DISREGARD
);

1400 
	`IWL_MVM_ENC_USIG_VALUE_MASK
(
usig
, 
usig_a2
,

1401 
IWL_RX_USIG_A2_EHT_CRC_OK
,

1402 
IEEE80211_RADIOTAP_EHT_USIG2_TB_B16_B19_CRC
);

1404 
	}
}

1406 
	$iwl_mvm_decode_eht_ru
(
iwl_mvm
 *
mvm
,

1407 
õì80211_rx_°©us
 *
rx_°©us
,

1408 
õì80211_ødiŸ≠_eht
 *
eht
)

1410 
u32
 
ru
 = 
	`À32_gë_bôs
(
eht
->
d©a
[8],

1411 
IEEE80211_RADIOTAP_EHT_DATA8_RU_ALLOC_TB_FMT_B7_B1
);

1412 
∆80211_eht_ru_Æloc
 
∆_ru
;

1418 
ru
) {

1420 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_26
;

1423 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_52
;

1426 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_106
;

1429 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_242
;

1432 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_484
;

1435 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_996
;

1438 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_2x996
;

1441 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_4x996
;

1444 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_52P26
;

1447 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_106P26
;

1450 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_484P242
;

1453 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_996P484
;

1456 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_996P484P242
;

1459 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_2x996P484
;

1462 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_3x996
;

1465 
∆_ru
 = 
NL80211_RATE_INFO_EHT_RU_ALLOC_3x996P484
;

1471 
rx_°©us
->
bw
 = 
RATE_INFO_BW_EHT_RU
;

1472 
rx_°©us
->
eht
.
ru
 = 
∆_ru
;

1473 
	}
}

1475 
	$iwl_mvm_decode_eht_phy_d©a
(
iwl_mvm
 *
mvm
,

1476 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1477 
õì80211_rx_°©us
 *
rx_°©us
,

1478 
õì80211_ødiŸ≠_eht
 *
eht
,

1479 
õì80211_ødiŸ≠_eht_usig
 *
usig
)

1482 
__À32
 
d©a0
 = 
phy_d©a
->
d0
;

1483 
__À32
 
d©a1
 = 
phy_d©a
->
d1
;

1484 
__À32
 
usig_a1
 = 
phy_d©a
->
rx_vec
[0];

1485 
u8
 
öfo_ty≥
 = 
phy_d©a
->info_type;

1488 i‡(
öfo_ty≥
 < 
IWL_RX_PHY_INFO_TYPE_EHT_MU
 ||

1489 
öfo_ty≥
 > 
IWL_RX_PHY_INFO_TYPE_EHT_TB_EXT
)

1492 
usig
->
comm⁄
 |
˝u_to_À32


1493 (
IEEE80211_RADIOTAP_EHT_USIG_COMMON_UL_DL_KNOWN
 |

1494 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_BSS_COLOR_KNOWN
);

1495 i‡(
phy_d©a
->
wôh_d©a
) {

1496 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
d©a0
,

1497 
IWL_RX_PHY_DATA0_EHT_UPLINK
,

1498 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_UL_DL
);

1499 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
d©a0
,

1500 
IWL_RX_PHY_DATA0_EHT_BSS_COLOR_MASK
,

1501 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_BSS_COLOR
);

1503 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
usig_a1
,

1504 
IWL_RX_USIG_A1_UL_FLAG
,

1505 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_UL_DL
);

1506 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
usig_a1
,

1507 
IWL_RX_USIG_A1_BSS_COLOR
,

1508 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_BSS_COLOR
);

1511 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1512 
IWL_UCODE_TLV_CAPA_SNIFF_VALIDATE_SUPPORT
)) {

1513 
usig
->
comm⁄
 |=

1514 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USIG_COMMON_VALIDATE_BITS_CHECKED
);

1515 
usig
->
comm⁄
 |=

1516 
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_VALIDATE
,

1517 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_VALIDATE_BITS_OK
);

1520 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_SPATIAL_REUSE
);

1521 
eht
->
d©a
[0] |
	`LE32_DEC_ENC
(
d©a0
,

1522 
IWL_RX_PHY_DATA0_ETH_SPATIAL_REUSE_MASK
,

1523 
IEEE80211_RADIOTAP_EHT_DATA0_SPATIAL_REUSE
);

1526 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_RU_ALLOC_TB_FMT
);

1527 
eht
->
d©a
[8] |
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_PS160
,

1528 
IEEE80211_RADIOTAP_EHT_DATA8_RU_ALLOC_TB_FMT_PS_160
);

1529 
eht
->
d©a
[8] |
	`LE32_DEC_ENC
(
d©a1
, 
IWL_RX_PHY_DATA1_EHT_RU_ALLOC_B0
,

1530 
IEEE80211_RADIOTAP_EHT_DATA8_RU_ALLOC_TB_FMT_B0
);

1531 
eht
->
d©a
[8] |
	`LE32_DEC_ENC
(
d©a1
, 
IWL_RX_PHY_DATA1_EHT_RU_ALLOC_B1_B7
,

1532 
IEEE80211_RADIOTAP_EHT_DATA8_RU_ALLOC_TB_FMT_B7_B1
);

1534 
	`iwl_mvm_decode_eht_ru
(
mvm
, 
rx_°©us
, 
eht
);

1540 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_PRIMARY_80
);

1541 
eht
->
d©a
[1] |=

1542 
	`À32_ícode_bôs
(
mvm
->
m⁄ô‹_p80
,

1543 
IEEE80211_RADIOTAP_EHT_DATA1_PRIMARY_80
);

1545 
usig
->
comm⁄
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USIG_COMMON_TXOP_KNOWN
);

1546 i‡(
phy_d©a
->
wôh_d©a
)

1547 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_TXOP_DUR_MASK
,

1548 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_TXOP
);

1550 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
usig_a1
, 
IWL_RX_USIG_A1_TXOP_DURATION
,

1551 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_TXOP
);

1553 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_LDPC_EXTRA_SYM_OM
);

1554 
eht
->
d©a
[0] |
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_LDPC_EXT_SYM
,

1555 
IEEE80211_RADIOTAP_EHT_DATA0_LDPC_EXTRA_SYM_OM
);

1557 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_PRE_PADD_FACOR_OM
);

1558 
eht
->
d©a
[0] |
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_PRE_FEC_PAD_MASK
,

1559 
IEEE80211_RADIOTAP_EHT_DATA0_PRE_PADD_FACOR_OM
);

1561 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_PE_DISAMBIGUITY_OM
);

1562 
eht
->
d©a
[0] |
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_PE_DISAMBIG
,

1563 
IEEE80211_RADIOTAP_EHT_DATA0_PE_DISAMBIGUITY_OM
);

1567 i‡(!
	`À32_gë_bôs
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_SIGA_CRC_OK
))

1568 
usig
->
comm⁄
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USIG_COMMON_BAD_USIG_CRC
);

1570 
usig
->
comm⁄
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USIG_COMMON_PHY_VER_KNOWN
);

1571 
usig
->
comm⁄
 |
	`LE32_DEC_ENC
(
d©a0
, 
IWL_RX_PHY_DATA0_EHT_PHY_VER
,

1572 
IEEE80211_RADIOTAP_EHT_USIG_COMMON_PHY_VER
);

1579 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_EHT_LTF
);

1580 
eht
->
d©a
[0] |
	`LE32_DEC_ENC
(
d©a1
, 
IWL_RX_PHY_DATA1_EHT_SIG_LTF_NUM
,

1581 
IEEE80211_RADIOTAP_EHT_DATA0_EHT_LTF
);

1583 i‡(
öfo_ty≥
 =
IWL_RX_PHY_INFO_TYPE_EHT_TB_EXT
 ||

1584 
öfo_ty≥
 =
IWL_RX_PHY_INFO_TYPE_EHT_TB
)

1585 
	`iwl_mvm_decode_eht_ext_tb
(
mvm
, 
phy_d©a
, 
rx_°©us
, 
eht
, 
usig
);

1587 i‡(
öfo_ty≥
 =
IWL_RX_PHY_INFO_TYPE_EHT_MU_EXT
 ||

1588 
öfo_ty≥
 =
IWL_RX_PHY_INFO_TYPE_EHT_MU
)

1589 
	`iwl_mvm_decode_eht_ext_mu
(
mvm
, 
phy_d©a
, 
rx_°©us
, 
eht
, 
usig
);

1590 
	}
}

1592 
	$iwl_mvm_rx_eht
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1593 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1594 
queue
)

1596 
õì80211_rx_°©us
 *
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1598 
õì80211_ødiŸ≠_eht
 *
eht
;

1599 
õì80211_ødiŸ≠_eht_usig
 *
usig
;

1600 
size_t
 
eht_Àn
 = (*
eht
);

1602 
u32
 
øã_n_Êags
 = 
phy_d©a
->rate_n_flags;

1603 
u32
 
he_ty≥
 = 
øã_n_Êags
 & 
RATE_MCS_HE_TYPE_MSK
;

1605 
u8
 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_UNKNOWN
;

1606 
u16
 
phy_öfo
 = 
phy_d©a
->phy_info;

1607 
u32
 
bw
;

1610 i‡(
phy_d©a
->
wôh_d©a
)

1611 
eht_Àn
 +(
u32
);

1613 
eht
 = 
	`iwl_mvm_ødiŸ≠_put_év
(
skb
, 
IEEE80211_RADIOTAP_EHT
, 
eht_Àn
);

1615 
usig
 = 
	`iwl_mvm_ødiŸ≠_put_év
(
skb
, 
IEEE80211_RADIOTAP_EHT_USIG
,

1616 (*
usig
));

1617 
rx_°©us
->
Êag
 |
RX_FLAG_RADIOTAP_TLV_AT_END
;

1618 
usig
->
comm⁄
 |=

1619 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USIG_COMMON_BW_KNOWN
);

1622 
bw
 = 
	`FIELD_GET
(
RATE_MCS_CHAN_WIDTH_MSK
, 
øã_n_Êags
);

1623 i‡(
bw
 =
RATE_MCS_CHAN_WIDTH_320_VAL
)

1624 
bw
 +
	`FIELD_GET
(
IWL_RX_PHY_DATA0_EHT_BW320_SLOT
,

1625 
	`À32_to_˝u
(
phy_d©a
->
d0
));

1627 
usig
->
comm⁄
 |
˝u_to_À32


1628 (
	`FIELD_PREP
(
IEEE80211_RADIOTAP_EHT_USIG_COMMON_BW
, 
bw
));

1631 i‡(!
queue
 && !(
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU
)) {

1632 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_DETAILS
;

1633 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT_KNOWN
;

1634 i‡(
phy_d©a
->
d0
 & 
	`˝u_to_À32
(
IWL_RX_PHY_DATA0_EHT_DELIM_EOF
))

1635 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT
;

1639 i‡(!
queue
 && (
phy_öfo
 & 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
) &&

1640 (
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU
Ë&& 
phy_d©a
->
fú°_sub‰ame
) {

1641 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT_KNOWN
;

1642 i‡(
phy_d©a
->
d0
 & 
	`˝u_to_À32
(
IWL_RX_PHY_DATA0_EHT_DELIM_EOF
))

1643 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT
;

1646 i‡(
phy_öfo
 & 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
)

1647 
	`iwl_mvm_decode_eht_phy_d©a
(
mvm
, 
phy_d©a
, 
rx_°©us
, 
eht
, 
usig
);

1649 
	#CHECK_TYPE
(
F
) \

1650 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA1_FORMAT_
 ## 
F
 != \

1651 (
RATE_MCS_HE_TYPE_
 ## 
F
 >> 
RATE_MCS_HE_TYPE_POS
))

	)

1653 
	`CHECK_TYPE
(
SU
);

1654 
	`CHECK_TYPE
(
EXT_SU
);

1655 
	`CHECK_TYPE
(
MU
);

1656 
	`CHECK_TYPE
(
TRIG
);

1658 
	`FIELD_GET
(
RATE_MCS_HE_GI_LTF_MSK
, 
øã_n_Êags
)) {

1660 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_TRIG
) {

1661 
rx_°©us
->
eht
.
gi
 = 
NL80211_RATE_INFO_EHT_GI_1_6
;

1662 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_1X
;

1664 
rx_°©us
->
eht
.
gi
 = 
NL80211_RATE_INFO_EHT_GI_0_8
;

1665 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_2X
;

1669 
rx_°©us
->
eht
.
gi
 = 
NL80211_RATE_INFO_EHT_GI_1_6
;

1670 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_2X
;

1673 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_4X
;

1674 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_TRIG
)

1675 
rx_°©us
->
eht
.
gi
 = 
NL80211_RATE_INFO_EHT_GI_3_2
;

1677 
rx_°©us
->
eht
.
gi
 = 
NL80211_RATE_INFO_EHT_GI_0_8
;

1680 i‡(
he_ty≥
 !
RATE_MCS_HE_TYPE_TRIG
) {

1681 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_4X
;

1682 
rx_°©us
->
eht
.
gi
 = 
NL80211_RATE_INFO_EHT_GI_3_2
;

1690 i‡(
…f
 !
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_UNKNOWN
) {

1691 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_GI
);

1692 
eht
->
d©a
[0] |
˝u_to_À32


1693 (
	`FIELD_PREP
(
IEEE80211_RADIOTAP_EHT_DATA0_LTF
,

1694 
…f
) |

1695 
	`FIELD_PREP
(
IEEE80211_RADIOTAP_EHT_DATA0_GI
,

1696 
rx_°©us
->
eht
.
gi
));

1700 i‡(!
phy_d©a
->
wôh_d©a
) {

1701 
eht
->
known
 |
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_KNOWN_NSS_S
 |

1702 
IEEE80211_RADIOTAP_EHT_KNOWN_BEAMFORMED_S
);

1703 
eht
->
d©a
[7] |=

1704 
	`À32_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
rx_vec
[2],

1705 
RX_NO_DATA_RX_VEC2_EHT_NSTS_MSK
),

1706 
IEEE80211_RADIOTAP_EHT_DATA7_NSS_S
);

1707 i‡(
øã_n_Êags
 & 
RATE_MCS_BF_MSK
)

1708 
eht
->
d©a
[7] |=

1709 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_DATA7_BEAMFORMED_S
);

1711 
eht
->
u£r_öfo
[0] |=

1712 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USER_INFO_MCS_KNOWN
 |

1713 
IEEE80211_RADIOTAP_EHT_USER_INFO_CODING_KNOWN
 |

1714 
IEEE80211_RADIOTAP_EHT_USER_INFO_NSS_KNOWN_O
 |

1715 
IEEE80211_RADIOTAP_EHT_USER_INFO_BEAMFORMING_KNOWN_O
 |

1716 
IEEE80211_RADIOTAP_EHT_USER_INFO_DATA_FOR_USER
);

1718 i‡(
øã_n_Êags
 & 
RATE_MCS_BF_MSK
)

1719 
eht
->
u£r_öfo
[0] |=

1720 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USER_INFO_BEAMFORMING_O
);

1722 i‡(
øã_n_Êags
 & 
RATE_MCS_LDPC_MSK
)

1723 
eht
->
u£r_öfo
[0] |=

1724 
	`˝u_to_À32
(
IEEE80211_RADIOTAP_EHT_USER_INFO_CODING
);

1726 
eht
->
u£r_öfo
[0] |
˝u_to_À32


1727 (
	`FIELD_PREP
(
IEEE80211_RADIOTAP_EHT_USER_INFO_MCS
,

1728 
	`FIELD_GET
(
RATE_VHT_MCS_RATE_CODE_MSK
,

1729 
øã_n_Êags
)) |

1730 
	`FIELD_PREP
(
IEEE80211_RADIOTAP_EHT_USER_INFO_NSS_O
,

1731 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã_n_Êags
)));

1733 
	}
}

1735 
	$iwl_mvm_rx_he
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1736 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1737 
queue
)

1739 
õì80211_rx_°©us
 *
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1740 
õì80211_ødiŸ≠_he
 *
he
 = 
NULL
;

1741 
õì80211_ødiŸ≠_he_mu
 *
he_mu
 = 
NULL
;

1742 
u32
 
øã_n_Êags
 = 
phy_d©a
->rate_n_flags;

1743 
u32
 
he_ty≥
 = 
øã_n_Êags
 & 
RATE_MCS_HE_TYPE_MSK
;

1744 
u8
 
…f
;

1745 c⁄° 
õì80211_ødiŸ≠_he
 
known
 = {

1746 .
d©a1
 = 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_DATA_MCS_KNOWN
 |

1747 
IEEE80211_RADIOTAP_HE_DATA1_DATA_DCM_KNOWN
 |

1748 
IEEE80211_RADIOTAP_HE_DATA1_STBC_KNOWN
 |

1749 
IEEE80211_RADIOTAP_HE_DATA1_CODING_KNOWN
),

1750 .
d©a2
 = 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA2_GI_KNOWN
 |

1751 
IEEE80211_RADIOTAP_HE_DATA2_TXBF_KNOWN
),

1753 c⁄° 
õì80211_ødiŸ≠_he_mu
 
mu_known
 = {

1754 .
Êags1
 = 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_MCS_KNOWN
 |

1755 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_DCM_KNOWN
 |

1756 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_SYMS_USERS_KNOWN
 |

1757 
IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_COMP_KNOWN
),

1758 .
Êags2
 = 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_MU_FLAGS2_PUNC_FROM_SIG_A_BW_KNOWN
 |

1759 
IEEE80211_RADIOTAP_HE_MU_FLAGS2_BW_FROM_SIG_A_BW_KNOWN
),

1761 
u16
 
phy_öfo
 = 
phy_d©a
->phy_info;

1763 
he
 = 
	`skb_put_d©a
(
skb
, &
known
, (known));

1764 
rx_°©us
->
Êag
 |
RX_FLAG_RADIOTAP_HE
;

1766 i‡(
phy_d©a
->
öfo_ty≥
 =
IWL_RX_PHY_INFO_TYPE_HE_MU
 ||

1767 
phy_d©a
->
öfo_ty≥
 =
IWL_RX_PHY_INFO_TYPE_HE_MU_EXT
) {

1768 
he_mu
 = 
	`skb_put_d©a
(
skb
, &
mu_known
, (mu_known));

1769 
rx_°©us
->
Êag
 |
RX_FLAG_RADIOTAP_HE_MU
;

1773 i‡(!
queue
 && !(
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU
)) {

1774 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_DETAILS
;

1775 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT_KNOWN
;

1776 i‡(
phy_d©a
->
d0
 & 
	`˝u_to_À32
(
IWL_RX_PHY_DATA0_HE_DELIM_EOF
))

1777 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT
;

1780 i‡(
phy_öfo
 & 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
)

1781 
	`iwl_mvm_decode_he_phy_d©a
(
mvm
, 
phy_d©a
, 
he
, 
he_mu
, 
rx_°©us
,

1782 
queue
);

1785 i‡(!
queue
 && (
phy_öfo
 & 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
) &&

1786 (
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU
Ë&& 
phy_d©a
->
fú°_sub‰ame
) {

1787 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT_KNOWN
;

1788 i‡(
phy_d©a
->
d0
 & 
	`˝u_to_À32
(
IWL_RX_PHY_DATA0_EHT_DELIM_EOF
))

1789 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_EOF_BIT
;

1792 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_EXT_SU
 &&

1793 
øã_n_Êags
 & 
RATE_MCS_HE_106T_MSK
) {

1794 
rx_°©us
->
bw
 = 
RATE_INFO_BW_HE_RU
;

1795 
rx_°©us
->
he_ru
 = 
NL80211_RATE_INFO_HE_RU_ALLOC_106
;

1799 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_SU
 ||

1800 
he_ty≥
 =
RATE_MCS_HE_TYPE_EXT_SU
)

1801 
he
->
d©a1
 |=

1802 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA1_BW_RU_ALLOC_KNOWN
);

1804 
	#CHECK_TYPE
(
F
) \

1805 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA1_FORMAT_
 ## 
F
 != \

1806 (
RATE_MCS_HE_TYPE_
 ## 
F
 >> 
RATE_MCS_HE_TYPE_POS
))

	)

1808 
	`CHECK_TYPE
(
SU
);

1809 
	`CHECK_TYPE
(
EXT_SU
);

1810 
	`CHECK_TYPE
(
MU
);

1811 
	`CHECK_TYPE
(
TRIG
);

1813 
he
->
d©a1
 |
	`˝u_to_À16
(
he_ty≥
 >> 
RATE_MCS_HE_TYPE_POS
);

1815 i‡(
øã_n_Êags
 & 
RATE_MCS_BF_MSK
)

1816 
he
->
d©a5
 |
	`˝u_to_À16
(
IEEE80211_RADIOTAP_HE_DATA5_TXBF
);

1818 (
øã_n_Êags
 & 
RATE_MCS_HE_GI_LTF_MSK
) >>

1819 
RATE_MCS_HE_GI_LTF_POS
) {

1821 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_TRIG
)

1822 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_1_6
;

1824 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_0_8
;

1825 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_MU
)

1826 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_4X
;

1828 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_1X
;

1831 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_TRIG
)

1832 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_1_6
;

1834 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_0_8
;

1835 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_2X
;

1838 i‡(
he_ty≥
 =
RATE_MCS_HE_TYPE_TRIG
) {

1839 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_3_2
;

1840 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_4X
;

1842 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_1_6
;

1843 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_2X
;

1847 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_3_2
;

1848 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_4X
;

1851 
rx_°©us
->
he_gi
 = 
NL80211_RATE_INFO_HE_GI_0_8
;

1852 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_4X
;

1855 
…f
 = 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE_UNKNOWN
;

1858 
he
->
d©a5
 |
	`À16_ícode_bôs
(
…f
,

1859 
IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE
);

1860 
	}
}

1862 
	$iwl_mvm_decode_lsig
(
sk_buff
 *
skb
,

1863 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
)

1865 
õì80211_rx_°©us
 *
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1866 
õì80211_ødiŸ≠_lsig
 *
lsig
;

1868 
phy_d©a
->
öfo_ty≥
) {

1869 
IWL_RX_PHY_INFO_TYPE_HT
:

1870 
IWL_RX_PHY_INFO_TYPE_VHT_SU
:

1871 
IWL_RX_PHY_INFO_TYPE_VHT_MU
:

1872 
IWL_RX_PHY_INFO_TYPE_HE_TB_EXT
:

1873 
IWL_RX_PHY_INFO_TYPE_HE_SU
:

1874 
IWL_RX_PHY_INFO_TYPE_HE_MU
:

1875 
IWL_RX_PHY_INFO_TYPE_HE_MU_EXT
:

1876 
IWL_RX_PHY_INFO_TYPE_HE_TB
:

1877 
IWL_RX_PHY_INFO_TYPE_EHT_MU
:

1878 
IWL_RX_PHY_INFO_TYPE_EHT_TB
:

1879 
IWL_RX_PHY_INFO_TYPE_EHT_MU_EXT
:

1880 
IWL_RX_PHY_INFO_TYPE_EHT_TB_EXT
:

1881 
lsig
 = 
	`skb_put
(
skb
, (*lsig));

1882 
lsig
->
d©a1
 = 
	`˝u_to_À16
(
IEEE80211_RADIOTAP_LSIG_DATA1_LENGTH_KNOWN
);

1883 
lsig
->
d©a2
 = 
	`À16_ícode_bôs
(
	`À32_gë_bôs
(
phy_d©a
->
d1
,

1884 
IWL_RX_PHY_DATA1_LSIG_LEN_MASK
),

1885 
IEEE80211_RADIOTAP_LSIG_DATA2_LENGTH
);

1886 
rx_°©us
->
Êag
 |
RX_FLAG_RADIOTAP_LSIG
;

1891 
	}
}

1893 
ölöe
 
u8
 
	$iwl_mvm_∆80211_b™d_‰om_rx_msdu
(
u8
 
phy_b™d
)

1895 
phy_b™d
) {

1896 
PHY_BAND_24
:

1897  
NL80211_BAND_2GHZ
;

1898 
PHY_BAND_5
:

1899  
NL80211_BAND_5GHZ
;

1900 
PHY_BAND_6
:

1901  
NL80211_BAND_6GHZ
;

1903 
	`WARN_ONCE
(1, "Unsuµ‹ãdÖhy b™d (%u)\n", 
phy_b™d
);

1904  
NL80211_BAND_5GHZ
;

1906 
	}
}

1908 
	siwl_rx_°a_cß
 {

1909 
boﬁ
 
	mÆl_°a_unblocked
;

1910 
õì80211_vif
 *
	mvif
;

1913 
	$iwl_mvm_rx_gë_°a_block_tx
(*
d©a
, 
õì80211_°a
 *
°a
)

1915 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1916 
iwl_rx_°a_cß
 *
rx_°a_cß
 = 
d©a
;

1918 i‡(
mvm°a
->
vif
 !
rx_°a_cß
->vif)

1921 i‡(
mvm°a
->
dißbÀ_tx
)

1922 
rx_°a_cß
->
Æl_°a_unblocked
 = 
Ál£
;

1923 
	}
}

1929 
	$iwl_mvm_rx_fûl_°©us
(
iwl_mvm
 *
mvm
,

1930 
sk_buff
 *
skb
,

1931 
iwl_mvm_rx_phy_d©a
 *
phy_d©a
,

1932 
queue
)

1934 
õì80211_rx_°©us
 *
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1935 
u32
 
øã_n_Êags
 = 
phy_d©a
->rate_n_flags;

1936 
u8
 
°bc
 = 
	`u32_gë_bôs
(
øã_n_Êags
, 
RATE_MCS_STBC_MSK
);

1937 
u32
 
f‹m©
 = 
øã_n_Êags
 & 
RATE_MCS_MOD_TYPE_MSK
;

1938 
boﬁ
 
is_sgi
;

1940 
phy_d©a
->
öfo_ty≥
 = 
IWL_RX_PHY_INFO_TYPE_NONE
;

1942 i‡(
phy_d©a
->
phy_öfo
 & 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
)

1943 
phy_d©a
->
öfo_ty≥
 =

1944 
	`À32_gë_bôs
(
phy_d©a
->
d1
,

1945 
IWL_RX_PHY_DATA1_INFO_TYPE_MASK
);

1948 
øã_n_Êags
 & 
RATE_MCS_CHAN_WIDTH_MSK
) {

1949 
RATE_MCS_CHAN_WIDTH_20
:

1951 
RATE_MCS_CHAN_WIDTH_40
:

1952 
rx_°©us
->
bw
 = 
RATE_INFO_BW_40
;

1954 
RATE_MCS_CHAN_WIDTH_80
:

1955 
rx_°©us
->
bw
 = 
RATE_INFO_BW_80
;

1957 
RATE_MCS_CHAN_WIDTH_160
:

1958 
rx_°©us
->
bw
 = 
RATE_INFO_BW_160
;

1960 
RATE_MCS_CHAN_WIDTH_320
:

1961 
rx_°©us
->
bw
 = 
RATE_INFO_BW_320
;

1966 i‡(
f‹m©
 =
RATE_MCS_HE_MSK
)

1967 
	`iwl_mvm_rx_he
(
mvm
, 
skb
, 
phy_d©a
, 
queue
);

1969 
	`iwl_mvm_decode_lsig
(
skb
, 
phy_d©a
);

1971 
rx_°©us
->
devi˚_time°amp
 = 
phy_d©a
->
gp2_⁄_aú_ri£
;

1972 
rx_°©us
->
‰eq
 = 
	`õì80211_ch™√l_to_‰equícy
(
phy_d©a
->
ch™√l
,

1973 
rx_°©us
->
b™d
);

1974 
	`iwl_mvm_gë_sig«l_°ªngth
(
mvm
, 
rx_°©us
, 
øã_n_Êags
,

1975 
phy_d©a
->
íîgy_a
,Öhy_d©a->
íîgy_b
);

1978 i‡(
f‹m©
 =
RATE_MCS_EHT_MSK
)

1979 
	`iwl_mvm_rx_eht
(
mvm
, 
skb
, 
phy_d©a
, 
queue
);

1981 i‡(
	`u∆ikñy
(
mvm
->
m⁄ô‹_⁄
))

1982 
	`iwl_mvm_add_π≠_¢if„r_c⁄fig
(
mvm
, 
skb
);

1984 
is_sgi
 = 
f‹m©
 =
RATE_MCS_HE_MSK
 ?

1985 
	`iwl_he_is_sgi
(
øã_n_Êags
) :

1986 
øã_n_Êags
 & 
RATE_MCS_SGI_MSK
;

1988 i‡(!(
f‹m©
 =
RATE_MCS_CCK_MSK
Ë&& 
is_sgi
)

1989 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_SHORT_GI
;

1991 i‡(
øã_n_Êags
 & 
RATE_MCS_LDPC_MSK
)

1992 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_LDPC
;

1994 
f‹m©
) {

1995 
RATE_MCS_VHT_MSK
:

1996 
rx_°©us
->
ícodög
 = 
RX_ENC_VHT
;

1998 
RATE_MCS_HE_MSK
:

1999 
rx_°©us
->
ícodög
 = 
RX_ENC_HE
;

2000 
rx_°©us
->
he_dcm
 =

2001 !!(
øã_n_Êags
 & 
RATE_HE_DUAL_CARRIER_MODE_MSK
);

2003 
RATE_MCS_EHT_MSK
:

2004 
rx_°©us
->
ícodög
 = 
RX_ENC_EHT
;

2008 
f‹m©
) {

2009 
RATE_MCS_HT_MSK
:

2010 
rx_°©us
->
ícodög
 = 
RX_ENC_HT
;

2011 
rx_°©us
->
øã_idx
 = 
	`RATE_HT_MCS_INDEX
(
øã_n_Êags
);

2012 
rx_°©us
->
íc_Êags
 |
°bc
 << 
RX_ENC_FLAG_STBC_SHIFT
;

2014 
RATE_MCS_VHT_MSK
:

2015 
RATE_MCS_HE_MSK
:

2016 
RATE_MCS_EHT_MSK
:

2017 
rx_°©us
->
nss
 =

2018 
	`u32_gë_bôs
(
øã_n_Êags
, 
RATE_MCS_NSS_MSK
) + 1;

2019 
rx_°©us
->
øã_idx
 = 
øã_n_Êags
 & 
RATE_MCS_CODE_MSK
;

2020 
rx_°©us
->
íc_Êags
 |
°bc
 << 
RX_ENC_FLAG_STBC_SHIFT
;

2023 
øã
 = 
	`iwl_mvm_Àgacy_hw_idx_to_mac80211_idx
(
øã_n_Êags
,

2024 
rx_°©us
->
b™d
);

2026 
rx_°©us
->
øã_idx
 = 
øã
;

2028 i‡((
øã
 < 0 ||Ñate > 0xFF)) {

2029 
rx_°©us
->
øã_idx
 = 0;

2030 i‡(
	`√t_øãlimô
())

2031 
	`IWL_ERR
(
mvm
, "InvalidÑate flags 0x%x, band %d,\n",

2032 
øã_n_Êags
, 
rx_°©us
->
b™d
);

2038 
	}
}

2040 
	$iwl_mvm_rx_mpdu_mq
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

2041 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
)

2043 
õì80211_rx_°©us
 *
rx_°©us
;

2044 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2045 
iwl_rx_mpdu_desc
 *
desc
 = (*)
pkt
->
d©a
;

2046 
õì80211_hdr
 *
hdr
;

2047 
u32
 
Àn
;

2048 
u32
 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

2049 
õì80211_°a
 *
°a
 = 
NULL
;

2050 
õì80211_lök_°a
 *
lök_°a
 = 
NULL
;

2051 
sk_buff
 *
skb
;

2052 
u8
 
¸y±_Àn
 = 0;

2053 
size_t
 
desc_size
;

2054 
iwl_mvm_rx_phy_d©a
 
phy_d©a
 = {};

2055 
u32
 
f‹m©
;

2057 i‡(
	`u∆ikñy
(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)))

2060 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

2061 
desc_size
 = (*
desc
);

2063 
desc_size
 = 
IWL_RX_DESC_SIZE_V1
;

2065 i‡(
	`u∆ikñy
(
pkt_Àn
 < 
desc_size
)) {

2066 
	`IWL_DEBUG_DROP
(
mvm
, "Bad REPLY_RX_MPDU_CMD size\n");

2070 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

2071 
phy_d©a
.
øã_n_Êags
 = 
	`À32_to_˝u
(
desc
->
v3
.rate_n_flags);

2072 
phy_d©a
.
ch™√l
 = 
desc
->
v3
.channel;

2073 
phy_d©a
.
gp2_⁄_aú_ri£
 = 
	`À32_to_˝u
(
desc
->
v3
.gp2_on_air_rise);

2074 
phy_d©a
.
íîgy_a
 = 
desc
->
v3
.energy_a;

2075 
phy_d©a
.
íîgy_b
 = 
desc
->
v3
.energy_b;

2077 
phy_d©a
.
d0
 = 
desc
->
v3
.
phy_d©a0
;

2078 
phy_d©a
.
d1
 = 
desc
->
v3
.
phy_d©a1
;

2079 
phy_d©a
.
d2
 = 
desc
->
v3
.
phy_d©a2
;

2080 
phy_d©a
.
d3
 = 
desc
->
v3
.
phy_d©a3
;

2081 
phy_d©a
.
eht_d4
 = 
desc
->
phy_eht_d©a4
;

2082 
phy_d©a
.
d5
 = 
desc
->
v3
.
phy_d©a5
;

2084 
phy_d©a
.
øã_n_Êags
 = 
	`À32_to_˝u
(
desc
->
v1
.rate_n_flags);

2085 
phy_d©a
.
ch™√l
 = 
desc
->
v1
.channel;

2086 
phy_d©a
.
gp2_⁄_aú_ri£
 = 
	`À32_to_˝u
(
desc
->
v1
.gp2_on_air_rise);

2087 
phy_d©a
.
íîgy_a
 = 
desc
->
v1
.energy_a;

2088 
phy_d©a
.
íîgy_b
 = 
desc
->
v1
.energy_b;

2090 
phy_d©a
.
d0
 = 
desc
->
v1
.
phy_d©a0
;

2091 
phy_d©a
.
d1
 = 
desc
->
v1
.
phy_d©a1
;

2092 
phy_d©a
.
d2
 = 
desc
->
v1
.
phy_d©a2
;

2093 
phy_d©a
.
d3
 = 
desc
->
v1
.
phy_d©a3
;

2096 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

2097 
REPLY_RX_MPDU_CMD
, 0) < 4) {

2098 
phy_d©a
.
øã_n_Êags
 = 
	`iwl_√w_øã_‰om_v1
(phy_data.rate_n_flags);

2099 
	`IWL_DEBUG_DROP
(
mvm
, "Got old formatÑate, converting. NewÑate: 0x%x\n",

2100 
phy_d©a
.
øã_n_Êags
);

2103 
f‹m©
 = 
phy_d©a
.
øã_n_Êags
 & 
RATE_MCS_MOD_TYPE_MSK
;

2105 
Àn
 = 
	`À16_to_˝u
(
desc
->
mpdu_Àn
);

2107 i‡(
	`u∆ikñy
(
Àn
 + 
desc_size
 > 
pkt_Àn
)) {

2108 
	`IWL_DEBUG_DROP
(
mvm
, "FWÜiedáboutÖacketÜen\n");

2112 
phy_d©a
.
wôh_d©a
 = 
åue
;

2113 
phy_d©a
.
phy_öfo
 = 
	`À16_to_˝u
(
desc
->phy_info);

2114 
phy_d©a
.
d4
 = 
desc
->
phy_d©a4
;

2116 
hdr
 = (*)(
pkt
->
d©a
 + 
desc_size
);

2120 
skb
 = 
	`Æloc_skb
(128, 
GFP_ATOMIC
);

2121 i‡(!
skb
) {

2122 
	`IWL_ERR
(
mvm
, "alloc_skb failed\n");

2126 i‡(
desc
->
mac_Êags2
 & 
IWL_RX_MPDU_MFLG2_PAD
) {

2133 
	`skb_ª£rve
(
skb
, 2);

2136 
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

2142 i‡(!(
desc
->
°©us
 & 
	`˝u_to_À32
(
IWL_RX_MPDU_STATUS_CRC_OK
)) ||

2143 !(
desc
->
°©us
 & 
	`˝u_to_À32
(
IWL_RX_MPDU_STATUS_OVERRUN_OK
))) {

2144 
	`IWL_DEBUG_RX
(
mvm
, "Bad CRC or FIFO: 0x%08X.\n",

2145 
	`À32_to_˝u
(
desc
->
°©us
));

2146 
rx_°©us
->
Êag
 |
RX_FLAG_FAILED_FCS_CRC
;

2150 i‡(
f‹m©
 =
RATE_MCS_CCK_MSK
 &&

2151 
phy_d©a
.
phy_öfo
 & 
IWL_RX_MPDU_PHY_SHORT_PREAMBLE
)

2152 
rx_°©us
->
íc_Êags
 |
RX_ENC_FLAG_SHORTPRE
;

2154 i‡(
	`likñy
(!(
phy_d©a
.
phy_öfo
 & 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
))) {

2155 
u64
 
tsf_⁄_aú_ri£
;

2157 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

2158 
IWL_DEVICE_FAMILY_AX210
)

2159 
tsf_⁄_aú_ri£
 = 
	`À64_to_˝u
(
desc
->
v3
.tsf_on_air_rise);

2161 
tsf_⁄_aú_ri£
 = 
	`À64_to_˝u
(
desc
->
v1
.tsf_on_air_rise);

2163 
rx_°©us
->
ma˘ime
 = 
tsf_⁄_aú_ri£
;

2165 
rx_°©us
->
Êag
 |
RX_FLAG_MACTIME_PLCP_START
;

2168 i‡(
	`iwl_mvm_is_b™d_ö_rx_suµ‹ãd
(
mvm
)) {

2169 
u8
 
b™d
 = 
	`BAND_IN_RX_STATUS
(
desc
->
mac_phy_idx
);

2171 
rx_°©us
->
b™d
 = 
	`iwl_mvm_∆80211_b™d_‰om_rx_msdu
(band);

2173 
rx_°©us
->
b™d
 = 
phy_d©a
.
ch™√l
 > 14 ? 
NL80211_BAND_5GHZ
 :

2174 
NL80211_BAND_2GHZ
;

2178 i‡(!
queue
 && (
phy_d©a
.
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU
)) {

2179 
boﬁ
 
toggÀ_bô
;

2181 
toggÀ_bô
 = 
phy_d©a
.
phy_öfo
 & 
IWL_RX_MPDU_PHY_AMPDU_TOGGLE
;

2182 
rx_°©us
->
Êag
 |
RX_FLAG_AMPDU_DETAILS
;

2188 i‡(
toggÀ_bô
 !
mvm
->
ampdu_toggÀ
) {

2189 
mvm
->
ampdu_ªf
++;

2190 i‡(
mvm
->
ampdu_ªf
 == 0)

2191 
mvm
->
ampdu_ªf
++;

2192 
mvm
->
ampdu_toggÀ
 = 
toggÀ_bô
;

2193 
phy_d©a
.
fú°_sub‰ame
 = 
åue
;

2195 
rx_°©us
->
ampdu_ª„ªn˚
 = 
mvm
->
ampdu_ªf
;

2198 
	`rcu_ªad_lock
();

2200 i‡(
desc
->
°©us
 & 
	`˝u_to_À32
(
IWL_RX_MPDU_STATUS_SRC_STA_FOUND
)) {

2201 
u8
 
id
 = 
	`À32_gë_bôs
(
desc
->
°©us
, 
IWL_RX_MPDU_STATUS_STA_ID
);

2203 i‡(!
	`WARN_ON_ONCE
(
id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
)) {

2204 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
id
]);

2205 i‡(
	`IS_ERR
(
°a
))

2206 
°a
 = 
NULL
;

2207 
lök_°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_lök_°a
[
id
]);

2209 i‡(
°a
 && sè->
vÆid_löks
 && 
lök_°a
) {

2210 
rx_°©us
->
lök_vÆid
 = 1;

2211 
rx_°©us
->
lök_id
 = 
lök_°a
->link_id;

2214 } i‡(!
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr2
)) {

2219 
°a
 = 
	`õì80211_föd_°a_by_iÁddr
(
mvm
->
hw
, 
hdr
->
addr2
, 
NULL
);

2222 i‡(
	`iwl_mvm_rx_¸y±o
(
mvm
, 
°a
, 
hdr
, 
rx_°©us
, 
phy_d©a
.
phy_öfo
, 
desc
,

2223 
	`À32_to_˝u
(
pkt
->
Àn_n_Êags
), 
queue
,

2224 &
¸y±_Àn
)) {

2225 
	`k‰ì_skb
(
skb
);

2226 
out
;

2229 
	`iwl_mvm_rx_fûl_°©us
(
mvm
, 
skb
, &
phy_d©a
, 
queue
);

2231 i‡(
°a
) {

2232 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2233 
õì80211_vif
 *
tx_blocked_vif
 =

2234 
	`rcu_dîe„ªn˚
(
mvm
->
cß_tx_blocked_vif
);

2235 
u8
 
baid
 = (u8)((
	`À32_to_˝u
(
desc
->
ª‹dî_d©a
) &

2236 
IWL_RX_MPDU_REORDER_BAID_MASK
) >>

2237 
IWL_RX_MPDU_REORDER_BAID_SHIFT
);

2238 
iwl_fw_dbg_åiggî_év
 *
åig
;

2239 
õì80211_vif
 *
vif
 = 
mvm°a
->vif;

2241 i‡(!
mvm
->
tcm
.
∑u£d
 && 
Àn
 >(*
hdr
) &&

2242 !
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
) &&

2243 
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) &&

2244 
	`time_a·î
(
jiffõs
, 
mvm
->
tcm
.
ts
 + 
MVM_TCM_PERIOD
))

2245 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tcm
.
w‹k
, 0);

2252 i‡(
	`u∆ikñy
(
tx_blocked_vif
Ë&&Åx_blocked_vi‡=
vif
) {

2253 
iwl_mvm_vif
 *
mvmvif
 =

2254 
	`iwl_mvm_vif_‰om_mac80211
(
tx_blocked_vif
);

2255 
iwl_rx_°a_cß
 
rx_°a_cß
 = {

2256 .
Æl_°a_unblocked
 = 
åue
,

2257 .
vif
 = 
tx_blocked_vif
,

2260 i‡(
mvmvif
->
cß_èrgë_‰eq
 =
rx_°©us
->
‰eq
)

2261 
	`iwl_mvm_°a_modify_dißbÀ_tx_≠
(
mvm
, 
°a
,

2262 
Ál£
);

2263 
	`õì80211_ôî©e_°©i⁄s_©omic
(
mvm
->
hw
,

2264 
iwl_mvm_rx_gë_°a_block_tx
,

2265 &
rx_°a_cß
);

2267 i‡(
rx_°a_cß
.
Æl_°a_unblocked
) {

2268 
	`RCU_INIT_POINTER
(
mvm
->
cß_tx_blocked_vif
, 
NULL
);

2270 
	`iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
mvm
, 
mvmvif
, 
Ál£
);

2271 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
cs_tx_unblock_dw‹k
);

2275 
	`rs_upd©e_œ°_rssi
(
mvm
, 
mvm°a
, 
rx_°©us
);

2277 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
,

2278 
	`õì80211_vif_to_wdev
(
vif
),

2279 
FW_DBG_TRIGGER_RSSI
);

2281 i‡(
åig
 && 
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
)) {

2282 
iwl_fw_dbg_åiggî_low_rssi
 *
rssi_åig
;

2283 
s32
 
rssi
;

2285 
rssi_åig
 = (*)
åig
->
d©a
;

2286 
rssi
 = 
	`À32_to_˝u
(
rssi_åig
->rssi);

2288 i‡(
rx_°©us
->
sig«l
 < 
rssi
)

2289 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

2290 
NULL
);

2293 i‡(
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

2294 
	`iwl_mvm_rx_csum
(
mvm
, 
°a
, 
skb
, 
pkt
);

2296 i‡(
	`iwl_mvm_is_dup
(
°a
, 
queue
, 
rx_°©us
, 
hdr
, 
desc
)) {

2297 
	`IWL_DEBUG_DROP
(
mvm
, "Dropping duplicateÖacket 0x%x\n",

2298 
	`À16_to_˝u
(
hdr
->
£q_˘æ
));

2299 
	`k‰ì_skb
(
skb
);

2300 
out
;

2309 i‡((
desc
->
mac_Êags2
 & 
IWL_RX_MPDU_MFLG2_AMSDU
) &&

2310 !
	`WARN_ON
(!
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
))) {

2311 
u8
 *
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

2313 *
qc
 &~
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

2315 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 ==

2316 
IWL_DEVICE_FAMILY_9000
) {

2317 
	`iwl_mvm_Êù_addªss
(
hdr
->
addr3
);

2319 i‡(
	`õì80211_has_a4
(
hdr
->
‰ame_c⁄åﬁ
))

2320 
	`iwl_mvm_Êù_addªss
(
hdr
->
addr4
);

2323 i‡(
baid
 !
IWL_RX_REORDER_DATA_INVALID_BAID
) {

2324 
u32
 
ª‹dî_d©a
 = 
	`À32_to_˝u
(
desc
->reorder_data);

2326 
	`iwl_mvm_agg_rx_ª˚ived
(
mvm
, 
ª‹dî_d©a
, 
baid
);

2331 i‡(!
queue
) {

2332 i‡(
	`u∆ikñy
((
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
) ||

2333 
	`õì80211_is_¥obe_ª•
(
hdr
->
‰ame_c⁄åﬁ
)) &&

2334 
mvm
->
sched_sˇn_∑ss_Æl
 ==

2335 
SCHED_SCAN_PASS_ALL_ENABLED
))

2336 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_FOUND
;

2338 i‡(
	`u∆ikñy
(
	`õì80211_is_bóc⁄
(
hdr
->
‰ame_c⁄åﬁ
) ||

2339 
	`õì80211_is_¥obe_ª•
(
hdr
->
‰ame_c⁄åﬁ
)))

2340 
rx_°©us
->
boŸtime_ns
 = 
	`ktime_gë_boŸtime_ns
();

2343 i‡(
	`iwl_mvm_¸óã_skb
(
mvm
, 
skb
, 
hdr
, 
Àn
, 
¸y±_Àn
, 
rxb
)) {

2344 
	`k‰ì_skb
(
skb
);

2345 
out
;

2348 i‡(!
	`iwl_mvm_ª‹dî
(
mvm
, 
«pi
, 
queue
, 
°a
, 
skb
, 
desc
) &&

2349 
	`likñy
(!
	`iwl_mvm_time_sync_‰ame
(
mvm
, 
skb
, 
hdr
->
addr2
)) &&

2350 
	`likñy
(!
	`iwl_mvm_mei_fûãr_sˇn
(
mvm
, 
skb
))) {

2351 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_9000
 &&

2352 (
desc
->
mac_Êags2
 & 
IWL_RX_MPDU_MFLG2_AMSDU
) &&

2353 !(
desc
->
amsdu_öfo
 & 
IWL_RX_MPDU_AMSDU_LAST_SUBFRAME
))

2354 
rx_°©us
->
Êag
 |
RX_FLAG_AMSDU_MORE
;

2356 
	`iwl_mvm_∑ss_∑ckë_to_mac80211
(
mvm
, 
«pi
, 
skb
, 
queue
, 
°a
);

2358 
out
:

2359 
	`rcu_ªad_u∆ock
();

2360 
	}
}

2362 
	$iwl_mvm_rx_m⁄ô‹_no_d©a
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

2363 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
)

2365 
õì80211_rx_°©us
 *
rx_°©us
;

2366 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2367 
iwl_rx_no_d©a_vî_3
 *
desc
 = (*)
pkt
->
d©a
;

2368 
u32
 
rssi
;

2369 
u32
 
öfo_ty≥
;

2370 
õì80211_°a
 *
°a
 = 
NULL
;

2371 
sk_buff
 *
skb
;

2372 
iwl_mvm_rx_phy_d©a
 
phy_d©a
;

2373 
u32
 
f‹m©
;

2375 i‡(
	`u∆ikñy
(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)))

2378 i‡(
	`u∆ikñy
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë< (
iwl_rx_no_d©a
)))

2381 
rssi
 = 
	`À32_to_˝u
(
desc
->rssi);

2382 
öfo_ty≥
 = 
	`À32_to_˝u
(
desc
->
öfo
Ë& 
RX_NO_DATA_INFO_TYPE_MSK
;

2383 
phy_d©a
.
d0
 = 
desc
->
phy_öfo
[0];

2384 
phy_d©a
.
d1
 = 
desc
->
phy_öfo
[1];

2385 
phy_d©a
.
phy_öfo
 = 
IWL_RX_MPDU_PHY_TSF_OVERLOAD
;

2386 
phy_d©a
.
gp2_⁄_aú_ri£
 = 
	`À32_to_˝u
(
desc
->
⁄_aú_ri£_time
);

2387 
phy_d©a
.
øã_n_Êags
 = 
	`À32_to_˝u
(
desc
->
øã
);

2388 
phy_d©a
.
íîgy_a
 = 
	`u32_gë_bôs
(
rssi
, 
RX_NO_DATA_CHAIN_A_MSK
);

2389 
phy_d©a
.
íîgy_b
 = 
	`u32_gë_bôs
(
rssi
, 
RX_NO_DATA_CHAIN_B_MSK
);

2390 
phy_d©a
.
ch™√l
 = 
	`u32_gë_bôs
(
rssi
, 
RX_NO_DATA_CHANNEL_MSK
);

2391 
phy_d©a
.
wôh_d©a
 = 
Ál£
;

2392 
phy_d©a
.
rx_vec
[0] = 
desc
->rx_vec[0];

2393 
phy_d©a
.
rx_vec
[1] = 
desc
->rx_vec[1];

2395 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
DATA_PATH_GROUP
,

2396 
RX_NO_DATA_NOTIF
, 0) < 2) {

2397 
	`IWL_DEBUG_DROP
(
mvm
, "Gotán oldÑate format. OldÑate: 0x%x\n",

2398 
phy_d©a
.
øã_n_Êags
);

2399 
phy_d©a
.
øã_n_Êags
 = 
	`iwl_√w_øã_‰om_v1
(phy_data.rate_n_flags);

2400 
	`IWL_DEBUG_DROP
(
mvm
, " Rateáfter conversionÅoÅheÇew format: 0x%x\n",

2401 
phy_d©a
.
øã_n_Êags
);

2404 
f‹m©
 = 
phy_d©a
.
øã_n_Êags
 & 
RATE_MCS_MOD_TYPE_MSK
;

2406 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
DATA_PATH_GROUP
,

2407 
RX_NO_DATA_NOTIF
, 0) >= 3) {

2408 i‡(
	`u∆ikñy
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
) <

2409 (
iwl_rx_no_d©a_vî_3
)))

2412 
phy_d©a
.
rx_vec
[2] = 
desc
->rx_vec[2];

2413 
phy_d©a
.
rx_vec
[3] = 
desc
->rx_vec[3];

2415 i‡(
f‹m©
 =
RATE_MCS_EHT_MSK
)

2423 
skb
 = 
	`Æloc_skb
(128, 
GFP_ATOMIC
);

2424 i‡(!
skb
) {

2425 
	`IWL_ERR
(
mvm
, "alloc_skb failed\n");

2429 
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

2432 
rx_°©us
->
Êag
 |
RX_FLAG_NO_PSDU
;

2434 
öfo_ty≥
) {

2435 
RX_NO_DATA_INFO_TYPE_NDP
:

2436 
rx_°©us
->
zîo_Àngth_psdu_ty≥
 =

2437 
IEEE80211_RADIOTAP_ZERO_LEN_PSDU_SOUNDING
;

2439 
RX_NO_DATA_INFO_TYPE_MU_UNMATCHED
:

2440 
RX_NO_DATA_INFO_TYPE_TB_UNMATCHED
:

2441 
rx_°©us
->
zîo_Àngth_psdu_ty≥
 =

2442 
IEEE80211_RADIOTAP_ZERO_LEN_PSDU_NOT_CAPTURED
;

2445 
rx_°©us
->
zîo_Àngth_psdu_ty≥
 =

2446 
IEEE80211_RADIOTAP_ZERO_LEN_PSDU_VENDOR
;

2450 
rx_°©us
->
b™d
 = 
phy_d©a
.
ch™√l
 > 14 ? 
NL80211_BAND_5GHZ
 :

2451 
NL80211_BAND_2GHZ
;

2453 
	`iwl_mvm_rx_fûl_°©us
(
mvm
, 
skb
, &
phy_d©a
, 
queue
);

2460 
	`skb_ª£t_mac_hódî
(
skb
);

2467 
f‹m©
) {

2468 
RATE_MCS_VHT_MSK
:

2469 
rx_°©us
->
nss
 =

2470 
	`À32_gë_bôs
(
desc
->
rx_vec
[0],

2471 
RX_NO_DATA_RX_VEC0_VHT_NSTS_MSK
) + 1;

2473 
RATE_MCS_HE_MSK
:

2474 
rx_°©us
->
nss
 =

2475 
	`À32_gë_bôs
(
desc
->
rx_vec
[0],

2476 
RX_NO_DATA_RX_VEC0_HE_NSTS_MSK
) + 1;

2478 
RATE_MCS_EHT_MSK
:

2479 
rx_°©us
->
nss
 =

2480 
	`À32_gë_bôs
(
desc
->
rx_vec
[2],

2481 
RX_NO_DATA_RX_VEC2_EHT_NSTS_MSK
) + 1;

2484 
	`rcu_ªad_lock
();

2485 
	`õì80211_rx_«pi
(
mvm
->
hw
, 
°a
, 
skb
, 
«pi
);

2486 
	`rcu_ªad_u∆ock
();

2487 
	}
}

2489 
	$iwl_mvm_rx_‰ame_ªÀa£
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

2490 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
)

2492 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2493 
iwl_‰ame_ªÀa£
 *
ªÀa£
 = (*)
pkt
->
d©a
;

2495 i‡(
	`u∆ikñy
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë< (*
ªÀa£
)))

2498 
	`iwl_mvm_ªÀa£_‰ames_‰om_nŸif
(
mvm
, 
«pi
, 
ªÀa£
->
baid
,

2499 
	`À16_to_˝u
(
ªÀa£
->
ns¢
),

2500 
queue
);

2501 
	}
}

2503 
	$iwl_mvm_rx_b¨_‰ame_ªÀa£
(
iwl_mvm
 *
mvm
, 
«pi_°ru˘
 *
«pi
,

2504 
iwl_rx_cmd_buf„r
 *
rxb
, 
queue
)

2506 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2507 
iwl_b¨_‰ame_ªÀa£
 *
ªÀa£
 = (*)
pkt
->
d©a
;

2508 
baid
 = 
	`À32_gë_bôs
(
ªÀa£
->
ba_öfo
,

2509 
IWL_BAR_FRAME_RELEASE_BAID_MASK
);

2510 
ns¢
 = 
	`À32_gë_bôs
(
ªÀa£
->
ba_öfo
,

2511 
IWL_BAR_FRAME_RELEASE_NSSN_MASK
);

2512 
°a_id
 = 
	`À32_gë_bôs
(
ªÀa£
->
°a_tid
,

2513 
IWL_BAR_FRAME_RELEASE_STA_MASK
);

2514 
tid
 = 
	`À32_gë_bôs
(
ªÀa£
->
°a_tid
,

2515 
IWL_BAR_FRAME_RELEASE_TID_MASK
);

2516 
iwl_mvm_baid_d©a
 *
baid_d©a
;

2518 i‡(
	`u∆ikñy
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë< (*
ªÀa£
)))

2521 i‡(
	`WARN_ON_ONCE
(
baid
 =
IWL_RX_REORDER_DATA_INVALID_BAID
 ||

2522 
baid
 >
	`ARRAY_SIZE
(
mvm
->
baid_m≠
)))

2525 
	`rcu_ªad_lock
();

2526 
baid_d©a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
baid_m≠
[
baid
]);

2527 i‡(!
baid_d©a
) {

2528 
	`IWL_DEBUG_RX
(
mvm
,

2530 
baid
);

2531 
out
;

2534 i‡(
	`WARN
(
tid
 !
baid_d©a
->tid || 
°a_id
 > 
IWL_MVM_STATION_COUNT_MAX
 ||

2535 !(
baid_d©a
->
°a_mask
 & 
	`BIT
(
°a_id
)),

2537 
baid
, 
baid_d©a
->
°a_mask
, baid_d©a->
tid
, 
°a_id
,

2538 
tid
))

2539 
out
;

2541 
	`IWL_DEBUG_DROP
(
mvm
, "Receivedá BAR,ÉxpectÖacketÜoss:Çssn %d\n",

2542 
ns¢
);

2544 
	`iwl_mvm_ªÀa£_‰ames_‰om_nŸif
(
mvm
, 
«pi
, 
baid
, 
ns¢
, 
queue
);

2545 
out
:

2546 
	`rcu_ªad_u∆ock
();

2547 
	}
}

	@mvm/scan.c

7 
	~<löux/ëhîdevi˚.h
>

8 
	~<√t/mac80211.h
>

9 
	~<löux/¸c32.h
>

11 
	~"mvm.h
"

12 
	~"fw/≠i/sˇn.h
"

13 
	~"iwl-io.h
"

15 
	#IWL_DENSE_EBS_SCAN_RATIO
 5

	)

16 
	#IWL_SPARSE_EBS_SCAN_RATIO
 1

	)

18 
	#IWL_SCAN_DWELL_ACTIVE
 10

	)

19 
	#IWL_SCAN_DWELL_PASSIVE
 110

	)

20 
	#IWL_SCAN_DWELL_FRAGMENTED
 44

	)

21 
	#IWL_SCAN_DWELL_EXTENDED
 90

	)

22 
	#IWL_SCAN_NUM_OF_FRAGS
 3

	)

25 
	#IWL_SCAN_ADWELL_MAX_BUDGET_FULL_SCAN
 300

	)

27 
	#IWL_SCAN_ADWELL_MAX_BUDGET_DIRECTED_SCAN
 100

	)

29 
	#IWL_SCAN_ADWELL_DEFAULT_HB_N_APS
 8

	)

31 
	#IWL_SCAN_ADWELL_DEFAULT_LB_N_APS
 2

	)

33 
	#IWL_SCAN_ADWELL_DEFAULT_N_APS_SOCIAL
 10

	)

35 
	#IWL_SCAN_NUM_CHANNELS
 112

	)

37 
	#IWL_SCAN_ADWELL_N_APS_GO_FRIENDLY_BIT
 
	`BIT
(20)

	)

39 
	#IWL_SCAN_ADWELL_N_APS_SOCIAL_CHS_BIT
 
	`BIT
(21)

	)

41 
	#IWL_SCAN_ADWELL_N_APS_GO_FRIENDLY
 10

	)

43 
	#IWL_SCAN_ADWELL_N_APS_SOCIAL_CHS
 2

	)

46 
	#IWL_MVM_6GHZ_PASSIVE_SCAN_MIN_CHANS
 4

	)

49 
	#IWL_MEI_SCAN_NUM_ITER
 5U

	)

51 
	siwl_mvm_sˇn_timög_∑øms
 {

52 
u32
 
	msu•íd_time
;

53 
u32
 
	mmax_out_time
;

56 
iwl_mvm_sˇn_timög_∑øms
 
	gsˇn_timög
[] = {

57 [
IWL_SCAN_TYPE_UNASSOC
] = {

58 .
su•íd_time
 = 0,

59 .
	gmax_out_time
 = 0,

61 [
IWL_SCAN_TYPE_WILD
] = {

62 .
su•íd_time
 = 30,

63 .
	gmax_out_time
 = 120,

65 [
IWL_SCAN_TYPE_MILD
] = {

66 .
su•íd_time
 = 120,

67 .
	gmax_out_time
 = 120,

69 [
IWL_SCAN_TYPE_FRAGMENTED
] = {

70 .
su•íd_time
 = 95,

71 .
	gmax_out_time
 = 44,

73 [
IWL_SCAN_TYPE_FAST_BALANCE
] = {

74 .
su•íd_time
 = 30,

75 .
	gmax_out_time
 = 37,

79 
	siwl_mvm_sˇn_∑øms
 {

81 
iwl_mvm_sˇn_ty≥
 
	mty≥
;

82 
iwl_mvm_sˇn_ty≥
 
	mhb_ty≥
;

83 
u32
 
	mn_ch™√ls
;

84 
u16
 
	mdñay
;

85 
	mn_ssids
;

86 
cfg80211_ssid
 *
	mssids
;

87 
õì80211_ch™√l
 **
	mch™√ls
;

88 
u32
 
	mÊags
;

89 
u8
 *
	mmac_addr
;

90 
u8
 *
	mmac_addr_mask
;

91 
boﬁ
 
	mno_cck
;

92 
boﬁ
 
	m∑ss_Æl
;

93 
	mn_m©ch_£ts
;

94 
iwl_sˇn_¥obe_ªq
 
	m¥eq
;

95 
cfg80211_m©ch_£t
 *
	mm©ch_£ts
;

96 
	mn_sˇn_∂™s
;

97 
cfg80211_sched_sˇn_∂™
 *
	msˇn_∂™s
;

98 
boﬁ
 
	môî_nŸif
;

99 
cfg80211_sˇn_6ghz_∑øms
 *
	msˇn_6ghz_∑øms
;

100 
u32
 
	mn_6ghz_∑øms
;

101 
boﬁ
 
	msˇn_6ghz
;

102 
boﬁ
 
	míabÀ_6ghz_∑ssive
;

103 
boﬁ
 
	mª•e˘_p2p_go
, 
	mª•e˘_p2p_go_hb
;

104 
s8
 
	mtsf_ªp‹t_lök_id
;

105 
u8
 
	mbssid
[
ETH_ALEN
] 
__Æig√d
(2);

108 
ölöe
 *
	$iwl_mvm_gë_sˇn_ªq_umac_d©a
(
iwl_mvm
 *
mvm
)

110 
iwl_sˇn_ªq_umac
 *
cmd
 = 
mvm
->
sˇn_cmd
;

112 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_v2_suµ‹ãd
(
mvm
))

113  (*)&
cmd
->
v8
.
d©a
;

115 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
))

116  (*)&
cmd
->
v7
.
d©a
;

118 i‡(
	`iwl_mvm_cdb_sˇn_≠i
(
mvm
))

119  (*)&
cmd
->
v6
.
d©a
;

121  (*)&
cmd
->
v1
.
d©a
;

122 
	}
}

124 
ölöe
 
iwl_sˇn_umac_ch™_∑øm
 *

125 
	$iwl_mvm_gë_sˇn_ªq_umac_ch™√l
(
iwl_mvm
 *
mvm
)

127 
iwl_sˇn_ªq_umac
 *
cmd
 = 
mvm
->
sˇn_cmd
;

129 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_v2_suµ‹ãd
(
mvm
))

130  &
cmd
->
v8
.
ch™√l
;

132 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
))

133  &
cmd
->
v7
.
ch™√l
;

135 i‡(
	`iwl_mvm_cdb_sˇn_≠i
(
mvm
))

136  &
cmd
->
v6
.
ch™√l
;

138  &
cmd
->
v1
.
ch™√l
;

139 
	}
}

141 
u8
 
	$iwl_mvm_sˇn_rx_™t
(
iwl_mvm
 *
mvm
)

143 i‡(
mvm
->
sˇn_rx_™t
 !
ANT_NONE
)

144  
mvm
->
sˇn_rx_™t
;

145  
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
);

146 
	}
}

148 
ölöe
 
__À16
 
	$iwl_mvm_sˇn_rx_chaö
(
iwl_mvm
 *
mvm
)

150 
u16
 
rx_chaö
;

151 
u8
 
rx_™t
;

153 
rx_™t
 = 
	`iwl_mvm_sˇn_rx_™t
(
mvm
);

154 
rx_chaö
 = 
rx_™t
 << 
PHY_RX_CHAIN_VALID_POS
;

155 
rx_chaö
 |
rx_™t
 << 
PHY_RX_CHAIN_FORCE_MIMO_SEL_POS
;

156 
rx_chaö
 |
rx_™t
 << 
PHY_RX_CHAIN_FORCE_SEL_POS
;

157 
rx_chaö
 |0x1 << 
PHY_RX_CHAIN_DRIVER_FORCE_POS
;

158  
	`˝u_to_À16
(
rx_chaö
);

159 
	}
}

161 
ölöe
 
__À32


162 
	$iwl_mvm_sˇn_øã_n_Êags
(
iwl_mvm
 *
mvm
, 
∆80211_b™d
 
b™d
,

163 
boﬁ
 
no_cck
)

165 
u32
 
tx_™t
;

167 
	`iwl_mvm_toggÀ_tx_™t
(
mvm
, &mvm->
sˇn_œ°_™ã¬a_idx
);

168 
tx_™t
 = 
	`BIT
(
mvm
->
sˇn_œ°_™ã¬a_idx
Ë<< 
RATE_MCS_ANT_POS
;

170 i‡(
b™d
 =
NL80211_BAND_2GHZ
 && !
no_cck
)

171  
	`˝u_to_À32
(
IWL_RATE_1M_PLCP
 | 
RATE_MCS_CCK_MSK_V1
 |

172 
tx_™t
);

174  
	`˝u_to_À32
(
IWL_RATE_6M_PLCP
 | 
tx_™t
);

175 
	}
}

177 
iwl_mvm_åaffic_lﬂd
 
	$iwl_mvm_gë_åaffic_lﬂd
(
iwl_mvm
 *
mvm
)

179  
mvm
->
tcm
.
ªsu…
.
globÆ_lﬂd
;

180 
	}
}

182 
iwl_mvm_åaffic_lﬂd


183 
	$iwl_mvm_gë_åaffic_lﬂd_b™d
(
iwl_mvm
 *
mvm
, 
∆80211_b™d
 
b™d
)

185  
mvm
->
tcm
.
ªsu…
.
b™d_lﬂd
[
b™d
];

186 
	}
}

188 
	siwl_mvm_sˇn_ôî_d©a
 {

189 
u32
 
	mglobÆ_˙t
;

190 
õì80211_vif
 *
	mcuºít_vif
;

191 
boﬁ
 
	mis_dcm_wôh_p2p_go
;

194 
	$iwl_mvm_sˇn_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

195 
õì80211_vif
 *
vif
)

197 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

198 
iwl_mvm_sˇn_ôî_d©a
 *
d©a
 = 
_d©a
;

199 
iwl_mvm_vif
 *
cuº_mvmvif
;

201 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
 &&

202 
mvmvif
->
deÊök
.
phy_˘xt
 &&

203 
mvmvif
->
deÊök
.
phy_˘xt
->
id
 < 
NUM_PHY_CTX
)

204 
d©a
->
globÆ_˙t
 += 1;

206 i‡(!
d©a
->
cuºít_vif
 || 
vif
 == data->current_vif)

209 
cuº_mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
d©a
->
cuºít_vif
);

211 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && vif->
p2p
 &&

212 
mvmvif
->
deÊök
.
phy_˘xt
 && 
cuº_mvmvif
->deflink.phy_ctxt &&

213 
mvmvif
->
deÊök
.
phy_˘xt
->
id
 !
cuº_mvmvif
->deflink.phy_ctxt->id)

214 
d©a
->
is_dcm_wôh_p2p_go
 = 
åue
;

215 
	}
}

218 
iwl_mvm_sˇn_ty≥
 
	$_iwl_mvm_gë_sˇn_ty≥
(
iwl_mvm
 *
mvm
,

219 
õì80211_vif
 *
vif
,

220 
iwl_mvm_åaffic_lﬂd
 
lﬂd
,

221 
boﬁ
 
low_œãncy
)

223 
iwl_mvm_sˇn_ôî_d©a
 
d©a
 = {

224 .
cuºít_vif
 = 
vif
,

225 .
is_dcm_wôh_p2p_go
 = 
Ál£
,

226 .
globÆ_˙t
 = 0,

229 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

230 
IEEE80211_IFACE_ITER_NORMAL
,

231 
iwl_mvm_sˇn_ôî©‹
,

232 &
d©a
);

234 i‡(!
d©a
.
globÆ_˙t
)

235  
IWL_SCAN_TYPE_UNASSOC
;

237 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

238 
IWL_UCODE_TLV_API_FRAGMENTED_SCAN
)) {

239 i‡((
lﬂd
 =
IWL_MVM_TRAFFIC_HIGH
 || 
low_œãncy
) &&

240 (!
vif
 || vif->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
))

241  
IWL_SCAN_TYPE_FRAGMENTED
;

247 i‡(
vif
 && vif->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

248 
d©a
.
is_dcm_wôh_p2p_go
)

249  
IWL_SCAN_TYPE_FAST_BALANCE
;

252 i‡(
lﬂd
 >
IWL_MVM_TRAFFIC_MEDIUM
 || 
low_œãncy
)

253  
IWL_SCAN_TYPE_MILD
;

255  
IWL_SCAN_TYPE_WILD
;

256 
	}
}

259 
iwl_mvm_sˇn_ty≥
 
	$iwl_mvm_gë_sˇn_ty≥
(
iwl_mvm
 *
mvm
,

260 
õì80211_vif
 *
vif
)

262 
iwl_mvm_åaffic_lﬂd
 
lﬂd
;

263 
boﬁ
 
low_œãncy
;

265 
lﬂd
 = 
	`iwl_mvm_gë_åaffic_lﬂd
(
mvm
);

266 
low_œãncy
 = 
	`iwl_mvm_low_œãncy
(
mvm
);

268  
	`_iwl_mvm_gë_sˇn_ty≥
(
mvm
, 
vif
, 
lﬂd
, 
low_œãncy
);

269 
	}
}

272 
iwl_mvm_sˇn_ty≥
 
	$iwl_mvm_gë_sˇn_ty≥_b™d
(
iwl_mvm
 *
mvm
,

273 
õì80211_vif
 *
vif
,

274 
∆80211_b™d
 
b™d
)

276 
iwl_mvm_åaffic_lﬂd
 
lﬂd
;

277 
boﬁ
 
low_œãncy
;

279 
lﬂd
 = 
	`iwl_mvm_gë_åaffic_lﬂd_b™d
(
mvm
, 
b™d
);

280 
low_œãncy
 = 
	`iwl_mvm_low_œãncy_b™d
(
mvm
, 
b™d
);

282  
	`_iwl_mvm_gë_sˇn_ty≥
(
mvm
, 
vif
, 
lﬂd
, 
low_œãncy
);

283 
	}
}

285 
ölöe
 
boﬁ
 
	$iwl_mvm_ºm_sˇn_√eded
(
iwl_mvm
 *
mvm
)

288  
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

289 
IWL_UCODE_TLV_CAPA_DS_PARAM_SET_IE_SUPPORT
);

290 
	}
}

292 
	$iwl_mvm_max_sˇn_õ_fw_cmd_room
(
iwl_mvm
 *
mvm
)

294 
max_¥obe_Àn
;

296 
max_¥obe_Àn
 = 
SCAN_OFFLOAD_PROBE_REQ_SIZE
;

299 
max_¥obe_Àn
 -= 24 + 2;

302 i‡(
	`iwl_mvm_ºm_sˇn_√eded
(
mvm
))

303 
max_¥obe_Àn
 -= 3;

305  
max_¥obe_Àn
;

306 
	}
}

308 
	$iwl_mvm_max_sˇn_õ_Àn
(
iwl_mvm
 *
mvm
)

310 
max_õ_Àn
 = 
	`iwl_mvm_max_sˇn_õ_fw_cmd_room
(
mvm
);

322  
max_õ_Àn
;

323 
	}
}

325 
	$iwl_mvm_rx_lmac_sˇn_ôî_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

326 
iwl_rx_cmd_buf„r
 *
rxb
)

328 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

329 
iwl_lmac_sˇn_com∂ëe_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

331 
	`IWL_DEBUG_SCAN
(
mvm
,

333 
nŸif
->
°©us
,ÇŸif->
sˇ¬ed_ch™√ls
);

335 i‡(
mvm
->
sched_sˇn_∑ss_Æl
 =
SCHED_SCAN_PASS_ALL_FOUND
) {

336 
	`IWL_DEBUG_SCAN
(
mvm
, "Passáll scheduled scanÑesults found\n");

337 
	`õì80211_sched_sˇn_ªsu…s
(
mvm
->
hw
);

338 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_ENABLED
;

340 
	}
}

342 
	$iwl_mvm_rx_sˇn_m©ch_found
(
iwl_mvm
 *
mvm
,

343 
iwl_rx_cmd_buf„r
 *
rxb
)

345 
	`IWL_DEBUG_SCAN
(
mvm
, "Scheduled scanÑesults\n");

346 
	`õì80211_sched_sˇn_ªsu…s
(
mvm
->
hw
);

347 
	}
}

349 c⁄° *
	$iwl_mvm_ebs_°©us_°r
(
iwl_sˇn_ebs_°©us
 
°©us
)

351 
°©us
) {

352 
IWL_SCAN_EBS_SUCCESS
:

354 
IWL_SCAN_EBS_INACTIVE
:

356 
IWL_SCAN_EBS_FAILED
:

357 
IWL_SCAN_EBS_CHAN_NOT_FOUND
:

361 
	}
}

363 
	$iwl_mvm_rx_lmac_sˇn_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

364 
iwl_rx_cmd_buf„r
 *
rxb
)

366 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

367 
iwl_≥riodic_sˇn_com∂ëe
 *
sˇn_nŸif
 = (*)
pkt
->
d©a
;

368 
boﬁ
 
ab‹ãd
 = (
sˇn_nŸif
->
°©us
 =
IWL_SCAN_OFFLOAD_ABORTED
);

373 i‡(
	`WARN_ON_ONCE
(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

374 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
)))

378 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

390 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_STOPPING_SCHED
) {

391 
	`WARN_ON_ONCE
(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_STOPPING_REGULAR
);

393 
	`IWL_DEBUG_SCAN
(
mvm
, "Scheduled scan %s, EBS status %s\n",

394 
ab‹ãd
 ? "aborted" : "completed",

395 
	`iwl_mvm_ebs_°©us_°r
(
sˇn_nŸif
->
ebs_°©us
));

396 
	`IWL_DEBUG_SCAN
(
mvm
,

398 
sˇn_nŸif
->
œ°_scheduÀ_löe
,

399 
sˇn_nŸif
->
œ°_scheduÀ_ôî©i⁄
,

400 
	`__À32_to_˝u
(
sˇn_nŸif
->
time_a·î_œ°_ôî
));

402 
mvm
->
sˇn_°©us
 &~
IWL_MVM_SCAN_STOPPING_SCHED
;

403 } i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_STOPPING_REGULAR
) {

404 
	`IWL_DEBUG_SCAN
(
mvm
, "Regular scan %s, EBS status %s\n",

405 
ab‹ãd
 ? "aborted" : "completed",

406 
	`iwl_mvm_ebs_°©us_°r
(
sˇn_nŸif
->
ebs_°©us
));

408 
mvm
->
sˇn_°©us
 &~
IWL_MVM_SCAN_STOPPING_REGULAR
;

409 } i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_SCHED
) {

410 
	`WARN_ON_ONCE
(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_REGULAR
);

412 
	`IWL_DEBUG_SCAN
(
mvm
, "Scheduled scan %s, EBS status %s\n",

413 
ab‹ãd
 ? "aborted" : "completed",

414 
	`iwl_mvm_ebs_°©us_°r
(
sˇn_nŸif
->
ebs_°©us
));

415 
	`IWL_DEBUG_SCAN
(
mvm
,

417 
sˇn_nŸif
->
œ°_scheduÀ_löe
,

418 
sˇn_nŸif
->
œ°_scheduÀ_ôî©i⁄
,

419 
	`__À32_to_˝u
(
sˇn_nŸif
->
time_a·î_œ°_ôî
));

421 
mvm
->
sˇn_°©us
 &~
IWL_MVM_SCAN_SCHED
;

422 
	`õì80211_sched_sˇn_°›≥d
(
mvm
->
hw
);

423 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

424 } i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_REGULAR
) {

425 
cfg80211_sˇn_öfo
 
öfo
 = {

426 .
ab‹ãd
 =áborted,

429 
	`IWL_DEBUG_SCAN
(
mvm
, "Regular scan %s, EBS status %s (FW)\n",

430 
ab‹ãd
 ? "aborted" : "completed",

431 
	`iwl_mvm_ebs_°©us_°r
(
sˇn_nŸif
->
ebs_°©us
));

433 
mvm
->
sˇn_°©us
 &~
IWL_MVM_SCAN_REGULAR
;

434 
	`õì80211_sˇn_com∂ëed
(
mvm
->
hw
, &
öfo
);

435 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
sˇn_timeout_dw‹k
);

436 
	`iwl_mvm_ªsume_tcm
(
mvm
);

438 
	`IWL_ERR
(
mvm
,

442 
mvm
->
œ°_ebs_suc˚ssful
 =

443 
sˇn_nŸif
->
ebs_°©us
 =
IWL_SCAN_EBS_SUCCESS
 ||

444 
sˇn_nŸif
->
ebs_°©us
 =
IWL_SCAN_EBS_INACTIVE
;

445 
	}
}

447 
	$iwl_ssid_exi°
(
u8
 *
ssid
, u8 
ssid_Àn
, 
iwl_ssid_õ
 *
ssid_li°
)

449 
i
;

451 
i
 = 0; i < 
PROBE_OPTION_MAX
; i++) {

452 i‡(!
ssid_li°
[
i
].
Àn
)

454 i‡(
ssid_li°
[
i
].
Àn
 =
ssid_Àn
 &&

455 !
	`memcmp
(
ssid_li°
->
ssid
, ssid, 
ssid_Àn
))

456  
i
;

459 
	}
}

464 
	$iwl_sˇn_buûd_ssids
(
iwl_mvm_sˇn_∑øms
 *
∑øms
,

465 
iwl_ssid_õ
 *
ssids
,

466 
u32
 *
ssid_bôm≠
)

468 
i
, 
j
;

469 
ödex
;

470 
u32
 
tmp_bôm≠
 = 0;

477 
i
 = 0, 
j
 = 
∑øms
->
n_m©ch_£ts
 - 1;

478 
j
 >0 && 
i
 < 
PROBE_OPTION_MAX
;

479 
i
++, 
j
--) {

481 i‡(!
∑øms
->
m©ch_£ts
[
j
].
ssid
.
ssid_Àn
)

483 
ssids
[
i
].
id
 = 
WLAN_EID_SSID
;

484 
ssids
[
i
].
Àn
 = 
∑øms
->
m©ch_£ts
[
j
].
ssid
.
ssid_Àn
;

485 
	`mem˝y
(
ssids
[
i
].
ssid
, 
∑øms
->
m©ch_£ts
[
j
].ssid.ssid,

486 
ssids
[
i
].
Àn
);

490 
j
 = 
∑øms
->
n_ssids
 - 1;

491 
j
 >0 && 
i
 < 
PROBE_OPTION_MAX
;

492 
i
++, 
j
--) {

493 
ödex
 = 
	`iwl_ssid_exi°
(
∑øms
->
ssids
[
j
].
ssid
,

494 
∑øms
->
ssids
[
j
].
ssid_Àn
,

495 
ssids
);

496 i‡(
ödex
 < 0) {

497 
ssids
[
i
].
id
 = 
WLAN_EID_SSID
;

498 
ssids
[
i
].
Àn
 = 
∑øms
->ssids[
j
].
ssid_Àn
;

499 
	`mem˝y
(
ssids
[
i
].
ssid
, 
∑øms
->ssids[
j
].ssid,

500 
ssids
[
i
].
Àn
);

501 
tmp_bôm≠
 |
	`BIT
(
i
);

503 
tmp_bôm≠
 |
	`BIT
(
ödex
);

506 i‡(
ssid_bôm≠
)

507 *
ssid_bôm≠
 = 
tmp_bôm≠
;

508 
	}
}

511 
	$iwl_mvm_c⁄fig_sched_sˇn_¥ofûes
(
iwl_mvm
 *
mvm
,

512 
cfg80211_sched_sˇn_ªque°
 *
ªq
)

514 
iwl_sˇn_ofÊﬂd_¥ofûe
 *
¥ofûe
;

515 
iwl_sˇn_ofÊﬂd_¥ofûe_cfg_v1
 *
¥ofûe_cfg_v1
;

516 
iwl_sˇn_ofÊﬂd_blockli°
 *
blockli°
;

517 
iwl_sˇn_ofÊﬂd_¥ofûe_cfg_d©a
 *
d©a
;

518 
max_¥ofûes
 = 
	`iwl_umac_sˇn_gë_max_¥ofûes
(
mvm
->
fw
);

519 
¥ofûe_cfg_size
 = (*
d©a
) +

520 (*
¥ofûe
Ë* 
max_¥ofûes
;

521 
iwl_ho°_cmd
 
cmd
 = {

522 .
id
 = 
SCAN_OFFLOAD_UPDATE_PROFILES_CMD
,

523 .
Àn
[1] = 
¥ofûe_cfg_size
,

524 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

525 .
d©aÊags
[1] = 
IWL_HCMD_DFL_NOCOPY
,

527 
blockli°_Àn
;

528 
i
;

529 
ªt
;

531 i‡(
	`WARN_ON
(
ªq
->
n_m©ch_£ts
 > 
max_¥ofûes
))

532  -
EIO
;

534 i‡(
mvm
->
fw
->
ucode_ˇ∑
.
Êags
 & 
IWL_UCODE_TLV_FLAGS_SHORT_BL
)

535 
blockli°_Àn
 = 
IWL_SCAN_SHORT_BLACKLIST_LEN
;

537 
blockli°_Àn
 = 
IWL_SCAN_MAX_BLACKLIST_LEN
;

539 
blockli°
 = 
	`kˇŒoc
(
blockli°_Àn
, (*blockli°), 
GFP_KERNEL
);

540 i‡(!
blockli°
)

541  -
ENOMEM
;

543 
¥ofûe_cfg_v1
 = 
	`kzÆloc
(
¥ofûe_cfg_size
, 
GFP_KERNEL
);

544 i‡(!
¥ofûe_cfg_v1
) {

545 
ªt
 = -
ENOMEM
;

546 
‰ì_blockli°
;

549 
cmd
.
d©a
[0] = 
blockli°
;

550 
cmd
.
Àn
[0] = (*
blockli°
Ë* 
blockli°_Àn
;

551 
cmd
.
d©a
[1] = 
¥ofûe_cfg_v1
;

554 i‡(
max_¥ofûes
 =
IWL_SCAN_MAX_PROFILES_V2
) {

555 
iwl_sˇn_ofÊﬂd_¥ofûe_cfg
 *
¥ofûe_cfg
 =

556 (
iwl_sˇn_ofÊﬂd_¥ofûe_cfg
 *)
¥ofûe_cfg_v1
;

558 
d©a
 = &
¥ofûe_cfg
->data;

560 
d©a
 = &
¥ofûe_cfg_v1
->data;

564 
d©a
->
num_¥ofûes
 = 
ªq
->
n_m©ch_£ts
;

565 
d©a
->
a˘ive_˛õ¡s
 = 
SCAN_CLIENT_SCHED_SCAN
;

566 
d©a
->
∑ss_m©ch
 = 
SCAN_CLIENT_SCHED_SCAN
;

567 
d©a
->
m©ch_nŸify
 = 
SCAN_CLIENT_SCHED_SCAN
;

569 i‡(!
ªq
->
n_m©ch_£ts
 || !ªq->
m©ch_£ts
[0].
ssid
.
ssid_Àn
)

570 
d©a
->
™y_bóc⁄_nŸify
 = 
SCAN_CLIENT_SCHED_SCAN
;

572 
i
 = 0; i < 
ªq
->
n_m©ch_£ts
; i++) {

573 
¥ofûe
 = &
¥ofûe_cfg_v1
->
¥ofûes
[
i
];

574 
¥ofûe
->
ssid_ödex
 = 
i
;

576 
¥ofûe
->
uniˇ°_cùhî
 = 0xff;

577 
¥ofûe
->
auth_Æg
 = 
IWL_AUTH_ALGO_UNSUPPORTED
 |

578 
IWL_AUTH_ALGO_NONE
 | 
IWL_AUTH_ALGO_PSK
 | 
IWL_AUTH_ALGO_8021X
 |

579 
IWL_AUTH_ALGO_SAE
 | 
IWL_AUTH_ALGO_8021X_SHA384
 | 
IWL_AUTH_ALGO_OWE
;

580 
¥ofûe
->
√tw‹k_ty≥
 = 
IWL_NETWORK_TYPE_ANY
;

581 
¥ofûe
->
b™d_£À˘i⁄
 = 
IWL_SCAN_OFFLOAD_SELECT_ANY
;

582 
¥ofûe
->
˛õ¡_bôm≠
 = 
SCAN_CLIENT_SCHED_SCAN
;

585 
	`IWL_DEBUG_SCAN
(
mvm
, "Sending scheduled scanÖrofile config\n");

587 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

588 
	`k‰ì
(
¥ofûe_cfg_v1
);

589 
‰ì_blockli°
:

590 
	`k‰ì
(
blockli°
);

592  
ªt
;

593 
	}
}

595 
boﬁ
 
	$iwl_mvm_sˇn_∑ss_Æl
(
iwl_mvm
 *
mvm
,

596 
cfg80211_sched_sˇn_ªque°
 *
ªq
)

598 i‡(
ªq
->
n_m©ch_£ts
 &&Ñeq->
m©ch_£ts
[0].
ssid
.
ssid_Àn
) {

599 
	`IWL_DEBUG_SCAN
(
mvm
,

601 
ªq
->
n_m©ch_£ts
);

602 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

603  
Ál£
;

606 
	`IWL_DEBUG_SCAN
(
mvm
, "Sending Scheduled scan without filtering\n");

608 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_ENABLED
;

609  
åue
;

610 
	}
}

612 
	$iwl_mvm_lmac_sˇn_ab‹t
(
iwl_mvm
 *
mvm
)

614 
ªt
;

615 
iwl_ho°_cmd
 
cmd
 = {

616 .
id
 = 
SCAN_OFFLOAD_ABORT_CMD
,

618 
u32
 
°©us
 = 
CAN_ABORT_STATUS
;

620 
ªt
 = 
	`iwl_mvm_£nd_cmd_°©us
(
mvm
, &
cmd
, &
°©us
);

621 i‡(
ªt
)

622  
ªt
;

624 i‡(
°©us
 !
CAN_ABORT_STATUS
) {

632 
	`IWL_DEBUG_SCAN
(
mvm
, "SCAN OFFLOAD ABORTÑë %d.\n", 
°©us
);

633 
ªt
 = -
ENOENT
;

636  
ªt
;

637 
	}
}

639 
	$iwl_mvm_sˇn_fûl_tx_cmd
(
iwl_mvm
 *
mvm
,

640 
iwl_sˇn_ªq_tx_cmd
 *
tx_cmd
,

641 
boﬁ
 
no_cck
)

643 
tx_cmd
[0].
tx_Êags
 = 
	`˝u_to_À32
(
TX_CMD_FLG_SEQ_CTL
 |

644 
TX_CMD_FLG_BT_DIS
);

645 
tx_cmd
[0].
øã_n_Êags
 = 
	`iwl_mvm_sˇn_øã_n_Êags
(
mvm
,

646 
NL80211_BAND_2GHZ
,

647 
no_cck
);

649 i‡(!
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
)) {

650 
tx_cmd
[0].
°a_id
 = 
mvm
->
aux_°a
.sta_id;

651 
tx_cmd
[1].
°a_id
 = 
mvm
->
aux_°a
.sta_id;

658 
tx_cmd
[0].
°a_id
 = 0xff;

659 
tx_cmd
[1].
°a_id
 = 0xff;

662 
tx_cmd
[1].
tx_Êags
 = 
	`˝u_to_À32
(
TX_CMD_FLG_SEQ_CTL
 |

663 
TX_CMD_FLG_BT_DIS
);

665 
tx_cmd
[1].
øã_n_Êags
 = 
	`iwl_mvm_sˇn_øã_n_Êags
(
mvm
,

666 
NL80211_BAND_5GHZ
,

667 
no_cck
);

668 
	}
}

671 
	$iwl_mvm_lmac_sˇn_cfg_ch™√ls
(
iwl_mvm
 *
mvm
,

672 
õì80211_ch™√l
 **
ch™√ls
,

673 
n_ch™√ls
, 
u32
 
ssid_bôm≠
,

674 
iwl_sˇn_ªq_lmac
 *
cmd
)

676 
iwl_sˇn_ch™√l_cfg_lmac
 *
ch™√l_cfg
 = (*)&
cmd
->
d©a
;

677 
i
;

679 
i
 = 0; i < 
n_ch™√ls
; i++) {

680 
ch™√l_cfg
[
i
].
ch™√l_num
 =

681 
	`˝u_to_À16
(
ch™√ls
[
i
]->
hw_vÆue
);

682 
ch™√l_cfg
[
i
].
ôî_cou¡
 = 
	`˝u_to_À16
(1);

683 
ch™√l_cfg
[
i
].
ôî_öãrvÆ
 = 0;

684 
ch™√l_cfg
[
i
].
Êags
 =

685 
	`˝u_to_À32
(
IWL_UNIFIED_SCAN_CHANNEL_PARTIAL
 |

686 
ssid_bôm≠
);

688 
	}
}

690 
u8
 *
	$iwl_mvm_c›y_™d_ö£π_ds_ñem
(
iwl_mvm
 *
mvm
, c⁄° 
u8
 *
õs
,

691 
size_t
 
Àn
, 
u8
 *c⁄° 
pos
)

693 c⁄° 
u8
 
bef‹e_ds_∑øms
[] = {

694 
WLAN_EID_SSID
,

695 
WLAN_EID_SUPP_RATES
,

696 
WLAN_EID_REQUEST
,

697 
WLAN_EID_EXT_SUPP_RATES
,

699 
size_t
 
offs
;

700 
u8
 *
√wpos
 = 
pos
;

702 i‡(!
	`iwl_mvm_ºm_sˇn_√eded
(
mvm
)) {

703 
	`mem˝y
(
√wpos
, 
õs
, 
Àn
);

704  
√wpos
 + 
Àn
;

707 
offs
 = 
	`õì80211_õ_•lô
(
õs
, 
Àn
,

708 
bef‹e_ds_∑øms
,

709 
	`ARRAY_SIZE
(
bef‹e_ds_∑øms
),

712 
	`mem˝y
(
√wpos
, 
õs
, 
offs
);

713 
√wpos
 +
offs
;

716 *
√wpos
++ = 
WLAN_EID_DS_PARAMS
;

717 *
√wpos
++ = 1;

718 *
√wpos
++ = 0;

720 
	`mem˝y
(
√wpos
, 
õs
 + 
offs
, 
Àn
 - offs);

721 
√wpos
 +
Àn
 - 
offs
;

723  
√wpos
;

724 
	}
}

726 
	#WFA_TPC_IE_LEN
 9

	)

728 
	$iwl_mvm_add_çc_ªp‹t_õ
(
u8
 *
pos
)

730 
pos
[0] = 
WLAN_EID_VENDOR_SPECIFIC
;

731 
pos
[1] = 
WFA_TPC_IE_LEN
 - 2;

732 
pos
[2] = (
WLAN_OUI_MICROSOFT
 >> 16) & 0xff;

733 
pos
[3] = (
WLAN_OUI_MICROSOFT
 >> 8) & 0xff;

734 
pos
[4] = 
WLAN_OUI_MICROSOFT
 & 0xff;

735 
pos
[5] = 
WLAN_OUI_TYPE_MICROSOFT_TPC
;

736 
pos
[6] = 0;

738 
pos
[7] = 0;

739 
pos
[8] = 0;

740 
	}
}

743 
	$iwl_mvm_buûd_sˇn_¥obe
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

744 
õì80211_sˇn_õs
 *
õs
,

745 
iwl_mvm_sˇn_∑øms
 *
∑øms
)

747 
õì80211_mgmt
 *
‰ame
 = (*)
∑øms
->
¥eq
.
buf
;

748 
u8
 *
pos
, *
√wpos
;

749 c⁄° 
u8
 *
mac_addr
 = 
∑øms
->
Êags
 & 
NL80211_SCAN_FLAG_RANDOM_ADDR
 ?

750 
∑øms
->
mac_addr
 : 
NULL
;

758 i‡(
mac_addr
)

759 
	`gë_øndom_mask_addr
(
‰ame
->
ß
, 
mac_addr
,

760 
∑øms
->
mac_addr_mask
);

762 
	`mem˝y
(
‰ame
->
ß
, 
vif
->
addr
, 
ETH_ALEN
);

764 
‰ame
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_STYPE_PROBE_REQ
);

765 
	`ëh_brﬂdˇ°_addr
(
‰ame
->
da
);

766 
	`ëhî_addr_c›y
(
‰ame
->
bssid
, 
∑øms
->bssid);

767 
‰ame
->
£q_˘æ
 = 0;

769 
pos
 = 
‰ame
->
u
.
¥obe_ªq
.
v¨übÀ
;

770 *
pos
++ = 
WLAN_EID_SSID
;

771 *
pos
++ = 0;

773 
∑øms
->
¥eq
.
mac_hódî
.
off£t
 = 0;

774 
∑øms
->
¥eq
.
mac_hódî
.
Àn
 = 
	`˝u_to_À16
(24 + 2);

777 
√wpos
 = 
	`iwl_mvm_c›y_™d_ö£π_ds_ñem
(
mvm
,

778 
õs
->õs[
NL80211_BAND_2GHZ
],

779 
õs
->
Àn
[
NL80211_BAND_2GHZ
],

780 
pos
);

781 
∑øms
->
¥eq
.
b™d_d©a
[0].
off£t
 = 
	`˝u_to_À16
(
pos
 -Ö¨ams->¥eq.
buf
);

782 
∑øms
->
¥eq
.
b™d_d©a
[0].
Àn
 = 
	`˝u_to_À16
(
√wpos
 - 
pos
);

783 
pos
 = 
√wpos
;

785 
	`mem˝y
(
pos
, 
õs
->õs[
NL80211_BAND_5GHZ
],

786 
õs
->
Àn
[
NL80211_BAND_5GHZ
]);

787 
∑øms
->
¥eq
.
b™d_d©a
[1].
off£t
 = 
	`˝u_to_À16
(
pos
 -Ö¨ams->¥eq.
buf
);

788 
∑øms
->
¥eq
.
b™d_d©a
[1].
Àn
 =

789 
	`˝u_to_À16
(
õs
->
Àn
[
NL80211_BAND_5GHZ
]);

790 
pos
 +
õs
->
Àn
[
NL80211_BAND_5GHZ
];

792 
	`mem˝y
(
pos
, 
õs
->õs[
NL80211_BAND_6GHZ
],

793 
õs
->
Àn
[
NL80211_BAND_6GHZ
]);

794 
∑øms
->
¥eq
.
b™d_d©a
[2].
off£t
 = 
	`˝u_to_À16
(
pos
 -Ö¨ams->¥eq.
buf
);

795 
∑øms
->
¥eq
.
b™d_d©a
[2].
Àn
 =

796 
	`˝u_to_À16
(
õs
->
Àn
[
NL80211_BAND_6GHZ
]);

797 
pos
 +
õs
->
Àn
[
NL80211_BAND_6GHZ
];

798 
	`mem˝y
(
pos
, 
õs
->
comm⁄_õs
, ies->
comm⁄_õ_Àn
);

799 
∑øms
->
¥eq
.
comm⁄_d©a
.
off£t
 = 
	`˝u_to_À16
(
pos
 -Ö¨ams->¥eq.
buf
);

801 i‡(
	`iwl_mvm_ºm_sˇn_√eded
(
mvm
) &&

802 !
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

803 
IWL_UCODE_TLV_CAPA_WFA_TPC_REP_IE_SUPPORT
)) {

804 
	`iwl_mvm_add_çc_ªp‹t_õ
(
pos
 + 
õs
->
comm⁄_õ_Àn
);

805 
∑øms
->
¥eq
.
comm⁄_d©a
.
Àn
 = 
	`˝u_to_À16
(
õs
->
comm⁄_õ_Àn
 +

806 
WFA_TPC_IE_LEN
);

808 
∑øms
->
¥eq
.
comm⁄_d©a
.
Àn
 = 
	`˝u_to_À16
(
õs
->
comm⁄_õ_Àn
);

810 
	}
}

812 
	$iwl_mvm_sˇn_lmac_dwñl
(
iwl_mvm
 *
mvm
,

813 
iwl_sˇn_ªq_lmac
 *
cmd
,

814 
iwl_mvm_sˇn_∑øms
 *
∑øms
)

816 
cmd
->
a˘ive_dwñl
 = 
IWL_SCAN_DWELL_ACTIVE
;

817 
cmd
->
∑ssive_dwñl
 = 
IWL_SCAN_DWELL_PASSIVE
;

818 
cmd
->
‰agmíãd_dwñl
 = 
IWL_SCAN_DWELL_FRAGMENTED
;

819 
cmd
->
exãnded_dwñl
 = 
IWL_SCAN_DWELL_EXTENDED
;

820 
cmd
->
max_out_time
 = 
	`˝u_to_À32
(
sˇn_timög
[
∑øms
->
ty≥
].max_out_time);

821 
cmd
->
su•íd_time
 = 
	`˝u_to_À32
(
sˇn_timög
[
∑øms
->
ty≥
].suspend_time);

822 
cmd
->
sˇn_¥io
 = 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_6
);

823 
	}
}

825 
ölöe
 
boﬁ
 
	$iwl_mvm_sˇn_fôs
(
iwl_mvm
 *
mvm
, 
n_ssids
,

826 
õì80211_sˇn_õs
 *
õs
,

827 
n_ch™√ls
)

829  ((
n_ssids
 <
PROBE_OPTION_MAX
) &&

830 (
n_ch™√ls
 <
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
) &

831 (
õs
->
comm⁄_õ_Àn
 +

832 
õs
->
Àn
[
NL80211_BAND_2GHZ
] +

833 
õs
->
Àn
[
NL80211_BAND_5GHZ
] <=

834 
	`iwl_mvm_max_sˇn_õ_fw_cmd_room
(
mvm
)));

835 
	}
}

837 
ölöe
 
boﬁ
 
	$iwl_mvm_sˇn_u£_ebs
(
iwl_mvm
 *
mvm
,

838 
õì80211_vif
 *
vif
)

840 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
 = &
mvm
->
fw
->
ucode_ˇ∑
;

841 
boﬁ
 
low_œãncy
;

843 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
))

844 
low_œãncy
 = 
	`iwl_mvm_low_œãncy_b™d
(
mvm
, 
NL80211_BAND_5GHZ
);

846 
low_œãncy
 = 
	`iwl_mvm_low_œãncy
(
mvm
);

856  ((
ˇ∑
->
Êags
 & 
IWL_UCODE_TLV_FLAGS_EBS_SUPPORT
) &&

857 
mvm
->
œ°_ebs_suc˚ssful
 && 
IWL_MVM_ENABLE_EBS
 &&

858 
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
 &&

859 (!
low_œãncy
 || 
	`iwl_mvm_is_‰ag_ebs_suµ‹ãd
(
mvm
)));

860 
	}
}

862 
ölöe
 
boﬁ
 
	$iwl_mvm_is_ªguœr_sˇn
(
iwl_mvm_sˇn_∑øms
 *
∑øms
)

864  
∑øms
->
n_sˇn_∂™s
 == 1 &&

865 
∑øms
->
sˇn_∂™s
[0].
ôî©i⁄s
 == 1;

866 
	}
}

868 
boﬁ
 
	$iwl_mvm_is_sˇn_‰agmíãd
(
iwl_mvm_sˇn_ty≥
 
ty≥
)

870  (
ty≥
 =
IWL_SCAN_TYPE_FRAGMENTED
 ||

871 
ty≥
 =
IWL_SCAN_TYPE_FAST_BALANCE
);

872 
	}
}

874 
	$iwl_mvm_sˇn_lmac_Êags
(
iwl_mvm
 *
mvm
,

875 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

876 
õì80211_vif
 *
vif
)

878 
Êags
 = 0;

880 i‡(
∑øms
->
n_ssids
 == 0)

881 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_PASSIVE
;

883 i‡(
∑øms
->
n_ssids
 =1 &&Ö¨ams->
ssids
[0].
ssid_Àn
 != 0)

884 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_PRE_CONNECTION
;

886 i‡(
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
))

887 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_FRAGMENTED
;

889 i‡(
	`iwl_mvm_ºm_sˇn_√eded
(
mvm
) &&

890 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

891 
IWL_UCODE_TLV_CAPA_WFA_TPC_REP_IE_SUPPORT
))

892 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAGS_RRM_ENABLED
;

894 i‡(
∑øms
->
∑ss_Æl
)

895 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_PASS_ALL
;

897 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_MATCH
;

899 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


900 i‡(
mvm
->
sˇn_ôî_nŸif_íabÀd
)

901 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_ITER_COMPLETE
;

904 i‡(
mvm
->
sched_sˇn_∑ss_Æl
 =
SCHED_SCAN_PASS_ALL_ENABLED
)

905 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_ITER_COMPLETE
;

907 i‡(
	`iwl_mvm_is_ªguœr_sˇn
(
∑øms
) &&

908 
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
 &&

909 !
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
))

910 
Êags
 |
IWL_MVM_LMAC_SCAN_FLAG_EXTENDED_DWELL
;

912  
Êags
;

913 
	}
}

916 
	$iwl_mvm_sˇn_£t_Àgacy_¥obe_ªq
(
iwl_sˇn_¥obe_ªq_v1
 *
p_ªq
,

917 
iwl_sˇn_¥obe_ªq
 *
§c_p_ªq
)

919 
i
;

921 
p_ªq
->
mac_hódî
 = 
§c_p_ªq
->mac_header;

922 
i
 = 0; i < 
SCAN_NUM_BAND_PROBE_DATA_V_1
; i++)

923 
p_ªq
->
b™d_d©a
[
i
] = 
§c_p_ªq
->band_data[i];

924 
p_ªq
->
comm⁄_d©a
 = 
§c_p_ªq
->common_data;

925 
	`mem˝y
(
p_ªq
->
buf
, 
§c_p_ªq
->buf, (p_req->buf));

926 
	}
}

928 
	$iwl_mvm_sˇn_lmac
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

929 
iwl_mvm_sˇn_∑øms
 *
∑øms
)

931 
iwl_sˇn_ªq_lmac
 *
cmd
 = 
mvm
->
sˇn_cmd
;

932 
iwl_sˇn_¥obe_ªq_v1
 *
¥eq
 =

933 (*)(
cmd
->
d©a
 + (
iwl_sˇn_ch™√l_cfg_lmac
) *

934 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
);

935 
u32
 
ssid_bôm≠
 = 0;

936 
i
;

937 
u8
 
b™d
;

939 i‡(
	`WARN_ON
(
∑øms
->
n_sˇn_∂™s
 > 
IWL_MAX_SCHED_SCAN_PLANS
))

940  -
EINVAL
;

942 
	`iwl_mvm_sˇn_lmac_dwñl
(
mvm
, 
cmd
, 
∑øms
);

944 
cmd
->
rx_chaö_£À˘
 = 
	`iwl_mvm_sˇn_rx_chaö
(
mvm
);

945 
cmd
->
ôî_num
 = 
	`˝u_to_À32
(1);

946 
cmd
->
n_ch™√ls
 = (
u8
)
∑øms
->n_channels;

948 
cmd
->
dñay
 = 
	`˝u_to_À32
(
∑øms
->delay);

950 
cmd
->
sˇn_Êags
 = 
	`˝u_to_À32
(
	`iwl_mvm_sˇn_lmac_Êags
(
mvm
, 
∑øms
,

951 
vif
));

953 
b™d
 = 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
∑øms
->
ch™√ls
[0]->band);

954 
cmd
->
Êags
 = 
	`˝u_to_À32
(
b™d
);

955 
cmd
->
fûãr_Êags
 = 
	`˝u_to_À32
(
MAC_FILTER_ACCEPT_GRP
 |

956 
MAC_FILTER_IN_BEACON
);

957 
	`iwl_mvm_sˇn_fûl_tx_cmd
(
mvm
, 
cmd
->
tx_cmd
, 
∑øms
->
no_cck
);

958 
	`iwl_sˇn_buûd_ssids
(
∑øms
, 
cmd
->
dúe˘_sˇn
, &
ssid_bôm≠
);

961 
ssid_bôm≠
 <<= 1;

963 
i
 = 0; i < 
∑øms
->
n_sˇn_∂™s
; i++) {

964 
cfg80211_sched_sˇn_∂™
 *
sˇn_∂™
 =

965 &
∑øms
->
sˇn_∂™s
[
i
];

967 
cmd
->
scheduÀ
[
i
].
dñay
 =

968 
	`˝u_to_À16
(
sˇn_∂™
->
öãrvÆ
);

969 
cmd
->
scheduÀ
[
i
].
ôî©i⁄s
 = 
sˇn_∂™
->iterations;

970 
cmd
->
scheduÀ
[
i
].
fuŒ_sˇn_mul
 = 1;

979 i‡(!
cmd
->
scheduÀ
[
i
 - 1].
ôî©i⁄s
)

980 
cmd
->
scheduÀ
[
i
 - 1].
ôî©i⁄s
 = 0xff;

982 i‡(
	`iwl_mvm_sˇn_u£_ebs
(
mvm
, 
vif
)) {

983 
cmd
->
ch™√l_›t
[0].
Êags
 =

984 
	`˝u_to_À16
(
IWL_SCAN_CHANNEL_FLAG_EBS
 |

985 
IWL_SCAN_CHANNEL_FLAG_EBS_ACCURATE
 |

986 
IWL_SCAN_CHANNEL_FLAG_CACHE_ADD
);

987 
cmd
->
ch™√l_›t
[0].
n⁄_ebs_øtio
 =

988 
	`˝u_to_À16
(
IWL_DENSE_EBS_SCAN_RATIO
);

989 
cmd
->
ch™√l_›t
[1].
Êags
 =

990 
	`˝u_to_À16
(
IWL_SCAN_CHANNEL_FLAG_EBS
 |

991 
IWL_SCAN_CHANNEL_FLAG_EBS_ACCURATE
 |

992 
IWL_SCAN_CHANNEL_FLAG_CACHE_ADD
);

993 
cmd
->
ch™√l_›t
[1].
n⁄_ebs_øtio
 =

994 
	`˝u_to_À16
(
IWL_SPARSE_EBS_SCAN_RATIO
);

997 
	`iwl_mvm_lmac_sˇn_cfg_ch™√ls
(
mvm
, 
∑øms
->
ch™√ls
,

998 
∑øms
->
n_ch™√ls
, 
ssid_bôm≠
, 
cmd
);

1000 
	`iwl_mvm_sˇn_£t_Àgacy_¥obe_ªq
(
¥eq
, &
∑øms
->preq);

1003 
	}
}

1005 
	$øã_to_sˇn_øã_Êag
(
øã
)

1007 c⁄° 
øã_to_sˇn_øã
[
IWL_RATE_COUNT
] = {

1008 [
IWL_RATE_1M_INDEX
] = 
SCAN_CONFIG_RATE_1M
,

1009 [
IWL_RATE_2M_INDEX
] = 
SCAN_CONFIG_RATE_2M
,

1010 [
IWL_RATE_5M_INDEX
] = 
SCAN_CONFIG_RATE_5M
,

1011 [
IWL_RATE_11M_INDEX
] = 
SCAN_CONFIG_RATE_11M
,

1012 [
IWL_RATE_6M_INDEX
] = 
SCAN_CONFIG_RATE_6M
,

1013 [
IWL_RATE_9M_INDEX
] = 
SCAN_CONFIG_RATE_9M
,

1014 [
IWL_RATE_12M_INDEX
] = 
SCAN_CONFIG_RATE_12M
,

1015 [
IWL_RATE_18M_INDEX
] = 
SCAN_CONFIG_RATE_18M
,

1016 [
IWL_RATE_24M_INDEX
] = 
SCAN_CONFIG_RATE_24M
,

1017 [
IWL_RATE_36M_INDEX
] = 
SCAN_CONFIG_RATE_36M
,

1018 [
IWL_RATE_48M_INDEX
] = 
SCAN_CONFIG_RATE_48M
,

1019 [
IWL_RATE_54M_INDEX
] = 
SCAN_CONFIG_RATE_54M
,

1022  
øã_to_sˇn_øã
[
øã
];

1023 
	}
}

1025 
__À32
 
	$iwl_mvm_sˇn_c⁄fig_øãs
(
iwl_mvm
 *
mvm
)

1027 
õì80211_suµ‹ãd_b™d
 *
b™d
;

1028 
øãs
 = 0;

1029 
i
;

1031 
b™d
 = &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

1032 
i
 = 0; i < 
b™d
->
n_bôøãs
; i++)

1033 
øãs
 |
	`øã_to_sˇn_øã_Êag
(
b™d
->
bôøãs
[
i
].
hw_vÆue
);

1034 
b™d
 = &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

1035 
i
 = 0; i < 
b™d
->
n_bôøãs
; i++)

1036 
øãs
 |
	`øã_to_sˇn_øã_Êag
(
b™d
->
bôøãs
[
i
].
hw_vÆue
);

1039 
øãs
 |
	`SCAN_CONFIG_SUPPORTED_RATE
(rates);

1041  
	`˝u_to_À32
(
øãs
);

1042 
	}
}

1044 
	$iwl_mvm_fûl_sˇn_dwñl
(
iwl_mvm
 *
mvm
,

1045 
iwl_sˇn_dwñl
 *
dwñl
)

1047 
dwñl
->
a˘ive
 = 
IWL_SCAN_DWELL_ACTIVE
;

1048 
dwñl
->
∑ssive
 = 
IWL_SCAN_DWELL_PASSIVE
;

1049 
dwñl
->
‰agmíãd
 = 
IWL_SCAN_DWELL_FRAGMENTED
;

1050 
dwñl
->
exãnded
 = 
IWL_SCAN_DWELL_EXTENDED
;

1051 
	}
}

1053 
	$iwl_mvm_fûl_ch™√ls
(
iwl_mvm
 *
mvm
, 
u8
 *
ch™√ls
,

1054 
u32
 
max_ch™√ls
)

1056 
õì80211_suµ‹ãd_b™d
 *
b™d
;

1057 
i
, 
j
 = 0;

1059 
b™d
 = &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
];

1060 
i
 = 0; i < 
b™d
->
n_ch™√ls
 && 
j
 < 
max_ch™√ls
; i++, j++)

1061 
ch™√ls
[
j
] = 
b™d
->ch™√ls[
i
].
hw_vÆue
;

1062 
b™d
 = &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
];

1063 
i
 = 0; i < 
b™d
->
n_ch™√ls
 && 
j
 < 
max_ch™√ls
; i++, j++)

1064 
ch™√ls
[
j
] = 
b™d
->ch™√ls[
i
].
hw_vÆue
;

1065 
	}
}

1067 
	$iwl_mvm_fûl_sˇn_c⁄fig_v1
(
iwl_mvm
 *
mvm
, *
c⁄fig
,

1068 
u32
 
Êags
, 
u8
 
ch™√l_Êags
,

1069 
u32
 
max_ch™√ls
)

1071 
iwl_mvm_sˇn_ty≥
 
ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥
(
mvm
, 
NULL
);

1072 
iwl_sˇn_c⁄fig_v1
 *
cfg
 = 
c⁄fig
;

1074 
cfg
->
Êags
 = 
	`˝u_to_À32
(flags);

1075 
cfg
->
tx_chaös
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
));

1076 
cfg
->
rx_chaös
 = 
	`˝u_to_À32
(
	`iwl_mvm_sˇn_rx_™t
(
mvm
));

1077 
cfg
->
Àgacy_øãs
 = 
	`iwl_mvm_sˇn_c⁄fig_øãs
(
mvm
);

1078 
cfg
->
out_of_ch™√l_time
 = 
	`˝u_to_À32
(
sˇn_timög
[
ty≥
].
max_out_time
);

1079 
cfg
->
su•íd_time
 = 
	`˝u_to_À32
(
sˇn_timög
[
ty≥
].suspend_time);

1081 
	`iwl_mvm_fûl_sˇn_dwñl
(
mvm
, &
cfg
->
dwñl
);

1083 
	`mem˝y
(&
cfg
->
mac_addr
, &
mvm
->
addªs£s
[0].
addr
, 
ETH_ALEN
);

1086 
	`WARN_ON_ONCE
(
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
));

1088 
cfg
->
bˇ°_°a_id
 = 
mvm
->
aux_°a
.
°a_id
;

1089 
cfg
->
ch™√l_Êags
 = channel_flags;

1091 
	`iwl_mvm_fûl_ch™√ls
(
mvm
, 
cfg
->
ch™√l_¨øy
, 
max_ch™√ls
);

1092 
	}
}

1094 
	$iwl_mvm_fûl_sˇn_c⁄fig_v2
(
iwl_mvm
 *
mvm
, *
c⁄fig
,

1095 
u32
 
Êags
, 
u8
 
ch™√l_Êags
,

1096 
u32
 
max_ch™√ls
)

1098 
iwl_sˇn_c⁄fig_v2
 *
cfg
 = 
c⁄fig
;

1100 
cfg
->
Êags
 = 
	`˝u_to_À32
(flags);

1101 
cfg
->
tx_chaös
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
));

1102 
cfg
->
rx_chaös
 = 
	`˝u_to_À32
(
	`iwl_mvm_sˇn_rx_™t
(
mvm
));

1103 
cfg
->
Àgacy_øãs
 = 
	`iwl_mvm_sˇn_c⁄fig_øãs
(
mvm
);

1105 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

1106 
iwl_mvm_sˇn_ty≥
 
lb_ty≥
, 
hb_ty≥
;

1108 
lb_ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥_b™d
(
mvm
, 
NULL
,

1109 
NL80211_BAND_2GHZ
);

1110 
hb_ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥_b™d
(
mvm
, 
NULL
,

1111 
NL80211_BAND_5GHZ
);

1113 
cfg
->
out_of_ch™√l_time
[
SCAN_LB_LMAC_IDX
] =

1114 
	`˝u_to_À32
(
sˇn_timög
[
lb_ty≥
].
max_out_time
);

1115 
cfg
->
su•íd_time
[
SCAN_LB_LMAC_IDX
] =

1116 
	`˝u_to_À32
(
sˇn_timög
[
lb_ty≥
].
su•íd_time
);

1118 
cfg
->
out_of_ch™√l_time
[
SCAN_HB_LMAC_IDX
] =

1119 
	`˝u_to_À32
(
sˇn_timög
[
hb_ty≥
].
max_out_time
);

1120 
cfg
->
su•íd_time
[
SCAN_HB_LMAC_IDX
] =

1121 
	`˝u_to_À32
(
sˇn_timög
[
hb_ty≥
].
su•íd_time
);

1123 
iwl_mvm_sˇn_ty≥
 
ty≥
 =

1124 
	`iwl_mvm_gë_sˇn_ty≥
(
mvm
, 
NULL
);

1126 
cfg
->
out_of_ch™√l_time
[
SCAN_LB_LMAC_IDX
] =

1127 
	`˝u_to_À32
(
sˇn_timög
[
ty≥
].
max_out_time
);

1128 
cfg
->
su•íd_time
[
SCAN_LB_LMAC_IDX
] =

1129 
	`˝u_to_À32
(
sˇn_timög
[
ty≥
].
su•íd_time
);

1132 
	`iwl_mvm_fûl_sˇn_dwñl
(
mvm
, &
cfg
->
dwñl
);

1134 
	`mem˝y
(&
cfg
->
mac_addr
, &
mvm
->
addªs£s
[0].
addr
, 
ETH_ALEN
);

1137 
	`WARN_ON_ONCE
(
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
));

1139 
cfg
->
bˇ°_°a_id
 = 
mvm
->
aux_°a
.
°a_id
;

1140 
cfg
->
ch™√l_Êags
 = channel_flags;

1142 
	`iwl_mvm_fûl_ch™√ls
(
mvm
, 
cfg
->
ch™√l_¨øy
, 
max_ch™√ls
);

1143 
	}
}

1145 
	$iwl_mvm_Àgacy_c⁄fig_sˇn
(
iwl_mvm
 *
mvm
)

1147 *
cfg
;

1148 
ªt
, 
cmd_size
;

1149 
iwl_ho°_cmd
 
cmd
 = {

1150 .
id
 = 
	`WIDE_ID
(
IWL_ALWAYS_LONG_GROUP
, 
SCAN_CFG_CMD
),

1152 
iwl_mvm_sˇn_ty≥
 
ty≥
;

1153 
iwl_mvm_sˇn_ty≥
 
hb_ty≥
 = 
IWL_SCAN_TYPE_NOT_SET
;

1154 
num_ch™√ls
 =

1155 
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_2GHZ
].
n_ch™√ls
 +

1156 
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_5GHZ
].
n_ch™√ls
;

1157 
u32
 
Êags
;

1158 
u8
 
ch™√l_Êags
;

1160 i‡(
	`WARN_ON
(
num_ch™√ls
 > 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
))

1161 
num_ch™√ls
 = 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
;

1163 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

1164 
ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥_b™d
(
mvm
, 
NULL
,

1165 
NL80211_BAND_2GHZ
);

1166 
hb_ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥_b™d
(
mvm
, 
NULL
,

1167 
NL80211_BAND_5GHZ
);

1168 i‡(
ty≥
 =
mvm
->
sˇn_ty≥
 && 
hb_ty≥
 =mvm->
hb_sˇn_ty≥
)

1171 
ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥
(
mvm
, 
NULL
);

1172 i‡(
ty≥
 =
mvm
->
sˇn_ty≥
)

1176 i‡(
	`iwl_mvm_cdb_sˇn_≠i
(
mvm
))

1177 
cmd_size
 = (
iwl_sˇn_c⁄fig_v2
);

1179 
cmd_size
 = (
iwl_sˇn_c⁄fig_v1
);

1180 
cmd_size
 +
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
;

1182 
cfg
 = 
	`kzÆloc
(
cmd_size
, 
GFP_KERNEL
);

1183 i‡(!
cfg
)

1184  -
ENOMEM
;

1186 
Êags
 = 
SCAN_CONFIG_FLAG_ACTIVATE
 |

1187 
SCAN_CONFIG_FLAG_ALLOW_CHUB_REQS
 |

1188 
SCAN_CONFIG_FLAG_SET_TX_CHAINS
 |

1189 
SCAN_CONFIG_FLAG_SET_RX_CHAINS
 |

1190 
SCAN_CONFIG_FLAG_SET_AUX_STA_ID
 |

1191 
SCAN_CONFIG_FLAG_SET_ALL_TIMES
 |

1192 
SCAN_CONFIG_FLAG_SET_LEGACY_RATES
 |

1193 
SCAN_CONFIG_FLAG_SET_MAC_ADDR
 |

1194 
SCAN_CONFIG_FLAG_SET_CHANNEL_FLAGS
 |

1195 
	`SCAN_CONFIG_N_CHANNELS
(
num_ch™√ls
) |

1196 (
	`iwl_mvm_is_sˇn_‰agmíãd
(
ty≥
) ?

1197 
SCAN_CONFIG_FLAG_SET_FRAGMENTED
 :

1198 
SCAN_CONFIG_FLAG_CLEAR_FRAGMENTED
);

1200 
ch™√l_Êags
 = 
IWL_CHANNEL_FLAG_EBS
 |

1201 
IWL_CHANNEL_FLAG_ACCURATE_EBS
 |

1202 
IWL_CHANNEL_FLAG_EBS_ADD
 |

1203 
IWL_CHANNEL_FLAG_PRE_SCAN_PASSIVE2ACTIVE
;

1209 i‡(
	`iwl_mvm_cdb_sˇn_≠i
(
mvm
)) {

1210 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
))

1211 
Êags
 |(
	`iwl_mvm_is_sˇn_‰agmíãd
(
hb_ty≥
)) ?

1212 
SCAN_CONFIG_FLAG_SET_LMAC2_FRAGMENTED
 :

1213 
SCAN_CONFIG_FLAG_CLEAR_LMAC2_FRAGMENTED
;

1214 
	`iwl_mvm_fûl_sˇn_c⁄fig_v2
(
mvm
, 
cfg
, 
Êags
, 
ch™√l_Êags
,

1215 
num_ch™√ls
);

1217 
	`iwl_mvm_fûl_sˇn_c⁄fig_v1
(
mvm
, 
cfg
, 
Êags
, 
ch™√l_Êags
,

1218 
num_ch™√ls
);

1221 
cmd
.
d©a
[0] = 
cfg
;

1222 
cmd
.
Àn
[0] = 
cmd_size
;

1223 
cmd
.
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
;

1225 
	`IWL_DEBUG_SCAN
(
mvm
, "Sending UMAC scan config\n");

1227 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

1228 i‡(!
ªt
) {

1229 
mvm
->
sˇn_ty≥
 = 
ty≥
;

1230 
mvm
->
hb_sˇn_ty≥
 = 
hb_ty≥
;

1233 
	`k‰ì
(
cfg
);

1234  
ªt
;

1235 
	}
}

1237 
	$iwl_mvm_c⁄fig_sˇn
(
iwl_mvm
 *
mvm
)

1239 
iwl_sˇn_c⁄fig
 
cfg
;

1240 
iwl_ho°_cmd
 
cmd
 = {

1241 .
id
 = 
	`WIDE_ID
(
IWL_ALWAYS_LONG_GROUP
, 
SCAN_CFG_CMD
),

1242 .
Àn
[0] = (
cfg
),

1243 .
d©a
[0] = &
cfg
,

1244 .
d©aÊags
[0] = 
IWL_HCMD_DFL_NOCOPY
,

1247 i‡(!
	`iwl_mvm_is_ªdu˚d_c⁄fig_sˇn_suµ‹ãd
(
mvm
))

1248  
	`iwl_mvm_Àgacy_c⁄fig_sˇn
(
mvm
);

1250 
	`mem£t
(&
cfg
, 0, (cfg));

1252 i‡(!
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
)) {

1253 
cfg
.
bˇ°_°a_id
 = 
mvm
->
aux_°a
.
°a_id
;

1254 } i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
SCAN_CFG_CMD
, 0) < 5) {

1259 
cfg
.
bˇ°_°a_id
 = 0xff;

1262 
cfg
.
tx_chaös
 = 
	`˝u_to_À32
(
	`iwl_mvm_gë_vÆid_tx_™t
(
mvm
));

1263 
cfg
.
rx_chaös
 = 
	`˝u_to_À32
(
	`iwl_mvm_sˇn_rx_™t
(
mvm
));

1265 
	`IWL_DEBUG_SCAN
(
mvm
, "Sending UMAC scan config\n");

1267  
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

1268 
	}
}

1270 
	$iwl_mvm_sˇn_uid_by_°©us
(
iwl_mvm
 *
mvm
, 
°©us
)

1272 
i
;

1274 
i
 = 0; i < 
mvm
->
max_sˇns
; i++)

1275 i‡(
mvm
->
sˇn_uid_°©us
[
i
] =
°©us
)

1276  
i
;

1278  -
ENOENT
;

1279 
	}
}

1281 
	$iwl_mvm_sˇn_umac_dwñl
(
iwl_mvm
 *
mvm
,

1282 
iwl_sˇn_ªq_umac
 *
cmd
,

1283 
iwl_mvm_sˇn_∑øms
 *
∑øms
)

1285 
iwl_mvm_sˇn_timög_∑øms
 *
timög
, *
hb_timög
;

1286 
u8
 
a˘ive_dwñl
, 
∑ssive_dwñl
;

1288 
timög
 = &
sˇn_timög
[
∑øms
->
ty≥
];

1289 
a˘ive_dwñl
 = 
IWL_SCAN_DWELL_ACTIVE
;

1290 
∑ssive_dwñl
 = 
IWL_SCAN_DWELL_PASSIVE
;

1292 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
)) {

1293 
cmd
->
v7
.
adwñl_deÁu…_n_≠s_socül
 =

1294 
IWL_SCAN_ADWELL_DEFAULT_N_APS_SOCIAL
;

1295 
cmd
->
v7
.
adwñl_deÁu…_n_≠s
 =

1296 
IWL_SCAN_ADWELL_DEFAULT_LB_N_APS
;

1298 i‡(
	`iwl_mvm_is_adwñl_hb_≠_num_suµ‹ãd
(
mvm
))

1299 
cmd
->
v9
.
adwñl_deÁu…_hb_n_≠s
 =

1300 
IWL_SCAN_ADWELL_DEFAULT_HB_N_APS
;

1303 i‡(
IWL_MVM_ADWELL_MAX_BUDGET
)

1304 
cmd
->
v7
.
adwñl_max_budgë
 =

1305 
	`˝u_to_À16
(
IWL_MVM_ADWELL_MAX_BUDGET
);

1306 i‡(
∑øms
->
ssids
 &&Ö¨ams->ssids[0].
ssid_Àn
)

1307 
cmd
->
v7
.
adwñl_max_budgë
 =

1308 
	`˝u_to_À16
(
IWL_SCAN_ADWELL_MAX_BUDGET_DIRECTED_SCAN
);

1310 
cmd
->
v7
.
adwñl_max_budgë
 =

1311 
	`˝u_to_À16
(
IWL_SCAN_ADWELL_MAX_BUDGET_FULL_SCAN
);

1313 
cmd
->
v7
.
sˇn_¥i‹ôy
 = 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_6
);

1314 
cmd
->
v7
.
max_out_time
[
SCAN_LB_LMAC_IDX
] =

1315 
	`˝u_to_À32
(
timög
->
max_out_time
);

1316 
cmd
->
v7
.
su•íd_time
[
SCAN_LB_LMAC_IDX
] =

1317 
	`˝u_to_À32
(
timög
->
su•íd_time
);

1319 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

1320 
hb_timög
 = &
sˇn_timög
[
∑øms
->
hb_ty≥
];

1322 
cmd
->
v7
.
max_out_time
[
SCAN_HB_LMAC_IDX
] =

1323 
	`˝u_to_À32
(
hb_timög
->
max_out_time
);

1324 
cmd
->
v7
.
su•íd_time
[
SCAN_HB_LMAC_IDX
] =

1325 
	`˝u_to_À32
(
hb_timög
->
su•íd_time
);

1328 i‡(!
	`iwl_mvm_is_ad≠tive_dwñl_v2_suµ‹ãd
(
mvm
)) {

1329 
cmd
->
v7
.
a˘ive_dwñl
 =áctive_dwell;

1330 
cmd
->
v7
.
∑ssive_dwñl
 =Öassive_dwell;

1331 
cmd
->
v7
.
‰agmíãd_dwñl
 = 
IWL_SCAN_DWELL_FRAGMENTED
;

1333 
cmd
->
v8
.
a˘ive_dwñl
[
SCAN_LB_LMAC_IDX
] =áctive_dwell;

1334 
cmd
->
v8
.
∑ssive_dwñl
[
SCAN_LB_LMAC_IDX
] =Öassive_dwell;

1335 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

1336 
cmd
->
v8
.
a˘ive_dwñl
[
SCAN_HB_LMAC_IDX
] =

1337 
a˘ive_dwñl
;

1338 
cmd
->
v8
.
∑ssive_dwñl
[
SCAN_HB_LMAC_IDX
] =

1339 
∑ssive_dwñl
;

1343 
cmd
->
v1
.
exãnded_dwñl
 = 
IWL_SCAN_DWELL_EXTENDED
;

1344 
cmd
->
v1
.
a˘ive_dwñl
 =áctive_dwell;

1345 
cmd
->
v1
.
∑ssive_dwñl
 =Öassive_dwell;

1346 
cmd
->
v1
.
‰agmíãd_dwñl
 = 
IWL_SCAN_DWELL_FRAGMENTED
;

1348 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

1349 
hb_timög
 = &
sˇn_timög
[
∑øms
->
hb_ty≥
];

1351 
cmd
->
v6
.
max_out_time
[
SCAN_HB_LMAC_IDX
] =

1352 
	`˝u_to_À32
(
hb_timög
->
max_out_time
);

1353 
cmd
->
v6
.
su•íd_time
[
SCAN_HB_LMAC_IDX
] =

1354 
	`˝u_to_À32
(
hb_timög
->
su•íd_time
);

1357 i‡(
	`iwl_mvm_cdb_sˇn_≠i
(
mvm
)) {

1358 
cmd
->
v6
.
sˇn_¥i‹ôy
 =

1359 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_6
);

1360 
cmd
->
v6
.
max_out_time
[
SCAN_LB_LMAC_IDX
] =

1361 
	`˝u_to_À32
(
timög
->
max_out_time
);

1362 
cmd
->
v6
.
su•íd_time
[
SCAN_LB_LMAC_IDX
] =

1363 
	`˝u_to_À32
(
timög
->
su•íd_time
);

1365 
cmd
->
v1
.
sˇn_¥i‹ôy
 =

1366 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_6
);

1367 
cmd
->
v1
.
max_out_time
 =

1368 
	`˝u_to_À32
(
timög
->
max_out_time
);

1369 
cmd
->
v1
.
su•íd_time
 =

1370 
	`˝u_to_À32
(
timög
->
su•íd_time
);

1374 i‡(
	`iwl_mvm_is_ªguœr_sˇn
(
∑øms
))

1375 
cmd
->
ooc_¥i‹ôy
 = 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_6
);

1377 
cmd
->
ooc_¥i‹ôy
 = 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_2
);

1378 
	}
}

1380 
u32
 
	$iwl_mvm_sˇn_umac_ooc_¥i‹ôy
(
iwl_mvm_sˇn_∑øms
 *
∑øms
)

1382  
	`iwl_mvm_is_ªguœr_sˇn
(
∑øms
) ?

1383 
IWL_SCAN_PRIORITY_EXT_6
 :

1384 
IWL_SCAN_PRIORITY_EXT_2
;

1385 
	}
}

1388 
	$iwl_mvm_sˇn_umac_dwñl_v11
(
iwl_mvm
 *
mvm
,

1389 
iwl_sˇn_gíîÆ_∑øms_v11
 *
gíîÆ_∑øms
,

1390 
iwl_mvm_sˇn_∑øms
 *
∑øms
)

1392 
iwl_mvm_sˇn_timög_∑øms
 *
timög
, *
hb_timög
;

1393 
u8
 
a˘ive_dwñl
, 
∑ssive_dwñl
;

1395 
timög
 = &
sˇn_timög
[
∑øms
->
ty≥
];

1396 
a˘ive_dwñl
 = 
IWL_SCAN_DWELL_ACTIVE
;

1397 
∑ssive_dwñl
 = 
IWL_SCAN_DWELL_PASSIVE
;

1399 
gíîÆ_∑øms
->
adwñl_deÁu…_socül_chn
 =

1400 
IWL_SCAN_ADWELL_DEFAULT_N_APS_SOCIAL
;

1401 
gíîÆ_∑øms
->
adwñl_deÁu…_2g
 = 
IWL_SCAN_ADWELL_DEFAULT_LB_N_APS
;

1402 
gíîÆ_∑øms
->
adwñl_deÁu…_5g
 = 
IWL_SCAN_ADWELL_DEFAULT_HB_N_APS
;

1405 i‡(
IWL_MVM_ADWELL_MAX_BUDGET
)

1406 
gíîÆ_∑øms
->
adwñl_max_budgë
 =

1407 
	`˝u_to_À16
(
IWL_MVM_ADWELL_MAX_BUDGET
);

1408 i‡(
∑øms
->
ssids
 &&Ö¨ams->ssids[0].
ssid_Àn
)

1409 
gíîÆ_∑øms
->
adwñl_max_budgë
 =

1410 
	`˝u_to_À16
(
IWL_SCAN_ADWELL_MAX_BUDGET_DIRECTED_SCAN
);

1412 
gíîÆ_∑øms
->
adwñl_max_budgë
 =

1413 
	`˝u_to_À16
(
IWL_SCAN_ADWELL_MAX_BUDGET_FULL_SCAN
);

1415 
gíîÆ_∑øms
->
sˇn_¥i‹ôy
 = 
	`˝u_to_À32
(
IWL_SCAN_PRIORITY_EXT_6
);

1416 
gíîÆ_∑øms
->
max_out_of_time
[
SCAN_LB_LMAC_IDX
] =

1417 
	`˝u_to_À32
(
timög
->
max_out_time
);

1418 
gíîÆ_∑øms
->
su•íd_time
[
SCAN_LB_LMAC_IDX
] =

1419 
	`˝u_to_À32
(
timög
->
su•íd_time
);

1421 
hb_timög
 = &
sˇn_timög
[
∑øms
->
hb_ty≥
];

1423 
gíîÆ_∑øms
->
max_out_of_time
[
SCAN_HB_LMAC_IDX
] =

1424 
	`˝u_to_À32
(
hb_timög
->
max_out_time
);

1425 
gíîÆ_∑øms
->
su•íd_time
[
SCAN_HB_LMAC_IDX
] =

1426 
	`˝u_to_À32
(
hb_timög
->
su•íd_time
);

1428 
gíîÆ_∑øms
->
a˘ive_dwñl
[
SCAN_LB_LMAC_IDX
] =áctive_dwell;

1429 
gíîÆ_∑øms
->
∑ssive_dwñl
[
SCAN_LB_LMAC_IDX
] =Öassive_dwell;

1430 
gíîÆ_∑øms
->
a˘ive_dwñl
[
SCAN_HB_LMAC_IDX
] =áctive_dwell;

1431 
gíîÆ_∑øms
->
∑ssive_dwñl
[
SCAN_HB_LMAC_IDX
] =Öassive_dwell;

1432 
	}
}

1434 
	siwl_mvm_sˇn_ch™√l_£gmít
 {

1435 
u8
 
	m°¨t_idx
;

1436 
u8
 
	míd_idx
;

1437 
u8
 
	mfú°_ch™√l_id
;

1438 
u8
 
	mœ°_ch™√l_id
;

1439 
u8
 
	mch™√l_•acög_shi·
;

1440 
u8
 
	mb™d
;

1443 c⁄° 
iwl_mvm_sˇn_ch™√l_£gmít
 
	gsˇn_ch™√l_£gmíts
[] = {

1445 .
°¨t_idx
 = 0,

1446 .
	gíd_idx
 = 13,

1447 .
	gfú°_ch™√l_id
 = 1,

1448 .
	gœ°_ch™√l_id
 = 14,

1449 .
	gch™√l_•acög_shi·
 = 0,

1450 .
	gb™d
 = 
PHY_BAND_24


1453 .
	g°¨t_idx
 = 14,

1454 .
	gíd_idx
 = 41,

1455 .
	gfú°_ch™√l_id
 = 36,

1456 .
	gœ°_ch™√l_id
 = 144,

1457 .
	gch™√l_•acög_shi·
 = 2,

1458 .
	gb™d
 = 
PHY_BAND_5


1461 .
	g°¨t_idx
 = 42,

1462 .
	gíd_idx
 = 50,

1463 .
	gfú°_ch™√l_id
 = 149,

1464 .
	gœ°_ch™√l_id
 = 181,

1465 .
	gch™√l_•acög_shi·
 = 2,

1466 .
	gb™d
 = 
PHY_BAND_5


1469 .
	g°¨t_idx
 = 51,

1470 .
	gíd_idx
 = 111,

1471 .
	gfú°_ch™√l_id
 = 1,

1472 .
	gœ°_ch™√l_id
 = 241,

1473 .
	gch™√l_•acög_shi·
 = 2,

1474 .
	gb™d
 = 
PHY_BAND_6


1478 
	$iwl_mvm_sˇn_ch_™d_b™d_to_idx
(
u8
 
ch™√l_id
, u8 
b™d
)

1480 
i
, 
ödex
;

1482 i‡(!
ch™√l_id
)

1483  -
EINVAL
;

1485 
i
 = 0; i < 
	`ARRAY_SIZE
(
sˇn_ch™√l_£gmíts
); i++) {

1486 c⁄° 
iwl_mvm_sˇn_ch™√l_£gmít
 *
ch_£gmít
 =

1487 &
sˇn_ch™√l_£gmíts
[
i
];

1488 
u32
 
ch_off£t
;

1490 i‡(
ch_£gmít
->
b™d
 != band ||

1491 
ch_£gmít
->
fú°_ch™√l_id
 > 
ch™√l_id
 ||

1492 
ch_£gmít
->
œ°_ch™√l_id
 < 
ch™√l_id
)

1495 
ch_off£t
 = (
ch™√l_id
 - 
ch_£gmít
->
fú°_ch™√l_id
) >>

1496 
ch_£gmít
->
ch™√l_•acög_shi·
;

1498 
ödex
 = 
sˇn_ch™√l_£gmíts
[
i
].
°¨t_idx
 + 
ch_off£t
;

1499 i‡(
ödex
 < 
IWL_SCAN_NUM_CHANNELS
)

1500  
ödex
;

1505  -
EINVAL
;

1506 
	}
}

1508 c⁄° 
u8
 
	gp2p_go_‰õndly_chs
[] = {

1512 c⁄° 
u8
 
	gsocül_chs
[] = {

1516 
	$iwl_mvm_sˇn_ch_add_n_≠s_ovîride
(
∆80211_i·y≥
 
vif_ty≥
,

1517 
u8
 
ch_id
, u8 
b™d
, u8 *
ch_bôm≠
,

1518 
size_t
 
bôm≠_n_íåõs
)

1520 
i
;

1522 i‡(
vif_ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
)

1525 
i
 = 0; i < 
	`ARRAY_SIZE
(
p2p_go_‰õndly_chs
); i++) {

1526 i‡(
p2p_go_‰õndly_chs
[
i
] =
ch_id
) {

1527 
ch_idx
, 
bôm≠_idx
;

1529 
ch_idx
 = 
	`iwl_mvm_sˇn_ch_™d_b™d_to_idx
(
ch_id
, 
b™d
);

1530 i‡(
ch_idx
 < 0)

1533 
bôm≠_idx
 = 
ch_idx
 / 8;

1534 i‡(
bôm≠_idx
 >
bôm≠_n_íåõs
)

1537 
ch_idx
 = ch_idx % 8;

1538 
ch_bôm≠
[
bôm≠_idx
] |
	`BIT
(
ch_idx
);

1543 
	}
}

1545 
u32
 
	$iwl_mvm_sˇn_ch_n_≠s_Êag
(
∆80211_i·y≥
 
vif_ty≥
, 
u8
 
ch_id
)

1547 
i
;

1548 
u32
 
Êags
 = 0;

1550 i‡(
vif_ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
)

1551 
out
;

1553 
i
 = 0; i < 
	`ARRAY_SIZE
(
p2p_go_‰õndly_chs
); i++) {

1554 i‡(
p2p_go_‰õndly_chs
[
i
] =
ch_id
) {

1555 
Êags
 |
IWL_SCAN_ADWELL_N_APS_GO_FRIENDLY_BIT
;

1560 i‡(
Êags
)

1561 
out
;

1563 
i
 = 0; i < 
	`ARRAY_SIZE
(
socül_chs
); i++) {

1564 i‡(
socül_chs
[
i
] =
ch_id
) {

1565 
Êags
 |
IWL_SCAN_ADWELL_N_APS_SOCIAL_CHS_BIT
;

1570 
out
:

1571  
Êags
;

1572 
	}
}

1575 
	$iwl_mvm_umac_sˇn_cfg_ch™√ls
(
iwl_mvm
 *
mvm
,

1576 
õì80211_ch™√l
 **
ch™√ls
,

1577 
n_ch™√ls
, 
u32
 
Êags
,

1578 
iwl_sˇn_ch™√l_cfg_umac
 *
ch™√l_cfg
)

1580 
i
;

1582 
i
 = 0; i < 
n_ch™√ls
; i++) {

1583 
ch™√l_cfg
[
i
].
Êags
 = 
	`˝u_to_À32
(flags);

1584 
ch™√l_cfg
[
i
].
v1
.
ch™√l_num
 = 
ch™√ls
[i]->
hw_vÆue
;

1585 i‡(
	`iwl_mvm_is_sˇn_ext_ch™_suµ‹ãd
(
mvm
)) {

1586 
∆80211_b™d
 
b™d
 = 
ch™√ls
[
i
]->band;

1588 
ch™√l_cfg
[
i
].
v2
.
b™d
 =

1589 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
b™d
);

1590 
ch™√l_cfg
[
i
].
v2
.
ôî_cou¡
 = 1;

1591 
ch™√l_cfg
[
i
].
v2
.
ôî_öãrvÆ
 = 0;

1593 
ch™√l_cfg
[
i
].
v1
.
ôî_cou¡
 = 1;

1594 
ch™√l_cfg
[
i
].
v1
.
ôî_öãrvÆ
 = 0;

1597 
	}
}

1600 
	$iwl_mvm_umac_sˇn_cfg_ch™√ls_v4
(
iwl_mvm
 *
mvm
,

1601 
õì80211_ch™√l
 **
ch™√ls
,

1602 
iwl_sˇn_ch™√l_∑øms_v4
 *
˝
,

1603 
n_ch™√ls
, 
u32
 
Êags
,

1604 
∆80211_i·y≥
 
vif_ty≥
)

1606 
u8
 *
bôm≠
 = 
˝
->
adwñl_ch_ovîride_bôm≠
;

1607 
size_t
 
bôm≠_n_íåõs
 = 
	`ARRAY_SIZE
(
˝
->
adwñl_ch_ovîride_bôm≠
);

1608 
i
;

1610 
i
 = 0; i < 
n_ch™√ls
; i++) {

1611 
∆80211_b™d
 
b™d
 = 
ch™√ls
[
i
]->band;

1612 
iwl_sˇn_ch™√l_cfg_umac
 *
cfg
 =

1613 &
˝
->
ch™√l_c⁄fig
[
i
];

1615 
cfg
->
Êags
 = 
	`˝u_to_À32
(flags);

1616 
cfg
->
v2
.
ch™√l_num
 = 
ch™√ls
[
i
]->
hw_vÆue
;

1617 
cfg
->
v2
.
b™d
 = 
	`iwl_mvm_phy_b™d_‰om_∆80211
(band);

1618 
cfg
->
v2
.
ôî_cou¡
 = 1;

1619 
cfg
->
v2
.
ôî_öãrvÆ
 = 0;

1621 
	`iwl_mvm_sˇn_ch_add_n_≠s_ovîride
(
vif_ty≥
,

1622 
cfg
->
v2
.
ch™√l_num
,

1623 
cfg
->
v2
.
b™d
, 
bôm≠
,

1624 
bôm≠_n_íåõs
);

1626 
	}
}

1629 
	$iwl_mvm_umac_sˇn_cfg_ch™√ls_v7
(
iwl_mvm
 *
mvm
,

1630 
õì80211_ch™√l
 **
ch™√ls
,

1631 
iwl_sˇn_ch™√l_∑øms_v7
 *
˝
,

1632 
n_ch™√ls
, 
u32
 
Êags
,

1633 
∆80211_i·y≥
 
vif_ty≥
, 
u32
 
vîsi⁄
)

1635 
i
;

1637 
i
 = 0; i < 
n_ch™√ls
; i++) {

1638 
∆80211_b™d
 
b™d
 = 
ch™√ls
[
i
]->band;

1639 
iwl_sˇn_ch™√l_cfg_umac
 *
cfg
 = &
˝
->
ch™√l_c⁄fig
[
i
];

1640 
u32
 
n_≠s_Êag
 =

1641 
	`iwl_mvm_sˇn_ch_n_≠s_Êag
(
vif_ty≥
,

1642 
ch™√ls
[
i
]->
hw_vÆue
);

1643 
u8
 
iwl_b™d
 = 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
b™d
);

1645 
cfg
->
Êags
 = 
	`˝u_to_À32
(Êag†| 
n_≠s_Êag
);

1646 
cfg
->
v2
.
ch™√l_num
 = 
ch™√ls
[
i
]->
hw_vÆue
;

1647 i‡(
	`cfg80211_ch™√l_is_psc
(
ch™√ls
[
i
]))

1648 
cfg
->
Êags
 = 0;

1649 
cfg
->
v2
.
ôî_cou¡
 = 1;

1650 
cfg
->
v2
.
ôî_öãrvÆ
 = 0;

1651 i‡(
vîsi⁄
 < 17)

1652 
cfg
->
v2
.
b™d
 = 
iwl_b™d
;

1654 
cfg
->
Êags
 |
	`˝u_to_À32
((
iwl_b™d
 <<

1655 
IWL_CHAN_CFG_FLAGS_BAND_POS
));

1657 
	}
}

1660 
	$iwl_mvm_umac_sˇn_fûl_6g_ch™_li°
(
iwl_mvm
 *
mvm
,

1661 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

1662 
iwl_sˇn_¥obe_∑øms_v4
 *
µ
)

1664 
j
, 
idex_s
 = 0, 
idex_b
 = 0;

1665 
cfg80211_sˇn_6ghz_∑øms
 *
sˇn_6ghz_∑øms
 =

1666 
∑øms
->
sˇn_6ghz_∑øms
;

1667 
boﬁ
 
hiddí_suµ‹ãd
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1668 
IWL_UCODE_TLV_CAPA_HIDDEN_6GHZ_SCAN
);

1670 
j
 = 0; j < 
∑øms
->
n_ssids
 && 
idex_s
 < 
SCAN_SHORT_SSID_MAX_SIZE
;

1671 
j
++) {

1672 i‡(!
∑øms
->
ssids
[
j
].
ssid_Àn
)

1675 
µ
->
sh‹t_ssid
[
idex_s
] =

1676 
	`˝u_to_À32
(~
	`¸c32_À
(~0, 
∑øms
->
ssids
[
j
].
ssid
,

1677 
∑øms
->
ssids
[
j
].
ssid_Àn
));

1679 i‡(
hiddí_suµ‹ãd
) {

1680 
µ
->
dúe˘_sˇn
[
idex_s
].
id
 = 
WLAN_EID_SSID
;

1681 
µ
->
dúe˘_sˇn
[
idex_s
].
Àn
 = 
∑øms
->
ssids
[
j
].
ssid_Àn
;

1682 
	`mem˝y
(
µ
->
dúe˘_sˇn
[
idex_s
].
ssid
, 
∑øms
->
ssids
[
j
].ssid,

1683 
∑øms
->
ssids
[
j
].
ssid_Àn
);

1685 
idex_s
++;

1696 
j
 = 0; j < 
∑øms
->
n_6ghz_∑øms
; j++) {

1697 
k
;

1700 i‡(
sˇn_6ghz_∑øms
[
j
].
sh‹t_ssid_vÆid
) {

1701 
k
 = 0; k < 
idex_s
; k++) {

1702 i‡(
µ
->
sh‹t_ssid
[
k
] ==

1703 
	`˝u_to_À32
(
sˇn_6ghz_∑øms
[
j
].
sh‹t_ssid
))

1707 i‡(
k
 =
idex_s
 && idex_†< 
SCAN_SHORT_SSID_MAX_SIZE
) {

1708 
µ
->
sh‹t_ssid
[
idex_s
++] =

1709 
	`˝u_to_À32
(
sˇn_6ghz_∑øms
[
j
].
sh‹t_ssid
);

1714 
k
 = 0; k < 
idex_b
; k++) {

1715 i‡(!
	`memcmp
(&
µ
->
bssid_¨øy
[
k
],

1716 
sˇn_6ghz_∑øms
[
j
].
bssid
, 
ETH_ALEN
))

1720 i‡(
k
 =
idex_b
 && idex_b < 
SCAN_BSSID_MAX_SIZE
) {

1721 
	`mem˝y
(&
µ
->
bssid_¨øy
[
idex_b
++],

1722 
sˇn_6ghz_∑øms
[
j
].
bssid
, 
ETH_ALEN
);

1726 
µ
->
sh‹t_ssid_num
 = 
idex_s
;

1727 
µ
->
bssid_num
 = 
idex_b
;

1728 
	}
}

1731 
u32


1732 
	$iwl_mvm_umac_sˇn_cfg_ch™√ls_v7_6g
(
iwl_mvm
 *
mvm
,

1733 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

1734 
u32
 
n_ch™√ls
,

1735 
iwl_sˇn_¥obe_∑øms_v4
 *
µ
,

1736 
iwl_sˇn_ch™√l_∑øms_v7
 *
˝
,

1737 
∆80211_i·y≥
 
vif_ty≥
,

1738 
u32
 
vîsi⁄
)

1740 
i
;

1741 
cfg80211_sˇn_6ghz_∑øms
 *
sˇn_6ghz_∑øms
 =

1742 
∑øms
->
sˇn_6ghz_∑øms
;

1743 
u32
 
ch_˙t
;

1745 
i
 = 0, 
ch_˙t
 = 0; i < 
∑øms
->
n_ch™√ls
; i++) {

1746 
iwl_sˇn_ch™√l_cfg_umac
 *
cfg
 =

1747 &
˝
->
ch™√l_c⁄fig
[
ch_˙t
];

1749 
u32
 
s_ssid_bôm≠
 = 0, 
bssid_bôm≠
 = 0, 
Êags
 = 0;

1750 
u8
 
j
, 
k
, 
s_max
 = 0, 
b_max
 = 0, 
n_u£d_bssid_íåõs
;

1751 
boﬁ
 
f‹˚_∑ssive
, 
found
 = 
Ál£
, 
Ælow_∑ssive
 = 
åue
,

1752 
unsﬁicôed_¥obe_⁄_ch™
 = 
Ál£
, 
psc_no_li°í
 = false;

1753 
s8
 
psd_20
 = 
IEEE80211_RNR_TBTT_PARAMS_PSD_RESERVED
;

1760 i‡(!
	`cfg80211_ch™√l_is_psc
(
∑øms
->
ch™√ls
[
i
]) &&

1761 !
∑øms
->
n_6ghz_∑øms
 &&Ö¨ams->
n_ssids
)

1764 
cfg
->
v1
.
ch™√l_num
 = 
∑øms
->
ch™√ls
[
i
]->
hw_vÆue
;

1765 i‡(
vîsi⁄
 < 17)

1766 
cfg
->
v2
.
b™d
 = 
PHY_BAND_6
;

1768 
cfg
->
Êags
 |
	`˝u_to_À32
(
PHY_BAND_6
 <<

1769 
IWL_CHAN_CFG_FLAGS_BAND_POS
);

1771 
cfg
->
v5
.
ôî_cou¡
 = 1;

1772 
cfg
->
v5
.
ôî_öãrvÆ
 = 0;

1781 
n_u£d_bssid_íåõs
 = 3;

1782 
j
 = 0; j < 
∑øms
->
n_6ghz_∑øms
; j++) {

1783 
s8
 
tmp_psd_20
;

1785 i‡(!(
sˇn_6ghz_∑øms
[
j
].
ch™√l_idx
 =
i
))

1791 
tmp_psd_20
 = 
sˇn_6ghz_∑øms
[
j
].
psd_20
;

1792 i‡(
tmp_psd_20
 !=

1793 
IEEE80211_RNR_TBTT_PARAMS_PSD_RESERVED
 &&

1794 (
psd_20
 ==

1795 
IEEE80211_RNR_TBTT_PARAMS_PSD_RESERVED
 ||

1796 
psd_20
 < 
tmp_psd_20
))

1797 
psd_20
 = 
tmp_psd_20
;

1799 
found
 = 
Ál£
;

1800 
unsﬁicôed_¥obe_⁄_ch™
 |=

1801 
sˇn_6ghz_∑øms
[
j
].
unsﬁicôed_¥obe
;

1802 
psc_no_li°í
 |
sˇn_6ghz_∑øms
[
j
].psc_no_listen;

1804 
k
 = 0; k < 
µ
->
sh‹t_ssid_num
; k++) {

1805 i‡(!
sˇn_6ghz_∑øms
[
j
].
unsﬁicôed_¥obe
 &&

1806 
	`À32_to_˝u
(
µ
->
sh‹t_ssid
[
k
]) ==

1807 
sˇn_6ghz_∑øms
[
j
].
sh‹t_ssid
) {

1809 i‡(
s_ssid_bôm≠
 & 
	`BIT
(
k
)) {

1810 
found
 = 
åue
;

1821 i‡(
n_u£d_bssid_íåõs
 >= 3) {

1822 
s_ssid_bôm≠
 |
	`BIT
(
k
);

1823 
s_max
++;

1824 
n_u£d_bssid_íåõs
 -= 3;

1825 
found
 = 
åue
;

1827 } i‡(
µ
->
dúe˘_sˇn
[
k
].
Àn
) {

1828 
s_ssid_bôm≠
 |
	`BIT
(
k
);

1829 
s_max
++;

1830 
found
 = 
åue
;

1831 
Ælow_∑ssive
 = 
Ál£
;

1837 i‡(
found
)

1840 
k
 = 0; k < 
µ
->
bssid_num
; k++) {

1841 i‡(!
	`memcmp
(&
µ
->
bssid_¨øy
[
k
],

1842 
sˇn_6ghz_∑øms
[
j
].
bssid
,

1843 
ETH_ALEN
)) {

1844 i‡(!(
bssid_bôm≠
 & 
	`BIT
(
k
))) {

1845 
bssid_bôm≠
 |
	`BIT
(
k
);

1846 
b_max
++;

1847 
n_u£d_bssid_íåõs
++;

1854 i‡(
	`cfg80211_ch™√l_is_psc
(
∑øms
->
ch™√ls
[
i
]) &&

1855 
psc_no_li°í
)

1856 
Êags
 |
IWL_UHB_CHAN_CFG_FLAG_PSC_CHAN_NO_LISTEN
;

1858 i‡(
unsﬁicôed_¥obe_⁄_ch™
)

1859 
Êags
 |
IWL_UHB_CHAN_CFG_FLAG_UNSOLICITED_PROBE_RES
;

1878 i‡(!
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
)) {

1879 i‡(!
	`cfg80211_ch™√l_is_psc
(
∑øms
->
ch™√ls
[
i
]) ||

1880 
Êags
 & 
IWL_UHB_CHAN_CFG_FLAG_PSC_CHAN_NO_LISTEN
) {

1881 
f‹˚_∑ssive
 = (
s_max
 > 3 || 
b_max
 > 9);

1882 
f‹˚_∑ssive
 |(
unsﬁicôed_¥obe_⁄_ch™
 &&

1883 (
s_max
 > 2 || 
b_max
 > 6));

1885 
f‹˚_∑ssive
 = (
s_max
 > 2 || 
b_max
 > 6);

1887 } i‡(
	`cfg80211_ch™√l_is_psc
(
∑øms
->
ch™√ls
[
i
])) {

1888 
f‹˚_∑ssive
 = (
s_max
 > 1 || 
b_max
 > 3);

1890 
f‹˚_∑ssive
 = (
s_max
 > 2 || 
b_max
 > 6);

1891 
f‹˚_∑ssive
 |(
unsﬁicôed_¥obe_⁄_ch™
 &&

1892 (
s_max
 > 1 || 
b_max
 > 3));

1894 i‡((
Ælow_∑ssive
 && 
f‹˚_∑ssive
) ||

1895 (!(
bssid_bôm≠
 | 
s_ssid_bôm≠
) &&

1896 !
	`cfg80211_ch™√l_is_psc
(
∑øms
->
ch™√ls
[
i
])))

1897 
Êags
 |
IWL_UHB_CHAN_CFG_FLAG_FORCE_PASSIVE
;

1899 
Êags
 |
bssid_bôm≠
 | (
s_ssid_bôm≠
 << 16);

1901 
cfg
->
Êags
 |
	`˝u_to_À32
(flags);

1902 i‡(
vîsi⁄
 >= 17)

1903 
cfg
->
v5
.
psd_20
 =Ösd_20;

1905 
ch_˙t
++;

1908 i‡(
∑øms
->
n_ch™√ls
 > 
ch_˙t
)

1909 
	`IWL_DEBUG_SCAN
(
mvm
,

1911 
∑øms
->
n_ch™√ls
, 
ch_˙t
);

1913  
ch_˙t
;

1914 
	}
}

1916 
u8
 
	$iwl_mvm_sˇn_umac_ch™_Êags_v2
(
iwl_mvm
 *
mvm
,

1917 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

1918 
õì80211_vif
 *
vif
)

1920 
u8
 
Êags
 = 0;

1922 
Êags
 |
IWL_SCAN_CHANNEL_FLAG_ENABLE_CHAN_ORDER
;

1924 i‡(
	`iwl_mvm_sˇn_u£_ebs
(
mvm
, 
vif
))

1925 
Êags
 |
IWL_SCAN_CHANNEL_FLAG_EBS
 |

1926 
IWL_SCAN_CHANNEL_FLAG_EBS_ACCURATE
 |

1927 
IWL_SCAN_CHANNEL_FLAG_CACHE_ADD
;

1930 i‡((!
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) &&

1931 
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
)) ||

1932 (
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) &&

1933 
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
hb_ty≥
)))

1934 
Êags
 |
IWL_SCAN_CHANNEL_FLAG_EBS_FRAG
;

1940 i‡((!
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) &&

1941 
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
Ë&&Ö¨ams->
ª•e˘_p2p_go
) ||

1942 (
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) &&

1943 
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
hb_ty≥
) &&

1944 
∑øms
->
ª•e˘_p2p_go_hb
)) {

1945 
	`IWL_DEBUG_SCAN
(
mvm
, "Respect P2P GO. Force EBS\n");

1946 
Êags
 |
IWL_SCAN_CHANNEL_FLAG_FORCE_EBS
;

1949  
Êags
;

1950 
	}
}

1952 
	$iwl_mvm_sˇn_6ghz_∑ssive_sˇn
(
iwl_mvm
 *
mvm
,

1953 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

1954 
õì80211_vif
 *
vif
)

1956 
õì80211_suµ‹ãd_b™d
 *
sb™d
 =

1957 &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_6GHZ
];

1958 
u32
 
n_dißbÀd
, 
i
;

1960 
∑øms
->
íabÀ_6ghz_∑ssive
 = 
Ál£
;

1962 i‡(
∑øms
->
sˇn_6ghz
)

1965 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1966 
IWL_UCODE_TLV_CAPA_PASSIVE_6GHZ_SCAN
)) {

1967 
	`IWL_DEBUG_SCAN
(
mvm
,

1973 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
) {

1974 
	`IWL_DEBUG_SCAN
(
mvm
,

1984 i‡((
vif
->
cfg
.
assoc
 ||

1985 
	`time_a·î
(
mvm
->
œ°_6ghz_∑ssive_sˇn_jiffõs
 +

1986 (
IWL_MVM_6GHZ_PASSIVE_SCAN_TIMEOUT
 * 
HZ
), 
jiffõs
)) &&

1987 (
	`time_bef‹e
(
mvm
->
œ°_ª£t_‹_ªsume_time_jiffõs
 +

1988 (
IWL_MVM_6GHZ_PASSIVE_SCAN_ASSOC_TIMEOUT
 * 
HZ
),

1989 
jiffõs
))) {

1990 
	`IWL_DEBUG_SCAN
(
mvm
, "6GHzÖassive scan: %s\n",

1991 
vif
->
cfg
.
assoc
 ? "associated" :

1997 i‡(
∑øms
->
n_ch™√ls
 < 
IWL_MVM_6GHZ_PASSIVE_SCAN_MIN_CHANS
) {

1998 
	`IWL_DEBUG_SCAN
(
mvm
,

2003 
i
 = 0; i < 
∑øms
->
n_ssids
; i++) {

2004 i‡(!
∑øms
->
ssids
[
i
].
ssid_Àn
)

2009 i‡(
i
 =
∑øms
->
n_ssids
) {

2010 
	`IWL_DEBUG_SCAN
(
mvm
,

2015 i‡(!
sb™d
 || !sb™d->
n_ch™√ls
) {

2016 
	`IWL_DEBUG_SCAN
(
mvm
,

2021 
i
 = 0, 
n_dißbÀd
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

2022 i‡(
sb™d
->
ch™√ls
[
i
].
Êags
 & (
IEEE80211_CHAN_DISABLED
))

2023 
n_dißbÀd
++;

2030 i‡(
n_dißbÀd
 !
sb™d
->
n_ch™√ls
) {

2031 
	`IWL_DEBUG_SCAN
(
mvm
,

2037 
	`IWL_DEBUG_SCAN
(
mvm
, "6GHzÖassive scan: can beÉnabled\n");

2038 
∑øms
->
íabÀ_6ghz_∑ssive
 = 
åue
;

2039 
	}
}

2041 
u16
 
	$iwl_mvm_sˇn_umac_Êags_v2
(
iwl_mvm
 *
mvm
,

2042 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2043 
õì80211_vif
 *
vif
,

2044 
ty≥
)

2046 
u16
 
Êags
 = 0;

2054 i‡(
∑øms
->
n_ssids
 == 0)

2055 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_FORCE_PASSIVE
;

2056 i‡(
∑øms
->
n_ssids
 =1 &&Ö¨ams->
ssids
[0].
ssid_Àn
)

2057 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_USE_ALL_RX_CHAINS
;

2059 i‡(
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
))

2060 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_FRAGMENTED_LMAC1
;

2062 i‡(
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
hb_ty≥
))

2063 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_FRAGMENTED_LMAC2
;

2065 i‡(
∑øms
->
∑ss_Æl
)

2066 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_PASS_ALL
;

2068 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_MATCH
;

2070 i‡(!
	`iwl_mvm_is_ªguœr_sˇn
(
∑øms
))

2071 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_PERIODIC
;

2073 i‡(
∑øms
->
ôî_nŸif
 ||

2074 
mvm
->
sched_sˇn_∑ss_Æl
 =
SCHED_SCAN_PASS_ALL_ENABLED
)

2075 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_NTFY_ITER_COMPLETE
;

2077 i‡(
IWL_MVM_ADWELL_ENABLE
)

2078 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_ADAPTIVE_DWELL
;

2080 i‡(
ty≥
 =
IWL_MVM_SCAN_SCHED
 ||Åy≥ =
IWL_MVM_SCAN_NETDETECT
)

2081 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_PREEMPTIVE
;

2083 i‡((
ty≥
 =
IWL_MVM_SCAN_SCHED
 ||Åy≥ =
IWL_MVM_SCAN_NETDETECT
) &&

2084 
∑øms
->
Êags
 & 
NL80211_SCAN_FLAG_COLOCATED_6GHZ
)

2085 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_TRIGGER_UHB_SCAN
;

2087 i‡(
∑øms
->
íabÀ_6ghz_∑ssive
)

2088 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_6GHZ_PASSIVE_SCAN
;

2090 i‡(
	`iwl_mvm_is_o˚_suµ‹ãd
(
mvm
) &&

2091 (
∑øms
->
Êags
 & (
NL80211_SCAN_FLAG_ACCEPT_BCAST_PROBE_RESP
 |

2092 
NL80211_SCAN_FLAG_OCE_PROBE_REQ_HIGH_TX_RATE
 |

2093 
NL80211_SCAN_FLAG_FILS_MAX_CHANNEL_TIME
)))

2094 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_V2_OCE
;

2096  
Êags
;

2097 
	}
}

2099 
u8
 
	$iwl_mvm_sˇn_umac_Êags2
(
iwl_mvm
 *
mvm
,

2100 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2101 
õì80211_vif
 *
vif
, 
ty≥
)

2103 
u8
 
Êags
 = 0;

2105 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

2106 i‡(
∑øms
->
ª•e˘_p2p_go
)

2107 
Êags
 |
IWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_RESPECT_P2P_GO_LB
;

2108 i‡(
∑øms
->
ª•e˘_p2p_go_hb
)

2109 
Êags
 |
IWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_RESPECT_P2P_GO_HB
;

2111 i‡(
∑øms
->
ª•e˘_p2p_go
)

2112 
Êags
 = 
IWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_RESPECT_P2P_GO_LB
 |

2113 
IWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_RESPECT_P2P_GO_HB
;

2116 i‡(
∑øms
->
sˇn_6ghz
 &&

2117 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2118 
IWL_UCODE_TLV_CAPA_SCAN_DONT_TOGGLE_ANT
))

2119 
Êags
 |
IWL_UMAC_SCAN_GEN_PARAMS_FLAGS2_DONT_TOGGLE_ANT
;

2121  
Êags
;

2122 
	}
}

2124 
u16
 
	$iwl_mvm_sˇn_umac_Êags
(
iwl_mvm
 *
mvm
,

2125 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2126 
õì80211_vif
 *
vif
)

2128 
u16
 
Êags
 = 0;

2130 i‡(
∑øms
->
n_ssids
 == 0)

2131 
Êags
 = 
IWL_UMAC_SCAN_GEN_FLAGS_PASSIVE
;

2133 i‡(
∑øms
->
n_ssids
 =1 &&Ö¨ams->
ssids
[0].
ssid_Àn
 != 0)

2134 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_PRE_CONNECT
;

2136 i‡(
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
))

2137 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_FRAGMENTED
;

2139 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) &&

2140 
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
hb_ty≥
))

2141 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_LMAC2_FRAGMENTED
;

2143 i‡(
	`iwl_mvm_ºm_sˇn_√eded
(
mvm
) &&

2144 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2145 
IWL_UCODE_TLV_CAPA_WFA_TPC_REP_IE_SUPPORT
))

2146 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_RRM_ENABLED
;

2148 i‡(
∑øms
->
∑ss_Æl
)

2149 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_PASS_ALL
;

2151 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_MATCH
;

2153 i‡(!
	`iwl_mvm_is_ªguœr_sˇn
(
∑øms
))

2154 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_PERIODIC
;

2156 i‡(
∑øms
->
ôî_nŸif
)

2157 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_ITER_COMPLETE
;

2159 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2160 i‡(
mvm
->
sˇn_ôî_nŸif_íabÀd
)

2161 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_ITER_COMPLETE
;

2164 i‡(
mvm
->
sched_sˇn_∑ss_Æl
 =
SCHED_SCAN_PASS_ALL_ENABLED
)

2165 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_ITER_COMPLETE
;

2167 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
Ë&& 
IWL_MVM_ADWELL_ENABLE
)

2168 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_ADAPTIVE_DWELL
;

2175 i‡(
	`iwl_mvm_is_ªguœr_sˇn
(
∑øms
) &&

2176 
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
 &&

2177 !
	`iwl_mvm_is_sˇn_‰agmíãd
(
∑øms
->
ty≥
) &&

2178 !
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
) &&

2179 !
	`iwl_mvm_is_o˚_suµ‹ãd
(
mvm
))

2180 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_EXTENDED_DWELL
;

2182 i‡(
	`iwl_mvm_is_o˚_suµ‹ãd
(
mvm
)) {

2183 i‡((
∑øms
->
Êags
 &

2184 
NL80211_SCAN_FLAG_OCE_PROBE_REQ_HIGH_TX_RATE
))

2185 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_PROB_REQ_HIGH_TX_RATE
;

2191 i‡((
∑øms
->
Êags
 &

2192 
NL80211_SCAN_FLAG_OCE_PROBE_REQ_DEFERRAL_SUPPRESSION
) &&

2193 !
	`WARN_ON_ONCE
(!
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
)))

2194 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_PROB_REQ_DEFER_SUPP
;

2195 i‡((
∑øms
->
Êags
 & 
NL80211_SCAN_FLAG_FILS_MAX_CHANNEL_TIME
))

2196 
Êags
 |
IWL_UMAC_SCAN_GEN_FLAGS_MAX_CHNL_TIME
;

2199  
Êags
;

2200 
	}
}

2203 
	$iwl_mvm_fûl_sˇn_sched_∑øms
(
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2204 
iwl_sˇn_umac_scheduÀ
 *
scheduÀ
,

2205 
__À16
 *
dñay
)

2207 
i
;

2208 i‡(
	`WARN_ON
(!
∑øms
->
n_sˇn_∂™s
 ||

2209 
∑øms
->
n_sˇn_∂™s
 > 
IWL_MAX_SCHED_SCAN_PLANS
))

2210  -
EINVAL
;

2212 
i
 = 0; i < 
∑øms
->
n_sˇn_∂™s
; i++) {

2213 
cfg80211_sched_sˇn_∂™
 *
sˇn_∂™
 =

2214 &
∑øms
->
sˇn_∂™s
[
i
];

2216 
scheduÀ
[
i
].
ôî_cou¡
 = 
sˇn_∂™
->
ôî©i⁄s
;

2217 
scheduÀ
[
i
].
öãrvÆ
 =

2218 
	`˝u_to_À16
(
sˇn_∂™
->
öãrvÆ
);

2227 i‡(!
scheduÀ
[
∑øms
->
n_sˇn_∂™s
 - 1].
ôî_cou¡
)

2228 
scheduÀ
[
∑øms
->
n_sˇn_∂™s
 - 1].
ôî_cou¡
 = 0xff;

2230 *
dñay
 = 
	`˝u_to_À16
(
∑øms
->delay);

2233 
	}
}

2235 
	$iwl_mvm_sˇn_umac
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2236 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2237 
ty≥
, 
uid
)

2239 
iwl_sˇn_ªq_umac
 *
cmd
 = 
mvm
->
sˇn_cmd
;

2240 
iwl_sˇn_umac_ch™_∑øm
 *
ch™_∑øm
;

2241 *
cmd_d©a
 = 
	`iwl_mvm_gë_sˇn_ªq_umac_d©a
(
mvm
);

2242 *
£c_∑π
 = (
u8
 *)
cmd_d©a
 + (
iwl_sˇn_ch™√l_cfg_umac
) *

2243 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
;

2244 
iwl_sˇn_ªq_umac_èû_v2
 *
èû_v2
 =

2245 (
iwl_sˇn_ªq_umac_èû_v2
 *)
£c_∑π
;

2246 
iwl_sˇn_ªq_umac_èû_v1
 *
èû_v1
;

2247 
iwl_ssid_õ
 *
dúe˘_sˇn
;

2248 
ªt
 = 0;

2249 
u32
 
ssid_bôm≠
 = 0;

2250 
u8
 
ch™√l_Êags
 = 0;

2251 
u16
 
gí_Êags
;

2252 
iwl_mvm_vif
 *
sˇn_vif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2254 
ch™_∑øm
 = 
	`iwl_mvm_gë_sˇn_ªq_umac_ch™√l
(
mvm
);

2256 
	`iwl_mvm_sˇn_umac_dwñl
(
mvm
, 
cmd
, 
∑øms
);

2258 
mvm
->
sˇn_uid_°©us
[
uid
] = 
ty≥
;

2260 
cmd
->
uid
 = 
	`˝u_to_À32
(uid);

2261 
gí_Êags
 = 
	`iwl_mvm_sˇn_umac_Êags
(
mvm
, 
∑øms
, 
vif
);

2262 
cmd
->
gíîÆ_Êags
 = 
	`˝u_to_À16
(
gí_Êags
);

2263 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_v2_suµ‹ãd
(
mvm
)) {

2264 i‡(
gí_Êags
 & 
IWL_UMAC_SCAN_GEN_FLAGS_FRAGMENTED
)

2265 
cmd
->
v8
.
num_of_‰agmíts
[
SCAN_LB_LMAC_IDX
] =

2266 
IWL_SCAN_NUM_OF_FRAGS
;

2267 i‡(
gí_Êags
 & 
IWL_UMAC_SCAN_GEN_FLAGS_LMAC2_FRAGMENTED
)

2268 
cmd
->
v8
.
num_of_‰agmíts
[
SCAN_HB_LMAC_IDX
] =

2269 
IWL_SCAN_NUM_OF_FRAGS
;

2271 
cmd
->
v8
.
gíîÆ_Êags2
 =

2272 
IWL_UMAC_SCAN_GEN_FLAGS2_ALLOW_CHNL_REORDER
;

2275 
cmd
->
sˇn_°¨t_mac_id
 = 
sˇn_vif
->
id
;

2277 i‡(
ty≥
 =
IWL_MVM_SCAN_SCHED
 ||Åy≥ =
IWL_MVM_SCAN_NETDETECT
)

2278 
cmd
->
Êags
 = 
	`˝u_to_À32
(
IWL_UMAC_SCAN_FLAG_PREEMPTIVE
);

2280 i‡(
	`iwl_mvm_sˇn_u£_ebs
(
mvm
, 
vif
)) {

2281 
ch™√l_Êags
 = 
IWL_SCAN_CHANNEL_FLAG_EBS
 |

2282 
IWL_SCAN_CHANNEL_FLAG_EBS_ACCURATE
 |

2283 
IWL_SCAN_CHANNEL_FLAG_CACHE_ADD
;

2286 i‡(
	`iwl_mvm_is_‰ag_ebs_suµ‹ãd
(
mvm
)) {

2287 i‡(
gí_Êags
 &

2288 
IWL_UMAC_SCAN_GEN_FLAGS_LMAC2_FRAGMENTED
 ||

2289 (!
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
) &&

2290 
gí_Êags
 & 
IWL_UMAC_SCAN_GEN_FLAGS_FRAGMENTED
))

2291 
ch™√l_Êags
 |
IWL_SCAN_CHANNEL_FLAG_EBS_FRAG
;

2295 
ch™_∑øm
->
Êags
 = 
ch™√l_Êags
;

2296 
ch™_∑øm
->
cou¡
 = 
∑øms
->
n_ch™√ls
;

2298 
ªt
 = 
	`iwl_mvm_fûl_sˇn_sched_∑øms
(
∑øms
, 
èû_v2
->
scheduÀ
,

2299 &
èû_v2
->
dñay
);

2300 i‡(
ªt
) {

2301 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

2302  
ªt
;

2305 i‡(
	`iwl_mvm_is_sˇn_ext_ch™_suµ‹ãd
(
mvm
)) {

2306 
èû_v2
->
¥eq
 = 
∑øms
->preq;

2307 
dúe˘_sˇn
 = 
èû_v2
->direct_scan;

2309 
èû_v1
 = (
iwl_sˇn_ªq_umac_èû_v1
 *)
£c_∑π
;

2310 
	`iwl_mvm_sˇn_£t_Àgacy_¥obe_ªq
(&
èû_v1
->
¥eq
,

2311 &
∑øms
->
¥eq
);

2312 
dúe˘_sˇn
 = 
èû_v1
->direct_scan;

2314 
	`iwl_sˇn_buûd_ssids
(
∑øms
, 
dúe˘_sˇn
, &
ssid_bôm≠
);

2315 
	`iwl_mvm_umac_sˇn_cfg_ch™√ls
(
mvm
, 
∑øms
->
ch™√ls
,

2316 
∑øms
->
n_ch™√ls
, 
ssid_bôm≠
,

2317 
cmd_d©a
);

2319 
	}
}

2322 
	$iwl_mvm_sˇn_umac_fûl_gíîÆ_p_v12
(
iwl_mvm
 *
mvm
,

2323 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2324 
õì80211_vif
 *
vif
,

2325 
iwl_sˇn_gíîÆ_∑øms_v11
 *
gp
,

2326 
u16
 
gí_Êags
, 
u8
 
gí_Êags2
,

2327 
u32
 
vîsi⁄
)

2329 
iwl_mvm_vif
 *
sˇn_vif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2331 
	`iwl_mvm_sˇn_umac_dwñl_v11
(
mvm
, 
gp
, 
∑øms
);

2333 
	`IWL_DEBUG_SCAN
(
mvm
, "General: flags=0x%x, flags2=0x%x\n",

2334 
gí_Êags
, 
gí_Êags2
);

2336 
gp
->
Êags
 = 
	`˝u_to_À16
(
gí_Êags
);

2337 
gp
->
Êags2
 = 
gí_Êags2
;

2339 i‡(
gí_Êags
 & 
IWL_UMAC_SCAN_GEN_FLAGS_V2_FRAGMENTED_LMAC1
)

2340 
gp
->
num_of_‰agmíts
[
SCAN_LB_LMAC_IDX
] = 
IWL_SCAN_NUM_OF_FRAGS
;

2341 i‡(
gí_Êags
 & 
IWL_UMAC_SCAN_GEN_FLAGS_V2_FRAGMENTED_LMAC2
)

2342 
gp
->
num_of_‰agmíts
[
SCAN_HB_LMAC_IDX
] = 
IWL_SCAN_NUM_OF_FRAGS
;

2344 
mvm
->
sˇn_lök_id
 = 0;

2346 i‡(
vîsi⁄
 < 16) {

2347 
gp
->
sˇn_°¨t_mac_‹_lök_id
 = 
sˇn_vif
->
id
;

2349 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 =

2350 
sˇn_vif
->
lök
[
∑øms
->
tsf_ªp‹t_lök_id
];

2352 
mvm
->
sˇn_lök_id
 = 
∑øms
->
tsf_ªp‹t_lök_id
;

2353 i‡(!
	`WARN_ON
(!
lök_öfo
))

2354 
gp
->
sˇn_°¨t_mac_‹_lök_id
 = 
lök_öfo
->
fw_lök_id
;

2356 
	}
}

2359 
	$iwl_mvm_sˇn_umac_fûl_¥obe_p_v3
(
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2360 
iwl_sˇn_¥obe_∑øms_v3
 *
µ
)

2362 
µ
->
¥eq
 = 
∑øms
->preq;

2363 
µ
->
ssid_num
 = 
∑øms
->
n_ssids
;

2364 
	`iwl_sˇn_buûd_ssids
(
∑øms
, 
µ
->
dúe˘_sˇn
, 
NULL
);

2365 
	}
}

2368 
	$iwl_mvm_sˇn_umac_fûl_¥obe_p_v4
(
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2369 
iwl_sˇn_¥obe_∑øms_v4
 *
µ
,

2370 
u32
 *
bôm≠_ssid
)

2372 
µ
->
¥eq
 = 
∑øms
->preq;

2373 
	`iwl_sˇn_buûd_ssids
(
∑øms
, 
µ
->
dúe˘_sˇn
, 
bôm≠_ssid
);

2374 
	}
}

2377 
	$iwl_mvm_sˇn_umac_fûl_ch_p_v4
(
iwl_mvm
 *
mvm
,

2378 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2379 
õì80211_vif
 *
vif
,

2380 
iwl_sˇn_ch™√l_∑øms_v4
 *
˝
,

2381 
u32
 
ch™√l_cfg_Êags
)

2383 
˝
->
Êags
 = 
	`iwl_mvm_sˇn_umac_ch™_Êags_v2
(
mvm
, 
∑øms
, 
vif
);

2384 
˝
->
cou¡
 = 
∑øms
->
n_ch™√ls
;

2385 
˝
->
num_of_≠s_ovîride
 = 
IWL_SCAN_ADWELL_N_APS_GO_FRIENDLY
;

2387 
	`iwl_mvm_umac_sˇn_cfg_ch™√ls_v4
(
mvm
, 
∑øms
->
ch™√ls
, 
˝
,

2388 
∑øms
->
n_ch™√ls
,

2389 
ch™√l_cfg_Êags
,

2390 
vif
->
ty≥
);

2391 
	}
}

2394 
	$iwl_mvm_sˇn_umac_fûl_ch_p_v7
(
iwl_mvm
 *
mvm
,

2395 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2396 
õì80211_vif
 *
vif
,

2397 
iwl_sˇn_ch™√l_∑øms_v7
 *
˝
,

2398 
u32
 
ch™√l_cfg_Êags
,

2399 
u32
 
vîsi⁄
)

2401 
˝
->
Êags
 = 
	`iwl_mvm_sˇn_umac_ch™_Êags_v2
(
mvm
, 
∑øms
, 
vif
);

2402 
˝
->
cou¡
 = 
∑øms
->
n_ch™√ls
;

2403 
˝
->
n_≠s_ovîride
[0] = 
IWL_SCAN_ADWELL_N_APS_GO_FRIENDLY
;

2404 
˝
->
n_≠s_ovîride
[1] = 
IWL_SCAN_ADWELL_N_APS_SOCIAL_CHS
;

2406 
	`iwl_mvm_umac_sˇn_cfg_ch™√ls_v7
(
mvm
, 
∑øms
->
ch™√ls
, 
˝
,

2407 
∑øms
->
n_ch™√ls
,

2408 
ch™√l_cfg_Êags
,

2409 
vif
->
ty≥
, 
vîsi⁄
);

2411 i‡(
∑øms
->
íabÀ_6ghz_∑ssive
) {

2412 
õì80211_suµ‹ãd_b™d
 *
sb™d
 =

2413 &
mvm
->
nvm_d©a
->
b™ds
[
NL80211_BAND_6GHZ
];

2414 
u32
 
i
;

2416 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

2417 
õì80211_ch™√l
 *
ch™√l
 =

2418 &
sb™d
->
ch™√ls
[
i
];

2420 
iwl_sˇn_ch™√l_cfg_umac
 *
cfg
 =

2421 &
˝
->
ch™√l_c⁄fig
[˝->
cou¡
];

2423 i‡(!
	`cfg80211_ch™√l_is_psc
(
ch™√l
))

2426 
cfg
->
v5
.
ch™√l_num
 = 
ch™√l
->
hw_vÆue
;

2427 
cfg
->
v5
.
ôî_cou¡
 = 1;

2428 
cfg
->
v5
.
ôî_öãrvÆ
 = 0;

2430 i‡(
vîsi⁄
 < 17) {

2431 
cfg
->
Êags
 = 0;

2432 
cfg
->
v2
.
b™d
 = 
PHY_BAND_6
;

2434 
cfg
->
Êags
 = 
	`˝u_to_À32
(
PHY_BAND_6
 <<

2435 
IWL_CHAN_CFG_FLAGS_BAND_POS
);

2436 
cfg
->
v5
.
psd_20
 =

2437 
IEEE80211_RNR_TBTT_PARAMS_PSD_RESERVED
;

2439 
˝
->
cou¡
++;

2442 
	}
}

2444 
	$iwl_mvm_sˇn_umac_v12
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2445 
iwl_mvm_sˇn_∑øms
 *
∑øms
, 
ty≥
,

2446 
uid
)

2448 
iwl_sˇn_ªq_umac_v12
 *
cmd
 = 
mvm
->
sˇn_cmd
;

2449 
iwl_sˇn_ªq_∑øms_v12
 *
sˇn_p
 = &
cmd
->
sˇn_∑øms
;

2450 
ªt
;

2451 
u16
 
gí_Êags
;

2453 
mvm
->
sˇn_uid_°©us
[
uid
] = 
ty≥
;

2455 
cmd
->
ooc_¥i‹ôy
 = 
	`˝u_to_À32
(
	`iwl_mvm_sˇn_umac_ooc_¥i‹ôy
(
∑øms
));

2456 
cmd
->
uid
 = 
	`˝u_to_À32
(uid);

2458 
gí_Êags
 = 
	`iwl_mvm_sˇn_umac_Êags_v2
(
mvm
, 
∑øms
, 
vif
, 
ty≥
);

2459 
	`iwl_mvm_sˇn_umac_fûl_gíîÆ_p_v12
(
mvm
, 
∑øms
, 
vif
,

2460 &
sˇn_p
->
gíîÆ_∑øms
,

2461 
gí_Êags
, 0, 12);

2463 
ªt
 = 
	`iwl_mvm_fûl_sˇn_sched_∑øms
(
∑øms
,

2464 
sˇn_p
->
≥riodic_∑øms
.
scheduÀ
,

2465 &
sˇn_p
->
≥riodic_∑øms
.
dñay
);

2466 i‡(
ªt
)

2467  
ªt
;

2469 
	`iwl_mvm_sˇn_umac_fûl_¥obe_p_v3
(
∑øms
, &
sˇn_p
->
¥obe_∑øms
);

2470 
	`iwl_mvm_sˇn_umac_fûl_ch_p_v4
(
mvm
, 
∑øms
, 
vif
,

2471 &
sˇn_p
->
ch™√l_∑øms
, 0);

2474 
	}
}

2476 
	$iwl_mvm_sˇn_umac_v14_™d_above
(
iwl_mvm
 *
mvm
,

2477 
õì80211_vif
 *
vif
,

2478 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2479 
ty≥
, 
uid
, 
u32
 
vîsi⁄
)

2481 
iwl_sˇn_ªq_umac_v17
 *
cmd
 = 
mvm
->
sˇn_cmd
;

2482 
iwl_sˇn_ªq_∑øms_v17
 *
sˇn_p
 = &
cmd
->
sˇn_∑øms
;

2483 
iwl_sˇn_ch™√l_∑øms_v7
 *
˝
 = &
sˇn_p
->
ch™√l_∑øms
;

2484 
iwl_sˇn_¥obe_∑øms_v4
 *
pb
 = &
sˇn_p
->
¥obe_∑øms
;

2485 
ªt
;

2486 
u16
 
gí_Êags
;

2487 
u8
 
gí_Êags2
;

2488 
u32
 
bôm≠_ssid
 = 0;

2490 
mvm
->
sˇn_uid_°©us
[
uid
] = 
ty≥
;

2492 
cmd
->
ooc_¥i‹ôy
 = 
	`˝u_to_À32
(
	`iwl_mvm_sˇn_umac_ooc_¥i‹ôy
(
∑øms
));

2493 
cmd
->
uid
 = 
	`˝u_to_À32
(uid);

2495 
gí_Êags
 = 
	`iwl_mvm_sˇn_umac_Êags_v2
(
mvm
, 
∑øms
, 
vif
, 
ty≥
);

2497 i‡(
vîsi⁄
 >= 15)

2498 
gí_Êags2
 = 
	`iwl_mvm_sˇn_umac_Êags2
(
mvm
, 
∑øms
, 
vif
, 
ty≥
);

2500 
gí_Êags2
 = 0;

2502 
	`iwl_mvm_sˇn_umac_fûl_gíîÆ_p_v12
(
mvm
, 
∑øms
, 
vif
,

2503 &
sˇn_p
->
gíîÆ_∑øms
,

2504 
gí_Êags
, 
gí_Êags2
, 
vîsi⁄
);

2506 
ªt
 = 
	`iwl_mvm_fûl_sˇn_sched_∑øms
(
∑øms
,

2507 
sˇn_p
->
≥riodic_∑øms
.
scheduÀ
,

2508 &
sˇn_p
->
≥riodic_∑øms
.
dñay
);

2509 i‡(
ªt
)

2510  
ªt
;

2512 i‡(!
∑øms
->
sˇn_6ghz
) {

2513 
	`iwl_mvm_sˇn_umac_fûl_¥obe_p_v4
(
∑øms
,

2514 &
sˇn_p
->
¥obe_∑øms
,

2515 &
bôm≠_ssid
);

2516 
	`iwl_mvm_sˇn_umac_fûl_ch_p_v7
(
mvm
, 
∑øms
, 
vif
,

2517 &
sˇn_p
->
ch™√l_∑øms
,

2518 
bôm≠_ssid
,

2519 
vîsi⁄
);

2522 
pb
->
¥eq
 = 
∑øms
->preq;

2525 
˝
->
Êags
 = 
	`iwl_mvm_sˇn_umac_ch™_Êags_v2
(
mvm
, 
∑øms
, 
vif
);

2526 
˝
->
n_≠s_ovîride
[0] = 
IWL_SCAN_ADWELL_N_APS_GO_FRIENDLY
;

2527 
˝
->
n_≠s_ovîride
[1] = 
IWL_SCAN_ADWELL_N_APS_SOCIAL_CHS
;

2529 
	`iwl_mvm_umac_sˇn_fûl_6g_ch™_li°
(
mvm
, 
∑øms
, 
pb
);

2531 
˝
->
cou¡
 = 
	`iwl_mvm_umac_sˇn_cfg_ch™√ls_v7_6g
(
mvm
, 
∑øms
,

2532 
∑øms
->
n_ch™√ls
,

2533 
pb
, 
˝
, 
vif
->
ty≥
,

2534 
vîsi⁄
);

2535 i‡(!
˝
->
cou¡
) {

2536 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

2537  -
EINVAL
;

2540 i‡(!
∑øms
->
n_ssids
 ||

2541 (
∑øms
->
n_ssids
 =1 && !∑øms->
ssids
[0].
ssid_Àn
))

2542 
˝
->
Êags
 |
IWL_SCAN_CHANNEL_FLAG_6G_PSC_NO_FILTER
;

2545 
	}
}

2547 
	$iwl_mvm_sˇn_umac_v14
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2548 
iwl_mvm_sˇn_∑øms
 *
∑øms
, 
ty≥
,

2549 
uid
)

2551  
	`iwl_mvm_sˇn_umac_v14_™d_above
(
mvm
, 
vif
, 
∑øms
, 
ty≥
, 
uid
, 14);

2552 
	}
}

2554 
	$iwl_mvm_sˇn_umac_v15
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2555 
iwl_mvm_sˇn_∑øms
 *
∑øms
, 
ty≥
,

2556 
uid
)

2558  
	`iwl_mvm_sˇn_umac_v14_™d_above
(
mvm
, 
vif
, 
∑øms
, 
ty≥
, 
uid
, 15);

2559 
	}
}

2561 
	$iwl_mvm_sˇn_umac_v16
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2562 
iwl_mvm_sˇn_∑øms
 *
∑øms
, 
ty≥
,

2563 
uid
)

2565  
	`iwl_mvm_sˇn_umac_v14_™d_above
(
mvm
, 
vif
, 
∑øms
, 
ty≥
, 
uid
, 16);

2566 
	}
}

2568 
	$iwl_mvm_sˇn_umac_v17
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2569 
iwl_mvm_sˇn_∑øms
 *
∑øms
, 
ty≥
,

2570 
uid
)

2572  
	`iwl_mvm_sˇn_umac_v14_™d_above
(
mvm
, 
vif
, 
∑øms
, 
ty≥
, 
uid
, 17);

2573 
	}
}

2575 
	$iwl_mvm_num_sˇns
(
iwl_mvm
 *
mvm
)

2577  
	`hweight32
(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_MASK
);

2578 
	}
}

2580 
	$iwl_mvm_check_ru¬ög_sˇns
(
iwl_mvm
 *
mvm
, 
ty≥
)

2582 
boﬁ
 
unifõd_image
 = 
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2583 
IWL_UCODE_TLV_CAPA_CNSLDTD_D3_D0_IMG
);

2596 i‡((
ty≥
 =
IWL_MVM_SCAN_SCHED
 ||Åy≥ =
IWL_MVM_SCAN_NETDETECT
) &&

2597 
mvm
->
sˇn_°©us
 & (
IWL_MVM_SCAN_SCHED
 | 
IWL_MVM_SCAN_NETDETECT
))

2598  -
EBUSY
;

2600 i‡(
	`iwl_mvm_num_sˇns
(
mvm
Ë< mvm->
max_sˇns
)

2606 
ty≥
) {

2607 
IWL_MVM_SCAN_REGULAR
:

2608 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_REGULAR_MASK
)

2609  -
EBUSY
;

2610  
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_SCHED
, 
åue
);

2611 
IWL_MVM_SCAN_SCHED
:

2612 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_SCHED_MASK
)

2613  -
EBUSY
;

2614  
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_REGULAR
, 
åue
);

2615 
IWL_MVM_SCAN_NETDETECT
:

2621 i‡(!
unifõd_image
)

2630 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_REGULAR_MASK
)

2631  
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_REGULAR
,

2632 
åue
);

2633 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_SCHED_MASK
)

2634  
	`iwl_mvm_sˇn_°›
(
mvm
, 
IWL_MVM_SCAN_SCHED
,

2635 
åue
);

2639 
ÁŒthrough
;

2641 
	`WARN_ON
(1);

2645  -
EIO
;

2646 
	}
}

2648 
	#SCAN_TIMEOUT
 30000

	)

2650 
	$iwl_mvm_sˇn_timeout_wk
(
w‹k_°ru˘
 *
w‹k
)

2652 
dñayed_w‹k
 *dñayed_w‹k = 
	`to_dñayed_w‹k
(
w‹k
);

2653 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
dñayed_w‹k
, iwl_mvm,

2654 
sˇn_timeout_dw‹k
);

2656 
	`IWL_ERR
(
mvm
, "regular scanÅimed out\n");

2658 
	`iwl_f‹˚_nmi
(
mvm
->
å™s
);

2659 
	}
}

2661 
	$iwl_mvm_fûl_sˇn_ty≥
(
iwl_mvm
 *
mvm
,

2662 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2663 
õì80211_vif
 *
vif
)

2665 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

2666 
∑øms
->
ty≥
 =

2667 
	`iwl_mvm_gë_sˇn_ty≥_b™d
(
mvm
, 
vif
,

2668 
NL80211_BAND_2GHZ
);

2669 
∑øms
->
hb_ty≥
 =

2670 
	`iwl_mvm_gë_sˇn_ty≥_b™d
(
mvm
, 
vif
,

2671 
NL80211_BAND_5GHZ
);

2673 
∑øms
->
ty≥
 = 
	`iwl_mvm_gë_sˇn_ty≥
(
mvm
, 
vif
);

2675 
	}
}

2677 
	siwl_sˇn_umac_h™dÀr
 {

2678 
u8
 
	mvîsi⁄
;

2679 (*
	mh™dÀr
)(
iwl_mvm
 *
	mmvm
, 
õì80211_vif
 *
	mvif
,

2680 
iwl_mvm_sˇn_∑øms
 *
	m∑øms
, 
	mty≥
, 
	muid
);

2683 
	#IWL_SCAN_UMAC_HANDLER
(
_vî
) { \

2684 .
vîsi⁄
 = 
_vî
, \

2685 .
h™dÀr
 = 
iwl_mvm_sˇn_umac_v
##
_vî
, \

2686 }

	)

2688 c⁄° 
iwl_sˇn_umac_h™dÀr
 
	giwl_sˇn_umac_h™dÀrs
[] = {

2690 
IWL_SCAN_UMAC_HANDLER
(17),

2691 
IWL_SCAN_UMAC_HANDLER
(16),

2692 
IWL_SCAN_UMAC_HANDLER
(15),

2693 
IWL_SCAN_UMAC_HANDLER
(14),

2694 
IWL_SCAN_UMAC_HANDLER
(12),

2697 
	$iwl_mvm_mei_sˇn_w‹k
(
w‹k_°ru˘
 *
wk
)

2699 
iwl_mei_sˇn_fûãr
 *
sˇn_fûãr
 =

2700 
	`c⁄èöî_of
(
wk
, 
iwl_mei_sˇn_fûãr
, 
sˇn_w‹k
);

2701 
iwl_mvm
 *
mvm
 =

2702 
	`c⁄èöî_of
(
sˇn_fûãr
, 
iwl_mvm
, 
mei_sˇn_fûãr
);

2703 
iwl_mvm_csme_c⁄n_öfo
 *
öfo
;

2704 
sk_buff
 *
skb
;

2705 
u8
 
bssid
[
ETH_ALEN
];

2707 
	`muãx_lock
(&
mvm
->
muãx
);

2708 
öfo
 = 
	`iwl_mvm_gë_csme_c⁄n_öfo
(
mvm
);

2709 
	`mem˝y
(
bssid
, 
öfo
->
c⁄n_öfo
.bssid, 
ETH_ALEN
);

2710 
	`muãx_u∆ock
(&
mvm
->
muãx
);

2712 (
skb
 = 
	`skb_dequeue
(&
sˇn_fûãr
->
sˇn_ªs
))) {

2713 
õì80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

2715 i‡(!
	`memcmp
(
mgmt
->
bssid
, bssid, 
ETH_ALEN
))

2716 
	`õì80211_rx_úqß„
(
mvm
->
hw
, 
skb
);

2718 
	`k‰ì_skb
(
skb
);

2720 
	}
}

2722 
	$iwl_mvm_mei_sˇn_fûãr_öô
(
iwl_mei_sˇn_fûãr
 *
mei_sˇn_fûãr
)

2724 
	`skb_queue_hód_öô
(&
mei_sˇn_fûãr
->
sˇn_ªs
);

2725 
	`INIT_WORK
(&
mei_sˇn_fûãr
->
sˇn_w‹k
, 
iwl_mvm_mei_sˇn_w‹k
);

2726 
	}
}

2732 
	$iwl_mvm_mei_limôed_sˇn
(
iwl_mvm
 *
mvm
,

2733 
iwl_mvm_sˇn_∑øms
 *
∑øms
)

2735 
iwl_mvm_csme_c⁄n_öfo
 *
öfo
 = 
	`iwl_mvm_gë_csme_c⁄n_öfo
(
mvm
);

2736 
iwl_mei_c⁄n_öfo
 *
c⁄n_öfo
;

2737 
õì80211_ch™√l
 *
ch™
;

2738 
sˇn_ôîs
, 
i
;

2740 i‡(!
öfo
) {

2741 
	`IWL_DEBUG_SCAN
(
mvm
, "mei_limited_scan:Ço connection info\n");

2745 
c⁄n_öfo
 = &
öfo
->conn_info;

2746 i‡(!
öfo
->
c⁄n_öfo
.
Õ_°©e
 || !öfo->c⁄n_öfo.
ssid_Àn
)

2749 i‡(!
∑øms
->
n_ch™√ls
 || !∑øms->
n_ssids
)

2752 
mvm
->
mei_sˇn_fûãr
.
is_mei_limôed_sˇn
 = 
åue
;

2754 
ch™
 = 
	`õì80211_gë_ch™√l
(
mvm
->
hw
->
wùhy
,

2755 
	`õì80211_ch™√l_to_‰equícy
(
c⁄n_öfo
->
ch™√l
,

2756 
c⁄n_öfo
->
b™d
));

2757 i‡(!
ch™
) {

2758 
	`IWL_DEBUG_SCAN
(
mvm
,

2760 
c⁄n_öfo
->
ch™√l
, c⁄n_öfo->
b™d
);

2768 
sˇn_ôîs
 = 
	`mö
(
IWL_MEI_SCAN_NUM_ITER
, 
∑øms
->
n_ch™√ls
);

2769 
∑øms
->
n_ch™√ls
 = 
sˇn_ôîs
;

2770 
i
 = 0; i < 
sˇn_ôîs
; i++)

2771 
∑øms
->
ch™√ls
[
i
] = 
ch™
;

2773 
	`IWL_DEBUG_SCAN
(
mvm
, "Meòsˇn:Çum iãøti⁄s=%u\n", 
sˇn_ôîs
);

2775 
∑øms
->
n_ssids
 = 1;

2776 
∑øms
->
ssids
[0].
ssid_Àn
 = 
c⁄n_öfo
->ssid_len;

2777 
	`mem˝y
(
∑øms
->
ssids
[0].
ssid
, 
c⁄n_öfo
->ssid, c⁄n_öfo->
ssid_Àn
);

2778 
	}
}

2780 
	$iwl_mvm_buûd_sˇn_cmd
(
iwl_mvm
 *
mvm
,

2781 
õì80211_vif
 *
vif
,

2782 
iwl_ho°_cmd
 *
hcmd
,

2783 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2784 
ty≥
)

2786 
uid
, 
i
, 
îr
;

2787 
u8
 
sˇn_vî
;

2789 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2790 
	`mem£t
(
mvm
->
sˇn_cmd
, 0, mvm->
sˇn_cmd_size
);

2792 
	`iwl_mvm_mei_limôed_sˇn
(
mvm
, 
∑øms
);

2794 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
)) {

2795 
hcmd
->
id
 = 
SCAN_OFFLOAD_REQUEST_CMD
;

2797  
	`iwl_mvm_sˇn_lmac
(
mvm
, 
vif
, 
∑øms
);

2800 
uid
 = 
	`iwl_mvm_sˇn_uid_by_°©us
(
mvm
, 0);

2801 i‡(
uid
 < 0)

2802  
uid
;

2804 
hcmd
->
id
 = 
	`WIDE_ID
(
IWL_ALWAYS_LONG_GROUP
, 
SCAN_REQ_UMAC
);

2806 
sˇn_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
SCAN_REQ_UMAC
,

2807 
IWL_FW_CMD_VER_UNKNOWN
);

2809 
i
 = 0; i < 
	`ARRAY_SIZE
(
iwl_sˇn_umac_h™dÀrs
); i++) {

2810 c⁄° 
iwl_sˇn_umac_h™dÀr
 *
vî_h™dÀr
 =

2811 &
iwl_sˇn_umac_h™dÀrs
[
i
];

2813 i‡(
vî_h™dÀr
->
vîsi⁄
 !
sˇn_vî
)

2816 
îr
 = 
vî_h™dÀr
->
	`h™dÀr
(
mvm
, 
vif
, 
∑øms
, 
ty≥
, 
uid
);

2817  
îr
 ? : 
uid
;

2820 
îr
 = 
	`iwl_mvm_sˇn_umac
(
mvm
, 
vif
, 
∑øms
, 
ty≥
, 
uid
);

2821 i‡(
îr
)

2822  
îr
;

2824  
uid
;

2825 
	}
}

2827 
	siwl_mvm_sˇn_ª•e˘_p2p_go_ôî_d©a
 {

2828 
õì80211_vif
 *
	mcuºít_vif
;

2829 
boﬁ
 
	mp2p_go
;

2830 
∆80211_b™d
 
	mb™d
;

2833 
	$iwl_mvm_sˇn_ª•e˘_p2p_go_ôî
(*
_d©a
, 
u8
 *
mac
,

2834 
õì80211_vif
 *
vif
)

2836 
iwl_mvm_sˇn_ª•e˘_p2p_go_ôî_d©a
 *
d©a
 = 
_d©a
;

2837 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2840 i‡(
vif
 =
d©a
->
cuºít_vif
)

2843 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && vif->
p2p
) {

2844 
u32
 
lök_id
;

2846 
lök_id
 = 0;

2847 
lök_id
 < 
	`ARRAY_SIZE
(
mvmvif
->
lök
);

2848 
lök_id
++) {

2849 
iwl_mvm_vif_lök_öfo
 *
lök
 =

2850 
mvmvif
->
lök
[
lök_id
];

2852 i‡(
lök
 &&Üök->
phy_˘xt
->
id
 < 
NUM_PHY_CTX
 &&

2853 (
d©a
->
b™d
 =
NUM_NL80211_BANDS
 ||

2854 
lök
->
phy_˘xt
->
ch™√l
->
b™d
 =
d©a
->band)) {

2855 
d©a
->
p2p_go
 = 
åue
;

2860 
	}
}

2862 
boﬁ
 
	$_iwl_mvm_gë_ª•e˘_p2p_go
(
iwl_mvm
 *
mvm
,

2863 
õì80211_vif
 *
vif
,

2864 
boﬁ
 
low_œãncy
,

2865 
∆80211_b™d
 
b™d
)

2867 
iwl_mvm_sˇn_ª•e˘_p2p_go_ôî_d©a
 
d©a
 = {

2868 .
cuºít_vif
 = 
vif
,

2869 .
p2p_go
 = 
Ál£
,

2870 .
b™d
 = band,

2873 i‡(!
low_œãncy
)

2874  
Ál£
;

2876 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

2877 
IEEE80211_IFACE_ITER_NORMAL
,

2878 
iwl_mvm_sˇn_ª•e˘_p2p_go_ôî
,

2879 &
d©a
);

2881  
d©a
.
p2p_go
;

2882 
	}
}

2884 
boﬁ
 
	$iwl_mvm_gë_ª•e˘_p2p_go_b™d
(
iwl_mvm
 *
mvm
,

2885 
õì80211_vif
 *
vif
,

2886 
∆80211_b™d
 
b™d
)

2888 
boﬁ
 
low_œãncy
 = 
	`iwl_mvm_low_œãncy_b™d
(
mvm
, 
b™d
);

2890  
	`_iwl_mvm_gë_ª•e˘_p2p_go
(
mvm
, 
vif
, 
low_œãncy
, 
b™d
);

2891 
	}
}

2893 
boﬁ
 
	$iwl_mvm_gë_ª•e˘_p2p_go
(
iwl_mvm
 *
mvm
,

2894 
õì80211_vif
 *
vif
)

2896 
boﬁ
 
low_œãncy
 = 
	`iwl_mvm_low_œãncy
(
mvm
);

2898  
	`_iwl_mvm_gë_ª•e˘_p2p_go
(
mvm
, 
vif
, 
low_œãncy
,

2899 
NUM_NL80211_BANDS
);

2900 
	}
}

2902 
	$iwl_mvm_fûl_ª•e˘_p2p_go
(
iwl_mvm
 *
mvm
,

2903 
iwl_mvm_sˇn_∑øms
 *
∑øms
,

2904 
õì80211_vif
 *
vif
)

2906 i‡(
	`iwl_mvm_is_cdb_suµ‹ãd
(
mvm
)) {

2907 
∑øms
->
ª•e˘_p2p_go
 =

2908 
	`iwl_mvm_gë_ª•e˘_p2p_go_b™d
(
mvm
, 
vif
,

2909 
NL80211_BAND_2GHZ
);

2910 
∑øms
->
ª•e˘_p2p_go_hb
 =

2911 
	`iwl_mvm_gë_ª•e˘_p2p_go_b™d
(
mvm
, 
vif
,

2912 
NL80211_BAND_5GHZ
);

2914 
∑øms
->
ª•e˘_p2p_go
 = 
	`iwl_mvm_gë_ª•e˘_p2p_go
(
mvm
, 
vif
);

2916 
	}
}

2918 
	$iwl_mvm_ªg_sˇn_°¨t
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2919 
cfg80211_sˇn_ªque°
 *
ªq
,

2920 
õì80211_sˇn_õs
 *
õs
)

2922 
iwl_ho°_cmd
 
hcmd
 = {

2923 .
Àn
 = { 
	`iwl_mvm_sˇn_size
(
mvm
), },

2924 .
d©a
 = { 
mvm
->
sˇn_cmd
, },

2925 .
d©aÊags
 = { 
IWL_HCMD_DFL_NOCOPY
, },

2927 
iwl_mvm_sˇn_∑øms
 
∑øms
 = {};

2928 
ªt
, 
uid
;

2929 
cfg80211_sched_sˇn_∂™
 
sˇn_∂™
 = { .
ôî©i⁄s
 = 1 };

2931 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2933 i‡(
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
Ë&& !mvm->
œr_ªgdom_£t
) {

2934 
	`IWL_ERR
(
mvm
, "scan while LARÑegdomain isÇot set\n");

2935  -
EBUSY
;

2938 
ªt
 = 
	`iwl_mvm_check_ru¬ög_sˇns
(
mvm
, 
IWL_MVM_SCAN_REGULAR
);

2939 i‡(
ªt
)

2940  
ªt
;

2943 i‡(
	`WARN_ON
(!
mvm
->
sˇn_cmd
))

2944  -
ENOMEM
;

2946 i‡(!
	`iwl_mvm_sˇn_fôs
(
mvm
, 
ªq
->
n_ssids
, 
õs
,Ñeq->
n_ch™√ls
))

2947  -
ENOBUFS
;

2949 
∑øms
.
n_ssids
 = 
ªq
->n_ssids;

2950 
∑øms
.
Êags
 = 
ªq
->flags;

2951 
∑øms
.
n_ch™√ls
 = 
ªq
->n_channels;

2952 
∑øms
.
dñay
 = 0;

2953 
∑øms
.
ssids
 = 
ªq
->ssids;

2954 
∑øms
.
ch™√ls
 = 
ªq
->channels;

2955 
∑øms
.
mac_addr
 = 
ªq
->mac_addr;

2956 
∑øms
.
mac_addr_mask
 = 
ªq
->mac_addr_mask;

2957 
∑øms
.
no_cck
 = 
ªq
->no_cck;

2958 
∑øms
.
∑ss_Æl
 = 
åue
;

2959 
∑øms
.
n_m©ch_£ts
 = 0;

2960 
∑øms
.
m©ch_£ts
 = 
NULL
;

2961 
	`ëhî_addr_c›y
(
∑øms
.
bssid
, 
ªq
->bssid);

2963 
∑øms
.
sˇn_∂™s
 = &
sˇn_∂™
;

2964 
∑øms
.
n_sˇn_∂™s
 = 1;

2966 
∑øms
.
n_6ghz_∑øms
 = 
ªq
->n_6ghz_params;

2967 
∑øms
.
sˇn_6ghz_∑øms
 = 
ªq
->scan_6ghz_params;

2968 
∑øms
.
sˇn_6ghz
 = 
ªq
->scan_6ghz;

2969 
	`iwl_mvm_fûl_sˇn_ty≥
(
mvm
, &
∑øms
, 
vif
);

2970 
	`iwl_mvm_fûl_ª•e˘_p2p_go
(
mvm
, &
∑øms
, 
vif
);

2972 i‡(
ªq
->
duøti⁄
)

2973 
∑øms
.
ôî_nŸif
 = 
åue
;

2975 
∑øms
.
tsf_ªp‹t_lök_id
 = 
ªq
->tsf_report_link_id;

2976 i‡(
∑øms
.
tsf_ªp‹t_lök_id
 < 0) {

2977 i‡(
vif
->
a˘ive_löks
)

2978 
∑øms
.
tsf_ªp‹t_lök_id
 = 
	`__ffs
(
vif
->
a˘ive_löks
);

2980 
∑øms
.
tsf_ªp‹t_lök_id
 = 0;

2983 
	`iwl_mvm_buûd_sˇn_¥obe
(
mvm
, 
vif
, 
õs
, &
∑øms
);

2985 
	`iwl_mvm_sˇn_6ghz_∑ssive_sˇn
(
mvm
, &
∑øms
, 
vif
);

2987 
uid
 = 
	`iwl_mvm_buûd_sˇn_cmd
(
mvm
, 
vif
, &
hcmd
, &
∑øms
,

2988 
IWL_MVM_SCAN_REGULAR
);

2990 i‡(
uid
 < 0)

2991  
uid
;

2993 
	`iwl_mvm_∑u£_tcm
(
mvm
, 
Ál£
);

2995 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

2996 i‡(
ªt
) {

3001 
	`IWL_ERR
(
mvm
, "Sˇ¿Áûed!Ñë %d\n", 
ªt
);

3002 
	`iwl_mvm_ªsume_tcm
(
mvm
);

3003 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3004  
ªt
;

3007 
	`IWL_DEBUG_SCAN
(
mvm
, "ScanÑequest was sent successfully\n");

3008 
mvm
->
sˇn_°©us
 |
IWL_MVM_SCAN_REGULAR
;

3009 
mvm
->
sˇn_vif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3011 i‡(
∑øms
.
íabÀ_6ghz_∑ssive
)

3012 
mvm
->
œ°_6ghz_∑ssive_sˇn_jiffõs
 = 
jiffõs
;

3014 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
sˇn_timeout_dw‹k
,

3015 
	`m£cs_to_jiffõs
(
SCAN_TIMEOUT
));

3018 
	}
}

3020 
	$iwl_mvm_sched_sˇn_°¨t
(
iwl_mvm
 *
mvm
,

3021 
õì80211_vif
 *
vif
,

3022 
cfg80211_sched_sˇn_ªque°
 *
ªq
,

3023 
õì80211_sˇn_õs
 *
õs
,

3024 
ty≥
)

3026 
iwl_ho°_cmd
 
hcmd
 = {

3027 .
Àn
 = { 
	`iwl_mvm_sˇn_size
(
mvm
), },

3028 .
d©a
 = { 
mvm
->
sˇn_cmd
, },

3029 .
d©aÊags
 = { 
IWL_HCMD_DFL_NOCOPY
, },

3031 
iwl_mvm_sˇn_∑øms
 
∑øms
 = {};

3032 
ªt
, 
uid
;

3033 
i
, 
j
;

3034 
boﬁ
 
n⁄_psc_ö˛uded
 = 
Ál£
;

3036 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3038 i‡(
	`iwl_mvm_is_œr_suµ‹ãd
(
mvm
Ë&& !mvm->
œr_ªgdom_£t
) {

3039 
	`IWL_ERR
(
mvm
, "sched-scan while LARÑegdomain isÇot set\n");

3040  -
EBUSY
;

3043 
ªt
 = 
	`iwl_mvm_check_ru¬ög_sˇns
(
mvm
, 
ty≥
);

3044 i‡(
ªt
)

3045  
ªt
;

3048 i‡(
	`WARN_ON
(!
mvm
->
sˇn_cmd
))

3049  -
ENOMEM
;

3052 
∑øms
.
n_ssids
 = 
ªq
->n_ssids;

3053 
∑øms
.
Êags
 = 
ªq
->flags;

3054 
∑øms
.
n_ch™√ls
 = 
ªq
->n_channels;

3055 
∑øms
.
ssids
 = 
ªq
->ssids;

3056 
∑øms
.
ch™√ls
 = 
ªq
->channels;

3057 
∑øms
.
mac_addr
 = 
ªq
->mac_addr;

3058 
∑øms
.
mac_addr_mask
 = 
ªq
->mac_addr_mask;

3059 
∑øms
.
no_cck
 = 
Ál£
;

3060 
∑øms
.
∑ss_Æl
 = 
	`iwl_mvm_sˇn_∑ss_Æl
(
mvm
, 
ªq
);

3061 
∑øms
.
n_m©ch_£ts
 = 
ªq
->n_match_sets;

3062 
∑øms
.
m©ch_£ts
 = 
ªq
->match_sets;

3063 
	`ëh_brﬂdˇ°_addr
(
∑øms
.
bssid
);

3064 i‡(!
ªq
->
n_sˇn_∂™s
)

3065  -
EINVAL
;

3067 
∑øms
.
n_sˇn_∂™s
 = 
ªq
->n_scan_plans;

3068 
∑øms
.
sˇn_∂™s
 = 
ªq
->scan_plans;

3070 
	`iwl_mvm_fûl_sˇn_ty≥
(
mvm
, &
∑øms
, 
vif
);

3071 
	`iwl_mvm_fûl_ª•e˘_p2p_go
(
mvm
, &
∑øms
, 
vif
);

3078 i‡(
ªq
->
dñay
 > 
U16_MAX
) {

3079 
	`IWL_DEBUG_SCAN
(
mvm
,

3081 
∑øms
.
dñay
 = 
U16_MAX
;

3083 
∑øms
.
dñay
 = 
ªq
->delay;

3086 
ªt
 = 
	`iwl_mvm_c⁄fig_sched_sˇn_¥ofûes
(
mvm
, 
ªq
);

3087 i‡(
ªt
)

3088  
ªt
;

3090 
	`iwl_mvm_buûd_sˇn_¥obe
(
mvm
, 
vif
, 
õs
, &
∑øms
);

3093 
i
 = 0; i < 
∑øms
.
n_ch™√ls
; i++) {

3094 
õì80211_ch™√l
 *
ch™√l
 = 
∑øms
.
ch™√ls
[
i
];

3096 i‡(
ch™√l
->
b™d
 =
NL80211_BAND_6GHZ
 &&

3097 !
	`cfg80211_ch™√l_is_psc
(
ch™√l
)) {

3098 
n⁄_psc_ö˛uded
 = 
åue
;

3103 i‡(
n⁄_psc_ö˛uded
) {

3104 
∑øms
.
ch™√ls
 = 
	`kmemdup
(params.channels,

3105 (
∑øms
.
ch™√ls
[0]) *

3106 
∑øms
.
n_ch™√ls
,

3107 
GFP_KERNEL
);

3108 i‡(!
∑øms
.
ch™√ls
)

3109  -
ENOMEM
;

3111 
i
 = 
j
 = 0; i < 
∑øms
.
n_ch™√ls
; i++) {

3112 i‡(
∑øms
.
ch™√ls
[
i
]->
b™d
 =
NL80211_BAND_6GHZ
 &&

3113 !
	`cfg80211_ch™√l_is_psc
(
∑øms
.
ch™√ls
[
i
]))

3115 
∑øms
.
ch™√ls
[
j
++] =Ö¨ams.ch™√ls[
i
];

3117 
∑øms
.
n_ch™√ls
 = 
j
;

3120 i‡(
n⁄_psc_ö˛uded
 &&

3121 !
	`iwl_mvm_sˇn_fôs
(
mvm
, 
ªq
->
n_ssids
, 
õs
, 
∑øms
.
n_ch™√ls
)) {

3122 
	`k‰ì
(
∑øms
.
ch™√ls
);

3123  -
ENOBUFS
;

3126 
uid
 = 
	`iwl_mvm_buûd_sˇn_cmd
(
mvm
, 
vif
, &
hcmd
, &
∑øms
, 
ty≥
);

3128 i‡(
n⁄_psc_ö˛uded
)

3129 
	`k‰ì
(
∑øms
.
ch™√ls
);

3130 i‡(
uid
 < 0)

3131  
uid
;

3133 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
hcmd
);

3134 i‡(!
ªt
) {

3135 
	`IWL_DEBUG_SCAN
(
mvm
,

3137 
mvm
->
sˇn_°©us
 |
ty≥
;

3143 
	`IWL_ERR
(
mvm
, "Sched sˇ¿Áûed!Ñë %d\n", 
ªt
);

3144 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3145 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

3148  
ªt
;

3149 
	}
}

3151 
	$iwl_mvm_rx_umac_sˇn_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

3152 
iwl_rx_cmd_buf„r
 *
rxb
)

3154 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

3155 
iwl_umac_sˇn_com∂ëe
 *
nŸif
 = (*)
pkt
->
d©a
;

3156 
u32
 
uid
 = 
	`__À32_to_˝u
(
nŸif
->uid);

3157 
boﬁ
 
ab‹ãd
 = (
nŸif
->
°©us
 =
IWL_SCAN_OFFLOAD_ABORTED
);

3159 
mvm
->
mei_sˇn_fûãr
.
is_mei_limôed_sˇn
 = 
Ál£
;

3161 i‡(
	`WARN_ON
(!(
mvm
->
sˇn_uid_°©us
[
uid
] & mvm->
sˇn_°©us
)))

3165 i‡(
mvm
->
sˇn_uid_°©us
[
uid
] =
IWL_MVM_SCAN_REGULAR
) {

3166 
cfg80211_sˇn_öfo
 
öfo
 = {

3167 .
ab‹ãd
 =áborted,

3168 .
sˇn_°¨t_tsf
 = 
mvm
->
sˇn_°¨t
,

3170 
iwl_mvm_vif
 *
sˇn_vif
 = 
mvm
->scan_vif;

3171 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 =

3172 
sˇn_vif
->
lök
[
mvm
->
sˇn_lök_id
];

3174 i‡(!
	`WARN_ON
(!
lök_öfo
))

3175 
	`mem˝y
(
öfo
.
tsf_bssid
, 
lök_öfo
->
bssid
, 
ETH_ALEN
);

3177 
	`õì80211_sˇn_com∂ëed
(
mvm
->
hw
, &
öfo
);

3178 
mvm
->
sˇn_vif
 = 
NULL
;

3179 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
sˇn_timeout_dw‹k
);

3180 
	`iwl_mvm_ªsume_tcm
(
mvm
);

3181 } i‡(
mvm
->
sˇn_uid_°©us
[
uid
] =
IWL_MVM_SCAN_SCHED
) {

3182 
	`õì80211_sched_sˇn_°›≥d
(
mvm
->
hw
);

3183 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

3186 
mvm
->
sˇn_°©us
 &~mvm->
sˇn_uid_°©us
[
uid
];

3187 
	`IWL_DEBUG_SCAN
(
mvm
,

3189 
uid
, 
mvm
->
sˇn_uid_°©us
[uid],

3190 
nŸif
->
°©us
 =
IWL_SCAN_OFFLOAD_COMPLETED
 ?

3192 
	`iwl_mvm_ebs_°©us_°r
(
nŸif
->
ebs_°©us
));

3193 
	`IWL_DEBUG_SCAN
(
mvm
,

3195 
nŸif
->
œ°_scheduÀ
,ÇŸif->
œ°_ôî
,

3196 
	`__À32_to_˝u
(
nŸif
->
time_‰om_œ°_ôî
));

3198 i‡(
nŸif
->
ebs_°©us
 !
IWL_SCAN_EBS_SUCCESS
 &&

3199 
nŸif
->
ebs_°©us
 !
IWL_SCAN_EBS_INACTIVE
)

3200 
mvm
->
œ°_ebs_suc˚ssful
 = 
Ál£
;

3202 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3203 
	}
}

3205 
	$iwl_mvm_rx_umac_sˇn_ôî_com∂ëe_nŸif
(
iwl_mvm
 *
mvm
,

3206 
iwl_rx_cmd_buf„r
 *
rxb
)

3208 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

3209 
iwl_umac_sˇn_ôî_com∂ëe_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

3211 
mvm
->
sˇn_°¨t
 = 
	`À64_to_˝u
(
nŸif
->
°¨t_tsf
);

3213 
	`IWL_DEBUG_SCAN
(
mvm
,

3215 
nŸif
->
°©us
,ÇŸif->
sˇ¬ed_ch™√ls
);

3217 i‡(
mvm
->
sched_sˇn_∑ss_Æl
 =
SCHED_SCAN_PASS_ALL_FOUND
) {

3218 
	`IWL_DEBUG_SCAN
(
mvm
, "Passáll scheduled scanÑesults found\n");

3219 
	`õì80211_sched_sˇn_ªsu…s
(
mvm
->
hw
);

3220 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_ENABLED
;

3223 
	`IWL_DEBUG_SCAN
(
mvm
,

3225 
mvm
->
sˇn_°¨t
);

3226 
	}
}

3228 
	$iwl_mvm_umac_sˇn_ab‹t
(
iwl_mvm
 *
mvm
, 
ty≥
)

3230 
iwl_umac_sˇn_ab‹t
 
cmd
 = {};

3231 
uid
, 
ªt
;

3233 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3239 
uid
 = 
	`iwl_mvm_sˇn_uid_by_°©us
(
mvm
, 
ty≥
);

3240 i‡(
	`WARN_ON_ONCE
(
uid
 < 0))

3241  
uid
;

3243 
cmd
.
uid
 = 
	`˝u_to_À32
(uid);

3245 
	`IWL_DEBUG_SCAN
(
mvm
, "Sídög sˇ¿ab‹t, uid %u\n", 
uid
);

3247 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

3248 
	`WIDE_ID
(
IWL_ALWAYS_LONG_GROUP
, 
SCAN_ABORT_UMAC
),

3249 0, (
cmd
), &cmd);

3250 i‡(!
ªt
)

3251 
mvm
->
sˇn_uid_°©us
[
uid
] = 
ty≥
 << 
IWL_MVM_SCAN_STOPPING_SHIFT
;

3253  
ªt
;

3254 
	}
}

3256 
	$iwl_mvm_sˇn_°›_waô
(
iwl_mvm
 *
mvm
, 
ty≥
)

3258 
iwl_nŸifiˇti⁄_waô
 
waô_sˇn_d⁄e
;

3259 c⁄° 
u16
 
sˇn_d⁄e_nŸif
[] = { 
SCAN_COMPLETE_UMAC
,

3260 
SCAN_OFFLOAD_COMPLETE
, };

3261 
ªt
;

3263 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3265 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_sˇn_d⁄e
,

3266 
sˇn_d⁄e_nŸif
,

3267 
	`ARRAY_SIZE
(
sˇn_d⁄e_nŸif
),

3268 
NULL
, NULL);

3270 
	`IWL_DEBUG_SCAN
(
mvm
, "Pª∑rögÅÿ°› sˇn,Åy≥ %x\n", 
ty≥
);

3272 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
))

3273 
ªt
 = 
	`iwl_mvm_umac_sˇn_ab‹t
(
mvm
, 
ty≥
);

3275 
ªt
 = 
	`iwl_mvm_lmac_sˇn_ab‹t
(
mvm
);

3277 i‡(
ªt
) {

3278 
	`IWL_DEBUG_SCAN
(
mvm
, "couldn'à°› sˇ¿ty≥ %d\n", 
ty≥
);

3279 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_sˇn_d⁄e
);

3280  
ªt
;

3283  
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_sˇn_d⁄e
,

3284 1 * 
HZ
);

3285 
	}
}

3287 
size_t
 
	$iwl_sˇn_ªq_umac_gë_size
(
u8
 
sˇn_vî
)

3289 
sˇn_vî
) {

3291  (
iwl_sˇn_ªq_umac_v12
);

3296  (
iwl_sˇn_ªq_umac_v17
);

3300 
	}
}

3302 
size_t
 
	$iwl_mvm_sˇn_size
(
iwl_mvm
 *
mvm
)

3304 
ba£_size
, 
èû_size
;

3305 
u8
 
sˇn_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
SCAN_REQ_UMAC
,

3306 
IWL_FW_CMD_VER_UNKNOWN
);

3308 
ba£_size
 = 
	`iwl_sˇn_ªq_umac_gë_size
(
sˇn_vî
);

3309 i‡(
ba£_size
)

3310  
ba£_size
;

3313 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_v2_suµ‹ãd
(
mvm
))

3314 
ba£_size
 = 
IWL_SCAN_REQ_UMAC_SIZE_V8
;

3315 i‡(
	`iwl_mvm_is_ad≠tive_dwñl_suµ‹ãd
(
mvm
))

3316 
ba£_size
 = 
IWL_SCAN_REQ_UMAC_SIZE_V7
;

3317 i‡(
	`iwl_mvm_cdb_sˇn_≠i
(
mvm
))

3318 
ba£_size
 = 
IWL_SCAN_REQ_UMAC_SIZE_V6
;

3320 
ba£_size
 = 
IWL_SCAN_REQ_UMAC_SIZE_V1
;

3322 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
)) {

3323 i‡(
	`iwl_mvm_is_sˇn_ext_ch™_suµ‹ãd
(
mvm
))

3324 
èû_size
 = (
iwl_sˇn_ªq_umac_èû_v2
);

3326 
èû_size
 = (
iwl_sˇn_ªq_umac_èû_v1
);

3328  
ba£_size
 +

3329 (
iwl_sˇn_ch™√l_cfg_umac
) *

3330 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
 +

3331 
èû_size
;

3333  (
iwl_sˇn_ªq_lmac
) +

3334 (
iwl_sˇn_ch™√l_cfg_lmac
) *

3335 
mvm
->
fw
->
ucode_ˇ∑
.
n_sˇn_ch™√ls
 +

3336 (
iwl_sˇn_¥obe_ªq_v1
);

3337 
	}
}

3343 
	$iwl_mvm_ªp‹t_sˇn_ab‹ãd
(
iwl_mvm
 *
mvm
)

3345 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
)) {

3346 
uid
, 
i
;

3348 
uid
 = 
	`iwl_mvm_sˇn_uid_by_°©us
(
mvm
, 
IWL_MVM_SCAN_REGULAR
);

3349 i‡(
uid
 >= 0) {

3350 
cfg80211_sˇn_öfo
 
öfo
 = {

3351 .
ab‹ãd
 = 
åue
,

3354 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
sˇn_timeout_dw‹k
);

3356 
	`õì80211_sˇn_com∂ëed
(
mvm
->
hw
, &
öfo
);

3357 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3359 
uid
 = 
	`iwl_mvm_sˇn_uid_by_°©us
(
mvm
, 
IWL_MVM_SCAN_SCHED
);

3360 i‡(
uid
 >= 0) {

3365 i‡(!
mvm
->
fw_ª°¨t
)

3366 
	`õì80211_sched_sˇn_°›≥d
(
mvm
->
hw
);

3367 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

3368 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3370 
uid
 = 
	`iwl_mvm_sˇn_uid_by_°©us
(
mvm
,

3371 
IWL_MVM_SCAN_STOPPING_REGULAR
);

3372 i‡(
uid
 >= 0)

3373 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3375 
uid
 = 
	`iwl_mvm_sˇn_uid_by_°©us
(
mvm
,

3376 
IWL_MVM_SCAN_STOPPING_SCHED
);

3377 i‡(
uid
 >= 0)

3378 
mvm
->
sˇn_uid_°©us
[
uid
] = 0;

3384 
i
 = 0; i < 
mvm
->
max_sˇns
; i++) {

3385 i‡(
	`WARN_ONCE
(
mvm
->
sˇn_uid_°©us
[
i
],

3387 
i
))

3388 
mvm
->
sˇn_uid_°©us
[
i
] = 0;

3391 i‡(
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_REGULAR
) {

3392 
cfg80211_sˇn_öfo
 
öfo
 = {

3393 .
ab‹ãd
 = 
åue
,

3396 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
sˇn_timeout_dw‹k
);

3397 
	`õì80211_sˇn_com∂ëed
(
mvm
->
hw
, &
öfo
);

3404 i‡((
mvm
->
sˇn_°©us
 & 
IWL_MVM_SCAN_SCHED
) &&

3405 !
mvm
->
fw_ª°¨t
) {

3406 
	`õì80211_sched_sˇn_°›≥d
(
mvm
->
hw
);

3407 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

3410 
	}
}

3412 
	$iwl_mvm_sˇn_°›
(
iwl_mvm
 *
mvm
, 
ty≥
, 
boﬁ
 
nŸify
)

3414 
ªt
;

3416 i‡(!(
mvm
->
sˇn_°©us
 & 
ty≥
))

3419 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
mvm
->
å™s
->
°©us
)) {

3420 
ªt
 = 0;

3421 
out
;

3424 
ªt
 = 
	`iwl_mvm_sˇn_°›_waô
(
mvm
, 
ty≥
);

3425 i‡(!
ªt
)

3426 
mvm
->
sˇn_°©us
 |
ty≥
 << 
IWL_MVM_SCAN_STOPPING_SHIFT
;

3427 
out
:

3433 
mvm
->
sˇn_°©us
 &~
ty≥
;

3435 i‡(
ty≥
 =
IWL_MVM_SCAN_REGULAR
) {

3436 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
sˇn_timeout_dw‹k
);

3437 i‡(
nŸify
) {

3438 
cfg80211_sˇn_öfo
 
öfo
 = {

3439 .
ab‹ãd
 = 
åue
,

3442 
	`õì80211_sˇn_com∂ëed
(
mvm
->
hw
, &
öfo
);

3444 } i‡(
nŸify
) {

3445 
	`õì80211_sched_sˇn_°›≥d
(
mvm
->
hw
);

3446 
mvm
->
sched_sˇn_∑ss_Æl
 = 
SCHED_SCAN_PASS_ALL_DISABLED
;

3449  
ªt
;

3450 
	}
}

	@mvm/sf.c

6 
	~"mvm.h
"

9 
	siwl_mvm_a˘ive_iÁ˚_ôî©‹_d©a
 {

10 
õì80211_vif
 *
	mign‹e_vif
;

11 
õì80211_°a
 *
	m°a_vif_≠_°a
;

12 
iwl_sf_°©e
 
	m°a_vif_°©e
;

13 
u32
 
	mnum_a˘ive_macs
;

20 
	$iwl_mvm_bound_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

21 
õì80211_vif
 *
vif
)

23 
iwl_mvm_a˘ive_iÁ˚_ôî©‹_d©a
 *
d©a
 = 
_d©a
;

24 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

26 i‡(
vif
 =
d©a
->
ign‹e_vif
 || !
mvmvif
->
deÊök
.
phy_˘xt
 ||

27 
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
)

30 
d©a
->
num_a˘ive_macs
++;

32 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

33 
d©a
->
°a_vif_≠_°a
 = 
mvmvif
->
≠_°a
;

34 i‡(
vif
->
cfg
.
assoc
)

35 
d©a
->
°a_vif_°©e
 = 
SF_FULL_ON
;

37 
d©a
->
°a_vif_°©e
 = 
SF_INIT_OFF
;

39 
	}
}

46 
__À32
 
	gsf_fuŒ_timeout_def
[
SF_NUM_SCENARIO
][
SF_NUM_TIMEOUT_TYPES
] = {

48 
˝u_to_À32
(
SF_SINGLE_UNICAST_AGING_TIMER_DEF
),

49 
˝u_to_À32
(
SF_SINGLE_UNICAST_IDLE_TIMER_DEF
)

52 
˝u_to_À32
(
SF_AGG_UNICAST_AGING_TIMER_DEF
),

53 
˝u_to_À32
(
SF_AGG_UNICAST_IDLE_TIMER_DEF
)

56 
˝u_to_À32
(
SF_MCAST_AGING_TIMER_DEF
),

57 
˝u_to_À32
(
SF_MCAST_IDLE_TIMER_DEF
)

60 
˝u_to_À32
(
SF_BA_AGING_TIMER_DEF
),

61 
˝u_to_À32
(
SF_BA_IDLE_TIMER_DEF
)

64 
˝u_to_À32
(
SF_TX_RE_AGING_TIMER_DEF
),

65 
˝u_to_À32
(
SF_TX_RE_IDLE_TIMER_DEF
)

73 c⁄° 
__À32
 
	gsf_fuŒ_timeout
[
SF_NUM_SCENARIO
][
SF_NUM_TIMEOUT_TYPES
] = {

75 
˝u_to_À32
(
SF_SINGLE_UNICAST_AGING_TIMER
),

76 
˝u_to_À32
(
SF_SINGLE_UNICAST_IDLE_TIMER
)

79 
˝u_to_À32
(
SF_AGG_UNICAST_AGING_TIMER
),

80 
˝u_to_À32
(
SF_AGG_UNICAST_IDLE_TIMER
)

83 
˝u_to_À32
(
SF_MCAST_AGING_TIMER
),

84 
˝u_to_À32
(
SF_MCAST_IDLE_TIMER
)

87 
˝u_to_À32
(
SF_BA_AGING_TIMER
),

88 
˝u_to_À32
(
SF_BA_IDLE_TIMER
)

91 
˝u_to_À32
(
SF_TX_RE_AGING_TIMER
),

92 
˝u_to_À32
(
SF_TX_RE_IDLE_TIMER
)

96 
	$iwl_mvm_fûl_sf_comm™d
(
iwl_mvm
 *
mvm
,

97 
iwl_sf_cfg_cmd
 *
sf_cmd
,

98 
õì80211_°a
 *
°a
)

100 
i
, 
j
, 
w©îm¨k
;

101 
u8
 
max_rx_nss
 = 0;

102 
boﬁ
 
is_Àgacy
 = 
åue
;

103 
õì80211_lök_°a
 *
lök_°a
;

104 
lök_id
;

106 
sf_cmd
->
w©îm¨k
[
SF_LONG_DELAY_ON
] = 
	`˝u_to_À32
(
SF_W_MARK_SCAN
);

112 i‡(
°a
) {

114 
	`rcu_ªad_lock
();

115 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
°a
->
lök
);Üink_id++) {

116 
lök_°a
 = 
	`rcu_dîe„ªn˚
(
°a
->
lök
[
lök_id
]);

117 i‡(!
lök_°a
)

120 i‡(
lök_°a
->
ht_ˇp
.
ht_suµ‹ãd
 ||

121 
lök_°a
->
vht_ˇp
.
vht_suµ‹ãd
 ||

122 
lök_°a
->
eht_ˇp
.
has_eht
 ||

123 
lök_°a
->
he_ˇp
.
has_he
) {

124 
is_Àgacy
 = 
Ál£
;

125 
max_rx_nss
 = 
	`max
(max_rx_nss, 
lök_°a
->
rx_nss
);

128 
	`rcu_ªad_u∆ock
();

130 i‡(!
is_Àgacy
) {

131 
max_rx_nss
) {

133 
w©îm¨k
 = 
SF_W_MARK_SISO
;

136 
w©îm¨k
 = 
SF_W_MARK_MIMO2
;

139 
w©îm¨k
 = 
SF_W_MARK_MIMO3
;

143 
w©îm¨k
 = 
SF_W_MARK_LEGACY
;

147 
w©îm¨k
 = 
SF_W_MARK_MIMO2
;

149 
sf_cmd
->
w©îm¨k
[
SF_FULL_ON
] = 
	`˝u_to_À32
(watermark);

151 
i
 = 0; i < 
SF_NUM_SCENARIO
; i++) {

152 
j
 = 0; j < 
SF_NUM_TIMEOUT_TYPES
; j++) {

153 
sf_cmd
->
l⁄g_dñay_timeouts
[
i
][
j
] =

154 
	`˝u_to_À32
(
SF_LONG_DELAY_AGING_TIMER
);

158 i‡(
°a
) {

159 
	`BUILD_BUG_ON
((
sf_fuŒ_timeout
) !=

160 (
__À32
Ë* 
SF_NUM_SCENARIO
 *

161 
SF_NUM_TIMEOUT_TYPES
);

163 
	`mem˝y
(
sf_cmd
->
fuŒ_⁄_timeouts
, 
sf_fuŒ_timeout
,

164 (
sf_fuŒ_timeout
));

166 
	`BUILD_BUG_ON
((
sf_fuŒ_timeout_def
) !=

167 (
__À32
Ë* 
SF_NUM_SCENARIO
 *

168 
SF_NUM_TIMEOUT_TYPES
);

170 
	`mem˝y
(
sf_cmd
->
fuŒ_⁄_timeouts
, 
sf_fuŒ_timeout_def
,

171 (
sf_fuŒ_timeout_def
));

173 
	}
}

175 
	$iwl_mvm_sf_c⁄fig
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

176 
iwl_sf_°©e
 
√w_°©e
)

178 
iwl_sf_cfg_cmd
 
sf_cmd
 = {

179 .
°©e
 = 
	`˝u_to_À32
(
√w_°©e
),

181 
ªt
 = 0;

187 i‡(
√w_°©e
 !
SF_FULL_ON
 && 
mvm
->
sf_°©e
 ==Çew_state)

190 
√w_°©e
) {

191 
SF_UNINIT
:

192 
	`iwl_mvm_fûl_sf_comm™d
(
mvm
, &
sf_cmd
, 
NULL
);

194 
SF_FULL_ON
:

195 i‡(!
°a
) {

196 
	`IWL_ERR
(
mvm
,

198  -
EINVAL
;

200 
	`iwl_mvm_fûl_sf_comm™d
(
mvm
, &
sf_cmd
, 
°a
);

202 
SF_INIT_OFF
:

203 
	`iwl_mvm_fûl_sf_comm™d
(
mvm
, &
sf_cmd
, 
NULL
);

206 
	`WARN_ONCE
(1, "Invalid state: %d.Çot sending Smart Fifo cmd\n",

207 
√w_°©e
);

208  -
EINVAL
;

211 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
REPLY_SF_CFG_CMD
, 
CMD_ASYNC
,

212 (
sf_cmd
), &sf_cmd);

213 i‡(!
ªt
)

214 
mvm
->
sf_°©e
 = 
√w_°©e
;

216  
ªt
;

217 
	}
}

224 
	$iwl_mvm_sf_upd©e
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
ch™ged_vif
,

225 
boﬁ
 
ªmove_vif
)

227 
iwl_sf_°©e
 
√w_°©e
;

228 
iwl_mvm_vif
 *
mvmvif
 = 
NULL
;

229 
iwl_mvm_a˘ive_iÁ˚_ôî©‹_d©a
 
d©a
 = {

230 .
ign‹e_vif
 = 
ch™ged_vif
,

231 .
°a_vif_°©e
 = 
SF_UNINIT
,

233 
õì80211_°a
 *
°a
 = 
NULL
;

235 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

236 
IWL_UCODE_TLV_API_SMART_FIFO_OFFLOAD
))

242 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) ||

243 (
ch™ged_vif
 && ch™ged_vif->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
))

246 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

247 
IEEE80211_IFACE_ITER_NORMAL
,

248 
iwl_mvm_bound_iÁ˚_ôî©‹
,

249 &
d©a
);

252 i‡(
ch™ged_vif
 && !
ªmove_vif
)

253 
d©a
.
num_a˘ive_macs
++;

255 
d©a
.
num_a˘ive_macs
) {

258 
√w_°©e
 = 
SF_INIT_OFF
;

261 i‡(
ªmove_vif
) {

265 
√w_°©e
 = 
d©a
.
°a_vif_°©e
;

266 
°a
 = 
d©a
.
°a_vif_≠_°a
;

268 i‡(
	`WARN_ON
(!
ch™ged_vif
))

269  -
EINVAL
;

270 i‡(
ch™ged_vif
->
ty≥
 !
NL80211_IFTYPE_STATION
) {

271 
√w_°©e
 = 
SF_UNINIT
;

272 } i‡(
ch™ged_vif
->
cfg
.
assoc
 &&

273 
ch™ged_vif
->
bss_c⁄f
.
dtim_≥riod
) {

274 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
ch™ged_vif
);

275 
°a
 = 
mvmvif
->
≠_°a
;

276 
√w_°©e
 = 
SF_FULL_ON
;

278 
√w_°©e
 = 
SF_INIT_OFF
;

284 
√w_°©e
 = 
SF_UNINIT
;

287  
	`iwl_mvm_sf_c⁄fig
(
mvm
, 
°a
, 
√w_°©e
);

288 
	}
}

	@mvm/sta.c

7 
	~<√t/mac80211.h
>

9 
	~"mvm.h
"

10 
	~"°a.h
"

11 
	~"rs.h
"

18 
ölöe
 
	$iwl_mvm_add_°a_cmd_size
(
iwl_mvm
 *
mvm
)

20 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
) ||

21 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
))

22  (
iwl_mvm_add_°a_cmd
);

24  (
iwl_mvm_add_°a_cmd_v7
);

25 
	}
}

27 
	$iwl_mvm_föd_‰ì_°a_id
(
iwl_mvm
 *
mvm
, 
∆80211_i·y≥
 
i·y≥
)

29 
°a_id
;

30 
u32
 
ª£rved_ids
 = 0;

32 
	`BUILD_BUG_ON
(
IWL_MVM_STATION_COUNT_MAX
 > 32);

33 
	`WARN_ON_ONCE
(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
));

35 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

38 i‡(
i·y≥
 !
NL80211_IFTYPE_STATION
)

39 
ª£rved_ids
 = 
	`BIT
(0);

42 
°a_id
 = 0; sè_id < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; sta_id++) {

43 i‡(
	`BIT
(
°a_id
Ë& 
ª£rved_ids
)

46 i‡(!
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

47 
	`lockdï_is_hñd
(&
mvm
->
muãx
)))

48  
°a_id
;

50  
IWL_MVM_INVALID_STA
;

51 
	}
}

54 
u32
 
	$iwl_mvm_gë_°a_ampdu_dís
(
õì80211_lök_°a
 *
lök_°a
,

55 
õì80211_bss_c⁄f
 *
lök_c⁄f
,

56 
u32
 *
_agg_size
)

58 
u32
 
agg_size
 = 0, 
mpdu_dís
 = 0;

60 i‡(
	`WARN_ON
(!
lök_°a
))

69 i‡(
lök_°a
->
ht_ˇp
.
ht_suµ‹ãd
) {

70 
agg_size
 = 
lök_°a
->
ht_ˇp
.
ampdu_Á˘‹
;

71 
mpdu_dís
 = 
lök_°a
->
ht_ˇp
.
ampdu_dísôy
;

74 i‡(
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->
b™d
 =
NL80211_BAND_6GHZ
) {

76 
mpdu_dís
 = 
	`À16_gë_bôs
(
lök_°a
->
he_6ghz_ˇ∑
.
ˇ∑
,

77 
IEEE80211_HE_6GHZ_CAP_MIN_MPDU_START
);

78 
agg_size
 = 
	`À16_gë_bôs
(
lök_°a
->
he_6ghz_ˇ∑
.
ˇ∑
,

79 
IEEE80211_HE_6GHZ_CAP_MAX_AMPDU_LEN_EXP
);

80 } i‡(
lök_°a
->
vht_ˇp
.
vht_suµ‹ãd
) {

82 
agg_size
 = 
	`u32_gë_bôs
(
lök_°a
->
vht_ˇp
.
ˇp
,

83 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
);

94 i‡(
lök_°a
->
he_ˇp
.
has_he
)

95 
agg_size
 +=

96 
	`u8_gë_bôs
(
lök_°a
->
he_ˇp
.
he_ˇp_ñem
.
mac_ˇp_öfo
[3],

97 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_MASK
);

99 i‡(
lök_°a
->
eht_ˇp
.
has_eht
)

100 
agg_size
 +
	`u8_gë_bôs
(
lök_°a
->
eht_ˇp
.
eht_ˇp_ñem
.
mac_ˇp_öfo
[1],

101 
IEEE80211_EHT_MAC_CAP1_MAX_AMPDU_LEN_MASK
);

104 
agg_size
 = 
	`mö_t
(
u32
,ágg_size,

105 
STA_FLG_MAX_AGG_SIZE_4M
 >> 
STA_FLG_MAX_AGG_SIZE_SHIFT
);

107 *
_agg_size
 = 
agg_size
;

108  
mpdu_dís
;

109 
	}
}

111 
u8
 
	$iwl_mvm_gë_°a_u≠sd_acs
(
õì80211_°a
 *
°a
)

113 
u8
 
u≠sd_acs
 = 0;

115 i‡(
°a
->
u≠sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BK
)

116 
u≠sd_acs
 |
	`BIT
(
AC_BK
);

117 i‡(
°a
->
u≠sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BE
)

118 
u≠sd_acs
 |
	`BIT
(
AC_BE
);

119 i‡(
°a
->
u≠sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VI
)

120 
u≠sd_acs
 |
	`BIT
(
AC_VI
);

121 i‡(
°a
->
u≠sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VO
)

122 
u≠sd_acs
 |
	`BIT
(
AC_VO
);

124  
u≠sd_acs
 | uapsd_acs << 4;

125 
	}
}

128 
	$iwl_mvm_°a_£nd_to_fw
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

129 
boﬁ
 
upd©e
, 
Êags
)

131 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

132 
iwl_mvm_add_°a_cmd
 
add_°a_cmd
 = {

133 .
°a_id
 = 
mvm_°a
->
deÊök
.sta_id,

134 .
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm_°a
->mac_id_n_color),

135 .
add_modify
 = 
upd©e
 ? 1 : 0,

136 .
°©i⁄_Êags_msk
 = 
	`˝u_to_À32
(
STA_FLG_FAT_EN_MSK
 |

137 
STA_FLG_MIMO_EN_MSK
 |

138 
STA_FLG_RTS_MIMO_PROT
),

139 .
tid_dißbÀ_tx
 = 
	`˝u_to_À16
(
mvm_°a
->
tid_dißbÀ_agg
),

141 
ªt
;

142 
u32
 
°©us
;

143 
u32
 
agg_size
 = 0, 
mpdu_dís
 = 0;

145 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
))

146 
add_°a_cmd
.
°©i⁄_ty≥
 = 
mvm_°a
->
°a_ty≥
;

148 i‡(!
upd©e
 || (
Êags
 & 
STA_MODIFY_QUEUES
)) {

149 
	`mem˝y
(&
add_°a_cmd
.
addr
, 
°a
->addr, 
ETH_ALEN
);

151 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

152 
add_°a_cmd
.
tfd_queue_msk
 =

153 
	`˝u_to_À32
(
mvm_°a
->
tfd_queue_msk
);

155 i‡(
Êags
 & 
STA_MODIFY_QUEUES
)

156 
add_°a_cmd
.
modify_mask
 |
STA_MODIFY_QUEUES
;

158 
	`WARN_ON
(
Êags
 & 
STA_MODIFY_QUEUES
);

162 
°a
->
deÊök
.
b™dwidth
) {

163 
IEEE80211_STA_RX_BW_320
:

164 
IEEE80211_STA_RX_BW_160
:

165 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_FAT_EN_160MHZ
);

166 
ÁŒthrough
;

167 
IEEE80211_STA_RX_BW_80
:

168 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_FAT_EN_80MHZ
);

169 
ÁŒthrough
;

170 
IEEE80211_STA_RX_BW_40
:

171 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_FAT_EN_40MHZ
);

172 
ÁŒthrough
;

173 
IEEE80211_STA_RX_BW_20
:

174 i‡(
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
)

175 
add_°a_cmd
.
°©i⁄_Êags
 |=

176 
	`˝u_to_À32
(
STA_FLG_FAT_EN_20MHZ
);

180 
°a
->
deÊök
.
rx_nss
) {

182 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_MIMO_EN_SISO
);

185 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_MIMO_EN_MIMO2
);

188 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_MIMO_EN_MIMO3
);

192 
°a
->
deÊök
.
smps_mode
) {

193 
IEEE80211_SMPS_AUTOMATIC
:

194 
IEEE80211_SMPS_NUM_MODES
:

195 
	`WARN_ON
(1);

197 
IEEE80211_SMPS_STATIC
:

199 
add_°a_cmd
.
°©i⁄_Êags
 &~
	`˝u_to_À32
(
STA_FLG_MIMO_EN_MSK
);

200 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_MIMO_EN_SISO
);

202 
IEEE80211_SMPS_DYNAMIC
:

203 
add_°a_cmd
.
°©i⁄_Êags
 |
	`˝u_to_À32
(
STA_FLG_RTS_MIMO_PROT
);

205 
IEEE80211_SMPS_OFF
:

210 i‡(
°a
->
deÊök
.
ht_ˇp
.
ht_suµ‹ãd
 ||

211 
mvm_°a
->
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
ch™
->
b™d
 =
NL80211_BAND_6GHZ
)

212 
add_°a_cmd
.
°©i⁄_Êags_msk
 |=

213 
	`˝u_to_À32
(
STA_FLG_MAX_AGG_SIZE_MSK
 |

214 
STA_FLG_AGG_MPDU_DENS_MSK
);

216 
mpdu_dís
 = 
	`iwl_mvm_gë_°a_ampdu_dís
(&
°a
->
deÊök
,

217 &
mvm_°a
->
vif
->
bss_c⁄f
,

218 &
agg_size
);

219 
add_°a_cmd
.
°©i⁄_Êags
 |=

220 
	`˝u_to_À32
(
agg_size
 << 
STA_FLG_MAX_AGG_SIZE_SHIFT
);

221 
add_°a_cmd
.
°©i⁄_Êags
 |=

222 
	`˝u_to_À32
(
mpdu_dís
 << 
STA_FLG_AGG_MPDU_DENS_SHIFT
);

224 i‡(
mvm_°a
->
°a_°©e
 >
IEEE80211_STA_ASSOC
)

225 
add_°a_cmd
.
assoc_id
 = 
	`˝u_to_À16
(
°a
->
aid
);

227 i‡(
°a
->
wme
) {

228 
add_°a_cmd
.
modify_mask
 |
STA_MODIFY_UAPSD_ACS
;

229 
add_°a_cmd
.
u≠sd_acs
 = 
	`iwl_mvm_gë_°a_u≠sd_acs
(
°a
);

230 
add_°a_cmd
.
•_Àngth
 = 
°a
->
max_•
 ? sta->max_sp * 2 : 128;

233 
°©us
 = 
ADD_STA_SUCCESS
;

234 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA
,

235 
	`iwl_mvm_add_°a_cmd_size
(
mvm
),

236 &
add_°a_cmd
, &
°©us
);

237 i‡(
ªt
)

238  
ªt
;

240 
°©us
 & 
IWL_ADD_STA_STATUS_MASK
) {

241 
ADD_STA_SUCCESS
:

242 
	`IWL_DEBUG_ASSOC
(
mvm
, "ADD_STA PASSED\n");

245 
ªt
 = -
EIO
;

246 
	`IWL_ERR
(
mvm
, "ADD_STA failed\n");

250  
ªt
;

251 
	}
}

253 
	$iwl_mvm_rx_agg_£ssi⁄_expúed
(
timî_li°
 *
t
)

255 
iwl_mvm_baid_d©a
 *
d©a
 =

256 
	`‰om_timî
(
d©a
, 
t
, 
£ssi⁄_timî
);

257 
iwl_mvm_baid_d©a
 
__rcu
 **
rcu_±r
 = 
d©a
->rcu_ptr;

258 
iwl_mvm_baid_d©a
 *
ba_d©a
;

259 
õì80211_°a
 *
°a
;

260 
iwl_mvm_°a
 *
mvm_°a
;

261 
timeout
;

262 
°a_id
;

264 
	`rcu_ªad_lock
();

266 
ba_d©a
 = 
	`rcu_dîe„ªn˚
(*
rcu_±r
);

268 i‡(
	`WARN_ON
(!
ba_d©a
))

269 
u∆ock
;

271 i‡(!
ba_d©a
->
timeout
)

272 
u∆ock
;

274 
timeout
 = 
ba_d©a
->
œ°_rx
 + 
	`TU_TO_JIFFIES
(ba_data->timeout * 2);

275 i‡(
	`time_is_a·î_jiffõs
(
timeout
)) {

276 
	`mod_timî
(&
ba_d©a
->
£ssi⁄_timî
, 
timeout
);

277 
u∆ock
;

281 
°a_id
 = 
	`ffs
(
ba_d©a
->
°a_mask
) - 1;

282 
°a
 = 
	`rcu_dîe„ªn˚
(
ba_d©a
->
mvm
->
fw_id_to_mac_id
[
°a_id
]);

292 i‡(
	`IS_ERR_OR_NULL
(
°a
))

293 
u∆ock
;

295 
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

296 
	`õì80211_rx_ba_timî_expúed
(
mvm_°a
->
vif
,

297 
°a
->
addr
, 
ba_d©a
->
tid
);

298 
u∆ock
:

299 
	`rcu_ªad_u∆ock
();

300 
	}
}

303 
	$iwl_mvm_övÆid©e_°a_queue
(
iwl_mvm
 *
mvm
, 
queue
,

304 
dißbÀ_agg_tids
,

305 
boﬁ
 
ªmove_queue
)

307 
iwl_mvm_add_°a_cmd
 
cmd
 = {};

308 
õì80211_°a
 *
°a
;

309 
iwl_mvm_°a
 *
mvm°a
;

310 
u32
 
°©us
;

311 
u8
 
°a_id
;

313 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

314  -
EINVAL
;

316 
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

318 
	`rcu_ªad_lock
();

320 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

322 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
))) {

323 
	`rcu_ªad_u∆ock
();

324  -
EINVAL
;

327 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

329 
mvm°a
->
tid_dißbÀ_agg
 |
dißbÀ_agg_tids
;

331 
cmd
.
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm°a
->mac_id_n_color);

332 
cmd
.
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

333 
cmd
.
add_modify
 = 
STA_MODE_MODIFY
;

334 
cmd
.
modify_mask
 = 
STA_MODIFY_QUEUES
;

335 i‡(
dißbÀ_agg_tids
)

336 
cmd
.
modify_mask
 |
STA_MODIFY_TID_DISABLE_TX
;

337 i‡(
ªmove_queue
)

338 
cmd
.
modify_mask
 |
STA_MODIFY_QUEUE_REMOVAL
;

339 
cmd
.
tfd_queue_msk
 = 
	`˝u_to_À32
(
mvm°a
->tfd_queue_msk);

340 
cmd
.
tid_dißbÀ_tx
 = 
	`˝u_to_À16
(
mvm°a
->
tid_dißbÀ_agg
);

342 
	`rcu_ªad_u∆ock
();

345 
°©us
 = 
ADD_STA_SUCCESS
;

346  
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA
,

347 
	`iwl_mvm_add_°a_cmd_size
(
mvm
),

348 &
cmd
, &
°©us
);

349 
	}
}

351 
	$iwl_mvm_dißbÀ_txq
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

352 
°a_id
, 
u16
 *
queuïå
, 
u8
 
tid
)

354 
queue
 = *
queuïå
;

355 
iwl_scd_txq_cfg_cmd
 
cmd
 = {

356 .
scd_queue
 = 
queue
,

357 .
a˘i⁄
 = 
SCD_CFG_DISABLE_QUEUE
,

359 
ªt
;

361 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

363 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

364 i‡(
mvm
->
°a_ªmove_ªquúes_queue_ªmove
) {

365 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
,

366 
SCD_QUEUE_CONFIG_CMD
);

367 
iwl_scd_queue_cfg_cmd
 
ªmove_cmd
 = {

368 .
›î©i⁄
 = 
	`˝u_to_À32
(
IWL_SCD_QUEUE_REMOVE
),

369 .
u
.
ªmove
.
°a_mask
 = 
	`˝u_to_À32
(
	`BIT
(
°a_id
)),

372 i‡(
tid
 =
IWL_MAX_TID_COUNT
)

373 
tid
 = 
IWL_MGMT_TID
;

375 
ªmove_cmd
.
u
.
ªmove
.
tid
 = 
	`˝u_to_À32
(tid);

377 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
cmd_id
, 0,

378 (
ªmove_cmd
),

379 &
ªmove_cmd
);

381 
ªt
 = 0;

384 
	`iwl_å™s_txq_‰ì
(
mvm
->
å™s
, 
queue
);

385 *
queuïå
 = 
IWL_MVM_INVALID_QUEUE
;

387  
ªt
;

390 i‡(
	`WARN_ON
(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 == 0))

393 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 &~
	`BIT
(
tid
);

395 
cmd
.
a˘i⁄
 = 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 ?

396 
SCD_CFG_ENABLE_QUEUE
 : 
SCD_CFG_DISABLE_QUEUE
;

397 i‡(
cmd
.
a˘i⁄
 =
SCD_CFG_DISABLE_QUEUE
)

398 
mvm
->
queue_öfo
[
queue
].
°©us
 = 
IWL_MVM_QUEUE_FREE
;

400 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

402 
queue
,

403 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
);

406 i‡(
cmd
.
a˘i⁄
 =
SCD_CFG_ENABLE_QUEUE
)

409 
cmd
.
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

410 
cmd
.
tid
 = 
mvm
->
queue_öfo
[
queue
].
txq_tid
;

413 
	`WARN
(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
,

415 
queue
, 
mvm
->
queue_öfo
[queue].
tid_bôm≠
);

418 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 = 0;

420 i‡(
°a
) {

421 
iwl_mvm_txq
 *
mvmtxq
 =

422 
	`iwl_mvm_txq_‰om_tid
(
°a
, 
tid
);

424 
	`•ö_lock_bh
(&
mvm
->
add_°ªam_lock
);

425 
	`li°_dñ_öô
(&
mvmtxq
->
li°
);

426 
	`˛ór_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
);

427 
mvmtxq
->
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

428 
	`•ö_u∆ock_bh
(&
mvm
->
add_°ªam_lock
);

432 
mvm
->
queue_öfo
[
queue
].
ª£rved
 = 
Ál£
;

434 
	`iwl_å™s_txq_dißbÀ
(
mvm
->
å™s
, 
queue
, 
Ál£
);

435 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
SCD_QUEUE_CFG
, 0,

436 (
iwl_scd_txq_cfg_cmd
), &
cmd
);

438 i‡(
ªt
)

439 
	`IWL_ERR
(
mvm
, "FailedÅo disable queue %d (ret=%d)\n",

440 
queue
, 
ªt
);

441  
ªt
;

442 
	}
}

444 
	$iwl_mvm_gë_queue_agg_tids
(
iwl_mvm
 *
mvm
, 
queue
)

446 
õì80211_°a
 *
°a
;

447 
iwl_mvm_°a
 *
mvm°a
;

448 
tid_bôm≠
;

449 
agg_tids
 = 0;

450 
u8
 
°a_id
;

451 
tid
;

453 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

455 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

456  -
EINVAL
;

458 
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

459 
tid_bôm≠
 = 
mvm
->
queue_öfo
[
queue
].tid_bitmap;

461 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

462 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

464 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
)))

465  -
EINVAL
;

467 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

469 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

470 
	`f‹_óch_£t_bô
(
tid
, &
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1) {

471 i‡(
mvm°a
->
tid_d©a
[
tid
].
°©e
 =
IWL_AGG_ON
)

472 
agg_tids
 |
	`BIT
(
tid
);

474 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

476  
agg_tids
;

477 
	}
}

484 
	$iwl_mvm_ªmove_°a_queue_m¨kög
(
iwl_mvm
 *
mvm
, 
queue
)

486 
õì80211_°a
 *
°a
;

487 
iwl_mvm_°a
 *
mvm°a
;

488 
tid_bôm≠
;

489 
dißbÀ_agg_tids
 = 0;

490 
u8
 
°a_id
;

491 
tid
;

493 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

495 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

496  -
EINVAL
;

498 
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

499 
tid_bôm≠
 = 
mvm
->
queue_öfo
[
queue
].tid_bitmap;

501 
	`rcu_ªad_lock
();

503 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

505 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
))) {

506 
	`rcu_ªad_u∆ock
();

510 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

512 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

514 
	`f‹_óch_£t_bô
(
tid
, &
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1) {

515 
iwl_mvm_txq
 *
mvmtxq
 =

516 
	`iwl_mvm_txq_‰om_tid
(
°a
, 
tid
);

518 i‡(
mvm°a
->
tid_d©a
[
tid
].
°©e
 =
IWL_AGG_ON
)

519 
dißbÀ_agg_tids
 |
	`BIT
(
tid
);

520 
mvm°a
->
tid_d©a
[
tid
].
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

522 
	`•ö_lock_bh
(&
mvm
->
add_°ªam_lock
);

523 
	`li°_dñ_öô
(&
mvmtxq
->
li°
);

524 
	`˛ór_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
);

525 
mvmtxq
->
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

526 
	`•ö_u∆ock_bh
(&
mvm
->
add_°ªam_lock
);

529 
mvm°a
->
tfd_queue_msk
 &~
	`BIT
(
queue
);

530 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

532 
	`rcu_ªad_u∆ock
();

542 
	`synchr⁄ize_√t
();

544  
dißbÀ_agg_tids
;

545 
	}
}

547 
	$iwl_mvm_‰ì_öa˘ive_queue
(
iwl_mvm
 *
mvm
, 
queue
,

548 
õì80211_°a
 *
ﬁd_°a
,

549 
u8
 
√w_°a_id
)

551 
iwl_mvm_°a
 *
mvm°a
;

552 
u8
 
°a_id
, 
tid
;

553 
dißbÀ_agg_tids
 = 0;

554 
boﬁ
 
ßme_°a
;

555 
u16
 
queue_tmp
 = 
queue
;

556 
ªt
;

558 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

560 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

561  -
EINVAL
;

563 
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

564 
tid
 = 
mvm
->
queue_öfo
[
queue
].
txq_tid
;

566 
ßme_°a
 = 
°a_id
 =
√w_°a_id
;

568 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 
°a_id
);

569 i‡(
	`WARN_ON
(!
mvm°a
))

570  -
EINVAL
;

572 
dißbÀ_agg_tids
 = 
	`iwl_mvm_ªmove_°a_queue_m¨kög
(
mvm
, 
queue
);

574 i‡(
dißbÀ_agg_tids
)

575 
	`iwl_mvm_övÆid©e_°a_queue
(
mvm
, 
queue
,

576 
dißbÀ_agg_tids
, 
Ál£
);

578 
ªt
 = 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
ﬁd_°a
, 
°a_id
, &
queue_tmp
, 
tid
);

579 i‡(
ªt
) {

580 
	`IWL_ERR
(
mvm
,

582 
queue
, 
ªt
);

584  
ªt
;

588 i‡(!
ßme_°a
)

589 
	`iwl_mvm_övÆid©e_°a_queue
(
mvm
, 
queue
, 0, 
åue
);

592 
	}
}

594 
	$iwl_mvm_gë_sh¨ed_queue
(
iwl_mvm
 *
mvm
,

595 
tfd_queue_mask
, 
u8
 
ac
)

597 
queue
 = 0;

598 
u8
 
ac_to_queue
[
IEEE80211_NUM_ACS
];

599 
i
;

605 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

607 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

608  -
EINVAL
;

610 
	`mem£t
(&
ac_to_queue
, 
IEEE80211_INVAL_HW_QUEUE
, (ac_to_queue));

613 
	`f‹_óch_£t_bô
(
i
, &
tfd_queue_mask
, 
IWL_MVM_DQA_MAX_DATA_QUEUE
) {

615 i‡(
i
 < 
IWL_MVM_DQA_MIN_DATA_QUEUE
 &&

616 
i
 !
IWL_MVM_DQA_BSS_CLIENT_QUEUE
)

619 
ac_to_queue
[
mvm
->
queue_öfo
[
i
].
mac80211_ac
] = i;

632 i‡(
ac_to_queue
[
IEEE80211_AC_BE
] !
IEEE80211_INVAL_HW_QUEUE
)

633 
queue
 = 
ac_to_queue
[
IEEE80211_AC_BE
];

635 i‡(
ac_to_queue
[
ac
] !
IEEE80211_INVAL_HW_QUEUE
)

636 
queue
 = 
ac_to_queue
[
ac
];

638 i‡(
ac
 =
IEEE80211_AC_VO
 &&

639 
ac_to_queue
[
IEEE80211_AC_VI
] !
IEEE80211_INVAL_HW_QUEUE
)

640 
queue
 = 
ac_to_queue
[
IEEE80211_AC_VI
];

642 i‡(
ac_to_queue
[
IEEE80211_AC_BK
] !
IEEE80211_INVAL_HW_QUEUE
)

643 
queue
 = 
ac_to_queue
[
IEEE80211_AC_BK
];

645 i‡(
ac_to_queue
[
IEEE80211_AC_VI
] !
IEEE80211_INVAL_HW_QUEUE
)

646 
queue
 = 
ac_to_queue
[
IEEE80211_AC_VI
];

648 i‡(
ac_to_queue
[
IEEE80211_AC_VO
] !
IEEE80211_INVAL_HW_QUEUE
)

649 
queue
 = 
ac_to_queue
[
IEEE80211_AC_VO
];

652 i‡(!
	`iwl_mvm_is_dqa_d©a_queue
(
mvm
, 
queue
) &&

653 !
	`iwl_mvm_is_dqa_mgmt_queue
(
mvm
, 
queue
) &&

654 (
queue
 !
IWL_MVM_DQA_BSS_CLIENT_QUEUE
)) {

655 
	`IWL_ERR
(
mvm
, "No DATA queuesávailableÅo share\n");

656  -
ENOSPC
;

659  
queue
;

660 
	}
}

663 
	$iwl_mvm_ªc⁄fig_scd
(
iwl_mvm
 *
mvm
, 
queue
, 
fifo
,

664 
°a_id
, 
tid
, 
‰ame_limô
, 
u16
 
s¢
)

666 
iwl_scd_txq_cfg_cmd
 
cmd
 = {

667 .
scd_queue
 = 
queue
,

668 .
a˘i⁄
 = 
SCD_CFG_ENABLE_QUEUE
,

669 .
wödow
 = 
‰ame_limô
,

670 .
°a_id
 = sta_id,

671 .
s¢
 = 
	`˝u_to_À16
(ssn),

672 .
tx_fifo
 = 
fifo
,

673 .
aggªg©e
 = (
queue
 >
IWL_MVM_DQA_MIN_DATA_QUEUE
 ||

674 
queue
 =
IWL_MVM_DQA_BSS_CLIENT_QUEUE
),

675 .
tid
 =Åid,

677 
ªt
;

679 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

680  -
EINVAL
;

682 i‡(
	`WARN
(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 == 0,

683 "TryögÅÿªc⁄fig u«Œoˇãd queuê%d\n", 
queue
))

684  -
ENXIO
;

686 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Rec⁄fig SCD f‹ TXQ #%d\n", 
queue
);

688 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
SCD_QUEUE_CFG
, 0, (
cmd
), &cmd);

689 
	`WARN_ONCE
(
ªt
, "FailedÅoÑe-configure queue %d on FIFO %d,Ñet=%d\n",

690 
queue
, 
fifo
, 
ªt
);

692  
ªt
;

693 
	}
}

701 
	$iwl_mvm_ªdúe˘_queue
(
iwl_mvm
 *
mvm
, 
queue
, 
tid
,

702 
ac
, 
s¢
, 
wdg_timeout
,

703 
boﬁ
 
f‹˚
, 
iwl_mvm_txq
 *
txq
)

705 
iwl_scd_txq_cfg_cmd
 
cmd
 = {

706 .
scd_queue
 = 
queue
,

707 .
a˘i⁄
 = 
SCD_CFG_DISABLE_QUEUE
,

709 
boﬁ
 
sh¨ed_queue
;

710 
ªt
;

712 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

713  -
EINVAL
;

723 i‡(
ac
 <
mvm
->
queue_öfo
[
queue
].
mac80211_ac
 && !
f‹˚
) {

724 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

726 
queue
);

730 
cmd
.
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

731 
cmd
.
tx_fifo
 = 
iwl_mvm_ac_to_tx_fifo
[
mvm
->
queue_öfo
[
queue
].
mac80211_ac
];

732 
cmd
.
tid
 = 
mvm
->
queue_öfo
[
queue
].
txq_tid
;

733 
sh¨ed_queue
 = 
	`hweight16
(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
) > 1;

735 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Redirecting TXQ #%dÅo FIFO #%d\n",

736 
queue
, 
iwl_mvm_ac_to_tx_fifo
[
ac
]);

739 
	`£t_bô
(
IWL_MVM_TXQ_STATE_STOP_REDIRECT
, &
txq
->
°©e
);

741 
ªt
 = 
	`iwl_å™s_waô_tx_queues_em±y
(
mvm
->
å™s
, 
	`BIT
(
queue
));

742 i‡(
ªt
) {

743 
	`IWL_ERR
(
mvm
, "Error draining queue %d beforeÑeconfig\n",

744 
queue
);

745 
ªt
 = -
EIO
;

746 
out
;

750 
	`iwl_å™s_txq_dißbÀ
(
mvm
->
å™s
, 
queue
, 
Ál£
);

751 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
SCD_QUEUE_CFG
, 0, (
cmd
), &cmd);

752 i‡(
ªt
)

753 
	`IWL_ERR
(
mvm
, "Faûed SCD dißbÀ TXQ %d (ªt=%d)\n", 
queue
,

754 
ªt
);

757 
	`iwl_å™s_txq_íabÀ_cfg
(
mvm
->
å™s
, 
queue
, 
s¢
, 
NULL
, 
wdg_timeout
);

760 
mvm
->
queue_öfo
[
queue
].
txq_tid
 = 
tid
;

765 
	`iwl_mvm_ªc⁄fig_scd
(
mvm
, 
queue
, 
iwl_mvm_ac_to_tx_fifo
[
ac
],

766 
cmd
.
°a_id
, 
tid
, 
IWL_FRAME_LIMIT
, 
s¢
);

769 
mvm
->
queue_öfo
[
queue
].
mac80211_ac
 = 
ac
;

777 i‡(
sh¨ed_queue
)

778 
	`iwl_å™s_txq_£t_sh¨ed_mode
(
mvm
->
å™s
, 
queue
, 
åue
);

780 
out
:

782 
	`˛ór_bô
(
IWL_MVM_TXQ_STATE_STOP_REDIRECT
, &
txq
->
°©e
);

784  
ªt
;

785 
	}
}

787 
	$iwl_mvm_föd_‰ì_queue
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
,

788 
u8
 
möq
, u8 
maxq
)

790 
i
;

792 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

794 i‡(
	`WARN
(
maxq
 >
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
,

795 "max queuê%d >num_of_queue†(%d)", 
maxq
,

796 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
))

797 
maxq
 = 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
 - 1;

800 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

801  -
ENOSPC
;

804 
i
 = 
möq
; i <
maxq
; i++)

805 i‡(
mvm
->
queue_öfo
[
i
].
tid_bôm≠
 == 0 &&

806 
mvm
->
queue_öfo
[
i
].
°©us
 =
IWL_MVM_QUEUE_FREE
)

807  
i
;

809  -
ENOSPC
;

810 
	}
}

812 
	$iwl_mvm_gë_queue_size
(
õì80211_°a
 *
°a
)

814 
max_size
 = 
IWL_DEFAULT_QUEUE_SIZE
;

815 
lök_id
;

818 i‡(!
°a
)

819  
IWL_MGMT_QUEUE_SIZE
;

821 
	`rcu_ªad_lock
();

823 
lök_id
 = 0;Üök_id < 
	`ARRAY_SIZE
(
°a
->
lök
);Üink_id++) {

824 
õì80211_lök_°a
 *
lök
 =

825 
	`rcu_dîe„ªn˚
(
°a
->
lök
[
lök_id
]);

827 i‡(!
lök
)

831 i‡(
lök
->
eht_ˇp
.
has_eht
 &&

832 
max_size
 < 
IWL_DEFAULT_QUEUE_SIZE_EHT
)

833 
max_size
 = 
IWL_DEFAULT_QUEUE_SIZE_EHT
;

836 i‡(
lök
->
he_ˇp
.
has_he
 &&

837 
max_size
 < 
IWL_DEFAULT_QUEUE_SIZE_HE
)

838 
max_size
 = 
IWL_DEFAULT_QUEUE_SIZE_HE
;

841 
	`rcu_ªad_u∆ock
();

842  
max_size
;

843 
	}
}

845 
	$iwl_mvm_tvqm_íabÀ_txq
(
iwl_mvm
 *
mvm
,

846 
õì80211_°a
 *
°a
,

847 
u8
 
°a_id
, u8 
tid
, 
timeout
)

849 
queue
, 
size
;

850 
u32
 
°a_mask
 = 0;

852 i‡(
tid
 =
IWL_MAX_TID_COUNT
) {

853 
tid
 = 
IWL_MGMT_TID
;

854 
size
 = 
	`max_t
(
u32
, 
IWL_MGMT_QUEUE_SIZE
,

855 
mvm
->
å™s
->
cfg
->
mö_txq_size
);

857 
size
 = 
	`iwl_mvm_gë_queue_size
(
°a
);

861 
size
 = 
	`mö_t
(
u32
, size, 
mvm
->
å™s
->
txqs
.
bc_tbl_size
 / (
u16
));

864 
size
 = 
	`rounddown_pow_of_two
(size);

866 i‡(
°a
) {

867 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

868 
õì80211_lök_°a
 *
lök_°a
;

869 
lök_id
;

871 
	`rcu_ªad_lock
();

872 
	`f‹_óch_°a_a˘ive_lök
(
mvm°a
->
vif
, 
°a
, 
lök_°a
, 
lök_id
) {

873 
iwl_mvm_lök_°a
 *
lök
 =

874 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm°a
->
lök
[
lök_id
],

875 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

877 i‡(!
lök
)

880 
°a_mask
 |
	`BIT
(
lök
->
°a_id
);

882 
	`rcu_ªad_u∆ock
();

884 
°a_mask
 |
	`BIT
(
°a_id
);

887 i‡(!
°a_mask
)

888  -
EINVAL
;

891 
queue
 = 
	`iwl_å™s_txq_Æloc
(
mvm
->
å™s
, 0, 
°a_mask
,

892 
tid
, 
size
, 
timeout
);

894 i‡(
queue
 < 0)

895 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

897 
size
, 
°a_mask
, 
tid
, 
queue
);

898 
size
 /= 2;

899 } 
queue
 < 0 && 
size
 >= 16);

901 i‡(
queue
 < 0)

902  
queue
;

904 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Enabling TXQ #%d for sta mask 0x%xÅid %d\n",

905 
queue
, 
°a_mask
, 
tid
);

907  
queue
;

908 
	}
}

910 
	$iwl_mvm_°a_Æloc_queue_tvqm
(
iwl_mvm
 *
mvm
,

911 
õì80211_°a
 *
°a
, 
u8
 
ac
,

912 
tid
)

914 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

915 
iwl_mvm_txq
 *
mvmtxq
 =

916 
	`iwl_mvm_txq_‰om_tid
(
°a
, 
tid
);

917 
wdg_timeout
 =

918 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
mvm°a
->
vif
, 
Ál£
, false);

919 
queue
 = -1;

921 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

923 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

925 
mvm°a
->
deÊök
.
°a_id
, 
tid
);

926 
queue
 = 
	`iwl_mvm_tvqm_íabÀ_txq
(
mvm
, 
°a
, 
mvm°a
->
deÊök
.
°a_id
,

927 
tid
, 
wdg_timeout
);

928 i‡(
queue
 < 0)

929  
queue
;

931 
mvmtxq
->
txq_id
 = 
queue
;

932 
mvm
->
tvqm_öfo
[
queue
].
txq_tid
 = 
tid
;

933 
mvm
->
tvqm_öfo
[
queue
].
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

935 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "AŒoˇãd queuêi†%d\n", 
queue
);

937 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

938 
mvm°a
->
tid_d©a
[
tid
].
txq_id
 = 
queue
;

939 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

942 
	}
}

944 
boﬁ
 
	$iwl_mvm_upd©e_txq_m≠pög
(
iwl_mvm
 *
mvm
,

945 
õì80211_°a
 *
°a
,

946 
queue
, 
u8
 
°a_id
, u8 
tid
)

948 
boﬁ
 
íabÀ_queue
 = 
åue
;

951 i‡(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 & 
	`BIT
(
tid
)) {

952 
	`IWL_ERR
(
mvm
, "TryingÅoÉnable TXQ %d withÉxisting TID %d\n",

953 
queue
, 
tid
);

954  
Ál£
;

958 i‡(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
)

959 
íabÀ_queue
 = 
Ál£
;

961 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 |
	`BIT
(
tid
);

962 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
 = 
°a_id
;

964 i‡(
íabÀ_queue
) {

965 i‡(
tid
 !
IWL_MAX_TID_COUNT
)

966 
mvm
->
queue_öfo
[
queue
].
mac80211_ac
 =

967 
tid_to_mac80211_ac
[
tid
];

969 
mvm
->
queue_öfo
[
queue
].
mac80211_ac
 = 
IEEE80211_AC_VO
;

971 
mvm
->
queue_öfo
[
queue
].
txq_tid
 = 
tid
;

974 i‡(
°a
) {

975 
iwl_mvm_txq
 *
mvmtxq
 =

976 
	`iwl_mvm_txq_‰om_tid
(
°a
, 
tid
);

978 
mvmtxq
->
txq_id
 = 
queue
;

981 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

983 
queue
, 
mvm
->
queue_öfo
[queue].
tid_bôm≠
);

985  
íabÀ_queue
;

986 
	}
}

988 
boﬁ
 
	$iwl_mvm_íabÀ_txq
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

989 
queue
, 
u16
 
s¢
,

990 c⁄° 
iwl_å™s_txq_scd_cfg
 *
cfg
,

991 
wdg_timeout
)

993 
iwl_scd_txq_cfg_cmd
 
cmd
 = {

994 .
scd_queue
 = 
queue
,

995 .
a˘i⁄
 = 
SCD_CFG_ENABLE_QUEUE
,

996 .
wödow
 = 
cfg
->
‰ame_limô
,

997 .
°a_id
 = 
cfg
->sta_id,

998 .
s¢
 = 
	`˝u_to_À16
(ssn),

999 .
tx_fifo
 = 
cfg
->
fifo
,

1000 .
aggªg©e
 = 
cfg
->aggregate,

1001 .
tid
 = 
cfg
->tid,

1003 
boﬁ
 
öc_s¢
;

1005 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

1006  
Ál£
;

1009 i‡(!
	`iwl_mvm_upd©e_txq_m≠pög
(
mvm
, 
°a
, 
queue
, 
cfg
->
°a_id
, cfg->
tid
))

1010  
Ál£
;

1012 
öc_s¢
 = 
	`iwl_å™s_txq_íabÀ_cfg
(
mvm
->
å™s
, 
queue
, 
s¢
,

1013 
NULL
, 
wdg_timeout
);

1014 i‡(
öc_s¢
)

1015 
	`À16_add_˝u
(&
cmd
.
s¢
, 1);

1017 
	`WARN
(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
SCD_QUEUE_CFG
, 0, (
cmd
), &cmd),

1018 "FaûedÅÿc⁄figuª queuê%d o¿FIFO %d\n", 
queue
, 
cfg
->
fifo
);

1020  
öc_s¢
;

1021 
	}
}

1023 
	$iwl_mvm_ch™ge_queue_tid
(
iwl_mvm
 *
mvm
, 
queue
)

1025 
iwl_scd_txq_cfg_cmd
 
cmd
 = {

1026 .
scd_queue
 = 
queue
,

1027 .
a˘i⁄
 = 
SCD_CFG_UPDATE_QUEUE_TID
,

1029 
tid
;

1030 
tid_bôm≠
;

1031 
ªt
;

1033 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1035 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

1038 
tid_bôm≠
 = 
mvm
->
queue_öfo
[
queue
].tid_bitmap;

1040 i‡(
	`WARN
(!
tid_bôm≠
, "TXQ %d ha†nÿtid†assig√dÅÿô\n", 
queue
))

1044 
tid
 = 
	`föd_fú°_bô
(&
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1);

1045 
cmd
.
tid
 =Åid;

1046 
cmd
.
tx_fifo
 = 
iwl_mvm_ac_to_tx_fifo
[
tid_to_mac80211_ac
[
tid
]];

1048 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
SCD_QUEUE_CFG
, 0, (
cmd
), &cmd);

1049 i‡(
ªt
) {

1050 
	`IWL_ERR
(
mvm
, "FailedÅo update owner of TXQ %d (ret=%d)\n",

1051 
queue
, 
ªt
);

1055 
mvm
->
queue_öfo
[
queue
].
txq_tid
 = 
tid
;

1056 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Changed TXQ %d ownershipÅoÅid %d\n",

1057 
queue
, 
tid
);

1058 
	}
}

1060 
	$iwl_mvm_unsh¨e_queue
(
iwl_mvm
 *
mvm
, 
queue
)

1062 
õì80211_°a
 *
°a
;

1063 
iwl_mvm_°a
 *
mvm°a
;

1064 
u8
 
°a_id
;

1065 
tid
 = -1;

1066 
tid_bôm≠
;

1067 
wdg_timeout
;

1068 
s¢
;

1069 
ªt
 = 
åue
;

1072 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

1075 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1077 
°a_id
 = 
mvm
->
queue_öfo
[
queue
].
ø_°a_id
;

1078 
tid_bôm≠
 = 
mvm
->
queue_öfo
[
queue
].tid_bitmap;

1081 
tid
 = 
	`föd_fú°_bô
(&
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1);

1082 i‡(
tid_bôm≠
 !
	`BIT
(
tid
)) {

1083 
	`IWL_ERR
(
mvm
, "FailedÅo unshare q %d,áctiveÅids=0x%lx\n",

1084 
queue
, 
tid_bôm≠
);

1088 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Unsh¨ög TXQ %d, kìpögÅid %d\n", 
queue
,

1089 
tid
);

1091 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

1092 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1094 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
)))

1097 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1098 
wdg_timeout
 = 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
mvm°a
->
vif
, 
Ál£
, false);

1100 
s¢
 = 
	`IEEE80211_SEQ_TO_SN
(
mvm°a
->
tid_d©a
[
tid
].
£q_numbî
);

1102 
ªt
 = 
	`iwl_mvm_ªdúe˘_queue
(
mvm
, 
queue
, 
tid
,

1103 
tid_to_mac80211_ac
[
tid
], 
s¢
,

1104 
wdg_timeout
, 
åue
,

1105 
	`iwl_mvm_txq_‰om_tid
(
°a
, 
tid
));

1106 i‡(
ªt
) {

1107 
	`IWL_ERR
(
mvm
, "FaûedÅÿªdúe˘ TXQ %d\n", 
queue
);

1112 i‡(
mvm°a
->
tid_d©a
[
tid
].
°©e
 =
IWL_AGG_ON
) {

1113 
iwl_mvm_add_°a_cmd
 
cmd
 = {0};

1115 
mvm°a
->
tid_dißbÀ_agg
 &~
	`BIT
(
tid
);

1117 
cmd
.
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm°a
->mac_id_n_color);

1118 
cmd
.
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

1119 
cmd
.
add_modify
 = 
STA_MODE_MODIFY
;

1120 
cmd
.
modify_mask
 = 
STA_MODIFY_TID_DISABLE_TX
;

1121 
cmd
.
tfd_queue_msk
 = 
	`˝u_to_À32
(
mvm°a
->tfd_queue_msk);

1122 
cmd
.
tid_dißbÀ_tx
 = 
	`˝u_to_À16
(
mvm°a
->
tid_dißbÀ_agg
);

1124 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ADD_STA
, 
CMD_ASYNC
,

1125 
	`iwl_mvm_add_°a_cmd_size
(
mvm
), &
cmd
);

1126 i‡(!
ªt
) {

1127 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1129 
queue
);

1132 
	`iwl_å™s_txq_£t_sh¨ed_mode
(
mvm
->
å™s
, 
queue
, 
Ál£
);

1136 
mvm
->
queue_öfo
[
queue
].
°©us
 = 
IWL_MVM_QUEUE_READY
;

1137 
	}
}

1146 
boﬁ
 
	$iwl_mvm_ªmove_öa˘ive_tids
(
iwl_mvm
 *
mvm
,

1147 
iwl_mvm_°a
 *
mvm°a
, 
queue
,

1148 
tid_bôm≠
,

1149 *
unsh¨e_queues
,

1150 *
ch™gëid_queues
)

1152 
tid
;

1154 
	`lockdï_as£π_hñd
(&
mvm°a
->
lock
);

1155 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1157 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

1158  
Ál£
;

1161 
	`f‹_óch_£t_bô
(
tid
, &
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1) {

1163 i‡(
	`iwl_mvm_tid_queued
(
mvm
, &
mvm°a
->
tid_d©a
[
tid
]))

1164 
tid_bôm≠
 &~
	`BIT
(
tid
);

1167 i‡(
mvm°a
->
tid_d©a
[
tid
].
°©e
 !
IWL_AGG_OFF
)

1168 
tid_bôm≠
 &~
	`BIT
(
tid
);

1172 i‡(
tid_bôm≠
 =
mvm
->
queue_öfo
[
queue
].tid_bitmap) {

1173 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Queuê%d i†öa˘ive\n", 
queue
);

1174  
åue
;

1181 
	`f‹_óch_£t_bô
(
tid
, &
tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1) {

1182 
u16
 
q_tid_bôm≠
;

1184 
mvm°a
->
tid_d©a
[
tid
].
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

1185 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
 &~
	`BIT
(
tid
);

1187 
q_tid_bôm≠
 = 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
;

1200 i‡(!(
q_tid_bôm≠
 & 
	`BIT
(
mvm
->
queue_öfo
[
queue
].
txq_tid
)))

1201 
	`£t_bô
(
queue
, 
ch™gëid_queues
);

1203 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1205 
tid
, 
queue
);

1208 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1209 "TXQ #%dÜe· wôhÅid bôm≠ 0x%x\n", 
queue
,

1210 
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
);

1216 
tid_bôm≠
 = 
mvm
->
queue_öfo
[
queue
].tid_bitmap;

1219 i‡(
	`hweight16
(
mvm
->
queue_öfo
[
queue
].
tid_bôm≠
) == 1 &&

1220 
mvm
->
queue_öfo
[
queue
].
°©us
 =
IWL_MVM_QUEUE_SHARED
) {

1221 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Marking Q:%d forÑeconfig\n",

1222 
queue
);

1223 
	`£t_bô
(
queue
, 
unsh¨e_queues
);

1226  
Ál£
;

1227 
	}
}

1238 
	$iwl_mvm_öa˘ivôy_check
(
iwl_mvm
 *
mvm
, 
u8
 
Æloc_f‹_°a
)

1240 
now
 = 
jiffõs
;

1241 
unsh¨e_queues
 = 0;

1242 
ch™gëid_queues
 = 0;

1243 
i
, 
ªt
, 
‰ì_queue
 = -
ENOSPC
;

1244 
õì80211_°a
 *
queue_ow√r
 = 
NULL
;

1246 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1248 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1249  -
ENOSPC
;

1251 
	`rcu_ªad_lock
();

1254 
	`BUILD_BUG_ON
(
IWL_MVM_DQA_CMD_QUEUE
 != 0);

1256 
i
 = 1; i < 
IWL_MAX_HW_QUEUES
; i++) {

1257 
õì80211_°a
 *
°a
;

1258 
iwl_mvm_°a
 *
mvm°a
;

1259 
u8
 
°a_id
;

1260 
tid
;

1261 
öa˘ive_tid_bôm≠
 = 0;

1262 
queue_tid_bôm≠
;

1264 
queue_tid_bôm≠
 = 
mvm
->
queue_öfo
[
i
].
tid_bôm≠
;

1265 i‡(!
queue_tid_bôm≠
)

1269 i‡(
mvm
->
queue_öfo
[
i
].
°©us
 !
IWL_MVM_QUEUE_READY
 &&

1270 
mvm
->
queue_öfo
[
i
].
°©us
 !
IWL_MVM_QUEUE_SHARED
)

1274 
	`f‹_óch_£t_bô
(
tid
, &
queue_tid_bôm≠
,

1275 
IWL_MAX_TID_COUNT
 + 1) {

1276 i‡(
	`time_a·î
(
mvm
->
queue_öfo
[
i
].
œ°_‰ame_time
[
tid
] +

1277 
IWL_MVM_DQA_QUEUE_TIMEOUT
, 
now
))

1280 
öa˘ive_tid_bôm≠
 |
	`BIT
(
tid
);

1284 i‡(!
öa˘ive_tid_bôm≠
)

1292 
°a_id
 = 
mvm
->
queue_öfo
[
i
].
ø_°a_id
;

1293 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

1300 i‡(
	`IS_ERR_OR_NULL
(
°a
))

1303 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1305 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

1306 
ªt
 = 
	`iwl_mvm_ªmove_öa˘ive_tids
(
mvm
, 
mvm°a
, 
i
,

1307 
öa˘ive_tid_bôm≠
,

1308 &
unsh¨e_queues
,

1309 &
ch™gëid_queues
);

1310 i‡(
ªt
 && 
‰ì_queue
 < 0) {

1311 
queue_ow√r
 = 
°a
;

1312 
‰ì_queue
 = 
i
;

1315 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

1320 
	`f‹_óch_£t_bô
(
i
, &
unsh¨e_queues
, 
IWL_MAX_HW_QUEUES
)

1321 
	`iwl_mvm_unsh¨e_queue
(
mvm
, 
i
);

1322 
	`f‹_óch_£t_bô
(
i
, &
ch™gëid_queues
, 
IWL_MAX_HW_QUEUES
)

1323 
	`iwl_mvm_ch™ge_queue_tid
(
mvm
, 
i
);

1325 
	`rcu_ªad_u∆ock
();

1327 i‡(
‰ì_queue
 >0 && 
Æloc_f‹_°a
 !
IWL_MVM_INVALID_STA
) {

1328 
ªt
 = 
	`iwl_mvm_‰ì_öa˘ive_queue
(
mvm
, 
‰ì_queue
, 
queue_ow√r
,

1329 
Æloc_f‹_°a
);

1330 i‡(
ªt
)

1331  
ªt
;

1334  
‰ì_queue
;

1335 
	}
}

1337 
	$iwl_mvm_°a_Æloc_queue
(
iwl_mvm
 *
mvm
,

1338 
õì80211_°a
 *
°a
, 
u8
 
ac
, 
tid
)

1340 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1341 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

1342 .
fifo
 = 
	`iwl_mvm_mac_ac_to_tx_fifo
(
mvm
, 
ac
),

1343 .
°a_id
 = 
mvm°a
->
deÊök
.sta_id,

1344 .
tid
 =Åid,

1345 .
‰ame_limô
 = 
IWL_FRAME_LIMIT
,

1347 
wdg_timeout
 =

1348 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
mvm°a
->
vif
, 
Ál£
, false);

1349 
queue
 = -1;

1350 
u16
 
queue_tmp
;

1351 
dißbÀ_agg_tids
 = 0;

1352 
iwl_mvm_agg_°©e
 
queue_°©e
;

1353 
boﬁ
 
sh¨ed_queue
 = 
Ál£
, 
öc_s¢
;

1354 
s¢
;

1355 
tfd_queue_mask
;

1356 
ªt
;

1358 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1360 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1361  
	`iwl_mvm_°a_Æloc_queue_tvqm
(
mvm
, 
°a
, 
ac
, 
tid
);

1363 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

1364 
tfd_queue_mask
 = 
mvm°a
->
tfd_queue_msk
;

1365 
s¢
 = 
	`IEEE80211_SEQ_TO_SN
(
mvm°a
->
tid_d©a
[
tid
].
£q_numbî
);

1366 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

1368 i‡(
tid
 =
IWL_MAX_TID_COUNT
) {

1369 
queue
 = 
	`iwl_mvm_föd_‰ì_queue
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
,

1370 
IWL_MVM_DQA_MIN_MGMT_QUEUE
,

1371 
IWL_MVM_DQA_MAX_MGMT_QUEUE
);

1372 i‡(
queue
 >
IWL_MVM_DQA_MIN_MGMT_QUEUE
)

1373 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Found free MGMT queue #%d\n",

1374 
queue
);

1379 i‡((
queue
 < 0 && 
mvm°a
->
ª£rved_queue
 !
IEEE80211_INVAL_HW_QUEUE
) &&

1380 (
mvm
->
queue_öfo
[
mvm°a
->
ª£rved_queue
].
°©us
 ==

1381 
IWL_MVM_QUEUE_RESERVED
)) {

1382 
queue
 = 
mvm°a
->
ª£rved_queue
;

1383 
mvm
->
queue_öfo
[
queue
].
ª£rved
 = 
åue
;

1384 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "UsögÑe£rved queuê#%d\n", 
queue
);

1387 i‡(
queue
 < 0)

1388 
queue
 = 
	`iwl_mvm_föd_‰ì_queue
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
,

1389 
IWL_MVM_DQA_MIN_DATA_QUEUE
,

1390 
IWL_MVM_DQA_MAX_DATA_QUEUE
);

1391 i‡(
queue
 < 0) {

1393 
queue
 = 
	`iwl_mvm_öa˘ivôy_check
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
);

1397 i‡(
queue
 <= 0) {

1398 
queue
 = 
	`iwl_mvm_gë_sh¨ed_queue
(
mvm
, 
tfd_queue_mask
, 
ac
);

1399 i‡(
queue
 > 0) {

1400 
sh¨ed_queue
 = 
åue
;

1401 
mvm
->
queue_öfo
[
queue
].
°©us
 = 
IWL_MVM_QUEUE_SHARED
;

1411 i‡(
queue
 > 0 && !
sh¨ed_queue
)

1412 
mvm
->
queue_öfo
[
queue
].
°©us
 = 
IWL_MVM_QUEUE_READY
;

1415 i‡(
	`WARN_ON
(
queue
 <= 0)) {

1416 
	`IWL_ERR
(
mvm
, "Noávailable queues forÅid %d on sta_id %d\n",

1417 
tid
, 
cfg
.
°a_id
);

1418  
queue
;

1427 
cfg
.
aggªg©e
 = (
queue
 >
IWL_MVM_DQA_MIN_DATA_QUEUE
 ||

1428 
queue
 =
IWL_MVM_DQA_BSS_CLIENT_QUEUE
);

1430 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1432 
sh¨ed_queue
 ? "sh¨ed " : "", 
queue
,

1433 
mvm°a
->
deÊök
.
°a_id
, 
tid
);

1435 i‡(
sh¨ed_queue
) {

1437 
dißbÀ_agg_tids
 = 
	`iwl_mvm_gë_queue_agg_tids
(
mvm
, 
queue
);

1439 i‡(
dißbÀ_agg_tids
) {

1440 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Disablingággs on queue %d\n",

1441 
queue
);

1442 
	`iwl_mvm_övÆid©e_°a_queue
(
mvm
, 
queue
,

1443 
dißbÀ_agg_tids
, 
Ál£
);

1447 
öc_s¢
 = 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
°a
, 
queue
, 
s¢
, &
cfg
, 
wdg_timeout
);

1455 i‡(
sh¨ed_queue
)

1456 
	`iwl_å™s_txq_£t_sh¨ed_mode
(
mvm
->
å™s
, 
queue
, 
åue
);

1458 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

1464 i‡(
öc_s¢
) {

1465 
mvm°a
->
tid_d©a
[
tid
].
£q_numbî
 += 0x10;

1466 
s¢
 = (s¢ + 1Ë& 
IEEE80211_SCTL_SEQ
;

1468 
mvm°a
->
tid_d©a
[
tid
].
txq_id
 = 
queue
;

1469 
mvm°a
->
tfd_queue_msk
 |
	`BIT
(
queue
);

1470 
queue_°©e
 = 
mvm°a
->
tid_d©a
[
tid
].
°©e
;

1472 i‡(
mvm°a
->
ª£rved_queue
 =
queue
)

1473 
mvm°a
->
ª£rved_queue
 = 
IEEE80211_INVAL_HW_QUEUE
;

1474 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

1476 i‡(!
sh¨ed_queue
) {

1477 
ªt
 = 
	`iwl_mvm_°a_£nd_to_fw
(
mvm
, 
°a
, 
åue
, 
STA_MODIFY_QUEUES
);

1478 i‡(
ªt
)

1479 
out_îr
;

1482 i‡(
queue_°©e
 =
IWL_AGG_ON
) {

1483 
ªt
 = 
	`iwl_mvm_°a_tx_agg
(
mvm
, 
°a
, 
tid
, 
queue
, 
åue
);

1484 i‡(
ªt
)

1485 
out_îr
;

1489 
ªt
 = 
	`iwl_mvm_ªdúe˘_queue
(
mvm
, 
queue
, 
tid
, 
ac
, 
s¢
,

1490 
wdg_timeout
, 
Ál£
,

1491 
	`iwl_mvm_txq_‰om_tid
(
°a
, 
tid
));

1492 i‡(
ªt
)

1493 
out_îr
;

1498 
out_îr
:

1499 
queue_tmp
 = 
queue
;

1500 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
°a
, 
mvm°a
->
deÊök
.
°a_id
, &
queue_tmp
, 
tid
);

1502  
ªt
;

1503 
	}
}

1505 
	$iwl_mvm_°a_ísuª_queue
(
iwl_mvm
 *
mvm
,

1506 
õì80211_txq
 *
txq
)

1508 
iwl_mvm_txq
 *
mvmtxq
 = 
	`iwl_mvm_txq_‰om_mac80211
(
txq
);

1509 
ªt
 = -
EINVAL
;

1511 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1513 i‡(
	`likñy
(
	`ã°_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
)) ||

1514 !
txq
->
°a
) {

1518 i‡(!
	`iwl_mvm_°a_Æloc_queue
(
mvm
, 
txq
->
°a
,Åxq->
ac
,Åxq->
tid
)) {

1519 
	`£t_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
);

1520 
ªt
 = 0;

1523 
	`loˇl_bh_dißbÀ
();

1524 
	`•ö_lock
(&
mvm
->
add_°ªam_lock
);

1525 i‡(!
	`li°_em±y
(&
mvmtxq
->
li°
))

1526 
	`li°_dñ_öô
(&
mvmtxq
->
li°
);

1527 
	`•ö_u∆ock
(&
mvm
->
add_°ªam_lock
);

1528 
	`loˇl_bh_íabÀ
();

1530  
ªt
;

1531 
	}
}

1533 
	$iwl_mvm_add_√w_dqa_°ªam_wk
(
w‹k_°ru˘
 *
wk
)

1535 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
wk
, iwl_mvm,

1536 
add_°ªam_wk
);

1538 
	`muãx_lock
(&
mvm
->
muãx
);

1540 
	`iwl_mvm_öa˘ivôy_check
(
mvm
, 
IWL_MVM_INVALID_STA
);

1542 !
	`li°_em±y
(&
mvm
->
add_°ªam_txqs
)) {

1543 
iwl_mvm_txq
 *
mvmtxq
;

1544 
õì80211_txq
 *
txq
;

1545 
u8
 
tid
;

1547 
mvmtxq
 = 
	`li°_fú°_íåy
(&
mvm
->
add_°ªam_txqs
,

1548 
iwl_mvm_txq
, 
li°
);

1550 
txq
 = 
	`c⁄èöî_of
((*)
mvmtxq
, 
õì80211_txq
,

1551 
drv_¥iv
);

1552 
tid
 = 
txq
->tid;

1553 i‡(
tid
 =
IEEE80211_NUM_TIDS
)

1554 
tid
 = 
IWL_MAX_TID_COUNT
;

1562 i‡(
	`iwl_mvm_°a_Æloc_queue
(
mvm
, 
txq
->
°a
,Åxq->
ac
, 
tid
)) {

1563 
	`•ö_lock_bh
(&
mvm
->
add_°ªam_lock
);

1564 
	`li°_dñ_öô
(&
mvmtxq
->
li°
);

1565 
	`•ö_u∆ock_bh
(&
mvm
->
add_°ªam_lock
);

1572 
	`£t_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
);

1574 
	`loˇl_bh_dißbÀ
();

1575 
	`•ö_lock
(&
mvm
->
add_°ªam_lock
);

1576 
	`li°_dñ_öô
(&
mvmtxq
->
li°
);

1577 
	`•ö_u∆ock
(&
mvm
->
add_°ªam_lock
);

1579 
	`iwl_mvm_mac_ôxq_xmô
(
mvm
->
hw
, 
txq
);

1580 
	`loˇl_bh_íabÀ
();

1583 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1584 
	}
}

1586 
	$iwl_mvm_ª£rve_°a_°ªam
(
iwl_mvm
 *
mvm
,

1587 
õì80211_°a
 *
°a
,

1588 
∆80211_i·y≥
 
vif_ty≥
)

1590 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1591 
queue
;

1594 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

1598 
	`iwl_mvm_öa˘ivôy_check
(
mvm
, 
IWL_MVM_INVALID_STA
);

1601 i‡(
vif_ty≥
 =
NL80211_IFTYPE_STATION
 && !
°a
->
tdls
 &&

1602 !
mvm
->
queue_öfo
[
IWL_MVM_DQA_BSS_CLIENT_QUEUE
].
tid_bôm≠
 &&

1603 (
mvm
->
queue_öfo
[
IWL_MVM_DQA_BSS_CLIENT_QUEUE
].
°©us
 ==

1604 
IWL_MVM_QUEUE_FREE
))

1605 
queue
 = 
IWL_MVM_DQA_BSS_CLIENT_QUEUE
;

1607 
queue
 = 
	`iwl_mvm_föd_‰ì_queue
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
,

1608 
IWL_MVM_DQA_MIN_DATA_QUEUE
,

1609 
IWL_MVM_DQA_MAX_DATA_QUEUE
);

1610 i‡(
queue
 < 0) {

1612 
queue
 = 
	`iwl_mvm_öa˘ivôy_check
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
);

1613 i‡(
queue
 < 0) {

1614 
	`IWL_ERR
(
mvm
, "Noávailable queues forÇew station\n");

1615  -
ENOSPC
;

1618 
mvm
->
queue_öfo
[
queue
].
°©us
 = 
IWL_MVM_QUEUE_RESERVED
;

1620 
mvm°a
->
ª£rved_queue
 = 
queue
;

1622 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Reserving data queue #%d for sta_id %d\n",

1623 
queue
, 
mvm°a
->
deÊök
.
°a_id
);

1626 
	}
}

1635 
	$iwl_mvm_ªÆloc_queues_a·î_ª°¨t
(
iwl_mvm
 *
mvm
,

1636 
õì80211_°a
 *
°a
)

1638 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1639 
wdg
 =

1640 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
mvm_°a
->
vif
, 
Ál£
, false);

1641 
i
;

1642 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

1643 .
°a_id
 = 
mvm_°a
->
deÊök
.sta_id,

1644 .
‰ame_limô
 = 
IWL_FRAME_LIMIT
,

1648 i‡(
mvm_°a
->
ª£rved_queue
 !
IEEE80211_INVAL_HW_QUEUE
)

1649 
mvm
->
queue_öfo
[
mvm_°a
->
ª£rved_queue
].
°©us
 =

1650 
IWL_MVM_QUEUE_RESERVED
;

1652 
i
 = 0; i <
IWL_MAX_TID_COUNT
; i++) {

1653 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm_°a
->tid_d©a[
i
];

1654 
txq_id
 = 
tid_d©a
->txq_id;

1655 
ac
;

1657 i‡(
txq_id
 =
IWL_MVM_INVALID_QUEUE
)

1660 
ac
 = 
tid_to_mac80211_ac
[
i
];

1662 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

1663 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1665 
mvm_°a
->
deÊök
.
°a_id
, 
i
);

1666 
txq_id
 = 
	`iwl_mvm_tvqm_íabÀ_txq
(
mvm
, 
°a
,

1667 
mvm_°a
->
deÊök
.
°a_id
,

1668 
i
, 
wdg
);

1674 i‡(
txq_id
 < 0)

1675 
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

1676 
tid_d©a
->
txq_id
 =Åxq_id;

1684 
tid_d©a
->
£q_numbî
 = 0;

1686 
u16
 
£q
 = 
	`IEEE80211_SEQ_TO_SN
(
tid_d©a
->
£q_numbî
);

1688 
cfg
.
tid
 = 
i
;

1689 
cfg
.
fifo
 = 
	`iwl_mvm_mac_ac_to_tx_fifo
(
mvm
, 
ac
);

1690 
cfg
.
aggªg©e
 = (
txq_id
 >
IWL_MVM_DQA_MIN_DATA_QUEUE
 ||

1691 
txq_id
 ==

1692 
IWL_MVM_DQA_BSS_CLIENT_QUEUE
);

1694 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1696 
mvm_°a
->
deÊök
.
°a_id
, 
i
,

1697 
txq_id
);

1699 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
°a
, 
txq_id
, 
£q
, &
cfg
, 
wdg
);

1700 
mvm
->
queue_öfo
[
txq_id
].
°©us
 = 
IWL_MVM_QUEUE_READY
;

1703 
	}
}

1705 
	$iwl_mvm_add_öt_°a_comm⁄
(
iwl_mvm
 *
mvm
,

1706 
iwl_mvm_öt_°a
 *
°a
,

1707 c⁄° 
u8
 *
addr
,

1708 
u16
 
mac_id
, u16 
cﬁ‹
)

1710 
iwl_mvm_add_°a_cmd
 
cmd
;

1711 
ªt
;

1712 
u32
 
°©us
 = 
ADD_STA_SUCCESS
;

1714 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1716 
	`mem£t
(&
cmd
, 0, (cmd));

1717 
cmd
.
°a_id
 = 
°a
->sta_id;

1719 i‡(
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
) &&

1720 
°a
->
ty≥
 =
IWL_STA_AUX_ACTIVITY
)

1721 
cmd
.
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mac_id
);

1723 
cmd
.
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mac_id
,

1724 
cﬁ‹
));

1726 i‡(
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
))

1727 
cmd
.
°©i⁄_ty≥
 = 
°a
->
ty≥
;

1729 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1730 
cmd
.
tfd_queue_msk
 = 
	`˝u_to_À32
(
°a
->tfd_queue_msk);

1731 
cmd
.
tid_dißbÀ_tx
 = 
	`˝u_to_À16
(0xffff);

1733 i‡(
addr
)

1734 
	`mem˝y
(
cmd
.
addr
,áddr, 
ETH_ALEN
);

1736 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA
,

1737 
	`iwl_mvm_add_°a_cmd_size
(
mvm
),

1738 &
cmd
, &
°©us
);

1739 i‡(
ªt
)

1740  
ªt
;

1742 
°©us
 & 
IWL_ADD_STA_STATUS_MASK
) {

1743 
ADD_STA_SUCCESS
:

1744 
	`IWL_DEBUG_INFO
(
mvm
, "Internal stationádded.\n");

1747 
ªt
 = -
EIO
;

1748 
	`IWL_ERR
(
mvm
, "Add internal station failed, status=0x%x\n",

1749 
°©us
);

1752  
ªt
;

1753 
	}
}

1756 
	$iwl_mvm_°a_öô
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1757 
õì80211_°a
 *
°a
, 
°a_id
, 
u8
 
°a_ty≥
)

1759 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1760 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1761 
iwl_mvm_rxq_dup_d©a
 *
dup_d©a
;

1762 
i
, 
ªt
 = 0;

1764 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1766 
mvm_°a
->
mac_id_n_cﬁ‹
 = 
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
,

1767 
mvmvif
->
cﬁ‹
);

1768 
mvm_°a
->
vif
 = vif;

1773 i‡(!
mvm
->
mld_≠i_is_u£d
) {

1774 i‡(
	`WARN_ON
(
°a_id
 =
IWL_MVM_INVALID_STA
))

1775  -
EINVAL
;

1777 
mvm_°a
->
deÊök
.
°a_id
 = sta_id;

1778 
	`rcu_assign_poöãr
(
mvm_°a
->
lök
[0], &mvm_°a->
deÊök
);

1780 i‡(!
mvm
->
å™s
->
å™s_cfg
->
gí2
)

1781 
mvm_°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
max_agg_bufsize
 =

1782 
LINK_QUAL_AGG_FRAME_LIMIT_DEF
;

1784 
mvm_°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
max_agg_bufsize
 =

1785 
LINK_QUAL_AGG_FRAME_LIMIT_GEN2_DEF
;

1788 
mvm_°a
->
â_tx_¥Ÿe˘i⁄
 = 
Ál£
;

1789 
mvm_°a
->
°a_ty≥
 = sta_type;

1791 
mvm_°a
->
tid_dißbÀ_agg
 = 0xffff;

1793 
i
 = 0; i <
IWL_MAX_TID_COUNT
; i++) {

1798 
mvm_°a
->
tid_d©a
[
i
].
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

1801 
i
 = 0; i < 
	`ARRAY_SIZE
(
°a
->
txq
); i++) {

1802 
iwl_mvm_txq
 *
mvmtxq
 =

1803 
	`iwl_mvm_txq_‰om_mac80211
(
°a
->
txq
[
i
]);

1805 
mvmtxq
->
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

1806 
	`INIT_LIST_HEAD
(&
mvmtxq
->
li°
);

1807 
	`©omic_£t
(&
mvmtxq
->
tx_ªque°
, 0);

1810 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

1811 
q
;

1813 
dup_d©a
 = 
	`kˇŒoc
(
mvm
->
å™s
->
num_rx_queues
,

1814 (*
dup_d©a
), 
GFP_KERNEL
);

1815 i‡(!
dup_d©a
)

1816  -
ENOMEM
;

1826 
q
 = 0; q < 
mvm
->
å™s
->
num_rx_queues
; q++)

1827 
	`mem£t
(
dup_d©a
[
q
].
œ°_£q
, 0xff,

1828 (
dup_d©a
[
q
].
œ°_£q
));

1829 
mvm_°a
->
dup_d©a
 = dup_data;

1832 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

1833 
ªt
 = 
	`iwl_mvm_ª£rve_°a_°ªam
(
mvm
, 
°a
,

1834 
	`õì80211_vif_ty≥_p2p
(
vif
));

1835 i‡(
ªt
)

1836  
ªt
;

1843 i‡(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
))

1844 
	`iwl_mvm_rs_add_°a
(
mvm
, 
mvm_°a
);

1846 
	`•ö_lock_öô
(&
mvm_°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
lock
);

1848 
	`iwl_mvm_toggÀ_tx_™t
(
mvm
, &
mvm_°a
->
tx_™t
);

1851 
	}
}

1853 
	$iwl_mvm_add_°a
(
iwl_mvm
 *
mvm
,

1854 
õì80211_vif
 *
vif
,

1855 
õì80211_°a
 *
°a
)

1857 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1858 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1859 
ªt
, 
°a_id
;

1860 
boﬁ
 
°a_upd©e
 = 
Ál£
;

1861 
°a_Êags
 = 0;

1863 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1865 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

1866 
°a_id
 = 
	`iwl_mvm_föd_‰ì_°a_id
(
mvm
,

1867 
	`õì80211_vif_ty≥_p2p
(
vif
));

1869 
°a_id
 = 
mvm_°a
->
deÊök
.sta_id;

1871 i‡(
°a_id
 =
IWL_MVM_INVALID_STA
)

1872  -
ENOSPC
;

1874 
	`•ö_lock_öô
(&
mvm_°a
->
lock
);

1877 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

1878 
iwl_mvm_öt_°a
 
tmp_°a
 = {

1879 .
°a_id
 = sta_id,

1880 .
ty≥
 = 
mvm_°a
->
°a_ty≥
,

1886 
ªt
 = 
	`iwl_mvm_add_öt_°a_comm⁄
(
mvm
, &
tmp_°a
, 
°a
->
addr
,

1887 
mvmvif
->
id
, mvmvif->
cﬁ‹
);

1888 i‡(
ªt
)

1889 
îr
;

1891 
	`iwl_mvm_ªÆloc_queues_a·î_ª°¨t
(
mvm
, 
°a
);

1892 
°a_upd©e
 = 
åue
;

1893 
°a_Êags
 = 
	`iwl_mvm_has_√w_tx_≠i
(
mvm
Ë? 0 : 
STA_MODIFY_QUEUES
;

1894 
upd©e_fw
;

1897 
ªt
 = 
	`iwl_mvm_°a_öô
(
mvm
, 
vif
, 
°a
, 
°a_id
,

1898 
°a
->
tdls
 ? 
IWL_STA_TDLS_LINK
 : 
IWL_STA_LINK
);

1899 i‡(
ªt
)

1900 
îr
;

1902 
upd©e_fw
:

1903 
ªt
 = 
	`iwl_mvm_°a_£nd_to_fw
(
mvm
, 
°a
, 
°a_upd©e
, 
°a_Êags
);

1904 i‡(
ªt
)

1905 
îr
;

1907 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
) {

1908 i‡(!
°a
->
tdls
) {

1909 
	`WARN_ON
(
mvmvif
->
deÊök
.
≠_°a_id
 !
IWL_MVM_INVALID_STA
);

1910 
mvmvif
->
deÊök
.
≠_°a_id
 = 
°a_id
;

1912 
	`WARN_ON
(
mvmvif
->
deÊök
.
≠_°a_id
 =
IWL_MVM_INVALID_STA
);

1916 
	`rcu_assign_poöãr
(
mvm
->
fw_id_to_mac_id
[
°a_id
], 
°a
);

1920 
îr
:

1921  
ªt
;

1922 
	}
}

1924 
	$iwl_mvm_døö_°a
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

1925 
boﬁ
 
døö
)

1927 
iwl_mvm_add_°a_cmd
 
cmd
 = {};

1928 
ªt
;

1929 
u32
 
°©us
;

1931 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1933 
cmd
.
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm°a
->mac_id_n_color);

1934 
cmd
.
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

1935 
cmd
.
add_modify
 = 
STA_MODE_MODIFY
;

1936 
cmd
.
°©i⁄_Êags
 = 
døö
 ? 
	`˝u_to_À32
(
STA_FLG_DRAIN_FLOW
) : 0;

1937 
cmd
.
°©i⁄_Êags_msk
 = 
	`˝u_to_À32
(
STA_FLG_DRAIN_FLOW
);

1939 
°©us
 = 
ADD_STA_SUCCESS
;

1940 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA
,

1941 
	`iwl_mvm_add_°a_cmd_size
(
mvm
),

1942 &
cmd
, &
°©us
);

1943 i‡(
ªt
)

1944  
ªt
;

1946 
°©us
 & 
IWL_ADD_STA_STATUS_MASK
) {

1947 
ADD_STA_SUCCESS
:

1948 
	`IWL_DEBUG_INFO
(
mvm
, "Frames for staid %d will drained in fw\n",

1949 
mvm°a
->
deÊök
.
°a_id
);

1952 
ªt
 = -
EIO
;

1953 
	`IWL_ERR
(
mvm
, "Couldn't drain frames for staid %d\n",

1954 
mvm°a
->
deÊök
.
°a_id
);

1958  
ªt
;

1959 
	}
}

1966 
	$iwl_mvm_rm_°a_comm⁄
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
)

1968 
õì80211_°a
 *
°a
;

1969 
iwl_mvm_rm_°a_cmd
 
rm_°a_cmd
 = {

1970 .
°a_id
 = sta_id,

1972 
ªt
;

1974 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

1975 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

1978 i‡(!
°a
) {

1979 
	`IWL_ERR
(
mvm
, "Invalid station id\n");

1980  -
EINVAL
;

1983 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
REMOVE_STA
, 0,

1984 (
rm_°a_cmd
), &rm_sta_cmd);

1985 i‡(
ªt
) {

1986 
	`IWL_ERR
(
mvm
, "FaûedÅÿªmovê°©i⁄. Id=%d\n", 
°a_id
);

1987  
ªt
;

1991 
	}
}

1993 
	$iwl_mvm_dißbÀ_°a_queues
(
iwl_mvm
 *
mvm
,

1994 
õì80211_vif
 *
vif
,

1995 
õì80211_°a
 *
°a
)

1997 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1998 
i
;

2000 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2002 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvm_°a
->
tid_d©a
); i++) {

2003 i‡(
mvm_°a
->
tid_d©a
[
i
].
txq_id
 =
IWL_MVM_INVALID_QUEUE
)

2006 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
°a
, 
mvm_°a
->
deÊök
.
°a_id
,

2007 &
mvm_°a
->
tid_d©a
[
i
].
txq_id
, i);

2008 
mvm_°a
->
tid_d©a
[
i
].
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

2011 
i
 = 0; i < 
	`ARRAY_SIZE
(
°a
->
txq
); i++) {

2012 
iwl_mvm_txq
 *
mvmtxq
 =

2013 
	`iwl_mvm_txq_‰om_mac80211
(
°a
->
txq
[
i
]);

2015 
	`•ö_lock_bh
(&
mvm
->
add_°ªam_lock
);

2016 
mvmtxq
->
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

2017 
	`li°_dñ_öô
(&
mvmtxq
->
li°
);

2018 
	`˛ór_bô
(
IWL_MVM_TXQ_STATE_READY
, &
mvmtxq
->
°©e
);

2019 
	`•ö_u∆ock_bh
(&
mvm
->
add_°ªam_lock
);

2021 
	}
}

2023 
	$iwl_mvm_waô_°a_queues_em±y
(
iwl_mvm
 *
mvm
,

2024 
iwl_mvm_°a
 *
mvm_°a
)

2026 
i
;

2028 
i
 = 0; i < 
	`ARRAY_SIZE
(
mvm_°a
->
tid_d©a
); i++) {

2029 
u16
 
txq_id
;

2030 
ªt
;

2032 
	`•ö_lock_bh
(&
mvm_°a
->
lock
);

2033 
txq_id
 = 
mvm_°a
->
tid_d©a
[
i
].txq_id;

2034 
	`•ö_u∆ock_bh
(&
mvm_°a
->
lock
);

2036 i‡(
txq_id
 =
IWL_MVM_INVALID_QUEUE
)

2039 
ªt
 = 
	`iwl_å™s_waô_txq_em±y
(
mvm
->
å™s
, 
txq_id
);

2040 i‡(
ªt
)

2041  
ªt
;

2045 
	}
}

2051 
boﬁ
 
	$iwl_mvm_°a_dñ
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

2052 
õì80211_°a
 *
°a
,

2053 
õì80211_lök_°a
 *
lök_°a
, *
ªt
)

2055 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2056 
iwl_mvm_vif_lök_öfo
 *
mvm_lök
 =

2057 
mvmvif
->
lök
[
lök_°a
->
lök_id
];

2058 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2059 
iwl_mvm_lök_°a
 *
mvm_lök_°a
;

2060 
u8
 
°a_id
;

2062 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2064 
mvm_lök_°a
 =

2065 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm_°a
->
lök
[
lök_°a
->
lök_id
],

2066 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

2067 
°a_id
 = 
mvm_lök_°a
->sta_id;

2070 i‡(
mvm_°a
->
ª£rved_queue
 !
IEEE80211_INVAL_HW_QUEUE
) {

2071 
u8
 
ª£rved_txq
 = 
mvm_°a
->
ª£rved_queue
;

2072 
iwl_mvm_queue_°©us
 *
°©us
;

2079 
°©us
 = &
mvm
->
queue_öfo
[
ª£rved_txq
].status;

2080 i‡(
	`WARN
((*
°©us
 !
IWL_MVM_QUEUE_RESERVED
) &&

2081 (*
°©us
 !
IWL_MVM_QUEUE_FREE
),

2083 
°a_id
, 
ª£rved_txq
, *
°©us
)) {

2084 *
ªt
 = -
EINVAL
;

2085  
åue
;

2088 *
°©us
 = 
IWL_MVM_QUEUE_FREE
;

2091 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

2092 
mvm_lök
->
≠_°a_id
 =
°a_id
) {

2094 i‡(
vif
->
cfg
.
assoc
)

2095  
åue
;

2098 
	`iwl_mvm_£c_key_ªmove_≠
(
mvm
, 
vif
, 
mvm_lök
, 0);

2101 
mvm_lök
->
≠_°a_id
 = 
IWL_MVM_INVALID_STA
;

2108 i‡(
	`WARN_ON_ONCE
(
mvm
->
tdls_cs
.
≥î
.
°a_id
 == sta_id)) {

2109 
mvm
->
tdls_cs
.
≥î
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

2110 
	`ˇn˚l_dñayed_w‹k
(&
mvm
->
tdls_cs
.
dw‹k
);

2113  
Ál£
;

2114 
	}
}

2116 
	$iwl_mvm_rm_°a
(
iwl_mvm
 *
mvm
,

2117 
õì80211_vif
 *
vif
,

2118 
õì80211_°a
 *
°a
)

2120 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2121 
ªt
;

2123 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2125 
ªt
 = 
	`iwl_mvm_døö_°a
(
mvm
, 
mvm_°a
, 
åue
);

2126 i‡(
ªt
)

2127  
ªt
;

2130 
ªt
 = 
	`iwl_mvm_Êush_°a
(
mvm
, 
mvm_°a
->
deÊök
.
°a_id
,

2131 
mvm_°a
->
tfd_queue_msk
);

2132 i‡(
ªt
)

2133  
ªt
;

2134 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

2135 
ªt
 = 
	`iwl_mvm_waô_°a_queues_em±y
(
mvm
, 
mvm_°a
);

2137 
u32
 
q_mask
 = 
mvm_°a
->
tfd_queue_msk
;

2139 
ªt
 = 
	`iwl_å™s_waô_tx_queues_em±y
(
mvm
->
å™s
,

2140 
q_mask
);

2142 i‡(
ªt
)

2143  
ªt
;

2145 
ªt
 = 
	`iwl_mvm_døö_°a
(
mvm
, 
mvm_°a
, 
Ál£
);

2147 
	`iwl_mvm_dißbÀ_°a_queues
(
mvm
, 
vif
, 
°a
);

2149 i‡(
	`iwl_mvm_°a_dñ
(
mvm
, 
vif
, 
°a
, &°a->
deÊök
, &
ªt
))

2150  
ªt
;

2152 
ªt
 = 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, 
mvm_°a
->
deÊök
.
°a_id
);

2153 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
mvm_°a
->
deÊök
.
°a_id
], 
NULL
);

2155  
ªt
;

2156 
	}
}

2158 
	$iwl_mvm_rm_°a_id
(
iwl_mvm
 *
mvm
,

2159 
õì80211_vif
 *
vif
,

2160 
u8
 
°a_id
)

2162 
ªt
 = 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, 
°a_id
);

2164 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2166 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
°a_id
], 
NULL
);

2167  
ªt
;

2168 
	}
}

2170 
	$iwl_mvm_Æloˇã_öt_°a
(
iwl_mvm
 *
mvm
,

2171 
iwl_mvm_öt_°a
 *
°a
,

2172 
u32
 
qmask
, 
∆80211_i·y≥
 
i·y≥
,

2173 
u8
 
ty≥
)

2175 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
) ||

2176 
°a
->
°a_id
 =
IWL_MVM_INVALID_STA
) {

2177 
°a
->
°a_id
 = 
	`iwl_mvm_föd_‰ì_°a_id
(
mvm
, 
i·y≥
);

2178 i‡(
	`WARN_ON_ONCE
(
°a
->
°a_id
 =
IWL_MVM_INVALID_STA
))

2179  -
ENOSPC
;

2182 
°a
->
tfd_queue_msk
 = 
qmask
;

2183 
°a
->
ty≥
 =Åype;

2186 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
°a
->
°a_id
], 
	`ERR_PTR
(-
EINVAL
));

2188 
	}
}

2190 
	$iwl_mvm_dóŒoc_öt_°a
(
iwl_mvm
 *
mvm
, 
iwl_mvm_öt_°a
 *
°a
)

2192 
	`RCU_INIT_POINTER
(
mvm
->
fw_id_to_mac_id
[
°a
->
°a_id
], 
NULL
);

2193 
	`mem£t
(
°a
, 0, (
iwl_mvm_öt_°a
));

2194 
°a
->
°a_id
 = 
IWL_MVM_INVALID_STA
;

2195 
	}
}

2197 
	$iwl_mvm_íabÀ_aux_¢if_queue
(
iwl_mvm
 *
mvm
, 
u16
 
queue
,

2198 
u8
 
°a_id
, u8 
fifo
)

2200 
wdg_timeout
 =

2201 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
wd_timeout
;

2202 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

2203 .
fifo
 = fifo,

2204 .
°a_id
 = sta_id,

2205 .
tid
 = 
IWL_MAX_TID_COUNT
,

2206 .
aggªg©e
 = 
Ál£
,

2207 .
‰ame_limô
 = 
IWL_FRAME_LIMIT
,

2210 
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
));

2212 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
NULL
, 
queue
, 0, &
cfg
, 
wdg_timeout
);

2213 
	}
}

2215 
	$iwl_mvm_íabÀ_aux_¢if_queue_tvqm
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
)

2217 
wdg_timeout
 =

2218 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
wd_timeout
;

2220 
	`WARN_ON
(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
));

2222  
	`iwl_mvm_tvqm_íabÀ_txq
(
mvm
, 
NULL
, 
°a_id
, 
IWL_MAX_TID_COUNT
,

2223 
wdg_timeout
);

2224 
	}
}

2226 
	$iwl_mvm_add_öt_°a_wôh_queue
(
iwl_mvm
 *
mvm
, 
macidx
,

2227 
maccﬁ‹
, 
u8
 *
addr
,

2228 
iwl_mvm_öt_°a
 *
°a
,

2229 
u16
 *
queue
, 
fifo
)

2231 
ªt
;

2234 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

2235 
	`iwl_mvm_íabÀ_aux_¢if_queue
(
mvm
, *
queue
, 
°a
->
°a_id
, 
fifo
);

2237 
ªt
 = 
	`iwl_mvm_add_öt_°a_comm⁄
(
mvm
, 
°a
, 
addr
, 
macidx
, 
maccﬁ‹
);

2238 i‡(
ªt
) {

2239 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

2240 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
NULL
, 
°a
->
°a_id
, 
queue
,

2241 
IWL_MAX_TID_COUNT
);

2242  
ªt
;

2249 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

2250 
txq
;

2252 
txq
 = 
	`iwl_mvm_íabÀ_aux_¢if_queue_tvqm
(
mvm
, 
°a
->
°a_id
);

2253 i‡(
txq
 < 0) {

2254 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, 
°a
->
°a_id
);

2255  
txq
;

2258 *
queue
 = 
txq
;

2262 
	}
}

2264 
	$iwl_mvm_add_aux_°a
(
iwl_mvm
 *
mvm
, 
u32
 
lmac_id
)

2266 
ªt
;

2267 
u32
 
qmask
 = 
mvm
->
aux_queue
 =
IWL_MVM_INVALID_QUEUE
 ? 0 :

2268 
	`BIT
(
mvm
->
aux_queue
);

2270 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2273 
ªt
 = 
	`iwl_mvm_Æloˇã_öt_°a
(
mvm
, &mvm->
aux_°a
, 
qmask
,

2274 
NL80211_IFTYPE_UNSPECIFIED
,

2275 
IWL_STA_AUX_ACTIVITY
);

2276 i‡(
ªt
)

2277  
ªt
;

2283 
ªt
 = 
	`iwl_mvm_add_öt_°a_wôh_queue
(
mvm
, 
lmac_id
, 0, 
NULL
,

2284 &
mvm
->
aux_°a
, &mvm->
aux_queue
,

2285 
IWL_MVM_TX_FIFO_MCAST
);

2286 i‡(
ªt
) {

2287 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, &mvm->
aux_°a
);

2288  
ªt
;

2292 
	}
}

2294 
	$iwl_mvm_add_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2296 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2298 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2300  
	`iwl_mvm_add_öt_°a_wôh_queue
(
mvm
, 
mvmvif
->
id
, mvmvif->
cﬁ‹
,

2301 
NULL
, &
mvm
->
¢if_°a
,

2302 &
mvm
->
¢if_queue
,

2303 
IWL_MVM_TX_FIFO_BE
);

2304 
	}
}

2306 
	$iwl_mvm_rm_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2308 
ªt
;

2310 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2312 i‡(
	`WARN_ON_ONCE
(
mvm
->
¢if_°a
.
°a_id
 =
IWL_MVM_INVALID_STA
))

2313  -
EINVAL
;

2315 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
NULL
, mvm->
¢if_°a
.
°a_id
,

2316 &
mvm
->
¢if_queue
, 
IWL_MAX_TID_COUNT
);

2317 
ªt
 = 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, mvm->
¢if_°a
.
°a_id
);

2318 i‡(
ªt
)

2319 
	`IWL_WARN
(
mvm
, "Failed sendingÑemove station\n");

2321  
ªt
;

2322 
	}
}

2324 
	$iwl_mvm_rm_aux_°a
(
iwl_mvm
 *
mvm
)

2326 
ªt
;

2328 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2330 i‡(
	`WARN_ON_ONCE
(
mvm
->
aux_°a
.
°a_id
 =
IWL_MVM_INVALID_STA
))

2331  -
EINVAL
;

2333 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
NULL
, mvm->
aux_°a
.
°a_id
,

2334 &
mvm
->
aux_queue
, 
IWL_MAX_TID_COUNT
);

2335 
ªt
 = 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, mvm->
aux_°a
.
°a_id
);

2336 i‡(
ªt
)

2337 
	`IWL_WARN
(
mvm
, "Failed sendingÑemove station\n");

2338 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, &mvm->
aux_°a
);

2340  
ªt
;

2341 
	}
}

2343 
	$iwl_mvm_dóŒoc_¢if_°a
(
iwl_mvm
 *
mvm
)

2345 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, &mvm->
¢if_°a
);

2346 
	}
}

2356 
	$iwl_mvm_£nd_add_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2358 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2359 
iwl_mvm_öt_°a
 *
b°a
 = &
mvmvif
->
deÊök
.
bˇ°_°a
;

2360 c⁄° 
u8
 
_baddr
[] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

2361 c⁄° 
u8
 *
baddr
 = 
_baddr
;

2362 
queue
;

2363 
ªt
;

2364 
wdg_timeout
 =

2365 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
vif
, 
Ál£
, false);

2366 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

2367 .
fifo
 = 
IWL_MVM_TX_FIFO_VO
,

2368 .
°a_id
 = 
mvmvif
->
deÊök
.
bˇ°_°a
.sta_id,

2369 .
tid
 = 
IWL_MAX_TID_COUNT
,

2370 .
aggªg©e
 = 
Ál£
,

2371 .
‰ame_limô
 = 
IWL_FRAME_LIMIT
,

2374 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2376 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

2377 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

2378 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

2379 
queue
 = 
mvm
->
¥obe_queue
;

2380 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

2381 
queue
 = 
mvm
->
p2p_dev_queue
;

2383 
	`WARN
(1, "MissingÑequired TXQ forádding bcast STA\n");

2384  -
EINVAL
;

2387 
b°a
->
tfd_queue_msk
 |
	`BIT
(
queue
);

2389 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
NULL
, 
queue
, 0, &
cfg
, 
wdg_timeout
);

2392 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
)

2393 
baddr
 = 
vif
->
bss_c⁄f
.
bssid
;

2395 i‡(
	`WARN_ON_ONCE
(
b°a
->
°a_id
 =
IWL_MVM_INVALID_STA
))

2396  -
ENOSPC
;

2398 
ªt
 = 
	`iwl_mvm_add_öt_°a_comm⁄
(
mvm
, 
b°a
, 
baddr
,

2399 
mvmvif
->
id
, mvmvif->
cﬁ‹
);

2400 i‡(
ªt
)

2401  
ªt
;

2407 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

2408 
queue
 = 
	`iwl_mvm_tvqm_íabÀ_txq
(
mvm
, 
NULL
, 
b°a
->
°a_id
,

2409 
IWL_MAX_TID_COUNT
,

2410 
wdg_timeout
);

2411 i‡(
queue
 < 0) {

2412 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, 
b°a
->
°a_id
);

2413  
queue
;

2416 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

2417 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

2419 
mvm
->
¥obe_queue
 = 
queue
;

2421 
mvmvif
->
deÊök
.
mgmt_queue
 = 
queue
;

2422 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

2423 
mvm
->
p2p_dev_queue
 = 
queue
;

2425 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

2426 
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

2428 
mvmvif
->
deÊök
.
mgmt_queue
 = 
mvm
->
¥obe_queue
;

2432 
	}
}

2434 
	$iwl_mvm_‰ì_bˇ°_°a_queues
(
iwl_mvm
 *
mvm
,

2435 
õì80211_vif
 *
vif
)

2437 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2438 
u16
 *
queuïå
, 
queue
;

2440 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2442 
	`iwl_mvm_Êush_°a
(
mvm
, 
mvmvif
->
deÊök
.
bˇ°_°a
.
°a_id
,

2443 
mvmvif
->
deÊök
.
bˇ°_°a
.
tfd_queue_msk
);

2445 
vif
->
ty≥
) {

2446 
NL80211_IFTYPE_AP
:

2447 
NL80211_IFTYPE_ADHOC
:

2448 
queuïå
 = &
mvm
->
¥obe_queue
;

2450 
NL80211_IFTYPE_P2P_DEVICE
:

2451 
queuïå
 = &
mvm
->
p2p_dev_queue
;

2454 
	`WARN
(1, "Can't free bcast queue on vifÅype %d\n",

2455 
vif
->
ty≥
);

2459 
queue
 = *
queuïå
;

2460 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
NULL
, 
mvmvif
->
deÊök
.
bˇ°_°a
.
°a_id
,

2461 
queuïå
, 
IWL_MAX_TID_COUNT
);

2463 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 || vif->ty≥ =
NL80211_IFTYPE_ADHOC
)

2464 
mvmvif
->
deÊök
.
mgmt_queue
 = 
mvm
->
¥obe_queue
;

2466 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

2469 
	`WARN_ON
(!(
mvmvif
->
deÊök
.
bˇ°_°a
.
tfd_queue_msk
 & 
	`BIT
(
queue
)));

2470 
mvmvif
->
deÊök
.
bˇ°_°a
.
tfd_queue_msk
 &~
	`BIT
(
queue
);

2471 
	}
}

2475 
	$iwl_mvm_£nd_rm_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2477 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2478 
ªt
;

2480 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2482 
	`iwl_mvm_‰ì_bˇ°_°a_queues
(
mvm
, 
vif
);

2484 
ªt
 = 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, 
mvmvif
->
deÊök
.
bˇ°_°a
.
°a_id
);

2485 i‡(
ªt
)

2486 
	`IWL_WARN
(
mvm
, "Failed sendingÑemove station\n");

2487  
ªt
;

2488 
	}
}

2490 
	$iwl_mvm_Æloc_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2492 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2494 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2496  
	`iwl_mvm_Æloˇã_öt_°a
(
mvm
, &
mvmvif
->
deÊök
.
bˇ°_°a
, 0,

2497 
	`õì80211_vif_ty≥_p2p
(
vif
),

2498 
IWL_STA_GENERAL_PURPOSE
);

2499 
	}
}

2508 
	$iwl_mvm_add_p2p_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2510 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2511 
iwl_mvm_öt_°a
 *
b°a
 = &
mvmvif
->
deÊök
.
bˇ°_°a
;

2512 
ªt
;

2514 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2516 
ªt
 = 
	`iwl_mvm_Æloc_bˇ°_°a
(
mvm
, 
vif
);

2517 i‡(
ªt
)

2518  
ªt
;

2520 
ªt
 = 
	`iwl_mvm_£nd_add_bˇ°_°a
(
mvm
, 
vif
);

2522 i‡(
ªt
)

2523 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, 
b°a
);

2525  
ªt
;

2526 
	}
}

2528 
	$iwl_mvm_dóŒoc_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2530 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2532 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, &
mvmvif
->
deÊök
.
bˇ°_°a
);

2533 
	}
}

2539 
	$iwl_mvm_rm_p2p_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2541 
ªt
;

2543 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2545 
ªt
 = 
	`iwl_mvm_£nd_rm_bˇ°_°a
(
mvm
, 
vif
);

2547 
	`iwl_mvm_dóŒoc_bˇ°_°a
(
mvm
, 
vif
);

2549  
ªt
;

2550 
	}
}

2560 
	$iwl_mvm_add_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2562 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2563 
iwl_mvm_öt_°a
 *
m°a
 = &
mvmvif
->
deÊök
.
mˇ°_°a
;

2564 c⁄° 
u8
 
_maddr
[] = {0x03, 0x00, 0x00, 0x00, 0x00, 0x00};

2565 c⁄° 
u8
 *
maddr
 = 
_maddr
;

2566 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

2567 .
fifo
 = 
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ?

2568 
IWL_MVM_TX_FIFO_MCAST
 : 
IWL_MVM_TX_FIFO_BE
,

2569 .
°a_id
 = 
m°a
->sta_id,

2570 .
tid
 = 0,

2571 .
aggªg©e
 = 
Ál£
,

2572 .
‰ame_limô
 = 
IWL_FRAME_LIMIT
,

2574 
timeout
 = 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
vif
, 
Ál£
, false);

2575 
ªt
;

2577 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2579 i‡(
	`WARN_ON
(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 &&

2580 
vif
->
ty≥
 !
NL80211_IFTYPE_ADHOC
))

2581  -
EOPNOTSUPP
;

2589 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
)

2590 
mvmvif
->
deÊök
.
ˇb_queue
 = 
IWL_MVM_DQA_GCAST_QUEUE
;

2596 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
) &&

2597 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
)) {

2598 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
NULL
, 
mvmvif
->
deÊök
.
ˇb_queue
, 0,

2599 &
cfg
,

2600 
timeout
);

2601 
m°a
->
tfd_queue_msk
 |
	`BIT
(
mvmvif
->
deÊök
.
ˇb_queue
);

2603 
ªt
 = 
	`iwl_mvm_add_öt_°a_comm⁄
(
mvm
, 
m°a
, 
maddr
,

2604 
mvmvif
->
id
, mvmvif->
cﬁ‹
);

2605 i‡(
ªt
)

2606 
îr
;

2615 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

2616 
queue
 = 
	`iwl_mvm_tvqm_íabÀ_txq
(
mvm
, 
NULL
, 
m°a
->
°a_id
,

2617 0, 
timeout
);

2618 i‡(
queue
 < 0) {

2619 
ªt
 = 
queue
;

2620 
îr
;

2622 
mvmvif
->
deÊök
.
ˇb_queue
 = 
queue
;

2623 } i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

2624 
IWL_UCODE_TLV_API_STA_TYPE
))

2625 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
NULL
, 
mvmvif
->
deÊök
.
ˇb_queue
, 0,

2626 &
cfg
,

2627 
timeout
);

2630 
îr
:

2631 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, 
m°a
);

2632  
ªt
;

2633 
	}
}

2635 
	$__iwl_mvm_ªmove_°a_key
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
,

2636 
õì80211_key_c⁄f
 *
keyc⁄f
,

2637 
boﬁ
 
mˇ°
)

2640 
iwl_mvm_add_°a_key_cmd_v1
 
cmd_v1
;

2641 
iwl_mvm_add_°a_key_cmd
 
cmd
;

2642 } 
u
 = {};

2643 
boﬁ
 
√w_≠i
 = 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

2644 
IWL_UCODE_TLV_API_TKIP_MIC_KEYS
);

2645 
__À16
 
key_Êags
;

2646 
ªt
, 
size
;

2647 
u32
 
°©us
;

2650 i‡(
°a_id
 =
IWL_MVM_INVALID_STA
)

2653 
key_Êags
 = 
	`˝u_to_À16
((
keyc⁄f
->
keyidx
 << 
STA_KEY_FLG_KEYID_POS
) &

2654 
STA_KEY_FLG_KEYID_MSK
);

2655 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_NO_ENC
 | 
STA_KEY_FLG_WEP_KEY_MAP
);

2656 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_NOT_VALID
);

2658 i‡(
mˇ°
)

2659 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_MULTICAST
);

2665 
u
.
cmd
.
comm⁄
.
key_Êags
 = key_flags;

2666 
u
.
cmd
.
comm⁄
.
key_off£t
 = 
keyc⁄f
->
hw_key_idx
;

2667 
u
.
cmd
.
comm⁄
.
°a_id
 = sta_id;

2669 
size
 = 
√w_≠i
 ? (
u
.
cmd
Ë: (u.
cmd_v1
);

2671 
°©us
 = 
ADD_STA_SUCCESS
;

2672 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA_KEY
, 
size
, &
u
.
cmd
,

2673 &
°©us
);

2675 
°©us
) {

2676 
ADD_STA_SUCCESS
:

2677 
	`IWL_DEBUG_WEP
(
mvm
, "MODIFY_STA:Ñemove sta keyÖassed\n");

2680 
ªt
 = -
EIO
;

2681 
	`IWL_ERR
(
mvm
, "MODIFY_STA:Ñemove sta key failed\n");

2685  
ªt
;

2686 
	}
}

2692 
	$iwl_mvm_rm_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

2694 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

2695 
ªt
;

2697 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2699 
	`iwl_mvm_Êush_°a
(
mvm
, 
mvmvif
->
deÊök
.
mˇ°_°a
.
°a_id
,

2700 
mvmvif
->
deÊök
.
mˇ°_°a
.
tfd_queue_msk
);

2702 
	`iwl_mvm_dißbÀ_txq
(
mvm
, 
NULL
, 
mvmvif
->
deÊök
.
mˇ°_°a
.
°a_id
,

2703 &
mvmvif
->
deÊök
.
ˇb_queue
, 0);

2705 
ªt
 = 
	`iwl_mvm_rm_°a_comm⁄
(
mvm
, 
mvmvif
->
deÊök
.
mˇ°_°a
.
°a_id
);

2706 i‡(
ªt
)

2707 
	`IWL_WARN
(
mvm
, "Failed sendingÑemove station\n");

2709  
ªt
;

2710 
	}
}

2712 
	$iwl_mvm_sync_rxq_dñ_ba
(
iwl_mvm
 *
mvm
, 
u8
 
baid
)

2714 
iwl_mvm_dñba_d©a
 
nŸif
 = {

2715 .
baid
 = baid,

2718 
	`iwl_mvm_sync_rx_queues_öã∫Æ
(
mvm
, 
IWL_MVM_RXQ_NOTIF_DEL_BA
, 
åue
,

2719 &
nŸif
, (notif));

2720 
	}
};

2722 
	$iwl_mvm_‰ì_ª‹dî
(
iwl_mvm
 *
mvm
,

2723 
iwl_mvm_baid_d©a
 *
d©a
)

2725 
i
;

2727 
	`iwl_mvm_sync_rxq_dñ_ba
(
mvm
, 
d©a
->
baid
);

2729 
i
 = 0; i < 
mvm
->
å™s
->
num_rx_queues
; i++) {

2730 
j
;

2731 
iwl_mvm_ª‹dî_buf„r
 *
ª‹dî_buf
 =

2732 &
d©a
->
ª‹dî_buf
[
i
];

2733 
iwl_mvm_ª‹dî_buf_íåy
 *
íåõs
 =

2734 &
d©a
->
íåõs
[
i
 * d©a->
íåõs_≥r_queue
];

2736 
	`•ö_lock_bh
(&
ª‹dî_buf
->
lock
);

2737 i‡(
	`likñy
(!
ª‹dî_buf
->
num_°‹ed
)) {

2738 
	`•ö_u∆ock_bh
(&
ª‹dî_buf
->
lock
);

2747 
	`WARN_ON
(1);

2749 
j
 = 0; j < 
ª‹dî_buf
->
buf_size
; j++)

2750 
	`__skb_queue_purge
(&
íåõs
[
j
].
‰ames
);

2752 
	`•ö_u∆ock_bh
(&
ª‹dî_buf
->
lock
);

2754 
	}
}

2756 
	$iwl_mvm_öô_ª‹dî_buf„r
(
iwl_mvm
 *
mvm
,

2757 
iwl_mvm_baid_d©a
 *
d©a
,

2758 
u16
 
s¢
, u16 
buf_size
)

2760 
i
;

2762 
i
 = 0; i < 
mvm
->
å™s
->
num_rx_queues
; i++) {

2763 
iwl_mvm_ª‹dî_buf„r
 *
ª‹dî_buf
 =

2764 &
d©a
->
ª‹dî_buf
[
i
];

2765 
iwl_mvm_ª‹dî_buf_íåy
 *
íåõs
 =

2766 &
d©a
->
íåõs
[
i
 * d©a->
íåõs_≥r_queue
];

2767 
j
;

2769 
ª‹dî_buf
->
num_°‹ed
 = 0;

2770 
ª‹dî_buf
->
hód_¢
 = 
s¢
;

2771 
ª‹dî_buf
->
buf_size
 = buf_size;

2772 
	`•ö_lock_öô
(&
ª‹dî_buf
->
lock
);

2773 
ª‹dî_buf
->
mvm
 = mvm;

2774 
ª‹dî_buf
->
queue
 = 
i
;

2775 
ª‹dî_buf
->
vÆid
 = 
Ál£
;

2776 
j
 = 0; j < 
ª‹dî_buf
->
buf_size
; j++)

2777 
	`__skb_queue_hód_öô
(&
íåõs
[
j
].
‰ames
);

2779 
	}
}

2781 
	$iwl_mvm_fw_baid_›_°a
(
iwl_mvm
 *
mvm
,

2782 
õì80211_°a
 *
°a
,

2783 
boﬁ
 
°¨t
, 
tid
, 
u16
 
s¢
,

2784 
u16
 
buf_size
)

2786 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2787 
iwl_mvm_add_°a_cmd
 
cmd
 = {

2788 .
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm_°a
->mac_id_n_color),

2789 .
°a_id
 = 
mvm_°a
->
deÊök
.sta_id,

2790 .
add_modify
 = 
STA_MODE_MODIFY
,

2792 
u32
 
°©us
;

2793 
ªt
;

2795 i‡(
°¨t
) {

2796 
cmd
.
add_immedüã_ba_tid
 = 
tid
;

2797 
cmd
.
add_immedüã_ba_s¢
 = 
	`˝u_to_À16
(
s¢
);

2798 
cmd
.
rx_ba_wödow
 = 
	`˝u_to_À16
(
buf_size
);

2799 
cmd
.
modify_mask
 = 
STA_MODIFY_ADD_BA_TID
;

2801 
cmd
.
ªmove_immedüã_ba_tid
 = 
tid
;

2802 
cmd
.
modify_mask
 = 
STA_MODIFY_REMOVE_BA_TID
;

2805 
°©us
 = 
ADD_STA_SUCCESS
;

2806 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA
,

2807 
	`iwl_mvm_add_°a_cmd_size
(
mvm
),

2808 &
cmd
, &
°©us
);

2809 i‡(
ªt
)

2810  
ªt
;

2812 
°©us
 & 
IWL_ADD_STA_STATUS_MASK
) {

2813 
ADD_STA_SUCCESS
:

2814 
	`IWL_DEBUG_HT
(
mvm
, "RX BA Session %sed in fw\n",

2815 
°¨t
 ? "start" : "stopp");

2816 i‡(
	`WARN_ON
(
°¨t
 && 
	`iwl_mvm_has_√w_rx_≠i
(
mvm
) &&

2817 !(
°©us
 & 
IWL_ADD_STA_BAID_VALID_MASK
)))

2818  -
EINVAL
;

2819  
	`u32_gë_bôs
(
°©us
, 
IWL_ADD_STA_BAID_MASK
);

2820 
ADD_STA_IMMEDIATE_BA_FAILURE
:

2821 
	`IWL_WARN
(
mvm
, "RX BA SessionÑefused by fw\n");

2822  -
ENOSPC
;

2824 
	`IWL_ERR
(
mvm
, "RX BA Session failed %sing, status 0x%x\n",

2825 
°¨t
 ? "°¨t" : "°›p", 
°©us
);

2826  -
EIO
;

2828 
	}
}

2830 
	$iwl_mvm_fw_baid_›_cmd
(
iwl_mvm
 *
mvm
,

2831 
õì80211_°a
 *
°a
,

2832 
boﬁ
 
°¨t
, 
tid
, 
u16
 
s¢
,

2833 
u16
 
buf_size
, 
baid
)

2835 
iwl_rx_baid_cfg_cmd
 
cmd
 = {

2836 .
a˘i⁄
 = 
°¨t
 ? 
	`˝u_to_À32
(
IWL_RX_BAID_ACTION_ADD
) :

2837 
	`˝u_to_À32
(
IWL_RX_BAID_ACTION_REMOVE
),

2839 
u32
 
cmd_id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
RX_BAID_ALLOCATION_CONFIG_CMD
);

2840 
ªt
;

2842 
	`BUILD_BUG_ON
((
iwl_rx_baid_cfg_ª•
Ë!(
baid
));

2844 i‡(
°¨t
) {

2845 
cmd
.
Æloc
.
°a_id_mask
 =

2846 
	`˝u_to_À32
(
	`iwl_mvm_°a_fw_id_mask
(
mvm
, 
°a
, -1));

2847 
cmd
.
Æloc
.
tid
 =Åid;

2848 
cmd
.
Æloc
.
s¢
 = 
	`˝u_to_À16
(ssn);

2849 
cmd
.
Æloc
.
wö_size
 = 
	`˝u_to_À16
(
buf_size
);

2850 
baid
 = -
EIO
;

2851 } i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
, 1) == 1) {

2852 
cmd
.
ªmove_v1
.
baid
 = 
	`˝u_to_À32
(baid);

2853 
	`BUILD_BUG_ON
((
cmd
.
ªmove_v1
Ë> (cmd.
ªmove
));

2855 
cmd
.
ªmove
.
°a_id_mask
 =

2856 
	`˝u_to_À32
(
	`iwl_mvm_°a_fw_id_mask
(
mvm
, 
°a
, -1));

2857 
cmd
.
ªmove
.
tid
 = 
	`˝u_to_À32
(tid);

2860 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
cmd_id
, (
cmd
),

2861 &
cmd
, &
baid
);

2862 i‡(
ªt
)

2863  
ªt
;

2865 i‡(!
°¨t
) {

2867 
baid
 = 0;

2870 
	`IWL_DEBUG_HT
(
mvm
, "RX BA Session %sed in fw\n",

2871 
°¨t
 ? "start" : "stopp");

2873 i‡(
baid
 < 0 || baid >
	`ARRAY_SIZE
(
mvm
->
baid_m≠
))

2874  -
EINVAL
;

2876  
baid
;

2877 
	}
}

2879 
	$iwl_mvm_fw_baid_›
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

2880 
boﬁ
 
°¨t
, 
tid
, 
u16
 
s¢
, u16 
buf_size
,

2881 
baid
)

2883 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

2884 
IWL_UCODE_TLV_CAPA_BAID_ML_SUPPORT
))

2885  
	`iwl_mvm_fw_baid_›_cmd
(
mvm
, 
°a
, 
°¨t
,

2886 
tid
, 
s¢
, 
buf_size
, 
baid
);

2888  
	`iwl_mvm_fw_baid_›_°a
(
mvm
, 
°a
, 
°¨t
,

2889 
tid
, 
s¢
, 
buf_size
);

2890 
	}
}

2892 
	$iwl_mvm_°a_rx_agg
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

2893 
tid
, 
u16
 
s¢
, 
boﬁ
 
°¨t
, u16 
buf_size
, u16 
timeout
)

2895 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2896 
iwl_mvm_baid_d©a
 *
baid_d©a
 = 
NULL
;

2897 
ªt
, 
baid
;

2898 
u32
 
max_ba_id_£ssi⁄s
 = 
	`iwl_mvm_has_√w_tx_≠i
(
mvm
Ë? 
IWL_MAX_BAID
 :

2899 
IWL_MAX_BAID_OLD
;

2901 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

2903 i‡(
°¨t
 && 
mvm
->
rx_ba_£ssi⁄s
 >
max_ba_id_£ssi⁄s
) {

2904 
	`IWL_WARN
(
mvm
, "NotÉnough RX BA SESSIONS\n");

2905  -
ENOSPC
;

2908 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
Ë&& 
°¨t
) {

2909 
u32
 
ª‹dî_buf_size
 = 
buf_size
 * (
baid_d©a
->
íåõs
[0]);

2912 #i‚de‡
__CHECKER__


2919 
	`BUILD_BUG_ON
(
SMP_CACHE_BYTES
 % (
baid_d©a
->
íåõs
[0]) &&

2920 (
baid_d©a
->
íåõs
[0]Ë% 
SMP_CACHE_BYTES
);

2928 
ª‹dî_buf_size
 = 
	`ALIGN
‘e‹dî_buf_size, 
SMP_CACHE_BYTES
);

2934 
baid_d©a
 = 
	`kzÆloc
((*baid_data) +

2935 
mvm
->
å™s
->
num_rx_queues
 *

2936 
ª‹dî_buf_size
,

2937 
GFP_KERNEL
);

2938 i‡(!
baid_d©a
)

2939  -
ENOMEM
;

2945 
baid_d©a
->
íåõs_≥r_queue
 =

2946 
ª‹dî_buf_size
 / (
baid_d©a
->
íåõs
[0]);

2949 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
Ë&& !
°¨t
) {

2950 
baid
 = 
mvm_°a
->
tid_to_baid
[
tid
];

2953 
baid
 = -1;

2957 i‡(
°¨t
 || !
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
))

2958 
baid
 = 
	`iwl_mvm_fw_baid_›
(
mvm
, 
°a
, 
°¨t
, 
tid
, 
s¢
, 
buf_size
,

2959 
baid
);

2961 i‡(
baid
 < 0) {

2962 
ªt
 = 
baid
;

2963 
out_‰ì
;

2966 i‡(
°¨t
) {

2967 
mvm
->
rx_ba_£ssi⁄s
++;

2969 i‡(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
))

2972 
baid_d©a
->
baid
 = baid;

2973 
baid_d©a
->
timeout
 =Åimeout;

2974 
baid_d©a
->
œ°_rx
 = 
jiffõs
;

2975 
baid_d©a
->
rcu_±r
 = &
mvm
->
baid_m≠
[
baid
];

2976 
	`timî_£tup
(&
baid_d©a
->
£ssi⁄_timî
,

2977 
iwl_mvm_rx_agg_£ssi⁄_expúed
, 0);

2978 
baid_d©a
->
mvm
 = mvm;

2979 
baid_d©a
->
tid
 =Åid;

2980 
baid_d©a
->
°a_mask
 = 
	`iwl_mvm_°a_fw_id_mask
(
mvm
, 
°a
, -1);

2982 
mvm_°a
->
tid_to_baid
[
tid
] = 
baid
;

2983 i‡(
timeout
)

2984 
	`mod_timî
(&
baid_d©a
->
£ssi⁄_timî
,

2985 
	`TU_TO_EXP_TIME
(
timeout
 * 2));

2987 
	`iwl_mvm_öô_ª‹dî_buf„r
(
mvm
, 
baid_d©a
, 
s¢
, 
buf_size
);

2994 
	`IWL_DEBUG_HT
(
mvm
, "Sta %d(%d) isássignedÅo BAID %d\n",

2995 
mvm_°a
->
deÊök
.
°a_id
, 
tid
, 
baid
);

2996 
	`WARN_ON
(
	`rcu_ac˚ss_poöãr
(
mvm
->
baid_m≠
[
baid
]));

2997 
	`rcu_assign_poöãr
(
mvm
->
baid_m≠
[
baid
], 
baid_d©a
);

2999 
baid
 = 
mvm_°a
->
tid_to_baid
[
tid
];

3001 i‡(
mvm
->
rx_ba_£ssi⁄s
 > 0)

3003 
mvm
->
rx_ba_£ssi⁄s
--;

3004 i‡(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
))

3007 i‡(
	`WARN_ON
(
baid
 =
IWL_RX_REORDER_DATA_INVALID_BAID
))

3008  -
EINVAL
;

3010 
baid_d©a
 = 
	`rcu_ac˚ss_poöãr
(
mvm
->
baid_m≠
[
baid
]);

3011 i‡(
	`WARN_ON
(!
baid_d©a
))

3012  -
EINVAL
;

3015 
	`iwl_mvm_‰ì_ª‹dî
(
mvm
, 
baid_d©a
);

3016 
	`timî_shutdown_sync
(&
baid_d©a
->
£ssi⁄_timî
);

3017 
	`RCU_INIT_POINTER
(
mvm
->
baid_m≠
[
baid
], 
NULL
);

3018 
	`k‰ì_rcu
(
baid_d©a
, 
rcu_hód
);

3019 
	`IWL_DEBUG_HT
(
mvm
, "BAID %d i†‰ì\n", 
baid
);

3023 
out_‰ì
:

3024 
	`k‰ì
(
baid_d©a
);

3025  
ªt
;

3026 
	}
}

3028 
	$iwl_mvm_°a_tx_agg
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

3029 
tid
, 
u8
 
queue
, 
boﬁ
 
°¨t
)

3031 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3032 
iwl_mvm_add_°a_cmd
 
cmd
 = {};

3033 
ªt
;

3034 
u32
 
°©us
;

3036 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3038 i‡(
°¨t
) {

3039 
mvm_°a
->
tfd_queue_msk
 |
	`BIT
(
queue
);

3040 
mvm_°a
->
tid_dißbÀ_agg
 &~
	`BIT
(
tid
);

3043 
mvm_°a
->
tid_dißbÀ_agg
 |
	`BIT
(
tid
);

3046 
cmd
.
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm_°a
->mac_id_n_color);

3047 
cmd
.
°a_id
 = 
mvm_°a
->
deÊök
.sta_id;

3048 
cmd
.
add_modify
 = 
STA_MODE_MODIFY
;

3049 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

3050 
cmd
.
modify_mask
 = 
STA_MODIFY_QUEUES
;

3051 
cmd
.
modify_mask
 |
STA_MODIFY_TID_DISABLE_TX
;

3052 
cmd
.
tfd_queue_msk
 = 
	`˝u_to_À32
(
mvm_°a
->tfd_queue_msk);

3053 
cmd
.
tid_dißbÀ_tx
 = 
	`˝u_to_À16
(
mvm_°a
->
tid_dißbÀ_agg
);

3055 
°©us
 = 
ADD_STA_SUCCESS
;

3056 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA
,

3057 
	`iwl_mvm_add_°a_cmd_size
(
mvm
),

3058 &
cmd
, &
°©us
);

3059 i‡(
ªt
)

3060  
ªt
;

3062 
°©us
 & 
IWL_ADD_STA_STATUS_MASK
) {

3063 
ADD_STA_SUCCESS
:

3066 
ªt
 = -
EIO
;

3067 
	`IWL_ERR
(
mvm
, "TX BA Session failed %sing, status 0x%x\n",

3068 
°¨t
 ? "°¨t" : "°›p", 
°©us
);

3072  
ªt
;

3073 
	}
}

3075 c⁄° 
u8
 
	gtid_to_mac80211_ac
[] = {

3076 
IEEE80211_AC_BE
,

3077 
IEEE80211_AC_BK
,

3078 
IEEE80211_AC_BK
,

3079 
IEEE80211_AC_BE
,

3080 
IEEE80211_AC_VI
,

3081 
IEEE80211_AC_VI
,

3082 
IEEE80211_AC_VO
,

3083 
IEEE80211_AC_VO
,

3084 
IEEE80211_AC_VO
,

3087 c⁄° 
u8
 
	gtid_to_ucode_ac
[] = {

3088 
AC_BE
,

3089 
AC_BK
,

3090 
AC_BK
,

3091 
AC_BE
,

3092 
AC_VI
,

3093 
AC_VI
,

3094 
AC_VO
,

3095 
AC_VO
,

3098 
	$iwl_mvm_°a_tx_agg_°¨t
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

3099 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 *
s¢
)

3101 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3102 
iwl_mvm_tid_d©a
 *
tid_d©a
;

3103 
u16
 
n‹mÆized_s¢
;

3104 
u16
 
txq_id
;

3105 
ªt
;

3107 i‡(
	`WARN_ON_ONCE
(
tid
 >
IWL_MAX_TID_COUNT
))

3108  -
EINVAL
;

3110 i‡(
mvm°a
->
tid_d©a
[
tid
].
°©e
 !
IWL_AGG_QUEUED
 &&

3111 
mvm°a
->
tid_d©a
[
tid
].
°©e
 !
IWL_AGG_OFF
) {

3112 
	`IWL_ERR
(
mvm
,

3114 
mvm°a
->
tid_d©a
[
tid
].
°©e
);

3115  -
ENXIO
;

3118 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3120 i‡(
mvm°a
->
tid_d©a
[
tid
].
txq_id
 =
IWL_MVM_INVALID_QUEUE
 &&

3121 
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

3122 
u8
 
ac
 = 
tid_to_mac80211_ac
[
tid
];

3124 
ªt
 = 
	`iwl_mvm_°a_Æloc_queue_tvqm
(
mvm
, 
°a
, 
ac
, 
tid
);

3125 i‡(
ªt
)

3126  
ªt
;

3129 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

3137 
txq_id
 = 
mvm°a
->
tid_d©a
[
tid
].txq_id;

3138 i‡(
txq_id
 =
IWL_MVM_INVALID_QUEUE
) {

3139 
ªt
 = 
	`iwl_mvm_föd_‰ì_queue
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
,

3140 
IWL_MVM_DQA_MIN_DATA_QUEUE
,

3141 
IWL_MVM_DQA_MAX_DATA_QUEUE
);

3142 i‡(
ªt
 < 0) {

3143 
	`IWL_ERR
(
mvm
, "FailedÅoállocateágg queue\n");

3144 
out
;

3147 
txq_id
 = 
ªt
;

3150 
mvm
->
queue_öfo
[
txq_id
].
°©us
 = 
IWL_MVM_QUEUE_RESERVED
;

3151 } i‡(
	`WARN_ON
(
txq_id
 >
IWL_MAX_HW_QUEUES
)) {

3152 
ªt
 = -
ENXIO
;

3153 
	`IWL_ERR
(
mvm
, "tid_id %d out ofÑange (0, %d)!\n",

3154 
tid
, 
IWL_MAX_HW_QUEUES
 - 1);

3155 
out
;

3157 } i‡(
	`u∆ikñy
(
mvm
->
queue_öfo
[
txq_id
].
°©us
 ==

3158 
IWL_MVM_QUEUE_SHARED
)) {

3159 
ªt
 = -
ENXIO
;

3160 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

3162 
tid
);

3163 
out
;

3166 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

3168 
tid
, 
txq_id
);

3170 
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

3171 
tid_d©a
->
s¢
 = 
	`IEEE80211_SEQ_TO_SN
—id_d©a->
£q_numbî
);

3172 
tid_d©a
->
txq_id
 =Åxq_id;

3173 *
s¢
 = 
tid_d©a
->ssn;

3175 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

3177 
mvm°a
->
deÊök
.
°a_id
, 
tid
, 
txq_id
,

3178 
tid_d©a
->
s¢
,

3179 
tid_d©a
->
√xt_ª˛aimed
);

3185 
n‹mÆized_s¢
 = 
tid_d©a
->
s¢
;

3186 i‡(
mvm
->
å™s
->
å™s_cfg
->
gí2
)

3187 
n‹mÆized_s¢
 &= 0xff;

3189 i‡(
n‹mÆized_s¢
 =
tid_d©a
->
√xt_ª˛aimed
) {

3190 
tid_d©a
->
°©e
 = 
IWL_AGG_STARTING
;

3191 
ªt
 = 
IEEE80211_AMPDU_TX_START_IMMEDIATE
;

3193 
tid_d©a
->
°©e
 = 
IWL_EMPTYING_HW_QUEUE_ADDBA
;

3194 
ªt
 = 
IEEE80211_AMPDU_TX_START_DELAY_ADDBA
;

3197 
out
:

3198 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

3200  
ªt
;

3201 
	}
}

3203 
	$iwl_mvm_°a_tx_agg_›î
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

3204 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 
buf_size
,

3205 
boﬁ
 
amsdu
)

3207 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3208 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

3209 
wdg_timeout
 =

3210 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
vif
, 
°a
->
tdls
, 
Ál£
);

3211 
queue
, 
ªt
;

3212 
boﬁ
 
Æloc_queue
 = 
åue
;

3213 
iwl_mvm_queue_°©us
 
queue_°©us
;

3214 
u16
 
s¢
;

3216 
iwl_å™s_txq_scd_cfg
 
cfg
 = {

3217 .
°a_id
 = 
mvm°a
->
deÊök
.sta_id,

3218 .
tid
 =Åid,

3219 .
‰ame_limô
 = 
buf_size
,

3220 .
aggªg©e
 = 
åue
,

3227 i‡(
	`WARN_ON_ONCE
(
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)))

3228  -
EINVAL
;

3230 
	`BUILD_BUG_ON
(((
mvm°a
->
agg_tids
Ë* 
BITS_PER_BYTE
)

3231 !
IWL_MAX_TID_COUNT
);

3233 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

3234 
s¢
 = 
tid_d©a
->ssn;

3235 
queue
 = 
tid_d©a
->
txq_id
;

3236 
tid_d©a
->
°©e
 = 
IWL_AGG_ON
;

3237 
mvm°a
->
agg_tids
 |
	`BIT
(
tid
);

3238 
tid_d©a
->
s¢
 = 0xffff;

3239 
tid_d©a
->
amsdu_ö_ampdu_Ælowed
 = 
amsdu
;

3240 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

3242 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

3254 i‡(
buf_size
 < 
IWL_FRAME_LIMIT
)

3255  -
EOPNOTSUPP
;

3257 
ªt
 = 
	`iwl_mvm_°a_tx_agg
(
mvm
, 
°a
, 
tid
, 
queue
, 
åue
);

3258 i‡(
ªt
)

3259  -
EIO
;

3260 
out
;

3263 
cfg
.
fifo
 = 
iwl_mvm_ac_to_tx_fifo
[
tid_to_mac80211_ac
[
tid
]];

3265 
queue_°©us
 = 
mvm
->
queue_öfo
[
queue
].
°©us
;

3268 i‡(
mvm
->
queue_öfo
[
queue
].
°©us
 =
IWL_MVM_QUEUE_READY
)

3269 
Æloc_queue
 = 
Ál£
;

3275 i‡(!
Æloc_queue
 && 
buf_size
 < 
IWL_FRAME_LIMIT
) {

3280 
ªt
 = 
	`iwl_å™s_waô_tx_queues_em±y
(
mvm
->
å™s
,

3281 
	`BIT
(
queue
));

3282 i‡(
ªt
) {

3283 
	`IWL_ERR
(
mvm
,

3285  
ªt
;

3288 
ªt
 = 
	`iwl_mvm_ªc⁄fig_scd
(
mvm
, 
queue
, 
cfg
.
fifo
,

3289 
mvm°a
->
deÊök
.
°a_id
, 
tid
,

3290 
buf_size
, 
s¢
);

3291 i‡(
ªt
) {

3292 
	`IWL_ERR
(
mvm
,

3293 "Eº‹Ñec⁄figurög TXQ #%d\n", 
queue
);

3294  
ªt
;

3298 i‡(
Æloc_queue
)

3299 
	`iwl_mvm_íabÀ_txq
(
mvm
, 
°a
, 
queue
, 
s¢
,

3300 &
cfg
, 
wdg_timeout
);

3303 i‡(
queue_°©us
 !
IWL_MVM_QUEUE_SHARED
) {

3304 
ªt
 = 
	`iwl_mvm_°a_tx_agg
(
mvm
, 
°a
, 
tid
, 
queue
, 
åue
);

3305 i‡(
ªt
)

3306  -
EIO
;

3310 
mvm
->
queue_öfo
[
queue
].
°©us
 = 
IWL_MVM_QUEUE_READY
;

3312 
out
:

3320 
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
max_agg_bufsize
 =

3321 
	`mö
(
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
max_agg_bufsize
,

3322 
buf_size
);

3323 
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
lq
.
agg_‰ame_˙t_limô
 =

3324 
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
≥rs
.
max_agg_bufsize
;

3326 
	`IWL_DEBUG_HT
(
mvm
, "TxággregationÉnabled onÑa = %pMÅid = %d\n",

3327 
°a
->
addr
, 
tid
);

3329  
	`iwl_mvm_£nd_lq_cmd
(
mvm
, &
mvm°a
->
deÊök
.
lq_°a
.
rs_drv
.
lq
);

3330 
	}
}

3332 
	$iwl_mvm_uƒe£rve_agg_queue
(
iwl_mvm
 *
mvm
,

3333 
iwl_mvm_°a
 *
mvm°a
,

3334 
iwl_mvm_tid_d©a
 *
tid_d©a
)

3336 
u16
 
txq_id
 = 
tid_d©a
->txq_id;

3338 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3340 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

3350 i‡(
mvm
->
queue_öfo
[
txq_id
].
°©us
 =
IWL_MVM_QUEUE_RESERVED
) {

3351 
mvm
->
queue_öfo
[
txq_id
].
°©us
 = 
IWL_MVM_QUEUE_FREE
;

3352 
tid_d©a
->
txq_id
 = 
IWL_MVM_INVALID_QUEUE
;

3354 
	}
}

3356 
	$iwl_mvm_°a_tx_agg_°›
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

3357 
õì80211_°a
 *
°a
, 
u16
 
tid
)

3359 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3360 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

3361 
u16
 
txq_id
;

3362 
îr
;

3368 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_IN_HW_RESTART
, &
mvm
->
°©us
)) {

3369 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

3373 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

3375 
txq_id
 = 
tid_d©a
->txq_id;

3377 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Stop AGG: sta %dÅid %d q %d state %d\n",

3378 
mvm°a
->
deÊök
.
°a_id
, 
tid
, 
txq_id
,

3379 
tid_d©a
->
°©e
);

3381 
mvm°a
->
agg_tids
 &~
	`BIT
(
tid
);

3383 
	`iwl_mvm_uƒe£rve_agg_queue
(
mvm
, 
mvm°a
, 
tid_d©a
);

3385 
tid_d©a
->
°©e
) {

3386 
IWL_AGG_ON
:

3387 
tid_d©a
->
s¢
 = 
	`IEEE80211_SEQ_TO_SN
—id_d©a->
£q_numbî
);

3389 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

3391 
tid_d©a
->
s¢
,Åid_d©a->
√xt_ª˛aimed
);

3393 
tid_d©a
->
s¢
 = 0xffff;

3394 
tid_d©a
->
°©e
 = 
IWL_AGG_OFF
;

3395 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

3397 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

3399 
	`iwl_mvm_°a_tx_agg
(
mvm
, 
°a
, 
tid
, 
txq_id
, 
Ál£
);

3401 
IWL_AGG_STARTING
:

3402 
IWL_EMPTYING_HW_QUEUE_ADDBA
:

3409 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3411 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

3412 
tid_d©a
->
°©e
 = 
IWL_AGG_OFF
;

3413 
îr
 = 0;

3416 
	`IWL_ERR
(
mvm
,

3418 
mvm°a
->
deÊök
.
°a_id
, 
tid
, 
tid_d©a
->
°©e
);

3419 
	`IWL_ERR
(
mvm
,

3420 "\âid_d©a->txq_id = %d\n", 
tid_d©a
->
txq_id
);

3421 
îr
 = -
EINVAL
;

3424 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

3426  
îr
;

3427 
	}
}

3429 
	$iwl_mvm_°a_tx_agg_Êush
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

3430 
õì80211_°a
 *
°a
, 
u16
 
tid
)

3432 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3433 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

3434 
u16
 
txq_id
;

3435 
iwl_mvm_agg_°©e
 
ﬁd_°©e
;

3441 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

3442 
txq_id
 = 
tid_d©a
->txq_id;

3443 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "Flush AGG: sta %dÅid %d q %d state %d\n",

3444 
mvm°a
->
deÊök
.
°a_id
, 
tid
, 
txq_id
,

3445 
tid_d©a
->
°©e
);

3446 
ﬁd_°©e
 = 
tid_d©a
->
°©e
;

3447 
tid_d©a
->
°©e
 = 
IWL_AGG_OFF
;

3448 
mvm°a
->
agg_tids
 &~
	`BIT
(
tid
);

3449 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

3451 
	`iwl_mvm_uƒe£rve_agg_queue
(
mvm
, 
mvm°a
, 
tid_d©a
);

3453 i‡(
ﬁd_°©e
 >
IWL_AGG_ON
) {

3454 
	`iwl_mvm_døö_°a
(
mvm
, 
mvm°a
, 
åue
);

3456 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

3457 i‡(
	`iwl_mvm_Êush_°a_tids
(
mvm
, 
mvm°a
->
deÊök
.
°a_id
,

3458 
	`BIT
(
tid
)))

3459 
	`IWL_ERR
(
mvm
, "Couldn't flushÅhe AGG queue\n");

3460 
	`iwl_å™s_waô_txq_em±y
(
mvm
->
å™s
, 
txq_id
);

3462 i‡(
	`iwl_mvm_Êush_tx_∑th
(
mvm
, 
	`BIT
(
txq_id
)))

3463 
	`IWL_ERR
(
mvm
, "Couldn't flushÅhe AGG queue\n");

3464 
	`iwl_å™s_waô_tx_queues_em±y
(
mvm
->
å™s
, 
	`BIT
(
txq_id
));

3467 
	`iwl_mvm_døö_°a
(
mvm
, 
mvm°a
, 
Ál£
);

3469 
	`iwl_mvm_°a_tx_agg
(
mvm
, 
°a
, 
tid
, 
txq_id
, 
Ál£
);

3473 
	}
}

3475 
	$iwl_mvm_£t_fw_key_idx
(
iwl_mvm
 *
mvm
)

3477 
i
, 
max
 = -1, 
max_offs
 = -1;

3479 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3487 
i
 = 0; i < 
STA_KEY_MAX_NUM
; i++) {

3488 i‡(
	`ã°_bô
(
i
, 
mvm
->
fw_key_èbÀ
))

3490 i‡(
mvm
->
fw_key_dñëed
[
i
] > 
max
) {

3491 
max
 = 
mvm
->
fw_key_dñëed
[
i
];

3492 
max_offs
 = 
i
;

3496 i‡(
max_offs
 < 0)

3497  
STA_KEY_IDX_INVALID
;

3499  
max_offs
;

3500 
	}
}

3502 
iwl_mvm_°a
 *
	$iwl_mvm_gë_key_°a
(
iwl_mvm
 *
mvm
,

3503 
õì80211_vif
 *
vif
,

3504 
õì80211_°a
 *
°a
)

3506 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3508 i‡(
°a
)

3509  
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3516 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

3517 
mvmvif
->
deÊök
.
≠_°a_id
 !
IWL_MVM_INVALID_STA
) {

3518 
u8
 
°a_id
 = 
mvmvif
->
deÊök
.
≠_°a_id
;

3520 
°a
 = 
	`rcu_dîe„ªn˚_check
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

3521 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

3528 i‡(
	`IS_ERR_OR_NULL
(
°a
))

3529  
NULL
;

3531  
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3534  
NULL
;

3535 
	}
}

3537 
	$iwl_mvm_≤_cmp
(c⁄° 
u8
 *
≤1
, c⁄° u8 *
≤2
, 
Àn
)

3539 
i
;

3541 
i
 = 
Àn
 - 1; i >= 0; i--) {

3542 i‡(
≤1
[
i
] > 
≤2
[i])

3544 i‡(
≤1
[
i
] < 
≤2
[i])

3549 
	}
}

3551 
	$iwl_mvm_£nd_°a_key
(
iwl_mvm
 *
mvm
,

3552 
u32
 
°a_id
,

3553 
õì80211_key_c⁄f
 *
key
, 
boﬁ
 
mˇ°
,

3554 
u32
 
tkù_iv32
, 
u16
 *
tkù_p1k
, u32 
cmd_Êags
,

3555 
u8
 
key_off£t
, 
boﬁ
 
mÂ
)

3558 
iwl_mvm_add_°a_key_cmd_v1
 
cmd_v1
;

3559 
iwl_mvm_add_°a_key_cmd
 
cmd
;

3560 } 
u
 = {};

3561 
__À16
 
key_Êags
;

3562 
ªt
;

3563 
u32
 
°©us
;

3564 
u16
 
keyidx
;

3565 
u64
 
≤
 = 0;

3566 
i
, 
size
;

3567 
boﬁ
 
√w_≠i
 = 
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
,

3568 
IWL_UCODE_TLV_API_TKIP_MIC_KEYS
);

3569 
≠i_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
ADD_STA_KEY
,

3570 
√w_≠i
 ? 2 : 1);

3572 i‡(
°a_id
 =
IWL_MVM_INVALID_STA
)

3573  -
EINVAL
;

3575 
keyidx
 = (
key
->keyidx << 
STA_KEY_FLG_KEYID_POS
) &

3576 
STA_KEY_FLG_KEYID_MSK
;

3577 
key_Êags
 = 
	`˝u_to_À16
(
keyidx
);

3578 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_WEP_KEY_MAP
);

3580 i‡(
key
->
Êags
 & 
IEEE80211_KEY_FLAG_SPP_AMSDU
)

3581 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_AMSDU_SPP
);

3583 
key
->
cùhî
) {

3584 
WLAN_CIPHER_SUITE_TKIP
:

3585 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_TKIP
);

3586 i‡(
≠i_vî
 >= 2) {

3587 
	`mem˝y
((*)&
u
.
cmd
.
tx_mic_key
,

3588 &
key
->key[
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
],

3589 
IWL_MIC_KEY_SIZE
);

3591 
	`mem˝y
((*)&
u
.
cmd
.
rx_mic_key
,

3592 &
key
->key[
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
],

3593 
IWL_MIC_KEY_SIZE
);

3594 
≤
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

3597 
u
.
cmd_v1
.
tkù_rx_tsc_byã2
 = 
tkù_iv32
;

3598 
i
 = 0; i < 5; i++)

3599 
u
.
cmd_v1
.
tkù_rx_âak
[
i
] =

3600 
	`˝u_to_À16
(
tkù_p1k
[
i
]);

3602 
	`mem˝y
(
u
.
cmd
.
comm⁄
.
key
, key->key, key->
keyÀn
);

3604 
WLAN_CIPHER_SUITE_CCMP
:

3605 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_CCM
);

3606 
	`mem˝y
(
u
.
cmd
.
comm⁄
.
key
, key->key, key->
keyÀn
);

3607 i‡(
≠i_vî
 >= 2)

3608 
≤
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

3610 
WLAN_CIPHER_SUITE_WEP104
:

3611 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_WEP_13BYTES
);

3612 
ÁŒthrough
;

3613 
WLAN_CIPHER_SUITE_WEP40
:

3614 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_WEP
);

3615 
	`mem˝y
(
u
.
cmd
.
comm⁄
.
key
 + 3, key->key, key->
keyÀn
);

3617 
WLAN_CIPHER_SUITE_GCMP_256
:

3618 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_KEY_32BYTES
);

3619 
ÁŒthrough
;

3620 
WLAN_CIPHER_SUITE_GCMP
:

3621 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_GCMP
);

3622 
	`mem˝y
(
u
.
cmd
.
comm⁄
.
key
, key->key, key->
keyÀn
);

3623 i‡(
≠i_vî
 >= 2)

3624 
≤
 = 
	`©omic64_ªad
(&
key
->
tx_≤
);

3627 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_FLG_EXT
);

3628 
	`mem˝y
(
u
.
cmd
.
comm⁄
.
key
, key->key, key->
keyÀn
);

3631 i‡(
mˇ°
)

3632 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_MULTICAST
);

3633 i‡(
mÂ
)

3634 
key_Êags
 |
	`˝u_to_À16
(
STA_KEY_MFP
);

3636 
u
.
cmd
.
comm⁄
.
key_off£t
 = key_offset;

3637 
u
.
cmd
.
comm⁄
.
key_Êags
 = key_flags;

3638 
u
.
cmd
.
comm⁄
.
°a_id
 = sta_id;

3640 i‡(
key
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
)

3641 
i
 = 0;

3643 
i
 = -1;

3645 ; 
i
 < 
IEEE80211_NUM_TIDS
; i++) {

3646 
õì80211_key_£q
 
£q
 = {};

3647 
u8
 
_rx_≤
[
IEEE80211_MAX_PN_LEN
] = {}, *
rx_≤
 = _rx_pn;

3648 
rx_≤_Àn
 = 8;

3650 
hﬁe
 = 
≠i_vî
 >= 3 ? 0 : 2;

3652 
	`õì80211_gë_key_rx_£q
(
key
, 
i
, &
£q
);

3654 i‡(
key
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
) {

3655 
rx_≤
[0] = 
£q
.
tkù
.
iv16
;

3656 
rx_≤
[1] = 
£q
.
tkù
.
iv16
 >> 8;

3657 
rx_≤
[2 + 
hﬁe
] = 
£q
.
tkù
.
iv32
;

3658 
rx_≤
[3 + 
hﬁe
] = 
£q
.
tkù
.
iv32
 >> 8;

3659 
rx_≤
[4 + 
hﬁe
] = 
£q
.
tkù
.
iv32
 >> 16;

3660 
rx_≤
[5 + 
hﬁe
] = 
£q
.
tkù
.
iv32
 >> 24;

3661 } i‡(
key_Êags
 & 
	`˝u_to_À16
(
STA_KEY_FLG_EXT
)) {

3662 
rx_≤
 = 
£q
.
hw
.seq;

3663 
rx_≤_Àn
 = 
£q
.
hw
.
£q_Àn
;

3665 
rx_≤
[0] = 
£q
.
ccmp
.
≤
[0];

3666 
rx_≤
[1] = 
£q
.
ccmp
.
≤
[1];

3667 
rx_≤
[2 + 
hﬁe
] = 
£q
.
ccmp
.
≤
[2];

3668 
rx_≤
[3 + 
hﬁe
] = 
£q
.
ccmp
.
≤
[3];

3669 
rx_≤
[4 + 
hﬁe
] = 
£q
.
ccmp
.
≤
[4];

3670 
rx_≤
[5 + 
hﬁe
] = 
£q
.
ccmp
.
≤
[5];

3673 i‡(
	`iwl_mvm_≤_cmp
(
rx_≤
, (
u8
 *)&
u
.
cmd
.
comm⁄
.
rx_£cur_£q_˙t
,

3674 
rx_≤_Àn
) > 0)

3675 
	`mem˝y
(&
u
.
cmd
.
comm⁄
.
rx_£cur_£q_˙t
, 
rx_≤
,

3676 
rx_≤_Àn
);

3679 i‡(
≠i_vî
 >= 2) {

3680 
u
.
cmd
.
å™smô_£q_˙t
 = 
	`˝u_to_À64
(
≤
);

3681 
size
 = (
u
.
cmd
);

3683 
size
 = (
u
.
cmd_v1
);

3686 
°©us
 = 
ADD_STA_SUCCESS
;

3687 i‡(
cmd_Êags
 & 
CMD_ASYNC
)

3688 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ADD_STA_KEY
, 
CMD_ASYNC
, 
size
,

3689 &
u
.
cmd
);

3691 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
ADD_STA_KEY
, 
size
,

3692 &
u
.
cmd
, &
°©us
);

3694 
°©us
) {

3695 
ADD_STA_SUCCESS
:

3696 
	`IWL_DEBUG_WEP
(
mvm
, "MODIFY_STA: set dynamic keyÖassed\n");

3699 
ªt
 = -
EIO
;

3700 
	`IWL_ERR
(
mvm
, "MODIFY_STA: set dynamic key failed\n");

3704  
ªt
;

3705 
	}
}

3707 
	$iwl_mvm_£nd_°a_igtk
(
iwl_mvm
 *
mvm
,

3708 
õì80211_key_c⁄f
 *
keyc⁄f
,

3709 
u8
 
°a_id
, 
boﬁ
 
ªmove_key
)

3711 
iwl_mvm_mgmt_mˇ°_key_cmd
 
igtk_cmd
 = {};

3714 i‡(
	`WARN_ON
((
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
) ||

3715 (
keyc⁄f
->
keyidx
 != 4 && keyconf->keyidx != 5 &&

3716 
keyc⁄f
->
keyidx
 != 6 && keyconf->keyidx != 7) ||

3717 (
keyc⁄f
->
cùhî
 !
WLAN_CIPHER_SUITE_AES_CMAC
 &&

3718 
keyc⁄f
->
cùhî
 !
WLAN_CIPHER_SUITE_BIP_GMAC_128
 &&

3719 
keyc⁄f
->
cùhî
 !
WLAN_CIPHER_SUITE_BIP_GMAC_256
)))

3720  -
EINVAL
;

3722 i‡(
	`WARN_ON
(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
) &&

3723 
keyc⁄f
->
cùhî
 !
WLAN_CIPHER_SUITE_AES_CMAC
))

3724  -
EINVAL
;

3726 
igtk_cmd
.
key_id
 = 
	`˝u_to_À32
(
keyc⁄f
->
keyidx
);

3727 
igtk_cmd
.
°a_id
 = 
	`˝u_to_À32
(sta_id);

3729 i‡(
ªmove_key
) {

3731 i‡(
°a_id
 =
IWL_MVM_INVALID_STA
)

3734 
igtk_cmd
.
˘æ_Êags
 |
	`˝u_to_À32
(
STA_KEY_NOT_VALID
);

3736 
õì80211_key_£q
 
£q
;

3737 c⁄° 
u8
 *
≤
;

3739 
keyc⁄f
->
cùhî
) {

3740 
WLAN_CIPHER_SUITE_AES_CMAC
:

3741 
igtk_cmd
.
˘æ_Êags
 |
	`˝u_to_À32
(
STA_KEY_FLG_CCM
);

3743 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

3744 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

3745 
igtk_cmd
.
˘æ_Êags
 |
	`˝u_to_À32
(
STA_KEY_FLG_GCMP
);

3748  -
EINVAL
;

3751 
	`mem˝y
(
igtk_cmd
.
igtk
, 
keyc⁄f
->
key
, keyc⁄f->
keyÀn
);

3752 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_256
)

3753 
igtk_cmd
.
˘æ_Êags
 |=

3754 
	`˝u_to_À32
(
STA_KEY_FLG_KEY_32BYTES
);

3755 
	`õì80211_gë_key_rx_£q
(
keyc⁄f
, 0, &
£q
);

3756 
≤
 = 
£q
.
´s_cmac
.pn;

3757 
igtk_cmd
.
ª˚ive_£q_˙t
 = 
	`˝u_to_À64
(((
u64
Ë
≤
[5] << 0) |

3758 ((
u64
Ë
≤
[4] << 8) |

3759 ((
u64
Ë
≤
[3] << 16) |

3760 ((
u64
Ë
≤
[2] << 24) |

3761 ((
u64
Ë
≤
[1] << 32) |

3762 ((
u64
Ë
≤
[0] << 40));

3765 
	`IWL_DEBUG_INFO
(
mvm
, "%s %sIGTK (%d) for sta %u\n",

3766 
ªmove_key
 ? "removing" : "installing",

3767 
keyc⁄f
->
keyidx
 >= 6 ? "B" : "",

3768 
keyc⁄f
->
keyidx
, 
igtk_cmd
.
°a_id
);

3770 i‡(!
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

3771 
iwl_mvm_mgmt_mˇ°_key_cmd_v1
 
igtk_cmd_v1
 = {

3772 .
˘æ_Êags
 = 
igtk_cmd
.ctrl_flags,

3773 .
key_id
 = 
igtk_cmd
.key_id,

3774 .
°a_id
 = 
igtk_cmd
.sta_id,

3775 .
ª˚ive_£q_˙t
 = 
igtk_cmd
.receive_seq_cnt

3778 
	`mem˝y
(
igtk_cmd_v1
.
igtk
, 
igtk_cmd
.igtk,

3779 
	`ARRAY_SIZE
(
igtk_cmd_v1
.
igtk
));

3780  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
MGMT_MCAST_KEY
, 0,

3781 (
igtk_cmd_v1
), &igtk_cmd_v1);

3783  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
MGMT_MCAST_KEY
, 0,

3784 (
igtk_cmd
), &igtk_cmd);

3785 
	}
}

3788 
ölöe
 
u8
 *
	$iwl_mvm_gë_mac_addr
(
iwl_mvm
 *
mvm
,

3789 
õì80211_vif
 *
vif
,

3790 
õì80211_°a
 *
°a
)

3792 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3794 i‡(
°a
)

3795  
°a
->
addr
;

3797 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

3798 
mvmvif
->
deÊök
.
≠_°a_id
 !
IWL_MVM_INVALID_STA
) {

3799 
u8
 
°a_id
 = 
mvmvif
->
deÊök
.
≠_°a_id
;

3800 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

3801 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

3802 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
)))

3803  
NULL
;

3805  
°a
->
addr
;

3809  
NULL
;

3810 
	}
}

3812 
	$__iwl_mvm_£t_°a_key
(
iwl_mvm
 *
mvm
,

3813 
õì80211_vif
 *
vif
,

3814 
õì80211_°a
 *
°a
,

3815 
õì80211_key_c⁄f
 *
keyc⁄f
,

3816 
u8
 
key_off£t
,

3817 
boﬁ
 
mˇ°
)

3819 c⁄° 
u8
 *
addr
;

3820 
õì80211_key_£q
 
£q
;

3821 
u16
 
p1k
[5];

3822 
u32
 
°a_id
;

3823 
boﬁ
 
mÂ
 = 
Ál£
;

3825 i‡(
°a
) {

3826 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

3828 
°a_id
 = 
mvm_°a
->
deÊök
.sta_id;

3829 
mÂ
 = 
°a
->mfp;

3830 } i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 &&

3831 !(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

3832 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3834 
°a_id
 = 
mvmvif
->
deÊök
.
mˇ°_°a
.sta_id;

3836 
	`IWL_ERR
(
mvm
, "FailedÅo find station id\n");

3837  -
EINVAL
;

3840 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_TKIP
) {

3841 
addr
 = 
	`iwl_mvm_gë_mac_addr
(
mvm
, 
vif
, 
°a
);

3842 i‡(!
addr
) {

3843 
	`IWL_ERR
(
mvm
, "FailedÅo find macáddress\n");

3844  -
EINVAL
;

3848 
	`õì80211_gë_key_rx_£q
(
keyc⁄f
, 0, &
£q
);

3849 
	`õì80211_gë_tkù_rx_p1k
(
keyc⁄f
, 
addr
, 
£q
.
tkù
.
iv32
, 
p1k
);

3851  
	`iwl_mvm_£nd_°a_key
(
mvm
, 
°a_id
, 
keyc⁄f
, 
mˇ°
,

3852 
£q
.
tkù
.
iv32
, 
p1k
, 0, 
key_off£t
,

3853 
mÂ
);

3856  
	`iwl_mvm_£nd_°a_key
(
mvm
, 
°a_id
, 
keyc⁄f
, 
mˇ°
,

3857 0, 
NULL
, 0, 
key_off£t
, 
mÂ
);

3858 
	}
}

3860 
	$iwl_mvm_£t_°a_key
(
iwl_mvm
 *
mvm
,

3861 
õì80211_vif
 *
vif
,

3862 
õì80211_°a
 *
°a
,

3863 
õì80211_key_c⁄f
 *
keyc⁄f
,

3864 
u8
 
key_off£t
)

3866 
boﬁ
 
mˇ°
 = !(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
);

3867 
iwl_mvm_°a
 *
mvm_°a
;

3868 
u8
 
°a_id
 = 
IWL_MVM_INVALID_STA
;

3869 
ªt
;

3870 c⁄° 
u8
 
__maybe_unu£d
 
zîo_addr
[
ETH_ALEN
] = {0};

3872 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3874 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_AP
 ||

3875 
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
) {

3877 
mvm_°a
 = 
	`iwl_mvm_gë_key_°a
(
mvm
, 
vif
, 
°a
);

3878 i‡(!
mvm_°a
) {

3879 
	`IWL_ERR
(
mvm
, "FailedÅo find station\n");

3880  -
EINVAL
;

3882 
°a_id
 = 
mvm_°a
->
deÊök
.sta_id;

3889 i‡(!
°a
) {

3890 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

3891 
mvm
->
fw_id_to_mac_id
[
°a_id
],

3892 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

3893 i‡(
	`IS_ERR_OR_NULL
(
°a
)) {

3894 
	`IWL_ERR
(
mvm
, "Invalid station id\n");

3895  -
EINVAL
;

3899 i‡(
	`WARN_ON_ONCE
(
	`iwl_mvm_°a_‰om_mac80211
(
°a
)->
vif
 != vif))

3900  -
EINVAL
;

3902 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

3904 
°a_id
 = 
mvmvif
->
deÊök
.
mˇ°_°a
.sta_id;

3907 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_AES_CMAC
 ||

3908 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_128
 ||

3909 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_256
) {

3910 
ªt
 = 
	`iwl_mvm_£nd_°a_igtk
(
mvm
, 
keyc⁄f
, 
°a_id
, 
Ál£
);

3911 
íd
;

3925 i‡(
key_off£t
 =
STA_KEY_IDX_INVALID
) {

3926 
key_off£t
 = 
	`iwl_mvm_£t_fw_key_idx
(
mvm
);

3927 i‡(
key_off£t
 =
STA_KEY_IDX_INVALID
)

3928  -
ENOSPC
;

3929 
keyc⁄f
->
hw_key_idx
 = 
key_off£t
;

3932 
ªt
 = 
	`__iwl_mvm_£t_°a_key
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
, 
key_off£t
, 
mˇ°
);

3933 i‡(
ªt
)

3934 
íd
;

3942 i‡((
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

3943 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
) &&

3944 
°a
) {

3945 
ªt
 = 
	`__iwl_mvm_£t_°a_key
(
mvm
, 
vif
, 
°a
, 
keyc⁄f
,

3946 
key_off£t
, !
mˇ°
);

3947 i‡(
ªt
) {

3948 
	`__iwl_mvm_ªmove_°a_key
(
mvm
, 
°a_id
, 
keyc⁄f
, 
mˇ°
);

3949 
íd
;

3953 
	`__£t_bô
(
key_off£t
, 
mvm
->
fw_key_èbÀ
);

3955 
íd
:

3956 
	`IWL_DEBUG_WEP
(
mvm
, "key: cipher=%xÜen=%d idx=%d sta=%pMÑet=%d\n",

3957 
keyc⁄f
->
cùhî
, keyc⁄f->
keyÀn
, keyc⁄f->
keyidx
,

3958 
°a
 ? sè->
addr
 : 
zîo_addr
, 
ªt
);

3959  
ªt
;

3960 
	}
}

3962 
	$iwl_mvm_ªmove_°a_key
(
iwl_mvm
 *
mvm
,

3963 
õì80211_vif
 *
vif
,

3964 
õì80211_°a
 *
°a
,

3965 
õì80211_key_c⁄f
 *
keyc⁄f
)

3967 
boﬁ
 
mˇ°
 = !(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
);

3968 
iwl_mvm_°a
 *
mvm_°a
;

3969 
u8
 
°a_id
 = 
IWL_MVM_INVALID_STA
;

3970 
ªt
, 
i
;

3972 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

3975 
mvm_°a
 = 
	`iwl_mvm_gë_key_°a
(
mvm
, 
vif
, 
°a
);

3976 i‡(
mvm_°a
)

3977 
°a_id
 = 
mvm_°a
->
deÊök
.sta_id;

3978 i‡(!
°a
 && 
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 && 
mˇ°
)

3979 
°a_id
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
)->
deÊök
.
mˇ°_°a
.sta_id;

3982 
	`IWL_DEBUG_WEP
(
mvm
, "mvmÑemove dynamic key: idx=%d sta=%d\n",

3983 
keyc⁄f
->
keyidx
, 
°a_id
);

3985 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_AES_CMAC
 ||

3986 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_128
 ||

3987 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_BIP_GMAC_256
)

3988  
	`iwl_mvm_£nd_°a_igtk
(
mvm
, 
keyc⁄f
, 
°a_id
, 
åue
);

3990 i‡(!
	`__ã°_™d_˛ór_bô
(
keyc⁄f
->
hw_key_idx
, 
mvm
->
fw_key_èbÀ
)) {

3991 
	`IWL_ERR
(
mvm
, "offset %dÇot used in fw keyÅable.\n",

3992 
keyc⁄f
->
hw_key_idx
);

3993  -
ENOENT
;

3997 
i
 = 0; i < 
STA_KEY_MAX_NUM
; i++) {

3998 i‡(
mvm
->
fw_key_dñëed
[
i
] < 
U8_MAX
)

3999 
mvm
->
fw_key_dñëed
[
i
]++;

4001 
mvm
->
fw_key_dñëed
[
keyc⁄f
->
hw_key_idx
] = 0;

4003 i‡(
°a
 && !
mvm_°a
) {

4004 
	`IWL_DEBUG_WEP
(
mvm
, "stationÇon-existent,ÉarlyÑeturn.\n");

4008 
ªt
 = 
	`__iwl_mvm_ªmove_°a_key
(
mvm
, 
°a_id
, 
keyc⁄f
, 
mˇ°
);

4009 i‡(
ªt
)

4010  
ªt
;

4013 i‡(
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP40
 ||

4014 
keyc⁄f
->
cùhî
 =
WLAN_CIPHER_SUITE_WEP104
)

4015 
ªt
 = 
	`__iwl_mvm_ªmove_°a_key
(
mvm
, 
°a_id
, 
keyc⁄f
, !
mˇ°
);

4017  
ªt
;

4018 
	}
}

4020 
	$iwl_mvm_upd©e_tkù_key
(
iwl_mvm
 *
mvm
,

4021 
õì80211_vif
 *
vif
,

4022 
õì80211_key_c⁄f
 *
keyc⁄f
,

4023 
õì80211_°a
 *
°a
, 
u32
 
iv32
,

4024 
u16
 *
pha£1key
)

4026 
iwl_mvm_°a
 *
mvm_°a
;

4027 
boﬁ
 
mˇ°
 = !(
keyc⁄f
->
Êags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
);

4028 
boﬁ
 
mÂ
 = 
°a
 ? sè->mÂ : 
Ál£
;

4030 
	`rcu_ªad_lock
();

4032 
mvm_°a
 = 
	`iwl_mvm_gë_key_°a
(
mvm
, 
vif
, 
°a
);

4033 i‡(
	`WARN_ON_ONCE
(!
mvm_°a
))

4034 
u∆ock
;

4035 
	`iwl_mvm_£nd_°a_key
(
mvm
, 
mvm_°a
->
deÊök
.
°a_id
, 
keyc⁄f
, 
mˇ°
,

4036 
iv32
, 
pha£1key
, 
CMD_ASYNC
, 
keyc⁄f
->
hw_key_idx
,

4037 
mÂ
);

4039 
u∆ock
:

4040 
	`rcu_ªad_u∆ock
();

4041 
	}
}

4043 
	$iwl_mvm_°a_modify_ps_wake
(
iwl_mvm
 *
mvm
,

4044 
õì80211_°a
 *
°a
)

4046 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4047 
iwl_mvm_add_°a_cmd
 
cmd
 = {

4048 .
add_modify
 = 
STA_MODE_MODIFY
,

4049 .
°a_id
 = 
mvm°a
->
deÊök
.sta_id,

4050 .
°©i⁄_Êags_msk
 = 
	`˝u_to_À32
(
STA_FLG_PS
),

4051 .
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm°a
->mac_id_n_color),

4053 
ªt
;

4055 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ADD_STA
, 
CMD_ASYNC
,

4056 
	`iwl_mvm_add_°a_cmd_size
(
mvm
), &
cmd
);

4057 i‡(
ªt
)

4058 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd ADD_STA comm™d (%d)\n", 
ªt
);

4059 
	}
}

4061 
	$iwl_mvm_°a_modify_¶ìp_tx_cou¡
(
iwl_mvm
 *
mvm
,

4062 
õì80211_°a
 *
°a
,

4063 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

4064 
u16
 
˙t
, u16 
tids
, 
boﬁ
 
m‹e_d©a
,

4065 
boﬁ
 
sögÀ_°a_queue
)

4067 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4068 
iwl_mvm_add_°a_cmd
 
cmd
 = {

4069 .
add_modify
 = 
STA_MODE_MODIFY
,

4070 .
°a_id
 = 
mvm°a
->
deÊök
.sta_id,

4071 .
modify_mask
 = 
STA_MODIFY_SLEEPING_STA_TX_COUNT
,

4072 .
¶ìp_tx_cou¡
 = 
	`˝u_to_À16
(
˙t
),

4073 .
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm°a
->mac_id_n_color),

4075 
tid
, 
ªt
;

4076 
_tids
 = 
tids
;

4082 
	`f‹_óch_£t_bô
(
tid
, &
_tids
, 
IWL_MAX_TID_COUNT
)

4083 
cmd
.
awake_acs
 |
	`BIT
(
tid_to_ucode_ac
[
tid
]);

4092 i‡(
sögÀ_°a_queue
) {

4093 
ªmaöög
 = 
˙t
;

4094 
¶ìp_tx_cou¡
;

4096 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

4097 
	`f‹_óch_£t_bô
(
tid
, &
_tids
, 
IWL_MAX_TID_COUNT
) {

4098 
iwl_mvm_tid_d©a
 *
tid_d©a
;

4099 
u16
 
n_queued
;

4101 
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

4103 
n_queued
 = 
	`iwl_mvm_tid_queued
(
mvm
, 
tid_d©a
);

4104 i‡(
n_queued
 > 
ªmaöög
) {

4105 
m‹e_d©a
 = 
åue
;

4106 
ªmaöög
 = 0;

4109 
ªmaöög
 -
n_queued
;

4111 
¶ìp_tx_cou¡
 = 
˙t
 - 
ªmaöög
;

4112 i‡(
ªas⁄
 =
IEEE80211_FRAME_RELEASE_UAPSD
)

4113 
mvm°a
->
¶ìp_tx_cou¡
 = sleep_tx_count;

4114 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

4116 
cmd
.
¶ìp_tx_cou¡
 = 
	`˝u_to_À16
(sleep_tx_count);

4117 i‡(
	`WARN_ON
(
˙t
 - 
ªmaöög
 == 0)) {

4118 
	`õì80211_°a_eo•
(
°a
);

4124 i‡(
m‹e_d©a
)

4125 
cmd
.
¶ìp_°©e_Êags
 |
STA_SLEEP_STATE_MOREDATA
;

4127 i‡(
ªas⁄
 =
IEEE80211_FRAME_RELEASE_PSPOLL
) {

4128 
mvm°a
->
√xt_°©us_eo•
 = 
åue
;

4129 
cmd
.
¶ìp_°©e_Êags
 |
STA_SLEEP_STATE_PS_POLL
;

4131 
cmd
.
¶ìp_°©e_Êags
 |
STA_SLEEP_STATE_UAPSD
;

4135 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ADD_STA
,

4136 
CMD_ASYNC
 | 
CMD_BLOCK_TXQS
,

4137 
	`iwl_mvm_add_°a_cmd_size
(
mvm
), &
cmd
);

4138 i‡(
ªt
)

4139 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd ADD_STA comm™d (%d)\n", 
ªt
);

4140 
	}
}

4142 
	$iwl_mvm_rx_eo•_nŸif
(
iwl_mvm
 *
mvm
,

4143 
iwl_rx_cmd_buf„r
 *
rxb
)

4145 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

4146 
iwl_mvm_eo•_nŸifiˇti⁄
 *
nŸif
 = (*)
pkt
->
d©a
;

4147 
õì80211_°a
 *
°a
;

4148 
u32
 
°a_id
 = 
	`À32_to_˝u
(
nŸif
->sta_id);

4150 i‡(
	`WARN_ON_ONCE
(
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
))

4153 
	`rcu_ªad_lock
();

4154 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

4155 i‡(!
	`IS_ERR_OR_NULL
(
°a
))

4156 
	`õì80211_°a_eo•
(
°a
);

4157 
	`rcu_ªad_u∆ock
();

4158 
	}
}

4160 
	$iwl_mvm_°a_modify_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

4161 
iwl_mvm_°a
 *
mvm°a
,

4162 
boﬁ
 
dißbÀ
)

4164 
iwl_mvm_add_°a_cmd
 
cmd
 = {

4165 .
add_modify
 = 
STA_MODE_MODIFY
,

4166 .
°a_id
 = 
mvm°a
->
deÊök
.sta_id,

4167 .
°©i⁄_Êags
 = 
dißbÀ
 ? 
	`˝u_to_À32
(
STA_FLG_DISABLE_TX
) : 0,

4168 .
°©i⁄_Êags_msk
 = 
	`˝u_to_À32
(
STA_FLG_DISABLE_TX
),

4169 .
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
mvm°a
->mac_id_n_color),

4171 
ªt
;

4173 i‡(
mvm
->
mld_≠i_is_u£d
) {

4174 i‡(!
	`iwl_mvm_has_no_ho°_dißbÀ_tx
(
mvm
))

4175 
	`iwl_mvm_mld_°a_modify_dißbÀ_tx
(
mvm
, 
mvm°a
, 
dißbÀ
);

4179 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ADD_STA
, 
CMD_ASYNC
,

4180 
	`iwl_mvm_add_°a_cmd_size
(
mvm
), &
cmd
);

4181 i‡(
ªt
)

4182 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd ADD_STA comm™d (%d)\n", 
ªt
);

4183 
	}
}

4185 
	$iwl_mvm_°a_modify_dißbÀ_tx_≠
(
iwl_mvm
 *
mvm
,

4186 
õì80211_°a
 *
°a
,

4187 
boﬁ
 
dißbÀ
)

4189 
iwl_mvm_°a
 *
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4191 i‡(
mvm
->
mld_≠i_is_u£d
) {

4192 i‡(!
	`iwl_mvm_has_no_ho°_dißbÀ_tx
(
mvm
))

4193 
	`iwl_mvm_mld_°a_modify_dißbÀ_tx_≠
(
mvm
, 
°a
, 
dißbÀ
);

4197 
	`•ö_lock_bh
(&
mvm_°a
->
lock
);

4199 i‡(
mvm_°a
->
dißbÀ_tx
 =
dißbÀ
) {

4200 
	`•ö_u∆ock_bh
(&
mvm_°a
->
lock
);

4204 
mvm_°a
->
dißbÀ_tx
 = 
dißbÀ
;

4210 i‡(!
	`õì80211_hw_check
(
mvm
->
hw
, 
AP_LINK_PS
))

4211 
	`õì80211_°a_block_awake
(
mvm
->
hw
, 
°a
, 
dißbÀ
);

4213 
	`iwl_mvm_°a_modify_dißbÀ_tx
(
mvm
, 
mvm_°a
, 
dißbÀ
);

4215 
	`•ö_u∆ock_bh
(&
mvm_°a
->
lock
);

4216 
	}
}

4218 
	$iwl_mvm_öt_°a_modify_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

4219 
iwl_mvm_vif
 *
mvmvif
,

4220 
iwl_mvm_öt_°a
 *
°a
,

4221 
boﬁ
 
dißbÀ
)

4223 
u32
 
id
 = 
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->id, mvmvif->
cﬁ‹
);

4224 
iwl_mvm_add_°a_cmd
 
cmd
 = {

4225 .
add_modify
 = 
STA_MODE_MODIFY
,

4226 .
°a_id
 = 
°a
->sta_id,

4227 .
°©i⁄_Êags
 = 
dißbÀ
 ? 
	`˝u_to_À32
(
STA_FLG_DISABLE_TX
) : 0,

4228 .
°©i⁄_Êags_msk
 = 
	`˝u_to_À32
(
STA_FLG_DISABLE_TX
),

4229 .
mac_id_n_cﬁ‹
 = 
	`˝u_to_À32
(
id
),

4231 
ªt
;

4233 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
ADD_STA
, 
CMD_ASYNC
,

4234 
	`iwl_mvm_add_°a_cmd_size
(
mvm
), &
cmd
);

4235 i‡(
ªt
)

4236 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd ADD_STA comm™d (%d)\n", 
ªt
);

4237 
	}
}

4239 
	$iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

4240 
iwl_mvm_vif
 *
mvmvif
,

4241 
boﬁ
 
dißbÀ
)

4243 
õì80211_°a
 *
°a
;

4244 
iwl_mvm_°a
 *
mvm_°a
;

4245 
i
;

4247 i‡(
mvm
->
mld_≠i_is_u£d
) {

4248 i‡(!
	`iwl_mvm_has_no_ho°_dißbÀ_tx
(
mvm
))

4249 
	`iwl_mvm_mld_modify_Æl_°a_dißbÀ_tx
(
mvm
, 
mvmvif
,

4250 
dißbÀ
);

4254 
	`rcu_ªad_lock
();

4257 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

4258 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
i
]);

4259 i‡(
	`IS_ERR_OR_NULL
(
°a
))

4262 
mvm_°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

4263 i‡(
mvm_°a
->
mac_id_n_cﬁ‹
 !=

4264 
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
))

4267 
	`iwl_mvm_°a_modify_dißbÀ_tx_≠
(
mvm
, 
°a
, 
dißbÀ
);

4270 
	`rcu_ªad_u∆ock
();

4272 i‡(!
	`fw_has_≠i
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_API_STA_TYPE
))

4276 i‡(
mvmvif
->
deÊök
.
mˇ°_°a
.
°a_id
 !
IWL_MVM_INVALID_STA
)

4277 
	`iwl_mvm_öt_°a_modify_dißbÀ_tx
(
mvm
, 
mvmvif
,

4278 &
mvmvif
->
deÊök
.
mˇ°_°a
,

4279 
dißbÀ
);

4285 i‡(!
dißbÀ
 && 
mvmvif
->
deÊök
.
bˇ°_°a
.
°a_id
 !
IWL_MVM_INVALID_STA
)

4286 
	`iwl_mvm_öt_°a_modify_dißbÀ_tx
(
mvm
, 
mvmvif
,

4287 &
mvmvif
->
deÊök
.
bˇ°_°a
,

4288 
dißbÀ
);

4289 
	}
}

4291 
	$iwl_mvm_cß_˛õ¡_ab£¡
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

4293 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4294 
iwl_mvm_°a
 *
mvm°a
;

4296 
	`rcu_ªad_lock
();

4298 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_rcu
(
mvm
, 
mvmvif
->
deÊök
.
≠_°a_id
);

4300 i‡(
mvm°a
)

4301 
	`iwl_mvm_°a_modify_dißbÀ_tx
(
mvm
, 
mvm°a
, 
åue
);

4303 
	`rcu_ªad_u∆ock
();

4304 
	}
}

4306 
u16
 
	$iwl_mvm_tid_queued
(
iwl_mvm
 *
mvm
, 
iwl_mvm_tid_d©a
 *
tid_d©a
)

4308 
u16
 
¢
 = 
	`IEEE80211_SEQ_TO_SN
(
tid_d©a
->
£q_numbî
);

4314 i‡(
mvm
->
å™s
->
å™s_cfg
->
gí2
)

4315 
¢
 &= 0xff;

4317  
	`õì80211_¢_sub
(
¢
, 
tid_d©a
->
√xt_ª˛aimed
);

4318 
	}
}

4320 
	$iwl_mvm_add_∑¢_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

4321 
iwl_mvm_öt_°a
 *
°a
, 
u8
 *
addr
, 
u32
 
cùhî
,

4322 
u8
 *
key
, 
u32
 
key_Àn
,

4323 
õì80211_key_c⁄f
 *
keyc⁄f
)

4325 
ªt
;

4326 
u16
 
queue
;

4327 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

4328 
wdg_timeout
 =

4329 
	`iwl_mvm_gë_wd_timeout
(
mvm
, 
vif
, 
Ál£
, false);

4330 
boﬁ
 
mld
 = 
	`iwl_mvm_has_mld_≠i
(
mvm
->
fw
);

4331 
u32
 
ty≥
 = 
mld
 ? 
STATION_TYPE_PEER
 : 
IWL_STA_LINK
;

4333 
ªt
 = 
	`iwl_mvm_Æloˇã_öt_°a
(
mvm
, 
°a
, 0,

4334 
NL80211_IFTYPE_UNSPECIFIED
, 
ty≥
);

4335 i‡(
ªt
)

4336  
ªt
;

4338 i‡(
mld
)

4339 
ªt
 = 
	`iwl_mvm_mld_add_öt_°a_wôh_queue
(
mvm
, 
°a
, 
addr
,

4340 
mvmvif
->
deÊök
.
fw_lök_id
,

4341 &
queue
,

4342 
IWL_MAX_TID_COUNT
,

4343 &
wdg_timeout
);

4345 
ªt
 = 
	`iwl_mvm_add_öt_°a_wôh_queue
(
mvm
, 
mvmvif
->
id
,

4346 
mvmvif
->
cﬁ‹
, 
addr
, 
°a
,

4347 &
queue
,

4348 
IWL_MVM_TX_FIFO_BE
);

4349 i‡(
ªt
)

4350 
out
;

4352 
keyc⁄f
->
cùhî
 = cipher;

4353 
	`mem˝y
(
keyc⁄f
->
key
, key, 
key_Àn
);

4354 
keyc⁄f
->
keyÀn
 = 
key_Àn
;

4355 
keyc⁄f
->
Êags
 = 
IEEE80211_KEY_FLAG_PAIRWISE
;

4357 i‡(
mld
) {

4361 
u32
 
key_Êags
 =

4362 
	`iwl_mvm_gë_£c_Êags
(
mvm
, 
vif
, 
NULL
, 
keyc⁄f
) |

4363 
IWL_SEC_KEY_FLAG_MFP
;

4364 
u32
 
°a_mask
 = 
	`BIT
(
°a
->
°a_id
);

4366 
ªt
 = 
	`iwl_mvm_mld_£nd_key
(
mvm
, 
°a_mask
, 
key_Êags
, 
keyc⁄f
);

4368 
ªt
 = 
	`iwl_mvm_£nd_°a_key
(
mvm
, 
°a
->
°a_id
, 
keyc⁄f
, 
Ál£
,

4369 0, 
NULL
, 0, 0, 
åue
);

4372 
out
:

4373 i‡(
ªt
)

4374 
	`iwl_mvm_dóŒoc_öt_°a
(
mvm
, 
°a
);

4375  
ªt
;

4376 
	}
}

4378 
	$iwl_mvm_ˇn˚l_ch™√l_swôch
(
iwl_mvm
 *
mvm
,

4379 
õì80211_vif
 *
vif
,

4380 
u32
 
id
)

4382 
iwl_ˇn˚l_ch™√l_swôch_cmd
 
ˇn˚l_ch™√l_swôch_cmd
 = {

4383 .
id
 = 
	`˝u_to_À32
(id),

4385 
ªt
;

4387 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

4388 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
CANCEL_CHANNEL_SWITCH_CMD
),

4389 
CMD_ASYNC
,

4390 (
ˇn˚l_ch™√l_swôch_cmd
),

4391 &
ˇn˚l_ch™√l_swôch_cmd
);

4392 i‡(
ªt
)

4393 
	`IWL_ERR
(
mvm
, "FailedÅo cancelÅhe channel switch\n");

4394 
	}
}

	@mvm/sta.h

7 #i‚de‡
__°a_h__


8 
	#__°a_h__


	)

10 
	~<löux/•ölock.h
>

11 
	~<√t/mac80211.h
>

12 
	~<löux/waô.h
>

14 
	~"iwl-å™s.h
"

15 
	~"fw-≠i.h
"

16 
	~"rs.h
"

18 
	giwl_mvm
;

19 
	giwl_mvm_vif
;

231 
	eiwl_mvm_agg_°©e
 {

232 
	mIWL_AGG_OFF
 = 0,

233 
	mIWL_AGG_QUEUED
,

234 
	mIWL_AGG_STARTING
,

235 
	mIWL_AGG_ON
,

236 
	mIWL_EMPTYING_HW_QUEUE_ADDBA
,

237 
	mIWL_EMPTYING_HW_QUEUE_DELBA
,

261 
	siwl_mvm_tid_d©a
 {

262 
u16
 
	m£q_numbî
;

263 
u16
 
	m√xt_ª˛aimed
;

265 
u32
 
	møã_n_Êags
;

266 
u8
 
	mlq_cﬁ‹
;

267 
boﬁ
 
	mamsdu_ö_ampdu_Ælowed
;

268 
iwl_mvm_agg_°©e
 
	m°©e
;

269 
u16
 
	mtxq_id
;

270 
u16
 
	ms¢
;

271 
u16
 
	mtx_time
;

272 
	mçt_mós_°¨t
;

273 
u32
 
	mtx_cou¡_œ°
;

274 
u32
 
	mtx_cou¡
;

277 
	siwl_mvm_key_≤
 {

278 
rcu_hód
 
	mrcu_hód
;

280 
u8
 
	m≤
[
IWL_MAX_TID_COUNT
][
IEEE80211_CCMP_PN_LEN
];

281 } 
____ˇchñöe_Æig√d_ö_smp
 
	mq
[];

290 
	eiwl_mvm_rxq_nŸif_ty≥
 {

291 
	mIWL_MVM_RXQ_EMPTY
,

292 
	mIWL_MVM_RXQ_NOTIF_DEL_BA
,

305 
	siwl_mvm_öã∫Æ_rxq_nŸif
 {

306 
u16
 
	mty≥
;

307 
u16
 
	msync
;

308 
u32
 
	mcookõ
;

309 
u8
 
	md©a
[];

310 } 
	g__∑cked
;

312 
	siwl_mvm_dñba_d©a
 {

313 
u32
 
	mbaid
;

314 } 
	g__∑cked
;

321 
	siwl_mvm_rxq_dup_d©a
 {

322 
__À16
 
	mœ°_£q
[
IWL_MAX_TID_COUNT
 + 1];

323 
u8
 
	mœ°_sub_‰ame
[
IWL_MAX_TID_COUNT
 + 1];

324 } 
	g____ˇchñöe_Æig√d_ö_smp
;

337 
	siwl_mvm_lök_°a
 {

338 
rcu_hód
 
	mrcu_hód
;

339 
u32
 
	m°a_id
;

341 
iwl_lq_°a_rs_fw
 
	mrs_fw
;

342 
iwl_lq_°a
 
	mrs_drv
;

343 } 
	mlq_°a
;

345 
u16
 
	m‹ig_amsdu_Àn
;

347 
u8
 
	mavg_íîgy
;

403 
	siwl_mvm_°a
 {

404 
u32
 
	mtfd_queue_msk
;

405 
u32
 
	mmac_id_n_cﬁ‹
;

406 
u16
 
	mtid_dißbÀ_agg
;

407 
u8
 
	m°a_ty≥
;

408 
õì80211_°a_°©e
 
	m°a_°©e
;

409 
boﬁ
 
	mbt_ªdu˚d_txpowî
;

410 
boﬁ
 
	m√xt_°©us_eo•
;

411 
boﬁ
 
	mauth‹ized
;

412 
•ölock_t
 
	mlock
;

413 
iwl_mvm_tid_d©a
 
	mtid_d©a
[
IWL_MAX_TID_COUNT
 + 1];

414 
u8
 
	mtid_to_baid
[
IWL_MAX_TID_COUNT
];

415 
õì80211_vif
 *
	mvif
;

416 
iwl_mvm_key_≤
 
__rcu
 *
	m±k_≤
[4];

417 
iwl_mvm_rxq_dup_d©a
 *
	mdup_d©a
;

419 
u8
 
	mª£rved_queue
;

422 
s8
 
	mtx_¥Ÿe˘i⁄
;

423 
boﬁ
 
	mâ_tx_¥Ÿe˘i⁄
;

425 
boﬁ
 
	mdißbÀ_tx
;

426 
u16
 
	mamsdu_íabÀd
;

427 
u16
 
	mmax_amsdu_Àn
;

428 
boﬁ
 
	m¶ìpög
;

429 
u8
 
	magg_tids
;

430 
u8
 
	m¶ìp_tx_cou¡
;

431 
u8
 
	mtx_™t
;

432 
u32
 
	m∑úwi£_cùhî
;

434 
iwl_mvm_lök_°a
 
	mdeÊök
;

435 
iwl_mvm_lök_°a
 
__rcu
 *
	mlök
[
IEEE80211_MLD_MAX_NUM_LINKS
];

438 
u16
 
iwl_mvm_tid_queued
(
iwl_mvm
 *
mvm
, 
iwl_mvm_tid_d©a
 *
tid_d©a
);

440 
ölöe
 
iwl_mvm_°a
 *

441 
	$iwl_mvm_°a_‰om_mac80211
(
õì80211_°a
 *
°a
)

443  (*)
°a
->
drv_¥iv
;

444 
	}
}

453 
	siwl_mvm_öt_°a
 {

454 
u32
 
	m°a_id
;

455 
u8
 
	mty≥
;

456 
u32
 
	mtfd_queue_msk
;

469 
iwl_mvm_°a_£nd_to_fw
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

470 
boﬁ
 
upd©e
, 
Êags
);

471 
iwl_mvm_föd_‰ì_°a_id
(
iwl_mvm
 *
mvm
, 
∆80211_i·y≥
 
i·y≥
);

472 
iwl_mvm_°a_öô
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

473 
õì80211_°a
 *
°a
, 
°a_id
, 
u8
 
°a_ty≥
);

474 
iwl_mvm_add_°a
(
iwl_mvm
 *
mvm
,

475 
õì80211_vif
 *
vif
,

476 
õì80211_°a
 *
°a
);

478 
ölöe
 
	$iwl_mvm_upd©e_°a
(
iwl_mvm
 *
mvm
,

479 
õì80211_vif
 *
vif
,

480 
õì80211_°a
 *
°a
)

482  
	`iwl_mvm_°a_£nd_to_fw
(
mvm
, 
°a
, 
åue
, 0);

483 
	}
}

485 
iwl_mvm_ªÆloc_queues_a·î_ª°¨t
(
iwl_mvm
 *
mvm
,

486 
õì80211_°a
 *
°a
);

487 
iwl_mvm_waô_°a_queues_em±y
(
iwl_mvm
 *
mvm
,

488 
iwl_mvm_°a
 *
mvm_°a
);

489 
boﬁ
 
iwl_mvm_°a_dñ
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

490 
õì80211_°a
 *
°a
,

491 
õì80211_lök_°a
 *
lök_°a
, *
ªt
);

492 
iwl_mvm_rm_°a
(
iwl_mvm
 *
mvm
,

493 
õì80211_vif
 *
vif
,

494 
õì80211_°a
 *
°a
);

495 
iwl_mvm_rm_°a_id
(
iwl_mvm
 *
mvm
,

496 
õì80211_vif
 *
vif
,

497 
u8
 
°a_id
);

498 
iwl_mvm_£t_°a_key
(
iwl_mvm
 *
mvm
,

499 
õì80211_vif
 *
vif
,

500 
õì80211_°a
 *
°a
,

501 
õì80211_key_c⁄f
 *
keyc⁄f
,

502 
u8
 
key_off£t
);

503 
iwl_mvm_ªmove_°a_key
(
iwl_mvm
 *
mvm
,

504 
õì80211_vif
 *
vif
,

505 
õì80211_°a
 *
°a
,

506 
õì80211_key_c⁄f
 *
keyc⁄f
);

508 
iwl_mvm_upd©e_tkù_key
(
iwl_mvm
 *
mvm
,

509 
õì80211_vif
 *
vif
,

510 
õì80211_key_c⁄f
 *
keyc⁄f
,

511 
õì80211_°a
 *
°a
, 
u32
 
iv32
,

512 
u16
 *
pha£1key
);

514 
iwl_mvm_rx_eo•_nŸif
(
iwl_mvm
 *
mvm
,

515 
iwl_rx_cmd_buf„r
 *
rxb
);

518 
iwl_mvm_°a_rx_agg
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

519 
tid
, 
u16
 
s¢
, 
boﬁ
 
°¨t
, u16 
buf_size
, u16 
timeout
);

520 
iwl_mvm_°a_tx_agg_°¨t
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

521 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 *
s¢
);

522 
iwl_mvm_°a_tx_agg_›î
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

523 
õì80211_°a
 *
°a
, 
u16
 
tid
, u16 
buf_size
,

524 
boﬁ
 
amsdu
);

525 
iwl_mvm_°a_tx_agg_°›
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

526 
õì80211_°a
 *
°a
, 
u16
 
tid
);

527 
iwl_mvm_°a_tx_agg_Êush
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

528 
õì80211_°a
 *
°a
, 
u16
 
tid
);

530 
iwl_mvm_°a_tx_agg
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

531 
tid
, 
u8
 
queue
, 
boﬁ
 
°¨t
);

533 
iwl_mvm_add_aux_°a
(
iwl_mvm
 *
mvm
, 
u32
 
lmac_id
);

534 
iwl_mvm_rm_aux_°a
(
iwl_mvm
 *
mvm
);

536 
iwl_mvm_Æloc_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

537 
iwl_mvm_‰ì_bˇ°_°a_queues
(
iwl_mvm
 *
mvm
,

538 
õì80211_vif
 *
vif
);

539 
iwl_mvm_£nd_add_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

540 
iwl_mvm_add_p2p_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

541 
iwl_mvm_£nd_rm_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

542 
iwl_mvm_rm_p2p_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

543 
iwl_mvm_add_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

544 
iwl_mvm_rm_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

545 
iwl_mvm_Æloˇã_öt_°a
(
iwl_mvm
 *
mvm
,

546 
iwl_mvm_öt_°a
 *
°a
,

547 
u32
 
qmask
, 
∆80211_i·y≥
 
i·y≥
,

548 
u8
 
ty≥
);

549 
iwl_mvm_dóŒoc_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

550 
iwl_mvm_dóŒoc_öt_°a
(
iwl_mvm
 *
mvm
, 
iwl_mvm_öt_°a
 *
°a
);

551 
iwl_mvm_add_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

552 
iwl_mvm_rm_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

553 
iwl_mvm_dóŒoc_¢if_°a
(
iwl_mvm
 *
mvm
);

555 
iwl_mvm_°a_modify_ps_wake
(
iwl_mvm
 *
mvm
,

556 
õì80211_°a
 *
°a
);

557 
iwl_mvm_°a_modify_¶ìp_tx_cou¡
(
iwl_mvm
 *
mvm
,

558 
õì80211_°a
 *
°a
,

559 
õì80211_‰ame_ªÀa£_ty≥
 
ªas⁄
,

560 
u16
 
˙t
, u16 
tids
, 
boﬁ
 
m‹e_d©a
,

561 
boﬁ
 
sögÀ_°a_queue
);

562 
iwl_mvm_døö_°a
(
iwl_mvm
 *
mvm
, 
iwl_mvm_°a
 *
mvm°a
,

563 
boﬁ
 
døö
);

564 
iwl_mvm_°a_modify_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

565 
iwl_mvm_°a
 *
mvm°a
, 
boﬁ
 
dißbÀ
);

566 
iwl_mvm_°a_modify_dißbÀ_tx_≠
(
iwl_mvm
 *
mvm
,

567 
õì80211_°a
 *
°a
,

568 
boﬁ
 
dißbÀ
);

569 
iwl_mvm_modify_Æl_°a_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

570 
iwl_mvm_vif
 *
mvmvif
,

571 
boﬁ
 
dißbÀ
);

573 
iwl_mvm_cß_˛õ¡_ab£¡
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

574 
iwl_mvm_°a_ísuª_queue
(
iwl_mvm
 *
mvm
, 
õì80211_txq
 *
txq
);

575 
iwl_mvm_add_√w_dqa_°ªam_wk
(
w‹k_°ru˘
 *
wk
);

576 
iwl_mvm_add_∑¢_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

577 
iwl_mvm_öt_°a
 *
°a
, 
u8
 *
addr
, 
u32
 
cùhî
,

578 
u8
 *
key
, 
u32
 
key_Àn
,

579 
õì80211_key_c⁄f
 *
key_c⁄f_out
);

580 
iwl_mvm_ˇn˚l_ch™√l_swôch
(
iwl_mvm
 *
mvm
,

581 
õì80211_vif
 *
vif
,

582 
u32
 
id
);

584 
iwl_mvm_tvqm_íabÀ_txq
(
iwl_mvm
 *
mvm
,

585 
õì80211_°a
 *
°a
,

586 
u8
 
°a_id
, u8 
tid
, 
timeout
);

602 
	siwl_mvm_°a_°©e_›s
 {

603 (*
	madd_°a
)(
iwl_mvm
 *
	mmvm
, 
õì80211_vif
 *
	mvif
,

604 
õì80211_°a
 *
	m°a
);

605 (*
	mupd©e_°a
)(
iwl_mvm
 *
	mmvm
, 
õì80211_vif
 *
	mvif
,

606 
õì80211_°a
 *
	m°a
);

607 (*
	mrm_°a
)(
iwl_mvm
 *
	mmvm
, 
õì80211_vif
 *
	mvif
,

608 
õì80211_°a
 *
	m°a
);

609 (*
	mmac_˘xt_ch™ged
)(
iwl_mvm
 *
	mmvm
, 
õì80211_vif
 *
	mvif
,

610 
boﬁ
 
	mf‹˚_assoc_off
);

613 
iwl_mvm_mac_°a_°©e_comm⁄
(
õì80211_hw
 *
hw
,

614 
õì80211_vif
 *
vif
,

615 
õì80211_°a
 *
°a
,

616 
õì80211_°a_°©e
 
ﬁd_°©e
,

617 
õì80211_°a_°©e
 
√w_°©e
,

618 c⁄° 
iwl_mvm_°a_°©e_›s
 *
ˇŒbacks
);

622 
iwl_mvm_mld_add_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

623 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

624 
iwl_mvm_mld_add_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

625 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

626 
iwl_mvm_mld_add_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

627 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

628 
iwl_mvm_mld_add_aux_°a
(
iwl_mvm
 *
mvm
, 
u32
 
lmac_id
);

629 
iwl_mvm_mld_rm_bˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

630 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

631 
iwl_mvm_mld_rm_¢if_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

632 
iwl_mvm_mld_rm_mˇ°_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

633 
õì80211_bss_c⁄f
 *
lök_c⁄f
);

634 
iwl_mvm_mld_rm_aux_°a
(
iwl_mvm
 *
mvm
);

635 
iwl_mvm_mld_add_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

636 
õì80211_°a
 *
°a
);

637 
iwl_mvm_mld_upd©e_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

638 
õì80211_°a
 *
°a
);

639 
iwl_mvm_mld_rm_°a
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

640 
õì80211_°a
 *
°a
);

641 
iwl_mvm_mld_rm_°a_id
(
iwl_mvm
 *
mvm
, 
u8
 
°a_id
);

642 
iwl_mvm_mld_upd©e_°a_löks
(
iwl_mvm
 *
mvm
,

643 
õì80211_vif
 *
vif
,

644 
õì80211_°a
 *
°a
,

645 
u16
 
ﬁd_löks
, u16 
√w_löks
);

646 
u32
 
iwl_mvm_°a_fw_id_mask
(
iwl_mvm
 *
mvm
, 
õì80211_°a
 *
°a
,

647 
fûãr_lök_id
);

648 
iwl_mvm_mld_add_öt_°a_wôh_queue
(
iwl_mvm
 *
mvm
,

649 
iwl_mvm_öt_°a
 *
°a
,

650 c⁄° 
u8
 *
addr
, 
lök_id
,

651 
u16
 *
queue
, 
u8
 
tid
,

652 *
_wdg_timeout
);

655 
iwl_mvm_mld_modify_Æl_°a_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

656 
iwl_mvm_vif
 *
mvmvif
,

657 
boﬁ
 
dißbÀ
);

658 
iwl_mvm_mld_°a_modify_dißbÀ_tx
(
iwl_mvm
 *
mvm
,

659 
iwl_mvm_°a
 *
mvm_°a
,

660 
boﬁ
 
dißbÀ
);

661 
iwl_mvm_mld_°a_modify_dißbÀ_tx_≠
(
iwl_mvm
 *
mvm
,

662 
õì80211_°a
 *
°a
,

663 
boﬁ
 
dißbÀ
);

	@mvm/tdls.c

7 
	~<löux/ëhîdevi˚.h
>

8 
	~"mvm.h
"

9 
	~"time-evít.h
"

10 
	~"iwl-io.h
"

11 
	~"iwl-¥ph.h
"

13 
	#TU_TO_US
(
x
Ë(x * 1024)

	)

14 
	#TU_TO_MS
(
x
Ë(
	`TU_TO_US
(xË/ 1000)

	)

16 
	$iwl_mvm_ã¨down_tdls_≥îs
(
iwl_mvm
 *
mvm
)

18 
õì80211_°a
 *
°a
;

19 
iwl_mvm_°a
 *
mvm°a
;

20 
i
;

22 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

24 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

25 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
i
],

26 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

27 i‡(!
°a
 || 
	`IS_ERR
(°aË|| !°a->
tdls
)

30 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

31 
	`õì80211_tdls_›î_ªque°
(
mvm°a
->
vif
, 
°a
->
addr
,

32 
NL80211_TDLS_TEARDOWN
,

33 
WLAN_REASON_TDLS_TEARDOWN_UNSPECIFIED
,

34 
GFP_KERNEL
);

36 
	}
}

38 
	$iwl_mvm_tdls_°a_cou¡
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

40 
õì80211_°a
 *
°a
;

41 
iwl_mvm_°a
 *
mvm°a
;

42 
cou¡
 = 0;

43 
i
;

45 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

47 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

48 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
i
],

49 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

50 i‡(!
°a
 || 
	`IS_ERR
(°aË|| !°a->
tdls
)

53 i‡(
vif
) {

54 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

55 i‡(
mvm°a
->
vif
 != vif)

59 
cou¡
++;

62  
cou¡
;

63 
	}
}

65 
	$iwl_mvm_tdls_c⁄fig
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

67 
iwl_rx_∑ckë
 *
pkt
;

68 
iwl_tdls_c⁄fig_ªs
 *
ª•
;

69 
iwl_tdls_c⁄fig_cmd
 
tdls_cfg_cmd
 = {};

70 
iwl_ho°_cmd
 
cmd
 = {

71 .
id
 = 
TDLS_CONFIG_CMD
,

72 .
Êags
 = 
CMD_WANT_SKB
,

73 .
d©a
 = { &
tdls_cfg_cmd
, },

74 .
Àn
 = { (
iwl_tdls_c⁄fig_cmd
), },

76 
õì80211_°a
 *
°a
;

77 
ªt
, 
i
, 
˙t
;

78 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

80 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

82 
tdls_cfg_cmd
.
id_™d_cﬁ‹
 =

83 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
));

84 
tdls_cfg_cmd
.
tx_to_≠_tid
 = 
IWL_MVM_TDLS_FW_TID
;

85 
tdls_cfg_cmd
.
tx_to_≠_s¢
 = 
	`˝u_to_À16
(0);

90 
˙t
 = 0;

91 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

92 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
i
],

93 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

94 i‡(
	`IS_ERR_OR_NULL
(
°a
Ë|| !°a->
tdls
)

97 
tdls_cfg_cmd
.
°a_öfo
[
˙t
].
°a_id
 = 
i
;

98 
tdls_cfg_cmd
.
°a_öfo
[
˙t
].
tx_to_≥î_tid
 =

99 
IWL_MVM_TDLS_FW_TID
;

100 
tdls_cfg_cmd
.
°a_öfo
[
˙t
].
tx_to_≥î_s¢
 = 
	`˝u_to_À16
(0);

101 
tdls_cfg_cmd
.
°a_öfo
[
˙t
].
is_öôüt‹
 =

102 
	`˝u_to_À32
(
°a
->
tdls_öôüt‹
 ? 1 : 0);

104 
˙t
++;

107 
tdls_cfg_cmd
.
tdls_≥î_cou¡
 = 
˙t
;

108 
	`IWL_DEBUG_TDLS
(
mvm
, "£nd TDLS c⁄figÅÿFW f‹ %dÖìrs\n", 
˙t
);

110 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

111 i‡(
	`WARN_ON_ONCE
(
ªt
))

114 
pkt
 = 
cmd
.
ª•_pkt
;

116 
	`WARN_ON_ONCE
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
Ë!(*
ª•
));

120 
	`iwl_‰ì_ª•
(&
cmd
);

121 
	}
}

123 
	$iwl_mvm_ªˇlc_tdls_°©e
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

124 
boﬁ
 
°a_added
)

126 
tdls_°a_˙t
 = 
	`iwl_mvm_tdls_°a_cou¡
(
mvm
, 
vif
);

129 i‡(
tdls_°a_˙t
 =1 && 
°a_added
)

130 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

137 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

138 
IWL_UCODE_TLV_CAPA_TDLS_CHANNEL_SWITCH
))

139 
	`iwl_mvm_tdls_c⁄fig
(
mvm
, 
vif
);

142 i‡(
tdls_°a_˙t
 =0 && !
°a_added
)

143 
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

144 
	}
}

146 
	$iwl_mvm_mac_mgd_¥Ÿe˘_tdls_discovî
(
õì80211_hw
 *
hw
,

147 
õì80211_vif
 *
vif
,

148 
lök_id
)

150 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

151 
u32
 
duøti⁄
 = 2 * 
vif
->
bss_c⁄f
.
dtim_≥riod
 * vif->bss_c⁄f.
bóc⁄_öt
;

153 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

156 
	`muãx_lock
(&
mvm
->
muãx
);

157 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

158 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
))

159 
	`iwl_mvm_scheduÀ_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
, 
duøti⁄
,

160 
duøti⁄
, 
åue
, 
lök_id
);

162 
	`iwl_mvm_¥Ÿe˘_£ssi⁄
(
mvm
, 
vif
, 
duøti⁄
,

163 
duøti⁄
, 100, 
åue
);

164 
	`muãx_u∆ock
(&
mvm
->
muãx
);

165 
	}
}

168 
	$iwl_mvm_tdls_cs_°©e_°r
(
iwl_mvm_tdls_cs_°©e
 
°©e
)

170 
°©e
) {

171 
IWL_MVM_TDLS_SW_IDLE
:

173 
IWL_MVM_TDLS_SW_REQ_SENT
:

175 
IWL_MVM_TDLS_SW_RESP_RCVD
:

177 
IWL_MVM_TDLS_SW_REQ_RCVD
:

179 
IWL_MVM_TDLS_SW_ACTIVE
:

183  
NULL
;

184 
	}
}

186 
	$iwl_mvm_tdls_upd©e_cs_°©e
(
iwl_mvm
 *
mvm
,

187 
iwl_mvm_tdls_cs_°©e
 
°©e
)

189 i‡(
mvm
->
tdls_cs
.
°©e
 == state)

192 
	`IWL_DEBUG_TDLS
(
mvm
, "TDLS channel switch state: %s -> %s\n",

193 
	`iwl_mvm_tdls_cs_°©e_°r
(
mvm
->
tdls_cs
.
°©e
),

194 
	`iwl_mvm_tdls_cs_°©e_°r
(
°©e
));

195 
mvm
->
tdls_cs
.
°©e
 = state;

198 i‡(
°©e
 =
IWL_MVM_TDLS_SW_REQ_SENT
)

199 
mvm
->
tdls_cs
.
≥î
.
£¡_time°amp
 = 
	`iwl_mvm_gë_sy°ime
(mvm);

201 i‡(
°©e
 =
IWL_MVM_TDLS_SW_IDLE
)

202 
mvm
->
tdls_cs
.
cur_°a_id
 = 
IWL_MVM_INVALID_STA
;

203 
	}
}

205 
	$iwl_mvm_rx_tdls_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

207 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

208 
iwl_tdls_ch™√l_swôch_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

209 
õì80211_°a
 *
°a
;

210 
dñay
;

211 
iwl_mvm_°a
 *
mvm°a
;

212 
õì80211_vif
 *
vif
;

213 
u32
 
°a_id
 = 
	`À32_to_˝u
(
nŸif
->sta_id);

215 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

218 i‡(!
	`À32_to_˝u
(
nŸif
->
°©us
)) {

219 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
, 
IWL_MVM_TDLS_SW_IDLE
);

223 i‡(
	`WARN_ON
(
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
))

226 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(
mvm
->
fw_id_to_mac_id
[
°a_id
],

227 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

229 i‡(
	`IS_ERR_OR_NULL
(
°a
Ë|| 
	`WARN_ON
(!°a->
tdls
))

232 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

233 
vif
 = 
mvm°a
->vif;

239 
dñay
 = 
	`TU_TO_MS
(
vif
->
bss_c⁄f
.
dtim_≥riod
 * vif->bss_c⁄f.
bóc⁄_öt
);

240 
	`mod_dñayed_w‹k
(
sy°em_wq
, &
mvm
->
tdls_cs
.
dw‹k
,

241 
	`m£cs_to_jiffõs
(
dñay
));

243 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
, 
IWL_MVM_TDLS_SW_ACTIVE
);

244 
	}
}

247 
	$iwl_mvm_tdls_check_a˘i⁄
(
iwl_mvm
 *
mvm
,

248 
iwl_tdls_ch™√l_swôch_ty≥
 
ty≥
,

249 c⁄° 
u8
 *
≥î
, 
boﬁ
 
≥î_öôüt‹
, 
u32
 
time°amp
)

251 
boﬁ
 
ßme_≥î
 = 
Ál£
;

252 
ªt
 = 0;

255 i‡(
mvm
->
tdls_cs
.
°©e
 !
IWL_MVM_TDLS_SW_IDLE
 &&

256 
mvm
->
tdls_cs
.
cur_°a_id
 !
IWL_MVM_INVALID_STA
) {

257 
õì80211_°a
 *
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

258 
mvm
->
fw_id_to_mac_id
[mvm->
tdls_cs
.
cur_°a_id
],

259 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

260 i‡(!
	`IS_ERR_OR_NULL
(
°a
))

261 
ßme_≥î
 = 
	`ëhî_addr_equÆ
(
≥î
, 
°a
->
addr
);

264 
mvm
->
tdls_cs
.
°©e
) {

265 
IWL_MVM_TDLS_SW_IDLE
:

270 i‡(
ty≥
 =
TDLS_MOVE_CH
)

271 
ªt
 = -
EINVAL
;

273 
IWL_MVM_TDLS_SW_REQ_SENT
:

275 i‡(!
ßme_≥î
)

276 
ªt
 = -
EBUSY
;

277 i‡(
ty≥
 =
TDLS_SEND_CHAN_SW_RESP_AND_MOVE_CH
 &&

278 !
≥î_öôüt‹
)

284 
ªt
 = -
EBUSY
;

285 i‡(
ty≥
 =
TDLS_SEND_CHAN_SW_REQ
)

287 
ªt
 = -
EBUSY
;

288 i‡(
time°amp
 <
mvm
->
tdls_cs
.
≥î
.
£¡_time°amp
)

290 
ªt
 = -
EINVAL
;

292 
IWL_MVM_TDLS_SW_RESP_RCVD
:

297 
ªt
 = -
EBUSY
;

299 
IWL_MVM_TDLS_SW_REQ_RCVD
:

301 i‡(
ty≥
 =
TDLS_SEND_CHAN_SW_REQ
) {

302 i‡(!
ßme_≥î
)

303 
ªt
 = -
EBUSY
;

304 i‡(
≥î_öôüt‹
)

305 
ªt
 = -
EBUSY
;

306 } i‡(
ty≥
 =
TDLS_MOVE_CH
) {

307 
ªt
 = -
EINVAL
;

310 
IWL_MVM_TDLS_SW_ACTIVE
:

315 i‡(
ty≥
 !
TDLS_MOVE_CH
 || !
ßme_≥î
)

316 
ªt
 = -
EBUSY
;

320 i‡(
ªt
)

321 
	`IWL_DEBUG_TDLS
(
mvm
,

323 
ty≥
, 
mvm
->
tdls_cs
.
°©e
, 
≥î
, 
ßme_≥î
,

324 
≥î_öôüt‹
);

326  
ªt
;

327 
	}
}

330 
	$iwl_mvm_tdls_c⁄fig_ch™√l_swôch
(
iwl_mvm
 *
mvm
,

331 
õì80211_vif
 *
vif
,

332 
iwl_tdls_ch™√l_swôch_ty≥
 
ty≥
,

333 c⁄° 
u8
 *
≥î
, 
boﬁ
 
≥î_öôüt‹
,

334 
u8
 
›î_˛ass
,

335 
cfg80211_ch™_def
 *
ch™def
,

336 
u32
 
time°amp
, 
u16
 
swôch_time
,

337 
u16
 
swôch_timeout
, 
sk_buff
 *
skb
,

338 
u32
 
ch_sw_tm_õ
)

340 
õì80211_°a
 *
°a
;

341 
iwl_mvm_°a
 *
mvm°a
;

342 
õì80211_tx_öfo
 *
öfo
;

343 
õì80211_hdr
 *
hdr
;

344 
iwl_tdls_ch™√l_swôch_cmd
 
cmd
 = {0};

345 
iwl_tdls_ch™√l_swôch_cmd_èû
 *
èû
 =

346 
	`iwl_mvm_ch™_öfo_cmd_èû
(
mvm
, &
cmd
.
ci
);

347 
u16
 
Àn
 = (
cmd
Ë- 
	`iwl_mvm_ch™_öfo_∑ddög
(
mvm
);

348 
ªt
;

350 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

352 
ªt
 = 
	`iwl_mvm_tdls_check_a˘i⁄
(
mvm
, 
ty≥
, 
≥î
, 
≥î_öôüt‹
,

353 
time°amp
);

354 i‡(
ªt
)

355  
ªt
;

357 i‡(!
skb
 || 
	`WARN_ON
(skb->
Àn
 > 
IWL_TDLS_CH_SW_FRAME_MAX_SIZE
)) {

358 
ªt
 = -
EINVAL
;

359 
out
;

362 
cmd
.
swôch_ty≥
 = 
ty≥
;

363 
èû
->
timög
.
‰ame_time°amp
 = 
	`˝u_to_À32
(
time°amp
);

364 
èû
->
timög
.
swôch_time
 = 
	`˝u_to_À32
(switch_time);

365 
èû
->
timög
.
swôch_timeout
 = 
	`˝u_to_À32
(switch_timeout);

367 
	`rcu_ªad_lock
();

368 
°a
 = 
	`õì80211_föd_°a
(
vif
, 
≥î
);

369 i‡(!
°a
) {

370 
	`rcu_ªad_u∆ock
();

371 
ªt
 = -
ENOENT
;

372 
out
;

374 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

375 
cmd
.
≥î_°a_id
 = 
	`˝u_to_À32
(
mvm°a
->
deÊök
.
°a_id
);

377 i‡(!
ch™def
) {

378 i‡(
mvm
->
tdls_cs
.
°©e
 =
IWL_MVM_TDLS_SW_REQ_SENT
 &&

379 
mvm
->
tdls_cs
.
≥î
.
ch™def
.
ch™
) {

381 
ch™def
 = &
mvm
->
tdls_cs
.
≥î
.chandef;

382 } i‡(
mvm
->
tdls_cs
.
°©e
 =
IWL_MVM_TDLS_SW_ACTIVE
 &&

383 
ty≥
 =
TDLS_MOVE_CH
) {

385 
õì80211_ch™˘x_c⁄f
 *
ch™˘x
 =

386 
	`rcu_dîe„ªn˚
(
vif
->
bss_c⁄f
.
ch™˘x_c⁄f
);

388 i‡(
	`WARN_ON_ONCE
(!
ch™˘x
)) {

389 
	`rcu_ªad_u∆ock
();

390 
out
;

393 
ch™def
 = &
ch™˘x
->
def
;

397 i‡(
ch™def
)

398 
	`iwl_mvm_£t_ch™_öfo_ch™def
(
mvm
, &
cmd
.
ci
, 
ch™def
);

401 
èû
->
timög
.
max_offch™_duøti⁄
 =

402 
	`˝u_to_À32
(
	`TU_TO_US
(
vif
->
bss_c⁄f
.
dtim_≥riod
 *

403 
vif
->
bss_c⁄f
.
bóc⁄_öt
) / 2);

406 
èû
->
‰ame
.
swôch_time_off£t
 = 
	`˝u_to_À32
(
ch_sw_tm_õ
 + 2);

408 
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

409 
hdr
 = (*)
skb
->
d©a
;

410 i‡(
öfo
->
c⁄åﬁ
.
hw_key
) {

411 i‡(
öfo
->
c⁄åﬁ
.
hw_key
->
cùhî
 !
WLAN_CIPHER_SUITE_CCMP
) {

412 
	`rcu_ªad_u∆ock
();

413 
ªt
 = -
EINVAL
;

414 
out
;

416 
	`iwl_mvm_£t_tx_cmd_ccmp
(
öfo
, &
èû
->
‰ame
.
tx_cmd
);

419 
	`iwl_mvm_£t_tx_cmd
(
mvm
, 
skb
, &
èû
->
‰ame
.
tx_cmd
, 
öfo
,

420 
mvm°a
->
deÊök
.
°a_id
);

422 
	`iwl_mvm_£t_tx_cmd_øã
(
mvm
, &
èû
->
‰ame
.
tx_cmd
, 
öfo
, 
°a
,

423 
hdr
->
‰ame_c⁄åﬁ
);

424 
	`rcu_ªad_u∆ock
();

426 
	`mem˝y
(
èû
->
‰ame
.
d©a
, 
skb
->d©a, skb->
Àn
);

428 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TDLS_CHANNEL_SWITCH_CMD
, 0, 
Àn
, &
cmd
);

429 i‡(
ªt
) {

430 
	`IWL_ERR
(
mvm
, "FailedÅo send TDLS_CHANNEL_SWITCH cmd: %d\n",

431 
ªt
);

432 
out
;

436 i‡(
ty≥
 !
TDLS_MOVE_CH
) {

437 
mvm
->
tdls_cs
.
cur_°a_id
 = 
mvm°a
->
deÊök
.
°a_id
;

438 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
,

439 
ty≥
 =
TDLS_SEND_CHAN_SW_REQ
 ?

440 
IWL_MVM_TDLS_SW_REQ_SENT
 :

441 
IWL_MVM_TDLS_SW_REQ_RCVD
);

443 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
, 
IWL_MVM_TDLS_SW_RESP_RCVD
);

446 
out
:

449 i‡(
ªt
)

450 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
, 
IWL_MVM_TDLS_SW_IDLE
);

452  
ªt
;

453 
	}
}

455 
	$iwl_mvm_tdls_ch_swôch_w‹k
(
w‹k_°ru˘
 *
w‹k
)

457 
iwl_mvm
 *
mvm
;

458 
õì80211_°a
 *
°a
;

459 
iwl_mvm_°a
 *
mvm°a
;

460 
õì80211_vif
 *
vif
;

461 
dñay
;

462 
ªt
;

464 
mvm
 = 
	`c⁄èöî_of
(
w‹k
, 
iwl_mvm
, 
tdls_cs
.
dw‹k
.work);

465 
	`muãx_lock
(&
mvm
->
muãx
);

468 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
, 
IWL_MVM_TDLS_SW_IDLE
);

471 i‡(
mvm
->
tdls_cs
.
≥î
.
°a_id
 =
IWL_MVM_INVALID_STA
)

472 
out
;

474 
°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

475 
mvm
->
fw_id_to_mac_id
[mvm->
tdls_cs
.
≥î
.
°a_id
],

476 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

478 i‡(!
°a
 || 
	`IS_ERR
(°aË|| 
	`WARN_ON
(!°a->
tdls
))

479 
out
;

481 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

482 
vif
 = 
mvm°a
->vif;

483 
ªt
 = 
	`iwl_mvm_tdls_c⁄fig_ch™√l_swôch
(
mvm
, 
vif
,

484 
TDLS_SEND_CHAN_SW_REQ
,

485 
°a
->
addr
,

486 
mvm
->
tdls_cs
.
≥î
.
öôüt‹
,

487 
mvm
->
tdls_cs
.
≥î
.
›_˛ass
,

488 &
mvm
->
tdls_cs
.
≥î
.
ch™def
,

490 
mvm
->
tdls_cs
.
≥î
.
skb
,

491 
mvm
->
tdls_cs
.
≥î
.
ch_sw_tm_õ
);

492 i‡(
ªt
)

493 
	`IWL_ERR
(
mvm
, "NŸ sídög TDLS ch™√»swôch: %d\n", 
ªt
);

496 
dñay
 = 
	`TU_TO_MS
(
vif
->
bss_c⁄f
.
dtim_≥riod
 * vif->bss_c⁄f.
bóc⁄_öt
);

497 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tdls_cs
.
dw‹k
, 
	`m£cs_to_jiffõs
(
dñay
));

498 
out
:

499 
	`muãx_u∆ock
(&
mvm
->
muãx
);

500 
	}
}

503 
	$iwl_mvm_tdls_ch™√l_swôch
(
õì80211_hw
 *
hw
,

504 
õì80211_vif
 *
vif
,

505 
õì80211_°a
 *
°a
, 
u8
 
›î_˛ass
,

506 
cfg80211_ch™_def
 *
ch™def
,

507 
sk_buff
 *
tm∂_skb
, 
u32
 
ch_sw_tm_õ
)

509 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

510 
iwl_mvm_°a
 *
mvm°a
;

511 
dñay
;

512 
ªt
;

514 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

516 
	`muãx_lock
(&
mvm
->
muãx
);

518 
	`IWL_DEBUG_TDLS
(
mvm
, "TDLS channel switch with %pM ch %d width %d\n",

519 
°a
->
addr
, 
ch™def
->
ch™
->
˚¡î_‰eq
, ch™def->
width
);

522 i‡(
mvm
->
tdls_cs
.
≥î
.
°a_id
 !
IWL_MVM_INVALID_STA
) {

523 
	`IWL_DEBUG_TDLS
(
mvm
,

525 
°a
->
addr
);

526 
ªt
 = -
EBUSY
;

527 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

528 
out
;

531 
ªt
 = 
	`iwl_mvm_tdls_c⁄fig_ch™√l_swôch
(
mvm
, 
vif
,

532 
TDLS_SEND_CHAN_SW_REQ
,

533 
°a
->
addr
, sè->
tdls_öôüt‹
,

534 
›î_˛ass
, 
ch™def
, 0, 0, 0,

535 
tm∂_skb
, 
ch_sw_tm_õ
);

536 i‡(
ªt
) {

537 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

538 
out
;

545 
mvm
->
tdls_cs
.
≥î
.
skb
 = 
	`skb_c›y
(
tm∂_skb
, 
GFP_KERNEL
);

546 i‡(!
mvm
->
tdls_cs
.
≥î
.
skb
) {

547 
ªt
 = -
ENOMEM
;

548 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

549 
out
;

552 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

553 
mvm
->
tdls_cs
.
≥î
.
°a_id
 = 
mvm°a
->
deÊök
.sta_id;

554 
mvm
->
tdls_cs
.
≥î
.
ch™def
 = *chandef;

555 
mvm
->
tdls_cs
.
≥î
.
öôüt‹
 = 
°a
->
tdls_öôüt‹
;

556 
mvm
->
tdls_cs
.
≥î
.
›_˛ass
 = 
›î_˛ass
;

557 
mvm
->
tdls_cs
.
≥î
.
ch_sw_tm_õ
 = ch_sw_tm_ie;

563 
dñay
 = 2 * 
	`TU_TO_MS
(
vif
->
bss_c⁄f
.
dtim_≥riod
 *

564 
vif
->
bss_c⁄f
.
bóc⁄_öt
);

565 
	`mod_dñayed_w‹k
(
sy°em_wq
, &
mvm
->
tdls_cs
.
dw‹k
,

566 
	`m£cs_to_jiffõs
(
dñay
));

568 
out
:

569 
	`muãx_u∆ock
(&
mvm
->
muãx
);

570 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

571  
ªt
;

572 
	}
}

574 
	$iwl_mvm_tdls_ˇn˚l_ch™√l_swôch
(
õì80211_hw
 *
hw
,

575 
õì80211_vif
 *
vif
,

576 
õì80211_°a
 *
°a
)

578 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

579 
õì80211_°a
 *
cur_°a
;

580 
boﬁ
 
waô_f‹_phy
 = 
Ál£
;

582 
	`¥_öfo
("[%s] [%d] : ENTRY\n", 
__func__
, 
__LINE__
);

584 
	`muãx_lock
(&
mvm
->
muãx
);

586 
	`IWL_DEBUG_TDLS
(
mvm
, "TDLS c™˚»ch™√»swôch wôh %pM\n", 
°a
->
addr
);

589 i‡(
mvm
->
tdls_cs
.
≥î
.
°a_id
 =
IWL_MVM_INVALID_STA
) {

590 
	`IWL_DEBUG_TDLS
(
mvm
, "Nÿch swôchÖì∏- %pM\n", 
°a
->
addr
);

591 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

592 
out
;

595 
cur_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

596 
mvm
->
fw_id_to_mac_id
[mvm->
tdls_cs
.
≥î
.
°a_id
],

597 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

599 i‡(
cur_°a
 !
°a
) {

600 
	`¥_öfo
("[%s] [%d] : EXIT\n", 
__func__
, 
__LINE__
);

601 
out
;

609 i‡(
mvm
->
tdls_cs
.
cur_°a_id
 =mvm->tdls_cs.
≥î
.
°a_id
 &&

610 
mvm
->
tdls_cs
.
°©e
 !
IWL_MVM_TDLS_SW_IDLE
)

611 
waô_f‹_phy
 = 
åue
;

613 
mvm
->
tdls_cs
.
≥î
.
°a_id
 = 
IWL_MVM_INVALID_STA
;

614 
	`dev_k‰ì_skb
(
mvm
->
tdls_cs
.
≥î
.
skb
);

615 
mvm
->
tdls_cs
.
≥î
.
skb
 = 
NULL
;

617 
out
:

618 
	`muãx_u∆ock
(&
mvm
->
muãx
);

621 i‡(
waô_f‹_phy
)

622 
	`m¶ìp
(
	`TU_TO_MS
(
vif
->
bss_c⁄f
.
dtim_≥riod
 *

623 
vif
->
bss_c⁄f
.
bóc⁄_öt
));

626 
	`Êush_dñayed_w‹k
(&
mvm
->
tdls_cs
.
dw‹k
);

628 
	`IWL_DEBUG_TDLS
(
mvm
, "TDLSÉndög ch™√»swôch wôh %pM\n", 
°a
->
addr
);

629 
	}
}

632 
	$iwl_mvm_tdls_ªcv_ch™√l_swôch
(
õì80211_hw
 *
hw
,

633 
õì80211_vif
 *
vif
,

634 
õì80211_tdls_ch_sw_∑øms
 *
∑øms
)

636 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

637 
iwl_tdls_ch™√l_swôch_ty≥
 
ty≥
;

638 
dñay
;

639 c⁄° *
a˘i⁄_°r
 =

640 
∑øms
->
a˘i⁄_code
 =
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
 ?

643 
	`muãx_lock
(&
mvm
->
muãx
);

645 
	`IWL_DEBUG_TDLS
(
mvm
,

647 
a˘i⁄_°r
, 
∑øms
->
°a
->
addr
,Ö¨ams->
°©us
);

653 i‡(
∑øms
->
a˘i⁄_code
 =
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
 &&

654 
∑øms
->
°©us
 != 0 &&

655 
mvm
->
tdls_cs
.
°©e
 =
IWL_MVM_TDLS_SW_REQ_SENT
 &&

656 
mvm
->
tdls_cs
.
cur_°a_id
 !
IWL_MVM_INVALID_STA
) {

657 
õì80211_°a
 *
cur_°a
;

660 
cur_°a
 = 
	`rcu_dîe„ªn˚_¥Ÿe˘ed
(

661 
mvm
->
fw_id_to_mac_id
[mvm->
tdls_cs
.
cur_°a_id
],

662 
	`lockdï_is_hñd
(&
mvm
->
muãx
));

663 i‡(
cur_°a
 =
∑øms
->
°a
) {

664 
	`iwl_mvm_tdls_upd©e_cs_°©e
(
mvm
,

665 
IWL_MVM_TDLS_SW_IDLE
);

666 
ªåy
;

670 
ty≥
 = (
∑øms
->
a˘i⁄_code
 =
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
) ?

671 
TDLS_SEND_CHAN_SW_RESP_AND_MOVE_CH
 : 
TDLS_MOVE_CH
;

673 
	`iwl_mvm_tdls_c⁄fig_ch™√l_swôch
(
mvm
, 
vif
, 
ty≥
, 
∑øms
->
°a
->
addr
,

674 
∑øms
->
°a
->
tdls_öôüt‹
, 0,

675 
∑øms
->
ch™def
,Ö¨ams->
time°amp
,

676 
∑øms
->
swôch_time
,

677 
∑øms
->
swôch_timeout
,

678 
∑øms
->
tm∂_skb
,

679 
∑øms
->
ch_sw_tm_õ
);

681 
ªåy
:

683 
dñay
 = 
vif
->
bss_c⁄f
.
dtim_≥riod
 * vif->bss_c⁄f.
bóc⁄_öt
 *

685 
	`mod_dñayed_w‹k
(
sy°em_wq
, &
mvm
->
tdls_cs
.
dw‹k
,

686 
	`m£cs_to_jiffõs
(
dñay
));

687 
	`muãx_u∆ock
(&
mvm
->
muãx
);

688 
	}
}

	@mvm/testmode.h

61 #i‚de‡
__IWL_MVM_TESTMODE_H__


62 
	#__IWL_MVM_TESTMODE_H__


	)

71 
	eiwl_mvm_ã°mode_©ås
 {

72 
	mIWL_MVM_TM_ATTR_UNSPEC
,

73 
	mIWL_MVM_TM_ATTR_CMD
,

74 
	mIWL_MVM_TM_ATTR_NOA_DURATION
,

75 
	mIWL_MVM_TM_ATTR_BEACON_FILTER_STATE
,

78 
	mNUM_IWL_MVM_TM_ATTRS
,

79 
	mIWL_MVM_TM_ATTR_MAX
 = 
NUM_IWL_MVM_TM_ATTRS
 - 1,

87 
	eiwl_mvm_ã°mode_comm™ds
 {

88 
	mIWL_MVM_TM_CMD_SET_NOA
,

89 
	mIWL_MVM_TM_CMD_SET_BEACON_FILTER
,

	@mvm/time-event.c

7 
	~<löux/jiffõs.h
>

8 
	~<√t/mac80211.h
>

10 
	~"fw/nŸif-waô.h
"

11 
	~"iwl-å™s.h
"

12 
	~"fw-≠i.h
"

13 
	~"time-evít.h
"

14 
	~"mvm.h
"

15 
	~"iwl-io.h
"

16 
	~"iwl-¥ph.h
"

22 
	#IWL_MVM_ROC_TE_TYPE_NORMAL
 
TE_P2P_DEVICE_DISCOVERABLE


	)

23 
	#IWL_MVM_ROC_TE_TYPE_MGMT_TX
 
TE_P2P_CLIENT_ASSOC


	)

25 
	$iwl_mvm_ã_˛ór_d©a
(
iwl_mvm
 *
mvm
,

26 
iwl_mvm_time_evít_d©a
 *
ã_d©a
)

28 
	`lockdï_as£π_hñd
(&
mvm
->
time_evít_lock
);

30 i‡(!
ã_d©a
 || !ã_d©a->
vif
)

33 
	`li°_dñ
(&
ã_d©a
->
li°
);

39 
	`INIT_LIST_HEAD
(&
ã_d©a
->
li°
);

41 
ã_d©a
->
ru¬ög
 = 
Ál£
;

42 
ã_d©a
->
uid
 = 0;

43 
ã_d©a
->
id
 = 
TE_MAX
;

44 
ã_d©a
->
vif
 = 
NULL
;

45 
ã_d©a
->
lök_id
 = -1;

46 
	}
}

48 
	$iwl_mvm_˛ónup_roc
(
iwl_mvm
 *
mvm
)

61 i‡(
	`ã°_™d_˛ór_bô
(
IWL_MVM_STATUS_ROC_RUNNING
, &
mvm
->
°©us
)) {

62 
iwl_mvm_vif
 *
mvmvif
;

64 
	`synchr⁄ize_√t
();

73 i‡(!
	`WARN_ON
(!
mvm
->
p2p_devi˚_vif
)) {

74 
õì80211_vif
 *
vif
 = 
mvm
->
p2p_devi˚_vif
;

76 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

77 
	`iwl_mvm_Êush_°a
(
mvm
, 
mvmvif
->
deÊök
.
bˇ°_°a
.
°a_id
,

78 
mvmvif
->
deÊök
.
bˇ°_°a
.
tfd_queue_msk
);

80 i‡(
mvm
->
mld_≠i_is_u£d
) {

81 
	`iwl_mvm_mld_rm_bˇ°_°a
(
mvm
, 
vif
,

82 &
vif
->
bss_c⁄f
);

84 
	`iwl_mvm_lök_ch™ged
(
mvm
, 
vif
, &vif->
bss_c⁄f
,

85 
LINK_CONTEXT_MODIFY_ACTIVE
,

86 
Ál£
);

88 
	`iwl_mvm_rm_p2p_bˇ°_°a
(
mvm
, 
vif
);

89 
	`iwl_mvm_bödög_ªmove_vif
(
mvm
, 
vif
);

101 i‡(
	`ã°_™d_˛ór_bô
(
IWL_MVM_STATUS_ROC_AUX_RUNNING
, &
mvm
->
°©us
)) {

102 
	`synchr⁄ize_√t
();

104 
	`iwl_mvm_Êush_°a
(
mvm
, mvm->
aux_°a
.
°a_id
,

105 
mvm
->
aux_°a
.
tfd_queue_msk
);

107 i‡(
mvm
->
mld_≠i_is_u£d
) {

108 
	`iwl_mvm_mld_rm_aux_°a
(
mvm
);

115 i‡(
	`iwl_mvm_has_√w_°©i⁄_≠i
(
mvm
->
fw
))

116 
	`iwl_mvm_rm_aux_°a
(
mvm
);

118 
	}
}

120 
	$iwl_mvm_roc_d⁄e_wk
(
w‹k_°ru˘
 *
wk
)

122 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
wk
, iwl_mvm, 
roc_d⁄e_wk
);

124 
	`muãx_lock
(&
mvm
->
muãx
);

125 
	`iwl_mvm_˛ónup_roc
(
mvm
);

126 
	`muãx_u∆ock
(&
mvm
->
muãx
);

127 
	}
}

129 
	$iwl_mvm_roc_föished
(
iwl_mvm
 *
mvm
)

138 
	`scheduÀ_w‹k
(&
mvm
->
roc_d⁄e_wk
);

139 
	}
}

141 
	$iwl_mvm_cß_nﬂ_°¨t
(
iwl_mvm
 *
mvm
)

143 
õì80211_vif
 *
cß_vif
;

145 
	`rcu_ªad_lock
();

147 
cß_vif
 = 
	`rcu_dîe„ªn˚
(
mvm
->csa_vif);

148 i‡(!
cß_vif
 || !cß_vif->
bss_c⁄f
.
cß_a˘ive
)

149 
out_u∆ock
;

151 
	`IWL_DEBUG_TE
(
mvm
, "CSA NOA started\n");

159 i‡(!
	`õì80211_bóc⁄_˙tdwn_is_com∂ëe
(
cß_vif
, 0)) {

160 
	`IWL_WARN
(
mvm
, "CSA NOA startedÅooÉarly\n");

161 
out_u∆ock
;

164 
	`õì80211_cß_föish
(
cß_vif
, 0);

166 
	`rcu_ªad_u∆ock
();

168 
	`RCU_INIT_POINTER
(
mvm
->
cß_vif
, 
NULL
);

172 
out_u∆ock
:

173 
	`rcu_ªad_u∆ock
();

174 
	}
}

176 
boﬁ
 
	$iwl_mvm_ã_check_disc⁄√˘
(
iwl_mvm
 *
mvm
,

177 
õì80211_vif
 *
vif
,

178 c⁄° *
îrmsg
)

180 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

182 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

183  
Ál£
;

185 i‡(!
mvmvif
->
cß_b˙_≥ndög
 && 
vif
->
cfg
.
assoc
 &&

186 
vif
->
bss_c⁄f
.
dtim_≥riod
)

187  
Ál£
;

188 i‡(
îrmsg
)

189 
	`IWL_ERR
(
mvm
, "%s\n", 
îrmsg
);

191 i‡(
mvmvif
->
cß_b˙_≥ndög
) {

192 
iwl_mvm_°a
 *
mvm°a
;

194 
	`rcu_ªad_lock
();

195 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_rcu
(
mvm
,

196 
mvmvif
->
deÊök
.
≠_°a_id
);

197 i‡(!
	`WARN_ON
(!
mvm°a
))

198 
	`iwl_mvm_°a_modify_dißbÀ_tx
(
mvm
, 
mvm°a
, 
Ál£
);

199 
	`rcu_ªad_u∆ock
();

202 i‡(
vif
->
cfg
.
assoc
) {

207 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

208 
IWL_FW_INI_TIME_POINT_ASSOC_FAILED
,

209 
NULL
);

212 
	`iwl_mvm_c⁄√˘i⁄_loss
(
mvm
, 
vif
, 
îrmsg
);

213  
åue
;

214 
	}
}

217 
	$iwl_mvm_ã_h™dÀ_nŸify_cß
(
iwl_mvm
 *
mvm
,

218 
iwl_mvm_time_evít_d©a
 *
ã_d©a
,

219 
iwl_time_evít_nŸif
 *
nŸif
)

221 
õì80211_vif
 *
vif
 = 
ã_d©a
->vif;

222 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

224 i‡(!
nŸif
->
°©us
)

225 
	`IWL_DEBUG_TE
(
mvm
, "CSAÅimeÉvent failedÅo start\n");

227 
ã_d©a
->
vif
->
ty≥
) {

228 
NL80211_IFTYPE_AP
:

229 i‡(!
nŸif
->
°©us
)

230 
mvmvif
->
cß_Áûed
 = 
åue
;

231 
	`iwl_mvm_cß_nﬂ_°¨t
(
mvm
);

233 
NL80211_IFTYPE_STATION
:

234 i‡(!
nŸif
->
°©us
) {

235 
	`iwl_mvm_c⁄√˘i⁄_loss
(
mvm
, 
vif
,

239 
	`iwl_mvm_cß_˛õ¡_ab£¡
(
mvm
, 
ã_d©a
->
vif
);

240 
	`ˇn˚l_dñayed_w‹k
(&
mvmvif
->
cß_w‹k
);

241 
	`õì80211_chswôch_d⁄e
(
ã_d©a
->
vif
, 
åue
, 0);

245 
	`WARN_ON_ONCE
(1);

250 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

251 
	}
}

253 
	$iwl_mvm_ã_check_åiggî
(
iwl_mvm
 *
mvm
,

254 
iwl_time_evít_nŸif
 *
nŸif
,

255 
iwl_mvm_time_evít_d©a
 *
ã_d©a
)

257 
iwl_fw_dbg_åiggî_év
 *
åig
;

258 
iwl_fw_dbg_åiggî_time_evít
 *
ã_åig
;

259 
i
;

261 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
,

262 
	`õì80211_vif_to_wdev
(
ã_d©a
->
vif
),

263 
FW_DBG_TRIGGER_TIME_EVENT
);

264 i‡(!
åig
)

267 
ã_åig
 = (*)
åig
->
d©a
;

269 
i
 = 0; i < 
	`ARRAY_SIZE
(
ã_åig
->
time_evíts
); i++) {

270 
u32
 
åig_ã_id
 = 
	`À32_to_˝u
(
ã_åig
->
time_evíts
[
i
].
id
);

271 
u32
 
åig_a˘i⁄_bôm≠
 =

272 
	`À32_to_˝u
(
ã_åig
->
time_evíts
[
i
].
a˘i⁄_bôm≠
);

273 
u32
 
åig_°©us_bôm≠
 =

274 
	`À32_to_˝u
(
ã_åig
->
time_evíts
[
i
].
°©us_bôm≠
);

276 i‡(
åig_ã_id
 !
ã_d©a
->
id
 ||

277 !(
åig_a˘i⁄_bôm≠
 & 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
)) ||

278 !(
åig_°©us_bôm≠
 & 
	`BIT
(
	`À32_to_˝u
(
nŸif
->
°©us
))))

281 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

283 
ã_d©a
->
id
,

284 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
),

285 
	`À32_to_˝u
(
nŸif
->
°©us
));

288 
	}
}

297 
	$iwl_mvm_ã_h™dÀ_nŸif
(
iwl_mvm
 *
mvm
,

298 
iwl_mvm_time_evít_d©a
 *
ã_d©a
,

299 
iwl_time_evít_nŸif
 *
nŸif
)

301 
	`lockdï_as£π_hñd
(&
mvm
->
time_evít_lock
);

303 
	`IWL_DEBUG_TE
(
mvm
, "HandleÅimeÉventÇotif - UID = 0x%xáction %d\n",

304 
	`À32_to_˝u
(
nŸif
->
unique_id
),

305 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
));

307 
	`iwl_mvm_ã_check_åiggî
(
mvm
, 
nŸif
, 
ã_d©a
);

317 i‡(!
	`À32_to_˝u
(
nŸif
->
°©us
)) {

318 c⁄° *
msg
;

320 i‡(
nŸif
->
a˘i⁄
 & 
	`˝u_to_À32
(
TE_V2_NOTIF_HOST_EVENT_START
))

321 
msg
 = "Time Event startÇotification failure";

323 
msg
 = "Time EventÉndÇotification failure";

325 
	`IWL_DEBUG_TE
(
mvm
, "%s\n", 
msg
);

327 i‡(
	`iwl_mvm_ã_check_disc⁄√˘
(
mvm
, 
ã_d©a
->
vif
, 
msg
)) {

328 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

333 i‡(
	`À32_to_˝u
(
nŸif
->
a˘i⁄
Ë& 
TE_V2_NOTIF_HOST_EVENT_END
) {

334 
	`IWL_DEBUG_TE
(
mvm
,

336 
jiffõs
, 
ã_d©a
->
íd_jiffõs
);

338 
ã_d©a
->
vif
->
ty≥
) {

339 
NL80211_IFTYPE_P2P_DEVICE
:

340 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
mvm
->
hw
);

341 
	`iwl_mvm_roc_föished
(
mvm
);

343 
NL80211_IFTYPE_STATION
:

349 i‡(
ã_d©a
->
id
 =
TE_CHANNEL_SWITCH_PERIOD
) {

350 
	`IWL_DEBUG_TE
(
mvm
,

359 
	`iwl_mvm_ã_check_disc⁄√˘
(
mvm
, 
ã_d©a
->
vif
,

360 !
ã_d©a
->
vif
->
cfg
.
assoc
 ?

368 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

369 } i‡(
	`À32_to_˝u
(
nŸif
->
a˘i⁄
Ë& 
TE_V2_NOTIF_HOST_EVENT_START
) {

370 
ã_d©a
->
ru¬ög
 = 
åue
;

371 
ã_d©a
->
íd_jiffõs
 = 
	`TU_TO_EXP_TIME
—e_d©a->
duøti⁄
);

373 i‡(
ã_d©a
->
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

374 
	`£t_bô
(
IWL_MVM_STATUS_ROC_RUNNING
, &
mvm
->
°©us
);

375 
	`õì80211_ªady_⁄_ch™√l
(
mvm
->
hw
);

376 } i‡(
ã_d©a
->
id
 =
TE_CHANNEL_SWITCH_PERIOD
) {

377 
	`iwl_mvm_ã_h™dÀ_nŸify_cß
(
mvm
, 
ã_d©a
, 
nŸif
);

380 
	`IWL_WARN
(
mvm
, "Got TE with unknownáction\n");

382 
	}
}

384 
	$iwl_mvm_rx_roc_nŸif
(
iwl_mvm
 *
mvm
,

385 
iwl_rx_cmd_buf„r
 *
rxb
)

387 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

388 
iwl_roc_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

390 i‡(
	`À32_to_˝u
(
nŸif
->
suc˚ss
Ë&&Üe32_to_˝u“Ÿif->
°¨ãd
) &&

391 
	`À32_to_˝u
(
nŸif
->
a˘ivôy
Ë=
ROC_ACTIVITY_HOTSPOT
) {

392 
	`£t_bô
(
IWL_MVM_STATUS_ROC_AUX_RUNNING
, &
mvm
->
°©us
);

393 
	`õì80211_ªady_⁄_ch™√l
(
mvm
->
hw
);

395 
	`iwl_mvm_roc_föished
(
mvm
);

396 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
mvm
->
hw
);

398 
	}
}

403 
	$iwl_mvm_aux_roc_ã_h™dÀ_nŸif
(
iwl_mvm
 *
mvm
,

404 
iwl_time_evít_nŸif
 *
nŸif
)

406 
iwl_mvm_time_evít_d©a
 *
aux_roc_ã
 = 
NULL
, *
ã_d©a
;

408 
	`li°_f‹_óch_íåy
(
ã_d©a
, &
mvm
->
aux_roc_ã_li°
, 
li°
) {

409 i‡(
	`À32_to_˝u
(
nŸif
->
unique_id
Ë=
ã_d©a
->
uid
) {

410 
aux_roc_ã
 = 
ã_d©a
;

414 i‡(!
aux_roc_ã
)

415  -
EINVAL
;

417 
	`iwl_mvm_ã_check_åiggî
(
mvm
, 
nŸif
, 
ã_d©a
);

419 
	`IWL_DEBUG_TE
(
mvm
,

421 
	`À32_to_˝u
(
nŸif
->
unique_id
),

422 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
),Üe32_to_˝u“Ÿif->
°©us
));

424 i‡(!
	`À32_to_˝u
(
nŸif
->
°©us
) ||

425 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
Ë=
TE_V2_NOTIF_HOST_EVENT_END
) {

427 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
mvm
->
hw
);

428 
	`iwl_mvm_roc_föished
(
mvm
);

429 
	`li°_dñ
(&
ã_d©a
->
li°
);

430 
ã_d©a
->
ru¬ög
 = 
Ál£
;

431 
ã_d©a
->
vif
 = 
NULL
;

432 
ã_d©a
->
uid
 = 0;

433 
ã_d©a
->
id
 = 
TE_MAX
;

434 } i‡(
	`À32_to_˝u
(
nŸif
->
a˘i⁄
Ë=
TE_V2_NOTIF_HOST_EVENT_START
) {

435 
	`£t_bô
(
IWL_MVM_STATUS_ROC_AUX_RUNNING
, &
mvm
->
°©us
);

436 
ã_d©a
->
ru¬ög
 = 
åue
;

437 
	`õì80211_ªady_⁄_ch™√l
(
mvm
->
hw
);

439 
	`IWL_DEBUG_TE
(
mvm
,

441 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
));

442  -
EINVAL
;

446 
	}
}

451 
	$iwl_mvm_rx_time_evít_nŸif
(
iwl_mvm
 *
mvm
,

452 
iwl_rx_cmd_buf„r
 *
rxb
)

454 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

455 
iwl_time_evít_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

456 
iwl_mvm_time_evít_d©a
 *
ã_d©a
, *
tmp
;

458 
	`IWL_DEBUG_TE
(
mvm
, "TimeÉventÇotification - UID = 0x%xáction %d\n",

459 
	`À32_to_˝u
(
nŸif
->
unique_id
),

460 
	`À32_to_˝u
(
nŸif
->
a˘i⁄
));

462 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

464 i‡(!
	`iwl_mvm_aux_roc_ã_h™dÀ_nŸif
(
mvm
, 
nŸif
))

465 
u∆ock
;

467 
	`li°_f‹_óch_íåy_ß„
(
ã_d©a
, 
tmp
, &
mvm
->
time_evít_li°
, 
li°
) {

468 i‡(
	`À32_to_˝u
(
nŸif
->
unique_id
Ë=
ã_d©a
->
uid
)

469 
	`iwl_mvm_ã_h™dÀ_nŸif
(
mvm
, 
ã_d©a
, 
nŸif
);

471 
u∆ock
:

472 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

473 
	}
}

475 
boﬁ
 
	$iwl_mvm_ã_nŸif
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

476 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

478 
iwl_mvm
 *
mvm
 =

479 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

480 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = 
d©a
;

481 
iwl_time_evít_nŸif
 *
ª•
;

482 
ª•_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

484 i‡(
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
TIME_EVENT_NOTIFICATION
))

485  
åue
;

487 i‡(
	`WARN_ON_ONCE
(
ª•_Àn
 !(*
ª•
))) {

488 
	`IWL_ERR
(
mvm
, "Invalid TIME_EVENT_NOTIFICATIONÑesponse\n");

489  
åue
;

492 
ª•
 = (*)
pkt
->
d©a
;

495 i‡(
	`À32_to_˝u
(
ª•
->
unique_id
Ë!
ã_d©a
->
uid
)

496  
Ál£
;

498 
	`IWL_DEBUG_TE
(
mvm
, "TIME_EVENT_NOTIFICATIONÑesponse - UID = 0x%x\n",

499 
ã_d©a
->
uid
);

500 i‡(!
ª•
->
°©us
)

501 
	`IWL_ERR
(
mvm
,

504  
åue
;

505 
	}
}

507 
boﬁ
 
	$iwl_mvm_time_evít_ª•⁄£
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

508 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

510 
iwl_mvm
 *
mvm
 =

511 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

512 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = 
d©a
;

513 
iwl_time_evít_ª•
 *
ª•
;

514 
ª•_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

516 i‡(
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
TIME_EVENT_CMD
))

517  
åue
;

519 i‡(
	`WARN_ON_ONCE
(
ª•_Àn
 !(*
ª•
))) {

520 
	`IWL_ERR
(
mvm
, "Invalid TIME_EVENT_CMDÑesponse\n");

521  
åue
;

524 
ª•
 = (*)
pkt
->
d©a
;

527 i‡(
	`WARN_ON_ONCE
(
	`À32_to_˝u
(
ª•
->
id
Ë!
ã_d©a
->id))

528  
Ál£
;

530 
ã_d©a
->
uid
 = 
	`À32_to_˝u
(
ª•
->
unique_id
);

531 
	`IWL_DEBUG_TE
(
mvm
, "TIME_EVENT_CMDÑesponse - UID = 0x%x\n",

532 
ã_d©a
->
uid
);

533  
åue
;

534 
	}
}

536 
	$iwl_mvm_time_evít_£nd_add
(
iwl_mvm
 *
mvm
,

537 
õì80211_vif
 *
vif
,

538 
iwl_mvm_time_evít_d©a
 *
ã_d©a
,

539 
iwl_time_evít_cmd
 *
ã_cmd
)

541 c⁄° 
u16
 
time_evít_ª•⁄£
[] = { 
TIME_EVENT_CMD
 };

542 
iwl_nŸifiˇti⁄_waô
 
waô_time_evít
;

543 
ªt
;

545 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

547 
	`IWL_DEBUG_TE
(
mvm
, "AddÇew TE, duration %d TU\n",

548 
	`À32_to_˝u
(
ã_cmd
->
duøti⁄
));

550 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

551 i‡(
	`WARN_ON
(
ã_d©a
->
id
 !
TE_MAX
)) {

552 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

553  -
EIO
;

555 
ã_d©a
->
vif
 = vif;

556 
ã_d©a
->
duøti⁄
 = 
	`À32_to_˝u
(
ã_cmd
->duration);

557 
ã_d©a
->
id
 = 
	`À32_to_˝u
(
ã_cmd
->id);

558 
	`li°_add_èû
(&
ã_d©a
->
li°
, &
mvm
->
time_evít_li°
);

559 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

570 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_time_evít
,

571 
time_evít_ª•⁄£
,

572 
	`ARRAY_SIZE
(
time_evít_ª•⁄£
),

573 
iwl_mvm_time_evít_ª•⁄£
, 
ã_d©a
);

575 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TIME_EVENT_CMD
, 0,

576 (*
ã_cmd
),Åe_cmd);

577 i‡(
ªt
) {

578 
	`IWL_ERR
(
mvm
, "Couldn'à£nd TIME_EVENT_CMD: %d\n", 
ªt
);

579 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_time_evít
);

580 
out_˛ór_ã
;

584 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_time_evít
, 1);

586 
	`WARN_ON_ONCE
(
ªt
);

588 i‡(
ªt
) {

589 
out_˛ór_ã
:

590 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

591 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

592 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

594  
ªt
;

595 
	}
}

597 
	$iwl_mvm_¥Ÿe˘_£ssi⁄
(
iwl_mvm
 *
mvm
,

598 
õì80211_vif
 *
vif
,

599 
u32
 
duøti⁄
, u32 
mö_duøti⁄
,

600 
u32
 
max_dñay
, 
boﬁ
 
waô_f‹_nŸif
)

602 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

603 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

604 c⁄° 
u16
 
ã_nŸif_ª•⁄£
[] = { 
TIME_EVENT_NOTIFICATION
 };

605 
iwl_nŸifiˇti⁄_waô
 
waô_ã_nŸif
;

606 
iwl_time_evít_cmd
 
time_cmd
 = {};

608 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

610 i‡(
ã_d©a
->
ru¬ög
 &&

611 
	`time_a·î
(
ã_d©a
->
íd_jiffõs
, 
	`TU_TO_EXP_TIME
(
mö_duøti⁄
))) {

612 
	`IWL_DEBUG_TE
(
mvm
, "We haveÉnoughÅime inÅhe current TE: %u\n",

613 
	`jiffõs_to_m£cs
(
ã_d©a
->
íd_jiffõs
 - 
jiffõs
));

617 i‡(
ã_d©a
->
ru¬ög
) {

618 
	`IWL_DEBUG_TE
(
mvm
, "extend 0x%x: only %u msÜeft\n",

619 
ã_d©a
->
uid
,

620 
	`jiffõs_to_m£cs
(
ã_d©a
->
íd_jiffõs
 - 
jiffõs
));

629 
	`iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
);

632 
time_cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
);

633 
time_cmd
.
id_™d_cﬁ‹
 =

634 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
));

635 
time_cmd
.
id
 = 
	`˝u_to_À32
(
TE_BSS_STA_AGGRESSIVE_ASSOC
);

637 
time_cmd
.
≠∂y_time
 = 
	`˝u_to_À32
(0);

639 
time_cmd
.
max_‰ags
 = 
TE_V2_FRAG_NONE
;

640 
time_cmd
.
max_dñay
 = 
	`˝u_to_À32
(max_delay);

642 
time_cmd
.
öãrvÆ
 = 
	`˝u_to_À32
(1);

643 
time_cmd
.
duøti⁄
 = 
	`˝u_to_À32
(duration);

644 
time_cmd
.
ª≥©
 = 1;

645 
time_cmd
.
pﬁicy
 = 
	`˝u_to_À16
(
TE_V2_NOTIF_HOST_EVENT_START
 |

646 
TE_V2_NOTIF_HOST_EVENT_END
 |

647 
TE_V2_START_IMMEDIATELY
);

649 i‡(!
waô_f‹_nŸif
) {

650 
	`iwl_mvm_time_evít_£nd_add
(
mvm
, 
vif
, 
ã_d©a
, &
time_cmd
);

658 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_ã_nŸif
,

659 
ã_nŸif_ª•⁄£
,

660 
	`ARRAY_SIZE
(
ã_nŸif_ª•⁄£
),

661 
iwl_mvm_ã_nŸif
, 
ã_d©a
);

664 i‡(
	`iwl_mvm_time_evít_£nd_add
(
mvm
, 
vif
, 
ã_d©a
, &
time_cmd
)) {

665 
	`IWL_ERR
(
mvm
, "FailedÅoádd TEÅoÖrotect session\n");

666 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_ã_nŸif
);

667 } i‡(
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_ã_nŸif
,

668 
	`TU_TO_JIFFIES
(
max_dñay
))) {

669 
	`IWL_ERR
(
mvm
, "FailedÅoÖrotect session until TE\n");

671 
	}
}

674 
	$iwl_mvm_gë_£ssi⁄_¥Ÿ_id
(
iwl_mvm
 *
mvm
,

675 
õì80211_vif
 *
vif
,

676 
s8
 
lök_id
)

678 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

679 
vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

680 
	`WIDE_ID
(
MAC_CONF_GROUP
,

681 
SESSION_PROTECTION_CMD
), 1);

683 i‡(
vî
 < 2)

684  
mvmvif
->
id
;

686 i‡(
	`WARN
(
lök_id
 < 0 || !
mvmvif
->
lök
[link_id],

687 "InvÆidÜök ID f‹ sessi⁄ÖrŸe˘i⁄: %u\n", 
lök_id
))

688  -
EINVAL
;

690 i‡(
	`WARN
(!
mvmvif
->
lök
[
lök_id
]->
a˘ive
,

691 "Sessi⁄ PrŸe˘i⁄ o¿™ i«˘ivêlök: %u\n", 
lök_id
))

692  -
EINVAL
;

694  
mvmvif
->
lök
[
lök_id
]->
fw_lök_id
;

695 
	}
}

697 
	$iwl_mvm_ˇn˚l_£ssi⁄_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
,

698 
õì80211_vif
 *
vif
,

699 
u32
 
id
, 
s8
 
lök_id
)

701 
mac_lök_id
 = 
	`iwl_mvm_gë_£ssi⁄_¥Ÿ_id
(
mvm
, 
vif
, 
lök_id
);

702 
iwl_mvm_£ssi⁄_¥Ÿ_cmd
 
cmd
 = {

703 .
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
mac_lök_id
),

704 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
),

705 .
c⁄f_id
 = 
	`˝u_to_À32
(
id
),

707 
ªt
;

709 i‡(
mac_lök_id
 < 0)

712 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

713 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
SESSION_PROTECTION_CMD
),

714 0, (
cmd
), &cmd);

715 i‡(
ªt
)

716 
	`IWL_ERR
(
mvm
,

717 "Couldn'à£ndÅhêSESSION_PROTECTION_CMD: %d\n", 
ªt
);

718 
	}
}

720 
boﬁ
 
	$__iwl_mvm_ªmove_time_evít
(
iwl_mvm
 *
mvm
,

721 
iwl_mvm_time_evít_d©a
 *
ã_d©a
,

722 
u32
 *
uid
)

724 
u32
 
id
;

725 
õì80211_vif
 *
vif
 = 
ã_d©a
->vif;

726 
iwl_mvm_vif
 *
mvmvif
;

727 
∆80211_i·y≥
 
i·y≥
;

728 
s8
 
lök_id
;

730 i‡(!
vif
)

731  
Ál£
;

733 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
ã_d©a
->
vif
);

734 
i·y≥
 = 
ã_d©a
->
vif
->
ty≥
;

740 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

743 *
uid
 = 
ã_d©a
->uid;

744 
id
 = 
ã_d©a
->id;

745 
lök_id
 = 
ã_d©a
->link_id;

750 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

751 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

758 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

759 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
) &&

760 
id
 !
HOT_SPOT_CMD
) {

761 i‡(
mvmvif
 && 
id
 < 
SESSION_PROTECT_CONF_MAX_ID
) {

763 
	`iwl_mvm_ˇn˚l_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
, 
id
,

764 
lök_id
);

765 i‡(
i·y≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

766 
	`iwl_mvm_roc_föished
(
mvm
);

769  
Ál£
;

775 i‡(
id
 =
TE_MAX
) {

776 
	`IWL_DEBUG_TE
(
mvm
, "TE 0x%x ha†ÆªadyÉnded\n", *
uid
);

777  
Ál£
;

781  
åue
;

782 
	}
}

790 
	$iwl_mvm_ªmove_aux_roc_ã
(
iwl_mvm
 *
mvm
,

791 
iwl_mvm_vif
 *
mvmvif
,

792 
iwl_mvm_time_evít_d©a
 *
ã_d©a
)

794 
iwl_hs20_roc_ªq
 
aux_cmd
 = {};

795 
u16
 
Àn
 = (
aux_cmd
Ë- 
	`iwl_mvm_ch™_öfo_∑ddög
(
mvm
);

797 
u32
 
uid
;

798 
ªt
;

800 i‡(!
	`__iwl_mvm_ªmove_time_evít
(
mvm
, 
ã_d©a
, &
uid
))

803 
aux_cmd
.
evít_unique_id
 = 
	`˝u_to_À32
(
uid
);

804 
aux_cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
);

805 
aux_cmd
.
id_™d_cﬁ‹
 =

806 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
));

807 
	`IWL_DEBUG_TE
(
mvm
, "Removing BSS AUX ROC TE 0x%x\n",

808 
	`À32_to_˝u
(
aux_cmd
.
evít_unique_id
));

809 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
HOT_SPOT_CMD
, 0,

810 
Àn
, &
aux_cmd
);

812 i‡(
	`WARN_ON
(
ªt
))

814 
	}
}

821 
	$iwl_mvm_ªmove_time_evít
(
iwl_mvm
 *
mvm
,

822 
iwl_mvm_vif
 *
mvmvif
,

823 
iwl_mvm_time_evít_d©a
 *
ã_d©a
)

825 
iwl_time_evít_cmd
 
time_cmd
 = {};

826 
u32
 
uid
;

827 
ªt
;

829 i‡(!
	`__iwl_mvm_ªmove_time_evít
(
mvm
, 
ã_d©a
, &
uid
))

833 
time_cmd
.
id
 = 
	`˝u_to_À32
(
uid
);

834 
time_cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
);

835 
time_cmd
.
id_™d_cﬁ‹
 =

836 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
));

838 
	`IWL_DEBUG_TE
(
mvm
, "Removög TE 0x%x\n", 
	`À32_to_˝u
(
time_cmd
.
id
));

839 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TIME_EVENT_CMD
, 0,

840 (
time_cmd
), &time_cmd);

841 i‡(
ªt
)

842 
	`IWL_ERR
(
mvm
, "Couldn'tÑemoveÅheÅimeÉvent\n");

843 
	}
}

845 
	$iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
,

846 
õì80211_vif
 *
vif
)

848 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

849 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

850 
u32
 
id
;

852 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

854 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

855 
id
 = 
ã_d©a
->id;

856 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

858 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

859 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
)) {

860 i‡(
id
 !
SESSION_PROTECT_CONF_ASSOC
) {

861 
	`IWL_DEBUG_TE
(
mvm
,

863 
id
);

866 } i‡(
id
 !
TE_BSS_STA_AGGRESSIVE_ASSOC
) {

867 
	`IWL_DEBUG_TE
(
mvm
,

869 
id
);

873 
	`iwl_mvm_ªmove_time_evít
(
mvm
, 
mvmvif
, 
ã_d©a
);

874 
	}
}

876 
	$iwl_mvm_rx_£ssi⁄_¥Ÿe˘_nŸif
(
iwl_mvm
 *
mvm
,

877 
iwl_rx_cmd_buf„r
 *
rxb
)

879 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

880 
iwl_mvm_£ssi⁄_¥Ÿ_nŸif
 *
nŸif
 = (*)
pkt
->
d©a
;

881 
vî
 =

882 
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
MAC_CONF_GROUP
,

883 
SESSION_PROTECTION_NOTIF
, 2);

884 
id
 = 
	`À32_to_˝u
(
nŸif
->
mac_lök_id
);

885 
õì80211_vif
 *
vif
;

886 
iwl_mvm_vif
 *
mvmvif
;

887 
nŸif_lök_id
;

889 
	`rcu_ªad_lock
();

891 i‡(
vî
 <= 2) {

892 
vif
 = 
	`iwl_mvm_rcu_dîe„ªn˚_vif_id
(
mvm
, 
id
, 
åue
);

894 
õì80211_bss_c⁄f
 *
lök_c⁄f
 =

895 
	`iwl_mvm_rcu_fw_lök_id_to_lök_c⁄f
(
mvm
, 
id
, 
åue
);

897 i‡(!
lök_c⁄f
)

898 
out_u∆ock
;

900 
nŸif_lök_id
 = 
lök_c⁄f
->
lök_id
;

901 
vif
 = 
lök_c⁄f
->vif;

904 i‡(!
vif
)

905 
out_u∆ock
;

907 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

909 i‡(
	`WARN
(
vî
 > 2 && 
mvmvif
->
time_evít_d©a
.
lök_id
 >= 0 &&

910 
mvmvif
->
time_evít_d©a
.
lök_id
 !
nŸif_lök_id
,

912 
nŸif_lök_id
, 
mvmvif
->
time_evít_d©a
.
lök_id
))

913 
out_u∆ock
;

916 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE
) {

917 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 =

918 &
mvmvif
->
time_evít_d©a
;

920 i‡(!
	`À32_to_˝u
(
nŸif
->
°©us
)) {

921 
	`iwl_mvm_ã_check_disc⁄√˘
(
mvm
, 
vif
,

923 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

924 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

925 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

928 i‡(
	`À32_to_˝u
(
nŸif
->
°¨t
)) {

929 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

930 
ã_d©a
->
ru¬ög
 = 
	`À32_to_˝u
(
nŸif
->
°¨t
);

931 
ã_d©a
->
íd_jiffõs
 =

932 
	`TU_TO_EXP_TIME
(
ã_d©a
->
duøti⁄
);

933 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

939 
	`iwl_mvm_ã_check_disc⁄√˘
(
mvm
, 
vif
,

940 !
vif
->
cfg
.
assoc
 ?

943 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

944 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

945 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

948 
out_u∆ock
;

951 i‡(!
	`À32_to_˝u
(
nŸif
->
°©us
Ë|| !À32_to_˝u“Ÿif->
°¨t
)) {

953 
mvmvif
->
time_evít_d©a
.
id
 = 
SESSION_PROTECT_CONF_MAX_ID
;

954 
mvmvif
->
time_evít_d©a
.
lök_id
 = -1;

955 
	`iwl_mvm_roc_föished
(
mvm
);

956 
	`õì80211_ªmaö_⁄_ch™√l_expúed
(
mvm
->
hw
);

957 } i‡(
	`À32_to_˝u
(
nŸif
->
°¨t
)) {

958 i‡(
	`WARN_ON
(
mvmvif
->
time_evít_d©a
.
id
 !=

959 
	`À32_to_˝u
(
nŸif
->
c⁄f_id
)))

960 
out_u∆ock
;

961 
	`£t_bô
(
IWL_MVM_STATUS_ROC_RUNNING
, &
mvm
->
°©us
);

962 
	`õì80211_ªady_⁄_ch™√l
(
mvm
->
hw
);

965 
out_u∆ock
:

966 
	`rcu_ªad_u∆ock
();

967 
	}
}

969 
	#AUX_ROC_MIN_DURATION
 
	`MSEC_TO_TU
(100)

	)

970 
	#AUX_ROC_MIN_DELAY
 
	`MSEC_TO_TU
(200)

	)

971 
	#AUX_ROC_MAX_DELAY
 
	`MSEC_TO_TU
(600)

	)

972 
	#AUX_ROC_SAFETY_BUFFER
 
	`MSEC_TO_TU
(20)

	)

973 
	#AUX_ROC_MIN_SAFETY_BUFFER
 
	`MSEC_TO_TU
(10)

	)

975 
	$iwl_mvm_roc_duøti⁄_™d_dñay
(
õì80211_vif
 *
vif
,

976 
u32
 
duøti⁄_ms
,

977 
u32
 *
duøti⁄_tu
,

978 
u32
 *
dñay
)

980 
u32
 
dtim_öãrvÆ
 = 
vif
->
bss_c⁄f
.
dtim_≥riod
 *

981 
vif
->
bss_c⁄f
.
bóc⁄_öt
;

983 *
dñay
 = 
AUX_ROC_MIN_DELAY
;

984 *
duøti⁄_tu
 = 
	`MSEC_TO_TU
(
duøti⁄_ms
);

995 i‡(
vif
->
cfg
.
assoc
) {

996 *
dñay
 = 
	`mö_t
(
u32
, 
dtim_öãrvÆ
 * 3, 
AUX_ROC_MAX_DELAY
);

998 i‡(
dtim_öãrvÆ
 <*
duøti⁄_tu
) {

999 *
duøti⁄_tu
 = 
dtim_öãrvÆ
 - 
AUX_ROC_SAFETY_BUFFER
;

1000 i‡(*
duøti⁄_tu
 <
AUX_ROC_MIN_DURATION
)

1001 *
duøti⁄_tu
 = 
dtim_öãrvÆ
 -

1002 
AUX_ROC_MIN_SAFETY_BUFFER
;

1005 
	}
}

1007 
	$iwl_mvm_roc_add_cmd
(
iwl_mvm
 *
mvm
,

1008 
õì80211_ch™√l
 *
ch™√l
,

1009 
õì80211_vif
 *
vif
,

1010 
duøti⁄
, 
u32
 
a˘ivôy
)

1012 
ªs
;

1013 
u32
 
duøti⁄_tu
, 
dñay
;

1014 
iwl_roc_ªq
 
roc_ªq
 = {

1015 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
),

1016 .
a˘ivôy
 = 
	`˝u_to_À32
(activity),

1017 .
°a_id
 = 
	`˝u_to_À32
(
mvm
->
aux_°a
.sta_id),

1020 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1023 
	`iwl_mvm_£t_ch™_öfo
(
mvm
, &
roc_ªq
.
ch™√l_öfo
,

1024 
ch™√l
->
hw_vÆue
,

1025 
	`iwl_mvm_phy_b™d_‰om_∆80211
(
ch™√l
->
b™d
),

1026 
IWL_PHY_CHANNEL_MODE20
, 0);

1028 
	`iwl_mvm_roc_duøti⁄_™d_dñay
(
vif
, 
duøti⁄
, &
duøti⁄_tu
,

1029 &
dñay
);

1030 
roc_ªq
.
duøti⁄
 = 
	`˝u_to_À32
(
duøti⁄_tu
);

1031 
roc_ªq
.
max_dñay
 = 
	`˝u_to_À32
(
dñay
);

1033 
	`IWL_DEBUG_TE
(
mvm
,

1035 
duøti⁄
, 
dñay
);

1036 
	`IWL_DEBUG_TE
(
mvm
,

1038 
ch™√l
->
hw_vÆue
, 
duøti⁄_tu
);

1041 
	`mem˝y
(
roc_ªq
.
node_addr
, 
vif
->
addr
, 
ETH_ALEN
);

1043 
ªs
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
ROC_CMD
),

1044 0, (
roc_ªq
), &roc_req);

1046  
ªs
;

1047 
	}
}

1050 
	$iwl_mvm_°¨t_p2p_roc_£ssi⁄_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
,

1051 
õì80211_vif
 *
vif
,

1052 
duøti⁄
,

1053 
õì80211_roc_ty≥
 
ty≥
)

1055 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1056 
iwl_mvm_£ssi⁄_¥Ÿ_cmd
 
cmd
 = {

1057 .
id_™d_cﬁ‹
 =

1058 
	`˝u_to_À32
(
	`iwl_mvm_gë_£ssi⁄_¥Ÿ_id
(
mvm
, 
vif
, 0)),

1059 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
),

1060 .
duøti⁄_tu
 = 
	`˝u_to_À32
(
	`MSEC_TO_TU
(
duøti⁄
)),

1063 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1069 
mvmvif
->
time_evít_d©a
.
lök_id
 = 0;

1071 
ty≥
) {

1072 
IEEE80211_ROC_TYPE_NORMAL
:

1073 
mvmvif
->
time_evít_d©a
.
id
 =

1074 
SESSION_PROTECT_CONF_P2P_DEVICE_DISCOV
;

1076 
IEEE80211_ROC_TYPE_MGMT_TX
:

1077 
mvmvif
->
time_evít_d©a
.
id
 =

1078 
SESSION_PROTECT_CONF_P2P_GO_NEGOTIATION
;

1081 
	`WARN_ONCE
(1, "Gotán invalid ROCÅype\n");

1082  -
EINVAL
;

1085 
cmd
.
c⁄f_id
 = 
	`˝u_to_À32
(
mvmvif
->
time_evít_d©a
.
id
);

1086  
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1087 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
SESSION_PROTECTION_CMD
),

1088 0, (
cmd
), &cmd);

1089 
	}
}

1091 
	$iwl_mvm_°¨t_p2p_roc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

1092 
duøti⁄
, 
õì80211_roc_ty≥
 
ty≥
)

1094 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1095 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

1096 
iwl_time_evít_cmd
 
time_cmd
 = {};

1098 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1099 i‡(
ã_d©a
->
ru¬ög
) {

1100 
	`IWL_WARN
(
mvm
, "P2P_DEVICEÑemain on channelálreadyÑunning\n");

1101  -
EBUSY
;

1104 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1105 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
))

1106  
	`iwl_mvm_°¨t_p2p_roc_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
,

1107 
duøti⁄
,

1108 
ty≥
);

1110 
time_cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
);

1111 
time_cmd
.
id_™d_cﬁ‹
 =

1112 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
));

1114 
ty≥
) {

1115 
IEEE80211_ROC_TYPE_NORMAL
:

1116 
time_cmd
.
id
 = 
	`˝u_to_À32
(
IWL_MVM_ROC_TE_TYPE_NORMAL
);

1118 
IEEE80211_ROC_TYPE_MGMT_TX
:

1119 
time_cmd
.
id
 = 
	`˝u_to_À32
(
IWL_MVM_ROC_TE_TYPE_MGMT_TX
);

1122 
	`WARN_ONCE
(1, "Gotán invalid ROCÅype\n");

1123  -
EINVAL
;

1126 
time_cmd
.
≠∂y_time
 = 
	`˝u_to_À32
(0);

1127 
time_cmd
.
öãrvÆ
 = 
	`˝u_to_À32
(1);

1135 
time_cmd
.
max_‰ags
 = 
	`mö
(
	`MSEC_TO_TU
(
duøti⁄
)/50, 
TE_V2_FRAG_ENDLESS
);

1136 
time_cmd
.
max_dñay
 = 
	`˝u_to_À32
(
	`MSEC_TO_TU
(
duøti⁄
/2));

1137 
time_cmd
.
duøti⁄
 = 
	`˝u_to_À32
(
	`MSEC_TO_TU
(duration));

1138 
time_cmd
.
ª≥©
 = 1;

1139 
time_cmd
.
pﬁicy
 = 
	`˝u_to_À16
(
TE_V2_NOTIF_HOST_EVENT_START
 |

1140 
TE_V2_NOTIF_HOST_EVENT_END
 |

1141 
TE_V2_START_IMMEDIATELY
);

1143  
	`iwl_mvm_time_evít_£nd_add
(
mvm
, 
vif
, 
ã_d©a
, &
time_cmd
);

1144 
	}
}

1146 
iwl_mvm_time_evít_d©a
 *
	$iwl_mvm_gë_roc_ã
(
iwl_mvm
 *
mvm
)

1148 
iwl_mvm_time_evít_d©a
 *
ã_d©a
;

1150 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1152 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

1161 
	`li°_f‹_óch_íåy
(
ã_d©a
, &
mvm
->
time_evít_li°
, 
li°
) {

1162 i‡(
ã_d©a
->
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
)

1163 
out
;

1169 
ã_d©a
 = 
	`li°_fú°_íåy_‹_nuŒ
(&
mvm
->
aux_roc_ã_li°
,

1170 
iwl_mvm_time_evít_d©a
,

1171 
li°
);

1172 
out
:

1173 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1174  
ã_d©a
;

1175 
	}
}

1177 
	$iwl_mvm_˛ónup_roc_ã
(
iwl_mvm
 *
mvm
)

1179 
iwl_mvm_time_evít_d©a
 *
ã_d©a
;

1180 
u32
 
uid
;

1182 
ã_d©a
 = 
	`iwl_mvm_gë_roc_ã
(
mvm
);

1183 i‡(
ã_d©a
)

1184 
	`__iwl_mvm_ªmove_time_evít
(
mvm
, 
ã_d©a
, &
uid
);

1185 
	}
}

1187 
	$iwl_mvm_roc_rm_cmd
(
iwl_mvm
 *
mvm
, 
u32
 
a˘ivôy
)

1189 
ªt
;

1190 
iwl_roc_ªq
 
roc_cmd
 = {

1191 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_REMOVE
),

1192 .
a˘ivôy
 = 
	`˝u_to_À32
(activity),

1195 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1196 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1197 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
ROC_CMD
),

1198 0, (
roc_cmd
), &roc_cmd);

1199 
	`WARN_ON
(
ªt
);

1200 
	}
}

1202 
	$iwl_mvm_roc_°©i⁄_ªmove
(
iwl_mvm
 *
mvm
,

1203 
iwl_mvm_vif
 *
mvmvif
)

1205 
u32
 
cmd_id
 = 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
ROC_CMD
);

1206 
u8
 
fw_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
cmd_id
,

1207 
IWL_FW_CMD_VER_UNKNOWN
);

1209 i‡(
fw_vî
 =
IWL_FW_CMD_VER_UNKNOWN
)

1210 
	`iwl_mvm_ªmove_aux_roc_ã
(
mvm
, 
mvmvif
,

1211 &
mvmvif
->
hs_time_evít_d©a
);

1212 i‡(
fw_vî
 == 3)

1213 
	`iwl_mvm_roc_rm_cmd
(
mvm
, 
ROC_ACTIVITY_HOTSPOT
);

1215 
	`IWL_ERR
(
mvm
, "ROC comm™d vîsi⁄ %d mism©ch!\n", 
fw_vî
);

1216 
	}
}

1218 
	$iwl_mvm_°›_roc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

1220 
iwl_mvm_vif
 *
mvmvif
;

1221 
iwl_mvm_time_evít_d©a
 *
ã_d©a
;

1223 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

1224 
IWL_UCODE_TLV_CAPA_SESSION_PROT_CMD
)) {

1225 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1226 
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

1228 i‡(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
) {

1229 i‡(
ã_d©a
->
id
 >
SESSION_PROTECT_CONF_MAX_ID
) {

1230 
	`IWL_DEBUG_TE
(
mvm
,

1235 
	`iwl_mvm_ˇn˚l_£ssi⁄_¥Ÿe˘i⁄
(
mvm
, 
vif
,

1236 
ã_d©a
->
id
,

1237 
ã_d©a
->
lök_id
);

1239 
	`iwl_mvm_roc_°©i⁄_ªmove
(
mvm
, 
mvmvif
);

1241 
˛ónup_roc
;

1244 
ã_d©a
 = 
	`iwl_mvm_gë_roc_ã
(
mvm
);

1245 i‡(!
ã_d©a
) {

1246 
	`IWL_WARN
(
mvm
, "NoÑemain on channelÉvent\n");

1250 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
ã_d©a
->
vif
);

1252 i‡(
ã_d©a
->
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
)

1253 
	`iwl_mvm_ªmove_time_evít
(
mvm
, 
mvmvif
, 
ã_d©a
);

1255 
	`iwl_mvm_ªmove_aux_roc_ã
(
mvm
, 
mvmvif
, 
ã_d©a
);

1257 
˛ónup_roc
:

1263 
	`£t_bô
(
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
 ?

1264 
IWL_MVM_STATUS_ROC_RUNNING
 : 
IWL_MVM_STATUS_ROC_AUX_RUNNING
,

1265 &
mvm
->
°©us
);

1266 
	`iwl_mvm_˛ónup_roc
(
mvm
);

1267 
	}
}

1269 
	$iwl_mvm_ªmove_cß_≥riod
(
iwl_mvm
 *
mvm
,

1270 
õì80211_vif
 *
vif
)

1272 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1273 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

1274 
u32
 
id
;

1276 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1278 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

1279 
id
 = 
ã_d©a
->id;

1280 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1282 i‡(
id
 !
TE_CHANNEL_SWITCH_PERIOD
)

1285 
	`iwl_mvm_ªmove_time_evít
(
mvm
, 
mvmvif
, 
ã_d©a
);

1286 
	}
}

1288 
	$iwl_mvm_scheduÀ_cß_≥riod
(
iwl_mvm
 *
mvm
,

1289 
õì80211_vif
 *
vif
,

1290 
u32
 
duøti⁄
, u32 
≠∂y_time
)

1292 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1293 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

1294 
iwl_time_evít_cmd
 
time_cmd
 = {};

1296 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1298 i‡(
ã_d©a
->
ru¬ög
) {

1299 
u32
 
id
;

1301 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

1302 
id
 = 
ã_d©a
->id;

1303 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1305 i‡(
id
 =
TE_CHANNEL_SWITCH_PERIOD
) {

1306 
	`IWL_DEBUG_TE
(
mvm
, "CSÖeriod isálready scheduled\n");

1307  -
EBUSY
;

1315 
	`iwl_mvm_ªmove_time_evít
(
mvm
, 
mvmvif
, 
ã_d©a
);

1318 
time_cmd
.
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
);

1319 
time_cmd
.
id_™d_cﬁ‹
 =

1320 
	`˝u_to_À32
(
	`FW_CMD_ID_AND_COLOR
(
mvmvif
->
id
, mvmvif->
cﬁ‹
));

1321 
time_cmd
.
id
 = 
	`˝u_to_À32
(
TE_CHANNEL_SWITCH_PERIOD
);

1322 
time_cmd
.
≠∂y_time
 = 
	`˝u_to_À32
(apply_time);

1323 
time_cmd
.
max_‰ags
 = 
TE_V2_FRAG_NONE
;

1324 
time_cmd
.
duøti⁄
 = 
	`˝u_to_À32
(duration);

1325 
time_cmd
.
ª≥©
 = 1;

1326 
time_cmd
.
öãrvÆ
 = 
	`˝u_to_À32
(1);

1327 
time_cmd
.
pﬁicy
 = 
	`˝u_to_À16
(
TE_V2_NOTIF_HOST_EVENT_START
 |

1328 
TE_V2_ABSENCE
);

1329 i‡(!
≠∂y_time
)

1330 
time_cmd
.
pﬁicy
 |
	`˝u_to_À16
(
TE_V2_START_IMMEDIATELY
);

1332  
	`iwl_mvm_time_evít_£nd_add
(
mvm
, 
vif
, 
ã_d©a
, &
time_cmd
);

1333 
	}
}

1335 
boﬁ
 
	$iwl_mvm_£ssi⁄_¥Ÿ_nŸif
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

1336 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

1338 
iwl_mvm
 *
mvm
 =

1339 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

1340 
iwl_mvm_£ssi⁄_¥Ÿ_nŸif
 *
ª•
;

1341 
ª•_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

1343 i‡(
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
SESSION_PROTECTION_NOTIF
 ||

1344 
pkt
->
hdr
.
group_id
 !
MAC_CONF_GROUP
))

1345  
åue
;

1347 i‡(
	`WARN_ON_ONCE
(
ª•_Àn
 !(*
ª•
))) {

1348 
	`IWL_ERR
(
mvm
, "Invalid SESSION_PROTECTION_NOTIFÑesponse\n");

1349  
åue
;

1352 
ª•
 = (*)
pkt
->
d©a
;

1354 i‡(!
ª•
->
°©us
)

1355 
	`IWL_ERR
(
mvm
,

1358  
åue
;

1359 
	}
}

1361 
	$iwl_mvm_scheduÀ_£ssi⁄_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
,

1362 
õì80211_vif
 *
vif
,

1363 
u32
 
duøti⁄
, u32 
mö_duøti⁄
,

1364 
boﬁ
 
waô_f‹_nŸif
,

1365 
lök_id
)

1367 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1368 
iwl_mvm_time_evít_d©a
 *
ã_d©a
 = &
mvmvif
->
time_evít_d©a
;

1369 c⁄° 
u16
 
nŸif
[] = { 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
SESSION_PROTECTION_NOTIF
) };

1370 
iwl_nŸifiˇti⁄_waô
 
waô_nŸif
;

1371 
mac_lök_id
 = 
	`iwl_mvm_gë_£ssi⁄_¥Ÿ_id
(
mvm
, 
vif
, (
s8
)
lök_id
);

1372 
iwl_mvm_£ssi⁄_¥Ÿ_cmd
 
cmd
 = {

1373 .
id_™d_cﬁ‹
 = 
	`˝u_to_À32
(
mac_lök_id
),

1374 .
a˘i⁄
 = 
	`˝u_to_À32
(
FW_CTXT_ACTION_ADD
),

1375 .
c⁄f_id
 = 
	`˝u_to_À32
(
SESSION_PROTECT_CONF_ASSOC
),

1376 .
duøti⁄_tu
 = 
	`˝u_to_À32
(
	`MSEC_TO_TU
(
duøti⁄
)),

1379 i‡(
mac_lök_id
 < 0)

1382 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1384 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

1385 i‡(
ã_d©a
->
ru¬ög
 &&Åe_d©a->
lök_id
 ==Üink_id &&

1386 
	`time_a·î
(
ã_d©a
->
íd_jiffõs
, 
	`TU_TO_EXP_TIME
(
mö_duøti⁄
))) {

1387 
	`IWL_DEBUG_TE
(
mvm
, "We haveÉnoughÅime inÅhe current TE: %u\n",

1388 
	`jiffõs_to_m£cs
(
ã_d©a
->
íd_jiffõs
 - 
jiffõs
));

1389 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1394 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

1399 
ã_d©a
->
id
 = 
	`À32_to_˝u
(
cmd
.
c⁄f_id
);

1400 
ã_d©a
->
duøti⁄
 = 
	`À32_to_˝u
(
cmd
.
duøti⁄_tu
);

1401 
ã_d©a
->
vif
 = vif;

1402 
ã_d©a
->
lök_id
 =Üink_id;

1403 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1405 
	`IWL_DEBUG_TE
(
mvm
, "AddÇew sessionÖrotection, duration %d TU\n",

1406 
	`À32_to_˝u
(
cmd
.
duøti⁄_tu
));

1408 i‡(!
waô_f‹_nŸif
) {

1409 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1410 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
SESSION_PROTECTION_CMD
),

1411 0, (
cmd
), &cmd)) {

1412 
£nd_cmd_îr
;

1418 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_nŸif
,

1419 
nŸif
, 
	`ARRAY_SIZE
(notif),

1420 
iwl_mvm_£ssi⁄_¥Ÿ_nŸif
, 
NULL
);

1422 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

1423 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
SESSION_PROTECTION_CMD
),

1424 0, (
cmd
), &cmd)) {

1425 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_nŸif
);

1426 
£nd_cmd_îr
;

1427 } i‡(
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_nŸif
,

1428 
	`TU_TO_JIFFIES
(100))) {

1429 
	`IWL_ERR
(
mvm
,

1434 
£nd_cmd_îr
:

1435 
	`IWL_ERR
(
mvm
,

1437 
	`•ö_lock_bh
(&
mvm
->
time_evít_lock
);

1438 
	`iwl_mvm_ã_˛ór_d©a
(
mvm
, 
ã_d©a
);

1439 
	`•ö_u∆ock_bh
(&
mvm
->
time_evít_lock
);

1440 
	}
}

	@mvm/time-event.h

6 #i‚de‡
__time_evít_h__


7 
	#__time_evít_h__


	)

9 
	~"fw-≠i.h
"

11 
	~"mvm.h
"

58 
	#IWL_MVM_TE_SESSION_PROTECTION_MAX_TIME_MS
 600

	)

59 
	#IWL_MVM_TE_SESSION_PROTECTION_MIN_TIME_MS
 400

	)

79 
iwl_mvm_¥Ÿe˘_£ssi⁄
(
iwl_mvm
 *
mvm
,

80 
õì80211_vif
 *
vif
,

81 
u32
 
duøti⁄
, u32 
mö_duøti⁄
,

82 
u32
 
max_dñay
, 
boﬁ
 
waô_f‹_nŸif
);

94 
iwl_mvm_°›_£ssi⁄_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
,

95 
õì80211_vif
 *
vif
);

100 
iwl_mvm_rx_time_evít_nŸif
(
iwl_mvm
 *
mvm
,

101 
iwl_rx_cmd_buf„r
 *
rxb
);

108 
iwl_mvm_rx_roc_nŸif
(
iwl_mvm
 *
mvm
,

109 
iwl_rx_cmd_buf„r
 *
rxb
);

128 
iwl_mvm_°¨t_p2p_roc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

129 
duøti⁄
, 
õì80211_roc_ty≥
 
ty≥
);

140 
iwl_mvm_°›_roc
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
);

152 
iwl_mvm_ªmove_time_evít
(
iwl_mvm
 *
mvm
,

153 
iwl_mvm_vif
 *
mvmvif
,

154 
iwl_mvm_time_evít_d©a
 *
ã_d©a
);

164 
iwl_mvm_ã_˛ór_d©a
(
iwl_mvm
 *
mvm
,

165 
iwl_mvm_time_evít_d©a
 *
ã_d©a
);

167 
iwl_mvm_˛ónup_roc_ã
(
iwl_mvm
 *
mvm
);

168 
iwl_mvm_roc_d⁄e_wk
(
w‹k_°ru˘
 *
wk
);

170 
iwl_mvm_ªmove_cß_≥riod
(
iwl_mvm
 *
mvm
,

171 
õì80211_vif
 *
vif
);

183 
iwl_mvm_scheduÀ_cß_≥riod
(
iwl_mvm
 *
mvm
,

184 
õì80211_vif
 *
vif
,

185 
u32
 
duøti⁄
, u32 
≠∂y_time
);

193 
ölöe
 
boﬁ


194 
	$iwl_mvm_ã_scheduÀd
(
iwl_mvm_time_evít_d©a
 *
ã_d©a
)

196 i‡(!
ã_d©a
)

197  
Ál£
;

199  !!
ã_d©a
->
uid
;

200 
	}
}

211 
iwl_mvm_scheduÀ_£ssi⁄_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
,

212 
õì80211_vif
 *
vif
,

213 
u32
 
duøti⁄
, u32 
mö_duøti⁄
,

214 
boﬁ
 
waô_f‹_nŸif
,

215 
lök_id
);

222 
iwl_mvm_rx_£ssi⁄_¥Ÿe˘_nŸif
(
iwl_mvm
 *
mvm
,

223 
iwl_rx_cmd_buf„r
 *
rxb
);

	@mvm/time-sync.c

6 
	~"mvm.h
"

7 
	~"time-sync.h
"

8 
	~<löux/õì80211.h
>

10 
	$iwl_mvm_öô_time_sync
(
iwl_time_sync_d©a
 *
d©a
)

12 
	`skb_queue_hód_öô
(&
d©a
->
‰ame_li°
);

13 
	}
}

15 
boﬁ
 
	$iwl_mvm_is_skb_m©ch
(
sk_buff
 *
skb
, 
u8
 *
addr
, u8 
dülog_tokí
)

17 
õì80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

18 
u8
 
skb_dülog_tokí
;

20 i‡(
	`õì80211_is_timög_mósuªmít
(
skb
))

21 
skb_dülog_tokí
 = 
mgmt
->
u
.
a˘i⁄
.u.
wnm_timög_m§
.
dülog_tokí
;

23 
skb_dülog_tokí
 = 
mgmt
->
u
.
a˘i⁄
.u.
·m
.
dülog_tokí
;

25 i‡((
	`ëhî_addr_equÆ
(
mgmt
->
ß
, 
addr
) ||

26 
	`ëhî_addr_equÆ
(
mgmt
->
da
, 
addr
)) &&

27 
skb_dülog_tokí
 =
dülog_tokí
)

28  
åue
;

30  
Ál£
;

31 
	}
}

33 
sk_buff
 *
	$iwl_mvm_time_sync_föd_skb
(
iwl_mvm
 *
mvm
, 
u8
 *
addr
,

34 
u8
 
dülog_tokí
)

36 
sk_buff
 *
skb
;

42 (
skb
 = 
	`skb_dequeue
(&
mvm
->
time_sync
.
‰ame_li°
))) {

43 i‡(
	`iwl_mvm_is_skb_m©ch
(
skb
, 
addr
, 
dülog_tokí
))

46 
	`k‰ì_skb
(
skb
);

47 
skb
 = 
NULL
;

50  
skb
;

51 
	}
}

53 
u64
 
	$iwl_mvm_gë_64_bô
(
__À32
 
high
, __À32 
low
)

55  ((
u64
)
	`À32_to_˝u
(
high
Ë<< 32Ë|Üe32_to_˝u(
low
);

56 
	}
}

58 
	$iwl_mvm_time_sync_msmt_evít
(
iwl_mvm
 *
mvm
,

59 
iwl_rx_cmd_buf„r
 *
rxb
)

61 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

62 
iwl_time_msmt_nŸify
 *
nŸif
 = (*)
pkt
->
d©a
;

63 
õì80211_rx_°©us
 *
rx_°©us
;

64 
skb_sh¨ed_hwt°amps
 *
shwt
;

65 
u64
 
ts_10ns
;

66 
sk_buff
 *
skb
 =

67 
	`iwl_mvm_time_sync_föd_skb
(
mvm
, 
nŸif
->
≥î_addr
,

68 
	`À32_to_˝u
(
nŸif
->
dülog_tokí
));

69 
u64
 
adj_time
;

71 i‡(!
skb
) {

72 
	`IWL_DEBUG_INFO
(
mvm
, "Time syncÉvent butÇoÖending skb\n");

76 
ts_10ns
 = 
	`iwl_mvm_gë_64_bô
(
nŸif
->
t2_hi
,ÇŸif->
t2_lo
);

77 
adj_time
 = 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, 
ts_10ns
 * 10);

78 
shwt
 = 
	`skb_hwt°amps
(
skb
);

79 
shwt
->
hwt°amp
 = 
	`ktime_£t
(0, 
adj_time
);

81 
ts_10ns
 = 
	`iwl_mvm_gë_64_bô
(
nŸif
->
t3_hi
,ÇŸif->
t3_lo
);

82 
adj_time
 = 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, 
ts_10ns
 * 10);

83 
rx_°©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

84 
rx_°©us
->
ack_tx_hwt°amp
 = 
	`ktime_£t
(0, 
adj_time
);

86 
	`IWL_DEBUG_INFO
(
mvm
,

88 
	`ktime_to_ns
(
shwt
->
hwt°amp
),

89 
	`ktime_to_ns
(
rx_°©us
->
ack_tx_hwt°amp
));

90 
	`õì80211_rx_«pi
(
mvm
->
hw
, 
NULL
, 
skb
, NULL);

91 
	}
}

93 
	$iwl_mvm_time_sync_msmt_c⁄fúm_evít
(
iwl_mvm
 *
mvm
,

94 
iwl_rx_cmd_buf„r
 *
rxb
)

96 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

97 
iwl_time_msmt_cfm_nŸify
 *
nŸif
 = (*)
pkt
->
d©a
;

98 
õì80211_tx_°©us
 
°©us
 = {};

99 
skb_sh¨ed_hwt°amps
 *
shwt
;

100 
u64
 
ts_10ns
, 
adj_time
;

102 
°©us
.
skb
 =

103 
	`iwl_mvm_time_sync_föd_skb
(
mvm
, 
nŸif
->
≥î_addr
,

104 
	`À32_to_˝u
(
nŸif
->
dülog_tokí
));

106 i‡(!
°©us
.
skb
) {

107 
	`IWL_DEBUG_INFO
(
mvm
, "Time sync confirm butÇoÖending skb\n");

111 
ts_10ns
 = 
	`iwl_mvm_gë_64_bô
(
nŸif
->
t1_hi
,ÇŸif->
t1_lo
);

112 
adj_time
 = 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, 
ts_10ns
 * 10);

113 
shwt
 = 
	`skb_hwt°amps
(
°©us
.
skb
);

114 
shwt
->
hwt°amp
 = 
	`ktime_£t
(0, 
adj_time
);

116 
ts_10ns
 = 
	`iwl_mvm_gë_64_bô
(
nŸif
->
t4_hi
,ÇŸif->
t4_lo
);

117 
adj_time
 = 
	`iwl_mvm_±p_gë_adj_time
(
mvm
, 
ts_10ns
 * 10);

118 
°©us
.
öfo
 = 
	`IEEE80211_SKB_CB
(°©us.
skb
);

119 
°©us
.
ack_hwt°amp
 = 
	`ktime_£t
(0, 
adj_time
);

121 
	`IWL_DEBUG_INFO
(
mvm
,

123 
	`ktime_to_ns
(
shwt
->
hwt°amp
),

124 
	`ktime_to_ns
(
°©us
.
ack_hwt°amp
));

125 
	`õì80211_tx_°©us_ext
(
mvm
->
hw
, &
°©us
);

126 
	}
}

128 
	$iwl_mvm_time_sync_c⁄fig
(
iwl_mvm
 *
mvm
, c⁄° 
u8
 *
addr
, 
u32
 
¥Ÿocﬁs
)

130 
iwl_time_sync_cfg_cmd
 
cmd
 = {};

131 
îr
;

133 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

135 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

136 
IWL_UCODE_TLV_CAPA_TIME_SYNC_BOTH_FTM_TM
))

137  -
EINVAL
;

142 i‡(
mvm
->
time_sync
.
a˘ive
 &&

143 !
	`ëhî_addr_equÆ
(
addr
, 
mvm
->
time_sync
.
≥î_addr
)) {

144 
	`IWL_DEBUG_INFO
(
mvm
, "Time sync:Ñeject config forÖeer: %pM\n",

145 
addr
);

146  -
ENOBUFS
;

149 i‡(
¥Ÿocﬁs
 & ~(
IWL_TIME_SYNC_PROTOCOL_TM
 |

150 
IWL_TIME_SYNC_PROTOCOL_FTM
))

151  -
EINVAL
;

153 
cmd
.
¥Ÿocﬁs
 = 
	`˝u_to_À32
(protocols);

155 
	`ëhî_addr_c›y
(
cmd
.
≥î_addr
, 
addr
);

157 
îr
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
,

158 
	`WIDE_ID
(
DATA_PATH_GROUP
,

159 
WNM_80211V_TIMING_MEASUREMENT_CONFIG_CMD
),

160 0, (
cmd
), &cmd);

161 i‡(
îr
) {

162 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£ndÅimêsyn¯cfg cmd: %d\n", 
îr
);

164 
mvm
->
time_sync
.
a˘ive
 = 
¥Ÿocﬁs
 != 0;

165 
	`ëhî_addr_c›y
(
mvm
->
time_sync
.
≥î_addr
, 
addr
);

166 
	`IWL_DEBUG_INFO
(
mvm
, "Timêsync: sëÖì∏addr=%pM\n", 
addr
);

169 i‡(!
mvm
->
time_sync
.
a˘ive
)

170 
	`skb_queue_purge
(&
mvm
->
time_sync
.
‰ame_li°
);

172  
îr
;

173 
	}
}

	@mvm/time-sync.h

5 #i‚de‡
__TIME_SYNC_H__


6 
	#__TIME_SYNC_H__


	)

8 
	~"mvm.h
"

9 
	~<löux/õì80211.h
>

11 
iwl_mvm_öô_time_sync
(
iwl_time_sync_d©a
 *
d©a
);

12 
iwl_mvm_time_sync_msmt_evít
(
iwl_mvm
 *
mvm
,

13 
iwl_rx_cmd_buf„r
 *
rxb
);

14 
iwl_mvm_time_sync_msmt_c⁄fúm_evít
(
iwl_mvm
 *
mvm
,

15 
iwl_rx_cmd_buf„r
 *
rxb
);

16 
iwl_mvm_time_sync_c⁄fig
(
iwl_mvm
 *
mvm
, c⁄° 
u8
 *
addr
,

17 
u32
 
¥Ÿocﬁs
);

19 
ölöe


20 
boﬁ
 
	$iwl_mvm_time_sync_‰ame
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
, 
u8
 *
addr
)

22 i‡(
	`ëhî_addr_equÆ
(
mvm
->
time_sync
.
≥î_addr
, 
addr
) &&

23 (
	`õì80211_is_timög_mósuªmít
(
skb
Ë|| 
	`õì80211_is_·m
(skb))) {

24 
	`skb_queue_èû
(&
mvm
->
time_sync
.
‰ame_li°
, 
skb
);

25  
åue
;

28  
Ál£
;

29 
	}
}

	@mvm/tt.c

7 
	~<löux/s‹t.h
>

9 
	~"mvm.h
"

11 
	#IWL_MVM_TEMP_NOTIF_WAIT_TIMEOUT
 
HZ


	)

13 
	$iwl_mvm_íãr_˘kûl
(
iwl_mvm
 *
mvm
)

15 
iwl_mvm_â_mgmt
 *
â
 = &
mvm
->
thîmÆ_thrŸée
;

16 
u32
 
duøti⁄
 = 
â
->
∑øms
.
˘_kûl_duøti⁄
;

18 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
))

21 
	`IWL_ERR
(
mvm
, "Enter CT Kill\n");

22 
	`iwl_mvm_£t_hw_˘kûl_°©e
(
mvm
, 
åue
);

24 i‡(!
	`iwl_mvm_is_â_ö_fw
(
mvm
)) {

25 
â
->
thrŸée
 = 
Ál£
;

26 
â
->
dy«mic_smps
 = 
Ál£
;

33 i‡(!
mvm
->
ãm≥øtuª_ã°
)

34 
	`scheduÀ_dñayed_w‹k
(&
â
->
˘_kûl_exô
,

35 
	`round_jiffõs_ªœtive
(
duøti⁄
 * 
HZ
));

36 
	}
}

38 
	$iwl_mvm_exô_˘kûl
(
iwl_mvm
 *
mvm
)

40 i‡(!
	`ã°_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
))

43 
	`IWL_ERR
(
mvm
, "Exit CT Kill\n");

44 
	`iwl_mvm_£t_hw_˘kûl_°©e
(
mvm
, 
Ál£
);

45 
	}
}

47 
	$iwl_mvm_â_ãmp_ch™ged
(
iwl_mvm
 *
mvm
, 
u32
 
ãmp
)

50 i‡(
mvm
->
ãm≥øtuª_ã°
)

53 i‡(
mvm
->
ãm≥øtuª
 =
ãmp
)

56 
mvm
->
ãm≥øtuª
 = 
ãmp
;

57 
	`iwl_mvm_â_h™dÀr
(
mvm
);

58 
	}
}

60 
	$iwl_mvm_ãmp_nŸif_∑r£
(
iwl_mvm
 *
mvm
,

61 
iwl_rx_∑ckë
 *
pkt
)

63 
iwl_dts_mósuªmít_nŸif_v1
 *
nŸif_v1
;

64 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

65 
ãmp
;

70 i‡(
	`WARN_ON_ONCE
(
Àn
 < (*
nŸif_v1
))) {

71 
	`IWL_ERR
(
mvm
, "Invalid DTS_MEASUREMENT_NOTIFICATION\n");

72  -
EINVAL
;

75 
nŸif_v1
 = (*)
pkt
->
d©a
;

77 
ãmp
 = 
	`À32_to_˝u
(
nŸif_v1
->temp);

80 i‡(
	`WARN_ON_ONCE
(
ãmp
 < 0))

81 
ãmp
 = 0;

83 
	`IWL_DEBUG_TEMP
(
mvm
, "DTS_MEASUREMENT_NOTIFICATION - %d\n", 
ãmp
);

85  
ãmp
;

86 
	}
}

88 
boﬁ
 
	$iwl_mvm_ãmp_nŸif_waô
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

89 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

91 
iwl_mvm
 *
mvm
 =

92 
	`c⁄èöî_of
(
nŸif_waô
, 
iwl_mvm
,Çotif_wait);

93 *
ãmp
 = 
d©a
;

94 
ªt
;

96 
ªt
 = 
	`iwl_mvm_ãmp_nŸif_∑r£
(
mvm
, 
pkt
);

97 i‡(
ªt
 < 0)

98  
åue
;

100 *
ãmp
 = 
ªt
;

102  
åue
;

103 
	}
}

105 
	$iwl_mvm_ãmp_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

107 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

108 
iwl_dts_mósuªmít_nŸif_v2
 *
nŸif_v2
;

109 
Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

110 
ãmp
;

111 
u32
 
ths_¸os£d
;

114 i‡(
	`ã°_bô
(
IWL_MVM_STATUS_HW_CTKILL
, &
mvm
->
°©us
))

117 
ãmp
 = 
	`iwl_mvm_ãmp_nŸif_∑r£
(
mvm
, 
pkt
);

119 i‡(!
	`iwl_mvm_is_â_ö_fw
(
mvm
)) {

120 i‡(
ãmp
 >= 0)

121 
	`iwl_mvm_â_ãmp_ch™ged
(
mvm
, 
ãmp
);

125 i‡(
	`WARN_ON_ONCE
(
Àn
 < (*
nŸif_v2
))) {

126 
	`IWL_ERR
(
mvm
, "Invalid DTS_MEASUREMENT_NOTIFICATION\n");

130 
nŸif_v2
 = (*)
pkt
->
d©a
;

131 
ths_¸os£d
 = 
	`À32_to_˝u
(
nŸif_v2
->
thªshﬁd_idx
);

136 i‡(
ths_¸os£d
 == 0xFF)

139 
	`IWL_DEBUG_TEMP
(
mvm
, "Temp = %d Threshold crossed = %d\n",

140 
ãmp
, 
ths_¸os£d
);

142 #ifde‡
CONFIG_THERMAL


143 i‡(
	`WARN_ON
(
ths_¸os£d
 >
IWL_MAX_DTS_TRIPS
))

146 i‡(
mvm
->
tz_devi˚
.
tz⁄e
) {

147 
iwl_mvm_thîmÆ_devi˚
 *
tz_dev
 = &
mvm
->
tz_devi˚
;

149 
	`thîmÆ_z⁄e_devi˚_upd©e
(
tz_dev
->
tz⁄e
,

150 
THERMAL_TRIP_VIOLATED
);

153 
	}
}

155 
	$iwl_mvm_˘_kûl_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

157 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

158 
˘_kûl_nŸif
 *
nŸif
;

160 
nŸif
 = (
˘_kûl_nŸif
 *)
pkt
->
d©a
;

161 
	`IWL_DEBUG_TEMP
(
mvm
, "CT KillÇotificationÅemperature = %d\n",

162 
nŸif
->
ãm≥øtuª
);

163 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
PHY_OPS_GROUP
,

164 
CT_KILL_NOTIFICATION
, 0) > 1)

165 
	`IWL_DEBUG_TEMP
(
mvm
,

167 
nŸif
->
dts
,ÇŸif->
scheme
);

169 
	`iwl_mvm_íãr_˘kûl
(
mvm
);

170 
	}
}

176 
	$iwl_mvm_£nd_ãmp_cmd
(
iwl_mvm
 *
mvm
, 
boﬁ
 
ª•⁄£
, 
s32
 *
ãmp
)

178 
iwl_ho°_cmd
 
cmd
 = {};

179 
iwl_dts_mósuªmít_cmd
 
dts_cmd
 = {

180 .
Êags
 = 
	`˝u_to_À32
(
DTS_TRIGGER_CMD_FLAGS_TEMP
),

182 
iwl_ext_dts_mósuªmít_cmd
 
ext_cmd
 = {

183 .
c⁄åﬁ_mode
 = 
	`˝u_to_À32
(
DTS_DIRECT_WITHOUT_MEASURE
),

185 
iwl_dts_mósuªmít_ª•
 *
ª•
;

186 *
cmd_±r
;

187 
ªt
;

188 
u32
 
cmd_Êags
 = 0;

189 
u16
 
Àn
;

192 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

193 
IWL_UCODE_TLV_CAPA_EXTENDED_DTS_MEASURE
)) {

194 
Àn
 = (
ext_cmd
);

195 
cmd_±r
 = &
ext_cmd
;

197 
Àn
 = (
dts_cmd
);

198 
cmd_±r
 = &
dts_cmd
;

201 i‡(
ª•⁄£
) {

202 
cmd_Êags
 = 
CMD_WANT_SKB
;

203 
Àn
 = 0;

206 
cmd
.
id
 = 
	`WIDE_ID
(
PHY_OPS_GROUP
, 
CMD_DTS_MEASUREMENT_TRIGGER_WIDE
);

207 
cmd
.
Àn
[0] =Üen;

208 
cmd
.
Êags
 = 
cmd_Êags
;

209 
cmd
.
d©a
[0] = 
cmd_±r
;

211 
	`IWL_DEBUG_TEMP
(
mvm
,

213 
ª•⁄£
 ? "with" : "without");

214 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

216 i‡(
ªt
) {

217 
	`IWL_ERR
(
mvm
,

219 
ªt
);

220  
ªt
;

223 i‡(
ª•⁄£
) {

224 
ª•
 = (*)
cmd
.
ª•_pkt
->
d©a
;

225 *
ãmp
 = 
	`À32_to_˝u
(
ª•
->temp);

226 
	`IWL_DEBUG_TEMP
(
mvm
,

228 *
ãmp
);

229 
	`iwl_‰ì_ª•
(&
cmd
);

232  
ªt
;

233 
	}
}

235 
	$iwl_mvm_gë_ãmp
(
iwl_mvm
 *
mvm
, 
s32
 *
ãmp
)

237 
iwl_nŸifiˇti⁄_waô
 
waô_ãmp_nŸif
;

238 
u16
 
ãmp_nŸif
[] = { 
	`WIDE_ID
(
PHY_OPS_GROUP
,

239 
DTS_MEASUREMENT_NOTIF_WIDE
) };

240 
ªt
;

241 
u8
 
cmd_vî
;

248 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

249 
	`WIDE_ID
(
PHY_OPS_GROUP
, 
CMD_DTS_MEASUREMENT_TRIGGER_WIDE
),

250 
IWL_FW_CMD_VER_UNKNOWN
);

251 i‡(
cmd_vî
 == 1)

252  
	`iwl_mvm_£nd_ãmp_cmd
(
mvm
, 
åue
, 
ãmp
);

254 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

256 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
waô_ãmp_nŸif
,

257 
ãmp_nŸif
, 
	`ARRAY_SIZE
(temp_notif),

258 
iwl_mvm_ãmp_nŸif_waô
, 
ãmp
);

260 
ªt
 = 
	`iwl_mvm_£nd_ãmp_cmd
(
mvm
, 
Ál£
, 
ãmp
);

261 i‡(
ªt
) {

262 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_ãmp_nŸif
);

263  
ªt
;

266 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
waô_ãmp_nŸif
,

267 
IWL_MVM_TEMP_NOTIF_WAIT_TIMEOUT
);

268 i‡(
ªt
)

269 
	`IWL_WARN
(
mvm
, "GettingÅheÅemperatureÅimed out\n");

271  
ªt
;

272 
	}
}

274 
	$check_exô_˘kûl
(
w‹k_°ru˘
 *
w‹k
)

276 
iwl_mvm_â_mgmt
 *
â
;

277 
iwl_mvm
 *
mvm
;

278 
u32
 
duøti⁄
;

279 
s32
 
ãmp
;

280 
ªt
;

282 
â
 = 
	`c⁄èöî_of
(
w‹k
, 
iwl_mvm_â_mgmt
, 
˘_kûl_exô
.work);

283 
mvm
 = 
	`c⁄èöî_of
(
â
, 
iwl_mvm
, 
thîmÆ_thrŸée
);

285 i‡(
	`iwl_mvm_is_â_ö_fw
(
mvm
)) {

286 
	`iwl_mvm_exô_˘kûl
(
mvm
);

291 
duøti⁄
 = 
â
->
∑øms
.
˘_kûl_duøti⁄
;

293 
	`Êush_w‹k
(&
mvm
->
roc_d⁄e_wk
);

295 
	`muãx_lock
(&
mvm
->
muãx
);

297 i‡(
	`__iwl_mvm_mac_°¨t
(
mvm
))

298 
ªscheduÀ
;

300 
ªt
 = 
	`iwl_mvm_gë_ãmp
(
mvm
, &
ãmp
);

302 
	`__iwl_mvm_mac_°›
(
mvm
);

304 i‡(
ªt
)

305 
ªscheduÀ
;

307 
	`IWL_DEBUG_TEMP
(
mvm
, "NICÅem≥øtuª: %d\n", 
ãmp
);

309 i‡(
ãmp
 <
â
->
∑øms
.
˘_kûl_exô
) {

310 
	`muãx_u∆ock
(&
mvm
->
muãx
);

311 
	`iwl_mvm_exô_˘kûl
(
mvm
);

315 
ªscheduÀ
:

316 
	`muãx_u∆ock
(&
mvm
->
muãx
);

317 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
thîmÆ_thrŸée
.
˘_kûl_exô
,

318 
	`round_jiffõs
(
duøti⁄
 * 
HZ
));

319 
	}
}

321 
	$iwl_mvm_â_smps_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

322 
õì80211_vif
 *
vif
)

324 
iwl_mvm
 *
mvm
 = 
_d©a
;

325 
õì80211_smps_mode
 
smps_mode
;

327 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

329 i‡(
mvm
->
thîmÆ_thrŸée
.
dy«mic_smps
)

330 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

332 
smps_mode
 = 
IEEE80211_SMPS_AUTOMATIC
;

334 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

337 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
, 
IWL_MVM_SMPS_REQ_TT
, 
smps_mode
, 0);

338 
	}
}

340 
	$iwl_mvm_â_tx_¥Ÿe˘i⁄
(
iwl_mvm
 *
mvm
, 
boﬁ
 
íabÀ
)

342 
iwl_mvm_°a
 *
mvm°a
;

343 
i
, 
îr
;

345 
i
 = 0; i < 
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
; i++) {

346 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_¥Ÿe˘ed
(
mvm
, 
i
);

347 i‡(!
mvm°a
)

350 i‡(
íabÀ
 =
mvm°a
->
â_tx_¥Ÿe˘i⁄
)

352 
îr
 = 
	`iwl_mvm_tx_¥Ÿe˘i⁄
(
mvm
, 
mvm°a
, 
íabÀ
);

353 i‡(
îr
) {

354 
	`IWL_ERR
(
mvm
, "FailedÅo %s TxÖrotection\n",

355 
íabÀ
 ? "enable" : "disable");

357 
	`IWL_DEBUG_TEMP
(
mvm
, "%s TxÖrotection\n",

358 
íabÀ
 ? "Enable" : "Disable");

359 
mvm°a
->
â_tx_¥Ÿe˘i⁄
 = 
íabÀ
;

362 
	}
}

364 
	$iwl_mvm_â_tx_backoff
(
iwl_mvm
 *
mvm
, 
u32
 
backoff
)

366 
iwl_ho°_cmd
 
cmd
 = {

367 .
id
 = 
REPLY_THERMAL_MNG_BACKOFF
,

368 .
Àn
 = { (
u32
), },

369 .
d©a
 = { &
backoff
, },

372 
backoff
 = 
	`max
(backoff, 
mvm
->
thîmÆ_thrŸée
.
mö_backoff
);

374 i‡(
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
) == 0) {

375 
	`IWL_DEBUG_TEMP
(
mvm
, "Set Thermal Tx backoffÅo: %u\n",

376 
backoff
);

377 
mvm
->
thîmÆ_thrŸée
.
tx_backoff
 = 
backoff
;

379 
	`IWL_ERR
(
mvm
, "FailedÅo change Thermal Tx backoff\n");

381 
	}
}

383 
	$iwl_mvm_â_h™dÀr
(
iwl_mvm
 *
mvm
)

385 
iwl_â_∑øms
 *
∑øms
 = &
mvm
->
thîmÆ_thrŸée
.params;

386 
iwl_mvm_â_mgmt
 *
â
 = &
mvm
->
thîmÆ_thrŸée
;

387 
s32
 
ãm≥øtuª
 = 
mvm
->temperature;

388 
boﬁ
 
thrŸée_íabÀ
 = 
Ál£
;

389 
i
;

390 
u32
 
tx_backoff
;

392 
	`IWL_DEBUG_TEMP
(
mvm
, "NICÅem≥øtuª: %d\n", mvm->
ãm≥øtuª
);

394 i‡(
∑øms
->
suµ‹t_˘_kûl
 && 
ãm≥øtuª
 >∑øms->
˘_kûl_íåy
) {

395 
	`iwl_mvm_íãr_˘kûl
(
mvm
);

399 i‡(
∑øms
->
suµ‹t_˘_kûl
 &&

400 
ãm≥øtuª
 <
∑øms
->
˘_kûl_exô
) {

401 
	`iwl_mvm_exô_˘kûl
(
mvm
);

405 i‡(
∑øms
->
suµ‹t_dy«mic_smps
) {

406 i‡(!
â
->
dy«mic_smps
 &&

407 
ãm≥øtuª
 >
∑øms
->
dy«mic_smps_íåy
) {

408 
	`IWL_DEBUG_TEMP
(
mvm
, "Enable dynamic SMPS\n");

409 
â
->
dy«mic_smps
 = 
åue
;

410 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

411 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

412 
iwl_mvm_â_smps_ôî©‹
, 
mvm
);

413 
thrŸée_íabÀ
 = 
åue
;

414 } i‡(
â
->
dy«mic_smps
 &&

415 
ãm≥øtuª
 <
∑øms
->
dy«mic_smps_exô
) {

416 
	`IWL_DEBUG_TEMP
(
mvm
, "Disable dynamic SMPS\n");

417 
â
->
dy«mic_smps
 = 
Ál£
;

418 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

419 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

420 
iwl_mvm_â_smps_ôî©‹
, 
mvm
);

424 i‡(
∑øms
->
suµ‹t_tx_¥Ÿe˘i⁄
) {

425 i‡(
ãm≥øtuª
 >
∑øms
->
tx_¥Ÿe˘i⁄_íåy
) {

426 
	`iwl_mvm_â_tx_¥Ÿe˘i⁄
(
mvm
, 
åue
);

427 
thrŸée_íabÀ
 = 
åue
;

428 } i‡(
ãm≥øtuª
 <
∑øms
->
tx_¥Ÿe˘i⁄_exô
) {

429 
	`iwl_mvm_â_tx_¥Ÿe˘i⁄
(
mvm
, 
Ál£
);

433 i‡(
∑øms
->
suµ‹t_tx_backoff
) {

434 
tx_backoff
 = 
â
->
mö_backoff
;

435 
i
 = 0; i < 
TT_TX_BACKOFF_SIZE
; i++) {

436 i‡(
ãm≥øtuª
 < 
∑øms
->
tx_backoff
[
i
].temperature)

438 
tx_backoff
 = 
	`max
(
â
->
mö_backoff
,

439 
∑øms
->
tx_backoff
[
i
].
backoff
);

441 i‡(
tx_backoff
 !
â
->
mö_backoff
)

442 
thrŸée_íabÀ
 = 
åue
;

443 i‡(
â
->
tx_backoff
 !=Åx_backoff)

444 
	`iwl_mvm_â_tx_backoff
(
mvm
, 
tx_backoff
);

447 i‡(!
â
->
thrŸée
 && 
thrŸée_íabÀ
) {

448 
	`IWL_WARN
(
mvm
,

450 
â
->
thrŸée
 = 
åue
;

451 } i‡(
â
->
thrŸée
 && !â->
dy«mic_smps
 &&

452 
â
->
tx_backoff
 =â->
mö_backoff
 &&

453 
ãm≥øtuª
 <
∑øms
->
tx_¥Ÿe˘i⁄_exô
) {

454 
	`IWL_WARN
(
mvm
,

456 
â
->
thrŸée
 = 
Ál£
;

458 
	}
}

460 c⁄° 
iwl_â_∑øms
 
	giwl_mvm_deÁu…_â_∑øms
 = {

461 .
˘_kûl_íåy
 = 118,

462 .
	g˘_kûl_exô
 = 96,

463 .
	g˘_kûl_duøti⁄
 = 5,

464 .
	gdy«mic_smps_íåy
 = 114,

465 .
	gdy«mic_smps_exô
 = 110,

466 .
	gtx_¥Ÿe˘i⁄_íåy
 = 114,

467 .
	gtx_¥Ÿe˘i⁄_exô
 = 108,

468 .
	gtx_backoff
 = {

469 {.
ãm≥øtuª
 = 112, .
	gbackoff
 = 200},

470 {.
	gãm≥øtuª
 = 113, .
	gbackoff
 = 600},

471 {.
	gãm≥øtuª
 = 114, .
	gbackoff
 = 1200},

472 {.
	gãm≥øtuª
 = 115, .
	gbackoff
 = 2000},

473 {.
	gãm≥øtuª
 = 116, .
	gbackoff
 = 4000},

474 {.
	gãm≥øtuª
 = 117, .
	gbackoff
 = 10000},

476 .
	gsuµ‹t_˘_kûl
 = 
åue
,

477 .
	gsuµ‹t_dy«mic_smps
 = 
åue
,

478 .
	gsuµ‹t_tx_¥Ÿe˘i⁄
 = 
åue
,

479 .
	gsuµ‹t_tx_backoff
 = 
åue
,

483 c⁄° 
u32
 
	giwl_mvm_cdev_budgës
[] = {

507 
	$iwl_mvm_˘dp_comm™d
(
iwl_mvm
 *
mvm
, 
u32
 
›
, u32 
°©e
)

509 
iwl_mvm_˘dp_cmd
 
cmd
 = {

510 .
›î©i⁄
 = 
	`˝u_to_À32
(
›
),

511 .
budgë
 = 
	`˝u_to_À32
(
iwl_mvm_cdev_budgës
[
°©e
]),

512 .
wödow_size
 = 0,

514 
ªt
;

515 
u32
 
°©us
;

517 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

519 
°©us
 = 0;

520 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu_°©us
(
mvm
, 
	`WIDE_ID
(
PHY_OPS_GROUP
,

521 
CTDP_CONFIG_CMD
),

522 (
cmd
), &cmd, &
°©us
);

524 i‡(
ªt
) {

525 
	`IWL_ERR
(
mvm
, "cTDP comm™d faûed (îr=%d)\n", 
ªt
);

526  
ªt
;

529 
›
) {

530 
CTDP_CMD_OPERATION_START
:

531 #ifde‡
CONFIG_THERMAL


532 
mvm
->
coﬁög_dev
.
cur_°©e
 = 
°©e
;

535 
CTDP_CMD_OPERATION_REPORT
:

536 
	`IWL_DEBUG_TEMP
(
mvm
, "cTDPávgÉ√rgy i¿mW©à%d\n", 
°©us
);

543  
°©us
;

544 
CTDP_CMD_OPERATION_STOP
:

545 
	`IWL_DEBUG_TEMP
(
mvm
, "cTDP stopped successfully\n");

550 
	}
}

552 #ifde‡
CONFIG_THERMAL


553 
	$com∑ª_ãmps
(c⁄° *
a
, c⁄° *
b
)

555  ((
s16
)
	`À16_to_˝u
(*(
__À16
 *)
a
) -

556 (
s16
)
	`À16_to_˝u
(*(
__À16
 *)
b
));

557 
	}
}

559 
	siwl_åù_wÆk_d©a
 {

560 
__À16
 *
	mthªshﬁds
;

561 
	mcou¡
;

564 
	$iwl_åù_ãmp_cb
(
thîmÆ_åù
 *
åù
, *
¨g
)

566 
iwl_åù_wÆk_d©a
 *
twd
 = 
¨g
;

568 i‡(
åù
->
ãm≥øtuª
 =
THERMAL_TEMP_INVALID
)

571 
twd
->
thªshﬁds
[twd->
cou¡
++] = 
	`˝u_to_À16
((
s16
)(
åù
->
ãm≥øtuª
 / 1000));

573 
	}
}

576 
	$iwl_mvm_£nd_ãmp_ªp‹t_ths_cmd
(
iwl_mvm
 *
mvm
)

578 
ãmp_ªp‹t_ths_cmd
 
cmd
 = {0};

579 
ªt
;

580 #ifde‡
CONFIG_THERMAL


581 
iwl_åù_wÆk_d©a
 
twd
 = { .
thªshﬁds
 = 
cmd
.thªshﬁds, .
cou¡
 = 0 };

583 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

585 i‡(!
mvm
->
tz_devi˚
.
tz⁄e
)

586 
£nd
;

595 
	`f‹_óch_thîmÆ_åù
(
mvm
->
tz_devi˚
.
tz⁄e
, 
iwl_åù_ãmp_cb
, &
twd
);

597 
cmd
.
num_ãmps
 = 
	`˝u_to_À32
(
twd
.
cou¡
);

598 i‡(
twd
.
cou¡
)

599 
	`s‹t
(
cmd
.
thªshﬁds
, 
twd
.
cou¡
, (
s16
), 
com∑ª_ãmps
, 
NULL
);

601 
£nd
:

603 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
PHY_OPS_GROUP
,

604 
TEMP_REPORTING_THRESHOLDS_CMD
),

605 0, (
cmd
), &cmd);

606 i‡(
ªt
)

607 
	`IWL_ERR
(
mvm
, "TEMP_REPORT_THS_CMD command failed (err=%d)\n",

608 
ªt
);

610  
ªt
;

611 
	}
}

613 #ifde‡
CONFIG_THERMAL


614 
	$iwl_mvm_tz⁄e_gë_ãmp
(
thîmÆ_z⁄e_devi˚
 *
devi˚
,

615 *
ãm≥øtuª
)

617 
iwl_mvm
 *
mvm
 = 
	`thîmÆ_z⁄e_devi˚_¥iv
(
devi˚
);

618 
ªt
;

619 
ãmp
;

621 
	`muãx_lock
(&
mvm
->
muãx
);

623 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

624 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
) {

625 
ªt
 = -
ENODATA
;

626 
out
;

629 
ªt
 = 
	`iwl_mvm_gë_ãmp
(
mvm
, &
ãmp
);

630 i‡(
ªt
)

631 
out
;

633 *
ãm≥øtuª
 = 
ãmp
 * 1000;

635 
out
:

636 
	`muãx_u∆ock
(&
mvm
->
muãx
);

637  
ªt
;

638 
	}
}

640 
	$iwl_mvm_tz⁄e_£t_åù_ãmp
(
thîmÆ_z⁄e_devi˚
 *
devi˚
,

641 
åù
, 
ãmp
)

643 
iwl_mvm
 *
mvm
 = 
	`thîmÆ_z⁄e_devi˚_¥iv
(
devi˚
);

644 
ªt
;

646 
	`muãx_lock
(&
mvm
->
muãx
);

648 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

649 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
) {

650 
ªt
 = -
EIO
;

651 
out
;

654 i‡((
ãmp
 / 1000Ë> 
S16_MAX
) {

655 
ªt
 = -
EINVAL
;

656 
out
;

659 
ªt
 = 
	`iwl_mvm_£nd_ãmp_ªp‹t_ths_cmd
(
mvm
);

660 
out
:

661 
	`muãx_u∆ock
(&
mvm
->
muãx
);

662  
ªt
;

663 
	}
}

665 
thîmÆ_z⁄e_devi˚_›s
 
	gtz⁄e_›s
 = {

666 .
gë_ãmp
 = 
iwl_mvm_tz⁄e_gë_ãmp
,

667 .
	g£t_åù_ãmp
 = 
iwl_mvm_tz⁄e_£t_åù_ãmp
,

670 
	$iwl_mvm_thîmÆ_z⁄e_ªgi°î
(
iwl_mvm
 *
mvm
)

672 
i
, 
ªt
;

673 
«me
[16];

674 
©omic_t
 
cou¡î
 = 
	`ATOMIC_INIT
(0);

676 i‡(!
	`iwl_mvm_is_â_ö_fw
(
mvm
)) {

677 
mvm
->
tz_devi˚
.
tz⁄e
 = 
NULL
;

682 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
«me
Ë>
THERMAL_NAME_LENGTH
);

684 
	`•rötf
(
«me
, "iwlwifi_%u", 
	`©omic_öc_ªtu∫
(&
cou¡î
) & 0xFF);

689 
i
 = 0 ; i < 
IWL_MAX_DTS_TRIPS
; i++) {

690 
mvm
->
tz_devi˚
.
åùs
[
i
].
ãm≥øtuª
 = 
THERMAL_TEMP_INVALID
;

691 
mvm
->
tz_devi˚
.
åùs
[
i
].
ty≥
 = 
THERMAL_TRIP_PASSIVE
;

692 
mvm
->
tz_devi˚
.
åùs
[
i
].
Êags
 = 
THERMAL_TRIP_FLAG_RW_TEMP
;

694 
mvm
->
tz_devi˚
.
tz⁄e
 = 
	`thîmÆ_z⁄e_devi˚_ªgi°î_wôh_åùs
(
«me
,

695 
mvm
->
tz_devi˚
.
åùs
,

696 
IWL_MAX_DTS_TRIPS
,

697 
mvm
, &
tz⁄e_›s
,

698 
NULL
, 0, 0);

699 i‡(
	`IS_ERR
(
mvm
->
tz_devi˚
.
tz⁄e
)) {

700 
	`IWL_DEBUG_TEMP
(
mvm
,

702 
	`PTR_ERR
(
mvm
->
tz_devi˚
.
tz⁄e
));

703 
mvm
->
tz_devi˚
.
tz⁄e
 = 
NULL
;

707 
ªt
 = 
	`thîmÆ_z⁄e_devi˚_íabÀ
(
mvm
->
tz_devi˚
.
tz⁄e
);

708 i‡(
ªt
) {

709 
	`IWL_DEBUG_TEMP
(
mvm
, "FailedÅoÉnableÅhermal zone\n");

710 
	`thîmÆ_z⁄e_devi˚_uƒegi°î
(
mvm
->
tz_devi˚
.
tz⁄e
);

712 
	}
}

714 
	$iwl_mvm_tcoﬁ_gë_max_°©e
(
thîmÆ_coﬁög_devi˚
 *
cdev
,

715 *
°©e
)

717 *
°©e
 = 
	`ARRAY_SIZE
(
iwl_mvm_cdev_budgës
) - 1;

720 
	}
}

722 
	$iwl_mvm_tcoﬁ_gë_cur_°©e
(
thîmÆ_coﬁög_devi˚
 *
cdev
,

723 *
°©e
)

725 
iwl_mvm
 *
mvm
 = (iwl_mvm *)(
cdev
->
devd©a
);

727 *
°©e
 = 
mvm
->
coﬁög_dev
.
cur_°©e
;

730 
	}
}

732 
	$iwl_mvm_tcoﬁ_£t_cur_°©e
(
thîmÆ_coﬁög_devi˚
 *
cdev
,

733 
√w_°©e
)

735 
iwl_mvm
 *
mvm
 = (iwl_mvm *)(
cdev
->
devd©a
);

736 
ªt
;

738 
	`muãx_lock
(&
mvm
->
muãx
);

740 i‡(!
	`iwl_mvm_fúmw¨e_ru¬ög
(
mvm
) ||

741 
mvm
->
fwπ
.
cur_fw_img
 !
IWL_UCODE_REGULAR
) {

742 
ªt
 = -
EIO
;

743 
u∆ock
;

746 i‡(
√w_°©e
 >
	`ARRAY_SIZE
(
iwl_mvm_cdev_budgës
)) {

747 
ªt
 = -
EINVAL
;

748 
u∆ock
;

751 
ªt
 = 
	`iwl_mvm_˘dp_comm™d
(
mvm
, 
CTDP_CMD_OPERATION_START
,

752 
√w_°©e
);

754 
u∆ock
:

755 
	`muãx_u∆ock
(&
mvm
->
muãx
);

756  
ªt
;

757 
	}
}

759 c⁄° 
thîmÆ_coﬁög_devi˚_›s
 
	gtcoﬁög_›s
 = {

760 .
gë_max_°©e
 = 
iwl_mvm_tcoﬁ_gë_max_°©e
,

761 .
	ggë_cur_°©e
 = 
iwl_mvm_tcoﬁ_gë_cur_°©e
,

762 .
	g£t_cur_°©e
 = 
iwl_mvm_tcoﬁ_£t_cur_°©e
,

765 
	$iwl_mvm_coﬁög_devi˚_ªgi°î
(
iwl_mvm
 *
mvm
)

767 
«me
[] = "iwlwifi";

769 i‡(!
	`iwl_mvm_is_˘dp_suµ‹ãd
(
mvm
))

772 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
«me
Ë>
THERMAL_NAME_LENGTH
);

774 
mvm
->
coﬁög_dev
.
cdev
 =

775 
	`thîmÆ_coﬁög_devi˚_ªgi°î
(
«me
,

776 
mvm
,

777 &
tcoﬁög_›s
);

779 i‡(
	`IS_ERR
(
mvm
->
coﬁög_dev
.
cdev
)) {

780 
	`IWL_DEBUG_TEMP
(
mvm
,

782 
	`PTR_ERR
(
mvm
->
coﬁög_dev
.
cdev
));

783 
mvm
->
coﬁög_dev
.
cdev
 = 
NULL
;

786 
	}
}

788 
	$iwl_mvm_thîmÆ_z⁄e_uƒegi°î
(
iwl_mvm
 *
mvm
)

790 i‡(!
	`iwl_mvm_is_â_ö_fw
(
mvm
Ë|| !mvm->
tz_devi˚
.
tz⁄e
)

793 
	`IWL_DEBUG_TEMP
(
mvm
, "Thermal zone device unregister\n");

794 i‡(
mvm
->
tz_devi˚
.
tz⁄e
) {

795 
	`thîmÆ_z⁄e_devi˚_uƒegi°î
(
mvm
->
tz_devi˚
.
tz⁄e
);

796 
mvm
->
tz_devi˚
.
tz⁄e
 = 
NULL
;

798 
	}
}

800 
	$iwl_mvm_coﬁög_devi˚_uƒegi°î
(
iwl_mvm
 *
mvm
)

802 i‡(!
	`iwl_mvm_is_˘dp_suµ‹ãd
(
mvm
Ë|| !mvm->
coﬁög_dev
.
cdev
)

805 
	`IWL_DEBUG_TEMP
(
mvm
, "Cooling device unregister\n");

806 i‡(
mvm
->
coﬁög_dev
.
cdev
) {

807 
	`thîmÆ_coﬁög_devi˚_uƒegi°î
(
mvm
->
coﬁög_dev
.
cdev
);

808 
mvm
->
coﬁög_dev
.
cdev
 = 
NULL
;

810 
	}
}

813 
	$iwl_mvm_thîmÆ_öôülize
(
iwl_mvm
 *
mvm
, 
u32
 
mö_backoff
)

815 
iwl_mvm_â_mgmt
 *
â
 = &
mvm
->
thîmÆ_thrŸée
;

817 
	`IWL_DEBUG_TEMP
(
mvm
, "Initialize Thermal Throttling\n");

819 i‡(
mvm
->
cfg
->
thîmÆ_∑øms
)

820 
â
->
∑øms
 = *
mvm
->
cfg
->
thîmÆ_∑øms
;

822 
â
->
∑øms
 = 
iwl_mvm_deÁu…_â_∑øms
;

824 
â
->
thrŸée
 = 
Ál£
;

825 
â
->
dy«mic_smps
 = 
Ál£
;

826 
â
->
mö_backoff
 = min_backoff;

827 
	`INIT_DELAYED_WORK
(&
â
->
˘_kûl_exô
, 
check_exô_˘kûl
);

829 #ifde‡
CONFIG_THERMAL


830 
	`iwl_mvm_coﬁög_devi˚_ªgi°î
(
mvm
);

831 
	`iwl_mvm_thîmÆ_z⁄e_ªgi°î
(
mvm
);

833 
mvm
->
öô_°©us
 |
IWL_MVM_INIT_STATUS_THERMAL_INIT_COMPLETE
;

834 
	}
}

836 
	$iwl_mvm_thîmÆ_exô
(
iwl_mvm
 *
mvm
)

838 i‡(!(
mvm
->
öô_°©us
 & 
IWL_MVM_INIT_STATUS_THERMAL_INIT_COMPLETE
))

841 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvm
->
thîmÆ_thrŸée
.
˘_kûl_exô
);

842 
	`IWL_DEBUG_TEMP
(
mvm
, "Exit Thermal Throttling\n");

844 #ifde‡
CONFIG_THERMAL


845 
	`iwl_mvm_coﬁög_devi˚_uƒegi°î
(
mvm
);

846 
	`iwl_mvm_thîmÆ_z⁄e_uƒegi°î
(
mvm
);

848 
mvm
->
öô_°©us
 &~
IWL_MVM_INIT_STATUS_THERMAL_INIT_COMPLETE
;

849 
	}
}

	@mvm/tx.c

7 
	~<löux/õì80211.h
>

8 
	~<löux/ëhîdevi˚.h
>

9 
	~<löux/t˝.h
>

10 
	~<√t/gso.h
>

11 
	~<√t/ù.h
>

12 
	~<√t/ùv6.h
>

14 
	~"iwl-å™s.h
"

15 
	~"iwl-ì¥om-∑r£.h
"

16 
	~"mvm.h
"

17 
	~"°a.h
"

18 
	~"time-sync.h
"

21 
	$iwl_mvm_b¨_check_åiggî
(
iwl_mvm
 *
mvm
, c⁄° 
u8
 *
addr
,

22 
u16
 
tid
, u16 
s¢
)

24 
iwl_fw_dbg_åiggî_év
 *
åig
;

25 
iwl_fw_dbg_åiggî_ba
 *
ba_åig
;

27 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
NULL
, 
FW_DBG_TRIGGER_BA
);

28 i‡(!
åig
)

31 
ba_åig
 = (*)
åig
->
d©a
;

33 i‡(!(
	`À16_to_˝u
(
ba_åig
->
tx_b¨
Ë& 
	`BIT
(
tid
)))

36 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

38 
addr
, 
tid
, 
s¢
);

39 
	}
}

41 
	#OPT_HDR
(
ty≥
, 
skb
, 
off
) \

42 (
ty≥
 *)(
	`skb_√tw‹k_hódî
(
skb
Ë+ (
off
))

	)

44 
u32
 
	$iwl_mvm_tx_csum
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

45 
õì80211_tx_öfo
 *
öfo
,

46 
boﬁ
 
amsdu
)

48 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

49 
u16
 
mh_Àn
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

50 
u16
 
ofÊﬂd_assi°
 = 0;

51 #i‡
	`IS_ENABLED
(
CONFIG_INET
)

52 
u8
 
¥Ÿocﬁ
 = 0;

55 i‡(
skb
->
ù_summed
 !
CHECKSUM_PARTIAL
)

56 
out
;

59 i‡(
	`WARN_ONCE
(!(
mvm
->
hw
->
√tdev_„©uªs
 & 
IWL_TX_CSUM_NETIF_FLAGS
) ||

60 (
skb
->
¥Ÿocﬁ
 !
	`ht⁄s
(
ETH_P_IP
) &&

61 
skb
->
¥Ÿocﬁ
 !
	`ht⁄s
(
ETH_P_IPV6
)),

63 
	`skb_checksum_hñp
(
skb
);

64 
out
;

67 i‡(
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETH_P_IP
)) {

68 
¥Ÿocﬁ
 = 
	`ù_hdr
(
skb
)->protocol;

70 #i‡
	`IS_ENABLED
(
CONFIG_IPV6
)

71 
ùv6hdr
 *
ùv6h
 =

72 (
ùv6hdr
 *)
	`skb_√tw‹k_hódî
(
skb
);

73 
off
 = (*
ùv6h
);

75 
¥Ÿocﬁ
 = 
ùv6h
->
√xthdr
;

76 
¥Ÿocﬁ
 !
NEXTHDR_NONE
 && 
	`ùv6_ext_hdr
(protocol)) {

77 
ùv6_›t_hdr
 *
hp
;

80 i‡(
¥Ÿocﬁ
 !
NEXTHDR_ROUTING
 &&

81 
¥Ÿocﬁ
 !
NEXTHDR_HOP
 &&

82 
¥Ÿocﬁ
 !
NEXTHDR_DEST
) {

83 
	`skb_checksum_hñp
(
skb
);

84 
out
;

87 
hp
 = 
	`OPT_HDR
(
ùv6_›t_hdr
, 
skb
, 
off
);

88 
¥Ÿocﬁ
 = 
hp
->
√xthdr
;

89 
off
 +
	`ùv6_›éí
(
hp
);

95 i‡(
¥Ÿocﬁ
 !
IPPROTO_TCP
 &&ÖrŸocﬁ !
IPPROTO_UDP
) {

96 
	`WARN_ON_ONCE
(1);

97 
	`skb_checksum_hñp
(
skb
);

98 
out
;

102 
ofÊﬂd_assi°
 |
	`BIT
(
TX_CMD_OFFLD_L4_EN
);

109 
ofÊﬂd_assi°
 |(4 << 
TX_CMD_OFFLD_IP_HDR
);

112 i‡(
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETH_P_IP
Ë&& 
amsdu
) {

113 
	`ù_hdr
(
skb
)->
check
 = 0;

114 
ofÊﬂd_assi°
 |
	`BIT
(
TX_CMD_OFFLD_L3_EN
);

118 i‡(
¥Ÿocﬁ
 =
IPPROTO_TCP
)

119 
	`t˝_hdr
(
skb
)->
check
 = 0;

121 
	`udp_hdr
(
skb
)->
check
 = 0;

123 
out
:

130 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
Ë&& 
öfo
->
c⁄åﬁ
.
hw_key
 &&

131 
öfo
->
c⁄åﬁ
.
hw_key
->
cùhî
 !
WLAN_CIPHER_SUITE_WEP40
 &&

132 
öfo
->
c⁄åﬁ
.
hw_key
->
cùhî
 !
WLAN_CIPHER_SUITE_WEP104
)

133 
mh_Àn
 +
öfo
->
c⁄åﬁ
.
hw_key
->
iv_Àn
;

134 
mh_Àn
 /= 2;

135 
ofÊﬂd_assi°
 |
mh_Àn
 << 
TX_CMD_OFFLD_MH_SIZE
;

137 i‡(
amsdu
)

138 
ofÊﬂd_assi°
 |
	`BIT
(
TX_CMD_OFFLD_AMSDU
);

139 i‡(
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
) % 4)

141 
ofÊﬂd_assi°
 |
	`BIT
(
TX_CMD_OFFLD_PAD
);

143  
ofÊﬂd_assi°
;

144 
	}
}

149 
	$iwl_mvm_£t_tx_cmd
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

150 
iwl_tx_cmd
 *
tx_cmd
,

151 
õì80211_tx_öfo
 *
öfo
, 
u8
 
°a_id
)

153 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

154 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

155 
u32
 
tx_Êags
 = 
	`À32_to_˝u
(
tx_cmd
->tx_flags);

156 
u32
 
Àn
 = 
skb
->À¿+ 
FCS_LEN
;

157 
boﬁ
 
amsdu
 = 
Ál£
;

158 
u8
 
ac
;

160 i‡(!(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_ACK
) ||

161 (
	`õì80211_is_¥obe_ª•
(
fc
) &&

162 !
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
)))

163 
tx_Êags
 |
TX_CMD_FLG_ACK
;

165 
tx_Êags
 &~
TX_CMD_FLG_ACK
;

167 i‡(
	`õì80211_is_¥obe_ª•
(
fc
))

168 
tx_Êags
 |
TX_CMD_FLG_TSF
;

170 i‡(
	`õì80211_has_m‹e‰ags
(
fc
))

171 
tx_Êags
 |
TX_CMD_FLG_MORE_FRAG
;

173 i‡(
	`õì80211_is_d©a_qos
(
fc
)) {

174 
u8
 *
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

175 
tx_cmd
->
tid_t•ec
 = 
qc
[0] & 0xf;

176 
tx_Êags
 &~
TX_CMD_FLG_SEQ_CTL
;

177 
amsdu
 = *
qc
 & 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

178 } i‡(
	`õì80211_is_back_ªq
(
fc
)) {

179 
õì80211_b¨
 *
b¨
 = (*)
skb
->
d©a
;

180 
u16
 
c⁄åﬁ
 = 
	`À16_to_˝u
(
b¨
->control);

181 
u16
 
s¢
 = 
	`À16_to_˝u
(
b¨
->
°¨t_£q_num
);

183 
tx_Êags
 |
TX_CMD_FLG_ACK
 | 
TX_CMD_FLG_BAR
;

184 
tx_cmd
->
tid_t•ec
 = (
c⁄åﬁ
 &

185 
IEEE80211_BAR_CTRL_TID_INFO_MASK
) >>

186 
IEEE80211_BAR_CTRL_TID_INFO_SHIFT
;

187 
	`WARN_ON_ONCE
(
tx_cmd
->
tid_t•ec
 >
IWL_MAX_TID_COUNT
);

188 
	`iwl_mvm_b¨_check_åiggî
(
mvm
, 
b¨
->
ø
, 
tx_cmd
->
tid_t•ec
,

189 
s¢
);

191 i‡(
	`õì80211_is_d©a
(
fc
))

192 
tx_cmd
->
tid_t•ec
 = 
IWL_TID_NON_QOS
;

194 
tx_cmd
->
tid_t•ec
 = 
IWL_MAX_TID_COUNT
;

196 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_ASSIGN_SEQ
)

197 
tx_Êags
 |
TX_CMD_FLG_SEQ_CTL
;

199 
tx_Êags
 &~
TX_CMD_FLG_SEQ_CTL
;

203 i‡(
tx_cmd
->
tid_t•ec
 < 
IWL_MAX_TID_COUNT
)

204 
ac
 = 
tid_to_mac80211_ac
[
tx_cmd
->
tid_t•ec
];

206 
ac
 = 
tid_to_mac80211_ac
[0];

208 
tx_Êags
 |
	`iwl_mvm_bt_c€x_tx_¥io
(
mvm
, 
hdr
, 
öfo
, 
ac
) <<

209 
TX_CMD_FLG_BT_PRIO_POS
;

211 i‡(
	`õì80211_is_mgmt
(
fc
)) {

212 i‡(
	`õì80211_is_assoc_ªq
(
fc
Ë|| 
	`õì80211_is_ªassoc_ªq
(fc))

213 
tx_cmd
->
pm_‰ame_timeout
 = 
	`˝u_to_À16
(
PM_FRAME_ASSOC
);

214 i‡(
	`õì80211_is_a˘i⁄
(
fc
))

215 
tx_cmd
->
pm_‰ame_timeout
 = 
	`˝u_to_À16
(
PM_FRAME_NONE
);

217 
tx_cmd
->
pm_‰ame_timeout
 = 
	`˝u_to_À16
(
PM_FRAME_MGMT
);

222 
	`WARN_ON_ONCE
(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
);

223 } i‡(
öfo
->
c⁄åﬁ
.
Êags
 & 
IEEE80211_TX_CTRL_PORT_CTRL_PROTO
) {

224 
tx_cmd
->
pm_‰ame_timeout
 = 
	`˝u_to_À16
(
PM_FRAME_MGMT
);

226 
tx_cmd
->
pm_‰ame_timeout
 = 
	`˝u_to_À16
(
PM_FRAME_NONE
);

229 i‡(
	`õì80211_is_d©a
(
fc
Ë&& 
Àn
 > 
mvm
->
πs_thªshﬁd
 &&

230 !
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
))

231 
tx_Êags
 |
TX_CMD_FLG_PROT_REQUIRE
;

233 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

234 
IWL_UCODE_TLV_CAPA_TXPOWER_INSERTION_SUPPORT
) &&

235 
	`õì80211_a˘i⁄_c⁄èös_çc
(
skb
))

236 
tx_Êags
 |
TX_CMD_FLG_WRITE_TX_POWER
;

238 
tx_cmd
->
tx_Êags
 = 
	`˝u_to_À32
(tx_flags);

240 
tx_cmd
->
Àn
 = 
	`˝u_to_À16
((
u16
)
skb
->len);

241 
tx_cmd
->
li„_time
 = 
	`˝u_to_À32
(
TX_CMD_LIFE_TIME_INFINITE
);

242 
tx_cmd
->
°a_id
 = sta_id;

244 
tx_cmd
->
ofÊﬂd_assi°
 =

245 
	`˝u_to_À16
(
	`iwl_mvm_tx_csum
(
mvm
, 
skb
, 
öfo
, 
amsdu
));

246 
	}
}

248 
u32
 
	$iwl_mvm_gë_tx_™t
(
iwl_mvm
 *
mvm
,

249 
õì80211_tx_öfo
 *
öfo
,

250 
õì80211_°a
 *
°a
, 
__À16
 
fc
)

252 i‡(
öfo
->
b™d
 =
NL80211_BAND_2GHZ
 &&

253 !
	`iwl_mvm_bt_c€x_is_sh¨ed_™t_avaû
(
mvm
))

254  
mvm
->
cfg
->
n⁄_sh¨ed_™t
 << 
RATE_MCS_ANT_POS
;

256 i‡(
°a
 && 
	`õì80211_is_d©a
(
fc
)) {

257 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

259  
	`BIT
(
mvm°a
->
tx_™t
Ë<< 
RATE_MCS_ANT_POS
;

262  
	`BIT
(
mvm
->
mgmt_œ°_™ã¬a_idx
Ë<< 
RATE_MCS_ANT_POS
;

263 
	}
}

265 
u32
 
	$iwl_mvm_c⁄vît_øã_idx
(
iwl_mvm
 *
mvm
,

266 
õì80211_tx_öfo
 *
öfo
,

267 
øã_idx
)

269 
u32
 
øã_Êags
 = 0;

270 
u8
 
øã_∂˝
;

271 
boﬁ
 
is_cck
;

274 i‡(
øã_idx
 < 0 ||Ñ©e_idx >
IWL_RATE_COUNT_LEGACY
)

275 
øã_idx
 = 
	`iwl_mvm_mac_˘xt_gë_lowe°_øã
(
mvm
,

276 
öfo
,

277 
öfo
->
c⁄åﬁ
.
vif
);

280 
øã_∂˝
 = 
	`iwl_mvm_mac80211_idx_to_hwøã
(
mvm
->
fw
, 
øã_idx
);

281 
is_cck
 = (
øã_idx
 >
IWL_FIRST_CCK_RATE
) &&

282 (
øã_idx
 <
IWL_LAST_CCK_RATE
);

285 i‡(
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
, 
TX_CMD
, 0) > 8) {

286 i‡(!
is_cck
)

287 
øã_Êags
 |
RATE_MCS_LEGACY_OFDM_MSK
;

289 
øã_Êags
 |
RATE_MCS_CCK_MSK
;

290 } i‡(
is_cck
) {

291 
øã_Êags
 |
RATE_MCS_CCK_MSK_V1
;

294  (
u32
)
øã_∂˝
 | 
øã_Êags
;

295 
	}
}

297 
u32
 
	$iwl_mvm_gë_öje˘_tx_øã
(
iwl_mvm
 *
mvm
,

298 
õì80211_tx_öfo
 *
öfo
,

299 
õì80211_°a
 *
°a
,

300 
__À16
 
fc
)

302 
õì80211_tx_øã
 *
øã
 = &
öfo
->
c⁄åﬁ
.
øãs
[0];

303 
u32
 
ªsu…
;

310 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

311 
u8
 
mcs
 = 
	`õì80211_øã_gë_vht_mcs
(
øã
);

312 
u8
 
nss
 = 
	`õì80211_øã_gë_vht_nss
(
øã
);

314 
ªsu…
 = 
RATE_MCS_VHT_MSK_V1
;

315 
ªsu…
 |
	`u32_ícode_bôs
(
mcs
, 
RATE_VHT_MCS_RATE_CODE_MSK
);

316 
ªsu…
 |
	`u32_ícode_bôs
(
nss
, 
RATE_MCS_NSS_MSK
);

317 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_SHORT_GI
)

318 
ªsu…
 |
RATE_MCS_SGI_MSK_V1
;

319 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

320 
ªsu…
 |
	`u32_ícode_bôs
(1, 
RATE_MCS_CHAN_WIDTH_MSK_V1
);

321 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

322 
ªsu…
 |
	`u32_ícode_bôs
(2, 
RATE_MCS_CHAN_WIDTH_MSK_V1
);

323 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_160_MHZ_WIDTH
)

324 
ªsu…
 |
	`u32_ícode_bôs
(3, 
RATE_MCS_CHAN_WIDTH_MSK_V1
);

326 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LONG_GROUP
, 
TX_CMD
, 0) > 6)

327 
ªsu…
 = 
	`iwl_√w_øã_‰om_v1
(result);

328 } i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_MCS
) {

329 
ªsu…
 = 
RATE_MCS_HT_MSK_V1
;

330 
ªsu…
 |
	`u32_ícode_bôs
(
øã
->
idx
,

331 
RATE_HT_MCS_RATE_CODE_MSK_V1
 |

332 
RATE_HT_MCS_NSS_MSK_V1
);

333 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_SHORT_GI
)

334 
ªsu…
 |
RATE_MCS_SGI_MSK_V1
;

335 i‡(
øã
->
Êags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

336 
ªsu…
 |
	`u32_ícode_bôs
(1, 
RATE_MCS_CHAN_WIDTH_MSK_V1
);

337 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_LDPC
)

338 
ªsu…
 |
RATE_MCS_LDPC_MSK_V1
;

339 i‡(
	`u32_gë_bôs
(
öfo
->
Êags
, 
IEEE80211_TX_CTL_STBC
))

340 
ªsu…
 |
RATE_MCS_STBC_MSK
;

342 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LONG_GROUP
, 
TX_CMD
, 0) > 6)

343 
ªsu…
 = 
	`iwl_√w_øã_‰om_v1
(result);

345 
øã_idx
 = 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
;

347 
ªsu…
 = 
	`iwl_mvm_c⁄vît_øã_idx
(
mvm
, 
öfo
, 
øã_idx
);

350 i‡(
öfo
->
c⁄åﬁ
.
™ã¬as
)

351 
ªsu…
 |
	`u32_ícode_bôs
(
öfo
->
c⁄åﬁ
.
™ã¬as
,

352 
RATE_MCS_ANT_AB_MSK
);

354 
ªsu…
 |
	`iwl_mvm_gë_tx_™t
(
mvm
, 
öfo
, 
°a
, 
fc
);

356  
ªsu…
;

357 
	}
}

359 
u32
 
	$iwl_mvm_gë_tx_øã
(
iwl_mvm
 *
mvm
,

360 
õì80211_tx_öfo
 *
öfo
,

361 
õì80211_°a
 *
°a
, 
__À16
 
fc
)

363 
øã_idx
 = -1;

365 i‡(!
	`õì80211_hw_check
(
mvm
->
hw
, 
HAS_RATE_CONTROL
)) {

369 
	`WARN_ONCE
(
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
 & 
IEEE80211_TX_RC_MCS
 &&

370 !
	`õì80211_is_d©a
(
fc
),

372 
öfo
->
c⁄åﬁ
.
øãs
[0].
Êags
,

373 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
,

374 
	`À16_to_˝u
(
fc
),

375 
°a
 ? 
	`iwl_mvm_°a_‰om_mac80211
(°a)->
°a_°©e
 : -1);

377 
øã_idx
 = 
öfo
->
c⁄åﬁ
.
øãs
[0].
idx
;

382 i‡(
öfo
->
b™d
 !
NL80211_BAND_2GHZ
 ||

383 (
öfo
->
Êags
 & 
IEEE80211_TX_CTL_NO_CCK_RATE
))

384 
øã_idx
 +
IWL_FIRST_OFDM_RATE
;

387 
	`BUILD_BUG_ON
(
IWL_FIRST_CCK_RATE
 != 0);

390  
	`iwl_mvm_c⁄vît_øã_idx
(
mvm
, 
öfo
, 
øã_idx
);

391 
	}
}

393 
u32
 
	$iwl_mvm_gë_tx_øã_n_Êags
(
iwl_mvm
 *
mvm
,

394 
õì80211_tx_öfo
 *
öfo
,

395 
õì80211_°a
 *
°a
, 
__À16
 
fc
)

397 i‡(
	`u∆ikñy
(
öfo
->
c⁄åﬁ
.
Êags
 & 
IEEE80211_TX_CTRL_RATE_INJECT
))

398  
	`iwl_mvm_gë_öje˘_tx_øã
(
mvm
, 
öfo
, 
°a
, 
fc
);

400  
	`iwl_mvm_gë_tx_øã
(
mvm
, 
öfo
, 
°a
, 
fc
) |

401 
	`iwl_mvm_gë_tx_™t
(
mvm
, 
öfo
, 
°a
, 
fc
);

402 
	}
}

407 
	$iwl_mvm_£t_tx_cmd_øã
(
iwl_mvm
 *
mvm
, 
iwl_tx_cmd
 *
tx_cmd
,

408 
õì80211_tx_öfo
 *
öfo
,

409 
õì80211_°a
 *
°a
, 
__À16
 
fc
)

412 
tx_cmd
->
πs_ªåy_limô
 = 
IWL_RTS_DFAULT_RETRY_LIMIT
;

415 i‡(
	`õì80211_is_¥obe_ª•
(
fc
)) {

416 
tx_cmd
->
d©a_ªåy_limô
 = 
IWL_MGMT_DFAULT_RETRY_LIMIT
;

417 
tx_cmd
->
πs_ªåy_limô
 =

418 
	`mö
(
tx_cmd
->
d©a_ªåy_limô
,Åx_cmd->
πs_ªåy_limô
);

419 } i‡(
	`õì80211_is_back_ªq
(
fc
)) {

420 
tx_cmd
->
d©a_ªåy_limô
 = 
IWL_BAR_DFAULT_RETRY_LIMIT
;

422 
tx_cmd
->
d©a_ªåy_limô
 = 
IWL_DEFAULT_TX_RETRY
;

430 i‡(
	`likñy
(
	`õì80211_is_d©a
(
fc
Ë&& 
°a
 &&

431 !(
öfo
->
c⁄åﬁ
.
Êags
 & 
IEEE80211_TX_CTRL_RATE_INJECT
))) {

432 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

434 i‡(
mvm°a
->
°a_°©e
 >
IEEE80211_STA_AUTHORIZED
) {

435 
tx_cmd
->
öôül_øã_ödex
 = 0;

436 
tx_cmd
->
tx_Êags
 |
	`˝u_to_À32
(
TX_CMD_FLG_STA_RATE
);

439 } i‡(
	`õì80211_is_back_ªq
(
fc
)) {

440 
tx_cmd
->
tx_Êags
 |=

441 
	`˝u_to_À32
(
TX_CMD_FLG_ACK
 | 
TX_CMD_FLG_BAR
);

445 
tx_cmd
->
øã_n_Êags
 =

446 
	`˝u_to_À32
(
	`iwl_mvm_gë_tx_øã_n_Êags
(
mvm
, 
öfo
, 
°a
, 
fc
));

447 
	}
}

449 
ölöe
 
	$iwl_mvm_£t_tx_cmd_≤
(
õì80211_tx_öfo
 *
öfo
,

450 
u8
 *
¸y±o_hdr
)

452 
õì80211_key_c⁄f
 *
keyc⁄f
 = 
öfo
->
c⁄åﬁ
.
hw_key
;

453 
u64
 
≤
;

455 
≤
 = 
	`©omic64_öc_ªtu∫
(&
keyc⁄f
->
tx_≤
);

456 
¸y±o_hdr
[0] = 
≤
;

457 
¸y±o_hdr
[2] = 0;

458 
¸y±o_hdr
[3] = 0x20 | (
keyc⁄f
->
keyidx
 << 6);

459 
¸y±o_hdr
[1] = 
≤
 >> 8;

460 
¸y±o_hdr
[4] = 
≤
 >> 16;

461 
¸y±o_hdr
[5] = 
≤
 >> 24;

462 
¸y±o_hdr
[6] = 
≤
 >> 32;

463 
¸y±o_hdr
[7] = 
≤
 >> 40;

464 
	}
}

469 
	$iwl_mvm_£t_tx_cmd_¸y±o
(
iwl_mvm
 *
mvm
,

470 
õì80211_tx_öfo
 *
öfo
,

471 
iwl_tx_cmd
 *
tx_cmd
,

472 
sk_buff
 *
skb_‰ag
,

473 
hdæí
)

475 
õì80211_key_c⁄f
 *
keyc⁄f
 = 
öfo
->
c⁄åﬁ
.
hw_key
;

476 
u8
 *
¸y±o_hdr
 = 
skb_‰ag
->
d©a
 + 
hdæí
;

477 
iwl_tx_cmd_£c_˘æ
 
ty≥
 = 
TX_CMD_SEC_CCM
;

478 
u64
 
≤
;

480 
keyc⁄f
->
cùhî
) {

481 
WLAN_CIPHER_SUITE_CCMP
:

482 
	`iwl_mvm_£t_tx_cmd_ccmp
(
öfo
, 
tx_cmd
);

483 
	`iwl_mvm_£t_tx_cmd_≤
(
öfo
, 
¸y±o_hdr
);

486 
WLAN_CIPHER_SUITE_TKIP
:

487 
tx_cmd
->
£c_˘l
 = 
TX_CMD_SEC_TKIP
;

488 
≤
 = 
	`©omic64_öc_ªtu∫
(&
keyc⁄f
->
tx_≤
);

489 
	`õì80211_tkù_add_iv
(
¸y±o_hdr
, 
keyc⁄f
, 
≤
);

490 
	`õì80211_gë_tkù_p2k
(
keyc⁄f
, 
skb_‰ag
, 
tx_cmd
->
key
);

493 
WLAN_CIPHER_SUITE_WEP104
:

494 
tx_cmd
->
£c_˘l
 |
TX_CMD_SEC_KEY128
;

495 
ÁŒthrough
;

496 
WLAN_CIPHER_SUITE_WEP40
:

497 
tx_cmd
->
£c_˘l
 |
TX_CMD_SEC_WEP
 |

498 ((
keyc⁄f
->
keyidx
 << 
TX_CMD_SEC_WEP_KEY_IDX_POS
) &

499 
TX_CMD_SEC_WEP_KEY_IDX_MSK
);

501 
	`mem˝y
(&
tx_cmd
->
key
[3], 
keyc⁄f
->key, keyc⁄f->
keyÀn
);

503 
WLAN_CIPHER_SUITE_GCMP
:

504 
WLAN_CIPHER_SUITE_GCMP_256
:

505 
ty≥
 = 
TX_CMD_SEC_GCMP
;

506 
ÁŒthrough
;

507 
WLAN_CIPHER_SUITE_CCMP_256
:

514 
tx_cmd
->
£c_˘l
 |
ty≥
 | 
TX_CMD_SEC_KEY_FROM_TABLE
;

515 
tx_cmd
->
key
[0] = 
keyc⁄f
->
hw_key_idx
;

516 
	`iwl_mvm_£t_tx_cmd_≤
(
öfo
, 
¸y±o_hdr
);

519 
tx_cmd
->
£c_˘l
 |
TX_CMD_SEC_EXT
;

521 
	}
}

523 
boﬁ
 
	$iwl_mvm_u£_ho°_øã
(
iwl_mvm
 *
mvm
,

524 
iwl_mvm_°a
 *
mvm°a
,

525 
õì80211_hdr
 *
hdr
,

526 
õì80211_tx_öfo
 *
öfo
)

528 i‡(
	`u∆ikñy
(!
mvm°a
))

529  
åue
;

531 i‡(
	`u∆ikñy
(
öfo
->
c⁄åﬁ
.
Êags
 & 
IEEE80211_TX_CTRL_RATE_INJECT
))

532  
åue
;

534 i‡(
	`likñy
(
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) &&

535 
mvm°a
->
°a_°©e
 >
IEEE80211_STA_AUTHORIZED
))

536  
Ál£
;

545  
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_BZ
;

546 
	}
}

548 
	$iwl_mvm_c›y_hdr
(*
cmd
, c⁄° *
hdr
, 
hdæí
,

549 c⁄° 
u8
 *
addr3_ovîride
)

551 
õì80211_hdr
 *
out_hdr
 = 
cmd
;

553 
	`mem˝y
(
cmd
, 
hdr
, 
hdæí
);

554 i‡(
addr3_ovîride
)

555 
	`mem˝y
(
out_hdr
->
addr3
, 
addr3_ovîride
, 
ETH_ALEN
);

556 
	}
}

561 
iwl_devi˚_tx_cmd
 *

562 
	$iwl_mvm_£t_tx_∑øms
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

563 
õì80211_tx_öfo
 *
öfo
, 
hdæí
,

564 
õì80211_°a
 *
°a
, 
u8
 
°a_id
,

565 c⁄° 
u8
 *
addr3_ovîride
)

567 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

568 
iwl_devi˚_tx_cmd
 *
dev_cmd
;

569 
iwl_tx_cmd
 *
tx_cmd
;

571 
dev_cmd
 = 
	`iwl_å™s_Æloc_tx_cmd
(
mvm
->
å™s
);

573 i‡(
	`u∆ikñy
(!
dev_cmd
))

574  
NULL
;

576 
dev_cmd
->
hdr
.
cmd
 = 
TX_CMD
;

578 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

579 
u32
 
øã_n_Êags
 = 0;

580 
u16
 
Êags
 = 0;

581 
iwl_mvm_°a
 *
mvm°a
 = 
°a
 ?

582 
	`iwl_mvm_°a_‰om_mac80211
(
°a
Ë: 
NULL
;

583 
boﬁ
 
amsdu
 = 
Ál£
;

585 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
)) {

586 
u8
 *
qc
 = 
	`õì80211_gë_qos_˘l
(
hdr
);

588 
amsdu
 = *
qc
 & 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

591 i‡(!
öfo
->
c⁄åﬁ
.
hw_key
)

592 
Êags
 |
IWL_TX_FLAGS_ENCRYPT_DIS
;

600 i‡(
	`u∆ikñy
(
	`iwl_mvm_u£_ho°_øã
(
mvm
, 
mvm°a
, 
hdr
, 
öfo
))) {

601 
Êags
 |
IWL_TX_FLAGS_CMD_RATE
;

602 
øã_n_Êags
 =

603 
	`iwl_mvm_gë_tx_øã_n_Êags
(
mvm
, 
öfo
, 
°a
,

604 
hdr
->
‰ame_c⁄åﬁ
);

605 } i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
) ||

606 
mvm°a
->
°a_°©e
 < 
IEEE80211_STA_AUTHORIZED
) {

608 
Êags
 |
IWL_TX_FLAGS_HIGH_PRI
;

611 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

612 
IWL_DEVICE_FAMILY_AX210
) {

613 
iwl_tx_cmd_gí3
 *
cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

614 
u32
 
ofÊﬂd_assi°
 = 
	`iwl_mvm_tx_csum
(
mvm
, 
skb
,

615 
öfo
, 
amsdu
);

617 
cmd
->
ofÊﬂd_assi°
 = 
	`˝u_to_À32
(offload_assist);

620 
cmd
->
Àn
 = 
	`˝u_to_À16
((
u16
)
skb
->len);

623 
	`iwl_mvm_c›y_hdr
(
cmd
->
hdr
, hdr, 
hdæí
, 
addr3_ovîride
);

625 
cmd
->
Êags
 = 
	`˝u_to_À16
(flags);

626 
cmd
->
øã_n_Êags
 = 
	`˝u_to_À32
(rate_n_flags);

628 
iwl_tx_cmd_gí2
 *
cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

629 
u16
 
ofÊﬂd_assi°
 = 
	`iwl_mvm_tx_csum
(
mvm
, 
skb
,

630 
öfo
, 
amsdu
);

632 
cmd
->
ofÊﬂd_assi°
 = 
	`˝u_to_À16
(offload_assist);

635 
cmd
->
Àn
 = 
	`˝u_to_À16
((
u16
)
skb
->len);

638 
	`iwl_mvm_c›y_hdr
(
cmd
->
hdr
, hdr, 
hdæí
, 
addr3_ovîride
);

640 
cmd
->
Êags
 = 
	`˝u_to_À32
(flags);

641 
cmd
->
øã_n_Êags
 = 
	`˝u_to_À32
(rate_n_flags);

643 
out
;

646 
tx_cmd
 = (
iwl_tx_cmd
 *)
dev_cmd
->
∑ylﬂd
;

648 i‡(
öfo
->
c⁄åﬁ
.
hw_key
)

649 
	`iwl_mvm_£t_tx_cmd_¸y±o
(
mvm
, 
öfo
, 
tx_cmd
, 
skb
, 
hdæí
);

651 
	`iwl_mvm_£t_tx_cmd
(
mvm
, 
skb
, 
tx_cmd
, 
öfo
, 
°a_id
);

653 
	`iwl_mvm_£t_tx_cmd_øã
(
mvm
, 
tx_cmd
, 
öfo
, 
°a
, 
hdr
->
‰ame_c⁄åﬁ
);

656 
	`iwl_mvm_c›y_hdr
(
tx_cmd
->
hdr
, hdr, 
hdæí
, 
addr3_ovîride
);

658 
out
:

659  
dev_cmd
;

660 
	}
}

662 
	$iwl_mvm_skb_¥ï¨e_°©us
(
sk_buff
 *
skb
,

663 
iwl_devi˚_tx_cmd
 *
cmd
)

665 
õì80211_tx_öfo
 *
skb_öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

667 
	`mem£t
(&
skb_öfo
->
°©us
, 0, (skb_info->status));

668 
	`mem£t
(
skb_öfo
->
drivî_d©a
, 0, (skb_info->driver_data));

670 
skb_öfo
->
drivî_d©a
[1] = 
cmd
;

671 
	}
}

673 
	$iwl_mvm_gë_˘æ_vif_queue
(
iwl_mvm
 *
mvm
,

674 
iwl_mvm_vif_lök_öfo
 *
lök
,

675 
õì80211_tx_öfo
 *
öfo
,

676 
sk_buff
 *
skb
)

678 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

679 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

681 
öfo
->
c⁄åﬁ
.
vif
->
ty≥
) {

682 
NL80211_IFTYPE_AP
:

683 
NL80211_IFTYPE_ADHOC
:

694 i‡(
	`õì80211_is_mgmt
(
fc
) &&

695 (!
	`õì80211_is_buf„øbÀ_mmpdu
(
skb
) ||

696 
	`õì80211_is_dóuth
(
fc
Ë|| 
	`õì80211_is_dißssoc
(fc)))

697  
lök
->
mgmt_queue
;

699 i‡(!
	`õì80211_has_‹dî
(
fc
Ë&& !
	`õì80211_is_¥obe_ªq
(fc) &&

700 
	`is_mu…iˇ°_ëhî_addr
(
hdr
->
addr1
))

701  
lök
->
ˇb_queue
;

703 
	`WARN_ONCE
(
öfo
->
c⁄åﬁ
.
vif
->
ty≥
 !
NL80211_IFTYPE_ADHOC
,

704 "fc=0x%02x", 
	`À16_to_˝u
(
fc
));

705  
lök
->
mgmt_queue
;

706 
NL80211_IFTYPE_P2P_DEVICE
:

707 i‡(
	`õì80211_is_mgmt
(
fc
))

708  
mvm
->
p2p_dev_queue
;

710 
	`WARN_ON_ONCE
(1);

711  
mvm
->
p2p_dev_queue
;

713 
	`WARN_ONCE
(1, "Notá ctrl vif,Çoávailable queue\n");

716 
	}
}

718 
	$iwl_mvm_¥obe_ª•_£t_nﬂ
(
iwl_mvm
 *
mvm
,

719 
sk_buff
 *
skb
)

721 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

722 
iwl_mvm_vif
 *
mvmvif
 =

723 
	`iwl_mvm_vif_‰om_mac80211
(
öfo
->
c⁄åﬁ
.
vif
);

724 
õì80211_mgmt
 *
mgmt
 = (õì80211_mgmà*)
skb
->
d©a
;

725 
ba£_Àn
 = (
u8
 *)
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
 - (u8 *)mgmt;

726 
iwl_¥obe_ª•_d©a
 *
ª•_d©a
;

727 c⁄° 
u8
 *
õ
;

728 
u8
 *
pos
;

729 
u8
 
m©ch
[] = {

730 (
WLAN_OUI_WFA
 >> 16) & 0xff,

731 (
WLAN_OUI_WFA
 >> 8) & 0xff,

732 
WLAN_OUI_WFA
 & 0xff,

733 
WLAN_OUI_TYPE_WFA_P2P
,

736 
	`rcu_ªad_lock
();

738 
ª•_d©a
 = 
	`rcu_dîe„ªn˚
(
mvmvif
->
deÊök
.
¥obe_ª•_d©a
);

739 i‡(!
ª•_d©a
)

740 
out
;

742 i‡(!
ª•_d©a
->
nŸif
.
nﬂ_a˘ive
)

743 
out
;

745 
õ
 = 
	`cfg80211_föd_õ_m©ch
(
WLAN_EID_VENDOR_SPECIFIC
,

746 
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
,

747 
skb
->
Àn
 - 
ba£_Àn
,

748 
m©ch
, 4, 2);

749 i‡(!
õ
) {

750 
	`IWL_DEBUG_TX
(
mvm
, "probeÑesp doesn't have P2P IE\n");

751 
out
;

754 i‡(
	`skb_èûroom
(
skb
Ë< 
ª•_d©a
->
nﬂ_Àn
) {

755 i‡(
	`pskb_ex∑nd_hód
(
skb
, 0, 
ª•_d©a
->
nﬂ_Àn
, 
GFP_ATOMIC
)) {

756 
	`IWL_ERR
(
mvm
,

758 
out
;

762 
pos
 = 
	`skb_put
(
skb
, 
ª•_d©a
->
nﬂ_Àn
);

764 *
pos
++ = 
WLAN_EID_VENDOR_SPECIFIC
;

766 *
pos
++ = 
ª•_d©a
->
nﬂ_Àn
 - 2;

767 *
pos
++ = (
WLAN_OUI_WFA
 >> 16) & 0xff;

768 *
pos
++ = (
WLAN_OUI_WFA
 >> 8) & 0xff;

769 *
pos
++ = 
WLAN_OUI_WFA
 & 0xff;

770 *
pos
++ = 
WLAN_OUI_TYPE_WFA_P2P
;

772 
	`mem˝y
(
pos
, &
ª•_d©a
->
nŸif
.
nﬂ_©å
,

773 
ª•_d©a
->
nﬂ_Àn
 - (
õì80211_víd‹_õ
));

775 
out
:

776 
	`rcu_ªad_u∆ock
();

777 
	}
}

779 
	$iwl_mvm_tx_skb_n⁄_°a
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
)

781 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

782 
õì80211_tx_öfo
 
öfo
;

783 
iwl_devi˚_tx_cmd
 *
dev_cmd
;

784 
u8
 
°a_id
;

785 
hdæí
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

786 
__À16
 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

787 
boﬁ
 
offch™√l
 = 
	`IEEE80211_SKB_CB
(
skb
)->
Êags
 &

788 
IEEE80211_TX_CTL_TX_OFFCHAN
;

789 
queue
 = -1;

791 i‡(
IWL_MVM_NON_TRANSMITTING_AP
 && 
	`õì80211_is_¥obe_ª•
(
fc
))

794 
	`mem˝y
(&
öfo
, 
skb
->
cb
, (info));

796 i‡(
	`WARN_ON_ONCE
(
skb
->
Àn
 > 
IEEE80211_MAX_DATA_LEN
 + 
hdæí
))

799 i‡(
	`WARN_ON_ONCE
(
öfo
.
Êags
 & 
IEEE80211_TX_CTL_AMPDU
))

802 i‡(
öfo
.
c⁄åﬁ
.
vif
) {

803 
iwl_mvm_vif
 *
mvmvif
 =

804 
	`iwl_mvm_vif_‰om_mac80211
(
öfo
.
c⁄åﬁ
.
vif
);

806 i‡(
öfo
.
c⁄åﬁ
.
vif
->
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE
 ||

807 
öfo
.
c⁄åﬁ
.
vif
->
ty≥
 =
NL80211_IFTYPE_AP
 ||

808 
öfo
.
c⁄åﬁ
.
vif
->
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

809 
u32
 
lök_id
 = 
	`u32_gë_bôs
(
öfo
.
c⁄åﬁ
.
Êags
,

810 
IEEE80211_TX_CTRL_MLO_LINK
);

811 
iwl_mvm_vif_lök_öfo
 *
lök
;

813 i‡(
lök_id
 =
IEEE80211_LINK_UNSPECIFIED
) {

814 i‡(
öfo
.
c⁄åﬁ
.
vif
->
a˘ive_löks
)

815 
lök_id
 = 
	`ffs
(
öfo
.
c⁄åﬁ
.
vif
->
a˘ive_löks
) - 1;

817 
lök_id
 = 0;

820 
lök
 = 
mvmvif
->lök[
lök_id
];

821 i‡(
	`WARN_ON
(!
lök
))

824 i‡(!
	`õì80211_is_d©a
(
hdr
->
‰ame_c⁄åﬁ
))

825 
°a_id
 = 
lök
->
bˇ°_°a
.sta_id;

827 
°a_id
 = 
lök
->
mˇ°_°a
.sta_id;

829 
queue
 = 
	`iwl_mvm_gë_˘æ_vif_queue
(
mvm
, 
lök
, &
öfo
,

830 
skb
);

831 } i‡(
öfo
.
c⁄åﬁ
.
vif
->
ty≥
 =
NL80211_IFTYPE_MONITOR
) {

832 
queue
 = 
mvm
->
¢if_queue
;

833 
°a_id
 = 
mvm
->
¢if_°a
.sta_id;

834 } i‡(
öfo
.
c⁄åﬁ
.
vif
->
ty≥
 =
NL80211_IFTYPE_STATION
 &&

835 
offch™√l
) {

844 
°a_id
 = 
mvm
->
aux_°a
.sta_id;

845 
queue
 = 
mvm
->
aux_queue
;

849 i‡(
queue
 < 0) {

850 
	`IWL_ERR
(
mvm
, "No queue was found. Dropping TX\n");

854 i‡(
	`u∆ikñy
(
	`õì80211_is_¥obe_ª•
(
fc
)))

855 
	`iwl_mvm_¥obe_ª•_£t_nﬂ
(
mvm
, 
skb
);

857 
	`IWL_DEBUG_TX
(
mvm
, "°©i⁄ Id %d, queue=%d\n", 
°a_id
, 
queue
);

859 
dev_cmd
 = 
	`iwl_mvm_£t_tx_∑øms
(
mvm
, 
skb
, &
öfo
, 
hdæí
, 
NULL
, 
°a_id
,

860 
NULL
);

861 i‡(!
dev_cmd
)

865 
	`iwl_mvm_skb_¥ï¨e_°©us
(
skb
, 
dev_cmd
);

867 i‡(
	`iwl_å™s_tx
(
mvm
->
å™s
, 
skb
, 
dev_cmd
, 
queue
)) {

868 
	`iwl_å™s_‰ì_tx_cmd
(
mvm
->
å™s
, 
dev_cmd
);

873 
	}
}

875 
	$iwl_mvm_max_amsdu_size
(
iwl_mvm
 *
mvm
,

876 
õì80211_°a
 *
°a
, 
tid
)

878 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

879 
u8
 
ac
 = 
tid_to_mac80211_ac
[
tid
];

880 
∆80211_b™d
 
b™d
;

881 
txf
;

882 
vÆ
;

883 
lmac
;

886 i‡(
°a
->
deÊök
.
he_ˇp
.
has_he
 && !
	`WARN_ON
(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

887 
ac
 += 4;

889 
txf
 = 
	`iwl_mvm_mac_ac_to_tx_fifo
(
mvm
, 
ac
);

897 
vÆ
 = 
mvm°a
->
max_amsdu_Àn
;

899 i‡(
	`hweight16
(
°a
->
vÆid_löks
) <= 1) {

900 i‡(
°a
->
vÆid_löks
) {

901 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

902 
lök
 = 
	`ffs
(
°a
->
vÆid_löks
) - 1;

904 
	`rcu_ªad_lock
();

905 
lök_c⁄f
 = 
	`rcu_dîe„ªn˚
(
mvm°a
->
vif
->lök_c⁄f[
lök
]);

906 i‡(
	`WARN_ON
(!
lök_c⁄f
))

907 
b™d
 = 
NL80211_BAND_2GHZ
;

909 
b™d
 = 
lök_c⁄f
->
ch™ªq
.
›î
.
ch™
->band;

910 
	`rcu_ªad_u∆ock
();

912 
b™d
 = 
mvm°a
->
vif
->
bss_c⁄f
.
ch™ªq
.
›î
.
ch™
->band;

915 
lmac
 = 
	`iwl_mvm_gë_lmac_id
(
mvm
, 
b™d
);

916 } i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

917 
IWL_UCODE_TLV_CAPA_CDB_SUPPORT
)) {

919 
lmac
 = 
IWL_LMAC_5G_INDEX
;

920 
vÆ
 = 
	`mö_t
(, val,

921 
mvm
->
fwπ
.
smem_cfg
.
lmac
[lmac].
txfifo_size
[
txf
] - 256);

922 
lmac
 = 
IWL_LMAC_24G_INDEX
;

924 
lmac
 = 
IWL_LMAC_24G_INDEX
;

927  
	`mö_t
(, 
vÆ
,

928 
mvm
->
fwπ
.
smem_cfg
.
lmac
[lmac].
txfifo_size
[
txf
] - 256);

929 
	}
}

931 #ifde‡
CONFIG_INET


934 
	$iwl_mvm_tx_tso_£gmít
(
sk_buff
 *
skb
, 
num_sub‰ames
,

935 
√tdev_„©uªs_t
 
√tdev_Êags
,

936 
sk_buff_hód
 *
mpdus_skb
)

938 
sk_buff
 *
tmp
, *
√xt
;

939 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

940 
cb
[(
skb
->cb)];

941 
u16
 
i
 = 0;

942 
t˝_∑ylﬂd_Àn
;

943 
mss
 = 
	`skb_shöfo
(
skb
)->
gso_size
;

944 
boﬁ
 
ùv4
 = (
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETH_P_IP
));

945 
boﬁ
 
qos
 = 
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
);

946 
u16
 
ù_ba£_id
 = 
ùv4
 ? 
	`¡ohs
(
	`ù_hdr
(
skb
)->
id
) : 0;

948 
	`skb_shöfo
(
skb
)->
gso_size
 = 
num_sub‰ames
 * 
mss
;

949 
	`mem˝y
(
cb
, 
skb
->cb, (cb));

951 
√xt
 = 
	`skb_gso_£gmít
(
skb
, 
√tdev_Êags
);

952 
	`skb_shöfo
(
skb
)->
gso_size
 = 
mss
;

953 
	`skb_shöfo
(
skb
)->
gso_ty≥
 = 
ùv4
 ? 
SKB_GSO_TCPV4
 : 
SKB_GSO_TCPV6
;

955 i‡(
	`IS_ERR
(
√xt
Ë&& 
	`PTR_ERR
“extË=-
ENOMEM
)

956  -
ENOMEM
;

958 i‡(
	`WARN_ONCE
(
	`IS_ERR
(
√xt
),

959 "skb_gso_£gmíàîr‹: %d\n", ()
	`PTR_ERR
(
√xt
)))

960  
	`PTR_ERR
(
√xt
);

962 i‡(
√xt
)

963 
	`c⁄sume_skb
(
skb
);

965 
	`skb_li°_wÆk_ß„
(
√xt
, 
tmp
,Çext) {

966 
	`mem˝y
(
tmp
->
cb
, cb, (tmp->cb));

973 
t˝_∑ylﬂd_Àn
 = 
	`skb_èû_poöãr
(
tmp
) -

974 
	`skb_å™•‹t_hódî
(
tmp
) -

975 
	`t˝_hdæí
(
tmp
Ë+Åmp->
d©a_Àn
;

977 i‡(
ùv4
)

978 
	`ù_hdr
(
tmp
)->
id
 = 
	`ht⁄s
(
ù_ba£_id
 + 
i
 * 
num_sub‰ames
);

980 i‡(
t˝_∑ylﬂd_Àn
 > 
mss
) {

981 
	`skb_shöfo
(
tmp
)->
gso_size
 = 
mss
;

982 
	`skb_shöfo
(
tmp
)->
gso_ty≥
 = 
ùv4
 ? 
SKB_GSO_TCPV4
 :

983 
SKB_GSO_TCPV6
;

985 i‡(
qos
) {

986 
u8
 *
qc
;

988 i‡(
ùv4
)

989 
	`ù_£nd_check
(
	`ù_hdr
(
tmp
));

991 
qc
 = 
	`õì80211_gë_qos_˘l
((*)
tmp
->
d©a
);

992 *
qc
 &~
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

994 
	`skb_shöfo
(
tmp
)->
gso_size
 = 0;

997 
	`skb_m¨k_nŸ_⁄_li°
(
tmp
);

998 
	`__skb_queue_èû
(
mpdus_skb
, 
tmp
);

999 
i
++;

1003 
	}
}

1005 
	$iwl_mvm_tx_tso
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1006 
õì80211_tx_öfo
 *
öfo
,

1007 
õì80211_°a
 *
°a
,

1008 
sk_buff_hód
 *
mpdus_skb
)

1010 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1011 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

1012 
mss
 = 
	`skb_shöfo
(
skb
)->
gso_size
;

1013 
num_sub‰ames
, 
t˝_∑ylﬂd_Àn
, 
subf_Àn
, 
max_amsdu_Àn
;

1014 
u16
 
¢≠_ù_t˝
, 
∑d
;

1015 
√tdev_„©uªs_t
 
√tdev_Êags
 = 
NETIF_F_CSUM_MASK
 | 
NETIF_F_SG
;

1016 
u8
 
tid
;

1018 
¢≠_ù_t˝
 = 8 + 
	`skb_√tw‹k_hódî_Àn
(
skb
Ë+ 
	`t˝_hdæí
(skb);

1020 i‡(!
mvm°a
->
max_amsdu_Àn
 ||

1021 !
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
) ||

1022 !
mvm°a
->
amsdu_íabÀd
)

1023  
	`iwl_mvm_tx_tso_£gmít
(
skb
, 1, 
√tdev_Êags
, 
mpdus_skb
);

1029 i‡(
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETH_P_IPV6
) &&

1030 ((
ùv6hdr
 *)
	`skb_√tw‹k_hódî
(
skb
))->
√xthdr
 !=

1031 
IPPROTO_TCP
) {

1032 
√tdev_Êags
 &~
NETIF_F_CSUM_MASK
;

1033  
	`iwl_mvm_tx_tso_£gmít
(
skb
, 1, 
√tdev_Êags
, 
mpdus_skb
);

1036 
tid
 = 
	`õì80211_gë_tid
(
hdr
);

1037 i‡(
	`WARN_ON_ONCE
(
tid
 >
IWL_MAX_TID_COUNT
))

1038  -
EINVAL
;

1044 i‡((
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
 &&

1045 !
mvm°a
->
tid_d©a
[
tid
].
amsdu_ö_ampdu_Ælowed
) ||

1046 !(
mvm°a
->
amsdu_íabÀd
 & 
	`BIT
(
tid
)))

1047  
	`iwl_mvm_tx_tso_£gmít
(
skb
, 1, 
√tdev_Êags
, 
mpdus_skb
);

1052 
max_amsdu_Àn
 =

1053 
	`mö_t
(, 
°a
->
cur
->
max_amsdu_Àn
,

1054 
	`iwl_mvm_max_amsdu_size
(
mvm
, 
°a
, 
tid
));

1061 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
 &&

1062 !
°a
->
deÊök
.
vht_ˇp
.
vht_suµ‹ãd
)

1063 
max_amsdu_Àn
 = 
	`mö_t
(, max_amsdu_len, 4095);

1066 
subf_Àn
 = (
ëhhdr
Ë+ 
¢≠_ù_t˝
 + 
mss
;

1067 
∑d
 = (4 - 
subf_Àn
) & 0x3;

1073 
num_sub‰ames
 = (
max_amsdu_Àn
 + 
∑d
Ë/ (
subf_Àn
 +Öad);

1075 i‡(
°a
->
max_amsdu_sub‰ames
 &&

1076 
num_sub‰ames
 > 
°a
->
max_amsdu_sub‰ames
)

1077 
num_sub‰ames
 = 
°a
->
max_amsdu_sub‰ames
;

1079 
t˝_∑ylﬂd_Àn
 = 
	`skb_èû_poöãr
(
skb
Ë- 
	`skb_å™•‹t_hódî
(skb) -

1080 
	`t˝_hdæí
(
skb
Ë+ skb->
d©a_Àn
;

1088 i‡((
num_sub‰ames
 * 2 + 
	`skb_shöfo
(
skb
)->
ƒ_‰ags
 + 1) >

1089 
mvm
->
å™s
->
max_skb_‰ags
)

1090 
num_sub‰ames
 = 1;

1092 i‡(
num_sub‰ames
 > 1)

1093 *
	`õì80211_gë_qos_˘l
(
hdr
Ë|
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

1096 i‡(
num_sub‰ames
 * 
mss
 >
t˝_∑ylﬂd_Àn
) {

1097 
	`__skb_queue_èû
(
mpdus_skb
, 
skb
);

1105  
	`iwl_mvm_tx_tso_£gmít
(
skb
, 
num_sub‰ames
, 
√tdev_Êags
,

1106 
mpdus_skb
);

1107 
	}
}

1109 
	$iwl_mvm_tx_tso
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1110 
õì80211_tx_öfo
 *
öfo
,

1111 
õì80211_°a
 *
°a
,

1112 
sk_buff_hód
 *
mpdus_skb
)

1115 
	`WARN_ON
(1);

1118 
	}
}

1122 
boﬁ
 
	$iwl_mvm_txq_should_upd©e
(
iwl_mvm
 *
mvm
, 
txq_id
)

1124 
queue_tid_bôm≠
 = 
mvm
->
queue_öfo
[
txq_id
].
tid_bôm≠
;

1125 
now
 = 
jiffõs
;

1126 
tid
;

1128 i‡(
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)))

1129  
Ál£
;

1131 
	`f‹_óch_£t_bô
(
tid
, &
queue_tid_bôm≠
, 
IWL_MAX_TID_COUNT
 + 1) {

1132 i‡(
	`time_bef‹e
(
mvm
->
queue_öfo
[
txq_id
].
œ°_‰ame_time
[
tid
] +

1133 
IWL_MVM_DQA_QUEUE_TIMEOUT
, 
now
))

1134  
åue
;

1137  
Ál£
;

1138 
	}
}

1140 
	$iwl_mvm_tx_aútime
(
iwl_mvm
 *
mvm
,

1141 
iwl_mvm_°a
 *
mvm°a
,

1142 
aútime
)

1144 
mac
 = 
mvm°a
->
mac_id_n_cﬁ‹
 & 
FW_CTXT_ID_MSK
;

1145 
iwl_mvm_tcm_mac
 *
md©a
;

1147 i‡(
mac
 >
NUM_MAC_INDEX_DRIVER
)

1150 
md©a
 = &
mvm
->
tcm
.
d©a
[
mac
];

1152 i‡(
mvm
->
tcm
.
∑u£d
)

1155 i‡(
	`time_a·î
(
jiffõs
, 
mvm
->
tcm
.
ts
 + 
MVM_TCM_PERIOD
))

1156 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tcm
.
w‹k
, 0);

1158 
md©a
->
tx
.
aútime
 +=áirtime;

1159 
	}
}

1161 
	$iwl_mvm_tx_pkt_queued
(
iwl_mvm
 *
mvm
,

1162 
iwl_mvm_°a
 *
mvm°a
, 
tid
)

1164 
u32
 
ac
 = 
tid_to_mac80211_ac
[
tid
];

1165 
mac
 = 
mvm°a
->
mac_id_n_cﬁ‹
 & 
FW_CTXT_ID_MSK
;

1166 
iwl_mvm_tcm_mac
 *
md©a
;

1168 i‡(
mac
 >
NUM_MAC_INDEX_DRIVER
)

1169  -
EINVAL
;

1171 
md©a
 = &
mvm
->
tcm
.
d©a
[
mac
];

1173 
md©a
->
tx
.
pkts
[
ac
]++;

1176 
	}
}

1183 
	$iwl_mvm_tx_mpdu
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1184 
õì80211_tx_öfo
 *
öfo
,

1185 
õì80211_°a
 *
°a
,

1186 c⁄° 
u8
 *
addr3_ovîride
)

1188 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

1189 
iwl_mvm_°a
 *
mvm°a
;

1190 
iwl_devi˚_tx_cmd
 *
dev_cmd
;

1191 
__À16
 
fc
;

1192 
u16
 
£q_numbî
 = 0;

1193 
u8
 
tid
 = 
IWL_MAX_TID_COUNT
;

1194 
u16
 
txq_id
;

1195 
boﬁ
 
is_ampdu
 = 
Ál£
;

1196 
hdæí
;

1198 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1199 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

1200 
hdæí
 = 
	`õì80211_hdæí
(
fc
);

1202 i‡(
IWL_MVM_NON_TRANSMITTING_AP
 && 
	`õì80211_is_¥obe_ª•
(
fc
))

1205 i‡(
	`WARN_ON_ONCE
(!
mvm°a
))

1208 i‡(
	`WARN_ON_ONCE
(
mvm°a
->
deÊök
.
°a_id
 =
IWL_MVM_INVALID_STA
))

1211 i‡(
	`u∆ikñy
(
	`õì80211_is_™y_nuŒfunc
(
fc
)Ë&& 
°a
->
deÊök
.
he_ˇp
.
has_he
)

1214 i‡(
	`u∆ikñy
(
	`õì80211_is_¥obe_ª•
(
fc
)))

1215 
	`iwl_mvm_¥obe_ª•_£t_nﬂ
(
mvm
, 
skb
);

1217 
dev_cmd
 = 
	`iwl_mvm_£t_tx_∑øms
(
mvm
, 
skb
, 
öfo
, 
hdæí
,

1218 
°a
, 
mvm°a
->
deÊök
.
°a_id
,

1219 
addr3_ovîride
);

1220 i‡(!
dev_cmd
)

1221 
dr›
;

1228 
öfo
->
Êags
 &~
IEEE80211_TX_STATUS_EOSP
;

1230 
	`•ö_lock
(&
mvm°a
->
lock
);

1236 i‡(
	`õì80211_is_d©a_qos
(
fc
Ë&& !
	`õì80211_is_qos_nuŒfunc
(fc)) {

1237 
tid
 = 
	`õì80211_gë_tid
(
hdr
);

1238 i‡(
	`WARN_ONCE
(
tid
 >
IWL_MAX_TID_COUNT
, "Invalid TID %d",Åid))

1239 
dr›_u∆ock_°a
;

1241 
is_ampdu
 = 
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
;

1242 i‡(
	`WARN_ONCE
(
is_ampdu
 &&

1243 
mvm°a
->
tid_d©a
[
tid
].
°©e
 !
IWL_AGG_ON
,

1245 
mvm°a
->
tid_d©a
[
tid
].
°©e
,Åid))

1246 
dr›_u∆ock_°a
;

1248 
£q_numbî
 = 
mvm°a
->
tid_d©a
[
tid
].seq_number;

1249 
£q_numbî
 &
IEEE80211_SCTL_SEQ
;

1251 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

1252 
iwl_tx_cmd
 *
tx_cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

1254 
hdr
->
£q_˘æ
 &
	`˝u_to_À16
(
IEEE80211_SCTL_FRAG
);

1255 
hdr
->
£q_˘æ
 |
	`˝u_to_À16
(
£q_numbî
);

1257 
tx_cmd
->
hdr
->
£q_˘æ
 = hdr->seq_ctrl;

1259 } i‡(
	`õì80211_is_d©a
(
fc
Ë&& !
	`õì80211_is_d©a_qos
(fc) &&

1260 !
	`õì80211_is_nuŒfunc
(
fc
)) {

1261 
tid
 = 
IWL_TID_NON_QOS
;

1264 
txq_id
 = 
mvm°a
->
tid_d©a
[
tid
].txq_id;

1266 
	`WARN_ON_ONCE
(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_SEND_AFTER_DTIM
);

1268 i‡(
	`WARN_ONCE
(
txq_id
 =
IWL_MVM_INVALID_QUEUE
, "Invalid TXQ id")) {

1269 
	`iwl_å™s_‰ì_tx_cmd
(
mvm
->
å™s
, 
dev_cmd
);

1270 
	`•ö_u∆ock
(&
mvm°a
->
lock
);

1274 i‡(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

1276 
mvm
->
queue_öfo
[
txq_id
].
œ°_‰ame_time
[
tid
] = 
jiffõs
;

1288 i‡(
	`u∆ikñy
(
mvm
->
queue_öfo
[
txq_id
].
°©us
 ==

1289 
IWL_MVM_QUEUE_SHARED
 &&

1290 
	`iwl_mvm_txq_should_upd©e
(
mvm
, 
txq_id
)))

1291 
	`scheduÀ_w‹k
(&
mvm
->
add_°ªam_wk
);

1294 
	`IWL_DEBUG_TX
(
mvm
, "TXÅo [%d|%d] Q:%d - seq: 0x%xÜen %d\n",

1295 
mvm°a
->
deÊök
.
°a_id
, 
tid
, 
txq_id
,

1296 
	`IEEE80211_SEQ_TO_SN
(
£q_numbî
), 
skb
->
Àn
);

1299 
	`iwl_mvm_skb_¥ï¨e_°©us
(
skb
, 
dev_cmd
);

1306 i‡(
	`õì80211_is_d©a
(
fc
))

1307 
	`iwl_mvm_mei_tx_c›y_to_csme
(
mvm
, 
skb
,

1308 
öfo
->
c⁄åﬁ
.
hw_key
 &&

1309 !
	`iwl_mvm_has_√w_tx_≠i
(
mvm
) ?

1310 
öfo
->
c⁄åﬁ
.
hw_key
->
iv_Àn
 : 0);

1312 i‡(
	`iwl_å™s_tx
(
mvm
->
å™s
, 
skb
, 
dev_cmd
, 
txq_id
))

1313 
dr›_u∆ock_°a
;

1315 i‡(
tid
 < 
IWL_MAX_TID_COUNT
 && !
	`õì80211_has_m‹e‰ags
(
fc
))

1316 
mvm°a
->
tid_d©a
[
tid
].
£q_numbî
 = seq_number + 0x10;

1318 
	`•ö_u∆ock
(&
mvm°a
->
lock
);

1320 i‡(
	`iwl_mvm_tx_pkt_queued
(
mvm
, 
mvm°a
,

1321 
tid
 =
IWL_MAX_TID_COUNT
 ? 0 :Åid))

1322 
dr›
;

1326 
dr›_u∆ock_°a
:

1327 
	`iwl_å™s_‰ì_tx_cmd
(
mvm
->
å™s
, 
dev_cmd
);

1328 
	`•ö_u∆ock
(&
mvm°a
->
lock
);

1329 
dr›
:

1330 
	`IWL_DEBUG_TX
(
mvm
, "TXÅÿ[%d|%d] dr›≥d\n", 
mvm°a
->
deÊök
.
°a_id
,

1331 
tid
);

1333 
	}
}

1335 
	$iwl_mvm_tx_skb_°a
(
iwl_mvm
 *
mvm
, 
sk_buff
 *
skb
,

1336 
õì80211_°a
 *
°a
)

1338 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1339 
õì80211_tx_öfo
 
öfo
;

1340 
sk_buff_hód
 
mpdus_skbs
;

1341 
õì80211_vif
 *
vif
;

1342 
∑ylﬂd_Àn
;

1343 
ªt
;

1344 
sk_buff
 *
‹ig_skb
 = 
skb
;

1345 c⁄° 
u8
 *
addr3
;

1347 i‡(
	`WARN_ON_ONCE
(!
mvm°a
))

1350 i‡(
	`WARN_ON_ONCE
(
mvm°a
->
deÊök
.
°a_id
 =
IWL_MVM_INVALID_STA
))

1353 
	`mem˝y
(&
öfo
, 
skb
->
cb
, (info));

1355 i‡(!
	`skb_is_gso
(
skb
))

1356  
	`iwl_mvm_tx_mpdu
(
mvm
, 
skb
, &
öfo
, 
°a
, 
NULL
);

1358 
∑ylﬂd_Àn
 = 
	`skb_èû_poöãr
(
skb
Ë- 
	`skb_å™•‹t_hódî
(skb) -

1359 
	`t˝_hdæí
(
skb
Ë+ skb->
d©a_Àn
;

1361 i‡(
∑ylﬂd_Àn
 <
	`skb_shöfo
(
skb
)->
gso_size
)

1362  
	`iwl_mvm_tx_mpdu
(
mvm
, 
skb
, &
öfo
, 
°a
, 
NULL
);

1364 
	`__skb_queue_hód_öô
(&
mpdus_skbs
);

1366 
vif
 = 
öfo
.
c⁄åﬁ
.vif;

1367 i‡(!
vif
)

1370 
ªt
 = 
	`iwl_mvm_tx_tso
(
mvm
, 
skb
, &
öfo
, 
°a
, &
mpdus_skbs
);

1371 i‡(
ªt
)

1372  
ªt
;

1374 
	`WARN_ON
(
	`skb_queue_em±y
(&
mpdus_skbs
));

1385 
vif
->
ty≥
) {

1386 
NL80211_IFTYPE_STATION
:

1387 
addr3
 = 
vif
->
cfg
.
≠_addr
;

1389 
NL80211_IFTYPE_AP
:

1390 
addr3
 = 
vif
->
addr
;

1393 
addr3
 = 
NULL
;

1397 !
	`skb_queue_em±y
(&
mpdus_skbs
)) {

1398 
õì80211_hdr
 *
hdr
;

1399 
boﬁ
 
amsdu
;

1401 
skb
 = 
	`__skb_dequeue
(&
mpdus_skbs
);

1402 
hdr
 = (*)
skb
->
d©a
;

1403 
amsdu
 = 
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
) &&

1404 (*
	`õì80211_gë_qos_˘l
(
hdr
) &

1405 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
);

1407 
ªt
 = 
	`iwl_mvm_tx_mpdu
(
mvm
, 
skb
, &
öfo
, 
°a
,

1408 
amsdu
 ? 
addr3
 : 
NULL
);

1409 i‡(
ªt
) {

1411 
	`__skb_queue_purge
(&
mpdus_skbs
);

1415 i‡(
skb
 =
‹ig_skb
)

1416 
	`õì80211_‰ì_txskb
(
mvm
->
hw
, 
skb
);

1418 
	`k‰ì_skb
(
skb
);

1425 
	}
}

1427 
	$iwl_mvm_check_øtid_em±y
(
iwl_mvm
 *
mvm
,

1428 
õì80211_°a
 *
°a
, 
u8
 
tid
)

1430 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1431 
iwl_mvm_tid_d©a
 *
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

1432 
õì80211_vif
 *
vif
 = 
mvm°a
->vif;

1433 
u16
 
n‹mÆized_s¢
;

1435 
	`lockdï_as£π_hñd
(&
mvm°a
->
lock
);

1437 i‡((
tid_d©a
->
°©e
 =
IWL_AGG_ON
 ||

1438 
tid_d©a
->
°©e
 =
IWL_EMPTYING_HW_QUEUE_DELBA
) &&

1439 
	`iwl_mvm_tid_queued
(
mvm
, 
tid_d©a
) == 0) {

1445 
	`õì80211_°a_£t_buf„ªd
(
°a
, 
tid
, 
Ál£
);

1452 
n‹mÆized_s¢
 = 
tid_d©a
->
s¢
;

1453 i‡(
mvm
->
å™s
->
å™s_cfg
->
gí2
)

1454 
n‹mÆized_s¢
 &= 0xff;

1456 i‡(
n‹mÆized_s¢
 !
tid_d©a
->
√xt_ª˛aimed
)

1459 
tid_d©a
->
°©e
) {

1460 
IWL_EMPTYING_HW_QUEUE_ADDBA
:

1461 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1463 
tid_d©a
->
√xt_ª˛aimed
);

1464 
tid_d©a
->
°©e
 = 
IWL_AGG_STARTING
;

1465 
	`õì80211_°¨t_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

1468 
IWL_EMPTYING_HW_QUEUE_DELBA
:

1469 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

1471 
tid_d©a
->
√xt_ª˛aimed
);

1472 
tid_d©a
->
°©e
 = 
IWL_AGG_OFF
;

1473 
	`õì80211_°›_tx_ba_cb_úqß„
(
vif
, 
°a
->
addr
, 
tid
);

1479 
	}
}

1481 #ifde‡
CONFIG_IWLWIFI_DEBUG


1482 c⁄° *
	$iwl_mvm_gë_tx_Áû_ªas⁄
(
u32
 
°©us
)

1484 
	#TX_STATUS_FAIL
(
x
Ë
TX_STATUS_FAIL_
 ## x:  #x

	)

1485 
	#TX_STATUS_POSTPONE
(
x
Ë
TX_STATUS_POSTPONE_
 ## x:  #x

	)

1487 
°©us
 & 
TX_STATUS_MSK
) {

1488 
TX_STATUS_SUCCESS
:

1490 
	`TX_STATUS_POSTPONE
(
DELAY
);

1491 
	`TX_STATUS_POSTPONE
(
FEW_BYTES
);

1492 
	`TX_STATUS_POSTPONE
(
BT_PRIO
);

1493 
	`TX_STATUS_POSTPONE
(
QUIET_PERIOD
);

1494 
	`TX_STATUS_POSTPONE
(
CALC_TTAK
);

1495 
	`TX_STATUS_FAIL
(
INTERNAL_CROSSED_RETRY
);

1496 
	`TX_STATUS_FAIL
(
SHORT_LIMIT
);

1497 
	`TX_STATUS_FAIL
(
LONG_LIMIT
);

1498 
	`TX_STATUS_FAIL
(
UNDERRUN
);

1499 
	`TX_STATUS_FAIL
(
DRAIN_FLOW
);

1500 
	`TX_STATUS_FAIL
(
RFKILL_FLUSH
);

1501 
	`TX_STATUS_FAIL
(
LIFE_EXPIRE
);

1502 
	`TX_STATUS_FAIL
(
DEST_PS
);

1503 
	`TX_STATUS_FAIL
(
HOST_ABORTED
);

1504 
	`TX_STATUS_FAIL
(
BT_RETRY
);

1505 
	`TX_STATUS_FAIL
(
STA_INVALID
);

1506 
	`TX_STATUS_FAIL
(
FRAG_DROPPED
);

1507 
	`TX_STATUS_FAIL
(
TID_DISABLE
);

1508 
	`TX_STATUS_FAIL
(
FIFO_FLUSHED
);

1509 
	`TX_STATUS_FAIL
(
SMALL_CF_POLL
);

1510 
	`TX_STATUS_FAIL
(
FW_DROP
);

1511 
	`TX_STATUS_FAIL
(
STA_COLOR_MISMATCH
);

1516 #unde‡
TX_STATUS_FAIL


1517 #unde‡
TX_STATUS_POSTPONE


1518 
	}
}

1521 
	$iwl_mvm_gë_hwøã_ch™_width
(
u32
 
ch™_width
)

1523 
ch™_width
) {

1524 
RATE_MCS_CHAN_WIDTH_20
:

1526 
RATE_MCS_CHAN_WIDTH_40
:

1527  
IEEE80211_TX_RC_40_MHZ_WIDTH
;

1528 
RATE_MCS_CHAN_WIDTH_80
:

1529  
IEEE80211_TX_RC_80_MHZ_WIDTH
;

1530 
RATE_MCS_CHAN_WIDTH_160
:

1531  
IEEE80211_TX_RC_160_MHZ_WIDTH
;

1535 
	}
}

1537 
	$iwl_mvm_hwøã_to_tx_øã
(
u32
 
øã_n_Êags
,

1538 
∆80211_b™d
 
b™d
,

1539 
õì80211_tx_øã
 *
r
)

1541 
u32
 
f‹m©
 = 
øã_n_Êags
 & 
RATE_MCS_MOD_TYPE_MSK
;

1542 
u32
 
øã
 = 
f‹m©
 =
RATE_MCS_HT_MSK
 ?

1543 
	`RATE_HT_MCS_INDEX
(
øã_n_Êags
) :

1544 
øã_n_Êags
 & 
RATE_MCS_CODE_MSK
;

1546 
r
->
Êags
 |=

1547 
	`iwl_mvm_gë_hwøã_ch™_width
(
øã_n_Êags
 &

1548 
RATE_MCS_CHAN_WIDTH_MSK
);

1550 i‡(
øã_n_Êags
 & 
RATE_MCS_SGI_MSK
)

1551 
r
->
Êags
 |
IEEE80211_TX_RC_SHORT_GI
;

1552 i‡(
f‹m©
 =
RATE_MCS_HT_MSK
) {

1553 
r
->
Êags
 |
IEEE80211_TX_RC_MCS
;

1554 
r
->
idx
 = 
øã
;

1555 } i‡(
f‹m©
 =
RATE_MCS_VHT_MSK
) {

1556 
	`õì80211_øã_£t_vht
(
r
, 
øã
,

1557 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
,

1558 
øã_n_Êags
) + 1);

1559 
r
->
Êags
 |
IEEE80211_TX_RC_VHT_MCS
;

1560 } i‡(
f‹m©
 =
RATE_MCS_HE_MSK
) {

1563 
r
->
idx
 = 0;

1565 
r
->
idx
 = 
	`iwl_mvm_Àgacy_hw_idx_to_mac80211_idx
(
øã_n_Êags
,

1566 
b™d
);

1568 
	}
}

1570 
	$iwl_mvm_hwøã_to_tx_øã_v1
(
u32
 
øã_n_Êags
,

1571 
∆80211_b™d
 
b™d
,

1572 
õì80211_tx_øã
 *
r
)

1574 i‡(
øã_n_Êags
 & 
RATE_HT_MCS_GF_MSK
)

1575 
r
->
Êags
 |
IEEE80211_TX_RC_GREEN_FIELD
;

1577 
r
->
Êags
 |=

1578 
	`iwl_mvm_gë_hwøã_ch™_width
(
øã_n_Êags
 &

1579 
RATE_MCS_CHAN_WIDTH_MSK_V1
);

1581 i‡(
øã_n_Êags
 & 
RATE_MCS_SGI_MSK_V1
)

1582 
r
->
Êags
 |
IEEE80211_TX_RC_SHORT_GI
;

1583 i‡(
øã_n_Êags
 & 
RATE_MCS_HT_MSK_V1
) {

1584 
r
->
Êags
 |
IEEE80211_TX_RC_MCS
;

1585 
r
->
idx
 = 
øã_n_Êags
 & 
RATE_HT_MCS_INDEX_MSK_V1
;

1586 } i‡(
øã_n_Êags
 & 
RATE_MCS_VHT_MSK_V1
) {

1587 
	`õì80211_øã_£t_vht
(

1588 
r
, 
øã_n_Êags
 & 
RATE_VHT_MCS_RATE_CODE_MSK
,

1589 
	`FIELD_GET
(
RATE_MCS_NSS_MSK
, 
øã_n_Êags
) + 1);

1590 
r
->
Êags
 |
IEEE80211_TX_RC_VHT_MCS
;

1592 
r
->
idx
 = 
	`iwl_mvm_Àgacy_øã_to_mac80211_idx
(
øã_n_Êags
,

1593 
b™d
);

1595 
	}
}

1600 
	$iwl_mvm_hwøã_to_tx_°©us
(c⁄° 
iwl_fw
 *
fw
,

1601 
u32
 
øã_n_Êags
,

1602 
õì80211_tx_öfo
 *
öfo
)

1604 
õì80211_tx_øã
 *
r
 = &
öfo
->
°©us
.
øãs
[0];

1606 i‡(
	`iwl_fw_lookup_nŸif_vî
(
fw
, 
LONG_GROUP
,

1607 
TX_CMD
, 0) <= 6)

1608 
øã_n_Êags
 = 
	`iwl_√w_øã_‰om_v1
(rate_n_flags);

1610 
öfo
->
°©us
.
™ã¬a
 =

1611 ((
øã_n_Êags
 & 
RATE_MCS_ANT_AB_MSK
Ë>> 
RATE_MCS_ANT_POS
);

1612 
	`iwl_mvm_hwøã_to_tx_øã
(
øã_n_Êags
,

1613 
öfo
->
b™d
, 
r
);

1614 
	}
}

1616 
	$iwl_mvm_tx_°©us_check_åiggî
(
iwl_mvm
 *
mvm
,

1617 
u32
 
°©us
, 
__À16
 
‰ame_c⁄åﬁ
)

1619 
iwl_fw_dbg_åiggî_év
 *
åig
;

1620 
iwl_fw_dbg_åiggî_tx_°©us
 *
°©us_åig
;

1621 
i
;

1623 i‡((
°©us
 & 
TX_STATUS_MSK
Ë!
TX_STATUS_SUCCESS
) {

1624 
iwl_fw_öi_time_poöt
 
ç
 =

1625 
IWL_FW_INI_TIME_POINT_TX_FAILED
;

1627 i‡(
	`õì80211_is_a˘i⁄
(
‰ame_c⁄åﬁ
))

1628 
ç
 = 
IWL_FW_INI_TIME_POINT_TX_WFD_ACTION_FRAME_FAILED
;

1630 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

1631 
ç
, 
NULL
);

1635 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
NULL
,

1636 
FW_DBG_TRIGGER_TX_STATUS
);

1637 i‡(!
åig
)

1640 
°©us_åig
 = (*)
åig
->
d©a
;

1642 
i
 = 0; i < 
	`ARRAY_SIZE
(
°©us_åig
->
°©u£s
); i++) {

1644 i‡(!
°©us_åig
->
°©u£s
[
i
].
°©us
)

1647 i‡(
°©us_åig
->
°©u£s
[
i
].
°©us
 !(°©u†& 
TX_STATUS_MSK
))

1650 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

1652 
°©us
 & 
TX_STATUS_MSK
);

1655 
	}
}

1672 
ölöe
 
u32
 
	$iwl_mvm_gë_scd_s¢
(
iwl_mvm
 *
mvm
,

1673 
iwl_mvm_tx_ª•
 *
tx_ª•
)

1675 
u32
 
vÆ
 = 
	`À32_to_˝up
((
__À32
 *)
	`iwl_mvm_gë_agg_°©us
(
mvm
, 
tx_ª•
) +

1676 
tx_ª•
->
‰ame_cou¡
);

1678 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

1679  
vÆ
 & 0xFFFF;

1680  
vÆ
 & 0xFFF;

1681 
	}
}

1683 
	$iwl_mvm_rx_tx_cmd_sögÀ
(
iwl_mvm
 *
mvm
,

1684 
iwl_rx_∑ckë
 *
pkt
)

1686 
õì80211_°a
 *
°a
;

1687 
u16
 
£quí˚
 = 
	`À16_to_˝u
(
pkt
->
hdr
.sequence);

1688 
txq_id
 = 
	`SEQ_TO_QUEUE
(
£quí˚
);

1690 
iwl_mvm_tx_ª•
 *
tx_ª•
 = (*)
pkt
->
d©a
;

1691 
°a_id
 = 
	`IWL_MVM_TX_RES_GET_RA
(
tx_ª•
->
ø_tid
);

1692 
tid
 = 
	`IWL_MVM_TX_RES_GET_TID
(
tx_ª•
->
ø_tid
);

1693 
agg_tx_°©us
 *
agg_°©us
 =

1694 
	`iwl_mvm_gë_agg_°©us
(
mvm
, 
tx_ª•
);

1695 
u32
 
°©us
 = 
	`À16_to_˝u
(
agg_°©us
->status);

1696 
u16
 
s¢
 = 
	`iwl_mvm_gë_scd_s¢
(
mvm
, 
tx_ª•
);

1697 
sk_buff_hód
 
skbs
;

1698 
u8
 
skb_‰ìd
 = 0;

1699 
u8
 
lq_cﬁ‹
;

1700 
u16
 
√xt_ª˛aimed
, 
£q_˘l
;

1701 
boﬁ
 
is_ndp
 = 
Ál£
;

1703 
	`__skb_queue_hód_öô
(&
skbs
);

1705 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

1706 
txq_id
 = 
	`À16_to_˝u
(
tx_ª•
->
tx_queue
);

1708 
£q_˘l
 = 
	`À16_to_˝u
(
tx_ª•
->seq_ctl);

1711 
	`iwl_å™s_ª˛aim
(
mvm
->
å™s
, 
txq_id
, 
s¢
, &
skbs
, 
Ál£
);

1713 !
	`skb_queue_em±y
(&
skbs
)) {

1714 
sk_buff
 *
skb
 = 
	`__skb_dequeue
(&
skbs
);

1715 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1716 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

1717 
boﬁ
 
Êushed
 = 
Ál£
;

1719 
skb_‰ìd
++;

1721 
	`iwl_å™s_‰ì_tx_cmd
(
mvm
->
å™s
, 
öfo
->
drivî_d©a
[1]);

1723 
	`mem£t
(&
öfo
->
°©us
, 0, (info->status));

1724 
öfo
->
Êags
 &~(
IEEE80211_TX_STAT_ACK
 | 
IEEE80211_TX_STAT_TX_FILTERED
);

1727 
°©us
 & 
TX_STATUS_MSK
) {

1728 
TX_STATUS_SUCCESS
:

1729 
TX_STATUS_DIRECT_DONE
:

1730 
öfo
->
Êags
 |
IEEE80211_TX_STAT_ACK
;

1732 
TX_STATUS_FAIL_FIFO_FLUSHED
:

1733 
TX_STATUS_FAIL_DRAIN_FLOW
:

1734 
Êushed
 = 
åue
;

1736 
TX_STATUS_FAIL_DEST_PS
:

1740 
	`IWL_ERR_LIMIT
(
mvm
,

1742 
°©us
, 
	`À16_to_˝u
(
hdr
->
‰ame_c⁄åﬁ
));

1743 
öfo
->
Êags
 |
IEEE80211_TX_STAT_TX_FILTERED
;

1749 i‡((
°©us
 & 
TX_STATUS_MSK
Ë!
TX_STATUS_SUCCESS
 &&

1750 
	`õì80211_is_mgmt
(
hdr
->
‰ame_c⁄åﬁ
))

1751 
	`iwl_mvm_toggÀ_tx_™t
(
mvm
, &mvm->
mgmt_œ°_™ã¬a_idx
);

1758 i‡(
skb_‰ìd
 > 1)

1759 
öfo
->
Êags
 |
IEEE80211_TX_STAT_ACK
;

1761 
	`iwl_mvm_tx_°©us_check_åiggî
(
mvm
, 
°©us
, 
hdr
->
‰ame_c⁄åﬁ
);

1763 
öfo
->
°©us
.
øãs
[0].
cou¡
 = 
tx_ª•
->
Áûuª_‰ame
 + 1;

1765 
	`iwl_mvm_hwøã_to_tx_°©us
(
mvm
->
fw
,

1766 
	`À32_to_˝u
(
tx_ª•
->
öôül_øã
),

1767 
öfo
);

1772 
öfo
->
°©us
.
°©us_drivî_d©a
[1] =

1773 (*)(
uöçå_t
)
	`À32_to_˝u
(
tx_ª•
->
öôül_øã
);

1776 i‡(
öfo
->
Êags
 & 
IEEE80211_TX_CTL_AMPDU
 &&

1777 !(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_ACK
) &&

1778 !(
öfo
->
Êags
 & 
IEEE80211_TX_STAT_TX_FILTERED
Ë&& !
Êushed
)

1779 
öfo
->
Êags
 |
IEEE80211_TX_STAT_AMPDU_NO_BACK
;

1780 
öfo
->
Êags
 &~
IEEE80211_TX_CTL_AMPDU
;

1783 i‡(
	`õì80211_is_back_ªq
(
hdr
->
‰ame_c⁄åﬁ
))

1784 
£q_˘l
 = 0;

1785 i‡(
°©us
 !
TX_STATUS_SUCCESS
)

1786 
£q_˘l
 = 
	`À16_to_˝u
(
hdr
->
£q_˘æ
);

1788 i‡(
	`u∆ikñy
(!
£q_˘l
)) {

1796 i‡(
	`õì80211_is_qos_nuŒfunc
(
hdr
->
‰ame_c⁄åﬁ
))

1797 
is_ndp
 = 
åue
;

1804 
öfo
->
°©us
.
tx_time
 =

1805 
	`À16_to_˝u
(
tx_ª•
->
wúñess_medü_time
);

1806 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
öfo
->
°©us
.
°©us_drivî_d©a
) < 1);

1807 
lq_cﬁ‹
 = 
	`TX_RES_RATE_TABLE_COL_GET
(
tx_ª•
->
éc_öfo
);

1808 
öfo
->
°©us
.
°©us_drivî_d©a
[0] =

1809 
	`RS_DRV_DATA_PACK
(
lq_cﬁ‹
, 
tx_ª•
->
ªdu˚d_çc
);

1811 i‡(
	`likñy
(!
	`iwl_mvm_time_sync_‰ame
(
mvm
, 
skb
, 
hdr
->
addr1
)))

1812 
	`õì80211_tx_°©us_skb
(
mvm
->
hw
, 
skb
);

1829 
√xt_ª˛aimed
 = 
s¢
;

1831 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

1833 
txq_id
, 
	`iwl_mvm_gë_tx_Áû_ªas⁄
(
°©us
), status);

1835 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

1837 
	`À32_to_˝u
(
tx_ª•
->
öôül_øã
),

1838 
tx_ª•
->
Áûuª_‰ame
, 
	`SEQ_TO_INDEX
(
£quí˚
),

1839 
s¢
, 
√xt_ª˛aimed
, 
£q_˘l
);

1841 
	`rcu_ªad_lock
();

1843 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

1848 i‡(
	`WARN_ON_ONCE
(!
°a
))

1849 
out
;

1851 i‡(!
	`IS_ERR
(
°a
)) {

1852 
iwl_mvm_°a
 *
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

1854 
	`iwl_mvm_tx_aútime
(
mvm
, 
mvm°a
,

1855 
	`À16_to_˝u
(
tx_ª•
->
wúñess_medü_time
));

1857 i‡((
°©us
 & 
TX_STATUS_MSK
Ë!
TX_STATUS_SUCCESS
 &&

1858 
mvm°a
->
°a_°©e
 < 
IEEE80211_STA_AUTHORIZED
)

1859 
	`iwl_mvm_toggÀ_tx_™t
(
mvm
, &
mvm°a
->
tx_™t
);

1861 i‡(
°a
->
wme
 && 
tid
 !
IWL_MGMT_TID
) {

1862 
iwl_mvm_tid_d©a
 *
tid_d©a
 =

1863 &
mvm°a
->
tid_d©a
[
tid
];

1864 
boﬁ
 
£nd_eo•_ndp
 = 
Ál£
;

1866 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

1868 i‡(!
is_ndp
) {

1869 
tid_d©a
->
√xt_ª˛aimed
 =Çext_reclaimed;

1870 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

1872 
√xt_ª˛aimed
);

1874 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

1878 
	`iwl_mvm_check_øtid_em±y
(
mvm
, 
°a
, 
tid
);

1880 i‡(
mvm°a
->
¶ìp_tx_cou¡
) {

1881 
mvm°a
->
¶ìp_tx_cou¡
--;

1882 i‡(
mvm°a
->
¶ìp_tx_cou¡
 &&

1883 !
	`iwl_mvm_tid_queued
(
mvm
, 
tid_d©a
)) {

1897 
£nd_eo•_ndp
 = 
åue
;

1901 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

1902 i‡(
£nd_eo•_ndp
) {

1903 
	`iwl_mvm_°a_modify_¶ìp_tx_cou¡
(
mvm
, 
°a
,

1904 
IEEE80211_FRAME_RELEASE_UAPSD
,

1905 1, 
tid
, 
Ál£
, false);

1906 
mvm°a
->
¶ìp_tx_cou¡
 = 0;

1907 
	`õì80211_£nd_eo•_nuŒfunc
(
°a
, 
tid
);

1911 i‡(
mvm°a
->
√xt_°©us_eo•
) {

1912 
mvm°a
->
√xt_°©us_eo•
 = 
Ál£
;

1913 
	`õì80211_°a_eo•
(
°a
);

1916 
out
:

1917 
	`rcu_ªad_u∆ock
();

1918 
	}
}

1920 #ifde‡
CONFIG_IWLWIFI_DEBUG


1921 
	#AGG_TX_STATE_
(
x
Ë
AGG_TX_STATE_
 ## x:  #x

	)

1922 c⁄° *
	$iwl_gë_agg_tx_°©us
(
u16
 
°©us
)

1924 
°©us
 & 
AGG_TX_STATE_STATUS_MSK
) {

1925 
	`AGG_TX_STATE_
(
TRANSMITTED
);

1926 
	`AGG_TX_STATE_
(
UNDERRUN
);

1927 
	`AGG_TX_STATE_
(
BT_PRIO
);

1928 
	`AGG_TX_STATE_
(
FEW_BYTES
);

1929 
	`AGG_TX_STATE_
(
ABORT
);

1930 
	`AGG_TX_STATE_
(
TX_ON_AIR_DROP
);

1931 
	`AGG_TX_STATE_
(
LAST_SENT_TRY_CNT
);

1932 
	`AGG_TX_STATE_
(
LAST_SENT_BT_KILL
);

1933 
	`AGG_TX_STATE_
(
SCD_QUERY
);

1934 
	`AGG_TX_STATE_
(
TEST_BAD_CRC32
);

1935 
	`AGG_TX_STATE_
(
RESPONSE
);

1936 
	`AGG_TX_STATE_
(
DUMP_TX
);

1937 
	`AGG_TX_STATE_
(
DELAY_TX
);

1941 
	}
}

1943 
	$iwl_mvm_rx_tx_cmd_agg_dbg
(
iwl_mvm
 *
mvm
,

1944 
iwl_rx_∑ckë
 *
pkt
)

1946 
iwl_mvm_tx_ª•
 *
tx_ª•
 = (*)
pkt
->
d©a
;

1947 
agg_tx_°©us
 *
‰ame_°©us
 =

1948 
	`iwl_mvm_gë_agg_°©us
(
mvm
, 
tx_ª•
);

1949 
i
;

1950 
boﬁ
 
túggî_timïoöt
 = 
Ál£
;

1952 
i
 = 0; i < 
tx_ª•
->
‰ame_cou¡
; i++) {

1953 
u16
 
f°©us
 = 
	`À16_to_˝u
(
‰ame_°©us
[
i
].
°©us
);

1955 
túggî_timïoöt
 |((
f°©us
 & 
AGG_TX_STATE_STATUS_MSK
) !=

1956 
AGG_TX_STATE_TRANSMITTED
);

1957 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

1959 
	`iwl_gë_agg_tx_°©us
(
f°©us
),

1960 
f°©us
 & 
AGG_TX_STATE_STATUS_MSK
,

1961 (
f°©us
 & 
AGG_TX_STATE_TRY_CNT_MSK
) >>

1962 
AGG_TX_STATE_TRY_CNT_POS
,

1963 
	`À16_to_˝u
(
‰ame_°©us
[
i
].
£quí˚
));

1966 i‡(
túggî_timïoöt
)

1967 
	`iwl_dbg_év_time_poöt
(&
mvm
->
fwπ
,

1968 
IWL_FW_INI_TIME_POINT_TX_FAILED
, 
NULL
);

1970 
	}
}

1972 
	$iwl_mvm_rx_tx_cmd_agg_dbg
(
iwl_mvm
 *
mvm
,

1973 
iwl_rx_∑ckë
 *
pkt
)

1974 {
	}
}

1977 
	$iwl_mvm_rx_tx_cmd_agg
(
iwl_mvm
 *
mvm
,

1978 
iwl_rx_∑ckë
 *
pkt
)

1980 
iwl_mvm_tx_ª•
 *
tx_ª•
 = (*)
pkt
->
d©a
;

1981 
°a_id
 = 
	`IWL_MVM_TX_RES_GET_RA
(
tx_ª•
->
ø_tid
);

1982 
tid
 = 
	`IWL_MVM_TX_RES_GET_TID
(
tx_ª•
->
ø_tid
);

1983 
u16
 
£quí˚
 = 
	`À16_to_˝u
(
pkt
->
hdr
.sequence);

1984 
iwl_mvm_°a
 *
mvm°a
;

1985 
queue
 = 
	`SEQ_TO_QUEUE
(
£quí˚
);

1986 
õì80211_°a
 *
°a
;

1988 i‡(
	`WARN_ON_ONCE
(
queue
 < 
IWL_MVM_DQA_MIN_DATA_QUEUE
 &&

1989 (
queue
 !
IWL_MVM_DQA_BSS_CLIENT_QUEUE
)))

1992 
	`iwl_mvm_rx_tx_cmd_agg_dbg
(
mvm
, 
pkt
);

1994 
	`rcu_ªad_lock
();

1996 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_rcu
(
mvm
, 
°a_id
);

1998 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

1999 i‡(
	`WARN_ON_ONCE
(
	`IS_ERR_OR_NULL
(
°a
Ë|| !°a->
wme
)) {

2000 
	`rcu_ªad_u∆ock
();

2004 i‡(!
	`WARN_ON_ONCE
(!
mvm°a
)) {

2005 
mvm°a
->
tid_d©a
[
tid
].
øã_n_Êags
 =

2006 
	`À32_to_˝u
(
tx_ª•
->
öôül_øã
);

2007 
mvm°a
->
tid_d©a
[
tid
].
tx_time
 =

2008 
	`À16_to_˝u
(
tx_ª•
->
wúñess_medü_time
);

2009 
mvm°a
->
tid_d©a
[
tid
].
lq_cﬁ‹
 =

2010 
	`TX_RES_RATE_TABLE_COL_GET
(
tx_ª•
->
éc_öfo
);

2011 
	`iwl_mvm_tx_aútime
(
mvm
, 
mvm°a
,

2012 
	`À16_to_˝u
(
tx_ª•
->
wúñess_medü_time
));

2015 
	`rcu_ªad_u∆ock
();

2016 
	}
}

2018 
	$iwl_mvm_rx_tx_cmd
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

2020 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2021 
iwl_mvm_tx_ª•
 *
tx_ª•
 = (*)
pkt
->
d©a
;

2023 i‡(
tx_ª•
->
‰ame_cou¡
 == 1)

2024 
	`iwl_mvm_rx_tx_cmd_sögÀ
(
mvm
, 
pkt
);

2026 
	`iwl_mvm_rx_tx_cmd_agg
(
mvm
, 
pkt
);

2027 
	}
}

2029 
	$iwl_mvm_tx_ª˛aim
(
iwl_mvm
 *
mvm
, 
°a_id
, 
tid
,

2030 
txq
, 
ödex
,

2031 
õì80211_tx_öfo
 *
tx_öfo
, 
u32
 
øã
,

2032 
boﬁ
 
is_Êush
)

2034 
sk_buff_hód
 
ª˛aimed_skbs
;

2035 
iwl_mvm_tid_d©a
 *
tid_d©a
 = 
NULL
;

2036 
õì80211_°a
 *
°a
;

2037 
iwl_mvm_°a
 *
mvm°a
 = 
NULL
;

2038 
sk_buff
 *
skb
;

2039 
‰ìd
;

2041 i‡(
	`WARN_ONCE
(
°a_id
 >
mvm
->
fw
->
ucode_ˇ∑
.
num_°©i⁄s
 ||

2042 
tid
 > 
IWL_MAX_TID_COUNT
,

2043 "°a_id %dÅid %d", 
°a_id
, 
tid
))

2046 
	`rcu_ªad_lock
();

2048 
°a
 = 
	`rcu_dîe„ªn˚
(
mvm
->
fw_id_to_mac_id
[
°a_id
]);

2051 i‡(
	`WARN_ON_ONCE
(!
°a
)) {

2052 
	`rcu_ªad_u∆ock
();

2056 
	`__skb_queue_hód_öô
(&
ª˛aimed_skbs
);

2063 
	`iwl_å™s_ª˛aim
(
mvm
->
å™s
, 
txq
, 
ödex
, &
ª˛aimed_skbs
, 
is_Êush
);

2065 
	`skb_queue_wÆk
(&
ª˛aimed_skbs
, 
skb
) {

2066 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2068 
	`iwl_å™s_‰ì_tx_cmd
(
mvm
->
å™s
, 
öfo
->
drivî_d©a
[1]);

2070 
	`mem£t
(&
öfo
->
°©us
, 0, (info->status));

2075 i‡(!
is_Êush
)

2076 
öfo
->
Êags
 |
IEEE80211_TX_STAT_ACK
;

2078 
öfo
->
Êags
 &~
IEEE80211_TX_STAT_ACK
;

2089 i‡(
	`IS_ERR
(
°a
))

2090 
out
;

2092 
mvm°a
 = 
	`iwl_mvm_°a_‰om_mac80211
(
°a
);

2093 
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

2095 i‡(
tid_d©a
->
txq_id
 !
txq
) {

2096 
	`IWL_ERR
(
mvm
,

2098 
tid_d©a
->
txq_id
, 
tid
);

2099 
	`rcu_ªad_u∆ock
();

2103 
	`•ö_lock_bh
(&
mvm°a
->
lock
);

2105 
tid_d©a
->
√xt_ª˛aimed
 = 
ödex
;

2107 
	`iwl_mvm_check_øtid_em±y
(
mvm
, 
°a
, 
tid
);

2109 
‰ìd
 = 0;

2112 
tx_öfo
->
°©us
.
°©us_drivî_d©a
[0] =

2113 
	`RS_DRV_DATA_PACK
(
tid_d©a
->
lq_cﬁ‹
,

2114 
tx_öfo
->
°©us
.
°©us_drivî_d©a
[0]);

2115 
tx_öfo
->
°©us
.
°©us_drivî_d©a
[1] = (*)(
uöçå_t
)
øã
;

2117 
	`skb_queue_wÆk
(&
ª˛aimed_skbs
, 
skb
) {

2118 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

2119 
õì80211_tx_öfo
 *
öfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2121 i‡(!
is_Êush
) {

2122 i‡(
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
))

2123 
‰ìd
++;

2125 
	`WARN_ON_ONCE
(
tid
 !
IWL_MAX_TID_COUNT
);

2130 i‡(
‰ìd
 == 1) {

2131 
öfo
->
Êags
 |
IEEE80211_TX_STAT_AMPDU
;

2132 
	`mem˝y
(&
öfo
->
°©us
, &
tx_öfo
->status,

2133 (
tx_öfo
->
°©us
));

2134 
	`iwl_mvm_hwøã_to_tx_°©us
(
mvm
->
fw
, 
øã
, 
öfo
);

2138 
	`•ö_u∆ock_bh
(&
mvm°a
->
lock
);

2144 i‡(!
is_Êush
 && 
	`skb_queue_em±y
(&
ª˛aimed_skbs
) &&

2145 !
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)) {

2146 
õì80211_ch™˘x_c⁄f
 *
ch™˘x_c⁄f
 = 
NULL
;

2149 i‡(
mvm°a
->
vif
)

2150 
ch™˘x_c⁄f
 =

2151 
	`rcu_dîe„ªn˚
(
mvm°a
->
vif
->
bss_c⁄f
.
ch™˘x_c⁄f
);

2153 i‡(
	`WARN_ON_ONCE
(!
ch™˘x_c⁄f
))

2154 
out
;

2156 
tx_öfo
->
b™d
 = 
ch™˘x_c⁄f
->
def
.
ch™
->band;

2157 
	`iwl_mvm_hwøã_to_tx_°©us
(
mvm
->
fw
, 
øã
, 
tx_öfo
);

2159 
	`IWL_DEBUG_TX_REPLY
(
mvm
, "NoÑeclaim. UpdateÑs directly\n");

2160 
	`iwl_mvm_rs_tx_°©us
(
mvm
, 
°a
, 
tid
, 
tx_öfo
, 
Ál£
);

2163 
out
:

2164 
	`rcu_ªad_u∆ock
();

2166 !
	`skb_queue_em±y
(&
ª˛aimed_skbs
)) {

2167 
skb
 = 
	`__skb_dequeue
(&
ª˛aimed_skbs
);

2168 
	`õì80211_tx_°©us_skb
(
mvm
->
hw
, 
skb
);

2170 
	}
}

2172 
	$iwl_mvm_rx_ba_nŸif
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

2174 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

2175 
pkt_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

2176 
°a_id
, 
tid
, 
txq
, 
ödex
;

2177 
õì80211_tx_öfo
 
ba_öfo
 = {};

2178 
iwl_mvm_ba_nŸif
 *
ba_nŸif
;

2179 
iwl_mvm_tid_d©a
 *
tid_d©a
;

2180 
iwl_mvm_°a
 *
mvm°a
;

2182 
ba_öfo
.
Êags
 = 
IEEE80211_TX_STAT_AMPDU
;

2184 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
)) {

2185 
iwl_mvm_com¥es£d_ba_nŸif
 *
ba_ªs
 =

2186 (*)
pkt
->
d©a
;

2187 
u8
 
lq_cﬁ‹
 = 
	`TX_RES_RATE_TABLE_COL_GET
(
ba_ªs
->
éc_øã_öfo
);

2188 
u16
 
tfd_˙t
;

2189 
i
;

2191 i‡(
	`IWL_FW_CHECK
(
mvm
, (*
ba_ªs
Ë> 
pkt_Àn
,

2192 "sh‹àBAÇŸifiˇti⁄ (%d)\n", 
pkt_Àn
))

2195 
°a_id
 = 
ba_ªs
->sta_id;

2196 
ba_öfo
.
°©us
.
ampdu_ack_Àn
 = (
u8
)
	`À16_to_˝u
(
ba_ªs
->
d⁄e
);

2197 
ba_öfo
.
°©us
.
ampdu_Àn
 = (
u8
)
	`À16_to_˝u
(
ba_ªs
->
txed
);

2198 
ba_öfo
.
°©us
.
tx_time
 =

2199 (
u16
)
	`À32_to_˝u
(
ba_ªs
->
wúñess_time
);

2200 
ba_öfo
.
°©us
.
°©us_drivî_d©a
[0] =

2201 (*)(
uöçå_t
)
ba_ªs
->
ªdu˚d_txp
;

2203 
tfd_˙t
 = 
	`À16_to_˝u
(
ba_ªs
->tfd_cnt);

2204 i‡(!
tfd_˙t
)

2207 i‡(
	`IWL_FW_CHECK
(
mvm
,

2208 
	`°ru˘_size
(
ba_ªs
, 
tfd
, 
tfd_˙t
Ë> 
pkt_Àn
,

2210 
tfd_˙t
, 
pkt_Àn
))

2213 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

2215 
°a_id
, 
	`À32_to_˝u
(
ba_ªs
->
Êags
),

2216 
	`À16_to_˝u
(
ba_ªs
->
txed
),

2217 
	`À16_to_˝u
(
ba_ªs
->
d⁄e
));

2219 
	`rcu_ªad_lock
();

2221 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_rcu
(
mvm
, 
°a_id
);

2232 
i
 = 0; i < 
tfd_˙t
; i++) {

2233 
iwl_mvm_com¥es£d_ba_tfd
 *
ba_tfd
 =

2234 &
ba_ªs
->
tfd
[
i
];

2236 
tid
 = 
ba_tfd
->tid;

2237 i‡(
tid
 =
IWL_MGMT_TID
)

2238 
tid
 = 
IWL_MAX_TID_COUNT
;

2240 i‡(
mvm°a
)

2241 
mvm°a
->
tid_d©a
[
i
].
lq_cﬁ‹
 =Üq_color;

2243 
	`iwl_mvm_tx_ª˛aim
(
mvm
, 
°a_id
, 
tid
,

2244 ()(
	`À16_to_˝u
(
ba_tfd
->
q_num
)),

2245 
	`À16_to_˝u
(
ba_tfd
->
tfd_ödex
),

2246 &
ba_öfo
,

2247 
	`À32_to_˝u
(
ba_ªs
->
tx_øã
), 
Ál£
);

2250 i‡(
mvm°a
)

2251 
	`iwl_mvm_tx_aútime
(
mvm
, 
mvm°a
,

2252 
	`À32_to_˝u
(
ba_ªs
->
wúñess_time
));

2253 
	`rcu_ªad_u∆ock
();

2257 
ba_nŸif
 = (*)
pkt
->
d©a
;

2258 
°a_id
 = 
ba_nŸif
->sta_id;

2259 
tid
 = 
ba_nŸif
->tid;

2261 
txq
 = 
	`À16_to_˝u
(
ba_nŸif
->
scd_Êow
);

2264 
ödex
 = 
	`À16_to_˝u
(
ba_nŸif
->
scd_s¢
);

2266 
	`rcu_ªad_lock
();

2267 
mvm°a
 = 
	`iwl_mvm_°a_‰om_°aid_rcu
(
mvm
, 
°a_id
);

2268 i‡(
	`IWL_FW_CHECK
(
mvm
, !
mvm°a
,

2270 
°a_id
)) {

2271 
	`rcu_ªad_u∆ock
();

2275 
tid_d©a
 = &
mvm°a
->tid_d©a[
tid
];

2277 
ba_öfo
.
°©us
.
ampdu_ack_Àn
 = 
ba_nŸif
->
txed_2_d⁄e
;

2278 
ba_öfo
.
°©us
.
ampdu_Àn
 = 
ba_nŸif
->
txed
;

2279 
ba_öfo
.
°©us
.
tx_time
 = 
tid_d©a
->tx_time;

2280 
ba_öfo
.
°©us
.
°©us_drivî_d©a
[0] =

2281 (*)(
uöçå_t
)
ba_nŸif
->
ªdu˚d_txp
;

2283 
	`rcu_ªad_u∆ock
();

2285 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

2287 
ba_nŸif
->
°a_addr
, ba_nŸif->
°a_id
);

2289 
	`IWL_DEBUG_TX_REPLY
(
mvm
,

2291 
ba_nŸif
->
tid
, 
	`À16_to_˝u
(ba_nŸif->
£q_˘l
),

2292 
	`À64_to_˝u
(
ba_nŸif
->
bôm≠
), 
txq
, 
ödex
,

2293 
ba_nŸif
->
txed
, ba_nŸif->
txed_2_d⁄e
);

2295 
	`IWL_DEBUG_TX_REPLY
(
mvm
, "reducedÅxp from baÇotif %d\n",

2296 
ba_nŸif
->
ªdu˚d_txp
);

2298 
	`iwl_mvm_tx_ª˛aim
(
mvm
, 
°a_id
, 
tid
, 
txq
, 
ödex
, &
ba_öfo
,

2299 
tid_d©a
->
øã_n_Êags
, 
Ál£
);

2300 
	}
}

2310 
	$iwl_mvm_Êush_tx_∑th
(
iwl_mvm
 *
mvm
, 
u32
 
tfd_msk
)

2312 
ªt
;

2313 
iwl_tx_∑th_Êush_cmd_v1
 
Êush_cmd
 = {

2314 .
queues_˘l
 = 
	`˝u_to_À32
(
tfd_msk
),

2315 .
Êush_˘l
 = 
	`˝u_to_À16
(
DUMP_TX_FIFO_FLUSH
),

2318 
	`WARN_ON
(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
));

2319 
ªt
 = 
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
TXPATH_FLUSH
, 0,

2320 (
Êush_cmd
), &flush_cmd);

2321 i‡(
ªt
)

2322 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd flush comm™d (%d)\n", 
ªt
);

2323  
ªt
;

2324 
	}
}

2326 
	$iwl_mvm_Êush_°a_tids
(
iwl_mvm
 *
mvm
, 
u32
 
°a_id
, 
u16
 
tids
)

2328 
ªt
;

2329 
iwl_tx_∑th_Êush_cmd_r•
 *
r•
;

2330 
iwl_tx_∑th_Êush_cmd
 
Êush_cmd
 = {

2331 .
°a_id
 = 
	`˝u_to_À32
(sta_id),

2332 .
tid_mask
 = 
	`˝u_to_À16
(
tids
),

2335 
iwl_ho°_cmd
 
cmd
 = {

2336 .
id
 = 
TXPATH_FLUSH
,

2337 .
Àn
 = { (
Êush_cmd
), },

2338 .
d©a
 = { &
Êush_cmd
, },

2341 
	`WARN_ON
(!
	`iwl_mvm_has_√w_tx_≠i
(
mvm
));

2343 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LONG_GROUP
, 
TXPATH_FLUSH
, 0) > 0)

2344 
cmd
.
Êags
 |
CMD_WANT_SKB
 | 
CMD_SEND_IN_RFKILL
;

2346 
	`IWL_DEBUG_TX_QUEUES
(
mvm
, "flush for sta id %dÅid mask 0x%x\n",

2347 
°a_id
, 
tids
);

2349 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

2351 i‡(
ªt
) {

2352 
	`IWL_ERR
(
mvm
, "FaûedÅÿ£nd flush comm™d (%d)\n", 
ªt
);

2353  
ªt
;

2356 i‡(
cmd
.
Êags
 & 
CMD_WANT_SKB
) {

2357 
i
;

2358 
num_Êushed_queues
;

2360 i‡(
	`WARN_ON_ONCE
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
cmd
.
ª•_pkt
Ë!(*
r•
))) {

2361 
ªt
 = -
EIO
;

2362 
‰ì_r•
;

2365 
r•
 = (*)
cmd
.
ª•_pkt
->
d©a
;

2367 i‡(
	`WARN_ONCE
(
	`À16_to_˝u
(
r•
->
°a_id
) != sta_id,

2369 
°a_id
, 
	`À16_to_˝u
(
r•
->sta_id))) {

2370 
ªt
 = -
EIO
;

2371 
‰ì_r•
;

2374 
num_Êushed_queues
 = 
	`À16_to_˝u
(
r•
->num_flushed_queues);

2375 i‡(
	`WARN_ONCE
(
num_Êushed_queues
 > 
IWL_TX_FLUSH_QUEUE_RSP
,

2376 "num_Êushed_queue†%d", 
num_Êushed_queues
)) {

2377 
ªt
 = -
EIO
;

2378 
‰ì_r•
;

2381 
i
 = 0; i < 
num_Êushed_queues
; i++) {

2382 
õì80211_tx_öfo
 
tx_öfo
 = {};

2383 
iwl_Êush_queue_öfo
 *
queue_öfo
 = &
r•
->
queues
[
i
];

2384 
tid
 = 
	`À16_to_˝u
(
queue_öfo
->tid);

2385 
ªad_bef‹e
 = 
	`À16_to_˝u
(
queue_öfo
->
ªad_bef‹e_Êush
);

2386 
ªad_a·î
 = 
	`À16_to_˝u
(
queue_öfo
->
ªad_a·î_Êush
);

2387 
queue_num
 = 
	`À16_to_˝u
(
queue_öfo
->queue_num);

2389 i‡(
tid
 =
IWL_MGMT_TID
)

2390 
tid
 = 
IWL_MAX_TID_COUNT
;

2392 
	`IWL_DEBUG_TX_QUEUES
(
mvm
,

2394 
tid
, 
queue_num
, 
ªad_bef‹e
, 
ªad_a·î
);

2396 
	`iwl_mvm_tx_ª˛aim
(
mvm
, 
°a_id
, 
tid
, 
queue_num
, 
ªad_a·î
,

2397 &
tx_öfo
, 0, 
åue
);

2399 
‰ì_r•
:

2400 
	`iwl_‰ì_ª•
(&
cmd
);

2402  
ªt
;

2403 
	}
}

2405 
	$iwl_mvm_Êush_°a
(
iwl_mvm
 *
mvm
, 
u32
 
°a_id
, u32 
tfd_queue_mask
)

2407 i‡(
	`iwl_mvm_has_√w_tx_≠i
(
mvm
))

2408  
	`iwl_mvm_Êush_°a_tids
(
mvm
, 
°a_id
, 0xffff);

2410  
	`iwl_mvm_Êush_tx_∑th
(
mvm
, 
tfd_queue_mask
);

2411 
	}
}

	@mvm/utils.c

7 
	~<√t/mac80211.h
>

9 
	~"iwl-debug.h
"

10 
	~"iwl-io.h
"

11 
	~"iwl-¥ph.h
"

12 
	~"iwl-c§.h
"

13 
	~"mvm.h
"

14 
	~"fw/≠i/rs.h
"

15 
	~"fw/img.h
"

21 
	$iwl_mvm_£nd_cmd
(
iwl_mvm
 *
mvm
, 
iwl_ho°_cmd
 *
cmd
)

23 
ªt
;

25 #i‡
	`deföed
(
CONFIG_IWLWIFI_DEBUGFS
Ë&& deföed(
CONFIG_PM_SLEEP
)

26 i‡(
	`WARN_ON
(
mvm
->
d3_ã°_a˘ive
))

27  -
EIO
;

35 i‡(!(
cmd
->
Êags
 & 
CMD_ASYNC
))

36 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

38 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
mvm
->
å™s
, 
cmd
);

45 i‡(
cmd
->
Êags
 & 
CMD_WANT_SKB
)

46  
ªt
;

52 i‡(!
ªt
 ||Ñë =-
ERFKILL
 ||Ñë =-
EHOSTDOWN
)

54  
ªt
;

55 
	}
}

57 
	$iwl_mvm_£nd_cmd_pdu
(
iwl_mvm
 *
mvm
, 
u32
 
id
,

58 
u32
 
Êags
, 
u16
 
Àn
, c⁄° *
d©a
)

60 
iwl_ho°_cmd
 
cmd
 = {

61 .
id
 = id,

62 .
Àn
 = {Üen, },

63 .
d©a
 = { data, },

64 .
Êags
 = flags,

67  
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

68 
	}
}

73 
	$iwl_mvm_£nd_cmd_°©us
(
iwl_mvm
 *
mvm
, 
iwl_ho°_cmd
 *
cmd
,

74 
u32
 *
°©us
)

76 
iwl_rx_∑ckë
 *
pkt
;

77 
iwl_cmd_ª•⁄£
 *
ª•
;

78 
ªt
, 
ª•_Àn
;

80 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

82 #i‡
	`deföed
(
CONFIG_IWLWIFI_DEBUGFS
Ë&& deföed(
CONFIG_PM_SLEEP
)

83 i‡(
	`WARN_ON
(
mvm
->
d3_ã°_a˘ive
))

84  -
EIO
;

91 i‡(
	`WARN_ONCE
(
cmd
->
Êags
 & (
CMD_ASYNC
 | 
CMD_WANT_SKB
),

92 "cmd fœg†%x", 
cmd
->
Êags
))

93  -
EINVAL
;

95 
cmd
->
Êags
 |
CMD_WANT_SKB
;

97 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
mvm
->
å™s
, 
cmd
);

98 i‡(
ªt
 =-
ERFKILL
) {

104 } i‡(
ªt
) {

105  
ªt
;

108 
pkt
 = 
cmd
->
ª•_pkt
;

110 
ª•_Àn
 = 
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
pkt
);

111 i‡(
	`WARN_ON_ONCE
(
ª•_Àn
 !(*
ª•
))) {

112 
ªt
 = -
EIO
;

113 
out_‰ì_ª•
;

116 
ª•
 = (*)
pkt
->
d©a
;

117 *
°©us
 = 
	`À32_to_˝u
(
ª•
->status);

118 
out_‰ì_ª•
:

119 
	`iwl_‰ì_ª•
(
cmd
);

120  
ªt
;

121 
	}
}

126 
	$iwl_mvm_£nd_cmd_pdu_°©us
(
iwl_mvm
 *
mvm
, 
u32
 
id
, 
u16
 
Àn
,

127 c⁄° *
d©a
, 
u32
 *
°©us
)

129 
iwl_ho°_cmd
 
cmd
 = {

130 .
id
 = id,

131 .
Àn
 = {Üen, },

132 .
d©a
 = { data, },

135  
	`iwl_mvm_£nd_cmd_°©us
(
mvm
, &
cmd
, 
°©us
);

136 
	}
}

138 
	$iwl_mvm_Àgacy_hw_idx_to_mac80211_idx
(
u32
 
øã_n_Êags
,

139 
∆80211_b™d
 
b™d
)

141 
f‹m©
 = 
øã_n_Êags
 & 
RATE_MCS_MOD_TYPE_MSK
;

142 
øã
 = 
øã_n_Êags
 & 
RATE_LEGACY_RATE_MSK
;

143 
boﬁ
 
is_LB
 = 
b™d
 =
NL80211_BAND_2GHZ
;

145 i‡(
f‹m©
 =
RATE_MCS_LEGACY_OFDM_MSK
)

146  
is_LB
 ? 
øã
 + 
IWL_FIRST_OFDM_RATE
 :

147 
øã
;

150  
is_LB
 ? 
øã
 : -1;

151 
	}
}

153 
	$iwl_mvm_Àgacy_øã_to_mac80211_idx
(
u32
 
øã_n_Êags
,

154 
∆80211_b™d
 
b™d
)

156 
øã
 = 
øã_n_Êags
 & 
RATE_LEGACY_RATE_MSK_V1
;

157 
idx
;

158 
b™d_off£t
 = 0;

161 i‡(
b™d
 !
NL80211_BAND_2GHZ
)

162 
b™d_off£t
 = 
IWL_FIRST_OFDM_RATE
;

163 
idx
 = 
b™d_off£t
; idx < 
IWL_RATE_COUNT_LEGACY
; idx++)

164 i‡(
	`iwl_fw_øã_idx_to_∂˝
(
idx
Ë=
øã
)

165  
idx
 - 
b™d_off£t
;

168 
	}
}

170 
u8
 
	$iwl_mvm_mac80211_idx_to_hwøã
(c⁄° 
iwl_fw
 *
fw
, 
øã_idx
)

172 i‡(
	`iwl_fw_lookup_cmd_vî
(
fw
, 
TX_CMD
, 0) > 8)

176  (
øã_idx
 >
IWL_FIRST_OFDM_RATE
 ?

177 
øã_idx
 - 
IWL_FIRST_OFDM_RATE
 :

178 
øã_idx
);

180  
	`iwl_fw_øã_idx_to_∂˝
(
øã_idx
);

181 
	}
}

183 
u8
 
	$iwl_mvm_mac80211_ac_to_ucode_ac
(
õì80211_ac_numbîs
 
ac
)

185 c⁄° 
u8
 
mac80211_ac_to_ucode_ac
[] = {

186 
AC_VO
,

187 
AC_VI
,

188 
AC_BE
,

189 
AC_BK


192  
mac80211_ac_to_ucode_ac
[
ac
];

193 
	}
}

195 
	$iwl_mvm_rx_fw_îr‹
(
iwl_mvm
 *
mvm
, 
iwl_rx_cmd_buf„r
 *
rxb
)

197 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

198 
iwl_îr‹_ª•
 *
îr_ª•
 = (*)
pkt
->
d©a
;

200 
	`IWL_ERR
(
mvm
, "FW ErrorÇotification:Åype 0x%08X cmd_id 0x%02X\n",

201 
	`À32_to_˝u
(
îr_ª•
->
îr‹_ty≥
),Éº_ª•->
cmd_id
);

202 
	`IWL_ERR
(
mvm
, "FW ErrorÇotification: seq 0x%04X service 0x%08X\n",

203 
	`À16_to_˝u
(
îr_ª•
->
bad_cmd_£q_num
),

204 
	`À32_to_˝u
(
îr_ª•
->
îr‹_£rvi˚
));

205 
	`IWL_ERR
(
mvm
, "FW ErrorÇotification:Åimestamp 0x%016llX\n",

206 
	`À64_to_˝u
(
îr_ª•
->
time°amp
));

207 
	}
}

213 
u8
 
	$fú°_™ã¬a
(
u8
 
mask
)

215 
	`BUILD_BUG_ON
(
ANT_A
 !
	`BIT
(0));

216 i‡(
	`WARN_ON_ONCE
(!
mask
))

217  
	`BIT
(0);

218  
	`BIT
(
	`ffs
(
mask
) - 1);

219 
	}
}

221 
	#MAX_ANT_NUM
 2

	)

228 
u8
 
	$iwl_mvm_√xt_™ã¬a
(
iwl_mvm
 *
mvm
, 
u8
 
vÆid
, u8 
œ°_idx
)

230 
u8
 
öd
 = 
œ°_idx
;

231 
i
;

233 
i
 = 0; i < 
MAX_ANT_NUM
; i++) {

234 
öd
 = (öd + 1Ë% 
MAX_ANT_NUM
;

235 i‡(
vÆid
 & 
	`BIT
(
öd
))

236  
öd
;

239 
	`WARN_ONCE
(1, "FaûedÅÿtoggÀ bëwì¿™ã¬a†0x%x", 
vÆid
);

240  
œ°_idx
;

241 
	}
}

255 
	$iwl_mvm_£nd_lq_cmd
(
iwl_mvm
 *
mvm
, 
iwl_lq_cmd
 *
lq
)

257 
iwl_ho°_cmd
 
cmd
 = {

258 .
id
 = 
LQ_CMD
,

259 .
Àn
 = { (
iwl_lq_cmd
), },

260 .
Êags
 = 
CMD_ASYNC
,

261 .
d©a
 = { 
lq
, },

264 i‡(
	`WARN_ON
(
lq
->
°a_id
 =
IWL_MVM_INVALID_STA
 ||

265 
	`iwl_mvm_has_éc_ofÊﬂd
(
mvm
)))

266  -
EINVAL
;

268  
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

269 
	}
}

282 
	$iwl_mvm_upd©e_smps
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

283 
iwl_mvm_smps_ty≥_ªque°
 
ªq_ty≥
,

284 
õì80211_smps_mode
 
smps_ªque°
,

285 
lök_id
)

287 
iwl_mvm_vif
 *
mvmvif
;

288 
õì80211_smps_mode
 
smps_mode
 = 
IEEE80211_SMPS_AUTOMATIC
;

289 
i
;

291 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

294 i‡(
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
)) == 1)

297 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

300 
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

302 i‡(
	`WARN_ON_ONCE
(!
mvmvif
->
lök
[
lök_id
]))

305 
mvmvif
->
lök
[
lök_id
]->
smps_ªque°s
[
ªq_ty≥
] = 
smps_ªque°
;

306 
i
 = 0; i < 
NUM_IWL_MVM_SMPS_REQ
; i++) {

307 i‡(
mvmvif
->
lök
[
lök_id
]->
smps_ªque°s
[
i
] ==

308 
IEEE80211_SMPS_STATIC
) {

309 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

312 i‡(
mvmvif
->
lök
[
lök_id
]->
smps_ªque°s
[
i
] ==

313 
IEEE80211_SMPS_DYNAMIC
)

314 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

318 i‡(
mvmvif
->
e§_a˘ive
)

319 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

321 
	`õì80211_ªque°_smps
(
vif
, 
lök_id
, 
smps_mode
);

322 
	}
}

324 
	$iwl_mvm_upd©e_smps_⁄_a˘ive_löks
(
iwl_mvm
 *
mvm
,

325 
õì80211_vif
 *
vif
,

326 
iwl_mvm_smps_ty≥_ªque°
 
ªq_ty≥
,

327 
õì80211_smps_mode
 
smps_ªque°
)

329 
õì80211_bss_c⁄f
 *
lök_c⁄f
;

330 
lök_id
;

332 
	`rcu_ªad_lock
();

333 
	`f‹_óch_vif_a˘ive_lök
(
vif
, 
lök_c⁄f
, 
lök_id
)

334 
	`iwl_mvm_upd©e_smps
(
mvm
, 
vif
, 
ªq_ty≥
, 
smps_ªque°
,

335 
lök_id
);

336 
	`rcu_ªad_u∆ock
();

337 
	}
}

339 
boﬁ
 
	$iwl_waô_°©s_com∂ëe
(
iwl_nŸif_waô_d©a
 *
nŸif_waô
,

340 
iwl_rx_∑ckë
 *
pkt
, *
d©a
)

342 
	`WARN_ON
(
pkt
->
hdr
.
cmd
 !
STATISTICS_NOTIFICATION
);

344  
åue
;

345 
	}
}

347 
	$iwl_mvm_ªque°_sy°em_°©i°ics
(
iwl_mvm
 *
mvm
, 
boﬁ
 
˛ór
,

348 
u8
 
cmd_vî
)

350 
iwl_sy°em_°©i°ics_cmd
 
sy°em_cmd
 = {

351 .
cfg_mask
 = 
˛ór
 ?

352 
	`˝u_to_À32
(
IWL_STATS_CFG_FLG_ON_DEMAND_NTFY_MSK
) :

353 
	`˝u_to_À32
(
IWL_STATS_CFG_FLG_RESET_MSK
 |

354 
IWL_STATS_CFG_FLG_ON_DEMAND_NTFY_MSK
),

355 .
ty≥_id_mask
 = 
	`˝u_to_À32
(
IWL_STATS_NTFY_TYPE_ID_OPER
 |

356 
IWL_STATS_NTFY_TYPE_ID_OPER_PART1
),

358 
iwl_ho°_cmd
 
cmd
 = {

359 .
id
 = 
	`WIDE_ID
(
SYSTEM_GROUP
, 
SYSTEM_STATISTICS_CMD
),

360 .
Àn
[0] = (
sy°em_cmd
),

361 .
d©a
[0] = &
sy°em_cmd
,

363 
iwl_nŸifiˇti⁄_waô
 
°©s_waô
;

364 c⁄° 
u16
 
°©s_com∂ëe
[] = {

365 
	`WIDE_ID
(
SYSTEM_GROUP
, 
SYSTEM_STATISTICS_END_NOTIF
),

367 
ªt
;

369 i‡(
cmd_vî
 != 1) {

370 
	`IWL_FW_CHECK_FAILED
(
mvm
,

372 
cmd_vî
);

373  -
EOPNOTSUPP
;

376 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
°©s_waô
,

377 
°©s_com∂ëe
, 
	`ARRAY_SIZE
(stats_complete),

378 
NULL
, NULL);

380 
mvm
->
°©i°ics_˛ór
 = 
˛ór
;

381 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

382 i‡(
ªt
) {

383 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
°©s_waô
);

384  
ªt
;

391 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
°©s_waô
, 
HZ
 / 2);

392 i‡(
ªt
)

393  
ªt
;

395 i‡(
˛ór
)

396 
	`iwl_mvm_accu_ødio_°©s
(
mvm
);

398  
ªt
;

399 
	}
}

401 
	$iwl_mvm_ªque°_°©i°ics
(
iwl_mvm
 *
mvm
, 
boﬁ
 
˛ór
)

403 
iwl_°©i°ics_cmd
 
scmd
 = {

404 .
Êags
 = 
˛ór
 ? 
	`˝u_to_À32
(
IWL_STATISTICS_FLG_CLEAR
) : 0,

407 
iwl_ho°_cmd
 
cmd
 = {

408 .
id
 = 
STATISTICS_CMD
,

409 .
Àn
[0] = (
scmd
),

410 .
d©a
[0] = &
scmd
,

412 
u8
 
cmd_vî
 = 
	`iwl_fw_lookup_cmd_vî
(
mvm
->
fw
,

413 
	`WIDE_ID
(
SYSTEM_GROUP
,

414 
SYSTEM_STATISTICS_CMD
),

415 
IWL_FW_CMD_VER_UNKNOWN
);

416 
ªt
;

418 i‡(
cmd_vî
 !
IWL_FW_CMD_VER_UNKNOWN
)

419  
	`iwl_mvm_ªque°_sy°em_°©i°ics
(
mvm
, 
˛ór
, 
cmd_vî
);

425 i‡(
	`iwl_fw_lookup_nŸif_vî
(
mvm
->
fw
, 
LEGACY_GROUP
,

426 
STATISTICS_NOTIFICATION
, 0) < 15) {

427 
cmd
.
Êags
 = 
CMD_WANT_SKB
;

429 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

430 i‡(
ªt
)

431  
ªt
;

433 
	`iwl_mvm_h™dÀ_rx_°©i°ics
(
mvm
, 
cmd
.
ª•_pkt
);

434 
	`iwl_‰ì_ª•
(&
cmd
);

436 
iwl_nŸifiˇti⁄_waô
 
°©s_waô
;

437 c⁄° 
u16
 
°©s_com∂ëe
[] = {

438 
STATISTICS_NOTIFICATION
,

441 
	`iwl_öô_nŸifiˇti⁄_waô
(&
mvm
->
nŸif_waô
, &
°©s_waô
,

442 
°©s_com∂ëe
, 
	`ARRAY_SIZE
(stats_complete),

443 
iwl_waô_°©s_com∂ëe
, 
NULL
);

445 
ªt
 = 
	`iwl_mvm_£nd_cmd
(
mvm
, &
cmd
);

446 i‡(
ªt
) {

447 
	`iwl_ªmove_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
°©s_waô
);

448  
ªt
;

454 
ªt
 = 
	`iwl_waô_nŸifiˇti⁄
(&
mvm
->
nŸif_waô
, &
°©s_waô
, 
HZ
 / 5);

455 i‡(
ªt
)

456  
ªt
;

459 i‡(
˛ór
)

460 
	`iwl_mvm_accu_ødio_°©s
(
mvm
);

463 
	}
}

465 
	$iwl_mvm_accu_ødio_°©s
(
iwl_mvm
 *
mvm
)

467 
mvm
->
accu_ødio_°©s
.
rx_time
 +mvm->
ødio_°©s
.rx_time;

468 
mvm
->
accu_ødio_°©s
.
tx_time
 +mvm->
ødio_°©s
.tx_time;

469 
mvm
->
accu_ødio_°©s
.
⁄_time_rf
 +mvm->
ødio_°©s
.on_time_rf;

470 
mvm
->
accu_ødio_°©s
.
⁄_time_sˇn
 +mvm->
ødio_°©s
.on_time_scan;

471 
	}
}

473 
	siwl_mvm_divîsôy_ôî_d©a
 {

474 
iwl_mvm_phy_˘xt
 *
	m˘xt
;

475 
boﬁ
 
	mªsu…
;

478 
	$iwl_mvm_divîsôy_ôî
(*
_d©a
, 
u8
 *
mac
,

479 
õì80211_vif
 *
vif
)

481 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

482 
iwl_mvm_divîsôy_ôî_d©a
 *
d©a
 = 
_d©a
;

483 
i
, 
lök_id
;

485 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
lök_id
) {

486 
iwl_mvm_vif_lök_öfo
 *
lök_öfo
 = 
mvmvif
->
lök
[
lök_id
];

488 i‡(
lök_öfo
->
phy_˘xt
 !
d©a
->
˘xt
)

491 
i
 = 0; i < 
NUM_IWL_MVM_SMPS_REQ
; i++) {

492 i‡(
lök_öfo
->
smps_ªque°s
[
i
] =
IEEE80211_SMPS_STATIC
 ||

493 
lök_öfo
->
smps_ªque°s
[
i
] =
IEEE80211_SMPS_DYNAMIC
) {

494 
d©a
->
ªsu…
 = 
Ál£
;

499 
	}
}

501 
boﬁ
 
	$iwl_mvm_rx_divîsôy_Ælowed
(
iwl_mvm
 *
mvm
,

502 
iwl_mvm_phy_˘xt
 *
˘xt
)

504 
iwl_mvm_divîsôy_ôî_d©a
 
d©a
 = {

505 .
˘xt
 = ctxt,

506 .
ªsu…
 = 
åue
,

509 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

511 i‡(
iwlmvm_mod_∑øms
.
powî_scheme
 !
IWL_POWER_SCHEME_CAM
)

512  
Ál£
;

514 i‡(
	`num_of_™t
(
	`iwl_mvm_gë_vÆid_rx_™t
(
mvm
)) == 1)

515  
Ál£
;

517 i‡(
mvm
->
cfg
->
rx_wôh_siso_divîsôy
)

518  
Ál£
;

520 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

521 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

522 
iwl_mvm_divîsôy_ôî
, &
d©a
);

524  
d©a
.
ªsu…
;

525 
	}
}

527 
	$iwl_mvm_£nd_low_œãncy_cmd
(
iwl_mvm
 *
mvm
,

528 
boﬁ
 
low_œãncy
, 
u16
 
mac_id
)

530 
iwl_mac_low_œãncy_cmd
 
cmd
 = {

531 .
mac_id
 = 
	`˝u_to_À32
(mac_id)

534 i‡(!
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

535 
IWL_UCODE_TLV_CAPA_DYNAMIC_QUOTA
))

538 i‡(
low_œãncy
) {

540 
cmd
.
low_œãncy_rx
 = 1;

541 
cmd
.
low_œãncy_tx
 = 1;

544 i‡(
	`iwl_mvm_£nd_cmd_pdu
(
mvm
, 
	`WIDE_ID
(
MAC_CONF_GROUP
, 
LOW_LATENCY_CMD
),

545 0, (
cmd
), &cmd))

546 
	`IWL_ERR
(
mvm
, "FailedÅo sendÜowÜatency command\n");

547 
	}
}

549 
	$iwl_mvm_upd©e_low_œãncy
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

550 
boﬁ
 
low_œãncy
,

551 
iwl_mvm_low_œãncy_ˇu£
 
ˇu£
)

553 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

554 
ªs
;

555 
boﬁ
 
¥ev
;

557 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

559 
¥ev
 = 
	`iwl_mvm_vif_low_œãncy
(
mvmvif
);

560 
	`iwl_mvm_vif_£t_low_œãncy
(
mvmvif
, 
low_œãncy
, 
ˇu£
);

562 
low_œãncy
 = 
	`iwl_mvm_vif_low_œãncy
(
mvmvif
);

564 i‡(
low_œãncy
 =
¥ev
)

567 
	`iwl_mvm_£nd_low_œãncy_cmd
(
mvm
, 
low_œãncy
, 
mvmvif
->
id
);

569 
ªs
 = 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

570 i‡(
ªs
)

571  
ªs
;

573 
	`iwl_mvm_bt_c€x_vif_ch™ge
(
mvm
);

575  
	`iwl_mvm_powî_upd©e_mac
(
mvm
);

576 
	}
}

578 
	siwl_mvm_low_œãncy_ôî
 {

579 
boﬁ
 
	mªsu…
;

580 
boﬁ
 
	mªsu…_≥r_b™d
[
NUM_NL80211_BANDS
];

583 
	$iwl_mvm_Œ_ôî
(*
_d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

585 
iwl_mvm_low_œãncy_ôî
 *
ªsu…
 = 
_d©a
;

586 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

587 
∆80211_b™d
 
b™d
;

589 i‡(
	`iwl_mvm_vif_low_œãncy
(
mvmvif
)) {

590 
ªsu…
->ªsu… = 
åue
;

592 i‡(!
mvmvif
->
deÊök
.
phy_˘xt
)

595 
b™d
 = 
mvmvif
->
deÊök
.
phy_˘xt
->
ch™√l
->band;

596 
ªsu…
->
ªsu…_≥r_b™d
[
b™d
] = 
åue
;

598 
	}
}

600 
boﬁ
 
	$iwl_mvm_low_œãncy
(
iwl_mvm
 *
mvm
)

602 
iwl_mvm_low_œãncy_ôî
 
d©a
 = {};

604 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

605 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

606 
iwl_mvm_Œ_ôî
, &
d©a
);

608  
d©a
.
ªsu…
;

609 
	}
}

611 
boﬁ
 
	$iwl_mvm_low_œãncy_b™d
(
iwl_mvm
 *
mvm
, 
∆80211_b™d
 
b™d
)

613 
iwl_mvm_low_œãncy_ôî
 
d©a
 = {};

615 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

616 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

617 
iwl_mvm_Œ_ôî
, &
d©a
);

619  
d©a
.
ªsu…_≥r_b™d
[
b™d
];

620 
	}
}

622 
	siwl_bss_ôî_d©a
 {

623 
õì80211_vif
 *
	mvif
;

624 
boﬁ
 
	mîr‹
;

627 
	$iwl_mvm_bss_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

628 
õì80211_vif
 *
vif
)

630 
iwl_bss_ôî_d©a
 *
d©a
 = 
_d©a
;

632 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
 || vif->
p2p
)

635 i‡(
d©a
->
vif
) {

636 
d©a
->
îr‹
 = 
åue
;

640 
d©a
->
vif
 = vif;

641 
	}
}

643 
õì80211_vif
 *
	$iwl_mvm_gë_bss_vif
(
iwl_mvm
 *
mvm
)

645 
iwl_bss_ôî_d©a
 
bss_ôî_d©a
 = {};

647 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

648 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

649 
iwl_mvm_bss_iÁ˚_ôî©‹
, &
bss_ôî_d©a
);

651 i‡(
bss_ôî_d©a
.
îr‹
) {

652 
	`IWL_ERR
(
mvm
, "MoreÅhan one managed interfaceáctive!\n");

653  
	`ERR_PTR
(-
EINVAL
);

656  
bss_ôî_d©a
.
vif
;

657 
	}
}

659 
	siwl_bss_föd_ôî_d©a
 {

660 
õì80211_vif
 *
	mvif
;

661 
u32
 
	mmacid
;

664 
	$iwl_mvm_bss_föd_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

665 
õì80211_vif
 *
vif
)

667 
iwl_bss_föd_ôî_d©a
 *
d©a
 = 
_d©a
;

668 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

670 i‡(
mvmvif
->
id
 =
d©a
->
macid
)

671 
d©a
->
vif
 = vif;

672 
	}
}

674 
õì80211_vif
 *
	$iwl_mvm_gë_vif_by_macid
(
iwl_mvm
 *
mvm
, 
u32
 
macid
)

676 
iwl_bss_föd_ôî_d©a
 
d©a
 = {

677 .
macid
 = macid,

680 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

682 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(

683 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

684 
iwl_mvm_bss_föd_iÁ˚_ôî©‹
, &
d©a
);

686  
d©a
.
vif
;

687 
	}
}

689 
	siwl_°a_ôî_d©a
 {

690 
boﬁ
 
	massoc
;

693 
	$iwl_mvm_°a_iÁ˚_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

694 
õì80211_vif
 *
vif
)

696 
iwl_°a_ôî_d©a
 *
d©a
 = 
_d©a
;

698 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

701 i‡(
vif
->
cfg
.
assoc
)

702 
d©a
->
assoc
 = 
åue
;

703 
	}
}

705 
boﬁ
 
	$iwl_mvm_is_vif_assoc
(
iwl_mvm
 *
mvm
)

707 
iwl_°a_ôî_d©a
 
d©a
 = {

708 .
assoc
 = 
Ál£
,

711 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

712 
IEEE80211_IFACE_ITER_NORMAL
,

713 
iwl_mvm_°a_iÁ˚_ôî©‹
,

714 &
d©a
);

715  
d©a
.
assoc
;

716 
	}
}

718 
	$iwl_mvm_gë_wd_timeout
(
iwl_mvm
 *
mvm
,

719 
õì80211_vif
 *
vif
,

720 
boﬁ
 
tdls
, boﬁ 
cmd_q
)

722 
iwl_fw_dbg_åiggî_év
 *
åiggî
;

723 
iwl_fw_dbg_åiggî_txq_timî
 *
txq_timî
;

724 
deÁu…_timeout
 = 
cmd_q
 ?

725 
IWL_DEF_WD_TIMEOUT
 :

726 
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
wd_timeout
;

728 i‡(!
	`iwl_fw_dbg_åiggî_íabÀd
(
mvm
->
fw
, 
FW_DBG_TRIGGER_TXQ_TIMERS
)) {

733 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
,

734 
IWL_UCODE_TLV_CAPA_STA_PM_NOTIF
) &&

735 
vif
 && vif->
ty≥
 =
NL80211_IFTYPE_AP
)

736  
IWL_WATCHDOG_DISABLED
;

737  
deÁu…_timeout
;

740 
åiggî
 = 
	`iwl_fw_dbg_gë_åiggî
(
mvm
->
fw
, 
FW_DBG_TRIGGER_TXQ_TIMERS
);

741 
txq_timî
 = (*)
åiggî
->
d©a
;

743 i‡(
tdls
)

744  
	`À32_to_˝u
(
txq_timî
->
tdls
);

746 i‡(
cmd_q
)

747  
	`À32_to_˝u
(
txq_timî
->
comm™d_queue
);

749 i‡(
	`WARN_ON
(!
vif
))

750  
deÁu…_timeout
;

752 
	`õì80211_vif_ty≥_p2p
(
vif
)) {

753 
NL80211_IFTYPE_ADHOC
:

754  
	`À32_to_˝u
(
txq_timî
->
ibss
);

755 
NL80211_IFTYPE_STATION
:

756  
	`À32_to_˝u
(
txq_timî
->
bss
);

757 
NL80211_IFTYPE_AP
:

758  
	`À32_to_˝u
(
txq_timî
->
so·≠
);

759 
NL80211_IFTYPE_P2P_CLIENT
:

760  
	`À32_to_˝u
(
txq_timî
->
p2p_˛õ¡
);

761 
NL80211_IFTYPE_P2P_GO
:

762  
	`À32_to_˝u
(
txq_timî
->
p2p_go
);

763 
NL80211_IFTYPE_P2P_DEVICE
:

764  
	`À32_to_˝u
(
txq_timî
->
p2p_devi˚
);

765 
NL80211_IFTYPE_MONITOR
:

766  
deÁu…_timeout
;

768 
	`WARN_ON
(1);

769  
mvm
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
wd_timeout
;

771 
	}
}

773 
	$iwl_mvm_c⁄√˘i⁄_loss
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
,

774 c⁄° *
îrmsg
)

776 
iwl_fw_dbg_åiggî_év
 *
åig
;

777 
iwl_fw_dbg_åiggî_mlme
 *
åig_mlme
;

779 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

780 
FW_DBG_TRIGGER_MLME
);

781 i‡(!
åig
)

782 
out
;

784 
åig_mlme
 = (*)
åig
->
d©a
;

786 i‡(
åig_mlme
->
°›_c⁄√˘i⁄_loss
 &&

787 --
åig_mlme
->
°›_c⁄√˘i⁄_loss
)

788 
out
;

790 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
, "%s", 
îrmsg
);

792 
out
:

793 
	`õì80211_c⁄√˘i⁄_loss
(
vif
);

794 
	}
}

796 
	$iwl_mvm_evít_‰ame_timeout_ˇŒback
(
iwl_mvm
 *
mvm
,

797 
õì80211_vif
 *
vif
,

798 c⁄° 
õì80211_°a
 *
°a
,

799 
u16
 
tid
)

801 
iwl_fw_dbg_åiggî_év
 *
åig
;

802 
iwl_fw_dbg_åiggî_ba
 *
ba_åig
;

804 
åig
 = 
	`iwl_fw_dbg_åiggî_⁄
(&
mvm
->
fwπ
, 
	`õì80211_vif_to_wdev
(
vif
),

805 
FW_DBG_TRIGGER_BA
);

806 i‡(!
åig
)

809 
ba_åig
 = (*)
åig
->
d©a
;

811 i‡(!(
	`À16_to_˝u
(
ba_åig
->
‰ame_timeout
Ë& 
	`BIT
(
tid
)))

814 
	`iwl_fw_dbg_cﬁÀ˘_åig
(&
mvm
->
fwπ
, 
åig
,

816 
°a
->
addr
, 
tid
);

817 
	}
}

819 
u8
 
	$iwl_mvm_tcm_lﬂd_≥r˚¡age
(
u32
 
aútime
, u32 
ñ≠£d
)

821 i‡(!
ñ≠£d
)

824  (100 * 
aútime
 / 
ñ≠£d
Ë/ 
USEC_PER_MSEC
;

825 
	}
}

827 
iwl_mvm_åaffic_lﬂd


828 
	$iwl_mvm_tcm_lﬂd
(
iwl_mvm
 *
mvm
, 
u32
 
aútime
, 
ñ≠£d
)

830 
u8
 
lﬂd
 = 
	`iwl_mvm_tcm_lﬂd_≥r˚¡age
(
aútime
, 
ñ≠£d
);

832 i‡(
lﬂd
 > 
IWL_MVM_TCM_LOAD_HIGH_THRESH
)

833  
IWL_MVM_TRAFFIC_HIGH
;

834 i‡(
lﬂd
 > 
IWL_MVM_TCM_LOAD_MEDIUM_THRESH
)

835  
IWL_MVM_TRAFFIC_MEDIUM
;

837  
IWL_MVM_TRAFFIC_LOW
;

838 
	}
}

840 
	$iwl_mvm_tcm_ôî
(*
_d©a
, 
u8
 *
mac
, 
õì80211_vif
 *
vif
)

842 
iwl_mvm
 *
mvm
 = 
_d©a
;

843 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

844 
boﬁ
 
low_œãncy
, 
¥ev
 = 
mvmvif
->low_œãncy & 
LOW_LATENCY_TRAFFIC
;

846 i‡(
mvmvif
->
id
 >
NUM_MAC_INDEX_DRIVER
)

849 
low_œãncy
 = 
mvm
->
tcm
.
ªsu…
.low_œãncy[
mvmvif
->
id
];

851 i‡(!
mvm
->
tcm
.
ªsu…
.
ch™ge
[
mvmvif
->
id
] &&

852 
¥ev
 =
low_œãncy
) {

853 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

857 i‡(
¥ev
 !
low_œãncy
) {

859 
	`iwl_mvm_upd©e_low_œãncy
(
mvm
, 
vif
, 
low_œãncy
,

860 
LOW_LATENCY_TRAFFIC
);

862 
	`iwl_mvm_upd©e_quŸas
(
mvm
, 
Ál£
, 
NULL
);

864 
	}
}

866 
	$iwl_mvm_tcm_ªsu…s
(
iwl_mvm
 *
mvm
)

868 
	`muãx_lock
(&
mvm
->
muãx
);

870 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s
(

871 
mvm
->
hw
, 
IEEE80211_IFACE_ITER_NORMAL
,

872 
iwl_mvm_tcm_ôî
, 
mvm
);

874 i‡(
	`fw_has_ˇ∑
(&
mvm
->
fw
->
ucode_ˇ∑
, 
IWL_UCODE_TLV_CAPA_UMAC_SCAN
))

875 
	`iwl_mvm_c⁄fig_sˇn
(
mvm
);

877 
	`muãx_u∆ock
(&
mvm
->
muãx
);

878 
	}
}

880 
	$iwl_mvm_tcm_u≠sd_n⁄agg_dëe˘ed_wk
(
w‹k_°ru˘
 *
wk
)

882 
iwl_mvm
 *
mvm
;

883 
iwl_mvm_vif
 *
mvmvif
;

884 
õì80211_vif
 *
vif
;

886 
mvmvif
 = 
	`c⁄èöî_of
(
wk
, 
iwl_mvm_vif
,

887 
u≠sd_n⁄agg_dëe˘ed_wk
.
w‹k
);

888 
vif
 = 
	`c⁄èöî_of
((*)
mvmvif
, 
õì80211_vif
, 
drv_¥iv
);

889 
mvm
 = 
mvmvif
->mvm;

891 i‡(
mvm
->
tcm
.
d©a
[
mvmvif
->
id
].
›íed_rx_ba_£ssi⁄s
)

895 
	`mem˝y
(
mvm
->
u≠sd_nﬂgg_bssids
[mvm->
u≠sd_nﬂgg_bssid_wrôe_idx
].
addr
,

896 
vif
->
bss_c⁄f
.
bssid
, 
ETH_ALEN
);

897 
mvm
->
u≠sd_nﬂgg_bssid_wrôe_idx
++;

898 i‡(
mvm
->
u≠sd_nﬂgg_bssid_wrôe_idx
 >
IWL_MVM_UAPSD_NOAGG_LIST_LEN
)

899 
mvm
->
u≠sd_nﬂgg_bssid_wrôe_idx
 = 0;

901 
	`iwl_mvm_c⁄√˘i⁄_loss
(
mvm
, 
vif
,

903 
	}
}

905 
	$iwl_mvm_u≠sd_agg_disc⁄√˘
(
iwl_mvm
 *
mvm
,

906 
õì80211_vif
 *
vif
)

908 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

910 i‡(
vif
->
ty≥
 !
NL80211_IFTYPE_STATION
)

913 i‡(!
vif
->
cfg
.
assoc
)

916 i‡(!
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_VO
].
u≠sd
 &&

917 !
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_VI
].
u≠sd
 &&

918 !
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_BE
].
u≠sd
 &&

919 !
mvmvif
->
deÊök
.
queue_∑øms
[
IEEE80211_AC_BK
].
u≠sd
)

922 i‡(
mvm
->
tcm
.
d©a
[
mvmvif
->
id
].
u≠sd_n⁄agg_dëe˘
.
dëe˘ed
)

925 
mvm
->
tcm
.
d©a
[
mvmvif
->
id
].
u≠sd_n⁄agg_dëe˘
.
dëe˘ed
 = 
åue
;

926 
	`IWL_INFO
(
mvm
,

928 
	`scheduÀ_dñayed_w‹k
(&
mvmvif
->
u≠sd_n⁄agg_dëe˘ed_wk
,

929 15 * 
HZ
);

930 
	}
}

932 
	$iwl_mvm_check_u≠sd_agg_ex≥˘ed_çt
(
iwl_mvm
 *
mvm
,

933 
ñ≠£d
,

934 
mac
)

936 
u64
 
byãs
 = 
mvm
->
tcm
.
d©a
[
mac
].
u≠sd_n⁄agg_dëe˘
.
rx_byãs
;

937 
u64
 
çt
;

938 
øã
;

939 
õì80211_vif
 *
vif
;

941 
øã
 = 
	`ewma_øã_ªad
(&
mvm
->
tcm
.
d©a
[
mac
].
u≠sd_n⁄agg_dëe˘
.rate);

943 i‡(!
øã
 || 
mvm
->
tcm
.
d©a
[
mac
].
›íed_rx_ba_£ssi⁄s
 ||

944 
mvm
->
tcm
.
d©a
[
mac
].
u≠sd_n⁄agg_dëe˘
.
dëe˘ed
)

947 i‡(
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

948 
çt
 = 8 * 
byãs
;

949 
	`do_div
(
çt
, 
ñ≠£d
);

950 
øã
 *= 1000;

951 i‡(
çt
 < 22 * 
øã
 / 100)

962 
çt
 = (8 * 
byãs
);

963 
	`do_div
(
çt
, 
ñ≠£d
 * 100);

964 i‡(
çt
 < 
øã
)

968 
	`rcu_ªad_lock
();

969 
vif
 = 
	`rcu_dîe„ªn˚
(
mvm
->
vif_id_to_mac
[
mac
]);

970 i‡(
vif
)

971 
	`iwl_mvm_u≠sd_agg_disc⁄√˘
(
mvm
, 
vif
);

972 
	`rcu_ªad_u∆ock
();

973 
	}
}

975 
	$iwl_mvm_tcm_ôî©‹
(*
_d©a
, 
u8
 *
mac
,

976 
õì80211_vif
 *
vif
)

978 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

979 
u32
 *
b™d
 = 
_d©a
;

981 i‡(!
mvmvif
->
deÊök
.
phy_˘xt
)

984 
b™d
[
mvmvif
->
id
] = mvmvif->
deÊök
.
phy_˘xt
->
ch™√l
->band;

985 
	}
}

987 
	$iwl_mvm_ˇlc_tcm_°©s
(
iwl_mvm
 *
mvm
,

988 
ts
,

989 
boﬁ
 
h™dÀ_u≠sd
)

991 
ñ≠£d
 = 
	`jiffõs_to_m£cs
(
ts
 - 
mvm
->
tcm
.ts);

992 
u≠sd_ñ≠£d
 =

993 
	`jiffõs_to_m£cs
(
ts
 - 
mvm
->
tcm
.
u≠sd_n⁄agg_ts
);

994 
u32
 
tŸÆ_aútime
 = 0;

995 
u32
 
b™d_aútime
[
NUM_NL80211_BANDS
] = {0};

996 
u32
 
b™d
[
NUM_MAC_INDEX_DRIVER
] = {0};

997 
ac
, 
mac
, 
i
;

998 
boﬁ
 
low_œãncy
 = 
Ál£
;

999 
iwl_mvm_åaffic_lﬂd
 
lﬂd
, 
b™d_lﬂd
;

1000 
boﬁ
 
h™dÀ_Œ
 = 
	`time_a·î
(
ts
, 
mvm
->
tcm
.
Œ_ts
 + 
MVM_LL_PERIOD
);

1002 i‡(
h™dÀ_Œ
)

1003 
mvm
->
tcm
.
Œ_ts
 = 
ts
;

1004 i‡(
h™dÀ_u≠sd
)

1005 
mvm
->
tcm
.
u≠sd_n⁄agg_ts
 = 
ts
;

1007 
mvm
->
tcm
.
ªsu…
.
ñ≠£d
 =Élapsed;

1009 
	`õì80211_ôî©e_a˘ive_öãrÁ˚s_©omic
(
mvm
->
hw
,

1010 
IEEE80211_IFACE_ITER_NORMAL
,

1011 
iwl_mvm_tcm_ôî©‹
,

1012 &
b™d
);

1014 
mac
 = 0; ma¯< 
NUM_MAC_INDEX_DRIVER
; mac++) {

1015 
iwl_mvm_tcm_mac
 *
md©a
 = &
mvm
->
tcm
.
d©a
[
mac
];

1016 
u32
 
vo_vi_pkts
 = 0;

1017 
u32
 
aútime
 = 
md©a
->
rx
.aútimê+ md©a->
tx
.airtime;

1019 
tŸÆ_aútime
 +
aútime
;

1020 
b™d_aútime
[
b™d
[
mac
]] +
aútime
;

1022 
lﬂd
 = 
	`iwl_mvm_tcm_lﬂd
(
mvm
, 
aútime
, 
ñ≠£d
);

1023 
mvm
->
tcm
.
ªsu…
.
ch™ge
[
mac
] = 
lﬂd
 != mvm->tcm.result.load[mac];

1024 
mvm
->
tcm
.
ªsu…
.
lﬂd
[
mac
] =Üoad;

1025 
mvm
->
tcm
.
ªsu…
.
aútime
[
mac
] =áirtime;

1027 
ac
 = 
IEEE80211_AC_VO
;á¯<
IEEE80211_AC_VI
;ác++)

1028 
vo_vi_pkts
 +
md©a
->
rx
.
pkts
[
ac
] +

1029 
md©a
->
tx
.
pkts
[
ac
];

1032 i‡(
vo_vi_pkts
 > 
IWL_MVM_TCM_LOWLAT_ENABLE_THRESH
)

1033 
mvm
->
tcm
.
ªsu…
.
low_œãncy
[
mac
] = 
åue
;

1034 i‡(
h™dÀ_Œ
)

1035 
mvm
->
tcm
.
ªsu…
.
low_œãncy
[
mac
] = 
Ál£
;

1037 i‡(
h™dÀ_Œ
) {

1039 
	`mem£t
(&
md©a
->
rx
.
pkts
, 0, (mdata->rx.pkts));

1040 
	`mem£t
(&
md©a
->
tx
.
pkts
, 0, (mdata->tx.pkts));

1042 
low_œãncy
 |
mvm
->
tcm
.
ªsu…
.low_œãncy[
mac
];

1044 i‡(!
mvm
->
tcm
.
ªsu…
.
low_œãncy
[
mac
] && 
h™dÀ_u≠sd
)

1045 
	`iwl_mvm_check_u≠sd_agg_ex≥˘ed_çt
(
mvm
, 
u≠sd_ñ≠£d
,

1046 
mac
);

1048 i‡(
h™dÀ_u≠sd
)

1049 
md©a
->
u≠sd_n⁄agg_dëe˘
.
rx_byãs
 = 0;

1050 
	`mem£t
(&
md©a
->
rx
.
aútime
, 0, (mdata->rx.airtime));

1051 
	`mem£t
(&
md©a
->
tx
.
aútime
, 0, (mdata->tx.airtime));

1054 
lﬂd
 = 
	`iwl_mvm_tcm_lﬂd
(
mvm
, 
tŸÆ_aútime
, 
ñ≠£d
);

1055 
mvm
->
tcm
.
ªsu…
.
globÆ_lﬂd
 = 
lﬂd
;

1057 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

1058 
b™d_lﬂd
 = 
	`iwl_mvm_tcm_lﬂd
(
mvm
, 
b™d_aútime
[
i
], 
ñ≠£d
);

1059 
mvm
->
tcm
.
ªsu…
.
b™d_lﬂd
[
i
] = band_load;

1068 i‡(
lﬂd
 !
IWL_MVM_TRAFFIC_LOW
)

1069  
MVM_TCM_PERIOD
;

1075 i‡(
low_œãncy
)

1076  
MVM_LL_PERIOD
;

1089 
	}
}

1091 
	$iwl_mvm_ªˇlc_tcm
(
iwl_mvm
 *
mvm
)

1093 
ts
 = 
jiffõs
;

1094 
boﬁ
 
h™dÀ_u≠sd
 =

1095 
	`time_a·î
(
ts
, 
mvm
->
tcm
.
u≠sd_n⁄agg_ts
 +

1096 
	`m£cs_to_jiffõs
(
IWL_MVM_UAPSD_NONAGG_PERIOD
));

1098 
	`•ö_lock
(&
mvm
->
tcm
.
lock
);

1099 i‡(
mvm
->
tcm
.
∑u£d
 || !
	`time_a·î
(
ts
, mvm->tcm.t†+ 
MVM_TCM_PERIOD
)) {

1100 
	`•ö_u∆ock
(&
mvm
->
tcm
.
lock
);

1103 
	`•ö_u∆ock
(&
mvm
->
tcm
.
lock
);

1105 i‡(
h™dÀ_u≠sd
 && 
	`iwl_mvm_has_√w_rx_≠i
(
mvm
)) {

1106 
	`muãx_lock
(&
mvm
->
muãx
);

1107 i‡(
	`iwl_mvm_ªque°_°©i°ics
(
mvm
, 
åue
))

1108 
h™dÀ_u≠sd
 = 
Ál£
;

1109 
	`muãx_u∆ock
(&
mvm
->
muãx
);

1112 
	`•ö_lock
(&
mvm
->
tcm
.
lock
);

1114 i‡(!
mvm
->
tcm
.
∑u£d
 && 
	`time_a·î
(
ts
, mvm->tcm.t†+ 
MVM_TCM_PERIOD
)) {

1116 
w‹k_dñay
 = 
	`iwl_mvm_ˇlc_tcm_°©s
(
mvm
, 
ts
,

1117 
h™dÀ_u≠sd
);

1120 
	`smp_mb
();

1121 
mvm
->
tcm
.
ts
 =Ås;

1122 i‡(
w‹k_dñay
)

1123 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tcm
.
w‹k
, 
w‹k_dñay
);

1125 
	`•ö_u∆ock
(&
mvm
->
tcm
.
lock
);

1127 
	`iwl_mvm_tcm_ªsu…s
(
mvm
);

1128 
	}
}

1130 
	$iwl_mvm_tcm_w‹k
(
w‹k_°ru˘
 *
w‹k
)

1132 
dñayed_w‹k
 *dñayed_w‹k = 
	`to_dñayed_w‹k
(
w‹k
);

1133 
iwl_mvm
 *
mvm
 = 
	`c⁄èöî_of
(
dñayed_w‹k
, iwl_mvm,

1134 
tcm
.
w‹k
);

1136 
	`iwl_mvm_ªˇlc_tcm
(
mvm
);

1137 
	}
}

1139 
	$iwl_mvm_∑u£_tcm
(
iwl_mvm
 *
mvm
, 
boﬁ
 
wôh_ˇn˚l
)

1141 
	`•ö_lock_bh
(&
mvm
->
tcm
.
lock
);

1142 
mvm
->
tcm
.
∑u£d
 = 
åue
;

1143 
	`•ö_u∆ock_bh
(&
mvm
->
tcm
.
lock
);

1144 i‡(
wôh_ˇn˚l
)

1145 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvm
->
tcm
.
w‹k
);

1146 
	}
}

1148 
	$iwl_mvm_ªsume_tcm
(
iwl_mvm
 *
mvm
)

1150 
mac
;

1151 
boﬁ
 
low_œãncy
 = 
Ál£
;

1153 
	`•ö_lock_bh
(&
mvm
->
tcm
.
lock
);

1154 
mvm
->
tcm
.
ts
 = 
jiffõs
;

1155 
mvm
->
tcm
.
Œ_ts
 = 
jiffõs
;

1156 
mac
 = 0; ma¯< 
NUM_MAC_INDEX_DRIVER
; mac++) {

1157 
iwl_mvm_tcm_mac
 *
md©a
 = &
mvm
->
tcm
.
d©a
[
mac
];

1159 
	`mem£t
(&
md©a
->
rx
.
pkts
, 0, (mdata->rx.pkts));

1160 
	`mem£t
(&
md©a
->
tx
.
pkts
, 0, (mdata->tx.pkts));

1161 
	`mem£t
(&
md©a
->
rx
.
aútime
, 0, (mdata->rx.airtime));

1162 
	`mem£t
(&
md©a
->
tx
.
aútime
, 0, (mdata->tx.airtime));

1164 i‡(
mvm
->
tcm
.
ªsu…
.
low_œãncy
[
mac
])

1165 
low_œãncy
 = 
åue
;

1168 
	`smp_mb
();

1169 
mvm
->
tcm
.
∑u£d
 = 
Ál£
;

1175 i‡(
mvm
->
tcm
.
ªsu…
.
globÆ_lﬂd
 > 
IWL_MVM_TRAFFIC_LOW
)

1176 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tcm
.
w‹k
, 
MVM_TCM_PERIOD
);

1177 i‡(
low_œãncy
)

1178 
	`scheduÀ_dñayed_w‹k
(&
mvm
->
tcm
.
w‹k
, 
MVM_LL_PERIOD
);

1180 
	`•ö_u∆ock_bh
(&
mvm
->
tcm
.
lock
);

1181 
	}
}

1183 
	$iwl_mvm_tcm_add_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

1185 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1187 
	`INIT_DELAYED_WORK
(&
mvmvif
->
u≠sd_n⁄agg_dëe˘ed_wk
,

1188 
iwl_mvm_tcm_u≠sd_n⁄agg_dëe˘ed_wk
);

1189 
	}
}

1191 
	$iwl_mvm_tcm_rm_vif
(
iwl_mvm
 *
mvm
, 
õì80211_vif
 *
vif
)

1193 
iwl_mvm_vif
 *
mvmvif
 = 
	`iwl_mvm_vif_‰om_mac80211
(
vif
);

1195 
	`ˇn˚l_dñayed_w‹k_sync
(&
mvmvif
->
u≠sd_n⁄agg_dëe˘ed_wk
);

1196 
	}
}

1198 
u32
 
	$iwl_mvm_gë_sy°ime
(
iwl_mvm
 *
mvm
)

1200 
u32
 
ªg_addr
 = 
DEVICE_SYSTEM_TIME_REG
;

1202 i‡(
mvm
->
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_22000
 &&

1203 
mvm
->
å™s
->
cfg
->
gp2_ªg_addr
)

1204 
ªg_addr
 = 
mvm
->
å™s
->
cfg
->
gp2_ªg_addr
;

1206  
	`iwl_ªad_¥ph
(
mvm
->
å™s
, 
ªg_addr
);

1207 
	}
}

1209 
	$iwl_mvm_gë_sync_time
(
iwl_mvm
 *
mvm
, 
˛ock_ty≥
,

1210 
u32
 *
gp2
, 
u64
 *
boŸtime
, 
ktime_t
 *
ªÆtime
)

1212 
boﬁ
 
ps_dißbÀd
;

1214 
	`lockdï_as£π_hñd
(&
mvm
->
muãx
);

1217 
ps_dißbÀd
 = 
mvm
->ps_disabled;

1218 i‡(!
ps_dißbÀd
) {

1219 
mvm
->
ps_dißbÀd
 = 
åue
;

1220 
	`iwl_mvm_powî_upd©e_devi˚
(
mvm
);

1223 *
gp2
 = 
	`iwl_mvm_gë_sy°ime
(
mvm
);

1225 i‡(
˛ock_ty≥
 =
CLOCK_BOOTTIME
 && 
boŸtime
)

1226 *
boŸtime
 = 
	`ktime_gë_boŸtime_ns
();

1227 i‡(
˛ock_ty≥
 =
CLOCK_REALTIME
 && 
ªÆtime
)

1228 *
ªÆtime
 = 
	`ktime_gë_ªÆ
();

1230 i‡(!
ps_dißbÀd
) {

1231 
mvm
->
ps_dißbÀd
 =Ös_disabled;

1232 
	`iwl_mvm_powî_upd©e_devi˚
(
mvm
);

1234 
	}
}

1240 
boﬁ
 
	$iwl_mvm_have_löks_ßme_ch™√l
(
iwl_mvm_vif
 *
vif1
,

1241 
iwl_mvm_vif
 *
vif2
)

1243 
i
, 
j
;

1245 
	`f‹_óch_mvm_vif_vÆid_lök
(
vif1
, 
i
) {

1246 
	`f‹_óch_mvm_vif_vÆid_lök
(
vif2
, 
j
) {

1247 i‡(
vif1
->
lök
[
i
]->
phy_˘xt
 =
vif2
->lök[
j
]->phy_ctxt)

1248  
åue
;

1252  
Ál£
;

1253 
	}
}

1255 
boﬁ
 
	$iwl_mvm_vif_is_a˘ive
(
iwl_mvm_vif
 *
mvmvif
)

1257 
i
;

1260 
	`f‹_óch_mvm_vif_vÆid_lök
(
mvmvif
, 
i
) {

1261 i‡(
mvmvif
->
lök
[
i
]->
phy_˘xt
 &&

1262 
mvmvif
->
lök
[
i
]->
phy_˘xt
->
id
 < 
NUM_PHY_CTX
)

1263  
åue
;

1266  
Ál£
;

1267 
	}
}

	@mvm/vendor-cmd.c

5 
	~"mvm.h
"

6 
	~<löux/∆80211-vnd-öãl.h
>

7 
	~<√t/√éök.h
>

9 c⁄° 
∆a_pﬁicy


10 
	giwl_mvm_víd‹_©å_pﬁicy
[
NUM_IWL_MVM_VENDOR_ATTR
] = {

11 [
IWL_MVM_VENDOR_ATTR_ROAMING_FORBIDDEN
] = { .
ty≥
 = 
NLA_U8
 },

12 [
IWL_MVM_VENDOR_ATTR_AUTH_MODE
] = { .
ty≥
 = 
NLA_U32
 },

13 [
IWL_MVM_VENDOR_ATTR_CHANNEL_NUM
] = { .
ty≥
 = 
NLA_U8
 },

14 [
IWL_MVM_VENDOR_ATTR_SSID
] = { .
ty≥
 = 
NLA_BINARY
,

15 .
	gÀn
 = 
IEEE80211_MAX_SSID_LEN
 },

16 [
IWL_MVM_VENDOR_ATTR_BAND
] = { .
ty≥
 = 
NLA_U8
 },

17 [
IWL_MVM_VENDOR_ATTR_COLLOC_CHANNEL
] = { .
ty≥
 = 
NLA_U8
 },

18 [
IWL_MVM_VENDOR_ATTR_COLLOC_ADDR
] = { .
ty≥
 = 
NLA_BINARY
, .
	gÀn
 = 
ETH_ALEN
 },

21 
	$iwl_mvm_víd‹_gë_csme_c⁄n_öfo
(
wùhy
 *wiphy,

22 
wúñess_dev
 *
wdev
,

23 c⁄° *
d©a
, 
d©a_Àn
)

25 
õì80211_hw
 *
hw
 = 
	`wùhy_to_õì80211_hw
(
wùhy
);

26 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

27 
iwl_mvm_csme_c⁄n_öfo
 *
csme_c⁄n_öfo
;

28 
sk_buff
 *
skb
;

29 
îr
 = 0;

31 
	`muãx_lock
(&
mvm
->
muãx
);

32 
csme_c⁄n_öfo
 = 
	`iwl_mvm_gë_csme_c⁄n_öfo
(
mvm
);

34 i‡(!
csme_c⁄n_öfo
) {

35 
îr
 = -
EINVAL
;

36 
out_u∆ock
;

39 
skb
 = 
	`cfg80211_víd‹_cmd_Æloc_ª∂y_skb
(
wùhy
, 200);

40 i‡(!
skb
) {

41 
îr
 = -
ENOMEM
;

42 
out_u∆ock
;

45 i‡(
	`∆a_put_u32
(
skb
, 
IWL_MVM_VENDOR_ATTR_AUTH_MODE
,

46 
csme_c⁄n_öfo
->
c⁄n_öfo
.
auth_mode
) ||

47 
	`∆a_put
(
skb
, 
IWL_MVM_VENDOR_ATTR_SSID
,

48 
csme_c⁄n_öfo
->
c⁄n_öfo
.
ssid_Àn
,

49 
csme_c⁄n_öfo
->
c⁄n_öfo
.
ssid
) ||

50 
	`∆a_put_u32
(
skb
, 
IWL_MVM_VENDOR_ATTR_STA_CIPHER
,

51 
csme_c⁄n_öfo
->
c⁄n_öfo
.
∑úwi£_cùhî
) ||

52 
	`∆a_put_u8
(
skb
, 
IWL_MVM_VENDOR_ATTR_CHANNEL_NUM
,

53 
csme_c⁄n_öfo
->
c⁄n_öfo
.
ch™√l
) ||

54 
	`∆a_put
(
skb
, 
IWL_MVM_VENDOR_ATTR_ADDR
, 
ETH_ALEN
,

55 
csme_c⁄n_öfo
->
c⁄n_öfo
.
bssid
)) {

56 
	`k‰ì_skb
(
skb
);

57 
îr
 = -
ENOBUFS
;

60 
out_u∆ock
:

61 
	`muãx_u∆ock
(&
mvm
->
muãx
);

62 i‡(
îr
)

63  
îr
;

65  
	`cfg80211_víd‹_cmd_ª∂y
(
skb
);

66 
	}
}

68 
	$iwl_mvm_víd‹_ho°_gë_ow√rshù
(
wùhy
 *wiphy,

69 
wúñess_dev
 *
wdev
,

70 c⁄° *
d©a
, 
d©a_Àn
)

72 
õì80211_hw
 *
hw
 = 
	`wùhy_to_õì80211_hw
(
wùhy
);

73 
iwl_mvm
 *
mvm
 = 
	`IWL_MAC80211_GET_MVM
(
hw
);

74 
ªt
;

76 
	`muãx_lock
(&
mvm
->
muãx
);

77 
ªt
 = 
	`iwl_mvm_mei_gë_ow√rshù
(
mvm
);

78 
	`muãx_u∆ock
(&
mvm
->
muãx
);

80  
ªt
;

81 
	}
}

83 c⁄° 
wùhy_víd‹_comm™d
 
	giwl_mvm_víd‹_comm™ds
[] = {

85 .
öfo
 = {

86 .
víd‹_id
 = 
INTEL_OUI
,

87 .
	gsubcmd
 = 
IWL_MVM_VENDOR_CMD_GET_CSME_CONN_INFO
,

89 .
	gdoô
 = 
iwl_mvm_víd‹_gë_csme_c⁄n_öfo
,

90 .
	gÊags
 = 
WIPHY_VENDOR_CMD_NEED_WDEV
,

91 .
	gpﬁicy
 = 
iwl_mvm_víd‹_©å_pﬁicy
,

92 .
	gmax©å
 = 
MAX_IWL_MVM_VENDOR_ATTR
,

95 .
	göfo
 = {

96 .
víd‹_id
 = 
INTEL_OUI
,

97 .
	gsubcmd
 = 
IWL_MVM_VENDOR_CMD_HOST_GET_OWNERSHIP
,

99 .
	gdoô
 = 
iwl_mvm_víd‹_ho°_gë_ow√rshù
,

100 .
	gÊags
 = 
WIPHY_VENDOR_CMD_NEED_WDEV
,

101 .
	gpﬁicy
 = 
iwl_mvm_víd‹_©å_pﬁicy
,

102 .
	gmax©å
 = 
MAX_IWL_MVM_VENDOR_ATTR
,

106 
	eiwl_mvm_víd‹_evíts_idx
 {

108 
	mIWL_MVM_VENDOR_EVENT_IDX_ROAMING_FORBIDDEN
 = 4,

109 
	mNUM_IWL_MVM_VENDOR_EVENT_IDX


112 c⁄° 
∆80211_víd‹_cmd_öfo


113 
	giwl_mvm_víd‹_evíts
[
NUM_IWL_MVM_VENDOR_EVENT_IDX
] = {

114 [
IWL_MVM_VENDOR_EVENT_IDX_ROAMING_FORBIDDEN
] = {

115 .
víd‹_id
 = 
INTEL_OUI
,

116 .
	gsubcmd
 = 
IWL_MVM_VENDOR_CMD_ROAMING_FORBIDDEN_EVENT
,

120 
	$iwl_mvm_víd‹_cmds_ªgi°î
(
iwl_mvm
 *
mvm
)

122 
mvm
->
hw
->
wùhy
->
víd‹_comm™ds
 = 
iwl_mvm_víd‹_comm™ds
;

123 
mvm
->
hw
->
wùhy
->
n_víd‹_comm™ds
 = 
	`ARRAY_SIZE
(
iwl_mvm_víd‹_comm™ds
);

124 
mvm
->
hw
->
wùhy
->
víd‹_evíts
 = 
iwl_mvm_víd‹_evíts
;

125 
mvm
->
hw
->
wùhy
->
n_víd‹_evíts
 = 
	`ARRAY_SIZE
(
iwl_mvm_víd‹_evíts
);

126 
	}
}

128 
	$iwl_mvm_£nd_rﬂmög_f‹biddí_evít
(
iwl_mvm
 *
mvm
,

129 
õì80211_vif
 *
vif
,

130 
boﬁ
 
f‹biddí
)

132 
sk_buff
 *
msg
 =

133 
	`cfg80211_víd‹_evít_Æloc
(
mvm
->
hw
->
wùhy
,

134 
	`õì80211_vif_to_wdev
(
vif
),

135 200, 
IWL_MVM_VENDOR_EVENT_IDX_ROAMING_FORBIDDEN
,

136 
GFP_ATOMIC
);

137 i‡(!
msg
)

140 i‡(
	`WARN_ON
(!
vif
))

143 i‡(
	`∆a_put
(
msg
, 
IWL_MVM_VENDOR_ATTR_VIF_ADDR
,

144 
ETH_ALEN
, 
vif
->
addr
) ||

145 
	`∆a_put_u8
(
msg
, 
IWL_MVM_VENDOR_ATTR_ROAMING_FORBIDDEN
, 
f‹biddí
))

146 
∆a_put_Áûuª
;

148 
	`cfg80211_víd‹_evít
(
msg
, 
GFP_ATOMIC
);

151 
∆a_put_Áûuª
:

152 
	`k‰ì_skb
(
msg
);

153 
	}
}

	@pcie/ctxt-info-gen3.c

5 
	~"iwl-å™s.h
"

6 
	~"iwl-fh.h
"

7 
	~"iwl-c⁄ãxt-öfo-gí3.h
"

8 
	~"öã∫Æ.h
"

9 
	~"iwl-¥ph.h
"

12 
	$iwl_pcõ_˘xt_öfo_dbg_íabÀ
(
iwl_å™s
 *
å™s
,

13 
iwl_¥ph_s¸©ch_hwm_cfg
 *
dbg_cfg
,

14 
u32
 *
c⁄åﬁ_Êags
)

16 
iwl_fw_öi_Æloˇti⁄_id
 
Æloc_id
 = 
IWL_FW_INI_ALLOCATION_ID_DBGC1
;

17 
iwl_fw_öi_Æloˇti⁄_év
 *
fw_m⁄_cfg
;

18 
u32
 
dbg_Êags
 = 0;

20 i‡(!
	`iwl_å™s_dbg_öi_vÆid
(
å™s
)) {

21 
iwl_døm_d©a
 *
fw_m⁄
 = &
å™s
->
dbg
.fw_mon;

23 
	`iwl_pcõ_Æloc_fw_m⁄ô‹
(
å™s
, 0);

25 i‡(
fw_m⁄
->
size
) {

26 
dbg_Êags
 |
IWL_PRPH_SCRATCH_EDBG_DEST_DRAM
;

28 
	`IWL_DEBUG_FW
(
å™s
,

31 
dbg_cfg
->
hwm_ba£_addr
 = 
	`˝u_to_À64
(
fw_m⁄
->
physiˇl
);

32 
dbg_cfg
->
hwm_size
 = 
	`˝u_to_À32
(
fw_m⁄
->
size
);

35 
out
;

38 
fw_m⁄_cfg
 = &
å™s
->
dbg
.fw_m⁄_cfg[
Æloc_id
];

40 
	`À32_to_˝u
(
fw_m⁄_cfg
->
buf_loˇti⁄
)) {

41 
IWL_FW_INI_LOCATION_SRAM_PATH
:

42 
dbg_Êags
 |
IWL_PRPH_SCRATCH_EDBG_DEST_INTERNAL
;

43 
	`IWL_DEBUG_FW
(
å™s
,

47 
IWL_FW_INI_LOCATION_NPK_PATH
:

48 
dbg_Êags
 |
IWL_PRPH_SCRATCH_EDBG_DEST_TB22DTF
;

49 
	`IWL_DEBUG_FW
(
å™s
,

53 
IWL_FW_INI_LOCATION_DRAM_PATH
:

54 i‡(
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
].
num_‰ags
) {

55 
iwl_døm_d©a
 *
‰ag
 =

56 &
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
].
‰ags
[0];

57 
dbg_Êags
 |
IWL_PRPH_SCRATCH_EDBG_DEST_DRAM
;

58 
dbg_cfg
->
hwm_ba£_addr
 = 
	`˝u_to_À64
(
‰ag
->
physiˇl
);

59 
dbg_cfg
->
hwm_size
 = 
	`˝u_to_À32
(
‰ag
->
size
);

60 
dbg_cfg
->
debug_tokí_c⁄fig
 = 
	`˝u_to_À32
(
å™s
->
dbg
.
ucode_¥e£t
);

61 
	`IWL_DEBUG_FW
(
å™s
,

63 
dbg_cfg
->
debug_tokí_c⁄fig
);

64 
	`IWL_DEBUG_FW
(
å™s
,

66 
Æloc_id
,

67 
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
].
num_‰ags
);

71 
	`IWL_ERR
(
å™s
, "WRT: Invalid buffer destination\n");

73 
out
:

74 i‡(
dbg_Êags
)

75 *
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_EARLY_DEBUG_EN
 | 
dbg_Êags
;

76 
	}
}

78 
	$iwl_pcõ_˘xt_öfo_gí3_öô
(
iwl_å™s
 *
å™s
,

79 c⁄° 
fw_img
 *
fw
)

81 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

82 
iwl_c⁄ãxt_öfo_gí3
 *
˘xt_öfo_gí3
;

83 
iwl_¥ph_s¸©ch
 *
¥ph_s¸©ch
;

84 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
;

85 
iwl_¥ph_öfo
 *
¥ph_öfo
;

86 
u32
 
c⁄åﬁ_Êags
 = 0;

87 
ªt
;

88 
cmdq_size
 = 
	`max_t
(
u32
, 
IWL_CMD_QUEUE_SIZE
,

89 
å™s
->
cfg
->
mö_txq_size
);

91 
å™s_pcõ
->
rx_buf_size
) {

92 
IWL_AMSDU_DEF
:

93  -
EINVAL
;

94 
IWL_AMSDU_2K
:

96 
IWL_AMSDU_4K
:

97 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_RB_SIZE_4K
;

99 
IWL_AMSDU_8K
:

100 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_RB_SIZE_4K
;

102 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_RB_SIZE_EXT_8K
;

104 
IWL_AMSDU_12K
:

105 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_RB_SIZE_4K
;

107 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_RB_SIZE_EXT_16K
;

112 
¥ph_s¸©ch
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, (*prph_scratch),

113 &
å™s_pcõ
->
¥ph_s¸©ch_dma_addr
,

114 
GFP_KERNEL
);

115 i‡(!
¥ph_s¸©ch
)

116  -
ENOMEM
;

118 
¥ph_sc_˘æ
 = &
¥ph_s¸©ch
->
˘æ_cfg
;

120 
¥ph_sc_˘æ
->
vîsi⁄
.version = 0;

121 
¥ph_sc_˘æ
->
vîsi⁄
.
mac_id
 =

122 
	`˝u_to_À16
((
u16
)
å™s
->
hw_ªv
);

123 
¥ph_sc_˘æ
->
vîsi⁄
.
size
 = 
	`˝u_to_À16
((*
¥ph_s¸©ch
) / 4);

125 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_MTR_MODE
;

126 
c⁄åﬁ_Êags
 |
IWL_PRPH_MTR_FORMAT_256B
 & 
IWL_PRPH_SCRATCH_MTR_FORMAT
;

128 i‡(
å™s
->
å™s_cfg
->
imr_íabÀd
)

129 
c⁄åﬁ_Êags
 |
IWL_PRPH_SCRATCH_IMR_DEBUG_EN
;

132 
¥ph_sc_˘æ
->
rbd_cfg
.
‰ì_rbd_addr
 =

133 
	`˝u_to_À64
(
å™s_pcõ
->
rxq
->
bd_dma
);

135 
	`iwl_pcõ_˘xt_öfo_dbg_íabÀ
(
å™s
, &
¥ph_sc_˘æ
->
hwm_cfg
,

136 &
c⁄åﬁ_Êags
);

137 
¥ph_sc_˘æ
->
c⁄åﬁ
.
c⁄åﬁ_Êags
 = 
	`˝u_to_À32
(control_flags);

140 
¥ph_sc_˘æ
->
°ï_cfg
.
mbx_addr_0
 = 
	`˝u_to_À32
(
å™s
->
mbx_addr_0_°ï
);

141 
¥ph_sc_˘æ
->
°ï_cfg
.
mbx_addr_1
 = 
	`˝u_to_À32
(
å™s
->
mbx_addr_1_°ï
);

144 
ªt
 = 
	`iwl_pcõ_öô_fw_£c
(
å™s
, 
fw
, &
¥ph_s¸©ch
->
døm
);

145 i‡(
ªt
)

146 
îr_‰ì_¥ph_s¸©ch
;

158 
	`BUILD_BUG_ON
((*
¥ph_öfo
Ë> 
PAGE_SIZE
 / 2);

159 
¥ph_öfo
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
PAGE_SIZE
,

160 &
å™s_pcõ
->
¥ph_öfo_dma_addr
,

161 
GFP_KERNEL
);

162 i‡(!
¥ph_öfo
) {

163 
ªt
 = -
ENOMEM
;

164 
îr_‰ì_¥ph_s¸©ch
;

168 
˘xt_öfo_gí3
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
,

169 (*
˘xt_öfo_gí3
),

170 &
å™s_pcõ
->
˘xt_öfo_dma_addr
,

171 
GFP_KERNEL
);

172 i‡(!
˘xt_öfo_gí3
) {

173 
ªt
 = -
ENOMEM
;

174 
îr_‰ì_¥ph_öfo
;

177 
˘xt_öfo_gí3
->
¥ph_öfo_ba£_addr
 =

178 
	`˝u_to_À64
(
å™s_pcõ
->
¥ph_öfo_dma_addr
);

179 
˘xt_öfo_gí3
->
¥ph_s¸©ch_ba£_addr
 =

180 
	`˝u_to_À64
(
å™s_pcõ
->
¥ph_s¸©ch_dma_addr
);

181 
˘xt_öfo_gí3
->
¥ph_s¸©ch_size
 =

182 
	`˝u_to_À32
((*
¥ph_s¸©ch
));

183 
˘xt_öfo_gí3
->
¸_hód_idx_¨r_ba£_addr
 =

184 
	`˝u_to_À64
(
å™s_pcõ
->
rxq
->
rb_°ts_dma
);

185 
˘xt_öfo_gí3
->
å_èû_idx_¨r_ba£_addr
 =

186 
	`˝u_to_À64
(
å™s_pcõ
->
¥ph_öfo_dma_addr
 + 
PAGE_SIZE
 / 2);

187 
˘xt_öfo_gí3
->
¸_èû_idx_¨r_ba£_addr
 =

188 
	`˝u_to_À64
(
å™s_pcõ
->
¥ph_öfo_dma_addr
 + 3 * 
PAGE_SIZE
 / 4);

189 
˘xt_öfo_gí3
->
må_ba£_addr
 =

190 
	`˝u_to_À64
(
å™s
->
txqs
.
txq
[å™s->txqs.
cmd
.
q_id
]->
dma_addr
);

191 
˘xt_öfo_gí3
->
m¸_ba£_addr
 =

192 
	`˝u_to_À64
(
å™s_pcõ
->
rxq
->
u£d_bd_dma
);

193 
˘xt_öfo_gí3
->
må_size
 =

194 
	`˝u_to_À16
(
	`TFD_QUEUE_CB_SIZE
(
cmdq_size
));

195 
˘xt_öfo_gí3
->
m¸_size
 =

196 
	`˝u_to_À16
(
	`RX_QUEUE_CB_SIZE
(
å™s
->
cfg
->
num_rbds
));

198 
å™s_pcõ
->
˘xt_öfo_gí3
 = ctxt_info_gen3;

199 
å™s_pcõ
->
¥ph_öfo
 =Örph_info;

200 
å™s_pcõ
->
¥ph_s¸©ch
 =Örph_scratch;

203 
å™s_pcõ
->
iml
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
,Åøns->
iml_Àn
,

204 &
å™s_pcõ
->
iml_dma_addr
,

205 
GFP_KERNEL
);

206 i‡(!
å™s_pcõ
->
iml
) {

207 
ªt
 = -
ENOMEM
;

208 
îr_‰ì_˘xt_öfo
;

211 
	`mem˝y
(
å™s_pcõ
->
iml
, 
å™s
->iml,Åøns->
iml_Àn
);

213 
	`iwl_íabÀ_fw_lﬂd_öt_˘x_öfo
(
å™s
);

216 
	`iwl_wrôe64
(
å™s
, 
CSR_CTXT_INFO_ADDR
,

217 
å™s_pcõ
->
˘xt_öfo_dma_addr
);

218 
	`iwl_wrôe64
(
å™s
, 
CSR_IML_DATA_ADDR
,

219 
å™s_pcõ
->
iml_dma_addr
);

220 
	`iwl_wrôe32
(
å™s
, 
CSR_IML_SIZE_ADDR
,Åøns->
iml_Àn
);

222 
	`iwl_£t_bô
(
å™s
, 
CSR_CTXT_INFO_BOOT_CTRL
,

223 
CSR_AUTO_FUNC_BOOT_ENA
);

227 
îr_‰ì_˘xt_öfo
:

228 
	`dma_‰ì_cohîít
(
å™s
->
dev
, (*
å™s_pcõ
->
˘xt_öfo_gí3
),

229 
å™s_pcõ
->
˘xt_öfo_gí3
,

230 
å™s_pcõ
->
˘xt_öfo_dma_addr
);

231 
å™s_pcõ
->
˘xt_öfo_gí3
 = 
NULL
;

232 
îr_‰ì_¥ph_öfo
:

233 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
PAGE_SIZE
, 
¥ph_öfo
,

234 
å™s_pcõ
->
¥ph_öfo_dma_addr
);

236 
îr_‰ì_¥ph_s¸©ch
:

237 
	`dma_‰ì_cohîít
(
å™s
->
dev
,

238 (*
¥ph_s¸©ch
),

239 
¥ph_s¸©ch
,

240 
å™s_pcõ
->
¥ph_s¸©ch_dma_addr
);

241  
ªt
;

243 
	}
}

245 
	$iwl_pcõ_˘xt_öfo_gí3_‰ì
(
iwl_å™s
 *
å™s
, 
boﬁ
 
Æive
)

247 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

249 i‡(
å™s_pcõ
->
iml
) {

250 
	`dma_‰ì_cohîít
(
å™s
->
dev
,Åøns->
iml_Àn
, 
å™s_pcõ
->
iml
,

251 
å™s_pcõ
->
iml_dma_addr
);

252 
å™s_pcõ
->
iml_dma_addr
 = 0;

253 
å™s_pcõ
->
iml
 = 
NULL
;

256 
	`iwl_pcõ_˘xt_öfo_‰ì_fw_img
(
å™s
);

258 i‡(
Æive
)

261 i‡(!
å™s_pcõ
->
˘xt_öfo_gí3
)

265 
	`dma_‰ì_cohîít
(
å™s
->
dev
, (*
å™s_pcõ
->
˘xt_öfo_gí3
),

266 
å™s_pcõ
->
˘xt_öfo_gí3
,

267 
å™s_pcõ
->
˘xt_öfo_dma_addr
);

268 
å™s_pcõ
->
˘xt_öfo_dma_addr
 = 0;

269 
å™s_pcõ
->
˘xt_öfo_gí3
 = 
NULL
;

271 
	`dma_‰ì_cohîít
(
å™s
->
dev
, (*
å™s_pcõ
->
¥ph_s¸©ch
),

272 
å™s_pcõ
->
¥ph_s¸©ch
,

273 
å™s_pcõ
->
¥ph_s¸©ch_dma_addr
);

274 
å™s_pcõ
->
¥ph_s¸©ch_dma_addr
 = 0;

275 
å™s_pcõ
->
¥ph_s¸©ch
 = 
NULL
;

278 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
PAGE_SIZE
, 
å™s_pcõ
->
¥ph_öfo
,

279 
å™s_pcõ
->
¥ph_öfo_dma_addr
);

280 
å™s_pcõ
->
¥ph_öfo_dma_addr
 = 0;

281 
å™s_pcõ
->
¥ph_öfo
 = 
NULL
;

282 
	}
}

284 
	$iwl_pcõ_lﬂd_∑ylﬂds_c⁄töuou¶y
(
iwl_å™s
 *
å™s
,

285 c⁄° 
iwl_≤vm_image
 *
≤vm_d©a
,

286 
iwl_døm_d©a
 *
døm
)

288 
u32
 
Àn
, 
Àn0
, 
Àn1
;

290 i‡(
≤vm_d©a
->
n_chunks
 !
UNFRAGMENTED_PNVM_PAYLOADS_NUMBER
) {

291 
	`IWL_DEBUG_FW
(
å™s
, "expected 2Öayloads, got %d.\n",

292 
≤vm_d©a
->
n_chunks
);

293  -
EINVAL
;

296 
Àn0
 = 
≤vm_d©a
->
chunks
[0].
Àn
;

297 
Àn1
 = 
≤vm_d©a
->
chunks
[1].
Àn
;

298 i‡(
Àn1
 > 0xFFFFFFFF - 
Àn0
) {

299 
	`IWL_DEBUG_FW
(
å™s
, "sizes ofÖayloads overflow.\n");

300  -
EINVAL
;

302 
Àn
 = 
Àn0
 + 
Àn1
;

304 
døm
->
block
 = 
	`iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
å™s
, 
Àn
,

305 &
døm
->
physiˇl
);

306 i‡(!
døm
->
block
) {

307 
	`IWL_DEBUG_FW
(
å™s
, "FailedÅoállocate PNVM DMA.\n");

308  -
ENOMEM
;

311 
døm
->
size
 = 
Àn
;

312 
	`mem˝y
(
døm
->
block
, 
≤vm_d©a
->
chunks
[0].
d©a
, 
Àn0
);

313 
	`mem˝y
((
u8
 *)
døm
->
block
 + 
Àn0
, 
≤vm_d©a
->
chunks
[1].
d©a
, 
Àn1
);

316 
	}
}

318 
	giwl_pcõ_lﬂd_∑ylﬂds_£gmíts


319 (
iwl_å™s
 *
	gå™s
,

320 
iwl_døm_ªgi⁄s
 *
	gdøm_ªgi⁄s
,

321 c⁄° 
iwl_≤vm_image
 *
	g≤vm_d©a
)

323 
iwl_døm_d©a
 *
	gcur_∑ylﬂd_døm
 = &
døm_ªgi⁄s
->
døms
[0];

324 
iwl_døm_d©a
 *
	gdesc_døm
 = &
døm_ªgi⁄s
->
¥ph_s¸©ch_mem_desc
;

325 
iwl_¥ph_s¸©h_mem_desc_addr_¨øy
 *
	gaddªs£s
;

326 c⁄° *
	gd©a
;

327 
u32
 
	gÀn
;

328 
	gi
;

331 
	gÀn
 = (
iwl_¥ph_s¸©h_mem_desc_addr_¨øy
);

332 
	gdesc_døm
->
	gblock
 = 
iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít


333 (
å™s
,

334 
	gÀn
,

335 &
	gdesc_døm
->
	gphysiˇl
);

336 i‡(!
	gdesc_døm
->
	gblock
) {

337 
IWL_DEBUG_FW
(
å™s
, "FailedÅoállocate PNVM DMA.\n");

338  -
	gENOMEM
;

340 
	gdesc_døm
->
	gsize
 = 
Àn
;

341 
mem£t
(
desc_døm
->
block
, 0, 
Àn
);

344 
	gdøm_ªgi⁄s
->
	gn_ªgi⁄s
 = 0;

345 
	gi
 = 0; i < 
	g≤vm_d©a
->
	gn_chunks
; i++) {

346 
	gÀn
 = 
≤vm_d©a
->
chunks
[
i
].
Àn
;

347 
	gd©a
 = 
≤vm_d©a
->
chunks
[
i
].
d©a
;

349 i‡(
iwl_pcõ_˘xt_öfo_Æloc_dma
(
å™s
,

350 
d©a
,

351 
Àn
,

352 
cur_∑ylﬂd_døm
)) {

353 
iwl_å™s_pcõ_‰ì_≤vm_døm_ªgi⁄s
(
døm_ªgi⁄s
,

354 
å™s
->
dev
);

355  -
	gENOMEM
;

358 
	gdøm_ªgi⁄s
->
	gn_ªgi⁄s
++;

359 
	gcur_∑ylﬂd_døm
++;

363 
	gaddªs£s
 = 
desc_døm
->
block
;

364 
	gi
 = 0; i < 
	g≤vm_d©a
->
	gn_chunks
; i++) {

365 
	gaddªs£s
->
	gmem_descs
[
i
] =

366 
˝u_to_À64
(
døm_ªgi⁄s
->
døms
[
i
].
physiˇl
);

373 
	$iwl_å™s_pcõ_˘x_öfo_gí3_lﬂd_≤vm
(
iwl_å™s
 *
å™s
,

374 c⁄° 
iwl_≤vm_image
 *
≤vm_∑ylﬂds
,

375 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

377 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

378 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
 =

379 &
å™s_pcõ
->
¥ph_s¸©ch
->
˘æ_cfg
;

380 
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
 = &
å™s_pcõ
->
≤vm_d©a
;

381 
ªt
 = 0;

384 i‡(
å™s
->
≤vm_lﬂded
)

387 i‡(
	`WARN_ON
(
¥ph_sc_˘æ
->
≤vm_cfg
.
≤vm_size
))

388  -
EBUSY
;

390 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

393 i‡(!
≤vm_∑ylﬂds
->
n_chunks
) {

394 
	`IWL_DEBUG_FW
(
å™s
, "noÖayloads\n");

395  -
EINVAL
;

399 i‡(
	`fw_has_ˇ∑
(
ˇ∑
, 
IWL_UCODE_TLV_CAPA_FRAGMENTED_PNVM_IMG
)) {

400 
ªt
 = 
	`iwl_pcõ_lﬂd_∑ylﬂds_£gmíts
(
å™s
,

401 
døm_ªgi⁄s
,

402 
≤vm_∑ylﬂds
);

403 i‡(!
ªt
)

404 
å™s
->
≤vm_lﬂded
 = 
åue
;

407 
ªt
 = 
iwl_pcõ_lﬂd_∑ylﬂds_c⁄töuou¶y


408 (
å™s
,

409 
≤vm_∑ylﬂds
,

410 &
døm_ªgi⁄s
->
døms
[0]);

411 i‡(!
ªt
) {

412 
døm_ªgi⁄s
->
n_ªgi⁄s
 = 1;

413 
å™s
->
≤vm_lﬂded
 = 
åue
;

417  
ªt
;

418 
	}
}

420 
ölöe
 
size_t


421 
	$iwl_døm_ªgi⁄s_size
(c⁄° 
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
)

423 
size_t
 
tŸÆ_size
 = 0;

424 
i
;

426 
i
 = 0; i < 
døm_ªgi⁄s
->
n_ªgi⁄s
; i++)

427 
tŸÆ_size
 +
døm_ªgi⁄s
->
døms
[
i
].
size
;

429  
tŸÆ_size
;

430 
	}
}

432 
	$iwl_pcõ_£t_≤vm_£gmíts
(
iwl_å™s
 *
å™s
)

434 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

435 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
 =

436 &
å™s_pcõ
->
¥ph_s¸©ch
->
˘æ_cfg
;

437 
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
 = &
å™s_pcõ
->
≤vm_d©a
;

439 
¥ph_sc_˘æ
->
≤vm_cfg
.
≤vm_ba£_addr
 =

440 
	`˝u_to_À64
(
døm_ªgi⁄s
->
¥ph_s¸©ch_mem_desc
.
physiˇl
);

441 
¥ph_sc_˘æ
->
≤vm_cfg
.
≤vm_size
 =

442 
	`˝u_to_À32
(
	`iwl_døm_ªgi⁄s_size
(
døm_ªgi⁄s
));

443 
	}
}

445 
	$iwl_pcõ_£t_c⁄töuous_≤vm
(
iwl_å™s
 *
å™s
)

447 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

448 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
 =

449 &
å™s_pcõ
->
¥ph_s¸©ch
->
˘æ_cfg
;

451 
¥ph_sc_˘æ
->
≤vm_cfg
.
≤vm_ba£_addr
 =

452 
	`˝u_to_À64
(
å™s_pcõ
->
≤vm_d©a
.
døms
[0].
physiˇl
);

453 
¥ph_sc_˘æ
->
≤vm_cfg
.
≤vm_size
 =

454 
	`˝u_to_À32
(
å™s_pcõ
->
≤vm_d©a
.
døms
[0].
size
);

455 
	}
}

457 
	$iwl_å™s_pcõ_˘x_öfo_gí3_£t_≤vm
(
iwl_å™s
 *
å™s
,

458 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

460 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

463 i‡(
	`fw_has_ˇ∑
(
ˇ∑
, 
IWL_UCODE_TLV_CAPA_FRAGMENTED_PNVM_IMG
))

464 
	`iwl_pcõ_£t_≤vm_£gmíts
(
å™s
);

466 
	`iwl_pcõ_£t_c⁄töuous_≤vm
(
å™s
);

467 
	}
}

469 
	$iwl_å™s_pcõ_˘x_öfo_gí3_lﬂd_ªdu˚_powî
(
iwl_å™s
 *
å™s
,

470 c⁄° 
iwl_≤vm_image
 *
∑ylﬂds
,

471 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

473 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

474 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
 =

475 &
å™s_pcõ
->
¥ph_s¸©ch
->
˘æ_cfg
;

476 
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
 = &
å™s_pcõ
->
ªdu˚d_èbÀs_d©a
;

477 
ªt
 = 0;

480 i‡(
å™s
->
ªdu˚_powî_lﬂded
)

483 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

486 i‡(
	`WARN_ON
(
¥ph_sc_˘æ
->
ªdu˚_powî_cfg
.
size
))

487  -
EBUSY
;

489 i‡(!
∑ylﬂds
->
n_chunks
) {

490 
	`IWL_DEBUG_FW
(
å™s
, "noÖayloads\n");

491  -
EINVAL
;

495 i‡(
	`fw_has_ˇ∑
(
ˇ∑
, 
IWL_UCODE_TLV_CAPA_FRAGMENTED_PNVM_IMG
)) {

496 
ªt
 = 
	`iwl_pcõ_lﬂd_∑ylﬂds_£gmíts
(
å™s
,

497 
døm_ªgi⁄s
,

498 
∑ylﬂds
);

499 i‡(!
ªt
)

500 
å™s
->
ªdu˚_powî_lﬂded
 = 
åue
;

503 
ªt
 = 
iwl_pcõ_lﬂd_∑ylﬂds_c⁄töuou¶y


504 (
å™s
,

505 
∑ylﬂds
,

506 &
døm_ªgi⁄s
->
døms
[0]);

507 i‡(!
ªt
) {

508 
døm_ªgi⁄s
->
n_ªgi⁄s
 = 1;

509 
å™s
->
ªdu˚_powî_lﬂded
 = 
åue
;

513  
ªt
;

514 
	}
}

516 
	$iwl_pcõ_£t_ªdu˚_powî_£gmíts
(
iwl_å™s
 *
å™s
)

518 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

519 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
 =

520 &
å™s_pcõ
->
¥ph_s¸©ch
->
˘æ_cfg
;

521 
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
 = &
å™s_pcõ
->
ªdu˚d_èbÀs_d©a
;

523 
¥ph_sc_˘æ
->
ªdu˚_powî_cfg
.
ba£_addr
 =

524 
	`˝u_to_À64
(
døm_ªgi⁄s
->
¥ph_s¸©ch_mem_desc
.
physiˇl
);

525 
¥ph_sc_˘æ
->
ªdu˚_powî_cfg
.
size
 =

526 
	`˝u_to_À32
(
	`iwl_døm_ªgi⁄s_size
(
døm_ªgi⁄s
));

527 
	}
}

529 
	$iwl_pcõ_£t_c⁄töuous_ªdu˚_powî
(
iwl_å™s
 *
å™s
)

531 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

532 
iwl_¥ph_s¸©ch_˘æ_cfg
 *
¥ph_sc_˘æ
 =

533 &
å™s_pcõ
->
¥ph_s¸©ch
->
˘æ_cfg
;

535 
¥ph_sc_˘æ
->
ªdu˚_powî_cfg
.
ba£_addr
 =

536 
	`˝u_to_À64
(
å™s_pcõ
->
ªdu˚d_èbÀs_d©a
.
døms
[0].
physiˇl
);

537 
¥ph_sc_˘æ
->
ªdu˚_powî_cfg
.
size
 =

538 
	`˝u_to_À32
(
å™s_pcõ
->
ªdu˚d_èbÀs_d©a
.
døms
[0].
size
);

539 
	}
}

542 
	$iwl_å™s_pcõ_˘x_öfo_gí3_£t_ªdu˚_powî
(
iwl_å™s
 *
å™s
,

543 c⁄° 
iwl_ucode_ˇ∑bûôõs
 *
ˇ∑
)

545 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

548 i‡(
	`fw_has_ˇ∑
(
ˇ∑
, 
IWL_UCODE_TLV_CAPA_FRAGMENTED_PNVM_IMG
))

549 
	`iwl_pcõ_£t_ªdu˚_powî_£gmíts
(
å™s
);

551 
	`iwl_pcõ_£t_c⁄töuous_ªdu˚_powî
(
å™s
);

552 
	}
}

	@pcie/ctxt-info.c

6 
	~"iwl-å™s.h
"

7 
	~"iwl-fh.h
"

8 
	~"iwl-c⁄ãxt-öfo.h
"

9 
	~"öã∫Æ.h
"

10 
	~"iwl-¥ph.h
"

12 *
	$_iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
iwl_å™s
 *
å™s
,

13 
size_t
 
size
,

14 
dma_addr_t
 *
phys
,

15 
dïth
)

17 *
ªsu…
;

19 i‡(
	`WARN
(
dïth
 > 2,

21  
NULL
;

23 
ªsu…
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
size
, 
phys
, 
GFP_KERNEL
);

25 i‡(!
ªsu…
)

26  
NULL
;

28 i‡(
	`u∆ikñy
(
	`iwl_txq_¸os£s_4g_bound¨y
(*
phys
, 
size
))) {

29 *
ﬁd
 = 
ªsu…
;

30 
dma_addr_t
 
ﬁdphys
 = *
phys
;

32 
ªsu…
 = 
	`_iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
å™s
, 
size
,

33 
phys
,

34 
dïth
 + 1);

35 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
size
, 
ﬁd
, 
ﬁdphys
);

38  
ªsu…
;

39 
	}
}

41 *
	$iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
iwl_å™s
 *
å™s
,

42 
size_t
 
size
,

43 
dma_addr_t
 *
phys
)

45  
	`_iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
å™s
, 
size
, 
phys
, 0);

46 
	}
}

48 
	$iwl_pcõ_˘xt_öfo_Æloc_dma
(
iwl_å™s
 *
å™s
,

49 c⁄° *
d©a
, 
u32
 
Àn
,

50 
iwl_døm_d©a
 *
døm
)

52 
døm
->
block
 = 
	`iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
å™s
, 
Àn
,

53 &
døm
->
physiˇl
);

54 i‡(!
døm
->
block
)

55  -
ENOMEM
;

57 
døm
->
size
 = 
Àn
;

58 
	`mem˝y
(
døm
->
block
, 
d©a
, 
Àn
);

61 
	}
}

63 
	$iwl_pcõ_˘xt_öfo_‰ì_∑gög
(
iwl_å™s
 *
å™s
)

65 
iwl_£lf_öô_døm
 *
døm
 = &
å™s
->
öô_døm
;

66 
i
;

68 i‡(!
døm
->
∑gög
) {

69 
	`WARN_ON
(
døm
->
∑gög_˙t
);

74 
i
 = 0; i < 
døm
->
∑gög_˙t
; i++)

75 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
døm
->
∑gög
[
i
].
size
,

76 
døm
->
∑gög
[
i
].
block
,

77 
døm
->
∑gög
[
i
].
physiˇl
);

79 
	`k‰ì
(
døm
->
∑gög
);

80 
døm
->
∑gög_˙t
 = 0;

81 
døm
->
∑gög
 = 
NULL
;

82 
	}
}

84 
	$iwl_pcõ_öô_fw_£c
(
iwl_å™s
 *
å™s
,

85 c⁄° 
fw_img
 *
fw
,

86 
iwl_c⁄ãxt_öfo_døm
 *
˘xt_døm
)

88 
iwl_£lf_öô_døm
 *
døm
 = &
å™s
->
öô_døm
;

89 
i
, 
ªt
, 
lmac_˙t
, 
umac_˙t
, 
∑gög_˙t
;

91 i‡(
	`WARN
(
døm
->
∑gög
,

93 
døm
->
∑gög_˙t
))

94 
	`iwl_pcõ_˘xt_öfo_‰ì_∑gög
(
å™s
);

96 
lmac_˙t
 = 
	`iwl_pcõ_gë_num_£˘i⁄s
(
fw
, 0);

98 
umac_˙t
 = 
	`iwl_pcõ_gë_num_£˘i⁄s
(
fw
, 
lmac_˙t
 + 1);

100 
∑gög_˙t
 = 
	`iwl_pcõ_gë_num_£˘i⁄s
(
fw
, 
lmac_˙t
 + 
umac_˙t
 + 2);

102 
døm
->
fw
 = 
	`kˇŒoc
(
umac_˙t
 + 
lmac_˙t
, (*døm->fw), 
GFP_KERNEL
);

103 i‡(!
døm
->
fw
)

104  -
ENOMEM
;

105 
døm
->
∑gög
 = 
	`kˇŒoc
(
∑gög_˙t
, (*døm->∑gög), 
GFP_KERNEL
);

106 i‡(!
døm
->
∑gög
)

107  -
ENOMEM
;

110 
i
 = 0; i < 
lmac_˙t
; i++) {

111 
ªt
 = 
	`iwl_pcõ_˘xt_öfo_Æloc_dma
(
å™s
, 
fw
->
£c
[
i
].
d©a
,

112 
fw
->
£c
[
i
].
Àn
,

113 &
døm
->
fw
[døm->
fw_˙t
]);

114 i‡(
ªt
)

115  
ªt
;

116 
˘xt_døm
->
lmac_img
[
i
] =

117 
	`˝u_to_À64
(
døm
->
fw
[døm->
fw_˙t
].
physiˇl
);

118 
døm
->
fw_˙t
++;

122 
i
 = 0; i < 
umac_˙t
; i++) {

124 
ªt
 = 
	`iwl_pcõ_˘xt_öfo_Æloc_dma
(
å™s
,

125 
fw
->
£c
[
døm
->
fw_˙t
 + 1].
d©a
,

126 
fw
->
£c
[
døm
->
fw_˙t
 + 1].
Àn
,

127 &
døm
->
fw
[døm->
fw_˙t
]);

128 i‡(
ªt
)

129  
ªt
;

130 
˘xt_døm
->
umac_img
[
i
] =

131 
	`˝u_to_À64
(
døm
->
fw
[døm->
fw_˙t
].
physiˇl
);

132 
døm
->
fw_˙t
++;

145 
i
 = 0; i < 
∑gög_˙t
; i++) {

147 
fw_idx
 = 
døm
->
fw_˙t
 + 
i
 + 2;

149 
ªt
 = 
	`iwl_pcõ_˘xt_öfo_Æloc_dma
(
å™s
, 
fw
->
£c
[
fw_idx
].
d©a
,

150 
fw
->
£c
[
fw_idx
].
Àn
,

151 &
døm
->
∑gög
[
i
]);

152 i‡(
ªt
)

153  
ªt
;

155 
˘xt_døm
->
vútuÆ_img
[
i
] =

156 
	`˝u_to_À64
(
døm
->
∑gög
[
i
].
physiˇl
);

157 
døm
->
∑gög_˙t
++;

161 
	}
}

163 
	$iwl_pcõ_˘xt_öfo_öô
(
iwl_å™s
 *
å™s
,

164 c⁄° 
fw_img
 *
fw
)

166 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

167 
iwl_c⁄ãxt_öfo
 *
˘xt_öfo
;

168 
iwl_c⁄ãxt_öfo_rbd_cfg
 *
rx_cfg
;

169 
u32
 
c⁄åﬁ_Êags
 = 0, 
rb_size
;

170 
dma_addr_t
 
phys
;

171 
ªt
;

173 
˘xt_öfo
 = 
	`iwl_pcõ_˘xt_öfo_dma_Æloc_cohîít
(
å™s
,

174 (*
˘xt_öfo
),

175 &
phys
);

176 i‡(!
˘xt_öfo
)

177  -
ENOMEM
;

179 
å™s_pcõ
->
˘xt_öfo_dma_addr
 = 
phys
;

181 
˘xt_öfo
->
vîsi⁄
.version = 0;

182 
˘xt_öfo
->
vîsi⁄
.
mac_id
 =

183 
	`˝u_to_À16
((
u16
)
å™s
->
hw_ªv
);

185 
˘xt_öfo
->
vîsi⁄
.
size
 = 
	`˝u_to_À16
((*ctxt_info) / 4);

187 
å™s_pcõ
->
rx_buf_size
) {

188 
IWL_AMSDU_2K
:

189 
rb_size
 = 
IWL_CTXT_INFO_RB_SIZE_2K
;

191 
IWL_AMSDU_4K
:

192 
rb_size
 = 
IWL_CTXT_INFO_RB_SIZE_4K
;

194 
IWL_AMSDU_8K
:

195 
rb_size
 = 
IWL_CTXT_INFO_RB_SIZE_8K
;

197 
IWL_AMSDU_12K
:

198 
rb_size
 = 
IWL_CTXT_INFO_RB_SIZE_16K
;

201 
	`WARN_ON
(1);

202 
rb_size
 = 
IWL_CTXT_INFO_RB_SIZE_4K
;

205 
	`WARN_ON
(
	`RX_QUEUE_CB_SIZE
(
å™s
->
cfg
->
num_rbds
) > 12);

206 
c⁄åﬁ_Êags
 = 
IWL_CTXT_INFO_TFD_FORMAT_LONG
;

207 
c⁄åﬁ_Êags
 |=

208 
	`u32_ícode_bôs
(
	`RX_QUEUE_CB_SIZE
(
å™s
->
cfg
->
num_rbds
),

209 
IWL_CTXT_INFO_RB_CB_SIZE
);

210 
c⁄åﬁ_Êags
 |
	`u32_ícode_bôs
(
rb_size
, 
IWL_CTXT_INFO_RB_SIZE
);

211 
˘xt_öfo
->
c⁄åﬁ
.
c⁄åﬁ_Êags
 = 
	`˝u_to_À32
(control_flags);

214 
rx_cfg
 = &
˘xt_öfo
->
rbd_cfg
;

215 
rx_cfg
->
‰ì_rbd_addr
 = 
	`˝u_to_À64
(
å™s_pcõ
->
rxq
->
bd_dma
);

216 
rx_cfg
->
u£d_rbd_addr
 = 
	`˝u_to_À64
(
å™s_pcõ
->
rxq
->
u£d_bd_dma
);

217 
rx_cfg
->
°©us_wr_±r
 = 
	`˝u_to_À64
(
å™s_pcõ
->
rxq
->
rb_°ts_dma
);

220 
˘xt_öfo
->
hcmd_cfg
.
cmd_queue_addr
 =

221 
	`˝u_to_À64
(
å™s
->
txqs
.
txq
[å™s->txqs.
cmd
.
q_id
]->
dma_addr
);

222 
˘xt_öfo
->
hcmd_cfg
.
cmd_queue_size
 =

223 
	`TFD_QUEUE_CB_SIZE
(
IWL_CMD_QUEUE_SIZE
);

226 
ªt
 = 
	`iwl_pcõ_öô_fw_£c
(
å™s
, 
fw
, &
˘xt_öfo
->
døm
);

227 i‡(
ªt
) {

228 
	`dma_‰ì_cohîít
(
å™s
->
dev
, (*
å™s_pcõ
->
˘xt_öfo
),

229 
˘xt_öfo
, 
å™s_pcõ
->
˘xt_öfo_dma_addr
);

230  
ªt
;

233 
å™s_pcõ
->
˘xt_öfo
 = ctxt_info;

235 
	`iwl_íabÀ_fw_lﬂd_öt_˘x_öfo
(
å™s
);

238 i‡(
	`iwl_pcõ_dbg_⁄
(
å™s
))

239 
	`iwl_pcõ_≠∂y_de°ö©i⁄
(
å™s
);

242 
	`iwl_wrôe64
(
å™s
, 
CSR_CTXT_INFO_BA
, 
å™s_pcõ
->
˘xt_öfo_dma_addr
);

247 
	}
}

249 
	$iwl_pcõ_˘xt_öfo_‰ì
(
iwl_å™s
 *
å™s
)

251 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

253 i‡(!
å™s_pcõ
->
˘xt_öfo
)

256 
	`dma_‰ì_cohîít
(
å™s
->
dev
, (*
å™s_pcõ
->
˘xt_öfo
),

257 
å™s_pcõ
->
˘xt_öfo
,

258 
å™s_pcõ
->
˘xt_öfo_dma_addr
);

259 
å™s_pcõ
->
˘xt_öfo_dma_addr
 = 0;

260 
å™s_pcõ
->
˘xt_öfo
 = 
NULL
;

262 
	`iwl_pcõ_˘xt_öfo_‰ì_fw_img
(
å™s
);

263 
	}
}

	@pcie/drv.c

7 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

9 
	~<löux/moduÀ.h
>

10 
	~<löux/pci.h
>

11 
	~<löux/a˝i.h
>

13 
	~"fw/a˝i.h
"

15 
	~"iwl-å™s.h
"

16 
	~"iwl-drv.h
"

17 
	~"iwl-¥ph.h
"

18 
	~"öã∫Æ.h
"

20 
	#TRANS_CFG_MARKER
 
	`BIT
(0)

	)

21 
	#_IS_A
(
cfg
, 
_°ru˘
Ë
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`ty≥of
(cfg), \

22 
_°ru˘
)

	)

23 
_övÆid_ty≥
;

24 
	#_TRANS_CFG_MARKER
(
cfg
) \

25 (
	`__buûtö_choo£_ex¥
(
	`_IS_A
(
cfg
, 
iwl_cfg_å™s_∑øms
), \

26 
TRANS_CFG_MARKER
, \

27 
	`__buûtö_choo£_ex¥
(
	`_IS_A
(
cfg
, 
iwl_cfg
), 0, 
_övÆid_ty≥
)))

	)

28 
	#_ASSIGN_CFG
(
cfg
Ë(
	`_TRANS_CFG_MARKER
(cfgË+ (
kî√l_ul⁄g_t
)&(cfg))

	)

30 
	#IWL_PCI_DEVICE
(
dev
, 
subdev
, 
cfg
) \

31 .
víd‹
 = 
PCI_VENDOR_ID_INTEL
, .
devi˚
 = (
dev
), \

32 .
subvíd‹
 = 
PCI_ANY_ID
, .
subdevi˚
 = (
subdev
), \

33 .
drivî_d©a
 = 
	`_ASSIGN_CFG
(
cfg
)

	)

36 c⁄° 
pci_devi˚_id
 
	giwl_hw_ˇrd_ids
[] = {

37 #i‡
IS_ENABLED
(
CONFIG_IWLDVM
)

38 {
IWL_PCI_DEVICE
(0x4232, 0x1201, 
iwl5100_agn_cfg
)},

39 {
IWL_PCI_DEVICE
(0x4232, 0x1301, 
iwl5100_agn_cfg
)},

40 {
IWL_PCI_DEVICE
(0x4232, 0x1204, 
iwl5100_agn_cfg
)},

41 {
IWL_PCI_DEVICE
(0x4232, 0x1304, 
iwl5100_agn_cfg
)},

42 {
IWL_PCI_DEVICE
(0x4232, 0x1205, 
iwl5100_bgn_cfg
)},

43 {
IWL_PCI_DEVICE
(0x4232, 0x1305, 
iwl5100_bgn_cfg
)},

44 {
IWL_PCI_DEVICE
(0x4232, 0x1206, 
iwl5100_abg_cfg
)},

45 {
IWL_PCI_DEVICE
(0x4232, 0x1306, 
iwl5100_abg_cfg
)},

46 {
IWL_PCI_DEVICE
(0x4232, 0x1221, 
iwl5100_agn_cfg
)},

47 {
IWL_PCI_DEVICE
(0x4232, 0x1321, 
iwl5100_agn_cfg
)},

48 {
IWL_PCI_DEVICE
(0x4232, 0x1224, 
iwl5100_agn_cfg
)},

49 {
IWL_PCI_DEVICE
(0x4232, 0x1324, 
iwl5100_agn_cfg
)},

50 {
IWL_PCI_DEVICE
(0x4232, 0x1225, 
iwl5100_bgn_cfg
)},

51 {
IWL_PCI_DEVICE
(0x4232, 0x1325, 
iwl5100_bgn_cfg
)},

52 {
IWL_PCI_DEVICE
(0x4232, 0x1226, 
iwl5100_abg_cfg
)},

53 {
IWL_PCI_DEVICE
(0x4232, 0x1326, 
iwl5100_abg_cfg
)},

54 {
IWL_PCI_DEVICE
(0x4237, 0x1211, 
iwl5100_agn_cfg
)},

55 {
IWL_PCI_DEVICE
(0x4237, 0x1311, 
iwl5100_agn_cfg
)},

56 {
IWL_PCI_DEVICE
(0x4237, 0x1214, 
iwl5100_agn_cfg
)},

57 {
IWL_PCI_DEVICE
(0x4237, 0x1314, 
iwl5100_agn_cfg
)},

58 {
IWL_PCI_DEVICE
(0x4237, 0x1215, 
iwl5100_bgn_cfg
)},

59 {
IWL_PCI_DEVICE
(0x4237, 0x1315, 
iwl5100_bgn_cfg
)},

60 {
IWL_PCI_DEVICE
(0x4237, 0x1216, 
iwl5100_abg_cfg
)},

61 {
IWL_PCI_DEVICE
(0x4237, 0x1316, 
iwl5100_abg_cfg
)},

64 {
IWL_PCI_DEVICE
(0x4235, 0x1021, 
iwl5300_agn_cfg
)},

65 {
IWL_PCI_DEVICE
(0x4235, 0x1121, 
iwl5300_agn_cfg
)},

66 {
IWL_PCI_DEVICE
(0x4235, 0x1024, 
iwl5300_agn_cfg
)},

67 {
IWL_PCI_DEVICE
(0x4235, 0x1124, 
iwl5300_agn_cfg
)},

68 {
IWL_PCI_DEVICE
(0x4235, 0x1001, 
iwl5300_agn_cfg
)},

69 {
IWL_PCI_DEVICE
(0x4235, 0x1101, 
iwl5300_agn_cfg
)},

70 {
IWL_PCI_DEVICE
(0x4235, 0x1004, 
iwl5300_agn_cfg
)},

71 {
IWL_PCI_DEVICE
(0x4235, 0x1104, 
iwl5300_agn_cfg
)},

72 {
IWL_PCI_DEVICE
(0x4236, 0x1011, 
iwl5300_agn_cfg
)},

73 {
IWL_PCI_DEVICE
(0x4236, 0x1111, 
iwl5300_agn_cfg
)},

74 {
IWL_PCI_DEVICE
(0x4236, 0x1014, 
iwl5300_agn_cfg
)},

75 {
IWL_PCI_DEVICE
(0x4236, 0x1114, 
iwl5300_agn_cfg
)},

78 {
IWL_PCI_DEVICE
(0x423A, 0x1001, 
iwl5350_agn_cfg
)},

79 {
IWL_PCI_DEVICE
(0x423A, 0x1021, 
iwl5350_agn_cfg
)},

80 {
IWL_PCI_DEVICE
(0x423B, 0x1011, 
iwl5350_agn_cfg
)},

83 {
IWL_PCI_DEVICE
(0x423C, 0x1201, 
iwl5150_agn_cfg
)},

84 {
IWL_PCI_DEVICE
(0x423C, 0x1301, 
iwl5150_agn_cfg
)},

85 {
IWL_PCI_DEVICE
(0x423C, 0x1206, 
iwl5150_abg_cfg
)},

86 {
IWL_PCI_DEVICE
(0x423C, 0x1306, 
iwl5150_abg_cfg
)},

87 {
IWL_PCI_DEVICE
(0x423C, 0x1221, 
iwl5150_agn_cfg
)},

88 {
IWL_PCI_DEVICE
(0x423C, 0x1321, 
iwl5150_agn_cfg
)},

89 {
IWL_PCI_DEVICE
(0x423C, 0x1326, 
iwl5150_abg_cfg
)},

91 {
IWL_PCI_DEVICE
(0x423D, 0x1211, 
iwl5150_agn_cfg
)},

92 {
IWL_PCI_DEVICE
(0x423D, 0x1311, 
iwl5150_agn_cfg
)},

93 {
IWL_PCI_DEVICE
(0x423D, 0x1216, 
iwl5150_abg_cfg
)},

94 {
IWL_PCI_DEVICE
(0x423D, 0x1316, 
iwl5150_abg_cfg
)},

97 {
IWL_PCI_DEVICE
(0x422B, 0x1101, 
iwl6000_3agn_cfg
)},

98 {
IWL_PCI_DEVICE
(0x422B, 0x1108, 
iwl6000_3agn_cfg
)},

99 {
IWL_PCI_DEVICE
(0x422B, 0x1121, 
iwl6000_3agn_cfg
)},

100 {
IWL_PCI_DEVICE
(0x422B, 0x1128, 
iwl6000_3agn_cfg
)},

101 {
IWL_PCI_DEVICE
(0x422C, 0x1301, 
iwl6000i_2agn_cfg
)},

102 {
IWL_PCI_DEVICE
(0x422C, 0x1306, 
iwl6000i_2abg_cfg
)},

103 {
IWL_PCI_DEVICE
(0x422C, 0x1307, 
iwl6000i_2bg_cfg
)},

104 {
IWL_PCI_DEVICE
(0x422C, 0x1321, 
iwl6000i_2agn_cfg
)},

105 {
IWL_PCI_DEVICE
(0x422C, 0x1326, 
iwl6000i_2abg_cfg
)},

106 {
IWL_PCI_DEVICE
(0x4238, 0x1111, 
iwl6000_3agn_cfg
)},

107 {
IWL_PCI_DEVICE
(0x4238, 0x1118, 
iwl6000_3agn_cfg
)},

108 {
IWL_PCI_DEVICE
(0x4239, 0x1311, 
iwl6000i_2agn_cfg
)},

109 {
IWL_PCI_DEVICE
(0x4239, 0x1316, 
iwl6000i_2abg_cfg
)},

112 {
IWL_PCI_DEVICE
(0x0082, 0x1301, 
iwl6005_2agn_cfg
)},

113 {
IWL_PCI_DEVICE
(0x0082, 0x1306, 
iwl6005_2abg_cfg
)},

114 {
IWL_PCI_DEVICE
(0x0082, 0x1307, 
iwl6005_2bg_cfg
)},

115 {
IWL_PCI_DEVICE
(0x0082, 0x1308, 
iwl6005_2agn_cfg
)},

116 {
IWL_PCI_DEVICE
(0x0082, 0x1321, 
iwl6005_2agn_cfg
)},

117 {
IWL_PCI_DEVICE
(0x0082, 0x1326, 
iwl6005_2abg_cfg
)},

118 {
IWL_PCI_DEVICE
(0x0082, 0x1328, 
iwl6005_2agn_cfg
)},

119 {
IWL_PCI_DEVICE
(0x0085, 0x1311, 
iwl6005_2agn_cfg
)},

120 {
IWL_PCI_DEVICE
(0x0085, 0x1318, 
iwl6005_2agn_cfg
)},

121 {
IWL_PCI_DEVICE
(0x0085, 0x1316, 
iwl6005_2abg_cfg
)},

122 {
IWL_PCI_DEVICE
(0x0082, 0xC020, 
iwl6005_2agn_sff_cfg
)},

123 {
IWL_PCI_DEVICE
(0x0085, 0xC220, 
iwl6005_2agn_sff_cfg
)},

124 {
IWL_PCI_DEVICE
(0x0085, 0xC228, 
iwl6005_2agn_sff_cfg
)},

125 {
IWL_PCI_DEVICE
(0x0082, 0x4820, 
iwl6005_2agn_d_cfg
)},

126 {
IWL_PCI_DEVICE
(0x0082, 0x1304, 
iwl6005_2agn_mow1_cfg
)},

127 {
IWL_PCI_DEVICE
(0x0082, 0x1305, 
iwl6005_2agn_mow2_cfg
)},

130 {
IWL_PCI_DEVICE
(0x008A, 0x5305, 
iwl1030_bgn_cfg
)},

131 {
IWL_PCI_DEVICE
(0x008A, 0x5307, 
iwl1030_bg_cfg
)},

132 {
IWL_PCI_DEVICE
(0x008A, 0x5325, 
iwl1030_bgn_cfg
)},

133 {
IWL_PCI_DEVICE
(0x008A, 0x5327, 
iwl1030_bg_cfg
)},

134 {
IWL_PCI_DEVICE
(0x008B, 0x5315, 
iwl1030_bgn_cfg
)},

135 {
IWL_PCI_DEVICE
(0x008B, 0x5317, 
iwl1030_bg_cfg
)},

136 {
IWL_PCI_DEVICE
(0x0090, 0x5211, 
iwl6030_2agn_cfg
)},

137 {
IWL_PCI_DEVICE
(0x0090, 0x5215, 
iwl6030_2bgn_cfg
)},

138 {
IWL_PCI_DEVICE
(0x0090, 0x5216, 
iwl6030_2abg_cfg
)},

139 {
IWL_PCI_DEVICE
(0x0091, 0x5201, 
iwl6030_2agn_cfg
)},

140 {
IWL_PCI_DEVICE
(0x0091, 0x5205, 
iwl6030_2bgn_cfg
)},

141 {
IWL_PCI_DEVICE
(0x0091, 0x5206, 
iwl6030_2abg_cfg
)},

142 {
IWL_PCI_DEVICE
(0x0091, 0x5207, 
iwl6030_2bg_cfg
)},

143 {
IWL_PCI_DEVICE
(0x0091, 0x5221, 
iwl6030_2agn_cfg
)},

144 {
IWL_PCI_DEVICE
(0x0091, 0x5225, 
iwl6030_2bgn_cfg
)},

145 {
IWL_PCI_DEVICE
(0x0091, 0x5226, 
iwl6030_2abg_cfg
)},

148 {
IWL_PCI_DEVICE
(0x0087, 0x1301, 
iwl6050_2agn_cfg
)},

149 {
IWL_PCI_DEVICE
(0x0087, 0x1306, 
iwl6050_2abg_cfg
)},

150 {
IWL_PCI_DEVICE
(0x0087, 0x1321, 
iwl6050_2agn_cfg
)},

151 {
IWL_PCI_DEVICE
(0x0087, 0x1326, 
iwl6050_2abg_cfg
)},

152 {
IWL_PCI_DEVICE
(0x0089, 0x1311, 
iwl6050_2agn_cfg
)},

153 {
IWL_PCI_DEVICE
(0x0089, 0x1316, 
iwl6050_2abg_cfg
)},

156 {
IWL_PCI_DEVICE
(0x0885, 0x1305, 
iwl6150_bgn_cfg
)},

157 {
IWL_PCI_DEVICE
(0x0885, 0x1307, 
iwl6150_bg_cfg
)},

158 {
IWL_PCI_DEVICE
(0x0885, 0x1325, 
iwl6150_bgn_cfg
)},

159 {
IWL_PCI_DEVICE
(0x0885, 0x1327, 
iwl6150_bg_cfg
)},

160 {
IWL_PCI_DEVICE
(0x0886, 0x1315, 
iwl6150_bgn_cfg
)},

161 {
IWL_PCI_DEVICE
(0x0886, 0x1317, 
iwl6150_bg_cfg
)},

164 {
IWL_PCI_DEVICE
(0x0083, 0x1205, 
iwl1000_bgn_cfg
)},

165 {
IWL_PCI_DEVICE
(0x0083, 0x1305, 
iwl1000_bgn_cfg
)},

166 {
IWL_PCI_DEVICE
(0x0083, 0x1225, 
iwl1000_bgn_cfg
)},

167 {
IWL_PCI_DEVICE
(0x0083, 0x1325, 
iwl1000_bgn_cfg
)},

168 {
IWL_PCI_DEVICE
(0x0084, 0x1215, 
iwl1000_bgn_cfg
)},

169 {
IWL_PCI_DEVICE
(0x0084, 0x1315, 
iwl1000_bgn_cfg
)},

170 {
IWL_PCI_DEVICE
(0x0083, 0x1206, 
iwl1000_bg_cfg
)},

171 {
IWL_PCI_DEVICE
(0x0083, 0x1306, 
iwl1000_bg_cfg
)},

172 {
IWL_PCI_DEVICE
(0x0083, 0x1226, 
iwl1000_bg_cfg
)},

173 {
IWL_PCI_DEVICE
(0x0083, 0x1326, 
iwl1000_bg_cfg
)},

174 {
IWL_PCI_DEVICE
(0x0084, 0x1216, 
iwl1000_bg_cfg
)},

175 {
IWL_PCI_DEVICE
(0x0084, 0x1316, 
iwl1000_bg_cfg
)},

178 {
IWL_PCI_DEVICE
(0x08AE, 0x1005, 
iwl100_bgn_cfg
)},

179 {
IWL_PCI_DEVICE
(0x08AE, 0x1007, 
iwl100_bg_cfg
)},

180 {
IWL_PCI_DEVICE
(0x08AF, 0x1015, 
iwl100_bgn_cfg
)},

181 {
IWL_PCI_DEVICE
(0x08AF, 0x1017, 
iwl100_bg_cfg
)},

182 {
IWL_PCI_DEVICE
(0x08AE, 0x1025, 
iwl100_bgn_cfg
)},

183 {
IWL_PCI_DEVICE
(0x08AE, 0x1027, 
iwl100_bg_cfg
)},

186 {
IWL_PCI_DEVICE
(0x0896, 0x5005, 
iwl130_bgn_cfg
)},

187 {
IWL_PCI_DEVICE
(0x0896, 0x5007, 
iwl130_bg_cfg
)},

188 {
IWL_PCI_DEVICE
(0x0897, 0x5015, 
iwl130_bgn_cfg
)},

189 {
IWL_PCI_DEVICE
(0x0897, 0x5017, 
iwl130_bg_cfg
)},

190 {
IWL_PCI_DEVICE
(0x0896, 0x5025, 
iwl130_bgn_cfg
)},

191 {
IWL_PCI_DEVICE
(0x0896, 0x5027, 
iwl130_bg_cfg
)},

194 {
IWL_PCI_DEVICE
(0x0890, 0x4022, 
iwl2000_2bgn_cfg
)},

195 {
IWL_PCI_DEVICE
(0x0891, 0x4222, 
iwl2000_2bgn_cfg
)},

196 {
IWL_PCI_DEVICE
(0x0890, 0x4422, 
iwl2000_2bgn_cfg
)},

197 {
IWL_PCI_DEVICE
(0x0890, 0x4822, 
iwl2000_2bgn_d_cfg
)},

200 {
IWL_PCI_DEVICE
(0x0887, 0x4062, 
iwl2030_2bgn_cfg
)},

201 {
IWL_PCI_DEVICE
(0x0888, 0x4262, 
iwl2030_2bgn_cfg
)},

202 {
IWL_PCI_DEVICE
(0x0887, 0x4462, 
iwl2030_2bgn_cfg
)},

205 {
IWL_PCI_DEVICE
(0x088E, 0x4060, 
iwl6035_2agn_cfg
)},

206 {
IWL_PCI_DEVICE
(0x088E, 0x406A, 
iwl6035_2agn_sff_cfg
)},

207 {
IWL_PCI_DEVICE
(0x088F, 0x4260, 
iwl6035_2agn_cfg
)},

208 {
IWL_PCI_DEVICE
(0x088F, 0x426A, 
iwl6035_2agn_sff_cfg
)},

209 {
IWL_PCI_DEVICE
(0x088E, 0x4460, 
iwl6035_2agn_cfg
)},

210 {
IWL_PCI_DEVICE
(0x088E, 0x446A, 
iwl6035_2agn_sff_cfg
)},

211 {
IWL_PCI_DEVICE
(0x088E, 0x4860, 
iwl6035_2agn_cfg
)},

212 {
IWL_PCI_DEVICE
(0x088F, 0x5260, 
iwl6035_2agn_cfg
)},

215 {
IWL_PCI_DEVICE
(0x0894, 0x0022, 
iwl105_bgn_cfg
)},

216 {
IWL_PCI_DEVICE
(0x0895, 0x0222, 
iwl105_bgn_cfg
)},

217 {
IWL_PCI_DEVICE
(0x0894, 0x0422, 
iwl105_bgn_cfg
)},

218 {
IWL_PCI_DEVICE
(0x0894, 0x0822, 
iwl105_bgn_d_cfg
)},

221 {
IWL_PCI_DEVICE
(0x0892, 0x0062, 
iwl135_bgn_cfg
)},

222 {
IWL_PCI_DEVICE
(0x0893, 0x0262, 
iwl135_bgn_cfg
)},

223 {
IWL_PCI_DEVICE
(0x0892, 0x0462, 
iwl135_bgn_cfg
)},

226 #i‡
IS_ENABLED
(
CONFIG_IWLMVM
)

228 {
IWL_PCI_DEVICE
(0x08B1, 0x4070, 
iwl7260_2ac_cfg
)},

229 {
IWL_PCI_DEVICE
(0x08B1, 0x4072, 
iwl7260_2ac_cfg
)},

230 {
IWL_PCI_DEVICE
(0x08B1, 0x4170, 
iwl7260_2ac_cfg
)},

231 {
IWL_PCI_DEVICE
(0x08B1, 0x4C60, 
iwl7260_2ac_cfg
)},

232 {
IWL_PCI_DEVICE
(0x08B1, 0x4C70, 
iwl7260_2ac_cfg
)},

233 {
IWL_PCI_DEVICE
(0x08B1, 0x4060, 
iwl7260_2n_cfg
)},

234 {
IWL_PCI_DEVICE
(0x08B1, 0x406A, 
iwl7260_2n_cfg
)},

235 {
IWL_PCI_DEVICE
(0x08B1, 0x4160, 
iwl7260_2n_cfg
)},

236 {
IWL_PCI_DEVICE
(0x08B1, 0x4062, 
iwl7260_n_cfg
)},

237 {
IWL_PCI_DEVICE
(0x08B1, 0x4162, 
iwl7260_n_cfg
)},

238 {
IWL_PCI_DEVICE
(0x08B2, 0x4270, 
iwl7260_2ac_cfg
)},

239 {
IWL_PCI_DEVICE
(0x08B2, 0x4272, 
iwl7260_2ac_cfg
)},

240 {
IWL_PCI_DEVICE
(0x08B2, 0x4260, 
iwl7260_2n_cfg
)},

241 {
IWL_PCI_DEVICE
(0x08B2, 0x426A, 
iwl7260_2n_cfg
)},

242 {
IWL_PCI_DEVICE
(0x08B2, 0x4262, 
iwl7260_n_cfg
)},

243 {
IWL_PCI_DEVICE
(0x08B1, 0x4470, 
iwl7260_2ac_cfg
)},

244 {
IWL_PCI_DEVICE
(0x08B1, 0x4472, 
iwl7260_2ac_cfg
)},

245 {
IWL_PCI_DEVICE
(0x08B1, 0x4460, 
iwl7260_2n_cfg
)},

246 {
IWL_PCI_DEVICE
(0x08B1, 0x446A, 
iwl7260_2n_cfg
)},

247 {
IWL_PCI_DEVICE
(0x08B1, 0x4462, 
iwl7260_n_cfg
)},

248 {
IWL_PCI_DEVICE
(0x08B1, 0x4870, 
iwl7260_2ac_cfg
)},

249 {
IWL_PCI_DEVICE
(0x08B1, 0x486E, 
iwl7260_2ac_cfg
)},

250 {
IWL_PCI_DEVICE
(0x08B1, 0x4A70, 
iwl7260_2ac_cfg_high_ãmp
)},

251 {
IWL_PCI_DEVICE
(0x08B1, 0x4A6E, 
iwl7260_2ac_cfg_high_ãmp
)},

252 {
IWL_PCI_DEVICE
(0x08B1, 0x4A6C, 
iwl7260_2ac_cfg_high_ãmp
)},

253 {
IWL_PCI_DEVICE
(0x08B1, 0x4570, 
iwl7260_2ac_cfg
)},

254 {
IWL_PCI_DEVICE
(0x08B1, 0x4560, 
iwl7260_2n_cfg
)},

255 {
IWL_PCI_DEVICE
(0x08B2, 0x4370, 
iwl7260_2ac_cfg
)},

256 {
IWL_PCI_DEVICE
(0x08B2, 0x4360, 
iwl7260_2n_cfg
)},

257 {
IWL_PCI_DEVICE
(0x08B1, 0x5070, 
iwl7260_2ac_cfg
)},

258 {
IWL_PCI_DEVICE
(0x08B1, 0x5072, 
iwl7260_2ac_cfg
)},

259 {
IWL_PCI_DEVICE
(0x08B1, 0x5170, 
iwl7260_2ac_cfg
)},

260 {
IWL_PCI_DEVICE
(0x08B1, 0x5770, 
iwl7260_2ac_cfg
)},

261 {
IWL_PCI_DEVICE
(0x08B1, 0x4020, 
iwl7260_2n_cfg
)},

262 {
IWL_PCI_DEVICE
(0x08B1, 0x402A, 
iwl7260_2n_cfg
)},

263 {
IWL_PCI_DEVICE
(0x08B2, 0x4220, 
iwl7260_2n_cfg
)},

264 {
IWL_PCI_DEVICE
(0x08B1, 0x4420, 
iwl7260_2n_cfg
)},

265 {
IWL_PCI_DEVICE
(0x08B1, 0xC070, 
iwl7260_2ac_cfg
)},

266 {
IWL_PCI_DEVICE
(0x08B1, 0xC072, 
iwl7260_2ac_cfg
)},

267 {
IWL_PCI_DEVICE
(0x08B1, 0xC170, 
iwl7260_2ac_cfg
)},

268 {
IWL_PCI_DEVICE
(0x08B1, 0xC060, 
iwl7260_2n_cfg
)},

269 {
IWL_PCI_DEVICE
(0x08B1, 0xC06A, 
iwl7260_2n_cfg
)},

270 {
IWL_PCI_DEVICE
(0x08B1, 0xC160, 
iwl7260_2n_cfg
)},

271 {
IWL_PCI_DEVICE
(0x08B1, 0xC062, 
iwl7260_n_cfg
)},

272 {
IWL_PCI_DEVICE
(0x08B1, 0xC162, 
iwl7260_n_cfg
)},

273 {
IWL_PCI_DEVICE
(0x08B1, 0xC770, 
iwl7260_2ac_cfg
)},

274 {
IWL_PCI_DEVICE
(0x08B1, 0xC760, 
iwl7260_2n_cfg
)},

275 {
IWL_PCI_DEVICE
(0x08B2, 0xC270, 
iwl7260_2ac_cfg
)},

276 {
IWL_PCI_DEVICE
(0x08B1, 0xCC70, 
iwl7260_2ac_cfg
)},

277 {
IWL_PCI_DEVICE
(0x08B1, 0xCC60, 
iwl7260_2ac_cfg
)},

278 {
IWL_PCI_DEVICE
(0x08B2, 0xC272, 
iwl7260_2ac_cfg
)},

279 {
IWL_PCI_DEVICE
(0x08B2, 0xC260, 
iwl7260_2n_cfg
)},

280 {
IWL_PCI_DEVICE
(0x08B2, 0xC26A, 
iwl7260_n_cfg
)},

281 {
IWL_PCI_DEVICE
(0x08B2, 0xC262, 
iwl7260_n_cfg
)},

282 {
IWL_PCI_DEVICE
(0x08B1, 0xC470, 
iwl7260_2ac_cfg
)},

283 {
IWL_PCI_DEVICE
(0x08B1, 0xC472, 
iwl7260_2ac_cfg
)},

284 {
IWL_PCI_DEVICE
(0x08B1, 0xC460, 
iwl7260_2n_cfg
)},

285 {
IWL_PCI_DEVICE
(0x08B1, 0xC462, 
iwl7260_n_cfg
)},

286 {
IWL_PCI_DEVICE
(0x08B1, 0xC570, 
iwl7260_2ac_cfg
)},

287 {
IWL_PCI_DEVICE
(0x08B1, 0xC560, 
iwl7260_2n_cfg
)},

288 {
IWL_PCI_DEVICE
(0x08B2, 0xC370, 
iwl7260_2ac_cfg
)},

289 {
IWL_PCI_DEVICE
(0x08B1, 0xC360, 
iwl7260_2n_cfg
)},

290 {
IWL_PCI_DEVICE
(0x08B1, 0xC020, 
iwl7260_2n_cfg
)},

291 {
IWL_PCI_DEVICE
(0x08B1, 0xC02A, 
iwl7260_2n_cfg
)},

292 {
IWL_PCI_DEVICE
(0x08B2, 0xC220, 
iwl7260_2n_cfg
)},

293 {
IWL_PCI_DEVICE
(0x08B1, 0xC420, 
iwl7260_2n_cfg
)},

296 {
IWL_PCI_DEVICE
(0x08B3, 0x0070, 
iwl3160_2ac_cfg
)},

297 {
IWL_PCI_DEVICE
(0x08B3, 0x0072, 
iwl3160_2ac_cfg
)},

298 {
IWL_PCI_DEVICE
(0x08B3, 0x0170, 
iwl3160_2ac_cfg
)},

299 {
IWL_PCI_DEVICE
(0x08B3, 0x0172, 
iwl3160_2ac_cfg
)},

300 {
IWL_PCI_DEVICE
(0x08B3, 0x0060, 
iwl3160_2n_cfg
)},

301 {
IWL_PCI_DEVICE
(0x08B3, 0x0062, 
iwl3160_n_cfg
)},

302 {
IWL_PCI_DEVICE
(0x08B4, 0x0270, 
iwl3160_2ac_cfg
)},

303 {
IWL_PCI_DEVICE
(0x08B4, 0x0272, 
iwl3160_2ac_cfg
)},

304 {
IWL_PCI_DEVICE
(0x08B3, 0x0470, 
iwl3160_2ac_cfg
)},

305 {
IWL_PCI_DEVICE
(0x08B3, 0x0472, 
iwl3160_2ac_cfg
)},

306 {
IWL_PCI_DEVICE
(0x08B4, 0x0370, 
iwl3160_2ac_cfg
)},

307 {
IWL_PCI_DEVICE
(0x08B3, 0x8070, 
iwl3160_2ac_cfg
)},

308 {
IWL_PCI_DEVICE
(0x08B3, 0x8072, 
iwl3160_2ac_cfg
)},

309 {
IWL_PCI_DEVICE
(0x08B3, 0x8170, 
iwl3160_2ac_cfg
)},

310 {
IWL_PCI_DEVICE
(0x08B3, 0x8172, 
iwl3160_2ac_cfg
)},

311 {
IWL_PCI_DEVICE
(0x08B3, 0x8060, 
iwl3160_2n_cfg
)},

312 {
IWL_PCI_DEVICE
(0x08B3, 0x8062, 
iwl3160_n_cfg
)},

313 {
IWL_PCI_DEVICE
(0x08B4, 0x8270, 
iwl3160_2ac_cfg
)},

314 {
IWL_PCI_DEVICE
(0x08B4, 0x8370, 
iwl3160_2ac_cfg
)},

315 {
IWL_PCI_DEVICE
(0x08B4, 0x8272, 
iwl3160_2ac_cfg
)},

316 {
IWL_PCI_DEVICE
(0x08B3, 0x8470, 
iwl3160_2ac_cfg
)},

317 {
IWL_PCI_DEVICE
(0x08B3, 0x8570, 
iwl3160_2ac_cfg
)},

318 {
IWL_PCI_DEVICE
(0x08B3, 0x1070, 
iwl3160_2ac_cfg
)},

319 {
IWL_PCI_DEVICE
(0x08B3, 0x1170, 
iwl3160_2ac_cfg
)},

322 {
IWL_PCI_DEVICE
(0x3165, 0x4010, 
iwl3165_2ac_cfg
)},

323 {
IWL_PCI_DEVICE
(0x3165, 0x4012, 
iwl3165_2ac_cfg
)},

324 {
IWL_PCI_DEVICE
(0x3166, 0x4212, 
iwl3165_2ac_cfg
)},

325 {
IWL_PCI_DEVICE
(0x3165, 0x4410, 
iwl3165_2ac_cfg
)},

326 {
IWL_PCI_DEVICE
(0x3165, 0x4510, 
iwl3165_2ac_cfg
)},

327 {
IWL_PCI_DEVICE
(0x3165, 0x4110, 
iwl3165_2ac_cfg
)},

328 {
IWL_PCI_DEVICE
(0x3166, 0x4310, 
iwl3165_2ac_cfg
)},

329 {
IWL_PCI_DEVICE
(0x3166, 0x4210, 
iwl3165_2ac_cfg
)},

330 {
IWL_PCI_DEVICE
(0x3165, 0x8010, 
iwl3165_2ac_cfg
)},

331 {
IWL_PCI_DEVICE
(0x3165, 0x8110, 
iwl3165_2ac_cfg
)},

334 {
IWL_PCI_DEVICE
(0x24FB, 0x2010, 
iwl3168_2ac_cfg
)},

335 {
IWL_PCI_DEVICE
(0x24FB, 0x2110, 
iwl3168_2ac_cfg
)},

336 {
IWL_PCI_DEVICE
(0x24FB, 0x2050, 
iwl3168_2ac_cfg
)},

337 {
IWL_PCI_DEVICE
(0x24FB, 0x2150, 
iwl3168_2ac_cfg
)},

338 {
IWL_PCI_DEVICE
(0x24FB, 0x0000, 
iwl3168_2ac_cfg
)},

341 {
IWL_PCI_DEVICE
(0x095A, 0x5010, 
iwl7265_2ac_cfg
)},

342 {
IWL_PCI_DEVICE
(0x095A, 0x5110, 
iwl7265_2ac_cfg
)},

343 {
IWL_PCI_DEVICE
(0x095A, 0x5100, 
iwl7265_2ac_cfg
)},

344 {
IWL_PCI_DEVICE
(0x095B, 0x5310, 
iwl7265_2ac_cfg
)},

345 {
IWL_PCI_DEVICE
(0x095B, 0x5302, 
iwl7265_n_cfg
)},

346 {
IWL_PCI_DEVICE
(0x095B, 0x5210, 
iwl7265_2ac_cfg
)},

347 {
IWL_PCI_DEVICE
(0x095A, 0x5C10, 
iwl7265_2ac_cfg
)},

348 {
IWL_PCI_DEVICE
(0x095A, 0x5012, 
iwl7265_2ac_cfg
)},

349 {
IWL_PCI_DEVICE
(0x095A, 0x5412, 
iwl7265_2ac_cfg
)},

350 {
IWL_PCI_DEVICE
(0x095A, 0x5410, 
iwl7265_2ac_cfg
)},

351 {
IWL_PCI_DEVICE
(0x095A, 0x5510, 
iwl7265_2ac_cfg
)},

352 {
IWL_PCI_DEVICE
(0x095A, 0x5400, 
iwl7265_2ac_cfg
)},

353 {
IWL_PCI_DEVICE
(0x095A, 0x1010, 
iwl7265_2ac_cfg
)},

354 {
IWL_PCI_DEVICE
(0x095A, 0x5000, 
iwl7265_2n_cfg
)},

355 {
IWL_PCI_DEVICE
(0x095A, 0x500A, 
iwl7265_2n_cfg
)},

356 {
IWL_PCI_DEVICE
(0x095B, 0x5200, 
iwl7265_2n_cfg
)},

357 {
IWL_PCI_DEVICE
(0x095A, 0x5002, 
iwl7265_n_cfg
)},

358 {
IWL_PCI_DEVICE
(0x095A, 0x5102, 
iwl7265_n_cfg
)},

359 {
IWL_PCI_DEVICE
(0x095B, 0x5202, 
iwl7265_n_cfg
)},

360 {
IWL_PCI_DEVICE
(0x095A, 0x9010, 
iwl7265_2ac_cfg
)},

361 {
IWL_PCI_DEVICE
(0x095A, 0x9012, 
iwl7265_2ac_cfg
)},

362 {
IWL_PCI_DEVICE
(0x095A, 0x900A, 
iwl7265_2ac_cfg
)},

363 {
IWL_PCI_DEVICE
(0x095A, 0x9110, 
iwl7265_2ac_cfg
)},

364 {
IWL_PCI_DEVICE
(0x095A, 0x9112, 
iwl7265_2ac_cfg
)},

365 {
IWL_PCI_DEVICE
(0x095B, 0x9210, 
iwl7265_2ac_cfg
)},

366 {
IWL_PCI_DEVICE
(0x095B, 0x9200, 
iwl7265_2ac_cfg
)},

367 {
IWL_PCI_DEVICE
(0x095A, 0x9510, 
iwl7265_2ac_cfg
)},

368 {
IWL_PCI_DEVICE
(0x095B, 0x9310, 
iwl7265_2ac_cfg
)},

369 {
IWL_PCI_DEVICE
(0x095A, 0x9410, 
iwl7265_2ac_cfg
)},

370 {
IWL_PCI_DEVICE
(0x095A, 0x5020, 
iwl7265_2n_cfg
)},

371 {
IWL_PCI_DEVICE
(0x095A, 0x502A, 
iwl7265_2n_cfg
)},

372 {
IWL_PCI_DEVICE
(0x095A, 0x5420, 
iwl7265_2n_cfg
)},

373 {
IWL_PCI_DEVICE
(0x095A, 0x5090, 
iwl7265_2ac_cfg
)},

374 {
IWL_PCI_DEVICE
(0x095A, 0x5190, 
iwl7265_2ac_cfg
)},

375 {
IWL_PCI_DEVICE
(0x095A, 0x5590, 
iwl7265_2ac_cfg
)},

376 {
IWL_PCI_DEVICE
(0x095B, 0x5290, 
iwl7265_2ac_cfg
)},

377 {
IWL_PCI_DEVICE
(0x095A, 0x5490, 
iwl7265_2ac_cfg
)},

378 {
IWL_PCI_DEVICE
(0x095A, 0x5F10, 
iwl7265_2ac_cfg
)},

379 {
IWL_PCI_DEVICE
(0x095B, 0x5212, 
iwl7265_2ac_cfg
)},

380 {
IWL_PCI_DEVICE
(0x095B, 0x520A, 
iwl7265_2ac_cfg
)},

381 {
IWL_PCI_DEVICE
(0x095A, 0x9000, 
iwl7265_2ac_cfg
)},

382 {
IWL_PCI_DEVICE
(0x095A, 0x9400, 
iwl7265_2ac_cfg
)},

383 {
IWL_PCI_DEVICE
(0x095A, 0x9E10, 
iwl7265_2ac_cfg
)},

386 {
IWL_PCI_DEVICE
(0x24F3, 0x0010, 
iwl8260_2ac_cfg
)},

387 {
IWL_PCI_DEVICE
(0x24F3, 0x1010, 
iwl8260_2ac_cfg
)},

388 {
IWL_PCI_DEVICE
(0x24F3, 0x10B0, 
iwl8260_2ac_cfg
)},

389 {
IWL_PCI_DEVICE
(0x24F3, 0x0130, 
iwl8260_2ac_cfg
)},

390 {
IWL_PCI_DEVICE
(0x24F3, 0x1130, 
iwl8260_2ac_cfg
)},

391 {
IWL_PCI_DEVICE
(0x24F3, 0x0132, 
iwl8260_2ac_cfg
)},

392 {
IWL_PCI_DEVICE
(0x24F3, 0x1132, 
iwl8260_2ac_cfg
)},

393 {
IWL_PCI_DEVICE
(0x24F3, 0x0110, 
iwl8260_2ac_cfg
)},

394 {
IWL_PCI_DEVICE
(0x24F3, 0x01F0, 
iwl8260_2ac_cfg
)},

395 {
IWL_PCI_DEVICE
(0x24F3, 0x0012, 
iwl8260_2ac_cfg
)},

396 {
IWL_PCI_DEVICE
(0x24F3, 0x1012, 
iwl8260_2ac_cfg
)},

397 {
IWL_PCI_DEVICE
(0x24F3, 0x1110, 
iwl8260_2ac_cfg
)},

398 {
IWL_PCI_DEVICE
(0x24F3, 0x0050, 
iwl8260_2ac_cfg
)},

399 {
IWL_PCI_DEVICE
(0x24F3, 0x0250, 
iwl8260_2ac_cfg
)},

400 {
IWL_PCI_DEVICE
(0x24F3, 0x1050, 
iwl8260_2ac_cfg
)},

401 {
IWL_PCI_DEVICE
(0x24F3, 0x0150, 
iwl8260_2ac_cfg
)},

402 {
IWL_PCI_DEVICE
(0x24F3, 0x1150, 
iwl8260_2ac_cfg
)},

403 {
IWL_PCI_DEVICE
(0x24F4, 0x0030, 
iwl8260_2ac_cfg
)},

404 {
IWL_PCI_DEVICE
(0x24F4, 0x1030, 
iwl8260_2ac_cfg
)},

405 {
IWL_PCI_DEVICE
(0x24F3, 0xC010, 
iwl8260_2ac_cfg
)},

406 {
IWL_PCI_DEVICE
(0x24F3, 0xC110, 
iwl8260_2ac_cfg
)},

407 {
IWL_PCI_DEVICE
(0x24F3, 0xD010, 
iwl8260_2ac_cfg
)},

408 {
IWL_PCI_DEVICE
(0x24F3, 0xC050, 
iwl8260_2ac_cfg
)},

409 {
IWL_PCI_DEVICE
(0x24F3, 0xD050, 
iwl8260_2ac_cfg
)},

410 {
IWL_PCI_DEVICE
(0x24F3, 0xD0B0, 
iwl8260_2ac_cfg
)},

411 {
IWL_PCI_DEVICE
(0x24F3, 0xB0B0, 
iwl8260_2ac_cfg
)},

412 {
IWL_PCI_DEVICE
(0x24F3, 0x8010, 
iwl8260_2ac_cfg
)},

413 {
IWL_PCI_DEVICE
(0x24F3, 0x8110, 
iwl8260_2ac_cfg
)},

414 {
IWL_PCI_DEVICE
(0x24F3, 0x9010, 
iwl8260_2ac_cfg
)},

415 {
IWL_PCI_DEVICE
(0x24F3, 0x9110, 
iwl8260_2ac_cfg
)},

416 {
IWL_PCI_DEVICE
(0x24F4, 0x8030, 
iwl8260_2ac_cfg
)},

417 {
IWL_PCI_DEVICE
(0x24F4, 0x9030, 
iwl8260_2ac_cfg
)},

418 {
IWL_PCI_DEVICE
(0x24F4, 0xC030, 
iwl8260_2ac_cfg
)},

419 {
IWL_PCI_DEVICE
(0x24F4, 0xD030, 
iwl8260_2ac_cfg
)},

420 {
IWL_PCI_DEVICE
(0x24F3, 0x8130, 
iwl8260_2ac_cfg
)},

421 {
IWL_PCI_DEVICE
(0x24F3, 0x9130, 
iwl8260_2ac_cfg
)},

422 {
IWL_PCI_DEVICE
(0x24F3, 0x8132, 
iwl8260_2ac_cfg
)},

423 {
IWL_PCI_DEVICE
(0x24F3, 0x9132, 
iwl8260_2ac_cfg
)},

424 {
IWL_PCI_DEVICE
(0x24F3, 0x8050, 
iwl8260_2ac_cfg
)},

425 {
IWL_PCI_DEVICE
(0x24F3, 0x8150, 
iwl8260_2ac_cfg
)},

426 {
IWL_PCI_DEVICE
(0x24F3, 0x9050, 
iwl8260_2ac_cfg
)},

427 {
IWL_PCI_DEVICE
(0x24F3, 0x9150, 
iwl8260_2ac_cfg
)},

428 {
IWL_PCI_DEVICE
(0x24F3, 0x0004, 
iwl8260_2n_cfg
)},

429 {
IWL_PCI_DEVICE
(0x24F3, 0x0044, 
iwl8260_2n_cfg
)},

430 {
IWL_PCI_DEVICE
(0x24F5, 0x0010, 
iwl4165_2ac_cfg
)},

431 {
IWL_PCI_DEVICE
(0x24F6, 0x0030, 
iwl4165_2ac_cfg
)},

432 {
IWL_PCI_DEVICE
(0x24F3, 0x0810, 
iwl8260_2ac_cfg
)},

433 {
IWL_PCI_DEVICE
(0x24F3, 0x0910, 
iwl8260_2ac_cfg
)},

434 {
IWL_PCI_DEVICE
(0x24F3, 0x0850, 
iwl8260_2ac_cfg
)},

435 {
IWL_PCI_DEVICE
(0x24F3, 0x0950, 
iwl8260_2ac_cfg
)},

436 {
IWL_PCI_DEVICE
(0x24F3, 0x0930, 
iwl8260_2ac_cfg
)},

437 {
IWL_PCI_DEVICE
(0x24F3, 0x0000, 
iwl8265_2ac_cfg
)},

438 {
IWL_PCI_DEVICE
(0x24F3, 0x4010, 
iwl8260_2ac_cfg
)},

439 {
IWL_PCI_DEVICE
(0x24FD, 0x0010, 
iwl8265_2ac_cfg
)},

440 {
IWL_PCI_DEVICE
(0x24FD, 0x0110, 
iwl8265_2ac_cfg
)},

441 {
IWL_PCI_DEVICE
(0x24FD, 0x1110, 
iwl8265_2ac_cfg
)},

442 {
IWL_PCI_DEVICE
(0x24FD, 0x1130, 
iwl8265_2ac_cfg
)},

443 {
IWL_PCI_DEVICE
(0x24FD, 0x0130, 
iwl8265_2ac_cfg
)},

444 {
IWL_PCI_DEVICE
(0x24FD, 0x1010, 
iwl8265_2ac_cfg
)},

445 {
IWL_PCI_DEVICE
(0x24FD, 0x10D0, 
iwl8265_2ac_cfg
)},

446 {
IWL_PCI_DEVICE
(0x24FD, 0x0050, 
iwl8265_2ac_cfg
)},

447 {
IWL_PCI_DEVICE
(0x24FD, 0x0150, 
iwl8265_2ac_cfg
)},

448 {
IWL_PCI_DEVICE
(0x24FD, 0x9010, 
iwl8265_2ac_cfg
)},

449 {
IWL_PCI_DEVICE
(0x24FD, 0x8110, 
iwl8265_2ac_cfg
)},

450 {
IWL_PCI_DEVICE
(0x24FD, 0x8050, 
iwl8265_2ac_cfg
)},

451 {
IWL_PCI_DEVICE
(0x24FD, 0x8010, 
iwl8265_2ac_cfg
)},

452 {
IWL_PCI_DEVICE
(0x24FD, 0x0810, 
iwl8265_2ac_cfg
)},

453 {
IWL_PCI_DEVICE
(0x24FD, 0x9110, 
iwl8265_2ac_cfg
)},

454 {
IWL_PCI_DEVICE
(0x24FD, 0x8130, 
iwl8265_2ac_cfg
)},

455 {
IWL_PCI_DEVICE
(0x24FD, 0x0910, 
iwl8265_2ac_cfg
)},

456 {
IWL_PCI_DEVICE
(0x24FD, 0x0930, 
iwl8265_2ac_cfg
)},

457 {
IWL_PCI_DEVICE
(0x24FD, 0x0950, 
iwl8265_2ac_cfg
)},

458 {
IWL_PCI_DEVICE
(0x24FD, 0x0850, 
iwl8265_2ac_cfg
)},

459 {
IWL_PCI_DEVICE
(0x24FD, 0x1014, 
iwl8265_2ac_cfg
)},

460 {
IWL_PCI_DEVICE
(0x24FD, 0x3E02, 
iwl8275_2ac_cfg
)},

461 {
IWL_PCI_DEVICE
(0x24FD, 0x3E01, 
iwl8275_2ac_cfg
)},

462 {
IWL_PCI_DEVICE
(0x24FD, 0x1012, 
iwl8275_2ac_cfg
)},

463 {
IWL_PCI_DEVICE
(0x24FD, 0x0012, 
iwl8275_2ac_cfg
)},

464 {
IWL_PCI_DEVICE
(0x24FD, 0x0014, 
iwl8265_2ac_cfg
)},

465 {
IWL_PCI_DEVICE
(0x24FD, 0x9074, 
iwl8265_2ac_cfg
)},

468 {
IWL_PCI_DEVICE
(0x2526, 
PCI_ANY_ID
, 
iwl9000_å™s_cfg
)},

469 {
IWL_PCI_DEVICE
(0x271B, 
PCI_ANY_ID
, 
iwl9000_å™s_cfg
)},

470 {
IWL_PCI_DEVICE
(0x271C, 
PCI_ANY_ID
, 
iwl9000_å™s_cfg
)},

471 {
IWL_PCI_DEVICE
(0x30DC, 
PCI_ANY_ID
, 
iwl9560_l⁄g_œãncy_å™s_cfg
)},

472 {
IWL_PCI_DEVICE
(0x31DC, 
PCI_ANY_ID
, 
iwl9560_sh¨ed_˛k_å™s_cfg
)},

473 {
IWL_PCI_DEVICE
(0x9DF0, 
PCI_ANY_ID
, 
iwl9560_å™s_cfg
)},

474 {
IWL_PCI_DEVICE
(0xA370, 
PCI_ANY_ID
, 
iwl9560_å™s_cfg
)},

477 {
IWL_PCI_DEVICE
(0x02F0, 
PCI_ANY_ID
, 
iwl_qu_å™s_cfg
)},

478 {
IWL_PCI_DEVICE
(0x06F0, 
PCI_ANY_ID
, 
iwl_qu_å™s_cfg
)},

480 {
IWL_PCI_DEVICE
(0x34F0, 
PCI_ANY_ID
, 
iwl_qu_medium_œãncy_å™s_cfg
)},

481 {
IWL_PCI_DEVICE
(0x3DF0, 
PCI_ANY_ID
, 
iwl_qu_medium_œãncy_å™s_cfg
)},

482 {
IWL_PCI_DEVICE
(0x4DF0, 
PCI_ANY_ID
, 
iwl_qu_medium_œãncy_å™s_cfg
)},

484 {
IWL_PCI_DEVICE
(0x43F0, 
PCI_ANY_ID
, 
iwl_qu_l⁄g_œãncy_å™s_cfg
)},

485 {
IWL_PCI_DEVICE
(0xA0F0, 
PCI_ANY_ID
, 
iwl_qu_l⁄g_œãncy_å™s_cfg
)},

487 {
IWL_PCI_DEVICE
(0x2723, 
PCI_ANY_ID
, 
iwl_ax200_å™s_cfg
)},

490 {
IWL_PCI_DEVICE
(0x2725, 
PCI_ANY_ID
, 
iwl_so_å™s_cfg
)},

491 {
IWL_PCI_DEVICE
(0x7A70, 
PCI_ANY_ID
, 
iwl_so_l⁄g_œãncy_imr_å™s_cfg
)},

492 {
IWL_PCI_DEVICE
(0x7AF0, 
PCI_ANY_ID
, 
iwl_so_å™s_cfg
)},

493 {
IWL_PCI_DEVICE
(0x51F0, 
PCI_ANY_ID
, 
iwl_so_l⁄g_œãncy_å™s_cfg
)},

494 {
IWL_PCI_DEVICE
(0x51F1, 
PCI_ANY_ID
, 
iwl_so_l⁄g_œãncy_imr_å™s_cfg
)},

495 {
IWL_PCI_DEVICE
(0x51F1, 
PCI_ANY_ID
, 
iwl_so_l⁄g_œãncy_å™s_cfg
)},

496 {
IWL_PCI_DEVICE
(0x54F0, 
PCI_ANY_ID
, 
iwl_so_l⁄g_œãncy_å™s_cfg
)},

497 {
IWL_PCI_DEVICE
(0x7F70, 
PCI_ANY_ID
, 
iwl_so_å™s_cfg
)},

500 {
IWL_PCI_DEVICE
(0x2729, 
PCI_ANY_ID
, 
iwl_ma_å™s_cfg
)},

501 {
IWL_PCI_DEVICE
(0x7E40, 
PCI_ANY_ID
, 
iwl_ma_å™s_cfg
)},

504 {
IWL_PCI_DEVICE
(0x2727, 
PCI_ANY_ID
, 
iwl_bz_å™s_cfg
)},

505 {
IWL_PCI_DEVICE
(0x272D, 
PCI_ANY_ID
, 
iwl_bz_å™s_cfg
)},

506 {
IWL_PCI_DEVICE
(0x272b, 
PCI_ANY_ID
, 
iwl_bz_å™s_cfg
)},

507 {
IWL_PCI_DEVICE
(0xA840, 
PCI_ANY_ID
, 
iwl_bz_å™s_cfg
)},

508 {
IWL_PCI_DEVICE
(0x7740, 
PCI_ANY_ID
, 
iwl_bz_å™s_cfg
)},

511 {
IWL_PCI_DEVICE
(0xE440, 
PCI_ANY_ID
, 
iwl_sc_å™s_cfg
)},

512 {
IWL_PCI_DEVICE
(0xE340, 
PCI_ANY_ID
, 
iwl_sc_å™s_cfg
)},

513 {
IWL_PCI_DEVICE
(0xD340, 
PCI_ANY_ID
, 
iwl_sc_å™s_cfg
)},

514 {
IWL_PCI_DEVICE
(0x6E70, 
PCI_ANY_ID
, 
iwl_sc_å™s_cfg
)},

519 
MODULE_DEVICE_TABLE
(
pci
, 
iwl_hw_ˇrd_ids
);

521 
	#_IWL_DEV_INFO
(
_devi˚
, 
_subdevi˚
, 
_mac_ty≥
, 
_mac_°ï
, 
_rf_ty≥
, \

522 
_rf_id
, 
_rf_°ï
, 
_no_160
, 
_c‹es
, 
_cdb
, 
_cfg
, 
_«me
) \

523 { .
devi˚
 = (
_devi˚
), .
subdevi˚
 = (
_subdevi˚
), .
cfg
 = &(
_cfg
), \

524 .
«me
 = 
_«me
, .
mac_ty≥
 = 
_mac_ty≥
, .
rf_ty≥
 = 
_rf_ty≥
, .
rf_°ï
 = 
_rf_°ï
, \

525 .
no_160
 = 
_no_160
, .
c‹es
 = 
_c‹es
, .
rf_id
 = 
_rf_id
, \

526 .
mac_°ï
 = 
_mac_°ï
, .
cdb
 = 
_cdb
, .
jackë
 = 
IWL_CFG_ANY
 }

	)

528 
	#IWL_DEV_INFO
(
_devi˚
, 
_subdevi˚
, 
_cfg
, 
_«me
) \

529 
	`_IWL_DEV_INFO
(
_devi˚
, 
_subdevi˚
, 
IWL_CFG_ANY
, IWL_CFG_ANY, \

530 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY, IWL_CFG_ANY, IWL_CFG_ANY, \

531 
IWL_CFG_ANY
, 
_cfg
, 
_«me
)

	)

533 
VISIBLE_IF_IWLWIFI_KUNIT
 c⁄° 
iwl_dev_öfo
 
	giwl_dev_öfo_èbÀ
[] = {

534 #i‡
IS_ENABLED
(
CONFIG_IWLMVM
)

536 
IWL_DEV_INFO
(0x2526, 0x1550, 
iwl9260_2ac_cfg
, 
iwl9260_kûÀr_1550_«me
),

537 
IWL_DEV_INFO
(0x2526, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_«me
),

538 
IWL_DEV_INFO
(0x2526, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_«me
),

539 
IWL_DEV_INFO
(0x30DC, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_«me
),

540 
IWL_DEV_INFO
(0x30DC, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_«me
),

541 
IWL_DEV_INFO
(0x31DC, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_«me
),

542 
IWL_DEV_INFO
(0x31DC, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_«me
),

543 
IWL_DEV_INFO
(0xA370, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_«me
),

544 
IWL_DEV_INFO
(0xA370, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_«me
),

545 
IWL_DEV_INFO
(0x54F0, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_160_«me
),

546 
IWL_DEV_INFO
(0x54F0, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_«me
),

547 
IWL_DEV_INFO
(0x51F0, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_160_«me
),

548 
IWL_DEV_INFO
(0x51F0, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_160_«me
),

549 
IWL_DEV_INFO
(0x51F0, 0x1691, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690s_«me
),

550 
IWL_DEV_INFO
(0x51F0, 0x1692, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690i_«me
),

551 
IWL_DEV_INFO
(0x51F1, 0x1692, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690i_«me
),

552 
IWL_DEV_INFO
(0x54F0, 0x1691, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690s_«me
),

553 
IWL_DEV_INFO
(0x54F0, 0x1692, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690i_«me
),

554 
IWL_DEV_INFO
(0x7A70, 0x1691, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690s_«me
),

555 
IWL_DEV_INFO
(0x7A70, 0x1692, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690i_«me
),

556 
IWL_DEV_INFO
(0x7AF0, 0x1691, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690s_«me
),

557 
IWL_DEV_INFO
(0x7AF0, 0x1692, 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_kûÀr_1690i_«me
),

559 
IWL_DEV_INFO
(0x271C, 0x0214, 
iwl9260_2ac_cfg
, 
iwl9260_1_«me
),

560 
IWL_DEV_INFO
(0x7E40, 0x1691, 
iwl_cfg_ma
, 
iwl_ax411_kûÀr_1690s_«me
),

561 
IWL_DEV_INFO
(0x7E40, 0x1692, 
iwl_cfg_ma
, 
iwl_ax411_kûÀr_1690i_«me
),

564 
IWL_DEV_INFO
(0x2723, 
IWL_CFG_ANY
, 
iwl_ax200_cfg_cc
, 
iwl_ax200_«me
),

565 
IWL_DEV_INFO
(0x2723, 0x1653, 
iwl_ax200_cfg_cc
, 
iwl_ax200_kûÀr_1650w_«me
),

566 
IWL_DEV_INFO
(0x2723, 0x1654, 
iwl_ax200_cfg_cc
, 
iwl_ax200_kûÀr_1650x_«me
),

569 
IWL_DEV_INFO
(0x43F0, 0x0070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

570 
IWL_DEV_INFO
(0x43F0, 0x0074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

571 
IWL_DEV_INFO
(0x43F0, 0x0078, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

572 
IWL_DEV_INFO
(0x43F0, 0x007C, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

573 
IWL_DEV_INFO
(0x43F0, 0x1651, 
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
, 
iwl_ax201_kûÀr_1650s_«me
),

574 
IWL_DEV_INFO
(0x43F0, 0x1652, 
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
, 
iwl_ax201_kûÀr_1650i_«me
),

575 
IWL_DEV_INFO
(0x43F0, 0x2074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

576 
IWL_DEV_INFO
(0x43F0, 0x4070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

577 
IWL_DEV_INFO
(0xA0F0, 0x0070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

578 
IWL_DEV_INFO
(0xA0F0, 0x0074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

579 
IWL_DEV_INFO
(0xA0F0, 0x0078, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

580 
IWL_DEV_INFO
(0xA0F0, 0x007C, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

581 
IWL_DEV_INFO
(0xA0F0, 0x0A10, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

582 
IWL_DEV_INFO
(0xA0F0, 0x1651, 
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

583 
IWL_DEV_INFO
(0xA0F0, 0x1652, 
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

584 
IWL_DEV_INFO
(0xA0F0, 0x2074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

585 
IWL_DEV_INFO
(0xA0F0, 0x4070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

586 
IWL_DEV_INFO
(0xA0F0, 0x6074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

587 
IWL_DEV_INFO
(0x02F0, 0x0070, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

588 
IWL_DEV_INFO
(0x02F0, 0x0074, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

589 
IWL_DEV_INFO
(0x02F0, 0x6074, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

590 
IWL_DEV_INFO
(0x02F0, 0x0078, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

591 
IWL_DEV_INFO
(0x02F0, 0x007C, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

592 
IWL_DEV_INFO
(0x02F0, 0x0310, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

593 
IWL_DEV_INFO
(0x02F0, 0x1651, 
iwl_ax1650s_cfg_quz_hr
, 
NULL
),

594 
IWL_DEV_INFO
(0x02F0, 0x1652, 
iwl_ax1650i_cfg_quz_hr
, 
NULL
),

595 
IWL_DEV_INFO
(0x02F0, 0x2074, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

596 
IWL_DEV_INFO
(0x02F0, 0x4070, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

597 
IWL_DEV_INFO
(0x06F0, 0x0070, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

598 
IWL_DEV_INFO
(0x06F0, 0x0074, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

599 
IWL_DEV_INFO
(0x06F0, 0x0078, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

600 
IWL_DEV_INFO
(0x06F0, 0x007C, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

601 
IWL_DEV_INFO
(0x06F0, 0x0310, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

602 
IWL_DEV_INFO
(0x06F0, 0x1651, 
iwl_ax1650s_cfg_quz_hr
, 
NULL
),

603 
IWL_DEV_INFO
(0x06F0, 0x1652, 
iwl_ax1650i_cfg_quz_hr
, 
NULL
),

604 
IWL_DEV_INFO
(0x06F0, 0x2074, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

605 
IWL_DEV_INFO
(0x06F0, 0x4070, 
iwl_ax201_cfg_quz_hr
, 
NULL
),

606 
IWL_DEV_INFO
(0x34F0, 0x0070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

607 
IWL_DEV_INFO
(0x34F0, 0x0074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

608 
IWL_DEV_INFO
(0x34F0, 0x0078, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

609 
IWL_DEV_INFO
(0x34F0, 0x007C, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

610 
IWL_DEV_INFO
(0x34F0, 0x0310, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

611 
IWL_DEV_INFO
(0x34F0, 0x1651, 
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

612 
IWL_DEV_INFO
(0x34F0, 0x1652, 
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

613 
IWL_DEV_INFO
(0x34F0, 0x2074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

614 
IWL_DEV_INFO
(0x34F0, 0x4070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

616 
IWL_DEV_INFO
(0x3DF0, 0x0070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

617 
IWL_DEV_INFO
(0x3DF0, 0x0074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

618 
IWL_DEV_INFO
(0x3DF0, 0x0078, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

619 
IWL_DEV_INFO
(0x3DF0, 0x007C, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

620 
IWL_DEV_INFO
(0x3DF0, 0x0310, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

621 
IWL_DEV_INFO
(0x3DF0, 0x1651, 
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

622 
IWL_DEV_INFO
(0x3DF0, 0x1652, 
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

623 
IWL_DEV_INFO
(0x3DF0, 0x2074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

624 
IWL_DEV_INFO
(0x3DF0, 0x4070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

626 
IWL_DEV_INFO
(0x4DF0, 0x0070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

627 
IWL_DEV_INFO
(0x4DF0, 0x0074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

628 
IWL_DEV_INFO
(0x4DF0, 0x0078, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

629 
IWL_DEV_INFO
(0x4DF0, 0x007C, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

630 
IWL_DEV_INFO
(0x4DF0, 0x0310, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

631 
IWL_DEV_INFO
(0x4DF0, 0x1651, 
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

632 
IWL_DEV_INFO
(0x4DF0, 0x1652, 
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
, 
NULL
),

633 
IWL_DEV_INFO
(0x4DF0, 0x2074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

634 
IWL_DEV_INFO
(0x4DF0, 0x4070, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

635 
IWL_DEV_INFO
(0x4DF0, 0x6074, 
iwl_ax201_cfg_qu_hr
, 
NULL
),

638 
IWL_DEV_INFO
(0x2725, 0x0090, 
iwœx211_2ax_cfg_so_gf_a0
, 
NULL
),

639 
IWL_DEV_INFO
(0x2725, 0x0020, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

640 
IWL_DEV_INFO
(0x2725, 0x2020, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

641 
IWL_DEV_INFO
(0x2725, 0x0024, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

642 
IWL_DEV_INFO
(0x2725, 0x0310, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

643 
IWL_DEV_INFO
(0x2725, 0x0510, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

644 
IWL_DEV_INFO
(0x2725, 0x0A10, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

645 
IWL_DEV_INFO
(0x2725, 0xE020, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

646 
IWL_DEV_INFO
(0x2725, 0xE024, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

647 
IWL_DEV_INFO
(0x2725, 0x4020, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

648 
IWL_DEV_INFO
(0x2725, 0x6020, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

649 
IWL_DEV_INFO
(0x2725, 0x6024, 
iwœx210_2ax_cfg_ty_gf_a0
, 
NULL
),

650 
IWL_DEV_INFO
(0x2725, 0x1673, 
iwœx210_2ax_cfg_ty_gf_a0
, 
iwl_ax210_kûÀr_1675w_«me
),

651 
IWL_DEV_INFO
(0x2725, 0x1674, 
iwœx210_2ax_cfg_ty_gf_a0
, 
iwl_ax210_kûÀr_1675x_«me
),

652 
IWL_DEV_INFO
(0x7A70, 0x0090, 
iwœx211_2ax_cfg_so_gf_a0_l⁄g
, 
NULL
),

653 
IWL_DEV_INFO
(0x7A70, 0x0098, 
iwœx211_2ax_cfg_so_gf_a0_l⁄g
, 
NULL
),

654 
IWL_DEV_INFO
(0x7A70, 0x00B0, 
iwœx411_2ax_cfg_so_gf4_a0_l⁄g
, 
NULL
),

655 
IWL_DEV_INFO
(0x7A70, 0x0310, 
iwœx211_2ax_cfg_so_gf_a0_l⁄g
, 
NULL
),

656 
IWL_DEV_INFO
(0x7A70, 0x0510, 
iwœx211_2ax_cfg_so_gf_a0_l⁄g
, 
NULL
),

657 
IWL_DEV_INFO
(0x7A70, 0x0A10, 
iwœx211_2ax_cfg_so_gf_a0_l⁄g
, 
NULL
),

658 
IWL_DEV_INFO
(0x7AF0, 0x0090, 
iwœx211_2ax_cfg_so_gf_a0
, 
NULL
),

659 
IWL_DEV_INFO
(0x7AF0, 0x0098, 
iwœx211_2ax_cfg_so_gf_a0
, 
NULL
),

660 
IWL_DEV_INFO
(0x7AF0, 0x00B0, 
iwœx411_2ax_cfg_so_gf4_a0
, 
NULL
),

661 
IWL_DEV_INFO
(0x7AF0, 0x0310, 
iwœx211_2ax_cfg_so_gf_a0
, 
NULL
),

662 
IWL_DEV_INFO
(0x7AF0, 0x0510, 
iwœx211_2ax_cfg_so_gf_a0
, 
NULL
),

663 
IWL_DEV_INFO
(0x7AF0, 0x0A10, 
iwœx211_2ax_cfg_so_gf_a0
, 
NULL
),

666 
IWL_DEV_INFO
(0x7A70, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_160_«me
),

667 
IWL_DEV_INFO
(0x7A70, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_160_«me
),

668 
IWL_DEV_INFO
(0x7AF0, 0x1551, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550s_160_«me
),

669 
IWL_DEV_INFO
(0x7AF0, 0x1552, 
iwl9560_2ac_cfg_soc
, 
iwl9560_kûÀr_1550i_160_«me
),

672 
IWL_DEV_INFO
(0x2726, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

673 
IWL_DEV_INFO
(0x2726, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

674 
IWL_DEV_INFO
(0x51F0, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

675 
IWL_DEV_INFO
(0x51F0, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

676 
IWL_DEV_INFO
(0x51F1, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

677 
IWL_DEV_INFO
(0x51F1, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

678 
IWL_DEV_INFO
(0x54F0, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

679 
IWL_DEV_INFO
(0x54F0, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

680 
IWL_DEV_INFO
(0x7A70, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

681 
IWL_DEV_INFO
(0x7A70, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

682 
IWL_DEV_INFO
(0x7AF0, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

683 
IWL_DEV_INFO
(0x7AF0, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

684 
IWL_DEV_INFO
(0x7F70, 0x1671, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675s_«me
),

685 
IWL_DEV_INFO
(0x7F70, 0x1672, 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_kûÀr_1675i_«me
),

688 
IWL_DEV_INFO
(0x7E40, 0x1671, 
iwl_cfg_ma
, 
iwl_ax211_kûÀr_1675s_«me
),

689 
IWL_DEV_INFO
(0x7E40, 0x1672, 
iwl_cfg_ma
, 
iwl_ax211_kûÀr_1675i_«me
),

691 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

692 
IWL_CFG_MAC_TYPE_PU
, 
IWL_CFG_ANY
,

693 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

694 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

695 
iwl9560_2ac_cfg_soc
, 
iwl9461_160_«me
),

696 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

697 
IWL_CFG_MAC_TYPE_PU
, 
IWL_CFG_ANY
,

698 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

699 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

700 
iwl9560_2ac_cfg_soc
, 
iwl9461_«me
),

701 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

702 
IWL_CFG_MAC_TYPE_PU
, 
IWL_CFG_ANY
,

703 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

704 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

705 
iwl9560_2ac_cfg_soc
, 
iwl9462_160_«me
),

706 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

707 
IWL_CFG_MAC_TYPE_PU
, 
IWL_CFG_ANY
,

708 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

709 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

710 
iwl9560_2ac_cfg_soc
, 
iwl9462_«me
),

712 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

713 
IWL_CFG_MAC_TYPE_PU
, 
IWL_CFG_ANY
,

714 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

715 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

716 
iwl9560_2ac_cfg_soc
, 
iwl9560_160_«me
),

717 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

718 
IWL_CFG_MAC_TYPE_PU
, 
IWL_CFG_ANY
,

719 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

720 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

721 
iwl9560_2ac_cfg_soc
, 
iwl9560_«me
),

723 
_IWL_DEV_INFO
(0x2526, 
IWL_CFG_ANY
,

724 
IWL_CFG_MAC_TYPE_TH
, 
IWL_CFG_ANY
,

725 
IWL_CFG_RF_TYPE_TH
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

726 
IWL_CFG_160
, 
IWL_CFG_CORES_BT_GNSS
, 
IWL_CFG_NO_CDB
,

727 
iwl9260_2ac_cfg
, 
iwl9270_160_«me
),

728 
_IWL_DEV_INFO
(0x2526, 
IWL_CFG_ANY
,

729 
IWL_CFG_MAC_TYPE_TH
, 
IWL_CFG_ANY
,

730 
IWL_CFG_RF_TYPE_TH
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

731 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT_GNSS
, 
IWL_CFG_NO_CDB
,

732 
iwl9260_2ac_cfg
, 
iwl9270_«me
),

734 
_IWL_DEV_INFO
(0x271B, 
IWL_CFG_ANY
,

735 
IWL_CFG_MAC_TYPE_TH
, 
IWL_CFG_ANY
,

736 
IWL_CFG_RF_TYPE_TH1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

737 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

738 
iwl9260_2ac_cfg
, 
iwl9162_160_«me
),

739 
_IWL_DEV_INFO
(0x271B, 
IWL_CFG_ANY
,

740 
IWL_CFG_MAC_TYPE_TH
, 
IWL_CFG_ANY
,

741 
IWL_CFG_RF_TYPE_TH1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

742 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

743 
iwl9260_2ac_cfg
, 
iwl9162_«me
),

745 
_IWL_DEV_INFO
(0x2526, 
IWL_CFG_ANY
,

746 
IWL_CFG_MAC_TYPE_TH
, 
IWL_CFG_ANY
,

747 
IWL_CFG_RF_TYPE_TH
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

748 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

749 
iwl9260_2ac_cfg
, 
iwl9260_160_«me
),

750 
_IWL_DEV_INFO
(0x2526, 
IWL_CFG_ANY
,

751 
IWL_CFG_MAC_TYPE_TH
, 
IWL_CFG_ANY
,

752 
IWL_CFG_RF_TYPE_TH
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

753 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

754 
iwl9260_2ac_cfg
, 
iwl9260_«me
),

758 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

759 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

760 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

761 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

762 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9461_160_«me
),

763 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

764 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

765 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

766 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

767 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9461_«me
),

768 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

769 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

770 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

771 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

772 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9462_160_«me
),

773 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

774 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

775 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

776 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

777 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9462_«me
),

779 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

780 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

781 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

782 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

783 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9560_160_«me
),

784 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

785 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

786 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

787 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

788 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9560_«me
),

790 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, 0x1551,

791 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

792 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

793 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

794 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9560_kûÀr_1550s_«me
),

795 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, 0x1552,

796 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

797 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

798 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

799 
iwl9560_qu_b0_jf_b0_cfg
, 
iwl9560_kûÀr_1550i_«me
),

802 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

803 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

804 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

805 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

806 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9461_160_«me
),

807 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

808 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

809 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

810 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

811 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9461_«me
),

812 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

813 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

814 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

815 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

816 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9462_160_«me
),

817 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

818 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

819 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

820 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

821 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9462_«me
),

823 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

824 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

825 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

826 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

827 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9560_160_«me
),

828 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

829 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

830 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

831 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

832 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9560_«me
),

834 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, 0x1551,

835 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

836 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

837 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

838 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9560_kûÀr_1550s_«me
),

839 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, 0x1552,

840 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

841 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

842 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

843 
iwl9560_qu_c0_jf_b0_cfg
, 
iwl9560_kûÀr_1550i_«me
),

846 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

847 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

848 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

849 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

850 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9461_160_«me
),

851 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

852 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

853 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

854 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

855 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9461_«me
),

856 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

857 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

858 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

859 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

860 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9462_160_«me
),

861 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

862 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

863 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

864 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

865 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9462_«me
),

867 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

868 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

869 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

870 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

871 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9560_160_«me
),

872 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

873 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

874 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

875 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

876 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9560_«me
),

878 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, 0x1551,

879 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

880 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

881 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

882 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9560_kûÀr_1550s_«me
),

883 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, 0x1552,

884 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

885 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

886 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

887 
iwl9560_quz_a0_jf_b0_cfg
, 
iwl9560_kûÀr_1550i_«me
),

891 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

892 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

893 
IWL_CFG_RF_TYPE_HR1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

894 
IWL_CFG_ANY
, IWL_CFG_ANY, 
IWL_CFG_NO_CDB
,

895 
iwl_qu_b0_hr1_b0
, 
iwl_ax101_«me
),

896 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

897 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_B_STEP
,

898 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

899 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

900 
iwl_qu_b0_hr_b0
, 
iwl_ax203_«me
),

903 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

904 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

905 
IWL_CFG_RF_TYPE_HR1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

906 
IWL_CFG_ANY
, IWL_CFG_ANY, 
IWL_CFG_NO_CDB
,

907 
iwl_qu_c0_hr1_b0
, 
iwl_ax101_«me
),

908 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

909 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

910 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

911 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

912 
iwl_qu_c0_hr_b0
, 
iwl_ax203_«me
),

913 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

914 
IWL_CFG_MAC_TYPE_QU
, 
SILICON_C_STEP
,

915 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

916 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

917 
iwl_qu_c0_hr_b0
, 
iwl_ax201_«me
),

920 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

921 
IWL_CFG_MAC_TYPE_QUZ
, 
IWL_CFG_ANY
,

922 
IWL_CFG_RF_TYPE_HR1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

923 
IWL_CFG_ANY
, IWL_CFG_ANY, 
IWL_CFG_NO_CDB
,

924 
iwl_quz_a0_hr1_b0
, 
iwl_ax101_«me
),

925 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

926 
IWL_CFG_MAC_TYPE_QUZ
, 
SILICON_B_STEP
,

927 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

928 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

929 
iwl_cfg_quz_a0_hr_b0
, 
iwl_ax203_«me
),

930 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

931 
IWL_CFG_MAC_TYPE_QUZ
, 
SILICON_B_STEP
,

932 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

933 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

934 
iwl_cfg_quz_a0_hr_b0
, 
iwl_ax201_«me
),

937 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

938 
IWL_CFG_MAC_TYPE_MA
, 
IWL_CFG_ANY
,

939 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

940 
IWL_CFG_ANY
, IWL_CFG_ANY, 
IWL_CFG_NO_CDB
,

941 
iwl_cfg_ma
, 
iwl_ax201_«me
),

942 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

943 
IWL_CFG_MAC_TYPE_MA
, 
IWL_CFG_ANY
,

944 
IWL_CFG_RF_TYPE_GF
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

945 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

946 
iwl_cfg_ma
, 
iwl_ax211_«me
),

947 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

948 
IWL_CFG_MAC_TYPE_MA
, 
IWL_CFG_ANY
,

949 
IWL_CFG_RF_TYPE_MR
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

950 
IWL_CFG_ANY
, IWL_CFG_ANY, 
IWL_CFG_NO_CDB
,

951 
iwl_cfg_ma
, 
iwl_ax221_«me
),

952 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

953 
IWL_CFG_MAC_TYPE_MA
, 
IWL_CFG_ANY
,

954 
IWL_CFG_RF_TYPE_FM
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

955 
IWL_CFG_ANY
, IWL_CFG_ANY, 
IWL_CFG_NO_CDB
,

956 
iwl_cfg_ma
, 
iwl_ax231_«me
),

959 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

960 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

961 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

962 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

963 
iwl_cfg_so_a0_hr_a0
, 
iwl_ax203_«me
),

964 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

965 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

966 
IWL_CFG_RF_TYPE_HR1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

967 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

968 
iwl_cfg_so_a0_hr_a0
, 
iwl_ax101_«me
),

969 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

970 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

971 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

972 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

973 
iwl_cfg_so_a0_hr_a0
, 
iwl_ax201_«me
),

976 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

977 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

978 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

979 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

980 
iwl_cfg_so_a0_hr_a0
, 
iwl_ax203_«me
),

981 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

982 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

983 
IWL_CFG_RF_TYPE_HR1
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

984 
IWL_CFG_NO_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

985 
iwl_cfg_so_a0_hr_a0
, 
iwl_ax101_«me
),

986 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

987 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

988 
IWL_CFG_RF_TYPE_HR2
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

989 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

990 
iwl_cfg_so_a0_hr_a0
, 
iwl_ax201_«me
),

993 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

994 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

995 
IWL_CFG_RF_TYPE_GF
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

996 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

997 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_«me
),

998 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

999 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1000 
IWL_CFG_RF_TYPE_GF
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1001 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_CDB
,

1002 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_«me
),

1005 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1006 
IWL_CFG_MAC_TYPE_BZ
, 
IWL_CFG_ANY
,

1007 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1008 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1009 
iwl_cfg_bz
, 
iwl_bz_«me
),

1012 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1013 
IWL_CFG_MAC_TYPE_GL
, 
IWL_CFG_ANY
,

1014 
IWL_CFG_RF_TYPE_FM
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1015 
IWL_CFG_320
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

1016 
iwl_cfg_gl
, 
iwl_bz_«me
),

1017 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1018 
IWL_CFG_MAC_TYPE_GL
, 
IWL_CFG_ANY
,

1019 
IWL_CFG_RF_TYPE_FM
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1020 
IWL_CFG_NO_320
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

1021 
iwl_cfg_gl
, 
iwl_mç_«me
),

1024 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1025 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1026 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

1027 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1028 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9560_160_«me
),

1029 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1030 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1031 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

1032 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1033 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9560_«me
),

1036 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1037 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1038 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

1039 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1040 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9461_160_«me
),

1041 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1042 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1043 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

1044 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1045 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9462_160_«me
),

1046 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1047 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1048 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

1049 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1050 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9461_«me
),

1051 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1052 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1053 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

1054 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1055 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9462_«me
),

1058 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1059 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1060 
IWL_CFG_RF_TYPE_GF
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1061 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

1062 
iwœx211_2ax_cfg_so_gf_a0
, 
iwl_ax211_«me
),

1063 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1064 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1065 
IWL_CFG_RF_TYPE_GF
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1066 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_CDB
,

1067 
iwœx411_2ax_cfg_so_gf4_a0
, 
iwl_ax411_«me
),

1070 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1071 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1072 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

1073 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1074 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9560_160_«me
),

1075 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1076 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1077 
IWL_CFG_RF_TYPE_JF2
, 
IWL_CFG_RF_ID_JF
, 
IWL_CFG_ANY
,

1078 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1079 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9560_«me
),

1082 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1083 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1084 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

1085 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1086 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9461_160_«me
),

1087 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1088 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1089 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

1090 
IWL_CFG_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1091 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9462_160_«me
),

1092 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1093 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1094 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1
, 
IWL_CFG_ANY
,

1095 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1096 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9461_«me
),

1097 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1098 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1099 
IWL_CFG_RF_TYPE_JF1
, 
IWL_CFG_RF_ID_JF1_DIV
, 
IWL_CFG_ANY
,

1100 
IWL_CFG_NO_160
, 
IWL_CFG_CORES_BT
, 
IWL_CFG_NO_CDB
,

1101 
iwœx210_2ax_cfg_so_jf_b0
, 
iwl9462_«me
),

1105 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1106 
IWL_CFG_MAC_TYPE_SO
, 
IWL_CFG_ANY
,

1107 
IWL_CFG_RF_TYPE_MS
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1108 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

1109 
iwl_cfg_so_a0_ms_a0
, 
iwl_ax204_«me
),

1110 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1111 
IWL_CFG_MAC_TYPE_SOF
, 
IWL_CFG_ANY
,

1112 
IWL_CFG_RF_TYPE_MS
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1113 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

1114 
iwl_cfg_so_a0_ms_a0
, 
iwl_ax204_«me
),

1115 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1116 
IWL_CFG_MAC_TYPE_MA
, 
IWL_CFG_ANY
,

1117 
IWL_CFG_RF_TYPE_MS
, 
IWL_CFG_ANY
, IWL_CFG_ANY,

1118 
IWL_CFG_160
, 
IWL_CFG_ANY
, 
IWL_CFG_NO_CDB
,

1119 
iwl_cfg_ma
, 
iwl_ax204_«me
),

1122 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1123 
IWL_CFG_MAC_TYPE_SC
, 
IWL_CFG_ANY
,

1124 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1125 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1126 
iwl_cfg_sc
, 
iwl_sc_«me
),

1127 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1128 
IWL_CFG_MAC_TYPE_SC2
, 
IWL_CFG_ANY
,

1129 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1130 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1131 
iwl_cfg_sc2
, 
iwl_sc2_«me
),

1132 
_IWL_DEV_INFO
(
IWL_CFG_ANY
, IWL_CFG_ANY,

1133 
IWL_CFG_MAC_TYPE_SC2F
, 
IWL_CFG_ANY
,

1134 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1135 
IWL_CFG_ANY
, IWL_CFG_ANY, IWL_CFG_ANY,

1136 
iwl_cfg_sc2f
, 
iwl_sc2f_«me
),

1139 
EXPORT_SYMBOL_IF_IWLWIFI_KUNIT
(
iwl_dev_öfo_èbÀ
);

1141 #i‡
IS_ENABLED
(
CONFIG_IWLWIFI_KUNIT_TESTS
)

1142 c⁄° 
	giwl_dev_öfo_èbÀ_size
 = 
ARRAY_SIZE
(
iwl_dev_öfo_èbÀ
);

1143 
EXPORT_SYMBOL_IF_IWLWIFI_KUNIT
(
iwl_dev_öfo_èbÀ_size
);

1149 
	$gë_¸f_id
(
iwl_å™s
 *iwl_trans)

1151 
u32
 
sd_ªg_vî_addr
;

1152 
u32
 
vÆ
 = 0;

1154 i‡(
iwl_å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

1155 
sd_ªg_vî_addr
 = 
SD_REG_VER_GEN2
;

1157 
sd_ªg_vî_addr
 = 
SD_REG_VER
;

1160 
vÆ
 = 
	`iwl_ªad_umac_¥ph_no_gøb
(
iwl_å™s
, 
WFPM_CTRL_REG
);

1161 
vÆ
 |
WFPM_AUX_CTL_AUX_IF_MAC_OWNER_MSK
;

1162 
	`iwl_wrôe_umac_¥ph_no_gøb
(
iwl_å™s
, 
WFPM_CTRL_REG
, 
vÆ
);

1165 
iwl_å™s
->
hw_¸f_id
 = 
	`iwl_ªad_¥ph_no_gøb
(iwl_å™s, 
sd_ªg_vî_addr
);

1168 
iwl_å™s
->
hw_˙v_id
 =

1169 
	`iwl_ªad_¥ph_no_gøb
(
iwl_å™s
, 
CNVI_AUX_MISC_CHIP
);

1172 i‡(
	`CSR_HW_REV_TYPE
(
iwl_å™s
->
hw_ªv
Ë=
IWL_CFG_MAC_TYPE_BZ
) {

1173 
u8
 
°ï
 = 
	`CNVI_AUX_MISC_CHIP_MAC_STEP
(
iwl_å™s
->
hw_˙v_id
);

1176 i‡((
	`CNVI_AUX_MISC_CHIP_PROD_TYPE
(
iwl_å™s
->
hw_˙v_id
) ==

1177 
CNVI_AUX_MISC_CHIP_PROD_TYPE_BZ_U
) &&

1178 
°ï
 =
SILICON_A_STEP
)

1179 
°ï
 = 
SILICON_B_STEP
;

1181 
iwl_å™s
->
hw_ªv_°ï
 = 
°ï
;

1182 
iwl_å™s
->
hw_ªv
 |
°ï
;

1186 
iwl_å™s
->
hw_wÂm_id
 =

1187 
	`iwl_ªad_umac_¥ph_no_gøb
(
iwl_å™s
, 
WFPM_OTP_CFG1_ADDR
);

1188 
	`IWL_INFO
(
iwl_å™s
, "Detected crf-id 0x%x, cnv-id 0x%x wfpm id 0x%x\n",

1189 
iwl_å™s
->
hw_¸f_id
, iwl_å™s->
hw_˙v_id
,

1190 
iwl_å™s
->
hw_wÂm_id
);

1191 
	}
}

1197 
	$m≠_¸f_id
(
iwl_å™s
 *iwl_trans)

1199 
ªt
 = 0;

1200 
u32
 
vÆ
 = 
iwl_å™s
->
hw_¸f_id
;

1201 
u32
 
°ï_id
 = 
	`REG_CRF_ID_STEP
(
vÆ
);

1202 
u32
 
¶ave_id
 = 
	`REG_CRF_ID_SLAVE
(
vÆ
);

1203 
u32
 
jackë_id_˙v
 = 
	`REG_CRF_ID_SLAVE
(
iwl_å™s
->
hw_˙v_id
);

1204 
u32
 
jackë_id_wÂm
 = 
	`WFPM_OTP_CFG1_IS_JACKET
(
iwl_å™s
->
hw_wÂm_id
);

1205 
u32
 
cdb_id_wÂm
 = 
	`WFPM_OTP_CFG1_IS_CDB
(
iwl_å™s
->
hw_wÂm_id
);

1208 
	`REG_CRF_ID_TYPE
(
vÆ
)) {

1209 
REG_CRF_ID_TYPE_JF_1
:

1210 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_JF1
 << 12);

1212 
REG_CRF_ID_TYPE_JF_2
:

1213 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_JF2
 << 12);

1215 
REG_CRF_ID_TYPE_HR_NONE_CDB_1X1
:

1216 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_HR1
 << 12);

1218 
REG_CRF_ID_TYPE_HR_NONE_CDB
:

1219 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_HR2
 << 12);

1221 
REG_CRF_ID_TYPE_HR_CDB
:

1222 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_HR2
 << 12);

1224 
REG_CRF_ID_TYPE_GF
:

1225 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_GF
 << 12);

1227 
REG_CRF_ID_TYPE_MR
:

1228 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_MR
 << 12);

1230 
REG_CRF_ID_TYPE_FM
:

1231 
REG_CRF_ID_TYPE_FMI
:

1232 
REG_CRF_ID_TYPE_FMR
:

1233 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_FM
 << 12);

1235 
REG_CRF_ID_TYPE_WHP
:

1236 
iwl_å™s
->
hw_rf_id
 = (
IWL_CFG_RF_TYPE_WH
 << 12);

1239 
ªt
 = -
EIO
;

1240 
	`IWL_ERR
(
iwl_å™s
,

1242 
	`REG_CRF_ID_TYPE
(
vÆ
));

1243 
out
;

1248 
iwl_å™s
->
hw_rf_id
 |(
°ï_id
 << 8);

1251 i‡(
cdb_id_wÂm
 || 
¶ave_id
) {

1252 
iwl_å™s
->
hw_rf_id
 +
	`BIT
(28);

1253 
	`IWL_INFO
(
iwl_å™s
, "Adding cdbÅoÑf id\n");

1257 i‡(
jackë_id_wÂm
 || 
jackë_id_˙v
) {

1258 
iwl_å™s
->
hw_rf_id
 +
	`BIT
(29);

1259 
	`IWL_INFO
(
iwl_å™s
, "Adding jacketÅoÑf id\n");

1262 
	`IWL_INFO
(
iwl_å™s
,

1264 
	`REG_CRF_ID_TYPE
(
vÆ
), 
°ï_id
, 
¶ave_id
, 
iwl_å™s
->
hw_rf_id
);

1265 
	`IWL_INFO
(
iwl_å™s
,

1267 
cdb_id_wÂm
, 
jackë_id_wÂm
, 
iwl_å™s
->
hw_wÂm_id
);

1268 
	`IWL_INFO
(
iwl_å™s
, "Detected jacket-id 0x%x from cnvi id 0x%x\n",

1269 
jackë_id_˙v
, 
iwl_å™s
->
hw_˙v_id
);

1271 
out
:

1272  
ªt
;

1273 
	}
}

1276 
	#PCI_CFG_RETRY_TIMEOUT
 0x041

	)

1278 
VISIBLE_IF_IWLWIFI_KUNIT
 c⁄° 
iwl_dev_öfo
 *

1279 
	$iwl_pci_föd_dev_öfo
(
u16
 
devi˚
, u16 
subsy°em_devi˚
,

1280 
u16
 
mac_ty≥
, 
u8
 
mac_°ï
, u16 
rf_ty≥
, u8 
cdb
,

1281 
u8
 
jackë
, u8 
rf_id
, u8 
no_160
, u8 
c‹es
, u8 
rf_°ï
)

1283 
num_devi˚s
 = 
	`ARRAY_SIZE
(
iwl_dev_öfo_èbÀ
);

1284 
i
;

1286 i‡(!
num_devi˚s
)

1287  
NULL
;

1289 
i
 = 
num_devi˚s
 - 1; i >= 0; i--) {

1290 c⁄° 
iwl_dev_öfo
 *
dev_öfo
 = &
iwl_dev_öfo_èbÀ
[
i
];

1292 i‡(
dev_öfo
->
devi˚
 !(
u16
)
IWL_CFG_ANY
 &&

1293 
dev_öfo
->
devi˚
 != device)

1296 i‡(
dev_öfo
->
subdevi˚
 !(
u16
)
IWL_CFG_ANY
 &&

1297 
dev_öfo
->
subdevi˚
 !
subsy°em_devi˚
)

1300 i‡(
dev_öfo
->
mac_ty≥
 !(
u16
)
IWL_CFG_ANY
 &&

1301 
dev_öfo
->
mac_ty≥
 != mac_type)

1304 i‡(
dev_öfo
->
mac_°ï
 !(
u8
)
IWL_CFG_ANY
 &&

1305 
dev_öfo
->
mac_°ï
 != mac_step)

1308 i‡(
dev_öfo
->
rf_ty≥
 !(
u16
)
IWL_CFG_ANY
 &&

1309 
dev_öfo
->
rf_ty≥
 !=Ñf_type)

1312 i‡(
dev_öfo
->
cdb
 !(
u8
)
IWL_CFG_ANY
 &&

1313 
dev_öfo
->
cdb
 != cdb)

1316 i‡(
dev_öfo
->
jackë
 !(
u8
)
IWL_CFG_ANY
 &&

1317 
dev_öfo
->
jackë
 != jacket)

1320 i‡(
dev_öfo
->
rf_id
 !(
u8
)
IWL_CFG_ANY
 &&

1321 
dev_öfo
->
rf_id
 !=Ñf_id)

1324 i‡(
dev_öfo
->
no_160
 !(
u8
)
IWL_CFG_ANY
 &&

1325 
dev_öfo
->
no_160
 !=Ço_160)

1328 i‡(
dev_öfo
->
c‹es
 !(
u8
)
IWL_CFG_ANY
 &&

1329 
dev_öfo
->
c‹es
 != cores)

1332 i‡(
dev_öfo
->
rf_°ï
 !(
u8
)
IWL_CFG_ANY
 &&

1333 
dev_öfo
->
rf_°ï
 !=Ñf_step)

1336  
dev_öfo
;

1339  
NULL
;

1340 
	}
}

1341 
EXPORT_SYMBOL_IF_IWLWIFI_KUNIT
(
iwl_pci_föd_dev_öfo
);

1343 
	$iwl_pci_¥obe
(
pci_dev
 *
pdev
, c⁄° 
pci_devi˚_id
 *
ít
)

1345 c⁄° 
iwl_cfg_å™s_∑øms
 *
å™s
;

1346 c⁄° 
iwl_cfg
 *
cfg_7265d
 
__maybe_unu£d
 = 
NULL
;

1347 c⁄° 
iwl_dev_öfo
 *
dev_öfo
;

1348 
iwl_å™s
 *iwl_trans;

1349 
iwl_å™s_pcõ
 *
å™s_pcõ
;

1350 
ªt
;

1351 c⁄° 
iwl_cfg
 *
cfg
;

1353 
å™s
 = (*)(
ít
->
drivî_d©a
 & ~
TRANS_CFG_MARKER
);

1361 
cfg
 = (*)(
ít
->
drivî_d©a
 & ~
TRANS_CFG_MARKER
);

1364 
	`BUILD_BUG_ON
(
	`off£tof
(
iwl_cfg
, 
å™s
));

1366 
iwl_å™s
 = 
	`iwl_å™s_pcõ_Æloc
(
pdev
, 
ít
, 
å™s
);

1367 i‡(
	`IS_ERR
(
iwl_å™s
))

1368  
	`PTR_ERR
(
iwl_å™s
);

1370 
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
iwl_å™s
);

1379 
ªt
 = 
	`iwl_pcõ_¥ï¨e_ˇrd_hw
(
iwl_å™s
);

1380 i‡(!
ªt
) {

1381 
ªt
 = 
	`iwl_föish_nic_öô
(
iwl_å™s
);

1382 i‡(
ªt
)

1383 
out_‰ì_å™s
;

1384 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
iwl_å™s
)) {

1385 
	`gë_¸f_id
(
iwl_å™s
);

1387 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
iwl_å™s
);

1389 
ªt
 = -
EIO
;

1390 
out_‰ì_å™s
;

1394 
iwl_å™s
->
hw_rf_id
 = 
	`iwl_ªad32
(iwl_å™s, 
CSR_HW_RF_ID
);

1401 i‡(
iwl_å™s
->
å™s_cfg
->
rf_id
 &&

1402 
iwl_å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_9000
 &&

1403 !
	`CSR_HW_RFID_TYPE
(
iwl_å™s
->
hw_rf_id
Ë&& 
	`m≠_¸f_id
(iwl_trans)) {

1404 
ªt
 = -
EINVAL
;

1405 
out_‰ì_å™s
;

1408 
	`IWL_INFO
(
iwl_å™s
, "PCI dev %04x/%04x,Ñev=0x%x,Ñfid=0x%x\n",

1409 
pdev
->
devi˚
,Ödev->
subsy°em_devi˚
,

1410 
iwl_å™s
->
hw_ªv
, iwl_å™s->
hw_rf_id
);

1412 
dev_öfo
 = 
	`iwl_pci_föd_dev_öfo
(
pdev
->
devi˚
,Ödev->
subsy°em_devi˚
,

1413 
	`CSR_HW_REV_TYPE
(
iwl_å™s
->
hw_ªv
),

1414 
iwl_å™s
->
hw_ªv_°ï
,

1415 
	`CSR_HW_RFID_TYPE
(
iwl_å™s
->
hw_rf_id
),

1416 
	`CSR_HW_RFID_IS_CDB
(
iwl_å™s
->
hw_rf_id
),

1417 
	`CSR_HW_RFID_IS_JACKET
(
iwl_å™s
->
hw_rf_id
),

1418 
	`IWL_SUBDEVICE_RF_ID
(
pdev
->
subsy°em_devi˚
),

1419 
	`IWL_SUBDEVICE_NO_160
(
pdev
->
subsy°em_devi˚
),

1420 
	`IWL_SUBDEVICE_CORES
(
pdev
->
subsy°em_devi˚
),

1421 
	`CSR_HW_RFID_STEP
(
iwl_å™s
->
hw_rf_id
));

1422 i‡(
dev_öfo
) {

1423 
iwl_å™s
->
cfg
 = 
dev_öfo
->cfg;

1424 
iwl_å™s
->
«me
 = 
dev_öfo
->name;

1425 
iwl_å™s
->
no_160
 = 
dev_öfo
->no_160 =
IWL_CFG_NO_160
;

1428 #i‡
	`IS_ENABLED
(
CONFIG_IWLMVM
)

1436 i‡(
cfg
 =&
iwl7265_2ac_cfg
)

1437 
cfg_7265d
 = &
iwl7265d_2ac_cfg
;

1438 i‡(
cfg
 =&
iwl7265_2n_cfg
)

1439 
cfg_7265d
 = &
iwl7265d_2n_cfg
;

1440 i‡(
cfg
 =&
iwl7265_n_cfg
)

1441 
cfg_7265d
 = &
iwl7265d_n_cfg
;

1442 i‡(
cfg_7265d
 &&

1443 (
iwl_å™s
->
hw_ªv
 & 
CSR_HW_REV_TYPE_MSK
Ë=
CSR_HW_REV_TYPE_7265D
)

1444 
iwl_å™s
->
cfg
 = 
cfg_7265d
;

1452 i‡(
iwl_å™s
->
hw_ªv
 =
CSR_HW_REV_TYPE_QU_C0
) {

1453 i‡(
iwl_å™s
->
cfg
 =&
iwl_ax201_cfg_qu_hr
)

1454 
iwl_å™s
->
cfg
 = &
iwl_ax201_cfg_qu_c0_hr_b0
;

1455 i‡(
iwl_å™s
->
cfg
 =&
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
)

1456 
iwl_å™s
->
cfg
 = &
kûÀr1650s_2ax_cfg_qu_c0_hr_b0
;

1457 i‡(
iwl_å™s
->
cfg
 =&
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
)

1458 
iwl_å™s
->
cfg
 = &
kûÀr1650i_2ax_cfg_qu_c0_hr_b0
;

1462 i‡(
iwl_å™s
->
hw_ªv
 =
CSR_HW_REV_TYPE_QUZ
) {

1463 i‡(
iwl_å™s
->
cfg
 =&
iwl_ax201_cfg_qu_hr
)

1464 
iwl_å™s
->
cfg
 = &
iwl_ax201_cfg_quz_hr
;

1465 i‡(
iwl_å™s
->
cfg
 =&
kûÀr1650s_2ax_cfg_qu_b0_hr_b0
)

1466 
iwl_å™s
->
cfg
 = &
iwl_ax1650s_cfg_quz_hr
;

1467 i‡(
iwl_å™s
->
cfg
 =&
kûÀr1650i_2ax_cfg_qu_b0_hr_b0
)

1468 
iwl_å™s
->
cfg
 = &
iwl_ax1650i_cfg_quz_hr
;

1476 i‡(!
iwl_å™s
->
cfg
) {

1477 i‡(
ít
->
drivî_d©a
 & 
TRANS_CFG_MARKER
) {

1478 
	`¥_îr
("No config found for PCI dev %04x/%04x,Ñev=0x%x,Ñfid=0x%x\n",

1479 
pdev
->
devi˚
,Ödev->
subsy°em_devi˚
,

1480 
iwl_å™s
->
hw_ªv
, iwl_å™s->
hw_rf_id
);

1481 
ªt
 = -
EINVAL
;

1482 
out_‰ì_å™s
;

1484 
iwl_å™s
->
cfg
 = cfg;

1488 i‡(!
iwl_å™s
->
«me
)

1489 
iwl_å™s
->
«me
 = iwl_å™s->
cfg
->name;

1491 i‡(
iwl_å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
) {

1492 i‡(
	`WARN_ON
(!
iwl_å™s
->
cfg
->
num_rbds
)) {

1493 
ªt
 = -
EINVAL
;

1494 
out_‰ì_å™s
;

1496 
å™s_pcõ
->
num_rx_bufs
 = 
iwl_å™s
->
cfg
->
num_rbds
;

1498 
å™s_pcõ
->
num_rx_bufs
 = 
RX_QUEUE_SIZE
;

1501 i‡(!
iwl_å™s
->
å™s_cfg
->
öãgøãd
) {

1502 
u16
 
lök_°©us
;

1504 
	`pcõ_ˇ∑bûôy_ªad_w‹d
(
pdev
, 
PCI_EXP_LNKSTA
, &
lök_°©us
);

1506 
iwl_å™s
->
pcõ_lök_•ìd
 =

1507 
	`u16_gë_bôs
(
lök_°©us
, 
PCI_EXP_LNKSTA_CLS
);

1510 
ªt
 = 
	`iwl_å™s_öô
(
iwl_å™s
);

1511 i‡(
ªt
)

1512 
out_‰ì_å™s
;

1514 
	`pci_£t_drvd©a
(
pdev
, 
iwl_å™s
);

1517 
	`iwl_pcõ_¥ï¨e_ˇrd_hw
(
iwl_å™s
);

1519 
iwl_å™s
->
drv
 = 
	`iwl_drv_°¨t
(iwl_trans);

1521 i‡(
	`IS_ERR
(
iwl_å™s
->
drv
)) {

1522 
ªt
 = 
	`PTR_ERR
(
iwl_å™s
->
drv
);

1523 
out_‰ì_å™s
;

1527 
	`iwl_å™s_pcõ_dbgfs_ªgi°î
(
iwl_å™s
);

1531 
out_‰ì_å™s
:

1532 
	`iwl_å™s_pcõ_‰ì
(
iwl_å™s
);

1533  
ªt
;

1534 
	}
}

1536 
	$iwl_pci_ªmove
(
pci_dev
 *
pdev
)

1538 
iwl_å™s
 *
å™s
 = 
	`pci_gë_drvd©a
(
pdev
);

1540 i‡(!
å™s
)

1543 
	`iwl_drv_°›
(
å™s
->
drv
);

1545 
	`iwl_å™s_pcõ_‰ì
(
å™s
);

1546 
	}
}

1548 #ifde‡
CONFIG_PM_SLEEP


1550 
	$iwl_pci_su•íd
(
devi˚
 *device)

1558 
	}
}

1560 
	$iwl_pci_ªsume
(
devi˚
 *device)

1562 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
devi˚
);

1563 
iwl_å™s
 *
å™s
 = 
	`pci_gë_drvd©a
(
pdev
);

1564 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1575 
	`pci_wrôe_c⁄fig_byã
(
pdev
, 
PCI_CFG_RETRY_TIMEOUT
, 0x00);

1577 i‡(!
å™s
->
›_mode
)

1581 i‡(
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

1585 
	`iwl_pcõ_c⁄f_msix_hw
(
å™s_pcõ
);

1592 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

1593 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

1594 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

1595 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

1598 
	}
}

1600 c⁄° 
dev_pm_›s
 
	giwl_dev_pm_›s
 = {

1601 
SET_SYSTEM_SLEEP_PM_OPS
(
iwl_pci_su•íd
,

1602 
iwl_pci_ªsume
)

1605 
	#IWL_PM_OPS
 (&
iwl_dev_pm_›s
)

	)

1609 
	#IWL_PM_OPS
 
NULL


	)

1613 
pci_drivî
 
	giwl_pci_drivî
 = {

1614 .
«me
 = 
DRV_NAME
,

1615 .
	gid_èbÀ
 = 
iwl_hw_ˇrd_ids
,

1616 .
	g¥obe
 = 
iwl_pci_¥obe
,

1617 .
	gªmove
 = 
iwl_pci_ªmove
,

1618 .
	gdrivî
.
	gpm
 = 
IWL_PM_OPS
,

1621 
__mu°_check
 
	$iwl_pci_ªgi°î_drivî
()

1623 
ªt
;

1624 
ªt
 = 
	`pci_ªgi°î_drivî
(&
iwl_pci_drivî
);

1625 i‡(
ªt
)

1626 
	`¥_îr
("UnableÅo initialize PCI module\n");

1628  
ªt
;

1629 
	}
}

1631 
	$iwl_pci_uƒegi°î_drivî
()

1633 
	`pci_uƒegi°î_drivî
(&
iwl_pci_drivî
);

1634 
	}
}

	@pcie/internal.h

7 #i‚de‡
__iwl_å™s_öt_pcõ_h__


8 
	#__iwl_å™s_öt_pcõ_h__


	)

10 
	~<löux/•ölock.h
>

11 
	~<löux/öãºu±.h
>

12 
	~<löux/skbuff.h
>

13 
	~<löux/waô.h
>

14 
	~<löux/pci.h
>

15 
	~<löux/timî.h
>

16 
	~<löux/˝u.h
>

18 
	~"iwl-fh.h
"

19 
	~"iwl-c§.h
"

20 
	~"iwl-å™s.h
"

21 
	~"iwl-debug.h
"

22 
	~"iwl-io.h
"

23 
	~"iwl-›-mode.h
"

24 
	~"iwl-drv.h
"

25 
	~"queue/tx.h
"

26 
	~"iwl-c⁄ãxt-öfo.h
"

31 
	#RX_NUM_QUEUES
 1

	)

32 
	#RX_POST_REQ_ALLOC
 2

	)

33 
	#RX_CLAIM_REQ_ALLOC
 8

	)

34 
	#RX_PENDING_WATERMARK
 16

	)

35 
	#FIRST_RX_QUEUE
 512

	)

37 
	giwl_ho°_cmd
;

52 
	siwl_rx_mem_buf„r
 {

53 
dma_addr_t
 
	m∑ge_dma
;

54 
∑ge
 *
	m∑ge
;

55 
li°_hód
 
	mli°
;

56 
u32
 
	moff£t
;

57 
u16
 
	mvid
;

58 
boﬁ
 
	mövÆid
;

62 
	si§_°©i°ics
 {

63 
u32
 
	mhw
;

64 
u32
 
	msw
;

65 
u32
 
	mîr_code
;

66 
u32
 
	msch
;

67 
u32
 
	mÆive
;

68 
u32
 
	mrfkûl
;

69 
u32
 
	m˘kûl
;

70 
u32
 
	mwakeup
;

71 
u32
 
	mrx
;

72 
u32
 
	mtx
;

73 
u32
 
	munh™dÀd
;

82 
	siwl_rx_å™s„r_desc
 {

83 
__À16
 
	mrbid
;

84 
__À16
 
	mª£rved
[3];

85 
__À64
 
	maddr
;

86 } 
	g__∑cked
;

88 
	#IWL_RX_CD_FLAGS_FRAGMENTED
 
	`BIT
(0)

	)

97 
	siwl_rx_com∂ëi⁄_desc
 {

98 
__À32
 
	mª£rved1
;

99 
__À16
 
	mrbid
;

100 
u8
 
	mÊags
;

101 
u8
 
	mª£rved2
[25];

102 } 
	g__∑cked
;

110 
	siwl_rx_com∂ëi⁄_desc_bz
 {

111 
__À16
 
	mrbid
;

112 
u8
 
	mÊags
;

113 
u8
 
	mª£rved
[1];

114 } 
	g__∑cked
;

146 
	siwl_rxq
 {

147 
	mid
;

148 *
	mbd
;

149 
dma_addr_t
 
	mbd_dma
;

150 *
	mu£d_bd
;

151 
dma_addr_t
 
	mu£d_bd_dma
;

152 
u32
 
	mªad
;

153 
u32
 
	mwrôe
;

154 
u32
 
	m‰ì_cou¡
;

155 
u32
 
	mu£d_cou¡
;

156 
u32
 
	mwrôe_a˘uÆ
;

157 
u32
 
	mqueue_size
;

158 
li°_hód
 
	mrx_‰ì
;

159 
li°_hód
 
	mrx_u£d
;

160 
boﬁ
 
	m√ed_upd©e
, 
	m√xt_rb_is_‰agmít
;

161 *
	mrb_°ts
;

162 
dma_addr_t
 
	mrb_°ts_dma
;

163 
•ölock_t
 
	mlock
;

164 
«pi_°ru˘
 
	m«pi
;

165 
iwl_rx_mem_buf„r
 *
	mqueue
[
RX_QUEUE_SIZE
];

180 
	siwl_rb_Æloˇt‹
 {

181 
©omic_t
 
	mªq_≥ndög
;

182 
©omic_t
 
	mªq_ªady
;

183 
li°_hód
 
	mrbd_Æloˇãd
;

184 
li°_hód
 
	mrbd_em±y
;

185 
•ölock_t
 
	mlock
;

186 
w‹kqueue_°ru˘
 *
	mÆloc_wq
;

187 
w‹k_°ru˘
 
	mrx_Æloc
;

195 
ölöe
 
u16
 
	$iwl_gë_˛o£d_rb_°ts
(
iwl_å™s
 *
å™s
,

196 
iwl_rxq
 *
rxq
)

198 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

199 
__À16
 *
rb_°ts
 = 
rxq
->rb_stts;

201  
	`À16_to_˝u
(
	`READ_ONCE
(*
rb_°ts
));

203 
iwl_rb_°©us
 *
rb_°ts
 = 
rxq
->rb_stts;

205  
	`À16_to_˝u
(
	`READ_ONCE
(
rb_°ts
->
˛o£d_rb_num
)) & 0xFFF;

207 
	}
}

209 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


219 
	eiwl_fw_m⁄_dbgfs_°©e
 {

220 
	mIWL_FW_MON_DBGFS_STATE_CLOSED
,

221 
	mIWL_FW_MON_DBGFS_STATE_OPEN
,

222 
	mIWL_FW_MON_DBGFS_STATE_DISABLED
,

231 
	eiwl_sh¨ed_úq_Êags
 {

232 
	mIWL_SHARED_IRQ_NON_RX
 = 
BIT
(0),

233 
	mIWL_SHARED_IRQ_FIRST_RSS
 = 
BIT
(1),

242 
	eiwl_image_ª•⁄£_code
 {

243 
	mIWL_IMAGE_RESP_DEF
 = 0,

244 
	mIWL_IMAGE_RESP_SUCCESS
 = 1,

245 
	mIWL_IMAGE_RESP_FAIL
 = 2,

248 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


259 
	sc⁄t_ªc
 {

260 
u32
 
	m¥ev_wr_±r
;

261 
u32
 
	m¥ev_wøp_˙t
;

262 
u8
 
	m°©e
;

264 
muãx
 
	mmuãx
;

268 
	eiwl_pcõ_fw_ª£t_°©e
 {

269 
	mFW_RESET_IDLE
,

270 
	mFW_RESET_REQUESTED
,

271 
	mFW_RESET_OK
,

272 
	mFW_RESET_ERROR
,

282 
	eiwl_pcõ_imr_°©us
 {

283 
	mIMR_D2S_IDLE
,

284 
	mIMR_D2S_REQUESTED
,

285 
	mIMR_D2S_COMPLETED
,

286 
	mIMR_D2S_ERROR
,

371 
	siwl_å™s_pcõ
 {

372 
iwl_rxq
 *
	mrxq
;

373 
iwl_rx_mem_buf„r
 *
	mrx_poﬁ
;

374 
iwl_rx_mem_buf„r
 **
	mglobÆ_èbÀ
;

375 
iwl_rb_Æloˇt‹
 
	mrba
;

377 
iwl_c⁄ãxt_öfo
 *
	m˘xt_öfo
;

378 
iwl_c⁄ãxt_öfo_gí3
 *
	m˘xt_öfo_gí3
;

380 
iwl_¥ph_öfo
 *
	m¥ph_öfo
;

381 
iwl_¥ph_s¸©ch
 *
	m¥ph_s¸©ch
;

382 *
	miml
;

383 
dma_addr_t
 
	m˘xt_öfo_dma_addr
;

384 
dma_addr_t
 
	m¥ph_öfo_dma_addr
;

385 
dma_addr_t
 
	m¥ph_s¸©ch_dma_addr
;

386 
dma_addr_t
 
	miml_dma_addr
;

387 
iwl_å™s
 *
	må™s
;

389 
√t_devi˚
 
	m«pi_dev
;

392 
__À32
 *
	mi˘_tbl
;

393 
dma_addr_t
 
	mi˘_tbl_dma
;

394 
	mi˘_ödex
;

395 
boﬁ
 
	mu£_i˘
;

396 
boﬁ
 
	mis_down
, 
	m›mode_down
;

397 
s8
 
	mdebug_rfkûl
;

398 
i§_°©i°ics
 
	mi§_°©s
;

400 
•ölock_t
 
	múq_lock
;

401 
muãx
 
	mmuãx
;

402 
u32
 
	möè_mask
;

403 
u32
 
	mscd_ba£_addr
;

404 
iwl_dma_±r
 
	mkw
;

407 
iwl_døm_ªgi⁄s
 
	m≤vm_d©a
;

408 
iwl_døm_ªgi⁄s
 
	mªdu˚d_èbÀs_d©a
;

410 
iwl_txq
 *
	mtxq_mem‹y
;

413 
pci_dev
 *
	mpci_dev
;

414 
u8
 
__iomem
 *
	mhw_ba£
;

416 
boﬁ
 
	mucode_wrôe_com∂ëe
;

417 
boﬁ
 
	msx_com∂ëe
;

418 
waô_queue_hód_t
 
	mucode_wrôe_waôq
;

419 
waô_queue_hód_t
 
	msx_waôq
;

421 
u8
 
	mn_no_ª˛aim_cmds
;

422 
u8
 
	mno_ª˛aim_cmds
[
MAX_NO_RECLAIM_CMDS
];

423 
u16
 
	mnum_rx_bufs
;

425 
iwl_amsdu_size
 
	mrx_buf_size
;

426 
boﬁ
 
	mscd_£t_a˘ive
;

427 
boﬁ
 
	mpcõ_dbg_dum≥d_⁄˚
;

428 
u32
 
	mrx_∑ge_‹dî
;

429 
u32
 
	mrx_buf_byãs
;

430 
u32
 
	msuµ‹ãd_dma_mask
;

433 
•ölock_t
 
	mÆloc_∑ge_lock
;

434 
∑ge
 *
	mÆloc_∑ge
;

435 
u32
 
	mÆloc_∑ge_u£d
;

438 
•ölock_t
 
	mªg_lock
;

439 
boﬁ
 
	mcmd_hﬁd_nic_awake
;

441 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


442 
c⁄t_ªc
 
	mfw_m⁄_d©a
;

445 
msix_íåy
 
	mmsix_íåõs
[
IWL_MAX_RX_HW_QUEUES
];

446 
boﬁ
 
	mmsix_íabÀd
;

447 
u8
 
	msh¨ed_vec_mask
;

448 
u32
 
	mÆloc_vecs
;

449 
u32
 
	mdef_úq
;

450 
u32
 
	mfh_öô_mask
;

451 
u32
 
	mhw_öô_mask
;

452 
u32
 
	mfh_mask
;

453 
u32
 
	mhw_mask
;

454 
˝umask_t
 
	mafföôy_mask
[
IWL_MAX_RX_HW_QUEUES
];

455 
u16
 
	mtx_cmd_queue_size
;

456 
boﬁ
 
	mö_ªsˇn
;

458 *
	mba£_rb_°ts
;

459 
dma_addr_t
 
	mba£_rb_°ts_dma
;

461 
boﬁ
 
	mfw_ª£t_h™dshake
;

462 
iwl_pcõ_fw_ª£t_°©e
 
	mfw_ª£t_°©e
;

463 
waô_queue_hód_t
 
	mfw_ª£t_waôq
;

464 
iwl_pcõ_imr_°©us
 
	mimr_°©us
;

465 
waô_queue_hód_t
 
	mimr_waôq
;

466 
	mrf_«me
[32];

469 
ölöe
 
iwl_å™s_pcõ
 *

470 
	$IWL_TRANS_GET_PCIE_TRANS
(
iwl_å™s
 *
å™s
)

472  (*)
å™s
->
å™s_•ecific
;

473 
	}
}

475 
ölöe
 
	$iwl_pcõ_˛ór_úq
(
iwl_å™s
 *
å™s
, 
queue
)

485 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_AUTOMASK_ST_AD
, 
	`BIT
(
queue
));

486 
	}
}

488 
ölöe
 
iwl_å™s
 *

489 
	$iwl_å™s_pcõ_gë_å™s
(
iwl_å™s_pcõ
 *
å™s_pcõ
)

491  
	`c⁄èöî_of
((*)
å™s_pcõ
, 
iwl_å™s
,

492 
å™s_•ecific
);

493 
	}
}

499 
iwl_å™s


500 *
iwl_å™s_pcõ_Æloc
(
pci_dev
 *
pdev
,

501 c⁄° 
pci_devi˚_id
 *
ít
,

502 c⁄° 
iwl_cfg_å™s_∑øms
 *
cfg_å™s
);

503 
iwl_å™s_pcõ_‰ì
(
iwl_å™s
 *
å™s
);

504 
iwl_å™s_pcõ_‰ì_≤vm_døm_ªgi⁄s
(
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
,

505 
devi˚
 *
dev
);

507 
boﬁ
 
__iwl_å™s_pcõ_gøb_nic_ac˚ss
(
iwl_å™s
 *
å™s
);

508 
	#_iwl_å™s_pcõ_gøb_nic_ac˚ss
(
å™s
) \

509 
	`__c⁄d_lock
(
nic_ac˚ss_nobh
, \

510 
	`likñy
(
	`__iwl_å™s_pcõ_gøb_nic_ac˚ss
(
å™s
)))

	)

515 
iwl_pcõ_rx_öô
(
iwl_å™s
 *
å™s
);

516 
iwl_pcõ_gí2_rx_öô
(
iwl_å™s
 *
å™s
);

517 
úqªtu∫_t
 
iwl_pcõ_msix_i§
(
úq
, *
d©a
);

518 
úqªtu∫_t
 
iwl_pcõ_úq_h™dÀr
(
úq
, *
dev_id
);

519 
úqªtu∫_t
 
iwl_pcõ_úq_msix_h™dÀr
(
úq
, *
dev_id
);

520 
úqªtu∫_t
 
iwl_pcõ_úq_rx_msix_h™dÀr
(
úq
, *
dev_id
);

521 
iwl_pcõ_rx_°›
(
iwl_å™s
 *
å™s
);

522 
iwl_pcõ_rx_‰ì
(
iwl_å™s
 *
å™s
);

523 
iwl_pcõ_‰ì_rbs_poﬁ
(
iwl_å™s
 *
å™s
);

524 
iwl_pcõ_rx_öô_rxb_li°s
(
iwl_rxq
 *
rxq
);

525 
iwl_pcõ_rx_«pi_sync
(
iwl_å™s
 *
å™s
);

526 
iwl_pcõ_rxq_Æloc_rbs
(
iwl_å™s
 *
å™s
, 
gÂ_t
 
¥i‹ôy
,

527 
iwl_rxq
 *
rxq
);

532 
úqªtu∫_t
 
iwl_pcõ_i§
(
úq
, *
d©a
);

533 
iwl_pcõ_Æloc_i˘
(
iwl_å™s
 *
å™s
);

534 
iwl_pcõ_‰ì_i˘
(
iwl_å™s
 *
å™s
);

535 
iwl_pcõ_ª£t_i˘
(
iwl_å™s
 *
å™s
);

536 
iwl_pcõ_dißbÀ_i˘
(
iwl_å™s
 *
å™s
);

541 
iwl_pcõ_tx_öô
(
iwl_å™s
 *
å™s
);

542 
iwl_pcõ_tx_°¨t
(
iwl_å™s
 *
å™s
, 
u32
 
scd_ba£_addr
);

543 
iwl_pcõ_tx_°›
(
iwl_å™s
 *
å™s
);

544 
iwl_pcõ_tx_‰ì
(
iwl_å™s
 *
å™s
);

545 
boﬁ
 
iwl_å™s_pcõ_txq_íabÀ
(
iwl_å™s
 *
å™s
, 
queue
, 
u16
 
s¢
,

546 c⁄° 
iwl_å™s_txq_scd_cfg
 *
cfg
,

547 
wdg_timeout
);

548 
iwl_å™s_pcõ_txq_dißbÀ
(
iwl_å™s
 *
å™s
, 
queue
,

549 
boﬁ
 
c⁄figuª_scd
);

550 
iwl_å™s_pcõ_txq_£t_sh¨ed_mode
(
iwl_å™s
 *
å™s
, 
u32
 
txq_id
,

551 
boﬁ
 
sh¨ed_mode
);

552 
iwl_å™s_pcõ_tx
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

553 
iwl_devi˚_tx_cmd
 *
dev_cmd
, 
txq_id
);

554 
iwl_pcõ_txq_check_wΩås
(
iwl_å™s
 *
å™s
);

555 
iwl_å™s_pcõ_£nd_hcmd
(
iwl_å™s
 *
å™s
, 
iwl_ho°_cmd
 *
cmd
);

556 
iwl_pcõ_hcmd_com∂ëe
(
iwl_å™s
 *
å™s
,

557 
iwl_rx_cmd_buf„r
 *
rxb
);

558 
iwl_å™s_pcõ_tx_ª£t
(
iwl_å™s
 *
å™s
);

563 
iwl_pcõ_dump_c§
(
iwl_å™s
 *
å™s
);

568 
ölöe
 
	$_iwl_dißbÀ_öãºu±s
(
iwl_å™s
 *
å™s
)

570 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

572 
	`˛ór_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
);

573 i‡(!
å™s_pcõ
->
msix_íabÀd
) {

575 
	`iwl_wrôe32
(
å™s
, 
CSR_INT_MASK
, 0x00000000);

579 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 0xffffffff);

580 
	`iwl_wrôe32
(
å™s
, 
CSR_FH_INT_STATUS
, 0xffffffff);

583 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
,

584 
å™s_pcõ
->
fh_öô_mask
);

585 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_HW_INT_MASK_AD
,

586 
å™s_pcõ
->
hw_öô_mask
);

588 
	`IWL_DEBUG_ISR
(
å™s
, "Disabled interrupts\n");

589 
	}
}

591 
ölöe
 
	$iwl_pcõ_gë_num_£˘i⁄s
(c⁄° 
fw_img
 *
fw
,

592 
°¨t
)

594 
i
 = 0;

596 
°¨t
 < 
fw
->
num_£c
 &&

597 
fw
->
£c
[
°¨t
].
off£t
 !
CPU1_CPU2_SEPARATOR_SECTION
 &&

598 
fw
->
£c
[
°¨t
].
off£t
 !
PAGING_SEPARATOR_SECTION
) {

599 
°¨t
++;

600 
i
++;

603  
i
;

604 
	}
}

606 
ölöe
 
	$iwl_pcõ_˘xt_öfo_‰ì_fw_img
(
iwl_å™s
 *
å™s
)

608 
iwl_£lf_öô_døm
 *
døm
 = &
å™s
->
öô_døm
;

609 
i
;

611 i‡(!
døm
->
fw
) {

612 
	`WARN_ON
(
døm
->
fw_˙t
);

616 
i
 = 0; i < 
døm
->
fw_˙t
; i++)

617 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
døm
->
fw
[
i
].
size
,

618 
døm
->
fw
[
i
].
block
, døm->fw[i].
physiˇl
);

620 
	`k‰ì
(
døm
->
fw
);

621 
døm
->
fw_˙t
 = 0;

622 
døm
->
fw
 = 
NULL
;

623 
	}
}

625 
ölöe
 
	$iwl_dißbÀ_öãºu±s
(
iwl_å™s
 *
å™s
)

627 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

629 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

630 
	`_iwl_dißbÀ_öãºu±s
(
å™s
);

631 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

632 
	}
}

634 
ölöe
 
	$_iwl_íabÀ_öãºu±s
(
iwl_å™s
 *
å™s
)

636 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

638 
	`IWL_DEBUG_ISR
(
å™s
, "Enabling interrupts\n");

639 
	`£t_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
);

640 i‡(!
å™s_pcõ
->
msix_íabÀd
) {

641 
å™s_pcõ
->
öè_mask
 = 
CSR_INI_SET_MASK
;

642 
	`iwl_wrôe32
(
å™s
, 
CSR_INT_MASK
, 
å™s_pcõ
->
öè_mask
);

648 
å™s_pcõ
->
hw_mask
 =Åøns_pcõ->
hw_öô_mask
;

649 
å™s_pcõ
->
fh_mask
 =Åøns_pcõ->
fh_öô_mask
;

650 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
,

651 ~
å™s_pcõ
->
fh_mask
);

652 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_HW_INT_MASK_AD
,

653 ~
å™s_pcõ
->
hw_mask
);

655 
	}
}

657 
ölöe
 
	$iwl_íabÀ_öãºu±s
(
iwl_å™s
 *
å™s
)

659 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

661 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

662 
	`_iwl_íabÀ_öãºu±s
(
å™s
);

663 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

664 
	}
}

665 
ölöe
 
	$iwl_íabÀ_hw_öt_msk_msix
(
iwl_å™s
 *
å™s
, 
u32
 
msk
)

667 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

669 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_HW_INT_MASK_AD
, ~
msk
);

670 
å™s_pcõ
->
hw_mask
 = 
msk
;

671 
	}
}

673 
ölöe
 
	$iwl_íabÀ_fh_öt_msk_msix
(
iwl_å™s
 *
å™s
, 
u32
 
msk
)

675 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

677 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
, ~
msk
);

678 
å™s_pcõ
->
fh_mask
 = 
msk
;

679 
	}
}

681 
ölöe
 
	$iwl_íabÀ_fw_lﬂd_öt
(
iwl_å™s
 *
å™s
)

683 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

685 
	`IWL_DEBUG_ISR
(
å™s
, "Enabling FWÜoad interrupt\n");

686 i‡(!
å™s_pcõ
->
msix_íabÀd
) {

687 
å™s_pcõ
->
öè_mask
 = 
CSR_INT_BIT_FH_TX
;

688 
	`iwl_wrôe32
(
å™s
, 
CSR_INT_MASK
, 
å™s_pcõ
->
öè_mask
);

690 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_HW_INT_MASK_AD
,

691 
å™s_pcõ
->
hw_öô_mask
);

692 
	`iwl_íabÀ_fh_öt_msk_msix
(
å™s
,

693 
MSIX_FH_INT_CAUSES_D2S_CH0_NUM
);

695 
	}
}

697 
ölöe
 
	$iwl_íabÀ_fw_lﬂd_öt_˘x_öfo
(
iwl_å™s
 *
å™s
)

699 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

701 
	`IWL_DEBUG_ISR
(
å™s
, "Enabling ALIVE interrupt only\n");

703 i‡(!
å™s_pcõ
->
msix_íabÀd
) {

711 
å™s_pcõ
->
öè_mask
 = 
CSR_INT_BIT_ALIVE
 | 
CSR_INT_BIT_FH_RX
;

712 
	`iwl_wrôe32
(
å™s
, 
CSR_INT_MASK
, 
å™s_pcõ
->
öè_mask
);

714 
	`iwl_íabÀ_hw_öt_msk_msix
(
å™s
,

715 
MSIX_HW_INT_CAUSES_REG_ALIVE
);

720 
	`iwl_íabÀ_fh_öt_msk_msix
(
å™s
, 
å™s_pcõ
->
fh_öô_mask
);

722 
	}
}

724 
ölöe
 c⁄° *
	$queue_«me
(
devi˚
 *
dev
,

725 
iwl_å™s_pcõ
 *
å™s_p
, 
i
)

727 i‡(
å™s_p
->
sh¨ed_vec_mask
) {

728 
vec
 = 
å™s_p
->
sh¨ed_vec_mask
 &

729 
IWL_SHARED_IRQ_FIRST_RSS
 ? 1 : 0;

731 i‡(
i
 == 0)

732  
DRV_NAME
 ":shared_IRQ";

734  
	`devm_ka•rötf
(
dev
, 
GFP_KERNEL
,

735 
DRV_NAME
 ":queue_%d", 
i
 + 
vec
);

737 i‡(
i
 == 0)

738  
DRV_NAME
 ":default_queue";

740 i‡(
i
 =
å™s_p
->
Æloc_vecs
 - 1)

741  
DRV_NAME
 ":exception";

743  
	`devm_ka•rötf
(
dev
, 
GFP_KERNEL
,

744 
DRV_NAME
 ":queue_%d", 
i
);

745 
	}
}

747 
ölöe
 
	$iwl_íabÀ_rfkûl_öt
(
iwl_å™s
 *
å™s
)

749 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

751 
	`IWL_DEBUG_ISR
(
å™s
, "EnablingÑfkill interrupt\n");

752 i‡(!
å™s_pcõ
->
msix_íabÀd
) {

753 
å™s_pcõ
->
öè_mask
 = 
CSR_INT_BIT_RF_KILL
;

754 
	`iwl_wrôe32
(
å™s
, 
CSR_INT_MASK
, 
å™s_pcõ
->
öè_mask
);

756 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
,

757 
å™s_pcõ
->
fh_öô_mask
);

758 
	`iwl_íabÀ_hw_öt_msk_msix
(
å™s
,

759 
MSIX_HW_INT_CAUSES_REG_RF_KILL
);

762 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_9000
) {

768 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

769 
CSR_GP_CNTRL_REG_FLAG_RFKILL_WAKE_L1A_EN
);

771 
	}
}

773 
iwl_pcõ_h™dÀ_rfkûl_úq
(
iwl_å™s
 *
å™s
, 
boﬁ
 
‰om_úq
);

775 
ölöe
 
boﬁ
 
	$iwl_is_rfkûl_£t
(
iwl_å™s
 *
å™s
)

777 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

779 
	`lockdï_as£π_hñd
(&
å™s_pcõ
->
muãx
);

781 i‡(
å™s_pcõ
->
debug_rfkûl
 == 1)

782  
åue
;

784  !(
	`iwl_ªad32
(
å™s
, 
CSR_GP_CNTRL
) &

785 
CSR_GP_CNTRL_REG_FLAG_HW_RF_KILL_SW
);

786 
	}
}

788 
ölöe
 
	$__iwl_å™s_pcõ_£t_bôs_mask
(
iwl_å™s
 *
å™s
,

789 
u32
 
ªg
, u32 
mask
, u32 
vÆue
)

791 
u32
 
v
;

793 #ifde‡
CONFIG_IWLWIFI_DEBUG


794 
	`WARN_ON_ONCE
(
vÆue
 & ~
mask
);

797 
v
 = 
	`iwl_ªad32
(
å™s
, 
ªg
);

798 
v
 &~
mask
;

799 
v
 |
vÆue
;

800 
	`iwl_wrôe32
(
å™s
, 
ªg
, 
v
);

801 
	}
}

803 
ölöe
 
	$__iwl_å™s_pcõ_˛ór_bô
(
iwl_å™s
 *
å™s
,

804 
u32
 
ªg
, u32 
mask
)

806 
	`__iwl_å™s_pcõ_£t_bôs_mask
(
å™s
, 
ªg
, 
mask
, 0);

807 
	}
}

809 
ölöe
 
	$__iwl_å™s_pcõ_£t_bô
(
iwl_å™s
 *
å™s
,

810 
u32
 
ªg
, u32 
mask
)

812 
	`__iwl_å™s_pcõ_£t_bôs_mask
(
å™s
, 
ªg
, 
mask
, mask);

813 
	}
}

815 
ölöe
 
boﬁ
 
	$iwl_pcõ_dbg_⁄
(
iwl_å™s
 *
å™s
)

817  (
å™s
->
dbg
.
de°_év
 || 
	`iwl_å™s_dbg_öi_vÆid
(trans));

818 
	}
}

820 
iwl_å™s_pcõ_rf_kûl
(
iwl_å™s
 *
å™s
, 
boﬁ
 
°©e
, boﬁ 
‰om_úq
);

821 
iwl_å™s_pcõ_dump_ªgs
(
iwl_å™s
 *
å™s
);

823 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


824 
iwl_å™s_pcõ_dbgfs_ªgi°î
(
iwl_å™s
 *
å™s
);

826 
ölöe
 
	$iwl_å™s_pcõ_dbgfs_ªgi°î
(
iwl_å™s
 *
å™s
Ë{ 
	}
}

829 
iwl_pcõ_rx_Æloˇt‹_w‹k
(
w‹k_°ru˘
 *
d©a
);

832 
iwl_pcõ_gí2_≠m_öô
(
iwl_å™s
 *
å™s
);

833 
iwl_pcõ_≠m_c⁄fig
(
iwl_å™s
 *
å™s
);

834 
iwl_pcõ_¥ï¨e_ˇrd_hw
(
iwl_å™s
 *
å™s
);

835 
iwl_pcõ_synchr⁄ize_úqs
(
iwl_å™s
 *
å™s
);

836 
boﬁ
 
iwl_pcõ_check_hw_rf_kûl
(
iwl_å™s
 *
å™s
);

837 
iwl_å™s_pcõ_h™dÀ_°›_rfkûl
(
iwl_å™s
 *
å™s
,

838 
boﬁ
 
was_ö_rfkûl
);

839 
iwl_pcõ_≠m_°›_ma°î
(
iwl_å™s
 *
å™s
);

840 
iwl_pcõ_c⁄f_msix_hw
(
iwl_å™s_pcõ
 *
å™s_pcõ
);

841 
iwl_pcõ_Æloc_dma_±r
(
iwl_å™s
 *
å™s
,

842 
iwl_dma_±r
 *
±r
, 
size_t
 
size
);

843 
iwl_pcõ_‰ì_dma_±r
(
iwl_å™s
 *
å™s
, 
iwl_dma_±r
 *
±r
);

844 
iwl_pcõ_≠∂y_de°ö©i⁄
(
iwl_å™s
 *
å™s
);

847 
iwl_pcõ_Æloc_fw_m⁄ô‹
(
iwl_å™s
 *
å™s
, 
u8
 
max_powî
);

850 
iwl_å™s_pcõ_gí2_°¨t_fw
(
iwl_å™s
 *
å™s
,

851 c⁄° 
fw_img
 *
fw
, 
boﬁ
 
run_ö_rfkûl
);

852 
iwl_å™s_pcõ_gí2_fw_Æive
(
iwl_å™s
 *
å™s
, 
u32
 
scd_addr
);

853 
iwl_å™s_pcõ_gí2_£nd_hcmd
(
iwl_å™s
 *
å™s
,

854 
iwl_ho°_cmd
 *
cmd
);

855 
iwl_å™s_pcõ_gí2_°›_devi˚
(
iwl_å™s
 *
å™s
);

856 
_iwl_å™s_pcõ_gí2_°›_devi˚
(
iwl_å™s
 *
å™s
);

857 
iwl_pcõ_d3_com∂ëe_su•íd
(
iwl_å™s
 *
å™s
,

858 
boﬁ
 
ã°
, boﬁ 
ª£t
);

859 
iwl_pcõ_gí2_íqueue_hcmd
(
iwl_å™s
 *
å™s
,

860 
iwl_ho°_cmd
 *
cmd
);

861 
iwl_pcõ_íqueue_hcmd
(
iwl_å™s
 *
å™s
,

862 
iwl_ho°_cmd
 *
cmd
);

863 
iwl_å™s_pcõ_c›y_imr_fh
(
iwl_å™s
 *
å™s
,

864 
u32
 
d°_addr
, 
u64
 
§c_addr
, u32 
byã_˙t
);

865 
iwl_å™s_pcõ_c›y_imr
(
iwl_å™s
 *
å™s
,

866 
u32
 
d°_addr
, 
u64
 
§c_addr
, u32 
byã_˙t
);

	@pcie/rx.c

7 
	~<löux/sched.h
>

8 
	~<löux/waô.h
>

9 
	~<löux/gÂ.h
>

11 
	~"iwl-¥ph.h
"

12 
	~"iwl-io.h
"

13 
	~"öã∫Æ.h
"

14 
	~"iwl-›-mode.h
"

15 
	~"iwl-c⁄ãxt-öfo-gí3.h
"

119 
	$iwl_rxq_•a˚
(c⁄° 
iwl_rxq
 *
rxq
)

122 
	`WARN_ON
(
rxq
->
queue_size
 & (rxq->queue_size - 1));

130  (
rxq
->
ªad
 -Ñxq->
wrôe
 - 1Ë& (rxq->
queue_size
 - 1);

131 
	}
}

136 
ölöe
 
__À32
 
	$iwl_pcõ_dma_addr2rbd_±r
(
dma_addr_t
 
dma_addr
)

138  
	`˝u_to_À32
((
u32
)(
dma_addr
 >> 8));

139 
	}
}

144 
	$iwl_pcõ_rx_°›
(
iwl_å™s
 *
å™s
)

146 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

148 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
RFH_RXF_DMA_CFG_GEN3
, 0);

149  
	`iwl_pﬁl_umac_¥ph_bô
(
å™s
, 
RFH_GEN_STATUS_GEN3
,

150 
RXF_DMA_IDLE
, RXF_DMA_IDLE, 1000);

151 } i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
) {

152 
	`iwl_wrôe_¥ph
(
å™s
, 
RFH_RXF_DMA_CFG
, 0);

153  
	`iwl_pﬁl_¥ph_bô
(
å™s
, 
RFH_GEN_STATUS
,

154 
RXF_DMA_IDLE
, RXF_DMA_IDLE, 1000);

156 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_MEM_RCSR_CHNL0_CONFIG_REG
, 0);

157  
	`iwl_pﬁl_dúe˘_bô
(
å™s
, 
FH_MEM_RSSR_RX_STATUS_REG
,

158 
FH_RSSR_CHNL0_RX_STATUS_CHNL_IDLE
,

161 
	}
}

166 
	$iwl_pcõ_rxq_öc_wr_±r
(
iwl_å™s
 *
å™s
,

167 
iwl_rxq
 *
rxq
)

169 
u32
 
ªg
;

171 
	`lockdï_as£π_hñd
(&
rxq
->
lock
);

178 i‡(!
å™s
->
å™s_cfg
->
ba£_∑øms
->
shadow_ªg_íabÀ
 &&

179 
	`ã°_bô
(
STATUS_TPOWER_PMI
, &
å™s
->
°©us
)) {

180 
ªg
 = 
	`iwl_ªad32
(
å™s
, 
CSR_UCODE_DRV_GP1
);

182 i‡(
ªg
 & 
CSR_UCODE_DRV_GP1_BIT_MAC_SLEEP
) {

183 
	`IWL_DEBUG_INFO
(
å™s
, "Rx queueÑequesting wakeup, GP1 = 0x%x\n",

184 
ªg
);

185 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

186 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

187 
rxq
->
√ed_upd©e
 = 
åue
;

192 
rxq
->
wrôe_a˘uÆ
 = 
	`round_down
‘xq->
wrôe
, 8);

193 i‡(!
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

194 
	`iwl_wrôe32
(
å™s
, 
FH_RSCSR_CHNL0_WPTR
, 
rxq
->
wrôe_a˘uÆ
);

195 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

196 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_WRPTR
, 
rxq
->
wrôe_a˘uÆ
 |

197 
	`HBUS_TARG_WRPTR_RX_Q
(
rxq
->
id
));

199 
	`iwl_wrôe32
(
å™s
, 
	`RFH_Q_FRBDCB_WIDX_TRG
(
rxq
->
id
),

200 
rxq
->
wrôe_a˘uÆ
);

201 
	}
}

203 
	$iwl_pcõ_rxq_check_wΩå
(
iwl_å™s
 *
å™s
)

205 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

206 
i
;

208 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

209 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

211 i‡(!
rxq
->
√ed_upd©e
)

213 
	`•ö_lock_bh
(&
rxq
->
lock
);

214 
	`iwl_pcõ_rxq_öc_wr_±r
(
å™s
, 
rxq
);

215 
rxq
->
√ed_upd©e
 = 
Ál£
;

216 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

218 
	}
}

220 
	$iwl_pcõ_ª°ock_bd
(
iwl_å™s
 *
å™s
,

221 
iwl_rxq
 *
rxq
,

222 
iwl_rx_mem_buf„r
 *
rxb
)

224 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

225 
iwl_rx_å™s„r_desc
 *
bd
 = 
rxq
->bd;

227 
	`BUILD_BUG_ON
((*
bd
Ë!2 * (
u64
));

229 
bd
[
rxq
->
wrôe
].
addr
 = 
	`˝u_to_À64
(
rxb
->
∑ge_dma
);

230 
bd
[
rxq
->
wrôe
].
rbid
 = 
	`˝u_to_À16
(
rxb
->
vid
);

232 
__À64
 *
bd
 = 
rxq
->bd;

234 
bd
[
rxq
->
wrôe
] = 
	`˝u_to_À64
(
rxb
->
∑ge_dma
 |Ñxb->
vid
);

237 
	`IWL_DEBUG_RX
(
å™s
, "Assigned virtual RB ID %uÅo queue %d index %d\n",

238 (
u32
)
rxb
->
vid
, 
rxq
->
id
,Ñxq->
wrôe
);

239 
	}
}

244 
	$iwl_pcõ_rxmq_ª°ock
(
iwl_å™s
 *
å™s
,

245 
iwl_rxq
 *
rxq
)

247 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

248 
iwl_rx_mem_buf„r
 *
rxb
;

258 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

261 
	`•ö_lock_bh
(&
rxq
->
lock
);

262 
rxq
->
‰ì_cou¡
) {

264 
rxb
 = 
	`li°_fú°_íåy
(&
rxq
->
rx_‰ì
, 
iwl_rx_mem_buf„r
,

265 
li°
);

266 
	`li°_dñ
(&
rxb
->
li°
);

267 
rxb
->
övÆid
 = 
Ál£
;

269 
	`WARN_ON
(
rxb
->
∑ge_dma
 & 
å™s_pcõ
->
suµ‹ãd_dma_mask
);

271 
	`iwl_pcõ_ª°ock_bd
(
å™s
, 
rxq
, 
rxb
);

272 
rxq
->
wrôe
 = (rxq->wrôê+ 1Ë& (rxq->
queue_size
 - 1);

273 
rxq
->
‰ì_cou¡
--;

275 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

281 i‡(
rxq
->
wrôe_a˘uÆ
 !‘xq->
wrôe
 & ~0x7)) {

282 
	`•ö_lock_bh
(&
rxq
->
lock
);

283 
	`iwl_pcõ_rxq_öc_wr_±r
(
å™s
, 
rxq
);

284 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

286 
	}
}

291 
	$iwl_pcõ_rxsq_ª°ock
(
iwl_å™s
 *
å™s
,

292 
iwl_rxq
 *
rxq
)

294 
iwl_rx_mem_buf„r
 *
rxb
;

304 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

307 
	`•ö_lock_bh
(&
rxq
->
lock
);

308 (
	`iwl_rxq_•a˚
(
rxq
Ë> 0Ë&& (rxq->
‰ì_cou¡
)) {

309 
__À32
 *
bd
 = (__À32 *)
rxq
->bd;

311 
rxb
 = 
rxq
->
queue
[rxq->
wrôe
];

312 
	`BUG_ON
(
rxb
 &&Ñxb->
∑ge
);

315 
rxb
 = 
	`li°_fú°_íåy
(&
rxq
->
rx_‰ì
, 
iwl_rx_mem_buf„r
,

316 
li°
);

317 
	`li°_dñ
(&
rxb
->
li°
);

318 
rxb
->
övÆid
 = 
Ál£
;

321 
bd
[
rxq
->
wrôe
] = 
	`iwl_pcõ_dma_addr2rbd_±r
(
rxb
->
∑ge_dma
);

322 
rxq
->
queue
[rxq->
wrôe
] = 
rxb
;

323 
rxq
->
wrôe
 = (rxq->wrôê+ 1Ë& 
RX_QUEUE_MASK
;

324 
rxq
->
‰ì_cou¡
--;

326 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

330 i‡(
rxq
->
wrôe_a˘uÆ
 !‘xq->
wrôe
 & ~0x7)) {

331 
	`•ö_lock_bh
(&
rxq
->
lock
);

332 
	`iwl_pcõ_rxq_öc_wr_±r
(
å™s
, 
rxq
);

333 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

335 
	}
}

349 
	$iwl_pcõ_rxq_ª°ock
(
iwl_å™s
 *
å™s
, 
iwl_rxq
 *
rxq
)

351 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

352 
	`iwl_pcõ_rxmq_ª°ock
(
å™s
, 
rxq
);

354 
	`iwl_pcõ_rxsq_ª°ock
(
å™s
, 
rxq
);

355 
	}
}

361 
∑ge
 *
	$iwl_pcõ_rx_Æloc_∑ge
(
iwl_å™s
 *
å™s
,

362 
u32
 *
off£t
, 
gÂ_t
 
¥i‹ôy
)

364 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

365 
rbsize
 = 
	`iwl_å™s_gë_rb_size
(
å™s_pcõ
->
rx_buf_size
);

366 
Ælocsize
 = 
PAGE_SIZE
 << 
å™s_pcõ
->
rx_∑ge_‹dî
;

367 
∑ge
 *page;

368 
gÂ_t
 
gÂ_mask
 = 
¥i‹ôy
;

370 i‡(
å™s_pcõ
->
rx_∑ge_‹dî
 > 0)

371 
gÂ_mask
 |
__GFP_COMP
;

373 i‡(
å™s_pcõ
->
Æloc_∑ge
) {

374 
	`•ö_lock_bh
(&
å™s_pcõ
->
Æloc_∑ge_lock
);

376 i‡(
å™s_pcõ
->
Æloc_∑ge
) {

377 *
off£t
 = 
å™s_pcõ
->
Æloc_∑ge_u£d
;

378 
∑ge
 = 
å™s_pcõ
->
Æloc_∑ge
;

379 
å™s_pcõ
->
Æloc_∑ge_u£d
 +
rbsize
;

380 i‡(
å™s_pcõ
->
Æloc_∑ge_u£d
 >
Ælocsize
)

381 
å™s_pcõ
->
Æloc_∑ge
 = 
NULL
;

383 
	`gë_∑ge
(
∑ge
);

384 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
Æloc_∑ge_lock
);

385  
∑ge
;

387 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
Æloc_∑ge_lock
);

391 
∑ge
 = 
	`Æloc_∑ges
(
gÂ_mask
, 
å™s_pcõ
->
rx_∑ge_‹dî
);

392 i‡(!
∑ge
) {

393 i‡(
	`√t_øãlimô
())

394 
	`IWL_DEBUG_INFO
(
å™s
, "alloc_pages failed, order: %d\n",

395 
å™s_pcõ
->
rx_∑ge_‹dî
);

400 i‡(!(
gÂ_mask
 & 
__GFP_NOWARN
Ë&& 
	`√t_øãlimô
())

401 
	`IWL_CRIT
(
å™s
,

403  
NULL
;

406 i‡(2 * 
rbsize
 <
Ælocsize
) {

407 
	`•ö_lock_bh
(&
å™s_pcõ
->
Æloc_∑ge_lock
);

408 i‡(!
å™s_pcõ
->
Æloc_∑ge
) {

409 
	`gë_∑ge
(
∑ge
);

410 
å™s_pcõ
->
Æloc_∑ge
 = 
∑ge
;

411 
å™s_pcõ
->
Æloc_∑ge_u£d
 = 
rbsize
;

413 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
Æloc_∑ge_lock
);

416 *
off£t
 = 0;

417  
∑ge
;

418 
	}
}

429 
	$iwl_pcõ_rxq_Æloc_rbs
(
iwl_å™s
 *
å™s
, 
gÂ_t
 
¥i‹ôy
,

430 
iwl_rxq
 *
rxq
)

432 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

433 
iwl_rx_mem_buf„r
 *
rxb
;

434 
∑ge
 *page;

437 
off£t
;

439 
	`•ö_lock_bh
(&
rxq
->
lock
);

440 i‡(
	`li°_em±y
(&
rxq
->
rx_u£d
)) {

441 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

444 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

446 
∑ge
 = 
	`iwl_pcõ_rx_Æloc_∑ge
(
å™s
, &
off£t
, 
¥i‹ôy
);

447 i‡(!
∑ge
)

450 
	`•ö_lock_bh
(&
rxq
->
lock
);

452 i‡(
	`li°_em±y
(&
rxq
->
rx_u£d
)) {

453 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

454 
	`__‰ì_∑ges
(
∑ge
, 
å™s_pcõ
->
rx_∑ge_‹dî
);

457 
rxb
 = 
	`li°_fú°_íåy
(&
rxq
->
rx_u£d
, 
iwl_rx_mem_buf„r
,

458 
li°
);

459 
	`li°_dñ
(&
rxb
->
li°
);

460 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

462 
	`BUG_ON
(
rxb
->
∑ge
);

463 
rxb
->
∑ge
 =Öage;

464 
rxb
->
off£t
 = offset;

466 
rxb
->
∑ge_dma
 =

467 
	`dma_m≠_∑ge
(
å™s
->
dev
, 
∑ge
, 
rxb
->
off£t
,

468 
å™s_pcõ
->
rx_buf_byãs
,

469 
DMA_FROM_DEVICE
);

470 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
rxb
->
∑ge_dma
)) {

471 
rxb
->
∑ge
 = 
NULL
;

472 
	`•ö_lock_bh
(&
rxq
->
lock
);

473 
	`li°_add
(&
rxb
->
li°
, &
rxq
->
rx_u£d
);

474 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

475 
	`__‰ì_∑ges
(
∑ge
, 
å™s_pcõ
->
rx_∑ge_‹dî
);

479 
	`•ö_lock_bh
(&
rxq
->
lock
);

481 
	`li°_add_èû
(&
rxb
->
li°
, &
rxq
->
rx_‰ì
);

482 
rxq
->
‰ì_cou¡
++;

484 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

486 
	}
}

488 
	$iwl_pcõ_‰ì_rbs_poﬁ
(
iwl_å™s
 *
å™s
)

490 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

491 
i
;

493 i‡(!
å™s_pcõ
->
rx_poﬁ
)

496 
i
 = 0; i < 
	`RX_POOL_SIZE
(
å™s_pcõ
->
num_rx_bufs
); i++) {

497 i‡(!
å™s_pcõ
->
rx_poﬁ
[
i
].
∑ge
)

499 
	`dma_unm≠_∑ge
(
å™s
->
dev
, 
å™s_pcõ
->
rx_poﬁ
[
i
].
∑ge_dma
,

500 
å™s_pcõ
->
rx_buf_byãs
, 
DMA_FROM_DEVICE
);

501 
	`__‰ì_∑ges
(
å™s_pcõ
->
rx_poﬁ
[
i
].
∑ge
,

502 
å™s_pcõ
->
rx_∑ge_‹dî
);

503 
å™s_pcõ
->
rx_poﬁ
[
i
].
∑ge
 = 
NULL
;

505 
	}
}

513 
	$iwl_pcõ_rx_Æloˇt‹
(
iwl_å™s
 *
å™s
)

515 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

516 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

517 
li°_hód
 
loˇl_em±y
;

518 
≥ndög
 = 
	`©omic_ªad
(&
rba
->
ªq_≥ndög
);

520 
	`IWL_DEBUG_TPT
(
å™s
, "PídögáŒoˇti⁄Ñeque°†%d\n", 
≥ndög
);

523 
	`•ö_lock_bh
(&
rba
->
lock
);

525 
	`li°_ª∂a˚_öô
(&
rba
->
rbd_em±y
, &
loˇl_em±y
);

526 
	`•ö_u∆ock_bh
(&
rba
->
lock
);

528 
≥ndög
) {

529 
i
;

530 
	`LIST_HEAD
(
loˇl_Æloˇãd
);

531 
gÂ_t
 
gÂ_mask
 = 
GFP_KERNEL
;

534 i‡(
≥ndög
 < 
RX_PENDING_WATERMARK
)

535 
gÂ_mask
 |
__GFP_NOWARN
;

537 
i
 = 0; i < 
RX_CLAIM_REQ_ALLOC
;) {

538 
iwl_rx_mem_buf„r
 *
rxb
;

539 
∑ge
 *page;

546 
	`BUG_ON
(
	`li°_em±y
(&
loˇl_em±y
));

548 
rxb
 = 
	`li°_fú°_íåy
(&
loˇl_em±y
,

549 
iwl_rx_mem_buf„r
, 
li°
);

550 
	`BUG_ON
(
rxb
->
∑ge
);

553 
∑ge
 = 
	`iwl_pcõ_rx_Æloc_∑ge
(
å™s
, &
rxb
->
off£t
,

554 
gÂ_mask
);

555 i‡(!
∑ge
)

557 
rxb
->
∑ge
 =Öage;

560 
rxb
->
∑ge_dma
 = 
	`dma_m≠_∑ge
(
å™s
->
dev
, 
∑ge
,

561 
rxb
->
off£t
,

562 
å™s_pcõ
->
rx_buf_byãs
,

563 
DMA_FROM_DEVICE
);

564 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
rxb
->
∑ge_dma
)) {

565 
rxb
->
∑ge
 = 
NULL
;

566 
	`__‰ì_∑ges
(
∑ge
, 
å™s_pcõ
->
rx_∑ge_‹dî
);

571 
	`li°_move
(&
rxb
->
li°
, &
loˇl_Æloˇãd
);

572 
i
++;

575 
	`©omic_dec
(&
rba
->
ªq_≥ndög
);

576 
≥ndög
--;

578 i‡(!
≥ndög
) {

579 
≥ndög
 = 
	`©omic_ªad
(&
rba
->
ªq_≥ndög
);

580 i‡(
≥ndög
)

581 
	`IWL_DEBUG_TPT
(
å™s
,

583 
≥ndög
);

586 
	`•ö_lock_bh
(&
rba
->
lock
);

588 
	`li°_•li˚_èû
(&
loˇl_Æloˇãd
, &
rba
->
rbd_Æloˇãd
);

590 
	`li°_•li˚_èû_öô
(&
rba
->
rbd_em±y
, &
loˇl_em±y
);

591 
	`•ö_u∆ock_bh
(&
rba
->
lock
);

593 
	`©omic_öc
(&
rba
->
ªq_ªady
);

597 
	`•ö_lock_bh
(&
rba
->
lock
);

599 
	`li°_•li˚_èû
(&
loˇl_em±y
, &
rba
->
rbd_em±y
);

600 
	`•ö_u∆ock_bh
(&
rba
->
lock
);

602 
	`IWL_DEBUG_TPT
(
å™s
, "%s,Éxô.\n", 
__func__
);

603 
	}
}

613 
	$iwl_pcõ_rx_Æloˇt‹_gë
(
iwl_å™s
 *
å™s
,

614 
iwl_rxq
 *
rxq
)

616 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

617 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

618 
i
;

620 
	`lockdï_as£π_hñd
(&
rxq
->
lock
);

630 i‡(
	`©omic_dec_if_posôive
(&
rba
->
ªq_ªady
) < 0)

633 
	`•ö_lock
(&
rba
->
lock
);

634 
i
 = 0; i < 
RX_CLAIM_REQ_ALLOC
; i++) {

636 
iwl_rx_mem_buf„r
 *
rxb
 =

637 
	`li°_fú°_íåy
(&
rba
->
rbd_Æloˇãd
,

638 
iwl_rx_mem_buf„r
, 
li°
);

640 
	`li°_move
(&
rxb
->
li°
, &
rxq
->
rx_‰ì
);

642 
	`•ö_u∆ock
(&
rba
->
lock
);

644 
rxq
->
u£d_cou¡
 -
RX_CLAIM_REQ_ALLOC
;

645 
rxq
->
‰ì_cou¡
 +
RX_CLAIM_REQ_ALLOC
;

646 
	}
}

648 
	$iwl_pcõ_rx_Æloˇt‹_w‹k
(
w‹k_°ru˘
 *
d©a
)

650 
iwl_rb_Æloˇt‹
 *
rba_p
 =

651 
	`c⁄èöî_of
(
d©a
, 
iwl_rb_Æloˇt‹
, 
rx_Æloc
);

652 
iwl_å™s_pcõ
 *
å™s_pcõ
 =

653 
	`c⁄èöî_of
(
rba_p
, 
iwl_å™s_pcõ
, 
rba
);

655 
	`iwl_pcõ_rx_Æloˇt‹
(
å™s_pcõ
->
å™s
);

656 
	}
}

658 
	$iwl_pcõ_‰ì_bd_size
(
iwl_å™s
 *
å™s
)

660 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

661  (
iwl_rx_å™s„r_desc
);

663  
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
 ?

664 (
__À64
Ë: (
__À32
);

665 
	}
}

667 
	$iwl_pcõ_u£d_bd_size
(
iwl_å™s
 *
å™s
)

669 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

670  (
iwl_rx_com∂ëi⁄_desc_bz
);

672 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

673  (
iwl_rx_com∂ëi⁄_desc
);

675  (
__À32
);

676 
	}
}

678 
	$iwl_pcõ_‰ì_rxq_dma
(
iwl_å™s
 *
å™s
,

679 
iwl_rxq
 *
rxq
)

681 
‰ì_size
 = 
	`iwl_pcõ_‰ì_bd_size
(
å™s
);

683 i‡(
rxq
->
bd
)

684 
	`dma_‰ì_cohîít
(
å™s
->
dev
,

685 
‰ì_size
 * 
rxq
->
queue_size
,

686 
rxq
->
bd
,Ñxq->
bd_dma
);

687 
rxq
->
bd_dma
 = 0;

688 
rxq
->
bd
 = 
NULL
;

690 
rxq
->
rb_°ts_dma
 = 0;

691 
rxq
->
rb_°ts
 = 
NULL
;

693 i‡(
rxq
->
u£d_bd
)

694 
	`dma_‰ì_cohîít
(
å™s
->
dev
,

695 
	`iwl_pcõ_u£d_bd_size
(
å™s
) *

696 
rxq
->
queue_size
,

697 
rxq
->
u£d_bd
,Ñxq->
u£d_bd_dma
);

698 
rxq
->
u£d_bd_dma
 = 0;

699 
rxq
->
u£d_bd
 = 
NULL
;

700 
	}
}

702 
size_t
 
	$iwl_pcõ_rb_°ts_size
(
iwl_å™s
 *
å™s
)

704 
boﬁ
 
u£_rx_td
 = (
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

705 
IWL_DEVICE_FAMILY_AX210
);

707 i‡(
u£_rx_td
)

708  (
__À16
);

710  (
iwl_rb_°©us
);

711 
	}
}

713 
	$iwl_pcõ_Æloc_rxq_dma
(
iwl_å™s
 *
å™s
,

714 
iwl_rxq
 *
rxq
)

716 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

717 
size_t
 
rb_°ts_size
 = 
	`iwl_pcõ_rb_°ts_size
(
å™s
);

718 
devi˚
 *
dev
 = 
å™s
->dev;

719 
i
;

720 
‰ì_size
;

722 
	`•ö_lock_öô
(&
rxq
->
lock
);

723 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

724 
rxq
->
queue_size
 = 
å™s
->
cfg
->
num_rbds
;

726 
rxq
->
queue_size
 = 
RX_QUEUE_SIZE
;

728 
‰ì_size
 = 
	`iwl_pcõ_‰ì_bd_size
(
å™s
);

734 
rxq
->
bd
 = 
	`dma_Æloc_cohîít
(
dev
, 
‰ì_size
 *Ñxq->
queue_size
,

735 &
rxq
->
bd_dma
, 
GFP_KERNEL
);

736 i‡(!
rxq
->
bd
)

737 
îr
;

739 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
) {

740 
rxq
->
u£d_bd
 = 
	`dma_Æloc_cohîít
(
dev
,

741 
	`iwl_pcõ_u£d_bd_size
(
å™s
) *

742 
rxq
->
queue_size
,

743 &
rxq
->
u£d_bd_dma
,

744 
GFP_KERNEL
);

745 i‡(!
rxq
->
u£d_bd
)

746 
îr
;

749 
rxq
->
rb_°ts
 = (
u8
 *)
å™s_pcõ
->
ba£_rb_°ts
 +Ñxq->
id
 * 
rb_°ts_size
;

750 
rxq
->
rb_°ts_dma
 =

751 
å™s_pcõ
->
ba£_rb_°ts_dma
 + 
rxq
->
id
 * 
rb_°ts_size
;

755 
îr
:

756 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

757 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

759 
	`iwl_pcõ_‰ì_rxq_dma
(
å™s
, 
rxq
);

762  -
ENOMEM
;

763 
	}
}

765 
	$iwl_pcõ_rx_Æloc
(
iwl_å™s
 *
å™s
)

767 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

768 
size_t
 
rb_°ts_size
 = 
	`iwl_pcõ_rb_°ts_size
(
å™s
);

769 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

770 
i
, 
ªt
;

772 i‡(
	`WARN_ON
(
å™s_pcõ
->
rxq
))

773  -
EINVAL
;

775 
å™s_pcõ
->
rxq
 = 
	`kˇŒoc
(
å™s
->
num_rx_queues
, (
iwl_rxq
),

776 
GFP_KERNEL
);

777 
å™s_pcõ
->
rx_poﬁ
 = 
	`kˇŒoc
(
	`RX_POOL_SIZE
—øns_pcõ->
num_rx_bufs
),

778 (
å™s_pcõ
->
rx_poﬁ
[0]),

779 
GFP_KERNEL
);

780 
å™s_pcõ
->
globÆ_èbÀ
 =

781 
	`kˇŒoc
(
	`RX_POOL_SIZE
(
å™s_pcõ
->
num_rx_bufs
),

782 (
å™s_pcõ
->
globÆ_èbÀ
[0]),

783 
GFP_KERNEL
);

784 i‡(!
å™s_pcõ
->
rxq
 || !å™s_pcõ->
rx_poﬁ
 ||

785 !
å™s_pcõ
->
globÆ_èbÀ
) {

786 
ªt
 = -
ENOMEM
;

787 
îr
;

790 
	`•ö_lock_öô
(&
rba
->
lock
);

796 
å™s_pcõ
->
ba£_rb_°ts
 =

797 
	`dma_Æloc_cohîít
(
å™s
->
dev
,

798 
rb_°ts_size
 * 
å™s
->
num_rx_queues
,

799 &
å™s_pcõ
->
ba£_rb_°ts_dma
,

800 
GFP_KERNEL
);

801 i‡(!
å™s_pcõ
->
ba£_rb_°ts
) {

802 
ªt
 = -
ENOMEM
;

803 
îr
;

806 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

807 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

809 
rxq
->
id
 = 
i
;

810 
ªt
 = 
	`iwl_pcõ_Æloc_rxq_dma
(
å™s
, 
rxq
);

811 i‡(
ªt
)

812 
îr
;

816 
îr
:

817 i‡(
å™s_pcõ
->
ba£_rb_°ts
) {

818 
	`dma_‰ì_cohîít
(
å™s
->
dev
,

819 
rb_°ts_size
 * 
å™s
->
num_rx_queues
,

820 
å™s_pcõ
->
ba£_rb_°ts
,

821 
å™s_pcõ
->
ba£_rb_°ts_dma
);

822 
å™s_pcõ
->
ba£_rb_°ts
 = 
NULL
;

823 
å™s_pcõ
->
ba£_rb_°ts_dma
 = 0;

825 
	`k‰ì
(
å™s_pcõ
->
rx_poﬁ
);

826 
å™s_pcõ
->
rx_poﬁ
 = 
NULL
;

827 
	`k‰ì
(
å™s_pcõ
->
globÆ_èbÀ
);

828 
å™s_pcõ
->
globÆ_èbÀ
 = 
NULL
;

829 
	`k‰ì
(
å™s_pcõ
->
rxq
);

830 
å™s_pcõ
->
rxq
 = 
NULL
;

832  
ªt
;

833 
	}
}

835 
	$iwl_pcõ_rx_hw_öô
(
iwl_å™s
 *
å™s
, 
iwl_rxq
 *
rxq
)

837 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

838 
u32
 
rb_size
;

839 c⁄° 
u32
 
rfd∆og
 = 
RX_QUEUE_SIZE_LOG
;

841 
å™s_pcõ
->
rx_buf_size
) {

842 
IWL_AMSDU_4K
:

843 
rb_size
 = 
FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_4K
;

845 
IWL_AMSDU_8K
:

846 
rb_size
 = 
FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_8K
;

848 
IWL_AMSDU_12K
:

849 
rb_size
 = 
FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_12K
;

852 
	`WARN_ON
(1);

853 
rb_size
 = 
FH_RCSR_RX_CONFIG_REG_VAL_RB_SIZE_4K
;

856 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

860 
	`iwl_wrôe32
(
å™s
, 
FH_MEM_RCSR_CHNL0_CONFIG_REG
, 0);

862 
	`iwl_wrôe32
(
å™s
, 
FH_MEM_RCSR_CHNL0_RBDCB_WPTR
, 0);

863 
	`iwl_wrôe32
(
å™s
, 
FH_MEM_RCSR_CHNL0_FLUSH_RB_REQ
, 0);

864 
	`iwl_wrôe32
(
å™s
, 
FH_RSCSR_CHNL0_RDPTR
, 0);

867 
	`iwl_wrôe32
(
å™s
, 
FH_RSCSR_CHNL0_RBDCB_WPTR_REG
, 0);

870 
	`iwl_wrôe32
(
å™s
, 
FH_RSCSR_CHNL0_RBDCB_BASE_REG
,

871 (
u32
)(
rxq
->
bd_dma
 >> 8));

874 
	`iwl_wrôe32
(
å™s
, 
FH_RSCSR_CHNL0_STTS_WPTR_REG
,

875 
rxq
->
rb_°ts_dma
 >> 4);

885 
	`iwl_wrôe32
(
å™s
, 
FH_MEM_RCSR_CHNL0_CONFIG_REG
,

886 
FH_RCSR_RX_CONFIG_CHNL_EN_ENABLE_VAL
 |

887 
FH_RCSR_CHNL0_RX_IGNORE_RXF_EMPTY
 |

888 
FH_RCSR_CHNL0_RX_CONFIG_IRQ_DEST_INT_HOST_VAL
 |

889 
rb_size
 |

890 (
RX_RB_TIMEOUT
 << 
FH_RCSR_RX_CONFIG_REG_IRQ_RBTH_POS
) |

891 (
rfd∆og
 << 
FH_RCSR_RX_CONFIG_RBDCB_SIZE_POS
));

893 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

896 
	`iwl_wrôe8
(
å™s
, 
CSR_INT_COALESCING
, 
IWL_HOST_INT_TIMEOUT_DEF
);

899 i‡(
å™s
->
cfg
->
ho°_öãºu±_›î©i⁄_mode
)

900 
	`iwl_£t_bô
(
å™s
, 
CSR_INT_COALESCING
, 
IWL_HOST_INT_OPER_MODE
);

901 
	}
}

903 
	$iwl_pcõ_rx_mq_hw_öô
(
iwl_å™s
 *
å™s
)

905 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

906 
u32
 
rb_size
, 
íabÀd
 = 0;

907 
i
;

909 
å™s_pcõ
->
rx_buf_size
) {

910 
IWL_AMSDU_2K
:

911 
rb_size
 = 
RFH_RXF_DMA_RB_SIZE_2K
;

913 
IWL_AMSDU_4K
:

914 
rb_size
 = 
RFH_RXF_DMA_RB_SIZE_4K
;

916 
IWL_AMSDU_8K
:

917 
rb_size
 = 
RFH_RXF_DMA_RB_SIZE_8K
;

919 
IWL_AMSDU_12K
:

920 
rb_size
 = 
RFH_RXF_DMA_RB_SIZE_12K
;

923 
	`WARN_ON
(1);

924 
rb_size
 = 
RFH_RXF_DMA_RB_SIZE_4K
;

927 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

931 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
RFH_RXF_DMA_CFG
, 0);

933 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
RFH_RXF_RXQ_ACTIVE
, 0);

935 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

937 
	`iwl_wrôe_¥ph64_no_gøb
(
å™s
,

938 
	`RFH_Q_FRBDCB_BA_LSB
(
i
),

939 
å™s_pcõ
->
rxq
[
i
].
bd_dma
);

941 
	`iwl_wrôe_¥ph64_no_gøb
(
å™s
,

942 
	`RFH_Q_URBDCB_BA_LSB
(
i
),

943 
å™s_pcõ
->
rxq
[
i
].
u£d_bd_dma
);

945 
	`iwl_wrôe_¥ph64_no_gøb
(
å™s
,

946 
	`RFH_Q_URBD_STTS_WPTR_LSB
(
i
),

947 
å™s_pcõ
->
rxq
[
i
].
rb_°ts_dma
);

949 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
	`RFH_Q_FRBDCB_WIDX
(
i
), 0);

950 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
	`RFH_Q_FRBDCB_RIDX
(
i
), 0);

951 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
	`RFH_Q_URBDCB_WIDX
(
i
), 0);

953 
íabÀd
 |
	`BIT
(
i
) | BIT(i + 16);

963 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
RFH_RXF_DMA_CFG
,

964 
RFH_DMA_EN_ENABLE_VAL
 | 
rb_size
 |

965 
RFH_RXF_DMA_MIN_RB_4_8
 |

966 
RFH_RXF_DMA_DROP_TOO_LARGE_MASK
 |

967 
RFH_RXF_DMA_RBDCB_SIZE_512
);

974 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
RFH_GEN_CFG
,

975 
RFH_GEN_CFG_RFH_DMA_SNOOP
 |

976 
	`RFH_GEN_CFG_VAL
(
DEFAULT_RXQ_NUM
, 0) |

977 
RFH_GEN_CFG_SERVICE_DMA_SNOOP
 |

978 
	`RFH_GEN_CFG_VAL
(
RB_CHUNK_SIZE
,

979 
å™s
->
å™s_cfg
->
öãgøãd
 ?

980 
RFH_GEN_CFG_RB_CHUNK_SIZE_64
 :

981 
RFH_GEN_CFG_RB_CHUNK_SIZE_128
));

983 
	`iwl_wrôe_¥ph_no_gøb
(
å™s
, 
RFH_RXF_RXQ_ACTIVE
, 
íabÀd
);

985 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

988 
	`iwl_wrôe8
(
å™s
, 
CSR_INT_COALESCING
, 
IWL_HOST_INT_TIMEOUT_DEF
);

989 
	}
}

991 
	$iwl_pcõ_rx_öô_rxb_li°s
(
iwl_rxq
 *
rxq
)

993 
	`lockdï_as£π_hñd
(&
rxq
->
lock
);

995 
	`INIT_LIST_HEAD
(&
rxq
->
rx_‰ì
);

996 
	`INIT_LIST_HEAD
(&
rxq
->
rx_u£d
);

997 
rxq
->
‰ì_cou¡
 = 0;

998 
rxq
->
u£d_cou¡
 = 0;

999 
	}
}

1001 
iwl_pcõ_rx_h™dÀ
(
iwl_å™s
 *
å™s
, 
queue
, 
budgë
);

1003 
	$iwl_pcõ_«pi_pﬁl
(
«pi_°ru˘
 *
«pi
, 
budgë
)

1005 
iwl_rxq
 *
rxq
 = 
	`c⁄èöî_of
(
«pi
, iwl_rxq,Çapi);

1006 
iwl_å™s_pcõ
 *
å™s_pcõ
;

1007 
iwl_å™s
 *
å™s
;

1008 
ªt
;

1010 
å™s_pcõ
 = 
	`c⁄èöî_of
(
«pi
->
dev
, 
iwl_å™s_pcõ
, 
«pi_dev
);

1011 
å™s
 = 
å™s_pcõ
->trans;

1013 
ªt
 = 
	`iwl_pcõ_rx_h™dÀ
(
å™s
, 
rxq
->
id
, 
budgë
);

1015 
	`IWL_DEBUG_ISR
(
å™s
, "[%d] handled %d, budget %d\n",

1016 
rxq
->
id
, 
ªt
, 
budgë
);

1018 i‡(
ªt
 < 
budgë
) {

1019 
	`•ö_lock
(&
å™s_pcõ
->
úq_lock
);

1020 i‡(
	`ã°_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
))

1021 
	`_iwl_íabÀ_öãºu±s
(
å™s
);

1022 
	`•ö_u∆ock
(&
å™s_pcõ
->
úq_lock
);

1024 
	`«pi_com∂ëe_d⁄e
(&
rxq
->
«pi
, 
ªt
);

1027  
ªt
;

1028 
	}
}

1030 
	$iwl_pcõ_«pi_pﬁl_msix
(
«pi_°ru˘
 *
«pi
, 
budgë
)

1032 
iwl_rxq
 *
rxq
 = 
	`c⁄èöî_of
(
«pi
, iwl_rxq,Çapi);

1033 
iwl_å™s_pcõ
 *
å™s_pcõ
;

1034 
iwl_å™s
 *
å™s
;

1035 
ªt
;

1037 
å™s_pcõ
 = 
	`c⁄èöî_of
(
«pi
->
dev
, 
iwl_å™s_pcõ
, 
«pi_dev
);

1038 
å™s
 = 
å™s_pcõ
->trans;

1040 
ªt
 = 
	`iwl_pcõ_rx_h™dÀ
(
å™s
, 
rxq
->
id
, 
budgë
);

1041 
	`IWL_DEBUG_ISR
(
å™s
, "[%d] h™dÀd %d, budgë %d\n", 
rxq
->
id
, 
ªt
,

1042 
budgë
);

1044 i‡(
ªt
 < 
budgë
) {

1045 
úq_löe
 = 
rxq
->
id
;

1048 i‡(
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_FIRST_RSS
 &&

1049 
rxq
->
id
 == 1)

1050 
úq_löe
 = 0;

1052 
	`•ö_lock
(&
å™s_pcõ
->
úq_lock
);

1053 
	`iwl_pcõ_˛ór_úq
(
å™s
, 
úq_löe
);

1054 
	`•ö_u∆ock
(&
å™s_pcõ
->
úq_lock
);

1056 
	`«pi_com∂ëe_d⁄e
(&
rxq
->
«pi
, 
ªt
);

1059  
ªt
;

1060 
	}
}

1062 
	$iwl_pcõ_rx_«pi_sync
(
iwl_å™s
 *
å™s
)

1064 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1065 
i
;

1067 i‡(
	`u∆ikñy
(!
å™s_pcõ
->
rxq
))

1070 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

1071 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

1073 i‡(
rxq
 &&Ñxq->
«pi
.
pﬁl
)

1074 
	`«pi_synchr⁄ize
(&
rxq
->
«pi
);

1076 
	}
}

1078 
	$_iwl_pcõ_rx_öô
(
iwl_å™s
 *
å™s
)

1080 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1081 
iwl_rxq
 *
def_rxq
;

1082 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

1083 
i
, 
îr
, 
queue_size
, 
Æloˇt‹_poﬁ_size
, 
num_Æloc
;

1085 i‡(!
å™s_pcõ
->
rxq
) {

1086 
îr
 = 
	`iwl_pcõ_rx_Æloc
(
å™s
);

1087 i‡(
îr
)

1088  
îr
;

1090 
def_rxq
 = 
å™s_pcõ
->
rxq
;

1092 
	`ˇn˚l_w‹k_sync
(&
rba
->
rx_Æloc
);

1094 
	`•ö_lock_bh
(&
rba
->
lock
);

1095 
	`©omic_£t
(&
rba
->
ªq_≥ndög
, 0);

1096 
	`©omic_£t
(&
rba
->
ªq_ªady
, 0);

1097 
	`INIT_LIST_HEAD
(&
rba
->
rbd_Æloˇãd
);

1098 
	`INIT_LIST_HEAD
(&
rba
->
rbd_em±y
);

1099 
	`•ö_u∆ock_bh
(&
rba
->
lock
);

1102 
	`iwl_pcõ_‰ì_rbs_poﬁ
(
å™s
);

1104 
i
 = 0; i < 
RX_QUEUE_SIZE
; i++)

1105 
def_rxq
->
queue
[
i
] = 
NULL
;

1107 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

1108 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

1110 
	`•ö_lock_bh
(&
rxq
->
lock
);

1116 
rxq
->
ªad
 = 0;

1117 
rxq
->
wrôe
 = 0;

1118 
rxq
->
wrôe_a˘uÆ
 = 0;

1119 
	`mem£t
(
rxq
->
rb_°ts
, 0,

1120 (
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

1121 
IWL_DEVICE_FAMILY_AX210
) ?

1122 (
__À16
Ë: (
iwl_rb_°©us
));

1124 
	`iwl_pcõ_rx_öô_rxb_li°s
(
rxq
);

1126 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

1128 i‡(!
rxq
->
«pi
.
pﬁl
) {

1129 (*
pﬁl
)(
«pi_°ru˘
 *, Ë
iwl_pcõ_«pi_pﬁl
;

1131 i‡(
å™s_pcõ
->
msix_íabÀd
)

1132 
pﬁl
 = 
iwl_pcõ_«pi_pﬁl_msix
;

1134 
	`√tif_«pi_add
(&
å™s_pcõ
->
«pi_dev
, &
rxq
->
«pi
,

1135 
pﬁl
);

1136 
	`«pi_íabÀ
(&
rxq
->
«pi
);

1142 
queue_size
 = 
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
 ?

1143 
å™s_pcõ
->
num_rx_bufs
 - 1 : 
RX_QUEUE_SIZE
;

1144 
Æloˇt‹_poﬁ_size
 = 
å™s
->
num_rx_queues
 *

1145 (
RX_CLAIM_REQ_ALLOC
 - 
RX_POST_REQ_ALLOC
);

1146 
num_Æloc
 = 
queue_size
 + 
Æloˇt‹_poﬁ_size
;

1148 
i
 = 0; i < 
num_Æloc
; i++) {

1149 
iwl_rx_mem_buf„r
 *
rxb
 = &
å™s_pcõ
->
rx_poﬁ
[
i
];

1151 i‡(
i
 < 
Æloˇt‹_poﬁ_size
)

1152 
	`li°_add
(&
rxb
->
li°
, &
rba
->
rbd_em±y
);

1154 
	`li°_add
(&
rxb
->
li°
, &
def_rxq
->
rx_u£d
);

1155 
å™s_pcõ
->
globÆ_èbÀ
[
i
] = 
rxb
;

1156 
rxb
->
vid
 = (
u16
)(
i
 + 1);

1157 
rxb
->
övÆid
 = 
åue
;

1160 
	`iwl_pcõ_rxq_Æloc_rbs
(
å™s
, 
GFP_KERNEL
, 
def_rxq
);

1163 
	}
}

1165 
	$iwl_pcõ_rx_öô
(
iwl_å™s
 *
å™s
)

1167 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1168 
ªt
 = 
	`_iwl_pcõ_rx_öô
(
å™s
);

1170 i‡(
ªt
)

1171  
ªt
;

1173 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
)

1174 
	`iwl_pcõ_rx_mq_hw_öô
(
å™s
);

1176 
	`iwl_pcõ_rx_hw_öô
(
å™s
, 
å™s_pcõ
->
rxq
);

1178 
	`iwl_pcõ_rxq_ª°ock
(
å™s
, 
å™s_pcõ
->
rxq
);

1180 
	`•ö_lock_bh
(&
å™s_pcõ
->
rxq
->
lock
);

1181 
	`iwl_pcõ_rxq_öc_wr_±r
(
å™s
, 
å™s_pcõ
->
rxq
);

1182 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
rxq
->
lock
);

1185 
	}
}

1187 
	$iwl_pcõ_gí2_rx_öô
(
iwl_å™s
 *
å™s
)

1190 
	`iwl_wrôe8
(
å™s
, 
CSR_INT_COALESCING
, 
IWL_HOST_INT_TIMEOUT_DEF
);

1196  
	`_iwl_pcõ_rx_öô
(
å™s
);

1197 
	}
}

1199 
	$iwl_pcõ_rx_‰ì
(
iwl_å™s
 *
å™s
)

1201 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1202 
size_t
 
rb_°ts_size
 = 
	`iwl_pcõ_rb_°ts_size
(
å™s
);

1203 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

1204 
i
;

1210 i‡(!
å™s_pcõ
->
rxq
) {

1211 
	`IWL_DEBUG_INFO
(
å™s
, "Free NULLÑx context\n");

1215 
	`ˇn˚l_w‹k_sync
(&
rba
->
rx_Æloc
);

1217 
	`iwl_pcõ_‰ì_rbs_poﬁ
(
å™s
);

1219 i‡(
å™s_pcõ
->
ba£_rb_°ts
) {

1220 
	`dma_‰ì_cohîít
(
å™s
->
dev
,

1221 
rb_°ts_size
 * 
å™s
->
num_rx_queues
,

1222 
å™s_pcõ
->
ba£_rb_°ts
,

1223 
å™s_pcõ
->
ba£_rb_°ts_dma
);

1224 
å™s_pcõ
->
ba£_rb_°ts
 = 
NULL
;

1225 
å™s_pcõ
->
ba£_rb_°ts_dma
 = 0;

1228 
i
 = 0; i < 
å™s
->
num_rx_queues
; i++) {

1229 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

1231 
	`iwl_pcõ_‰ì_rxq_dma
(
å™s
, 
rxq
);

1233 i‡(
rxq
->
«pi
.
pﬁl
) {

1234 
	`«pi_dißbÀ
(&
rxq
->
«pi
);

1235 
	`√tif_«pi_dñ
(&
rxq
->
«pi
);

1238 
	`k‰ì
(
å™s_pcõ
->
rx_poﬁ
);

1239 
	`k‰ì
(
å™s_pcõ
->
globÆ_èbÀ
);

1240 
	`k‰ì
(
å™s_pcõ
->
rxq
);

1242 i‡(
å™s_pcõ
->
Æloc_∑ge
)

1243 
	`__‰ì_∑ges
(
å™s_pcõ
->
Æloc_∑ge
,Åøns_pcõ->
rx_∑ge_‹dî
);

1244 
	}
}

1246 
	$iwl_pcõ_rx_move_to_Æloˇt‹
(
iwl_rxq
 *
rxq
,

1247 
iwl_rb_Æloˇt‹
 *
rba
)

1249 
	`•ö_lock
(&
rba
->
lock
);

1250 
	`li°_•li˚_èû_öô
(&
rxq
->
rx_u£d
, &
rba
->
rbd_em±y
);

1251 
	`•ö_u∆ock
(&
rba
->
lock
);

1252 
	}
}

1260 
	$iwl_pcõ_rx_ªu£_rbd
(
iwl_å™s
 *
å™s
,

1261 
iwl_rx_mem_buf„r
 *
rxb
,

1262 
iwl_rxq
 *
rxq
, 
boﬁ
 
emîgícy
)

1264 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1265 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

1269 
	`li°_add_èû
(&
rxb
->
li°
, &
rxq
->
rx_u£d
);

1271 i‡(
	`u∆ikñy
(
emîgícy
))

1275 
rxq
->
u£d_cou¡
++;

1282 i‡((
rxq
->
u£d_cou¡
 % 
RX_CLAIM_REQ_ALLOC
Ë=
RX_POST_REQ_ALLOC
) {

1285 
	`iwl_pcõ_rx_move_to_Æloˇt‹
(
rxq
, 
rba
);

1287 
	`©omic_öc
(&
rba
->
ªq_≥ndög
);

1288 
	`queue_w‹k
(
rba
->
Æloc_wq
, &rba->
rx_Æloc
);

1290 
	}
}

1292 
	$iwl_pcõ_rx_h™dÀ_rb
(
iwl_å™s
 *
å™s
,

1293 
iwl_rxq
 *
rxq
,

1294 
iwl_rx_mem_buf„r
 *
rxb
,

1295 
boﬁ
 
emîgícy
,

1296 
i
)

1298 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1299 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[å™s->txqs.
cmd
.
q_id
];

1300 
boﬁ
 
∑ge_°ﬁí
 = 
Ál£
;

1301 
max_Àn
 = 
å™s_pcõ
->
rx_buf_byãs
;

1302 
u32
 
off£t
 = 0;

1304 i‡(
	`WARN_ON
(!
rxb
))

1307 
	`dma_unm≠_∑ge
(
å™s
->
dev
, 
rxb
->
∑ge_dma
, 
max_Àn
, 
DMA_FROM_DEVICE
);

1309 
off£t
 + (
u32
Ë+ (
iwl_cmd_hódî
Ë< 
max_Àn
) {

1310 
iwl_rx_∑ckë
 *
pkt
;

1311 
boﬁ
 
ª˛aim
;

1312 
Àn
;

1313 
iwl_rx_cmd_buf„r
 
rxcb
 = {

1314 .
_off£t
 = 
rxb
->
off£t
 + offset,

1315 .
_rx_∑ge_‹dî
 = 
å™s_pcõ
->
rx_∑ge_‹dî
,

1316 .
_∑ge
 = 
rxb
->
∑ge
,

1317 .
_∑ge_°ﬁí
 = 
Ál£
,

1318 .
åuesize
 = 
max_Àn
,

1321 
pkt
 = 
	`rxb_addr
(&
rxcb
);

1323 i‡(
pkt
->
Àn_n_Êags
 =
	`˝u_to_À32
(
FH_RSCSR_FRAME_INVALID
)) {

1324 
	`IWL_DEBUG_RX
(
å™s
,

1326 
rxq
->
id
, 
off£t
);

1330 
	`WARN
((
	`À32_to_˝u
(
pkt
->
Àn_n_Êags
Ë& 
FH_RSCSR_RXQ_MASK
) >>

1331 
FH_RSCSR_RXQ_POS
 !
rxq
->
id
,

1333 
rxq
->
id
,

1334 (
	`À32_to_˝u
(
pkt
->
Àn_n_Êags
Ë& 
FH_RSCSR_RXQ_MASK
) >>

1335 
FH_RSCSR_RXQ_POS
);

1337 
	`IWL_DEBUG_RX
(
å™s
,

1339 
rxq
->
id
, 
off£t
,

1340 
	`iwl_gë_cmd_°rög
(
å™s
,

1341 
	`WIDE_ID
(
pkt
->
hdr
.
group_id
,Ökt->hdr.
cmd
)),

1342 
pkt
->
hdr
.
group_id
,Ökt->hdr.
cmd
,

1343 
	`À16_to_˝u
(
pkt
->
hdr
.
£quí˚
));

1345 
Àn
 = 
	`iwl_rx_∑ckë_Àn
(
pkt
);

1346 
Àn
 +(
u32
);

1348 
off£t
 +
	`ALIGN
(
Àn
, 
FH_RSCSR_FRAME_ALIGN
);

1351 i‡(
Àn
 < (*
pkt
Ë|| 
off£t
 > 
max_Àn
)

1354 
	`maybe_åa˚_iwlwifi_dev_rx
(
å™s
, 
pkt
, 
Àn
);

1362 
ª˛aim
 = !(
pkt
->
hdr
.
£quí˚
 & 
SEQ_RX_FRAME
);

1363 i‡(
ª˛aim
 && !
pkt
->
hdr
.
group_id
) {

1364 
i
;

1366 
i
 = 0; i < 
å™s_pcõ
->
n_no_ª˛aim_cmds
; i++) {

1367 i‡(
å™s_pcõ
->
no_ª˛aim_cmds
[
i
] ==

1368 
pkt
->
hdr
.
cmd
) {

1369 
ª˛aim
 = 
Ál£
;

1375 i‡(
rxq
->
id
 =
IWL_DEFAULT_RX_QUEUE
)

1376 
	`iwl_›_mode_rx
(
å™s
->
›_mode
, &
rxq
->
«pi
,

1377 &
rxcb
);

1379 
	`iwl_›_mode_rx_rss
(
å™s
->
›_mode
, &
rxq
->
«pi
,

1380 &
rxcb
, 
rxq
->
id
);

1387 i‡(
ª˛aim
 && 
txq
) {

1388 
u16
 
£quí˚
 = 
	`À16_to_˝u
(
pkt
->
hdr
.sequence);

1389 
ödex
 = 
	`SEQ_TO_INDEX
(
£quí˚
);

1390 
cmd_ödex
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
, 
ödex
);

1392 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
cmd_ödex
].
‰ì_buf
);

1393 
txq
->
íåõs
[
cmd_ödex
].
‰ì_buf
 = 
NULL
;

1399 i‡(!
rxcb
.
_∑ge_°ﬁí
)

1400 
	`iwl_pcõ_hcmd_com∂ëe
(
å™s
, &
rxcb
);

1402 
	`IWL_WARN
(
å™s
, "ClaimÇullÑxb?\n");

1405 
∑ge_°ﬁí
 |
rxcb
.
_∑ge_°ﬁí
;

1406 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

1411 i‡(
∑ge_°ﬁí
) {

1412 
	`__‰ì_∑ges
(
rxb
->
∑ge
, 
å™s_pcõ
->
rx_∑ge_‹dî
);

1413 
rxb
->
∑ge
 = 
NULL
;

1419 i‡(
rxb
->
∑ge
 !
NULL
) {

1420 
rxb
->
∑ge_dma
 =

1421 
	`dma_m≠_∑ge
(
å™s
->
dev
, 
rxb
->
∑ge
,Ñxb->
off£t
,

1422 
å™s_pcõ
->
rx_buf_byãs
,

1423 
DMA_FROM_DEVICE
);

1424 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
rxb
->
∑ge_dma
)) {

1430 
	`__‰ì_∑ges
(
rxb
->
∑ge
, 
å™s_pcõ
->
rx_∑ge_‹dî
);

1431 
rxb
->
∑ge
 = 
NULL
;

1432 
	`iwl_pcõ_rx_ªu£_rbd
(
å™s
, 
rxb
, 
rxq
, 
emîgícy
);

1434 
	`li°_add_èû
(&
rxb
->
li°
, &
rxq
->
rx_‰ì
);

1435 
rxq
->
‰ì_cou¡
++;

1438 
	`iwl_pcõ_rx_ªu£_rbd
(
å™s
, 
rxb
, 
rxq
, 
emîgícy
);

1439 
	}
}

1441 
iwl_rx_mem_buf„r
 *
	$iwl_pcõ_gë_rxb
(
iwl_å™s
 *
å™s
,

1442 
iwl_rxq
 *
rxq
, 
i
,

1443 
boﬁ
 *
joö
)

1445 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1446 
iwl_rx_mem_buf„r
 *
rxb
;

1447 
u16
 
vid
;

1449 
	`BUILD_BUG_ON
((
iwl_rx_com∂ëi⁄_desc
) != 32);

1450 
	`BUILD_BUG_ON
((
iwl_rx_com∂ëi⁄_desc_bz
) != 4);

1452 i‡(!
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
) {

1453 
rxb
 = 
rxq
->
queue
[
i
];

1454 
rxq
->
queue
[
i
] = 
NULL
;

1455  
rxb
;

1458 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

1459 
iwl_rx_com∂ëi⁄_desc_bz
 *
cd
 = 
rxq
->
u£d_bd
;

1461 
vid
 = 
	`À16_to_˝u
(
cd
[
i
].
rbid
);

1462 *
joö
 = 
cd
[
i
].
Êags
 & 
IWL_RX_CD_FLAGS_FRAGMENTED
;

1463 } i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

1464 
iwl_rx_com∂ëi⁄_desc
 *
cd
 = 
rxq
->
u£d_bd
;

1466 
vid
 = 
	`À16_to_˝u
(
cd
[
i
].
rbid
);

1467 *
joö
 = 
cd
[
i
].
Êags
 & 
IWL_RX_CD_FLAGS_FRAGMENTED
;

1469 
__À32
 *
cd
 = 
rxq
->
u£d_bd
;

1471 
vid
 = 
	`À32_to_˝u
(
cd
[
i
]) & 0x0FFF;

1474 i‡(!
vid
 || vid > 
	`RX_POOL_SIZE
(
å™s_pcõ
->
num_rx_bufs
))

1475 
out_îr
;

1477 
rxb
 = 
å™s_pcõ
->
globÆ_èbÀ
[
vid
 - 1];

1478 i‡(
rxb
->
övÆid
)

1479 
out_îr
;

1481 
	`IWL_DEBUG_RX
(
å™s
, "GŸ vútuÆ RB ID %u\n", (
u32
)
rxb
->
vid
);

1483 
rxb
->
övÆid
 = 
åue
;

1485  
rxb
;

1487 
out_îr
:

1488 
	`WARN
(1, "InvÆidÑxb from HW %u\n", (
u32
)
vid
);

1489 
	`iwl_f‹˚_nmi
(
å™s
);

1490  
NULL
;

1491 
	}
}

1496 
	$iwl_pcõ_rx_h™dÀ
(
iwl_å™s
 *
å™s
, 
queue
, 
budgë
)

1498 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1499 
iwl_rxq
 *
rxq
;

1500 
u32
 
r
, 
i
, 
cou¡
 = 0, 
h™dÀd
 = 0;

1501 
boﬁ
 
emîgícy
 = 
Ál£
;

1503 i‡(
	`WARN_ON_ONCE
(!
å™s_pcõ
->
rxq
 || !å™s_pcõ->rxq[
queue
].
bd
))

1504  
budgë
;

1506 
rxq
 = &
å™s_pcõ
->rxq[
queue
];

1508 
ª°¨t
:

1509 
	`•ö_lock
(&
rxq
->
lock
);

1512 
r
 = 
	`iwl_gë_˛o£d_rb_°ts
(
å™s
, 
rxq
);

1513 
i
 = 
rxq
->
ªad
;

1516 
r
 &(
rxq
->
queue_size
 - 1);

1519 i‡(
i
 =
r
)

1520 
	`IWL_DEBUG_RX
(
å™s
, "Q %d: HW = SW = %d\n", 
rxq
->
id
, 
r
);

1522 
i
 !
r
 && ++
h™dÀd
 < 
budgë
) {

1523 
iwl_rb_Æloˇt‹
 *
rba
 = &
å™s_pcõ
->rba;

1524 
iwl_rx_mem_buf„r
 *
rxb
;

1526 
u32
 
rb_≥ndög_Æloc
 =

1527 
	`©omic_ªad
(&
å™s_pcõ
->
rba
.
ªq_≥ndög
) *

1528 
RX_CLAIM_REQ_ALLOC
;

1529 
boﬁ
 
joö
 = 
Ál£
;

1531 i‡(
	`u∆ikñy
(
rb_≥ndög_Æloc
 >
rxq
->
queue_size
 / 2 &&

1532 !
emîgícy
)) {

1533 
	`iwl_pcõ_rx_move_to_Æloˇt‹
(
rxq
, 
rba
);

1534 
emîgícy
 = 
åue
;

1535 
	`IWL_DEBUG_TPT
(
å™s
,

1537 
rb_≥ndög_Æloc
);

1540 
	`IWL_DEBUG_RX
(
å™s
, "Q %d: HW = %d, SW = %d\n", 
rxq
->
id
, 
r
, 
i
);

1542 
rxb
 = 
	`iwl_pcõ_gë_rxb
(
å™s
, 
rxq
, 
i
, &
joö
);

1543 i‡(!
rxb
)

1544 
out
;

1546 i‡(
	`u∆ikñy
(
joö
 || 
rxq
->
√xt_rb_is_‰agmít
)) {

1547 
rxq
->
√xt_rb_is_‰agmít
 = 
joö
;

1560 
	`li°_add_èû
(&
rxb
->
li°
, &
rxq
->
rx_‰ì
);

1561 
rxq
->
‰ì_cou¡
++;

1563 
	`iwl_pcõ_rx_h™dÀ_rb
(
å™s
, 
rxq
, 
rxb
, 
emîgícy
, 
i
);

1566 
i
 = (ò+ 1Ë& (
rxq
->
queue_size
 - 1);

1575 i‡(
rxq
->
u£d_cou¡
 >
RX_CLAIM_REQ_ALLOC
)

1576 
	`iwl_pcõ_rx_Æloˇt‹_gë
(
å™s
, 
rxq
);

1578 i‡(
rxq
->
u£d_cou¡
 % 
RX_CLAIM_REQ_ALLOC
 =0 && !
emîgícy
) {

1580 
	`iwl_pcõ_rx_move_to_Æloˇt‹
(
rxq
, 
rba
);

1581 } i‡(
emîgícy
) {

1582 
cou¡
++;

1583 i‡(
cou¡
 == 8) {

1584 
cou¡
 = 0;

1585 i‡(
rb_≥ndög_Æloc
 < 
rxq
->
queue_size
 / 3) {

1586 
	`IWL_DEBUG_TPT
(
å™s
,

1588 
rb_≥ndög_Æloc
);

1589 
emîgícy
 = 
Ál£
;

1592 
rxq
->
ªad
 = 
i
;

1593 
	`•ö_u∆ock
(&
rxq
->
lock
);

1594 
	`iwl_pcõ_rxq_Æloc_rbs
(
å™s
, 
GFP_ATOMIC
, 
rxq
);

1595 
	`iwl_pcõ_rxq_ª°ock
(
å™s
, 
rxq
);

1596 
ª°¨t
;

1600 
out
:

1602 
rxq
->
ªad
 = 
i
;

1603 
	`•ö_u∆ock
(&
rxq
->
lock
);

1617 i‡(
	`u∆ikñy
(
emîgícy
 && 
cou¡
))

1618 
	`iwl_pcõ_rxq_Æloc_rbs
(
å™s
, 
GFP_ATOMIC
, 
rxq
);

1620 
	`iwl_pcõ_rxq_ª°ock
(
å™s
, 
rxq
);

1622  
h™dÀd
;

1623 
	}
}

1625 
iwl_å™s_pcõ
 *
	$iwl_pcõ_gë_å™s_pcõ
(
msix_íåy
 *
íåy
)

1627 
u8
 
queue
 = 
íåy
->entry;

1628 
msix_íåy
 *
íåõs
 = 
íåy
 - 
queue
;

1630  
	`c⁄èöî_of
(
íåõs
, 
iwl_å™s_pcõ
, 
msix_íåõs
[0]);

1631 
	}
}

1637 
úqªtu∫_t
 
	$iwl_pcõ_úq_rx_msix_h™dÀr
(
úq
, *
dev_id
)

1639 
msix_íåy
 *
íåy
 = 
dev_id
;

1640 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`iwl_pcõ_gë_å™s_pcõ
(
íåy
);

1641 
iwl_å™s
 *
å™s
 = 
å™s_pcõ
->trans;

1642 
iwl_rxq
 *
rxq
;

1644 
	`åa˚_iwlwifi_dev_úq_msix
(
å™s
->
dev
, 
íåy
, 
Ál£
, 0, 0);

1646 i‡(
	`WARN_ON
(
íåy
->íåy >
å™s
->
num_rx_queues
))

1647  
IRQ_NONE
;

1649 i‡(!
å™s_pcõ
->
rxq
) {

1650 i‡(
	`√t_øãlimô
())

1651 
	`IWL_ERR
(
å™s
,

1653 
íåy
->entry);

1654  
IRQ_NONE
;

1657 
rxq
 = &
å™s_pcõ
->rxq[
íåy
->entry];

1658 
	`lock_m≠_acquúe
(&
å™s
->
sync_cmd_lockdï_m≠
);

1659 
	`IWL_DEBUG_ISR
(
å™s
, "[%d] GŸ i¡îru±\n", 
íåy
->entry);

1661 
	`loˇl_bh_dißbÀ
();

1662 i‡(!
	`«pi_scheduÀ
(&
rxq
->
«pi
))

1663 
	`iwl_pcõ_˛ór_úq
(
å™s
, 
íåy
->entry);

1664 
	`loˇl_bh_íabÀ
();

1666 
	`lock_m≠_ªÀa£
(&
å™s
->
sync_cmd_lockdï_m≠
);

1668  
IRQ_HANDLED
;

1669 
	}
}

1674 
	$iwl_pcõ_úq_h™dÀ_îr‹
(
iwl_å™s
 *
å™s
)

1676 
i
;

1679 i‡(
å™s
->
cfg
->
öã∫Æ_wimax_c€x
 &&

1680 !
å™s
->
cfg
->
≠mg_nŸ_suµ‹ãd
 &&

1681 (!(
	`iwl_ªad_¥ph
(
å™s
, 
APMG_CLK_CTRL_REG
) &

1682 
APMS_CLK_VAL_MRB_FUNC_MODE
) ||

1683 (
	`iwl_ªad_¥ph
(
å™s
, 
APMG_PS_CTRL_REG
) &

1684 
APMG_PS_CTRL_VAL_RESET_REQ
))) {

1685 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

1686 
	`iwl_›_mode_wimax_a˘ive
(
å™s
->
›_mode
);

1687 
	`wake_up
(&
å™s
->
waô_comm™d_queue
);

1691 
i
 = 0; i < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
; i++) {

1692 i‡(!
å™s
->
txqs
.
txq
[
i
])

1694 
	`dñ_timî
(&
å™s
->
txqs
.
txq
[
i
]->
°uck_timî
);

1699 
	`iwl_å™s_fw_îr‹
(
å™s
, 
Ál£
);

1701 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

1702 
	`wake_up
(&
å™s
->
waô_comm™d_queue
);

1703 
	}
}

1705 
u32
 
	$iwl_pcõ_öt_ˇu£_n⁄_i˘
(
iwl_å™s
 *
å™s
)

1707 
u32
 
öè
;

1709 
	`lockdï_as£π_hñd
(&
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
)->
úq_lock
);

1711 
	`åa˚_iwlwifi_dev_úq
(
å™s
->
dev
);

1714 
öè
 = 
	`iwl_ªad32
(
å™s
, 
CSR_INT
);

1717  
öè
;

1718 
	}
}

1721 
	#ICT_SHIFT
 12

	)

1722 
	#ICT_SIZE
 (1 << 
ICT_SHIFT
)

	)

1723 
	#ICT_COUNT
 (
ICT_SIZE
 / (
u32
))

	)

1733 
u32
 
	$iwl_pcõ_öt_ˇu£_i˘
(
iwl_å™s
 *
å™s
)

1735 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1736 
u32
 
öè
;

1737 
u32
 
vÆ
 = 0;

1738 
u32
 
ªad
;

1740 
	`åa˚_iwlwifi_dev_úq
(
å™s
->
dev
);

1745 
ªad
 = 
	`À32_to_˝u
(
å™s_pcõ
->
i˘_tbl
[å™s_pcõ->
i˘_ödex
]);

1746 
	`åa˚_iwlwifi_dev_i˘_ªad
(
å™s
->
dev
, 
å™s_pcõ
->
i˘_ödex
, 
ªad
);

1747 i‡(!
ªad
)

1755 
vÆ
 |
ªad
;

1756 
	`IWL_DEBUG_ISR
(
å™s
, "ICT index %d value 0x%08X\n",

1757 
å™s_pcõ
->
i˘_ödex
, 
ªad
);

1758 
å™s_pcõ
->
i˘_tbl
[å™s_pcõ->
i˘_ödex
] = 0;

1759 
å™s_pcõ
->
i˘_ödex
 =

1760 ((
å™s_pcõ
->
i˘_ödex
 + 1Ë& (
ICT_COUNT
 - 1));

1762 
ªad
 = 
	`À32_to_˝u
(
å™s_pcõ
->
i˘_tbl
[å™s_pcõ->
i˘_ödex
]);

1763 
	`åa˚_iwlwifi_dev_i˘_ªad
(
å™s
->
dev
, 
å™s_pcõ
->
i˘_ödex
,

1764 
ªad
);

1765 } 
ªad
);

1768 i‡(
vÆ
 == 0xffffffff)

1769 
vÆ
 = 0;

1778 i‡(
vÆ
 & 0xC0000)

1779 
vÆ
 |= 0x8000;

1781 
öè
 = (0xf‡& 
vÆ
) | ((0xff00 & val) << 16);

1782  
öè
;

1783 
	}
}

1785 
	$iwl_pcõ_h™dÀ_rfkûl_úq
(
iwl_å™s
 *
å™s
, 
boﬁ
 
‰om_úq
)

1787 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1788 
i§_°©i°ics
 *
i§_°©s
 = &
å™s_pcõ
->isr_stats;

1789 
boﬁ
 
hw_rfkûl
, 
¥ev
, 
ªp‹t
;

1791 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

1792 
¥ev
 = 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1793 
hw_rfkûl
 = 
	`iwl_is_rfkûl_£t
(
å™s
);

1794 i‡(
hw_rfkûl
) {

1795 
	`£t_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1796 
	`£t_bô
(
STATUS_RFKILL_HW
, &
å™s
->
°©us
);

1798 i‡(
å™s_pcõ
->
›mode_down
)

1799 
ªp‹t
 = 
hw_rfkûl
;

1801 
ªp‹t
 = 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1803 
	`IWL_WARN
(
å™s
, "RF_KILL bitÅoggledÅo %s.\n",

1804 
hw_rfkûl
 ? "disableÑadio" : "enableÑadio");

1806 
i§_°©s
->
rfkûl
++;

1808 i‡(
¥ev
 !
ªp‹t
)

1809 
	`iwl_å™s_pcõ_rf_kûl
(
å™s
, 
ªp‹t
, 
‰om_úq
);

1810 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

1812 i‡(
hw_rfkûl
) {

1813 i‡(
	`ã°_™d_˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
,

1814 &
å™s
->
°©us
))

1815 
	`IWL_DEBUG_RF_KILL
(
å™s
,

1817 
	`wake_up
(&
å™s
->
waô_comm™d_queue
);

1819 
	`˛ór_bô
(
STATUS_RFKILL_HW
, &
å™s
->
°©us
);

1820 i‡(
å™s_pcõ
->
›mode_down
)

1821 
	`˛ór_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1823 
	}
}

1825 
úqªtu∫_t
 
	$iwl_pcõ_úq_h™dÀr
(
úq
, *
dev_id
)

1827 
iwl_å™s
 *
å™s
 = 
dev_id
;

1828 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1829 
i§_°©i°ics
 *
i§_°©s
 = &
å™s_pcõ
->isr_stats;

1830 
u32
 
öè
 = 0;

1831 
u32
 
h™dÀd
 = 0;

1832 
boﬁ
 
pﬁlög
 = 
Ál£
;

1834 
	`lock_m≠_acquúe
(&
å™s
->
sync_cmd_lockdï_m≠
);

1836 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

1841 i‡(
	`likñy
(
å™s_pcõ
->
u£_i˘
))

1842 
öè
 = 
	`iwl_pcõ_öt_ˇu£_i˘
(
å™s
);

1844 
öè
 = 
	`iwl_pcõ_öt_ˇu£_n⁄_i˘
(
å™s
);

1846 i‡(
	`iwl_have_debug_Àvñ
(
IWL_DL_ISR
)) {

1847 
	`IWL_DEBUG_ISR
(
å™s
,

1849 
öè
, 
å™s_pcõ
->
öè_mask
,

1850 
	`iwl_ªad32
(
å™s
, 
CSR_INT_MASK
),

1851 
	`iwl_ªad32
(
å™s
, 
CSR_FH_INT_STATUS
));

1852 i‡(
öè
 & (~
å™s_pcõ
->
öè_mask
))

1853 
	`IWL_DEBUG_ISR
(
å™s
,

1855 
öè
 & (~
å™s_pcõ
->
öè_mask
));

1858 
öè
 &
å™s_pcõ
->
öè_mask
;

1865 i‡(
	`u∆ikñy
(!
öè
)) {

1866 
	`IWL_DEBUG_ISR
(
å™s
, "Ignore interrupt, inta == 0\n");

1871 i‡(
	`ã°_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
))

1872 
	`_iwl_íabÀ_öãºu±s
(
å™s
);

1873 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

1874 
	`lock_m≠_ªÀa£
(&
å™s
->
sync_cmd_lockdï_m≠
);

1875  
IRQ_NONE
;

1878 i‡(
	`u∆ikñy
(
öè
 =0xFFFFFFFF || 
	`iwl_å™s_is_hw_îr‹_vÆue
(inta))) {

1883 
	`IWL_WARN
(
å™s
, "HARDWARE GONE?? INTA =0x%08x\n", 
öè
);

1884 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

1885 
out
;

1899 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 
öè
 | ~
å™s_pcõ
->
öè_mask
);

1901 i‡(
	`iwl_have_debug_Àvñ
(
IWL_DL_ISR
))

1902 
	`IWL_DEBUG_ISR
(
å™s
, "inta 0x%08x,Énabled 0x%08x\n",

1903 
öè
, 
	`iwl_ªad32
(
å™s
, 
CSR_INT_MASK
));

1905 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

1908 i‡(
öè
 & 
CSR_INT_BIT_HW_ERR
) {

1909 
	`IWL_ERR
(
å™s
, "HardwareÉrror detected. Restarting.\n");

1912 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1914 
i§_°©s
->
hw
++;

1915 
	`iwl_pcõ_úq_h™dÀ_îr‹
(
å™s
);

1917 
h™dÀd
 |
CSR_INT_BIT_HW_ERR
;

1919 
out
;

1923 i‡(
öè
 & 
CSR_INT_BIT_SCD
) {

1924 
	`IWL_DEBUG_ISR
(
å™s
,

1926 
i§_°©s
->
sch
++;

1930 i‡(
öè
 & 
CSR_INT_BIT_ALIVE
) {

1931 
	`IWL_DEBUG_ISR
(
å™s
, "Alive interrupt\n");

1932 
i§_°©s
->
Æive
++;

1933 i‡(
å™s
->
å™s_cfg
->
gí2
) {

1938 
	`iwl_pcõ_rxmq_ª°ock
(
å™s
, 
å™s_pcõ
->
rxq
);

1941 
h™dÀd
 |
CSR_INT_BIT_ALIVE
;

1945 
öè
 &~(
CSR_INT_BIT_SCD
 | 
CSR_INT_BIT_ALIVE
);

1948 i‡(
öè
 & 
CSR_INT_BIT_RF_KILL
) {

1949 
	`iwl_pcõ_h™dÀ_rfkûl_úq
(
å™s
, 
åue
);

1950 
h™dÀd
 |
CSR_INT_BIT_RF_KILL
;

1954 i‡(
öè
 & 
CSR_INT_BIT_CT_KILL
) {

1955 
	`IWL_ERR
(
å™s
, "Microcode CT killÉrror detected.\n");

1956 
i§_°©s
->
˘kûl
++;

1957 
h™dÀd
 |
CSR_INT_BIT_CT_KILL
;

1961 i‡(
öè
 & 
CSR_INT_BIT_SW_ERR
) {

1962 
	`IWL_ERR
(
å™s
, "Microcode SWÉrror detected. "

1963 " Re°¨tög 0x%X.\n", 
öè
);

1964 
i§_°©s
->
sw
++;

1965 
	`iwl_pcõ_úq_h™dÀ_îr‹
(
å™s
);

1966 
h™dÀd
 |
CSR_INT_BIT_SW_ERR
;

1970 i‡(
öè
 & 
CSR_INT_BIT_WAKEUP
) {

1971 
	`IWL_DEBUG_ISR
(
å™s
, "Wakeup interrupt\n");

1972 
	`iwl_pcõ_rxq_check_wΩå
(
å™s
);

1973 
	`iwl_pcõ_txq_check_wΩås
(
å™s
);

1975 
i§_°©s
->
wakeup
++;

1977 
h™dÀd
 |
CSR_INT_BIT_WAKEUP
;

1983 i‡(
öè
 & (
CSR_INT_BIT_FH_RX
 | 
CSR_INT_BIT_SW_RX
 |

1984 
CSR_INT_BIT_RX_PERIODIC
)) {

1985 
	`IWL_DEBUG_ISR
(
å™s
, "Rx interrupt\n");

1986 i‡(
öè
 & (
CSR_INT_BIT_FH_RX
 | 
CSR_INT_BIT_SW_RX
)) {

1987 
h™dÀd
 |(
CSR_INT_BIT_FH_RX
 | 
CSR_INT_BIT_SW_RX
);

1988 
	`iwl_wrôe32
(
å™s
, 
CSR_FH_INT_STATUS
,

1989 
CSR_FH_INT_RX_MASK
);

1991 i‡(
öè
 & 
CSR_INT_BIT_RX_PERIODIC
) {

1992 
h™dÀd
 |
CSR_INT_BIT_RX_PERIODIC
;

1993 
	`iwl_wrôe32
(
å™s
,

1994 
CSR_INT
, 
CSR_INT_BIT_RX_PERIODIC
);

2008 
	`iwl_wrôe8
(
å™s
, 
CSR_INT_PERIODIC_REG
,

2009 
CSR_INT_PERIODIC_DIS
);

2018 i‡(
öè
 & (
CSR_INT_BIT_FH_RX
 | 
CSR_INT_BIT_SW_RX
))

2019 
	`iwl_wrôe8
(
å™s
, 
CSR_INT_PERIODIC_REG
,

2020 
CSR_INT_PERIODIC_ENA
);

2022 
i§_°©s
->
rx
++;

2024 
	`loˇl_bh_dißbÀ
();

2025 i‡(
	`«pi_scheduÀ_¥ï
(&
å™s_pcõ
->
rxq
[0].
«pi
)) {

2026 
pﬁlög
 = 
åue
;

2027 
	`__«pi_scheduÀ
(&
å™s_pcõ
->
rxq
[0].
«pi
);

2029 
	`loˇl_bh_íabÀ
();

2033 i‡(
öè
 & 
CSR_INT_BIT_FH_TX
) {

2034 
	`iwl_wrôe32
(
å™s
, 
CSR_FH_INT_STATUS
, 
CSR_FH_INT_TX_MASK
);

2035 
	`IWL_DEBUG_ISR
(
å™s
, "uCodeÜoad interrupt\n");

2036 
i§_°©s
->
tx
++;

2037 
h™dÀd
 |
CSR_INT_BIT_FH_TX
;

2039 
å™s_pcõ
->
ucode_wrôe_com∂ëe
 = 
åue
;

2040 
	`wake_up
(&
å™s_pcõ
->
ucode_wrôe_waôq
);

2042 i‡(
å™s_pcõ
->
imr_°©us
 =
IMR_D2S_REQUESTED
) {

2043 
å™s_pcõ
->
imr_°©us
 = 
IMR_D2S_COMPLETED
;

2044 
	`wake_up
(&
å™s_pcõ
->
ucode_wrôe_waôq
);

2048 i‡(
öè
 & ~
h™dÀd
) {

2049 
	`IWL_ERR
(
å™s
, "Unh™dÀd INTA bô†0x%08x\n", 
öè
 & ~
h™dÀd
);

2050 
i§_°©s
->
unh™dÀd
++;

2053 i‡(
öè
 & ~(
å™s_pcõ
->
öè_mask
)) {

2054 
	`IWL_WARN
(
å™s
, "Disabled INTA bits 0x%08x wereÖending\n",

2055 
öè
 & ~
å™s_pcõ
->
öè_mask
);

2058 i‡(!
pﬁlög
) {

2059 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

2061 i‡(
	`ã°_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
))

2062 
	`_iwl_íabÀ_öãºu±s
(
å™s
);

2064 i‡(
h™dÀd
 & 
CSR_INT_BIT_FH_TX
)

2065 
	`iwl_íabÀ_fw_lﬂd_öt
(
å™s
);

2067 i‡(
h™dÀd
 & 
CSR_INT_BIT_RF_KILL
)

2068 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

2070 i‡(
h™dÀd
 & (
CSR_INT_BIT_ALIVE
 | 
CSR_INT_BIT_FH_RX
))

2071 
	`iwl_íabÀ_fw_lﬂd_öt_˘x_öfo
(
å™s
);

2072 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

2075 
out
:

2076 
	`lock_m≠_ªÀa£
(&
å™s
->
sync_cmd_lockdï_m≠
);

2077  
IRQ_HANDLED
;

2078 
	}
}

2087 
	$iwl_pcõ_‰ì_i˘
(
iwl_å™s
 *
å™s
)

2089 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2091 i‡(
å™s_pcõ
->
i˘_tbl
) {

2092 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
ICT_SIZE
,

2093 
å™s_pcõ
->
i˘_tbl
,

2094 
å™s_pcõ
->
i˘_tbl_dma
);

2095 
å™s_pcõ
->
i˘_tbl
 = 
NULL
;

2096 
å™s_pcõ
->
i˘_tbl_dma
 = 0;

2098 
	}
}

2105 
	$iwl_pcõ_Æloc_i˘
(
iwl_å™s
 *
å™s
)

2107 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2109 
å™s_pcõ
->
i˘_tbl
 =

2110 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
ICT_SIZE
,

2111 &
å™s_pcõ
->
i˘_tbl_dma
, 
GFP_KERNEL
);

2112 i‡(!
å™s_pcõ
->
i˘_tbl
)

2113  -
ENOMEM
;

2116 i‡(
	`WARN_ON
(
å™s_pcõ
->
i˘_tbl_dma
 & (
ICT_SIZE
 - 1))) {

2117 
	`iwl_pcõ_‰ì_i˘
(
å™s
);

2118  -
EINVAL
;

2122 
	}
}

2127 
	$iwl_pcõ_ª£t_i˘
(
iwl_å™s
 *
å™s
)

2129 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2130 
u32
 
vÆ
;

2132 i‡(!
å™s_pcõ
->
i˘_tbl
)

2135 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

2136 
	`_iwl_dißbÀ_öãºu±s
(
å™s
);

2138 
	`mem£t
(
å™s_pcõ
->
i˘_tbl
, 0, 
ICT_SIZE
);

2140 
vÆ
 = 
å™s_pcõ
->
i˘_tbl_dma
 >> 
ICT_SHIFT
;

2142 
vÆ
 |
CSR_DRAM_INT_TBL_ENABLE
 |

2143 
CSR_DRAM_INIT_TBL_WRAP_CHECK
 |

2144 
CSR_DRAM_INIT_TBL_WRITE_POINTER
;

2146 
	`IWL_DEBUG_ISR
(
å™s
, "CSR_DRAM_INT_TBL_REG =0x%x\n", 
vÆ
);

2148 
	`iwl_wrôe32
(
å™s
, 
CSR_DRAM_INT_TBL_REG
, 
vÆ
);

2149 
å™s_pcõ
->
u£_i˘
 = 
åue
;

2150 
å™s_pcõ
->
i˘_ödex
 = 0;

2151 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 
å™s_pcõ
->
öè_mask
);

2152 
	`_iwl_íabÀ_öãºu±s
(
å™s
);

2153 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

2154 
	}
}

2157 
	$iwl_pcõ_dißbÀ_i˘
(
iwl_å™s
 *
å™s
)

2159 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2161 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

2162 
å™s_pcõ
->
u£_i˘
 = 
Ál£
;

2163 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

2164 
	}
}

2166 
úqªtu∫_t
 
	$iwl_pcõ_i§
(
úq
, *
d©a
)

2168 
iwl_å™s
 *
å™s
 = 
d©a
;

2170 i‡(!
å™s
)

2171  
IRQ_NONE
;

2178 
	`iwl_wrôe32
(
å™s
, 
CSR_INT_MASK
, 0x00000000);

2180  
IRQ_WAKE_THREAD
;

2181 
	}
}

2183 
úqªtu∫_t
 
	$iwl_pcõ_msix_i§
(
úq
, *
d©a
)

2185  
IRQ_WAKE_THREAD
;

2186 
	}
}

2188 
úqªtu∫_t
 
	$iwl_pcõ_úq_msix_h™dÀr
(
úq
, *
dev_id
)

2190 
msix_íåy
 *
íåy
 = 
dev_id
;

2191 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`iwl_pcõ_gë_å™s_pcõ
(
íåy
);

2192 
iwl_å™s
 *
å™s
 = 
å™s_pcõ
->trans;

2193 
i§_°©i°ics
 *
i§_°©s
 = &
å™s_pcõ
->isr_stats;

2194 
u32
 
öè_fh_msk
 = ~
MSIX_FH_INT_CAUSES_DATA_QUEUE
;

2195 
u32
 
öè_fh
, 
öè_hw
;

2196 
boﬁ
 
pﬁlög
 = 
Ál£
;

2197 
boﬁ
 
sw_îr
;

2199 i‡(
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_NON_RX
)

2200 
öè_fh_msk
 |
MSIX_FH_INT_CAUSES_Q0
;

2202 i‡(
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_FIRST_RSS
)

2203 
öè_fh_msk
 |
MSIX_FH_INT_CAUSES_Q1
;

2205 
	`lock_m≠_acquúe
(&
å™s
->
sync_cmd_lockdï_m≠
);

2207 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

2208 
öè_fh
 = 
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_FH_INT_CAUSES_AD
);

2209 
öè_hw
 = 
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_HW_INT_CAUSES_AD
);

2213 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_FH_INT_CAUSES_AD
, 
öè_fh
 & 
öè_fh_msk
);

2214 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_HW_INT_CAUSES_AD
, 
öè_hw
);

2215 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

2217 
	`åa˚_iwlwifi_dev_úq_msix
(
å™s
->
dev
, 
íåy
, 
åue
, 
öè_fh
, 
öè_hw
);

2219 i‡(
	`u∆ikñy
(!(
öè_fh
 | 
öè_hw
))) {

2220 
	`IWL_DEBUG_ISR
(
å™s
, "Ignore interrupt, inta == 0\n");

2221 
	`lock_m≠_ªÀa£
(&
å™s
->
sync_cmd_lockdï_m≠
);

2222  
IRQ_NONE
;

2225 i‡(
	`iwl_have_debug_Àvñ
(
IWL_DL_ISR
)) {

2226 
	`IWL_DEBUG_ISR
(
å™s
,

2228 
íåy
->íåy, 
öè_fh
, 
å™s_pcõ
->
fh_mask
,

2229 
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
));

2230 i‡(
öè_fh
 & ~
å™s_pcõ
->
fh_mask
)

2231 
	`IWL_DEBUG_ISR
(
å™s
,

2233 
öè_fh
 & ~
å™s_pcõ
->
fh_mask
);

2236 
öè_fh
 &
å™s_pcõ
->
fh_mask
;

2238 i‡((
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_NON_RX
) &&

2239 
öè_fh
 & 
MSIX_FH_INT_CAUSES_Q0
) {

2240 
	`loˇl_bh_dißbÀ
();

2241 i‡(
	`«pi_scheduÀ_¥ï
(&
å™s_pcõ
->
rxq
[0].
«pi
)) {

2242 
pﬁlög
 = 
åue
;

2243 
	`__«pi_scheduÀ
(&
å™s_pcõ
->
rxq
[0].
«pi
);

2245 
	`loˇl_bh_íabÀ
();

2248 i‡((
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_FIRST_RSS
) &&

2249 
öè_fh
 & 
MSIX_FH_INT_CAUSES_Q1
) {

2250 
	`loˇl_bh_dißbÀ
();

2251 i‡(
	`«pi_scheduÀ_¥ï
(&
å™s_pcõ
->
rxq
[1].
«pi
)) {

2252 
pﬁlög
 = 
åue
;

2253 
	`__«pi_scheduÀ
(&
å™s_pcõ
->
rxq
[1].
«pi
);

2255 
	`loˇl_bh_íabÀ
();

2259 i‡(
öè_fh
 & 
MSIX_FH_INT_CAUSES_D2S_CH0_NUM
 &&

2260 
å™s_pcõ
->
imr_°©us
 =
IMR_D2S_REQUESTED
) {

2261 
	`IWL_DEBUG_ISR
(
å™s
, "IMR Complete interrupt\n");

2262 
i§_°©s
->
tx
++;

2265 i‡(
å™s_pcõ
->
imr_°©us
 =
IMR_D2S_REQUESTED
) {

2266 
å™s_pcõ
->
imr_°©us
 = 
IMR_D2S_COMPLETED
;

2267 
	`wake_up
(&
å™s_pcõ
->
ucode_wrôe_waôq
);

2269 } i‡(
öè_fh
 & 
MSIX_FH_INT_CAUSES_D2S_CH0_NUM
) {

2270 
	`IWL_DEBUG_ISR
(
å™s
, "uCodeÜoad interrupt\n");

2271 
i§_°©s
->
tx
++;

2276 
å™s_pcõ
->
ucode_wrôe_com∂ëe
 = 
åue
;

2277 
	`wake_up
(&
å™s_pcõ
->
ucode_wrôe_waôq
);

2280 i‡(
å™s_pcõ
->
imr_°©us
 =
IMR_D2S_REQUESTED
) {

2281 
å™s_pcõ
->
imr_°©us
 = 
IMR_D2S_COMPLETED
;

2282 
	`wake_up
(&
å™s_pcõ
->
ucode_wrôe_waôq
);

2286 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

2287 
sw_îr
 = 
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_SW_ERR_BZ
;

2289 
sw_îr
 = 
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_SW_ERR
;

2291 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_TOP_FATAL_ERR
) {

2292 
	`IWL_ERR
(
å™s
, "TOP FatalÉrror detected, inta_hw=0x%x.\n",

2293 
öè_hw
);

2298 i‡((
öè_fh
 & 
MSIX_FH_INT_CAUSES_FH_ERR
Ë|| 
sw_îr
) {

2299 
	`IWL_ERR
(
å™s
,

2301 
öè_fh
);

2302 
i§_°©s
->
sw
++;

2304 i‡(
å™s_pcõ
->
imr_°©us
 =
IMR_D2S_REQUESTED
) {

2305 
å™s_pcõ
->
imr_°©us
 = 
IMR_D2S_ERROR
;

2306 
	`wake_up
(&
å™s_pcõ
->
imr_waôq
);

2307 } i‡(
å™s_pcõ
->
fw_ª£t_°©e
 =
FW_RESET_REQUESTED
) {

2308 
å™s_pcõ
->
fw_ª£t_°©e
 = 
FW_RESET_ERROR
;

2309 
	`wake_up
(&
å™s_pcõ
->
fw_ª£t_waôq
);

2311 
	`iwl_pcõ_úq_h™dÀ_îr‹
(
å™s
);

2316 i‡(
	`iwl_have_debug_Àvñ
(
IWL_DL_ISR
)) {

2317 
	`IWL_DEBUG_ISR
(
å™s
,

2319 
íåy
->íåy, 
öè_hw
, 
å™s_pcõ
->
hw_mask
,

2320 
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_HW_INT_MASK_AD
));

2321 i‡(
öè_hw
 & ~
å™s_pcõ
->
hw_mask
)

2322 
	`IWL_DEBUG_ISR
(
å™s
,

2324 
öè_hw
 & ~
å™s_pcõ
->
hw_mask
);

2327 
öè_hw
 &
å™s_pcõ
->
hw_mask
;

2330 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_ALIVE
) {

2331 
	`IWL_DEBUG_ISR
(
å™s
, "Alive interrupt\n");

2332 
i§_°©s
->
Æive
++;

2333 i‡(
å™s
->
å™s_cfg
->
gí2
) {

2335 
	`iwl_pcõ_rxmq_ª°ock
(
å™s
, 
å™s_pcõ
->
rxq
);

2344 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_WAKEUP
 && 
å™s_pcõ
->
¥ph_öfo
) {

2345 
u32
 
¶ìp_nŸif
 =

2346 
	`À32_to_˝u
(
å™s_pcõ
->
¥ph_öfo
->
¶ìp_nŸif
);

2347 i‡(
¶ìp_nŸif
 =
IWL_D3_SLEEP_STATUS_SUSPEND
 ||

2348 
¶ìp_nŸif
 =
IWL_D3_SLEEP_STATUS_RESUME
) {

2349 
	`IWL_DEBUG_ISR
(
å™s
,

2351 
¶ìp_nŸif
);

2352 
å™s_pcõ
->
sx_com∂ëe
 = 
åue
;

2353 
	`wake_up
(&
å™s_pcõ
->
sx_waôq
);

2356 
	`IWL_DEBUG_ISR
(
å™s
, "Wakeup interrupt\n");

2357 
	`iwl_pcõ_rxq_check_wΩå
(
å™s
);

2358 
	`iwl_pcõ_txq_check_wΩås
(
å™s
);

2360 
i§_°©s
->
wakeup
++;

2365 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_CT_KILL
) {

2366 
	`IWL_ERR
(
å™s
, "Microcode CT killÉrror detected.\n");

2367 
i§_°©s
->
˘kûl
++;

2371 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_RF_KILL
)

2372 
	`iwl_pcõ_h™dÀ_rfkûl_úq
(
å™s
, 
åue
);

2374 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_HW_ERR
) {

2375 
	`IWL_ERR
(
å™s
,

2378 
i§_°©s
->
hw
++;

2379 
å™s
->
dbg
.
hw_îr‹
 = 
åue
;

2380 
	`iwl_pcõ_úq_h™dÀ_îr‹
(
å™s
);

2383 i‡(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_RESET_DONE
) {

2384 
	`IWL_DEBUG_ISR
(
å™s
, "Reset flow completed\n");

2385 
å™s_pcõ
->
fw_ª£t_°©e
 = 
FW_RESET_OK
;

2386 
	`wake_up
(&
å™s_pcõ
->
fw_ª£t_waôq
);

2389 i‡(!
pﬁlög
)

2390 
	`iwl_pcõ_˛ór_úq
(
å™s
, 
íåy
->entry);

2392 
	`lock_m≠_ªÀa£
(&
å™s
->
sync_cmd_lockdï_m≠
);

2394  
IRQ_HANDLED
;

2395 
	}
}

	@pcie/trans-gen2.c

6 
	~"iwl-å™s.h
"

7 
	~"iwl-¥ph.h
"

8 
	~"iwl-c⁄ãxt-öfo.h
"

9 
	~"iwl-c⁄ãxt-öfo-gí3.h
"

10 
	~"öã∫Æ.h
"

11 
	~"fw/dbg.h
"

13 
	#FW_RESET_TIMEOUT
 (
HZ
 / 5)

	)

20 
	$iwl_pcõ_gí2_≠m_öô
(
iwl_å™s
 *
å™s
)

22 
ªt
 = 0;

24 
	`IWL_DEBUG_INFO
(
å™s
, "Init card's basic functions\n");

35 
	`iwl_£t_bô
(
å™s
, 
CSR_GIO_CHICKEN_BITS
,

36 
CSR_GIO_CHICKEN_BITS_REG_BIT_L1A_NO_L0S_RX
);

39 
	`iwl_£t_bô
(
å™s
, 
CSR_DBG_HPET_MEM_REG
, 
CSR_DBG_HPET_MEM_REG_VAL
);

45 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

46 
CSR_HW_IF_CONFIG_REG_BIT_HAP_WAKE_L1A
);

48 
	`iwl_pcõ_≠m_c⁄fig
(
å™s
);

50 
ªt
 = 
	`iwl_föish_nic_öô
(
å™s
);

51 i‡(
ªt
)

52  
ªt
;

54 
	`£t_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
);

57 
	}
}

59 
	$iwl_pcõ_gí2_≠m_°›
(
iwl_å™s
 *
å™s
, 
boﬁ
 
›_mode_Àave
)

61 
	`IWL_DEBUG_INFO
(
å™s
, "Stop card,Öut inÜowÖower state\n");

63 i‡(
›_mode_Àave
) {

64 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

65 
	`iwl_pcõ_gí2_≠m_öô
(
å™s
);

68 
	`iwl_£t_bô
(
å™s
, 
CSR_DBG_LINK_PWR_MGMT_REG
,

69 
CSR_RESET_LINK_PWR_MGMT_DISABLED
);

70 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

71 
CSR_HW_IF_CONFIG_REG_PREPARE
 |

72 
CSR_HW_IF_CONFIG_REG_ENABLE_PME
);

73 
	`mdñay
(1);

74 
	`iwl_˛ór_bô
(
å™s
, 
CSR_DBG_LINK_PWR_MGMT_REG
,

75 
CSR_RESET_LINK_PWR_MGMT_DISABLED
);

76 
	`mdñay
(5);

79 
	`˛ór_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
);

82 
	`iwl_pcõ_≠m_°›_ma°î
(
å™s
);

84 
	`iwl_å™s_sw_ª£t
(
å™s
, 
Ál£
);

90 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

91 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

92 
CSR_GP_CNTRL_REG_FLAG_MAC_INIT
);

94 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

95 
CSR_GP_CNTRL_REG_FLAG_INIT_DONE
);

96 
	}
}

98 
	$iwl_å™s_pcõ_fw_ª£t_h™dshake
(
iwl_å™s
 *
å™s
)

100 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

101 
ªt
;

103 
å™s_pcõ
->
fw_ª£t_°©e
 = 
FW_RESET_REQUESTED
;

105 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

106 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_NIC_SET_NMI_DRIVER
,

107 
UREG_NIC_SET_NMI_DRIVER_RESET_HANDSHAKE
);

108 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_AX210
)

109 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_DOORBELL_TO_ISR6
,

110 
UREG_DOORBELL_TO_ISR6_RESET_HANDSHAKE
);

112 
	`iwl_wrôe32
(
å™s
, 
CSR_DOORBELL_VECTOR
,

113 
UREG_DOORBELL_TO_ISR6_RESET_HANDSHAKE
);

116 
ªt
 = 
	`waô_evít_timeout
(
å™s_pcõ
->
fw_ª£t_waôq
,

117 
å™s_pcõ
->
fw_ª£t_°©e
 !
FW_RESET_REQUESTED
,

118 
FW_RESET_TIMEOUT
);

119 i‡(!
ªt
 || 
å™s_pcõ
->
fw_ª£t_°©e
 =
FW_RESET_ERROR
) {

120 
u32
 
öè_hw
 = 
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_HW_INT_CAUSES_AD
);

122 
	`IWL_ERR
(
å™s
,

124 
öè_hw
);

126 i‡(!(
öè_hw
 & 
MSIX_HW_INT_CAUSES_REG_RESET_DONE
))

127 
	`iwl_å™s_fw_îr‹
(
å™s
, 
åue
);

130 
å™s_pcõ
->
fw_ª£t_°©e
 = 
FW_RESET_IDLE
;

131 
	}
}

133 
	$_iwl_å™s_pcõ_gí2_°›_devi˚
(
iwl_å™s
 *
å™s
)

135 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

137 
	`lockdï_as£π_hñd
(&
å™s_pcõ
->
muãx
);

139 i‡(
å™s_pcõ
->
is_down
)

142 i‡(
å™s
->
°©e
 >
IWL_TRANS_FW_STARTED
)

143 i‡(
å™s_pcõ
->
fw_ª£t_h™dshake
)

144 
	`iwl_å™s_pcõ_fw_ª£t_h™dshake
(
å™s
);

146 
å™s_pcõ
->
is_down
 = 
åue
;

149 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

152 
	`iwl_pcõ_dißbÀ_i˘
(
å™s
);

161 i‡(
	`ã°_™d_˛ór_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
)) {

162 
	`IWL_DEBUG_INFO
(
å™s
,

164 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

165 
	`iwl_pcõ_rx_«pi_sync
(
å™s
);

166 
	`iwl_txq_gí2_tx_‰ì
(
å™s
);

167 
	`iwl_pcõ_rx_°›
(
å™s
);

170 
	`iwl_pcõ_˘xt_öfo_‰ì_∑gög
(
å™s
);

171 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

172 
	`iwl_pcõ_˘xt_öfo_gí3_‰ì
(
å™s
, 
Ál£
);

174 
	`iwl_pcõ_˘xt_öfo_‰ì
(
å™s
);

177 
	`iwl_pcõ_gí2_≠m_°›
(
å™s
, 
Ál£
);

180 
	`iwl_å™s_sw_ª£t
(
å™s
, 
åue
);

189 
	`iwl_pcõ_c⁄f_msix_hw
(
å™s_pcõ
);

198 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

201 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

202 
	`˛ór_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
);

203 
	`˛ór_bô
(
STATUS_TPOWER_PMI
, &
å™s
->
°©us
);

209 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

210 
	}
}

212 
	$iwl_å™s_pcõ_gí2_°›_devi˚
(
iwl_å™s
 *
å™s
)

214 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

215 
boﬁ
 
was_ö_rfkûl
;

217 
	`iwl_›_mode_time_poöt
(
å™s
->
›_mode
,

218 
IWL_FW_INI_TIME_POINT_HOST_DEVICE_DISABLE
,

219 
NULL
);

221 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

222 
å™s_pcõ
->
›mode_down
 = 
åue
;

223 
was_ö_rfkûl
 = 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

224 
	`_iwl_å™s_pcõ_gí2_°›_devi˚
(
å™s
);

225 
	`iwl_å™s_pcõ_h™dÀ_°›_rfkûl
(
å™s
, 
was_ö_rfkûl
);

226 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

227 
	}
}

229 
	$iwl_pcõ_gí2_nic_öô
(
iwl_å™s
 *
å™s
)

231 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

232 
queue_size
 = 
	`max_t
(
u32
, 
IWL_CMD_QUEUE_SIZE
,

233 
å™s
->
cfg
->
mö_txq_size
);

234 
ªt
;

237 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

238 
ªt
 = 
	`iwl_pcõ_gí2_≠m_öô
(
å™s
);

239 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

240 i‡(
ªt
)

241  
ªt
;

243 
	`iwl_›_mode_nic_c⁄fig
(
å™s
->
›_mode
);

246 i‡(
	`iwl_pcõ_gí2_rx_öô
(
å™s
))

247  -
ENOMEM
;

250 i‡(
	`iwl_txq_gí2_öô
(
å™s
,Åøns->
txqs
.
cmd
.
q_id
, 
queue_size
))

251  -
ENOMEM
;

254 
	`iwl_£t_bô
(
å™s
, 
CSR_MAC_SHADOW_REG_CTRL
, 0x800FFFFF);

255 
	`IWL_DEBUG_INFO
(
å™s
, "Enabling shadowÑegisters in device\n");

258 
	}
}

260 
	$iwl_pcõ_gë_rf_«me
(
iwl_å™s
 *
å™s
)

262 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

263 *
buf
 = 
å™s_pcõ
->
rf_«me
;

264 
size_t
 
buÊí
 = (
å™s_pcõ
->
rf_«me
);

265 
size_t
 
pos
;

266 
u32
 
vîsi⁄
;

268 i‡(
buf
[0])

271 
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
)) {

272 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_JF
):

273 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "JF");

275 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_GF
):

276 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "GF");

278 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_GF4
):

279 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "GF4");

281 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_HR
):

282 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "HR");

284 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_HR1
):

285 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "HR1");

287 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_HRCDB
):

288 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "HRCDB");

290 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_MS
):

291 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "MS");

293 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_FM
):

294 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "FM");

296 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_WP
):

297 i‡(
SILICON_Z_STEP
 ==

298 
	`CSR_HW_RFID_STEP
(
å™s
->
hw_rf_id
))

299 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "WHTC");

301 
pos
 = 
	`s˙¥ötf
(
buf
, 
buÊí
, "WH");

307 
	`CSR_HW_RFID_TYPE
(
å™s
->
hw_rf_id
)) {

308 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_HR
):

309 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_HR1
):

310 
	`CSR_HW_RFID_TYPE
(
CSR_HW_RF_ID_TYPE_HRCDB
):

311 
vîsi⁄
 = 
	`iwl_ªad_¥ph
(
å™s
, 
CNVI_MBOX_C
);

312 
vîsi⁄
) {

314 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buÊí
 -Öos, " B3");

317 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buÊí
 -Öos, " B5");

320 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buÊí
 -Öos,

321 " (0x%x)", 
vîsi⁄
);

329 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buÊí
 -Öos, ",Ñfid=0x%x",

330 
å™s
->
hw_rf_id
);

332 
	`IWL_INFO
(
å™s
, "Dëe˘ed RF %s\n", 
buf
);

339 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
buÊí
 -Öos, "\n");

340 
	}
}

342 
	$iwl_å™s_pcõ_gí2_fw_Æive
(
iwl_å™s
 *
å™s
, 
u32
 
scd_addr
)

344 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

346 
	`iwl_pcõ_ª£t_i˘
(
å™s
);

349 
	`mem£t
(
å™s
->
txqs
.
queue_°›≥d
, 0,

350 (
å™s
->
txqs
.
queue_°›≥d
));

351 
	`mem£t
(
å™s
->
txqs
.
queue_u£d
, 0, (trans->txqs.queue_used));

356 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

357 
	`iwl_pcõ_˘xt_öfo_gí3_‰ì
(
å™s
, 
åue
);

359 
	`iwl_pcõ_˘xt_öfo_‰ì
(
å™s
);

365 
	`iwl_íabÀ_öãºu±s
(
å™s
);

366 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

367 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

369 
	`iwl_pcõ_gë_rf_«me
(
å™s
);

370 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

371 
	}
}

373 
boﬁ
 
	$iwl_pcõ_£t_…r
(
iwl_å™s
 *
å™s
)

375 
u32
 
…r_vÆ
 = 
CSR_LTR_LONG_VAL_AD_NO_SNOOP_REQ
 |

376 
	`u32_ícode_bôs
(
CSR_LTR_LONG_VAL_AD_SCALE_USEC
,

377 
CSR_LTR_LONG_VAL_AD_NO_SNOOP_SCALE
) |

378 
	`u32_ícode_bôs
(250,

379 
CSR_LTR_LONG_VAL_AD_NO_SNOOP_VAL
) |

380 
CSR_LTR_LONG_VAL_AD_SNOOP_REQ
 |

381 
	`u32_ícode_bôs
(
CSR_LTR_LONG_VAL_AD_SCALE_USEC
,

382 
CSR_LTR_LONG_VAL_AD_SNOOP_SCALE
) |

383 
	`u32_ícode_bôs
(250, 
CSR_LTR_LONG_VAL_AD_SNOOP_VAL
);

390 i‡((
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_AX210
 ||

391 
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_22000
) &&

392 !
å™s
->
å™s_cfg
->
öãgøãd
) {

393 
	`iwl_wrôe32
(
å™s
, 
CSR_LTR_LONG_VAL_AD
, 
…r_vÆ
);

394  
åue
;

397 i‡(
å™s
->
å™s_cfg
->
öãgøãd
 &&

398 
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_22000
) {

399 
	`iwl_wrôe_¥ph
(
å™s
, 
HPM_MAC_LTR_CSR
, 
HPM_MAC_LRT_ENABLE_ALL
);

400 
	`iwl_wrôe_¥ph
(
å™s
, 
HPM_UMAC_LTR
, 
…r_vÆ
);

401  
åue
;

404 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_AX210
) {

406 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_HW_INT_CAUSES_AD
,

407 
MSIX_HW_INT_CAUSES_REG_IML
);

415  
Ál£
;

419  
åue
;

420 
	}
}

422 
	$iwl_pcõ_•ö_f‹_iml
(
iwl_å™s
 *
å™s
)

425 
	#IML_WAIT_TIMEOUT
 (
HZ
 / 10)

	)

426 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

427 
íd_time
 = 
jiffõs
 + 
IML_WAIT_TIMEOUT
;

428 
u32
 
vÆue
, 
lo›s
 = 0;

429 
boﬁ
 
úq
 = 
Ál£
;

431 i‡(
	`WARN_ON
(!
å™s_pcõ
->
iml
))

434 
vÆue
 = 
	`iwl_ªad32
(
å™s
, 
CSR_LTR_LAST_MSG
);

435 
	`IWL_DEBUG_INFO
(
å™s
, "Polling for IMLÜoad - CSR_LTR_LAST_MSG=0x%x\n",

436 
vÆue
);

438 
	`time_bef‹e
(
jiffõs
, 
íd_time
)) {

439 i‡(
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_HW_INT_CAUSES_AD
) &

440 
MSIX_HW_INT_CAUSES_REG_IML
) {

441 
úq
 = 
åue
;

445 
vÆue
 = 
	`iwl_ªad32
(
å™s
, 
CSR_LTR_LAST_MSG
);

446 
lo›s
++;

449 
	`IWL_DEBUG_INFO
(
å™s
,

451 
úq
, 
lo›s
, 
vÆue
);

458 
	}
}

460 
	$iwl_å™s_pcõ_gí2_°¨t_fw
(
iwl_å™s
 *
å™s
,

461 c⁄° 
fw_img
 *
fw
, 
boﬁ
 
run_ö_rfkûl
)

463 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

464 
boﬁ
 
hw_rfkûl
, 
kìp_øm_busy
;

465 
ªt
;

468 i‡(
	`iwl_pcõ_¥ï¨e_ˇrd_hw
(
å™s
)) {

469 
	`IWL_WARN
(
å™s
, "Exit HWÇotÑeady\n");

470  -
EIO
;

473 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

475 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 0xFFFFFFFF);

482 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

485 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

487 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

490 
hw_rfkûl
 = 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

491 i‡(
hw_rfkûl
 && !
run_ö_rfkûl
) {

492 
ªt
 = -
ERFKILL
;

493 
out
;

497 i‡(
å™s_pcõ
->
is_down
) {

498 
	`IWL_WARN
(
å™s
,

500 
ªt
 = -
EIO
;

501 
out
;

505 
	`iwl_wrôe32
(
å™s
, 
CSR_UCODE_DRV_GP1_CLR
, 
CSR_UCODE_SW_BIT_RFKILL
);

506 
	`iwl_wrôe32
(
å™s
, 
CSR_UCODE_DRV_GP1_CLR
,

507 
CSR_UCODE_DRV_GP1_BIT_CMD_BLOCKED
);

510 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 0xFFFFFFFF);

512 
ªt
 = 
	`iwl_pcõ_gí2_nic_öô
(
å™s
);

513 i‡(
ªt
) {

514 
	`IWL_ERR
(
å™s
, "UnableÅo initÇic\n");

515 
out
;

518 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

519 
ªt
 = 
	`iwl_pcõ_˘xt_öfo_gí3_öô
(
å™s
, 
fw
);

521 
ªt
 = 
	`iwl_pcõ_˘xt_öfo_öô
(
å™s
, 
fw
);

522 i‡(
ªt
)

523 
out
;

525 
kìp_øm_busy
 = !
	`iwl_pcõ_£t_…r
(
å™s
);

527 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

528 
	`iwl_wrôe32
(
å™s
, 
CSR_FUNC_SCRATCH
, 
CSR_FUNC_SCRATCH_INIT_VALUE
);

529 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

530 
CSR_GP_CNTRL_REG_FLAG_ROM_START
);

531 } i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

532 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_CPU_INIT_RUN
, 1);

534 
	`iwl_wrôe_¥ph
(
å™s
, 
UREG_CPU_INIT_RUN
, 1);

537 i‡(
kìp_øm_busy
)

538 
	`iwl_pcõ_•ö_f‹_iml
(
å™s
);

541 
hw_rfkûl
 = 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

542 i‡(
hw_rfkûl
 && !
run_ö_rfkûl
)

543 
ªt
 = -
ERFKILL
;

545 
out
:

546 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

547  
ªt
;

548 
	}
}

	@pcie/trans.c

7 
	~<löux/pci.h
>

8 
	~<löux/öãºu±.h
>

9 
	~<löux/debugfs.h
>

10 
	~<löux/sched.h
>

11 
	~<löux/bô›s.h
>

12 
	~<löux/gÂ.h
>

13 
	~<löux/vmÆloc.h
>

14 
	~<löux/moduÀ.h
>

15 
	~<löux/waô.h
>

16 
	~<löux/£q_fûe.h
>

18 
	~"iwl-drv.h
"

19 
	~"iwl-å™s.h
"

20 
	~"iwl-c§.h
"

21 
	~"iwl-¥ph.h
"

22 
	~"iwl-scd.h
"

23 
	~"iwl-agn-hw.h
"

24 
	~"fw/îr‹-dump.h
"

25 
	~"fw/dbg.h
"

26 
	~"fw/≠i/tx.h
"

27 
	~"mei/iwl-mei.h
"

28 
	~"öã∫Æ.h
"

29 
	~"iwl-fh.h
"

30 
	~"iwl-c⁄ãxt-öfo-gí3.h
"

33 
	#IWL_FW_MEM_EXTENDED_START
 0x40000

	)

34 
	#IWL_FW_MEM_EXTENDED_END
 0x57FFF

	)

36 
	$iwl_å™s_pcõ_dump_ªgs
(
iwl_å™s
 *
å™s
)

38 
	#PCI_DUMP_SIZE
 352

	)

39 
	#PCI_MEM_DUMP_SIZE
 64

	)

40 
	#PCI_PARENT_DUMP_SIZE
 524

	)

41 
	#PREFIX_LEN
 32

	)

42 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

43 
pci_dev
 *
pdev
 = 
å™s_pcõ
->pci_dev;

44 
u32
 
i
, 
pos
, 
Æloc_size
, *
±r
, *
buf
;

45 *
¥efix
;

47 i‡(
å™s_pcõ
->
pcõ_dbg_dum≥d_⁄˚
)

51 
	`BUILD_BUG_ON
(
PCI_DUMP_SIZE
 > 4096 || PCI_DUMP_SIZE & 0x3);

52 
	`BUILD_BUG_ON
(
PCI_MEM_DUMP_SIZE
 > 4096 || PCI_MEM_DUMP_SIZE & 0x3);

53 
	`BUILD_BUG_ON
(
PCI_PARENT_DUMP_SIZE
 > 4096 || PCI_PARENT_DUMP_SIZE & 0x3);

56 
Æloc_size
 = 
PCI_ERR_ROOT_ERR_SRC
 + 4 + 
PREFIX_LEN
;

57 
Æloc_size
 = 
	`max_t
(
u32
,áŒoc_size, 
PCI_DUMP_SIZE
 + 
PREFIX_LEN
);

58 
Æloc_size
 = 
	`max_t
(
u32
,áŒoc_size, 
PCI_MEM_DUMP_SIZE
 + 
PREFIX_LEN
);

59 
Æloc_size
 = 
	`max_t
(
u32
,áŒoc_size, 
PCI_PARENT_DUMP_SIZE
 + 
PREFIX_LEN
);

61 
buf
 = 
	`kmÆloc
(
Æloc_size
, 
GFP_ATOMIC
);

62 i‡(!
buf
)

64 
¥efix
 = (*)
buf
 + 
Æloc_size
 - 
PREFIX_LEN
;

66 
	`IWL_ERR
(
å™s
, "iwlwifiÅransaction failed, dumpingÑegisters\n");

69 
	`•rötf
(
¥efix
, "iwlwifò%s: ", 
	`pci_«me
(
pdev
));

70 
	`IWL_ERR
(
å™s
, "iwlwifi device configÑegisters:\n");

71 
i
 = 0, 
±r
 = 
buf
; i < 
PCI_DUMP_SIZE
; i += 4,Ötr++)

72 i‡(
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 
i
, 
±r
))

73 
îr_ªad
;

74 
	`¥öt_hex_dump
(
KERN_ERR
, 
¥efix
, 
DUMP_PREFIX_OFFSET
, 32, 4, 
buf
, 
i
, 0);

76 
	`IWL_ERR
(
å™s
, "iwlwifi device memory mappedÑegisters:\n");

77 
i
 = 0, 
±r
 = 
buf
; i < 
PCI_MEM_DUMP_SIZE
; i += 4,Ötr++)

78 *
±r
 = 
	`iwl_ªad32
(
å™s
, 
i
);

79 
	`¥öt_hex_dump
(
KERN_ERR
, 
¥efix
, 
DUMP_PREFIX_OFFSET
, 32, 4, 
buf
, 
i
, 0);

81 
pos
 = 
	`pci_föd_ext_ˇ∑bûôy
(
pdev
, 
PCI_EXT_CAP_ID_ERR
);

82 i‡(
pos
) {

83 
	`IWL_ERR
(
å™s
, "iwlwifi device AER capability structure:\n");

84 
i
 = 0, 
±r
 = 
buf
; i < 
PCI_ERR_ROOT_COMMAND
; i += 4,Ötr++)

85 i‡(
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 
pos
 + 
i
, 
±r
))

86 
îr_ªad
;

87 
	`¥öt_hex_dump
(
KERN_ERR
, 
¥efix
, 
DUMP_PREFIX_OFFSET
,

88 32, 4, 
buf
, 
i
, 0);

92 i‡(!
pdev
->
bus
->
£lf
)

93 
out
;

95 
pdev
 =Ödev->
bus
->
£lf
;

96 
	`•rötf
(
¥efix
, "iwlwifò%s: ", 
	`pci_«me
(
pdev
));

98 
	`IWL_ERR
(
å™s
, "iwlwifiÖarentÖort (%s) configÑegisters:\n",

99 
	`pci_«me
(
pdev
));

100 
i
 = 0, 
±r
 = 
buf
; i < 
PCI_PARENT_DUMP_SIZE
; i += 4,Ötr++)

101 i‡(
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 
i
, 
±r
))

102 
îr_ªad
;

103 
	`¥öt_hex_dump
(
KERN_ERR
, 
¥efix
, 
DUMP_PREFIX_OFFSET
, 32, 4, 
buf
, 
i
, 0);

106 
pos
 = 0;

107 
pdev
 = 
	`pcõ_föd_roŸ_p‹t
(pdev);

108 i‡(
pdev
)

109 
pos
 = 
	`pci_föd_ext_ˇ∑bûôy
(
pdev
, 
PCI_EXT_CAP_ID_ERR
);

110 i‡(
pos
) {

111 
	`IWL_ERR
(
å™s
, "iwlwifiÑootÖort (%s) AER cap structure:\n",

112 
	`pci_«me
(
pdev
));

113 
	`•rötf
(
¥efix
, "iwlwifò%s: ", 
	`pci_«me
(
pdev
));

114 
i
 = 0, 
±r
 = 
buf
; i <
PCI_ERR_ROOT_ERR_SRC
; i += 4,Ötr++)

115 i‡(
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 
pos
 + 
i
, 
±r
))

116 
îr_ªad
;

117 
	`¥öt_hex_dump
(
KERN_ERR
, 
¥efix
, 
DUMP_PREFIX_OFFSET
, 32,

118 4, 
buf
, 
i
, 0);

120 
out
;

122 
îr_ªad
:

123 
	`¥öt_hex_dump
(
KERN_ERR
, 
¥efix
, 
DUMP_PREFIX_OFFSET
, 32, 4, 
buf
, 
i
, 0);

124 
	`IWL_ERR
(
å™s
, "Ród faûedáà0x%X\n", 
i
);

125 
out
:

126 
å™s_pcõ
->
pcõ_dbg_dum≥d_⁄˚
 = 1;

127 
	`k‰ì
(
buf
);

128 
	}
}

130 
	$iwl_å™s_pcõ_sw_ª£t
(
iwl_å™s
 *
å™s
,

131 
boﬁ
 
ªèke_ow√rshù
)

134 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

135 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

136 
CSR_GP_CNTRL_REG_FLAG_SW_RESET
);

137 
	`u¶ìp_ønge
(10000, 20000);

139 
	`iwl_£t_bô
(
å™s
, 
CSR_RESET
,

140 
CSR_RESET_REG_FLAG_SW_RESET
);

141 
	`u¶ìp_ønge
(5000, 6000);

144 i‡(
ªèke_ow√rshù
)

145  
	`iwl_pcõ_¥ï¨e_ˇrd_hw
(
å™s
);

148 
	}
}

150 
	$iwl_pcõ_‰ì_fw_m⁄ô‹
(
iwl_å™s
 *
å™s
)

152 
iwl_døm_d©a
 *
fw_m⁄
 = &
å™s
->
dbg
.fw_mon;

154 i‡(!
fw_m⁄
->
size
)

157 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
fw_m⁄
->
size
, fw_m⁄->
block
,

158 
fw_m⁄
->
physiˇl
);

160 
fw_m⁄
->
block
 = 
NULL
;

161 
fw_m⁄
->
physiˇl
 = 0;

162 
fw_m⁄
->
size
 = 0;

163 
	}
}

165 
	$iwl_pcõ_Æloc_fw_m⁄ô‹_block
(
iwl_å™s
 *
å™s
,

166 
u8
 
max_powî
)

168 
iwl_døm_d©a
 *
fw_m⁄
 = &
å™s
->
dbg
.fw_mon;

169 *
block
 = 
NULL
;

170 
dma_addr_t
 
physiˇl
 = 0;

171 
u32
 
size
 = 0;

172 
u8
 
powî
;

174 i‡(
fw_m⁄
->
size
) {

175 
	`mem£t
(
fw_m⁄
->
block
, 0, fw_m⁄->
size
);

180 
powî
 = 
max_powî
;Öower >= 11;Öower--) {

181 
size
 = 
	`BIT
(
powî
);

182 
block
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
size
, &
physiˇl
,

183 
GFP_KERNEL
 | 
__GFP_NOWARN
);

184 i‡(!
block
)

187 
	`IWL_INFO
(
å™s
,

189 
size
);

193 i‡(
	`WARN_ON_ONCE
(!
block
))

196 i‡(
powî
 !
max_powî
)

197 
	`IWL_ERR
(
å™s
,

199 ()
	`BIT
(
powî
 - 10),

200 ()
	`BIT
(
max_powî
 - 10));

202 
fw_m⁄
->
block
 = block;

203 
fw_m⁄
->
physiˇl
 =Öhysical;

204 
fw_m⁄
->
size
 = size;

205 
	}
}

207 
	$iwl_pcõ_Æloc_fw_m⁄ô‹
(
iwl_å™s
 *
å™s
, 
u8
 
max_powî
)

209 i‡(!
max_powî
) {

211 
max_powî
 = 26;

213 
max_powî
 += 11;

216 i‡(
	`WARN
(
max_powî
 > 26,

218 
max_powî
))

221 
	`iwl_pcõ_Æloc_fw_m⁄ô‹_block
(
å™s
, 
max_powî
);

222 
	}
}

224 
u32
 
	$iwl_å™s_pcõ_ªad_shr
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
)

226 
	`iwl_wrôe32
(
å™s
, 
HEEP_CTRL_WRD_PCIEX_CTRL_REG
,

227 ((
ªg
 & 0x0000ffff) | (2 << 28)));

228  
	`iwl_ªad32
(
å™s
, 
HEEP_CTRL_WRD_PCIEX_DATA_REG
);

229 
	}
}

231 
	$iwl_å™s_pcõ_wrôe_shr
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
, u32 
vÆ
)

233 
	`iwl_wrôe32
(
å™s
, 
HEEP_CTRL_WRD_PCIEX_DATA_REG
, 
vÆ
);

234 
	`iwl_wrôe32
(
å™s
, 
HEEP_CTRL_WRD_PCIEX_CTRL_REG
,

235 ((
ªg
 & 0x0000ffff) | (3 << 28)));

236 
	}
}

238 
	$iwl_pcõ_£t_pwr
(
iwl_å™s
 *
å™s
, 
boﬁ
 
vaux
)

240 i‡(
å™s
->
cfg
->
≠mg_nŸ_suµ‹ãd
)

243 i‡(
vaux
 && 
	`pci_pme_ˇ∑bÀ
(
	`to_pci_dev
(
å™s
->
dev
), 
PCI_D3cﬁd
))

244 
	`iwl_£t_bôs_mask_¥ph
(
å™s
, 
APMG_PS_CTRL_REG
,

245 
APMG_PS_CTRL_VAL_PWR_SRC_VAUX
,

246 ~
APMG_PS_CTRL_MSK_PWR_SRC
);

248 
	`iwl_£t_bôs_mask_¥ph
(
å™s
, 
APMG_PS_CTRL_REG
,

249 
APMG_PS_CTRL_VAL_PWR_SRC_VMAIN
,

250 ~
APMG_PS_CTRL_MSK_PWR_SRC
);

251 
	}
}

254 
	#PCI_CFG_RETRY_TIMEOUT
 0x041

	)

256 
	$iwl_pcõ_≠m_c⁄fig
(
iwl_å™s
 *
å™s
)

258 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

259 
u16
 
l˘l
;

260 
u16
 
ˇp
;

267 
	`iwl_£t_bô
(
å™s
, 
CSR_GIO_REG
, 
CSR_GIO_REG_VAL_L0S_DISABLED
);

269 
	`pcõ_ˇ∑bûôy_ªad_w‹d
(
å™s_pcõ
->
pci_dev
, 
PCI_EXP_LNKCTL
, &
l˘l
);

270 
å™s
->
pm_suµ‹t
 = !(
l˘l
 & 
PCI_EXP_LNKCTL_ASPM_L0S
);

272 
	`pcõ_ˇ∑bûôy_ªad_w‹d
(
å™s_pcõ
->
pci_dev
, 
PCI_EXP_DEVCTL2
, &
ˇp
);

273 
å™s
->
…r_íabÀd
 = 
ˇp
 & 
PCI_EXP_DEVCTL2_LTR_EN
;

274 
	`IWL_DEBUG_POWER
(
å™s
, "L1 %sabled - LTR %sabled\n",

275 (
l˘l
 & 
PCI_EXP_LNKCTL_ASPM_L1
) ? "En" : "Dis",

276 
å™s
->
…r_íabÀd
 ? "En" : "Dis");

277 
	}
}

284 
	$iwl_pcõ_≠m_öô
(
iwl_å™s
 *
å™s
)

286 
ªt
;

288 
	`IWL_DEBUG_INFO
(
å™s
, "Init card's basic functions\n");

296 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_8000
)

297 
	`iwl_£t_bô
(
å™s
, 
CSR_GIO_CHICKEN_BITS
,

298 
CSR_GIO_CHICKEN_BITS_REG_BIT_DIS_L0S_EXIT_TIMER
);

304 
	`iwl_£t_bô
(
å™s
, 
CSR_GIO_CHICKEN_BITS
,

305 
CSR_GIO_CHICKEN_BITS_REG_BIT_L1A_NO_L0S_RX
);

308 
	`iwl_£t_bô
(
å™s
, 
CSR_DBG_HPET_MEM_REG
, 
CSR_DBG_HPET_MEM_REG_VAL
);

314 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

315 
CSR_HW_IF_CONFIG_REG_BIT_HAP_WAKE_L1A
);

317 
	`iwl_pcõ_≠m_c⁄fig
(
å™s
);

320 i‡(
å™s
->
å™s_cfg
->
ba£_∑øms
->
∂l_cfg
)

321 
	`iwl_£t_bô
(
å™s
, 
CSR_ANA_PLL_CFG
, 
CSR50_ANA_PLL_CFG_VAL
);

323 
ªt
 = 
	`iwl_föish_nic_öô
(
å™s
);

324 i‡(
ªt
)

325  
ªt
;

327 i‡(
å™s
->
cfg
->
ho°_öãºu±_›î©i⁄_mode
) {

342 
	`iwl_ªad_¥ph
(
å™s
, 
OSC_CLK
);

343 
	`iwl_ªad_¥ph
(
å™s
, 
OSC_CLK
);

344 
	`iwl_£t_bôs_¥ph
(
å™s
, 
OSC_CLK
, 
OSC_CLK_FORCE_CONTROL
);

345 
	`iwl_ªad_¥ph
(
å™s
, 
OSC_CLK
);

346 
	`iwl_ªad_¥ph
(
å™s
, 
OSC_CLK
);

356 i‡(!
å™s
->
cfg
->
≠mg_nŸ_suµ‹ãd
) {

357 
	`iwl_wrôe_¥ph
(
å™s
, 
APMG_CLK_EN_REG
,

358 
APMG_CLK_VAL_DMA_CLK_RQT
);

359 
	`udñay
(20);

362 
	`iwl_£t_bôs_¥ph
(
å™s
, 
APMG_PCIDEV_STT_REG
,

363 
APMG_PCIDEV_STT_VAL_L1_ACT_DIS
);

366 
	`iwl_wrôe_¥ph
(
å™s
, 
APMG_RTC_INT_STT_REG
,

367 
APMG_RTC_INT_STT_RFKILL
);

370 
	`£t_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
);

373 
	}
}

382 
	$iwl_pcõ_≠m_Õ_xèl_íabÀ
(
iwl_å™s
 *
å™s
)

384 
ªt
;

385 
u32
 
≠mg_gp1_ªg
;

386 
u32
 
≠mg_xèl_cfg_ªg
;

387 
u32
 
dl_cfg_ªg
;

390 
	`__iwl_å™s_pcõ_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

391 
CSR_GP_CNTRL_REG_FLAG_XTAL_ON
);

393 
ªt
 = 
	`iwl_å™s_pcõ_sw_ª£t
(
å™s
, 
åue
);

395 i‡(!
ªt
)

396 
ªt
 = 
	`iwl_föish_nic_öô
(
å™s
);

398 i‡(
	`WARN_ON
(
ªt
)) {

400 
	`__iwl_å™s_pcõ_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

401 
CSR_GP_CNTRL_REG_FLAG_XTAL_ON
);

409 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
APMG_PCIDEV_STT_REG
,

410 
APMG_PCIDEV_STT_VAL_PERSIST_DIS
);

416 
≠mg_xèl_cfg_ªg
 = 
	`iwl_å™s_pcõ_ªad_shr
(
å™s
,

417 
SHR_APMG_XTAL_CFG_REG
);

418 
	`iwl_å™s_pcõ_wrôe_shr
(
å™s
, 
SHR_APMG_XTAL_CFG_REG
,

419 
≠mg_xèl_cfg_ªg
 |

420 
SHR_APMG_XTAL_CFG_XTAL_ON_REQ
);

422 
ªt
 = 
	`iwl_å™s_pcõ_sw_ª£t
(
å™s
, 
åue
);

423 i‡(
ªt
)

424 
	`IWL_ERR
(
å™s
,

428 
≠mg_gp1_ªg
 = 
	`iwl_å™s_pcõ_ªad_shr
(
å™s
, 
SHR_APMG_GP1_REG
);

429 
	`iwl_å™s_pcõ_wrôe_shr
(
å™s
, 
SHR_APMG_GP1_REG
, 
≠mg_gp1_ªg
 |

430 
SHR_APMG_GP1_WF_XTAL_LP_EN
 |

431 
SHR_APMG_GP1_CHICKEN_BIT_SELECT
);

434 
dl_cfg_ªg
 = 
	`iwl_å™s_pcõ_ªad_shr
(
å™s
, 
SHR_APMG_DL_CFG_REG
);

435 
	`iwl_å™s_pcõ_wrôe_shr
(
å™s
, 
SHR_APMG_DL_CFG_REG
, 
dl_cfg_ªg
 &

436 ~
SHR_APMG_DL_CFG_DL_CLOCK_POWER_UP
);

442 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

443 
CSR_HW_IF_CONFIG_REG_PERSIST_MODE
);

449 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
, 
CSR_GP_CNTRL_REG_FLAG_INIT_DONE
);

452 
	`__iwl_å™s_pcõ_£t_bô
(
å™s
, 
CSR_MONITOR_CFG_REG
,

453 
CSR_MONITOR_XTAL_RESOURCES
);

456 
	`__iwl_å™s_pcõ_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

457 
CSR_GP_CNTRL_REG_FLAG_XTAL_ON
);

458 
	`udñay
(10);

461 
	`iwl_å™s_pcõ_wrôe_shr
(
å™s
, 
SHR_APMG_XTAL_CFG_REG
,

462 
≠mg_xèl_cfg_ªg
 &

463 ~
SHR_APMG_XTAL_CFG_XTAL_ON_REQ
);

464 
	}
}

466 
	$iwl_pcõ_≠m_°›_ma°î
(
iwl_å™s
 *
å™s
)

468 
ªt
;

472 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

473 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

474 
CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_REQ
);

476 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_GP_CNTRL
,

477 
CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_STATUS
,

478 
CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_STATUS
,

480 
	`u¶ìp_ønge
(10000, 20000);

482 
	`iwl_£t_bô
(
å™s
, 
CSR_RESET
, 
CSR_RESET_REG_FLAG_STOP_MASTER
);

484 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_RESET
,

485 
CSR_RESET_REG_FLAG_MASTER_DISABLED
,

486 
CSR_RESET_REG_FLAG_MASTER_DISABLED
, 100);

489 i‡(
ªt
 < 0)

490 
	`IWL_WARN
(
å™s
, "Master Disable Timed Out, 100 usec\n");

492 
	`IWL_DEBUG_INFO
(
å™s
, "stop master\n");

493 
	}
}

495 
	$iwl_pcõ_≠m_°›
(
iwl_å™s
 *
å™s
, 
boﬁ
 
›_mode_Àave
)

497 
	`IWL_DEBUG_INFO
(
å™s
, "Stop card,Öut inÜowÖower state\n");

499 i‡(
›_mode_Àave
) {

500 i‡(!
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

501 
	`iwl_pcõ_≠m_öô
(
å™s
);

504 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_7000
)

505 
	`iwl_£t_bôs_¥ph
(
å™s
, 
APMG_PCIDEV_STT_REG
,

506 
APMG_PCIDEV_STT_VAL_WAKE_ME
);

507 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

508 
IWL_DEVICE_FAMILY_8000
) {

509 
	`iwl_£t_bô
(
å™s
, 
CSR_DBG_LINK_PWR_MGMT_REG
,

510 
CSR_RESET_LINK_PWR_MGMT_DISABLED
);

511 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

512 
CSR_HW_IF_CONFIG_REG_PREPARE
 |

513 
CSR_HW_IF_CONFIG_REG_ENABLE_PME
);

514 
	`mdñay
(1);

515 
	`iwl_˛ór_bô
(
å™s
, 
CSR_DBG_LINK_PWR_MGMT_REG
,

516 
CSR_RESET_LINK_PWR_MGMT_DISABLED
);

518 
	`mdñay
(5);

521 
	`˛ór_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
);

524 
	`iwl_pcõ_≠m_°›_ma°î
(
å™s
);

526 i‡(
å™s
->
cfg
->
Õ_xèl_w‹k¨ound
) {

527 
	`iwl_pcõ_≠m_Õ_xèl_íabÀ
(
å™s
);

531 
	`iwl_å™s_pcõ_sw_ª£t
(
å™s
, 
Ál£
);

537 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
, 
CSR_GP_CNTRL_REG_FLAG_INIT_DONE
);

538 
	}
}

540 
	$iwl_pcõ_nic_öô
(
iwl_å™s
 *
å™s
)

542 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

543 
ªt
;

546 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

547 
ªt
 = 
	`iwl_pcõ_≠m_öô
(
å™s
);

548 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

550 i‡(
ªt
)

551  
ªt
;

553 
	`iwl_pcõ_£t_pwr
(
å™s
, 
Ál£
);

555 
	`iwl_›_mode_nic_c⁄fig
(
å™s
->
›_mode
);

558 
ªt
 = 
	`iwl_pcõ_rx_öô
(
å™s
);

559 i‡(
ªt
)

560  
ªt
;

563 i‡(
	`iwl_pcõ_tx_öô
(
å™s
)) {

564 
	`iwl_pcõ_rx_‰ì
(
å™s
);

565  -
ENOMEM
;

568 i‡(
å™s
->
å™s_cfg
->
ba£_∑øms
->
shadow_ªg_íabÀ
) {

570 
	`iwl_£t_bô
(
å™s
, 
CSR_MAC_SHADOW_REG_CTRL
, 0x800FFFFF);

571 
	`IWL_DEBUG_INFO
(
å™s
, "Enabling shadowÑegisters in device\n");

575 
	}
}

577 
	#HW_READY_TIMEOUT
 (50)

	)

580 
	$iwl_pcõ_£t_hw_ªady
(
iwl_å™s
 *
å™s
)

582 
ªt
;

584 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

585 
CSR_HW_IF_CONFIG_REG_BIT_NIC_READY
);

588 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

589 
CSR_HW_IF_CONFIG_REG_BIT_NIC_READY
,

590 
CSR_HW_IF_CONFIG_REG_BIT_NIC_READY
,

591 
HW_READY_TIMEOUT
);

593 i‡(
ªt
 >= 0)

594 
	`iwl_£t_bô
(
å™s
, 
CSR_MBOX_SET_REG
, 
CSR_MBOX_SET_REG_OS_ALIVE
);

596 
	`IWL_DEBUG_INFO
(
å™s
, "h¨dw¨e%†ªady\n", 
ªt
 < 0 ? "Çot" : "");

597  
ªt
;

598 
	}
}

601 
	$iwl_pcõ_¥ï¨e_ˇrd_hw
(
iwl_å™s
 *
å™s
)

603 
ªt
;

604 
ôî
;

606 
	`IWL_DEBUG_INFO
(
å™s
, "iwl_trans_prepare_card_hwÉnter\n");

608 
ªt
 = 
	`iwl_pcõ_£t_hw_ªady
(
å™s
);

610 i‡(
ªt
 >= 0) {

611 
å™s
->
csme_own
 = 
Ál£
;

615 
	`iwl_£t_bô
(
å™s
, 
CSR_DBG_LINK_PWR_MGMT_REG
,

616 
CSR_RESET_LINK_PWR_MGMT_DISABLED
);

617 
	`u¶ìp_ønge
(1000, 2000);

619 
ôî
 = 0; iter < 10; iter++) {

620 
t
 = 0;

623 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

624 
CSR_HW_IF_CONFIG_REG_PREPARE
);

627 
ªt
 = 
	`iwl_pcõ_£t_hw_ªady
(
å™s
);

628 i‡(
ªt
 >= 0) {

629 
å™s
->
csme_own
 = 
Ál£
;

633 i‡(
	`iwl_mei_is_c⁄√˘ed
()) {

634 
	`IWL_DEBUG_INFO
(
å™s
,

636 
å™s
->
csme_own
 = 
åue
;

637 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 !=

638 
IWL_DEVICE_FAMILY_9000
)

639 
	`IWL_ERR
(
å™s
,

642  -
EBUSY
;

645 
	`u¶ìp_ønge
(200, 1000);

646 
t
 += 200;

647 } 
t
 < 150000);

648 
	`m¶ìp
(25);

651 
	`IWL_ERR
(
å™s
, "Couldn'tÖrepareÅhe card\n");

653  
ªt
;

654 
	}
}

659 
	$iwl_pcõ_lﬂd_fúmw¨e_chunk_fh
(
iwl_å™s
 *
å™s
,

660 
u32
 
d°_addr
, 
dma_addr_t
 
phy_addr
,

661 
u32
 
byã_˙t
)

663 
	`iwl_wrôe32
(
å™s
, 
	`FH_TCSR_CHNL_TX_CONFIG_REG
(
FH_SRVC_CHNL
),

664 
FH_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_PAUSE
);

666 
	`iwl_wrôe32
(
å™s
, 
	`FH_SRVC_CHNL_SRAM_ADDR_REG
(
FH_SRVC_CHNL
),

667 
d°_addr
);

669 
	`iwl_wrôe32
(
å™s
, 
	`FH_TFDIB_CTRL0_REG
(
FH_SRVC_CHNL
),

670 
phy_addr
 & 
FH_MEM_TFDIB_DRAM_ADDR_LSB_MSK
);

672 
	`iwl_wrôe32
(
å™s
, 
	`FH_TFDIB_CTRL1_REG
(
FH_SRVC_CHNL
),

673 (
	`iwl_gë_dma_hi_addr
(
phy_addr
)

674 << 
FH_MEM_TFDIB_REG1_ADDR_BITSHIFT
Ë| 
byã_˙t
);

676 
	`iwl_wrôe32
(
å™s
, 
	`FH_TCSR_CHNL_TX_BUF_STS_REG
(
FH_SRVC_CHNL
),

677 
	`BIT
(
FH_TCSR_CHNL_TX_BUF_STS_REG_POS_TB_NUM
) |

678 
	`BIT
(
FH_TCSR_CHNL_TX_BUF_STS_REG_POS_TB_IDX
) |

679 
FH_TCSR_CHNL_TX_BUF_STS_REG_VAL_TFDB_VALID
);

681 
	`iwl_wrôe32
(
å™s
, 
	`FH_TCSR_CHNL_TX_CONFIG_REG
(
FH_SRVC_CHNL
),

682 
FH_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_ENABLE
 |

683 
FH_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_DISABLE
 |

684 
FH_TCSR_TX_CONFIG_REG_VAL_CIRQ_HOST_ENDTFD
);

685 
	}
}

687 
	$iwl_pcõ_lﬂd_fúmw¨e_chunk
(
iwl_å™s
 *
å™s
,

688 
u32
 
d°_addr
, 
dma_addr_t
 
phy_addr
,

689 
u32
 
byã_˙t
)

691 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

692 
ªt
;

694 
å™s_pcõ
->
ucode_wrôe_com∂ëe
 = 
Ál£
;

696 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

697  -
EIO
;

699 
	`iwl_pcõ_lﬂd_fúmw¨e_chunk_fh
(
å™s
, 
d°_addr
, 
phy_addr
,

700 
byã_˙t
);

701 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

703 
ªt
 = 
	`waô_evít_timeout
(
å™s_pcõ
->
ucode_wrôe_waôq
,

704 
å™s_pcõ
->
ucode_wrôe_com∂ëe
, 5 * 
HZ
);

705 i‡(!
ªt
) {

706 
	`IWL_ERR
(
å™s
, "FailedÅoÜoad firmware chunk!\n");

707 
	`iwl_å™s_pcõ_dump_ªgs
(
å™s
);

708  -
ETIMEDOUT
;

712 
	}
}

714 
	$iwl_pcõ_lﬂd_£˘i⁄
(
iwl_å™s
 *
å™s
, 
u8
 
£˘i⁄_num
,

715 c⁄° 
fw_desc
 *
£˘i⁄
)

717 
u8
 *
v_addr
;

718 
dma_addr_t
 
p_addr
;

719 
u32
 
off£t
, 
chunk_sz
 = 
	`mö_t
(u32, 
FH_MEM_TB_MAX_LENGTH
, 
£˘i⁄
->
Àn
);

720 
ªt
 = 0;

722 
	`IWL_DEBUG_FW
(
å™s
, "[%d] uCode section beingÜoaded...\n",

723 
£˘i⁄_num
);

725 
v_addr
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
chunk_sz
, &
p_addr
,

726 
GFP_KERNEL
 | 
__GFP_NOWARN
);

727 i‡(!
v_addr
) {

728 
	`IWL_DEBUG_INFO
(
å™s
, "Falling backÅo small chunks of DMA\n");

729 
chunk_sz
 = 
PAGE_SIZE
;

730 
v_addr
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
chunk_sz
,

731 &
p_addr
, 
GFP_KERNEL
);

732 i‡(!
v_addr
)

733  -
ENOMEM
;

736 
off£t
 = 0; off£à< 
£˘i⁄
->
Àn
; off£à+
chunk_sz
) {

737 
u32
 
c›y_size
, 
d°_addr
;

738 
boﬁ
 
exãnded_addr
 = 
Ál£
;

740 
c›y_size
 = 
	`mö_t
(
u32
, 
chunk_sz
, 
£˘i⁄
->
Àn
 - 
off£t
);

741 
d°_addr
 = 
£˘i⁄
->
off£t
 + offset;

743 i‡(
d°_addr
 >
IWL_FW_MEM_EXTENDED_START
 &&

744 
d°_addr
 <
IWL_FW_MEM_EXTENDED_END
)

745 
exãnded_addr
 = 
åue
;

747 i‡(
exãnded_addr
)

748 
	`iwl_£t_bôs_¥ph
(
å™s
, 
LMPM_CHICK
,

749 
LMPM_CHICK_EXTENDED_ADDR_SPACE
);

751 
	`mem˝y
(
v_addr
, (c⁄° 
u8
 *)
£˘i⁄
->
d©a
 + 
off£t
, 
c›y_size
);

752 
ªt
 = 
	`iwl_pcõ_lﬂd_fúmw¨e_chunk
(
å™s
, 
d°_addr
, 
p_addr
,

753 
c›y_size
);

755 i‡(
exãnded_addr
)

756 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
LMPM_CHICK
,

757 
LMPM_CHICK_EXTENDED_ADDR_SPACE
);

759 i‡(
ªt
) {

760 
	`IWL_ERR
(
å™s
,

762 
£˘i⁄_num
);

767 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
chunk_sz
, 
v_addr
, 
p_addr
);

768  
ªt
;

769 
	}
}

771 
	$iwl_pcõ_lﬂd_˝u_£˘i⁄s_8000
(
iwl_å™s
 *
å™s
,

772 c⁄° 
fw_img
 *
image
,

773 
˝u
,

774 *
fú°_ucode_£˘i⁄
)

776 
shi·_∑øm
;

777 
i
, 
ªt
 = 0, 
£c_num
 = 0x1;

778 
u32
 
vÆ
, 
œ°_ªad_idx
 = 0;

780 i‡(
˝u
 == 1) {

781 
shi·_∑øm
 = 0;

782 *
fú°_ucode_£˘i⁄
 = 0;

784 
shi·_∑øm
 = 16;

785 (*
fú°_ucode_£˘i⁄
)++;

788 
i
 = *
fú°_ucode_£˘i⁄
; i < 
image
->
num_£c
; i++) {

789 
œ°_ªad_idx
 = 
i
;

797 i‡(!
image
->
£c
[
i
].
d©a
 ||

798 
image
->
£c
[
i
].
off£t
 =
CPU1_CPU2_SEPARATOR_SECTION
 ||

799 
image
->
£c
[
i
].
off£t
 =
PAGING_SEPARATOR_SECTION
) {

800 
	`IWL_DEBUG_FW
(
å™s
,

802 
i
);

806 
ªt
 = 
	`iwl_pcõ_lﬂd_£˘i⁄
(
å™s
, 
i
, &
image
->
£c
[i]);

807 i‡(
ªt
)

808  
ªt
;

811 
vÆ
 = 
	`iwl_ªad_dúe˘32
(
å™s
, 
FH_UCODE_LOAD_STATUS
);

812 
vÆ
 = vÆ | (
£c_num
 << 
shi·_∑øm
);

813 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_UCODE_LOAD_STATUS
, 
vÆ
);

815 
£c_num
 = (sec_num << 1) | 0x1;

818 *
fú°_ucode_£˘i⁄
 = 
œ°_ªad_idx
;

820 
	`iwl_íabÀ_öãºu±s
(
å™s
);

822 i‡(
å™s
->
å™s_cfg
->
gí2
) {

823 i‡(
˝u
 == 1)

824 
	`iwl_wrôe_¥ph
(
å™s
, 
UREG_UCODE_LOAD_STATUS
,

827 
	`iwl_wrôe_¥ph
(
å™s
, 
UREG_UCODE_LOAD_STATUS
,

830 i‡(
˝u
 == 1)

831 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_UCODE_LOAD_STATUS
,

834 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_UCODE_LOAD_STATUS
,

839 
	}
}

841 
	$iwl_pcõ_lﬂd_˝u_£˘i⁄s
(
iwl_å™s
 *
å™s
,

842 c⁄° 
fw_img
 *
image
,

843 
˝u
,

844 *
fú°_ucode_£˘i⁄
)

846 
i
, 
ªt
 = 0;

847 
u32
 
œ°_ªad_idx
 = 0;

849 i‡(
˝u
 == 1)

850 *
fú°_ucode_£˘i⁄
 = 0;

852 (*
fú°_ucode_£˘i⁄
)++;

854 
i
 = *
fú°_ucode_£˘i⁄
; i < 
image
->
num_£c
; i++) {

855 
œ°_ªad_idx
 = 
i
;

863 i‡(!
image
->
£c
[
i
].
d©a
 ||

864 
image
->
£c
[
i
].
off£t
 =
CPU1_CPU2_SEPARATOR_SECTION
 ||

865 
image
->
£c
[
i
].
off£t
 =
PAGING_SEPARATOR_SECTION
) {

866 
	`IWL_DEBUG_FW
(
å™s
,

868 
i
);

872 
ªt
 = 
	`iwl_pcõ_lﬂd_£˘i⁄
(
å™s
, 
i
, &
image
->
£c
[i]);

873 i‡(
ªt
)

874  
ªt
;

877 *
fú°_ucode_£˘i⁄
 = 
œ°_ªad_idx
;

880 
	}
}

882 
	$iwl_pcõ_≠∂y_de°ö©i⁄_öi
(
iwl_å™s
 *
å™s
)

884 
iwl_fw_öi_Æloˇti⁄_id
 
Æloc_id
 = 
IWL_FW_INI_ALLOCATION_ID_DBGC1
;

885 
iwl_fw_öi_Æloˇti⁄_év
 *
fw_m⁄_cfg
 =

886 &
å™s
->
dbg
.
fw_m⁄_cfg
[
Æloc_id
];

887 
iwl_døm_d©a
 *
‰ag
;

889 i‡(!
	`iwl_å™s_dbg_öi_vÆid
(
å™s
))

892 i‡(
	`À32_to_˝u
(
fw_m⁄_cfg
->
buf_loˇti⁄
) ==

893 
IWL_FW_INI_LOCATION_SRAM_PATH
) {

894 
	`IWL_DEBUG_FW
(
å™s
, "WRT: Applying SMEM buffer destination\n");

896 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

897 
CSR_HW_IF_CONFIG_REG_BIT_MONITOR_SRAM
);

902 i‡(
	`À32_to_˝u
(
fw_m⁄_cfg
->
buf_loˇti⁄
) !=

903 
IWL_FW_INI_LOCATION_DRAM_PATH
 ||

904 !
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
].
num_‰ags
)

907 
‰ag
 = &
å™s
->
dbg
.
fw_m⁄_öi
[
Æloc_id
].
‰ags
[0];

909 
	`IWL_DEBUG_FW
(
å™s
, "WRT: Applying DRAM destination (alloc_id=%u)\n",

910 
Æloc_id
);

912 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
MON_BUFF_BASE_ADDR_VER2
,

913 
‰ag
->
physiˇl
 >> 
MON_BUFF_SHIFT_VER2
);

914 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
MON_BUFF_END_ADDR_VER2
,

915 (
‰ag
->
physiˇl
 + føg->
size
 - 256) >>

916 
MON_BUFF_SHIFT_VER2
);

917 
	}
}

919 
	$iwl_pcõ_≠∂y_de°ö©i⁄
(
iwl_å™s
 *
å™s
)

921 c⁄° 
iwl_fw_dbg_de°_év_v1
 *
de°
 = 
å™s
->
dbg
.
de°_év
;

922 c⁄° 
iwl_døm_d©a
 *
fw_m⁄
 = &
å™s
->
dbg
.fw_mon;

923 
i
;

925 i‡(
	`iwl_å™s_dbg_öi_vÆid
(
å™s
)) {

926 
	`iwl_pcõ_≠∂y_de°ö©i⁄_öi
(
å™s
);

930 
	`IWL_INFO
(
å™s
, "Applying debug destination %s\n",

931 
	`gë_fw_dbg_mode_°rög
(
de°
->
m⁄ô‹_mode
));

933 i‡(
de°
->
m⁄ô‹_mode
 =
EXTERNAL_MODE
)

934 
	`iwl_pcõ_Æloc_fw_m⁄ô‹
(
å™s
, 
de°
->
size_powî
);

936 
	`IWL_WARN
(
å™s
, "PCI should haveÉxternal buffer debug\n");

938 
i
 = 0; i < 
å™s
->
dbg
.
n_de°_ªg
; i++) {

939 
u32
 
addr
 = 
	`À32_to_˝u
(
de°
->
ªg_›s
[
i
].addr);

940 
u32
 
vÆ
 = 
	`À32_to_˝u
(
de°
->
ªg_›s
[
i
].val);

942 
de°
->
ªg_›s
[
i
].
›
) {

943 
CSR_ASSIGN
:

944 
	`iwl_wrôe32
(
å™s
, 
addr
, 
vÆ
);

946 
CSR_SETBIT
:

947 
	`iwl_£t_bô
(
å™s
, 
addr
, 
	`BIT
(
vÆ
));

949 
CSR_CLEARBIT
:

950 
	`iwl_˛ór_bô
(
å™s
, 
addr
, 
	`BIT
(
vÆ
));

952 
PRPH_ASSIGN
:

953 
	`iwl_wrôe_¥ph
(
å™s
, 
addr
, 
vÆ
);

955 
PRPH_SETBIT
:

956 
	`iwl_£t_bôs_¥ph
(
å™s
, 
addr
, 
	`BIT
(
vÆ
));

958 
PRPH_CLEARBIT
:

959 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
addr
, 
	`BIT
(
vÆ
));

961 
PRPH_BLOCKBIT
:

962 i‡(
	`iwl_ªad_¥ph
(
å™s
, 
addr
Ë& 
	`BIT
(
vÆ
)) {

963 
	`IWL_ERR
(
å™s
,

965 
vÆ
, 
addr
);

966 
m⁄ô‹
;

970 
	`IWL_ERR
(
å™s
, "FW debug - unknown OP %d\n",

971 
de°
->
ªg_›s
[
i
].
›
);

976 
m⁄ô‹
:

977 i‡(
de°
->
m⁄ô‹_mode
 =
EXTERNAL_MODE
 && 
fw_m⁄
->
size
) {

978 
	`iwl_wrôe_¥ph
(
å™s
, 
	`À32_to_˝u
(
de°
->
ba£_ªg
),

979 
fw_m⁄
->
physiˇl
 >> 
de°
->
ba£_shi·
);

980 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_8000
)

981 
	`iwl_wrôe_¥ph
(
å™s
, 
	`À32_to_˝u
(
de°
->
íd_ªg
),

982 (
fw_m⁄
->
physiˇl
 + fw_m⁄->
size
 -

983 256Ë>> 
de°
->
íd_shi·
);

985 
	`iwl_wrôe_¥ph
(
å™s
, 
	`À32_to_˝u
(
de°
->
íd_ªg
),

986 (
fw_m⁄
->
physiˇl
 + fw_m⁄->
size
) >>

987 
de°
->
íd_shi·
);

989 
	}
}

991 
	$iwl_pcõ_lﬂd_giví_ucode
(
iwl_å™s
 *
å™s
,

992 c⁄° 
fw_img
 *
image
)

994 
ªt
 = 0;

995 
fú°_ucode_£˘i⁄
;

997 
	`IWL_DEBUG_FW
(
å™s
, "working with %s CPU\n",

998 
image
->
is_duÆ_˝us
 ? "Dual" : "Single");

1001 
ªt
 = 
	`iwl_pcõ_lﬂd_˝u_£˘i⁄s
(
å™s
, 
image
, 1, &
fú°_ucode_£˘i⁄
);

1002 i‡(
ªt
)

1003  
ªt
;

1005 i‡(
image
->
is_duÆ_˝us
) {

1007 
	`iwl_wrôe_¥ph
(
å™s
,

1008 
LMPM_SECURE_UCODE_LOAD_CPU2_HDR_ADDR
,

1009 
LMPM_SECURE_CPU2_HDR_MEM_SPACE
);

1012 
ªt
 = 
	`iwl_pcõ_lﬂd_˝u_£˘i⁄s
(
å™s
, 
image
, 2,

1013 &
fú°_ucode_£˘i⁄
);

1014 i‡(
ªt
)

1015  
ªt
;

1018 i‡(
	`iwl_pcõ_dbg_⁄
(
å™s
))

1019 
	`iwl_pcõ_≠∂y_de°ö©i⁄
(
å™s
);

1021 
	`iwl_íabÀ_öãºu±s
(
å™s
);

1024 
	`iwl_wrôe32
(
å™s
, 
CSR_RESET
, 0);

1027 
	}
}

1029 
	$iwl_pcõ_lﬂd_giví_ucode_8000
(
iwl_å™s
 *
å™s
,

1030 c⁄° 
fw_img
 *
image
)

1032 
ªt
 = 0;

1033 
fú°_ucode_£˘i⁄
;

1035 
	`IWL_DEBUG_FW
(
å™s
, "working with %s CPU\n",

1036 
image
->
is_duÆ_˝us
 ? "Dual" : "Single");

1038 i‡(
	`iwl_pcõ_dbg_⁄
(
å™s
))

1039 
	`iwl_pcõ_≠∂y_de°ö©i⁄
(
å™s
);

1041 
	`IWL_DEBUG_POWER
(
å™s
, "Original WFPM value = 0x%08X\n",

1042 
	`iwl_ªad_¥ph
(
å™s
, 
WFPM_GP2
));

1049 
	`iwl_wrôe_¥ph
(
å™s
, 
WFPM_GP2
, 0x01010101);

1053 
	`iwl_wrôe_¥ph
(
å™s
, 
RELEASE_CPU_RESET
, 
RELEASE_CPU_RESET_BIT
);

1056 
ªt
 = 
	`iwl_pcõ_lﬂd_˝u_£˘i⁄s_8000
(
å™s
, 
image
, 1,

1057 &
fú°_ucode_£˘i⁄
);

1058 i‡(
ªt
)

1059  
ªt
;

1062  
	`iwl_pcõ_lﬂd_˝u_£˘i⁄s_8000
(
å™s
, 
image
, 2,

1063 &
fú°_ucode_£˘i⁄
);

1064 
	}
}

1066 
boﬁ
 
	$iwl_pcõ_check_hw_rf_kûl
(
iwl_å™s
 *
å™s
)

1068 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1069 
boﬁ
 
hw_rfkûl
 = 
	`iwl_is_rfkûl_£t
(
å™s
);

1070 
boﬁ
 
¥ev
 = 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1071 
boﬁ
 
ªp‹t
;

1073 i‡(
hw_rfkûl
) {

1074 
	`£t_bô
(
STATUS_RFKILL_HW
, &
å™s
->
°©us
);

1075 
	`£t_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1077 
	`˛ór_bô
(
STATUS_RFKILL_HW
, &
å™s
->
°©us
);

1078 i‡(
å™s_pcõ
->
›mode_down
)

1079 
	`˛ór_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1082 
ªp‹t
 = 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1084 i‡(
¥ev
 !
ªp‹t
)

1085 
	`iwl_å™s_pcõ_rf_kûl
(
å™s
, 
ªp‹t
, 
Ál£
);

1087  
hw_rfkûl
;

1088 
	}
}

1090 
	siwl_ˇu£s_li°
 {

1091 
u16
 
	mmask_ªg
;

1092 
u8
 
	mbô
;

1093 
u8
 
	maddr
;

1096 
	#IWL_CAUSE
(
ªg
, 
mask
) \

1098 .
mask_ªg
 = 
ªg
, \

1099 .
bô
 = 
	`ûog2
(
mask
), \

1100 .
addr
 = 
	`ûog2
(
mask
) + \

1101 ((
ªg
Ë=
CSR_MSIX_FH_INT_MASK_AD
 ? -16 : \

1102 (
ªg
Ë=
CSR_MSIX_HW_INT_MASK_AD
 ? 16 : \

1104 }

	)

1106 c⁄° 
iwl_ˇu£s_li°
 
	gˇu£s_li°_comm⁄
[] = {

1107 
IWL_CAUSE
(
CSR_MSIX_FH_INT_MASK_AD
, 
MSIX_FH_INT_CAUSES_D2S_CH0_NUM
),

1108 
IWL_CAUSE
(
CSR_MSIX_FH_INT_MASK_AD
, 
MSIX_FH_INT_CAUSES_D2S_CH1_NUM
),

1109 
IWL_CAUSE
(
CSR_MSIX_FH_INT_MASK_AD
, 
MSIX_FH_INT_CAUSES_S2D
),

1110 
IWL_CAUSE
(
CSR_MSIX_FH_INT_MASK_AD
, 
MSIX_FH_INT_CAUSES_FH_ERR
),

1111 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_ALIVE
),

1112 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_WAKEUP
),

1113 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_RESET_DONE
),

1114 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_TOP_FATAL_ERR
),

1115 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_CT_KILL
),

1116 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_RF_KILL
),

1117 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_PERIODIC
),

1118 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_SCD
),

1119 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_FH_TX
),

1120 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_HW_ERR
),

1121 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_HAP
),

1124 c⁄° 
iwl_ˇu£s_li°
 
	gˇu£s_li°_¥e_bz
[] = {

1125 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_SW_ERR
),

1128 c⁄° 
iwl_ˇu£s_li°
 
	gˇu£s_li°_bz
[] = {

1129 
IWL_CAUSE
(
CSR_MSIX_HW_INT_MASK_AD
, 
MSIX_HW_INT_CAUSES_REG_SW_ERR_BZ
),

1132 
	$iwl_pcõ_m≠_li°
(
iwl_å™s
 *
å™s
,

1133 c⁄° 
iwl_ˇu£s_li°
 *
ˇu£s
,

1134 
¨r_size
, 
vÆ
)

1136 
i
;

1138 
i
 = 0; i < 
¨r_size
; i++) {

1139 
	`iwl_wrôe8
(
å™s
, 
	`CSR_MSIX_IVAR
(
ˇu£s
[
i
].
addr
), 
vÆ
);

1140 
	`iwl_˛ór_bô
(
å™s
, 
ˇu£s
[
i
].
mask_ªg
,

1141 
	`BIT
(
ˇu£s
[
i
].
bô
));

1143 
	}
}

1145 
	$iwl_pcõ_m≠_n⁄_rx_ˇu£s
(
iwl_å™s
 *
å™s
)

1147 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1148 
vÆ
 = 
å™s_pcõ
->
def_úq
 | 
MSIX_NON_AUTO_CLEAR_CAUSE
;

1154 
	`iwl_pcõ_m≠_li°
(
å™s
, 
ˇu£s_li°_comm⁄
,

1155 
	`ARRAY_SIZE
(
ˇu£s_li°_comm⁄
), 
vÆ
);

1156 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

1157 
	`iwl_pcõ_m≠_li°
(
å™s
, 
ˇu£s_li°_bz
,

1158 
	`ARRAY_SIZE
(
ˇu£s_li°_bz
), 
vÆ
);

1160 
	`iwl_pcõ_m≠_li°
(
å™s
, 
ˇu£s_li°_¥e_bz
,

1161 
	`ARRAY_SIZE
(
ˇu£s_li°_¥e_bz
), 
vÆ
);

1162 
	}
}

1164 
	$iwl_pcõ_m≠_rx_ˇu£s
(
iwl_å™s
 *
å™s
)

1166 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1167 
u32
 
off£t
 =

1168 
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_FIRST_RSS
 ? 1 : 0;

1169 
u32
 
vÆ
, 
idx
;

1177 
vÆ
 = 
	`BIT
(
	`MSIX_FH_INT_CAUSES_Q
(0));

1178 
idx
 = 1; idx < 
å™s
->
num_rx_queues
; idx++) {

1179 
	`iwl_wrôe8
(
å™s
, 
	`CSR_MSIX_RX_IVAR
(
idx
),

1180 
	`MSIX_FH_INT_CAUSES_Q
(
idx
 - 
off£t
));

1181 
vÆ
 |
	`BIT
(
	`MSIX_FH_INT_CAUSES_Q
(
idx
));

1183 
	`iwl_wrôe32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
, ~
vÆ
);

1185 
vÆ
 = 
	`MSIX_FH_INT_CAUSES_Q
(0);

1186 i‡(
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_NON_RX
)

1187 
vÆ
 |
MSIX_NON_AUTO_CLEAR_CAUSE
;

1188 
	`iwl_wrôe8
(
å™s
, 
	`CSR_MSIX_RX_IVAR
(0), 
vÆ
);

1190 i‡(
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_FIRST_RSS
)

1191 
	`iwl_wrôe8
(
å™s
, 
	`CSR_MSIX_RX_IVAR
(1), 
vÆ
);

1192 
	}
}

1194 
	$iwl_pcõ_c⁄f_msix_hw
(
iwl_å™s_pcõ
 *
å™s_pcõ
)

1196 
iwl_å™s
 *
å™s
 = 
å™s_pcõ
->trans;

1198 i‡(!
å™s_pcõ
->
msix_íabÀd
) {

1199 i‡(
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
 &&

1200 
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

1201 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_CHICK
,

1202 
UREG_CHICK_MSI_ENABLE
);

1210 i‡(
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
))

1211 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_CHICK
, 
UREG_CHICK_MSIX_ENABLE
);

1220 
	`iwl_pcõ_m≠_rx_ˇu£s
(
å™s
);

1222 
	`iwl_pcõ_m≠_n⁄_rx_ˇu£s
(
å™s
);

1223 
	}
}

1225 
	$iwl_pcõ_öô_msix
(
iwl_å™s_pcõ
 *
å™s_pcõ
)

1227 
iwl_å™s
 *
å™s
 = 
å™s_pcõ
->trans;

1229 
	`iwl_pcõ_c⁄f_msix_hw
(
å™s_pcõ
);

1231 i‡(!
å™s_pcõ
->
msix_íabÀd
)

1234 
å™s_pcõ
->
fh_öô_mask
 = ~
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_FH_INT_MASK_AD
);

1235 
å™s_pcõ
->
fh_mask
 =Åøns_pcõ->
fh_öô_mask
;

1236 
å™s_pcõ
->
hw_öô_mask
 = ~
	`iwl_ªad32
(
å™s
, 
CSR_MSIX_HW_INT_MASK_AD
);

1237 
å™s_pcõ
->
hw_mask
 =Åøns_pcõ->
hw_öô_mask
;

1238 
	}
}

1240 
	$_iwl_å™s_pcõ_°›_devi˚
(
iwl_å™s
 *
å™s
, 
boﬁ
 
‰om_úq
)

1242 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1244 
	`lockdï_as£π_hñd
(&
å™s_pcõ
->
muãx
);

1246 i‡(
å™s_pcõ
->
is_down
)

1249 
å™s_pcõ
->
is_down
 = 
åue
;

1252 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1255 
	`iwl_pcõ_dißbÀ_i˘
(
å™s
);

1264 i‡(
	`ã°_™d_˛ór_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
)) {

1265 
	`IWL_DEBUG_INFO
(
å™s
,

1267 i‡(!
‰om_úq
)

1268 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

1269 
	`iwl_pcõ_rx_«pi_sync
(
å™s
);

1270 
	`iwl_pcõ_tx_°›
(
å™s
);

1271 
	`iwl_pcõ_rx_°›
(
å™s
);

1274 i‡(!
å™s
->
cfg
->
≠mg_nŸ_suµ‹ãd
) {

1275 
	`iwl_wrôe_¥ph
(
å™s
, 
APMG_CLK_DIS_REG
,

1276 
APMG_CLK_VAL_DMA_CLK_RQT
);

1277 
	`udñay
(5);

1282 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

1283 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

1284 
CSR_GP_CNTRL_REG_FLAG_BZ_MAC_ACCESS_REQ
);

1286 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

1287 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

1290 
	`iwl_pcõ_≠m_°›
(
å™s
, 
Ál£
);

1293 
	`iwl_å™s_pcõ_sw_ª£t
(
å™s
, 
åue
);

1302 
	`iwl_pcõ_c⁄f_msix_hw
(
å™s_pcõ
);

1311 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1314 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

1315 
	`˛ór_bô
(
STATUS_INT_ENABLED
, &
å™s
->
°©us
);

1316 
	`˛ór_bô
(
STATUS_TPOWER_PMI
, &
å™s
->
°©us
);

1322 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

1323 
	}
}

1325 
	$iwl_pcõ_synchr⁄ize_úqs
(
iwl_å™s
 *
å™s
)

1327 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1329 i‡(
å™s_pcõ
->
msix_íabÀd
) {

1330 
i
;

1332 
i
 = 0; i < 
å™s_pcõ
->
Æloc_vecs
; i++)

1333 
	`synchr⁄ize_úq
(
å™s_pcõ
->
msix_íåõs
[
i
].
ve˘‹
);

1335 
	`synchr⁄ize_úq
(
å™s_pcõ
->
pci_dev
->
úq
);

1337 
	}
}

1339 
	$iwl_å™s_pcõ_°¨t_fw
(
iwl_å™s
 *
å™s
,

1340 c⁄° 
fw_img
 *
fw
, 
boﬁ
 
run_ö_rfkûl
)

1342 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1343 
boﬁ
 
hw_rfkûl
;

1344 
ªt
;

1347 i‡(
	`iwl_pcõ_¥ï¨e_ˇrd_hw
(
å™s
)) {

1348 
	`IWL_WARN
(
å™s
, "Exit HWÇotÑeady\n");

1349  -
EIO
;

1352 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

1354 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 0xFFFFFFFF);

1361 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1364 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

1366 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

1369 
hw_rfkûl
 = 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

1370 i‡(
hw_rfkûl
 && !
run_ö_rfkûl
) {

1371 
ªt
 = -
ERFKILL
;

1372 
out
;

1376 i‡(
å™s_pcõ
->
is_down
) {

1377 
	`IWL_WARN
(
å™s
,

1379 
ªt
 = -
EIO
;

1380 
out
;

1384 
	`iwl_wrôe32
(
å™s
, 
CSR_UCODE_DRV_GP1_CLR
, 
CSR_UCODE_SW_BIT_RFKILL
);

1385 
	`iwl_wrôe32
(
å™s
, 
CSR_UCODE_DRV_GP1_CLR
,

1386 
CSR_UCODE_DRV_GP1_BIT_CMD_BLOCKED
);

1389 
	`iwl_wrôe32
(
å™s
, 
CSR_INT
, 0xFFFFFFFF);

1391 
ªt
 = 
	`iwl_pcõ_nic_öô
(
å™s
);

1392 i‡(
ªt
) {

1393 
	`IWL_ERR
(
å™s
, "UnableÅo initÇic\n");

1394 
out
;

1404 
	`iwl_íabÀ_fw_lﬂd_öt
(
å™s
);

1407 
	`iwl_wrôe32
(
å™s
, 
CSR_UCODE_DRV_GP1_CLR
, 
CSR_UCODE_SW_BIT_RFKILL
);

1408 
	`iwl_wrôe32
(
å™s
, 
CSR_UCODE_DRV_GP1_CLR
, 
CSR_UCODE_SW_BIT_RFKILL
);

1411 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_8000
)

1412 
ªt
 = 
	`iwl_pcõ_lﬂd_giví_ucode_8000
(
å™s
, 
fw
);

1414 
ªt
 = 
	`iwl_pcõ_lﬂd_giví_ucode
(
å™s
, 
fw
);

1417 
hw_rfkûl
 = 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

1418 i‡(
hw_rfkûl
 && !
run_ö_rfkûl
)

1419 
ªt
 = -
ERFKILL
;

1421 
out
:

1422 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

1423  
ªt
;

1424 
	}
}

1426 
	$iwl_å™s_pcõ_fw_Æive
(
iwl_å™s
 *
å™s
, 
u32
 
scd_addr
)

1428 
	`iwl_pcõ_ª£t_i˘
(
å™s
);

1429 
	`iwl_pcõ_tx_°¨t
(
å™s
, 
scd_addr
);

1430 
	}
}

1432 
	$iwl_å™s_pcõ_h™dÀ_°›_rfkûl
(
iwl_å™s
 *
å™s
,

1433 
boﬁ
 
was_ö_rfkûl
)

1435 
boﬁ
 
hw_rfkûl
;

1449 
hw_rfkûl
 = 
	`iwl_is_rfkûl_£t
(
å™s
);

1450 i‡(
hw_rfkûl
) {

1451 
	`£t_bô
(
STATUS_RFKILL_HW
, &
å™s
->
°©us
);

1452 
	`£t_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1454 
	`˛ór_bô
(
STATUS_RFKILL_HW
, &
å™s
->
°©us
);

1455 
	`˛ór_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1457 i‡(
hw_rfkûl
 !
was_ö_rfkûl
)

1458 
	`iwl_å™s_pcõ_rf_kûl
(
å™s
, 
hw_rfkûl
, 
Ál£
);

1459 
	}
}

1461 
	$iwl_å™s_pcõ_°›_devi˚
(
iwl_å™s
 *
å™s
)

1463 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1464 
boﬁ
 
was_ö_rfkûl
;

1466 
	`iwl_›_mode_time_poöt
(
å™s
->
›_mode
,

1467 
IWL_FW_INI_TIME_POINT_HOST_DEVICE_DISABLE
,

1468 
NULL
);

1470 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

1471 
å™s_pcõ
->
›mode_down
 = 
åue
;

1472 
was_ö_rfkûl
 = 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
);

1473 
	`_iwl_å™s_pcõ_°›_devi˚
(
å™s
, 
Ál£
);

1474 
	`iwl_å™s_pcõ_h™dÀ_°›_rfkûl
(
å™s
, 
was_ö_rfkûl
);

1475 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

1476 
	}
}

1478 
	$iwl_å™s_pcõ_rf_kûl
(
iwl_å™s
 *
å™s
, 
boﬁ
 
°©e
, boﬁ 
‰om_úq
)

1480 
iwl_å™s_pcõ
 
__maybe_unu£d
 *
å™s_pcõ
 =

1481 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1483 
	`lockdï_as£π_hñd
(&
å™s_pcõ
->
muãx
);

1485 
	`IWL_WARN
(
å™s
, "reporting RF_KILL (radio %s)\n",

1486 
°©e
 ? "disabled" : "enabled");

1487 i‡(
	`iwl_›_mode_hw_rf_kûl
(
å™s
->
›_mode
, 
°©e
) &&

1488 !
	`WARN_ON
(
å™s
->
å™s_cfg
->
gí2
))

1489 
	`_iwl_å™s_pcõ_°›_devi˚
(
å™s
, 
‰om_úq
);

1490 
	}
}

1492 
	$iwl_pcõ_d3_com∂ëe_su•íd
(
iwl_å™s
 *
å™s
,

1493 
boﬁ
 
ã°
, boﬁ 
ª£t
)

1495 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1501 i‡(
ã°
)

1504 
	`iwl_pcõ_dißbÀ_i˘
(
å™s
);

1506 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

1508 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

1509 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

1510 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
, 
CSR_GP_CNTRL_REG_FLAG_INIT_DONE
);

1512 i‡(
ª£t
) {

1518 
	`iwl_å™s_pcõ_tx_ª£t
(
å™s
);

1521 
	`iwl_pcõ_£t_pwr
(
å™s
, 
åue
);

1522 
	}
}

1524 
	$iwl_pcõ_d3_h™dshake
(
iwl_å™s
 *
å™s
, 
boﬁ
 
su•íd
)

1526 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1527 
ªt
;

1529 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_AX210
)

1530 
	`iwl_wrôe_umac_¥ph
(
å™s
, 
UREG_DOORBELL_TO_ISR6
,

1531 
su•íd
 ? 
UREG_DOORBELL_TO_ISR6_SUSPEND
 :

1532 
UREG_DOORBELL_TO_ISR6_RESUME
);

1533 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

1534 
	`iwl_wrôe32
(
å™s
, 
CSR_IPC_SLEEP_CONTROL
,

1535 
su•íd
 ? 
CSR_IPC_SLEEP_CONTROL_SUSPEND
 :

1536 
CSR_IPC_SLEEP_CONTROL_RESUME
);

1540 
ªt
 = 
	`waô_evít_timeout
(
å™s_pcõ
->
sx_waôq
,

1541 
å™s_pcõ
->
sx_com∂ëe
, 2 * 
HZ
);

1544 
å™s_pcõ
->
sx_com∂ëe
 = 
Ál£
;

1546 i‡(!
ªt
) {

1547 
	`IWL_ERR
(
å™s
, "Timeout %s D3\n",

1548 
su•íd
 ? "entering" : "exiting");

1549  -
ETIMEDOUT
;

1553 
	}
}

1555 
	$iwl_å™s_pcõ_d3_su•íd
(
iwl_å™s
 *
å™s
, 
boﬁ
 
ã°
,

1556 
boﬁ
 
ª£t
)

1558 
ªt
;

1560 i‡(!
ª£t
)

1562 
	`iwl_£t_bô
(
å™s
, 
CSR_HW_IF_CONFIG_REG
,

1563 
CSR_HW_IF_CONFIG_REG_PERSIST_MODE
);

1565 
ªt
 = 
	`iwl_pcõ_d3_h™dshake
(
å™s
, 
åue
);

1566 i‡(
ªt
)

1567  
ªt
;

1569 
	`iwl_pcõ_d3_com∂ëe_su•íd
(
å™s
, 
ã°
, 
ª£t
);

1572 
	}
}

1574 
	$iwl_å™s_pcõ_d3_ªsume
(
iwl_å™s
 *
å™s
,

1575 
iwl_d3_°©us
 *
°©us
,

1576 
boﬁ
 
ã°
, boﬁ 
ª£t
)

1578 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1579 
u32
 
vÆ
;

1580 
ªt
;

1582 i‡(
ã°
) {

1583 
	`iwl_íabÀ_öãºu±s
(
å™s
);

1584 *
°©us
 = 
IWL_D3_STATUS_ALIVE
;

1585 
ªt
 = 0;

1586 
out
;

1589 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

1590 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

1592 
ªt
 = 
	`iwl_föish_nic_öô
(
å™s
);

1593 i‡(
ªt
)

1594  
ªt
;

1603 
	`iwl_pcõ_c⁄f_msix_hw
(
å™s_pcõ
);

1604 i‡(!
å™s_pcõ
->
msix_íabÀd
)

1605 
	`iwl_pcõ_ª£t_i˘
(
å™s
);

1606 
	`iwl_íabÀ_öãºu±s
(
å™s
);

1608 
	`iwl_pcõ_£t_pwr
(
å™s
, 
Ál£
);

1610 i‡(!
ª£t
) {

1611 
	`iwl_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

1612 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

1614 
	`iwl_å™s_pcõ_tx_ª£t
(
å™s
);

1616 
ªt
 = 
	`iwl_pcõ_rx_öô
(
å™s
);

1617 i‡(
ªt
) {

1618 
	`IWL_ERR
(
å™s
,

1620  
ªt
;

1624 
	`IWL_DEBUG_POWER
(
å™s
, "WFPM value uponÑesume = 0x%08X\n",

1625 
	`iwl_ªad_umac_¥ph
(
å™s
, 
WFPM_GP2
));

1627 
vÆ
 = 
	`iwl_ªad32
(
å™s
, 
CSR_RESET
);

1628 i‡(
vÆ
 & 
CSR_RESET_REG_FLAG_NEVO_RESET
)

1629 *
°©us
 = 
IWL_D3_STATUS_RESET
;

1631 *
°©us
 = 
IWL_D3_STATUS_ALIVE
;

1633 
out
:

1634 i‡(*
°©us
 =
IWL_D3_STATUS_ALIVE
)

1635 
ªt
 = 
	`iwl_pcõ_d3_h™dshake
(
å™s
, 
Ál£
);

1637  
ªt
;

1638 
	}
}

1641 
	$iwl_pcõ_£t_öãºu±_ˇ∑
(
pci_dev
 *
pdev
,

1642 
iwl_å™s
 *
å™s
,

1643 c⁄° 
iwl_cfg_å™s_∑øms
 *
cfg_å™s
)

1645 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1646 
max_úqs
, 
num_úqs
, 
i
, 
ªt
;

1647 
u16
 
pci_cmd
;

1648 
u32
 
max_rx_queues
 = 
IWL_MAX_RX_HW_QUEUES
;

1650 i‡(!
cfg_å™s
->
mq_rx_suµ‹ãd
)

1651 
íabÀ_msi
;

1653 i‡(
cfg_å™s
->
devi˚_Ámûy
 <
IWL_DEVICE_FAMILY_9000
)

1654 
max_rx_queues
 = 
IWL_9000_MAX_RX_HW_QUEUES
;

1656 
max_úqs
 = 
	`mö_t
(
u32
, 
	`num_⁄löe_˝us
(Ë+ 2, 
max_rx_queues
);

1657 
i
 = 0; i < 
max_úqs
; i++)

1658 
å™s_pcõ
->
msix_íåõs
[
i
].
íåy
 = i;

1660 
num_úqs
 = 
	`pci_íabÀ_msix_ønge
(
pdev
, 
å™s_pcõ
->
msix_íåõs
,

1661 
MSIX_MIN_INTERRUPT_VECTORS
,

1662 
max_úqs
);

1663 i‡(
num_úqs
 < 0) {

1664 
	`IWL_DEBUG_INFO
(
å™s
,

1666 
num_úqs
);

1667 
íabÀ_msi
;

1669 
å™s_pcõ
->
def_úq
 = (
num_úqs
 =
max_úqs
) ?Çum_irqs - 1 : 0;

1671 
	`IWL_DEBUG_INFO
(
å™s
,

1673 
num_úqs
);

1682 i‡(
num_úqs
 <
max_úqs
 - 2) {

1683 
å™s_pcõ
->
å™s
->
num_rx_queues
 = 
num_úqs
 + 1;

1684 
å™s_pcõ
->
sh¨ed_vec_mask
 = 
IWL_SHARED_IRQ_NON_RX
 |

1685 
IWL_SHARED_IRQ_FIRST_RSS
;

1686 } i‡(
num_úqs
 =
max_úqs
 - 1) {

1687 
å™s_pcõ
->
å™s
->
num_rx_queues
 = 
num_úqs
;

1688 
å™s_pcõ
->
sh¨ed_vec_mask
 = 
IWL_SHARED_IRQ_NON_RX
;

1690 
å™s_pcõ
->
å™s
->
num_rx_queues
 = 
num_úqs
 - 1;

1693 
	`IWL_DEBUG_INFO
(
å™s
,

1695 
å™s_pcõ
->
å™s
->
num_rx_queues
,Åøns_pcõ->
sh¨ed_vec_mask
);

1697 
	`WARN_ON
(
å™s_pcõ
->
å™s
->
num_rx_queues
 > 
IWL_MAX_RX_HW_QUEUES
);

1699 
å™s_pcõ
->
Æloc_vecs
 = 
num_úqs
;

1700 
å™s_pcõ
->
msix_íabÀd
 = 
åue
;

1703 
íabÀ_msi
:

1704 
ªt
 = 
	`pci_íabÀ_msi
(
pdev
);

1705 i‡(
ªt
) {

1706 
	`dev_îr
(&
pdev
->
dev
, "pci_íabÀ_msòÁûed - %d\n", 
ªt
);

1708 
	`pci_ªad_c⁄fig_w‹d
(
pdev
, 
PCI_COMMAND
, &
pci_cmd
);

1709 i‡(
pci_cmd
 & 
PCI_COMMAND_INTX_DISABLE
) {

1710 
pci_cmd
 &~
PCI_COMMAND_INTX_DISABLE
;

1711 
	`pci_wrôe_c⁄fig_w‹d
(
pdev
, 
PCI_COMMAND
, 
pci_cmd
);

1714 
	}
}

1716 
	$iwl_pcõ_úq_£t_afföôy
(
iwl_å™s
 *
å™s
)

1718 #i‡
	`deföed
(
CONFIG_SMP
)

1719 
ôî_rx_q
, 
i
, 
ªt
, 
˝u
, 
off£t
;

1720 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1722 
i
 = 
å™s_pcõ
->
sh¨ed_vec_mask
 & 
IWL_SHARED_IRQ_FIRST_RSS
 ? 0 : 1;

1723 
ôî_rx_q
 = 
å™s_pcõ
->
å™s
->
num_rx_queues
 - 1 + 
i
;

1724 
off£t
 = 1 + 
i
;

1725 ; 
i
 < 
ôî_rx_q
 ; i++) {

1730 
˝u
 = 
	`˝umask_√xt
(
i
 - 
off£t
, 
˝u_⁄löe_mask
);

1731 
	`˝umask_£t_˝u
(
˝u
, &
å™s_pcõ
->
afföôy_mask
[
i
]);

1732 
ªt
 = 
	`úq_£t_afföôy_höt
(
å™s_pcõ
->
msix_íåõs
[
i
].
ve˘‹
,

1733 &
å™s_pcõ
->
afföôy_mask
[
i
]);

1734 i‡(
ªt
)

1735 
	`IWL_ERR
(
å™s_pcõ
->
å™s
,

1737 
å™s_pcõ
->
msix_íåõs
[
i
].
ve˘‹
);

1740 
	}
}

1742 
	$iwl_pcõ_öô_msix_h™dÀr
(
pci_dev
 *
pdev
,

1743 
iwl_å™s_pcõ
 *
å™s_pcõ
)

1745 
i
;

1747 
i
 = 0; i < 
å™s_pcõ
->
Æloc_vecs
; i++) {

1748 
ªt
;

1749 
msix_íåy
 *msix_entry;

1750 c⁄° *
q«me
 = 
	`queue_«me
(&
pdev
->
dev
, 
å™s_pcõ
, 
i
);

1752 i‡(!
q«me
)

1753  -
ENOMEM
;

1755 
msix_íåy
 = &
å™s_pcõ
->
msix_íåõs
[
i
];

1756 
ªt
 = 
	`devm_ªque°_thªaded_úq
(&
pdev
->
dev
,

1757 
msix_íåy
->
ve˘‹
,

1758 
iwl_pcõ_msix_i§
,

1759 (
i
 =
å™s_pcõ
->
def_úq
) ?

1760 
iwl_pcõ_úq_msix_h™dÀr
 :

1761 
iwl_pcõ_úq_rx_msix_h™dÀr
,

1762 
IRQF_SHARED
,

1763 
q«me
,

1764 
msix_íåy
);

1765 i‡(
ªt
) {

1766 
	`IWL_ERR
(
å™s_pcõ
->
å™s
,

1767 "Eº‹áŒoˇtög IRQ %d\n", 
i
);

1769  
ªt
;

1772 
	`iwl_pcõ_úq_£t_afföôy
(
å™s_pcõ
->
å™s
);

1775 
	}
}

1777 
	$iwl_å™s_pcõ_˛ór_≥rsi°í˚_bô
(
iwl_å™s
 *
å™s
)

1779 
u32
 
hpm
, 
w¥Ÿ
;

1781 
å™s
->
å™s_cfg
->
devi˚_Ámûy
) {

1782 
IWL_DEVICE_FAMILY_9000
:

1783 
w¥Ÿ
 = 
PREG_PRPH_WPROT_9000
;

1785 
IWL_DEVICE_FAMILY_22000
:

1786 
w¥Ÿ
 = 
PREG_PRPH_WPROT_22000
;

1792 
hpm
 = 
	`iwl_ªad_umac_¥ph_no_gøb
(
å™s
, 
HPM_DEBUG
);

1793 i‡(!
	`iwl_å™s_is_hw_îr‹_vÆue
(
hpm
Ë&& (hpm & 
PERSISTENCE_BIT
)) {

1794 
u32
 
w¥Ÿ_vÆ
 = 
	`iwl_ªad_umac_¥ph_no_gøb
(
å™s
, 
w¥Ÿ
);

1796 i‡(
w¥Ÿ_vÆ
 & 
PREG_WFPM_ACCESS
) {

1797 
	`IWL_ERR
(
å™s
,

1799  -
EPERM
;

1801 
	`iwl_wrôe_umac_¥ph_no_gøb
(
å™s
, 
HPM_DEBUG
,

1802 
hpm
 & ~
PERSISTENCE_BIT
);

1806 
	}
}

1808 
	$iwl_pcõ_gí2_f‹˚_powî_g©ög
(
iwl_å™s
 *
å™s
)

1810 
ªt
;

1812 
ªt
 = 
	`iwl_föish_nic_öô
(
å™s
);

1813 i‡(
ªt
 < 0)

1814  
ªt
;

1816 
	`iwl_£t_bôs_¥ph
(
å™s
, 
HPM_HIPM_GEN_CFG
,

1817 
HPM_HIPM_GEN_CFG_CR_FORCE_ACTIVE
);

1818 
	`udñay
(20);

1819 
	`iwl_£t_bôs_¥ph
(
å™s
, 
HPM_HIPM_GEN_CFG
,

1820 
HPM_HIPM_GEN_CFG_CR_PG_EN
 |

1821 
HPM_HIPM_GEN_CFG_CR_SLP_EN
);

1822 
	`udñay
(20);

1823 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
HPM_HIPM_GEN_CFG
,

1824 
HPM_HIPM_GEN_CFG_CR_FORCE_ACTIVE
);

1826  
	`iwl_å™s_pcõ_sw_ª£t
(
å™s
, 
åue
);

1827 
	}
}

1829 
	$_iwl_å™s_pcõ_°¨t_hw
(
iwl_å™s
 *
å™s
)

1831 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1832 
îr
;

1834 
	`lockdï_as£π_hñd
(&
å™s_pcõ
->
muãx
);

1836 
îr
 = 
	`iwl_pcõ_¥ï¨e_ˇrd_hw
(
å™s
);

1837 i‡(
îr
) {

1838 
	`IWL_ERR
(
å™s
, "Eº‹ whûê¥ï¨ög HW: %d\n", 
îr
);

1839  
îr
;

1842 
îr
 = 
	`iwl_å™s_pcõ_˛ór_≥rsi°í˚_bô
(
å™s
);

1843 i‡(
îr
)

1844  
îr
;

1846 
îr
 = 
	`iwl_å™s_pcõ_sw_ª£t
(
å™s
, 
åue
);

1847 i‡(
îr
)

1848  
îr
;

1850 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_22000
 &&

1851 
å™s
->
å™s_cfg
->
öãgøãd
) {

1852 
îr
 = 
	`iwl_pcõ_gí2_f‹˚_powî_g©ög
(
å™s
);

1853 i‡(
îr
)

1854  
îr
;

1857 
îr
 = 
	`iwl_pcõ_≠m_öô
(
å™s
);

1858 i‡(
îr
)

1859  
îr
;

1861 
	`iwl_pcõ_öô_msix
(
å™s_pcõ
);

1864 
	`iwl_íabÀ_rfkûl_öt
(
å™s
);

1866 
å™s_pcõ
->
›mode_down
 = 
Ál£
;

1869 
å™s_pcõ
->
is_down
 = 
Ál£
;

1872 
	`iwl_pcõ_check_hw_rf_kûl
(
å™s
);

1875 
	}
}

1877 
	$iwl_å™s_pcõ_°¨t_hw
(
iwl_å™s
 *
å™s
)

1879 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1880 
ªt
;

1882 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

1883 
ªt
 = 
	`_iwl_å™s_pcõ_°¨t_hw
(
å™s
);

1884 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

1886  
ªt
;

1887 
	}
}

1889 
	$iwl_å™s_pcõ_›_mode_Àave
(
iwl_å™s
 *
å™s
)

1891 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1893 
	`muãx_lock
(&
å™s_pcõ
->
muãx
);

1896 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1898 
	`iwl_pcõ_≠m_°›
(
å™s
, 
åue
);

1900 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

1902 
	`iwl_pcõ_dißbÀ_i˘
(
å™s
);

1904 
	`muãx_u∆ock
(&
å™s_pcõ
->
muãx
);

1906 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

1907 
	}
}

1909 
	$iwl_å™s_pcõ_wrôe8
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, 
u8
 
vÆ
)

1911 
	`wrôeb
(
vÆ
, 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
)->
hw_ba£
 + 
ofs
);

1912 
	}
}

1914 
	$iwl_å™s_pcõ_wrôe32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
, u32 
vÆ
)

1916 
	`wrôñ
(
vÆ
, 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
)->
hw_ba£
 + 
ofs
);

1917 
	}
}

1919 
u32
 
	$iwl_å™s_pcõ_ªad32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
)

1921  
	`ªadl
(
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
)->
hw_ba£
 + 
ofs
);

1922 
	}
}

1924 
u32
 
	$iwl_å™s_pcõ_¥ph_msk
(
iwl_å™s
 *
å™s
)

1926 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

1930 
	}
}

1932 
u32
 
	$iwl_å™s_pcõ_ªad_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
)

1934 
u32
 
mask
 = 
	`iwl_å™s_pcõ_¥ph_msk
(
å™s
);

1936 
	`iwl_å™s_pcõ_wrôe32
(
å™s
, 
HBUS_TARG_PRPH_RADDR
,

1937 ((
ªg
 & 
mask
) | (3 << 24)));

1938  
	`iwl_å™s_pcõ_ªad32
(
å™s
, 
HBUS_TARG_PRPH_RDAT
);

1939 
	}
}

1941 
	$iwl_å™s_pcõ_wrôe_¥ph
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

1942 
u32
 
vÆ
)

1944 
u32
 
mask
 = 
	`iwl_å™s_pcõ_¥ph_msk
(
å™s
);

1946 
	`iwl_å™s_pcõ_wrôe32
(
å™s
, 
HBUS_TARG_PRPH_WADDR
,

1947 ((
addr
 & 
mask
) | (3 << 24)));

1948 
	`iwl_å™s_pcõ_wrôe32
(
å™s
, 
HBUS_TARG_PRPH_WDAT
, 
vÆ
);

1949 
	}
}

1951 
	$iwl_å™s_pcõ_c⁄figuª
(
iwl_å™s
 *
å™s
,

1952 c⁄° 
iwl_å™s_c⁄fig
 *
å™s_cfg
)

1954 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1957 
	`iwl_pcõ_‰ì_rbs_poﬁ
(
å™s
);

1959 
å™s
->
txqs
.
cmd
.
q_id
 = 
å™s_cfg
->
cmd_queue
;

1960 
å™s
->
txqs
.
cmd
.
fifo
 = 
å™s_cfg
->
cmd_fifo
;

1961 
å™s
->
txqs
.
cmd
.
wdg_timeout
 = 
å™s_cfg
->
cmd_q_wdg_timeout
;

1962 
å™s
->
txqs
.
∑ge_offs
 = 
å™s_cfg
->
cb_d©a_offs
;

1963 
å™s
->
txqs
.
dev_cmd_offs
 = 
å™s_cfg
->
cb_d©a_offs
 + (*);

1964 
å™s
->
txqs
.
queue_Æloc_cmd_vî
 = 
å™s_cfg
->queue_alloc_cmd_ver;

1966 i‡(
	`WARN_ON
(
å™s_cfg
->
n_no_ª˛aim_cmds
 > 
MAX_NO_RECLAIM_CMDS
))

1967 
å™s_pcõ
->
n_no_ª˛aim_cmds
 = 0;

1969 
å™s_pcõ
->
n_no_ª˛aim_cmds
 = 
å™s_cfg
->n_no_reclaim_cmds;

1970 i‡(
å™s_pcõ
->
n_no_ª˛aim_cmds
)

1971 
	`mem˝y
(
å™s_pcõ
->
no_ª˛aim_cmds
, 
å™s_cfg
->no_reclaim_cmds,

1972 
å™s_pcõ
->
n_no_ª˛aim_cmds
 * (
u8
));

1974 
å™s_pcõ
->
rx_buf_size
 = 
å™s_cfg
->rx_buf_size;

1975 
å™s_pcõ
->
rx_∑ge_‹dî
 =

1976 
	`iwl_å™s_gë_rb_size_‹dî
(
å™s_pcõ
->
rx_buf_size
);

1977 
å™s_pcõ
->
rx_buf_byãs
 =

1978 
	`iwl_å™s_gë_rb_size
(
å™s_pcõ
->
rx_buf_size
);

1979 
å™s_pcõ
->
suµ‹ãd_dma_mask
 = 
	`DMA_BIT_MASK
(12);

1980 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
)

1981 
å™s_pcõ
->
suµ‹ãd_dma_mask
 = 
	`DMA_BIT_MASK
(11);

1983 
å™s
->
txqs
.
bc_èbÀ_dw‹d
 = 
å™s_cfg
->bc_table_dword;

1984 
å™s_pcõ
->
scd_£t_a˘ive
 = 
å™s_cfg
->scd_set_active;

1986 
å™s
->
comm™d_groups
 = 
å™s_cfg
->command_groups;

1987 
å™s
->
comm™d_groups_size
 = 
å™s_cfg
->command_groups_size;

1994 i‡(
å™s_pcõ
->
«pi_dev
.
ªg_°©e
 !
NETREG_DUMMY
)

1995 
	`öô_dummy_√tdev
(&
å™s_pcõ
->
«pi_dev
);

1997 
å™s_pcõ
->
fw_ª£t_h™dshake
 = 
å™s_cfg
->fw_reset_handshake;

1998 
	}
}

2000 
	$iwl_å™s_pcõ_‰ì_≤vm_døm_ªgi⁄s
(
iwl_døm_ªgi⁄s
 *
døm_ªgi⁄s
,

2001 
devi˚
 *
dev
)

2003 
u8
 
i
;

2004 
iwl_døm_d©a
 *
desc_døm
 = &
døm_ªgi⁄s
->
¥ph_s¸©ch_mem_desc
;

2007 
i
 = 0; i < 
døm_ªgi⁄s
->
n_ªgi⁄s
; i++) {

2008 
	`dma_‰ì_cohîít
(
dev
, 
døm_ªgi⁄s
->
døms
[
i
].
size
,

2009 
døm_ªgi⁄s
->
døms
[
i
].
block
,

2010 
døm_ªgi⁄s
->
døms
[
i
].
physiˇl
);

2012 
døm_ªgi⁄s
->
n_ªgi⁄s
 = 0;

2015 i‡(
desc_døm
->
block
) {

2016 
	`dma_‰ì_cohîít
(
dev
, 
desc_døm
->
size
,

2017 
desc_døm
->
block
,

2018 
desc_døm
->
physiˇl
);

2020 
	`mem£t
(
desc_døm
, 0, (*desc_dram));

2021 
	}
}

2023 
	$iwl_pcõ_‰ì_övÆid_tx_cmd
(
iwl_å™s
 *
å™s
)

2025 
	`iwl_pcõ_‰ì_dma_±r
(
å™s
, &å™s->
övÆid_tx_cmd
);

2026 
	}
}

2028 
	$iwl_pcõ_Æloc_övÆid_tx_cmd
(
iwl_å™s
 *
å™s
)

2030 
iwl_cmd_hódî_wide
 
bad_cmd
 = {

2031 .
cmd
 = 
INVALID_WR_PTR_CMD
,

2032 .
group_id
 = 
DEBUG_GROUP
,

2033 .
£quí˚
 = 
	`˝u_to_À16
(0xffff),

2034 .
Àngth
 = 
	`˝u_to_À16
(0),

2035 .
vîsi⁄
 = 0,

2037 
ªt
;

2039 
ªt
 = 
	`iwl_pcõ_Æloc_dma_±r
(
å™s
, &å™s->
övÆid_tx_cmd
,

2040 (
bad_cmd
));

2041 i‡(
ªt
)

2042  
ªt
;

2043 
	`mem˝y
(
å™s
->
övÆid_tx_cmd
.
addr
, &
bad_cmd
, (bad_cmd));

2045 
	}
}

2047 
	$iwl_å™s_pcõ_‰ì
(
iwl_å™s
 *
å™s
)

2049 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2050 
i
;

2052 
	`iwl_pcõ_synchr⁄ize_úqs
(
å™s
);

2054 i‡(
å™s
->
å™s_cfg
->
gí2
)

2055 
	`iwl_txq_gí2_tx_‰ì
(
å™s
);

2057 
	`iwl_pcõ_tx_‰ì
(
å™s
);

2058 
	`iwl_pcõ_rx_‰ì
(
å™s
);

2060 i‡(
å™s_pcõ
->
rba
.
Æloc_wq
) {

2061 
	`de°roy_w‹kqueue
(
å™s_pcõ
->
rba
.
Æloc_wq
);

2062 
å™s_pcõ
->
rba
.
Æloc_wq
 = 
NULL
;

2065 i‡(
å™s_pcõ
->
msix_íabÀd
) {

2066 
i
 = 0; i < 
å™s_pcõ
->
Æloc_vecs
; i++) {

2067 
	`úq_£t_afföôy_höt
(

2068 
å™s_pcõ
->
msix_íåõs
[
i
].
ve˘‹
,

2069 
NULL
);

2072 
å™s_pcõ
->
msix_íabÀd
 = 
Ál£
;

2074 
	`iwl_pcõ_‰ì_i˘
(
å™s
);

2077 
	`iwl_pcõ_‰ì_övÆid_tx_cmd
(
å™s
);

2079 
	`iwl_pcõ_‰ì_fw_m⁄ô‹
(
å™s
);

2081 
	`iwl_å™s_pcõ_‰ì_≤vm_døm_ªgi⁄s
(&
å™s_pcõ
->
≤vm_d©a
,

2082 
å™s
->
dev
);

2083 
	`iwl_å™s_pcõ_‰ì_≤vm_døm_ªgi⁄s
(&
å™s_pcõ
->
ªdu˚d_èbÀs_d©a
,

2084 
å™s
->
dev
);

2086 
	`muãx_de°roy
(&
å™s_pcõ
->
muãx
);

2087 
	`iwl_å™s_‰ì
(
å™s
);

2088 
	}
}

2090 
	$iwl_å™s_pcõ_£t_pmi
(
iwl_å™s
 *
å™s
, 
boﬁ
 
°©e
)

2092 i‡(
°©e
)

2093 
	`£t_bô
(
STATUS_TPOWER_PMI
, &
å™s
->
°©us
);

2095 
	`˛ór_bô
(
STATUS_TPOWER_PMI
, &
å™s
->
°©us
);

2096 
	}
}

2098 
	siwl_å™s_pcõ_ªmovÆ
 {

2099 
pci_dev
 *
	mpdev
;

2100 
w‹k_°ru˘
 
	mw‹k
;

2101 
boﬁ
 
	mªsˇn
;

2104 
	$iwl_å™s_pcõ_ªmovÆ_wk
(
w‹k_°ru˘
 *
wk
)

2106 
iwl_å™s_pcõ_ªmovÆ
 *
ªmovÆ
 =

2107 
	`c⁄èöî_of
(
wk
, 
iwl_å™s_pcõ_ªmovÆ
, 
w‹k
);

2108 
pci_dev
 *
pdev
 = 
ªmovÆ
->pdev;

2109 *
¥›
[] = {"EVENT=INACCESSIBLE", 
NULL
};

2110 
pci_bus
 *
bus
;

2112 
	`pci_lock_ªsˇn_ªmove
();

2114 
bus
 = 
pdev
->bus;

2116 i‡(!
bus
)

2117 
out
;

2119 
	`dev_îr
(&
pdev
->
dev
, "Device gone -áttemptingÑemoval\n");

2121 
	`kobje˘_uevít_ív
(&
pdev
->
dev
.
kobj
, 
KOBJ_CHANGE
, 
¥›
);

2123 
	`pci_°›_™d_ªmove_bus_devi˚
(
pdev
);

2124 
	`pci_dev_put
(
pdev
);

2126 i‡(
ªmovÆ
->
ªsˇn
) {

2127 i‡(
bus
->
∑ª¡
)

2128 
bus
 = bus->
∑ª¡
;

2129 
	`pci_ªsˇn_bus
(
bus
);

2132 
out
:

2133 
	`pci_u∆ock_ªsˇn_ªmove
();

2135 
	`k‰ì
(
ªmovÆ
);

2136 
	`moduÀ_put
(
THIS_MODULE
);

2137 
	}
}

2139 
	$iwl_å™s_pcõ_ªmove
(
iwl_å™s
 *
å™s
, 
boﬁ
 
ªsˇn
)

2141 
iwl_å™s_pcõ_ªmovÆ
 *
ªmovÆ
;

2143 i‡(
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
å™s
->
°©us
))

2146 
	`IWL_ERR
(
å™s
, "Device gone - schedulingÑemoval!\n");

2147 
	`iwl_pcõ_dump_c§
(
å™s
);

2155 i‡(!
	`åy_moduÀ_gë
(
THIS_MODULE
)) {

2156 
	`IWL_ERR
(
å™s
,

2161 
ªmovÆ
 = 
	`kzÆloc
((*ªmovÆ), 
GFP_ATOMIC
);

2162 i‡(!
ªmovÆ
) {

2163 
	`moduÀ_put
(
THIS_MODULE
);

2170 
	`£t_bô
(
STATUS_TRANS_DEAD
, &
å™s
->
°©us
);

2172 
ªmovÆ
->
pdev
 = 
	`to_pci_dev
(
å™s
->
dev
);

2173 
ªmovÆ
->
ªsˇn
 =Ñescan;

2174 
	`INIT_WORK
(&
ªmovÆ
->
w‹k
, 
iwl_å™s_pcõ_ªmovÆ_wk
);

2175 
	`pci_dev_gë
(
ªmovÆ
->
pdev
);

2176 
	`scheduÀ_w‹k
(&
ªmovÆ
->
w‹k
);

2177 
	}
}

2178 
EXPORT_SYMBOL
(
iwl_å™s_pcõ_ªmove
);

2184 
boﬁ
 
	$__iwl_å™s_pcõ_gøb_nic_ac˚ss
(
iwl_å™s
 *
å™s
)

2186 
ªt
;

2187 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2188 
u32
 
wrôe
 = 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
;

2189 
u32
 
mask
 = 
CSR_GP_CNTRL_REG_FLAG_MAC_CLOCK_READY
 |

2190 
CSR_GP_CNTRL_REG_FLAG_GOING_TO_SLEEP
;

2191 
u32
 
pﬁl
 = 
CSR_GP_CNTRL_REG_VAL_MAC_ACCESS_EN
;

2193 i‡(
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
å™s
->
°©us
))

2194  
Ál£
;

2196 
	`•ö_lock
(&
å™s_pcõ
->
ªg_lock
);

2198 i‡(
å™s_pcõ
->
cmd_hﬁd_nic_awake
)

2199 
out
;

2201 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
) {

2202 
wrôe
 = 
CSR_GP_CNTRL_REG_FLAG_BZ_MAC_ACCESS_REQ
;

2203 
mask
 = 
CSR_GP_CNTRL_REG_FLAG_MAC_STATUS
;

2204 
pﬁl
 = 
CSR_GP_CNTRL_REG_FLAG_MAC_STATUS
;

2208 
	`__iwl_å™s_pcõ_£t_bô
(
å™s
, 
CSR_GP_CNTRL
, 
wrôe
);

2209 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_8000
)

2210 
	`udñay
(2);

2232 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
CSR_GP_CNTRL
, 
pﬁl
, 
mask
, 15000);

2233 i‡(
	`u∆ikñy
(
ªt
 < 0)) {

2234 
u32
 
˙ål
 = 
	`iwl_ªad32
(
å™s
, 
CSR_GP_CNTRL
);

2236 
	`WARN_ONCE
(1,

2238 
˙ål
);

2240 
	`iwl_å™s_pcõ_dump_ªgs
(
å™s
);

2242 i‡(
iwlwifi_mod_∑øms
.
ªmove_whí_g⁄e
 && 
˙ål
 == ~0U)

2243 
	`iwl_å™s_pcõ_ªmove
(
å™s
, 
Ál£
);

2245 
	`iwl_wrôe32
(
å™s
, 
CSR_RESET
,

2246 
CSR_RESET_REG_FLAG_FORCE_NMI
);

2248 
	`•ö_u∆ock
(&
å™s_pcõ
->
ªg_lock
);

2249  
Ál£
;

2252 
out
:

2257 
	`__ªÀa£
(&
å™s_pcõ
->
ªg_lock
);

2258  
åue
;

2259 
	}
}

2261 
boﬁ
 
	$iwl_å™s_pcõ_gøb_nic_ac˚ss
(
iwl_å™s
 *
å™s
)

2263 
boﬁ
 
ªt
;

2265 
	`loˇl_bh_dißbÀ
();

2266 
ªt
 = 
	`__iwl_å™s_pcõ_gøb_nic_ac˚ss
(
å™s
);

2267 i‡(
ªt
) {

2269  
ªt
;

2271 
	`loˇl_bh_íabÀ
();

2272  
Ál£
;

2273 
	}
}

2275 
	$iwl_å™s_pcõ_ªÀa£_nic_ac˚ss
(
iwl_å™s
 *
å™s
)

2277 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2279 
	`lockdï_as£π_hñd
(&
å™s_pcõ
->
ªg_lock
);

2285 
	`__acquúe
(&
å™s_pcõ
->
ªg_lock
);

2287 i‡(
å™s_pcõ
->
cmd_hﬁd_nic_awake
)

2288 
out
;

2289 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

2290 
	`__iwl_å™s_pcõ_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

2291 
CSR_GP_CNTRL_REG_FLAG_BZ_MAC_ACCESS_REQ
);

2293 
	`__iwl_å™s_pcõ_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

2294 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

2301 
out
:

2302 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
ªg_lock
);

2303 
	}
}

2305 
	$iwl_å™s_pcõ_ªad_mem
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

2306 *
buf
, 
dw‹ds
)

2308 
	#IWL_MAX_HW_ERRS
 5

	)

2309 
num_c⁄£c_hw_îr‹s
 = 0;

2310 
offs
 = 0;

2311 
u32
 *
vÆs
 = 
buf
;

2313 
offs
 < 
dw‹ds
) {

2315 
íd
 = 
jiffõs
 + 
HZ
 / 2;

2316 
boﬁ
 
ªsched
 = 
Ál£
;

2318 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

2319 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_MEM_RADDR
,

2320 
addr
 + 4 * 
offs
);

2322 
offs
 < 
dw‹ds
) {

2323 
vÆs
[
offs
] = 
	`iwl_ªad32
(
å™s
,

2324 
HBUS_TARG_MEM_RDAT
);

2326 i‡(
	`iwl_å™s_is_hw_îr‹_vÆue
(
vÆs
[
offs
]))

2327 
num_c⁄£c_hw_îr‹s
++;

2329 
num_c⁄£c_hw_îr‹s
 = 0;

2331 i‡(
num_c⁄£c_hw_îr‹s
 >
IWL_MAX_HW_ERRS
) {

2332 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

2333  -
EIO
;

2336 
offs
++;

2338 i‡(
	`time_a·î
(
jiffõs
, 
íd
)) {

2339 
ªsched
 = 
åue
;

2343 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

2345 i‡(
ªsched
)

2346 
	`c⁄d_ªsched
();

2348  -
EBUSY
;

2353 
	}
}

2355 
	$iwl_å™s_pcõ_wrôe_mem
(
iwl_å™s
 *
å™s
, 
u32
 
addr
,

2356 c⁄° *
buf
, 
dw‹ds
)

2358 
offs
, 
ªt
 = 0;

2359 c⁄° 
u32
 *
vÆs
 = 
buf
;

2361 i‡(
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
)) {

2362 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_MEM_WADDR
, 
addr
);

2363 
offs
 = 0; off†< 
dw‹ds
; offs++)

2364 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_MEM_WDAT
,

2365 
vÆs
 ? vÆs[
offs
] : 0);

2366 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

2368 
ªt
 = -
EBUSY
;

2370  
ªt
;

2371 
	}
}

2373 
	$iwl_å™s_pcõ_ªad_c⁄fig32
(
iwl_å™s
 *
å™s
, 
u32
 
ofs
,

2374 
u32
 *
vÆ
)

2376  
	`pci_ªad_c⁄fig_dw‹d
(
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
)->
pci_dev
,

2377 
ofs
, 
vÆ
);

2378 
	}
}

2380 
	#IWL_FLUSH_WAIT_MS
 2000

	)

2382 
	$iwl_å™s_pcõ_rxq_dma_d©a
(
iwl_å™s
 *
å™s
, 
queue
,

2383 
iwl_å™s_rxq_dma_d©a
 *
d©a
)

2385 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2387 i‡(
queue
 >
å™s
->
num_rx_queues
 || !
å™s_pcõ
->
rxq
)

2388  -
EINVAL
;

2390 
d©a
->
‰_bd_cb
 = 
å™s_pcõ
->
rxq
[
queue
].
bd_dma
;

2391 
d©a
->
urbd_°ts_wΩå
 = 
å™s_pcõ
->
rxq
[
queue
].
rb_°ts_dma
;

2392 
d©a
->
ur_bd_cb
 = 
å™s_pcõ
->
rxq
[
queue
].
u£d_bd_dma
;

2393 
d©a
->
‰_bd_wid
 = 0;

2396 
	}
}

2398 
	$iwl_å™s_pcõ_waô_txq_em±y
(
iwl_å™s
 *
å™s
, 
txq_idx
)

2400 
iwl_txq
 *
txq
;

2401 
now
 = 
jiffõs
;

2402 
boﬁ
 
ovîÊow_tx
;

2403 
u8
 
wr_±r
;

2406 i‡(
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
å™s
->
°©us
))

2407  -
ENODEV
;

2409 i‡(!
	`ã°_bô
(
txq_idx
, 
å™s
->
txqs
.
queue_u£d
))

2410  -
EINVAL
;

2412 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "Em±yög queuê%d...\n", 
txq_idx
);

2413 
txq
 = 
å™s
->
txqs
.txq[
txq_idx
];

2415 
	`•ö_lock_bh
(&
txq
->
lock
);

2416 
ovîÊow_tx
 = 
txq
->overflow_tx ||

2417 !
	`skb_queue_em±y
(&
txq
->
ovîÊow_q
);

2418 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

2420 
wr_±r
 = 
	`READ_ONCE
(
txq
->
wrôe_±r
);

2422 (
txq
->
ªad_±r
 !
	`READ_ONCE
—xq->
wrôe_±r
) ||

2423 
ovîÊow_tx
) &&

2424 !
	`time_a·î
(
jiffõs
,

2425 
now
 + 
	`m£cs_to_jiffõs
(
IWL_FLUSH_WAIT_MS
))) {

2426 
u8
 
wrôe_±r
 = 
	`READ_ONCE
(
txq
->write_ptr);

2433 i‡(
	`WARN_ONCE
(
wr_±r
 !
wrôe_±r
 && !
ovîÊow_tx
,

2435 
wr_±r
, 
wrôe_±r
))

2436  -
ETIMEDOUT
;

2437 
wr_±r
 = 
wrôe_±r
;

2439 
	`u¶ìp_ønge
(1000, 2000);

2441 
	`•ö_lock_bh
(&
txq
->
lock
);

2442 
ovîÊow_tx
 = 
txq
->overflow_tx ||

2443 !
	`skb_queue_em±y
(&
txq
->
ovîÊow_q
);

2444 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

2447 i‡(
txq
->
ªad_±r
 !txq->
wrôe_±r
) {

2448 
	`IWL_ERR
(
å™s
,

2449 "ÁûÅÿÊusháŒÅx fifÿqueue†Q %d\n", 
txq_idx
);

2450 
	`iwl_txq_log_scd_îr‹
(
å™s
, 
txq
);

2451  -
ETIMEDOUT
;

2454 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "Queuê%d i†nowÉm±y.\n", 
txq_idx
);

2457 
	}
}

2459 
	$iwl_å™s_pcõ_waô_txqs_em±y
(
iwl_å™s
 *
å™s
, 
u32
 
txq_bm
)

2461 
˙t
;

2462 
ªt
 = 0;

2465 
˙t
 = 0;

2466 
˙t
 < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

2467 
˙t
++) {

2469 i‡(
˙t
 =
å™s
->
txqs
.
cmd
.
q_id
)

2471 i‡(!
	`ã°_bô
(
˙t
, 
å™s
->
txqs
.
queue_u£d
))

2473 i‡(!(
	`BIT
(
˙t
Ë& 
txq_bm
))

2476 
ªt
 = 
	`iwl_å™s_pcõ_waô_txq_em±y
(
å™s
, 
˙t
);

2477 i‡(
ªt
)

2481  
ªt
;

2482 
	}
}

2484 
	$iwl_å™s_pcõ_£t_bôs_mask
(
iwl_å™s
 *
å™s
, 
u32
 
ªg
,

2485 
u32
 
mask
, u32 
vÆue
)

2487 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2489 
	`•ö_lock_bh
(&
å™s_pcõ
->
ªg_lock
);

2490 
	`__iwl_å™s_pcõ_£t_bôs_mask
(
å™s
, 
ªg
, 
mask
, 
vÆue
);

2491 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
ªg_lock
);

2492 
	}
}

2494 c⁄° *
	$gë_c§_°rög
(
cmd
)

2496 
	#IWL_CMD
(
x
Ëx:  #x

	)

2497 
cmd
) {

2498 
	`IWL_CMD
(
CSR_HW_IF_CONFIG_REG
);

2499 
	`IWL_CMD
(
CSR_INT_COALESCING
);

2500 
	`IWL_CMD
(
CSR_INT
);

2501 
	`IWL_CMD
(
CSR_INT_MASK
);

2502 
	`IWL_CMD
(
CSR_FH_INT_STATUS
);

2503 
	`IWL_CMD
(
CSR_GPIO_IN
);

2504 
	`IWL_CMD
(
CSR_RESET
);

2505 
	`IWL_CMD
(
CSR_GP_CNTRL
);

2506 
	`IWL_CMD
(
CSR_HW_REV
);

2507 
	`IWL_CMD
(
CSR_EEPROM_REG
);

2508 
	`IWL_CMD
(
CSR_EEPROM_GP
);

2509 
	`IWL_CMD
(
CSR_OTP_GP_REG
);

2510 
	`IWL_CMD
(
CSR_GIO_REG
);

2511 
	`IWL_CMD
(
CSR_GP_UCODE_REG
);

2512 
	`IWL_CMD
(
CSR_GP_DRIVER_REG
);

2513 
	`IWL_CMD
(
CSR_UCODE_DRV_GP1
);

2514 
	`IWL_CMD
(
CSR_UCODE_DRV_GP2
);

2515 
	`IWL_CMD
(
CSR_LED_REG
);

2516 
	`IWL_CMD
(
CSR_DRAM_INT_TBL_REG
);

2517 
	`IWL_CMD
(
CSR_GIO_CHICKEN_BITS
);

2518 
	`IWL_CMD
(
CSR_ANA_PLL_CFG
);

2519 
	`IWL_CMD
(
CSR_HW_REV_WA_REG
);

2520 
	`IWL_CMD
(
CSR_MONITOR_STATUS_REG
);

2521 
	`IWL_CMD
(
CSR_DBG_HPET_MEM_REG
);

2525 #unde‡
IWL_CMD


2526 
	}
}

2528 
	$iwl_pcõ_dump_c§
(
iwl_å™s
 *
å™s
)

2530 
i
;

2531 c⁄° 
u32
 
c§_tbl
[] = {

2532 
CSR_HW_IF_CONFIG_REG
,

2533 
CSR_INT_COALESCING
,

2534 
CSR_INT
,

2535 
CSR_INT_MASK
,

2536 
CSR_FH_INT_STATUS
,

2537 
CSR_GPIO_IN
,

2538 
CSR_RESET
,

2539 
CSR_GP_CNTRL
,

2540 
CSR_HW_REV
,

2541 
CSR_EEPROM_REG
,

2542 
CSR_EEPROM_GP
,

2543 
CSR_OTP_GP_REG
,

2544 
CSR_GIO_REG
,

2545 
CSR_GP_UCODE_REG
,

2546 
CSR_GP_DRIVER_REG
,

2547 
CSR_UCODE_DRV_GP1
,

2548 
CSR_UCODE_DRV_GP2
,

2549 
CSR_LED_REG
,

2550 
CSR_DRAM_INT_TBL_REG
,

2551 
CSR_GIO_CHICKEN_BITS
,

2552 
CSR_ANA_PLL_CFG
,

2553 
CSR_MONITOR_STATUS_REG
,

2554 
CSR_HW_REV_WA_REG
,

2555 
CSR_DBG_HPET_MEM_REG


2557 
	`IWL_ERR
(
å™s
, "CSR values:\n");

2558 
	`IWL_ERR
(
å™s
, "(2nd byte of CSR_INT_COALESCING is "

2560 
i
 = 0; i < 
	`ARRAY_SIZE
(
c§_tbl
); i++) {

2561 
	`IWL_ERR
(
å™s
, " %25s: 0X%08x\n",

2562 
	`gë_c§_°rög
(
c§_tbl
[
i
]),

2563 
	`iwl_ªad32
(
å™s
, 
c§_tbl
[
i
]));

2565 
	}
}

2567 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


2569 
	#DEBUGFS_ADD_FILE
(
«me
, 
∑ª¡
, 
mode
) do { \

2570 
	`debugfs_¸óã_fûe
(#«me, 
mode
, 
∑ª¡
, 
å™s
, \

2571 &
iwl_dbgfs_
##
«me
##
_›s
); \

2572 } 0)

	)

2575 
	#DEBUGFS_READ_FILE_OPS
(
«me
) \

2576 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

2577 .
ªad
 = 
iwl_dbgfs_
##
«me
##
_ªad
, \

2578 .
›í
 = 
sim∂e_›í
, \

2579 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

2580 };

	)

2582 
	#DEBUGFS_WRITE_FILE_OPS
(
«me
) \

2583 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

2584 .
wrôe
 = 
iwl_dbgfs_
##
«me
##
_wrôe
, \

2585 .
›í
 = 
sim∂e_›í
, \

2586 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

2587 };

	)

2589 
	#DEBUGFS_READ_WRITE_FILE_OPS
(
«me
) \

2590 c⁄° 
fûe_›î©i⁄s
 
iwl_dbgfs_
##
«me
##
_›s
 = { \

2591 .
wrôe
 = 
iwl_dbgfs_
##
«me
##
_wrôe
, \

2592 .
ªad
 = 
iwl_dbgfs_
##
«me
##
_ªad
, \

2593 .
›í
 = 
sim∂e_›í
, \

2594 .
Œ£ek
 = 
gíîic_fûe_Œ£ek
, \

2595 };

	)

2597 
	siwl_dbgfs_tx_queue_¥iv
 {

2598 
iwl_å™s
 *
	må™s
;

2601 
	siwl_dbgfs_tx_queue_°©e
 {

2602 
loff_t
 
	mpos
;

2605 *
	$iwl_dbgfs_tx_queue_£q_°¨t
(
£q_fûe
 *
£q
, 
loff_t
 *
pos
)

2607 
iwl_dbgfs_tx_queue_¥iv
 *
¥iv
 = 
£q
->
¥iv©e
;

2608 
iwl_dbgfs_tx_queue_°©e
 *
°©e
;

2610 i‡(*
pos
 >
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
)

2611  
NULL
;

2613 
°©e
 = 
	`kmÆloc
((*°©e), 
GFP_KERNEL
);

2614 i‡(!
°©e
)

2615  
NULL
;

2616 
°©e
->
pos
 = *pos;

2617  
°©e
;

2618 
	}
}

2620 *
	$iwl_dbgfs_tx_queue_£q_√xt
(
£q_fûe
 *
£q
,

2621 *
v
, 
loff_t
 *
pos
)

2623 
iwl_dbgfs_tx_queue_¥iv
 *
¥iv
 = 
£q
->
¥iv©e
;

2624 
iwl_dbgfs_tx_queue_°©e
 *
°©e
 = 
v
;

2626 *
pos
 = ++
°©e
->pos;

2628 i‡(*
pos
 >
¥iv
->
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
)

2629  
NULL
;

2631  
°©e
;

2632 
	}
}

2634 
	$iwl_dbgfs_tx_queue_£q_°›
(
£q_fûe
 *
£q
, *
v
)

2636 
	`k‰ì
(
v
);

2637 
	}
}

2639 
	$iwl_dbgfs_tx_queue_£q_show
(
£q_fûe
 *
£q
, *
v
)

2641 
iwl_dbgfs_tx_queue_¥iv
 *
¥iv
 = 
£q
->
¥iv©e
;

2642 
iwl_dbgfs_tx_queue_°©e
 *
°©e
 = 
v
;

2643 
iwl_å™s
 *
å™s
 = 
¥iv
->trans;

2644 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
°©e
->
pos
];

2646 
	`£q_¥ötf
(
£q
, "hwq %.3u: used=%d stopped=%d ",

2647 ()
°©e
->
pos
,

2648 !!
	`ã°_bô
(
°©e
->
pos
, 
å™s
->
txqs
.
queue_u£d
),

2649 !!
	`ã°_bô
(
°©e
->
pos
, 
å™s
->
txqs
.
queue_°›≥d
));

2650 i‡(
txq
)

2651 
	`£q_¥ötf
(
£q
,

2653 
txq
->
ªad_±r
,Åxq->
wrôe_±r
,

2654 
txq
->
√ed_upd©e
,Åxq->
‰ozí
,

2655 
txq
->
n_wödow
,Åxq->
ampdu
);

2657 
	`£q_puts
(
£q
, "(unallocated)");

2659 i‡(
°©e
->
pos
 =
å™s
->
txqs
.
cmd
.
q_id
)

2660 
	`£q_puts
(
£q
, " (HCMD)");

2661 
	`£q_puts
(
£q
, "\n");

2664 
	}
}

2666 c⁄° 
£q_›î©i⁄s
 
	giwl_dbgfs_tx_queue_£q_›s
 = {

2667 .
°¨t
 = 
iwl_dbgfs_tx_queue_£q_°¨t
,

2668 .
	g√xt
 = 
iwl_dbgfs_tx_queue_£q_√xt
,

2669 .
	g°›
 = 
iwl_dbgfs_tx_queue_£q_°›
,

2670 .
	gshow
 = 
iwl_dbgfs_tx_queue_£q_show
,

2673 
	$iwl_dbgfs_tx_queue_›í
(
öode
 *öode, 
fûe
 *
fûp
)

2675 
iwl_dbgfs_tx_queue_¥iv
 *
¥iv
;

2677 
¥iv
 = 
	`__£q_›í_¥iv©e
(
fûp
, &
iwl_dbgfs_tx_queue_£q_›s
,

2678 (*
¥iv
));

2680 i‡(!
¥iv
)

2681  -
ENOMEM
;

2683 
¥iv
->
å™s
 = 
öode
->
i_¥iv©e
;

2685 
	}
}

2687 
ssize_t
 
	$iwl_dbgfs_rx_queue_ªad
(
fûe
 *file,

2688 
__u£r
 *
u£r_buf
,

2689 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2691 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2692 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2693 *
buf
;

2694 
pos
 = 0, 
i
, 
ªt
;

2695 
size_t
 
bufsz
;

2697 
bufsz
 = (Ë* 121 * 
å™s
->
num_rx_queues
;

2699 i‡(!
å™s_pcõ
->
rxq
)

2700  -
EAGAIN
;

2702 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

2703 i‡(!
buf
)

2704  -
ENOMEM
;

2706 
i
 = 0; i < 
å™s
->
num_rx_queues
 && 
pos
 < 
bufsz
; i++) {

2707 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[
i
];

2709 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "queue#: %2d\n",

2710 
i
);

2711 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\tread: %u\n",

2712 
rxq
->
ªad
);

2713 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\twrite: %u\n",

2714 
rxq
->
wrôe
);

2715 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\twrite_actual: %u\n",

2716 
rxq
->
wrôe_a˘uÆ
);

2717 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\tneed_update: %2d\n",

2718 
rxq
->
√ed_upd©e
);

2719 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "\tfree_count: %u\n",

2720 
rxq
->
‰ì_cou¡
);

2721 i‡(
rxq
->
rb_°ts
) {

2722 
u32
 
r
 = 
	`iwl_gë_˛o£d_rb_°ts
(
å™s
, 
rxq
);

2723 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2724 "\t˛o£d_rb_num: %u\n", 
r
);

2726 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2730 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2731 
	`k‰ì
(
buf
);

2733  
ªt
;

2734 
	}
}

2736 
ssize_t
 
	$iwl_dbgfs_öãºu±_ªad
(
fûe
 *file,

2737 
__u£r
 *
u£r_buf
,

2738 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2740 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2741 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2742 
i§_°©i°ics
 *
i§_°©s
 = &
å™s_pcõ
->isr_stats;

2744 
pos
 = 0;

2745 *
buf
;

2746 
bufsz
 = 24 * 64;

2747 
ssize_t
 
ªt
;

2749 
buf
 = 
	`kzÆloc
(
bufsz
, 
GFP_KERNEL
);

2750 i‡(!
buf
)

2751  -
ENOMEM
;

2753 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2756 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "HW Error:\t\t\t %u\n",

2757 
i§_°©s
->
hw
);

2758 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "SW Error:\t\t\t %u\n",

2759 
i§_°©s
->
sw
);

2760 i‡(
i§_°©s
->
sw
 || i§_°©s->
hw
) {

2761 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2763 
i§_°©s
->
îr_code
);

2765 #ifde‡
CONFIG_IWLWIFI_DEBUG


2766 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "FrameÅransmitted:\t\t %u\n",

2767 
i§_°©s
->
sch
);

2768 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Alive interrupt:\t\t %u\n",

2769 
i§_°©s
->
Æive
);

2771 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2772 "HW RF KILL swôchÅoggÀd:\à%u\n", 
i§_°©s
->
rfkûl
);

2774 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "CT KILL:\t\t\t %u\n",

2775 
i§_°©s
->
˘kûl
);

2777 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Wakeup Interrupt:\t\t %u\n",

2778 
i§_°©s
->
wakeup
);

2780 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos,

2781 "Rx comm™dÑe•⁄£s:\t\à%u\n", 
i§_°©s
->
rx
);

2783 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Tx/FH interrupt:\t\t %u\n",

2784 
i§_°©s
->
tx
);

2786 
pos
 +
	`s˙¥ötf
(
buf
 +Öos, 
bufsz
 -Öos, "Unexpected INTA:\t\t %u\n",

2787 
i§_°©s
->
unh™dÀd
);

2789 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2790 
	`k‰ì
(
buf
);

2791  
ªt
;

2792 
	}
}

2794 
ssize_t
 
	$iwl_dbgfs_öãºu±_wrôe
(
fûe
 *file,

2795 c⁄° 
__u£r
 *
u£r_buf
,

2796 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2798 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2799 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2800 
i§_°©i°ics
 *
i§_°©s
 = &
å™s_pcõ
->isr_stats;

2801 
u32
 
ª£t_Êag
;

2802 
ªt
;

2804 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 16, &
ª£t_Êag
);

2805 i‡(
ªt
)

2806  
ªt
;

2807 i‡(
ª£t_Êag
 == 0)

2808 
	`mem£t
(
i§_°©s
, 0, (*isr_stats));

2810  
cou¡
;

2811 
	}
}

2813 
ssize_t
 
	$iwl_dbgfs_c§_wrôe
(
fûe
 *file,

2814 c⁄° 
__u£r
 *
u£r_buf
,

2815 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2817 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2819 
	`iwl_pcõ_dump_c§
(
å™s
);

2821  
cou¡
;

2822 
	}
}

2824 
ssize_t
 
	$iwl_dbgfs_fh_ªg_ªad
(
fûe
 *file,

2825 
__u£r
 *
u£r_buf
,

2826 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2828 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2829 *
buf
 = 
NULL
;

2830 
ssize_t
 
ªt
;

2832 
ªt
 = 
	`iwl_dump_fh
(
å™s
, &
buf
);

2833 i‡(
ªt
 < 0)

2834  
ªt
;

2835 i‡(!
buf
)

2836  -
EINVAL
;

2837 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
,Ñet);

2838 
	`k‰ì
(
buf
);

2839  
ªt
;

2840 
	}
}

2842 
ssize_t
 
	$iwl_dbgfs_rfkûl_ªad
(
fûe
 *file,

2843 
__u£r
 *
u£r_buf
,

2844 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2846 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2847 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2848 
buf
[100];

2849 
pos
;

2851 
pos
 = 
	`s˙¥ötf
(
buf
, (buf), "debug: %d\nhw: %d\n",

2852 
å™s_pcõ
->
debug_rfkûl
,

2853 !(
	`iwl_ªad32
(
å™s
, 
CSR_GP_CNTRL
) &

2854 
CSR_GP_CNTRL_REG_FLAG_HW_RF_KILL_SW
));

2856  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
pos
);

2857 
	}
}

2859 
ssize_t
 
	$iwl_dbgfs_rfkûl_wrôe
(
fûe
 *file,

2860 c⁄° 
__u£r
 *
u£r_buf
,

2861 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2863 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2864 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2865 
boﬁ
 
√w_vÆue
;

2866 
ªt
;

2868 
ªt
 = 
	`k°πoboﬁ_‰om_u£r
(
u£r_buf
, 
cou¡
, &
√w_vÆue
);

2869 i‡(
ªt
)

2870  
ªt
;

2871 i‡(
√w_vÆue
 =
å™s_pcõ
->
debug_rfkûl
)

2872  
cou¡
;

2873 
	`IWL_WARN
(
å™s
, "changing debugÑfkill %d->%d\n",

2874 
å™s_pcõ
->
debug_rfkûl
, 
√w_vÆue
);

2875 
å™s_pcõ
->
debug_rfkûl
 = 
√w_vÆue
;

2876 
	`iwl_pcõ_h™dÀ_rfkûl_úq
(
å™s
, 
Ál£
);

2878  
cou¡
;

2879 
	}
}

2881 
	$iwl_dbgfs_m⁄ô‹_d©a_›í
(
öode
 *inode,

2882 
fûe
 *file)

2884 
iwl_å™s
 *
å™s
 = 
öode
->
i_¥iv©e
;

2885 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2887 i‡(!
å™s
->
dbg
.
de°_év
 ||

2888 
å™s
->
dbg
.
de°_év
->
m⁄ô‹_mode
 !
EXTERNAL_MODE
) {

2889 
	`IWL_ERR
(
å™s
, "Debug destination isÇot setÅo DRAM\n");

2890  -
ENOENT
;

2893 i‡(
å™s_pcõ
->
fw_m⁄_d©a
.
°©e
 !
IWL_FW_MON_DBGFS_STATE_CLOSED
)

2894  -
EBUSY
;

2896 
å™s_pcõ
->
fw_m⁄_d©a
.
°©e
 = 
IWL_FW_MON_DBGFS_STATE_OPEN
;

2897  
	`sim∂e_›í
(
öode
, 
fûe
);

2898 
	}
}

2900 
	$iwl_dbgfs_m⁄ô‹_d©a_ªÀa£
(
öode
 *inode,

2901 
fûe
 *file)

2903 
iwl_å™s_pcõ
 *
å™s_pcõ
 =

2904 
	`IWL_TRANS_GET_PCIE_TRANS
(
öode
->
i_¥iv©e
);

2906 i‡(
å™s_pcõ
->
fw_m⁄_d©a
.
°©e
 =
IWL_FW_MON_DBGFS_STATE_OPEN
)

2907 
å™s_pcõ
->
fw_m⁄_d©a
.
°©e
 = 
IWL_FW_MON_DBGFS_STATE_CLOSED
;

2909 
	}
}

2911 
boﬁ
 
	$iwl_wrôe_to_u£r_buf
(
__u£r
 *
u£r_buf
, 
ssize_t
 
cou¡
,

2912 *
buf
, 
ssize_t
 *
size
,

2913 
ssize_t
 *
byãs_c›õd
)

2915 
ssize_t
 
buf_size_À·
 = 
cou¡
 - *
byãs_c›õd
;

2917 
buf_size_À·
 = buf_size_À· - (buf_size_À· % (
u32
));

2918 i‡(*
size
 > 
buf_size_À·
)

2919 *
size
 = 
buf_size_À·
;

2921 *
size
 -
	`c›y_to_u£r
(
u£r_buf
, 
buf
, *size);

2922 *
byãs_c›õd
 +*
size
;

2924 i‡(
buf_size_À·
 =*
size
)

2925  
åue
;

2926  
Ál£
;

2927 
	}
}

2929 
ssize_t
 
	$iwl_dbgfs_m⁄ô‹_d©a_ªad
(
fûe
 *file,

2930 
__u£r
 *
u£r_buf
,

2931 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2933 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

2934 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

2935 
u8
 *
˝u_addr
 = (*)
å™s
->
dbg
.
fw_m⁄
.
block
, *
cuº_buf
;

2936 
c⁄t_ªc
 *
d©a
 = &
å™s_pcõ
->
fw_m⁄_d©a
;

2937 
u32
 
wrôe_±r_addr
, 
wøp_˙t_addr
, 
wrôe_±r
, 
wøp_˙t
;

2938 
ssize_t
 
size
, 
byãs_c›õd
 = 0;

2939 
boﬁ
 
b_fuŒ
;

2941 i‡(
å™s
->
dbg
.
de°_év
) {

2942 
wrôe_±r_addr
 =

2943 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
wrôe_±r_ªg
);

2944 
wøp_˙t_addr
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
wøp_cou¡
);

2946 
wrôe_±r_addr
 = 
MON_BUFF_WRPTR
;

2947 
wøp_˙t_addr
 = 
MON_BUFF_CYCLE_CNT
;

2950 i‡(
	`u∆ikñy
(!
å™s
->
dbg
.
ªc_⁄
))

2953 
	`muãx_lock
(&
d©a
->
muãx
);

2954 i‡(
d©a
->
°©e
 ==

2955 
IWL_FW_MON_DBGFS_STATE_DISABLED
) {

2956 
	`muãx_u∆ock
(&
d©a
->
muãx
);

2961 
wrôe_±r
 = 
	`iwl_ªad_¥ph
(
å™s
, 
wrôe_±r_addr
Ë* (
u32
);

2962 
wøp_˙t
 = 
	`iwl_ªad_¥ph
(
å™s
, 
wøp_˙t_addr
);

2964 i‡(
d©a
->
¥ev_wøp_˙t
 =
wøp_˙t
) {

2965 
size
 = 
wrôe_±r
 - 
d©a
->
¥ev_wr_±r
;

2966 
cuº_buf
 = 
˝u_addr
 + 
d©a
->
¥ev_wr_±r
;

2967 
b_fuŒ
 = 
	`iwl_wrôe_to_u£r_buf
(
u£r_buf
, 
cou¡
,

2968 
cuº_buf
, &
size
,

2969 &
byãs_c›õd
);

2970 
d©a
->
¥ev_wr_±r
 +
size
;

2972 } i‡(
d©a
->
¥ev_wøp_˙t
 =
wøp_˙t
 - 1 &&

2973 
wrôe_±r
 < 
d©a
->
¥ev_wr_±r
) {

2974 
size
 = 
å™s
->
dbg
.
fw_m⁄
.sizê- 
d©a
->
¥ev_wr_±r
;

2975 
cuº_buf
 = 
˝u_addr
 + 
d©a
->
¥ev_wr_±r
;

2976 
b_fuŒ
 = 
	`iwl_wrôe_to_u£r_buf
(
u£r_buf
, 
cou¡
,

2977 
cuº_buf
, &
size
,

2978 &
byãs_c›õd
);

2979 
d©a
->
¥ev_wr_±r
 +
size
;

2981 i‡(!
b_fuŒ
) {

2982 
size
 = 
wrôe_±r
;

2983 
b_fuŒ
 = 
	`iwl_wrôe_to_u£r_buf
(
u£r_buf
, 
cou¡
,

2984 
˝u_addr
, &
size
,

2985 &
byãs_c›õd
);

2986 
d©a
->
¥ev_wr_±r
 = 
size
;

2987 
d©a
->
¥ev_wøp_˙t
++;

2990 i‡(
d©a
->
¥ev_wøp_˙t
 =
wøp_˙t
 - 1 &&

2991 
wrôe_±r
 > 
d©a
->
¥ev_wr_±r
)

2992 
	`IWL_WARN
(
å™s
,

2994 i‡(!
	`u∆ikñy
(
d©a
->
¥ev_wøp_˙t
 == 0 &&

2995 
d©a
->
¥ev_wr_±r
 == 0))

2996 
	`IWL_WARN
(
å™s
,

2999 
size
 = 
wrôe_±r
;

3000 
b_fuŒ
 = 
	`iwl_wrôe_to_u£r_buf
(
u£r_buf
, 
cou¡
,

3001 
˝u_addr
, &
size
,

3002 &
byãs_c›õd
);

3003 
d©a
->
¥ev_wr_±r
 = 
size
;

3004 
d©a
->
¥ev_wøp_˙t
 = 
wøp_˙t
;

3007 
	`muãx_u∆ock
(&
d©a
->
muãx
);

3009  
byãs_c›õd
;

3010 
	}
}

3012 
ssize_t
 
	$iwl_dbgfs_rf_ªad
(
fûe
 *file,

3013 
__u£r
 *
u£r_buf
,

3014 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3016 
iwl_å™s
 *
å™s
 = 
fûe
->
¥iv©e_d©a
;

3017 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3019 i‡(!
å™s_pcõ
->
rf_«me
[0])

3020  -
ENODEV
;

3022  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
,

3023 
å™s_pcõ
->
rf_«me
,

3024 
	`°æí
(
å™s_pcõ
->
rf_«me
));

3025 
	}
}

3027 
DEBUGFS_READ_WRITE_FILE_OPS
(
öãºu±
);

3028 
DEBUGFS_READ_FILE_OPS
(
fh_ªg
);

3029 
DEBUGFS_READ_FILE_OPS
(
rx_queue
);

3030 
DEBUGFS_WRITE_FILE_OPS
(
c§
);

3031 
DEBUGFS_READ_WRITE_FILE_OPS
(
rfkûl
);

3032 
DEBUGFS_READ_FILE_OPS
(
rf
);

3034 c⁄° 
fûe_›î©i⁄s
 
	giwl_dbgfs_tx_queue_›s
 = {

3035 .
ow√r
 = 
THIS_MODULE
,

3036 .
	g›í
 = 
iwl_dbgfs_tx_queue_›í
,

3037 .
	gªad
 = 
£q_ªad
,

3038 .
	gŒ£ek
 = 
£q_l£ek
,

3039 .
	gªÀa£
 = 
£q_ªÀa£_¥iv©e
,

3042 c⁄° 
fûe_›î©i⁄s
 
	giwl_dbgfs_m⁄ô‹_d©a_›s
 = {

3043 .
ªad
 = 
iwl_dbgfs_m⁄ô‹_d©a_ªad
,

3044 .
	g›í
 = 
iwl_dbgfs_m⁄ô‹_d©a_›í
,

3045 .
	gªÀa£
 = 
iwl_dbgfs_m⁄ô‹_d©a_ªÀa£
,

3049 
	$iwl_å™s_pcõ_dbgfs_ªgi°î
(
iwl_å™s
 *
å™s
)

3051 
díåy
 *
dú
 = 
å™s
->
dbgfs_dú
;

3053 
	`DEBUGFS_ADD_FILE
(
rx_queue
, 
dú
, 0400);

3054 
	`DEBUGFS_ADD_FILE
(
tx_queue
, 
dú
, 0400);

3055 
	`DEBUGFS_ADD_FILE
(
öãºu±
, 
dú
, 0600);

3056 
	`DEBUGFS_ADD_FILE
(
c§
, 
dú
, 0200);

3057 
	`DEBUGFS_ADD_FILE
(
fh_ªg
, 
dú
, 0400);

3058 
	`DEBUGFS_ADD_FILE
(
rfkûl
, 
dú
, 0600);

3059 
	`DEBUGFS_ADD_FILE
(
m⁄ô‹_d©a
, 
dú
, 0400);

3060 
	`DEBUGFS_ADD_FILE
(
rf
, 
dú
, 0400);

3061 
	}
}

3063 
	$iwl_å™s_pcõ_debugfs_˛ónup
(
iwl_å™s
 *
å™s
)

3065 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3066 
c⁄t_ªc
 *
d©a
 = &
å™s_pcõ
->
fw_m⁄_d©a
;

3068 
	`muãx_lock
(&
d©a
->
muãx
);

3069 
d©a
->
°©e
 = 
IWL_FW_MON_DBGFS_STATE_DISABLED
;

3070 
	`muãx_u∆ock
(&
d©a
->
muãx
);

3071 
	}
}

3074 
u32
 
	$iwl_å™s_pcõ_gë_cmdÀn
(
iwl_å™s
 *
å™s
, *
tfd
)

3076 
u32
 
cmdÀn
 = 0;

3077 
i
;

3079 
i
 = 0; i < 
å™s
->
txqs
.
tfd
.
max_tbs
; i++)

3080 
cmdÀn
 +
	`iwl_txq_gí1_tfd_tb_gë_Àn
(
å™s
, 
tfd
, 
i
);

3082  
cmdÀn
;

3083 
	}
}

3085 
u32
 
	$iwl_å™s_pcõ_dump_rbs
(
iwl_å™s
 *
å™s
,

3086 
iwl_fw_îr‹_dump_d©a
 **
d©a
,

3087 
Æloˇãd_rb_nums
)

3089 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3090 
max_Àn
 = 
å™s_pcõ
->
rx_buf_byãs
;

3092 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[0];

3093 
u32
 
i
, 
r
, 
j
, 
rb_Àn
 = 0;

3095 
	`•ö_lock_bh
(&
rxq
->
lock
);

3097 
r
 = 
	`iwl_gë_˛o£d_rb_°ts
(
å™s
, 
rxq
);

3099 
i
 = 
rxq
->
ªad
, 
j
 = 0;

3100 
i
 !
r
 && 
j
 < 
Æloˇãd_rb_nums
;

3101 
i
 = (ò+ 1Ë& 
RX_QUEUE_MASK
, 
j
++) {

3102 
iwl_rx_mem_buf„r
 *
rxb
 = 
rxq
->
queue
[
i
];

3103 
iwl_fw_îr‹_dump_rb
 *
rb
;

3105 
	`dma_sync_sögÀ_f‹_˝u
(
å™s
->
dev
, 
rxb
->
∑ge_dma
,

3106 
max_Àn
, 
DMA_FROM_DEVICE
);

3108 
rb_Àn
 +(**
d©a
Ë+ (*
rb
Ë+ 
max_Àn
;

3110 (*
d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_RB
);

3111 (*
d©a
)->
Àn
 = 
	`˝u_to_À32
((*
rb
Ë+ 
max_Àn
);

3112 
rb
 = (*)(*
d©a
)->data;

3113 
rb
->
ödex
 = 
	`˝u_to_À32
(
i
);

3114 
	`mem˝y
(
rb
->
d©a
, 
	`∑ge_addªss
(
rxb
->
∑ge
), 
max_Àn
);

3116 *
d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*data);

3119 
	`•ö_u∆ock_bh
(&
rxq
->
lock
);

3121  
rb_Àn
;

3122 
	}
}

3123 
	#IWL_CSR_TO_DUMP
 (0x250)

	)

3125 
u32
 
	$iwl_å™s_pcõ_dump_c§
(
iwl_å™s
 *
å™s
,

3126 
iwl_fw_îr‹_dump_d©a
 **
d©a
)

3128 
u32
 
c§_Àn
 = (**
d©a
Ë+ 
IWL_CSR_TO_DUMP
;

3129 
__À32
 *
vÆ
;

3130 
i
;

3132 (*
d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_CSR
);

3133 (*
d©a
)->
Àn
 = 
	`˝u_to_À32
(
IWL_CSR_TO_DUMP
);

3134 
vÆ
 = (*)(*
d©a
)->data;

3136 
i
 = 0; i < 
IWL_CSR_TO_DUMP
; i += 4)

3137 *
vÆ
++ = 
	`˝u_to_À32
(
	`iwl_å™s_pcõ_ªad32
(
å™s
, 
i
));

3139 *
d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*data);

3141  
c§_Àn
;

3142 
	}
}

3144 
u32
 
	$iwl_å™s_pcõ_fh_ªgs_dump
(
iwl_å™s
 *
å™s
,

3145 
iwl_fw_îr‹_dump_d©a
 **
d©a
)

3147 
u32
 
fh_ªgs_Àn
 = 
FH_MEM_UPPER_BOUND
 - 
FH_MEM_LOWER_BOUND
;

3148 
__À32
 *
vÆ
;

3149 
i
;

3151 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

3154 (*
d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_FH_REGS
);

3155 (*
d©a
)->
Àn
 = 
	`˝u_to_À32
(
fh_ªgs_Àn
);

3156 
vÆ
 = (*)(*
d©a
)->data;

3158 i‡(!
å™s
->
å™s_cfg
->
gí2
)

3159 
i
 = 
FH_MEM_LOWER_BOUND
; i < 
FH_MEM_UPPER_BOUND
;

3160 
i
 +(
u32
))

3161 *
vÆ
++ = 
	`˝u_to_À32
(
	`iwl_å™s_pcõ_ªad32
(
å™s
, 
i
));

3163 
i
 = 
	`iwl_umac_¥ph
(
å™s
, 
FH_MEM_LOWER_BOUND_GEN2
);

3164 
i
 < 
	`iwl_umac_¥ph
(
å™s
, 
FH_MEM_UPPER_BOUND_GEN2
);

3165 
i
 +(
u32
))

3166 *
vÆ
++ = 
	`˝u_to_À32
(
	`iwl_å™s_pcõ_ªad_¥ph
(
å™s
,

3167 
i
));

3169 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

3171 *
d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(*data);

3173  (**
d©a
Ë+ 
fh_ªgs_Àn
;

3174 
	}
}

3176 
u32


3177 
	$iwl_å™s_pci_dump_m¨bh_m⁄ô‹
(
iwl_å™s
 *
å™s
,

3178 
iwl_fw_îr‹_dump_fw_m⁄
 *
fw_m⁄_d©a
,

3179 
u32
 
m⁄ô‹_Àn
)

3181 
u32
 
buf_size_ö_dw‹ds
 = (
m⁄ô‹_Àn
 >> 2);

3182 
u32
 *
buf„r
 = (u32 *)
fw_m⁄_d©a
->
d©a
;

3183 
u32
 
i
;

3185 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

3188 
	`iwl_wrôe_umac_¥ph_no_gøb
(
å™s
, 
MON_DMARB_RD_CTL_ADDR
, 0x1);

3189 
i
 = 0; i < 
buf_size_ö_dw‹ds
; i++)

3190 
buf„r
[
i
] = 
	`iwl_ªad_umac_¥ph_no_gøb
(
å™s
,

3191 
MON_DMARB_RD_DATA_ADDR
);

3192 
	`iwl_wrôe_umac_¥ph_no_gøb
(
å™s
, 
MON_DMARB_RD_CTL_ADDR
, 0x0);

3194 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

3196  
m⁄ô‹_Àn
;

3197 
	}
}

3200 
	$iwl_å™s_pcõ_dump_poöãrs
(
iwl_å™s
 *
å™s
,

3201 
iwl_fw_îr‹_dump_fw_m⁄
 *
fw_m⁄_d©a
)

3203 
u32
 
ba£
, 
ba£_high
, 
wrôe_±r
, 
wrôe_±r_vÆ
, 
wøp_˙t
;

3205 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

3206 
ba£
 = 
DBGC_CUR_DBGBUF_BASE_ADDR_LSB
;

3207 
ba£_high
 = 
DBGC_CUR_DBGBUF_BASE_ADDR_MSB
;

3208 
wrôe_±r
 = 
DBGC_CUR_DBGBUF_STATUS
;

3209 
wøp_˙t
 = 
DBGC_DBGBUF_WRAP_AROUND
;

3210 } i‡(
å™s
->
dbg
.
de°_év
) {

3211 
wrôe_±r
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
wrôe_±r_ªg
);

3212 
wøp_˙t
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
wøp_cou¡
);

3213 
ba£
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
ba£_ªg
);

3215 
ba£
 = 
MON_BUFF_BASE_ADDR
;

3216 
wrôe_±r
 = 
MON_BUFF_WRPTR
;

3217 
wøp_˙t
 = 
MON_BUFF_CYCLE_CNT
;

3220 
wrôe_±r_vÆ
 = 
	`iwl_ªad_¥ph
(
å™s
, 
wrôe_±r
);

3221 
fw_m⁄_d©a
->
fw_m⁄_cy˛e_˙t
 =

3222 
	`˝u_to_À32
(
	`iwl_ªad_¥ph
(
å™s
, 
wøp_˙t
));

3223 
fw_m⁄_d©a
->
fw_m⁄_ba£_±r
 =

3224 
	`˝u_to_À32
(
	`iwl_ªad_¥ph
(
å™s
, 
ba£
));

3225 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

3226 
fw_m⁄_d©a
->
fw_m⁄_ba£_high_±r
 =

3227 
	`˝u_to_À32
(
	`iwl_ªad_¥ph
(
å™s
, 
ba£_high
));

3228 
wrôe_±r_vÆ
 &
DBGC_CUR_DBGBUF_STATUS_OFFSET_MSK
;

3230 
wrôe_±r_vÆ
 >>= 2;

3232 
fw_m⁄_d©a
->
fw_m⁄_wr_±r
 = 
	`˝u_to_À32
(
wrôe_±r_vÆ
);

3233 
	}
}

3235 
u32


3236 
	$iwl_å™s_pcõ_dump_m⁄ô‹
(
iwl_å™s
 *
å™s
,

3237 
iwl_fw_îr‹_dump_d©a
 **
d©a
,

3238 
u32
 
m⁄ô‹_Àn
)

3240 
iwl_døm_d©a
 *
fw_m⁄
 = &
å™s
->
dbg
.fw_mon;

3241 
u32
 
Àn
 = 0;

3243 i‡(
å™s
->
dbg
.
de°_év
 ||

3244 (
fw_m⁄
->
size
 &&

3245 (
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_7000
 ||

3246 
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
))) {

3247 
iwl_fw_îr‹_dump_fw_m⁄
 *
fw_m⁄_d©a
;

3249 (*
d©a
)->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_FW_MONITOR
);

3250 
fw_m⁄_d©a
 = (*)(*
d©a
)->data;

3252 
	`iwl_å™s_pcõ_dump_poöãrs
(
å™s
, 
fw_m⁄_d©a
);

3254 
Àn
 +(**
d©a
Ë+ (*
fw_m⁄_d©a
);

3255 i‡(
fw_m⁄
->
size
) {

3256 
	`mem˝y
(
fw_m⁄_d©a
->
d©a
, 
fw_m⁄
->
block
, fw_m⁄->
size
);

3257 
m⁄ô‹_Àn
 = 
fw_m⁄
->
size
;

3258 } i‡(
å™s
->
dbg
.
de°_év
->
m⁄ô‹_mode
 =
SMEM_MODE
) {

3259 
u32
 
ba£
 = 
	`À32_to_˝u
(
fw_m⁄_d©a
->
fw_m⁄_ba£_±r
);

3264 i‡(
å™s
->
dbg
.
de°_év
->
vîsi⁄
) {

3265 
ba£
 = (
	`iwl_ªad_¥ph
(
å™s
, base) &

3266 
IWL_LDBG_M2S_BUF_BA_MSK
) <<

3267 
å™s
->
dbg
.
de°_év
->
ba£_shi·
;

3268 
ba£
 *
IWL_M2S_UNIT_SIZE
;

3269 
ba£
 +
å™s
->
cfg
->
smem_off£t
;

3271 
ba£
 = 
	`iwl_ªad_¥ph
(
å™s
, base) <<

3272 
å™s
->
dbg
.
de°_év
->
ba£_shi·
;

3275 
	`iwl_å™s_ªad_mem
(
å™s
, 
ba£
, 
fw_m⁄_d©a
->
d©a
,

3276 
m⁄ô‹_Àn
 / (
u32
));

3277 } i‡(
å™s
->
dbg
.
de°_év
->
m⁄ô‹_mode
 =
MARBH_MODE
) {

3278 
m⁄ô‹_Àn
 =

3279 
	`iwl_å™s_pci_dump_m¨bh_m⁄ô‹
(
å™s
,

3280 
fw_m⁄_d©a
,

3281 
m⁄ô‹_Àn
);

3284 
m⁄ô‹_Àn
 = 0;

3287 
Àn
 +
m⁄ô‹_Àn
;

3288 (*
d©a
)->
Àn
 = 
	`˝u_to_À32
(
m⁄ô‹_Àn
 + (*
fw_m⁄_d©a
));

3291  
Àn
;

3292 
	}
}

3294 
	$iwl_å™s_gë_fw_m⁄ô‹_Àn
(
iwl_å™s
 *
å™s
, 
u32
 *
Àn
)

3296 i‡(
å™s
->
dbg
.
fw_m⁄
.
size
) {

3297 *
Àn
 +(
iwl_fw_îr‹_dump_d©a
) +

3298 (
iwl_fw_îr‹_dump_fw_m⁄
) +

3299 
å™s
->
dbg
.
fw_m⁄
.
size
;

3300  
å™s
->
dbg
.
fw_m⁄
.
size
;

3301 } i‡(
å™s
->
dbg
.
de°_év
) {

3302 
u32
 
ba£
, 
íd
, 
cfg_ªg
, 
m⁄ô‹_Àn
;

3304 i‡(
å™s
->
dbg
.
de°_év
->
vîsi⁄
 == 1) {

3305 
cfg_ªg
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
ba£_ªg
);

3306 
cfg_ªg
 = 
	`iwl_ªad_¥ph
(
å™s
, cfg_reg);

3307 
ba£
 = (
cfg_ªg
 & 
IWL_LDBG_M2S_BUF_BA_MSK
) <<

3308 
å™s
->
dbg
.
de°_év
->
ba£_shi·
;

3309 
ba£
 *
IWL_M2S_UNIT_SIZE
;

3310 
ba£
 +
å™s
->
cfg
->
smem_off£t
;

3312 
m⁄ô‹_Àn
 =

3313 (
cfg_ªg
 & 
IWL_LDBG_M2S_BUF_SIZE_MSK
) >>

3314 
å™s
->
dbg
.
de°_év
->
íd_shi·
;

3315 
m⁄ô‹_Àn
 *
IWL_M2S_UNIT_SIZE
;

3317 
ba£
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
ba£_ªg
);

3318 
íd
 = 
	`À32_to_˝u
(
å™s
->
dbg
.
de°_év
->
íd_ªg
);

3320 
ba£
 = 
	`iwl_ªad_¥ph
(
å™s
, base) <<

3321 
å™s
->
dbg
.
de°_év
->
ba£_shi·
;

3322 
íd
 = 
	`iwl_ªad_¥ph
(
å™s
,Énd) <<

3323 
å™s
->
dbg
.
de°_év
->
íd_shi·
;

3326 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >=

3327 
IWL_DEVICE_FAMILY_8000
 ||

3328 
å™s
->
dbg
.
de°_év
->
m⁄ô‹_mode
 =
MARBH_MODE
)

3329 
íd
 +(1 << 
å™s
->
dbg
.
de°_év
->
íd_shi·
);

3330 
m⁄ô‹_Àn
 = 
íd
 - 
ba£
;

3332 *
Àn
 +(
iwl_fw_îr‹_dump_d©a
) +

3333 (
iwl_fw_îr‹_dump_fw_m⁄
) +

3334 
m⁄ô‹_Àn
;

3335  
m⁄ô‹_Àn
;

3338 
	}
}

3340 
iwl_å™s_dump_d©a
 *

3341 
	$iwl_å™s_pcõ_dump_d©a
(
iwl_å™s
 *
å™s
,

3342 
u32
 
dump_mask
,

3343 c⁄° 
iwl_dump_ßnôize_›s
 *
ßnôize_›s
,

3344 *
ßnôize_˘x
)

3346 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3347 
iwl_fw_îr‹_dump_d©a
 *
d©a
;

3348 
iwl_txq
 *
cmdq
 = 
å™s
->
txqs
.
txq
[å™s->txqs.
cmd
.
q_id
];

3349 
iwl_fw_îr‹_dump_txcmd
 *
txcmd
;

3350 
iwl_å™s_dump_d©a
 *
dump_d©a
;

3351 
u32
 
Àn
, 
num_rbs
 = 0, 
m⁄ô‹_Àn
 = 0;

3352 
i
, 
±r
;

3353 
boﬁ
 
dump_rbs
 = 
	`ã°_bô
(
STATUS_FW_ERROR
, &
å™s
->
°©us
) &&

3354 !
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
 &&

3355 
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_RB
);

3357 i‡(!
dump_mask
)

3358  
NULL
;

3361 
Àn
 = (*
dump_d©a
);

3364 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_TXCMD
Ë&& 
cmdq
)

3365 
Àn
 +(*
d©a
) +

3366 
cmdq
->
n_wödow
 * ((*
txcmd
) +

3367 
TFD_MAX_PAYLOAD_SIZE
);

3370 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_FW_MONITOR
))

3371 
m⁄ô‹_Àn
 = 
	`iwl_å™s_gë_fw_m⁄ô‹_Àn
(
å™s
, &
Àn
);

3374 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_CSR
))

3375 
Àn
 +(*
d©a
Ë+ 
IWL_CSR_TO_DUMP
;

3378 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_FH_REGS
)) {

3379 i‡(
å™s
->
å™s_cfg
->
gí2
)

3380 
Àn
 +(*
d©a
) +

3381 (
	`iwl_umac_¥ph
(
å™s
, 
FH_MEM_UPPER_BOUND_GEN2
) -

3382 
	`iwl_umac_¥ph
(
å™s
, 
FH_MEM_LOWER_BOUND_GEN2
));

3384 
Àn
 +(*
d©a
) +

3385 (
FH_MEM_UPPER_BOUND
 -

3386 
FH_MEM_LOWER_BOUND
);

3389 i‡(
dump_rbs
) {

3391 
iwl_rxq
 *
rxq
 = &
å™s_pcõ
->rxq[0];

3393 
num_rbs
 = 
	`iwl_gë_˛o£d_rb_°ts
(
å™s
, 
rxq
);

3394 
num_rbs
 = (num_rb†- 
rxq
->
ªad
Ë& 
RX_QUEUE_MASK
;

3395 
Àn
 +
num_rbs
 * ((*
d©a
) +

3396 (
iwl_fw_îr‹_dump_rb
) +

3397 (
PAGE_SIZE
 << 
å™s_pcõ
->
rx_∑ge_‹dî
));

3401 i‡(
å™s
->
å™s_cfg
->
gí2
 && 
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_PAGING
))

3402 
i
 = 0; i < 
å™s
->
öô_døm
.
∑gög_˙t
; i++)

3403 
Àn
 +(*
d©a
) +

3404 (
iwl_fw_îr‹_dump_∑gög
) +

3405 
å™s
->
öô_døm
.
∑gög
[
i
].
size
;

3407 
dump_d©a
 = 
	`vzÆloc
(
Àn
);

3408 i‡(!
dump_d©a
)

3409  
NULL
;

3411 
Àn
 = 0;

3412 
d©a
 = (*)
dump_d©a
->data;

3414 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_TXCMD
Ë&& 
cmdq
) {

3415 
u16
 
tfd_size
 = 
å™s
->
txqs
.
tfd
.
size
;

3417 
d©a
->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_TXCMD
);

3418 
txcmd
 = (*)
d©a
->data;

3419 
	`•ö_lock_bh
(&
cmdq
->
lock
);

3420 
±r
 = 
cmdq
->
wrôe_±r
;

3421 
i
 = 0; i < 
cmdq
->
n_wödow
; i++) {

3422 
u8
 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
cmdq
, 
±r
);

3423 
u8
 
tfdidx
;

3424 
u32
 
ˇ∂í
, 
cmdÀn
;

3426 i‡(
å™s
->
å™s_cfg
->
gí2
)

3427 
tfdidx
 = 
idx
;

3429 
tfdidx
 = 
±r
;

3431 
cmdÀn
 = 
	`iwl_å™s_pcõ_gë_cmdÀn
(
å™s
,

3432 (
u8
 *)
cmdq
->
tfds
 +

3433 
tfd_size
 * 
tfdidx
);

3434 
ˇ∂í
 = 
	`mö_t
(
u32
, 
TFD_MAX_PAYLOAD_SIZE
, 
cmdÀn
);

3436 i‡(
cmdÀn
) {

3437 
Àn
 +(*
txcmd
Ë+ 
ˇ∂í
;

3438 
txcmd
->
cmdÀn
 = 
	`˝u_to_À32
(cmdlen);

3439 
txcmd
->
ˇ∂í
 = 
	`˝u_to_À32
(caplen);

3440 
	`mem˝y
(
txcmd
->
d©a
, 
cmdq
->
íåõs
[
idx
].
cmd
,

3441 
ˇ∂í
);

3442 i‡(
ßnôize_›s
 && s™ôize_›s->
‰ob_hcmd
)

3443 
ßnôize_›s
->
	`‰ob_hcmd
(
ßnôize_˘x
,

3444 
txcmd
->
d©a
,

3445 
ˇ∂í
);

3446 
txcmd
 = (*)((
u8
 *Èxcmd->
d©a
 + 
ˇ∂í
);

3449 
±r
 = 
	`iwl_txq_dec_wøp
(
å™s
,Ötr);

3451 
	`•ö_u∆ock_bh
(&
cmdq
->
lock
);

3453 
d©a
->
Àn
 = 
	`˝u_to_À32
(len);

3454 
Àn
 +(*
d©a
);

3455 
d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(data);

3458 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_CSR
))

3459 
Àn
 +
	`iwl_å™s_pcõ_dump_c§
(
å™s
, &
d©a
);

3460 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_FH_REGS
))

3461 
Àn
 +
	`iwl_å™s_pcõ_fh_ªgs_dump
(
å™s
, &
d©a
);

3462 i‡(
dump_rbs
)

3463 
Àn
 +
	`iwl_å™s_pcõ_dump_rbs
(
å™s
, &
d©a
, 
num_rbs
);

3466 i‡(
å™s
->
å™s_cfg
->
gí2
 &&

3467 
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_PAGING
)) {

3468 
i
 = 0; i < 
å™s
->
öô_døm
.
∑gög_˙t
; i++) {

3469 
iwl_fw_îr‹_dump_∑gög
 *
∑gög
;

3470 
u32
 
∑ge_Àn
 = 
å™s
->
öô_døm
.
∑gög
[
i
].
size
;

3472 
d©a
->
ty≥
 = 
	`˝u_to_À32
(
IWL_FW_ERROR_DUMP_PAGING
);

3473 
d©a
->
Àn
 = 
	`˝u_to_À32
((*
∑gög
Ë+ 
∑ge_Àn
);

3474 
∑gög
 = (*)
d©a
->data;

3475 
∑gög
->
ödex
 = 
	`˝u_to_À32
(
i
);

3476 
	`mem˝y
(
∑gög
->
d©a
,

3477 
å™s
->
öô_døm
.
∑gög
[
i
].
block
, 
∑ge_Àn
);

3478 
d©a
 = 
	`iwl_fw_îr‹_√xt_d©a
(data);

3480 
Àn
 +(*
d©a
Ë+ (*
∑gög
Ë+ 
∑ge_Àn
;

3483 i‡(
dump_mask
 & 
	`BIT
(
IWL_FW_ERROR_DUMP_FW_MONITOR
))

3484 
Àn
 +
	`iwl_å™s_pcõ_dump_m⁄ô‹
(
å™s
, &
d©a
, 
m⁄ô‹_Àn
);

3486 
dump_d©a
->
Àn
 =Üen;

3488  
dump_d©a
;

3489 
	}
}

3491 
	$iwl_å™s_pci_öãºu±s
(
iwl_å™s
 *
å™s
, 
boﬁ
 
íabÀ
)

3493 i‡(
íabÀ
)

3494 
	`iwl_íabÀ_öãºu±s
(
å™s
);

3496 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

3497 
	}
}

3499 
	$iwl_å™s_pcõ_sync_nmi
(
iwl_å™s
 *
å™s
)

3501 
u32
 
öè_addr
, 
sw_îr_bô
;

3502 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3504 i‡(
å™s_pcõ
->
msix_íabÀd
) {

3505 
öè_addr
 = 
CSR_MSIX_HW_INT_CAUSES_AD
;

3506 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_BZ
)

3507 
sw_îr_bô
 = 
MSIX_HW_INT_CAUSES_REG_SW_ERR_BZ
;

3509 
sw_îr_bô
 = 
MSIX_HW_INT_CAUSES_REG_SW_ERR
;

3511 
öè_addr
 = 
CSR_INT
;

3512 
sw_îr_bô
 = 
CSR_INT_BIT_SW_ERR
;

3515 
	`iwl_å™s_sync_nmi_wôh_addr
(
å™s
, 
öè_addr
, 
sw_îr_bô
);

3516 
	}
}

3518 
	#IWL_TRANS_COMMON_OPS
 \

3519 .
›_mode_Àave
 = 
iwl_å™s_pcõ_›_mode_Àave
, \

3520 .
wrôe8
 = 
iwl_å™s_pcõ_wrôe8
, \

3521 .
wrôe32
 = 
iwl_å™s_pcõ_wrôe32
, \

3522 .
ªad32
 = 
iwl_å™s_pcõ_ªad32
, \

3523 .
ªad_¥ph
 = 
iwl_å™s_pcõ_ªad_¥ph
, \

3524 .
wrôe_¥ph
 = 
iwl_å™s_pcõ_wrôe_¥ph
, \

3525 .
ªad_mem
 = 
iwl_å™s_pcõ_ªad_mem
, \

3526 .
wrôe_mem
 = 
iwl_å™s_pcõ_wrôe_mem
, \

3527 .
ªad_c⁄fig32
 = 
iwl_å™s_pcõ_ªad_c⁄fig32
, \

3528 .
c⁄figuª
 = 
iwl_å™s_pcõ_c⁄figuª
, \

3529 .
£t_pmi
 = 
iwl_å™s_pcõ_£t_pmi
, \

3530 .
sw_ª£t
 = 
iwl_å™s_pcõ_sw_ª£t
, \

3531 .
gøb_nic_ac˚ss
 = 
iwl_å™s_pcõ_gøb_nic_ac˚ss
, \

3532 .
ªÀa£_nic_ac˚ss
 = 
iwl_å™s_pcõ_ªÀa£_nic_ac˚ss
, \

3533 .
£t_bôs_mask
 = 
iwl_å™s_pcõ_£t_bôs_mask
, \

3534 .
dump_d©a
 = 
iwl_å™s_pcõ_dump_d©a
, \

3535 .
d3_su•íd
 = 
iwl_å™s_pcõ_d3_su•íd
, \

3536 .
d3_ªsume
 = 
iwl_å™s_pcõ_d3_ªsume
, \

3537 .
öãºu±s
 = 
iwl_å™s_pci_öãºu±s
, \

3538 .
sync_nmi
 = 
iwl_å™s_pcõ_sync_nmi
, \

3539 .
imr_dma_d©a
 = 
iwl_å™s_pcõ_c›y_imr
 \

3540 

	)

3541 c⁄° 
iwl_å™s_›s
 
	gå™s_›s_pcõ
 = {

3542 
IWL_TRANS_COMMON_OPS
,

3543 .
°¨t_hw
 = 
iwl_å™s_pcõ_°¨t_hw
,

3544 .
	gfw_Æive
 = 
iwl_å™s_pcõ_fw_Æive
,

3545 .
	g°¨t_fw
 = 
iwl_å™s_pcõ_°¨t_fw
,

3546 .
	g°›_devi˚
 = 
iwl_å™s_pcõ_°›_devi˚
,

3548 .
	g£nd_cmd
 = 
iwl_pcõ_íqueue_hcmd
,

3550 .
	gtx
 = 
iwl_å™s_pcõ_tx
,

3551 .
	gª˛aim
 = 
iwl_txq_ª˛aim
,

3553 .
	gtxq_dißbÀ
 = 
iwl_å™s_pcõ_txq_dißbÀ
,

3554 .
	gtxq_íabÀ
 = 
iwl_å™s_pcõ_txq_íabÀ
,

3556 .
	gtxq_£t_sh¨ed_mode
 = 
iwl_å™s_pcõ_txq_£t_sh¨ed_mode
,

3558 .
	gwaô_tx_queues_em±y
 = 
iwl_å™s_pcõ_waô_txqs_em±y
,

3560 .
	g‰ìze_txq_timî
 = 
iwl_å™s_txq_‰ìze_timî
,

3561 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3562 .
	gdebugfs_˛ónup
 = 
iwl_å™s_pcõ_debugfs_˛ónup
,

3566 c⁄° 
iwl_å™s_›s
 
	gå™s_›s_pcõ_gí2
 = {

3567 
IWL_TRANS_COMMON_OPS
,

3568 .
°¨t_hw
 = 
iwl_å™s_pcõ_°¨t_hw
,

3569 .
	gfw_Æive
 = 
iwl_å™s_pcõ_gí2_fw_Æive
,

3570 .
	g°¨t_fw
 = 
iwl_å™s_pcõ_gí2_°¨t_fw
,

3571 .
	g°›_devi˚
 = 
iwl_å™s_pcõ_gí2_°›_devi˚
,

3573 .
	g£nd_cmd
 = 
iwl_pcõ_gí2_íqueue_hcmd
,

3575 .
	gtx
 = 
iwl_txq_gí2_tx
,

3576 .
	gª˛aim
 = 
iwl_txq_ª˛aim
,

3578 .
	g£t_q_±rs
 = 
iwl_txq_£t_q_±rs
,

3580 .
	gtxq_Æloc
 = 
iwl_txq_dyn_Æloc
,

3581 .
	gtxq_‰ì
 = 
iwl_txq_dyn_‰ì
,

3582 .
	gwaô_txq_em±y
 = 
iwl_å™s_pcõ_waô_txq_em±y
,

3583 .
	grxq_dma_d©a
 = 
iwl_å™s_pcõ_rxq_dma_d©a
,

3584 .
	glﬂd_≤vm
 = 
iwl_å™s_pcõ_˘x_öfo_gí3_lﬂd_≤vm
,

3585 .
	g£t_≤vm
 = 
iwl_å™s_pcõ_˘x_öfo_gí3_£t_≤vm
,

3586 .
	glﬂd_ªdu˚_powî
 = 
iwl_å™s_pcõ_˘x_öfo_gí3_lﬂd_ªdu˚_powî
,

3587 .
	g£t_ªdu˚_powî
 = 
iwl_å™s_pcõ_˘x_öfo_gí3_£t_ªdu˚_powî
,

3588 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3589 .
	gdebugfs_˛ónup
 = 
iwl_å™s_pcõ_debugfs_˛ónup
,

3593 
iwl_å™s
 *
	$iwl_å™s_pcõ_Æloc
(
pci_dev
 *
pdev
,

3594 c⁄° 
pci_devi˚_id
 *
ít
,

3595 c⁄° 
iwl_cfg_å™s_∑øms
 *
cfg_å™s
)

3597 
iwl_å™s_pcõ
 *
å™s_pcõ
;

3598 
iwl_å™s
 *
å™s
;

3599 
ªt
, 
addr_size
;

3600 c⁄° 
iwl_å™s_›s
 *
›s
 = &
å™s_›s_pcõ_gí2
;

3601 
__iomem
 * c⁄° *
èbÀ
;

3602 
u32
 
b¨0
;

3604 i‡(!
cfg_å™s
->
gí2
)

3605 
›s
 = &
å™s_›s_pcõ
;

3608 
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 
PCI_BASE_ADDRESS_0
, &
b¨0
);

3609 i‡(
b¨0
 =
PCI_BASE_ADDRESS_MEM_TYPE_64
) {

3610 
ªt
 = 
	`pci_assign_ªsour˚
(
pdev
, 0);

3611 i‡(
ªt
)

3612  
	`ERR_PTR
(
ªt
);

3615 
ªt
 = 
	`pcim_íabÀ_devi˚
(
pdev
);

3616 i‡(
ªt
)

3617  
	`ERR_PTR
(
ªt
);

3619 
å™s
 = 
	`iwl_å™s_Æloc
((
iwl_å™s_pcõ
), &
pdev
->
dev
, 
›s
,

3620 
cfg_å™s
);

3621 i‡(!
å™s
)

3622  
	`ERR_PTR
(-
ENOMEM
);

3624 
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3626 
å™s_pcõ
->
å™s
 =Årans;

3627 
å™s_pcõ
->
›mode_down
 = 
åue
;

3628 
	`•ö_lock_öô
(&
å™s_pcõ
->
úq_lock
);

3629 
	`•ö_lock_öô
(&
å™s_pcõ
->
ªg_lock
);

3630 
	`•ö_lock_öô
(&
å™s_pcõ
->
Æloc_∑ge_lock
);

3631 
	`muãx_öô
(&
å™s_pcõ
->
muãx
);

3632 
	`öô_waôqueue_hód
(&
å™s_pcõ
->
ucode_wrôe_waôq
);

3633 
	`öô_waôqueue_hód
(&
å™s_pcõ
->
fw_ª£t_waôq
);

3634 
	`öô_waôqueue_hód
(&
å™s_pcõ
->
imr_waôq
);

3636 
å™s_pcõ
->
rba
.
Æloc_wq
 = 
	`Æloc_w‹kqueue
("rb_allocator",

3637 
WQ_HIGHPRI
 | 
WQ_UNBOUND
, 0);

3638 i‡(!
å™s_pcõ
->
rba
.
Æloc_wq
) {

3639 
ªt
 = -
ENOMEM
;

3640 
out_‰ì_å™s
;

3642 
	`INIT_WORK
(&
å™s_pcõ
->
rba
.
rx_Æloc
, 
iwl_pcõ_rx_Æloˇt‹_w‹k
);

3644 
å™s_pcõ
->
debug_rfkûl
 = -1;

3646 i‡(!
cfg_å™s
->
ba£_∑øms
->
pcõ_l1_Ælowed
) {

3652 
	`pci_dißbÀ_lök_°©e
(
pdev
, 
PCIE_LINK_STATE_L0S
 |

3653 
PCIE_LINK_STATE_L1
 |

3654 
PCIE_LINK_STATE_CLKPM
);

3657 
	`pci_£t_ma°î
(
pdev
);

3659 
addr_size
 = 
å™s
->
txqs
.
tfd
.addr_size;

3660 
ªt
 = 
	`dma_£t_mask_™d_cohîít
(&
pdev
->
dev
, 
	`DMA_BIT_MASK
(
addr_size
));

3661 i‡(
ªt
) {

3662 
ªt
 = 
	`dma_£t_mask_™d_cohîít
(&
pdev
->
dev
, 
	`DMA_BIT_MASK
(32));

3664 i‡(
ªt
) {

3665 
	`dev_îr
(&
pdev
->
dev
, "No suitable DMAávailable\n");

3666 
out_no_pci
;

3670 
ªt
 = 
	`pcim_iom≠_ªgi⁄s_ªque°_Æl
(
pdev
, 
	`BIT
(0), 
DRV_NAME
);

3671 i‡(
ªt
) {

3672 
	`dev_îr
(&
pdev
->
dev
, "pcim_iomap_regions_request_all failed\n");

3673 
out_no_pci
;

3676 
èbÀ
 = 
	`pcim_iom≠_èbÀ
(
pdev
);

3677 i‡(!
èbÀ
) {

3678 
	`dev_îr
(&
pdev
->
dev
, "pcim_iomap_table failed\n");

3679 
ªt
 = -
ENOMEM
;

3680 
out_no_pci
;

3683 
å™s_pcõ
->
hw_ba£
 = 
èbÀ
[0];

3684 i‡(!
å™s_pcõ
->
hw_ba£
) {

3685 
	`dev_îr
(&
pdev
->
dev
, "couldn't find IO mem in first BAR\n");

3686 
ªt
 = -
ENODEV
;

3687 
out_no_pci
;

3692 
	`pci_wrôe_c⁄fig_byã
(
pdev
, 
PCI_CFG_RETRY_TIMEOUT
, 0x00);

3694 
å™s_pcõ
->
pci_dev
 = 
pdev
;

3695 
	`iwl_dißbÀ_öãºu±s
(
å™s
);

3697 
å™s
->
hw_ªv
 = 
	`iwl_ªad32
—øns, 
CSR_HW_REV
);

3698 i‡(
å™s
->
hw_ªv
 == 0xffffffff) {

3699 
	`dev_îr
(&
pdev
->
dev
, "HW_REV=0xFFFFFFFF, PCI issues?\n");

3700 
ªt
 = -
EIO
;

3701 
out_no_pci
;

3710 i‡(
cfg_å™s
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_8000
)

3711 
å™s
->
hw_ªv_°ï
 =Åøns->
hw_ªv
 & 0xF;

3713 
å™s
->
hw_ªv_°ï
 = (å™s->
hw_ªv
 & 0xC) >> 2;

3715 
	`IWL_DEBUG_INFO
(
å™s
, "HW REV: 0x%0x\n",Åøns->
hw_ªv
);

3717 
	`iwl_pcõ_£t_öãºu±_ˇ∑
(
pdev
, 
å™s
, 
cfg_å™s
);

3718 
å™s
->
hw_id
 = (
pdev
->
devi˚
 << 16Ë+Ödev->
subsy°em_devi˚
;

3719 
	`¢¥ötf
(
å™s
->
hw_id_°r
, (trans->hw_id_str),

3720 "PCI ID: 0x%04X:0x%04X", 
pdev
->
devi˚
,Ödev->
subsy°em_devi˚
);

3722 
	`öô_waôqueue_hód
(&
å™s_pcõ
->
sx_waôq
);

3724 
ªt
 = 
	`iwl_pcõ_Æloc_övÆid_tx_cmd
(
å™s
);

3725 i‡(
ªt
)

3726 
out_no_pci
;

3728 i‡(
å™s_pcõ
->
msix_íabÀd
) {

3729 
ªt
 = 
	`iwl_pcõ_öô_msix_h™dÀr
(
pdev
, 
å™s_pcõ
);

3730 i‡(
ªt
)

3731 
out_no_pci
;

3733 
ªt
 = 
	`iwl_pcõ_Æloc_i˘
(
å™s
);

3734 i‡(
ªt
)

3735 
out_no_pci
;

3737 
ªt
 = 
	`devm_ªque°_thªaded_úq
(&
pdev
->
dev
,Ödev->
úq
,

3738 
iwl_pcõ_i§
,

3739 
iwl_pcõ_úq_h™dÀr
,

3740 
IRQF_SHARED
, 
DRV_NAME
, 
å™s
);

3741 i‡(
ªt
) {

3742 
	`IWL_ERR
(
å™s
, "Eº‹áŒoˇtög IRQ %d\n", 
pdev
->
úq
);

3743 
out_‰ì_i˘
;

3747 #ifde‡
CONFIG_IWLWIFI_DEBUGFS


3748 
å™s_pcõ
->
fw_m⁄_d©a
.
°©e
 = 
IWL_FW_MON_DBGFS_STATE_CLOSED
;

3749 
	`muãx_öô
(&
å™s_pcõ
->
fw_m⁄_d©a
.
muãx
);

3752 
	`iwl_dbg_év_öô
(
å™s
);

3754  
å™s
;

3756 
out_‰ì_i˘
:

3757 
	`iwl_pcõ_‰ì_i˘
(
å™s
);

3758 
out_no_pci
:

3759 
	`de°roy_w‹kqueue
(
å™s_pcõ
->
rba
.
Æloc_wq
);

3760 
out_‰ì_å™s
:

3761 
	`iwl_å™s_‰ì
(
å™s
);

3762  
	`ERR_PTR
(
ªt
);

3763 
	}
}

3765 
	$iwl_å™s_pcõ_c›y_imr_fh
(
iwl_å™s
 *
å™s
,

3766 
u32
 
d°_addr
, 
u64
 
§c_addr
, u32 
byã_˙t
)

3768 
	`iwl_wrôe_¥ph
(
å™s
, 
IMR_UREG_CHICK
,

3769 
	`iwl_ªad_¥ph
(
å™s
, 
IMR_UREG_CHICK
) |

3770 
IMR_UREG_CHICK_HALT_UMAC_PERMANENTLY_MSK
);

3771 
	`iwl_wrôe_¥ph
(
å™s
, 
IMR_TFH_SRV_DMA_CHNL0_SRAM_ADDR
, 
d°_addr
);

3772 
	`iwl_wrôe_¥ph
(
å™s
, 
IMR_TFH_SRV_DMA_CHNL0_DRAM_ADDR_LSB
,

3773 (
u32
)(
§c_addr
 & 0xFFFFFFFF));

3774 
	`iwl_wrôe_¥ph
(
å™s
, 
IMR_TFH_SRV_DMA_CHNL0_DRAM_ADDR_MSB
,

3775 
	`iwl_gë_dma_hi_addr
(
§c_addr
));

3776 
	`iwl_wrôe_¥ph
(
å™s
, 
IMR_TFH_SRV_DMA_CHNL0_BC
, 
byã_˙t
);

3777 
	`iwl_wrôe_¥ph
(
å™s
, 
IMR_TFH_SRV_DMA_CHNL0_CTRL
,

3778 
IMR_TFH_SRV_DMA_CHNL0_CTRL_D2S_IRQ_TARGET_POS
 |

3779 
IMR_TFH_SRV_DMA_CHNL0_CTRL_D2S_DMA_EN_POS
 |

3780 
IMR_TFH_SRV_DMA_CHNL0_CTRL_D2S_RS_MSK
);

3781 
	}
}

3783 
	$iwl_å™s_pcõ_c›y_imr
(
iwl_å™s
 *
å™s
,

3784 
u32
 
d°_addr
, 
u64
 
§c_addr
, u32 
byã_˙t
)

3786 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

3787 
ªt
 = -1;

3789 
å™s_pcõ
->
imr_°©us
 = 
IMR_D2S_REQUESTED
;

3790 
	`iwl_å™s_pcõ_c›y_imr_fh
(
å™s
, 
d°_addr
, 
§c_addr
, 
byã_˙t
);

3791 
ªt
 = 
	`waô_evít_timeout
(
å™s_pcõ
->
imr_waôq
,

3792 
å™s_pcõ
->
imr_°©us
 !=

3793 
IMR_D2S_REQUESTED
, 5 * 
HZ
);

3794 i‡(!
ªt
 || 
å™s_pcõ
->
imr_°©us
 =
IMR_D2S_ERROR
) {

3795 
	`IWL_ERR
(
å™s
, "FailedÅo copy IMR Memory chunk!\n");

3796 
	`iwl_å™s_pcõ_dump_ªgs
(
å™s
);

3797  -
ETIMEDOUT
;

3799 
å™s_pcõ
->
imr_°©us
 = 
IMR_D2S_IDLE
;

3801 
	}
}

	@pcie/tx-gen2.c

6 
	~<√t/tso.h
>

7 
	~<löux/t˝.h
>

9 
	~"iwl-debug.h
"

10 
	~"iwl-c§.h
"

11 
	~"iwl-io.h
"

12 
	~"öã∫Æ.h
"

13 
	~"fw/≠i/tx.h
"

14 
	~"queue/tx.h
"

27 
	$iwl_pcõ_gí2_íqueue_hcmd
(
iwl_å™s
 *
å™s
,

28 
iwl_ho°_cmd
 *
cmd
)

30 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

31 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[å™s->txqs.
cmd
.
q_id
];

32 
iwl_devi˚_cmd
 *
out_cmd
;

33 
iwl_cmd_mëa
 *
out_mëa
;

34 *
dup_buf
 = 
NULL
;

35 
dma_addr_t
 
phys_addr
;

36 
i
, 
cmd_pos
, 
idx
;

37 
u16
 
c›y_size
, 
cmd_size
, 
tb0_size
;

38 
boﬁ
 
had_noc›y
 = 
Ál£
;

39 
u8
 
group_id
 = 
	`iwl_cmd_groupid
(
cmd
->
id
);

40 c⁄° 
u8
 *
cmdd©a
[
IWL_MAX_CMD_TBS_PER_TFD
];

41 
u16
 
cmdÀn
[
IWL_MAX_CMD_TBS_PER_TFD
];

42 
iwl_tfh_tfd
 *
tfd
;

43 
Êags
;

45 i‡(
	`WARN_ON
(
cmd
->
Êags
 & 
CMD_BLOCK_TXQS
))

46  -
EINVAL
;

48 
c›y_size
 = (
iwl_cmd_hódî_wide
);

49 
cmd_size
 = (
iwl_cmd_hódî_wide
);

51 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

52 
cmdd©a
[
i
] = 
cmd
->
d©a
[i];

53 
cmdÀn
[
i
] = 
cmd
->
Àn
[i];

55 i‡(!
cmd
->
Àn
[
i
])

59 i‡(
c›y_size
 < 
IWL_FIRST_TB_SIZE
) {

60 
c›y
 = 
IWL_FIRST_TB_SIZE
 - 
c›y_size
;

62 i‡(
c›y
 > 
cmdÀn
[
i
])

63 
c›y
 = 
cmdÀn
[
i
];

64 
cmdÀn
[
i
] -
c›y
;

65 
cmdd©a
[
i
] +
c›y
;

66 
c›y_size
 +
c›y
;

69 i‡(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_NOCOPY
) {

70 
had_noc›y
 = 
åue
;

71 i‡(
	`WARN_ON
(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_DUP
)) {

72 
idx
 = -
EINVAL
;

73 
‰ì_dup_buf
;

75 } i‡(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_DUP
) {

80 
had_noc›y
 = 
åue
;

83 i‡(
	`WARN_ON
(
dup_buf
)) {

84 
idx
 = -
EINVAL
;

85 
‰ì_dup_buf
;

88 
dup_buf
 = 
	`kmemdup
(
cmdd©a
[
i
], 
cmdÀn
[i],

89 
GFP_ATOMIC
);

90 i‡(!
dup_buf
)

91  -
ENOMEM
;

94 i‡(
	`WARN_ON
(
had_noc›y
)) {

95 
idx
 = -
EINVAL
;

96 
‰ì_dup_buf
;

98 
c›y_size
 +
cmdÀn
[
i
];

100 
cmd_size
 +
cmd
->
Àn
[
i
];

108 i‡(
	`WARN
(
c›y_size
 > 
TFD_MAX_PAYLOAD_SIZE
,

110 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd
->
id
), cmd->id, 
c›y_size
)) {

111 
idx
 = -
EINVAL
;

112 
‰ì_dup_buf
;

115 
	`•ö_lock_úqßve
(&
txq
->
lock
, 
Êags
);

117 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

118 
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
,Åxq->
wrôe_±r
);

119 
	`mem£t
(
tfd
, 0, (*tfd));

121 i‡(
	`iwl_txq_•a˚
(
å™s
, 
txq
Ë< ((
cmd
->
Êags
 & 
CMD_ASYNC
) ? 2 : 1)) {

122 
	`•ö_u∆ock_úqª°‹e
(&
txq
->
lock
, 
Êags
);

124 
	`IWL_ERR
(
å™s
, "No space in command queue\n");

125 
	`iwl_›_mode_cmd_queue_fuŒ
(
å™s
->
›_mode
);

126 
idx
 = -
ENOSPC
;

127 
‰ì_dup_buf
;

130 
out_cmd
 = 
txq
->
íåõs
[
idx
].
cmd
;

131 
out_mëa
 = &
txq
->
íåõs
[
idx
].
mëa
;

134 
	`mem£t
(
out_mëa
, 0, (*out_meta));

135 i‡(
cmd
->
Êags
 & 
CMD_WANT_SKB
)

136 
out_mëa
->
sour˚
 = 
cmd
;

139 
out_cmd
->
hdr_wide
.
cmd
 = 
	`iwl_cmd_›code
(cmd->
id
);

140 
out_cmd
->
hdr_wide
.
group_id
 = group_id;

141 
out_cmd
->
hdr_wide
.
vîsi⁄
 = 
	`iwl_cmd_vîsi⁄
(
cmd
->
id
);

142 
out_cmd
->
hdr_wide
.
Àngth
 =

143 
	`˝u_to_À16
(
cmd_size
 - (
iwl_cmd_hódî_wide
));

144 
out_cmd
->
hdr_wide
.
ª£rved
 = 0;

145 
out_cmd
->
hdr_wide
.
£quí˚
 =

146 
	`˝u_to_À16
(
	`QUEUE_TO_SEQ
(
å™s
->
txqs
.
cmd
.
q_id
) |

147 
	`INDEX_TO_SEQ
(
txq
->
wrôe_±r
));

149 
cmd_pos
 = (
iwl_cmd_hódî_wide
);

150 
c›y_size
 = (
iwl_cmd_hódî_wide
);

153 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

154 
c›y
;

156 i‡(!
cmd
->
Àn
[
i
])

160 i‡(!(
cmd
->
d©aÊags
[
i
] & (
IWL_HCMD_DFL_NOCOPY
 |

161 
IWL_HCMD_DFL_DUP
))) {

162 
c›y
 = 
cmd
->
Àn
[
i
];

164 
	`mem˝y
((
u8
 *)
out_cmd
 + 
cmd_pos
, 
cmd
->
d©a
[
i
], 
c›y
);

165 
cmd_pos
 +
c›y
;

166 
c›y_size
 +
c›y
;

175 
c›y
 = 
	`mö_t
(, 
TFD_MAX_PAYLOAD_SIZE
 - 
cmd_pos
, 
cmd
->
Àn
[
i
]);

177 
	`mem˝y
((
u8
 *)
out_cmd
 + 
cmd_pos
, 
cmd
->
d©a
[
i
], 
c›y
);

178 
cmd_pos
 +
c›y
;

181 i‡(
c›y_size
 < 
IWL_FIRST_TB_SIZE
) {

182 
c›y
 = 
IWL_FIRST_TB_SIZE
 - 
c›y_size
;

184 i‡(
c›y
 > 
cmd
->
Àn
[
i
])

185 
c›y
 = 
cmd
->
Àn
[
i
];

186 
c›y_size
 +
c›y
;

190 
	`IWL_DEBUG_HC
(
å™s
,

192 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd
->
id
), 
group_id
,

193 
out_cmd
->
hdr
.
cmd
, 
	`À16_to_˝u
(out_cmd->hdr.
£quí˚
),

194 
cmd_size
, 
txq
->
wrôe_±r
, 
idx
, 
å™s
->
txqs
.
cmd
.
q_id
);

197 
tb0_size
 = 
	`mö_t
(, 
c›y_size
, 
IWL_FIRST_TB_SIZE
);

198 
	`mem˝y
(&
txq
->
fú°_tb_bufs
[
idx
], 
out_cmd
, 
tb0_size
);

199 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
	`iwl_txq_gë_fú°_tb_dma
(
txq
, 
idx
),

200 
tb0_size
);

203 i‡(
c›y_size
 > 
tb0_size
) {

204 
phys_addr
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
,

205 (
u8
 *)
out_cmd
 + 
tb0_size
,

206 
c›y_size
 - 
tb0_size
,

207 
DMA_TO_DEVICE
);

208 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
phys_addr
)) {

209 
idx
 = -
ENOMEM
;

210 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, 
out_mëa
, 
tfd
);

211 
out
;

213 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
phys_addr
,

214 
c›y_size
 - 
tb0_size
);

218 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

219 *
d©a
 = (*)(
uöçå_t
)
cmdd©a
[
i
];

221 i‡(!
cmdÀn
[
i
])

223 i‡(!(
cmd
->
d©aÊags
[
i
] & (
IWL_HCMD_DFL_NOCOPY
 |

224 
IWL_HCMD_DFL_DUP
)))

226 i‡(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_DUP
)

227 
d©a
 = 
dup_buf
;

228 
phys_addr
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
d©a
,

229 
cmdÀn
[
i
], 
DMA_TO_DEVICE
);

230 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
phys_addr
)) {

231 
idx
 = -
ENOMEM
;

232 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, 
out_mëa
, 
tfd
);

233 
out
;

235 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
phys_addr
, 
cmdÀn
[
i
]);

238 
	`BUILD_BUG_ON
(
IWL_TFH_NUM_TBS
 > (
out_mëa
->
tbs
Ë* 
BITS_PER_BYTE
);

239 
out_mëa
->
Êags
 = 
cmd
->flags;

240 i‡(
	`WARN_ON_ONCE
(
txq
->
íåõs
[
idx
].
‰ì_buf
))

241 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
idx
].
‰ì_buf
);

242 
txq
->
íåõs
[
idx
].
‰ì_buf
 = 
dup_buf
;

244 
	`åa˚_iwlwifi_dev_hcmd
(
å™s
->
dev
, 
cmd
, 
cmd_size
, &
out_cmd
->
hdr_wide
);

247 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
 &&Åxq->
wd_timeout
)

248 
	`mod_timî
(&
txq
->
°uck_timî
, 
jiffõs
 +Åxq->
wd_timeout
);

250 
	`•ö_lock
(&
å™s_pcõ
->
ªg_lock
);

252 
txq
->
wrôe_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->write_ptr);

253 
	`iwl_txq_öc_wr_±r
(
å™s
, 
txq
);

254 
	`•ö_u∆ock
(&
å™s_pcõ
->
ªg_lock
);

256 
out
:

257 
	`•ö_u∆ock_úqª°‹e
(&
txq
->
lock
, 
Êags
);

258 
‰ì_dup_buf
:

259 i‡(
idx
 < 0)

260 
	`k‰ì
(
dup_buf
);

261  
idx
;

262 
	}
}

	@pcie/tx.c

7 
	~<löux/ëhîdevi˚.h
>

8 
	~<löux/õì80211.h
>

9 
	~<löux/¶ab.h
>

10 
	~<löux/sched.h
>

11 
	~<√t/ù6_checksum.h
>

12 
	~<√t/tso.h
>

14 
	~"iwl-debug.h
"

15 
	~"iwl-c§.h
"

16 
	~"iwl-¥ph.h
"

17 
	~"iwl-io.h
"

18 
	~"iwl-scd.h
"

19 
	~"iwl-›-mode.h
"

20 
	~"öã∫Æ.h
"

21 
	~"fw/≠i/tx.h
"

46 
	$iwl_pcõ_Æloc_dma_±r
(
iwl_å™s
 *
å™s
,

47 
iwl_dma_±r
 *
±r
, 
size_t
 
size
)

49 i‡(
	`WARN_ON
(
±r
->
addr
))

50  -
EINVAL
;

52 
±r
->
addr
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
size
,

53 &
±r
->
dma
, 
GFP_KERNEL
);

54 i‡(!
±r
->
addr
)

55  -
ENOMEM
;

56 
±r
->
size
 = size;

58 
	}
}

60 
	$iwl_pcõ_‰ì_dma_±r
(
iwl_å™s
 *
å™s
, 
iwl_dma_±r
 *
±r
)

62 i‡(
	`u∆ikñy
(!
±r
->
addr
))

65 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
±r
->
size
,Öå->
addr
,Öå->
dma
);

66 
	`mem£t
(
±r
, 0, (*ptr));

67 
	}
}

72 
	$iwl_pcõ_txq_öc_wr_±r
(
iwl_å™s
 *
å™s
,

73 
iwl_txq
 *
txq
)

75 
u32
 
ªg
 = 0;

76 
txq_id
 = 
txq
->
id
;

78 
	`lockdï_as£π_hñd
(&
txq
->
lock
);

86 i‡(!
å™s
->
å™s_cfg
->
ba£_∑øms
->
shadow_ªg_íabÀ
 &&

87 
txq_id
 !
å™s
->
txqs
.
cmd
.
q_id
 &&

88 
	`ã°_bô
(
STATUS_TPOWER_PMI
, &
å™s
->
°©us
)) {

94 
ªg
 = 
	`iwl_ªad32
(
å™s
, 
CSR_UCODE_DRV_GP1
);

96 i‡(
ªg
 & 
CSR_UCODE_DRV_GP1_BIT_MAC_SLEEP
) {

97 
	`IWL_DEBUG_INFO
(
å™s
, "Tx queue %dÑequesting wakeup, GP1 = 0x%x\n",

98 
txq_id
, 
ªg
);

99 
	`iwl_£t_bô
(
å™s
, 
CSR_GP_CNTRL
,

100 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

101 
txq
->
√ed_upd©e
 = 
åue
;

110 
	`IWL_DEBUG_TX
(
å™s
, "Q:%d WR: 0x%x\n", 
txq_id
, 
txq
->
wrôe_±r
);

111 i‡(!
txq
->
block
)

112 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_WRPTR
,

113 
txq
->
wrôe_±r
 | (
txq_id
 << 8));

114 
	}
}

116 
	$iwl_pcõ_txq_check_wΩås
(
iwl_å™s
 *
å™s
)

118 
i
;

120 
i
 = 0; i < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
; i++) {

121 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
i
];

123 i‡(!
	`ã°_bô
(
i
, 
å™s
->
txqs
.
queue_u£d
))

126 
	`•ö_lock_bh
(&
txq
->
lock
);

127 i‡(
txq
->
√ed_upd©e
) {

128 
	`iwl_pcõ_txq_öc_wr_±r
(
å™s
, 
txq
);

129 
txq
->
√ed_upd©e
 = 
Ál£
;

131 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

133 
	}
}

135 
	$iwl_pcõ_txq_buûd_tfd
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
,

136 
dma_addr_t
 
addr
, 
u16
 
Àn
, 
boﬁ
 
ª£t
)

138 *
tfd
;

139 
u32
 
num_tbs
;

141 
tfd
 = (
u8
 *)
txq
->
tfds
 + 
å™s
->
txqs
.tfd.
size
 *Åxq->
wrôe_±r
;

143 i‡(
ª£t
)

144 
	`mem£t
(
tfd
, 0, 
å™s
->
txqs
.tfd.
size
);

146 
num_tbs
 = 
	`iwl_txq_gí1_tfd_gë_num_tbs
(
å™s
, 
tfd
);

149 i‡(
num_tbs
 >
å™s
->
txqs
.
tfd
.
max_tbs
) {

150 
	`IWL_ERR
(
å™s
, "Error canÇot send moreÅhan %d chunks\n",

151 
å™s
->
txqs
.
tfd
.
max_tbs
);

152  -
EINVAL
;

155 i‡(
	`WARN
(
addr
 & ~
IWL_TX_DMA_MASK
,

156 "U«lig√dáddªs†%Œx\n", ()
addr
))

157  -
EINVAL
;

159 
	`iwl_pcõ_gí1_tfd_£t_tb
(
å™s
, 
tfd
, 
num_tbs
, 
addr
, 
Àn
);

161  
num_tbs
;

162 
	}
}

164 
	$iwl_pcõ_˛ór_cmd_ö_Êight
(
iwl_å™s
 *
å™s
)

166 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

168 i‡(!
å™s
->
å™s_cfg
->
ba£_∑øms
->
≠mg_wake_up_wa
)

171 
	`•ö_lock
(&
å™s_pcõ
->
ªg_lock
);

173 i‡(
	`WARN_ON
(!
å™s_pcõ
->
cmd_hﬁd_nic_awake
)) {

174 
	`•ö_u∆ock
(&
å™s_pcõ
->
ªg_lock
);

178 
å™s_pcõ
->
cmd_hﬁd_nic_awake
 = 
Ál£
;

179 
	`__iwl_å™s_pcõ_˛ór_bô
(
å™s
, 
CSR_GP_CNTRL
,

180 
CSR_GP_CNTRL_REG_FLAG_MAC_ACCESS_REQ
);

181 
	`•ö_u∆ock
(&
å™s_pcõ
->
ªg_lock
);

182 
	}
}

187 
	$iwl_pcõ_txq_unm≠
(
iwl_å™s
 *
å™s
, 
txq_id
)

189 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

191 i‡(!
txq
) {

192 
	`IWL_ERR
(
å™s
, "TryingÅo freeá queueÅhat wasn'tállocated?\n");

196 
	`•ö_lock_bh
(&
txq
->
lock
);

197 
txq
->
wrôe_±r
 !txq->
ªad_±r
) {

198 
	`IWL_DEBUG_TX_REPLY
(
å™s
, "Q %d Free %d\n",

199 
txq_id
, 
txq
->
ªad_±r
);

201 i‡(
txq_id
 !
å™s
->
txqs
.
cmd
.
q_id
) {

202 
sk_buff
 *
skb
 = 
txq
->
íåõs
[txq->
ªad_±r
].skb;

204 i‡(
	`WARN_ON_ONCE
(!
skb
))

207 
	`iwl_txq_‰ì_tso_∑ge
(
å™s
, 
skb
);

209 
	`iwl_txq_‰ì_tfd
(
å™s
, 
txq
);

210 
txq
->
ªad_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->read_ptr);

212 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
 &&

213 
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
)

214 
	`iwl_pcõ_˛ór_cmd_ö_Êight
(
å™s
);

217 !
	`skb_queue_em±y
(&
txq
->
ovîÊow_q
)) {

218 
sk_buff
 *
skb
 = 
	`__skb_dequeue
(&
txq
->
ovîÊow_q
);

220 
	`iwl_›_mode_‰ì_skb
(
å™s
->
›_mode
, 
skb
);

223 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

226 
	`iwl_wake_queue
(
å™s
, 
txq
);

227 
	}
}

237 
	$iwl_pcõ_txq_‰ì
(
iwl_å™s
 *
å™s
, 
txq_id
)

239 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

240 
devi˚
 *
dev
 = 
å™s
->dev;

241 
i
;

243 i‡(
	`WARN_ON
(!
txq
))

246 
	`iwl_pcõ_txq_unm≠
(
å™s
, 
txq_id
);

249 i‡(
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
)

250 
i
 = 0; i < 
txq
->
n_wödow
; i++) {

251 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
i
].
cmd
);

252 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
i
].
‰ì_buf
);

256 i‡(
txq
->
tfds
) {

257 
	`dma_‰ì_cohîít
(
dev
,

258 
å™s
->
txqs
.
tfd
.
size
 *

259 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
,

260 
txq
->
tfds
,Åxq->
dma_addr
);

261 
txq
->
dma_addr
 = 0;

262 
txq
->
tfds
 = 
NULL
;

264 
	`dma_‰ì_cohîít
(
dev
,

265 (*
txq
->
fú°_tb_bufs
Ë*Åxq->
n_wödow
,

266 
txq
->
fú°_tb_bufs
,Åxq->
fú°_tb_dma
);

269 
	`k‰ì
(
txq
->
íåõs
);

270 
txq
->
íåõs
 = 
NULL
;

272 
	`dñ_timî_sync
(&
txq
->
°uck_timî
);

275 
	`mem£t
(
txq
, 0, (*txq));

276 
	}
}

278 
	$iwl_pcõ_tx_°¨t
(
iwl_å™s
 *
å™s
, 
u32
 
scd_ba£_addr
)

280 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

281 
nq
 = 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

282 
ch™
;

283 
u32
 
ªg_vÆ
;

284 
˛ór_dw‹ds
 = (
	`SCD_TRANS_TBL_OFFSET_QUEUE
(
nq
) -

285 
SCD_CONTEXT_MEM_LOWER_BOUND
Ë/ (
u32
);

288 
	`mem£t
(
å™s
->
txqs
.
queue_°›≥d
, 0,

289 (
å™s
->
txqs
.
queue_°›≥d
));

290 
	`mem£t
(
å™s
->
txqs
.
queue_u£d
, 0, (trans->txqs.queue_used));

292 
å™s_pcõ
->
scd_ba£_addr
 =

293 
	`iwl_ªad_¥ph
(
å™s
, 
SCD_SRAM_BASE_ADDR
);

295 
	`WARN_ON
(
scd_ba£_addr
 != 0 &&

296 
scd_ba£_addr
 !
å™s_pcõ
->scd_base_addr);

299 
	`iwl_å™s_wrôe_mem
(
å™s
, 
å™s_pcõ
->
scd_ba£_addr
 +

300 
SCD_CONTEXT_MEM_LOWER_BOUND
,

301 
NULL
, 
˛ór_dw‹ds
);

303 
	`iwl_wrôe_¥ph
(
å™s
, 
SCD_DRAM_BASE_ADDR
,

304 
å™s
->
txqs
.
scd_bc_tbls
.
dma
 >> 10);

309 i‡(
å™s
->
å™s_cfg
->
ba£_∑øms
->
scd_chaö_ext_wa
)

310 
	`iwl_wrôe_¥ph
(
å™s
, 
SCD_CHAINEXT_EN
, 0);

312 
	`iwl_å™s_ac_txq_íabÀ
(
å™s
,Åøns->
txqs
.
cmd
.
q_id
,

313 
å™s
->
txqs
.
cmd
.
fifo
,

314 
å™s
->
txqs
.
cmd
.
wdg_timeout
);

317 
	`iwl_scd_a˘iv©e_fifos
(
å™s
);

320 
ch™
 = 0; ch™ < 
FH_TCSR_CHNL_NUM
; chan++)

321 
	`iwl_wrôe_dúe˘32
(
å™s
, 
	`FH_TCSR_CHNL_TX_CONFIG_REG
(
ch™
),

322 
FH_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_ENABLE
 |

323 
FH_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_ENABLE
);

326 
ªg_vÆ
 = 
	`iwl_ªad_dúe˘32
(
å™s
, 
FH_TX_CHICKEN_BITS_REG
);

327 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_TX_CHICKEN_BITS_REG
,

328 
ªg_vÆ
 | 
FH_TX_CHICKEN_BITS_SCD_AUTO_RETRY_EN
);

331 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_8000
)

332 
	`iwl_˛ór_bôs_¥ph
(
å™s
, 
APMG_PCIDEV_STT_REG
,

333 
APMG_PCIDEV_STT_VAL_L1_ACT_DIS
);

334 
	}
}

336 
	$iwl_å™s_pcõ_tx_ª£t
(
iwl_å™s
 *
å™s
)

338 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

339 
txq_id
;

345 i‡(
	`WARN_ON_ONCE
(
å™s
->
å™s_cfg
->
gí2
))

348 
txq_id
 = 0;Åxq_id < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

349 
txq_id
++) {

350 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

351 i‡(
å™s
->
å™s_cfg
->
gí2
)

352 
	`iwl_wrôe_dúe˘64
(
å™s
,

353 
	`FH_MEM_CBBC_QUEUE
(
å™s
, 
txq_id
),

354 
txq
->
dma_addr
);

356 
	`iwl_wrôe_dúe˘32
(
å™s
,

357 
	`FH_MEM_CBBC_QUEUE
(
å™s
, 
txq_id
),

358 
txq
->
dma_addr
 >> 8);

359 
	`iwl_pcõ_txq_unm≠
(
å™s
, 
txq_id
);

360 
txq
->
ªad_±r
 = 0;

361 
txq
->
wrôe_±r
 = 0;

365 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_KW_MEM_ADDR_REG
,

366 
å™s_pcõ
->
kw
.
dma
 >> 4);

373 
	`iwl_pcõ_tx_°¨t
(
å™s
, 0);

374 
	}
}

376 
	$iwl_pcõ_tx_°›_fh
(
iwl_å™s
 *
å™s
)

378 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

379 
ch
, 
ªt
;

380 
u32
 
mask
 = 0;

382 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

384 i‡(!
	`iwl_å™s_gøb_nic_ac˚ss
(
å™s
))

385 
out
;

388 
ch
 = 0; ch < 
FH_TCSR_CHNL_NUM
; ch++) {

389 
	`iwl_wrôe32
(
å™s
, 
	`FH_TCSR_CHNL_TX_CONFIG_REG
(
ch
), 0x0);

390 
mask
 |
	`FH_TSSR_TX_STATUS_REG_MSK_CHNL_IDLE
(
ch
);

394 
ªt
 = 
	`iwl_pﬁl_bô
(
å™s
, 
FH_TSSR_TX_STATUS_REG
, 
mask
, mask, 5000);

395 i‡(
ªt
 < 0)

396 
	`IWL_ERR
(
å™s
,

398 
ch
, 
	`iwl_ªad32
(
å™s
, 
FH_TSSR_TX_STATUS_REG
));

400 
	`iwl_å™s_ªÀa£_nic_ac˚ss
(
å™s
);

402 
out
:

403 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

404 
	}
}

409 
	$iwl_pcõ_tx_°›
(
iwl_å™s
 *
å™s
)

411 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

412 
txq_id
;

415 
	`iwl_scd_dó˘iv©e_fifos
(
å™s
);

418 
	`iwl_pcõ_tx_°›_fh
(
å™s
);

425 
	`mem£t
(
å™s
->
txqs
.
queue_°›≥d
, 0,

426 (
å™s
->
txqs
.
queue_°›≥d
));

427 
	`mem£t
(
å™s
->
txqs
.
queue_u£d
, 0, (trans->txqs.queue_used));

430 i‡(!
å™s_pcõ
->
txq_mem‹y
)

434 
txq_id
 = 0;Åxq_id < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

435 
txq_id
++)

436 
	`iwl_pcõ_txq_unm≠
(
å™s
, 
txq_id
);

439 
	}
}

446 
	$iwl_pcõ_tx_‰ì
(
iwl_å™s
 *
å™s
)

448 
txq_id
;

449 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

451 
	`mem£t
(
å™s
->
txqs
.
queue_u£d
, 0, (trans->txqs.queue_used));

454 i‡(
å™s_pcõ
->
txq_mem‹y
) {

455 
txq_id
 = 0;

456 
txq_id
 < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

457 
txq_id
++) {

458 
	`iwl_pcõ_txq_‰ì
(
å™s
, 
txq_id
);

459 
å™s
->
txqs
.
txq
[
txq_id
] = 
NULL
;

463 
	`k‰ì
(
å™s_pcõ
->
txq_mem‹y
);

464 
å™s_pcõ
->
txq_mem‹y
 = 
NULL
;

466 
	`iwl_pcõ_‰ì_dma_±r
(
å™s
, &
å™s_pcõ
->
kw
);

468 
	`iwl_pcõ_‰ì_dma_±r
(
å™s
, &å™s->
txqs
.
scd_bc_tbls
);

469 
	}
}

475 
	$iwl_pcõ_tx_Æloc
(
iwl_å™s
 *
å™s
)

477 
ªt
;

478 
txq_id
, 
¶Ÿs_num
;

479 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

480 
u16
 
bc_tbls_size
 = 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

482 i‡(
	`WARN_ON
(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
))

483  -
EINVAL
;

485 
bc_tbls_size
 *(
iwœgn_scd_bc_tbl
);

489 i‡(
	`WARN_ON
(
å™s_pcõ
->
txq_mem‹y
)) {

490 
ªt
 = -
EINVAL
;

491 
îr‹
;

494 
ªt
 = 
	`iwl_pcõ_Æloc_dma_±r
(
å™s
, &å™s->
txqs
.
scd_bc_tbls
,

495 
bc_tbls_size
);

496 i‡(
ªt
) {

497 
	`IWL_ERR
(
å™s
, "Scheduler BC Tableállocation failed\n");

498 
îr‹
;

502 
ªt
 = 
	`iwl_pcõ_Æloc_dma_±r
(
å™s
, &
å™s_pcõ
->
kw
, 
IWL_KW_SIZE
);

503 i‡(
ªt
) {

504 
	`IWL_ERR
(
å™s
, "Keep Warmállocation failed\n");

505 
îr‹
;

508 
å™s_pcõ
->
txq_mem‹y
 =

509 
	`kˇŒoc
(
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
,

510 (
iwl_txq
), 
GFP_KERNEL
);

511 i‡(!
å™s_pcõ
->
txq_mem‹y
) {

512 
	`IWL_ERR
(
å™s
, "NotÉnough memory forÅxq\n");

513 
ªt
 = -
ENOMEM
;

514 
îr‹
;

518 
txq_id
 = 0;Åxq_id < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

519 
txq_id
++) {

520 
boﬁ
 
cmd_queue
 = (
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
);

522 i‡(
cmd_queue
)

523 
¶Ÿs_num
 = 
	`max_t
(
u32
, 
IWL_CMD_QUEUE_SIZE
,

524 
å™s
->
cfg
->
mö_txq_size
);

526 
¶Ÿs_num
 = 
	`max_t
(
u32
, 
IWL_DEFAULT_QUEUE_SIZE
,

527 
å™s
->
cfg
->
mö_ba_txq_size
);

528 
å™s
->
txqs
.
txq
[
txq_id
] = &
å™s_pcõ
->
txq_mem‹y
[txq_id];

529 
ªt
 = 
	`iwl_txq_Æloc
(
å™s
,Åøns->
txqs
.
txq
[
txq_id
], 
¶Ÿs_num
,

530 
cmd_queue
);

531 i‡(
ªt
) {

532 
	`IWL_ERR
(
å™s
, "Tx %d queuêÆlo¯Áûed\n", 
txq_id
);

533 
îr‹
;

535 
å™s
->
txqs
.
txq
[
txq_id
]->
id
 =Åxq_id;

540 
îr‹
:

541 
	`iwl_pcõ_tx_‰ì
(
å™s
);

543  
ªt
;

544 
	}
}

546 
	$iwl_pcõ_tx_öô
(
iwl_å™s
 *
å™s
)

548 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

549 
ªt
;

550 
txq_id
, 
¶Ÿs_num
;

551 
boﬁ
 
Æloc
 = 
Ál£
;

553 i‡(!
å™s_pcõ
->
txq_mem‹y
) {

554 
ªt
 = 
	`iwl_pcõ_tx_Æloc
(
å™s
);

555 i‡(
ªt
)

556 
îr‹
;

557 
Æloc
 = 
åue
;

560 
	`•ö_lock_bh
(&
å™s_pcõ
->
úq_lock
);

563 
	`iwl_scd_dó˘iv©e_fifos
(
å™s
);

566 
	`iwl_wrôe_dúe˘32
(
å™s
, 
FH_KW_MEM_ADDR_REG
,

567 
å™s_pcõ
->
kw
.
dma
 >> 4);

569 
	`•ö_u∆ock_bh
(&
å™s_pcõ
->
úq_lock
);

572 
txq_id
 = 0;Åxq_id < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
;

573 
txq_id
++) {

574 
boﬁ
 
cmd_queue
 = (
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
);

576 i‡(
cmd_queue
)

577 
¶Ÿs_num
 = 
	`max_t
(
u32
, 
IWL_CMD_QUEUE_SIZE
,

578 
å™s
->
cfg
->
mö_txq_size
);

580 
¶Ÿs_num
 = 
	`max_t
(
u32
, 
IWL_DEFAULT_QUEUE_SIZE
,

581 
å™s
->
cfg
->
mö_ba_txq_size
);

582 
ªt
 = 
	`iwl_txq_öô
(
å™s
,Åøns->
txqs
.
txq
[
txq_id
], 
¶Ÿs_num
,

583 
cmd_queue
);

584 i‡(
ªt
) {

585 
	`IWL_ERR
(
å™s
, "Tx %d queuêöô faûed\n", 
txq_id
);

586 
îr‹
;

595 
	`iwl_wrôe_dúe˘32
(
å™s
, 
	`FH_MEM_CBBC_QUEUE
—øns, 
txq_id
),

596 
å™s
->
txqs
.
txq
[
txq_id
]->
dma_addr
 >> 8);

599 
	`iwl_£t_bôs_¥ph
(
å™s
, 
SCD_GP_CTRL
, 
SCD_GP_CTRL_AUTO_ACTIVE_MODE
);

600 i‡(
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
 > 20)

601 
	`iwl_£t_bôs_¥ph
(
å™s
, 
SCD_GP_CTRL
,

602 
SCD_GP_CTRL_ENABLE_31_QUEUES
);

605 
îr‹
:

607 i‡(
Æloc
)

608 
	`iwl_pcõ_tx_‰ì
(
å™s
);

609  
ªt
;

610 
	}
}

612 
	$iwl_pcõ_£t_cmd_ö_Êight
(
iwl_å™s
 *
å™s
,

613 c⁄° 
iwl_ho°_cmd
 *
cmd
)

615 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

618 i‡(
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
å™s
->
°©us
))

619  -
ENODEV
;

621 i‡(!
å™s
->
å™s_cfg
->
ba£_∑øms
->
≠mg_wake_up_wa
)

630 i‡(!
	`_iwl_å™s_pcõ_gøb_nic_ac˚ss
(
å™s
))

631  -
EIO
;

638 
å™s_pcõ
->
cmd_hﬁd_nic_awake
 = 
åue
;

639 
	`•ö_u∆ock
(&
å™s_pcõ
->
ªg_lock
);

642 
	}
}

651 
	$iwl_pcõ_cmdq_ª˛aim
(
iwl_å™s
 *
å™s
, 
txq_id
, 
idx
)

653 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

654 
n‰ìd
 = 0;

655 
u16
 
r
;

657 
	`lockdï_as£π_hñd
(&
txq
->
lock
);

659 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
, idx);

660 
r
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
ªad_±r
);

662 i‡(
idx
 >
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 ||

663 (!
	`iwl_txq_u£d
(
txq
, 
idx
))) {

664 
	`WARN_ONCE
(
	`ã°_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
),

666 
__func__
, 
txq_id
, 
idx
,

667 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
,

668 
txq
->
wrôe_±r
,Åxq->
ªad_±r
);

672 
idx
 = 
	`iwl_txq_öc_wøp
(
å™s
, idx); 
r
 != idx;

673 
r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Ñ)) {

674 
txq
->
ªad_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->read_ptr);

676 i‡(
n‰ìd
++ > 0) {

677 
	`IWL_ERR
(
å™s
, "HCMD skipped: index (%d) %d %d\n",

678 
idx
, 
txq
->
wrôe_±r
, 
r
);

679 
	`iwl_f‹˚_nmi
(
å™s
);

683 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
)

684 
	`iwl_pcõ_˛ór_cmd_ö_Êight
(
å™s
);

686 
	`iwl_txq_¥ogªss
(
txq
);

687 
	}
}

689 
	$iwl_pcõ_txq_£t_øtid_m≠
(
iwl_å™s
 *
å™s
, 
u16
 
ø_tid
,

690 
u16
 
txq_id
)

692 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

693 
u32
 
tbl_dw_addr
;

694 
u32
 
tbl_dw
;

695 
u16
 
scd_q2øtid
;

697 
scd_q2øtid
 = 
ø_tid
 & 
SCD_QUEUE_RA_TID_MAP_RATID_MSK
;

699 
tbl_dw_addr
 = 
å™s_pcõ
->
scd_ba£_addr
 +

700 
	`SCD_TRANS_TBL_OFFSET_QUEUE
(
txq_id
);

702 
tbl_dw
 = 
	`iwl_å™s_ªad_mem32
(
å™s
, 
tbl_dw_addr
);

704 i‡(
txq_id
 & 0x1)

705 
tbl_dw
 = (
scd_q2øtid
 << 16) | (tbl_dw & 0x0000FFFF);

707 
tbl_dw
 = 
scd_q2øtid
 | (tbl_dw & 0xFFFF0000);

709 
	`iwl_å™s_wrôe_mem32
(
å™s
, 
tbl_dw_addr
, 
tbl_dw
);

712 
	}
}

716 
	#BUILD_RAxTID
(
°a_id
, 
tid
Ë(((°a_idË<< 4Ë+ (tid))

	)

718 
boﬁ
 
	$iwl_å™s_pcõ_txq_íabÀ
(
iwl_å™s
 *
å™s
, 
txq_id
, 
u16
 
s¢
,

719 c⁄° 
iwl_å™s_txq_scd_cfg
 *
cfg
,

720 
wdg_timeout
)

722 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

723 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

724 
fifo
 = -1;

725 
boﬁ
 
scd_bug
 = 
Ál£
;

727 i‡(
	`ã°_™d_£t_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
))

728 
	`WARN_ONCE
(1, "queuê%dáÃódy u£d -Éx≥˘ issues", 
txq_id
);

730 
txq
->
wd_timeout
 = 
	`m£cs_to_jiffõs
(
wdg_timeout
);

732 i‡(
cfg
) {

733 
fifo
 = 
cfg
->fifo;

736 i‡(
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
 &&

737 
å™s_pcõ
->
scd_£t_a˘ive
)

738 
	`iwl_scd_íabÀ_£t_a˘ive
(
å™s
, 0);

741 
	`iwl_scd_txq_£t_öa˘ive
(
å™s
, 
txq_id
);

744 i‡(
txq_id
 !
å™s
->
txqs
.
cmd
.
q_id
)

745 
	`iwl_scd_txq_£t_chaö
(
å™s
, 
txq_id
);

747 i‡(
cfg
->
aggªg©e
) {

748 
u16
 
ø_tid
 = 
	`BUILD_RAxTID
(
cfg
->
°a_id
, cfg->
tid
);

751 
	`iwl_pcõ_txq_£t_øtid_m≠
(
å™s
, 
ø_tid
, 
txq_id
);

754 
	`iwl_scd_txq_íabÀ_agg
(
å™s
, 
txq_id
);

755 
txq
->
ampdu
 = 
åue
;

762 
	`iwl_scd_txq_dißbÀ_agg
(
å™s
, 
txq_id
);

764 
s¢
 = 
txq
->
ªad_±r
;

778 
scd_bug
 = !
å™s
->
å™s_cfg
->
mq_rx_suµ‹ãd
 &&

779 !((
s¢
 - 
txq
->
wrôe_±r
) & 0x3f) &&

780 (
s¢
 !
txq
->
wrôe_±r
);

781 i‡(
scd_bug
)

782 
s¢
++;

787 
txq
->
ªad_±r
 = (
s¢
 & 0xff);

788 
txq
->
wrôe_±r
 = (
s¢
 & 0xff);

789 
	`iwl_wrôe_dúe˘32
(
å™s
, 
HBUS_TARG_WRPTR
,

790 (
s¢
 & 0xffË| (
txq_id
 << 8));

792 i‡(
cfg
) {

793 
u8
 
‰ame_limô
 = 
cfg
->frame_limit;

795 
	`iwl_wrôe_¥ph
(
å™s
, 
	`SCD_QUEUE_RDPTR
(
txq_id
), 
s¢
);

798 
	`iwl_å™s_wrôe_mem32
(
å™s
, 
å™s_pcõ
->
scd_ba£_addr
 +

799 
	`SCD_CONTEXT_QUEUE_OFFSET
(
txq_id
), 0);

800 
	`iwl_å™s_wrôe_mem32
(
å™s
,

801 
å™s_pcõ
->
scd_ba£_addr
 +

802 
	`SCD_CONTEXT_QUEUE_OFFSET
(
txq_id
Ë+ (
u32
),

803 
	`SCD_QUEUE_CTX_REG2_VAL
(
WIN_SIZE
, 
‰ame_limô
) |

804 
	`SCD_QUEUE_CTX_REG2_VAL
(
FRAME_LIMIT
, 
‰ame_limô
));

807 
	`iwl_wrôe_¥ph
(
å™s
, 
	`SCD_QUEUE_STATUS_BITS
(
txq_id
),

808 (1 << 
SCD_QUEUE_STTS_REG_POS_ACTIVE
) |

809 (
cfg
->
fifo
 << 
SCD_QUEUE_STTS_REG_POS_TXF
) |

810 (1 << 
SCD_QUEUE_STTS_REG_POS_WSL
) |

811 
SCD_QUEUE_STTS_REG_MSK
);

814 i‡(
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
 &&

815 
å™s_pcõ
->
scd_£t_a˘ive
)

816 
	`iwl_scd_íabÀ_£t_a˘ive
(
å™s
, 
	`BIT
(
txq_id
));

818 
	`IWL_DEBUG_TX_QUEUES
(
å™s
,

820 
txq_id
, 
fifo
, 
s¢
 & 0xff);

822 
	`IWL_DEBUG_TX_QUEUES
(
å™s
,

824 
txq_id
, 
s¢
 & 0xff);

827  
scd_bug
;

828 
	}
}

830 
	$iwl_å™s_pcõ_txq_£t_sh¨ed_mode
(
iwl_å™s
 *
å™s
, 
u32
 
txq_id
,

831 
boﬁ
 
sh¨ed_mode
)

833 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

835 
txq
->
ampdu
 = !
sh¨ed_mode
;

836 
	}
}

838 
	$iwl_å™s_pcõ_txq_dißbÀ
(
iwl_å™s
 *
å™s
, 
txq_id
,

839 
boﬁ
 
c⁄figuª_scd
)

841 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

842 
u32
 
°ts_addr
 = 
å™s_pcõ
->
scd_ba£_addr
 +

843 
	`SCD_TX_STTS_QUEUE_OFFSET
(
txq_id
);

844 c⁄° 
u32
 
zîo_vÆ
[4] = {};

846 
å™s
->
txqs
.
txq
[
txq_id
]->
‰ozí_expúy_ªmaödî
 = 0;

847 
å™s
->
txqs
.
txq
[
txq_id
]->
‰ozí
 = 
Ál£
;

855 i‡(!
	`ã°_™d_˛ór_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
)) {

856 
	`WARN_ONCE
(
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
),

857 "queuê%dÇŸ u£d", 
txq_id
);

861 i‡(
c⁄figuª_scd
) {

862 
	`iwl_scd_txq_£t_öa˘ive
(
å™s
, 
txq_id
);

864 
	`iwl_å™s_wrôe_mem
(
å™s
, 
°ts_addr
, (c⁄° *)
zîo_vÆ
,

865 
	`ARRAY_SIZE
(
zîo_vÆ
));

868 
	`iwl_pcõ_txq_unm≠
(
å™s
, 
txq_id
);

869 
å™s
->
txqs
.
txq
[
txq_id
]->
ampdu
 = 
Ál£
;

871 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "Dó˘iv©êqueuê%d\n", 
txq_id
);

872 
	}
}

876 
	$iwl_å™s_pcõ_block_txq_±rs
(
iwl_å™s
 *
å™s
, 
boﬁ
 
block
)

878 
i
;

880 
i
 = 0; i < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
num_of_queues
; i++) {

881 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
i
];

883 i‡(
i
 =
å™s
->
txqs
.
cmd
.
q_id
)

887 
	`•ö_lock_√°ed
(&
txq
->
lock
, 1);

889 i‡(!
block
 && !(
	`WARN_ON_ONCE
(!
txq
->block))) {

890 
txq
->
block
--;

891 i‡(!
txq
->
block
) {

892 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_WRPTR
,

893 
txq
->
wrôe_±r
 | (
i
 << 8));

895 } i‡(
block
) {

896 
txq
->
block
++;

899 
	`•ö_u∆ock
(&
txq
->
lock
);

901 
	}
}

912 
	$iwl_pcõ_íqueue_hcmd
(
iwl_å™s
 *
å™s
,

913 
iwl_ho°_cmd
 *
cmd
)

915 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[å™s->txqs.
cmd
.
q_id
];

916 
iwl_devi˚_cmd
 *
out_cmd
;

917 
iwl_cmd_mëa
 *
out_mëa
;

918 *
dup_buf
 = 
NULL
;

919 
dma_addr_t
 
phys_addr
;

920 
idx
;

921 
u16
 
c›y_size
, 
cmd_size
, 
tb0_size
;

922 
boﬁ
 
had_noc›y
 = 
Ál£
;

923 
u8
 
group_id
 = 
	`iwl_cmd_groupid
(
cmd
->
id
);

924 
i
, 
ªt
;

925 
u32
 
cmd_pos
;

926 c⁄° 
u8
 *
cmdd©a
[
IWL_MAX_CMD_TBS_PER_TFD
];

927 
u16
 
cmdÀn
[
IWL_MAX_CMD_TBS_PER_TFD
];

928 
Êags
;

930 i‡(
	`WARN
(!
å™s
->
wide_cmd_hódî
 &&

931 
group_id
 > 
IWL_ALWAYS_LONG_GROUP
,

932 "unsuµ‹ãd widêcomm™d %#x\n", 
cmd
->
id
))

933  -
EINVAL
;

935 i‡(
group_id
 != 0) {

936 
c›y_size
 = (
iwl_cmd_hódî_wide
);

937 
cmd_size
 = (
iwl_cmd_hódî_wide
);

939 
c›y_size
 = (
iwl_cmd_hódî
);

940 
cmd_size
 = (
iwl_cmd_hódî
);

944 
	`BUILD_BUG_ON
(
IWL_MAX_CMD_TBS_PER_TFD
 > 
IWL_NUM_OF_TBS
 - 1);

946 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

947 
cmdd©a
[
i
] = 
cmd
->
d©a
[i];

948 
cmdÀn
[
i
] = 
cmd
->
Àn
[i];

950 i‡(!
cmd
->
Àn
[
i
])

954 i‡(
c›y_size
 < 
IWL_FIRST_TB_SIZE
) {

955 
c›y
 = 
IWL_FIRST_TB_SIZE
 - 
c›y_size
;

957 i‡(
c›y
 > 
cmdÀn
[
i
])

958 
c›y
 = 
cmdÀn
[
i
];

959 
cmdÀn
[
i
] -
c›y
;

960 
cmdd©a
[
i
] +
c›y
;

961 
c›y_size
 +
c›y
;

964 i‡(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_NOCOPY
) {

965 
had_noc›y
 = 
åue
;

966 i‡(
	`WARN_ON
(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_DUP
)) {

967 
idx
 = -
EINVAL
;

968 
‰ì_dup_buf
;

970 } i‡(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_DUP
) {

975 
had_noc›y
 = 
åue
;

978 i‡(
	`WARN_ON
(
dup_buf
)) {

979 
idx
 = -
EINVAL
;

980 
‰ì_dup_buf
;

983 
dup_buf
 = 
	`kmemdup
(
cmdd©a
[
i
], 
cmdÀn
[i],

984 
GFP_ATOMIC
);

985 i‡(!
dup_buf
)

986  -
ENOMEM
;

989 i‡(
	`WARN_ON
(
had_noc›y
)) {

990 
idx
 = -
EINVAL
;

991 
‰ì_dup_buf
;

993 
c›y_size
 +
cmdÀn
[
i
];

995 
cmd_size
 +
cmd
->
Àn
[
i
];

1004 i‡(
	`WARN
(
c›y_size
 > 
TFD_MAX_PAYLOAD_SIZE
,

1006 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd
->
id
),

1007 
cmd
->
id
, 
c›y_size
)) {

1008 
idx
 = -
EINVAL
;

1009 
‰ì_dup_buf
;

1012 
	`•ö_lock_úqßve
(&
txq
->
lock
, 
Êags
);

1014 i‡(
	`iwl_txq_•a˚
(
å™s
, 
txq
Ë< ((
cmd
->
Êags
 & 
CMD_ASYNC
) ? 2 : 1)) {

1015 
	`•ö_u∆ock_úqª°‹e
(&
txq
->
lock
, 
Êags
);

1017 
	`IWL_ERR
(
å™s
, "No space in command queue\n");

1018 
	`iwl_›_mode_cmd_queue_fuŒ
(
å™s
->
›_mode
);

1019 
idx
 = -
ENOSPC
;

1020 
‰ì_dup_buf
;

1023 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

1024 
out_cmd
 = 
txq
->
íåõs
[
idx
].
cmd
;

1025 
out_mëa
 = &
txq
->
íåõs
[
idx
].
mëa
;

1027 
	`mem£t
(
out_mëa
, 0, (*out_meta));

1028 i‡(
cmd
->
Êags
 & 
CMD_WANT_SKB
)

1029 
out_mëa
->
sour˚
 = 
cmd
;

1032 i‡(
group_id
 != 0) {

1033 
out_cmd
->
hdr_wide
.
cmd
 = 
	`iwl_cmd_›code
(cmd->
id
);

1034 
out_cmd
->
hdr_wide
.
group_id
 = group_id;

1035 
out_cmd
->
hdr_wide
.
vîsi⁄
 = 
	`iwl_cmd_vîsi⁄
(
cmd
->
id
);

1036 
out_cmd
->
hdr_wide
.
Àngth
 =

1037 
	`˝u_to_À16
(
cmd_size
 -

1038 (
iwl_cmd_hódî_wide
));

1039 
out_cmd
->
hdr_wide
.
ª£rved
 = 0;

1040 
out_cmd
->
hdr_wide
.
£quí˚
 =

1041 
	`˝u_to_À16
(
	`QUEUE_TO_SEQ
(
å™s
->
txqs
.
cmd
.
q_id
) |

1042 
	`INDEX_TO_SEQ
(
txq
->
wrôe_±r
));

1044 
cmd_pos
 = (
iwl_cmd_hódî_wide
);

1045 
c›y_size
 = (
iwl_cmd_hódî_wide
);

1047 
out_cmd
->
hdr
.
cmd
 = 
	`iwl_cmd_›code
(cmd->
id
);

1048 
out_cmd
->
hdr
.
£quí˚
 =

1049 
	`˝u_to_À16
(
	`QUEUE_TO_SEQ
(
å™s
->
txqs
.
cmd
.
q_id
) |

1050 
	`INDEX_TO_SEQ
(
txq
->
wrôe_±r
));

1051 
out_cmd
->
hdr
.
group_id
 = 0;

1053 
cmd_pos
 = (
iwl_cmd_hódî
);

1054 
c›y_size
 = (
iwl_cmd_hódî
);

1058 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

1059 
c›y
;

1061 i‡(!
cmd
->
Àn
[
i
])

1065 i‡(!(
cmd
->
d©aÊags
[
i
] & (
IWL_HCMD_DFL_NOCOPY
 |

1066 
IWL_HCMD_DFL_DUP
))) {

1067 
c›y
 = 
cmd
->
Àn
[
i
];

1069 
	`mem˝y
((
u8
 *)
out_cmd
 + 
cmd_pos
, 
cmd
->
d©a
[
i
], 
c›y
);

1070 
cmd_pos
 +
c›y
;

1071 
c›y_size
 +
c›y
;

1080 
c›y
 = 
	`mö_t
(, 
TFD_MAX_PAYLOAD_SIZE
 - 
cmd_pos
, 
cmd
->
Àn
[
i
]);

1082 
	`mem˝y
((
u8
 *)
out_cmd
 + 
cmd_pos
, 
cmd
->
d©a
[
i
], 
c›y
);

1083 
cmd_pos
 +
c›y
;

1086 i‡(
c›y_size
 < 
IWL_FIRST_TB_SIZE
) {

1087 
c›y
 = 
IWL_FIRST_TB_SIZE
 - 
c›y_size
;

1089 i‡(
c›y
 > 
cmd
->
Àn
[
i
])

1090 
c›y
 = 
cmd
->
Àn
[
i
];

1091 
c›y_size
 +
c›y
;

1095 
	`IWL_DEBUG_HC
(
å™s
,

1097 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd
->
id
),

1098 
group_id
, 
out_cmd
->
hdr
.
cmd
,

1099 
	`À16_to_˝u
(
out_cmd
->
hdr
.
£quí˚
),

1100 
cmd_size
, 
txq
->
wrôe_±r
, 
idx
, 
å™s
->
txqs
.
cmd
.
q_id
);

1103 
tb0_size
 = 
	`mö_t
(, 
c›y_size
, 
IWL_FIRST_TB_SIZE
);

1104 
	`mem˝y
(&
txq
->
fú°_tb_bufs
[
idx
], &
out_cmd
->
hdr
, 
tb0_size
);

1105 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
,

1106 
	`iwl_txq_gë_fú°_tb_dma
(
txq
, 
idx
),

1107 
tb0_size
, 
åue
);

1110 i‡(
c›y_size
 > 
tb0_size
) {

1111 
phys_addr
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
,

1112 ((
u8
 *)&
out_cmd
->
hdr
Ë+ 
tb0_size
,

1113 
c›y_size
 - 
tb0_size
,

1114 
DMA_TO_DEVICE
);

1115 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
phys_addr
)) {

1116 
	`iwl_txq_gí1_tfd_unm≠
(
å™s
, 
out_mëa
, 
txq
,

1117 
txq
->
wrôe_±r
);

1118 
idx
 = -
ENOMEM
;

1119 
out
;

1122 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
phys_addr
,

1123 
c›y_size
 - 
tb0_size
, 
Ál£
);

1127 
i
 = 0; i < 
IWL_MAX_CMD_TBS_PER_TFD
; i++) {

1128 *
d©a
 = (*)(
uöçå_t
)
cmdd©a
[
i
];

1130 i‡(!
cmdÀn
[
i
])

1132 i‡(!(
cmd
->
d©aÊags
[
i
] & (
IWL_HCMD_DFL_NOCOPY
 |

1133 
IWL_HCMD_DFL_DUP
)))

1135 i‡(
cmd
->
d©aÊags
[
i
] & 
IWL_HCMD_DFL_DUP
)

1136 
d©a
 = 
dup_buf
;

1137 
phys_addr
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
d©a
,

1138 
cmdÀn
[
i
], 
DMA_TO_DEVICE
);

1139 i‡(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
phys_addr
)) {

1140 
	`iwl_txq_gí1_tfd_unm≠
(
å™s
, 
out_mëa
, 
txq
,

1141 
txq
->
wrôe_±r
);

1142 
idx
 = -
ENOMEM
;

1143 
out
;

1146 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
phys_addr
, 
cmdÀn
[
i
], 
Ál£
);

1149 
	`BUILD_BUG_ON
(
IWL_TFH_NUM_TBS
 > (
out_mëa
->
tbs
Ë* 
BITS_PER_BYTE
);

1150 
out_mëa
->
Êags
 = 
cmd
->flags;

1151 i‡(
	`WARN_ON_ONCE
(
txq
->
íåõs
[
idx
].
‰ì_buf
))

1152 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
idx
].
‰ì_buf
);

1153 
txq
->
íåõs
[
idx
].
‰ì_buf
 = 
dup_buf
;

1155 
	`åa˚_iwlwifi_dev_hcmd
(
å™s
->
dev
, 
cmd
, 
cmd_size
, &
out_cmd
->
hdr_wide
);

1158 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
 &&Åxq->
wd_timeout
)

1159 
	`mod_timî
(&
txq
->
°uck_timî
, 
jiffõs
 +Åxq->
wd_timeout
);

1161 
ªt
 = 
	`iwl_pcõ_£t_cmd_ö_Êight
(
å™s
, 
cmd
);

1162 i‡(
ªt
 < 0) {

1163 
idx
 = 
ªt
;

1164 
out
;

1167 i‡(
cmd
->
Êags
 & 
CMD_BLOCK_TXQS
)

1168 
	`iwl_å™s_pcõ_block_txq_±rs
(
å™s
, 
åue
);

1171 
txq
->
wrôe_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->write_ptr);

1172 
	`iwl_pcõ_txq_öc_wr_±r
(
å™s
, 
txq
);

1174 
out
:

1175 
	`•ö_u∆ock_úqª°‹e
(&
txq
->
lock
, 
Êags
);

1176 
‰ì_dup_buf
:

1177 i‡(
idx
 < 0)

1178 
	`k‰ì
(
dup_buf
);

1179  
idx
;

1180 
	}
}

1186 
	$iwl_pcõ_hcmd_com∂ëe
(
iwl_å™s
 *
å™s
,

1187 
iwl_rx_cmd_buf„r
 *
rxb
)

1189 
iwl_rx_∑ckë
 *
pkt
 = 
	`rxb_addr
(
rxb
);

1190 
u16
 
£quí˚
 = 
	`À16_to_˝u
(
pkt
->
hdr
.sequence);

1191 
u8
 
group_id
;

1192 
u32
 
cmd_id
;

1193 
txq_id
 = 
	`SEQ_TO_QUEUE
(
£quí˚
);

1194 
ödex
 = 
	`SEQ_TO_INDEX
(
£quí˚
);

1195 
cmd_ödex
;

1196 
iwl_devi˚_cmd
 *
cmd
;

1197 
iwl_cmd_mëa
 *
mëa
;

1198 
iwl_å™s_pcõ
 *
å™s_pcõ
 = 
	`IWL_TRANS_GET_PCIE_TRANS
(
å™s
);

1199 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[å™s->txqs.
cmd
.
q_id
];

1204 i‡(
	`WARN
(
txq_id
 !
å™s
->
txqs
.
cmd
.
q_id
,

1206 
txq_id
, 
å™s
->
txqs
.
cmd
.
q_id
, 
£quí˚
, 
txq
->
ªad_±r
,

1207 
txq
->
wrôe_±r
)) {

1208 
	`iwl_¥öt_hex_îr‹
(
å™s
, 
pkt
, 32);

1212 
	`•ö_lock_bh
(&
txq
->
lock
);

1214 
cmd_ödex
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
, 
ödex
);

1215 
cmd
 = 
txq
->
íåõs
[
cmd_ödex
].cmd;

1216 
mëa
 = &
txq
->
íåõs
[
cmd_ödex
].meta;

1217 
group_id
 = 
cmd
->
hdr
.group_id;

1218 
cmd_id
 = 
	`WIDE_ID
(
group_id
, 
cmd
->
hdr
.cmd);

1220 i‡(
å™s
->
å™s_cfg
->
gí2
)

1221 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, 
mëa
,

1222 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
ödex
));

1224 
	`iwl_txq_gí1_tfd_unm≠
(
å™s
, 
mëa
, 
txq
, 
ödex
);

1227 i‡(
mëa
->
Êags
 & 
CMD_WANT_SKB
) {

1228 
∑ge
 *
p
 = 
	`rxb_°ól_∑ge
(
rxb
);

1230 
mëa
->
sour˚
->
ª•_pkt
 = 
pkt
;

1231 
mëa
->
sour˚
->
_rx_∑ge_addr
 = ()
	`∑ge_addªss
(
p
);

1232 
mëa
->
sour˚
->
_rx_∑ge_‹dî
 = 
å™s_pcõ
->
rx_∑ge_‹dî
;

1235 i‡(
mëa
->
Êags
 & 
CMD_BLOCK_TXQS
)

1236 
	`iwl_å™s_pcõ_block_txq_±rs
(
å™s
, 
Ál£
);

1238 
	`iwl_pcõ_cmdq_ª˛aim
(
å™s
, 
txq_id
, 
ödex
);

1240 i‡(!(
mëa
->
Êags
 & 
CMD_ASYNC
)) {

1241 i‡(!
	`ã°_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
)) {

1242 
	`IWL_WARN
(
å™s
,

1244 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd_id
));

1246 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

1247 
	`IWL_DEBUG_INFO
(
å™s
, "Clearing HCMD_ACTIVE for command %s\n",

1248 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd_id
));

1249 
	`wake_up
(&
å™s
->
waô_comm™d_queue
);

1252 
mëa
->
Êags
 = 0;

1254 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

1255 
	}
}

1257 
	$iwl_fûl_d©a_tbs
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

1258 
iwl_txq
 *
txq
, 
u8
 
hdr_Àn
,

1259 
iwl_cmd_mëa
 *
out_mëa
)

1261 
u16
 
hód_tb_Àn
;

1262 
i
;

1268 
hód_tb_Àn
 = 
	`skb_hódÀn
(
skb
Ë- 
hdr_Àn
;

1270 i‡(
hód_tb_Àn
 > 0) {

1271 
dma_addr_t
 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
,

1272 
skb
->
d©a
 + 
hdr_Àn
,

1273 
hód_tb_Àn
, 
DMA_TO_DEVICE
);

1274 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb_phys
)))

1275  -
EINVAL
;

1276 
	`åa˚_iwlwifi_dev_tx_tb
(
å™s
->
dev
, 
skb
, skb->
d©a
 + 
hdr_Àn
,

1277 
tb_phys
, 
hód_tb_Àn
);

1278 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
tb_phys
, 
hód_tb_Àn
, 
Ál£
);

1282 
i
 = 0; i < 
	`skb_shöfo
(
skb
)->
ƒ_‰ags
; i++) {

1283 c⁄° 
skb_‰ag_t
 *
‰ag
 = &
	`skb_shöfo
(
skb
)->
‰ags
[
i
];

1284 
dma_addr_t
 
tb_phys
;

1285 
tb_idx
;

1287 i‡(!
	`skb_‰ag_size
(
‰ag
))

1290 
tb_phys
 = 
	`skb_‰ag_dma_m≠
(
å™s
->
dev
, 
‰ag
, 0,

1291 
	`skb_‰ag_size
(
‰ag
), 
DMA_TO_DEVICE
);

1293 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb_phys
)))

1294  -
EINVAL
;

1295 
	`åa˚_iwlwifi_dev_tx_tb
(
å™s
->
dev
, 
skb
, 
	`skb_‰ag_addªss
(
‰ag
),

1296 
tb_phys
, 
	`skb_‰ag_size
(
‰ag
));

1297 
tb_idx
 = 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
tb_phys
,

1298 
	`skb_‰ag_size
(
‰ag
), 
Ál£
);

1299 i‡(
tb_idx
 < 0)

1300  
tb_idx
;

1302 
out_mëa
->
tbs
 |
	`BIT
(
tb_idx
);

1306 
	}
}

1308 #ifde‡
CONFIG_INET


1309 
	$iwl_fûl_d©a_tbs_amsdu
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

1310 
iwl_txq
 *
txq
, 
u8
 
hdr_Àn
,

1311 
iwl_cmd_mëa
 *
out_mëa
,

1312 
iwl_devi˚_tx_cmd
 *
dev_cmd
,

1313 
u16
 
tb1_Àn
)

1315 
iwl_tx_cmd
 *
tx_cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

1316 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

1317 
¢≠_ù_t˝_hdæí
, 
ù_hdæí
, 
tŸÆ_Àn
, 
hdr_room
;

1318 
mss
 = 
	`skb_shöfo
(
skb
)->
gso_size
;

1319 
u16
 
Àngth
, 
iv_Àn
, 
amsdu_∑d
;

1320 
u8
 *
°¨t_hdr
;

1321 
iwl_tso_hdr_∑ge
 *
hdr_∑ge
;

1322 
tso_t
 
tso
;

1325 
	`BUILD_BUG_ON
(
IEEE80211_CCMP_HDR_LEN
 !
IEEE80211_GCMP_HDR_LEN
);

1326 
iv_Àn
 = 
	`õì80211_has_¥Ÿe˘ed
(
hdr
->
‰ame_c⁄åﬁ
) ?

1327 
IEEE80211_CCMP_HDR_LEN
 : 0;

1329 
	`åa˚_iwlwifi_dev_tx
(
å™s
->
dev
, 
skb
,

1330 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
,Åxq->
wrôe_±r
),

1331 
å™s
->
txqs
.
tfd
.
size
,

1332 &
dev_cmd
->
hdr
, 
IWL_FIRST_TB_SIZE
 + 
tb1_Àn
, 0);

1334 
ù_hdæí
 = 
	`skb_√tw‹k_hódî_Àn
(
skb
);

1335 
¢≠_ù_t˝_hdæí
 = 8 + 
ù_hdæí
 + 
	`t˝_hdæí
(
skb
);

1336 
tŸÆ_Àn
 = 
skb
->
Àn
 - 
¢≠_ù_t˝_hdæí
 - 
hdr_Àn
 - 
iv_Àn
;

1337 
amsdu_∑d
 = 0;

1340 
hdr_room
 = 
	`DIV_ROUND_UP
(
tŸÆ_Àn
, 
mss
) *

1341 (3 + 
¢≠_ù_t˝_hdæí
 + (
ëhhdr
)Ë+ 
iv_Àn
;

1344 
hdr_∑ge
 = 
	`gë_∑ge_hdr
(
å™s
, 
hdr_room
, 
skb
);

1345 i‡(!
hdr_∑ge
)

1346  -
ENOMEM
;

1348 
°¨t_hdr
 = 
hdr_∑ge
->
pos
;

1349 
	`mem˝y
(
hdr_∑ge
->
pos
, 
skb
->
d©a
 + 
hdr_Àn
, 
iv_Àn
);

1350 
hdr_∑ge
->
pos
 +
iv_Àn
;

1356 
	`skb_puŒ
(
skb
, 
hdr_Àn
 + 
iv_Àn
);

1363 
	`À16_add_˝u
(&
tx_cmd
->
Àn
, -
¢≠_ù_t˝_hdæí
);

1365 
	`tso_°¨t
(
skb
, &
tso
);

1367 
tŸÆ_Àn
) {

1369 
d©a_À·
 =

1370 
	`mö_t
(, 
mss
, 
tŸÆ_Àn
);

1371 
hdr_tb_Àn
;

1372 
dma_addr_t
 
hdr_tb_phys
;

1373 
u8
 *
subf_hdrs_°¨t
 = 
hdr_∑ge
->
pos
;

1375 
tŸÆ_Àn
 -
d©a_À·
;

1377 
	`mem£t
(
hdr_∑ge
->
pos
, 0, 
amsdu_∑d
);

1378 
hdr_∑ge
->
pos
 +
amsdu_∑d
;

1379 
amsdu_∑d
 = (4 - ((
ëhhdr
Ë+ 
¢≠_ù_t˝_hdæí
 +

1380 
d©a_À·
)) & 0x3;

1381 
	`ëhî_addr_c›y
(
hdr_∑ge
->
pos
, 
	`õì80211_gë_DA
(
hdr
));

1382 
hdr_∑ge
->
pos
 +
ETH_ALEN
;

1383 
	`ëhî_addr_c›y
(
hdr_∑ge
->
pos
, 
	`õì80211_gë_SA
(
hdr
));

1384 
hdr_∑ge
->
pos
 +
ETH_ALEN
;

1386 
Àngth
 = 
¢≠_ù_t˝_hdæí
 + 
d©a_À·
;

1387 *((
__be16
 *)
hdr_∑ge
->
pos
Ë
	`˝u_to_be16
(
Àngth
);

1388 
hdr_∑ge
->
pos
 +(
Àngth
);

1394 
	`tso_buûd_hdr
(
skb
, 
hdr_∑ge
->
pos
, &
tso
, 
d©a_À·
, !
tŸÆ_Àn
);

1396 
hdr_∑ge
->
pos
 +
¢≠_ù_t˝_hdæí
;

1398 
hdr_tb_Àn
 = 
hdr_∑ge
->
pos
 - 
°¨t_hdr
;

1399 
hdr_tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
°¨t_hdr
,

1400 
hdr_tb_Àn
, 
DMA_TO_DEVICE
);

1401 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
hdr_tb_phys
)))

1402  -
EINVAL
;

1403 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
hdr_tb_phys
,

1404 
hdr_tb_Àn
, 
Ál£
);

1405 
	`åa˚_iwlwifi_dev_tx_tb
(
å™s
->
dev
, 
skb
, 
°¨t_hdr
,

1406 
hdr_tb_phys
, 
hdr_tb_Àn
);

1408 
	`À16_add_˝u
(&
tx_cmd
->
Àn
, 
hdr_∑ge
->
pos
 - 
subf_hdrs_°¨t
);

1411 
°¨t_hdr
 = 
hdr_∑ge
->
pos
;

1414 
d©a_À·
) {

1415 
size
 = 
	`mö_t
(, 
tso
.size,

1416 
d©a_À·
);

1417 
dma_addr_t
 
tb_phys
;

1419 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
tso
.
d©a
,

1420 
size
, 
DMA_TO_DEVICE
);

1421 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb_phys
)))

1422  -
EINVAL
;

1424 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
tb_phys
,

1425 
size
, 
Ál£
);

1426 
	`åa˚_iwlwifi_dev_tx_tb
(
å™s
->
dev
, 
skb
, 
tso
.
d©a
,

1427 
tb_phys
, 
size
);

1429 
d©a_À·
 -
size
;

1430 
	`tso_buûd_d©a
(
skb
, &
tso
, 
size
);

1435 
	`skb_push
(
skb
, 
hdr_Àn
 + 
iv_Àn
);

1438 
	}
}

1440 
	$iwl_fûl_d©a_tbs_amsdu
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

1441 
iwl_txq
 *
txq
, 
u8
 
hdr_Àn
,

1442 
iwl_cmd_mëa
 *
out_mëa
,

1443 
iwl_devi˚_tx_cmd
 *
dev_cmd
,

1444 
u16
 
tb1_Àn
)

1447 
	`WARN_ON
(1);

1450 
	}
}

1453 
	$iwl_å™s_pcõ_tx
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

1454 
iwl_devi˚_tx_cmd
 *
dev_cmd
, 
txq_id
)

1456 
õì80211_hdr
 *
hdr
;

1457 
iwl_tx_cmd
 *
tx_cmd
 = (iwl_tx_cmd *)
dev_cmd
->
∑ylﬂd
;

1458 
iwl_cmd_mëa
 *
out_mëa
;

1459 
iwl_txq
 *
txq
;

1460 
dma_addr_t
 
tb0_phys
, 
tb1_phys
, 
s¸©ch_phys
;

1461 *
tb1_addr
;

1462 *
tfd
;

1463 
u16
 
Àn
, 
tb1_Àn
;

1464 
boﬁ
 
waô_wrôe_±r
;

1465 
__À16
 
fc
;

1466 
u8
 
hdr_Àn
;

1467 
u16
 
wifi_£q
;

1468 
boﬁ
 
amsdu
;

1470 
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

1472 i‡(
	`WARN_ONCE
(!
	`ã°_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
),

1473 "TX o¿unu£d queuê%d\n", 
txq_id
))

1474  -
EINVAL
;

1476 i‡(
	`skb_is_n⁄löór
(
skb
) &&

1477 
	`skb_shöfo
(
skb
)->
ƒ_‰ags
 > 
	`IWL_TRANS_MAX_FRAGS
(
å™s
) &&

1478 
	`__skb_löórize
(
skb
))

1479  -
ENOMEM
;

1484 
hdr
 = (
õì80211_hdr
 *)
skb
->
d©a
;

1485 
fc
 = 
hdr
->
‰ame_c⁄åﬁ
;

1486 
hdr_Àn
 = 
	`õì80211_hdæí
(
fc
);

1488 
	`•ö_lock
(&
txq
->
lock
);

1490 i‡(
	`iwl_txq_•a˚
(
å™s
, 
txq
Ë<Åxq->
high_m¨k
) {

1491 
	`iwl_txq_°›
(
å™s
, 
txq
);

1494 i‡(
	`u∆ikñy
(
	`iwl_txq_•a˚
(
å™s
, 
txq
) < 3)) {

1495 
iwl_devi˚_tx_cmd
 **
dev_cmd_±r
;

1497 
dev_cmd_±r
 = (*)((
u8
 *)
skb
->
cb
 +

1498 
å™s
->
txqs
.
dev_cmd_offs
);

1500 *
dev_cmd_±r
 = 
dev_cmd
;

1501 
	`__skb_queue_èû
(&
txq
->
ovîÊow_q
, 
skb
);

1503 
	`•ö_u∆ock
(&
txq
->
lock
);

1513 
wifi_£q
 = 
	`IEEE80211_SEQ_TO_SN
(
	`À16_to_˝u
(
hdr
->
£q_˘æ
));

1514 
	`WARN_ONCE
(
txq
->
ampdu
 &&

1515 (
wifi_£q
 & 0xffË!
txq
->
wrôe_±r
,

1517 
txq_id
, 
wifi_£q
, 
txq
->
wrôe_±r
);

1520 
txq
->
íåõs
[txq->
wrôe_±r
].
skb
 = skb;

1521 
txq
->
íåõs
[txq->
wrôe_±r
].
cmd
 = 
dev_cmd
;

1523 
dev_cmd
->
hdr
.
£quí˚
 =

1524 
	`˝u_to_À16
((
u16
)(
	`QUEUE_TO_SEQ
(
txq_id
) |

1525 
	`INDEX_TO_SEQ
(
txq
->
wrôe_±r
)));

1527 
tb0_phys
 = 
	`iwl_txq_gë_fú°_tb_dma
(
txq
,Åxq->
wrôe_±r
);

1528 
s¸©ch_phys
 = 
tb0_phys
 + (
iwl_cmd_hódî
) +

1529 
	`off£tof
(
iwl_tx_cmd
, 
s¸©ch
);

1531 
tx_cmd
->
døm_lsb_±r
 = 
	`˝u_to_À32
(
s¸©ch_phys
);

1532 
tx_cmd
->
døm_msb_±r
 = 
	`iwl_gë_dma_hi_addr
(
s¸©ch_phys
);

1535 
out_mëa
 = &
txq
->
íåõs
[txq->
wrôe_±r
].
mëa
;

1536 
out_mëa
->
Êags
 = 0;

1544 
Àn
 = (
iwl_tx_cmd
Ë+ (
iwl_cmd_hódî
) +

1545 
hdr_Àn
 - 
IWL_FIRST_TB_SIZE
;

1547 
amsdu
 = 
	`õì80211_is_d©a_qos
(
fc
) &&

1548 (*
	`õì80211_gë_qos_˘l
(
hdr
) &

1549 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
);

1550 i‡(!
amsdu
) {

1551 
tb1_Àn
 = 
	`ALIGN
(
Àn
, 4);

1553 i‡(
tb1_Àn
 !
Àn
)

1554 
tx_cmd
->
tx_Êags
 |
	`˝u_to_À32
(
TX_CMD_FLG_MH_PAD
);

1556 
tb1_Àn
 = 
Àn
;

1563 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
tb0_phys
,

1564 
IWL_FIRST_TB_SIZE
, 
åue
);

1567 
	`BUILD_BUG_ON
((
iwl_tx_cmd
Ë< 
IWL_FIRST_TB_SIZE
);

1568 
	`BUILD_BUG_ON
((
iwl_cmd_hódî
) +

1569 
	`off£to„nd
(
iwl_tx_cmd
, 
s¸©ch
) >

1570 
IWL_FIRST_TB_SIZE
);

1573 
tb1_addr
 = ((
u8
 *)&
dev_cmd
->
hdr
Ë+ 
IWL_FIRST_TB_SIZE
;

1574 
tb1_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
tb1_addr
, 
tb1_Àn
, 
DMA_TO_DEVICE
);

1575 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb1_phys
)))

1576 
out_îr
;

1577 
	`iwl_pcõ_txq_buûd_tfd
(
å™s
, 
txq
, 
tb1_phys
, 
tb1_Àn
, 
Ál£
);

1579 
	`åa˚_iwlwifi_dev_tx
(
å™s
->
dev
, 
skb
,

1580 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
,Åxq->
wrôe_±r
),

1581 
å™s
->
txqs
.
tfd
.
size
,

1582 &
dev_cmd
->
hdr
, 
IWL_FIRST_TB_SIZE
 + 
tb1_Àn
,

1583 
hdr_Àn
);

1591 i‡(
amsdu
 && 
	`skb_shöfo
(
skb
)->
gso_size
) {

1592 i‡(
	`u∆ikñy
(
	`iwl_fûl_d©a_tbs_amsdu
(
å™s
, 
skb
, 
txq
, 
hdr_Àn
,

1593 
out_mëa
, 
dev_cmd
,

1594 
tb1_Àn
)))

1595 
out_îr
;

1597 
sk_buff
 *
‰ag
;

1599 i‡(
	`u∆ikñy
(
	`iwl_fûl_d©a_tbs
(
å™s
, 
skb
, 
txq
, 
hdr_Àn
,

1600 
out_mëa
)))

1601 
out_îr
;

1603 
	`skb_wÆk_‰ags
(
skb
, 
‰ag
) {

1604 i‡(
	`u∆ikñy
(
	`iwl_fûl_d©a_tbs
(
å™s
, 
‰ag
, 
txq
, 0,

1605 
out_mëa
)))

1606 
out_îr
;

1611 
	`mem˝y
(&
txq
->
fú°_tb_bufs
[txq->
wrôe_±r
], 
dev_cmd
, 
IWL_FIRST_TB_SIZE
);

1613 
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
,Åxq->
wrôe_±r
);

1615 
	`iwl_txq_gí1_upd©e_byã_˙t_tbl
(
å™s
, 
txq
, 
	`À16_to_˝u
(
tx_cmd
->
Àn
),

1616 
	`iwl_txq_gí1_tfd_gë_num_tbs
(
å™s
,

1617 
tfd
));

1619 
waô_wrôe_±r
 = 
	`õì80211_has_m‹e‰ags
(
fc
);

1622 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
 &&Åxq->
wd_timeout
) {

1629 i‡(!
txq
->
‰ozí
)

1630 
	`mod_timî
(&
txq
->
°uck_timî
,

1631 
jiffõs
 + 
txq
->
wd_timeout
);

1633 
txq
->
‰ozí_expúy_ªmaödî
 =Åxq->
wd_timeout
;

1637 
txq
->
wrôe_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->write_ptr);

1638 i‡(!
waô_wrôe_±r
)

1639 
	`iwl_pcõ_txq_öc_wr_±r
(
å™s
, 
txq
);

1645 
	`•ö_u∆ock
(&
txq
->
lock
);

1647 
out_îr
:

1648 
	`iwl_txq_gí1_tfd_unm≠
(
å™s
, 
out_mëa
, 
txq
,Åxq->
wrôe_±r
);

1649 
	`•ö_u∆ock
(&
txq
->
lock
);

1651 
	}
}

	@queue/tx.c

5 
	~<√t/tso.h
>

6 
	~<löux/t˝.h
>

8 
	~"iwl-debug.h
"

9 
	~"iwl-io.h
"

10 
	~"fw/≠i/comm™ds.h
"

11 
	~"fw/≠i/tx.h
"

12 
	~"fw/≠i/d©≠©h.h
"

13 
	~"fw/≠i/debug.h
"

14 
	~"queue/tx.h
"

15 
	~"iwl-fh.h
"

16 
	~"iwl-scd.h
"

17 
	~<löux/dm≠oﬁ.h
>

22 
	$iwl_pcõ_gí2_upd©e_byã_tbl
(
iwl_å™s
 *
å™s
,

23 
iwl_txq
 *
txq
, 
u16
 
byã_˙t
,

24 
num_tbs
)

26 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

27 
u8
 
fûÀd_tfd_size
, 
num_„tch_chunks
;

28 
u16
 
Àn
 = 
byã_˙t
;

29 
__À16
 
bc_ít
;

31 i‡(
	`WARN
(
idx
 >
txq
->
n_wödow
, "%d >= %d\n", idx,Åxq->n_window))

34 
fûÀd_tfd_size
 = 
	`off£tof
(
iwl_tfh_tfd
, 
tbs
) +

35 
num_tbs
 * (
iwl_tfh_tb
);

44 
num_„tch_chunks
 = 
	`DIV_ROUND_UP
(
fûÀd_tfd_size
, 64) - 1;

46 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

47 
iwl_gí3_bc_tbl_íåy
 *
scd_bc_tbl_gí3
 = 
txq
->
bc_tbl
.
addr
;

50 
	`WARN_ON
(
å™s
->
txqs
.
bc_èbÀ_dw‹d
);

51 
	`WARN_ON
(
Àn
 > 0x3FFF);

52 
bc_ít
 = 
	`˝u_to_À16
(
Àn
 | (
num_„tch_chunks
 << 14));

53 
scd_bc_tbl_gí3
[
idx
].
tfd_off£t
 = 
bc_ít
;

55 
iwœgn_scd_bc_tbl
 *
scd_bc_tbl
 = 
txq
->
bc_tbl
.
addr
;

58 
	`WARN_ON
(!
å™s
->
txqs
.
bc_èbÀ_dw‹d
);

59 
Àn
 = 
	`DIV_ROUND_UP
(len, 4);

60 
	`WARN_ON
(
Àn
 > 0xFFF);

61 
bc_ít
 = 
	`˝u_to_À16
(
Àn
 | (
num_„tch_chunks
 << 12));

62 
scd_bc_tbl
->
tfd_off£t
[
idx
] = 
bc_ít
;

64 
	}
}

69 
	$iwl_txq_öc_wr_±r
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
)

71 
	`lockdï_as£π_hñd
(&
txq
->
lock
);

73 
	`IWL_DEBUG_TX
(
å™s
, "Q:%d WR: 0x%x\n", 
txq
->
id
,Åxq->
wrôe_±r
);

79 
	`iwl_wrôe32
(
å™s
, 
HBUS_TARG_WRPTR
, 
txq
->
wrôe_±r
 | (txq->
id
 << 16));

80 
	}
}

82 
u8
 
	$iwl_txq_gí2_gë_num_tbs
(
iwl_å™s
 *
å™s
,

83 
iwl_tfh_tfd
 *
tfd
)

85  
	`À16_to_˝u
(
tfd
->
num_tbs
) & 0x1f;

86 
	}
}

88 
	$iwl_txq_gí2_£t_tb
(
iwl_å™s
 *
å™s
, 
iwl_tfh_tfd
 *
tfd
,

89 
dma_addr_t
 
addr
, 
u16
 
Àn
)

91 
idx
 = 
	`iwl_txq_gí2_gë_num_tbs
(
å™s
, 
tfd
);

92 
iwl_tfh_tb
 *
tb
;

100 
	`WARN
(
	`iwl_txq_¸os£s_4g_bound¨y
(
addr
, 
Àn
),

102 ()
addr
, 
Àn
);

104 i‡(
	`WARN_ON
(
idx
 >
IWL_TFH_NUM_TBS
))

105  -
EINVAL
;

106 
tb
 = &
tfd
->
tbs
[
idx
];

109 i‡(
	`À16_to_˝u
(
tfd
->
num_tbs
Ë>
å™s
->
txqs
.tfd.
max_tbs
) {

110 
	`IWL_ERR
(
å™s
, "Error canÇot send moreÅhan %d chunks\n",

111 
å™s
->
txqs
.
tfd
.
max_tbs
);

112  -
EINVAL
;

115 
	`put_u«lig√d_À64
(
addr
, &
tb
->addr);

116 
tb
->
tb_Àn
 = 
	`˝u_to_À16
(
Àn
);

118 
tfd
->
num_tbs
 = 
	`˝u_to_À16
(
idx
 + 1);

120  
idx
;

121 
	}
}

123 
	$iwl_txq_£t_tfd_övÆid_gí2
(
iwl_å™s
 *
å™s
,

124 
iwl_tfh_tfd
 *
tfd
)

126 
tfd
->
num_tbs
 = 0;

128 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
,Åøns->
övÆid_tx_cmd
.
dma
,

129 
å™s
->
övÆid_tx_cmd
.
size
);

130 
	}
}

132 
	$iwl_txq_gí2_tfd_unm≠
(
iwl_å™s
 *
å™s
, 
iwl_cmd_mëa
 *
mëa
,

133 
iwl_tfh_tfd
 *
tfd
)

135 
i
, 
num_tbs
;

138 
num_tbs
 = 
	`iwl_txq_gí2_gë_num_tbs
(
å™s
, 
tfd
);

140 i‡(
num_tbs
 > 
å™s
->
txqs
.
tfd
.
max_tbs
) {

141 
	`IWL_ERR
(
å™s
, "Toÿm™y chunks: %i\n", 
num_tbs
);

146 
i
 = 1; i < 
num_tbs
; i++) {

147 i‡(
mëa
->
tbs
 & 
	`BIT
(
i
))

148 
	`dma_unm≠_∑ge
(
å™s
->
dev
,

149 
	`À64_to_˝u
(
tfd
->
tbs
[
i
].
addr
),

150 
	`À16_to_˝u
(
tfd
->
tbs
[
i
].
tb_Àn
),

151 
DMA_TO_DEVICE
);

153 
	`dma_unm≠_sögÀ
(
å™s
->
dev
,

154 
	`À64_to_˝u
(
tfd
->
tbs
[
i
].
addr
),

155 
	`À16_to_˝u
(
tfd
->
tbs
[
i
].
tb_Àn
),

156 
DMA_TO_DEVICE
);

159 
	`iwl_txq_£t_tfd_övÆid_gí2
(
å™s
, 
tfd
);

160 
	}
}

162 
	$iwl_txq_gí2_‰ì_tfd
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
)

167 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
ªad_±r
);

168 
sk_buff
 *
skb
;

170 
	`lockdï_as£π_hñd
(&
txq
->
lock
);

172 i‡(!
txq
->
íåõs
)

175 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, &
txq
->
íåõs
[
idx
].
mëa
,

176 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
idx
));

178 
skb
 = 
txq
->
íåõs
[
idx
].skb;

184 i‡(
skb
) {

185 
	`iwl_›_mode_‰ì_skb
(
å™s
->
›_mode
, 
skb
);

186 
txq
->
íåõs
[
idx
].
skb
 = 
NULL
;

188 
	}
}

190 
∑ge
 *
	$gë_w‹k¨ound_∑ge
(
iwl_å™s
 *
å™s
,

191 
sk_buff
 *
skb
)

193 
∑ge
 **
∑ge_±r
;

194 
∑ge
 *
ªt
;

196 
∑ge_±r
 = (*)((
u8
 *)
skb
->
cb
 + 
å™s
->
txqs
.
∑ge_offs
);

198 
ªt
 = 
	`Æloc_∑ge
(
GFP_ATOMIC
);

199 i‡(!
ªt
)

200  
NULL
;

203 *(**)((
u8
 *)
	`∑ge_addªss
(
ªt
Ë+ 
PAGE_SIZE
 - (*)Ë*
∑ge_±r
;

204 *
∑ge_±r
 = 
ªt
;

206  
ªt
;

207 
	}
}

215 
	$iwl_txq_gí2_£t_tb_wôh_wa
(
iwl_å™s
 *
å™s
,

216 
sk_buff
 *
skb
,

217 
iwl_tfh_tfd
 *
tfd
,

218 
dma_addr_t
 
phys
, *
vút
,

219 
u16
 
Àn
, 
iwl_cmd_mëa
 *
mëa
)

221 
dma_addr_t
 
ﬁdphys
 = 
phys
;

222 
∑ge
 *page;

223 
ªt
;

225 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
phys
)))

226  -
ENOMEM
;

228 i‡(
	`likñy
(!
	`iwl_txq_¸os£s_4g_bound¨y
(
phys
, 
Àn
))) {

229 
ªt
 = 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
phys
, 
Àn
);

231 i‡(
ªt
 < 0)

232 
unm≠
;

234 i‡(
mëa
)

235 
mëa
->
tbs
 |
	`BIT
(
ªt
);

237 
ªt
 = 0;

238 
åa˚
;

250 i‡(
	`WARN_ON
(
Àn
 > 
PAGE_SIZE
 - (*))) {

251 
ªt
 = -
ENOBUFS
;

252 
unm≠
;

255 
∑ge
 = 
	`gë_w‹k¨ound_∑ge
(
å™s
, 
skb
);

256 i‡(!
∑ge
) {

257 
ªt
 = -
ENOMEM
;

258 
unm≠
;

261 
	`mem˝y
(
	`∑ge_addªss
(
∑ge
), 
vút
, 
Àn
);

263 
phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
	`∑ge_addªss
(
∑ge
), 
Àn
,

264 
DMA_TO_DEVICE
);

265 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
phys
)))

266  -
ENOMEM
;

267 
ªt
 = 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
phys
, 
Àn
);

268 i‡(
ªt
 < 0) {

270 
ﬁdphys
 = 
phys
;

271 
mëa
 = 
NULL
;

272 
unm≠
;

274 
	`IWL_DEBUG_TX
(
å™s
,

276 
Àn
, ()
ﬁdphys
,

277 ()
phys
);

279 
ªt
 = 0;

280 
unm≠
:

281 i‡(
mëa
)

282 
	`dma_unm≠_∑ge
(
å™s
->
dev
, 
ﬁdphys
, 
Àn
, 
DMA_TO_DEVICE
);

284 
	`dma_unm≠_sögÀ
(
å™s
->
dev
, 
ﬁdphys
, 
Àn
, 
DMA_TO_DEVICE
);

285 
åa˚
:

286 
	`åa˚_iwlwifi_dev_tx_tb
(
å™s
->
dev
, 
skb
, 
vút
, 
phys
, 
Àn
);

288  
ªt
;

289 
	}
}

291 #ifde‡
CONFIG_INET


292 
iwl_tso_hdr_∑ge
 *
	$gë_∑ge_hdr
(
iwl_å™s
 *
å™s
, 
size_t
 
Àn
,

293 
sk_buff
 *
skb
)

295 
iwl_tso_hdr_∑ge
 *
p
 = 
	`this_˝u_±r
(
å™s
->
txqs
.
tso_hdr_∑ge
);

296 
∑ge
 **
∑ge_±r
;

298 
∑ge_±r
 = (*)((
u8
 *)
skb
->
cb
 + 
å™s
->
txqs
.
∑ge_offs
);

300 i‡(
	`WARN_ON
(*
∑ge_±r
))

301  
NULL
;

303 i‡(!
p
->
∑ge
)

304 
Æloc
;

316 i‡(
p
->
pos
 + 
Àn
 < (
u8
 *)
	`∑ge_addªss
’->
∑ge
Ë+ 
PAGE_SIZE
 -

318 
out
;

321 
	`__‰ì_∑ge
(
p
->
∑ge
);

323 
Æloc
:

324 
p
->
∑ge
 = 
	`Æloc_∑ge
(
GFP_ATOMIC
);

325 i‡(!
p
->
∑ge
)

326  
NULL
;

327 
p
->
pos
 = 
	`∑ge_addªss
’->
∑ge
);

329 *(**)((
u8
 *)
	`∑ge_addªss
(
p
->
∑ge
Ë+ 
PAGE_SIZE
 - (*)Ë
NULL
;

330 
out
:

331 *
∑ge_±r
 = 
p
->
∑ge
;

332 
	`gë_∑ge
(
p
->
∑ge
);

333  
p
;

334 
	}
}

337 
	$iwl_txq_gí2_buûd_amsdu
(
iwl_å™s
 *
å™s
,

338 
sk_buff
 *
skb
,

339 
iwl_tfh_tfd
 *
tfd
, 
°¨t_Àn
,

340 
u8
 
hdr_Àn
,

341 
iwl_devi˚_tx_cmd
 *
dev_cmd
)

343 #ifde‡
CONFIG_INET


344 
iwl_tx_cmd_gí2
 *
tx_cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

345 
õì80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

346 
¢≠_ù_t˝_hdæí
, 
ù_hdæí
, 
tŸÆ_Àn
, 
hdr_room
;

347 
mss
 = 
	`skb_shöfo
(
skb
)->
gso_size
;

348 
u16
 
Àngth
, 
amsdu_∑d
;

349 
u8
 *
°¨t_hdr
;

350 
iwl_tso_hdr_∑ge
 *
hdr_∑ge
;

351 
tso_t
 
tso
;

353 
	`åa˚_iwlwifi_dev_tx
(
å™s
->
dev
, 
skb
, 
tfd
, (*tfd),

354 &
dev_cmd
->
hdr
, 
°¨t_Àn
, 0);

356 
ù_hdæí
 = 
	`skb_√tw‹k_hódî_Àn
(
skb
);

357 
¢≠_ù_t˝_hdæí
 = 8 + 
ù_hdæí
 + 
	`t˝_hdæí
(
skb
);

358 
tŸÆ_Àn
 = 
skb
->
Àn
 - 
¢≠_ù_t˝_hdæí
 - 
hdr_Àn
;

359 
amsdu_∑d
 = 0;

362 
hdr_room
 = 
	`DIV_ROUND_UP
(
tŸÆ_Àn
, 
mss
) *

363 (3 + 
¢≠_ù_t˝_hdæí
 + (
ëhhdr
));

366 
hdr_∑ge
 = 
	`gë_∑ge_hdr
(
å™s
, 
hdr_room
, 
skb
);

367 i‡(!
hdr_∑ge
)

368  -
ENOMEM
;

370 
°¨t_hdr
 = 
hdr_∑ge
->
pos
;

376 
	`skb_puŒ
(
skb
, 
hdr_Àn
);

383 
	`À16_add_˝u
(&
tx_cmd
->
Àn
, -
¢≠_ù_t˝_hdæí
);

385 
	`tso_°¨t
(
skb
, &
tso
);

387 
tŸÆ_Àn
) {

389 
d©a_À·
 = 
	`mö_t
(, 
mss
, 
tŸÆ_Àn
);

390 
tb_Àn
;

391 
dma_addr_t
 
tb_phys
;

392 
u8
 *
subf_hdrs_°¨t
 = 
hdr_∑ge
->
pos
;

394 
tŸÆ_Àn
 -
d©a_À·
;

396 
	`mem£t
(
hdr_∑ge
->
pos
, 0, 
amsdu_∑d
);

397 
hdr_∑ge
->
pos
 +
amsdu_∑d
;

398 
amsdu_∑d
 = (4 - ((
ëhhdr
Ë+ 
¢≠_ù_t˝_hdæí
 +

399 
d©a_À·
)) & 0x3;

400 
	`ëhî_addr_c›y
(
hdr_∑ge
->
pos
, 
	`õì80211_gë_DA
(
hdr
));

401 
hdr_∑ge
->
pos
 +
ETH_ALEN
;

402 
	`ëhî_addr_c›y
(
hdr_∑ge
->
pos
, 
	`õì80211_gë_SA
(
hdr
));

403 
hdr_∑ge
->
pos
 +
ETH_ALEN
;

405 
Àngth
 = 
¢≠_ù_t˝_hdæí
 + 
d©a_À·
;

406 *((
__be16
 *)
hdr_∑ge
->
pos
Ë
	`˝u_to_be16
(
Àngth
);

407 
hdr_∑ge
->
pos
 +(
Àngth
);

413 
	`tso_buûd_hdr
(
skb
, 
hdr_∑ge
->
pos
, &
tso
, 
d©a_À·
, !
tŸÆ_Àn
);

415 
hdr_∑ge
->
pos
 +
¢≠_ù_t˝_hdæí
;

417 
tb_Àn
 = 
hdr_∑ge
->
pos
 - 
°¨t_hdr
;

418 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
°¨t_hdr
,

419 
tb_Àn
, 
DMA_TO_DEVICE
);

420 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb_phys
)))

421 
out_îr
;

427 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
tb_phys
, 
tb_Àn
);

428 
	`åa˚_iwlwifi_dev_tx_tb
(
å™s
->
dev
, 
skb
, 
°¨t_hdr
,

429 
tb_phys
, 
tb_Àn
);

431 
	`À16_add_˝u
(&
tx_cmd
->
Àn
, 
hdr_∑ge
->
pos
 - 
subf_hdrs_°¨t
);

434 
°¨t_hdr
 = 
hdr_∑ge
->
pos
;

437 
d©a_À·
) {

438 
ªt
;

440 
tb_Àn
 = 
	`mö_t
(, 
tso
.
size
, 
d©a_À·
);

441 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
tso
.
d©a
,

442 
tb_Àn
, 
DMA_TO_DEVICE
);

443 
ªt
 = 
	`iwl_txq_gí2_£t_tb_wôh_wa
(
å™s
, 
skb
, 
tfd
,

444 
tb_phys
, 
tso
.
d©a
,

445 
tb_Àn
, 
NULL
);

446 i‡(
ªt
)

447 
out_îr
;

449 
d©a_À·
 -
tb_Àn
;

450 
	`tso_buûd_d©a
(
skb
, &
tso
, 
tb_Àn
);

455 
	`skb_push
(
skb
, 
hdr_Àn
);

459 
out_îr
:

461  -
EINVAL
;

462 
	}
}

465 
iwl_tfh_tfd
 *
	$iwl_txq_gí2_buûd_tx_amsdu
(
iwl_å™s
 *
å™s
,

466 
iwl_txq
 *
txq
,

467 
iwl_devi˚_tx_cmd
 *
dev_cmd
,

468 
sk_buff
 *
skb
,

469 
iwl_cmd_mëa
 *
out_mëa
,

470 
hdr_Àn
,

471 
tx_cmd_Àn
)

473 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

474 
iwl_tfh_tfd
 *
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
idx
);

475 
dma_addr_t
 
tb_phys
;

476 
Àn
;

477 *
tb1_addr
;

479 
tb_phys
 = 
	`iwl_txq_gë_fú°_tb_dma
(
txq
, 
idx
);

486 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
tb_phys
, 
IWL_FIRST_TB_SIZE
);

494 
Àn
 = 
tx_cmd_Àn
 + (
iwl_cmd_hódî
Ë+ 
hdr_Àn
 -

495 
IWL_FIRST_TB_SIZE
;

500 
tb1_addr
 = ((
u8
 *)&
dev_cmd
->
hdr
Ë+ 
IWL_FIRST_TB_SIZE
;

501 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
tb1_addr
, 
Àn
, 
DMA_TO_DEVICE
);

502 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb_phys
)))

503 
out_îr
;

508 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
tb_phys
, 
Àn
);

510 i‡(
	`iwl_txq_gí2_buûd_amsdu
(
å™s
, 
skb
, 
tfd
, 
Àn
 + 
IWL_FIRST_TB_SIZE
,

511 
hdr_Àn
, 
dev_cmd
))

512 
out_îr
;

515 
	`mem˝y
(&
txq
->
fú°_tb_bufs
[
idx
], 
dev_cmd
, 
IWL_FIRST_TB_SIZE
);

516  
tfd
;

518 
out_îr
:

519 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, 
out_mëa
, 
tfd
);

520  
NULL
;

521 
	}
}

523 
	$iwl_txq_gí2_tx_add_‰ags
(
iwl_å™s
 *
å™s
,

524 
sk_buff
 *
skb
,

525 
iwl_tfh_tfd
 *
tfd
,

526 
iwl_cmd_mëa
 *
out_mëa
)

528 
i
;

530 
i
 = 0; i < 
	`skb_shöfo
(
skb
)->
ƒ_‰ags
; i++) {

531 c⁄° 
skb_‰ag_t
 *
‰ag
 = &
	`skb_shöfo
(
skb
)->
‰ags
[
i
];

532 
dma_addr_t
 
tb_phys
;

533 
‰agsz
 = 
	`skb_‰ag_size
(
‰ag
);

534 
ªt
;

536 i‡(!
‰agsz
)

539 
tb_phys
 = 
	`skb_‰ag_dma_m≠
(
å™s
->
dev
, 
‰ag
, 0,

540 
‰agsz
, 
DMA_TO_DEVICE
);

541 
ªt
 = 
	`iwl_txq_gí2_£t_tb_wôh_wa
(
å™s
, 
skb
, 
tfd
, 
tb_phys
,

542 
	`skb_‰ag_addªss
(
‰ag
),

543 
‰agsz
, 
out_mëa
);

544 i‡(
ªt
)

545  
ªt
;

549 
	}
}

552 
iwl_tfh_tfd
 *
	$iwl_txq_gí2_buûd_tx
(
iwl_å™s
 *
å™s
,

553 
iwl_txq
 *
txq
,

554 
iwl_devi˚_tx_cmd
 *
dev_cmd
,

555 
sk_buff
 *
skb
,

556 
iwl_cmd_mëa
 *
out_mëa
,

557 
hdr_Àn
,

558 
tx_cmd_Àn
,

559 
boﬁ
 
∑d
)

561 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

562 
iwl_tfh_tfd
 *
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
idx
);

563 
dma_addr_t
 
tb_phys
;

564 
Àn
, 
tb1_Àn
, 
tb2_Àn
;

565 *
tb1_addr
;

566 
sk_buff
 *
‰ag
;

568 
tb_phys
 = 
	`iwl_txq_gë_fú°_tb_dma
(
txq
, 
idx
);

571 
	`mem˝y
(&
txq
->
fú°_tb_bufs
[
idx
], 
dev_cmd
, 
IWL_FIRST_TB_SIZE
);

578 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
tb_phys
, 
IWL_FIRST_TB_SIZE
);

586 
Àn
 = 
tx_cmd_Àn
 + (
iwl_cmd_hódî
Ë+ 
hdr_Àn
 -

587 
IWL_FIRST_TB_SIZE
;

589 i‡(
∑d
)

590 
tb1_Àn
 = 
	`ALIGN
(
Àn
, 4);

592 
tb1_Àn
 = 
Àn
;

595 
tb1_addr
 = ((
u8
 *)&
dev_cmd
->
hdr
Ë+ 
IWL_FIRST_TB_SIZE
;

596 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
tb1_addr
, 
tb1_Àn
, 
DMA_TO_DEVICE
);

597 i‡(
	`u∆ikñy
(
	`dma_m≠pög_îr‹
(
å™s
->
dev
, 
tb_phys
)))

598 
out_îr
;

603 
	`iwl_txq_gí2_£t_tb
(
å™s
, 
tfd
, 
tb_phys
, 
tb1_Àn
);

604 
	`åa˚_iwlwifi_dev_tx
(
å™s
->
dev
, 
skb
, 
tfd
, (*tfd), &
dev_cmd
->
hdr
,

605 
IWL_FIRST_TB_SIZE
 + 
tb1_Àn
, 
hdr_Àn
);

608 
tb2_Àn
 = 
	`skb_hódÀn
(
skb
Ë- 
hdr_Àn
;

610 i‡(
tb2_Àn
 > 0) {

611 
ªt
;

613 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
skb
->
d©a
 + 
hdr_Àn
,

614 
tb2_Àn
, 
DMA_TO_DEVICE
);

615 
ªt
 = 
	`iwl_txq_gí2_£t_tb_wôh_wa
(
å™s
, 
skb
, 
tfd
, 
tb_phys
,

616 
skb
->
d©a
 + 
hdr_Àn
, 
tb2_Àn
,

617 
NULL
);

618 i‡(
ªt
)

619 
out_îr
;

622 i‡(
	`iwl_txq_gí2_tx_add_‰ags
(
å™s
, 
skb
, 
tfd
, 
out_mëa
))

623 
out_îr
;

625 
	`skb_wÆk_‰ags
(
skb
, 
‰ag
) {

626 
ªt
;

628 
tb_phys
 = 
	`dma_m≠_sögÀ
(
å™s
->
dev
, 
‰ag
->
d©a
,

629 
	`skb_hódÀn
(
‰ag
), 
DMA_TO_DEVICE
);

630 
ªt
 = 
	`iwl_txq_gí2_£t_tb_wôh_wa
(
å™s
, 
skb
, 
tfd
, 
tb_phys
,

631 
‰ag
->
d©a
,

632 
	`skb_hódÀn
(
‰ag
), 
NULL
);

633 i‡(
ªt
)

634 
out_îr
;

635 i‡(
	`iwl_txq_gí2_tx_add_‰ags
(
å™s
, 
‰ag
, 
tfd
, 
out_mëa
))

636 
out_îr
;

639  
tfd
;

641 
out_îr
:

642 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, 
out_mëa
, 
tfd
);

643  
NULL
;

644 
	}
}

647 
iwl_tfh_tfd
 *
	$iwl_txq_gí2_buûd_tfd
(
iwl_å™s
 *
å™s
,

648 
iwl_txq
 *
txq
,

649 
iwl_devi˚_tx_cmd
 *
dev_cmd
,

650 
sk_buff
 *
skb
,

651 
iwl_cmd_mëa
 *
out_mëa
)

653 
õì80211_hdr
 *
hdr
 = (õì80211_hd∏*)
skb
->
d©a
;

654 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

655 
iwl_tfh_tfd
 *
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
idx
);

656 
Àn
, 
hdr_Àn
;

657 
boﬁ
 
amsdu
;

660 
	`BUILD_BUG_ON
((
iwl_tx_cmd_gí2
Ë< 
IWL_FIRST_TB_SIZE
);

661 
	`BUILD_BUG_ON
((
iwl_cmd_hódî
) +

662 
	`off£to„nd
(
iwl_tx_cmd_gí2
, 
døm_öfo
) >

663 
IWL_FIRST_TB_SIZE
);

664 
	`BUILD_BUG_ON
((
iwl_tx_cmd_gí3
Ë< 
IWL_FIRST_TB_SIZE
);

665 
	`BUILD_BUG_ON
((
iwl_cmd_hódî
) +

666 
	`off£to„nd
(
iwl_tx_cmd_gí3
, 
døm_öfo
) >

667 
IWL_FIRST_TB_SIZE
);

669 
	`mem£t
(
tfd
, 0, (*tfd));

671 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 < 
IWL_DEVICE_FAMILY_AX210
)

672 
Àn
 = (
iwl_tx_cmd_gí2
);

674 
Àn
 = (
iwl_tx_cmd_gí3
);

676 
amsdu
 = 
	`õì80211_is_d©a_qos
(
hdr
->
‰ame_c⁄åﬁ
) &&

677 (*
	`õì80211_gë_qos_˘l
(
hdr
) &

678 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
);

680 
hdr_Àn
 = 
	`õì80211_hdæí
(
hdr
->
‰ame_c⁄åﬁ
);

687 i‡(
amsdu
 && 
	`skb_shöfo
(
skb
)->
gso_size
)

688  
	`iwl_txq_gí2_buûd_tx_amsdu
(
å™s
, 
txq
, 
dev_cmd
, 
skb
,

689 
out_mëa
, 
hdr_Àn
, 
Àn
);

690  
	`iwl_txq_gí2_buûd_tx
(
å™s
, 
txq
, 
dev_cmd
, 
skb
, 
out_mëa
,

691 
hdr_Àn
, 
Àn
, !
amsdu
);

692 
	}
}

694 
	$iwl_txq_•a˚
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_txq
 *
q
)

696 
max
;

697 
u£d
;

705 i‡(
q
->
n_wödow
 < 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
)

706 
max
 = 
q
->
n_wödow
;

708 
max
 = 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1;

714 
u£d
 = (
q
->
wrôe_±r
 - q->
ªad_±r
) &

715 (
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1);

717 i‡(
	`WARN_ON
(
u£d
 > 
max
))

720  
max
 - 
u£d
;

721 
	}
}

723 
	$iwl_txq_gí2_tx
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

724 
iwl_devi˚_tx_cmd
 *
dev_cmd
, 
txq_id
)

726 
iwl_cmd_mëa
 *
out_mëa
;

727 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

728 
u16
 
cmd_Àn
;

729 
idx
;

730 *
tfd
;

732 i‡(
	`WARN_ONCE
(
txq_id
 >
IWL_MAX_TVQM_QUEUES
,

733 "queuê%d ouào‡ønge", 
txq_id
))

734  -
EINVAL
;

736 i‡(
	`WARN_ONCE
(!
	`ã°_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
),

737 "TX o¿unu£d queuê%d\n", 
txq_id
))

738  -
EINVAL
;

740 i‡(
	`skb_is_n⁄löór
(
skb
) &&

741 
	`skb_shöfo
(
skb
)->
ƒ_‰ags
 > 
	`IWL_TRANS_MAX_FRAGS
(
å™s
) &&

742 
	`__skb_löórize
(
skb
))

743  -
ENOMEM
;

745 
	`•ö_lock
(&
txq
->
lock
);

747 i‡(
	`iwl_txq_•a˚
(
å™s
, 
txq
Ë<Åxq->
high_m¨k
) {

748 
	`iwl_txq_°›
(
å™s
, 
txq
);

751 i‡(
	`u∆ikñy
(
	`iwl_txq_•a˚
(
å™s
, 
txq
) < 3)) {

752 
iwl_devi˚_tx_cmd
 **
dev_cmd_±r
;

754 
dev_cmd_±r
 = (*)((
u8
 *)
skb
->
cb
 +

755 
å™s
->
txqs
.
dev_cmd_offs
);

757 *
dev_cmd_±r
 = 
dev_cmd
;

758 
	`__skb_queue_èû
(&
txq
->
ovîÊow_q
, 
skb
);

759 
	`•ö_u∆ock
(&
txq
->
lock
);

764 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
wrôe_±r
);

767 
txq
->
íåõs
[
idx
].
skb
 = skb;

768 
txq
->
íåõs
[
idx
].
cmd
 = 
dev_cmd
;

770 
dev_cmd
->
hdr
.
£quí˚
 =

771 
	`˝u_to_À16
((
u16
)(
	`QUEUE_TO_SEQ
(
txq_id
) |

772 
	`INDEX_TO_SEQ
(
idx
)));

775 
out_mëa
 = &
txq
->
íåõs
[
idx
].
mëa
;

776 
out_mëa
->
Êags
 = 0;

778 
tfd
 = 
	`iwl_txq_gí2_buûd_tfd
(
å™s
, 
txq
, 
dev_cmd
, 
skb
, 
out_mëa
);

779 i‡(!
tfd
) {

780 
	`•ö_u∆ock
(&
txq
->
lock
);

784 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 >
IWL_DEVICE_FAMILY_AX210
) {

785 
iwl_tx_cmd_gí3
 *
tx_cmd_gí3
 =

786 (*)
dev_cmd
->
∑ylﬂd
;

788 
cmd_Àn
 = 
	`À16_to_˝u
(
tx_cmd_gí3
->
Àn
);

790 
iwl_tx_cmd_gí2
 *
tx_cmd_gí2
 =

791 (*)
dev_cmd
->
∑ylﬂd
;

793 
cmd_Àn
 = 
	`À16_to_˝u
(
tx_cmd_gí2
->
Àn
);

797 
	`iwl_pcõ_gí2_upd©e_byã_tbl
(
å™s
, 
txq
, 
cmd_Àn
,

798 
	`iwl_txq_gí2_gë_num_tbs
(
å™s
, 
tfd
));

801 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
 &&Åxq->
wd_timeout
)

802 
	`mod_timî
(&
txq
->
°uck_timî
, 
jiffõs
 +Åxq->
wd_timeout
);

805 
txq
->
wrôe_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->write_ptr);

806 
	`iwl_txq_öc_wr_±r
(
å™s
, 
txq
);

811 
	`•ö_u∆ock
(&
txq
->
lock
);

813 
	}
}

820 
	$iwl_txq_gí2_unm≠
(
iwl_å™s
 *
å™s
, 
txq_id
)

822 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

824 
	`•ö_lock_bh
(&
txq
->
lock
);

825 
txq
->
wrôe_±r
 !txq->
ªad_±r
) {

826 
	`IWL_DEBUG_TX_REPLY
(
å™s
, "Q %d Free %d\n",

827 
txq_id
, 
txq
->
ªad_±r
);

829 i‡(
txq_id
 !
å™s
->
txqs
.
cmd
.
q_id
) {

830 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->
ªad_±r
);

831 
sk_buff
 *
skb
 = 
txq
->
íåõs
[
idx
].skb;

833 i‡(!
	`WARN_ON_ONCE
(!
skb
))

834 
	`iwl_txq_‰ì_tso_∑ge
(
å™s
, 
skb
);

836 
	`iwl_txq_gí2_‰ì_tfd
(
å™s
, 
txq
);

837 
txq
->
ªad_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->read_ptr);

840 !
	`skb_queue_em±y
(&
txq
->
ovîÊow_q
)) {

841 
sk_buff
 *
skb
 = 
	`__skb_dequeue
(&
txq
->
ovîÊow_q
);

843 
	`iwl_›_mode_‰ì_skb
(
å™s
->
›_mode
, 
skb
);

846 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

849 
	`iwl_wake_queue
(
å™s
, 
txq
);

850 
	}
}

852 
	$iwl_txq_gí2_‰ì_mem‹y
(
iwl_å™s
 *
å™s
,

853 
iwl_txq
 *
txq
)

855 
devi˚
 *
dev
 = 
å™s
->dev;

858 i‡(
txq
->
tfds
) {

859 
	`dma_‰ì_cohîít
(
dev
,

860 
å™s
->
txqs
.
tfd
.
size
 * 
txq
->
n_wödow
,

861 
txq
->
tfds
,Åxq->
dma_addr
);

862 
	`dma_‰ì_cohîít
(
dev
,

863 (*
txq
->
fú°_tb_bufs
Ë*Åxq->
n_wödow
,

864 
txq
->
fú°_tb_bufs
,Åxq->
fú°_tb_dma
);

867 
	`k‰ì
(
txq
->
íåõs
);

868 i‡(
txq
->
bc_tbl
.
addr
)

869 
	`dma_poﬁ_‰ì
(
å™s
->
txqs
.
bc_poﬁ
,

870 
txq
->
bc_tbl
.
addr
,Åxq->bc_tbl.
dma
);

871 
	`k‰ì
(
txq
);

872 
	}
}

882 
	$iwl_txq_gí2_‰ì
(
iwl_å™s
 *
å™s
, 
txq_id
)

884 
iwl_txq
 *
txq
;

885 
i
;

887 i‡(
	`WARN_ONCE
(
txq_id
 >
IWL_MAX_TVQM_QUEUES
,

888 "queuê%d ouào‡ønge", 
txq_id
))

891 
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

893 i‡(
	`WARN_ON
(!
txq
))

896 
	`iwl_txq_gí2_unm≠
(
å™s
, 
txq_id
);

899 i‡(
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
)

900 
i
 = 0; i < 
txq
->
n_wödow
; i++) {

901 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
i
].
cmd
);

902 
	`k‰ì_£nsôive
(
txq
->
íåõs
[
i
].
‰ì_buf
);

904 
	`dñ_timî_sync
(&
txq
->
°uck_timî
);

906 
	`iwl_txq_gí2_‰ì_mem‹y
(
å™s
, 
txq
);

908 
å™s
->
txqs
.
txq
[
txq_id
] = 
NULL
;

910 
	`˛ór_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
);

911 
	}
}

916 
	$iwl_queue_öô
(
iwl_txq
 *
q
, 
¶Ÿs_num
)

918 
q
->
n_wödow
 = 
¶Ÿs_num
;

922 i‡(
	`WARN_ON
(!
	`is_powî_of_2
(
¶Ÿs_num
)))

923  -
EINVAL
;

925 
q
->
low_m¨k
 = q->
n_wödow
 / 4;

926 i‡(
q
->
low_m¨k
 < 4)

927 
q
->
low_m¨k
 = 4;

929 
q
->
high_m¨k
 = q->
n_wödow
 / 8;

930 i‡(
q
->
high_m¨k
 < 2)

931 
q
->
high_m¨k
 = 2;

933 
q
->
wrôe_±r
 = 0;

934 
q
->
ªad_±r
 = 0;

937 
	}
}

939 
	$iwl_txq_öô
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
, 
¶Ÿs_num
,

940 
boﬁ
 
cmd_queue
)

942 
ªt
;

943 
u32
 
tfd_queue_max_size
 =

944 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
;

946 
txq
->
√ed_upd©e
 = 
Ál£
;

950 i‡(
	`WARN_ONCE
(
tfd_queue_max_size
 & (tfd_queue_max_size - 1),

952 
tfd_queue_max_size
))

953  -
EINVAL
;

956 
ªt
 = 
	`iwl_queue_öô
(
txq
, 
¶Ÿs_num
);

957 i‡(
ªt
)

958  
ªt
;

960 
	`•ö_lock_öô
(&
txq
->
lock
);

962 i‡(
cmd_queue
) {

963 
lock_˛ass_key
 
iwl_txq_cmd_queue_lock_˛ass
;

965 
	`lockdï_£t_˛ass
(&
txq
->
lock
, &
iwl_txq_cmd_queue_lock_˛ass
);

968 
	`__skb_queue_hód_öô
(&
txq
->
ovîÊow_q
);

971 
	}
}

973 
	$iwl_txq_‰ì_tso_∑ge
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
)

975 
∑ge
 **
∑ge_±r
;

976 
∑ge
 *
√xt
;

978 
∑ge_±r
 = (*)((
u8
 *)
skb
->
cb
 + 
å™s
->
txqs
.
∑ge_offs
);

979 
√xt
 = *
∑ge_±r
;

980 *
∑ge_±r
 = 
NULL
;

982 
√xt
) {

983 
∑ge
 *
tmp
 = 
√xt
;

985 
√xt
 = *(**)((
u8
 *)
	`∑ge_addªss
“extË+ 
PAGE_SIZE
 -

987 
	`__‰ì_∑ge
(
tmp
);

989 
	}
}

991 
	$iwl_txq_log_scd_îr‹
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
)

993 
u32
 
txq_id
 = 
txq
->
id
;

994 
u32
 
°©us
;

995 
boﬁ
 
a˘ive
;

996 
u8
 
fifo
;

998 i‡(
å™s
->
å™s_cfg
->
gí2
) {

999 
	`IWL_ERR
(
å™s
, "Queuê%d i†°uck %d %d\n", 
txq_id
,

1000 
txq
->
ªad_±r
,Åxq->
wrôe_±r
);

1005 
°©us
 = 
	`iwl_ªad_¥ph
(
å™s
, 
	`SCD_QUEUE_STATUS_BITS
(
txq_id
));

1006 
fifo
 = (
°©us
 >> 
SCD_QUEUE_STTS_REG_POS_TXF
) & 0x7;

1007 
a˘ive
 = !!(
°©us
 & 
	`BIT
(
SCD_QUEUE_STTS_REG_POS_ACTIVE
));

1009 
	`IWL_ERR
(
å™s
,

1011 
txq_id
, 
a˘ive
 ? "" : "ö", 
fifo
,

1012 
	`jiffõs_to_m£cs
(
txq
->
wd_timeout
),

1013 
txq
->
ªad_±r
,Åxq->
wrôe_±r
,

1014 
	`iwl_ªad_¥ph
(
å™s
, 
	`SCD_QUEUE_RDPTR
(
txq_id
)) &

1015 (
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1),

1016 
	`iwl_ªad_¥ph
(
å™s
, 
	`SCD_QUEUE_WRPTR
(
txq_id
)) &

1017 (
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1),

1018 
	`iwl_ªad_dúe˘32
(
å™s
, 
	`FH_TX_TRB_REG
(
fifo
)));

1019 
	}
}

1021 
	$iwl_txq_°uck_timî
(
timî_li°
 *
t
)

1023 
iwl_txq
 *
txq
 = 
	`‰om_timî
—xq, 
t
, 
°uck_timî
);

1024 
iwl_å™s
 *
å™s
 = 
txq
->trans;

1026 
	`•ö_lock
(&
txq
->
lock
);

1028 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
) {

1029 
	`•ö_u∆ock
(&
txq
->
lock
);

1032 
	`•ö_u∆ock
(&
txq
->
lock
);

1034 
	`iwl_txq_log_scd_îr‹
(
å™s
, 
txq
);

1036 
	`iwl_f‹˚_nmi
(
å™s
);

1037 
	}
}

1039 
	$iwl_txq_£t_tfd_övÆid_gí1
(
iwl_å™s
 *
å™s
,

1040 
iwl_tfd
 *
tfd
)

1042 
tfd
->
num_tbs
 = 0;

1044 
	`iwl_pcõ_gí1_tfd_£t_tb
(
å™s
, 
tfd
, 0,Åøns->
övÆid_tx_cmd
.
dma
,

1045 
å™s
->
övÆid_tx_cmd
.
size
);

1046 
	}
}

1048 
	$iwl_txq_Æloc
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
, 
¶Ÿs_num
,

1049 
boﬁ
 
cmd_queue
)

1051 
size_t
 
num_íåõs
 = 
å™s
->
å™s_cfg
->
gí2
 ?

1052 
¶Ÿs_num
 : 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
;

1053 
size_t
 
tfd_sz
;

1054 
size_t
 
tb0_buf_sz
;

1055 
i
;

1057 i‡(
	`WARN_ONCE
(
¶Ÿs_num
 <= 0, "Invalid slotsÇum:%d\n", slots_num))

1058  -
EINVAL
;

1060 i‡(
	`WARN_ON
(
txq
->
íåõs
 ||Åxq->
tfds
))

1061  -
EINVAL
;

1063 
tfd_sz
 = 
å™s
->
txqs
.
tfd
.
size
 * 
num_íåõs
;

1065 
	`timî_£tup
(&
txq
->
°uck_timî
, 
iwl_txq_°uck_timî
, 0);

1066 
txq
->
å™s
 =Årans;

1068 
txq
->
n_wödow
 = 
¶Ÿs_num
;

1070 
txq
->
íåõs
 = 
	`kˇŒoc
(
¶Ÿs_num
,

1071 (
iwl_pcõ_txq_íåy
),

1072 
GFP_KERNEL
);

1074 i‡(!
txq
->
íåõs
)

1075 
îr‹
;

1077 i‡(
cmd_queue
)

1078 
i
 = 0; i < 
¶Ÿs_num
; i++) {

1079 
txq
->
íåõs
[
i
].
cmd
 =

1080 
	`kmÆloc
((
iwl_devi˚_cmd
),

1081 
GFP_KERNEL
);

1082 i‡(!
txq
->
íåõs
[
i
].
cmd
)

1083 
îr‹
;

1088 
txq
->
tfds
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
tfd_sz
,

1089 &
txq
->
dma_addr
, 
GFP_KERNEL
);

1090 i‡(!
txq
->
tfds
)

1091 
îr‹
;

1093 
	`BUILD_BUG_ON
((*
txq
->
fú°_tb_bufs
Ë!
IWL_FIRST_TB_SIZE_ALIGN
);

1095 
tb0_buf_sz
 = (*
txq
->
fú°_tb_bufs
Ë* 
¶Ÿs_num
;

1097 
txq
->
fú°_tb_bufs
 = 
	`dma_Æloc_cohîít
(
å™s
->
dev
, 
tb0_buf_sz
,

1098 &
txq
->
fú°_tb_dma
,

1099 
GFP_KERNEL
);

1100 i‡(!
txq
->
fú°_tb_bufs
)

1101 
îr_‰ì_tfds
;

1103 
i
 = 0; i < 
num_íåõs
; i++) {

1104 *
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
i
);

1106 i‡(
å™s
->
å™s_cfg
->
gí2
)

1107 
	`iwl_txq_£t_tfd_övÆid_gí2
(
å™s
, 
tfd
);

1109 
	`iwl_txq_£t_tfd_övÆid_gí1
(
å™s
, 
tfd
);

1113 
îr_‰ì_tfds
:

1114 
	`dma_‰ì_cohîít
(
å™s
->
dev
, 
tfd_sz
, 
txq
->
tfds
,Åxq->
dma_addr
);

1115 
txq
->
tfds
 = 
NULL
;

1116 
îr‹
:

1117 i‡(
txq
->
íåõs
 && 
cmd_queue
)

1118 
i
 = 0; i < 
¶Ÿs_num
; i++)

1119 
	`k‰ì
(
txq
->
íåõs
[
i
].
cmd
);

1120 
	`k‰ì
(
txq
->
íåõs
);

1121 
txq
->
íåõs
 = 
NULL
;

1123  -
ENOMEM
;

1124 
	}
}

1126 
iwl_txq
 *

1127 
	$iwl_txq_dyn_Æloc_dma
(
iwl_å™s
 *
å™s
, 
size
, 
timeout
)

1129 
size_t
 
bc_tbl_size
, 
bc_tbl_íåõs
;

1130 
iwl_txq
 *
txq
;

1131 
ªt
;

1133 
	`WARN_ON
(!
å™s
->
txqs
.
bc_tbl_size
);

1135 
bc_tbl_size
 = 
å™s
->
txqs
.bc_tbl_size;

1136 
bc_tbl_íåõs
 = 
bc_tbl_size
 / (
u16
);

1138 i‡(
	`WARN_ON
(
size
 > 
bc_tbl_íåõs
))

1139  
	`ERR_PTR
(-
EINVAL
);

1141 
txq
 = 
	`kzÆloc
((*txq), 
GFP_KERNEL
);

1142 i‡(!
txq
)

1143  
	`ERR_PTR
(-
ENOMEM
);

1145 
txq
->
bc_tbl
.
addr
 = 
	`dma_poﬁ_Æloc
(
å™s
->
txqs
.
bc_poﬁ
, 
GFP_KERNEL
,

1146 &
txq
->
bc_tbl
.
dma
);

1147 i‡(!
txq
->
bc_tbl
.
addr
) {

1148 
	`IWL_ERR
(
å™s
, "Scheduler BC Tableállocation failed\n");

1149 
	`k‰ì
(
txq
);

1150  
	`ERR_PTR
(-
ENOMEM
);

1153 
ªt
 = 
	`iwl_txq_Æloc
(
å™s
, 
txq
, 
size
, 
Ál£
);

1154 i‡(
ªt
) {

1155 
	`IWL_ERR
(
å™s
, "Tx queueálloc failed\n");

1156 
îr‹
;

1158 
ªt
 = 
	`iwl_txq_öô
(
å™s
, 
txq
, 
size
, 
Ál£
);

1159 i‡(
ªt
) {

1160 
	`IWL_ERR
(
å™s
, "Tx queue init failed\n");

1161 
îr‹
;

1164 
txq
->
wd_timeout
 = 
	`m£cs_to_jiffõs
(
timeout
);

1166  
txq
;

1168 
îr‹
:

1169 
	`iwl_txq_gí2_‰ì_mem‹y
(
å™s
, 
txq
);

1170  
	`ERR_PTR
(
ªt
);

1171 
	}
}

1173 
	$iwl_txq_Æloc_ª•⁄£
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
,

1174 
iwl_ho°_cmd
 *
hcmd
)

1176 
iwl_tx_queue_cfg_r•
 *
r•
;

1177 
ªt
, 
qid
;

1178 
u32
 
wr_±r
;

1180 i‡(
	`WARN_ON
(
	`iwl_rx_∑ckë_∑ylﬂd_Àn
(
hcmd
->
ª•_pkt
) !=

1181 (*
r•
))) {

1182 
ªt
 = -
EINVAL
;

1183 
îr‹_‰ì_ª•
;

1186 
r•
 = (*)
hcmd
->
ª•_pkt
->
d©a
;

1187 
qid
 = 
	`À16_to_˝u
(
r•
->
queue_numbî
);

1188 
wr_±r
 = 
	`À16_to_˝u
(
r•
->
wrôe_poöãr
);

1190 i‡(
qid
 >
	`ARRAY_SIZE
(
å™s
->
txqs
.
txq
)) {

1191 
	`WARN_ONCE
(1, "queuêödex %d unsuµ‹ãd", 
qid
);

1192 
ªt
 = -
EIO
;

1193 
îr‹_‰ì_ª•
;

1196 i‡(
	`ã°_™d_£t_bô
(
qid
, 
å™s
->
txqs
.
queue_u£d
)) {

1197 
	`WARN_ONCE
(1, "queuê%dáÃódy u£d", 
qid
);

1198 
ªt
 = -
EIO
;

1199 
îr‹_‰ì_ª•
;

1202 i‡(
	`WARN_ONCE
(
å™s
->
txqs
.
txq
[
qid
],

1203 "queuê%dáÃódyáŒoˇãd\n", 
qid
)) {

1204 
ªt
 = -
EIO
;

1205 
îr‹_‰ì_ª•
;

1208 
txq
->
id
 = 
qid
;

1209 
å™s
->
txqs
.
txq
[
qid
] =Åxq;

1210 
wr_±r
 &(
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1);

1213 
txq
->
ªad_±r
 = 
wr_±r
;

1214 
txq
->
wrôe_±r
 = 
wr_±r
;

1216 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "A˘iv©êqueuê%d\n", 
qid
);

1218 
	`iwl_‰ì_ª•
(
hcmd
);

1219  
qid
;

1221 
îr‹_‰ì_ª•
:

1222 
	`iwl_‰ì_ª•
(
hcmd
);

1223 
	`iwl_txq_gí2_‰ì_mem‹y
(
å™s
, 
txq
);

1224  
ªt
;

1225 
	}
}

1227 
	$iwl_txq_dyn_Æloc
(
iwl_å™s
 *
å™s
, 
u32
 
Êags
, u32 
°a_mask
,

1228 
u8
 
tid
, 
size
, 
timeout
)

1230 
iwl_txq
 *
txq
;

1232 
iwl_tx_queue_cfg_cmd
 
ﬁd
;

1233 
iwl_scd_queue_cfg_cmd
 
√w
;

1234 } 
cmd
;

1235 
iwl_ho°_cmd
 
hcmd
 = {

1236 .
Êags
 = 
CMD_WANT_SKB
,

1238 
ªt
;

1240 i‡(
å™s
->
å™s_cfg
->
devi˚_Ámûy
 =
IWL_DEVICE_FAMILY_BZ
 &&

1241 
å™s
->
hw_ªv_°ï
 =
SILICON_A_STEP
)

1242 
size
 = 4096;

1244 
txq
 = 
	`iwl_txq_dyn_Æloc_dma
(
å™s
, 
size
, 
timeout
);

1245 i‡(
	`IS_ERR
(
txq
))

1246  
	`PTR_ERR
(
txq
);

1248 i‡(
å™s
->
txqs
.
queue_Æloc_cmd_vî
 == 0) {

1249 
	`mem£t
(&
cmd
.
ﬁd
, 0, (cmd.old));

1250 
cmd
.
ﬁd
.
tfdq_addr
 = 
	`˝u_to_À64
(
txq
->
dma_addr
);

1251 
cmd
.
ﬁd
.
byã_˙t_addr
 = 
	`˝u_to_À64
(
txq
->
bc_tbl
.
dma
);

1252 
cmd
.
ﬁd
.
cb_size
 = 
	`˝u_to_À32
(
	`TFD_QUEUE_CB_SIZE
(
size
));

1253 
cmd
.
ﬁd
.
Êags
 = 
	`˝u_to_À16
(Êag†| 
TX_QUEUE_CFG_ENABLE_QUEUE
);

1254 
cmd
.
ﬁd
.
tid
 =Åid;

1256 i‡(
	`hweight32
(
°a_mask
) != 1) {

1257 
ªt
 = -
EINVAL
;

1258 
îr‹
;

1260 
cmd
.
ﬁd
.
°a_id
 = 
	`ffs
(
°a_mask
) - 1;

1262 
hcmd
.
id
 = 
SCD_QUEUE_CFG
;

1263 
hcmd
.
Àn
[0] = (
cmd
.
ﬁd
);

1264 
hcmd
.
d©a
[0] = &
cmd
.
ﬁd
;

1265 } i‡(
å™s
->
txqs
.
queue_Æloc_cmd_vî
 == 3) {

1266 
	`mem£t
(&
cmd
.
√w
, 0, (cmd.new));

1267 
cmd
.
√w
.
›î©i⁄
 = 
	`˝u_to_À32
(
IWL_SCD_QUEUE_ADD
);

1268 
cmd
.
√w
.
u
.
add
.
tfdq_døm_addr
 = 
	`˝u_to_À64
(
txq
->
dma_addr
);

1269 
cmd
.
√w
.
u
.
add
.
bc_døm_addr
 = 
	`˝u_to_À64
(
txq
->
bc_tbl
.
dma
);

1270 
cmd
.
√w
.
u
.
add
.
cb_size
 = 
	`˝u_to_À32
(
	`TFD_QUEUE_CB_SIZE
(
size
));

1271 
cmd
.
√w
.
u
.
add
.
Êags
 = 
	`˝u_to_À32
(flags);

1272 
cmd
.
√w
.
u
.
add
.
°a_mask
 = 
	`˝u_to_À32
(sta_mask);

1273 
cmd
.
√w
.
u
.
add
.
tid
 =Åid;

1275 
hcmd
.
id
 = 
	`WIDE_ID
(
DATA_PATH_GROUP
, 
SCD_QUEUE_CONFIG_CMD
);

1276 
hcmd
.
Àn
[0] = (
cmd
.
√w
);

1277 
hcmd
.
d©a
[0] = &
cmd
.
√w
;

1279 
ªt
 = -
EOPNOTSUPP
;

1280 
îr‹
;

1283 
ªt
 = 
	`iwl_å™s_£nd_cmd
(
å™s
, &
hcmd
);

1284 i‡(
ªt
)

1285 
îr‹
;

1287  
	`iwl_txq_Æloc_ª•⁄£
(
å™s
, 
txq
, &
hcmd
);

1289 
îr‹
:

1290 
	`iwl_txq_gí2_‰ì_mem‹y
(
å™s
, 
txq
);

1291  
ªt
;

1292 
	}
}

1294 
	$iwl_txq_dyn_‰ì
(
iwl_å™s
 *
å™s
, 
queue
)

1296 i‡(
	`WARN
(
queue
 >
IWL_MAX_TVQM_QUEUES
,

1297 "queuê%d ouào‡ønge", 
queue
))

1306 i‡(!
	`ã°_™d_˛ór_bô
(
queue
, 
å™s
->
txqs
.
queue_u£d
)) {

1307 
	`WARN_ONCE
(
	`ã°_bô
(
STATUS_DEVICE_ENABLED
, &
å™s
->
°©us
),

1308 "queuê%dÇŸ u£d", 
queue
);

1312 
	`iwl_txq_gí2_‰ì
(
å™s
, 
queue
);

1314 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "Dó˘iv©êqueuê%d\n", 
queue
);

1315 
	}
}

1317 
	$iwl_txq_gí2_tx_‰ì
(
iwl_å™s
 *
å™s
)

1319 
i
;

1321 
	`mem£t
(
å™s
->
txqs
.
queue_u£d
, 0, (trans->txqs.queue_used));

1324 
i
 = 0; i < 
	`ARRAY_SIZE
(
å™s
->
txqs
.
txq
); i++) {

1325 i‡(!
å™s
->
txqs
.
txq
[
i
])

1328 
	`iwl_txq_gí2_‰ì
(
å™s
, 
i
);

1330 
	}
}

1332 
	$iwl_txq_gí2_öô
(
iwl_å™s
 *
å™s
, 
txq_id
, 
queue_size
)

1334 
iwl_txq
 *
queue
;

1335 
ªt
;

1338 i‡(!
å™s
->
txqs
.
txq
[
txq_id
]) {

1339 
queue
 = 
	`kzÆloc
((*queue), 
GFP_KERNEL
);

1340 i‡(!
queue
) {

1341 
	`IWL_ERR
(
å™s
, "NotÉnough memory forÅx queue\n");

1342  -
ENOMEM
;

1344 
å™s
->
txqs
.
txq
[
txq_id
] = 
queue
;

1345 
ªt
 = 
	`iwl_txq_Æloc
(
å™s
, 
queue
, 
queue_size
, 
åue
);

1346 i‡(
ªt
) {

1347 
	`IWL_ERR
(
å™s
, "Tx %d queuêöô faûed\n", 
txq_id
);

1348 
îr‹
;

1351 
queue
 = 
å™s
->
txqs
.
txq
[
txq_id
];

1354 
ªt
 = 
	`iwl_txq_öô
(
å™s
, 
queue
, 
queue_size
,

1355 (
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
));

1356 i‡(
ªt
) {

1357 
	`IWL_ERR
(
å™s
, "Tx %d queuêÆlo¯Áûed\n", 
txq_id
);

1358 
îr‹
;

1360 
å™s
->
txqs
.
txq
[
txq_id
]->
id
 =Åxq_id;

1361 
	`£t_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
);

1365 
îr‹
:

1366 
	`iwl_txq_gí2_tx_‰ì
(
å™s
);

1367  
ªt
;

1368 
	}
}

1370 
ölöe
 
dma_addr_t
 
	$iwl_txq_gí1_tfd_tb_gë_addr
(
iwl_å™s
 *
å™s
,

1371 
iwl_tfd
 *
tfd
, 
u8
 
idx
)

1373 
iwl_tfd_tb
 *
tb
 = &
tfd
->
tbs
[
idx
];

1374 
dma_addr_t
 
addr
;

1375 
dma_addr_t
 
hi_Àn
;

1377 
addr
 = 
	`gë_u«lig√d_À32
(&
tb
->
lo
);

1379 i‡((
dma_addr_t
Ë<(
u32
))

1380  
addr
;

1382 
hi_Àn
 = 
	`À16_to_˝u
(
tb
->
hi_n_Àn
) & 0xF;

1389  
addr
 | ((
hi_Àn
 << 16) << 16);

1390 
	}
}

1392 
	$iwl_txq_gí1_tfd_unm≠
(
iwl_å™s
 *
å™s
,

1393 
iwl_cmd_mëa
 *
mëa
,

1394 
iwl_txq
 *
txq
, 
ödex
)

1396 
i
, 
num_tbs
;

1397 
iwl_tfd
 *
tfd
 = 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
ödex
);

1400 
num_tbs
 = 
	`iwl_txq_gí1_tfd_gë_num_tbs
(
å™s
, 
tfd
);

1402 i‡(
num_tbs
 > 
å™s
->
txqs
.
tfd
.
max_tbs
) {

1403 
	`IWL_ERR
(
å™s
, "Toÿm™y chunks: %i\n", 
num_tbs
);

1410 
i
 = 1; i < 
num_tbs
; i++) {

1411 i‡(
mëa
->
tbs
 & 
	`BIT
(
i
))

1412 
	`dma_unm≠_∑ge
(
å™s
->
dev
,

1413 
	`iwl_txq_gí1_tfd_tb_gë_addr
(
å™s
,

1414 
tfd
, 
i
),

1415 
	`iwl_txq_gí1_tfd_tb_gë_Àn
(
å™s
,

1416 
tfd
, 
i
),

1417 
DMA_TO_DEVICE
);

1419 
	`dma_unm≠_sögÀ
(
å™s
->
dev
,

1420 
	`iwl_txq_gí1_tfd_tb_gë_addr
(
å™s
,

1421 
tfd
, 
i
),

1422 
	`iwl_txq_gí1_tfd_tb_gë_Àn
(
å™s
,

1423 
tfd
, 
i
),

1424 
DMA_TO_DEVICE
);

1427 
mëa
->
tbs
 = 0;

1429 
	`iwl_txq_£t_tfd_övÆid_gí1
(
å™s
, 
tfd
);

1430 
	}
}

1432 
	#IWL_TX_CRC_SIZE
 4

	)

1433 
	#IWL_TX_DELIMITER_SIZE
 4

	)

1438 
	$iwl_txq_gí1_upd©e_byã_˙t_tbl
(
iwl_å™s
 *
å™s
,

1439 
iwl_txq
 *
txq
, 
u16
 
byã_˙t
,

1440 
num_tbs
)

1442 
iwœgn_scd_bc_tbl
 *
scd_bc_tbl
;

1443 
wrôe_±r
 = 
txq
->write_ptr;

1444 
txq_id
 = 
txq
->
id
;

1445 
u8
 
£c_˘l
 = 0;

1446 
u16
 
Àn
 = 
byã_˙t
 + 
IWL_TX_CRC_SIZE
 + 
IWL_TX_DELIMITER_SIZE
;

1447 
__À16
 
bc_ít
;

1448 
iwl_devi˚_tx_cmd
 *
dev_cmd
 = 
txq
->
íåõs
[txq->
wrôe_±r
].
cmd
;

1449 
iwl_tx_cmd
 *
tx_cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

1450 
u8
 
°a_id
 = 
tx_cmd
->sta_id;

1452 
scd_bc_tbl
 = 
å™s
->
txqs
.
scd_bc_tbls
.
addr
;

1454 
£c_˘l
 = 
tx_cmd
->sec_ctl;

1456 
£c_˘l
 & 
TX_CMD_SEC_MSK
) {

1457 
TX_CMD_SEC_CCM
:

1458 
Àn
 +
IEEE80211_CCMP_MIC_LEN
;

1460 
TX_CMD_SEC_TKIP
:

1461 
Àn
 +
IEEE80211_TKIP_ICV_LEN
;

1463 
TX_CMD_SEC_WEP
:

1464 
Àn
 +
IEEE80211_WEP_IV_LEN
 + 
IEEE80211_WEP_ICV_LEN
;

1467 i‡(
å™s
->
txqs
.
bc_èbÀ_dw‹d
)

1468 
Àn
 = 
	`DIV_ROUND_UP
(len, 4);

1470 i‡(
	`WARN_ON
(
Àn
 > 0xFFF || 
wrôe_±r
 >
TFD_QUEUE_SIZE_MAX
))

1473 
bc_ít
 = 
	`˝u_to_À16
(
Àn
 | (
°a_id
 << 12));

1475 
scd_bc_tbl
[
txq_id
].
tfd_off£t
[
wrôe_±r
] = 
bc_ít
;

1477 i‡(
wrôe_±r
 < 
TFD_QUEUE_SIZE_BC_DUP
)

1478 
scd_bc_tbl
[
txq_id
].
tfd_off£t
[
TFD_QUEUE_SIZE_MAX
 + 
wrôe_±r
] =

1479 
bc_ít
;

1480 
	}
}

1482 
	$iwl_txq_gí1_övÆ_byã_˙t_tbl
(
iwl_å™s
 *
å™s
,

1483 
iwl_txq
 *
txq
)

1485 
iwœgn_scd_bc_tbl
 *
scd_bc_tbl
 = 
å™s
->
txqs
.
scd_bc_tbls
.
addr
;

1486 
txq_id
 = 
txq
->
id
;

1487 
ªad_±r
 = 
txq
->read_ptr;

1488 
u8
 
°a_id
 = 0;

1489 
__À16
 
bc_ít
;

1490 
iwl_devi˚_tx_cmd
 *
dev_cmd
 = 
txq
->
íåõs
[
ªad_±r
].
cmd
;

1491 
iwl_tx_cmd
 *
tx_cmd
 = (*)
dev_cmd
->
∑ylﬂd
;

1493 
	`WARN_ON
(
ªad_±r
 >
TFD_QUEUE_SIZE_MAX
);

1495 i‡(
txq_id
 !
å™s
->
txqs
.
cmd
.
q_id
)

1496 
°a_id
 = 
tx_cmd
->sta_id;

1498 
bc_ít
 = 
	`˝u_to_À16
(1 | (
°a_id
 << 12));

1500 
scd_bc_tbl
[
txq_id
].
tfd_off£t
[
ªad_±r
] = 
bc_ít
;

1502 i‡(
ªad_±r
 < 
TFD_QUEUE_SIZE_BC_DUP
)

1503 
scd_bc_tbl
[
txq_id
].
tfd_off£t
[
TFD_QUEUE_SIZE_MAX
 + 
ªad_±r
] =

1504 
bc_ít
;

1505 
	}
}

1516 
	$iwl_txq_‰ì_tfd
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
)

1521 
rd_±r
 = 
txq
->
ªad_±r
;

1522 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
, 
rd_±r
);

1523 
sk_buff
 *
skb
;

1525 
	`lockdï_as£π_hñd
(&
txq
->
lock
);

1527 i‡(!
txq
->
íåõs
)

1533 i‡(
å™s
->
å™s_cfg
->
gí2
)

1534 
	`iwl_txq_gí2_tfd_unm≠
(
å™s
, &
txq
->
íåõs
[
idx
].
mëa
,

1535 
	`iwl_txq_gë_tfd
(
å™s
, 
txq
, 
rd_±r
));

1537 
	`iwl_txq_gí1_tfd_unm≠
(
å™s
, &
txq
->
íåõs
[
idx
].
mëa
,

1538 
txq
, 
rd_±r
);

1541 
skb
 = 
txq
->
íåõs
[
idx
].skb;

1547 i‡(
skb
) {

1548 
	`iwl_›_mode_‰ì_skb
(
å™s
->
›_mode
, 
skb
);

1549 
txq
->
íåõs
[
idx
].
skb
 = 
NULL
;

1551 
	}
}

1553 
	$iwl_txq_¥ogªss
(
iwl_txq
 *
txq
)

1555 
	`lockdï_as£π_hñd
(&
txq
->
lock
);

1557 i‡(!
txq
->
wd_timeout
)

1564 i‡(
txq
->
‰ozí
)

1571 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
)

1572 
	`dñ_timî
(&
txq
->
°uck_timî
);

1574 
	`mod_timî
(&
txq
->
°uck_timî
, 
jiffõs
 +Åxq->
wd_timeout
);

1575 
	}
}

1578 
	$iwl_txq_ª˛aim
(
iwl_å™s
 *
å™s
, 
txq_id
, 
s¢
,

1579 
sk_buff_hód
 *
skbs
, 
boﬁ
 
is_Êush
)

1581 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

1582 
tfd_num
, 
ªad_±r
, 
œ°_to_‰ì
;

1585 i‡(
	`WARN_ON
(
txq_id
 =
å™s
->
txqs
.
cmd
.
q_id
))

1588 i‡(
	`WARN_ON
(!
txq
))

1591 
tfd_num
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
, 
s¢
);

1593 
	`•ö_lock_bh
(&
txq
->
lock
);

1594 
ªad_±r
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->read_ptr);

1596 i‡(!
	`ã°_bô
(
txq_id
, 
å™s
->
txqs
.
queue_u£d
)) {

1597 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "Q %d inactive - ignoring idx %d\n",

1598 
txq_id
, 
s¢
);

1599 
out
;

1602 i‡(
ªad_±r
 =
tfd_num
)

1603 
out
;

1605 
	`IWL_DEBUG_TX_REPLY
(
å™s
, "[Q %d] %d (%d) -> %d (%d)\n",

1606 
txq_id
, 
ªad_±r
, 
txq
->ªad_±r, 
tfd_num
, 
s¢
);

1610 
œ°_to_‰ì
 = 
	`iwl_txq_dec_wøp
(
å™s
, 
tfd_num
);

1612 i‡(!
	`iwl_txq_u£d
(
txq
, 
œ°_to_‰ì
)) {

1613 
	`IWL_ERR
(
å™s
,

1615 
__func__
, 
txq_id
, 
œ°_to_‰ì
,

1616 
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
,

1617 
txq
->
wrôe_±r
,Åxq->
ªad_±r
);

1619 
	`iwl_›_mode_time_poöt
(
å™s
->
›_mode
,

1620 
IWL_FW_INI_TIME_POINT_FAKE_TX
,

1621 
NULL
);

1622 
out
;

1625 i‡(
	`WARN_ON
(!
	`skb_queue_em±y
(
skbs
)))

1626 
out
;

1629 
ªad_±r
 !
tfd_num
;

1630 
txq
->
ªad_±r
 = 
	`iwl_txq_öc_wøp
(
å™s
,Åxq->read_ptr),

1631 
ªad_±r
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
,Åxq->read_ptr)) {

1632 
sk_buff
 *
skb
 = 
txq
->
íåõs
[
ªad_±r
].skb;

1634 i‡(
	`WARN_ONCE
(!
skb
, "no SKBát %d (%d) on queue %d\n",

1635 
ªad_±r
, 
txq
->ªad_±r, 
txq_id
))

1638 
	`iwl_txq_‰ì_tso_∑ge
(
å™s
, 
skb
);

1640 
	`__skb_queue_èû
(
skbs
, 
skb
);

1642 
txq
->
íåõs
[
ªad_±r
].
skb
 = 
NULL
;

1644 i‡(!
å™s
->
å™s_cfg
->
gí2
)

1645 
	`iwl_txq_gí1_övÆ_byã_˙t_tbl
(
å™s
, 
txq
);

1647 
	`iwl_txq_‰ì_tfd
(
å™s
, 
txq
);

1650 
	`iwl_txq_¥ogªss
(
txq
);

1652 i‡(
	`iwl_txq_•a˚
(
å™s
, 
txq
Ë>Åxq->
low_m¨k
 &&

1653 
	`ã°_bô
(
txq_id
, 
å™s
->
txqs
.
queue_°›≥d
)) {

1654 
sk_buff_hód
 
ovîÊow_skbs
;

1655 
sk_buff
 *
skb
;

1657 
	`__skb_queue_hód_öô
(&
ovîÊow_skbs
);

1658 
	`skb_queue_•li˚_öô
(&
txq
->
ovîÊow_q
,

1659 
is_Êush
 ? 
skbs
 : &
ovîÊow_skbs
);

1668 
txq
->
ovîÊow_tx
 = 
åue
;

1677 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

1679 (
skb
 = 
	`__skb_dequeue
(&
ovîÊow_skbs
))) {

1680 
iwl_devi˚_tx_cmd
 *
dev_cmd_±r
;

1682 
dev_cmd_±r
 = *(**)((
u8
 *)
skb
->
cb
 +

1683 
å™s
->
txqs
.
dev_cmd_offs
);

1690 
	`iwl_å™s_tx
(
å™s
, 
skb
, 
dev_cmd_±r
, 
txq_id
);

1693 i‡(
	`iwl_txq_•a˚
(
å™s
, 
txq
Ë>Åxq->
low_m¨k
)

1694 
	`iwl_wake_queue
(
å™s
, 
txq
);

1696 
	`•ö_lock_bh
(&
txq
->
lock
);

1697 
txq
->
ovîÊow_tx
 = 
Ál£
;

1700 
out
:

1701 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

1702 
	}
}

1705 
	$iwl_txq_£t_q_±rs
(
iwl_å™s
 *
å™s
, 
txq_id
, 
±r
)

1707 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
txq_id
];

1709 
	`•ö_lock_bh
(&
txq
->
lock
);

1711 
txq
->
wrôe_±r
 = 
±r
;

1712 
txq
->
ªad_±r
 =Åxq->
wrôe_±r
;

1714 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

1715 
	}
}

1717 
	$iwl_å™s_txq_‰ìze_timî
(
iwl_å™s
 *
å™s
, 
txqs
,

1718 
boﬁ
 
‰ìze
)

1720 
queue
;

1722 
	`f‹_óch_£t_bô
(
queue
, &
txqs
, 
BITS_PER_LONG
) {

1723 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[
queue
];

1724 
now
;

1726 
	`•ö_lock_bh
(&
txq
->
lock
);

1728 
now
 = 
jiffõs
;

1730 i‡(
txq
->
‰ozí
 =
‰ìze
)

1731 
√xt_queue
;

1733 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "%s TXQ %d\n",

1734 
‰ìze
 ? "Fªezög" : "Wakög", 
queue
);

1736 
txq
->
‰ozí
 = 
‰ìze
;

1738 i‡(
txq
->
ªad_±r
 =txq->
wrôe_±r
)

1739 
√xt_queue
;

1741 i‡(
‰ìze
) {

1742 i‡(
	`u∆ikñy
(
	`time_a·î
(
now
,

1743 
txq
->
°uck_timî
.
expúes
))) {

1748 
√xt_queue
;

1751 
txq
->
‰ozí_expúy_ªmaödî
 =

1752 
txq
->
°uck_timî
.
expúes
 - 
now
;

1753 
	`dñ_timî
(&
txq
->
°uck_timî
);

1754 
√xt_queue
;

1761 
	`mod_timî
(&
txq
->
°uck_timî
,

1762 
now
 + 
txq
->
‰ozí_expúy_ªmaödî
);

1764 
√xt_queue
:

1765 
	`•ö_u∆ock_bh
(&
txq
->
lock
);

1767 
	}
}

1769 
	#HOST_COMPLETE_TIMEOUT
 (2 * 
HZ
)

	)

1771 
	$iwl_å™s_txq_£nd_hcmd_sync
(
iwl_å™s
 *
å™s
,

1772 
iwl_ho°_cmd
 *
cmd
)

1774 c⁄° *
cmd_°r
 = 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd
->
id
);

1775 
iwl_txq
 *
txq
 = 
å™s
->
txqs
.txq[å™s->txqs.
cmd
.
q_id
];

1776 
cmd_idx
;

1777 
ªt
;

1779 
	`IWL_DEBUG_INFO
(
å™s
, "Aâem±ögÅÿ£nd syn¯comm™d %s\n", 
cmd_°r
);

1781 i‡(
	`WARN
(
	`ã°_™d_£t_bô
(
STATUS_SYNC_HCMD_ACTIVE
,

1782 &
å™s
->
°©us
),

1783 "Comm™d %s:á comm™d i†Æªadyá˘ive!\n", 
cmd_°r
))

1784  -
EIO
;

1786 
	`IWL_DEBUG_INFO
(
å™s
, "Sëtög HCMD_ACTIVE f‹ comm™d %s\n", 
cmd_°r
);

1788 
cmd_idx
 = 
å™s
->
›s
->
	`£nd_cmd
—øns, 
cmd
);

1789 i‡(
cmd_idx
 < 0) {

1790 
ªt
 = 
cmd_idx
;

1791 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

1792 
	`IWL_ERR
(
å™s
, "Error sending %s:Énqueue_hcmd failed: %d\n",

1793 
cmd_°r
, 
ªt
);

1794  
ªt
;

1797 
ªt
 = 
	`waô_evít_timeout
(
å™s
->
waô_comm™d_queue
,

1798 !
	`ã°_bô
(
STATUS_SYNC_HCMD_ACTIVE
,

1799 &
å™s
->
°©us
),

1800 
HOST_COMPLETE_TIMEOUT
);

1801 i‡(!
ªt
) {

1802 
	`IWL_ERR
(
å™s
, "Error sending %s:Åime outáfter %dms.\n",

1803 
cmd_°r
, 
	`jiffõs_to_m£cs
(
HOST_COMPLETE_TIMEOUT
));

1805 
	`IWL_ERR
(
å™s
, "Current CMD queueÑead_ptr %d write_ptr %d\n",

1806 
txq
->
ªad_±r
,Åxq->
wrôe_±r
);

1808 
	`˛ór_bô
(
STATUS_SYNC_HCMD_ACTIVE
, &
å™s
->
°©us
);

1809 
	`IWL_DEBUG_INFO
(
å™s
, "Clearing HCMD_ACTIVE for command %s\n",

1810 
cmd_°r
);

1811 
ªt
 = -
ETIMEDOUT
;

1813 
	`iwl_å™s_sync_nmi
(
å™s
);

1814 
ˇn˚l
;

1817 i‡(
	`ã°_bô
(
STATUS_FW_ERROR
, &
å™s
->
°©us
)) {

1818 i‡(!
	`ã°_™d_˛ór_bô
(
STATUS_SUPPRESS_CMD_ERROR_ONCE
,

1819 &
å™s
->
°©us
)) {

1820 
	`IWL_ERR
(
å™s
, "FWÉº‹ i¿SYNC CMD %s\n", 
cmd_°r
);

1821 
	`dump_°ack
();

1823 
ªt
 = -
EIO
;

1824 
ˇn˚l
;

1827 i‡(!(
cmd
->
Êags
 & 
CMD_SEND_IN_RFKILL
) &&

1828 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
)) {

1829 
	`IWL_DEBUG_RF_KILL
(
å™s
, "RFKILL in SYNC CMD...ÇoÑsp\n");

1830 
ªt
 = -
ERFKILL
;

1831 
ˇn˚l
;

1834 i‡((
cmd
->
Êags
 & 
CMD_WANT_SKB
Ë&& !cmd->
ª•_pkt
) {

1835 
	`IWL_ERR
(
å™s
, "Eº‹: Re•⁄£ NULL i¿'%s'\n", 
cmd_°r
);

1836 
ªt
 = -
EIO
;

1837 
ˇn˚l
;

1842 
ˇn˚l
:

1843 i‡(
cmd
->
Êags
 & 
CMD_WANT_SKB
) {

1850 
txq
->
íåõs
[
cmd_idx
].
mëa
.
Êags
 &~
CMD_WANT_SKB
;

1853 i‡(
cmd
->
ª•_pkt
) {

1854 
	`iwl_‰ì_ª•
(
cmd
);

1855 
cmd
->
ª•_pkt
 = 
NULL
;

1858  
ªt
;

1859 
	}
}

1861 
	$iwl_å™s_txq_£nd_hcmd
(
iwl_å™s
 *
å™s
,

1862 
iwl_ho°_cmd
 *
cmd
)

1865 i‡(
	`ã°_bô
(
STATUS_TRANS_DEAD
, &
å™s
->
°©us
))

1866  -
ENODEV
;

1868 i‡(!(
cmd
->
Êags
 & 
CMD_SEND_IN_RFKILL
) &&

1869 
	`ã°_bô
(
STATUS_RFKILL_OPMODE
, &
å™s
->
°©us
)) {

1870 
	`IWL_DEBUG_RF_KILL
(
å™s
, "Dropping CMD 0x%x: RF KILL\n",

1871 
cmd
->
id
);

1872  -
ERFKILL
;

1875 i‡(
	`u∆ikñy
(
å™s
->
sy°em_pm_mode
 =
IWL_PLAT_PM_MODE_D3
 &&

1876 !(
cmd
->
Êags
 & 
CMD_SEND_IN_D3
))) {

1877 
	`IWL_DEBUG_WOWLAN
(
å™s
, "Dr›pög CMD 0x%x: D3\n", 
cmd
->
id
);

1878  -
EHOSTDOWN
;

1881 i‡(
cmd
->
Êags
 & 
CMD_ASYNC
) {

1882 
ªt
;

1885 i‡(
	`WARN_ON
(
cmd
->
Êags
 & 
CMD_WANT_SKB
))

1886  -
EINVAL
;

1888 
ªt
 = 
å™s
->
›s
->
	`£nd_cmd
—øns, 
cmd
);

1889 i‡(
ªt
 < 0) {

1890 
	`IWL_ERR
(
å™s
,

1892 
	`iwl_gë_cmd_°rög
(
å™s
, 
cmd
->
id
), 
ªt
);

1893  
ªt
;

1898  
	`iwl_å™s_txq_£nd_hcmd_sync
(
å™s
, 
cmd
);

1899 
	}
}

	@queue/tx.h

5 #i‚de‡
__iwl_å™s_queue_tx_h__


6 
	#__iwl_å™s_queue_tx_h__


	)

7 
	~"iwl-fh.h
"

8 
	~"fw/≠i/tx.h
"

10 
	siwl_tso_hdr_∑ge
 {

11 
∑ge
 *
	m∑ge
;

12 
u8
 *
	mpos
;

15 
ölöe
 
dma_addr_t


16 
	$iwl_txq_gë_fú°_tb_dma
(
iwl_txq
 *
txq
, 
idx
)

18  
txq
->
fú°_tb_dma
 +

19 (
iwl_pcõ_fú°_tb_buf
Ë* 
idx
;

20 
	}
}

22 
ölöe
 
u16
 
	$iwl_txq_gë_cmd_ödex
(c⁄° 
iwl_txq
 *
q
, 
u32
 
ödex
)

24  
ödex
 & (
q
->
n_wödow
 - 1);

25 
	}
}

27 
iwl_txq_gí2_unm≠
(
iwl_å™s
 *
å™s
, 
txq_id
);

29 
ölöe
 
	$iwl_wake_queue
(
iwl_å™s
 *
å™s
,

30 
iwl_txq
 *
txq
)

32 i‡(
	`ã°_™d_˛ór_bô
(
txq
->
id
, 
å™s
->
txqs
.
queue_°›≥d
)) {

33 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "Wakêhwq %d\n", 
txq
->
id
);

34 
	`iwl_›_mode_queue_nŸ_fuŒ
(
å™s
->
›_mode
, 
txq
->
id
);

36 
	}
}

38 
ölöe
 *
	$iwl_txq_gë_tfd
(
iwl_å™s
 *
å™s
,

39 
iwl_txq
 *
txq
, 
idx
)

41 i‡(
å™s
->
å™s_cfg
->
gí2
)

42 
idx
 = 
	`iwl_txq_gë_cmd_ödex
(
txq
, idx);

44  (
u8
 *)
txq
->
tfds
 + 
å™s
->
txqs
.
tfd
.
size
 * 
idx
;

45 
	}
}

47 
iwl_txq_Æloc
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
, 
¶Ÿs_num
,

48 
boﬁ
 
cmd_queue
);

54 
ölöe
 
boﬁ
 
	$iwl_txq_¸os£s_4g_bound¨y
(
u64
 
phys
, 
u16
 
Àn
)

56  
	`uµî_32_bôs
(
phys
Ë!uµî_32_bôs’hy†+ 
Àn
);

57 
	}
}

59 
iwl_txq_•a˚
(
iwl_å™s
 *
å™s
, c⁄° 
iwl_txq
 *
q
);

61 
ölöe
 
	$iwl_txq_°›
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
)

63 i‡(!
	`ã°_™d_£t_bô
(
txq
->
id
, 
å™s
->
txqs
.
queue_°›≥d
)) {

64 
	`iwl_›_mode_queue_fuŒ
(
å™s
->
›_mode
, 
txq
->
id
);

65 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "St› hwq %d\n", 
txq
->
id
);

67 
	`IWL_DEBUG_TX_QUEUES
(
å™s
, "hwq %dálready stopped\n",

68 
txq
->
id
);

70 
	}
}

77 
ölöe
 
	$iwl_txq_öc_wøp
(
iwl_å™s
 *
å™s
, 
ödex
)

79  ++
ödex
 &

80 (
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1);

81 
	}
}

88 
ölöe
 
	$iwl_txq_dec_wøp
(
iwl_å™s
 *
å™s
, 
ödex
)

90  --
ödex
 &

91 (
å™s
->
å™s_cfg
->
ba£_∑øms
->
max_tfd_queue_size
 - 1);

92 
	}
}

94 
ölöe
 
boﬁ
 
	$iwl_txq_u£d
(c⁄° 
iwl_txq
 *
q
, 
i
)

96 
ödex
 = 
	`iwl_txq_gë_cmd_ödex
(
q
, 
i
);

97 
r
 = 
	`iwl_txq_gë_cmd_ödex
(
q
, q->
ªad_±r
);

98 
w
 = 
	`iwl_txq_gë_cmd_ödex
(
q
, q->
wrôe_±r
);

100  
w
 >
r
 ?

101 (
ödex
 >
r
 && index < 
w
) :

102 !(
ödex
 < 
r
 && index >
w
);

103 
	}
}

105 
iwl_txq_‰ì_tso_∑ge
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
);

107 
iwl_txq_log_scd_îr‹
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
);

109 
iwl_txq_gí2_£t_tb
(
iwl_å™s
 *
å™s
,

110 
iwl_tfh_tfd
 *
tfd
, 
dma_addr_t
 
addr
,

111 
u16
 
Àn
);

113 
iwl_txq_gí2_tfd_unm≠
(
iwl_å™s
 *
å™s
,

114 
iwl_cmd_mëa
 *
mëa
,

115 
iwl_tfh_tfd
 *
tfd
);

117 
iwl_txq_dyn_Æloc
(
iwl_å™s
 *
å™s
, 
u32
 
Êags
,

118 
u32
 
°a_mask
, 
u8
 
tid
,

119 
size
, 
timeout
);

121 
iwl_txq_gí2_tx
(
iwl_å™s
 *
å™s
, 
sk_buff
 *
skb
,

122 
iwl_devi˚_tx_cmd
 *
dev_cmd
, 
txq_id
);

124 
iwl_txq_dyn_‰ì
(
iwl_å™s
 *
å™s
, 
queue
);

125 
iwl_txq_gí2_‰ì_tfd
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
);

126 
iwl_txq_öc_wr_±r
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
);

127 
iwl_txq_gí2_tx_‰ì
(
iwl_å™s
 *
å™s
);

128 
iwl_txq_öô
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
, 
¶Ÿs_num
,

129 
boﬁ
 
cmd_queue
);

130 
iwl_txq_gí2_öô
(
iwl_å™s
 *
å™s
, 
txq_id
, 
queue_size
);

131 #ifde‡
CONFIG_INET


132 
iwl_tso_hdr_∑ge
 *
gë_∑ge_hdr
(
iwl_å™s
 *
å™s
, 
size_t
 
Àn
,

133 
sk_buff
 *
skb
);

135 
ölöe
 
u8
 
	$iwl_txq_gí1_tfd_gë_num_tbs
(
iwl_å™s
 *
å™s
,

136 
iwl_tfd
 *
tfd
)

138  
tfd
->
num_tbs
 & 0x1f;

139 
	}
}

141 
ölöe
 
u16
 
	$iwl_txq_gí1_tfd_tb_gë_Àn
(
iwl_å™s
 *
å™s
,

142 *
_tfd
, 
u8
 
idx
)

144 
iwl_tfd
 *
tfd
;

145 
iwl_tfd_tb
 *
tb
;

147 i‡(
å™s
->
å™s_cfg
->
gí2
) {

148 
iwl_tfh_tfd
 *
tfh_tfd
 = 
_tfd
;

149 
iwl_tfh_tb
 *
tfh_tb
 = &
tfh_tfd
->
tbs
[
idx
];

151  
	`À16_to_˝u
(
tfh_tb
->
tb_Àn
);

154 
tfd
 = (
iwl_tfd
 *)
_tfd
;

155 
tb
 = &
tfd
->
tbs
[
idx
];

157  
	`À16_to_˝u
(
tb
->
hi_n_Àn
) >> 4;

158 
	}
}

160 
ölöe
 
	$iwl_pcõ_gí1_tfd_£t_tb
(
iwl_å™s
 *
å™s
,

161 
iwl_tfd
 *
tfd
,

162 
u8
 
idx
, 
dma_addr_t
 
addr
, 
u16
 
Àn
)

164 
iwl_tfd_tb
 *
tb
 = &
tfd
->
tbs
[
idx
];

165 
u16
 
hi_n_Àn
 = 
Àn
 << 4;

167 
	`put_u«lig√d_À32
(
addr
, &
tb
->
lo
);

168 
hi_n_Àn
 |
	`iwl_gë_dma_hi_addr
(
addr
);

170 
tb
->
hi_n_Àn
 = 
	`˝u_to_À16
(hi_n_len);

172 
tfd
->
num_tbs
 = 
idx
 + 1;

173 
	}
}

175 
iwl_txq_gí1_tfd_unm≠
(
iwl_å™s
 *
å™s
,

176 
iwl_cmd_mëa
 *
mëa
,

177 
iwl_txq
 *
txq
, 
ödex
);

178 
iwl_txq_gí1_övÆ_byã_˙t_tbl
(
iwl_å™s
 *
å™s
,

179 
iwl_txq
 *
txq
);

180 
iwl_txq_gí1_upd©e_byã_˙t_tbl
(
iwl_å™s
 *
å™s
,

181 
iwl_txq
 *
txq
, 
u16
 
byã_˙t
,

182 
num_tbs
);

183 
iwl_txq_ª˛aim
(
iwl_å™s
 *
å™s
, 
txq_id
, 
s¢
,

184 
sk_buff_hód
 *
skbs
, 
boﬁ
 
is_Êush
);

185 
iwl_txq_£t_q_±rs
(
iwl_å™s
 *
å™s
, 
txq_id
, 
±r
);

186 
iwl_å™s_txq_‰ìze_timî
(
iwl_å™s
 *
å™s
, 
txqs
,

187 
boﬁ
 
‰ìze
);

188 
iwl_txq_¥ogªss
(
iwl_txq
 *
txq
);

189 
iwl_txq_‰ì_tfd
(
iwl_å™s
 *
å™s
, 
iwl_txq
 *
txq
);

190 
iwl_å™s_txq_£nd_hcmd
(
iwl_å™s
 *
å™s
, 
iwl_ho°_cmd
 *
cmd
);

	@tests/devinfo.c

7 
	~<kunô/ã°.h
>

8 
	~"iwl-drv.h
"

9 
	~"iwl-c⁄fig.h
"

11 
MODULE_IMPORT_NS
(
EXPORTED_FOR_KUNIT_TESTING
);

13 
	$iwl_pci_¥öt_dev_öfo
(c⁄° *
pfx
, c⁄° 
iwl_dev_öfo
 *
di
)

15 
	`¥ötk
(
KERN_DEBUG
 "%sdev=%.4x,subdev=%.4x,mac_type=%.4x,mac_step=%.4x,rf_type=%.4x,cdb=%d,jacket=%d,rf_id=%.2x,no_160=%d,cores=%.2x\n",

16 
pfx
, 
di
->
devi˚
, di->
subdevi˚
, di->
mac_ty≥
, di->
mac_°ï
,

17 
di
->
rf_ty≥
, di->
cdb
, di->
jackë
, di->
rf_id
, di->
no_160
,

18 
di
->
c‹es
);

19 
	}
}

21 
	$devöfo_èbÀ_‹dî
(
kunô
 *
ã°
)

23 
idx
;

25 
idx
 = 0; idx < 
iwl_dev_öfo_èbÀ_size
; idx++) {

26 c⁄° 
iwl_dev_öfo
 *
di
 = &
iwl_dev_öfo_èbÀ
[
idx
];

27 c⁄° 
iwl_dev_öfo
 *
ªt
;

29 
ªt
 = 
	`iwl_pci_föd_dev_öfo
(
di
->
devi˚
, di->
subdevi˚
,

30 
di
->
mac_ty≥
, di->
mac_°ï
,

31 
di
->
rf_ty≥
, di->
cdb
,

32 
di
->
jackë
, di->
rf_id
,

33 
di
->
no_160
, di->
c‹es
, di->
rf_°ï
);

34 i‡(
ªt
 !
di
) {

35 
	`iwl_pci_¥öt_dev_öfo
("£¨ched: ", 
di
);

36 
	`iwl_pci_¥öt_dev_öfo
("found: ", 
ªt
);

37 
	`KUNIT_FAIL
(
ã°
,

39 
idx
, ()(
ªt
 - 
iwl_dev_öfo_èbÀ
));

42 
	}
}

44 
kunô_ˇ£
 
	gdevöfo_ã°_ˇ£s
[] = {

45 
KUNIT_CASE
(
devöfo_èbÀ_‹dî
),

49 
kunô_suôe
 
	giwlwifi_devöfo
 = {

50 .
«me
 = "iwlwifi-devinfo",

51 .
	gã°_ˇ£s
 = 
devöfo_ã°_ˇ£s
,

54 
kunô_ã°_suôe
(
iwlwifi_devöfo
);

	@tests/module.c

7 
	~<löux/moduÀ.h
>

9 
MODULE_LICENSE
("GPL");

10 
MODULE_DESCRIPTION
("kunitÅests for iwlwifi");

	@/usr/include/linux/fs.h

2 #i‚de‡
_LINUX_FS_H


3 
	#_LINUX_FS_H


	)

13 
	~<löux/limôs.h
>

14 
	~<löux/io˘l.h
>

15 
	~<löux/ty≥s.h
>

16 
	~<löux/fs¸y±.h
>

19 
	~<löux/mou¡.h
>

32 #unde‡
NR_OPEN


33 
	#INR_OPEN_CUR
 1024

	)

34 
	#INR_OPEN_MAX
 4096

	)

36 
	#BLOCK_SIZE_BITS
 10

	)

37 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

39 
	#SEEK_SET
 0

	)

40 
	#SEEK_CUR
 1

	)

41 
	#SEEK_END
 2

	)

42 
	#SEEK_DATA
 3

	)

43 
	#SEEK_HOLE
 4

	)

44 
	#SEEK_MAX
 
SEEK_HOLE


	)

46 
	#RENAME_NOREPLACE
 (1 << 0Ë

	)

47 
	#RENAME_EXCHANGE
 (1 << 1Ë

	)

48 
	#RENAME_WHITEOUT
 (1 << 2Ë

	)

50 
	sfûe_˛⁄e_ønge
 {

51 
__s64
 
	m§c_fd
;

52 
__u64
 
	m§c_off£t
;

53 
__u64
 
	m§c_Àngth
;

54 
__u64
 
	mde°_off£t
;

57 
	sf°rim_ønge
 {

58 
__u64
 
	m°¨t
;

59 
__u64
 
	mÀn
;

60 
__u64
 
	mmöÀn
;

64 
	#FILE_DEDUPE_RANGE_SAME
 0

	)

65 
	#FILE_DEDUPE_RANGE_DIFFERS
 1

	)

68 
	sfûe_dedu≥_ønge_öfo
 {

69 
__s64
 
	mde°_fd
;

70 
__u64
 
	mde°_off£t
;

71 
__u64
 
	mbyãs_dedu≥d
;

78 
__s32
 
	m°©us
;

79 
__u32
 
	mª£rved
;

83 
	sfûe_dedu≥_ønge
 {

84 
__u64
 
	m§c_off£t
;

85 
__u64
 
	m§c_Àngth
;

86 
__u16
 
	mde°_cou¡
;

87 
__u16
 
	mª£rved1
;

88 
__u32
 
	mª£rved2
;

89 
fûe_dedu≥_ønge_öfo
 
	möfo
[0];

93 
	sfûes_°©_°ru˘
 {

94 
	mƒ_fûes
;

95 
	mƒ_‰ì_fûes
;

96 
	mmax_fûes
;

99 
	söodes_°©_t
 {

100 
	mƒ_öodes
;

101 
	mƒ_unu£d
;

102 
	mdummy
[5];

106 
	#NR_FILE
 8192

	)

111 
	sfsx©å
 {

112 
__u32
 
	mfsx_xÊags
;

113 
__u32
 
	mfsx_extsize
;

114 
__u32
 
	mfsx_√xã¡s
;

115 
__u32
 
	mfsx_¥ojid
;

116 
__u32
 
	mfsx_cowextsize
;

117 
	mfsx_∑d
[8];

123 
	#FS_XFLAG_REALTIME
 0x00000001

	)

124 
	#FS_XFLAG_PREALLOC
 0x00000002

	)

125 
	#FS_XFLAG_IMMUTABLE
 0x00000008

	)

126 
	#FS_XFLAG_APPEND
 0x00000010

	)

127 
	#FS_XFLAG_SYNC
 0x00000020

	)

128 
	#FS_XFLAG_NOATIME
 0x00000040

	)

129 
	#FS_XFLAG_NODUMP
 0x00000080

	)

130 
	#FS_XFLAG_RTINHERIT
 0x00000100

	)

131 
	#FS_XFLAG_PROJINHERIT
 0x00000200

	)

132 
	#FS_XFLAG_NOSYMLINKS
 0x00000400

	)

133 
	#FS_XFLAG_EXTSIZE
 0x00000800

	)

134 
	#FS_XFLAG_EXTSZINHERIT
 0x00001000

	)

135 
	#FS_XFLAG_NODEFRAG
 0x00002000

	)

136 
	#FS_XFLAG_FILESTREAM
 0x00004000

	)

137 
	#FS_XFLAG_DAX
 0x00008000

	)

138 
	#FS_XFLAG_COWEXTSIZE
 0x00010000

	)

139 
	#FS_XFLAG_HASATTR
 0x80000000

	)

144 
	#BLKROSET
 
	`_IO
(0x12,93Ë

	)

145 
	#BLKROGET
 
	`_IO
(0x12,94Ë

	)

146 
	#BLKRRPART
 
	`_IO
(0x12,95Ë

	)

147 
	#BLKGETSIZE
 
	`_IO
(0x12,96Ë

	)

148 
	#BLKFLSBUF
 
	`_IO
(0x12,97Ë

	)

149 
	#BLKRASET
 
	`_IO
(0x12,98Ë

	)

150 
	#BLKRAGET
 
	`_IO
(0x12,99Ë

	)

151 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

152 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

153 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

154 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

155 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

157 
	#BLKPG
 
	`_IO
(0x12,105)

	)

161 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

162 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

167 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

168 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

169 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
Ë

	)

170 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_åa˚_£tup
)

	)

171 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

172 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

173 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

174 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

175 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

176 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

177 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

178 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

179 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

180 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

181 
	#BLKROTATIONAL
 
	`_IO
(0x12,126)

	)

182 
	#BLKZEROOUT
 
	`_IO
(0x12,127)

	)

183 
	#BLKGETDISKSEQ
 
	`_IOR
(0x12,128,
__u64
)

	)

189 
	#BMAP_IOCTL
 1

	)

190 
	#FIBMAP
 
	`_IO
(0x00,1Ë

	)

191 
	#FIGETBSZ
 
	`_IO
(0x00,2Ë

	)

192 
	#FIFREEZE
 
	`_IOWR
('X', 119, Ë

	)

193 
	#FITHAW
 
	`_IOWR
('X', 120, Ë

	)

194 
	#FITRIM
 
	`_IOWR
('X', 121, 
f°rim_ønge
Ë

	)

195 
	#FICLONE
 
	`_IOW
(0x94, 9, )

	)

196 
	#FICLONERANGE
 
	`_IOW
(0x94, 13, 
fûe_˛⁄e_ønge
)

	)

197 
	#FIDEDUPERANGE
 
	`_IOWR
(0x94, 54, 
fûe_dedu≥_ønge
)

	)

199 
	#FSLABEL_MAX
 256

	)

201 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

202 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

203 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

204 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

205 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
fõm≠
)

	)

206 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

207 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

208 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

209 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

210 
	#FS_IOC_FSGETXATTR
 
	`_IOR
('X', 31, 
fsx©å
)

	)

211 
	#FS_IOC_FSSETXATTR
 
	`_IOW
('X', 32, 
fsx©å
)

	)

212 
	#FS_IOC_GETFSLABEL
 
	`_IOR
(0x94, 49, [
FSLABEL_MAX
])

	)

213 
	#FS_IOC_SETFSLABEL
 
	`_IOW
(0x94, 50, [
FSLABEL_MAX
])

	)

235 
	#FS_SECRM_FL
 0x00000001

	)

236 
	#FS_UNRM_FL
 0x00000002

	)

237 
	#FS_COMPR_FL
 0x00000004

	)

238 
	#FS_SYNC_FL
 0x00000008

	)

239 
	#FS_IMMUTABLE_FL
 0x00000010

	)

240 
	#FS_APPEND_FL
 0x00000020

	)

241 
	#FS_NODUMP_FL
 0x00000040

	)

242 
	#FS_NOATIME_FL
 0x00000080

	)

244 
	#FS_DIRTY_FL
 0x00000100

	)

245 
	#FS_COMPRBLK_FL
 0x00000200

	)

246 
	#FS_NOCOMP_FL
 0x00000400

	)

248 
	#FS_ENCRYPT_FL
 0x00000800

	)

249 
	#FS_BTREE_FL
 0x00001000

	)

250 
	#FS_INDEX_FL
 0x00001000

	)

251 
	#FS_IMAGIC_FL
 0x00002000

	)

252 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

253 
	#FS_NOTAIL_FL
 0x00008000

	)

254 
	#FS_DIRSYNC_FL
 0x00010000

	)

255 
	#FS_TOPDIR_FL
 0x00020000

	)

256 
	#FS_HUGE_FILE_FL
 0x00040000

	)

257 
	#FS_EXTENT_FL
 0x00080000

	)

258 
	#FS_VERITY_FL
 0x00100000

	)

259 
	#FS_EA_INODE_FL
 0x00200000

	)

260 
	#FS_EOFBLOCKS_FL
 0x00400000

	)

261 
	#FS_NOCOW_FL
 0x00800000

	)

262 
	#FS_DAX_FL
 0x02000000

	)

263 
	#FS_INLINE_DATA_FL
 0x10000000

	)

264 
	#FS_PROJINHERIT_FL
 0x20000000

	)

265 
	#FS_CASEFOLD_FL
 0x40000000

	)

266 
	#FS_RESERVED_FL
 0x80000000

	)

268 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

269 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

272 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

273 
	#SYNC_FILE_RANGE_WRITE
 2

	)

274 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

275 
	#SYNC_FILE_RANGE_WRITE_AND_WAIT
 (
SYNC_FILE_RANGE_WRITE
 | \

276 
SYNC_FILE_RANGE_WAIT_BEFORE
 | \

277 
SYNC_FILE_RANGE_WAIT_AFTER
)

	)

283 
	t__bôwi£
 
	t__kî√l_rwf_t
;

286 
	#RWF_HIPRI
 ((
__kî√l_rwf_t
)0x00000001)

	)

289 
	#RWF_DSYNC
 ((
__kî√l_rwf_t
)0x00000002)

	)

292 
	#RWF_SYNC
 ((
__kî√l_rwf_t
)0x00000004)

	)

295 
	#RWF_NOWAIT
 ((
__kî√l_rwf_t
)0x00000008)

	)

298 
	#RWF_APPEND
 ((
__kî√l_rwf_t
)0x00000010)

	)

301 
	#RWF_SUPPORTED
 (
RWF_HIPRI
 | 
RWF_DSYNC
 | 
RWF_SYNC
 | 
RWF_NOWAIT
 |\

302 
RWF_APPEND
)

	)

	@/usr/include/linux/icmp.h

18 #i‚de‡
_LINUX_ICMP_H


19 
	#_LINUX_ICMP_H


	)

21 
	~<löux/ty≥s.h
>

22 
	~<asm/byã‹dî.h
>

23 
	~<löux/if.h
>

24 
	~<löux/ö6.h
>

26 
	#ICMP_ECHOREPLY
 0

	)

27 
	#ICMP_DEST_UNREACH
 3

	)

28 
	#ICMP_SOURCE_QUENCH
 4

	)

29 
	#ICMP_REDIRECT
 5

	)

30 
	#ICMP_ECHO
 8

	)

31 
	#ICMP_TIME_EXCEEDED
 11

	)

32 
	#ICMP_PARAMETERPROB
 12

	)

33 
	#ICMP_TIMESTAMP
 13

	)

34 
	#ICMP_TIMESTAMPREPLY
 14

	)

35 
	#ICMP_INFO_REQUEST
 15

	)

36 
	#ICMP_INFO_REPLY
 16

	)

37 
	#ICMP_ADDRESS
 17

	)

38 
	#ICMP_ADDRESSREPLY
 18

	)

39 
	#NR_ICMP_TYPES
 18

	)

43 
	#ICMP_NET_UNREACH
 0

	)

44 
	#ICMP_HOST_UNREACH
 1

	)

45 
	#ICMP_PROT_UNREACH
 2

	)

46 
	#ICMP_PORT_UNREACH
 3

	)

47 
	#ICMP_FRAG_NEEDED
 4

	)

48 
	#ICMP_SR_FAILED
 5

	)

49 
	#ICMP_NET_UNKNOWN
 6

	)

50 
	#ICMP_HOST_UNKNOWN
 7

	)

51 
	#ICMP_HOST_ISOLATED
 8

	)

52 
	#ICMP_NET_ANO
 9

	)

53 
	#ICMP_HOST_ANO
 10

	)

54 
	#ICMP_NET_UNR_TOS
 11

	)

55 
	#ICMP_HOST_UNR_TOS
 12

	)

56 
	#ICMP_PKT_FILTERED
 13

	)

57 
	#ICMP_PREC_VIOLATION
 14

	)

58 
	#ICMP_PREC_CUTOFF
 15

	)

59 
	#NR_ICMP_UNREACH
 15

	)

62 
	#ICMP_REDIR_NET
 0

	)

63 
	#ICMP_REDIR_HOST
 1

	)

64 
	#ICMP_REDIR_NETTOS
 2

	)

65 
	#ICMP_REDIR_HOSTTOS
 3

	)

68 
	#ICMP_EXC_TTL
 0

	)

69 
	#ICMP_EXC_FRAGTIME
 1

	)

72 
	#ICMP_EXT_ECHO
 42

	)

73 
	#ICMP_EXT_ECHOREPLY
 43

	)

74 
	#ICMP_EXT_CODE_MAL_QUERY
 1

	)

75 
	#ICMP_EXT_CODE_NO_IF
 2

	)

76 
	#ICMP_EXT_CODE_NO_TABLE_ENT
 3

	)

77 
	#ICMP_EXT_CODE_MULT_IFS
 4

	)

80 
	#ICMP_EXT_ECHOREPLY_ACTIVE
 (1 << 2)

	)

81 
	#ICMP_EXT_ECHOREPLY_IPV4
 (1 << 1)

	)

82 
	#ICMP_EXT_ECHOREPLY_IPV6
 1

	)

83 
	#ICMP_EXT_ECHO_CTYPE_NAME
 1

	)

84 
	#ICMP_EXT_ECHO_CTYPE_INDEX
 2

	)

85 
	#ICMP_EXT_ECHO_CTYPE_ADDR
 3

	)

86 
	#ICMP_AFI_IP
 1

	)

87 
	#ICMP_AFI_IP6
 2

	)

89 
	sicmphdr
 {

90 
__u8
 
	mty≥
;

91 
__u8
 
	mcode
;

92 
__sum16
 
	mchecksum
;

95 
__be16
 
	mid
;

96 
__be16
 
	m£quí˚
;

97 } 
	mecho
;

98 
__be32
 
	mg©eway
;

100 
__be16
 
	m__unu£d
;

101 
__be16
 
	mmtu
;

102 } 
	m‰ag
;

103 
__u8
 
	mª£rved
[4];

104 } 
	mun
;

112 
	#ICMP_FILTER
 1

	)

114 
	sicmp_fûãr
 {

115 
__u32
 
	md©a
;

119 
	sicmp_ext_hdr
 {

120 #i‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

121 
__u8
 
	mª£rved1
:4,

122 
	mvîsi⁄
:4;

123 #ñi‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

124 
__u8
 
	mvîsi⁄
:4,

125 
	mª£rved1
:4;

129 
__u8
 
	mª£rved2
;

130 
__sum16
 
	mchecksum
;

134 
	sicmp_extobj_hdr
 {

135 
__be16
 
	mÀngth
;

136 
__u8
 
	m˛ass_num
;

137 
__u8
 
	m˛ass_ty≥
;

141 
	sicmp_ext_echo_˘y≥3_hdr
 {

142 
__be16
 
	mafi
;

143 
__u8
 
	maddæí
;

144 
__u8
 
	mª£rved
;

148 
	sicmp_ext_echo_iio
 {

149 
icmp_extobj_hdr
 
	mextobj_hdr
;

151 
	m«me
[
IFNAMSIZ
];

152 
__be32
 
	mifödex
;

154 
icmp_ext_echo_˘y≥3_hdr
 
	m˘y≥3_hdr
;

156 
__be32
 
	mùv4_addr
;

157 
ö6_addr
 
	mùv6_addr
;

158 } 
	mù_addr
;

159 } 
	maddr
;

160 } 
	midít
;

	@/usr/include/linux/if_arp.h

24 #i‚de‡
_LINUX_IF_ARP_H


25 
	#_LINUX_IF_ARP_H


	)

27 
	~<löux/√tdevi˚.h
>

30 
	#ARPHRD_NETROM
 0

	)

31 
	#ARPHRD_ETHER
 1

	)

32 
	#ARPHRD_EETHER
 2

	)

33 
	#ARPHRD_AX25
 3

	)

34 
	#ARPHRD_PRONET
 4

	)

35 
	#ARPHRD_CHAOS
 5

	)

36 
	#ARPHRD_IEEE802
 6

	)

37 
	#ARPHRD_ARCNET
 7

	)

38 
	#ARPHRD_APPLETLK
 8

	)

39 
	#ARPHRD_DLCI
 15

	)

40 
	#ARPHRD_ATM
 19

	)

41 
	#ARPHRD_METRICOM
 23

	)

42 
	#ARPHRD_IEEE1394
 24

	)

43 
	#ARPHRD_EUI64
 27

	)

44 
	#ARPHRD_INFINIBAND
 32

	)

47 
	#ARPHRD_SLIP
 256

	)

48 
	#ARPHRD_CSLIP
 257

	)

49 
	#ARPHRD_SLIP6
 258

	)

50 
	#ARPHRD_CSLIP6
 259

	)

51 
	#ARPHRD_RSRVD
 260

	)

52 
	#ARPHRD_ADAPT
 264

	)

53 
	#ARPHRD_ROSE
 270

	)

54 
	#ARPHRD_X25
 271

	)

55 
	#ARPHRD_HWX25
 272

	)

56 
	#ARPHRD_CAN
 280

	)

57 
	#ARPHRD_MCTP
 290

	)

58 
	#ARPHRD_PPP
 512

	)

59 
	#ARPHRD_CISCO
 513

	)

60 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

61 
	#ARPHRD_LAPB
 516

	)

62 
	#ARPHRD_DDCMP
 517

	)

63 
	#ARPHRD_RAWHDLC
 518

	)

64 
	#ARPHRD_RAWIP
 519

	)

66 
	#ARPHRD_TUNNEL
 768

	)

67 
	#ARPHRD_TUNNEL6
 769

	)

68 
	#ARPHRD_FRAD
 770

	)

69 
	#ARPHRD_SKIP
 771

	)

70 
	#ARPHRD_LOOPBACK
 772

	)

71 
	#ARPHRD_LOCALTLK
 773

	)

72 
	#ARPHRD_FDDI
 774

	)

73 
	#ARPHRD_BIF
 775

	)

74 
	#ARPHRD_SIT
 776

	)

75 
	#ARPHRD_IPDDP
 777

	)

76 
	#ARPHRD_IPGRE
 778

	)

77 
	#ARPHRD_PIMREG
 779

	)

78 
	#ARPHRD_HIPPI
 780

	)

79 
	#ARPHRD_ASH
 781

	)

80 
	#ARPHRD_ECONET
 782

	)

81 
	#ARPHRD_IRDA
 783

	)

83 
	#ARPHRD_FCPP
 784

	)

84 
	#ARPHRD_FCAL
 785

	)

85 
	#ARPHRD_FCPL
 786

	)

86 
	#ARPHRD_FCFABRIC
 787

	)

88 
	#ARPHRD_IEEE802_TR
 800

	)

89 
	#ARPHRD_IEEE80211
 801

	)

90 
	#ARPHRD_IEEE80211_PRISM
 802

	)

91 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

92 
	#ARPHRD_IEEE802154
 804

	)

93 
	#ARPHRD_IEEE802154_MONITOR
 805

	)

95 
	#ARPHRD_PHONET
 820

	)

96 
	#ARPHRD_PHONET_PIPE
 821

	)

97 
	#ARPHRD_CAIF
 822

	)

98 
	#ARPHRD_IP6GRE
 823

	)

99 
	#ARPHRD_NETLINK
 824

	)

100 
	#ARPHRD_6LOWPAN
 825

	)

101 
	#ARPHRD_VSOCKMON
 826

	)

103 
	#ARPHRD_VOID
 0xFFFF

	)

104 
	#ARPHRD_NONE
 0xFFFE

	)

107 
	#ARPOP_REQUEST
 1

	)

108 
	#ARPOP_REPLY
 2

	)

109 
	#ARPOP_RREQUEST
 3

	)

110 
	#ARPOP_RREPLY
 4

	)

111 
	#ARPOP_InREQUEST
 8

	)

112 
	#ARPOP_InREPLY
 9

	)

113 
	#ARPOP_NAK
 10

	)

117 
	s¨¥eq
 {

118 
sockaddr
 
	m¨p_∑
;

119 
sockaddr
 
	m¨p_ha
;

120 
	m¨p_Êags
;

121 
sockaddr
 
	m¨p_√tmask
;

122 
	m¨p_dev
[
IFNAMSIZ
];

125 
	s¨¥eq_ﬁd
 {

126 
sockaddr
 
	m¨p_∑
;

127 
sockaddr
 
	m¨p_ha
;

128 
	m¨p_Êags
;

129 
sockaddr
 
	m¨p_√tmask
;

133 
	#ATF_COM
 0x02

	)

134 
	#ATF_PERM
 0x04

	)

135 
	#ATF_PUBL
 0x08

	)

136 
	#ATF_USETRAILERS
 0x10

	)

137 
	#ATF_NETMASK
 0x20

	)

139 
	#ATF_DONTPUB
 0x40

	)

145 
	s¨phdr
 {

146 
__be16
 
	m¨_hrd
;

147 
__be16
 
	m¨_¥o
;

148 
	m¨_h 
;

149 
	m¨_∂n
;

150 
__be16
 
	m¨_›
;

156 
	m¨_sha
[
ETH_ALEN
];

157 
	m¨_sù
[4];

158 
	m¨_tha
[
ETH_ALEN
];

159 
	m¨_tù
[4];

	@/usr/include/linux/if_ether.h

22 #i‚de‡
_LINUX_IF_ETHER_H


23 
	#_LINUX_IF_ETHER_H


	)

25 
	~<löux/ty≥s.h
>

32 
	#ETH_ALEN
 6

	)

33 
	#ETH_TLEN
 2

	)

34 
	#ETH_HLEN
 14

	)

35 
	#ETH_ZLEN
 60

	)

36 
	#ETH_DATA_LEN
 1500

	)

37 
	#ETH_FRAME_LEN
 1514

	)

38 
	#ETH_FCS_LEN
 4

	)

40 
	#ETH_MIN_MTU
 68

	)

41 
	#ETH_MAX_MTU
 0xFFFFU

	)

47 
	#ETH_P_LOOP
 0x0060

	)

48 
	#ETH_P_PUP
 0x0200

	)

49 
	#ETH_P_PUPAT
 0x0201

	)

50 
	#ETH_P_TSN
 0x22F0

	)

51 
	#ETH_P_ERSPAN2
 0x22EB

	)

52 
	#ETH_P_IP
 0x0800

	)

53 
	#ETH_P_X25
 0x0805

	)

54 
	#ETH_P_ARP
 0x0806

	)

55 
	#ETH_P_BPQ
 0x08FF

	)

56 
	#ETH_P_IEEEPUP
 0x0a00

	)

57 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

58 
	#ETH_P_BATMAN
 0x4305

	)

59 
	#ETH_P_DEC
 0x6000

	)

60 
	#ETH_P_DNA_DL
 0x6001

	)

61 
	#ETH_P_DNA_RC
 0x6002

	)

62 
	#ETH_P_DNA_RT
 0x6003

	)

63 
	#ETH_P_LAT
 0x6004

	)

64 
	#ETH_P_DIAG
 0x6005

	)

65 
	#ETH_P_CUST
 0x6006

	)

66 
	#ETH_P_SCA
 0x6007

	)

67 
	#ETH_P_TEB
 0x6558

	)

68 
	#ETH_P_RARP
 0x8035

	)

69 
	#ETH_P_ATALK
 0x809B

	)

70 
	#ETH_P_AARP
 0x80F3

	)

71 
	#ETH_P_8021Q
 0x8100

	)

72 
	#ETH_P_ERSPAN
 0x88BE

	)

73 
	#ETH_P_IPX
 0x8137

	)

74 
	#ETH_P_IPV6
 0x86DD

	)

75 
	#ETH_P_PAUSE
 0x8808

	)

76 
	#ETH_P_SLOW
 0x8809

	)

77 
	#ETH_P_WCCP
 0x883E

	)

79 
	#ETH_P_MPLS_UC
 0x8847

	)

80 
	#ETH_P_MPLS_MC
 0x8848

	)

81 
	#ETH_P_ATMMPOA
 0x884¯

	)

82 
	#ETH_P_PPP_DISC
 0x8863

	)

83 
	#ETH_P_PPP_SES
 0x8864

	)

84 
	#ETH_P_LINK_CTL
 0x886¯

	)

85 
	#ETH_P_ATMFATE
 0x8884

	)

88 
	#ETH_P_PAE
 0x888E

	)

89 
	#ETH_P_AOE
 0x88A2

	)

90 
	#ETH_P_8021AD
 0x88A8

	)

91 
	#ETH_P_802_EX1
 0x88B5

	)

92 
	#ETH_P_PREAUTH
 0x88C7

	)

93 
	#ETH_P_TIPC
 0x88CA

	)

94 
	#ETH_P_LLDP
 0x88CC

	)

95 
	#ETH_P_MRP
 0x88E3

	)

96 
	#ETH_P_MACSEC
 0x88E5

	)

97 
	#ETH_P_8021AH
 0x88E7

	)

98 
	#ETH_P_MVRP
 0x88F5

	)

99 
	#ETH_P_1588
 0x88F7

	)

100 
	#ETH_P_NCSI
 0x88F8

	)

101 
	#ETH_P_PRP
 0x88FB

	)

102 
	#ETH_P_CFM
 0x8902

	)

103 
	#ETH_P_FCOE
 0x8906

	)

104 
	#ETH_P_IBOE
 0x8915

	)

105 
	#ETH_P_TDLS
 0x890D

	)

106 
	#ETH_P_FIP
 0x8914

	)

107 
	#ETH_P_80221
 0x8917

	)

108 
	#ETH_P_HSR
 0x892F

	)

109 
	#ETH_P_NSH
 0x894F

	)

110 
	#ETH_P_LOOPBACK
 0x9000

	)

111 
	#ETH_P_QINQ1
 0x9100

	)

112 
	#ETH_P_QINQ2
 0x9200

	)

113 
	#ETH_P_QINQ3
 0x9300

	)

114 
	#ETH_P_EDSA
 0xDADA

	)

115 
	#ETH_P_DSA_8021Q
 0xDADB

	)

116 
	#ETH_P_IFE
 0xED3E

	)

117 
	#ETH_P_AF_IUCV
 0xFBFB

	)

119 
	#ETH_P_802_3_MIN
 0x0600

	)

126 
	#ETH_P_802_3
 0x0001

	)

127 
	#ETH_P_AX25
 0x0002

	)

128 
	#ETH_P_ALL
 0x0003

	)

129 
	#ETH_P_802_2
 0x0004

	)

130 
	#ETH_P_SNAP
 0x0005

	)

131 
	#ETH_P_DDCMP
 0x0006

	)

132 
	#ETH_P_WAN_PPP
 0x0007

	)

133 
	#ETH_P_PPP_MP
 0x0008

	)

134 
	#ETH_P_LOCALTALK
 0x0009

	)

135 
	#ETH_P_CAN
 0x000C

	)

136 
	#ETH_P_CANFD
 0x000D

	)

137 
	#ETH_P_PPPTALK
 0x0010

	)

138 
	#ETH_P_TR_802_2
 0x0011

	)

139 
	#ETH_P_MOBITEX
 0x0015

	)

140 
	#ETH_P_CONTROL
 0x0016

	)

141 
	#ETH_P_IRDA
 0x0017

	)

142 
	#ETH_P_ECONET
 0x0018

	)

143 
	#ETH_P_HDLC
 0x0019

	)

144 
	#ETH_P_ARCNET
 0x001A

	)

145 
	#ETH_P_DSA
 0x001B

	)

146 
	#ETH_P_TRAILER
 0x001C

	)

147 
	#ETH_P_PHONET
 0x00F5

	)

148 
	#ETH_P_IEEE802154
 0x00F6

	)

149 
	#ETH_P_CAIF
 0x00F7

	)

150 
	#ETH_P_XDSA
 0x00F8

	)

151 
	#ETH_P_MAP
 0x00F9

	)

154 
	#ETH_P_MCTP
 0x00FA

	)

163 #i‚de‡
__UAPI_DEF_ETHHDR


164 
	#__UAPI_DEF_ETHHDR
 1

	)

167 #i‡
__UAPI_DEF_ETHHDR


168 
	sëhhdr
 {

169 
	mh_de°
[
ETH_ALEN
];

170 
	mh_sour˚
[
ETH_ALEN
];

171 
__be16
 
	mh_¥Ÿo
;

172 } 
__©åibuã__
((
∑cked
));

	@/usr/include/linux/in6.h

22 #i‚de‡
_LINUX_IN6_H


23 
	#_LINUX_IN6_H


	)

25 
	~<löux/ty≥s.h
>

26 
	~<löux/libc-com∑t.h
>

32 #i‡
__UAPI_DEF_IN6_ADDR


33 
	sö6_addr
 {

35 
__u8
 
	mu6_addr8
[16];

36 #i‡
__UAPI_DEF_IN6_ADDR_ALT


37 
__be16
 
	mu6_addr16
[8];

38 
__be32
 
	mu6_addr32
[4];

40 } 
	mö6_u
;

41 
	#s6_addr
 
ö6_u
.
u6_addr8


	)

42 #i‡
__UAPI_DEF_IN6_ADDR_ALT


43 
	#s6_addr16
 
ö6_u
.
u6_addr16


	)

44 
	#s6_addr32
 
ö6_u
.
u6_addr32


	)

49 #i‡
__UAPI_DEF_SOCKADDR_IN6


50 
	ssockaddr_ö6
 {

51 
	msö6_Ámûy
;

52 
__be16
 
	msö6_p‹t
;

53 
__be32
 
	msö6_Êowöfo
;

54 
ö6_addr
 
	msö6_addr
;

55 
__u32
 
	msö6_sc›e_id
;

59 #i‡
__UAPI_DEF_IPV6_MREQ


60 
	sùv6_mªq
 {

62 
ö6_addr
 
	mùv6mr_mu…üddr
;

65 
	mùv6mr_ifödex
;

69 
	#ùv6mr_aˇddr
 
ùv6mr_mu…üddr


	)

71 
	sö6_Êowœbñ_ªq
 {

72 
ö6_addr
 
	mÊr_d°
;

73 
__be32
 
	mÊr_œbñ
;

74 
__u8
 
	mÊr_a˘i⁄
;

75 
__u8
 
	mÊr_sh¨e
;

76 
__u16
 
	mÊr_Êags
;

77 
__u16
 
	mÊr_expúes
;

78 
__u16
 
	mÊr_lögî
;

79 
__u32
 
	m__Êr_∑d
;

83 
	#IPV6_FL_A_GET
 0

	)

84 
	#IPV6_FL_A_PUT
 1

	)

85 
	#IPV6_FL_A_RENEW
 2

	)

87 
	#IPV6_FL_F_CREATE
 1

	)

88 
	#IPV6_FL_F_EXCL
 2

	)

89 
	#IPV6_FL_F_REFLECT
 4

	)

90 
	#IPV6_FL_F_REMOTE
 8

	)

92 
	#IPV6_FL_S_NONE
 0

	)

93 
	#IPV6_FL_S_EXCL
 1

	)

94 
	#IPV6_FL_S_PROCESS
 2

	)

95 
	#IPV6_FL_S_USER
 3

	)

96 
	#IPV6_FL_S_ANY
 255

	)

107 
	#IPV6_FLOWINFO_FLOWLABEL
 0x000fffff

	)

108 
	#IPV6_FLOWINFO_PRIORITY
 0x0ff00000

	)

111 
	#IPV6_PRIORITY_UNCHARACTERIZED
 0x0000

	)

112 
	#IPV6_PRIORITY_FILLER
 0x0100

	)

113 
	#IPV6_PRIORITY_UNATTENDED
 0x0200

	)

114 
	#IPV6_PRIORITY_RESERVED1
 0x0300

	)

115 
	#IPV6_PRIORITY_BULK
 0x0400

	)

116 
	#IPV6_PRIORITY_RESERVED2
 0x0500

	)

117 
	#IPV6_PRIORITY_INTERACTIVE
 0x0600

	)

118 
	#IPV6_PRIORITY_CONTROL
 0x0700

	)

119 
	#IPV6_PRIORITY_8
 0x0800

	)

120 
	#IPV6_PRIORITY_9
 0x0900

	)

121 
	#IPV6_PRIORITY_10
 0x0a00

	)

122 
	#IPV6_PRIORITY_11
 0x0b00

	)

123 
	#IPV6_PRIORITY_12
 0x0c00

	)

124 
	#IPV6_PRIORITY_13
 0x0d00

	)

125 
	#IPV6_PRIORITY_14
 0x0e00

	)

126 
	#IPV6_PRIORITY_15
 0x0f00

	)

131 #i‡
__UAPI_DEF_IPPROTO_V6


132 
	#IPPROTO_HOPOPTS
 0

	)

133 
	#IPPROTO_ROUTING
 43

	)

134 
	#IPPROTO_FRAGMENT
 44

	)

135 
	#IPPROTO_ICMPV6
 58

	)

136 
	#IPPROTO_NONE
 59

	)

137 
	#IPPROTO_DSTOPTS
 60

	)

138 
	#IPPROTO_MH
 135

	)

144 
	#IPV6_TLV_PAD1
 0

	)

145 
	#IPV6_TLV_PADN
 1

	)

146 
	#IPV6_TLV_ROUTERALERT
 5

	)

147 
	#IPV6_TLV_CALIPSO
 7

	)

148 
	#IPV6_TLV_IOAM
 49

	)

149 
	#IPV6_TLV_JUMBO
 194

	)

150 
	#IPV6_TLV_HAO
 201

	)

155 #i‡
__UAPI_DEF_IPV6_OPTIONS


156 
	#IPV6_ADDRFORM
 1

	)

157 
	#IPV6_2292PKTINFO
 2

	)

158 
	#IPV6_2292HOPOPTS
 3

	)

159 
	#IPV6_2292DSTOPTS
 4

	)

160 
	#IPV6_2292RTHDR
 5

	)

161 
	#IPV6_2292PKTOPTIONS
 6

	)

162 
	#IPV6_CHECKSUM
 7

	)

163 
	#IPV6_2292HOPLIMIT
 8

	)

164 
	#IPV6_NEXTHOP
 9

	)

165 
	#IPV6_AUTHHDR
 10

	)

166 
	#IPV6_FLOWINFO
 11

	)

168 
	#IPV6_UNICAST_HOPS
 16

	)

169 
	#IPV6_MULTICAST_IF
 17

	)

170 
	#IPV6_MULTICAST_HOPS
 18

	)

171 
	#IPV6_MULTICAST_LOOP
 19

	)

172 
	#IPV6_ADD_MEMBERSHIP
 20

	)

173 
	#IPV6_DROP_MEMBERSHIP
 21

	)

174 
	#IPV6_ROUTER_ALERT
 22

	)

175 
	#IPV6_MTU_DISCOVER
 23

	)

176 
	#IPV6_MTU
 24

	)

177 
	#IPV6_RECVERR
 25

	)

178 
	#IPV6_V6ONLY
 26

	)

179 
	#IPV6_JOIN_ANYCAST
 27

	)

180 
	#IPV6_LEAVE_ANYCAST
 28

	)

181 
	#IPV6_MULTICAST_ALL
 29

	)

182 
	#IPV6_ROUTER_ALERT_ISOLATE
 30

	)

183 
	#IPV6_RECVERR_RFC4884
 31

	)

186 
	#IPV6_PMTUDISC_DONT
 0

	)

187 
	#IPV6_PMTUDISC_WANT
 1

	)

188 
	#IPV6_PMTUDISC_DO
 2

	)

189 
	#IPV6_PMTUDISC_PROBE
 3

	)

193 
	#IPV6_PMTUDISC_INTERFACE
 4

	)

197 
	#IPV6_PMTUDISC_OMIT
 5

	)

200 
	#IPV6_FLOWLABEL_MGR
 32

	)

201 
	#IPV6_FLOWINFO_SEND
 33

	)

203 
	#IPV6_IPSEC_POLICY
 34

	)

204 
	#IPV6_XFRM_POLICY
 35

	)

205 
	#IPV6_HDRINCL
 36

	)

227 
	#IPV6_RECVPKTINFO
 49

	)

228 
	#IPV6_PKTINFO
 50

	)

229 
	#IPV6_RECVHOPLIMIT
 51

	)

230 
	#IPV6_HOPLIMIT
 52

	)

231 
	#IPV6_RECVHOPOPTS
 53

	)

232 
	#IPV6_HOPOPTS
 54

	)

233 
	#IPV6_RTHDRDSTOPTS
 55

	)

234 
	#IPV6_RECVRTHDR
 56

	)

235 
	#IPV6_RTHDR
 57

	)

236 
	#IPV6_RECVDSTOPTS
 58

	)

237 
	#IPV6_DSTOPTS
 59

	)

238 
	#IPV6_RECVPATHMTU
 60

	)

239 
	#IPV6_PATHMTU
 61

	)

240 
	#IPV6_DONTFRAG
 62

	)

242 
	#IPV6_USE_MIN_MTU
 63

	)

258 
	#IPV6_RECVTCLASS
 66

	)

259 
	#IPV6_TCLASS
 67

	)

272 
	#IPV6_AUTOFLOWLABEL
 70

	)

274 
	#IPV6_ADDR_PREFERENCES
 72

	)

276 
	#IPV6_PREFER_SRC_TMP
 0x0001

	)

277 
	#IPV6_PREFER_SRC_PUBLIC
 0x0002

	)

278 
	#IPV6_PREFER_SRC_PUBTMP_DEFAULT
 0x0100

	)

279 
	#IPV6_PREFER_SRC_COA
 0x0004

	)

280 
	#IPV6_PREFER_SRC_HOME
 0x0400

	)

281 
	#IPV6_PREFER_SRC_CGA
 0x0008

	)

282 
	#IPV6_PREFER_SRC_NONCGA
 0x0800

	)

285 
	#IPV6_MINHOPCOUNT
 73

	)

287 
	#IPV6_ORIGDSTADDR
 74

	)

288 
	#IPV6_RECVORIGDSTADDR
 
IPV6_ORIGDSTADDR


	)

289 
	#IPV6_TRANSPARENT
 75

	)

290 
	#IPV6_UNICAST_IF
 76

	)

291 
	#IPV6_RECVFRAGSIZE
 77

	)

292 
	#IPV6_FREEBIND
 78

	)

	@/usr/include/linux/ip.h

18 #i‚de‡
_LINUX_IP_H


19 
	#_LINUX_IP_H


	)

20 
	~<löux/ty≥s.h
>

21 
	~<löux/°ddef.h
>

22 
	~<asm/byã‹dî.h
>

24 
	#IPTOS_TOS_MASK
 0x1E

	)

25 
	#IPTOS_TOS
(
tos
Ë(—os)&
IPTOS_TOS_MASK
)

	)

26 
	#IPTOS_LOWDELAY
 0x10

	)

27 
	#IPTOS_THROUGHPUT
 0x08

	)

28 
	#IPTOS_RELIABILITY
 0x04

	)

29 
	#IPTOS_MINCOST
 0x02

	)

31 
	#IPTOS_PREC_MASK
 0xE0

	)

32 
	#IPTOS_PREC
(
tos
Ë(—os)&
IPTOS_PREC_MASK
)

	)

33 
	#IPTOS_PREC_NETCONTROL
 0xe0

	)

34 
	#IPTOS_PREC_INTERNETCONTROL
 0xc0

	)

35 
	#IPTOS_PREC_CRITIC_ECP
 0xa0

	)

36 
	#IPTOS_PREC_FLASHOVERRIDE
 0x80

	)

37 
	#IPTOS_PREC_FLASH
 0x60

	)

38 
	#IPTOS_PREC_IMMEDIATE
 0x40

	)

39 
	#IPTOS_PREC_PRIORITY
 0x20

	)

40 
	#IPTOS_PREC_ROUTINE
 0x00

	)

44 
	#IPOPT_COPY
 0x80

	)

45 
	#IPOPT_CLASS_MASK
 0x60

	)

46 
	#IPOPT_NUMBER_MASK
 0x1f

	)

48 
	#IPOPT_COPIED
(
o
Ë((o)&
IPOPT_COPY
)

	)

49 
	#IPOPT_CLASS
(
o
Ë((o)&
IPOPT_CLASS_MASK
)

	)

50 
	#IPOPT_NUMBER
(
o
Ë((o)&
IPOPT_NUMBER_MASK
)

	)

52 
	#IPOPT_CONTROL
 0x00

	)

53 
	#IPOPT_RESERVED1
 0x20

	)

54 
	#IPOPT_MEASUREMENT
 0x40

	)

55 
	#IPOPT_RESERVED2
 0x60

	)

57 
	#IPOPT_END
 (0 |
IPOPT_CONTROL
)

	)

58 
	#IPOPT_NOOP
 (1 |
IPOPT_CONTROL
)

	)

59 
	#IPOPT_SEC
 (2 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

60 
	#IPOPT_LSRR
 (3 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

61 
	#IPOPT_TIMESTAMP
 (4 |
IPOPT_MEASUREMENT
)

	)

62 
	#IPOPT_CIPSO
 (6 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

63 
	#IPOPT_RR
 (7 |
IPOPT_CONTROL
)

	)

64 
	#IPOPT_SID
 (8 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

65 
	#IPOPT_SSRR
 (9 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

66 
	#IPOPT_RA
 (20|
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

68 
	#IPVERSION
 4

	)

69 
	#MAXTTL
 255

	)

70 
	#IPDEFTTL
 64

	)

72 
	#IPOPT_OPTVAL
 0

	)

73 
	#IPOPT_OLEN
 1

	)

74 
	#IPOPT_OFFSET
 2

	)

75 
	#IPOPT_MINOFF
 4

	)

76 
	#MAX_IPOPTLEN
 40

	)

77 
	#IPOPT_NOP
 
IPOPT_NOOP


	)

78 
	#IPOPT_EOL
 
IPOPT_END


	)

79 
	#IPOPT_TS
 
IPOPT_TIMESTAMP


	)

81 
	#IPOPT_TS_TSONLY
 0

	)

82 
	#IPOPT_TS_TSANDADDR
 1

	)

83 
	#IPOPT_TS_PRESPEC
 3

	)

85 
	#IPV4_BEET_PHMAXLEN
 8

	)

87 
	sùhdr
 {

88 #i‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

89 
__u8
 
	mihl
:4,

90 
	mvîsi⁄
:4;

91 #ñi‡
deföed
 (
__BIG_ENDIAN_BITFIELD
)

92 
__u8
 
	mvîsi⁄
:4,

93 
	mihl
:4;

97 
__u8
 
	mtos
;

98 
__be16
 
	mtŸ_Àn
;

99 
__be16
 
	mid
;

100 
__be16
 
	m‰ag_off
;

101 
__u8
 
	mâl
;

102 
__u8
 
	m¥Ÿocﬁ
;

103 
__sum16
 
	mcheck
;

104 
__°ru˘_group
–, 
addrs
, ,

105 
__be32
 
ßddr
;

106 
__be32
 
daddr
;

112 
	sù_auth_hdr
 {

113 
__u8
 
	m√xthdr
;

114 
__u8
 
	mhdæí
;

115 
__be16
 
	mª£rved
;

116 
__be32
 
	m•i
;

117 
__be32
 
	m£q_no
;

118 
__u8
 
	mauth_d©a
[0];

121 
	sù_e•_hdr
 {

122 
__be32
 
	m•i
;

123 
__be32
 
	m£q_no
;

124 
__u8
 
	míc_d©a
[0];

127 
	sù_comp_hdr
 {

128 
__u8
 
	m√xthdr
;

129 
__u8
 
	mÊags
;

130 
__be16
 
	m˝i
;

133 
	sù_bìt_phdr
 {

134 
__u8
 
	m√xthdr
;

135 
__u8
 
	mhdæí
;

136 
__u8
 
	m∑dÀn
;

137 
__u8
 
	mª£rved
;

143 
	mIPV4_DEVCONF_FORWARDING
=1,

144 
	mIPV4_DEVCONF_MC_FORWARDING
,

145 
	mIPV4_DEVCONF_PROXY_ARP
,

146 
	mIPV4_DEVCONF_ACCEPT_REDIRECTS
,

147 
	mIPV4_DEVCONF_SECURE_REDIRECTS
,

148 
	mIPV4_DEVCONF_SEND_REDIRECTS
,

149 
	mIPV4_DEVCONF_SHARED_MEDIA
,

150 
	mIPV4_DEVCONF_RP_FILTER
,

151 
	mIPV4_DEVCONF_ACCEPT_SOURCE_ROUTE
,

152 
	mIPV4_DEVCONF_BOOTP_RELAY
,

153 
	mIPV4_DEVCONF_LOG_MARTIANS
,

154 
	mIPV4_DEVCONF_TAG
,

155 
	mIPV4_DEVCONF_ARPFILTER
,

156 
	mIPV4_DEVCONF_MEDIUM_ID
,

157 
	mIPV4_DEVCONF_NOXFRM
,

158 
	mIPV4_DEVCONF_NOPOLICY
,

159 
	mIPV4_DEVCONF_FORCE_IGMP_VERSION
,

160 
	mIPV4_DEVCONF_ARP_ANNOUNCE
,

161 
	mIPV4_DEVCONF_ARP_IGNORE
,

162 
	mIPV4_DEVCONF_PROMOTE_SECONDARIES
,

163 
	mIPV4_DEVCONF_ARP_ACCEPT
,

164 
	mIPV4_DEVCONF_ARP_NOTIFY
,

165 
	mIPV4_DEVCONF_ACCEPT_LOCAL
,

166 
	mIPV4_DEVCONF_SRC_VMARK
,

167 
	mIPV4_DEVCONF_PROXY_ARP_PVLAN
,

168 
	mIPV4_DEVCONF_ROUTE_LOCALNET
,

169 
	mIPV4_DEVCONF_IGMPV2_UNSOLICITED_REPORT_INTERVAL
,

170 
	mIPV4_DEVCONF_IGMPV3_UNSOLICITED_REPORT_INTERVAL
,

171 
	mIPV4_DEVCONF_IGNORE_ROUTES_WITH_LINKDOWN
,

172 
	mIPV4_DEVCONF_DROP_UNICAST_IN_L2_MULTICAST
,

173 
	mIPV4_DEVCONF_DROP_GRATUITOUS_ARP
,

174 
	mIPV4_DEVCONF_BC_FORWARDING
,

175 
	m__IPV4_DEVCONF_MAX


178 
	#IPV4_DEVCONF_MAX
 (
__IPV4_DEVCONF_MAX
 - 1)

	)

	@/usr/include/linux/kernel.h

2 #i‚de‡
_LINUX_KERNEL_H


3 
	#_LINUX_KERNEL_H


	)

5 
	~<löux/sysöfo.h
>

6 
	~<löux/c⁄°.h
>

	@/usr/include/linux/module.h

2 #i‚de‡
_LINUX_MODULE_H


3 
	#_LINUX_MODULE_H


	)

6 
	#MODULE_INIT_IGNORE_MODVERSIONS
 1

	)

7 
	#MODULE_INIT_IGNORE_VERMAGIC
 2

	)

	@/usr/include/linux/netdevice.h

26 #i‚de‡
_LINUX_NETDEVICE_H


27 
	#_LINUX_NETDEVICE_H


	)

29 
	~<löux/if.h
>

30 
	~<löux/if_ëhî.h
>

31 
	~<löux/if_∑ckë.h
>

32 
	~<löux/if_lök.h
>

35 
	#MAX_ADDR_LEN
 32

	)

38 
	#INIT_NETDEV_GROUP
 0

	)

42 
	#NET_NAME_UNKNOWN
 0

	)

43 
	#NET_NAME_ENUM
 1

	)

44 
	#NET_NAME_PREDICTABLE
 2

	)

45 
	#NET_NAME_USER
 3

	)

46 
	#NET_NAME_RENAMED
 4

	)

50 
	mIF_PORT_UNKNOWN
 = 0,

51 
	mIF_PORT_10BASE2
,

52 
	mIF_PORT_10BASET
,

53 
	mIF_PORT_AUI
,

54 
	mIF_PORT_100BASET
,

55 
	mIF_PORT_100BASETX
,

56 
	mIF_PORT_100BASEFX


60 
	#NET_ADDR_PERM
 0

	)

61 
	#NET_ADDR_RANDOM
 1

	)

62 
	#NET_ADDR_STOLEN
 2

	)

63 
	#NET_ADDR_SET
 3

	)

	@/usr/include/linux/nl80211-vnd-intel.h

7 #i‚de‡
__VENDOR_CMD_INTEL_H__


8 
	#__VENDOR_CMD_INTEL_H__


	)

10 
	#INTEL_OUI
 0x001735

	)

21 
	eiwl_mvm_víd‹_cmd
 {

22 
	mIWL_MVM_VENDOR_CMD_GET_CSME_CONN_INFO
 = 0x2d,

23 
	mIWL_MVM_VENDOR_CMD_HOST_GET_OWNERSHIP
 = 0x30,

24 
	mIWL_MVM_VENDOR_CMD_ROAMING_FORBIDDEN_EVENT
 = 0x32,

27 
	eiwl_víd‹_auth_akm_mode
 {

28 
	mIWL_VENDOR_AUTH_OPEN
,

29 
	mIWL_VENDOR_AUTH_RSNA
 = 0x6,

30 
	mIWL_VENDOR_AUTH_RSNA_PSK
,

31 
	mIWL_VENDOR_AUTH_SAE
 = 0x9,

32 
	mIWL_VENDOR_AUTH_MAX
,

60 
	eiwl_mvm_víd‹_©å
 {

61 
	m__IWL_MVM_VENDOR_ATTR_INVALID
 = 0x00,

62 
	mIWL_MVM_VENDOR_ATTR_VIF_ADDR
 = 0x02,

63 
	mIWL_MVM_VENDOR_ATTR_ADDR
 = 0x0a,

64 
	mIWL_MVM_VENDOR_ATTR_SSID
 = 0x3d,

65 
	mIWL_MVM_VENDOR_ATTR_STA_CIPHER
 = 0x51,

66 
	mIWL_MVM_VENDOR_ATTR_ROAMING_FORBIDDEN
 = 0x64,

67 
	mIWL_MVM_VENDOR_ATTR_AUTH_MODE
 = 0x65,

68 
	mIWL_MVM_VENDOR_ATTR_CHANNEL_NUM
 = 0x66,

69 
	mIWL_MVM_VENDOR_ATTR_BAND
 = 0x69,

70 
	mIWL_MVM_VENDOR_ATTR_COLLOC_CHANNEL
 = 0x70,

71 
	mIWL_MVM_VENDOR_ATTR_COLLOC_ADDR
 = 0x71,

73 
	mNUM_IWL_MVM_VENDOR_ATTR
,

74 
	mMAX_IWL_MVM_VENDOR_ATTR
 = 
NUM_IWL_MVM_VENDOR_ATTR
 - 1,

	@/usr/include/linux/nl80211.h

1 #i‚de‡
__LINUX_NL80211_H


2 
	#__LINUX_NL80211_H


	)

43 
	~<löux/ty≥s.h
>

45 
	#NL80211_GENL_NAME
 "∆80211"

	)

47 
	#NL80211_MULTICAST_GROUP_CONFIG
 "c⁄fig"

	)

48 
	#NL80211_MULTICAST_GROUP_SCAN
 "sˇn"

	)

49 
	#NL80211_MULTICAST_GROUP_REG
 "ªguœt‹y"

	)

50 
	#NL80211_MULTICAST_GROUP_MLME
 "mlme"

	)

51 
	#NL80211_MULTICAST_GROUP_VENDOR
 "víd‹"

	)

52 
	#NL80211_MULTICAST_GROUP_NAN
 "«n"

	)

53 
	#NL80211_MULTICAST_GROUP_TESTMODE
 "ã°mode"

	)

55 
	#NL80211_EDMG_BW_CONFIG_MIN
 4

	)

56 
	#NL80211_EDMG_BW_CONFIG_MAX
 15

	)

57 
	#NL80211_EDMG_CHANNELS_MIN
 1

	)

58 
	#NL80211_EDMG_CHANNELS_MAX
 0x3¯

	)

1206 
	e∆80211_comm™ds
 {

1208 
	mNL80211_CMD_UNSPEC
,

1210 
	mNL80211_CMD_GET_WIPHY
,

1211 
	mNL80211_CMD_SET_WIPHY
,

1212 
	mNL80211_CMD_NEW_WIPHY
,

1213 
	mNL80211_CMD_DEL_WIPHY
,

1215 
	mNL80211_CMD_GET_INTERFACE
,

1216 
	mNL80211_CMD_SET_INTERFACE
,

1217 
	mNL80211_CMD_NEW_INTERFACE
,

1218 
	mNL80211_CMD_DEL_INTERFACE
,

1220 
	mNL80211_CMD_GET_KEY
,

1221 
	mNL80211_CMD_SET_KEY
,

1222 
	mNL80211_CMD_NEW_KEY
,

1223 
	mNL80211_CMD_DEL_KEY
,

1225 
	mNL80211_CMD_GET_BEACON
,

1226 
	mNL80211_CMD_SET_BEACON
,

1227 
	mNL80211_CMD_START_AP
,

1228 
	mNL80211_CMD_NEW_BEACON
 = 
NL80211_CMD_START_AP
,

1229 
	mNL80211_CMD_STOP_AP
,

1230 
	mNL80211_CMD_DEL_BEACON
 = 
NL80211_CMD_STOP_AP
,

1232 
	mNL80211_CMD_GET_STATION
,

1233 
	mNL80211_CMD_SET_STATION
,

1234 
	mNL80211_CMD_NEW_STATION
,

1235 
	mNL80211_CMD_DEL_STATION
,

1237 
	mNL80211_CMD_GET_MPATH
,

1238 
	mNL80211_CMD_SET_MPATH
,

1239 
	mNL80211_CMD_NEW_MPATH
,

1240 
	mNL80211_CMD_DEL_MPATH
,

1242 
	mNL80211_CMD_SET_BSS
,

1244 
	mNL80211_CMD_SET_REG
,

1245 
	mNL80211_CMD_REQ_SET_REG
,

1247 
	mNL80211_CMD_GET_MESH_CONFIG
,

1248 
	mNL80211_CMD_SET_MESH_CONFIG
,

1250 
	mNL80211_CMD_SET_MGMT_EXTRA_IE
 ,

1252 
	mNL80211_CMD_GET_REG
,

1254 
	mNL80211_CMD_GET_SCAN
,

1255 
	mNL80211_CMD_TRIGGER_SCAN
,

1256 
	mNL80211_CMD_NEW_SCAN_RESULTS
,

1257 
	mNL80211_CMD_SCAN_ABORTED
,

1259 
	mNL80211_CMD_REG_CHANGE
,

1261 
	mNL80211_CMD_AUTHENTICATE
,

1262 
	mNL80211_CMD_ASSOCIATE
,

1263 
	mNL80211_CMD_DEAUTHENTICATE
,

1264 
	mNL80211_CMD_DISASSOCIATE
,

1266 
	mNL80211_CMD_MICHAEL_MIC_FAILURE
,

1268 
	mNL80211_CMD_REG_BEACON_HINT
,

1270 
	mNL80211_CMD_JOIN_IBSS
,

1271 
	mNL80211_CMD_LEAVE_IBSS
,

1273 
	mNL80211_CMD_TESTMODE
,

1275 
	mNL80211_CMD_CONNECT
,

1276 
	mNL80211_CMD_ROAM
,

1277 
	mNL80211_CMD_DISCONNECT
,

1279 
	mNL80211_CMD_SET_WIPHY_NETNS
,

1281 
	mNL80211_CMD_GET_SURVEY
,

1282 
	mNL80211_CMD_NEW_SURVEY_RESULTS
,

1284 
	mNL80211_CMD_SET_PMKSA
,

1285 
	mNL80211_CMD_DEL_PMKSA
,

1286 
	mNL80211_CMD_FLUSH_PMKSA
,

1288 
	mNL80211_CMD_REMAIN_ON_CHANNEL
,

1289 
	mNL80211_CMD_CANCEL_REMAIN_ON_CHANNEL
,

1291 
	mNL80211_CMD_SET_TX_BITRATE_MASK
,

1293 
	mNL80211_CMD_REGISTER_FRAME
,

1294 
	mNL80211_CMD_REGISTER_ACTION
 = 
NL80211_CMD_REGISTER_FRAME
,

1295 
	mNL80211_CMD_FRAME
,

1296 
	mNL80211_CMD_ACTION
 = 
NL80211_CMD_FRAME
,

1297 
	mNL80211_CMD_FRAME_TX_STATUS
,

1298 
	mNL80211_CMD_ACTION_TX_STATUS
 = 
NL80211_CMD_FRAME_TX_STATUS
,

1300 
	mNL80211_CMD_SET_POWER_SAVE
,

1301 
	mNL80211_CMD_GET_POWER_SAVE
,

1303 
	mNL80211_CMD_SET_CQM
,

1304 
	mNL80211_CMD_NOTIFY_CQM
,

1306 
	mNL80211_CMD_SET_CHANNEL
,

1307 
	mNL80211_CMD_SET_WDS_PEER
,

1309 
	mNL80211_CMD_FRAME_WAIT_CANCEL
,

1311 
	mNL80211_CMD_JOIN_MESH
,

1312 
	mNL80211_CMD_LEAVE_MESH
,

1314 
	mNL80211_CMD_UNPROT_DEAUTHENTICATE
,

1315 
	mNL80211_CMD_UNPROT_DISASSOCIATE
,

1317 
	mNL80211_CMD_NEW_PEER_CANDIDATE
,

1319 
	mNL80211_CMD_GET_WOWLAN
,

1320 
	mNL80211_CMD_SET_WOWLAN
,

1322 
	mNL80211_CMD_START_SCHED_SCAN
,

1323 
	mNL80211_CMD_STOP_SCHED_SCAN
,

1324 
	mNL80211_CMD_SCHED_SCAN_RESULTS
,

1325 
	mNL80211_CMD_SCHED_SCAN_STOPPED
,

1327 
	mNL80211_CMD_SET_REKEY_OFFLOAD
,

1329 
	mNL80211_CMD_PMKSA_CANDIDATE
,

1331 
	mNL80211_CMD_TDLS_OPER
,

1332 
	mNL80211_CMD_TDLS_MGMT
,

1334 
	mNL80211_CMD_UNEXPECTED_FRAME
,

1336 
	mNL80211_CMD_PROBE_CLIENT
,

1338 
	mNL80211_CMD_REGISTER_BEACONS
,

1340 
	mNL80211_CMD_UNEXPECTED_4ADDR_FRAME
,

1342 
	mNL80211_CMD_SET_NOACK_MAP
,

1344 
	mNL80211_CMD_CH_SWITCH_NOTIFY
,

1346 
	mNL80211_CMD_START_P2P_DEVICE
,

1347 
	mNL80211_CMD_STOP_P2P_DEVICE
,

1349 
	mNL80211_CMD_CONN_FAILED
,

1351 
	mNL80211_CMD_SET_MCAST_RATE
,

1353 
	mNL80211_CMD_SET_MAC_ACL
,

1355 
	mNL80211_CMD_RADAR_DETECT
,

1357 
	mNL80211_CMD_GET_PROTOCOL_FEATURES
,

1359 
	mNL80211_CMD_UPDATE_FT_IES
,

1360 
	mNL80211_CMD_FT_EVENT
,

1362 
	mNL80211_CMD_CRIT_PROTOCOL_START
,

1363 
	mNL80211_CMD_CRIT_PROTOCOL_STOP
,

1365 
	mNL80211_CMD_GET_COALESCE
,

1366 
	mNL80211_CMD_SET_COALESCE
,

1368 
	mNL80211_CMD_CHANNEL_SWITCH
,

1370 
	mNL80211_CMD_VENDOR
,

1372 
	mNL80211_CMD_SET_QOS_MAP
,

1374 
	mNL80211_CMD_ADD_TX_TS
,

1375 
	mNL80211_CMD_DEL_TX_TS
,

1377 
	mNL80211_CMD_GET_MPP
,

1379 
	mNL80211_CMD_JOIN_OCB
,

1380 
	mNL80211_CMD_LEAVE_OCB
,

1382 
	mNL80211_CMD_CH_SWITCH_STARTED_NOTIFY
,

1384 
	mNL80211_CMD_TDLS_CHANNEL_SWITCH
,

1385 
	mNL80211_CMD_TDLS_CANCEL_CHANNEL_SWITCH
,

1387 
	mNL80211_CMD_WIPHY_REG_CHANGE
,

1389 
	mNL80211_CMD_ABORT_SCAN
,

1391 
	mNL80211_CMD_START_NAN
,

1392 
	mNL80211_CMD_STOP_NAN
,

1393 
	mNL80211_CMD_ADD_NAN_FUNCTION
,

1394 
	mNL80211_CMD_DEL_NAN_FUNCTION
,

1395 
	mNL80211_CMD_CHANGE_NAN_CONFIG
,

1396 
	mNL80211_CMD_NAN_MATCH
,

1398 
	mNL80211_CMD_SET_MULTICAST_TO_UNICAST
,

1400 
	mNL80211_CMD_UPDATE_CONNECT_PARAMS
,

1402 
	mNL80211_CMD_SET_PMK
,

1403 
	mNL80211_CMD_DEL_PMK
,

1405 
	mNL80211_CMD_PORT_AUTHORIZED
,

1407 
	mNL80211_CMD_RELOAD_REGDB
,

1409 
	mNL80211_CMD_EXTERNAL_AUTH
,

1411 
	mNL80211_CMD_STA_OPMODE_CHANGED
,

1413 
	mNL80211_CMD_CONTROL_PORT_FRAME
,

1415 
	mNL80211_CMD_GET_FTM_RESPONDER_STATS
,

1417 
	mNL80211_CMD_PEER_MEASUREMENT_START
,

1418 
	mNL80211_CMD_PEER_MEASUREMENT_RESULT
,

1419 
	mNL80211_CMD_PEER_MEASUREMENT_COMPLETE
,

1421 
	mNL80211_CMD_NOTIFY_RADAR
,

1423 
	mNL80211_CMD_UPDATE_OWE_INFO
,

1425 
	mNL80211_CMD_PROBE_MESH_LINK
,

1427 
	mNL80211_CMD_SET_TID_CONFIG
,

1429 
	mNL80211_CMD_UNPROT_BEACON
,

1431 
	mNL80211_CMD_CONTROL_PORT_FRAME_TX_STATUS
,

1433 
	mNL80211_CMD_SET_SAR_SPECS
,

1435 
	mNL80211_CMD_OBSS_COLOR_COLLISION
,

1437 
	mNL80211_CMD_COLOR_CHANGE_REQUEST
,

1439 
	mNL80211_CMD_COLOR_CHANGE_STARTED
,

1440 
	mNL80211_CMD_COLOR_CHANGE_ABORTED
,

1441 
	mNL80211_CMD_COLOR_CHANGE_COMPLETED
,

1446 
	m__NL80211_CMD_AFTER_LAST
,

1447 
	mNL80211_CMD_MAX
 = 
__NL80211_CMD_AFTER_LAST
 - 1

1454 
	#NL80211_CMD_SET_BSS
 
NL80211_CMD_SET_BSS


	)

1455 
	#NL80211_CMD_SET_MGMT_EXTRA_IE
 
NL80211_CMD_SET_MGMT_EXTRA_IE


	)

1456 
	#NL80211_CMD_REG_CHANGE
 
NL80211_CMD_REG_CHANGE


	)

1457 
	#NL80211_CMD_AUTHENTICATE
 
NL80211_CMD_AUTHENTICATE


	)

1458 
	#NL80211_CMD_ASSOCIATE
 
NL80211_CMD_ASSOCIATE


	)

1459 
	#NL80211_CMD_DEAUTHENTICATE
 
NL80211_CMD_DEAUTHENTICATE


	)

1460 
	#NL80211_CMD_DISASSOCIATE
 
NL80211_CMD_DISASSOCIATE


	)

1461 
	#NL80211_CMD_REG_BEACON_HINT
 
NL80211_CMD_REG_BEACON_HINT


	)

1463 
	#NL80211_ATTR_FEATURE_FLAGS
 
NL80211_ATTR_FEATURE_FLAGS


	)

1466 
	#NL80211_CMD_GET_MESH_PARAMS
 
NL80211_CMD_GET_MESH_CONFIG


	)

1467 
	#NL80211_CMD_SET_MESH_PARAMS
 
NL80211_CMD_SET_MESH_CONFIG


	)

1468 
	#NL80211_MESH_SETUP_VENDOR_PATH_SEL_IE
 
NL80211_MESH_SETUP_IE


	)

2600 
	e∆80211_©ås
 {

2602 
	mNL80211_ATTR_UNSPEC
,

2604 
	mNL80211_ATTR_WIPHY
,

2605 
	mNL80211_ATTR_WIPHY_NAME
,

2607 
	mNL80211_ATTR_IFINDEX
,

2608 
	mNL80211_ATTR_IFNAME
,

2609 
	mNL80211_ATTR_IFTYPE
,

2611 
	mNL80211_ATTR_MAC
,

2613 
	mNL80211_ATTR_KEY_DATA
,

2614 
	mNL80211_ATTR_KEY_IDX
,

2615 
	mNL80211_ATTR_KEY_CIPHER
,

2616 
	mNL80211_ATTR_KEY_SEQ
,

2617 
	mNL80211_ATTR_KEY_DEFAULT
,

2619 
	mNL80211_ATTR_BEACON_INTERVAL
,

2620 
	mNL80211_ATTR_DTIM_PERIOD
,

2621 
	mNL80211_ATTR_BEACON_HEAD
,

2622 
	mNL80211_ATTR_BEACON_TAIL
,

2624 
	mNL80211_ATTR_STA_AID
,

2625 
	mNL80211_ATTR_STA_FLAGS
,

2626 
	mNL80211_ATTR_STA_LISTEN_INTERVAL
,

2627 
	mNL80211_ATTR_STA_SUPPORTED_RATES
,

2628 
	mNL80211_ATTR_STA_VLAN
,

2629 
	mNL80211_ATTR_STA_INFO
,

2631 
	mNL80211_ATTR_WIPHY_BANDS
,

2633 
	mNL80211_ATTR_MNTR_FLAGS
,

2635 
	mNL80211_ATTR_MESH_ID
,

2636 
	mNL80211_ATTR_STA_PLINK_ACTION
,

2637 
	mNL80211_ATTR_MPATH_NEXT_HOP
,

2638 
	mNL80211_ATTR_MPATH_INFO
,

2640 
	mNL80211_ATTR_BSS_CTS_PROT
,

2641 
	mNL80211_ATTR_BSS_SHORT_PREAMBLE
,

2642 
	mNL80211_ATTR_BSS_SHORT_SLOT_TIME
,

2644 
	mNL80211_ATTR_HT_CAPABILITY
,

2646 
	mNL80211_ATTR_SUPPORTED_IFTYPES
,

2648 
	mNL80211_ATTR_REG_ALPHA2
,

2649 
	mNL80211_ATTR_REG_RULES
,

2651 
	mNL80211_ATTR_MESH_CONFIG
,

2653 
	mNL80211_ATTR_BSS_BASIC_RATES
,

2655 
	mNL80211_ATTR_WIPHY_TXQ_PARAMS
,

2656 
	mNL80211_ATTR_WIPHY_FREQ
,

2657 
	mNL80211_ATTR_WIPHY_CHANNEL_TYPE
,

2659 
	mNL80211_ATTR_KEY_DEFAULT_MGMT
,

2661 
	mNL80211_ATTR_MGMT_SUBTYPE
,

2662 
	mNL80211_ATTR_IE
,

2664 
	mNL80211_ATTR_MAX_NUM_SCAN_SSIDS
,

2666 
	mNL80211_ATTR_SCAN_FREQUENCIES
,

2667 
	mNL80211_ATTR_SCAN_SSIDS
,

2668 
	mNL80211_ATTR_GENERATION
,

2669 
	mNL80211_ATTR_BSS
,

2671 
	mNL80211_ATTR_REG_INITIATOR
,

2672 
	mNL80211_ATTR_REG_TYPE
,

2674 
	mNL80211_ATTR_SUPPORTED_COMMANDS
,

2676 
	mNL80211_ATTR_FRAME
,

2677 
	mNL80211_ATTR_SSID
,

2678 
	mNL80211_ATTR_AUTH_TYPE
,

2679 
	mNL80211_ATTR_REASON_CODE
,

2681 
	mNL80211_ATTR_KEY_TYPE
,

2683 
	mNL80211_ATTR_MAX_SCAN_IE_LEN
,

2684 
	mNL80211_ATTR_CIPHER_SUITES
,

2686 
	mNL80211_ATTR_FREQ_BEFORE
,

2687 
	mNL80211_ATTR_FREQ_AFTER
,

2689 
	mNL80211_ATTR_FREQ_FIXED
,

2692 
	mNL80211_ATTR_WIPHY_RETRY_SHORT
,

2693 
	mNL80211_ATTR_WIPHY_RETRY_LONG
,

2694 
	mNL80211_ATTR_WIPHY_FRAG_THRESHOLD
,

2695 
	mNL80211_ATTR_WIPHY_RTS_THRESHOLD
,

2697 
	mNL80211_ATTR_TIMED_OUT
,

2699 
	mNL80211_ATTR_USE_MFP
,

2701 
	mNL80211_ATTR_STA_FLAGS2
,

2703 
	mNL80211_ATTR_CONTROL_PORT
,

2705 
	mNL80211_ATTR_TESTDATA
,

2707 
	mNL80211_ATTR_PRIVACY
,

2709 
	mNL80211_ATTR_DISCONNECTED_BY_AP
,

2710 
	mNL80211_ATTR_STATUS_CODE
,

2712 
	mNL80211_ATTR_CIPHER_SUITES_PAIRWISE
,

2713 
	mNL80211_ATTR_CIPHER_SUITE_GROUP
,

2714 
	mNL80211_ATTR_WPA_VERSIONS
,

2715 
	mNL80211_ATTR_AKM_SUITES
,

2717 
	mNL80211_ATTR_REQ_IE
,

2718 
	mNL80211_ATTR_RESP_IE
,

2720 
	mNL80211_ATTR_PREV_BSSID
,

2722 
	mNL80211_ATTR_KEY
,

2723 
	mNL80211_ATTR_KEYS
,

2725 
	mNL80211_ATTR_PID
,

2727 
	mNL80211_ATTR_4ADDR
,

2729 
	mNL80211_ATTR_SURVEY_INFO
,

2731 
	mNL80211_ATTR_PMKID
,

2732 
	mNL80211_ATTR_MAX_NUM_PMKIDS
,

2734 
	mNL80211_ATTR_DURATION
,

2736 
	mNL80211_ATTR_COOKIE
,

2738 
	mNL80211_ATTR_WIPHY_COVERAGE_CLASS
,

2740 
	mNL80211_ATTR_TX_RATES
,

2742 
	mNL80211_ATTR_FRAME_MATCH
,

2744 
	mNL80211_ATTR_ACK
,

2746 
	mNL80211_ATTR_PS_STATE
,

2748 
	mNL80211_ATTR_CQM
,

2750 
	mNL80211_ATTR_LOCAL_STATE_CHANGE
,

2752 
	mNL80211_ATTR_AP_ISOLATE
,

2754 
	mNL80211_ATTR_WIPHY_TX_POWER_SETTING
,

2755 
	mNL80211_ATTR_WIPHY_TX_POWER_LEVEL
,

2757 
	mNL80211_ATTR_TX_FRAME_TYPES
,

2758 
	mNL80211_ATTR_RX_FRAME_TYPES
,

2759 
	mNL80211_ATTR_FRAME_TYPE
,

2761 
	mNL80211_ATTR_CONTROL_PORT_ETHERTYPE
,

2762 
	mNL80211_ATTR_CONTROL_PORT_NO_ENCRYPT
,

2764 
	mNL80211_ATTR_SUPPORT_IBSS_RSN
,

2766 
	mNL80211_ATTR_WIPHY_ANTENNA_TX
,

2767 
	mNL80211_ATTR_WIPHY_ANTENNA_RX
,

2769 
	mNL80211_ATTR_MCAST_RATE
,

2771 
	mNL80211_ATTR_OFFCHANNEL_TX_OK
,

2773 
	mNL80211_ATTR_BSS_HT_OPMODE
,

2775 
	mNL80211_ATTR_KEY_DEFAULT_TYPES
,

2777 
	mNL80211_ATTR_MAX_REMAIN_ON_CHANNEL_DURATION
,

2779 
	mNL80211_ATTR_MESH_SETUP
,

2781 
	mNL80211_ATTR_WIPHY_ANTENNA_AVAIL_TX
,

2782 
	mNL80211_ATTR_WIPHY_ANTENNA_AVAIL_RX
,

2784 
	mNL80211_ATTR_SUPPORT_MESH_AUTH
,

2785 
	mNL80211_ATTR_STA_PLINK_STATE
,

2787 
	mNL80211_ATTR_WOWLAN_TRIGGERS
,

2788 
	mNL80211_ATTR_WOWLAN_TRIGGERS_SUPPORTED
,

2790 
	mNL80211_ATTR_SCHED_SCAN_INTERVAL
,

2792 
	mNL80211_ATTR_INTERFACE_COMBINATIONS
,

2793 
	mNL80211_ATTR_SOFTWARE_IFTYPES
,

2795 
	mNL80211_ATTR_REKEY_DATA
,

2797 
	mNL80211_ATTR_MAX_NUM_SCHED_SCAN_SSIDS
,

2798 
	mNL80211_ATTR_MAX_SCHED_SCAN_IE_LEN
,

2800 
	mNL80211_ATTR_SCAN_SUPP_RATES
,

2802 
	mNL80211_ATTR_HIDDEN_SSID
,

2804 
	mNL80211_ATTR_IE_PROBE_RESP
,

2805 
	mNL80211_ATTR_IE_ASSOC_RESP
,

2807 
	mNL80211_ATTR_STA_WME
,

2808 
	mNL80211_ATTR_SUPPORT_AP_UAPSD
,

2810 
	mNL80211_ATTR_ROAM_SUPPORT
,

2812 
	mNL80211_ATTR_SCHED_SCAN_MATCH
,

2813 
	mNL80211_ATTR_MAX_MATCH_SETS
,

2815 
	mNL80211_ATTR_PMKSA_CANDIDATE
,

2817 
	mNL80211_ATTR_TX_NO_CCK_RATE
,

2819 
	mNL80211_ATTR_TDLS_ACTION
,

2820 
	mNL80211_ATTR_TDLS_DIALOG_TOKEN
,

2821 
	mNL80211_ATTR_TDLS_OPERATION
,

2822 
	mNL80211_ATTR_TDLS_SUPPORT
,

2823 
	mNL80211_ATTR_TDLS_EXTERNAL_SETUP
,

2825 
	mNL80211_ATTR_DEVICE_AP_SME
,

2827 
	mNL80211_ATTR_DONT_WAIT_FOR_ACK
,

2829 
	mNL80211_ATTR_FEATURE_FLAGS
,

2831 
	mNL80211_ATTR_PROBE_RESP_OFFLOAD
,

2833 
	mNL80211_ATTR_PROBE_RESP
,

2835 
	mNL80211_ATTR_DFS_REGION
,

2837 
	mNL80211_ATTR_DISABLE_HT
,

2838 
	mNL80211_ATTR_HT_CAPABILITY_MASK
,

2840 
	mNL80211_ATTR_NOACK_MAP
,

2842 
	mNL80211_ATTR_INACTIVITY_TIMEOUT
,

2844 
	mNL80211_ATTR_RX_SIGNAL_DBM
,

2846 
	mNL80211_ATTR_BG_SCAN_PERIOD
,

2848 
	mNL80211_ATTR_WDEV
,

2850 
	mNL80211_ATTR_USER_REG_HINT_TYPE
,

2852 
	mNL80211_ATTR_CONN_FAILED_REASON
,

2854 
	mNL80211_ATTR_AUTH_DATA
,

2856 
	mNL80211_ATTR_VHT_CAPABILITY
,

2858 
	mNL80211_ATTR_SCAN_FLAGS
,

2860 
	mNL80211_ATTR_CHANNEL_WIDTH
,

2861 
	mNL80211_ATTR_CENTER_FREQ1
,

2862 
	mNL80211_ATTR_CENTER_FREQ2
,

2864 
	mNL80211_ATTR_P2P_CTWINDOW
,

2865 
	mNL80211_ATTR_P2P_OPPPS
,

2867 
	mNL80211_ATTR_LOCAL_MESH_POWER_MODE
,

2869 
	mNL80211_ATTR_ACL_POLICY
,

2871 
	mNL80211_ATTR_MAC_ADDRS
,

2873 
	mNL80211_ATTR_MAC_ACL_MAX
,

2875 
	mNL80211_ATTR_RADAR_EVENT
,

2877 
	mNL80211_ATTR_EXT_CAPA
,

2878 
	mNL80211_ATTR_EXT_CAPA_MASK
,

2880 
	mNL80211_ATTR_STA_CAPABILITY
,

2881 
	mNL80211_ATTR_STA_EXT_CAPABILITY
,

2883 
	mNL80211_ATTR_PROTOCOL_FEATURES
,

2884 
	mNL80211_ATTR_SPLIT_WIPHY_DUMP
,

2886 
	mNL80211_ATTR_DISABLE_VHT
,

2887 
	mNL80211_ATTR_VHT_CAPABILITY_MASK
,

2889 
	mNL80211_ATTR_MDID
,

2890 
	mNL80211_ATTR_IE_RIC
,

2892 
	mNL80211_ATTR_CRIT_PROT_ID
,

2893 
	mNL80211_ATTR_MAX_CRIT_PROT_DURATION
,

2895 
	mNL80211_ATTR_PEER_AID
,

2897 
	mNL80211_ATTR_COALESCE_RULE
,

2899 
	mNL80211_ATTR_CH_SWITCH_COUNT
,

2900 
	mNL80211_ATTR_CH_SWITCH_BLOCK_TX
,

2901 
	mNL80211_ATTR_CSA_IES
,

2902 
	mNL80211_ATTR_CNTDWN_OFFS_BEACON
,

2903 
	mNL80211_ATTR_CNTDWN_OFFS_PRESP
,

2905 
	mNL80211_ATTR_RXMGMT_FLAGS
,

2907 
	mNL80211_ATTR_STA_SUPPORTED_CHANNELS
,

2909 
	mNL80211_ATTR_STA_SUPPORTED_OPER_CLASSES
,

2911 
	mNL80211_ATTR_HANDLE_DFS
,

2913 
	mNL80211_ATTR_SUPPORT_5_MHZ
,

2914 
	mNL80211_ATTR_SUPPORT_10_MHZ
,

2916 
	mNL80211_ATTR_OPMODE_NOTIF
,

2918 
	mNL80211_ATTR_VENDOR_ID
,

2919 
	mNL80211_ATTR_VENDOR_SUBCMD
,

2920 
	mNL80211_ATTR_VENDOR_DATA
,

2921 
	mNL80211_ATTR_VENDOR_EVENTS
,

2923 
	mNL80211_ATTR_QOS_MAP
,

2925 
	mNL80211_ATTR_MAC_HINT
,

2926 
	mNL80211_ATTR_WIPHY_FREQ_HINT
,

2928 
	mNL80211_ATTR_MAX_AP_ASSOC_STA
,

2930 
	mNL80211_ATTR_TDLS_PEER_CAPABILITY
,

2932 
	mNL80211_ATTR_SOCKET_OWNER
,

2934 
	mNL80211_ATTR_CSA_C_OFFSETS_TX
,

2935 
	mNL80211_ATTR_MAX_CSA_COUNTERS
,

2937 
	mNL80211_ATTR_TDLS_INITIATOR
,

2939 
	mNL80211_ATTR_USE_RRM
,

2941 
	mNL80211_ATTR_WIPHY_DYN_ACK
,

2943 
	mNL80211_ATTR_TSID
,

2944 
	mNL80211_ATTR_USER_PRIO
,

2945 
	mNL80211_ATTR_ADMITTED_TIME
,

2947 
	mNL80211_ATTR_SMPS_MODE
,

2949 
	mNL80211_ATTR_OPER_CLASS
,

2951 
	mNL80211_ATTR_MAC_MASK
,

2953 
	mNL80211_ATTR_WIPHY_SELF_MANAGED_REG
,

2955 
	mNL80211_ATTR_EXT_FEATURES
,

2957 
	mNL80211_ATTR_SURVEY_RADIO_STATS
,

2959 
	mNL80211_ATTR_NETNS_FD
,

2961 
	mNL80211_ATTR_SCHED_SCAN_DELAY
,

2963 
	mNL80211_ATTR_REG_INDOOR
,

2965 
	mNL80211_ATTR_MAX_NUM_SCHED_SCAN_PLANS
,

2966 
	mNL80211_ATTR_MAX_SCAN_PLAN_INTERVAL
,

2967 
	mNL80211_ATTR_MAX_SCAN_PLAN_ITERATIONS
,

2968 
	mNL80211_ATTR_SCHED_SCAN_PLANS
,

2970 
	mNL80211_ATTR_PBSS
,

2972 
	mNL80211_ATTR_BSS_SELECT
,

2974 
	mNL80211_ATTR_STA_SUPPORT_P2P_PS
,

2976 
	mNL80211_ATTR_PAD
,

2978 
	mNL80211_ATTR_IFTYPE_EXT_CAPA
,

2980 
	mNL80211_ATTR_MU_MIMO_GROUP_DATA
,

2981 
	mNL80211_ATTR_MU_MIMO_FOLLOW_MAC_ADDR
,

2983 
	mNL80211_ATTR_SCAN_START_TIME_TSF
,

2984 
	mNL80211_ATTR_SCAN_START_TIME_TSF_BSSID
,

2985 
	mNL80211_ATTR_MEASUREMENT_DURATION
,

2986 
	mNL80211_ATTR_MEASUREMENT_DURATION_MANDATORY
,

2988 
	mNL80211_ATTR_MESH_PEER_AID
,

2990 
	mNL80211_ATTR_NAN_MASTER_PREF
,

2991 
	mNL80211_ATTR_BANDS
,

2992 
	mNL80211_ATTR_NAN_FUNC
,

2993 
	mNL80211_ATTR_NAN_MATCH
,

2995 
	mNL80211_ATTR_FILS_KEK
,

2996 
	mNL80211_ATTR_FILS_NONCES
,

2998 
	mNL80211_ATTR_MULTICAST_TO_UNICAST_ENABLED
,

3000 
	mNL80211_ATTR_BSSID
,

3002 
	mNL80211_ATTR_SCHED_SCAN_RELATIVE_RSSI
,

3003 
	mNL80211_ATTR_SCHED_SCAN_RSSI_ADJUST
,

3005 
	mNL80211_ATTR_TIMEOUT_REASON
,

3007 
	mNL80211_ATTR_FILS_ERP_USERNAME
,

3008 
	mNL80211_ATTR_FILS_ERP_REALM
,

3009 
	mNL80211_ATTR_FILS_ERP_NEXT_SEQ_NUM
,

3010 
	mNL80211_ATTR_FILS_ERP_RRK
,

3011 
	mNL80211_ATTR_FILS_CACHE_ID
,

3013 
	mNL80211_ATTR_PMK
,

3015 
	mNL80211_ATTR_SCHED_SCAN_MULTI
,

3016 
	mNL80211_ATTR_SCHED_SCAN_MAX_REQS
,

3018 
	mNL80211_ATTR_WANT_1X_4WAY_HS
,

3019 
	mNL80211_ATTR_PMKR0_NAME
,

3020 
	mNL80211_ATTR_PORT_AUTHORIZED
,

3022 
	mNL80211_ATTR_EXTERNAL_AUTH_ACTION
,

3023 
	mNL80211_ATTR_EXTERNAL_AUTH_SUPPORT
,

3025 
	mNL80211_ATTR_NSS
,

3026 
	mNL80211_ATTR_ACK_SIGNAL
,

3028 
	mNL80211_ATTR_CONTROL_PORT_OVER_NL80211
,

3030 
	mNL80211_ATTR_TXQ_STATS
,

3031 
	mNL80211_ATTR_TXQ_LIMIT
,

3032 
	mNL80211_ATTR_TXQ_MEMORY_LIMIT
,

3033 
	mNL80211_ATTR_TXQ_QUANTUM
,

3035 
	mNL80211_ATTR_HE_CAPABILITY
,

3037 
	mNL80211_ATTR_FTM_RESPONDER
,

3039 
	mNL80211_ATTR_FTM_RESPONDER_STATS
,

3041 
	mNL80211_ATTR_TIMEOUT
,

3043 
	mNL80211_ATTR_PEER_MEASUREMENTS
,

3045 
	mNL80211_ATTR_AIRTIME_WEIGHT
,

3046 
	mNL80211_ATTR_STA_TX_POWER_SETTING
,

3047 
	mNL80211_ATTR_STA_TX_POWER
,

3049 
	mNL80211_ATTR_SAE_PASSWORD
,

3051 
	mNL80211_ATTR_TWT_RESPONDER
,

3053 
	mNL80211_ATTR_HE_OBSS_PD
,

3055 
	mNL80211_ATTR_WIPHY_EDMG_CHANNELS
,

3056 
	mNL80211_ATTR_WIPHY_EDMG_BW_CONFIG
,

3058 
	mNL80211_ATTR_VLAN_ID
,

3060 
	mNL80211_ATTR_HE_BSS_COLOR
,

3062 
	mNL80211_ATTR_IFTYPE_AKM_SUITES
,

3064 
	mNL80211_ATTR_TID_CONFIG
,

3066 
	mNL80211_ATTR_CONTROL_PORT_NO_PREAUTH
,

3068 
	mNL80211_ATTR_PMK_LIFETIME
,

3069 
	mNL80211_ATTR_PMK_REAUTH_THRESHOLD
,

3071 
	mNL80211_ATTR_RECEIVE_MULTICAST
,

3072 
	mNL80211_ATTR_WIPHY_FREQ_OFFSET
,

3073 
	mNL80211_ATTR_CENTER_FREQ1_OFFSET
,

3074 
	mNL80211_ATTR_SCAN_FREQ_KHZ
,

3076 
	mNL80211_ATTR_HE_6GHZ_CAPABILITY
,

3078 
	mNL80211_ATTR_FILS_DISCOVERY
,

3080 
	mNL80211_ATTR_UNSOL_BCAST_PROBE_RESP
,

3082 
	mNL80211_ATTR_S1G_CAPABILITY
,

3083 
	mNL80211_ATTR_S1G_CAPABILITY_MASK
,

3085 
	mNL80211_ATTR_SAE_PWE
,

3087 
	mNL80211_ATTR_RECONNECT_REQUESTED
,

3089 
	mNL80211_ATTR_SAR_SPEC
,

3091 
	mNL80211_ATTR_DISABLE_HE
,

3093 
	mNL80211_ATTR_OBSS_COLOR_BITMAP
,

3095 
	mNL80211_ATTR_COLOR_CHANGE_COUNT
,

3096 
	mNL80211_ATTR_COLOR_CHANGE_COLOR
,

3097 
	mNL80211_ATTR_COLOR_CHANGE_ELEMS
,

3101 
	m__NL80211_ATTR_AFTER_LAST
,

3102 
	mNUM_NL80211_ATTR
 = 
__NL80211_ATTR_AFTER_LAST
,

3103 
	mNL80211_ATTR_MAX
 = 
__NL80211_ATTR_AFTER_LAST
 - 1

3107 
	#NL80211_ATTR_SCAN_GENERATION
 
NL80211_ATTR_GENERATION


	)

3108 
	#NL80211_ATTR_MESH_PARAMS
 
NL80211_ATTR_MESH_CONFIG


	)

3109 
	#NL80211_ATTR_IFACE_SOCKET_OWNER
 
NL80211_ATTR_SOCKET_OWNER


	)

3110 
	#NL80211_ATTR_SAE_DATA
 
NL80211_ATTR_AUTH_DATA


	)

3111 
	#NL80211_ATTR_CSA_C_OFF_BEACON
 
NL80211_ATTR_CNTDWN_OFFS_BEACON


	)

3112 
	#NL80211_ATTR_CSA_C_OFF_PRESP
 
NL80211_ATTR_CNTDWN_OFFS_PRESP


	)

3118 
	#NL80211_CMD_CONNECT
 
NL80211_CMD_CONNECT


	)

3119 
	#NL80211_ATTR_HT_CAPABILITY
 
NL80211_ATTR_HT_CAPABILITY


	)

3120 
	#NL80211_ATTR_BSS_BASIC_RATES
 
NL80211_ATTR_BSS_BASIC_RATES


	)

3121 
	#NL80211_ATTR_WIPHY_TXQ_PARAMS
 
NL80211_ATTR_WIPHY_TXQ_PARAMS


	)

3122 
	#NL80211_ATTR_WIPHY_FREQ
 
NL80211_ATTR_WIPHY_FREQ


	)

3123 
	#NL80211_ATTR_WIPHY_CHANNEL_TYPE
 
NL80211_ATTR_WIPHY_CHANNEL_TYPE


	)

3124 
	#NL80211_ATTR_MGMT_SUBTYPE
 
NL80211_ATTR_MGMT_SUBTYPE


	)

3125 
	#NL80211_ATTR_IE
 
NL80211_ATTR_IE


	)

3126 
	#NL80211_ATTR_REG_INITIATOR
 
NL80211_ATTR_REG_INITIATOR


	)

3127 
	#NL80211_ATTR_REG_TYPE
 
NL80211_ATTR_REG_TYPE


	)

3128 
	#NL80211_ATTR_FRAME
 
NL80211_ATTR_FRAME


	)

3129 
	#NL80211_ATTR_SSID
 
NL80211_ATTR_SSID


	)

3130 
	#NL80211_ATTR_AUTH_TYPE
 
NL80211_ATTR_AUTH_TYPE


	)

3131 
	#NL80211_ATTR_REASON_CODE
 
NL80211_ATTR_REASON_CODE


	)

3132 
	#NL80211_ATTR_CIPHER_SUITES_PAIRWISE
 
NL80211_ATTR_CIPHER_SUITES_PAIRWISE


	)

3133 
	#NL80211_ATTR_CIPHER_SUITE_GROUP
 
NL80211_ATTR_CIPHER_SUITE_GROUP


	)

3134 
	#NL80211_ATTR_WPA_VERSIONS
 
NL80211_ATTR_WPA_VERSIONS


	)

3135 
	#NL80211_ATTR_AKM_SUITES
 
NL80211_ATTR_AKM_SUITES


	)

3136 
	#NL80211_ATTR_KEY
 
NL80211_ATTR_KEY


	)

3137 
	#NL80211_ATTR_KEYS
 
NL80211_ATTR_KEYS


	)

3138 
	#NL80211_ATTR_FEATURE_FLAGS
 
NL80211_ATTR_FEATURE_FLAGS


	)

3140 
	#NL80211_WIPHY_NAME_MAXLEN
 64

	)

3142 
	#NL80211_MAX_SUPP_RATES
 32

	)

3143 
	#NL80211_MAX_SUPP_HT_RATES
 77

	)

3144 
	#NL80211_MAX_SUPP_REG_RULES
 128

	)

3145 
	#NL80211_TKIP_DATA_OFFSET_ENCR_KEY
 0

	)

3146 
	#NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
 16

	)

3147 
	#NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 24

	)

3148 
	#NL80211_HT_CAPABILITY_LEN
 26

	)

3149 
	#NL80211_VHT_CAPABILITY_LEN
 12

	)

3150 
	#NL80211_HE_MIN_CAPABILITY_LEN
 16

	)

3151 
	#NL80211_HE_MAX_CAPABILITY_LEN
 54

	)

3152 
	#NL80211_MAX_NR_CIPHER_SUITES
 5

	)

3153 
	#NL80211_MAX_NR_AKM_SUITES
 2

	)

3155 
	#NL80211_MIN_REMAIN_ON_CHANNEL_TIME
 10

	)

3158 
	#NL80211_SCAN_RSSI_THOLD_OFF
 -300

	)

3160 
	#NL80211_CQM_TXE_MAX_INTVL
 1800

	)

3191 
	e∆80211_i·y≥
 {

3192 
	mNL80211_IFTYPE_UNSPECIFIED
,

3193 
	mNL80211_IFTYPE_ADHOC
,

3194 
	mNL80211_IFTYPE_STATION
,

3195 
	mNL80211_IFTYPE_AP
,

3196 
	mNL80211_IFTYPE_AP_VLAN
,

3197 
	mNL80211_IFTYPE_WDS
,

3198 
	mNL80211_IFTYPE_MONITOR
,

3199 
	mNL80211_IFTYPE_MESH_POINT
,

3200 
	mNL80211_IFTYPE_P2P_CLIENT
,

3201 
	mNL80211_IFTYPE_P2P_GO
,

3202 
	mNL80211_IFTYPE_P2P_DEVICE
,

3203 
	mNL80211_IFTYPE_OCB
,

3204 
	mNL80211_IFTYPE_NAN
,

3207 
	mNUM_NL80211_IFTYPES
,

3208 
	mNL80211_IFTYPE_MAX
 = 
NUM_NL80211_IFTYPES
 - 1

3235 
	e∆80211_°a_Êags
 {

3236 
	m__NL80211_STA_FLAG_INVALID
,

3237 
	mNL80211_STA_FLAG_AUTHORIZED
,

3238 
	mNL80211_STA_FLAG_SHORT_PREAMBLE
,

3239 
	mNL80211_STA_FLAG_WME
,

3240 
	mNL80211_STA_FLAG_MFP
,

3241 
	mNL80211_STA_FLAG_AUTHENTICATED
,

3242 
	mNL80211_STA_FLAG_TDLS_PEER
,

3243 
	mNL80211_STA_FLAG_ASSOCIATED
,

3246 
	m__NL80211_STA_FLAG_AFTER_LAST
,

3247 
	mNL80211_STA_FLAG_MAX
 = 
__NL80211_STA_FLAG_AFTER_LAST
 - 1

3257 
	e∆80211_°a_p2p_ps_°©us
 {

3258 
	mNL80211_P2P_PS_UNSUPPORTED
 = 0,

3259 
	mNL80211_P2P_PS_SUPPORTED
,

3261 
	mNUM_NL80211_P2P_PS_STATUS
,

3264 
	#NL80211_STA_FLAG_MAX_OLD_API
 
NL80211_STA_FLAG_TDLS_PEER


	)

3273 
	s∆80211_°a_Êag_upd©e
 {

3274 
__u32
 
	mmask
;

3275 
__u32
 
	m£t
;

3276 } 
__©åibuã__
((
∑cked
));

3284 
	e∆80211_he_gi
 {

3285 
	mNL80211_RATE_INFO_HE_GI_0_8
,

3286 
	mNL80211_RATE_INFO_HE_GI_1_6
,

3287 
	mNL80211_RATE_INFO_HE_GI_3_2
,

3296 
	e∆80211_he_…f
 {

3297 
	mNL80211_RATE_INFO_HE_1XLTF
,

3298 
	mNL80211_RATE_INFO_HE_2XLTF
,

3299 
	mNL80211_RATE_INFO_HE_4XLTF
,

3312 
	e∆80211_he_ru_Æloc
 {

3313 
	mNL80211_RATE_INFO_HE_RU_ALLOC_26
,

3314 
	mNL80211_RATE_INFO_HE_RU_ALLOC_52
,

3315 
	mNL80211_RATE_INFO_HE_RU_ALLOC_106
,

3316 
	mNL80211_RATE_INFO_HE_RU_ALLOC_242
,

3317 
	mNL80211_RATE_INFO_HE_RU_ALLOC_484
,

3318 
	mNL80211_RATE_INFO_HE_RU_ALLOC_996
,

3319 
	mNL80211_RATE_INFO_HE_RU_ALLOC_2x996
,

3363 
	e∆80211_øã_öfo
 {

3364 
	m__NL80211_RATE_INFO_INVALID
,

3365 
	mNL80211_RATE_INFO_BITRATE
,

3366 
	mNL80211_RATE_INFO_MCS
,

3367 
	mNL80211_RATE_INFO_40_MHZ_WIDTH
,

3368 
	mNL80211_RATE_INFO_SHORT_GI
,

3369 
	mNL80211_RATE_INFO_BITRATE32
,

3370 
	mNL80211_RATE_INFO_VHT_MCS
,

3371 
	mNL80211_RATE_INFO_VHT_NSS
,

3372 
	mNL80211_RATE_INFO_80_MHZ_WIDTH
,

3373 
	mNL80211_RATE_INFO_80P80_MHZ_WIDTH
,

3374 
	mNL80211_RATE_INFO_160_MHZ_WIDTH
,

3375 
	mNL80211_RATE_INFO_10_MHZ_WIDTH
,

3376 
	mNL80211_RATE_INFO_5_MHZ_WIDTH
,

3377 
	mNL80211_RATE_INFO_HE_MCS
,

3378 
	mNL80211_RATE_INFO_HE_NSS
,

3379 
	mNL80211_RATE_INFO_HE_GI
,

3380 
	mNL80211_RATE_INFO_HE_DCM
,

3381 
	mNL80211_RATE_INFO_HE_RU_ALLOC
,

3384 
	m__NL80211_RATE_INFO_AFTER_LAST
,

3385 
	mNL80211_RATE_INFO_MAX
 = 
__NL80211_RATE_INFO_AFTER_LAST
 - 1

3405 
	e∆80211_°a_bss_∑øm
 {

3406 
	m__NL80211_STA_BSS_PARAM_INVALID
,

3407 
	mNL80211_STA_BSS_PARAM_CTS_PROT
,

3408 
	mNL80211_STA_BSS_PARAM_SHORT_PREAMBLE
,

3409 
	mNL80211_STA_BSS_PARAM_SHORT_SLOT_TIME
,

3410 
	mNL80211_STA_BSS_PARAM_DTIM_PERIOD
,

3411 
	mNL80211_STA_BSS_PARAM_BEACON_INTERVAL
,

3414 
	m__NL80211_STA_BSS_PARAM_AFTER_LAST
,

3415 
	mNL80211_STA_BSS_PARAM_MAX
 = 
__NL80211_STA_BSS_PARAM_AFTER_LAST
 - 1

3501 
	e∆80211_°a_öfo
 {

3502 
	m__NL80211_STA_INFO_INVALID
,

3503 
	mNL80211_STA_INFO_INACTIVE_TIME
,

3504 
	mNL80211_STA_INFO_RX_BYTES
,

3505 
	mNL80211_STA_INFO_TX_BYTES
,

3506 
	mNL80211_STA_INFO_LLID
,

3507 
	mNL80211_STA_INFO_PLID
,

3508 
	mNL80211_STA_INFO_PLINK_STATE
,

3509 
	mNL80211_STA_INFO_SIGNAL
,

3510 
	mNL80211_STA_INFO_TX_BITRATE
,

3511 
	mNL80211_STA_INFO_RX_PACKETS
,

3512 
	mNL80211_STA_INFO_TX_PACKETS
,

3513 
	mNL80211_STA_INFO_TX_RETRIES
,

3514 
	mNL80211_STA_INFO_TX_FAILED
,

3515 
	mNL80211_STA_INFO_SIGNAL_AVG
,

3516 
	mNL80211_STA_INFO_RX_BITRATE
,

3517 
	mNL80211_STA_INFO_BSS_PARAM
,

3518 
	mNL80211_STA_INFO_CONNECTED_TIME
,

3519 
	mNL80211_STA_INFO_STA_FLAGS
,

3520 
	mNL80211_STA_INFO_BEACON_LOSS
,

3521 
	mNL80211_STA_INFO_T_OFFSET
,

3522 
	mNL80211_STA_INFO_LOCAL_PM
,

3523 
	mNL80211_STA_INFO_PEER_PM
,

3524 
	mNL80211_STA_INFO_NONPEER_PM
,

3525 
	mNL80211_STA_INFO_RX_BYTES64
,

3526 
	mNL80211_STA_INFO_TX_BYTES64
,

3527 
	mNL80211_STA_INFO_CHAIN_SIGNAL
,

3528 
	mNL80211_STA_INFO_CHAIN_SIGNAL_AVG
,

3529 
	mNL80211_STA_INFO_EXPECTED_THROUGHPUT
,

3530 
	mNL80211_STA_INFO_RX_DROP_MISC
,

3531 
	mNL80211_STA_INFO_BEACON_RX
,

3532 
	mNL80211_STA_INFO_BEACON_SIGNAL_AVG
,

3533 
	mNL80211_STA_INFO_TID_STATS
,

3534 
	mNL80211_STA_INFO_RX_DURATION
,

3535 
	mNL80211_STA_INFO_PAD
,

3536 
	mNL80211_STA_INFO_ACK_SIGNAL
,

3537 
	mNL80211_STA_INFO_ACK_SIGNAL_AVG
,

3538 
	mNL80211_STA_INFO_RX_MPDUS
,

3539 
	mNL80211_STA_INFO_FCS_ERROR_COUNT
,

3540 
	mNL80211_STA_INFO_CONNECTED_TO_GATE
,

3541 
	mNL80211_STA_INFO_TX_DURATION
,

3542 
	mNL80211_STA_INFO_AIRTIME_WEIGHT
,

3543 
	mNL80211_STA_INFO_AIRTIME_LINK_METRIC
,

3544 
	mNL80211_STA_INFO_ASSOC_AT_BOOTTIME
,

3545 
	mNL80211_STA_INFO_CONNECTED_TO_AS
,

3548 
	m__NL80211_STA_INFO_AFTER_LAST
,

3549 
	mNL80211_STA_INFO_MAX
 = 
__NL80211_STA_INFO_AFTER_LAST
 - 1

3553 
	#NL80211_STA_INFO_DATA_ACK_SIGNAL_AVG
 
NL80211_STA_INFO_ACK_SIGNAL_AVG


	)

3571 
	e∆80211_tid_°©s
 {

3572 
	m__NL80211_TID_STATS_INVALID
,

3573 
	mNL80211_TID_STATS_RX_MSDU
,

3574 
	mNL80211_TID_STATS_TX_MSDU
,

3575 
	mNL80211_TID_STATS_TX_MSDU_RETRIES
,

3576 
	mNL80211_TID_STATS_TX_MSDU_FAILED
,

3577 
	mNL80211_TID_STATS_PAD
,

3578 
	mNL80211_TID_STATS_TXQ_STATS
,

3581 
	mNUM_NL80211_TID_STATS
,

3582 
	mNL80211_TID_STATS_MAX
 = 
NUM_NL80211_TID_STATS
 - 1

3604 
	e∆80211_txq_°©s
 {

3605 
	m__NL80211_TXQ_STATS_INVALID
,

3606 
	mNL80211_TXQ_STATS_BACKLOG_BYTES
,

3607 
	mNL80211_TXQ_STATS_BACKLOG_PACKETS
,

3608 
	mNL80211_TXQ_STATS_FLOWS
,

3609 
	mNL80211_TXQ_STATS_DROPS
,

3610 
	mNL80211_TXQ_STATS_ECN_MARKS
,

3611 
	mNL80211_TXQ_STATS_OVERLIMIT
,

3612 
	mNL80211_TXQ_STATS_OVERMEMORY
,

3613 
	mNL80211_TXQ_STATS_COLLISIONS
,

3614 
	mNL80211_TXQ_STATS_TX_BYTES
,

3615 
	mNL80211_TXQ_STATS_TX_PACKETS
,

3616 
	mNL80211_TXQ_STATS_MAX_FLOWS
,

3619 
	mNUM_NL80211_TXQ_STATS
,

3620 
	mNL80211_TXQ_STATS_MAX
 = 
NUM_NL80211_TXQ_STATS
 - 1

3632 
	e∆80211_m∑th_Êags
 {

3633 
	mNL80211_MPATH_FLAG_ACTIVE
 = 1<<0,

3634 
	mNL80211_MPATH_FLAG_RESOLVING
 = 1<<1,

3635 
	mNL80211_MPATH_FLAG_SN_VALID
 = 1<<2,

3636 
	mNL80211_MPATH_FLAG_FIXED
 = 1<<3,

3637 
	mNL80211_MPATH_FLAG_RESOLVED
 = 1<<4,

3661 
	e∆80211_m∑th_öfo
 {

3662 
	m__NL80211_MPATH_INFO_INVALID
,

3663 
	mNL80211_MPATH_INFO_FRAME_QLEN
,

3664 
	mNL80211_MPATH_INFO_SN
,

3665 
	mNL80211_MPATH_INFO_METRIC
,

3666 
	mNL80211_MPATH_INFO_EXPTIME
,

3667 
	mNL80211_MPATH_INFO_FLAGS
,

3668 
	mNL80211_MPATH_INFO_DISCOVERY_TIMEOUT
,

3669 
	mNL80211_MPATH_INFO_DISCOVERY_RETRIES
,

3670 
	mNL80211_MPATH_INFO_HOP_COUNT
,

3671 
	mNL80211_MPATH_INFO_PATH_CHANGE
,

3674 
	m__NL80211_MPATH_INFO_AFTER_LAST
,

3675 
	mNL80211_MPATH_INFO_MAX
 = 
__NL80211_MPATH_INFO_AFTER_LAST
 - 1

3700 
	e∆80211_b™d_i·y≥_©å
 {

3701 
	m__NL80211_BAND_IFTYPE_ATTR_INVALID
,

3703 
	mNL80211_BAND_IFTYPE_ATTR_IFTYPES
,

3704 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_MAC
,

3705 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_PHY
,

3706 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_MCS_SET
,

3707 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_PPE
,

3708 
	mNL80211_BAND_IFTYPE_ATTR_HE_6GHZ_CAPA
,

3709 
	mNL80211_BAND_IFTYPE_ATTR_VENDOR_ELEMS
,

3712 
	m__NL80211_BAND_IFTYPE_ATTR_AFTER_LAST
,

3713 
	mNL80211_BAND_IFTYPE_ATTR_MAX
 = 
__NL80211_BAND_IFTYPE_ATTR_AFTER_LAST
 - 1

3742 
	e∆80211_b™d_©å
 {

3743 
	m__NL80211_BAND_ATTR_INVALID
,

3744 
	mNL80211_BAND_ATTR_FREQS
,

3745 
	mNL80211_BAND_ATTR_RATES
,

3747 
	mNL80211_BAND_ATTR_HT_MCS_SET
,

3748 
	mNL80211_BAND_ATTR_HT_CAPA
,

3749 
	mNL80211_BAND_ATTR_HT_AMPDU_FACTOR
,

3750 
	mNL80211_BAND_ATTR_HT_AMPDU_DENSITY
,

3752 
	mNL80211_BAND_ATTR_VHT_MCS_SET
,

3753 
	mNL80211_BAND_ATTR_VHT_CAPA
,

3754 
	mNL80211_BAND_ATTR_IFTYPE_DATA
,

3756 
	mNL80211_BAND_ATTR_EDMG_CHANNELS
,

3757 
	mNL80211_BAND_ATTR_EDMG_BW_CONFIG
,

3760 
	m__NL80211_BAND_ATTR_AFTER_LAST
,

3761 
	mNL80211_BAND_ATTR_MAX
 = 
__NL80211_BAND_ATTR_AFTER_LAST
 - 1

3764 
	#NL80211_BAND_ATTR_HT_CAPA
 
NL80211_BAND_ATTR_HT_CAPA


	)

3777 
	e∆80211_wmm_ruÀ
 {

3778 
	m__NL80211_WMMR_INVALID
,

3779 
	mNL80211_WMMR_CW_MIN
,

3780 
	mNL80211_WMMR_CW_MAX
,

3781 
	mNL80211_WMMR_AIFSN
,

3782 
	mNL80211_WMMR_TXOP
,

3785 
	m__NL80211_WMMR_LAST
,

3786 
	mNL80211_WMMR_MAX
 = 
__NL80211_WMMR_LAST
 - 1

3863 
	e∆80211_‰equícy_©å
 {

3864 
	m__NL80211_FREQUENCY_ATTR_INVALID
,

3865 
	mNL80211_FREQUENCY_ATTR_FREQ
,

3866 
	mNL80211_FREQUENCY_ATTR_DISABLED
,

3867 
	mNL80211_FREQUENCY_ATTR_NO_IR
,

3868 
	m__NL80211_FREQUENCY_ATTR_NO_IBSS
,

3869 
	mNL80211_FREQUENCY_ATTR_RADAR
,

3870 
	mNL80211_FREQUENCY_ATTR_MAX_TX_POWER
,

3871 
	mNL80211_FREQUENCY_ATTR_DFS_STATE
,

3872 
	mNL80211_FREQUENCY_ATTR_DFS_TIME
,

3873 
	mNL80211_FREQUENCY_ATTR_NO_HT40_MINUS
,

3874 
	mNL80211_FREQUENCY_ATTR_NO_HT40_PLUS
,

3875 
	mNL80211_FREQUENCY_ATTR_NO_80MHZ
,

3876 
	mNL80211_FREQUENCY_ATTR_NO_160MHZ
,

3877 
	mNL80211_FREQUENCY_ATTR_DFS_CAC_TIME
,

3878 
	mNL80211_FREQUENCY_ATTR_INDOOR_ONLY
,

3879 
	mNL80211_FREQUENCY_ATTR_IR_CONCURRENT
,

3880 
	mNL80211_FREQUENCY_ATTR_NO_20MHZ
,

3881 
	mNL80211_FREQUENCY_ATTR_NO_10MHZ
,

3882 
	mNL80211_FREQUENCY_ATTR_WMM
,

3883 
	mNL80211_FREQUENCY_ATTR_NO_HE
,

3884 
	mNL80211_FREQUENCY_ATTR_OFFSET
,

3885 
	mNL80211_FREQUENCY_ATTR_1MHZ
,

3886 
	mNL80211_FREQUENCY_ATTR_2MHZ
,

3887 
	mNL80211_FREQUENCY_ATTR_4MHZ
,

3888 
	mNL80211_FREQUENCY_ATTR_8MHZ
,

3889 
	mNL80211_FREQUENCY_ATTR_16MHZ
,

3892 
	m__NL80211_FREQUENCY_ATTR_AFTER_LAST
,

3893 
	mNL80211_FREQUENCY_ATTR_MAX
 = 
__NL80211_FREQUENCY_ATTR_AFTER_LAST
 - 1

3896 
	#NL80211_FREQUENCY_ATTR_MAX_TX_POWER
 
NL80211_FREQUENCY_ATTR_MAX_TX_POWER


	)

3897 
	#NL80211_FREQUENCY_ATTR_PASSIVE_SCAN
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

3898 
	#NL80211_FREQUENCY_ATTR_NO_IBSS
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

3899 
	#NL80211_FREQUENCY_ATTR_NO_IR
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

3900 
	#NL80211_FREQUENCY_ATTR_GO_CONCURRENT
 \

3901 
NL80211_FREQUENCY_ATTR_IR_CONCURRENT


	)

3913 
	e∆80211_bôøã_©å
 {

3914 
	m__NL80211_BITRATE_ATTR_INVALID
,

3915 
	mNL80211_BITRATE_ATTR_RATE
,

3916 
	mNL80211_BITRATE_ATTR_2GHZ_SHORTPREAMBLE
,

3919 
	m__NL80211_BITRATE_ATTR_AFTER_LAST
,

3920 
	mNL80211_BITRATE_ATTR_MAX
 = 
__NL80211_BITRATE_ATTR_AFTER_LAST
 - 1

3939 
	e∆80211_ªg_öôüt‹
 {

3940 
	mNL80211_REGDOM_SET_BY_CORE
,

3941 
	mNL80211_REGDOM_SET_BY_USER
,

3942 
	mNL80211_REGDOM_SET_BY_DRIVER
,

3943 
	mNL80211_REGDOM_SET_BY_COUNTRY_IE
,

3962 
	e∆80211_ªg_ty≥
 {

3963 
	mNL80211_REGDOM_TYPE_COUNTRY
,

3964 
	mNL80211_REGDOM_TYPE_WORLD
,

3965 
	mNL80211_REGDOM_TYPE_CUSTOM_WORLD
,

3966 
	mNL80211_REGDOM_TYPE_INTERSECTION
,

3994 
	e∆80211_ªg_ruÀ_©å
 {

3995 
	m__NL80211_REG_RULE_ATTR_INVALID
,

3996 
	mNL80211_ATTR_REG_RULE_FLAGS
,

3998 
	mNL80211_ATTR_FREQ_RANGE_START
,

3999 
	mNL80211_ATTR_FREQ_RANGE_END
,

4000 
	mNL80211_ATTR_FREQ_RANGE_MAX_BW
,

4002 
	mNL80211_ATTR_POWER_RULE_MAX_ANT_GAIN
,

4003 
	mNL80211_ATTR_POWER_RULE_MAX_EIRP
,

4005 
	mNL80211_ATTR_DFS_CAC_TIME
,

4008 
	m__NL80211_REG_RULE_ATTR_AFTER_LAST
,

4009 
	mNL80211_REG_RULE_ATTR_MAX
 = 
__NL80211_REG_RULE_ATTR_AFTER_LAST
 - 1

4047 
	e∆80211_sched_sˇn_m©ch_©å
 {

4048 
	m__NL80211_SCHED_SCAN_MATCH_ATTR_INVALID
,

4050 
	mNL80211_SCHED_SCAN_MATCH_ATTR_SSID
,

4051 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RSSI
,

4052 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RELATIVE_RSSI
,

4053 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RSSI_ADJUST
,

4054 
	mNL80211_SCHED_SCAN_MATCH_ATTR_BSSID
,

4055 
	mNL80211_SCHED_SCAN_MATCH_PER_BAND_RSSI
,

4058 
	m__NL80211_SCHED_SCAN_MATCH_ATTR_AFTER_LAST
,

4059 
	mNL80211_SCHED_SCAN_MATCH_ATTR_MAX
 =

4060 
__NL80211_SCHED_SCAN_MATCH_ATTR_AFTER_LAST
 - 1

4064 
	#NL80211_ATTR_SCHED_SCAN_MATCH_SSID
 
NL80211_SCHED_SCAN_MATCH_ATTR_SSID


	)

4089 
	e∆80211_ªg_ruÀ_Êags
 {

4090 
	mNL80211_RRF_NO_OFDM
 = 1<<0,

4091 
	mNL80211_RRF_NO_CCK
 = 1<<1,

4092 
	mNL80211_RRF_NO_INDOOR
 = 1<<2,

4093 
	mNL80211_RRF_NO_OUTDOOR
 = 1<<3,

4094 
	mNL80211_RRF_DFS
 = 1<<4,

4095 
	mNL80211_RRF_PTP_ONLY
 = 1<<5,

4096 
	mNL80211_RRF_PTMP_ONLY
 = 1<<6,

4097 
	mNL80211_RRF_NO_IR
 = 1<<7,

4098 
	m__NL80211_RRF_NO_IBSS
 = 1<<8,

4099 
	mNL80211_RRF_AUTO_BW
 = 1<<11,

4100 
	mNL80211_RRF_IR_CONCURRENT
 = 1<<12,

4101 
	mNL80211_RRF_NO_HT40MINUS
 = 1<<13,

4102 
	mNL80211_RRF_NO_HT40PLUS
 = 1<<14,

4103 
	mNL80211_RRF_NO_80MHZ
 = 1<<15,

4104 
	mNL80211_RRF_NO_160MHZ
 = 1<<16,

4105 
	mNL80211_RRF_NO_HE
 = 1<<17,

4108 
	#NL80211_RRF_PASSIVE_SCAN
 
NL80211_RRF_NO_IR


	)

4109 
	#NL80211_RRF_NO_IBSS
 
NL80211_RRF_NO_IR


	)

4110 
	#NL80211_RRF_NO_IR
 
NL80211_RRF_NO_IR


	)

4111 
	#NL80211_RRF_NO_HT40
 (
NL80211_RRF_NO_HT40MINUS
 |\

4112 
NL80211_RRF_NO_HT40PLUS
)

	)

4113 
	#NL80211_RRF_GO_CONCURRENT
 
NL80211_RRF_IR_CONCURRENT


	)

4116 
	#NL80211_RRF_NO_IR_ALL
 (
NL80211_RRF_NO_IR
 | 
__NL80211_RRF_NO_IBSS
)

	)

4126 
	e∆80211_dfs_ªgi⁄s
 {

4127 
	mNL80211_DFS_UNSET
 = 0,

4128 
	mNL80211_DFS_FCC
 = 1,

4129 
	mNL80211_DFS_ETSI
 = 2,

4130 
	mNL80211_DFS_JP
 = 3,

4150 
	e∆80211_u£r_ªg_höt_ty≥
 {

4151 
	mNL80211_USER_REG_HINT_USER
 = 0,

4152 
	mNL80211_USER_REG_HINT_CELL_BASE
 = 1,

4153 
	mNL80211_USER_REG_HINT_INDOOR
 = 2,

4186 
	e∆80211_survey_öfo
 {

4187 
	m__NL80211_SURVEY_INFO_INVALID
,

4188 
	mNL80211_SURVEY_INFO_FREQUENCY
,

4189 
	mNL80211_SURVEY_INFO_NOISE
,

4190 
	mNL80211_SURVEY_INFO_IN_USE
,

4191 
	mNL80211_SURVEY_INFO_TIME
,

4192 
	mNL80211_SURVEY_INFO_TIME_BUSY
,

4193 
	mNL80211_SURVEY_INFO_TIME_EXT_BUSY
,

4194 
	mNL80211_SURVEY_INFO_TIME_RX
,

4195 
	mNL80211_SURVEY_INFO_TIME_TX
,

4196 
	mNL80211_SURVEY_INFO_TIME_SCAN
,

4197 
	mNL80211_SURVEY_INFO_PAD
,

4198 
	mNL80211_SURVEY_INFO_TIME_BSS_RX
,

4199 
	mNL80211_SURVEY_INFO_FREQUENCY_OFFSET
,

4202 
	m__NL80211_SURVEY_INFO_AFTER_LAST
,

4203 
	mNL80211_SURVEY_INFO_MAX
 = 
__NL80211_SURVEY_INFO_AFTER_LAST
 - 1

4207 
	#NL80211_SURVEY_INFO_CHANNEL_TIME
 
NL80211_SURVEY_INFO_TIME


	)

4208 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_BUSY
 
NL80211_SURVEY_INFO_TIME_BUSY


	)

4209 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_EXT_BUSY
 
NL80211_SURVEY_INFO_TIME_EXT_BUSY


	)

4210 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_RX
 
NL80211_SURVEY_INFO_TIME_RX


	)

4211 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_TX
 
NL80211_SURVEY_INFO_TIME_TX


	)

4232 
	e∆80211_m¡r_Êags
 {

4233 
	m__NL80211_MNTR_FLAG_INVALID
,

4234 
	mNL80211_MNTR_FLAG_FCSFAIL
,

4235 
	mNL80211_MNTR_FLAG_PLCPFAIL
,

4236 
	mNL80211_MNTR_FLAG_CONTROL
,

4237 
	mNL80211_MNTR_FLAG_OTHER_BSS
,

4238 
	mNL80211_MNTR_FLAG_COOK_FRAMES
,

4239 
	mNL80211_MNTR_FLAG_ACTIVE
,

4242 
	m__NL80211_MNTR_FLAG_AFTER_LAST
,

4243 
	mNL80211_MNTR_FLAG_MAX
 = 
__NL80211_MNTR_FLAG_AFTER_LAST
 - 1

4264 
	e∆80211_mesh_powî_mode
 {

4265 
	mNL80211_MESH_POWER_UNKNOWN
,

4266 
	mNL80211_MESH_POWER_ACTIVE
,

4267 
	mNL80211_MESH_POWER_LIGHT_SLEEP
,

4268 
	mNL80211_MESH_POWER_DEEP_SLEEP
,

4270 
	m__NL80211_MESH_POWER_AFTER_LAST
,

4271 
	mNL80211_MESH_POWER_MAX
 = 
__NL80211_MESH_POWER_AFTER_LAST
 - 1

4397 
	e∆80211_meshc⁄f_∑øms
 {

4398 
	m__NL80211_MESHCONF_INVALID
,

4399 
	mNL80211_MESHCONF_RETRY_TIMEOUT
,

4400 
	mNL80211_MESHCONF_CONFIRM_TIMEOUT
,

4401 
	mNL80211_MESHCONF_HOLDING_TIMEOUT
,

4402 
	mNL80211_MESHCONF_MAX_PEER_LINKS
,

4403 
	mNL80211_MESHCONF_MAX_RETRIES
,

4404 
	mNL80211_MESHCONF_TTL
,

4405 
	mNL80211_MESHCONF_AUTO_OPEN_PLINKS
,

4406 
	mNL80211_MESHCONF_HWMP_MAX_PREQ_RETRIES
,

4407 
	mNL80211_MESHCONF_PATH_REFRESH_TIME
,

4408 
	mNL80211_MESHCONF_MIN_DISCOVERY_TIMEOUT
,

4409 
	mNL80211_MESHCONF_HWMP_ACTIVE_PATH_TIMEOUT
,

4410 
	mNL80211_MESHCONF_HWMP_PREQ_MIN_INTERVAL
,

4411 
	mNL80211_MESHCONF_HWMP_NET_DIAM_TRVS_TIME
,

4412 
	mNL80211_MESHCONF_HWMP_ROOTMODE
,

4413 
	mNL80211_MESHCONF_ELEMENT_TTL
,

4414 
	mNL80211_MESHCONF_HWMP_RANN_INTERVAL
,

4415 
	mNL80211_MESHCONF_GATE_ANNOUNCEMENTS
,

4416 
	mNL80211_MESHCONF_HWMP_PERR_MIN_INTERVAL
,

4417 
	mNL80211_MESHCONF_FORWARDING
,

4418 
	mNL80211_MESHCONF_RSSI_THRESHOLD
,

4419 
	mNL80211_MESHCONF_SYNC_OFFSET_MAX_NEIGHBOR
,

4420 
	mNL80211_MESHCONF_HT_OPMODE
,

4421 
	mNL80211_MESHCONF_HWMP_PATH_TO_ROOT_TIMEOUT
,

4422 
	mNL80211_MESHCONF_HWMP_ROOT_INTERVAL
,

4423 
	mNL80211_MESHCONF_HWMP_CONFIRMATION_INTERVAL
,

4424 
	mNL80211_MESHCONF_POWER_MODE
,

4425 
	mNL80211_MESHCONF_AWAKE_WINDOW
,

4426 
	mNL80211_MESHCONF_PLINK_TIMEOUT
,

4427 
	mNL80211_MESHCONF_CONNECTED_TO_GATE
,

4428 
	mNL80211_MESHCONF_NOLEARN
,

4429 
	mNL80211_MESHCONF_CONNECTED_TO_AS
,

4432 
	m__NL80211_MESHCONF_ATTR_AFTER_LAST
,

4433 
	mNL80211_MESHCONF_ATTR_MAX
 = 
__NL80211_MESHCONF_ATTR_AFTER_LAST
 - 1

4485 
	e∆80211_mesh_£tup_∑øms
 {

4486 
	m__NL80211_MESH_SETUP_INVALID
,

4487 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_PATH_SEL
,

4488 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_METRIC
,

4489 
	mNL80211_MESH_SETUP_IE
,

4490 
	mNL80211_MESH_SETUP_USERSPACE_AUTH
,

4491 
	mNL80211_MESH_SETUP_USERSPACE_AMPE
,

4492 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_SYNC
,

4493 
	mNL80211_MESH_SETUP_USERSPACE_MPM
,

4494 
	mNL80211_MESH_SETUP_AUTH_PROTOCOL
,

4497 
	m__NL80211_MESH_SETUP_ATTR_AFTER_LAST
,

4498 
	mNL80211_MESH_SETUP_ATTR_MAX
 = 
__NL80211_MESH_SETUP_ATTR_AFTER_LAST
 - 1

4515 
	e∆80211_txq_©å
 {

4516 
	m__NL80211_TXQ_ATTR_INVALID
,

4517 
	mNL80211_TXQ_ATTR_AC
,

4518 
	mNL80211_TXQ_ATTR_TXOP
,

4519 
	mNL80211_TXQ_ATTR_CWMIN
,

4520 
	mNL80211_TXQ_ATTR_CWMAX
,

4521 
	mNL80211_TXQ_ATTR_AIFS
,

4524 
	m__NL80211_TXQ_ATTR_AFTER_LAST
,

4525 
	mNL80211_TXQ_ATTR_MAX
 = 
__NL80211_TXQ_ATTR_AFTER_LAST
 - 1

4528 
	e∆80211_ac
 {

4529 
	mNL80211_AC_VO
,

4530 
	mNL80211_AC_VI
,

4531 
	mNL80211_AC_BE
,

4532 
	mNL80211_AC_BK
,

4533 
	mNL80211_NUM_ACS


4537 
	#NL80211_TXQ_ATTR_QUEUE
 
NL80211_TXQ_ATTR_AC


	)

4538 
	#NL80211_TXQ_Q_VO
 
NL80211_AC_VO


	)

4539 
	#NL80211_TXQ_Q_VI
 
NL80211_AC_VI


	)

4540 
	#NL80211_TXQ_Q_BE
 
NL80211_AC_BE


	)

4541 
	#NL80211_TXQ_Q_BK
 
NL80211_AC_BK


	)

4552 
	e∆80211_ch™√l_ty≥
 {

4553 
	mNL80211_CHAN_NO_HT
,

4554 
	mNL80211_CHAN_HT20
,

4555 
	mNL80211_CHAN_HT40MINUS
,

4556 
	mNL80211_CHAN_HT40PLUS


4574 
	e∆80211_key_mode
 {

4575 
	mNL80211_KEY_RX_TX
,

4576 
	mNL80211_KEY_NO_TX
,

4577 
	mNL80211_KEY_SET_TX


4604 
	e∆80211_ch™_width
 {

4605 
	mNL80211_CHAN_WIDTH_20_NOHT
,

4606 
	mNL80211_CHAN_WIDTH_20
,

4607 
	mNL80211_CHAN_WIDTH_40
,

4608 
	mNL80211_CHAN_WIDTH_80
,

4609 
	mNL80211_CHAN_WIDTH_80P80
,

4610 
	mNL80211_CHAN_WIDTH_160
,

4611 
	mNL80211_CHAN_WIDTH_5
,

4612 
	mNL80211_CHAN_WIDTH_10
,

4613 
	mNL80211_CHAN_WIDTH_1
,

4614 
	mNL80211_CHAN_WIDTH_2
,

4615 
	mNL80211_CHAN_WIDTH_4
,

4616 
	mNL80211_CHAN_WIDTH_8
,

4617 
	mNL80211_CHAN_WIDTH_16
,

4631 
	e∆80211_bss_sˇn_width
 {

4632 
	mNL80211_BSS_CHAN_WIDTH_20
,

4633 
	mNL80211_BSS_CHAN_WIDTH_10
,

4634 
	mNL80211_BSS_CHAN_WIDTH_5
,

4635 
	mNL80211_BSS_CHAN_WIDTH_1
,

4636 
	mNL80211_BSS_CHAN_WIDTH_2
,

4692 
	e∆80211_bss
 {

4693 
	m__NL80211_BSS_INVALID
,

4694 
	mNL80211_BSS_BSSID
,

4695 
	mNL80211_BSS_FREQUENCY
,

4696 
	mNL80211_BSS_TSF
,

4697 
	mNL80211_BSS_BEACON_INTERVAL
,

4698 
	mNL80211_BSS_CAPABILITY
,

4699 
	mNL80211_BSS_INFORMATION_ELEMENTS
,

4700 
	mNL80211_BSS_SIGNAL_MBM
,

4701 
	mNL80211_BSS_SIGNAL_UNSPEC
,

4702 
	mNL80211_BSS_STATUS
,

4703 
	mNL80211_BSS_SEEN_MS_AGO
,

4704 
	mNL80211_BSS_BEACON_IES
,

4705 
	mNL80211_BSS_CHAN_WIDTH
,

4706 
	mNL80211_BSS_BEACON_TSF
,

4707 
	mNL80211_BSS_PRESP_DATA
,

4708 
	mNL80211_BSS_LAST_SEEN_BOOTTIME
,

4709 
	mNL80211_BSS_PAD
,

4710 
	mNL80211_BSS_PARENT_TSF
,

4711 
	mNL80211_BSS_PARENT_BSSID
,

4712 
	mNL80211_BSS_CHAIN_SIGNAL
,

4713 
	mNL80211_BSS_FREQUENCY_OFFSET
,

4716 
	m__NL80211_BSS_AFTER_LAST
,

4717 
	mNL80211_BSS_MAX
 = 
__NL80211_BSS_AFTER_LAST
 - 1

4732 
	e∆80211_bss_°©us
 {

4733 
	mNL80211_BSS_STATUS_AUTHENTICATED
,

4734 
	mNL80211_BSS_STATUS_ASSOCIATED
,

4735 
	mNL80211_BSS_STATUS_IBSS_JOINED
,

4755 
	e∆80211_auth_ty≥
 {

4756 
	mNL80211_AUTHTYPE_OPEN_SYSTEM
,

4757 
	mNL80211_AUTHTYPE_SHARED_KEY
,

4758 
	mNL80211_AUTHTYPE_FT
,

4759 
	mNL80211_AUTHTYPE_NETWORK_EAP
,

4760 
	mNL80211_AUTHTYPE_SAE
,

4761 
	mNL80211_AUTHTYPE_FILS_SK
,

4762 
	mNL80211_AUTHTYPE_FILS_SK_PFS
,

4763 
	mNL80211_AUTHTYPE_FILS_PK
,

4766 
	m__NL80211_AUTHTYPE_NUM
,

4767 
	mNL80211_AUTHTYPE_MAX
 = 
__NL80211_AUTHTYPE_NUM
 - 1,

4768 
	mNL80211_AUTHTYPE_AUTOMATIC


4778 
	e∆80211_key_ty≥
 {

4779 
	mNL80211_KEYTYPE_GROUP
,

4780 
	mNL80211_KEYTYPE_PAIRWISE
,

4781 
	mNL80211_KEYTYPE_PEERKEY
,

4783 
	mNUM_NL80211_KEYTYPES


4792 
	e∆80211_mÂ
 {

4793 
	mNL80211_MFP_NO
,

4794 
	mNL80211_MFP_REQUIRED
,

4795 
	mNL80211_MFP_OPTIONAL
,

4798 
	e∆80211_w∑_vîsi⁄s
 {

4799 
	mNL80211_WPA_VERSION_1
 = 1 << 0,

4800 
	mNL80211_WPA_VERSION_2
 = 1 << 1,

4801 
	mNL80211_WPA_VERSION_3
 = 1 << 2,

4813 
	e∆80211_key_deÁu…_ty≥s
 {

4814 
	m__NL80211_KEY_DEFAULT_TYPE_INVALID
,

4815 
	mNL80211_KEY_DEFAULT_TYPE_UNICAST
,

4816 
	mNL80211_KEY_DEFAULT_TYPE_MULTICAST
,

4818 
	mNUM_NL80211_KEY_DEFAULT_TYPES


4847 
	e∆80211_key_©åibuãs
 {

4848 
	m__NL80211_KEY_INVALID
,

4849 
	mNL80211_KEY_DATA
,

4850 
	mNL80211_KEY_IDX
,

4851 
	mNL80211_KEY_CIPHER
,

4852 
	mNL80211_KEY_SEQ
,

4853 
	mNL80211_KEY_DEFAULT
,

4854 
	mNL80211_KEY_DEFAULT_MGMT
,

4855 
	mNL80211_KEY_TYPE
,

4856 
	mNL80211_KEY_DEFAULT_TYPES
,

4857 
	mNL80211_KEY_MODE
,

4858 
	mNL80211_KEY_DEFAULT_BEACON
,

4861 
	m__NL80211_KEY_AFTER_LAST
,

4862 
	mNL80211_KEY_MAX
 = 
__NL80211_KEY_AFTER_LAST
 - 1

4884 
	e∆80211_tx_øã_©åibuãs
 {

4885 
	m__NL80211_TXRATE_INVALID
,

4886 
	mNL80211_TXRATE_LEGACY
,

4887 
	mNL80211_TXRATE_HT
,

4888 
	mNL80211_TXRATE_VHT
,

4889 
	mNL80211_TXRATE_GI
,

4890 
	mNL80211_TXRATE_HE
,

4891 
	mNL80211_TXRATE_HE_GI
,

4892 
	mNL80211_TXRATE_HE_LTF
,

4895 
	m__NL80211_TXRATE_AFTER_LAST
,

4896 
	mNL80211_TXRATE_MAX
 = 
__NL80211_TXRATE_AFTER_LAST
 - 1

4899 
	#NL80211_TXRATE_MCS
 
NL80211_TXRATE_HT


	)

4900 
	#NL80211_VHT_NSS_MAX
 8

	)

4906 
	s∆80211_txøã_vht
 {

4907 
__u16
 
	mmcs
[
NL80211_VHT_NSS_MAX
];

4910 
	#NL80211_HE_NSS_MAX
 8

	)

4915 
	s∆80211_txøã_he
 {

4916 
__u16
 
	mmcs
[
NL80211_HE_NSS_MAX
];

4919 
	e∆80211_txøã_gi
 {

4920 
	mNL80211_TXRATE_DEFAULT_GI
,

4921 
	mNL80211_TXRATE_FORCE_SGI
,

4922 
	mNL80211_TXRATE_FORCE_LGI
,

4935 
	e∆80211_b™d
 {

4936 
	mNL80211_BAND_2GHZ
,

4937 
	mNL80211_BAND_5GHZ
,

4938 
	mNL80211_BAND_60GHZ
,

4939 
	mNL80211_BAND_6GHZ
,

4940 
	mNL80211_BAND_S1GHZ
,

4942 
	mNUM_NL80211_BANDS
,

4950 
	e∆80211_ps_°©e
 {

4951 
	mNL80211_PS_DISABLED
,

4952 
	mNL80211_PS_ENABLED
,

4988 
	e∆80211_©å_cqm
 {

4989 
	m__NL80211_ATTR_CQM_INVALID
,

4990 
	mNL80211_ATTR_CQM_RSSI_THOLD
,

4991 
	mNL80211_ATTR_CQM_RSSI_HYST
,

4992 
	mNL80211_ATTR_CQM_RSSI_THRESHOLD_EVENT
,

4993 
	mNL80211_ATTR_CQM_PKT_LOSS_EVENT
,

4994 
	mNL80211_ATTR_CQM_TXE_RATE
,

4995 
	mNL80211_ATTR_CQM_TXE_PKTS
,

4996 
	mNL80211_ATTR_CQM_TXE_INTVL
,

4997 
	mNL80211_ATTR_CQM_BEACON_LOSS_EVENT
,

4998 
	mNL80211_ATTR_CQM_RSSI_LEVEL
,

5001 
	m__NL80211_ATTR_CQM_AFTER_LAST
,

5002 
	mNL80211_ATTR_CQM_MAX
 = 
__NL80211_ATTR_CQM_AFTER_LAST
 - 1

5013 
	e∆80211_cqm_rssi_thªshﬁd_evít
 {

5014 
	mNL80211_CQM_RSSI_THRESHOLD_EVENT_LOW
,

5015 
	mNL80211_CQM_RSSI_THRESHOLD_EVENT_HIGH
,

5016 
	mNL80211_CQM_RSSI_BEACON_LOSS_EVENT
,

5026 
	e∆80211_tx_powî_£âög
 {

5027 
	mNL80211_TX_POWER_AUTOMATIC
,

5028 
	mNL80211_TX_POWER_LIMITED
,

5029 
	mNL80211_TX_POWER_FIXED
,

5037 
	e∆80211_tid_c⁄fig
 {

5038 
	mNL80211_TID_CONFIG_ENABLE
,

5039 
	mNL80211_TID_CONFIG_DISABLE
,

5047 
	e∆80211_tx_øã_£âög
 {

5048 
	mNL80211_TX_RATE_AUTOMATIC
,

5049 
	mNL80211_TX_RATE_LIMITED
,

5050 
	mNL80211_TX_RATE_FIXED
,

5097 
	e∆80211_tid_c⁄fig_©å
 {

5098 
	m__NL80211_TID_CONFIG_ATTR_INVALID
,

5099 
	mNL80211_TID_CONFIG_ATTR_PAD
,

5100 
	mNL80211_TID_CONFIG_ATTR_VIF_SUPP
,

5101 
	mNL80211_TID_CONFIG_ATTR_PEER_SUPP
,

5102 
	mNL80211_TID_CONFIG_ATTR_OVERRIDE
,

5103 
	mNL80211_TID_CONFIG_ATTR_TIDS
,

5104 
	mNL80211_TID_CONFIG_ATTR_NOACK
,

5105 
	mNL80211_TID_CONFIG_ATTR_RETRY_SHORT
,

5106 
	mNL80211_TID_CONFIG_ATTR_RETRY_LONG
,

5107 
	mNL80211_TID_CONFIG_ATTR_AMPDU_CTRL
,

5108 
	mNL80211_TID_CONFIG_ATTR_RTSCTS_CTRL
,

5109 
	mNL80211_TID_CONFIG_ATTR_AMSDU_CTRL
,

5110 
	mNL80211_TID_CONFIG_ATTR_TX_RATE_TYPE
,

5111 
	mNL80211_TID_CONFIG_ATTR_TX_RATE
,

5114 
	m__NL80211_TID_CONFIG_ATTR_AFTER_LAST
,

5115 
	mNL80211_TID_CONFIG_ATTR_MAX
 = 
__NL80211_TID_CONFIG_ATTR_AFTER_LAST
 - 1

5139 
	e∆80211_∑ckë_∑âîn_©å
 {

5140 
	m__NL80211_PKTPAT_INVALID
,

5141 
	mNL80211_PKTPAT_MASK
,

5142 
	mNL80211_PKTPAT_PATTERN
,

5143 
	mNL80211_PKTPAT_OFFSET
,

5145 
	mNUM_NL80211_PKTPAT
,

5146 
	mMAX_NL80211_PKTPAT
 = 
NUM_NL80211_PKTPAT
 - 1,

5162 
	s∆80211_∑âîn_suµ‹t
 {

5163 
__u32
 
	mmax_∑âîns
;

5164 
__u32
 
	mmö_∑âîn_Àn
;

5165 
__u32
 
	mmax_∑âîn_Àn
;

5166 
__u32
 
	mmax_pkt_off£t
;

5167 } 
__©åibuã__
((
∑cked
));

5170 
	#__NL80211_WOWLAN_PKTPAT_INVALID
 
__NL80211_PKTPAT_INVALID


	)

5171 
	#NL80211_WOWLAN_PKTPAT_MASK
 
NL80211_PKTPAT_MASK


	)

5172 
	#NL80211_WOWLAN_PKTPAT_PATTERN
 
NL80211_PKTPAT_PATTERN


	)

5173 
	#NL80211_WOWLAN_PKTPAT_OFFSET
 
NL80211_PKTPAT_OFFSET


	)

5174 
	#NUM_NL80211_WOWLAN_PKTPAT
 
NUM_NL80211_PKTPAT


	)

5175 
	#MAX_NL80211_WOWLAN_PKTPAT
 
MAX_NL80211_PKTPAT


	)

5176 
	#∆80211_wowœn_∑âîn_suµ‹t
 
∆80211_∑âîn_suµ‹t


	)

5267 
	e∆80211_wowœn_åiggîs
 {

5268 
	m__NL80211_WOWLAN_TRIG_INVALID
,

5269 
	mNL80211_WOWLAN_TRIG_ANY
,

5270 
	mNL80211_WOWLAN_TRIG_DISCONNECT
,

5271 
	mNL80211_WOWLAN_TRIG_MAGIC_PKT
,

5272 
	mNL80211_WOWLAN_TRIG_PKT_PATTERN
,

5273 
	mNL80211_WOWLAN_TRIG_GTK_REKEY_SUPPORTED
,

5274 
	mNL80211_WOWLAN_TRIG_GTK_REKEY_FAILURE
,

5275 
	mNL80211_WOWLAN_TRIG_EAP_IDENT_REQUEST
,

5276 
	mNL80211_WOWLAN_TRIG_4WAY_HANDSHAKE
,

5277 
	mNL80211_WOWLAN_TRIG_RFKILL_RELEASE
,

5278 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_80211
,

5279 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_80211_LEN
,

5280 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_8023
,

5281 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_8023_LEN
,

5282 
	mNL80211_WOWLAN_TRIG_TCP_CONNECTION
,

5283 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_MATCH
,

5284 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_CONNLOST
,

5285 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_NOMORETOKENS
,

5286 
	mNL80211_WOWLAN_TRIG_NET_DETECT
,

5287 
	mNL80211_WOWLAN_TRIG_NET_DETECT_RESULTS
,

5290 
	mNUM_NL80211_WOWLAN_TRIG
,

5291 
	mMAX_NL80211_WOWLAN_TRIG
 = 
NUM_NL80211_WOWLAN_TRIG
 - 1

5327 
	s∆80211_wowœn_t˝_d©a_£q
 {

5328 
__u32
 
	m°¨t
, 
	moff£t
, 
	mÀn
;

5338 
	s∆80211_wowœn_t˝_d©a_tokí
 {

5339 
__u32
 
	moff£t
, 
	mÀn
;

5340 
__u8
 
	mtokí_°ªam
[];

5349 
	s∆80211_wowœn_t˝_d©a_tokí_„©uª
 {

5350 
__u32
 
	mmö_Àn
, 
	mmax_Àn
, 
	mbufsize
;

5385 
	e∆80211_wowœn_t˝_©ås
 {

5386 
	m__NL80211_WOWLAN_TCP_INVALID
,

5387 
	mNL80211_WOWLAN_TCP_SRC_IPV4
,

5388 
	mNL80211_WOWLAN_TCP_DST_IPV4
,

5389 
	mNL80211_WOWLAN_TCP_DST_MAC
,

5390 
	mNL80211_WOWLAN_TCP_SRC_PORT
,

5391 
	mNL80211_WOWLAN_TCP_DST_PORT
,

5392 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD
,

5393 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD_SEQ
,

5394 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD_TOKEN
,

5395 
	mNL80211_WOWLAN_TCP_DATA_INTERVAL
,

5396 
	mNL80211_WOWLAN_TCP_WAKE_PAYLOAD
,

5397 
	mNL80211_WOWLAN_TCP_WAKE_MASK
,

5400 
	mNUM_NL80211_WOWLAN_TCP
,

5401 
	mMAX_NL80211_WOWLAN_TCP
 = 
NUM_NL80211_WOWLAN_TCP
 - 1

5413 
	s∆80211_cﬂÀs˚_ruÀ_suµ‹t
 {

5414 
__u32
 
	mmax_ruÀs
;

5415 
∆80211_∑âîn_suµ‹t
 
	m∑t
;

5416 
__u32
 
	mmax_dñay
;

5417 } 
__©åibuã__
((
∑cked
));

5430 
	e∆80211_©å_cﬂÀs˚_ruÀ
 {

5431 
	m__NL80211_COALESCE_RULE_INVALID
,

5432 
	mNL80211_ATTR_COALESCE_RULE_DELAY
,

5433 
	mNL80211_ATTR_COALESCE_RULE_CONDITION
,

5434 
	mNL80211_ATTR_COALESCE_RULE_PKT_PATTERN
,

5437 
	mNUM_NL80211_ATTR_COALESCE_RULE
,

5438 
	mNL80211_ATTR_COALESCE_RULE_MAX
 = 
NUM_NL80211_ATTR_COALESCE_RULE
 - 1

5448 
	e∆80211_cﬂÀs˚_c⁄dôi⁄
 {

5449 
	mNL80211_COALESCE_CONDITION_MATCH
,

5450 
	mNL80211_COALESCE_CONDITION_NO_MATCH


5463 
	e∆80211_iÁ˚_limô_©ås
 {

5464 
	mNL80211_IFACE_LIMIT_UNSPEC
,

5465 
	mNL80211_IFACE_LIMIT_MAX
,

5466 
	mNL80211_IFACE_LIMIT_TYPES
,

5469 
	mNUM_NL80211_IFACE_LIMIT
,

5470 
	mMAX_NL80211_IFACE_LIMIT
 = 
NUM_NL80211_IFACE_LIMIT
 - 1

5522 
	e∆80211_if_combö©i⁄_©ås
 {

5523 
	mNL80211_IFACE_COMB_UNSPEC
,

5524 
	mNL80211_IFACE_COMB_LIMITS
,

5525 
	mNL80211_IFACE_COMB_MAXNUM
,

5526 
	mNL80211_IFACE_COMB_STA_AP_BI_MATCH
,

5527 
	mNL80211_IFACE_COMB_NUM_CHANNELS
,

5528 
	mNL80211_IFACE_COMB_RADAR_DETECT_WIDTHS
,

5529 
	mNL80211_IFACE_COMB_RADAR_DETECT_REGIONS
,

5530 
	mNL80211_IFACE_COMB_BI_MIN_GCD
,

5533 
	mNUM_NL80211_IFACE_COMB
,

5534 
	mMAX_NL80211_IFACE_COMB
 = 
NUM_NL80211_IFACE_COMB
 - 1

5556 
	e∆80211_∂ök_°©e
 {

5557 
	mNL80211_PLINK_LISTEN
,

5558 
	mNL80211_PLINK_OPN_SNT
,

5559 
	mNL80211_PLINK_OPN_RCVD
,

5560 
	mNL80211_PLINK_CNF_RCVD
,

5561 
	mNL80211_PLINK_ESTAB
,

5562 
	mNL80211_PLINK_HOLDING
,

5563 
	mNL80211_PLINK_BLOCKED
,

5566 
	mNUM_NL80211_PLINK_STATES
,

5567 
	mMAX_NL80211_PLINK_STATES
 = 
NUM_NL80211_PLINK_STATES
 - 1

5578 
	e∂ök_a˘i⁄s
 {

5579 
	mNL80211_PLINK_ACTION_NO_ACTION
,

5580 
	mNL80211_PLINK_ACTION_OPEN
,

5581 
	mNL80211_PLINK_ACTION_BLOCK
,

5583 
	mNUM_NL80211_PLINK_ACTIONS
,

5587 
	#NL80211_KCK_LEN
 16

	)

5588 
	#NL80211_KEK_LEN
 16

	)

5589 
	#NL80211_KCK_EXT_LEN
 24

	)

5590 
	#NL80211_KEK_EXT_LEN
 32

	)

5591 
	#NL80211_REPLAY_CTR_LEN
 8

	)

5603 
	e∆80211_ªkey_d©a
 {

5604 
	m__NL80211_REKEY_DATA_INVALID
,

5605 
	mNL80211_REKEY_DATA_KEK
,

5606 
	mNL80211_REKEY_DATA_KCK
,

5607 
	mNL80211_REKEY_DATA_REPLAY_CTR
,

5608 
	mNL80211_REKEY_DATA_AKM
,

5611 
	mNUM_NL80211_REKEY_DATA
,

5612 
	mMAX_NL80211_REKEY_DATA
 = 
NUM_NL80211_REKEY_DATA
 - 1

5624 
	e∆80211_hiddí_ssid
 {

5625 
	mNL80211_HIDDEN_SSID_NOT_IN_USE
,

5626 
	mNL80211_HIDDEN_SSID_ZERO_LEN
,

5627 
	mNL80211_HIDDEN_SSID_ZERO_CONTENTS


5640 
	e∆80211_°a_wme_©å
 {

5641 
	m__NL80211_STA_WME_INVALID
,

5642 
	mNL80211_STA_WME_UAPSD_QUEUES
,

5643 
	mNL80211_STA_WME_MAX_SP
,

5646 
	m__NL80211_STA_WME_AFTER_LAST
,

5647 
	mNL80211_STA_WME_MAX
 = 
__NL80211_STA_WME_AFTER_LAST
 - 1

5662 
	e∆80211_pmkß_ˇndid©e_©å
 {

5663 
	m__NL80211_PMKSA_CANDIDATE_INVALID
,

5664 
	mNL80211_PMKSA_CANDIDATE_INDEX
,

5665 
	mNL80211_PMKSA_CANDIDATE_BSSID
,

5666 
	mNL80211_PMKSA_CANDIDATE_PREAUTH
,

5669 
	mNUM_NL80211_PMKSA_CANDIDATE
,

5670 
	mMAX_NL80211_PMKSA_CANDIDATE
 = 
NUM_NL80211_PMKSA_CANDIDATE
 - 1

5681 
	e∆80211_tdls_›î©i⁄
 {

5682 
	mNL80211_TDLS_DISCOVERY_REQ
,

5683 
	mNL80211_TDLS_SETUP
,

5684 
	mNL80211_TDLS_TEARDOWN
,

5685 
	mNL80211_TDLS_ENABLE_LINK
,

5686 
	mNL80211_TDLS_DISABLE_LINK
,

5790 
	e∆80211_„©uª_Êags
 {

5791 
	mNL80211_FEATURE_SK_TX_STATUS
 = 1 << 0,

5792 
	mNL80211_FEATURE_HT_IBSS
 = 1 << 1,

5793 
	mNL80211_FEATURE_INACTIVITY_TIMER
 = 1 << 2,

5794 
	mNL80211_FEATURE_CELL_BASE_REG_HINTS
 = 1 << 3,

5795 
	mNL80211_FEATURE_P2P_DEVICE_NEEDS_CHANNEL
 = 1 << 4,

5796 
	mNL80211_FEATURE_SAE
 = 1 << 5,

5797 
	mNL80211_FEATURE_LOW_PRIORITY_SCAN
 = 1 << 6,

5798 
	mNL80211_FEATURE_SCAN_FLUSH
 = 1 << 7,

5799 
	mNL80211_FEATURE_AP_SCAN
 = 1 << 8,

5800 
	mNL80211_FEATURE_VIF_TXPOWER
 = 1 << 9,

5801 
	mNL80211_FEATURE_NEED_OBSS_SCAN
 = 1 << 10,

5802 
	mNL80211_FEATURE_P2P_GO_CTWIN
 = 1 << 11,

5803 
	mNL80211_FEATURE_P2P_GO_OPPPS
 = 1 << 12,

5805 
	mNL80211_FEATURE_ADVERTISE_CHAN_LIMITS
 = 1 << 14,

5806 
	mNL80211_FEATURE_FULL_AP_CLIENT_STATE
 = 1 << 15,

5807 
	mNL80211_FEATURE_USERSPACE_MPM
 = 1 << 16,

5808 
	mNL80211_FEATURE_ACTIVE_MONITOR
 = 1 << 17,

5809 
	mNL80211_FEATURE_AP_MODE_CHAN_WIDTH_CHANGE
 = 1 << 18,

5810 
	mNL80211_FEATURE_DS_PARAM_SET_IE_IN_PROBES
 = 1 << 19,

5811 
	mNL80211_FEATURE_WFA_TPC_IE_IN_PROBES
 = 1 << 20,

5812 
	mNL80211_FEATURE_QUIET
 = 1 << 21,

5813 
	mNL80211_FEATURE_TX_POWER_INSERTION
 = 1 << 22,

5814 
	mNL80211_FEATURE_ACKTO_ESTIMATION
 = 1 << 23,

5815 
	mNL80211_FEATURE_STATIC_SMPS
 = 1 << 24,

5816 
	mNL80211_FEATURE_DYNAMIC_SMPS
 = 1 << 25,

5817 
	mNL80211_FEATURE_SUPPORTS_WMM_ADMISSION
 = 1 << 26,

5818 
	mNL80211_FEATURE_MAC_ON_CREATE
 = 1 << 27,

5819 
	mNL80211_FEATURE_TDLS_CHANNEL_SWITCH
 = 1 << 28,

5820 
	mNL80211_FEATURE_SCAN_RANDOM_MAC_ADDR
 = 1 << 29,

5821 
	mNL80211_FEATURE_SCHED_SCAN_RANDOM_MAC_ADDR
 = 1 << 30,

5822 
	mNL80211_FEATURE_ND_RANDOM_MAC_ADDR
 = 1U << 31,

6001 
	e∆80211_ext_„©uª_ödex
 {

6002 
	mNL80211_EXT_FEATURE_VHT_IBSS
,

6003 
	mNL80211_EXT_FEATURE_RRM
,

6004 
	mNL80211_EXT_FEATURE_MU_MIMO_AIR_SNIFFER
,

6005 
	mNL80211_EXT_FEATURE_SCAN_START_TIME
,

6006 
	mNL80211_EXT_FEATURE_BSS_PARENT_TSF
,

6007 
	mNL80211_EXT_FEATURE_SET_SCAN_DWELL
,

6008 
	mNL80211_EXT_FEATURE_BEACON_RATE_LEGACY
,

6009 
	mNL80211_EXT_FEATURE_BEACON_RATE_HT
,

6010 
	mNL80211_EXT_FEATURE_BEACON_RATE_VHT
,

6011 
	mNL80211_EXT_FEATURE_FILS_STA
,

6012 
	mNL80211_EXT_FEATURE_MGMT_TX_RANDOM_TA
,

6013 
	mNL80211_EXT_FEATURE_MGMT_TX_RANDOM_TA_CONNECTED
,

6014 
	mNL80211_EXT_FEATURE_SCHED_SCAN_RELATIVE_RSSI
,

6015 
	mNL80211_EXT_FEATURE_CQM_RSSI_LIST
,

6016 
	mNL80211_EXT_FEATURE_FILS_SK_OFFLOAD
,

6017 
	mNL80211_EXT_FEATURE_4WAY_HANDSHAKE_STA_PSK
,

6018 
	mNL80211_EXT_FEATURE_4WAY_HANDSHAKE_STA_1X
,

6019 
	mNL80211_EXT_FEATURE_FILS_MAX_CHANNEL_TIME
,

6020 
	mNL80211_EXT_FEATURE_ACCEPT_BCAST_PROBE_RESP
,

6021 
	mNL80211_EXT_FEATURE_OCE_PROBE_REQ_HIGH_TX_RATE
,

6022 
	mNL80211_EXT_FEATURE_OCE_PROBE_REQ_DEFERRAL_SUPPRESSION
,

6023 
	mNL80211_EXT_FEATURE_MFP_OPTIONAL
,

6024 
	mNL80211_EXT_FEATURE_LOW_SPAN_SCAN
,

6025 
	mNL80211_EXT_FEATURE_LOW_POWER_SCAN
,

6026 
	mNL80211_EXT_FEATURE_HIGH_ACCURACY_SCAN
,

6027 
	mNL80211_EXT_FEATURE_DFS_OFFLOAD
,

6028 
	mNL80211_EXT_FEATURE_CONTROL_PORT_OVER_NL80211
,

6029 
	mNL80211_EXT_FEATURE_ACK_SIGNAL_SUPPORT
,

6031 
	mNL80211_EXT_FEATURE_DATA_ACK_SIGNAL_SUPPORT
 = 
NL80211_EXT_FEATURE_ACK_SIGNAL_SUPPORT
,

6032 
	mNL80211_EXT_FEATURE_TXQS
,

6033 
	mNL80211_EXT_FEATURE_SCAN_RANDOM_SN
,

6034 
	mNL80211_EXT_FEATURE_SCAN_MIN_PREQ_CONTENT
,

6035 
	mNL80211_EXT_FEATURE_CAN_REPLACE_PTK0
,

6036 
	mNL80211_EXT_FEATURE_ENABLE_FTM_RESPONDER
,

6037 
	mNL80211_EXT_FEATURE_AIRTIME_FAIRNESS
,

6038 
	mNL80211_EXT_FEATURE_AP_PMKSA_CACHING
,

6039 
	mNL80211_EXT_FEATURE_SCHED_SCAN_BAND_SPECIFIC_RSSI_THOLD
,

6040 
	mNL80211_EXT_FEATURE_EXT_KEY_ID
,

6041 
	mNL80211_EXT_FEATURE_STA_TX_PWR
,

6042 
	mNL80211_EXT_FEATURE_SAE_OFFLOAD
,

6043 
	mNL80211_EXT_FEATURE_VLAN_OFFLOAD
,

6044 
	mNL80211_EXT_FEATURE_AQL
,

6045 
	mNL80211_EXT_FEATURE_BEACON_PROTECTION
,

6046 
	mNL80211_EXT_FEATURE_CONTROL_PORT_NO_PREAUTH
,

6047 
	mNL80211_EXT_FEATURE_PROTECTED_TWT
,

6048 
	mNL80211_EXT_FEATURE_DEL_IBSS_STA
,

6049 
	mNL80211_EXT_FEATURE_MULTICAST_REGISTRATIONS
,

6050 
	mNL80211_EXT_FEATURE_BEACON_PROTECTION_CLIENT
,

6051 
	mNL80211_EXT_FEATURE_SCAN_FREQ_KHZ
,

6052 
	mNL80211_EXT_FEATURE_CONTROL_PORT_OVER_NL80211_TX_STATUS
,

6053 
	mNL80211_EXT_FEATURE_OPERATING_CHANNEL_VALIDATION
,

6054 
	mNL80211_EXT_FEATURE_4WAY_HANDSHAKE_AP_PSK
,

6055 
	mNL80211_EXT_FEATURE_SAE_OFFLOAD_AP
,

6056 
	mNL80211_EXT_FEATURE_FILS_DISCOVERY
,

6057 
	mNL80211_EXT_FEATURE_UNSOL_BCAST_PROBE_RESP
,

6058 
	mNL80211_EXT_FEATURE_BEACON_RATE_HE
,

6059 
	mNL80211_EXT_FEATURE_SECURE_LTF
,

6060 
	mNL80211_EXT_FEATURE_SECURE_RTT
,

6061 
	mNL80211_EXT_FEATURE_PROT_RANGE_NEGO_AND_MEASURE
,

6062 
	mNL80211_EXT_FEATURE_BSS_COLOR
,

6065 
	mNUM_NL80211_EXT_FEATURES
,

6066 
	mMAX_NL80211_EXT_FEATURES
 = 
NUM_NL80211_EXT_FEATURES
 - 1

6083 
	e∆80211_¥obe_ª•_ofÊﬂd_suµ‹t_©å
 {

6084 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS
 = 1<<0,

6085 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS2
 = 1<<1,

6086 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_P2P
 = 1<<2,

6087 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_80211U
 = 1<<3,

6096 
	e∆80211_c⁄√˘_Áûed_ªas⁄
 {

6097 
	mNL80211_CONN_FAIL_MAX_CLIENTS
,

6098 
	mNL80211_CONN_FAIL_BLOCKED_CLIENT
,

6109 
	e∆80211_timeout_ªas⁄
 {

6110 
	mNL80211_TIMEOUT_UNSPECIFIED
,

6111 
	mNL80211_TIMEOUT_SCAN
,

6112 
	mNL80211_TIMEOUT_AUTH
,

6113 
	mNL80211_TIMEOUT_ASSOC
,

6180 
	e∆80211_sˇn_Êags
 {

6181 
	mNL80211_SCAN_FLAG_LOW_PRIORITY
 = 1<<0,

6182 
	mNL80211_SCAN_FLAG_FLUSH
 = 1<<1,

6183 
	mNL80211_SCAN_FLAG_AP
 = 1<<2,

6184 
	mNL80211_SCAN_FLAG_RANDOM_ADDR
 = 1<<3,

6185 
	mNL80211_SCAN_FLAG_FILS_MAX_CHANNEL_TIME
 = 1<<4,

6186 
	mNL80211_SCAN_FLAG_ACCEPT_BCAST_PROBE_RESP
 = 1<<5,

6187 
	mNL80211_SCAN_FLAG_OCE_PROBE_REQ_HIGH_TX_RATE
 = 1<<6,

6188 
	mNL80211_SCAN_FLAG_OCE_PROBE_REQ_DEFERRAL_SUPPRESSION
 = 1<<7,

6189 
	mNL80211_SCAN_FLAG_LOW_SPAN
 = 1<<8,

6190 
	mNL80211_SCAN_FLAG_LOW_POWER
 = 1<<9,

6191 
	mNL80211_SCAN_FLAG_HIGH_ACCURACY
 = 1<<10,

6192 
	mNL80211_SCAN_FLAG_RANDOM_SN
 = 1<<11,

6193 
	mNL80211_SCAN_FLAG_MIN_PREQ_CONTENT
 = 1<<12,

6194 
	mNL80211_SCAN_FLAG_FREQ_KHZ
 = 1<<13,

6195 
	mNL80211_SCAN_FLAG_COLOCATED_6GHZ
 = 1<<14,

6211 
	e∆80211_a˛_pﬁicy
 {

6212 
	mNL80211_ACL_POLICY_ACCEPT_UNLESS_LISTED
,

6213 
	mNL80211_ACL_POLICY_DENY_UNLESS_LISTED
,

6226 
	e∆80211_smps_mode
 {

6227 
	mNL80211_SMPS_OFF
,

6228 
	mNL80211_SMPS_STATIC
,

6229 
	mNL80211_SMPS_DYNAMIC
,

6231 
	m__NL80211_SMPS_AFTER_LAST
,

6232 
	mNL80211_SMPS_MAX
 = 
__NL80211_SMPS_AFTER_LAST
 - 1

6256 
	e∆80211_ød¨_evít
 {

6257 
	mNL80211_RADAR_DETECTED
,

6258 
	mNL80211_RADAR_CAC_FINISHED
,

6259 
	mNL80211_RADAR_CAC_ABORTED
,

6260 
	mNL80211_RADAR_NOP_FINISHED
,

6261 
	mNL80211_RADAR_PRE_CAC_EXPIRED
,

6262 
	mNL80211_RADAR_CAC_STARTED
,

6276 
	e∆80211_dfs_°©e
 {

6277 
	mNL80211_DFS_USABLE
,

6278 
	mNL80211_DFS_UNAVAILABLE
,

6279 
	mNL80211_DFS_AVAILABLE
,

6290 
	e∆80211_¥Ÿocﬁ_„©uªs
 {

6291 
	mNL80211_PROTOCOL_FEATURE_SPLIT_WIPHY_DUMP
 = 1 << 0,

6303 
	e∆80211_¸ô_¥Ÿo_id
 {

6304 
	mNL80211_CRIT_PROTO_UNSPEC
,

6305 
	mNL80211_CRIT_PROTO_DHCP
,

6306 
	mNL80211_CRIT_PROTO_EAPOL
,

6307 
	mNL80211_CRIT_PROTO_APIPA
,

6309 
	mNUM_NL80211_CRIT_PROTO


6313 
	#NL80211_CRIT_PROTO_MAX_DURATION
 5000

	)

6326 
	e∆80211_rxmgmt_Êags
 {

6327 
	mNL80211_RXMGMT_FLAG_ANSWERED
 = 1 << 0,

6328 
	mNL80211_RXMGMT_FLAG_EXTERNAL_AUTH
 = 1 << 1,

6336 
	#NL80211_VENDOR_ID_IS_LINUX
 0x80000000

	)

6346 
	s∆80211_víd‹_cmd_öfo
 {

6347 
__u32
 
	mvíd‹_id
;

6348 
__u32
 
	msubcmd
;

6362 
	e∆80211_tdls_≥î_ˇ∑bûôy
 {

6363 
	mNL80211_TDLS_PEER_HT
 = 1<<0,

6364 
	mNL80211_TDLS_PEER_VHT
 = 1<<1,

6365 
	mNL80211_TDLS_PEER_WMM
 = 1<<2,

6366 
	mNL80211_TDLS_PEER_HE
 = 1<<3,

6382 
	e∆80211_sched_sˇn_∂™
 {

6383 
	m__NL80211_SCHED_SCAN_PLAN_INVALID
,

6384 
	mNL80211_SCHED_SCAN_PLAN_INTERVAL
,

6385 
	mNL80211_SCHED_SCAN_PLAN_ITERATIONS
,

6388 
	m__NL80211_SCHED_SCAN_PLAN_AFTER_LAST
,

6389 
	mNL80211_SCHED_SCAN_PLAN_MAX
 =

6390 
__NL80211_SCHED_SCAN_PLAN_AFTER_LAST
 - 1

6400 
	s∆80211_bss_£À˘_rssi_adju°
 {

6401 
__u8
 
	mb™d
;

6402 
__s8
 
	mdñè
;

6403 } 
__©åibuã__
((
∑cked
));

6427 
	e∆80211_bss_£À˘_©å
 {

6428 
	m__NL80211_BSS_SELECT_ATTR_INVALID
,

6429 
	mNL80211_BSS_SELECT_ATTR_RSSI
,

6430 
	mNL80211_BSS_SELECT_ATTR_BAND_PREF
,

6431 
	mNL80211_BSS_SELECT_ATTR_RSSI_ADJUST
,

6434 
	m__NL80211_BSS_SELECT_ATTR_AFTER_LAST
,

6435 
	mNL80211_BSS_SELECT_ATTR_MAX
 = 
__NL80211_BSS_SELECT_ATTR_AFTER_LAST
 - 1

6447 
	e∆80211_«n_fun˘i⁄_ty≥
 {

6448 
	mNL80211_NAN_FUNC_PUBLISH
,

6449 
	mNL80211_NAN_FUNC_SUBSCRIBE
,

6450 
	mNL80211_NAN_FUNC_FOLLOW_UP
,

6453 
	m__NL80211_NAN_FUNC_TYPE_AFTER_LAST
,

6454 
	mNL80211_NAN_FUNC_MAX_TYPE
 = 
__NL80211_NAN_FUNC_TYPE_AFTER_LAST
 - 1,

6465 
	e∆80211_«n_publish_ty≥
 {

6466 
	mNL80211_NAN_SOLICITED_PUBLISH
 = 1 << 0,

6467 
	mNL80211_NAN_UNSOLICITED_PUBLISH
 = 1 << 1,

6479 
	e∆80211_«n_func_ãrm_ªas⁄
 {

6480 
	mNL80211_NAN_FUNC_TERM_REASON_USER_REQUEST
,

6481 
	mNL80211_NAN_FUNC_TERM_REASON_TTL_EXPIRED
,

6482 
	mNL80211_NAN_FUNC_TERM_REASON_ERROR
,

6485 
	#NL80211_NAN_FUNC_SERVICE_ID_LEN
 6

	)

6486 
	#NL80211_NAN_FUNC_SERVICE_SPEC_INFO_MAX_LEN
 0xff

	)

6487 
	#NL80211_NAN_FUNC_SRF_MAX_LEN
 0xff

	)

6531 
	e∆80211_«n_func_©åibuãs
 {

6532 
	m__NL80211_NAN_FUNC_INVALID
,

6533 
	mNL80211_NAN_FUNC_TYPE
,

6534 
	mNL80211_NAN_FUNC_SERVICE_ID
,

6535 
	mNL80211_NAN_FUNC_PUBLISH_TYPE
,

6536 
	mNL80211_NAN_FUNC_PUBLISH_BCAST
,

6537 
	mNL80211_NAN_FUNC_SUBSCRIBE_ACTIVE
,

6538 
	mNL80211_NAN_FUNC_FOLLOW_UP_ID
,

6539 
	mNL80211_NAN_FUNC_FOLLOW_UP_REQ_ID
,

6540 
	mNL80211_NAN_FUNC_FOLLOW_UP_DEST
,

6541 
	mNL80211_NAN_FUNC_CLOSE_RANGE
,

6542 
	mNL80211_NAN_FUNC_TTL
,

6543 
	mNL80211_NAN_FUNC_SERVICE_INFO
,

6544 
	mNL80211_NAN_FUNC_SRF
,

6545 
	mNL80211_NAN_FUNC_RX_MATCH_FILTER
,

6546 
	mNL80211_NAN_FUNC_TX_MATCH_FILTER
,

6547 
	mNL80211_NAN_FUNC_INSTANCE_ID
,

6548 
	mNL80211_NAN_FUNC_TERM_REASON
,

6551 
	mNUM_NL80211_NAN_FUNC_ATTR
,

6552 
	mNL80211_NAN_FUNC_ATTR_MAX
 = 
NUM_NL80211_NAN_FUNC_ATTR
 - 1

6570 
	e∆80211_«n_§f_©åibuãs
 {

6571 
	m__NL80211_NAN_SRF_INVALID
,

6572 
	mNL80211_NAN_SRF_INCLUDE
,

6573 
	mNL80211_NAN_SRF_BF
,

6574 
	mNL80211_NAN_SRF_BF_IDX
,

6575 
	mNL80211_NAN_SRF_MAC_ADDRS
,

6578 
	mNUM_NL80211_NAN_SRF_ATTR
,

6579 
	mNL80211_NAN_SRF_ATTR_MAX
 = 
NUM_NL80211_NAN_SRF_ATTR
 - 1,

6595 
	e∆80211_«n_m©ch_©åibuãs
 {

6596 
	m__NL80211_NAN_MATCH_INVALID
,

6597 
	mNL80211_NAN_MATCH_FUNC_LOCAL
,

6598 
	mNL80211_NAN_MATCH_FUNC_PEER
,

6601 
	mNUM_NL80211_NAN_MATCH_ATTR
,

6602 
	mNL80211_NAN_MATCH_ATTR_MAX
 = 
NUM_NL80211_NAN_MATCH_ATTR
 - 1

6611 
	e∆80211_exã∫Æ_auth_a˘i⁄
 {

6612 
	mNL80211_EXTERNAL_AUTH_START
,

6613 
	mNL80211_EXTERNAL_AUTH_ABORT
,

6630 
	e∆80211_·m_ª•⁄dî_©åibuãs
 {

6631 
	m__NL80211_FTM_RESP_ATTR_INVALID
,

6633 
	mNL80211_FTM_RESP_ATTR_ENABLED
,

6634 
	mNL80211_FTM_RESP_ATTR_LCI
,

6635 
	mNL80211_FTM_RESP_ATTR_CIVICLOC
,

6638 
	m__NL80211_FTM_RESP_ATTR_LAST
,

6639 
	mNL80211_FTM_RESP_ATTR_MAX
 = 
__NL80211_FTM_RESP_ATTR_LAST
 - 1,

6670 
	e∆80211_·m_ª•⁄dî_°©s
 {

6671 
	m__NL80211_FTM_STATS_INVALID
,

6672 
	mNL80211_FTM_STATS_SUCCESS_NUM
,

6673 
	mNL80211_FTM_STATS_PARTIAL_NUM
,

6674 
	mNL80211_FTM_STATS_FAILED_NUM
,

6675 
	mNL80211_FTM_STATS_ASAP_NUM
,

6676 
	mNL80211_FTM_STATS_NON_ASAP_NUM
,

6677 
	mNL80211_FTM_STATS_TOTAL_DURATION_MSEC
,

6678 
	mNL80211_FTM_STATS_UNKNOWN_TRIGGERS_NUM
,

6679 
	mNL80211_FTM_STATS_RESCHEDULE_REQUESTS_NUM
,

6680 
	mNL80211_FTM_STATS_OUT_OF_WINDOW_TRIGGERS_NUM
,

6681 
	mNL80211_FTM_STATS_PAD
,

6684 
	m__NL80211_FTM_STATS_AFTER_LAST
,

6685 
	mNL80211_FTM_STATS_MAX
 = 
__NL80211_FTM_STATS_AFTER_LAST
 - 1

6696 
	e∆80211_¥ómbÀ
 {

6697 
	mNL80211_PREAMBLE_LEGACY
,

6698 
	mNL80211_PREAMBLE_HT
,

6699 
	mNL80211_PREAMBLE_VHT
,

6700 
	mNL80211_PREAMBLE_DMG
,

6701 
	mNL80211_PREAMBLE_HE
,

6714 
	e∆80211_≥î_mósuªmít_ty≥
 {

6715 
	mNL80211_PMSR_TYPE_INVALID
,

6717 
	mNL80211_PMSR_TYPE_FTM
,

6719 
	mNUM_NL80211_PMSR_TYPES
,

6720 
	mNL80211_PMSR_TYPE_MAX
 = 
NUM_NL80211_PMSR_TYPES
 - 1

6731 
	e∆80211_≥î_mósuªmít_°©us
 {

6732 
	mNL80211_PMSR_STATUS_SUCCESS
,

6733 
	mNL80211_PMSR_STATUS_REFUSED
,

6734 
	mNL80211_PMSR_STATUS_TIMEOUT
,

6735 
	mNL80211_PMSR_STATUS_FAILURE
,

6751 
	e∆80211_≥î_mósuªmít_ªq
 {

6752 
	m__NL80211_PMSR_REQ_ATTR_INVALID
,

6754 
	mNL80211_PMSR_REQ_ATTR_DATA
,

6755 
	mNL80211_PMSR_REQ_ATTR_GET_AP_TSF
,

6758 
	mNUM_NL80211_PMSR_REQ_ATTRS
,

6759 
	mNL80211_PMSR_REQ_ATTR_MAX
 = 
NUM_NL80211_PMSR_REQ_ATTRS
 - 1

6787 
	e∆80211_≥î_mósuªmít_ª•
 {

6788 
	m__NL80211_PMSR_RESP_ATTR_INVALID
,

6790 
	mNL80211_PMSR_RESP_ATTR_DATA
,

6791 
	mNL80211_PMSR_RESP_ATTR_STATUS
,

6792 
	mNL80211_PMSR_RESP_ATTR_HOST_TIME
,

6793 
	mNL80211_PMSR_RESP_ATTR_AP_TSF
,

6794 
	mNL80211_PMSR_RESP_ATTR_FINAL
,

6795 
	mNL80211_PMSR_RESP_ATTR_PAD
,

6798 
	mNUM_NL80211_PMSR_RESP_ATTRS
,

6799 
	mNL80211_PMSR_RESP_ATTR_MAX
 = 
NUM_NL80211_PMSR_RESP_ATTRS
 - 1

6819 
	e∆80211_≥î_mósuªmít_≥î_©ås
 {

6820 
	m__NL80211_PMSR_PEER_ATTR_INVALID
,

6822 
	mNL80211_PMSR_PEER_ATTR_ADDR
,

6823 
	mNL80211_PMSR_PEER_ATTR_CHAN
,

6824 
	mNL80211_PMSR_PEER_ATTR_REQ
,

6825 
	mNL80211_PMSR_PEER_ATTR_RESP
,

6828 
	mNUM_NL80211_PMSR_PEER_ATTRS
,

6829 
	mNL80211_PMSR_PEER_ATTR_MAX
 = 
NUM_NL80211_PMSR_PEER_ATTRS
 - 1,

6856 
	e∆80211_≥î_mósuªmít_©ås
 {

6857 
	m__NL80211_PMSR_ATTR_INVALID
,

6859 
	mNL80211_PMSR_ATTR_MAX_PEERS
,

6860 
	mNL80211_PMSR_ATTR_REPORT_AP_TSF
,

6861 
	mNL80211_PMSR_ATTR_RANDOMIZE_MAC_ADDR
,

6862 
	mNL80211_PMSR_ATTR_TYPE_CAPA
,

6863 
	mNL80211_PMSR_ATTR_PEERS
,

6866 
	mNUM_NL80211_PMSR_ATTR
,

6867 
	mNL80211_PMSR_ATTR_MAX
 = 
NUM_NL80211_PMSR_ATTR
 - 1

6902 
	e∆80211_≥î_mósuªmít_·m_ˇ∑
 {

6903 
	m__NL80211_PMSR_FTM_CAPA_ATTR_INVALID
,

6905 
	mNL80211_PMSR_FTM_CAPA_ATTR_ASAP
,

6906 
	mNL80211_PMSR_FTM_CAPA_ATTR_NON_ASAP
,

6907 
	mNL80211_PMSR_FTM_CAPA_ATTR_REQ_LCI
,

6908 
	mNL80211_PMSR_FTM_CAPA_ATTR_REQ_CIVICLOC
,

6909 
	mNL80211_PMSR_FTM_CAPA_ATTR_PREAMBLES
,

6910 
	mNL80211_PMSR_FTM_CAPA_ATTR_BANDWIDTHS
,

6911 
	mNL80211_PMSR_FTM_CAPA_ATTR_MAX_BURSTS_EXPONENT
,

6912 
	mNL80211_PMSR_FTM_CAPA_ATTR_MAX_FTMS_PER_BURST
,

6913 
	mNL80211_PMSR_FTM_CAPA_ATTR_TRIGGER_BASED
,

6914 
	mNL80211_PMSR_FTM_CAPA_ATTR_NON_TRIGGER_BASED
,

6917 
	mNUM_NL80211_PMSR_FTM_CAPA_ATTR
,

6918 
	mNL80211_PMSR_FTM_CAPA_ATTR_MAX
 = 
NUM_NL80211_PMSR_FTM_CAPA_ATTR
 - 1

6968 
	e∆80211_≥î_mósuªmít_·m_ªq
 {

6969 
	m__NL80211_PMSR_FTM_REQ_ATTR_INVALID
,

6971 
	mNL80211_PMSR_FTM_REQ_ATTR_ASAP
,

6972 
	mNL80211_PMSR_FTM_REQ_ATTR_PREAMBLE
,

6973 
	mNL80211_PMSR_FTM_REQ_ATTR_NUM_BURSTS_EXP
,

6974 
	mNL80211_PMSR_FTM_REQ_ATTR_BURST_PERIOD
,

6975 
	mNL80211_PMSR_FTM_REQ_ATTR_BURST_DURATION
,

6976 
	mNL80211_PMSR_FTM_REQ_ATTR_FTMS_PER_BURST
,

6977 
	mNL80211_PMSR_FTM_REQ_ATTR_NUM_FTMR_RETRIES
,

6978 
	mNL80211_PMSR_FTM_REQ_ATTR_REQUEST_LCI
,

6979 
	mNL80211_PMSR_FTM_REQ_ATTR_REQUEST_CIVICLOC
,

6980 
	mNL80211_PMSR_FTM_REQ_ATTR_TRIGGER_BASED
,

6981 
	mNL80211_PMSR_FTM_REQ_ATTR_NON_TRIGGER_BASED
,

6982 
	mNL80211_PMSR_FTM_REQ_ATTR_LMR_FEEDBACK
,

6983 
	mNL80211_PMSR_FTM_REQ_ATTR_BSS_COLOR
,

6986 
	mNUM_NL80211_PMSR_FTM_REQ_ATTR
,

6987 
	mNL80211_PMSR_FTM_REQ_ATTR_MAX
 = 
NUM_NL80211_PMSR_FTM_REQ_ATTR
 - 1

7006 
	e∆80211_≥î_mósuªmít_·m_Áûuª_ªas⁄s
 {

7007 
	mNL80211_PMSR_FTM_FAILURE_UNSPECIFIED
,

7008 
	mNL80211_PMSR_FTM_FAILURE_NO_RESPONSE
,

7009 
	mNL80211_PMSR_FTM_FAILURE_REJECTED
,

7010 
	mNL80211_PMSR_FTM_FAILURE_WRONG_CHANNEL
,

7011 
	mNL80211_PMSR_FTM_FAILURE_PEER_NOT_CAPABLE
,

7012 
	mNL80211_PMSR_FTM_FAILURE_INVALID_TIMESTAMP
,

7013 
	mNL80211_PMSR_FTM_FAILURE_PEER_BUSY
,

7014 
	mNL80211_PMSR_FTM_FAILURE_BAD_CHANGED_PARAMS
,

7072 
	e∆80211_≥î_mósuªmít_·m_ª•
 {

7073 
	m__NL80211_PMSR_FTM_RESP_ATTR_INVALID
,

7075 
	mNL80211_PMSR_FTM_RESP_ATTR_FAIL_REASON
,

7076 
	mNL80211_PMSR_FTM_RESP_ATTR_BURST_INDEX
,

7077 
	mNL80211_PMSR_FTM_RESP_ATTR_NUM_FTMR_ATTEMPTS
,

7078 
	mNL80211_PMSR_FTM_RESP_ATTR_NUM_FTMR_SUCCESSES
,

7079 
	mNL80211_PMSR_FTM_RESP_ATTR_BUSY_RETRY_TIME
,

7080 
	mNL80211_PMSR_FTM_RESP_ATTR_NUM_BURSTS_EXP
,

7081 
	mNL80211_PMSR_FTM_RESP_ATTR_BURST_DURATION
,

7082 
	mNL80211_PMSR_FTM_RESP_ATTR_FTMS_PER_BURST
,

7083 
	mNL80211_PMSR_FTM_RESP_ATTR_RSSI_AVG
,

7084 
	mNL80211_PMSR_FTM_RESP_ATTR_RSSI_SPREAD
,

7085 
	mNL80211_PMSR_FTM_RESP_ATTR_TX_RATE
,

7086 
	mNL80211_PMSR_FTM_RESP_ATTR_RX_RATE
,

7087 
	mNL80211_PMSR_FTM_RESP_ATTR_RTT_AVG
,

7088 
	mNL80211_PMSR_FTM_RESP_ATTR_RTT_VARIANCE
,

7089 
	mNL80211_PMSR_FTM_RESP_ATTR_RTT_SPREAD
,

7090 
	mNL80211_PMSR_FTM_RESP_ATTR_DIST_AVG
,

7091 
	mNL80211_PMSR_FTM_RESP_ATTR_DIST_VARIANCE
,

7092 
	mNL80211_PMSR_FTM_RESP_ATTR_DIST_SPREAD
,

7093 
	mNL80211_PMSR_FTM_RESP_ATTR_LCI
,

7094 
	mNL80211_PMSR_FTM_RESP_ATTR_CIVICLOC
,

7095 
	mNL80211_PMSR_FTM_RESP_ATTR_PAD
,

7098 
	mNUM_NL80211_PMSR_FTM_RESP_ATTR
,

7099 
	mNL80211_PMSR_FTM_RESP_ATTR_MAX
 = 
NUM_NL80211_PMSR_FTM_RESP_ATTR
 - 1

7119 
	e∆80211_obss_pd_©åibuãs
 {

7120 
	m__NL80211_HE_OBSS_PD_ATTR_INVALID
,

7122 
	mNL80211_HE_OBSS_PD_ATTR_MIN_OFFSET
,

7123 
	mNL80211_HE_OBSS_PD_ATTR_MAX_OFFSET
,

7124 
	mNL80211_HE_OBSS_PD_ATTR_NON_SRG_MAX_OFFSET
,

7125 
	mNL80211_HE_OBSS_PD_ATTR_BSS_COLOR_BITMAP
,

7126 
	mNL80211_HE_OBSS_PD_ATTR_PARTIAL_BSSID_BITMAP
,

7127 
	mNL80211_HE_OBSS_PD_ATTR_SR_CTRL
,

7130 
	m__NL80211_HE_OBSS_PD_ATTR_LAST
,

7131 
	mNL80211_HE_OBSS_PD_ATTR_MAX
 = 
__NL80211_HE_OBSS_PD_ATTR_LAST
 - 1,

7145 
	e∆80211_bss_cﬁ‹_©åibuãs
 {

7146 
	m__NL80211_HE_BSS_COLOR_ATTR_INVALID
,

7148 
	mNL80211_HE_BSS_COLOR_ATTR_COLOR
,

7149 
	mNL80211_HE_BSS_COLOR_ATTR_DISABLED
,

7150 
	mNL80211_HE_BSS_COLOR_ATTR_PARTIAL
,

7153 
	m__NL80211_HE_BSS_COLOR_ATTR_LAST
,

7154 
	mNL80211_HE_BSS_COLOR_ATTR_MAX
 = 
__NL80211_HE_BSS_COLOR_ATTR_LAST
 - 1,

7170 
	e∆80211_i·y≥_akm_©åibuãs
 {

7171 
	m__NL80211_IFTYPE_AKM_ATTR_INVALID
,

7173 
	mNL80211_IFTYPE_AKM_ATTR_IFTYPES
,

7174 
	mNL80211_IFTYPE_AKM_ATTR_SUITES
,

7177 
	m__NL80211_IFTYPE_AKM_ATTR_LAST
,

7178 
	mNL80211_IFTYPE_AKM_ATTR_MAX
 = 
__NL80211_IFTYPE_AKM_ATTR_LAST
 - 1,

7197 
	e∆80211_fûs_discovîy_©åibuãs
 {

7198 
	m__NL80211_FILS_DISCOVERY_ATTR_INVALID
,

7200 
	mNL80211_FILS_DISCOVERY_ATTR_INT_MIN
,

7201 
	mNL80211_FILS_DISCOVERY_ATTR_INT_MAX
,

7202 
	mNL80211_FILS_DISCOVERY_ATTR_TMPL
,

7205 
	m__NL80211_FILS_DISCOVERY_ATTR_LAST
,

7206 
	mNL80211_FILS_DISCOVERY_ATTR_MAX
 = 
__NL80211_FILS_DISCOVERY_ATTR_LAST
 - 1

7213 
	#NL80211_FILS_DISCOVERY_TMPL_MIN_LEN
 42

	)

7230 
	e∆80211_unsﬁ_bˇ°_¥obe_ª•_©åibuãs
 {

7231 
	m__NL80211_UNSOL_BCAST_PROBE_RESP_ATTR_INVALID
,

7233 
	mNL80211_UNSOL_BCAST_PROBE_RESP_ATTR_INT
,

7234 
	mNL80211_UNSOL_BCAST_PROBE_RESP_ATTR_TMPL
,

7237 
	m__NL80211_UNSOL_BCAST_PROBE_RESP_ATTR_LAST
,

7238 
	mNL80211_UNSOL_BCAST_PROBE_RESP_ATTR_MAX
 =

7239 
__NL80211_UNSOL_BCAST_PROBE_RESP_ATTR_LAST
 - 1

7254 
	e∆80211_ße_pwe_mech™ism
 {

7255 
	mNL80211_SAE_PWE_UNSPECIFIED
,

7256 
	mNL80211_SAE_PWE_HUNT_AND_PECK
,

7257 
	mNL80211_SAE_PWE_HASH_TO_ELEMENT
,

7258 
	mNL80211_SAE_PWE_BOTH
,

7267 
	e∆80211_ßr_ty≥
 {

7268 
	mNL80211_SAR_TYPE_POWER
,

7273 
	mNUM_NL80211_SAR_TYPE
,

7297 
	e∆80211_ßr_©ås
 {

7298 
	m__NL80211_SAR_ATTR_INVALID
,

7300 
	mNL80211_SAR_ATTR_TYPE
,

7301 
	mNL80211_SAR_ATTR_SPECS
,

7303 
	m__NL80211_SAR_ATTR_LAST
,

7304 
	mNL80211_SAR_ATTR_MAX
 = 
__NL80211_SAR_ATTR_LAST
 - 1,

7340 
	e∆80211_ßr_•ecs_©ås
 {

7341 
	m__NL80211_SAR_ATTR_SPECS_INVALID
,

7343 
	mNL80211_SAR_ATTR_SPECS_POWER
,

7344 
	mNL80211_SAR_ATTR_SPECS_RANGE_INDEX
,

7345 
	mNL80211_SAR_ATTR_SPECS_START_FREQ
,

7346 
	mNL80211_SAR_ATTR_SPECS_END_FREQ
,

7348 
	m__NL80211_SAR_ATTR_SPECS_LAST
,

7349 
	mNL80211_SAR_ATTR_SPECS_MAX
 = 
__NL80211_SAR_ATTR_SPECS_LAST
 - 1,

	@/usr/include/linux/pci.h

18 #i‚de‡
LINUX_PCI_H


19 
	#LINUX_PCI_H


	)

21 
	~<löux/pci_ªgs.h
>

31 
	#PCI_DEVFN
(
¶Ÿ
, 
func
Ë((((¶ŸË& 0x1fË<< 3Ë| ((funcË& 0x07))

	)

32 
	#PCI_SLOT
(
dev‚
Ë(((dev‚Ë>> 3Ë& 0x1f)

	)

33 
	#PCI_FUNC
(
dev‚
Ë((dev‚Ë& 0x07)

	)

36 
	#PCIIOC_BASE
 ('P' << 24 | 'C' << 16 | 'I' << 8)

	)

37 
	#PCIIOC_CONTROLLER
 (
PCIIOC_BASE
 | 0x00Ë

	)

38 
	#PCIIOC_MMAP_IS_IO
 (
PCIIOC_BASE
 | 0x01Ë

	)

39 
	#PCIIOC_MMAP_IS_MEM
 (
PCIIOC_BASE
 | 0x02Ë

	)

40 
	#PCIIOC_WRITE_COMBINE
 (
PCIIOC_BASE
 | 0x03Ë

	)

	@/usr/include/linux/rtnetlink.h

2 #i‚de‡
__LINUX_RTNETLINK_H


3 
	#__LINUX_RTNETLINK_H


	)

5 
	~<löux/ty≥s.h
>

6 
	~<löux/√éök.h
>

7 
	~<löux/if_lök.h
>

8 
	~<löux/if_addr.h
>

9 
	~<löux/√ighbour.h
>

14 
	#RTNL_FAMILY_IPMR
 128

	)

15 
	#RTNL_FAMILY_IP6MR
 129

	)

16 
	#RTNL_FAMILY_MAX
 129

	)

25 
	mRTM_BASE
 = 16,

26 
	#RTM_BASE
 
RTM_BASE


	)

28 
	mRTM_NEWLINK
 = 16,

29 
	#RTM_NEWLINK
 
RTM_NEWLINK


	)

30 
	mRTM_DELLINK
,

31 
	#RTM_DELLINK
 
RTM_DELLINK


	)

32 
	mRTM_GETLINK
,

33 
	#RTM_GETLINK
 
RTM_GETLINK


	)

34 
	mRTM_SETLINK
,

35 
	#RTM_SETLINK
 
RTM_SETLINK


	)

37 
	mRTM_NEWADDR
 = 20,

38 
	#RTM_NEWADDR
 
RTM_NEWADDR


	)

39 
	mRTM_DELADDR
,

40 
	#RTM_DELADDR
 
RTM_DELADDR


	)

41 
	mRTM_GETADDR
,

42 
	#RTM_GETADDR
 
RTM_GETADDR


	)

44 
	mRTM_NEWROUTE
 = 24,

45 
	#RTM_NEWROUTE
 
RTM_NEWROUTE


	)

46 
	mRTM_DELROUTE
,

47 
	#RTM_DELROUTE
 
RTM_DELROUTE


	)

48 
	mRTM_GETROUTE
,

49 
	#RTM_GETROUTE
 
RTM_GETROUTE


	)

51 
	mRTM_NEWNEIGH
 = 28,

52 
	#RTM_NEWNEIGH
 
RTM_NEWNEIGH


	)

53 
	mRTM_DELNEIGH
,

54 
	#RTM_DELNEIGH
 
RTM_DELNEIGH


	)

55 
	mRTM_GETNEIGH
,

56 
	#RTM_GETNEIGH
 
RTM_GETNEIGH


	)

58 
	mRTM_NEWRULE
 = 32,

59 
	#RTM_NEWRULE
 
RTM_NEWRULE


	)

60 
	mRTM_DELRULE
,

61 
	#RTM_DELRULE
 
RTM_DELRULE


	)

62 
	mRTM_GETRULE
,

63 
	#RTM_GETRULE
 
RTM_GETRULE


	)

65 
	mRTM_NEWQDISC
 = 36,

66 
	#RTM_NEWQDISC
 
RTM_NEWQDISC


	)

67 
	mRTM_DELQDISC
,

68 
	#RTM_DELQDISC
 
RTM_DELQDISC


	)

69 
	mRTM_GETQDISC
,

70 
	#RTM_GETQDISC
 
RTM_GETQDISC


	)

72 
	mRTM_NEWTCLASS
 = 40,

73 
	#RTM_NEWTCLASS
 
RTM_NEWTCLASS


	)

74 
	mRTM_DELTCLASS
,

75 
	#RTM_DELTCLASS
 
RTM_DELTCLASS


	)

76 
	mRTM_GETTCLASS
,

77 
	#RTM_GETTCLASS
 
RTM_GETTCLASS


	)

79 
	mRTM_NEWTFILTER
 = 44,

80 
	#RTM_NEWTFILTER
 
RTM_NEWTFILTER


	)

81 
	mRTM_DELTFILTER
,

82 
	#RTM_DELTFILTER
 
RTM_DELTFILTER


	)

83 
	mRTM_GETTFILTER
,

84 
	#RTM_GETTFILTER
 
RTM_GETTFILTER


	)

86 
	mRTM_NEWACTION
 = 48,

87 
	#RTM_NEWACTION
 
RTM_NEWACTION


	)

88 
	mRTM_DELACTION
,

89 
	#RTM_DELACTION
 
RTM_DELACTION


	)

90 
	mRTM_GETACTION
,

91 
	#RTM_GETACTION
 
RTM_GETACTION


	)

93 
	mRTM_NEWPREFIX
 = 52,

94 
	#RTM_NEWPREFIX
 
RTM_NEWPREFIX


	)

96 
	mRTM_GETMULTICAST
 = 58,

97 
	#RTM_GETMULTICAST
 
RTM_GETMULTICAST


	)

99 
	mRTM_GETANYCAST
 = 62,

100 
	#RTM_GETANYCAST
 
RTM_GETANYCAST


	)

102 
	mRTM_NEWNEIGHTBL
 = 64,

103 
	#RTM_NEWNEIGHTBL
 
RTM_NEWNEIGHTBL


	)

104 
	mRTM_GETNEIGHTBL
 = 66,

105 
	#RTM_GETNEIGHTBL
 
RTM_GETNEIGHTBL


	)

106 
	mRTM_SETNEIGHTBL
,

107 
	#RTM_SETNEIGHTBL
 
RTM_SETNEIGHTBL


	)

109 
	mRTM_NEWNDUSEROPT
 = 68,

110 
	#RTM_NEWNDUSEROPT
 
RTM_NEWNDUSEROPT


	)

112 
	mRTM_NEWADDRLABEL
 = 72,

113 
	#RTM_NEWADDRLABEL
 
RTM_NEWADDRLABEL


	)

114 
	mRTM_DELADDRLABEL
,

115 
	#RTM_DELADDRLABEL
 
RTM_DELADDRLABEL


	)

116 
	mRTM_GETADDRLABEL
,

117 
	#RTM_GETADDRLABEL
 
RTM_GETADDRLABEL


	)

119 
	mRTM_GETDCB
 = 78,

120 
	#RTM_GETDCB
 
RTM_GETDCB


	)

121 
	mRTM_SETDCB
,

122 
	#RTM_SETDCB
 
RTM_SETDCB


	)

124 
	mRTM_NEWNETCONF
 = 80,

125 
	#RTM_NEWNETCONF
 
RTM_NEWNETCONF


	)

126 
	mRTM_DELNETCONF
,

127 
	#RTM_DELNETCONF
 
RTM_DELNETCONF


	)

128 
	mRTM_GETNETCONF
 = 82,

129 
	#RTM_GETNETCONF
 
RTM_GETNETCONF


	)

131 
	mRTM_NEWMDB
 = 84,

132 
	#RTM_NEWMDB
 
RTM_NEWMDB


	)

133 
	mRTM_DELMDB
 = 85,

134 
	#RTM_DELMDB
 
RTM_DELMDB


	)

135 
	mRTM_GETMDB
 = 86,

136 
	#RTM_GETMDB
 
RTM_GETMDB


	)

138 
	mRTM_NEWNSID
 = 88,

139 
	#RTM_NEWNSID
 
RTM_NEWNSID


	)

140 
	mRTM_DELNSID
 = 89,

141 
	#RTM_DELNSID
 
RTM_DELNSID


	)

142 
	mRTM_GETNSID
 = 90,

143 
	#RTM_GETNSID
 
RTM_GETNSID


	)

145 
	mRTM_NEWSTATS
 = 92,

146 
	#RTM_NEWSTATS
 
RTM_NEWSTATS


	)

147 
	mRTM_GETSTATS
 = 94,

148 
	#RTM_GETSTATS
 
RTM_GETSTATS


	)

150 
	mRTM_NEWCACHEREPORT
 = 96,

151 
	#RTM_NEWCACHEREPORT
 
RTM_NEWCACHEREPORT


	)

153 
	mRTM_NEWCHAIN
 = 100,

154 
	#RTM_NEWCHAIN
 
RTM_NEWCHAIN


	)

155 
	mRTM_DELCHAIN
,

156 
	#RTM_DELCHAIN
 
RTM_DELCHAIN


	)

157 
	mRTM_GETCHAIN
,

158 
	#RTM_GETCHAIN
 
RTM_GETCHAIN


	)

160 
	mRTM_NEWNEXTHOP
 = 104,

161 
	#RTM_NEWNEXTHOP
 
RTM_NEWNEXTHOP


	)

162 
	mRTM_DELNEXTHOP
,

163 
	#RTM_DELNEXTHOP
 
RTM_DELNEXTHOP


	)

164 
	mRTM_GETNEXTHOP
,

165 
	#RTM_GETNEXTHOP
 
RTM_GETNEXTHOP


	)

167 
	mRTM_NEWLINKPROP
 = 108,

168 
	#RTM_NEWLINKPROP
 
RTM_NEWLINKPROP


	)

169 
	mRTM_DELLINKPROP
,

170 
	#RTM_DELLINKPROP
 
RTM_DELLINKPROP


	)

171 
	mRTM_GETLINKPROP
,

172 
	#RTM_GETLINKPROP
 
RTM_GETLINKPROP


	)

174 
	mRTM_NEWVLAN
 = 112,

175 
	#RTM_NEWNVLAN
 
RTM_NEWVLAN


	)

176 
	mRTM_DELVLAN
,

177 
	#RTM_DELVLAN
 
RTM_DELVLAN


	)

178 
	mRTM_GETVLAN
,

179 
	#RTM_GETVLAN
 
RTM_GETVLAN


	)

181 
	mRTM_NEWNEXTHOPBUCKET
 = 116,

182 
	#RTM_NEWNEXTHOPBUCKET
 
RTM_NEWNEXTHOPBUCKET


	)

183 
	mRTM_DELNEXTHOPBUCKET
,

184 
	#RTM_DELNEXTHOPBUCKET
 
RTM_DELNEXTHOPBUCKET


	)

185 
	mRTM_GETNEXTHOPBUCKET
,

186 
	#RTM_GETNEXTHOPBUCKET
 
RTM_GETNEXTHOPBUCKET


	)

188 
	m__RTM_MAX
,

189 
	#RTM_MAX
 (((
__RTM_MAX
 + 3Ë& ~3Ë- 1)

	)

192 
	#RTM_NR_MSGTYPES
 (
RTM_MAX
 + 1 - 
RTM_BASE
)

	)

193 
	#RTM_NR_FAMILIES
 (
RTM_NR_MSGTYPES
 >> 2)

	)

194 
	#RTM_FAM
(
cmd
Ë(((cmdË- 
RTM_BASE
Ë>> 2)

	)

202 
	sπ©å
 {

203 
	mπa_Àn
;

204 
	mπa_ty≥
;

209 
	#RTA_ALIGNTO
 4U

	)

210 
	#RTA_ALIGN
(
Àn
Ë–(÷í)+
RTA_ALIGNTO
-1Ë& ~(RTA_ALIGNTO-1Ë)

	)

211 
	#RTA_OK
(
πa
,
Àn
Ë(÷íË>()(
π©å
) && \

212 (
πa
)->
πa_Àn
 >(
π©å
) && \

213 (
πa
)->
πa_Àn
 <(
Àn
))

	)

214 
	#RTA_NEXT
(
πa
,
©åÀn
Ë(◊âæíË-
	`RTA_ALIGN
(‘è)->
πa_Àn
), \

215 (
π©å
*)(((*)(
πa
)Ë+ 
	`RTA_ALIGN
(‘è)->
πa_Àn
)))

	)

216 
	#RTA_LENGTH
(
Àn
Ë(
	`RTA_ALIGN
((
π©å
)Ë+ (Àn))

	)

217 
	#RTA_SPACE
(
Àn
Ë
	`RTA_ALIGN
(
	`RTA_LENGTH
÷í))

	)

218 
	#RTA_DATA
(
πa
Ë((*)(((*)‘è)Ë+ 
	`RTA_LENGTH
(0)))

	)

219 
	#RTA_PAYLOAD
(
πa
Ë(()(‘è)->
πa_Àn
Ë- 
	`RTA_LENGTH
(0))

	)

228 
	sπmsg
 {

229 
	mπm_Ámûy
;

230 
	mπm_d°_Àn
;

231 
	mπm_§c_Àn
;

232 
	mπm_tos
;

234 
	mπm_èbÀ
;

235 
	mπm_¥Ÿocﬁ
;

236 
	mπm_sc›e
;

237 
	mπm_ty≥
;

239 
	mπm_Êags
;

245 
	mRTN_UNSPEC
,

246 
	mRTN_UNICAST
,

247 
	mRTN_LOCAL
,

248 
	mRTN_BROADCAST
,

250 
	mRTN_ANYCAST
,

252 
	mRTN_MULTICAST
,

253 
	mRTN_BLACKHOLE
,

254 
	mRTN_UNREACHABLE
,

255 
	mRTN_PROHIBIT
,

256 
	mRTN_THROW
,

257 
	mRTN_NAT
,

258 
	mRTN_XRESOLVE
,

259 
	m__RTN_MAX


262 
	#RTN_MAX
 (
__RTN_MAX
 - 1)

	)

267 
	#RTPROT_UNSPEC
 0

	)

268 
	#RTPROT_REDIRECT
 1

	)

270 
	#RTPROT_KERNEL
 2

	)

271 
	#RTPROT_BOOT
 3

	)

272 
	#RTPROT_STATIC
 4

	)

281 
	#RTPROT_GATED
 8

	)

282 
	#RTPROT_RA
 9

	)

283 
	#RTPROT_MRT
 10

	)

284 
	#RTPROT_ZEBRA
 11

	)

285 
	#RTPROT_BIRD
 12

	)

286 
	#RTPROT_DNROUTED
 13

	)

287 
	#RTPROT_XORP
 14

	)

288 
	#RTPROT_NTK
 15

	)

289 
	#RTPROT_DHCP
 16

	)

290 
	#RTPROT_MROUTED
 17

	)

291 
	#RTPROT_KEEPALIVED
 18

	)

292 
	#RTPROT_BABEL
 42

	)

293 
	#RTPROT_OPENR
 99

	)

294 
	#RTPROT_BGP
 186

	)

295 
	#RTPROT_ISIS
 187

	)

296 
	#RTPROT_OSPF
 188

	)

297 
	#RTPROT_RIP
 189

	)

298 
	#RTPROT_EIGRP
 192

	)

311 
	eπ_sc›e_t
 {

312 
	mRT_SCOPE_UNIVERSE
=0,

314 
	mRT_SCOPE_SITE
=200,

315 
	mRT_SCOPE_LINK
=253,

316 
	mRT_SCOPE_HOST
=254,

317 
	mRT_SCOPE_NOWHERE
=255

322 
	#RTM_F_NOTIFY
 0x100

	)

323 
	#RTM_F_CLONED
 0x200

	)

324 
	#RTM_F_EQUALIZE
 0x400

	)

325 
	#RTM_F_PREFIX
 0x800

	)

326 
	#RTM_F_LOOKUP_TABLE
 0x1000

	)

327 
	#RTM_F_FIB_MATCH
 0x2000

	)

328 
	#RTM_F_OFFLOAD
 0x4000

	)

329 
	#RTM_F_TRAP
 0x8000

	)

330 
	#RTM_F_OFFLOAD_FAILED
 0x20000000

	)

338 
	eπ_˛ass_t
 {

339 
	mRT_TABLE_UNSPEC
=0,

341 
	mRT_TABLE_COMPAT
=252,

342 
	mRT_TABLE_DEFAULT
=253,

343 
	mRT_TABLE_MAIN
=254,

344 
	mRT_TABLE_LOCAL
=255,

345 
	mRT_TABLE_MAX
=0xFFFFFFFF

351 
	eπ©å_ty≥_t
 {

352 
	mRTA_UNSPEC
,

353 
	mRTA_DST
,

354 
	mRTA_SRC
,

355 
	mRTA_IIF
,

356 
	mRTA_OIF
,

357 
	mRTA_GATEWAY
,

358 
	mRTA_PRIORITY
,

359 
	mRTA_PREFSRC
,

360 
	mRTA_METRICS
,

361 
	mRTA_MULTIPATH
,

362 
	mRTA_PROTOINFO
,

363 
	mRTA_FLOW
,

364 
	mRTA_CACHEINFO
,

365 
	mRTA_SESSION
,

366 
	mRTA_MP_ALGO
,

367 
	mRTA_TABLE
,

368 
	mRTA_MARK
,

369 
	mRTA_MFC_STATS
,

370 
	mRTA_VIA
,

371 
	mRTA_NEWDST
,

372 
	mRTA_PREF
,

373 
	mRTA_ENCAP_TYPE
,

374 
	mRTA_ENCAP
,

375 
	mRTA_EXPIRES
,

376 
	mRTA_PAD
,

377 
	mRTA_UID
,

378 
	mRTA_TTL_PROPAGATE
,

379 
	mRTA_IP_PROTO
,

380 
	mRTA_SPORT
,

381 
	mRTA_DPORT
,

382 
	mRTA_NH_ID
,

383 
	m__RTA_MAX


386 
	#RTA_MAX
 (
__RTA_MAX
 - 1)

	)

388 
	#RTM_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
πmsg
))))

	)

389 
	#RTM_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
πmsg
))

	)

400 
	sπ√xth›
 {

401 
	mπnh_Àn
;

402 
	mπnh_Êags
;

403 
	mπnh_h›s
;

404 
	mπnh_ifödex
;

409 
	#RTNH_F_DEAD
 1

	)

410 
	#RTNH_F_PERVASIVE
 2

	)

411 
	#RTNH_F_ONLINK
 4

	)

412 
	#RTNH_F_OFFLOAD
 8

	)

413 
	#RTNH_F_LINKDOWN
 16

	)

414 
	#RTNH_F_UNRESOLVED
 32

	)

415 
	#RTNH_F_TRAP
 64

	)

417 
	#RTNH_COMPARE_MASK
 (
RTNH_F_DEAD
 | 
RTNH_F_LINKDOWN
 | \

418 
RTNH_F_OFFLOAD
 | 
RTNH_F_TRAP
)

	)

422 
	#RTNH_ALIGNTO
 4

	)

423 
	#RTNH_ALIGN
(
Àn
Ë–(÷í)+
RTNH_ALIGNTO
-1Ë& ~(RTNH_ALIGNTO-1Ë)

	)

424 
	#RTNH_OK
(
πnh
,
Àn
Ë(‘äh)->
πnh_Àn
 >(
π√xth›
) && \

425 (()(
πnh
)->
πnh_Àn
Ë<(
Àn
))

	)

426 
	#RTNH_NEXT
(
πnh
Ë((
π√xth›
*)(((*)‘äh)Ë+ 
	`RTNH_ALIGN
(‘äh)->
πnh_Àn
)))

	)

427 
	#RTNH_LENGTH
(
Àn
Ë(
	`RTNH_ALIGN
((
π√xth›
)Ë+ (Àn))

	)

428 
	#RTNH_SPACE
(
Àn
Ë
	`RTNH_ALIGN
(
	`RTNH_LENGTH
÷í))

	)

429 
	#RTNH_DATA
(
πnh
Ë((
π©å
*)(((*)‘äh)Ë+ 
	`RTNH_LENGTH
(0)))

	)

432 
	sπvü
 {

433 
__kî√l_ß_Ámûy_t
 
	mπvü_Ámûy
;

434 
__u8
 
	mπvü_addr
[0];

439 
	sπa_ˇcheöfo
 {

440 
__u32
 
	mπa_˛¡ªf
;

441 
__u32
 
	mπa_œ°u£
;

442 
__s32
 
	mπa_expúes
;

443 
__u32
 
	mπa_îr‹
;

444 
__u32
 
	mπa_u£d
;

446 
	#RTNETLINK_HAVE_PEERINFO
 1

	)

447 
__u32
 
	mπa_id
;

448 
__u32
 
	mπa_ts
;

449 
__u32
 
	mπa_tßge
;

455 
	mRTAX_UNSPEC
,

456 
	#RTAX_UNSPEC
 
RTAX_UNSPEC


	)

457 
	mRTAX_LOCK
,

458 
	#RTAX_LOCK
 
RTAX_LOCK


	)

459 
	mRTAX_MTU
,

460 
	#RTAX_MTU
 
RTAX_MTU


	)

461 
	mRTAX_WINDOW
,

462 
	#RTAX_WINDOW
 
RTAX_WINDOW


	)

463 
	mRTAX_RTT
,

464 
	#RTAX_RTT
 
RTAX_RTT


	)

465 
	mRTAX_RTTVAR
,

466 
	#RTAX_RTTVAR
 
RTAX_RTTVAR


	)

467 
	mRTAX_SSTHRESH
,

468 
	#RTAX_SSTHRESH
 
RTAX_SSTHRESH


	)

469 
	mRTAX_CWND
,

470 
	#RTAX_CWND
 
RTAX_CWND


	)

471 
	mRTAX_ADVMSS
,

472 
	#RTAX_ADVMSS
 
RTAX_ADVMSS


	)

473 
	mRTAX_REORDERING
,

474 
	#RTAX_REORDERING
 
RTAX_REORDERING


	)

475 
	mRTAX_HOPLIMIT
,

476 
	#RTAX_HOPLIMIT
 
RTAX_HOPLIMIT


	)

477 
	mRTAX_INITCWND
,

478 
	#RTAX_INITCWND
 
RTAX_INITCWND


	)

479 
	mRTAX_FEATURES
,

480 
	#RTAX_FEATURES
 
RTAX_FEATURES


	)

481 
	mRTAX_RTO_MIN
,

482 
	#RTAX_RTO_MIN
 
RTAX_RTO_MIN


	)

483 
	mRTAX_INITRWND
,

484 
	#RTAX_INITRWND
 
RTAX_INITRWND


	)

485 
	mRTAX_QUICKACK
,

486 
	#RTAX_QUICKACK
 
RTAX_QUICKACK


	)

487 
	mRTAX_CC_ALGO
,

488 
	#RTAX_CC_ALGO
 
RTAX_CC_ALGO


	)

489 
	mRTAX_FASTOPEN_NO_COOKIE
,

490 
	#RTAX_FASTOPEN_NO_COOKIE
 
RTAX_FASTOPEN_NO_COOKIE


	)

491 
	m__RTAX_MAX


494 
	#RTAX_MAX
 (
__RTAX_MAX
 - 1)

	)

496 
	#RTAX_FEATURE_ECN
 (1 << 0)

	)

497 
	#RTAX_FEATURE_SACK
 (1 << 1)

	)

498 
	#RTAX_FEATURE_TIMESTAMP
 (1 << 2)

	)

499 
	#RTAX_FEATURE_ALLFRAG
 (1 << 3)

	)

501 
	#RTAX_FEATURE_MASK
 (
RTAX_FEATURE_ECN
 | 
RTAX_FEATURE_SACK
 | \

502 
RTAX_FEATURE_TIMESTAMP
 | 
RTAX_FEATURE_ALLFRAG
)

	)

504 
	sπa_£ssi⁄
 {

505 
__u8
 
	m¥Ÿo
;

506 
__u8
 
	m∑d1
;

507 
__u16
 
	m∑d2
;

511 
__u16
 
	m•‹t
;

512 
__u16
 
	mdp‹t
;

513 } 
	mp‹ts
;

516 
__u8
 
	mty≥
;

517 
__u8
 
	mcode
;

518 
__u16
 
	midít
;

519 } 
	micm±
;

521 
__u32
 
	m•i
;

522 } 
	mu
;

525 
	sπa_mfc_°©s
 {

526 
__u64
 
	mmfcs_∑ckës
;

527 
__u64
 
	mmfcs_byãs
;

528 
__u64
 
	mmfcs_wr⁄g_if
;

535 
	sπgímsg
 {

536 
	mπgí_Ámûy
;

548 
	siföfomsg
 {

549 
	mifi_Ámûy
;

550 
	m__ifi_∑d
;

551 
	mifi_ty≥
;

552 
	mifi_ödex
;

553 
	mifi_Êags
;

554 
	mifi_ch™ge
;

561 
	s¥efixmsg
 {

562 
	m¥efix_Ámûy
;

563 
	m¥efix_∑d1
;

564 
	m¥efix_∑d2
;

565 
	m¥efix_ifödex
;

566 
	m¥efix_ty≥
;

567 
	m¥efix_Àn
;

568 
	m¥efix_Êags
;

569 
	m¥efix_∑d3
;

574 
	mPREFIX_UNSPEC
,

575 
	mPREFIX_ADDRESS
,

576 
	mPREFIX_CACHEINFO
,

577 
	m__PREFIX_MAX


580 
	#PREFIX_MAX
 (
__PREFIX_MAX
 - 1)

	)

582 
	s¥efix_ˇcheöfo
 {

583 
__u32
 
	m¥e„ºed_time
;

584 
__u32
 
	mvÆid_time
;

592 
	stcmsg
 {

593 
	mtcm_Ámûy
;

594 
	mtcm__∑d1
;

595 
	mtcm__∑d2
;

596 
	mtcm_ifödex
;

597 
__u32
 
	mtcm_h™dÀ
;

598 
__u32
 
	mtcm_∑ª¡
;

602 
	#tcm_block_ödex
 
tcm_∑ª¡


	)

603 
__u32
 
	mtcm_öfo
;

610 
	#TCM_IFINDEX_MAGIC_BLOCK
 (0xFFFFFFFFU)

	)

613 
	mTCA_UNSPEC
,

614 
	mTCA_KIND
,

615 
	mTCA_OPTIONS
,

616 
	mTCA_STATS
,

617 
	mTCA_XSTATS
,

618 
	mTCA_RATE
,

619 
	mTCA_FCNT
,

620 
	mTCA_STATS2
,

621 
	mTCA_STAB
,

622 
	mTCA_PAD
,

623 
	mTCA_DUMP_INVISIBLE
,

624 
	mTCA_CHAIN
,

625 
	mTCA_HW_OFFLOAD
,

626 
	mTCA_INGRESS_BLOCK
,

627 
	mTCA_EGRESS_BLOCK
,

628 
	mTCA_DUMP_FLAGS
,

629 
	m__TCA_MAX


632 
	#TCA_MAX
 (
__TCA_MAX
 - 1)

	)

634 
	#TCA_DUMP_FLAGS_TERSE
 (1 << 0Ë

	)

639 
	#TCA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
tcmsg
))))

	)

640 
	#TCA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
tcmsg
))

	)

646 
	sndu£r›tmsg
 {

647 
	mndu£r›t_Ámûy
;

648 
	mndu£r›t_∑d1
;

649 
	mndu£r›t_›ts_Àn
;

650 
	mndu£r›t_ifödex
;

651 
__u8
 
	mndu£r›t_icmp_ty≥
;

652 
__u8
 
	mndu£r›t_icmp_code
;

653 
	mndu£r›t_∑d2
;

654 
	mndu£r›t_∑d3
;

659 
	mNDUSEROPT_UNSPEC
,

660 
	mNDUSEROPT_SRCADDR
,

661 
	m__NDUSEROPT_MAX


664 
	#NDUSEROPT_MAX
 (
__NDUSEROPT_MAX
 - 1)

	)

667 
	#RTMGRP_LINK
 1

	)

668 
	#RTMGRP_NOTIFY
 2

	)

669 
	#RTMGRP_NEIGH
 4

	)

670 
	#RTMGRP_TC
 8

	)

672 
	#RTMGRP_IPV4_IFADDR
 0x10

	)

673 
	#RTMGRP_IPV4_MROUTE
 0x20

	)

674 
	#RTMGRP_IPV4_ROUTE
 0x40

	)

675 
	#RTMGRP_IPV4_RULE
 0x80

	)

677 
	#RTMGRP_IPV6_IFADDR
 0x100

	)

678 
	#RTMGRP_IPV6_MROUTE
 0x200

	)

679 
	#RTMGRP_IPV6_ROUTE
 0x400

	)

680 
	#RTMGRP_IPV6_IFINFO
 0x800

	)

682 
	#RTMGRP_DEC√t_IFADDR
 0x1000

	)

683 
	#RTMGRP_DEC√t_ROUTE
 0x4000

	)

685 
	#RTMGRP_IPV6_PREFIX
 0x20000

	)

688 
	eπ√éök_groups
 {

689 
	mRTNLGRP_NONE
,

690 
	#RTNLGRP_NONE
 
RTNLGRP_NONE


	)

691 
	mRTNLGRP_LINK
,

692 
	#RTNLGRP_LINK
 
RTNLGRP_LINK


	)

693 
	mRTNLGRP_NOTIFY
,

694 
	#RTNLGRP_NOTIFY
 
RTNLGRP_NOTIFY


	)

695 
	mRTNLGRP_NEIGH
,

696 
	#RTNLGRP_NEIGH
 
RTNLGRP_NEIGH


	)

697 
	mRTNLGRP_TC
,

698 
	#RTNLGRP_TC
 
RTNLGRP_TC


	)

699 
	mRTNLGRP_IPV4_IFADDR
,

700 
	#RTNLGRP_IPV4_IFADDR
 
RTNLGRP_IPV4_IFADDR


	)

701 
	mRTNLGRP_IPV4_MROUTE
,

702 
	#RTNLGRP_IPV4_MROUTE
 
RTNLGRP_IPV4_MROUTE


	)

703 
	mRTNLGRP_IPV4_ROUTE
,

704 
	#RTNLGRP_IPV4_ROUTE
 
RTNLGRP_IPV4_ROUTE


	)

705 
	mRTNLGRP_IPV4_RULE
,

706 
	#RTNLGRP_IPV4_RULE
 
RTNLGRP_IPV4_RULE


	)

707 
	mRTNLGRP_IPV6_IFADDR
,

708 
	#RTNLGRP_IPV6_IFADDR
 
RTNLGRP_IPV6_IFADDR


	)

709 
	mRTNLGRP_IPV6_MROUTE
,

710 
	#RTNLGRP_IPV6_MROUTE
 
RTNLGRP_IPV6_MROUTE


	)

711 
	mRTNLGRP_IPV6_ROUTE
,

712 
	#RTNLGRP_IPV6_ROUTE
 
RTNLGRP_IPV6_ROUTE


	)

713 
	mRTNLGRP_IPV6_IFINFO
,

714 
	#RTNLGRP_IPV6_IFINFO
 
RTNLGRP_IPV6_IFINFO


	)

715 
	mRTNLGRP_DEC√t_IFADDR
,

716 
	#RTNLGRP_DEC√t_IFADDR
 
RTNLGRP_DEC√t_IFADDR


	)

717 
	mRTNLGRP_NOP2
,

718 
	mRTNLGRP_DEC√t_ROUTE
,

719 
	#RTNLGRP_DEC√t_ROUTE
 
RTNLGRP_DEC√t_ROUTE


	)

720 
	mRTNLGRP_DEC√t_RULE
,

721 
	#RTNLGRP_DEC√t_RULE
 
RTNLGRP_DEC√t_RULE


	)

722 
	mRTNLGRP_NOP4
,

723 
	mRTNLGRP_IPV6_PREFIX
,

724 
	#RTNLGRP_IPV6_PREFIX
 
RTNLGRP_IPV6_PREFIX


	)

725 
	mRTNLGRP_IPV6_RULE
,

726 
	#RTNLGRP_IPV6_RULE
 
RTNLGRP_IPV6_RULE


	)

727 
	mRTNLGRP_ND_USEROPT
,

728 
	#RTNLGRP_ND_USEROPT
 
RTNLGRP_ND_USEROPT


	)

729 
	mRTNLGRP_PHONET_IFADDR
,

730 
	#RTNLGRP_PHONET_IFADDR
 
RTNLGRP_PHONET_IFADDR


	)

731 
	mRTNLGRP_PHONET_ROUTE
,

732 
	#RTNLGRP_PHONET_ROUTE
 
RTNLGRP_PHONET_ROUTE


	)

733 
	mRTNLGRP_DCB
,

734 
	#RTNLGRP_DCB
 
RTNLGRP_DCB


	)

735 
	mRTNLGRP_IPV4_NETCONF
,

736 
	#RTNLGRP_IPV4_NETCONF
 
RTNLGRP_IPV4_NETCONF


	)

737 
	mRTNLGRP_IPV6_NETCONF
,

738 
	#RTNLGRP_IPV6_NETCONF
 
RTNLGRP_IPV6_NETCONF


	)

739 
	mRTNLGRP_MDB
,

740 
	#RTNLGRP_MDB
 
RTNLGRP_MDB


	)

741 
	mRTNLGRP_MPLS_ROUTE
,

742 
	#RTNLGRP_MPLS_ROUTE
 
RTNLGRP_MPLS_ROUTE


	)

743 
	mRTNLGRP_NSID
,

744 
	#RTNLGRP_NSID
 
RTNLGRP_NSID


	)

745 
	mRTNLGRP_MPLS_NETCONF
,

746 
	#RTNLGRP_MPLS_NETCONF
 
RTNLGRP_MPLS_NETCONF


	)

747 
	mRTNLGRP_IPV4_MROUTE_R
,

748 
	#RTNLGRP_IPV4_MROUTE_R
 
RTNLGRP_IPV4_MROUTE_R


	)

749 
	mRTNLGRP_IPV6_MROUTE_R
,

750 
	#RTNLGRP_IPV6_MROUTE_R
 
RTNLGRP_IPV6_MROUTE_R


	)

751 
	mRTNLGRP_NEXTHOP
,

752 
	#RTNLGRP_NEXTHOP
 
RTNLGRP_NEXTHOP


	)

753 
	mRTNLGRP_BRVLAN
,

754 
	#RTNLGRP_BRVLAN
 
RTNLGRP_BRVLAN


	)

755 
	m__RTNLGRP_MAX


757 
	#RTNLGRP_MAX
 (
__RTNLGRP_MAX
 - 1)

	)

760 
	stˇmsg
 {

761 
	mtˇ_Ámûy
;

762 
	mtˇ__∑d1
;

763 
	mtˇ__∑d2
;

767 
	mTCA_ROOT_UNSPEC
,

768 
	mTCA_ROOT_TAB
,

769 
	#TCA_ACT_TAB
 
TCA_ROOT_TAB


	)

770 
	#TCAA_MAX
 
TCA_ROOT_TAB


	)

771 
	mTCA_ROOT_FLAGS
,

772 
	mTCA_ROOT_COUNT
,

773 
	mTCA_ROOT_TIME_DELTA
,

774 
	m__TCA_ROOT_MAX
,

775 
	#TCA_ROOT_MAX
 (
__TCA_ROOT_MAX
 - 1)

	)

778 
	#TA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
tˇmsg
))))

	)

779 
	#TA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
tˇmsg
))

	)

791 
	#TCA_FLAG_LARGE_DUMP_ON
 (1 << 0)

	)

792 
	#TCA_ACT_FLAG_LARGE_DUMP_ON
 
TCA_FLAG_LARGE_DUMP_ON


	)

793 
	#TCA_ACT_FLAG_TERSE_DUMP
 (1 << 1)

	)

796 
	#RTEXT_FILTER_VF
 (1 << 0)

	)

797 
	#RTEXT_FILTER_BRVLAN
 (1 << 1)

	)

798 
	#RTEXT_FILTER_BRVLAN_COMPRESSED
 (1 << 2)

	)

799 
	#RTEXT_FILTER_SKIP_STATS
 (1 << 3)

	)

800 
	#RTEXT_FILTER_MRP
 (1 << 4)

	)

801 
	#RTEXT_FILTER_CFM_CONFIG
 (1 << 5)

	)

802 
	#RTEXT_FILTER_CFM_STATUS
 (1 << 6)

	)

	@/usr/include/linux/sched.h

2 #i‚de‡
_LINUX_SCHED_H


3 
	#_LINUX_SCHED_H


	)

5 
	~<löux/ty≥s.h
>

10 
	#CSIGNAL
 0x000000f‡

	)

11 
	#CLONE_VM
 0x00000100

	)

12 
	#CLONE_FS
 0x00000200

	)

13 
	#CLONE_FILES
 0x00000400

	)

14 
	#CLONE_SIGHAND
 0x00000800

	)

15 
	#CLONE_PIDFD
 0x00001000

	)

16 
	#CLONE_PTRACE
 0x00002000

	)

17 
	#CLONE_VFORK
 0x00004000

	)

18 
	#CLONE_PARENT
 0x00008000

	)

19 
	#CLONE_THREAD
 0x00010000

	)

20 
	#CLONE_NEWNS
 0x00020000

	)

21 
	#CLONE_SYSVSEM
 0x00040000

	)

22 
	#CLONE_SETTLS
 0x00080000

	)

23 
	#CLONE_PARENT_SETTID
 0x00100000

	)

24 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

25 
	#CLONE_DETACHED
 0x00400000

	)

26 
	#CLONE_UNTRACED
 0x00800000

	)

27 
	#CLONE_CHILD_SETTID
 0x01000000

	)

28 
	#CLONE_NEWCGROUP
 0x02000000

	)

29 
	#CLONE_NEWUTS
 0x04000000

	)

30 
	#CLONE_NEWIPC
 0x08000000

	)

31 
	#CLONE_NEWUSER
 0x10000000

	)

32 
	#CLONE_NEWPID
 0x20000000

	)

33 
	#CLONE_NEWNET
 0x40000000

	)

34 
	#CLONE_IO
 0x80000000

	)

37 
	#CLONE_CLEAR_SIGHAND
 0x100000000ULL

	)

38 
	#CLONE_INTO_CGROUP
 0x200000000ULL

	)

44 
	#CLONE_NEWTIME
 0x00000080

	)

46 #i‚de‡
__ASSEMBLY__


92 
	s˛⁄e_¨gs
 {

93 
__Æig√d_u64
 
	mÊags
;

94 
__Æig√d_u64
 
	mpidfd
;

95 
__Æig√d_u64
 
	mchûd_tid
;

96 
__Æig√d_u64
 
	m∑ª¡_tid
;

97 
__Æig√d_u64
 
	mexô_sig«l
;

98 
__Æig√d_u64
 
	m°ack
;

99 
__Æig√d_u64
 
	m°ack_size
;

100 
__Æig√d_u64
 
	més
;

101 
__Æig√d_u64
 
	m£t_tid
;

102 
__Æig√d_u64
 
	m£t_tid_size
;

103 
__Æig√d_u64
 
	mcgroup
;

107 
	#CLONE_ARGS_SIZE_VER0
 64

	)

108 
	#CLONE_ARGS_SIZE_VER1
 80

	)

109 
	#CLONE_ARGS_SIZE_VER2
 88

	)

114 
	#SCHED_NORMAL
 0

	)

115 
	#SCHED_FIFO
 1

	)

116 
	#SCHED_RR
 2

	)

117 
	#SCHED_BATCH
 3

	)

119 
	#SCHED_IDLE
 5

	)

120 
	#SCHED_DEADLINE
 6

	)

123 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

128 
	#SCHED_FLAG_RESET_ON_FORK
 0x01

	)

129 
	#SCHED_FLAG_RECLAIM
 0x02

	)

130 
	#SCHED_FLAG_DL_OVERRUN
 0x04

	)

131 
	#SCHED_FLAG_KEEP_POLICY
 0x08

	)

132 
	#SCHED_FLAG_KEEP_PARAMS
 0x10

	)

133 
	#SCHED_FLAG_UTIL_CLAMP_MIN
 0x20

	)

134 
	#SCHED_FLAG_UTIL_CLAMP_MAX
 0x40

	)

136 
	#SCHED_FLAG_KEEP_ALL
 (
SCHED_FLAG_KEEP_POLICY
 | \

137 
SCHED_FLAG_KEEP_PARAMS
)

	)

139 
	#SCHED_FLAG_UTIL_CLAMP
 (
SCHED_FLAG_UTIL_CLAMP_MIN
 | \

140 
SCHED_FLAG_UTIL_CLAMP_MAX
)

	)

142 
	#SCHED_FLAG_ALL
 (
SCHED_FLAG_RESET_ON_FORK
 | \

143 
SCHED_FLAG_RECLAIM
 | \

144 
SCHED_FLAG_DL_OVERRUN
 | \

145 
SCHED_FLAG_KEEP_ALL
 | \

146 
SCHED_FLAG_UTIL_CLAMP
)

	)

	@/usr/include/linux/string.h

2 #i‚de‡
_LINUX_STRING_H_


3 
	#_LINUX_STRING_H_


	)

7 
	~<°rög.h
>

	@/usr/include/linux/tcp.h

18 #i‚de‡
_LINUX_TCP_H


19 
	#_LINUX_TCP_H


	)

21 
	~<löux/ty≥s.h
>

22 
	~<asm/byã‹dî.h
>

23 
	~<löux/sockë.h
>

25 
	st˝hdr
 {

26 
__be16
 
	msour˚
;

27 
__be16
 
	mde°
;

28 
__be32
 
	m£q
;

29 
__be32
 
	mack_£q
;

30 #i‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

31 
__u16
 
	mªs1
:4,

32 
	mdoff
:4,

33 
	mfö
:1,

34 
	msyn
:1,

35 
	mr°
:1,

36 
	mpsh
:1,

37 
	mack
:1,

38 
	murg
:1,

39 
	me˚
:1,

40 
	mcwr
:1;

41 #ñi‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

42 
__u16
 
	mdoff
:4,

43 
	mªs1
:4,

44 
	mcwr
:1,

45 
	me˚
:1,

46 
	murg
:1,

47 
	mack
:1,

48 
	mpsh
:1,

49 
	mr°
:1,

50 
	msyn
:1,

51 
	mfö
:1;

55 
__be16
 
	mwödow
;

56 
__sum16
 
	mcheck
;

57 
__be16
 
	murg_±r
;

65 
	ut˝_w‹d_hdr
 {

66 
t˝hdr
 
	mhdr
;

67 
__be32
 
	mw‹ds
[5];

70 
	#t˝_Êag_w‹d
(
ç
Ë(((
t˝_w‹d_hdr
 *)—p))->
w‹ds
[3])

	)

73 
	mTCP_FLAG_CWR
 = 
__c⁄°™t_˝u_to_be32
(0x00800000),

74 
	mTCP_FLAG_ECE
 = 
__c⁄°™t_˝u_to_be32
(0x00400000),

75 
	mTCP_FLAG_URG
 = 
__c⁄°™t_˝u_to_be32
(0x00200000),

76 
	mTCP_FLAG_ACK
 = 
__c⁄°™t_˝u_to_be32
(0x00100000),

77 
	mTCP_FLAG_PSH
 = 
__c⁄°™t_˝u_to_be32
(0x00080000),

78 
	mTCP_FLAG_RST
 = 
__c⁄°™t_˝u_to_be32
(0x00040000),

79 
	mTCP_FLAG_SYN
 = 
__c⁄°™t_˝u_to_be32
(0x00020000),

80 
	mTCP_FLAG_FIN
 = 
__c⁄°™t_˝u_to_be32
(0x00010000),

81 
	mTCP_RESERVED_BITS
 = 
__c⁄°™t_˝u_to_be32
(0x0F000000),

82 
	mTCP_DATA_OFFSET
 = 
__c⁄°™t_˝u_to_be32
(0xF0000000)

88 
	#TCP_MSS_DEFAULT
 536U

	)

89 
	#TCP_MSS_DESIRED
 1220U

	)

92 
	#TCP_NODELAY
 1

	)

93 
	#TCP_MAXSEG
 2

	)

94 
	#TCP_CORK
 3

	)

95 
	#TCP_KEEPIDLE
 4

	)

96 
	#TCP_KEEPINTVL
 5

	)

97 
	#TCP_KEEPCNT
 6

	)

98 
	#TCP_SYNCNT
 7

	)

99 
	#TCP_LINGER2
 8

	)

100 
	#TCP_DEFER_ACCEPT
 9

	)

101 
	#TCP_WINDOW_CLAMP
 10

	)

102 
	#TCP_INFO
 11

	)

103 
	#TCP_QUICKACK
 12

	)

104 
	#TCP_CONGESTION
 13

	)

105 
	#TCP_MD5SIG
 14

	)

106 
	#TCP_THIN_LINEAR_TIMEOUTS
 16

	)

107 
	#TCP_THIN_DUPACK
 17

	)

108 
	#TCP_USER_TIMEOUT
 18

	)

109 
	#TCP_REPAIR
 19

	)

110 
	#TCP_REPAIR_QUEUE
 20

	)

111 
	#TCP_QUEUE_SEQ
 21

	)

112 
	#TCP_REPAIR_OPTIONS
 22

	)

113 
	#TCP_FASTOPEN
 23

	)

114 
	#TCP_TIMESTAMP
 24

	)

115 
	#TCP_NOTSENT_LOWAT
 25

	)

116 
	#TCP_CC_INFO
 26

	)

117 
	#TCP_SAVE_SYN
 27

	)

118 
	#TCP_SAVED_SYN
 28

	)

119 
	#TCP_REPAIR_WINDOW
 29

	)

120 
	#TCP_FASTOPEN_CONNECT
 30

	)

121 
	#TCP_ULP
 31

	)

122 
	#TCP_MD5SIG_EXT
 32

	)

123 
	#TCP_FASTOPEN_KEY
 33

	)

124 
	#TCP_FASTOPEN_NO_COOKIE
 34

	)

125 
	#TCP_ZEROCOPY_RECEIVE
 35

	)

126 
	#TCP_INQ
 36

	)

128 
	#TCP_CM_INQ
 
TCP_INQ


	)

130 
	#TCP_TX_DELAY
 37

	)

133 
	#TCP_REPAIR_ON
 1

	)

134 
	#TCP_REPAIR_OFF
 0

	)

135 
	#TCP_REPAIR_OFF_NO_WP
 -1

	)

137 
	st˝_ª∑ú_›t
 {

138 
__u32
 
	m›t_code
;

139 
__u32
 
	m›t_vÆ
;

142 
	st˝_ª∑ú_wödow
 {

143 
__u32
 
	m¢d_wl1
;

144 
__u32
 
	m¢d_wnd
;

145 
__u32
 
	mmax_wödow
;

147 
__u32
 
	mrcv_wnd
;

148 
__u32
 
	mrcv_wup
;

152 
	mTCP_NO_QUEUE
,

153 
	mTCP_RECV_QUEUE
,

154 
	mTCP_SEND_QUEUE
,

155 
	mTCP_QUEUES_NR
,

159 
	et˝_Á°›í_˛õ¡_Áû
 {

160 
	mTFO_STATUS_UNSPEC
,

161 
	mTFO_COOKIE_UNAVAILABLE
,

162 
	mTFO_DATA_NOT_ACKED
,

163 
	mTFO_SYN_RETRANSMITTED
,

167 
	#TCPI_OPT_TIMESTAMPS
 1

	)

168 
	#TCPI_OPT_SACK
 2

	)

169 
	#TCPI_OPT_WSCALE
 4

	)

170 
	#TCPI_OPT_ECN
 8

	)

171 
	#TCPI_OPT_ECN_SEEN
 16

	)

172 
	#TCPI_OPT_SYN_DATA
 32

	)

179 
	et˝_ˇ_°©e
 {

184 
	mTCP_CA_O≥n
 = 0,

185 
	#TCPF_CA_O≥n
 (1<<
TCP_CA_O≥n
)

	)

192 
	mTCP_CA_Dis‹dî
 = 1,

193 
	#TCPF_CA_Dis‹dî
 (1<<
TCP_CA_Dis‹dî
)

	)

199 
	mTCP_CA_CWR
 = 2,

200 
	#TCPF_CA_CWR
 (1<<
TCP_CA_CWR
)

	)

205 
	mTCP_CA_Recovîy
 = 3,

206 
	#TCPF_CA_Recovîy
 (1<<
TCP_CA_Recovîy
)

	)

210 
	mTCP_CA_Loss
 = 4

211 
	#TCPF_CA_Loss
 (1<<
TCP_CA_Loss
)

	)

214 
	st˝_öfo
 {

215 
__u8
 
	mt˝i_°©e
;

216 
__u8
 
	mt˝i_ˇ_°©e
;

217 
__u8
 
	mt˝i_ªå™smôs
;

218 
__u8
 
	mt˝i_¥obes
;

219 
__u8
 
	mt˝i_backoff
;

220 
__u8
 
	mt˝i_›ti⁄s
;

221 
__u8
 
	mt˝i_¢d_wsˇÀ
 : 4, 
	mt˝i_rcv_wsˇÀ
 : 4;

222 
__u8
 
	mt˝i_dñivîy_øã_≠p_limôed
:1, 
	mt˝i_Á°›í_˛õ¡_Áû
:2;

224 
__u32
 
	mt˝i_πo
;

225 
__u32
 
	mt˝i_©o
;

226 
__u32
 
	mt˝i_¢d_mss
;

227 
__u32
 
	mt˝i_rcv_mss
;

229 
__u32
 
	mt˝i_u«cked
;

230 
__u32
 
	mt˝i_ßcked
;

231 
__u32
 
	mt˝i_lo°
;

232 
__u32
 
	mt˝i_ªå™s
;

233 
__u32
 
	mt˝i_Áckës
;

236 
__u32
 
	mt˝i_œ°_d©a_£¡
;

237 
__u32
 
	mt˝i_œ°_ack_£¡
;

238 
__u32
 
	mt˝i_œ°_d©a_ªcv
;

239 
__u32
 
	mt˝i_œ°_ack_ªcv
;

242 
__u32
 
	mt˝i_pmtu
;

243 
__u32
 
	mt˝i_rcv_s°hªsh
;

244 
__u32
 
	mt˝i_πt
;

245 
__u32
 
	mt˝i_πtv¨
;

246 
__u32
 
	mt˝i_¢d_s°hªsh
;

247 
__u32
 
	mt˝i_¢d_cwnd
;

248 
__u32
 
	mt˝i_advmss
;

249 
__u32
 
	mt˝i_ª‹dîög
;

251 
__u32
 
	mt˝i_rcv_πt
;

252 
__u32
 
	mt˝i_rcv_•a˚
;

254 
__u32
 
	mt˝i_tŸÆ_ªå™s
;

256 
__u64
 
	mt˝i_∑cög_øã
;

257 
__u64
 
	mt˝i_max_∑cög_øã
;

258 
__u64
 
	mt˝i_byãs_acked
;

259 
__u64
 
	mt˝i_byãs_ª˚ived
;

260 
__u32
 
	mt˝i_£gs_out
;

261 
__u32
 
	mt˝i_£gs_ö
;

263 
__u32
 
	mt˝i_nŸ£¡_byãs
;

264 
__u32
 
	mt˝i_mö_πt
;

265 
__u32
 
	mt˝i_d©a_£gs_ö
;

266 
__u32
 
	mt˝i_d©a_£gs_out
;

268 
__u64
 
	mt˝i_dñivîy_øã
;

270 
__u64
 
	mt˝i_busy_time
;

271 
__u64
 
	mt˝i_rwnd_limôed
;

272 
__u64
 
	mt˝i_¢dbuf_limôed
;

274 
__u32
 
	mt˝i_dñivîed
;

275 
__u32
 
	mt˝i_dñivîed_˚
;

277 
__u64
 
	mt˝i_byãs_£¡
;

278 
__u64
 
	mt˝i_byãs_ªå™s
;

279 
__u32
 
	mt˝i_dßck_dups
;

280 
__u32
 
	mt˝i_ª‹d_£í
;

282 
__u32
 
	mt˝i_rcv_oo›ack
;

284 
__u32
 
	mt˝i_¢d_wnd
;

291 
	mTCP_NLA_PAD
,

292 
	mTCP_NLA_BUSY
,

293 
	mTCP_NLA_RWND_LIMITED
,

294 
	mTCP_NLA_SNDBUF_LIMITED
,

295 
	mTCP_NLA_DATA_SEGS_OUT
,

296 
	mTCP_NLA_TOTAL_RETRANS
,

297 
	mTCP_NLA_PACING_RATE
,

298 
	mTCP_NLA_DELIVERY_RATE
,

299 
	mTCP_NLA_SND_CWND
,

300 
	mTCP_NLA_REORDERING
,

301 
	mTCP_NLA_MIN_RTT
,

302 
	mTCP_NLA_RECUR_RETRANS
,

303 
	mTCP_NLA_DELIVERY_RATE_APP_LMT
,

304 
	mTCP_NLA_SNDQ_SIZE
,

305 
	mTCP_NLA_CA_STATE
,

306 
	mTCP_NLA_SND_SSTHRESH
,

307 
	mTCP_NLA_DELIVERED
,

308 
	mTCP_NLA_DELIVERED_CE
,

309 
	mTCP_NLA_BYTES_SENT
,

310 
	mTCP_NLA_BYTES_RETRANS
,

311 
	mTCP_NLA_DSACK_DUPS
,

312 
	mTCP_NLA_REORD_SEEN
,

313 
	mTCP_NLA_SRTT
,

314 
	mTCP_NLA_TIMEOUT_REHASH
,

315 
	mTCP_NLA_BYTES_NOTSENT
,

316 
	mTCP_NLA_EDT
,

317 
	mTCP_NLA_TTL
,

321 
	#TCP_MD5SIG_MAXKEYLEN
 80

	)

324 
	#TCP_MD5SIG_FLAG_PREFIX
 0x1

	)

325 
	#TCP_MD5SIG_FLAG_IFINDEX
 0x2

	)

327 
	st˝_md5sig
 {

328 
__kî√l_sockaddr_°‹age
 
	mt˝m_addr
;

329 
__u8
 
	mt˝m_Êags
;

330 
__u8
 
	mt˝m_¥efixÀn
;

331 
__u16
 
	mt˝m_keyÀn
;

332 
	mt˝m_ifödex
;

333 
__u8
 
	mt˝m_key
[
TCP_MD5SIG_MAXKEYLEN
];

337 
	st˝_düg_md5sig
 {

338 
__u8
 
	mt˝m_Ámûy
;

339 
__u8
 
	mt˝m_¥efixÀn
;

340 
__u16
 
	mt˝m_keyÀn
;

341 
__be32
 
	mt˝m_addr
[4];

342 
__u8
 
	mt˝m_key
[
TCP_MD5SIG_MAXKEYLEN
];

347 
	#TCP_RECEIVE_ZEROCOPY_FLAG_TLB_CLEAN_HINT
 0x1

	)

348 
	st˝_zîoc›y_ª˚ive
 {

349 
__u64
 
	maddªss
;

350 
__u32
 
	mÀngth
;

351 
__u32
 
	mªcv_skù_höt
;

352 
__u32
 
	möq
;

353 
__s32
 
	mîr
;

354 
__u64
 
	mc›ybuf_addªss
;

355 
__s32
 
	mc›ybuf_Àn
;

356 
__u32
 
	mÊags
;

357 
__u64
 
	mmsg_c⁄åﬁ
;

358 
__u64
 
	mmsg_c⁄åﬁÀn
;

359 
__u32
 
	mmsg_Êags
;

360 
__u32
 
	mª£rved
;

	@/usr/include/linux/thermal.h

2 #i‚de‡
_LINUX_THERMAL_H


3 
	#_LINUX_THERMAL_H


	)

5 
	#THERMAL_NAME_LENGTH
 20

	)

7 
	ethîmÆ_devi˚_mode
 {

8 
	mTHERMAL_DEVICE_DISABLED
 = 0,

9 
	mTHERMAL_DEVICE_ENABLED
,

12 
	ethîmÆ_åù_ty≥
 {

13 
	mTHERMAL_TRIP_ACTIVE
 = 0,

14 
	mTHERMAL_TRIP_PASSIVE
,

15 
	mTHERMAL_TRIP_HOT
,

16 
	mTHERMAL_TRIP_CRITICAL
,

20 
	#THERMAL_GENL_FAMILY_NAME
 "thîmÆ"

	)

21 
	#THERMAL_GENL_VERSION
 0x01

	)

22 
	#THERMAL_GENL_SAMPLING_GROUP_NAME
 "ßm∂ög"

	)

23 
	#THERMAL_GENL_EVENT_GROUP_NAME
 "evít"

	)

26 
	ethîmÆ_gíl_©å
 {

27 
	mTHERMAL_GENL_ATTR_UNSPEC
,

28 
	mTHERMAL_GENL_ATTR_TZ
,

29 
	mTHERMAL_GENL_ATTR_TZ_ID
,

30 
	mTHERMAL_GENL_ATTR_TZ_TEMP
,

31 
	mTHERMAL_GENL_ATTR_TZ_TRIP
,

32 
	mTHERMAL_GENL_ATTR_TZ_TRIP_ID
,

33 
	mTHERMAL_GENL_ATTR_TZ_TRIP_TYPE
,

34 
	mTHERMAL_GENL_ATTR_TZ_TRIP_TEMP
,

35 
	mTHERMAL_GENL_ATTR_TZ_TRIP_HYST
,

36 
	mTHERMAL_GENL_ATTR_TZ_MODE
,

37 
	mTHERMAL_GENL_ATTR_TZ_NAME
,

38 
	mTHERMAL_GENL_ATTR_TZ_CDEV_WEIGHT
,

39 
	mTHERMAL_GENL_ATTR_TZ_GOV
,

40 
	mTHERMAL_GENL_ATTR_TZ_GOV_NAME
,

41 
	mTHERMAL_GENL_ATTR_CDEV
,

42 
	mTHERMAL_GENL_ATTR_CDEV_ID
,

43 
	mTHERMAL_GENL_ATTR_CDEV_CUR_STATE
,

44 
	mTHERMAL_GENL_ATTR_CDEV_MAX_STATE
,

45 
	mTHERMAL_GENL_ATTR_CDEV_NAME
,

46 
	mTHERMAL_GENL_ATTR_GOV_NAME
,

48 
	m__THERMAL_GENL_ATTR_MAX
,

50 
	#THERMAL_GENL_ATTR_MAX
 (
__THERMAL_GENL_ATTR_MAX
 - 1)

	)

52 
	ethîmÆ_gíl_ßm∂ög
 {

53 
	mTHERMAL_GENL_SAMPLING_TEMP
,

54 
	m__THERMAL_GENL_SAMPLING_MAX
,

56 
	#THERMAL_GENL_SAMPLING_MAX
 (
__THERMAL_GENL_SAMPLING_MAX
 - 1)

	)

59 
	ethîmÆ_gíl_evít
 {

60 
	mTHERMAL_GENL_EVENT_UNSPEC
,

61 
	mTHERMAL_GENL_EVENT_TZ_CREATE
,

62 
	mTHERMAL_GENL_EVENT_TZ_DELETE
,

63 
	mTHERMAL_GENL_EVENT_TZ_DISABLE
,

64 
	mTHERMAL_GENL_EVENT_TZ_ENABLE
,

65 
	mTHERMAL_GENL_EVENT_TZ_TRIP_UP
,

66 
	mTHERMAL_GENL_EVENT_TZ_TRIP_DOWN
,

67 
	mTHERMAL_GENL_EVENT_TZ_TRIP_CHANGE
,

68 
	mTHERMAL_GENL_EVENT_TZ_TRIP_ADD
,

69 
	mTHERMAL_GENL_EVENT_TZ_TRIP_DELETE
,

70 
	mTHERMAL_GENL_EVENT_CDEV_ADD
,

71 
	mTHERMAL_GENL_EVENT_CDEV_DELETE
,

72 
	mTHERMAL_GENL_EVENT_CDEV_STATE_UPDATE
,

73 
	mTHERMAL_GENL_EVENT_TZ_GOV_CHANGE
,

74 
	m__THERMAL_GENL_EVENT_MAX
,

76 
	#THERMAL_GENL_EVENT_MAX
 (
__THERMAL_GENL_EVENT_MAX
 - 1)

	)

79 
	ethîmÆ_gíl_cmd
 {

80 
	mTHERMAL_GENL_CMD_UNSPEC
,

81 
	mTHERMAL_GENL_CMD_TZ_GET_ID
,

82 
	mTHERMAL_GENL_CMD_TZ_GET_TRIP
,

83 
	mTHERMAL_GENL_CMD_TZ_GET_TEMP
,

84 
	mTHERMAL_GENL_CMD_TZ_GET_GOV
,

85 
	mTHERMAL_GENL_CMD_TZ_GET_MODE
,

86 
	mTHERMAL_GENL_CMD_CDEV_GET
,

87 
	m__THERMAL_GENL_CMD_MAX
,

89 
	#THERMAL_GENL_CMD_MAX
 (
__THERMAL_GENL_CMD_MAX
 - 1)

	)

	@/usr/include/linux/time.h

2 #i‚de‡
_LINUX_TIME_H


3 
	#_LINUX_TIME_H


	)

5 
	~<löux/ty≥s.h
>

6 
	~<löux/time_ty≥s.h
>

8 #i‚de‡
_STRUCT_TIMESPEC


9 
	#_STRUCT_TIMESPEC


	)

10 
	stime•ec
 {

11 
__kî√l_ﬁd_time_t
 
	mtv_£c
;

12 
	mtv_n£c
;

16 
	stimevÆ
 {

17 
__kî√l_ﬁd_time_t
 
	mtv_£c
;

18 
__kî√l_su£c⁄ds_t
 
	mtv_u£c
;

21 
	sôimî•ec
 {

22 
time•ec
 
	mô_öãrvÆ
;

23 
time•ec
 
	mô_vÆue
;

26 
	sôimîvÆ
 {

27 
timevÆ
 
	mô_öãrvÆ
;

28 
timevÆ
 
	mô_vÆue
;

31 
	stimez⁄e
 {

32 
	mtz_möuãswe°
;

33 
	mtz_d°time
;

40 
	#ITIMER_REAL
 0

	)

41 
	#ITIMER_VIRTUAL
 1

	)

42 
	#ITIMER_PROF
 2

	)

47 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

49 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

50 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

51 
	#CLOCK_MONOTONIC_RAW
 4

	)

52 
	#CLOCK_REALTIME_COARSE
 5

	)

53 
	#CLOCK_MONOTONIC_COARSE
 6

	)

54 
	#CLOCK_BOOTTIME
 7

	)

55 
	#CLOCK_REALTIME_ALARM
 8

	)

56 
	#CLOCK_BOOTTIME_ALARM
 9

	)

61 
	#CLOCK_SGI_CYCLE
 10

	)

62 
	#CLOCK_TAI
 11

	)

64 
	#MAX_CLOCKS
 16

	)

65 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

66 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

71 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/linux/types.h

2 #i‚de‡
_LINUX_TYPES_H


3 
	#_LINUX_TYPES_H


	)

5 
	~<asm/ty≥s.h
>

7 #i‚de‡
__ASSEMBLY__


9 
	~<löux/posix_ty≥s.h
>

17 #ifde‡
__CHECKER__


18 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

20 
	#__bôwi£__


	)

22 
	#__bôwi£
 
__bôwi£__


	)

24 
__u16
 
	t__bôwi£
 
	t__À16
;

25 
__u16
 
	t__bôwi£
 
	t__be16
;

26 
__u32
 
	t__bôwi£
 
	t__À32
;

27 
__u32
 
	t__bôwi£
 
	t__be32
;

28 
__u64
 
	t__bôwi£
 
	t__À64
;

29 
__u64
 
	t__bôwi£
 
	t__be64
;

31 
__u16
 
	t__bôwi£
 
	t__sum16
;

32 
__u32
 
	t__bôwi£
 
	t__wsum
;

43 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

44 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

45 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	t__bôwi£
 
	t__pﬁl_t
;

	@/usr/include/linux/udp.h

18 #i‚de‡
_LINUX_UDP_H


19 
	#_LINUX_UDP_H


	)

21 
	~<löux/ty≥s.h
>

23 
	sudphdr
 {

24 
__be16
 
	msour˚
;

25 
__be16
 
	mde°
;

26 
__be16
 
	mÀn
;

27 
__sum16
 
	mcheck
;

31 
	#UDP_CORK
 1

	)

32 
	#UDP_ENCAP
 100

	)

33 
	#UDP_NO_CHECK6_TX
 101

	)

34 
	#UDP_NO_CHECK6_RX
 102

	)

35 
	#UDP_SEGMENT
 103

	)

36 
	#UDP_GRO
 104

	)

39 
	#UDP_ENCAP_ESPINUDP_NON_IKE
 1

	)

40 
	#UDP_ENCAP_ESPINUDP
 2

	)

41 
	#UDP_ENCAP_L2TPINUDP
 3

	)

42 
	#UDP_ENCAP_GTP0
 4

	)

43 
	#UDP_ENCAP_GTP1U
 5

	)

44 
	#UDP_ENCAP_RXRPC
 6

	)

45 
	#TCP_ENCAP_ESPINTCP
 7

	)

	@/usr/include/linux/uuid.h

18 #i‚de‡
_LINUX_UUID_H_


19 
	#_LINUX_UUID_H_


	)

21 
	~<löux/ty≥s.h
>

24 
__u8
 
	mb
[16];

25 } 
	tguid_t
;

27 
	#GUID_INIT
(
a
, 
b
, 
c
, 
d0
, 
d1
, 
d2
, 
d3
, 
d4
, 
d5
, 
d6
, 
d7
) \

28 ((
guid_t
) \

29 {{ (
a
) & 0xff, ((a) >> 8) & 0xff, ((a) >> 16) & 0xff, ((a) >> 24) & 0xff, \

30 (
b
) & 0xff, ((b) >> 8) & 0xff, \

31 (
c
) & 0xff, ((c) >> 8) & 0xff, \

32 (
d0
), (
d1
), (
d2
), (
d3
), (
d4
), (
d5
), (
d6
), (
d7
Ë}})

	)

35 
guid_t
 
	tuuid_À
;

36 
	#UUID_LE
(
a
, 
b
, 
c
, 
d0
, 
d1
, 
d2
, 
d3
, 
d4
, 
d5
, 
d6
, 
d7
) \

37 
	`GUID_INIT
(
a
, 
b
, 
c
, 
d0
, 
d1
, 
d2
, 
d3
, 
d4
, 
d5
, 
d6
, 
d7
)

	)

38 
	#NULL_UUID_LE
 \

39 
	`UUID_LE
(0x00000000, 0x0000, 0x0000, 0x00, 0x00, 0x00, 0x00, \

40 0x00, 0x00, 0x00, 0x00)

	)

	@/usr/include/linux/wait.h

2 #i‚de‡
_LINUX_WAIT_H


3 
	#_LINUX_WAIT_H


	)

5 
	#WNOHANG
 0x00000001

	)

6 
	#WUNTRACED
 0x00000002

	)

7 
	#WSTOPPED
 
WUNTRACED


	)

8 
	#WEXITED
 0x00000004

	)

9 
	#WCONTINUED
 0x00000008

	)

10 
	#WNOWAIT
 0x01000000

	)

12 
	#__WNOTHREAD
 0x20000000

	)

13 
	#__WALL
 0x40000000

	)

14 
	#__WCLONE
 0x80000000

	)

17 
	#P_ALL
 0

	)

18 
	#P_PID
 1

	)

19 
	#P_PGID
 2

	)

20 
	#P_PIDFD
 3

	)

	@/usr/include/linux/const.h

4 #i‚de‡
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifde‡
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
Ë
	)
X

18 
	#_AT
(
T
,
X
Ë
	)
X

20 
	#__AC
(
X
,
Y
Ë(X##Y)

	)

21 
	#_AC
(
X
,
Y
Ë
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
Ë((T)(X))

	)

25 
	#_UL
(
x
Ë(
	`_AC
(x, 
UL
))

	)

26 
	#_ULL
(
x
Ë(
	`_AC
(x, 
ULL
))

	)

28 
	#_BITUL
(
x
Ë(
	`_UL
(1Ë<< (x))

	)

29 
	#_BITULL
(
x
Ë(
	`_ULL
(1Ë<< (x))

	)

31 
	#__ALIGN_KERNEL
(
x
, 
a
Ë
	`__ALIGN_KERNEL_MASK
(x, (
	`__ty≥of__
(x))◊Ë- 1)

	)

32 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

34 
	#__KERNEL_DIV_ROUND_UP
(
n
, 
d
Ë((“Ë+ (dË- 1Ë/ (d))

	)

	@/usr/include/linux/fscrypt.h

8 #i‚de‡
_LINUX_FSCRYPT_H


9 
	#_LINUX_FSCRYPT_H


	)

11 
	~<löux/io˘l.h
>

12 
	~<löux/ty≥s.h
>

15 
	#FSCRYPT_POLICY_FLAGS_PAD_4
 0x00

	)

16 
	#FSCRYPT_POLICY_FLAGS_PAD_8
 0x01

	)

17 
	#FSCRYPT_POLICY_FLAGS_PAD_16
 0x02

	)

18 
	#FSCRYPT_POLICY_FLAGS_PAD_32
 0x03

	)

19 
	#FSCRYPT_POLICY_FLAGS_PAD_MASK
 0x03

	)

20 
	#FSCRYPT_POLICY_FLAG_DIRECT_KEY
 0x04

	)

21 
	#FSCRYPT_POLICY_FLAG_IV_INO_LBLK_64
 0x08

	)

22 
	#FSCRYPT_POLICY_FLAG_IV_INO_LBLK_32
 0x10

	)

25 
	#FSCRYPT_MODE_AES_256_XTS
 1

	)

26 
	#FSCRYPT_MODE_AES_256_CTS
 4

	)

27 
	#FSCRYPT_MODE_AES_128_CBC
 5

	)

28 
	#FSCRYPT_MODE_AES_128_CTS
 6

	)

29 
	#FSCRYPT_MODE_ADIANTUM
 9

	)

38 
	#FSCRYPT_POLICY_V1
 0

	)

39 
	#FSCRYPT_KEY_DESCRIPTOR_SIZE
 8

	)

40 
	sfs¸y±_pﬁicy_v1
 {

41 
__u8
 
	mvîsi⁄
;

42 
__u8
 
	mc⁄ã¡s_í¸y±i⁄_mode
;

43 
__u8
 
	mfûíames_í¸y±i⁄_mode
;

44 
__u8
 
	mÊags
;

45 
__u8
 
	mma°î_key_des¸ùt‹
[
FSCRYPT_KEY_DESCRIPTOR_SIZE
];

52 
	#FSCRYPT_KEY_DESC_PREFIX
 "fs¸y±:"

	)

53 
	#FSCRYPT_KEY_DESC_PREFIX_SIZE
 8

	)

54 
	#FSCRYPT_MAX_KEY_SIZE
 64

	)

55 
	sfs¸y±_key
 {

56 
__u32
 
	mmode
;

57 
__u8
 
	møw
[
FSCRYPT_MAX_KEY_SIZE
];

58 
__u32
 
	msize
;

64 
	#FSCRYPT_POLICY_V2
 2

	)

65 
	#FSCRYPT_KEY_IDENTIFIER_SIZE
 16

	)

66 
	sfs¸y±_pﬁicy_v2
 {

67 
__u8
 
	mvîsi⁄
;

68 
__u8
 
	mc⁄ã¡s_í¸y±i⁄_mode
;

69 
__u8
 
	mfûíames_í¸y±i⁄_mode
;

70 
__u8
 
	mÊags
;

71 
__u8
 
	m__ª£rved
[4];

72 
__u8
 
	mma°î_key_idítifõr
[
FSCRYPT_KEY_IDENTIFIER_SIZE
];

76 
	sfs¸y±_gë_pﬁicy_ex_¨g
 {

77 
__u64
 
	mpﬁicy_size
;

79 
__u8
 
	mvîsi⁄
;

80 
fs¸y±_pﬁicy_v1
 
	mv1
;

81 
fs¸y±_pﬁicy_v2
 
	mv2
;

82 } 
	mpﬁicy
;

89 
	#FSCRYPT_KEY_SPEC_TYPE_DESCRIPTOR
 1

	)

96 
	#FSCRYPT_KEY_SPEC_TYPE_IDENTIFIER
 2

	)

102 
	sfs¸y±_key_•ecifõr
 {

103 
__u32
 
	mty≥
;

104 
__u32
 
	m__ª£rved
;

106 
__u8
 
	m__ª£rved
[32];

107 
__u8
 
	mdes¸ùt‹
[
FSCRYPT_KEY_DESCRIPTOR_SIZE
];

108 
__u8
 
	midítifõr
[
FSCRYPT_KEY_IDENTIFIER_SIZE
];

109 } 
	mu
;

116 
	sfs¸y±_¥ovisi⁄ög_key_∑ylﬂd
 {

117 
__u32
 
	mty≥
;

118 
__u32
 
	m__ª£rved
;

119 
__u8
 
	møw
[];

123 
	sfs¸y±_add_key_¨g
 {

124 
fs¸y±_key_•ecifõr
 
	mkey_•ec
;

125 
__u32
 
	møw_size
;

126 
__u32
 
	mkey_id
;

127 
__u32
 
	m__ª£rved
[8];

128 
__u8
 
	møw
[];

132 
	sfs¸y±_ªmove_key_¨g
 {

133 
fs¸y±_key_•ecifõr
 
	mkey_•ec
;

134 
	#FSCRYPT_KEY_REMOVAL_STATUS_FLAG_FILES_BUSY
 0x00000001

	)

135 
	#FSCRYPT_KEY_REMOVAL_STATUS_FLAG_OTHER_USERS
 0x00000002

	)

136 
__u32
 
	mªmovÆ_°©us_Êags
;

137 
__u32
 
	m__ª£rved
[5];

141 
	sfs¸y±_gë_key_°©us_¨g
 {

143 
fs¸y±_key_•ecifõr
 
	mkey_•ec
;

144 
__u32
 
	m__ª£rved
[6];

147 
	#FSCRYPT_KEY_STATUS_ABSENT
 1

	)

148 
	#FSCRYPT_KEY_STATUS_PRESENT
 2

	)

149 
	#FSCRYPT_KEY_STATUS_INCOMPLETELY_REMOVED
 3

	)

150 
__u32
 
	m°©us
;

151 
	#FSCRYPT_KEY_STATUS_FLAG_ADDED_BY_SELF
 0x00000001

	)

152 
__u32
 
	m°©us_Êags
;

153 
__u32
 
	mu£r_cou¡
;

154 
__u32
 
	m__out_ª£rved
[13];

157 
	#FS_IOC_SET_ENCRYPTION_POLICY
 
	`_IOR
('f', 19, 
fs¸y±_pﬁicy_v1
)

	)

158 
	#FS_IOC_GET_ENCRYPTION_PWSALT
 
	`_IOW
('f', 20, 
__u8
[16])

	)

159 
	#FS_IOC_GET_ENCRYPTION_POLICY
 
	`_IOW
('f', 21, 
fs¸y±_pﬁicy_v1
)

	)

160 
	#FS_IOC_GET_ENCRYPTION_POLICY_EX
 
	`_IOWR
('f', 22, 
__u8
[9]Ë

	)

161 
	#FS_IOC_ADD_ENCRYPTION_KEY
 
	`_IOWR
('f', 23, 
fs¸y±_add_key_¨g
)

	)

162 
	#FS_IOC_REMOVE_ENCRYPTION_KEY
 
	`_IOWR
('f', 24, 
fs¸y±_ªmove_key_¨g
)

	)

163 
	#FS_IOC_REMOVE_ENCRYPTION_KEY_ALL_USERS
 
	`_IOWR
('f', 25, 
fs¸y±_ªmove_key_¨g
)

	)

164 
	#FS_IOC_GET_ENCRYPTION_KEY_STATUS
 
	`_IOWR
('f', 26, 
fs¸y±_gë_key_°©us_¨g
)

	)

165 
	#FS_IOC_GET_ENCRYPTION_NONCE
 
	`_IOR
('f', 27, 
__u8
[16])

	)

170 
	#fs¸y±_pﬁicy
 
fs¸y±_pﬁicy_v1


	)

171 
	#FS_KEY_DESCRIPTOR_SIZE
 
FSCRYPT_KEY_DESCRIPTOR_SIZE


	)

172 
	#FS_POLICY_FLAGS_PAD_4
 
FSCRYPT_POLICY_FLAGS_PAD_4


	)

173 
	#FS_POLICY_FLAGS_PAD_8
 
FSCRYPT_POLICY_FLAGS_PAD_8


	)

174 
	#FS_POLICY_FLAGS_PAD_16
 
FSCRYPT_POLICY_FLAGS_PAD_16


	)

175 
	#FS_POLICY_FLAGS_PAD_32
 
FSCRYPT_POLICY_FLAGS_PAD_32


	)

176 
	#FS_POLICY_FLAGS_PAD_MASK
 
FSCRYPT_POLICY_FLAGS_PAD_MASK


	)

177 
	#FS_POLICY_FLAG_DIRECT_KEY
 
FSCRYPT_POLICY_FLAG_DIRECT_KEY


	)

178 
	#FS_POLICY_FLAGS_VALID
 0x07

	)

179 
	#FS_ENCRYPTION_MODE_INVALID
 0

	)

180 
	#FS_ENCRYPTION_MODE_AES_256_XTS
 
FSCRYPT_MODE_AES_256_XTS


	)

181 
	#FS_ENCRYPTION_MODE_AES_256_GCM
 2

	)

182 
	#FS_ENCRYPTION_MODE_AES_256_CBC
 3

	)

183 
	#FS_ENCRYPTION_MODE_AES_256_CTS
 
FSCRYPT_MODE_AES_256_CTS


	)

184 
	#FS_ENCRYPTION_MODE_AES_128_CBC
 
FSCRYPT_MODE_AES_128_CBC


	)

185 
	#FS_ENCRYPTION_MODE_AES_128_CTS
 
FSCRYPT_MODE_AES_128_CTS


	)

186 
	#FS_ENCRYPTION_MODE_SPECK128_256_XTS
 7

	)

187 
	#FS_ENCRYPTION_MODE_SPECK128_256_CTS
 8

	)

188 
	#FS_ENCRYPTION_MODE_ADIANTUM
 
FSCRYPT_MODE_ADIANTUM


	)

189 
	#FS_KEY_DESC_PREFIX
 
FSCRYPT_KEY_DESC_PREFIX


	)

190 
	#FS_KEY_DESC_PREFIX_SIZE
 
FSCRYPT_KEY_DESC_PREFIX_SIZE


	)

191 
	#FS_MAX_KEY_SIZE
 
FSCRYPT_MAX_KEY_SIZE


	)

	@/usr/include/linux/if.h

20 #i‚de‡
_LINUX_IF_H


21 
	#_LINUX_IF_H


	)

23 
	~<löux/libc-com∑t.h
>

24 
	~<löux/ty≥s.h
>

25 
	~<löux/sockë.h
>

28 
	~<sys/sockë.h
>

30 #i‡
__UAPI_DEF_IF_IFNAMSIZ


31 
	#IFNAMSIZ
 16

	)

33 
	#IFALIASZ
 256

	)

34 
	#ALTIFNAMSIZ
 128

	)

35 
	~<löux/hdlc/io˘l.h
>

38 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 != 0 || \

39 
	g__UAPI_DEF_IF_NET_DEVICE_FLAGS
 != 0

80 
	e√t_devi˚_Êags
 {

82 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


83 
IFF_UP
 = 1<<0,

84 
	mIFF_BROADCAST
 = 1<<1,

85 
	mIFF_DEBUG
 = 1<<2,

86 
	mIFF_LOOPBACK
 = 1<<3,

87 
	mIFF_POINTOPOINT
 = 1<<4,

88 
	mIFF_NOTRAILERS
 = 1<<5,

89 
	mIFF_RUNNING
 = 1<<6,

90 
	mIFF_NOARP
 = 1<<7,

91 
	mIFF_PROMISC
 = 1<<8,

92 
	mIFF_ALLMULTI
 = 1<<9,

93 
	mIFF_MASTER
 = 1<<10,

94 
	mIFF_SLAVE
 = 1<<11,

95 
	mIFF_MULTICAST
 = 1<<12,

96 
	mIFF_PORTSEL
 = 1<<13,

97 
	mIFF_AUTOMEDIA
 = 1<<14,

98 
	mIFF_DYNAMIC
 = 1<<15,

100 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


101 
	mIFF_LOWER_UP
 = 1<<16,

102 
	mIFF_DORMANT
 = 1<<17,

103 
	mIFF_ECHO
 = 1<<18,

109 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


110 
	#IFF_UP
 
IFF_UP


	)

111 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

112 
	#IFF_DEBUG
 
IFF_DEBUG


	)

113 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

114 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

115 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

116 
	#IFF_RUNNING
 
IFF_RUNNING


	)

117 
	#IFF_NOARP
 
IFF_NOARP


	)

118 
	#IFF_PROMISC
 
IFF_PROMISC


	)

119 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

120 
	#IFF_MASTER
 
IFF_MASTER


	)

121 
	#IFF_SLAVE
 
IFF_SLAVE


	)

122 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

123 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

124 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

125 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

128 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


129 
	#IFF_LOWER_UP
 
IFF_LOWER_UP


	)

130 
	#IFF_DORMANT
 
IFF_DORMANT


	)

131 
	#IFF_ECHO
 
IFF_ECHO


	)

134 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

135 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

137 
	#IF_GET_IFACE
 0x0001

	)

138 
	#IF_GET_PROTO
 0x0002

	)

141 
	#IF_IFACE_V35
 0x1000

	)

142 
	#IF_IFACE_V24
 0x1001

	)

143 
	#IF_IFACE_X21
 0x1002

	)

144 
	#IF_IFACE_T1
 0x1003

	)

145 
	#IF_IFACE_E1
 0x1004

	)

146 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

147 
	#IF_IFACE_X21D
 0x1006

	)

150 
	#IF_PROTO_HDLC
 0x2000

	)

151 
	#IF_PROTO_PPP
 0x2001

	)

152 
	#IF_PROTO_CISCO
 0x2002

	)

153 
	#IF_PROTO_FR
 0x2003

	)

154 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

155 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

156 
	#IF_PROTO_X25
 0x2006

	)

157 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

158 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

159 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

160 
	#IF_PROTO_FR_PVC
 0x200A

	)

161 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

162 
	#IF_PROTO_RAW
 0x200C

	)

166 
	mIF_OPER_UNKNOWN
,

167 
	mIF_OPER_NOTPRESENT
,

168 
	mIF_OPER_DOWN
,

169 
	mIF_OPER_LOWERLAYERDOWN
,

170 
	mIF_OPER_TESTING
,

171 
	mIF_OPER_DORMANT
,

172 
	mIF_OPER_UP
,

177 
	mIF_LINK_MODE_DEFAULT
,

178 
	mIF_LINK_MODE_DORMANT
,

179 
	mIF_LINK_MODE_TESTING
,

193 #i‡
__UAPI_DEF_IF_IFMAP


194 
	sifm≠
 {

195 
	mmem_°¨t
;

196 
	mmem_íd
;

197 
	mba£_addr
;

198 
	múq
;

199 
	mdma
;

200 
	mp‹t
;

205 
	sif_£âögs
 {

206 
	mty≥
;

207 
	msize
;

210 
øw_hdlc_¥Ÿo
 *
	møw_hdlc
;

211 
cisco_¥Ÿo
 *
	mcisco
;

212 
‰_¥Ÿo
 *
	m‰
;

213 
‰_¥Ÿo_pvc
 *
	m‰_pvc
;

214 
‰_¥Ÿo_pvc_öfo
 *
	m‰_pvc_öfo
;

215 
x25_hdlc_¥Ÿo
 *
	mx25
;

218 
sync_£rül_£âögs
 *
	msync
;

219 
ã1_£âögs
 *
	mã1
;

220 } 
	mifs_ifsu
;

231 #i‡
__UAPI_DEF_IF_IFREQ


232 
	si‰eq
 {

233 
	#IFHWADDRLEN
 6

	)

236 
	mi‰n_«me
[
IFNAMSIZ
];

237 } 
	mi‰_i‰n
;

240 
sockaddr
 
	mi‰u_addr
;

241 
sockaddr
 
	mi‰u_d°addr
;

242 
sockaddr
 
	mi‰u_brﬂdaddr
;

243 
sockaddr
 
	mi‰u_√tmask
;

244 
sockaddr
 
	mi‰u_hwaddr
;

245 
	mi‰u_Êags
;

246 
	mi‰u_ivÆue
;

247 
	mi‰u_mtu
;

248 
ifm≠
 
	mi‰u_m≠
;

249 
	mi‰u_¶ave
[
IFNAMSIZ
];

250 
	mi‰u_√w«me
[
IFNAMSIZ
];

251 * 
	mi‰u_d©a
;

252 
if_£âögs
 
	mi‰u_£âögs
;

253 } 
	mi‰_i‰u
;

257 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

258 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

259 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

260 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

261 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

262 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

263 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

264 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

265 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

266 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

267 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

268 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

269 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

270 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

271 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

272 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

273 
	#i‰_£âögs
 
i‰_i‰u
.
i‰u_£âögs


	)

283 #i‡
__UAPI_DEF_IF_IFCONF


284 
	sifc⁄f
 {

285 
	mifc_Àn
;

287 *
	mifcu_buf
;

288 
i‰eq
 *
	mifcu_ªq
;

289 } 
	mifc_ifcu
;

293 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

294 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

	@/usr/include/linux/if_addr.h

2 #i‚de‡
__LINUX_IF_ADDR_H


3 
	#__LINUX_IF_ADDR_H


	)

5 
	~<löux/ty≥s.h
>

6 
	~<löux/√éök.h
>

8 
	siÁddrmsg
 {

9 
__u8
 
	miÁ_Ámûy
;

10 
__u8
 
	miÁ_¥efixÀn
;

11 
__u8
 
	miÁ_Êags
;

12 
__u8
 
	miÁ_sc›e
;

13 
__u32
 
	miÁ_ödex
;

27 
	mIFA_UNSPEC
,

28 
	mIFA_ADDRESS
,

29 
	mIFA_LOCAL
,

30 
	mIFA_LABEL
,

31 
	mIFA_BROADCAST
,

32 
	mIFA_ANYCAST
,

33 
	mIFA_CACHEINFO
,

34 
	mIFA_MULTICAST
,

35 
	mIFA_FLAGS
,

36 
	mIFA_RT_PRIORITY
,

37 
	mIFA_TARGET_NETNSID
,

38 
	m__IFA_MAX
,

41 
	#IFA_MAX
 (
__IFA_MAX
 - 1)

	)

44 
	#IFA_F_SECONDARY
 0x01

	)

45 
	#IFA_F_TEMPORARY
 
IFA_F_SECONDARY


	)

47 
	#IFA_F_NODAD
 0x02

	)

48 
	#IFA_F_OPTIMISTIC
 0x04

	)

49 
	#IFA_F_DADFAILED
 0x08

	)

50 
	#IFA_F_HOMEADDRESS
 0x10

	)

51 
	#IFA_F_DEPRECATED
 0x20

	)

52 
	#IFA_F_TENTATIVE
 0x40

	)

53 
	#IFA_F_PERMANENT
 0x80

	)

54 
	#IFA_F_MANAGETEMPADDR
 0x100

	)

55 
	#IFA_F_NOPREFIXROUTE
 0x200

	)

56 
	#IFA_F_MCAUTOJOIN
 0x400

	)

57 
	#IFA_F_STABLE_PRIVACY
 0x800

	)

59 
	siÁ_ˇcheöfo
 {

60 
__u32
 
	miÁ_¥e„ªd
;

61 
__u32
 
	miÁ_vÆid
;

62 
__u32
 
	mc°amp
;

63 
__u32
 
	mt°amp
;

67 
	#IFA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
iÁddrmsg
))))

	)

68 
	#IFA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
iÁddrmsg
))

	)

	@/usr/include/linux/if_link.h

2 #i‚de‡
_LINUX_IF_LINK_H


3 
	#_LINUX_IF_LINK_H


	)

5 
	~<löux/ty≥s.h
>

6 
	~<löux/√éök.h
>

9 
	sπ∆_lök_°©s
 {

10 
__u32
 
	mrx_∑ckës
;

11 
__u32
 
	mtx_∑ckës
;

12 
__u32
 
	mrx_byãs
;

13 
__u32
 
	mtx_byãs
;

14 
__u32
 
	mrx_îr‹s
;

15 
__u32
 
	mtx_îr‹s
;

16 
__u32
 
	mrx_dr›≥d
;

17 
__u32
 
	mtx_dr›≥d
;

18 
__u32
 
	mmu…iˇ°
;

19 
__u32
 
	mcﬁlisi⁄s
;

21 
__u32
 
	mrx_Àngth_îr‹s
;

22 
__u32
 
	mrx_ovî_îr‹s
;

23 
__u32
 
	mrx_¸c_îr‹s
;

24 
__u32
 
	mrx_‰ame_îr‹s
;

25 
__u32
 
	mrx_fifo_îr‹s
;

26 
__u32
 
	mrx_mis£d_îr‹s
;

29 
__u32
 
	mtx_ab‹ãd_îr‹s
;

30 
__u32
 
	mtx_ˇºõr_îr‹s
;

31 
__u32
 
	mtx_fifo_îr‹s
;

32 
__u32
 
	mtx_hóπbót_îr‹s
;

33 
__u32
 
	mtx_wödow_îr‹s
;

36 
__u32
 
	mrx_com¥es£d
;

37 
__u32
 
	mtx_com¥es£d
;

39 
__u32
 
	mrx_noh™dÀr
;

215 
	sπ∆_lök_°©s64
 {

216 
__u64
 
	mrx_∑ckës
;

217 
__u64
 
	mtx_∑ckës
;

218 
__u64
 
	mrx_byãs
;

219 
__u64
 
	mtx_byãs
;

220 
__u64
 
	mrx_îr‹s
;

221 
__u64
 
	mtx_îr‹s
;

222 
__u64
 
	mrx_dr›≥d
;

223 
__u64
 
	mtx_dr›≥d
;

224 
__u64
 
	mmu…iˇ°
;

225 
__u64
 
	mcﬁlisi⁄s
;

228 
__u64
 
	mrx_Àngth_îr‹s
;

229 
__u64
 
	mrx_ovî_îr‹s
;

230 
__u64
 
	mrx_¸c_îr‹s
;

231 
__u64
 
	mrx_‰ame_îr‹s
;

232 
__u64
 
	mrx_fifo_îr‹s
;

233 
__u64
 
	mrx_mis£d_îr‹s
;

236 
__u64
 
	mtx_ab‹ãd_îr‹s
;

237 
__u64
 
	mtx_ˇºõr_îr‹s
;

238 
__u64
 
	mtx_fifo_îr‹s
;

239 
__u64
 
	mtx_hóπbót_îr‹s
;

240 
__u64
 
	mtx_wödow_îr‹s
;

243 
__u64
 
	mrx_com¥es£d
;

244 
__u64
 
	mtx_com¥es£d
;

245 
__u64
 
	mrx_noh™dÀr
;

249 
	sπ∆_lök_ifm≠
 {

250 
__u64
 
	mmem_°¨t
;

251 
__u64
 
	mmem_íd
;

252 
__u64
 
	mba£_addr
;

253 
__u16
 
	múq
;

254 
__u8
 
	mdma
;

255 
__u8
 
	mp‹t
;

277 
	mIFLA_UNSPEC
,

278 
	mIFLA_ADDRESS
,

279 
	mIFLA_BROADCAST
,

280 
	mIFLA_IFNAME
,

281 
	mIFLA_MTU
,

282 
	mIFLA_LINK
,

283 
	mIFLA_QDISC
,

284 
	mIFLA_STATS
,

285 
	mIFLA_COST
,

286 
	#IFLA_COST
 
IFLA_COST


	)

287 
	mIFLA_PRIORITY
,

288 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

289 
	mIFLA_MASTER
,

290 
	#IFLA_MASTER
 
IFLA_MASTER


	)

291 
	mIFLA_WIRELESS
,

292 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

293 
	mIFLA_PROTINFO
,

294 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

295 
	mIFLA_TXQLEN
,

296 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

297 
	mIFLA_MAP
,

298 
	#IFLA_MAP
 
IFLA_MAP


	)

299 
	mIFLA_WEIGHT
,

300 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

301 
	mIFLA_OPERSTATE
,

302 
	mIFLA_LINKMODE
,

303 
	mIFLA_LINKINFO
,

304 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

305 
	mIFLA_NET_NS_PID
,

306 
	mIFLA_IFALIAS
,

307 
	mIFLA_NUM_VF
,

308 
	mIFLA_VFINFO_LIST
,

309 
	mIFLA_STATS64
,

310 
	mIFLA_VF_PORTS
,

311 
	mIFLA_PORT_SELF
,

312 
	mIFLA_AF_SPEC
,

313 
	mIFLA_GROUP
,

314 
	mIFLA_NET_NS_FD
,

315 
	mIFLA_EXT_MASK
,

316 
	mIFLA_PROMISCUITY
,

317 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

318 
	mIFLA_NUM_TX_QUEUES
,

319 
	mIFLA_NUM_RX_QUEUES
,

320 
	mIFLA_CARRIER
,

321 
	mIFLA_PHYS_PORT_ID
,

322 
	mIFLA_CARRIER_CHANGES
,

323 
	mIFLA_PHYS_SWITCH_ID
,

324 
	mIFLA_LINK_NETNSID
,

325 
	mIFLA_PHYS_PORT_NAME
,

326 
	mIFLA_PROTO_DOWN
,

327 
	mIFLA_GSO_MAX_SEGS
,

328 
	mIFLA_GSO_MAX_SIZE
,

329 
	mIFLA_PAD
,

330 
	mIFLA_XDP
,

331 
	mIFLA_EVENT
,

332 
	mIFLA_NEW_NETNSID
,

333 
	mIFLA_IF_NETNSID
,

334 
	mIFLA_TARGET_NETNSID
 = 
IFLA_IF_NETNSID
,

335 
	mIFLA_CARRIER_UP_COUNT
,

336 
	mIFLA_CARRIER_DOWN_COUNT
,

337 
	mIFLA_NEW_IFINDEX
,

338 
	mIFLA_MIN_MTU
,

339 
	mIFLA_MAX_MTU
,

340 
	mIFLA_PROP_LIST
,

341 
	mIFLA_ALT_IFNAME
,

342 
	mIFLA_PERM_ADDRESS
,

343 
	mIFLA_PROTO_DOWN_REASON
,

348 
	mIFLA_PARENT_DEV_NAME
,

349 
	mIFLA_PARENT_DEV_BUS_NAME
,

351 
	m__IFLA_MAX


355 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

358 
	mIFLA_PROTO_DOWN_REASON_UNSPEC
,

359 
	mIFLA_PROTO_DOWN_REASON_MASK
,

360 
	mIFLA_PROTO_DOWN_REASON_VALUE
,

362 
	m__IFLA_PROTO_DOWN_REASON_CNT
,

363 
	mIFLA_PROTO_DOWN_REASON_MAX
 = 
__IFLA_PROTO_DOWN_REASON_CNT
 - 1

367 
	#IFLA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
iföfomsg
))))

	)

368 
	#IFLA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
iföfomsg
))

	)

371 
	mIFLA_INET_UNSPEC
,

372 
	mIFLA_INET_CONF
,

373 
	m__IFLA_INET_MAX
,

376 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

409 
	mIFLA_INET6_UNSPEC
,

410 
	mIFLA_INET6_FLAGS
,

411 
	mIFLA_INET6_CONF
,

412 
	mIFLA_INET6_STATS
,

413 
	mIFLA_INET6_MCAST
,

414 
	mIFLA_INET6_CACHEINFO
,

415 
	mIFLA_INET6_ICMP6STATS
,

416 
	mIFLA_INET6_TOKEN
,

417 
	mIFLA_INET6_ADDR_GEN_MODE
,

418 
	mIFLA_INET6_RA_MTU
,

419 
	m__IFLA_INET6_MAX


422 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

424 
	eö6_addr_gí_mode
 {

425 
	mIN6_ADDR_GEN_MODE_EUI64
,

426 
	mIN6_ADDR_GEN_MODE_NONE
,

427 
	mIN6_ADDR_GEN_MODE_STABLE_PRIVACY
,

428 
	mIN6_ADDR_GEN_MODE_RANDOM
,

434 
	mIFLA_BR_UNSPEC
,

435 
	mIFLA_BR_FORWARD_DELAY
,

436 
	mIFLA_BR_HELLO_TIME
,

437 
	mIFLA_BR_MAX_AGE
,

438 
	mIFLA_BR_AGEING_TIME
,

439 
	mIFLA_BR_STP_STATE
,

440 
	mIFLA_BR_PRIORITY
,

441 
	mIFLA_BR_VLAN_FILTERING
,

442 
	mIFLA_BR_VLAN_PROTOCOL
,

443 
	mIFLA_BR_GROUP_FWD_MASK
,

444 
	mIFLA_BR_ROOT_ID
,

445 
	mIFLA_BR_BRIDGE_ID
,

446 
	mIFLA_BR_ROOT_PORT
,

447 
	mIFLA_BR_ROOT_PATH_COST
,

448 
	mIFLA_BR_TOPOLOGY_CHANGE
,

449 
	mIFLA_BR_TOPOLOGY_CHANGE_DETECTED
,

450 
	mIFLA_BR_HELLO_TIMER
,

451 
	mIFLA_BR_TCN_TIMER
,

452 
	mIFLA_BR_TOPOLOGY_CHANGE_TIMER
,

453 
	mIFLA_BR_GC_TIMER
,

454 
	mIFLA_BR_GROUP_ADDR
,

455 
	mIFLA_BR_FDB_FLUSH
,

456 
	mIFLA_BR_MCAST_ROUTER
,

457 
	mIFLA_BR_MCAST_SNOOPING
,

458 
	mIFLA_BR_MCAST_QUERY_USE_IFADDR
,

459 
	mIFLA_BR_MCAST_QUERIER
,

460 
	mIFLA_BR_MCAST_HASH_ELASTICITY
,

461 
	mIFLA_BR_MCAST_HASH_MAX
,

462 
	mIFLA_BR_MCAST_LAST_MEMBER_CNT
,

463 
	mIFLA_BR_MCAST_STARTUP_QUERY_CNT
,

464 
	mIFLA_BR_MCAST_LAST_MEMBER_INTVL
,

465 
	mIFLA_BR_MCAST_MEMBERSHIP_INTVL
,

466 
	mIFLA_BR_MCAST_QUERIER_INTVL
,

467 
	mIFLA_BR_MCAST_QUERY_INTVL
,

468 
	mIFLA_BR_MCAST_QUERY_RESPONSE_INTVL
,

469 
	mIFLA_BR_MCAST_STARTUP_QUERY_INTVL
,

470 
	mIFLA_BR_NF_CALL_IPTABLES
,

471 
	mIFLA_BR_NF_CALL_IP6TABLES
,

472 
	mIFLA_BR_NF_CALL_ARPTABLES
,

473 
	mIFLA_BR_VLAN_DEFAULT_PVID
,

474 
	mIFLA_BR_PAD
,

475 
	mIFLA_BR_VLAN_STATS_ENABLED
,

476 
	mIFLA_BR_MCAST_STATS_ENABLED
,

477 
	mIFLA_BR_MCAST_IGMP_VERSION
,

478 
	mIFLA_BR_MCAST_MLD_VERSION
,

479 
	mIFLA_BR_VLAN_STATS_PER_PORT
,

480 
	mIFLA_BR_MULTI_BOOLOPT
,

481 
	mIFLA_BR_MCAST_QUERIER_STATE
,

482 
	m__IFLA_BR_MAX
,

485 
	#IFLA_BR_MAX
 (
__IFLA_BR_MAX
 - 1)

	)

487 
	siÊa_bridge_id
 {

488 
__u8
 
	m¥io
[2];

489 
__u8
 
	maddr
[6];

493 
	mBRIDGE_MODE_UNSPEC
,

494 
	mBRIDGE_MODE_HAIRPIN
,

498 
	mIFLA_BRPORT_UNSPEC
,

499 
	mIFLA_BRPORT_STATE
,

500 
	mIFLA_BRPORT_PRIORITY
,

501 
	mIFLA_BRPORT_COST
,

502 
	mIFLA_BRPORT_MODE
,

503 
	mIFLA_BRPORT_GUARD
,

504 
	mIFLA_BRPORT_PROTECT
,

505 
	mIFLA_BRPORT_FAST_LEAVE
,

506 
	mIFLA_BRPORT_LEARNING
,

507 
	mIFLA_BRPORT_UNICAST_FLOOD
,

508 
	mIFLA_BRPORT_PROXYARP
,

509 
	mIFLA_BRPORT_LEARNING_SYNC
,

510 
	mIFLA_BRPORT_PROXYARP_WIFI
,

511 
	mIFLA_BRPORT_ROOT_ID
,

512 
	mIFLA_BRPORT_BRIDGE_ID
,

513 
	mIFLA_BRPORT_DESIGNATED_PORT
,

514 
	mIFLA_BRPORT_DESIGNATED_COST
,

515 
	mIFLA_BRPORT_ID
,

516 
	mIFLA_BRPORT_NO
,

517 
	mIFLA_BRPORT_TOPOLOGY_CHANGE_ACK
,

518 
	mIFLA_BRPORT_CONFIG_PENDING
,

519 
	mIFLA_BRPORT_MESSAGE_AGE_TIMER
,

520 
	mIFLA_BRPORT_FORWARD_DELAY_TIMER
,

521 
	mIFLA_BRPORT_HOLD_TIMER
,

522 
	mIFLA_BRPORT_FLUSH
,

523 
	mIFLA_BRPORT_MULTICAST_ROUTER
,

524 
	mIFLA_BRPORT_PAD
,

525 
	mIFLA_BRPORT_MCAST_FLOOD
,

526 
	mIFLA_BRPORT_MCAST_TO_UCAST
,

527 
	mIFLA_BRPORT_VLAN_TUNNEL
,

528 
	mIFLA_BRPORT_BCAST_FLOOD
,

529 
	mIFLA_BRPORT_GROUP_FWD_MASK
,

530 
	mIFLA_BRPORT_NEIGH_SUPPRESS
,

531 
	mIFLA_BRPORT_ISOLATED
,

532 
	mIFLA_BRPORT_BACKUP_PORT
,

533 
	mIFLA_BRPORT_MRP_RING_OPEN
,

534 
	mIFLA_BRPORT_MRP_IN_OPEN
,

535 
	mIFLA_BRPORT_MCAST_EHT_HOSTS_LIMIT
,

536 
	mIFLA_BRPORT_MCAST_EHT_HOSTS_CNT
,

537 
	m__IFLA_BRPORT_MAX


539 
	#IFLA_BRPORT_MAX
 (
__IFLA_BRPORT_MAX
 - 1)

	)

541 
	siÊa_ˇcheöfo
 {

542 
__u32
 
	mmax_ªasm_Àn
;

543 
__u32
 
	mt°amp
;

544 
__u32
 
	mªachabÀ_time
;

545 
__u32
 
	mªå™s_time
;

549 
	mIFLA_INFO_UNSPEC
,

550 
	mIFLA_INFO_KIND
,

551 
	mIFLA_INFO_DATA
,

552 
	mIFLA_INFO_XSTATS
,

553 
	mIFLA_INFO_SLAVE_KIND
,

554 
	mIFLA_INFO_SLAVE_DATA
,

555 
	m__IFLA_INFO_MAX
,

558 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

563 
	mIFLA_VLAN_UNSPEC
,

564 
	mIFLA_VLAN_ID
,

565 
	mIFLA_VLAN_FLAGS
,

566 
	mIFLA_VLAN_EGRESS_QOS
,

567 
	mIFLA_VLAN_INGRESS_QOS
,

568 
	mIFLA_VLAN_PROTOCOL
,

569 
	m__IFLA_VLAN_MAX
,

572 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

574 
	siÊa_vœn_Êags
 {

575 
__u32
 
	mÊags
;

576 
__u32
 
	mmask
;

580 
	mIFLA_VLAN_QOS_UNSPEC
,

581 
	mIFLA_VLAN_QOS_MAPPING
,

582 
	m__IFLA_VLAN_QOS_MAX


585 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

587 
	siÊa_vœn_qos_m≠pög
 {

588 
__u32
 
	m‰om
;

589 
__u32
 
	mto
;

594 
	mIFLA_MACVLAN_UNSPEC
,

595 
	mIFLA_MACVLAN_MODE
,

596 
	mIFLA_MACVLAN_FLAGS
,

597 
	mIFLA_MACVLAN_MACADDR_MODE
,

598 
	mIFLA_MACVLAN_MACADDR
,

599 
	mIFLA_MACVLAN_MACADDR_DATA
,

600 
	mIFLA_MACVLAN_MACADDR_COUNT
,

601 
	mIFLA_MACVLAN_BC_QUEUE_LEN
,

602 
	mIFLA_MACVLAN_BC_QUEUE_LEN_USED
,

603 
	m__IFLA_MACVLAN_MAX
,

606 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

608 
	emacvœn_mode
 {

609 
	mMACVLAN_MODE_PRIVATE
 = 1,

610 
	mMACVLAN_MODE_VEPA
 = 2,

611 
	mMACVLAN_MODE_BRIDGE
 = 4,

612 
	mMACVLAN_MODE_PASSTHRU
 = 8,

613 
	mMACVLAN_MODE_SOURCE
 = 16,

616 
	emacvœn_maˇddr_mode
 {

617 
	mMACVLAN_MACADDR_ADD
,

618 
	mMACVLAN_MACADDR_DEL
,

619 
	mMACVLAN_MACADDR_FLUSH
,

620 
	mMACVLAN_MACADDR_SET
,

623 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

624 
	#MACVLAN_FLAG_NODST
 2

	)

628 
	mIFLA_VRF_UNSPEC
,

629 
	mIFLA_VRF_TABLE
,

630 
	m__IFLA_VRF_MAX


633 
	#IFLA_VRF_MAX
 (
__IFLA_VRF_MAX
 - 1)

	)

636 
	mIFLA_VRF_PORT_UNSPEC
,

637 
	mIFLA_VRF_PORT_TABLE
,

638 
	m__IFLA_VRF_PORT_MAX


641 
	#IFLA_VRF_PORT_MAX
 (
__IFLA_VRF_PORT_MAX
 - 1)

	)

645 
	mIFLA_MACSEC_UNSPEC
,

646 
	mIFLA_MACSEC_SCI
,

647 
	mIFLA_MACSEC_PORT
,

648 
	mIFLA_MACSEC_ICV_LEN
,

649 
	mIFLA_MACSEC_CIPHER_SUITE
,

650 
	mIFLA_MACSEC_WINDOW
,

651 
	mIFLA_MACSEC_ENCODING_SA
,

652 
	mIFLA_MACSEC_ENCRYPT
,

653 
	mIFLA_MACSEC_PROTECT
,

654 
	mIFLA_MACSEC_INC_SCI
,

655 
	mIFLA_MACSEC_ES
,

656 
	mIFLA_MACSEC_SCB
,

657 
	mIFLA_MACSEC_REPLAY_PROTECT
,

658 
	mIFLA_MACSEC_VALIDATION
,

659 
	mIFLA_MACSEC_PAD
,

660 
	mIFLA_MACSEC_OFFLOAD
,

661 
	m__IFLA_MACSEC_MAX
,

664 
	#IFLA_MACSEC_MAX
 (
__IFLA_MACSEC_MAX
 - 1)

	)

668 
	mIFLA_XFRM_UNSPEC
,

669 
	mIFLA_XFRM_LINK
,

670 
	mIFLA_XFRM_IF_ID
,

671 
	m__IFLA_XFRM_MAX


674 
	#IFLA_XFRM_MAX
 (
__IFLA_XFRM_MAX
 - 1)

	)

676 
	emac£c_vÆid©i⁄_ty≥
 {

677 
	mMACSEC_VALIDATE_DISABLED
 = 0,

678 
	mMACSEC_VALIDATE_CHECK
 = 1,

679 
	mMACSEC_VALIDATE_STRICT
 = 2,

680 
	m__MACSEC_VALIDATE_END
,

681 
	mMACSEC_VALIDATE_MAX
 = 
__MACSEC_VALIDATE_END
 - 1,

684 
	emac£c_ofÊﬂd
 {

685 
	mMACSEC_OFFLOAD_OFF
 = 0,

686 
	mMACSEC_OFFLOAD_PHY
 = 1,

687 
	mMACSEC_OFFLOAD_MAC
 = 2,

688 
	m__MACSEC_OFFLOAD_END
,

689 
	mMACSEC_OFFLOAD_MAX
 = 
__MACSEC_OFFLOAD_END
 - 1,

694 
	mIFLA_IPVLAN_UNSPEC
,

695 
	mIFLA_IPVLAN_MODE
,

696 
	mIFLA_IPVLAN_FLAGS
,

697 
	m__IFLA_IPVLAN_MAX


700 
	#IFLA_IPVLAN_MAX
 (
__IFLA_IPVLAN_MAX
 - 1)

	)

702 
	eùvœn_mode
 {

703 
	mIPVLAN_MODE_L2
 = 0,

704 
	mIPVLAN_MODE_L3
,

705 
	mIPVLAN_MODE_L3S
,

706 
	mIPVLAN_MODE_MAX


709 
	#IPVLAN_F_PRIVATE
 0x01

	)

710 
	#IPVLAN_F_VEPA
 0x02

	)

714 
	mIFLA_VXLAN_UNSPEC
,

715 
	mIFLA_VXLAN_ID
,

716 
	mIFLA_VXLAN_GROUP
,

717 
	mIFLA_VXLAN_LINK
,

718 
	mIFLA_VXLAN_LOCAL
,

719 
	mIFLA_VXLAN_TTL
,

720 
	mIFLA_VXLAN_TOS
,

721 
	mIFLA_VXLAN_LEARNING
,

722 
	mIFLA_VXLAN_AGEING
,

723 
	mIFLA_VXLAN_LIMIT
,

724 
	mIFLA_VXLAN_PORT_RANGE
,

725 
	mIFLA_VXLAN_PROXY
,

726 
	mIFLA_VXLAN_RSC
,

727 
	mIFLA_VXLAN_L2MISS
,

728 
	mIFLA_VXLAN_L3MISS
,

729 
	mIFLA_VXLAN_PORT
,

730 
	mIFLA_VXLAN_GROUP6
,

731 
	mIFLA_VXLAN_LOCAL6
,

732 
	mIFLA_VXLAN_UDP_CSUM
,

733 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_TX
,

734 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_RX
,

735 
	mIFLA_VXLAN_REMCSUM_TX
,

736 
	mIFLA_VXLAN_REMCSUM_RX
,

737 
	mIFLA_VXLAN_GBP
,

738 
	mIFLA_VXLAN_REMCSUM_NOPARTIAL
,

739 
	mIFLA_VXLAN_COLLECT_METADATA
,

740 
	mIFLA_VXLAN_LABEL
,

741 
	mIFLA_VXLAN_GPE
,

742 
	mIFLA_VXLAN_TTL_INHERIT
,

743 
	mIFLA_VXLAN_DF
,

744 
	mIFLA_VXLAN_FAN_MAP
 = 33,

745 
	m__IFLA_VXLAN_MAX


747 
	#IFLA_VXLAN_MAX
 (
__IFLA_VXLAN_MAX
 - 1)

	)

749 
	siÊa_vxœn_p‹t_ønge
 {

750 
__be16
 
	mlow
;

751 
__be16
 
	mhigh
;

754 
	eiÊa_vxœn_df
 {

755 
	mVXLAN_DF_UNSET
 = 0,

756 
	mVXLAN_DF_SET
,

757 
	mVXLAN_DF_INHERIT
,

758 
	m__VXLAN_DF_END
,

759 
	mVXLAN_DF_MAX
 = 
__VXLAN_DF_END
 - 1,

764 
	mIFLA_GENEVE_UNSPEC
,

765 
	mIFLA_GENEVE_ID
,

766 
	mIFLA_GENEVE_REMOTE
,

767 
	mIFLA_GENEVE_TTL
,

768 
	mIFLA_GENEVE_TOS
,

769 
	mIFLA_GENEVE_PORT
,

770 
	mIFLA_GENEVE_COLLECT_METADATA
,

771 
	mIFLA_GENEVE_REMOTE6
,

772 
	mIFLA_GENEVE_UDP_CSUM
,

773 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_TX
,

774 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_RX
,

775 
	mIFLA_GENEVE_LABEL
,

776 
	mIFLA_GENEVE_TTL_INHERIT
,

777 
	mIFLA_GENEVE_DF
,

778 
	m__IFLA_GENEVE_MAX


780 
	#IFLA_GENEVE_MAX
 (
__IFLA_GENEVE_MAX
 - 1)

	)

782 
	eiÊa_gíeve_df
 {

783 
	mGENEVE_DF_UNSET
 = 0,

784 
	mGENEVE_DF_SET
,

785 
	mGENEVE_DF_INHERIT
,

786 
	m__GENEVE_DF_END
,

787 
	mGENEVE_DF_MAX
 = 
__GENEVE_DF_END
 - 1,

792 
	mIFLA_BAREUDP_UNSPEC
,

793 
	mIFLA_BAREUDP_PORT
,

794 
	mIFLA_BAREUDP_ETHERTYPE
,

795 
	mIFLA_BAREUDP_SRCPORT_MIN
,

796 
	mIFLA_BAREUDP_MULTIPROTO_MODE
,

797 
	m__IFLA_BAREUDP_MAX


800 
	#IFLA_BAREUDP_MAX
 (
__IFLA_BAREUDP_MAX
 - 1)

	)

804 
	mIFLA_PPP_UNSPEC
,

805 
	mIFLA_PPP_DEV_FD
,

806 
	m__IFLA_PPP_MAX


808 
	#IFLA_PPP_MAX
 (
__IFLA_PPP_MAX
 - 1)

	)

812 
	eiÊa_gç_rﬁe
 {

813 
	mGTP_ROLE_GGSN
 = 0,

814 
	mGTP_ROLE_SGSN
,

818 
	mIFLA_GTP_UNSPEC
,

819 
	mIFLA_GTP_FD0
,

820 
	mIFLA_GTP_FD1
,

821 
	mIFLA_GTP_PDP_HASHSIZE
,

822 
	mIFLA_GTP_ROLE
,

823 
	m__IFLA_GTP_MAX
,

825 
	#IFLA_GTP_MAX
 (
__IFLA_GTP_MAX
 - 1)

	)

830 
	mIFLA_BOND_UNSPEC
,

831 
	mIFLA_BOND_MODE
,

832 
	mIFLA_BOND_ACTIVE_SLAVE
,

833 
	mIFLA_BOND_MIIMON
,

834 
	mIFLA_BOND_UPDELAY
,

835 
	mIFLA_BOND_DOWNDELAY
,

836 
	mIFLA_BOND_USE_CARRIER
,

837 
	mIFLA_BOND_ARP_INTERVAL
,

838 
	mIFLA_BOND_ARP_IP_TARGET
,

839 
	mIFLA_BOND_ARP_VALIDATE
,

840 
	mIFLA_BOND_ARP_ALL_TARGETS
,

841 
	mIFLA_BOND_PRIMARY
,

842 
	mIFLA_BOND_PRIMARY_RESELECT
,

843 
	mIFLA_BOND_FAIL_OVER_MAC
,

844 
	mIFLA_BOND_XMIT_HASH_POLICY
,

845 
	mIFLA_BOND_RESEND_IGMP
,

846 
	mIFLA_BOND_NUM_PEER_NOTIF
,

847 
	mIFLA_BOND_ALL_SLAVES_ACTIVE
,

848 
	mIFLA_BOND_MIN_LINKS
,

849 
	mIFLA_BOND_LP_INTERVAL
,

850 
	mIFLA_BOND_PACKETS_PER_SLAVE
,

851 
	mIFLA_BOND_AD_LACP_RATE
,

852 
	mIFLA_BOND_AD_SELECT
,

853 
	mIFLA_BOND_AD_INFO
,

854 
	mIFLA_BOND_AD_ACTOR_SYS_PRIO
,

855 
	mIFLA_BOND_AD_USER_PORT_KEY
,

856 
	mIFLA_BOND_AD_ACTOR_SYSTEM
,

857 
	mIFLA_BOND_TLB_DYNAMIC_LB
,

858 
	mIFLA_BOND_PEER_NOTIF_DELAY
,

859 
	mIFLA_BOND_AD_LACP_ACTIVE
,

860 
	mIFLA_BOND_MISSED_MAX
,

861 
	m__IFLA_BOND_MAX
,

864 
	#IFLA_BOND_MAX
 (
__IFLA_BOND_MAX
 - 1)

	)

867 
	mIFLA_BOND_AD_INFO_UNSPEC
,

868 
	mIFLA_BOND_AD_INFO_AGGREGATOR
,

869 
	mIFLA_BOND_AD_INFO_NUM_PORTS
,

870 
	mIFLA_BOND_AD_INFO_ACTOR_KEY
,

871 
	mIFLA_BOND_AD_INFO_PARTNER_KEY
,

872 
	mIFLA_BOND_AD_INFO_PARTNER_MAC
,

873 
	m__IFLA_BOND_AD_INFO_MAX
,

876 
	#IFLA_BOND_AD_INFO_MAX
 (
__IFLA_BOND_AD_INFO_MAX
 - 1)

	)

879 
	mIFLA_BOND_SLAVE_UNSPEC
,

880 
	mIFLA_BOND_SLAVE_STATE
,

881 
	mIFLA_BOND_SLAVE_MII_STATUS
,

882 
	mIFLA_BOND_SLAVE_LINK_FAILURE_COUNT
,

883 
	mIFLA_BOND_SLAVE_PERM_HWADDR
,

884 
	mIFLA_BOND_SLAVE_QUEUE_ID
,

885 
	mIFLA_BOND_SLAVE_AD_AGGREGATOR_ID
,

886 
	mIFLA_BOND_SLAVE_AD_ACTOR_OPER_PORT_STATE
,

887 
	mIFLA_BOND_SLAVE_AD_PARTNER_OPER_PORT_STATE
,

888 
	m__IFLA_BOND_SLAVE_MAX
,

891 
	#IFLA_BOND_SLAVE_MAX
 (
__IFLA_BOND_SLAVE_MAX
 - 1)

	)

896 
	mIFLA_VF_INFO_UNSPEC
,

897 
	mIFLA_VF_INFO
,

898 
	m__IFLA_VF_INFO_MAX
,

901 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

904 
	mIFLA_VF_UNSPEC
,

905 
	mIFLA_VF_MAC
,

906 
	mIFLA_VF_VLAN
,

907 
	mIFLA_VF_TX_RATE
,

908 
	mIFLA_VF_SPOOFCHK
,

909 
	mIFLA_VF_LINK_STATE
,

910 
	mIFLA_VF_RATE
,

911 
	mIFLA_VF_RSS_QUERY_EN
,

914 
	mIFLA_VF_STATS
,

915 
	mIFLA_VF_TRUST
,

916 
	mIFLA_VF_IB_NODE_GUID
,

917 
	mIFLA_VF_IB_PORT_GUID
,

918 
	mIFLA_VF_VLAN_LIST
,

919 
	mIFLA_VF_BROADCAST
,

920 
	m__IFLA_VF_MAX
,

923 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

925 
	siÊa_vf_mac
 {

926 
__u32
 
	mvf
;

927 
__u8
 
	mmac
[32];

930 
	siÊa_vf_brﬂdˇ°
 {

931 
__u8
 
	mbrﬂdˇ°
[32];

934 
	siÊa_vf_vœn
 {

935 
__u32
 
	mvf
;

936 
__u32
 
	mvœn
;

937 
__u32
 
	mqos
;

941 
	mIFLA_VF_VLAN_INFO_UNSPEC
,

942 
	mIFLA_VF_VLAN_INFO
,

943 
	m__IFLA_VF_VLAN_INFO_MAX
,

946 
	#IFLA_VF_VLAN_INFO_MAX
 (
__IFLA_VF_VLAN_INFO_MAX
 - 1)

	)

947 
	#MAX_VLAN_LIST_LEN
 1

	)

949 
	siÊa_vf_vœn_öfo
 {

950 
__u32
 
	mvf
;

951 
__u32
 
	mvœn
;

952 
__u32
 
	mqos
;

953 
__be16
 
	mvœn_¥Ÿo
;

956 
	siÊa_vf_tx_øã
 {

957 
__u32
 
	mvf
;

958 
__u32
 
	møã
;

961 
	siÊa_vf_øã
 {

962 
__u32
 
	mvf
;

963 
__u32
 
	mmö_tx_øã
;

964 
__u32
 
	mmax_tx_øã
;

967 
	siÊa_vf_•oofchk
 {

968 
__u32
 
	mvf
;

969 
__u32
 
	m£âög
;

972 
	siÊa_vf_guid
 {

973 
__u32
 
	mvf
;

974 
__u64
 
	mguid
;

978 
	mIFLA_VF_LINK_STATE_AUTO
,

979 
	mIFLA_VF_LINK_STATE_ENABLE
,

980 
	mIFLA_VF_LINK_STATE_DISABLE
,

981 
	m__IFLA_VF_LINK_STATE_MAX
,

984 
	siÊa_vf_lök_°©e
 {

985 
__u32
 
	mvf
;

986 
__u32
 
	mlök_°©e
;

989 
	siÊa_vf_rss_quîy_í
 {

990 
__u32
 
	mvf
;

991 
__u32
 
	m£âög
;

995 
	mIFLA_VF_STATS_RX_PACKETS
,

996 
	mIFLA_VF_STATS_TX_PACKETS
,

997 
	mIFLA_VF_STATS_RX_BYTES
,

998 
	mIFLA_VF_STATS_TX_BYTES
,

999 
	mIFLA_VF_STATS_BROADCAST
,

1000 
	mIFLA_VF_STATS_MULTICAST
,

1001 
	mIFLA_VF_STATS_PAD
,

1002 
	mIFLA_VF_STATS_RX_DROPPED
,

1003 
	mIFLA_VF_STATS_TX_DROPPED
,

1004 
	m__IFLA_VF_STATS_MAX
,

1007 
	#IFLA_VF_STATS_MAX
 (
__IFLA_VF_STATS_MAX
 - 1)

	)

1009 
	siÊa_vf_åu°
 {

1010 
__u32
 
	mvf
;

1011 
__u32
 
	m£âög
;

1030 
	mIFLA_VF_PORT_UNSPEC
,

1031 
	mIFLA_VF_PORT
,

1032 
	m__IFLA_VF_PORT_MAX
,

1035 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

1038 
	mIFLA_PORT_UNSPEC
,

1039 
	mIFLA_PORT_VF
,

1040 
	mIFLA_PORT_PROFILE
,

1041 
	mIFLA_PORT_VSI_TYPE
,

1042 
	mIFLA_PORT_INSTANCE_UUID
,

1043 
	mIFLA_PORT_HOST_UUID
,

1044 
	mIFLA_PORT_REQUEST
,

1045 
	mIFLA_PORT_RESPONSE
,

1046 
	m__IFLA_PORT_MAX
,

1049 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

1051 
	#PORT_PROFILE_MAX
 40

	)

1052 
	#PORT_UUID_MAX
 16

	)

1053 
	#PORT_SELF_VF
 -1

	)

1056 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

1057 
	mPORT_REQUEST_PREASSOCIATE_RR
,

1058 
	mPORT_REQUEST_ASSOCIATE
,

1059 
	mPORT_REQUEST_DISASSOCIATE
,

1063 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

1064 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

1065 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

1066 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

1067 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

1068 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

1069 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

1071 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

1072 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

1073 
	mPORT_PROFILE_RESPONSE_INVALID
,

1074 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

1075 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

1076 
	mPORT_PROFILE_RESPONSE_ERROR
,

1079 
	siÊa_p‹t_vsi
 {

1080 
__u8
 
	mvsi_mgr_id
;

1081 
__u8
 
	mvsi_ty≥_id
[3];

1082 
__u8
 
	mvsi_ty≥_vîsi⁄
;

1083 
__u8
 
	m∑d
[3];

1090 
	mIFLA_IPOIB_UNSPEC
,

1091 
	mIFLA_IPOIB_PKEY
,

1092 
	mIFLA_IPOIB_MODE
,

1093 
	mIFLA_IPOIB_UMCAST
,

1094 
	m__IFLA_IPOIB_MAX


1098 
	mIPOIB_MODE_DATAGRAM
 = 0,

1099 
	mIPOIB_MODE_CONNECTED
 = 1,

1102 
	#IFLA_IPOIB_MAX
 (
__IFLA_IPOIB_MAX
 - 1)

	)

1109 
	mHSR_PROTOCOL_HSR
,

1110 
	mHSR_PROTOCOL_PRP
,

1111 
	mHSR_PROTOCOL_MAX
,

1115 
	mIFLA_HSR_UNSPEC
,

1116 
	mIFLA_HSR_SLAVE1
,

1117 
	mIFLA_HSR_SLAVE2
,

1118 
	mIFLA_HSR_MULTICAST_SPEC
,

1119 
	mIFLA_HSR_SUPERVISION_ADDR
,

1120 
	mIFLA_HSR_SEQ_NR
,

1121 
	mIFLA_HSR_VERSION
,

1122 
	mIFLA_HSR_PROTOCOL
,

1125 
	m__IFLA_HSR_MAX
,

1128 
	#IFLA_HSR_MAX
 (
__IFLA_HSR_MAX
 - 1)

	)

1132 
	sif_°©s_msg
 {

1133 
__u8
 
	mÁmûy
;

1134 
__u8
 
	m∑d1
;

1135 
__u16
 
	m∑d2
;

1136 
__u32
 
	mifödex
;

1137 
__u32
 
	mfûãr_mask
;

1144 
	mIFLA_STATS_UNSPEC
,

1145 
	mIFLA_STATS_LINK_64
,

1146 
	mIFLA_STATS_LINK_XSTATS
,

1147 
	mIFLA_STATS_LINK_XSTATS_SLAVE
,

1148 
	mIFLA_STATS_LINK_OFFLOAD_XSTATS
,

1149 
	mIFLA_STATS_AF_SPEC
,

1150 
	m__IFLA_STATS_MAX
,

1153 
	#IFLA_STATS_MAX
 (
__IFLA_STATS_MAX
 - 1)

	)

1155 
	#IFLA_STATS_FILTER_BIT
(
ATTR
Ë(1 << (ATTR - 1))

	)

1163 
	mLINK_XSTATS_TYPE_UNSPEC
,

1164 
	mLINK_XSTATS_TYPE_BRIDGE
,

1165 
	mLINK_XSTATS_TYPE_BOND
,

1166 
	m__LINK_XSTATS_TYPE_MAX


1168 
	#LINK_XSTATS_TYPE_MAX
 (
__LINK_XSTATS_TYPE_MAX
 - 1)

	)

1172 
	mIFLA_OFFLOAD_XSTATS_UNSPEC
,

1173 
	mIFLA_OFFLOAD_XSTATS_CPU_HIT
,

1174 
	m__IFLA_OFFLOAD_XSTATS_MAX


1176 
	#IFLA_OFFLOAD_XSTATS_MAX
 (
__IFLA_OFFLOAD_XSTATS_MAX
 - 1)

	)

1180 
	#XDP_FLAGS_UPDATE_IF_NOEXIST
 (1U << 0)

	)

1181 
	#XDP_FLAGS_SKB_MODE
 (1U << 1)

	)

1182 
	#XDP_FLAGS_DRV_MODE
 (1U << 2)

	)

1183 
	#XDP_FLAGS_HW_MODE
 (1U << 3)

	)

1184 
	#XDP_FLAGS_REPLACE
 (1U << 4)

	)

1185 
	#XDP_FLAGS_MODES
 (
XDP_FLAGS_SKB_MODE
 | \

1186 
XDP_FLAGS_DRV_MODE
 | \

1187 
XDP_FLAGS_HW_MODE
)

	)

1188 
	#XDP_FLAGS_MASK
 (
XDP_FLAGS_UPDATE_IF_NOEXIST
 | \

1189 
XDP_FLAGS_MODES
 | 
XDP_FLAGS_REPLACE
)

	)

1193 
	mXDP_ATTACHED_NONE
 = 0,

1194 
	mXDP_ATTACHED_DRV
,

1195 
	mXDP_ATTACHED_SKB
,

1196 
	mXDP_ATTACHED_HW
,

1197 
	mXDP_ATTACHED_MULTI
,

1201 
	mIFLA_XDP_UNSPEC
,

1202 
	mIFLA_XDP_FD
,

1203 
	mIFLA_XDP_ATTACHED
,

1204 
	mIFLA_XDP_FLAGS
,

1205 
	mIFLA_XDP_PROG_ID
,

1206 
	mIFLA_XDP_DRV_PROG_ID
,

1207 
	mIFLA_XDP_SKB_PROG_ID
,

1208 
	mIFLA_XDP_HW_PROG_ID
,

1209 
	mIFLA_XDP_EXPECTED_FD
,

1210 
	m__IFLA_XDP_MAX
,

1213 
	#IFLA_XDP_MAX
 (
__IFLA_XDP_MAX
 - 1)

	)

1216 
	mIFLA_EVENT_NONE
,

1217 
	mIFLA_EVENT_REBOOT
,

1218 
	mIFLA_EVENT_FEATURES
,

1219 
	mIFLA_EVENT_BONDING_FAILOVER
,

1220 
	mIFLA_EVENT_NOTIFY_PEERS
,

1221 
	mIFLA_EVENT_IGMP_RESEND
,

1222 
	mIFLA_EVENT_BONDING_OPTIONS
,

1228 
	mIFLA_TUN_UNSPEC
,

1229 
	mIFLA_TUN_OWNER
,

1230 
	mIFLA_TUN_GROUP
,

1231 
	mIFLA_TUN_TYPE
,

1232 
	mIFLA_TUN_PI
,

1233 
	mIFLA_TUN_VNET_HDR
,

1234 
	mIFLA_TUN_PERSIST
,

1235 
	mIFLA_TUN_MULTI_QUEUE
,

1236 
	mIFLA_TUN_NUM_QUEUES
,

1237 
	mIFLA_TUN_NUM_DISABLED_QUEUES
,

1238 
	m__IFLA_TUN_MAX
,

1241 
	#IFLA_TUN_MAX
 (
__IFLA_TUN_MAX
 - 1)

	)

1245 
	#RMNET_FLAGS_INGRESS_DEAGGREGATION
 (1U << 0)

	)

1246 
	#RMNET_FLAGS_INGRESS_MAP_COMMANDS
 (1U << 1)

	)

1247 
	#RMNET_FLAGS_INGRESS_MAP_CKSUMV4
 (1U << 2)

	)

1248 
	#RMNET_FLAGS_EGRESS_MAP_CKSUMV4
 (1U << 3)

	)

1249 
	#RMNET_FLAGS_INGRESS_MAP_CKSUMV5
 (1U << 4)

	)

1250 
	#RMNET_FLAGS_EGRESS_MAP_CKSUMV5
 (1U << 5)

	)

1253 
	mIFLA_RMNET_UNSPEC
,

1254 
	mIFLA_RMNET_MUX_ID
,

1255 
	mIFLA_RMNET_FLAGS
,

1256 
	m__IFLA_RMNET_MAX
,

1259 
	#IFLA_RMNET_MAX
 (
__IFLA_RMNET_MAX
 - 1)

	)

1261 
	siÊa_rm√t_Êags
 {

1262 
__u32
 
	mÊags
;

1263 
__u32
 
	mmask
;

1269 
	mIFLA_MCTP_UNSPEC
,

1270 
	mIFLA_MCTP_NET
,

1271 
	m__IFLA_MCTP_MAX
,

1274 
	#IFLA_MCTP_MAX
 (
__IFLA_MCTP_MAX
 - 1)

	)

	@/usr/include/linux/if_packet.h

2 #i‚de‡
__LINUX_IF_PACKET_H


3 
	#__LINUX_IF_PACKET_H


	)

5 
	~<asm/byã‹dî.h
>

6 
	~<löux/ty≥s.h
>

8 
	ssockaddr_pkt
 {

9 
	m•kt_Ámûy
;

10 
	m•kt_devi˚
[14];

11 
__be16
 
	m•kt_¥Ÿocﬁ
;

14 
	ssockaddr_Œ
 {

15 
	m¶l_Ámûy
;

16 
__be16
 
	m¶l_¥Ÿocﬁ
;

17 
	m¶l_ifödex
;

18 
	m¶l_h©y≥
;

19 
	m¶l_pkây≥
;

20 
	m¶l_hÆí
;

21 
	m¶l_addr
[8];

26 
	#PACKET_HOST
 0

	)

27 
	#PACKET_BROADCAST
 1

	)

28 
	#PACKET_MULTICAST
 2

	)

29 
	#PACKET_OTHERHOST
 3

	)

30 
	#PACKET_OUTGOING
 4

	)

31 
	#PACKET_LOOPBACK
 5

	)

32 
	#PACKET_USER
 6

	)

33 
	#PACKET_KERNEL
 7

	)

35 
	#PACKET_FASTROUTE
 6

	)

39 
	#PACKET_ADD_MEMBERSHIP
 1

	)

40 
	#PACKET_DROP_MEMBERSHIP
 2

	)

41 
	#PACKET_RECV_OUTPUT
 3

	)

43 
	#PACKET_RX_RING
 5

	)

44 
	#PACKET_STATISTICS
 6

	)

45 
	#PACKET_COPY_THRESH
 7

	)

46 
	#PACKET_AUXDATA
 8

	)

47 
	#PACKET_ORIGDEV
 9

	)

48 
	#PACKET_VERSION
 10

	)

49 
	#PACKET_HDRLEN
 11

	)

50 
	#PACKET_RESERVE
 12

	)

51 
	#PACKET_TX_RING
 13

	)

52 
	#PACKET_LOSS
 14

	)

53 
	#PACKET_VNET_HDR
 15

	)

54 
	#PACKET_TX_TIMESTAMP
 16

	)

55 
	#PACKET_TIMESTAMP
 17

	)

56 
	#PACKET_FANOUT
 18

	)

57 
	#PACKET_TX_HAS_OFF
 19

	)

58 
	#PACKET_QDISC_BYPASS
 20

	)

59 
	#PACKET_ROLLOVER_STATS
 21

	)

60 
	#PACKET_FANOUT_DATA
 22

	)

61 
	#PACKET_IGNORE_OUTGOING
 23

	)

63 
	#PACKET_FANOUT_HASH
 0

	)

64 
	#PACKET_FANOUT_LB
 1

	)

65 
	#PACKET_FANOUT_CPU
 2

	)

66 
	#PACKET_FANOUT_ROLLOVER
 3

	)

67 
	#PACKET_FANOUT_RND
 4

	)

68 
	#PACKET_FANOUT_QM
 5

	)

69 
	#PACKET_FANOUT_CBPF
 6

	)

70 
	#PACKET_FANOUT_EBPF
 7

	)

71 
	#PACKET_FANOUT_FLAG_ROLLOVER
 0x1000

	)

72 
	#PACKET_FANOUT_FLAG_UNIQUEID
 0x2000

	)

73 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

75 
	sçackë_°©s
 {

76 
	mç_∑ckës
;

77 
	mç_dr›s
;

80 
	sçackë_°©s_v3
 {

81 
	mç_∑ckës
;

82 
	mç_dr›s
;

83 
	mç_‰ìze_q_˙t
;

86 
	sçackë_rﬁlovî_°©s
 {

87 
__Æig√d_u64
 
	mç_Æl
;

88 
__Æig√d_u64
 
	mç_huge
;

89 
__Æig√d_u64
 
	mç_Áûed
;

92 
	uçackë_°©s_u
 {

93 
çackë_°©s
 
	m°©s1
;

94 
çackë_°©s_v3
 
	m°©s3
;

97 
	sçackë_auxd©a
 {

98 
__u32
 
	mç_°©us
;

99 
__u32
 
	mç_Àn
;

100 
__u32
 
	mç_¢≠Àn
;

101 
__u16
 
	mç_mac
;

102 
__u16
 
	mç_√t
;

103 
__u16
 
	mç_vœn_tci
;

104 
__u16
 
	mç_vœn_çid
;

108 
	#TP_STATUS_KERNEL
 0

	)

109 
	#TP_STATUS_USER
 (1 << 0)

	)

110 
	#TP_STATUS_COPY
 (1 << 1)

	)

111 
	#TP_STATUS_LOSING
 (1 << 2)

	)

112 
	#TP_STATUS_CSUMNOTREADY
 (1 << 3)

	)

113 
	#TP_STATUS_VLAN_VALID
 (1 << 4Ë

	)

114 
	#TP_STATUS_BLK_TMO
 (1 << 5)

	)

115 
	#TP_STATUS_VLAN_TPID_VALID
 (1 << 6Ë

	)

116 
	#TP_STATUS_CSUM_VALID
 (1 << 7)

	)

119 
	#TP_STATUS_AVAILABLE
 0

	)

120 
	#TP_STATUS_SEND_REQUEST
 (1 << 0)

	)

121 
	#TP_STATUS_SENDING
 (1 << 1)

	)

122 
	#TP_STATUS_WRONG_FORMAT
 (1 << 2)

	)

125 
	#TP_STATUS_TS_SOFTWARE
 (1 << 29)

	)

126 
	#TP_STATUS_TS_SYS_HARDWARE
 (1 << 30Ë

	)

127 
	#TP_STATUS_TS_RAW_HARDWARE
 (1U << 31)

	)

130 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

132 
	sçackë_hdr
 {

133 
	mç_°©us
;

134 
	mç_Àn
;

135 
	mç_¢≠Àn
;

136 
	mç_mac
;

137 
	mç_√t
;

138 
	mç_£c
;

139 
	mç_u£c
;

142 
	#TPACKET_ALIGNMENT
 16

	)

143 
	#TPACKET_ALIGN
(
x
Ë(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

144 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë_hdr
)Ë+ (
sockaddr_Œ
))

	)

146 
	sçackë2_hdr
 {

147 
__u32
 
	mç_°©us
;

148 
__u32
 
	mç_Àn
;

149 
__u32
 
	mç_¢≠Àn
;

150 
__u16
 
	mç_mac
;

151 
__u16
 
	mç_√t
;

152 
__u32
 
	mç_£c
;

153 
__u32
 
	mç_n£c
;

154 
__u16
 
	mç_vœn_tci
;

155 
__u16
 
	mç_vœn_çid
;

156 
__u8
 
	mç_∑ddög
[4];

159 
	sçackë_hdr_v¨ü¡1
 {

160 
__u32
 
	mç_rxhash
;

161 
__u32
 
	mç_vœn_tci
;

162 
__u16
 
	mç_vœn_çid
;

163 
__u16
 
	mç_∑ddög
;

166 
	sçackë3_hdr
 {

167 
__u32
 
	mç_√xt_off£t
;

168 
__u32
 
	mç_£c
;

169 
__u32
 
	mç_n£c
;

170 
__u32
 
	mç_¢≠Àn
;

171 
__u32
 
	mç_Àn
;

172 
__u32
 
	mç_°©us
;

173 
__u16
 
	mç_mac
;

174 
__u16
 
	mç_√t
;

177 
çackë_hdr_v¨ü¡1
 
	mhv1
;

179 
__u8
 
	mç_∑ddög
[8];

182 
	sçackë_bd_ts
 {

183 
	mts_£c
;

185 
	mts_u£c
;

186 
	mts_n£c
;

190 
	sçackë_hdr_v1
 {

191 
__u32
 
	mblock_°©us
;

192 
__u32
 
	mnum_pkts
;

193 
__u32
 
	moff£t_to_fú°_pkt
;

198 
__u32
 
	mblk_Àn
;

209 
__Æig√d_u64
 
	m£q_num
;

236 
çackë_bd_ts
 
	mts_fú°_pkt
, 
	mts_œ°_pkt
;

239 
	uçackë_bd_hódî_u
 {

240 
çackë_hdr_v1
 
	mbh1
;

243 
	sçackë_block_desc
 {

244 
__u32
 
	mvîsi⁄
;

245 
__u32
 
	moff£t_to_¥iv
;

246 
çackë_bd_hódî_u
 
	mhdr
;

249 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë2_hdr
)Ë+ (
sockaddr_Œ
))

	)

250 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë3_hdr
)Ë+ (
sockaddr_Œ
))

	)

252 
	eçackë_vîsi⁄s
 {

253 
	mTPACKET_V1
,

254 
	mTPACKET_V2
,

255 
	mTPACKET_V3


271 
	sçackë_ªq
 {

272 
	mç_block_size
;

273 
	mç_block_ƒ
;

274 
	mç_‰ame_size
;

275 
	mç_‰ame_ƒ
;

278 
	sçackë_ªq3
 {

279 
	mç_block_size
;

280 
	mç_block_ƒ
;

281 
	mç_‰ame_size
;

282 
	mç_‰ame_ƒ
;

283 
	mç_ªtúe_blk_tov
;

284 
	mç_sizeof_¥iv
;

285 
	mç_„©uª_ªq_w‹d
;

288 
	uçackë_ªq_u
 {

289 
çackë_ªq
 
	mªq
;

290 
çackë_ªq3
 
	mªq3
;

293 
	s∑ckë_mªq
 {

294 
	mmr_ifödex
;

295 
	mmr_ty≥
;

296 
	mmr_Æí
;

297 
	mmr_addªss
[8];

300 
	sÁnout_¨gs
 {

301 #i‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

302 
__u16
 
	mid
;

303 
__u16
 
	mty≥_Êags
;

305 
__u16
 
	mty≥_Êags
;

306 
__u16
 
	mid
;

308 
__u32
 
	mmax_num_membîs
;

311 
	#PACKET_MR_MULTICAST
 0

	)

312 
	#PACKET_MR_PROMISC
 1

	)

313 
	#PACKET_MR_ALLMULTI
 2

	)

314 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/ioctl.h

2 #i‚de‡
_LINUX_IOCTL_H


3 
	#_LINUX_IOCTL_H


	)

5 
	~<asm/io˘l.h
>

	@/usr/include/linux/libc-compat.h

49 #i‚de‡
_LIBC_COMPAT_H


50 
	#_LIBC_COMPAT_H


	)

53 #i‡
deföed
(
__GLIBC__
)

56 #i‡
deföed
(
_NET_IF_H
Ë&& deföed(
__USE_MISC
)

61 
	#__UAPI_DEF_IF_IFCONF
 0

	)

62 
	#__UAPI_DEF_IF_IFMAP
 0

	)

63 
	#__UAPI_DEF_IF_IFNAMSIZ
 0

	)

64 
	#__UAPI_DEF_IF_IFREQ
 0

	)

66 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 0

	)

68 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


69 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

78 
	#__UAPI_DEF_IF_IFCONF
 1

	)

79 
	#__UAPI_DEF_IF_IFMAP
 1

	)

80 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

81 
	#__UAPI_DEF_IF_IFREQ
 1

	)

83 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

85 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

90 #i‡
deföed
(
_NETINET_IN_H
)

94 
	#__UAPI_DEF_IN_ADDR
 0

	)

95 
	#__UAPI_DEF_IN_IPPROTO
 0

	)

96 
	#__UAPI_DEF_IN_PKTINFO
 0

	)

97 
	#__UAPI_DEF_IP_MREQ
 0

	)

98 
	#__UAPI_DEF_SOCKADDR_IN
 0

	)

99 
	#__UAPI_DEF_IN_CLASS
 0

	)

101 
	#__UAPI_DEF_IN6_ADDR
 0

	)

106 #i‡
deföed
(
__USE_MISC
Ë|| deföed (
__USE_GNU
)

107 
	#__UAPI_DEF_IN6_ADDR_ALT
 0

	)

109 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

111 
	#__UAPI_DEF_SOCKADDR_IN6
 0

	)

112 
	#__UAPI_DEF_IPV6_MREQ
 0

	)

113 
	#__UAPI_DEF_IPPROTO_V6
 0

	)

114 
	#__UAPI_DEF_IPV6_OPTIONS
 0

	)

115 
	#__UAPI_DEF_IN6_PKTINFO
 0

	)

116 
	#__UAPI_DEF_IP6_MTUINFO
 0

	)

123 
	#__UAPI_DEF_IN_ADDR
 1

	)

124 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

125 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

126 
	#__UAPI_DEF_IP_MREQ
 1

	)

127 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

128 
	#__UAPI_DEF_IN_CLASS
 1

	)

130 
	#__UAPI_DEF_IN6_ADDR
 1

	)

133 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

134 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

135 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

136 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

137 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

138 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

139 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

144 #i‡
deföed
(
__NETIPX_IPX_H
)

146 
	#__UAPI_DEF_SOCKADDR_IPX
 0

	)

147 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 0

	)

148 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 0

	)

149 
	#__UAPI_DEF_IPX_CONFIG_DATA
 0

	)

150 
	#__UAPI_DEF_IPX_ROUTE_DEF
 0

	)

154 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

155 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

156 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

157 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

158 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

163 #i‡
deföed
(
_SYS_XATTR_H
)

164 
	#__UAPI_DEF_XATTR
 0

	)

166 
	#__UAPI_DEF_XATTR
 1

	)

176 #i‚de‡
__UAPI_DEF_IF_IFCONF


177 
	#__UAPI_DEF_IF_IFCONF
 1

	)

179 #i‚de‡
__UAPI_DEF_IF_IFMAP


180 
	#__UAPI_DEF_IF_IFMAP
 1

	)

182 #i‚de‡
__UAPI_DEF_IF_IFNAMSIZ


183 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

185 #i‚de‡
__UAPI_DEF_IF_IFREQ


186 
	#__UAPI_DEF_IF_IFREQ
 1

	)

189 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


190 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

193 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


194 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

198 #i‚de‡
__UAPI_DEF_IN_ADDR


199 
	#__UAPI_DEF_IN_ADDR
 1

	)

201 #i‚de‡
__UAPI_DEF_IN_IPPROTO


202 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

204 #i‚de‡
__UAPI_DEF_IN_PKTINFO


205 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

207 #i‚de‡
__UAPI_DEF_IP_MREQ


208 
	#__UAPI_DEF_IP_MREQ
 1

	)

210 #i‚de‡
__UAPI_DEF_SOCKADDR_IN


211 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

213 #i‚de‡
__UAPI_DEF_IN_CLASS


214 
	#__UAPI_DEF_IN_CLASS
 1

	)

218 #i‚de‡
__UAPI_DEF_IN6_ADDR


219 
	#__UAPI_DEF_IN6_ADDR
 1

	)

221 #i‚de‡
__UAPI_DEF_IN6_ADDR_ALT


222 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

224 #i‚de‡
__UAPI_DEF_SOCKADDR_IN6


225 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

227 #i‚de‡
__UAPI_DEF_IPV6_MREQ


228 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

230 #i‚de‡
__UAPI_DEF_IPPROTO_V6


231 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

233 #i‚de‡
__UAPI_DEF_IPV6_OPTIONS


234 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

236 #i‚de‡
__UAPI_DEF_IN6_PKTINFO


237 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

239 #i‚de‡
__UAPI_DEF_IP6_MTUINFO


240 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

244 #i‚de‡
__UAPI_DEF_SOCKADDR_IPX


245 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

247 #i‚de‡
__UAPI_DEF_IPX_ROUTE_DEFINITION


248 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

250 #i‚de‡
__UAPI_DEF_IPX_INTERFACE_DEFINITION


251 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

253 #i‚de‡
__UAPI_DEF_IPX_CONFIG_DATA


254 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

256 #i‚de‡
__UAPI_DEF_IPX_ROUTE_DEF


257 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

261 #i‚de‡
__UAPI_DEF_XATTR


262 
	#__UAPI_DEF_XATTR
 1

	)

	@/usr/include/linux/limits.h

2 #i‚de‡
_LINUX_LIMITS_H


3 
	#_LINUX_LIMITS_H


	)

5 
	#NR_OPEN
 1024

	)

7 
	#NGROUPS_MAX
 65536

	)

8 
	#ARG_MAX
 131072

	)

9 
	#LINK_MAX
 127

	)

10 
	#MAX_CANON
 255

	)

11 
	#MAX_INPUT
 255

	)

12 
	#NAME_MAX
 255

	)

13 
	#PATH_MAX
 4096

	)

14 
	#PIPE_BUF
 4096

	)

15 
	#XATTR_NAME_MAX
 255

	)

16 
	#XATTR_SIZE_MAX
 65536

	)

17 
	#XATTR_LIST_MAX
 65536

	)

19 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/mount.h

1 #i‚de‡
_LINUX_MOUNT_H


2 
	#_LINUX_MOUNT_H


	)

4 
	~<löux/ty≥s.h
>

13 
	#MS_RDONLY
 1

	)

14 
	#MS_NOSUID
 2

	)

15 
	#MS_NODEV
 4

	)

16 
	#MS_NOEXEC
 8

	)

17 
	#MS_SYNCHRONOUS
 16

	)

18 
	#MS_REMOUNT
 32

	)

19 
	#MS_MANDLOCK
 64

	)

20 
	#MS_DIRSYNC
 128

	)

21 
	#MS_NOSYMFOLLOW
 256

	)

22 
	#MS_NOATIME
 1024

	)

23 
	#MS_NODIRATIME
 2048

	)

24 
	#MS_BIND
 4096

	)

25 
	#MS_MOVE
 8192

	)

26 
	#MS_REC
 16384

	)

27 
	#MS_VERBOSE
 32768

	)

29 
	#MS_SILENT
 32768

	)

30 
	#MS_POSIXACL
 (1<<16Ë

	)

31 
	#MS_UNBINDABLE
 (1<<17Ë

	)

32 
	#MS_PRIVATE
 (1<<18Ë

	)

33 
	#MS_SLAVE
 (1<<19Ë

	)

34 
	#MS_SHARED
 (1<<20Ë

	)

35 
	#MS_RELATIME
 (1<<21Ë

	)

36 
	#MS_KERNMOUNT
 (1<<22Ë

	)

37 
	#MS_I_VERSION
 (1<<23Ë

	)

38 
	#MS_STRICTATIME
 (1<<24Ë

	)

39 
	#MS_LAZYTIME
 (1<<25Ë

	)

42 
	#MS_SUBMOUNT
 (1<<26)

	)

43 
	#MS_NOREMOTELOCK
 (1<<27)

	)

44 
	#MS_NOSEC
 (1<<28)

	)

45 
	#MS_BORN
 (1<<29)

	)

46 
	#MS_ACTIVE
 (1<<30)

	)

47 
	#MS_NOUSER
 (1<<31)

	)

52 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
|\

53 
MS_LAZYTIME
)

	)

58 
	#MS_MGC_VAL
 0xC0ED0000

	)

59 
	#MS_MGC_MSK
 0xffff0000

	)

64 
	#OPEN_TREE_CLONE
 1

	)

65 
	#OPEN_TREE_CLOEXEC
 
O_CLOEXEC


	)

70 
	#MOVE_MOUNT_F_SYMLINKS
 0x00000001

	)

71 
	#MOVE_MOUNT_F_AUTOMOUNTS
 0x00000002

	)

72 
	#MOVE_MOUNT_F_EMPTY_PATH
 0x00000004

	)

73 
	#MOVE_MOUNT_T_SYMLINKS
 0x00000010

	)

74 
	#MOVE_MOUNT_T_AUTOMOUNTS
 0x00000020

	)

75 
	#MOVE_MOUNT_T_EMPTY_PATH
 0x00000040

	)

76 
	#MOVE_MOUNT_SET_GROUP
 0x00000100

	)

77 
	#MOVE_MOUNT__MASK
 0x00000177

	)

82 
	#FSOPEN_CLOEXEC
 0x00000001

	)

87 
	#FSPICK_CLOEXEC
 0x00000001

	)

88 
	#FSPICK_SYMLINK_NOFOLLOW
 0x00000002

	)

89 
	#FSPICK_NO_AUTOMOUNT
 0x00000004

	)

90 
	#FSPICK_EMPTY_PATH
 0x00000008

	)

95 
	efsc⁄fig_comm™d
 {

96 
	mFSCONFIG_SET_FLAG
 = 0,

97 
	mFSCONFIG_SET_STRING
 = 1,

98 
	mFSCONFIG_SET_BINARY
 = 2,

99 
	mFSCONFIG_SET_PATH
 = 3,

100 
	mFSCONFIG_SET_PATH_EMPTY
 = 4,

101 
	mFSCONFIG_SET_FD
 = 5,

102 
	mFSCONFIG_CMD_CREATE
 = 6,

103 
	mFSCONFIG_CMD_RECONFIGURE
 = 7,

109 
	#FSMOUNT_CLOEXEC
 0x00000001

	)

114 
	#MOUNT_ATTR_RDONLY
 0x00000001

	)

115 
	#MOUNT_ATTR_NOSUID
 0x00000002

	)

116 
	#MOUNT_ATTR_NODEV
 0x00000004

	)

117 
	#MOUNT_ATTR_NOEXEC
 0x00000008

	)

118 
	#MOUNT_ATTR__ATIME
 0x00000070

	)

119 
	#MOUNT_ATTR_RELATIME
 0x00000000

	)

120 
	#MOUNT_ATTR_NOATIME
 0x00000010

	)

121 
	#MOUNT_ATTR_STRICTATIME
 0x00000020

	)

122 
	#MOUNT_ATTR_NODIRATIME
 0x00000080

	)

123 
	#MOUNT_ATTR_IDMAP
 0x00100000

	)

124 
	#MOUNT_ATTR_NOSYMFOLLOW
 0x00200000

	)

129 
	smou¡_©å
 {

130 
__u64
 
	m©å_£t
;

131 
__u64
 
	m©å_˛r
;

132 
__u64
 
	m¥›ag©i⁄
;

133 
__u64
 
	mu£∫s_fd
;

137 
	#MOUNT_ATTR_SIZE_VER0
 32

	)

	@/usr/include/linux/neighbour.h

2 #i‚de‡
__LINUX_NEIGHBOUR_H


3 
	#__LINUX_NEIGHBOUR_H


	)

5 
	~<löux/ty≥s.h
>

6 
	~<löux/√éök.h
>

8 
	sndmsg
 {

9 
__u8
 
	mndm_Ámûy
;

10 
__u8
 
	mndm_∑d1
;

11 
__u16
 
	mndm_∑d2
;

12 
__s32
 
	mndm_ifödex
;

13 
__u16
 
	mndm_°©e
;

14 
__u8
 
	mndm_Êags
;

15 
__u8
 
	mndm_ty≥
;

19 
	mNDA_UNSPEC
,

20 
	mNDA_DST
,

21 
	mNDA_LLADDR
,

22 
	mNDA_CACHEINFO
,

23 
	mNDA_PROBES
,

24 
	mNDA_VLAN
,

25 
	mNDA_PORT
,

26 
	mNDA_VNI
,

27 
	mNDA_IFINDEX
,

28 
	mNDA_MASTER
,

29 
	mNDA_LINK_NETNSID
,

30 
	mNDA_SRC_VNI
,

31 
	mNDA_PROTOCOL
,

32 
	mNDA_NH_ID
,

33 
	mNDA_FDB_EXT_ATTRS
,

34 
	m__NDA_MAX


37 
	#NDA_MAX
 (
__NDA_MAX
 - 1)

	)

43 
	#NTF_USE
 0x01

	)

44 
	#NTF_SELF
 0x02

	)

45 
	#NTF_MASTER
 0x04

	)

46 
	#NTF_PROXY
 0x08

	)

47 
	#NTF_EXT_LEARNED
 0x10

	)

48 
	#NTF_OFFLOADED
 0x20

	)

49 
	#NTF_STICKY
 0x40

	)

50 
	#NTF_ROUTER
 0x80

	)

56 
	#NUD_INCOMPLETE
 0x01

	)

57 
	#NUD_REACHABLE
 0x02

	)

58 
	#NUD_STALE
 0x04

	)

59 
	#NUD_DELAY
 0x08

	)

60 
	#NUD_PROBE
 0x10

	)

61 
	#NUD_FAILED
 0x20

	)

64 
	#NUD_NOARP
 0x40

	)

65 
	#NUD_PERMANENT
 0x80

	)

66 
	#NUD_NONE
 0x00

	)

76 
	snda_ˇcheöfo
 {

77 
__u32
 
	mndm_c⁄fúmed
;

78 
__u32
 
	mndm_u£d
;

79 
__u32
 
	mndm_upd©ed
;

80 
__u32
 
	mndm_ªf˙t
;

108 
	sndt_°©s
 {

109 
__u64
 
	mndts_Ælocs
;

110 
__u64
 
	mndts_de°roys
;

111 
__u64
 
	mndts_hash_grows
;

112 
__u64
 
	mndts_ªs_Áûed
;

113 
__u64
 
	mndts_lookups
;

114 
__u64
 
	mndts_hôs
;

115 
__u64
 
	mndts_rcv_¥obes_mˇ°
;

116 
__u64
 
	mndts_rcv_¥obes_uˇ°
;

117 
__u64
 
	mndts_≥riodic_gc_runs
;

118 
__u64
 
	mndts_f‹˚d_gc_runs
;

119 
__u64
 
	mndts_èbÀ_fuŒs
;

123 
	mNDTPA_UNSPEC
,

124 
	mNDTPA_IFINDEX
,

125 
	mNDTPA_REFCNT
,

126 
	mNDTPA_REACHABLE_TIME
,

127 
	mNDTPA_BASE_REACHABLE_TIME
,

128 
	mNDTPA_RETRANS_TIME
,

129 
	mNDTPA_GC_STALETIME
,

130 
	mNDTPA_DELAY_PROBE_TIME
,

131 
	mNDTPA_QUEUE_LEN
,

132 
	mNDTPA_APP_PROBES
,

133 
	mNDTPA_UCAST_PROBES
,

134 
	mNDTPA_MCAST_PROBES
,

135 
	mNDTPA_ANYCAST_DELAY
,

136 
	mNDTPA_PROXY_DELAY
,

137 
	mNDTPA_PROXY_QLEN
,

138 
	mNDTPA_LOCKTIME
,

139 
	mNDTPA_QUEUE_LENBYTES
,

140 
	mNDTPA_MCAST_REPROBES
,

141 
	mNDTPA_PAD
,

142 
	m__NDTPA_MAX


144 
	#NDTPA_MAX
 (
__NDTPA_MAX
 - 1)

	)

146 
	sndtmsg
 {

147 
__u8
 
	mndtm_Ámûy
;

148 
__u8
 
	mndtm_∑d1
;

149 
__u16
 
	mndtm_∑d2
;

152 
	sndt_c⁄fig
 {

153 
__u16
 
	mndtc_key_Àn
;

154 
__u16
 
	mndtc_íåy_size
;

155 
__u32
 
	mndtc_íåõs
;

156 
__u32
 
	mndtc_œ°_Êush
;

157 
__u32
 
	mndtc_œ°_ønd
;

158 
__u32
 
	mndtc_hash_∫d
;

159 
__u32
 
	mndtc_hash_mask
;

160 
__u32
 
	mndtc_hash_chaö_gc
;

161 
__u32
 
	mndtc_¥oxy_qÀn
;

165 
	mNDTA_UNSPEC
,

166 
	mNDTA_NAME
,

167 
	mNDTA_THRESH1
,

168 
	mNDTA_THRESH2
,

169 
	mNDTA_THRESH3
,

170 
	mNDTA_CONFIG
,

171 
	mNDTA_PARMS
,

172 
	mNDTA_STATS
,

173 
	mNDTA_GC_INTERVAL
,

174 
	mNDTA_PAD
,

175 
	m__NDTA_MAX


177 
	#NDTA_MAX
 (
__NDTA_MAX
 - 1)

	)

184 
	mFDB_NOTIFY_BIT
 = (1 << 0),

185 
	mFDB_NOTIFY_INACTIVE_BIT
 = (1 << 1)

195 
	mNFEA_UNSPEC
,

196 
	mNFEA_ACTIVITY_NOTIFY
,

197 
	mNFEA_DONT_REFRESH
,

198 
	m__NFEA_MAX


200 
	#NFEA_MAX
 (
__NFEA_MAX
 - 1)

	)

	@/usr/include/linux/netlink.h

2 #i‚de‡
__LINUX_NETLINK_H


3 
	#__LINUX_NETLINK_H


	)

5 
	~<löux/c⁄°.h
>

6 
	~<löux/sockë.h
>

7 
	~<löux/ty≥s.h
>

9 
	#NETLINK_ROUTE
 0

	)

10 
	#NETLINK_UNUSED
 1

	)

11 
	#NETLINK_USERSOCK
 2

	)

12 
	#NETLINK_FIREWALL
 3

	)

13 
	#NETLINK_SOCK_DIAG
 4

	)

14 
	#NETLINK_NFLOG
 5

	)

15 
	#NETLINK_XFRM
 6

	)

16 
	#NETLINK_SELINUX
 7

	)

17 
	#NETLINK_ISCSI
 8

	)

18 
	#NETLINK_AUDIT
 9

	)

19 
	#NETLINK_FIB_LOOKUP
 10

	)

20 
	#NETLINK_CONNECTOR
 11

	)

21 
	#NETLINK_NETFILTER
 12

	)

22 
	#NETLINK_IP6_FW
 13

	)

23 
	#NETLINK_DNRTMSG
 14

	)

24 
	#NETLINK_KOBJECT_UEVENT
 15

	)

25 
	#NETLINK_GENERIC
 16

	)

27 
	#NETLINK_SCSITRANSPORT
 18

	)

28 
	#NETLINK_ECRYPTFS
 19

	)

29 
	#NETLINK_RDMA
 20

	)

30 
	#NETLINK_CRYPTO
 21

	)

31 
	#NETLINK_SMC
 22

	)

33 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

35 
	#MAX_LINKS
 32

	)

37 
	ssockaddr_∆
 {

38 
__kî√l_ß_Ámûy_t
 
	m∆_Ámûy
;

39 
	m∆_∑d
;

40 
__u32
 
	m∆_pid
;

41 
__u32
 
	m∆_groups
;

44 
	s∆msghdr
 {

45 
__u32
 
	m∆msg_Àn
;

46 
__u16
 
	m∆msg_ty≥
;

47 
__u16
 
	m∆msg_Êags
;

48 
__u32
 
	m∆msg_£q
;

49 
__u32
 
	m∆msg_pid
;

54 
	#NLM_F_REQUEST
 0x01

	)

55 
	#NLM_F_MULTI
 0x02

	)

56 
	#NLM_F_ACK
 0x04

	)

57 
	#NLM_F_ECHO
 0x08

	)

58 
	#NLM_F_DUMP_INTR
 0x10

	)

59 
	#NLM_F_DUMP_FILTERED
 0x20

	)

62 
	#NLM_F_ROOT
 0x100

	)

63 
	#NLM_F_MATCH
 0x200

	)

64 
	#NLM_F_ATOMIC
 0x400

	)

65 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

68 
	#NLM_F_REPLACE
 0x100

	)

69 
	#NLM_F_EXCL
 0x200

	)

70 
	#NLM_F_CREATE
 0x400

	)

71 
	#NLM_F_APPEND
 0x800

	)

74 
	#NLM_F_NONREC
 0x100

	)

77 
	#NLM_F_CAPPED
 0x100

	)

78 
	#NLM_F_ACK_TLVS
 0x200

	)

89 
	#NLMSG_ALIGNTO
 4U

	)

90 
	#NLMSG_ALIGN
(
Àn
Ë–(÷í)+
NLMSG_ALIGNTO
-1Ë& ~(NLMSG_ALIGNTO-1Ë)

	)

91 
	#NLMSG_HDRLEN
 ((Ë
	`NLMSG_ALIGN
((
∆msghdr
)))

	)

92 
	#NLMSG_LENGTH
(
Àn
Ë(÷íË+ 
NLMSG_HDRLEN
)

	)

93 
	#NLMSG_SPACE
(
Àn
Ë
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
÷í))

	)

94 
	#NLMSG_DATA
(
∆h
Ë((*)(((*ÍlhË+ 
NLMSG_HDRLEN
))

	)

95 
	#NLMSG_NEXT
(
∆h
,
Àn
Ë(÷íË-
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
), \

96 (
∆msghdr
 *)(((*)(
∆h
)) + \

97 
	`NLMSG_ALIGN
((
∆h
)->
∆msg_Àn
)))

	)

98 
	#NLMSG_OK
(
∆h
,
Àn
Ë(÷íË>()(
∆msghdr
) && \

99 (
∆h
)->
∆msg_Àn
 >(
∆msghdr
) && \

100 (
∆h
)->
∆msg_Àn
 <(
Àn
))

	)

101 
	#NLMSG_PAYLOAD
(
∆h
,
Àn
Ë(“lh)->
∆msg_Àn
 - 
	`NLMSG_SPACE
(÷í)))

	)

103 
	#NLMSG_NOOP
 0x1

	)

104 
	#NLMSG_ERROR
 0x2

	)

105 
	#NLMSG_DONE
 0x3

	)

106 
	#NLMSG_OVERRUN
 0x4

	)

108 
	#NLMSG_MIN_TYPE
 0x10

	)

110 
	s∆msgîr
 {

111 
	mîr‹
;

112 
∆msghdr
 
	mmsg
;

137 
	e∆msgîr_©ås
 {

138 
	mNLMSGERR_ATTR_UNUSED
,

139 
	mNLMSGERR_ATTR_MSG
,

140 
	mNLMSGERR_ATTR_OFFS
,

141 
	mNLMSGERR_ATTR_COOKIE
,

142 
	mNLMSGERR_ATTR_POLICY
,

144 
	m__NLMSGERR_ATTR_MAX
,

145 
	mNLMSGERR_ATTR_MAX
 = 
__NLMSGERR_ATTR_MAX
 - 1

148 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

149 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

150 
	#NETLINK_PKTINFO
 3

	)

151 
	#NETLINK_BROADCAST_ERROR
 4

	)

152 
	#NETLINK_NO_ENOBUFS
 5

	)

153 
	#NETLINK_RX_RING
 6

	)

154 
	#NETLINK_TX_RING
 7

	)

155 
	#NETLINK_LISTEN_ALL_NSID
 8

	)

156 
	#NETLINK_LIST_MEMBERSHIPS
 9

	)

157 
	#NETLINK_CAP_ACK
 10

	)

158 
	#NETLINK_EXT_ACK
 11

	)

159 
	#NETLINK_GET_STRICT_CHK
 12

	)

161 
	s∆_pktöfo
 {

162 
__u32
 
	mgroup
;

165 
	s∆_mm≠_ªq
 {

166 
	mnm_block_size
;

167 
	mnm_block_ƒ
;

168 
	mnm_‰ame_size
;

169 
	mnm_‰ame_ƒ
;

172 
	s∆_mm≠_hdr
 {

173 
	mnm_°©us
;

174 
	mnm_Àn
;

175 
__u32
 
	mnm_group
;

177 
__u32
 
	mnm_pid
;

178 
__u32
 
	mnm_uid
;

179 
__u32
 
	mnm_gid
;

182 
	e∆_mm≠_°©us
 {

183 
	mNL_MMAP_STATUS_UNUSED
,

184 
	mNL_MMAP_STATUS_RESERVED
,

185 
	mNL_MMAP_STATUS_VALID
,

186 
	mNL_MMAP_STATUS_COPY
,

187 
	mNL_MMAP_STATUS_SKIP
,

190 
	#NL_MMAP_MSG_ALIGNMENT
 
NLMSG_ALIGNTO


	)

191 
	#NL_MMAP_MSG_ALIGN
(
sz
Ë
	`__ALIGN_KERNEL
(sz, 
NL_MMAP_MSG_ALIGNMENT
)

	)

192 
	#NL_MMAP_HDRLEN
 
	`NL_MMAP_MSG_ALIGN
((
∆_mm≠_hdr
))

	)

194 
	#NET_MAJOR
 36

	)

197 
	mNETLINK_UNCONNECTED
 = 0,

198 
	mNETLINK_CONNECTED
,

210 
	s∆©å
 {

211 
__u16
 
	m∆a_Àn
;

212 
__u16
 
	m∆a_ty≥
;

225 
	#NLA_F_NESTED
 (1 << 15)

	)

226 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

227 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

229 
	#NLA_ALIGNTO
 4

	)

230 
	#NLA_ALIGN
(
Àn
Ë((÷íË+ 
NLA_ALIGNTO
 - 1Ë& ~(NLA_ALIGNTO - 1))

	)

231 
	#NLA_HDRLEN
 ((Ë
	`NLA_ALIGN
((
∆©å
)))

	)

246 
	s∆a_bôfõld32
 {

247 
__u32
 
	mvÆue
;

248 
__u32
 
	m£À˘‹
;

283 
	e√éök_©åibuã_ty≥
 {

284 
	mNL_ATTR_TYPE_INVALID
,

286 
	mNL_ATTR_TYPE_FLAG
,

288 
	mNL_ATTR_TYPE_U8
,

289 
	mNL_ATTR_TYPE_U16
,

290 
	mNL_ATTR_TYPE_U32
,

291 
	mNL_ATTR_TYPE_U64
,

293 
	mNL_ATTR_TYPE_S8
,

294 
	mNL_ATTR_TYPE_S16
,

295 
	mNL_ATTR_TYPE_S32
,

296 
	mNL_ATTR_TYPE_S64
,

298 
	mNL_ATTR_TYPE_BINARY
,

299 
	mNL_ATTR_TYPE_STRING
,

300 
	mNL_ATTR_TYPE_NUL_STRING
,

302 
	mNL_ATTR_TYPE_NESTED
,

303 
	mNL_ATTR_TYPE_NESTED_ARRAY
,

305 
	mNL_ATTR_TYPE_BITFIELD32
,

336 
	e√éök_pﬁicy_ty≥_©å
 {

337 
	mNL_POLICY_TYPE_ATTR_UNSPEC
,

338 
	mNL_POLICY_TYPE_ATTR_TYPE
,

339 
	mNL_POLICY_TYPE_ATTR_MIN_VALUE_S
,

340 
	mNL_POLICY_TYPE_ATTR_MAX_VALUE_S
,

341 
	mNL_POLICY_TYPE_ATTR_MIN_VALUE_U
,

342 
	mNL_POLICY_TYPE_ATTR_MAX_VALUE_U
,

343 
	mNL_POLICY_TYPE_ATTR_MIN_LENGTH
,

344 
	mNL_POLICY_TYPE_ATTR_MAX_LENGTH
,

345 
	mNL_POLICY_TYPE_ATTR_POLICY_IDX
,

346 
	mNL_POLICY_TYPE_ATTR_POLICY_MAXTYPE
,

347 
	mNL_POLICY_TYPE_ATTR_BITFIELD32_MASK
,

348 
	mNL_POLICY_TYPE_ATTR_PAD
,

349 
	mNL_POLICY_TYPE_ATTR_MASK
,

352 
	m__NL_POLICY_TYPE_ATTR_MAX
,

353 
	mNL_POLICY_TYPE_ATTR_MAX
 = 
__NL_POLICY_TYPE_ATTR_MAX
 - 1

	@/usr/include/linux/pci_regs.h

21 #i‚de‡
LINUX_PCI_REGS_H


22 
	#LINUX_PCI_REGS_H


	)

29 
	#PCI_CFG_SPACE_SIZE
 256

	)

30 
	#PCI_CFG_SPACE_EXP_SIZE
 4096

	)

36 
	#PCI_STD_HEADER_SIZEOF
 64

	)

37 
	#PCI_STD_NUM_BARS
 6

	)

38 
	#PCI_VENDOR_ID
 0x00

	)

39 
	#PCI_DEVICE_ID
 0x02

	)

40 
	#PCI_COMMAND
 0x04

	)

41 
	#PCI_COMMAND_IO
 0x1

	)

42 
	#PCI_COMMAND_MEMORY
 0x2

	)

43 
	#PCI_COMMAND_MASTER
 0x4

	)

44 
	#PCI_COMMAND_SPECIAL
 0x8

	)

45 
	#PCI_COMMAND_INVALIDATE
 0x10

	)

46 
	#PCI_COMMAND_VGA_PALETTE
 0x20

	)

47 
	#PCI_COMMAND_PARITY
 0x40

	)

48 
	#PCI_COMMAND_WAIT
 0x80

	)

49 
	#PCI_COMMAND_SERR
 0x100

	)

50 
	#PCI_COMMAND_FAST_BACK
 0x200

	)

51 
	#PCI_COMMAND_INTX_DISABLE
 0x400

	)

53 
	#PCI_STATUS
 0x06

	)

54 
	#PCI_STATUS_IMM_READY
 0x01

	)

55 
	#PCI_STATUS_INTERRUPT
 0x08

	)

56 
	#PCI_STATUS_CAP_LIST
 0x10

	)

57 
	#PCI_STATUS_66MHZ
 0x20

	)

58 
	#PCI_STATUS_UDF
 0x40

	)

59 
	#PCI_STATUS_FAST_BACK
 0x80

	)

60 
	#PCI_STATUS_PARITY
 0x100

	)

61 
	#PCI_STATUS_DEVSEL_MASK
 0x600

	)

62 
	#PCI_STATUS_DEVSEL_FAST
 0x000

	)

63 
	#PCI_STATUS_DEVSEL_MEDIUM
 0x200

	)

64 
	#PCI_STATUS_DEVSEL_SLOW
 0x400

	)

65 
	#PCI_STATUS_SIG_TARGET_ABORT
 0x800

	)

66 
	#PCI_STATUS_REC_TARGET_ABORT
 0x1000

	)

67 
	#PCI_STATUS_REC_MASTER_ABORT
 0x2000

	)

68 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 0x4000

	)

69 
	#PCI_STATUS_DETECTED_PARITY
 0x8000

	)

71 
	#PCI_CLASS_REVISION
 0x08

	)

72 
	#PCI_REVISION_ID
 0x08

	)

73 
	#PCI_CLASS_PROG
 0x09

	)

74 
	#PCI_CLASS_DEVICE
 0x0®

	)

76 
	#PCI_CACHE_LINE_SIZE
 0x0¯

	)

77 
	#PCI_LATENCY_TIMER
 0x0d

	)

78 
	#PCI_HEADER_TYPE
 0x0ê

	)

79 
	#PCI_HEADER_TYPE_MASK
 0x7f

	)

80 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

81 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

82 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

84 
	#PCI_BIST
 0x0‡

	)

85 
	#PCI_BIST_CODE_MASK
 0x0‡

	)

86 
	#PCI_BIST_START
 0x40

	)

87 
	#PCI_BIST_CAPABLE
 0x80

	)

95 
	#PCI_BASE_ADDRESS_0
 0x10

	)

96 
	#PCI_BASE_ADDRESS_1
 0x14

	)

97 
	#PCI_BASE_ADDRESS_2
 0x18

	)

98 
	#PCI_BASE_ADDRESS_3
 0x1¯

	)

99 
	#PCI_BASE_ADDRESS_4
 0x20

	)

100 
	#PCI_BASE_ADDRESS_5
 0x24

	)

101 
	#PCI_BASE_ADDRESS_SPACE
 0x01

	)

102 
	#PCI_BASE_ADDRESS_SPACE_IO
 0x01

	)

103 
	#PCI_BASE_ADDRESS_SPACE_MEMORY
 0x00

	)

104 
	#PCI_BASE_ADDRESS_MEM_TYPE_MASK
 0x06

	)

105 
	#PCI_BASE_ADDRESS_MEM_TYPE_32
 0x00

	)

106 
	#PCI_BASE_ADDRESS_MEM_TYPE_1M
 0x02

	)

107 
	#PCI_BASE_ADDRESS_MEM_TYPE_64
 0x04

	)

108 
	#PCI_BASE_ADDRESS_MEM_PREFETCH
 0x08

	)

109 
	#PCI_BASE_ADDRESS_MEM_MASK
 (~0x0fUL)

	)

110 
	#PCI_BASE_ADDRESS_IO_MASK
 (~0x03UL)

	)

114 
	#PCI_CARDBUS_CIS
 0x28

	)

115 
	#PCI_SUBSYSTEM_VENDOR_ID
 0x2c

	)

116 
	#PCI_SUBSYSTEM_ID
 0x2e

	)

117 
	#PCI_ROM_ADDRESS
 0x30

	)

118 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

119 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffU)

	)

121 
	#PCI_CAPABILITY_LIST
 0x34

	)

124 
	#PCI_INTERRUPT_LINE
 0x3¯

	)

125 
	#PCI_INTERRUPT_PIN
 0x3d

	)

126 
	#PCI_MIN_GNT
 0x3ê

	)

127 
	#PCI_MAX_LAT
 0x3‡

	)

130 
	#PCI_PRIMARY_BUS
 0x18

	)

131 
	#PCI_SECONDARY_BUS
 0x19

	)

132 
	#PCI_SUBORDINATE_BUS
 0x1®

	)

133 
	#PCI_SEC_LATENCY_TIMER
 0x1b

	)

134 
	#PCI_IO_BASE
 0x1¯

	)

135 
	#PCI_IO_LIMIT
 0x1d

	)

136 
	#PCI_IO_RANGE_TYPE_MASK
 0x0fUL

	)

137 
	#PCI_IO_RANGE_TYPE_16
 0x00

	)

138 
	#PCI_IO_RANGE_TYPE_32
 0x01

	)

139 
	#PCI_IO_RANGE_MASK
 (~0x0fULË

	)

140 
	#PCI_IO_1K_RANGE_MASK
 (~0x03ULË

	)

141 
	#PCI_SEC_STATUS
 0x1ê

	)

142 
	#PCI_MEMORY_BASE
 0x20

	)

143 
	#PCI_MEMORY_LIMIT
 0x22

	)

144 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

145 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

146 
	#PCI_PREF_MEMORY_BASE
 0x24

	)

147 
	#PCI_PREF_MEMORY_LIMIT
 0x26

	)

148 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

149 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

150 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

151 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

152 
	#PCI_PREF_BASE_UPPER32
 0x28

	)

153 
	#PCI_PREF_LIMIT_UPPER32
 0x2c

	)

154 
	#PCI_IO_BASE_UPPER16
 0x30

	)

155 
	#PCI_IO_LIMIT_UPPER16
 0x32

	)

158 
	#PCI_ROM_ADDRESS1
 0x38

	)

160 
	#PCI_BRIDGE_CONTROL
 0x3e

	)

161 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

162 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

163 
	#PCI_BRIDGE_CTL_ISA
 0x04

	)

164 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

165 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

166 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

167 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

170 
	#PCI_CB_CAPABILITY_LIST
 0x14

	)

172 
	#PCI_CB_SEC_STATUS
 0x16

	)

173 
	#PCI_CB_PRIMARY_BUS
 0x18

	)

174 
	#PCI_CB_CARD_BUS
 0x19

	)

175 
	#PCI_CB_SUBORDINATE_BUS
 0x1®

	)

176 
	#PCI_CB_LATENCY_TIMER
 0x1b

	)

177 
	#PCI_CB_MEMORY_BASE_0
 0x1c

	)

178 
	#PCI_CB_MEMORY_LIMIT_0
 0x20

	)

179 
	#PCI_CB_MEMORY_BASE_1
 0x24

	)

180 
	#PCI_CB_MEMORY_LIMIT_1
 0x28

	)

181 
	#PCI_CB_IO_BASE_0
 0x2c

	)

182 
	#PCI_CB_IO_BASE_0_HI
 0x2e

	)

183 
	#PCI_CB_IO_LIMIT_0
 0x30

	)

184 
	#PCI_CB_IO_LIMIT_0_HI
 0x32

	)

185 
	#PCI_CB_IO_BASE_1
 0x34

	)

186 
	#PCI_CB_IO_BASE_1_HI
 0x36

	)

187 
	#PCI_CB_IO_LIMIT_1
 0x38

	)

188 
	#PCI_CB_IO_LIMIT_1_HI
 0x3a

	)

189 
	#PCI_CB_IO_RANGE_MASK
 (~0x03UL)

	)

191 
	#PCI_CB_BRIDGE_CONTROL
 0x3e

	)

192 
	#PCI_CB_BRIDGE_CTL_PARITY
 0x01

	)

193 
	#PCI_CB_BRIDGE_CTL_SERR
 0x02

	)

194 
	#PCI_CB_BRIDGE_CTL_ISA
 0x04

	)

195 
	#PCI_CB_BRIDGE_CTL_VGA
 0x08

	)

196 
	#PCI_CB_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

197 
	#PCI_CB_BRIDGE_CTL_CB_RESET
 0x40

	)

198 
	#PCI_CB_BRIDGE_CTL_16BIT_INT
 0x80

	)

199 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM0
 0x100

	)

200 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM1
 0x200

	)

201 
	#PCI_CB_BRIDGE_CTL_POST_WRITES
 0x400

	)

202 
	#PCI_CB_SUBSYSTEM_VENDOR_ID
 0x40

	)

203 
	#PCI_CB_SUBSYSTEM_ID
 0x42

	)

204 
	#PCI_CB_LEGACY_MODE_BASE
 0x44

	)

209 
	#PCI_CAP_LIST_ID
 0

	)

210 
	#PCI_CAP_ID_PM
 0x01

	)

211 
	#PCI_CAP_ID_AGP
 0x02

	)

212 
	#PCI_CAP_ID_VPD
 0x03

	)

213 
	#PCI_CAP_ID_SLOTID
 0x04

	)

214 
	#PCI_CAP_ID_MSI
 0x05

	)

215 
	#PCI_CAP_ID_CHSWP
 0x06

	)

216 
	#PCI_CAP_ID_PCIX
 0x07

	)

217 
	#PCI_CAP_ID_HT
 0x08

	)

218 
	#PCI_CAP_ID_VNDR
 0x09

	)

219 
	#PCI_CAP_ID_DBG
 0x0A

	)

220 
	#PCI_CAP_ID_CCRC
 0x0B

	)

221 
	#PCI_CAP_ID_SHPC
 0x0C

	)

222 
	#PCI_CAP_ID_SSVID
 0x0D

	)

223 
	#PCI_CAP_ID_AGP3
 0x0E

	)

224 
	#PCI_CAP_ID_SECDEV
 0x0F

	)

225 
	#PCI_CAP_ID_EXP
 0x10

	)

226 
	#PCI_CAP_ID_MSIX
 0x11

	)

227 
	#PCI_CAP_ID_SATA
 0x12

	)

228 
	#PCI_CAP_ID_AF
 0x13

	)

229 
	#PCI_CAP_ID_EA
 0x14

	)

230 
	#PCI_CAP_ID_MAX
 
PCI_CAP_ID_EA


	)

231 
	#PCI_CAP_LIST_NEXT
 1

	)

232 
	#PCI_CAP_FLAGS
 2

	)

233 
	#PCI_CAP_SIZEOF
 4

	)

237 
	#PCI_PM_PMC
 2

	)

238 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

239 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

240 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

241 
	#PCI_PM_CAP_DSI
 0x0020

	)

242 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

243 
	#PCI_PM_CAP_D1
 0x0200

	)

244 
	#PCI_PM_CAP_D2
 0x0400

	)

245 
	#PCI_PM_CAP_PME
 0x0800

	)

246 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

247 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

248 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

249 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

250 
	#PCI_PM_CAP_PME_D3hŸ
 0x4000

	)

251 
	#PCI_PM_CAP_PME_D3cﬁd
 0x8000

	)

252 
	#PCI_PM_CAP_PME_SHIFT
 11

	)

253 
	#PCI_PM_CTRL
 4

	)

254 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

255 
	#PCI_PM_CTRL_NO_SOFT_RESET
 0x0008

	)

256 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

257 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

258 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

259 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

260 
	#PCI_PM_PPB_EXTENSIONS
 6

	)

261 
	#PCI_PM_PPB_B2_B3
 0x40

	)

262 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

263 
	#PCI_PM_DATA_REGISTER
 7

	)

264 
	#PCI_PM_SIZEOF
 8

	)

268 
	#PCI_AGP_VERSION
 2

	)

269 
	#PCI_AGP_RFU
 3

	)

270 
	#PCI_AGP_STATUS
 4

	)

271 
	#PCI_AGP_STATUS_RQ_MASK
 0xff000000

	)

272 
	#PCI_AGP_STATUS_SBA
 0x0200

	)

273 
	#PCI_AGP_STATUS_64BIT
 0x0020

	)

274 
	#PCI_AGP_STATUS_FW
 0x0010

	)

275 
	#PCI_AGP_STATUS_RATE4
 0x0004

	)

276 
	#PCI_AGP_STATUS_RATE2
 0x0002

	)

277 
	#PCI_AGP_STATUS_RATE1
 0x0001

	)

278 
	#PCI_AGP_COMMAND
 8

	)

279 
	#PCI_AGP_COMMAND_RQ_MASK
 0xff000000

	)

280 
	#PCI_AGP_COMMAND_SBA
 0x0200

	)

281 
	#PCI_AGP_COMMAND_AGP
 0x0100

	)

282 
	#PCI_AGP_COMMAND_64BIT
 0x0020

	)

283 
	#PCI_AGP_COMMAND_FW
 0x0010

	)

284 
	#PCI_AGP_COMMAND_RATE4
 0x0004

	)

285 
	#PCI_AGP_COMMAND_RATE2
 0x0002

	)

286 
	#PCI_AGP_COMMAND_RATE1
 0x0001

	)

287 
	#PCI_AGP_SIZEOF
 12

	)

291 
	#PCI_VPD_ADDR
 2

	)

292 
	#PCI_VPD_ADDR_MASK
 0x7ff‡

	)

293 
	#PCI_VPD_ADDR_F
 0x8000

	)

294 
	#PCI_VPD_DATA
 4

	)

295 
	#PCI_CAP_VPD_SIZEOF
 8

	)

299 
	#PCI_SID_ESR
 2

	)

300 
	#PCI_SID_ESR_NSLOTS
 0x1‡

	)

301 
	#PCI_SID_ESR_FIC
 0x20

	)

302 
	#PCI_SID_CHASSIS_NR
 3

	)

306 
	#PCI_MSI_FLAGS
 2

	)

307 
	#PCI_MSI_FLAGS_ENABLE
 0x0001

	)

308 
	#PCI_MSI_FLAGS_QMASK
 0x000ê

	)

309 
	#PCI_MSI_FLAGS_QSIZE
 0x0070

	)

310 
	#PCI_MSI_FLAGS_64BIT
 0x0080

	)

311 
	#PCI_MSI_FLAGS_MASKBIT
 0x0100

	)

312 
	#PCI_MSI_RFU
 3

	)

313 
	#PCI_MSI_ADDRESS_LO
 4

	)

314 
	#PCI_MSI_ADDRESS_HI
 8

	)

315 
	#PCI_MSI_DATA_32
 8

	)

316 
	#PCI_MSI_MASK_32
 12

	)

317 
	#PCI_MSI_PENDING_32
 16

	)

318 
	#PCI_MSI_DATA_64
 12

	)

319 
	#PCI_MSI_MASK_64
 16

	)

320 
	#PCI_MSI_PENDING_64
 20

	)

323 
	#PCI_MSIX_FLAGS
 2

	)

324 
	#PCI_MSIX_FLAGS_QSIZE
 0x07FF

	)

325 
	#PCI_MSIX_FLAGS_MASKALL
 0x4000

	)

326 
	#PCI_MSIX_FLAGS_ENABLE
 0x8000

	)

327 
	#PCI_MSIX_TABLE
 4

	)

328 
	#PCI_MSIX_TABLE_BIR
 0x00000007

	)

329 
	#PCI_MSIX_TABLE_OFFSET
 0xfffffff8

	)

330 
	#PCI_MSIX_PBA
 8

	)

331 
	#PCI_MSIX_PBA_BIR
 0x00000007

	)

332 
	#PCI_MSIX_PBA_OFFSET
 0xfffffff8

	)

333 
	#PCI_MSIX_FLAGS_BIRMASK
 
PCI_MSIX_PBA_BIR


	)

334 
	#PCI_CAP_MSIX_SIZEOF
 12

	)

337 
	#PCI_MSIX_ENTRY_SIZE
 16

	)

338 
	#PCI_MSIX_ENTRY_LOWER_ADDR
 0

	)

339 
	#PCI_MSIX_ENTRY_UPPER_ADDR
 4

	)

340 
	#PCI_MSIX_ENTRY_DATA
 8

	)

341 
	#PCI_MSIX_ENTRY_VECTOR_CTRL
 12

	)

342 
	#PCI_MSIX_ENTRY_CTRL_MASKBIT
 0x00000001

	)

346 
	#PCI_CHSWP_CSR
 2

	)

347 
	#PCI_CHSWP_DHA
 0x01

	)

348 
	#PCI_CHSWP_EIM
 0x02

	)

349 
	#PCI_CHSWP_PIE
 0x04

	)

350 
	#PCI_CHSWP_LOO
 0x08

	)

351 
	#PCI_CHSWP_PI
 0x30

	)

352 
	#PCI_CHSWP_EXT
 0x40

	)

353 
	#PCI_CHSWP_INS
 0x80

	)

357 
	#PCI_AF_LENGTH
 2

	)

358 
	#PCI_AF_CAP
 3

	)

359 
	#PCI_AF_CAP_TP
 0x01

	)

360 
	#PCI_AF_CAP_FLR
 0x02

	)

361 
	#PCI_AF_CTRL
 4

	)

362 
	#PCI_AF_CTRL_FLR
 0x01

	)

363 
	#PCI_AF_STATUS
 5

	)

364 
	#PCI_AF_STATUS_TP
 0x01

	)

365 
	#PCI_CAP_AF_SIZEOF
 6

	)

369 
	#PCI_EA_NUM_ENT
 2

	)

370 
	#PCI_EA_NUM_ENT_MASK
 0x3‡

	)

371 
	#PCI_EA_FIRST_ENT
 4

	)

372 
	#PCI_EA_FIRST_ENT_BRIDGE
 8

	)

373 
	#PCI_EA_ES
 0x00000007

	)

374 
	#PCI_EA_BEI
 0x000000f0

	)

377 
	#PCI_EA_SEC_BUS_MASK
 0xff

	)

378 
	#PCI_EA_SUB_BUS_MASK
 0xff00

	)

379 
	#PCI_EA_SUB_BUS_SHIFT
 8

	)

382 
	#PCI_EA_BEI_BAR0
 0

	)

383 
	#PCI_EA_BEI_BAR5
 5

	)

384 
	#PCI_EA_BEI_BRIDGE
 6

	)

385 
	#PCI_EA_BEI_ENI
 7

	)

386 
	#PCI_EA_BEI_ROM
 8

	)

388 
	#PCI_EA_BEI_VF_BAR0
 9

	)

389 
	#PCI_EA_BEI_VF_BAR5
 14

	)

390 
	#PCI_EA_BEI_RESERVED
 15

	)

391 
	#PCI_EA_PP
 0x0000ff00

	)

392 
	#PCI_EA_SP
 0x00ff0000

	)

393 
	#PCI_EA_P_MEM
 0x00

	)

394 
	#PCI_EA_P_MEM_PREFETCH
 0x01

	)

395 
	#PCI_EA_P_IO
 0x02

	)

396 
	#PCI_EA_P_VF_MEM_PREFETCH
 0x03

	)

397 
	#PCI_EA_P_VF_MEM
 0x04

	)

398 
	#PCI_EA_P_BRIDGE_MEM
 0x05

	)

399 
	#PCI_EA_P_BRIDGE_MEM_PREFETCH
 0x06

	)

400 
	#PCI_EA_P_BRIDGE_IO
 0x07

	)

402 
	#PCI_EA_P_MEM_RESERVED
 0xfd

	)

403 
	#PCI_EA_P_IO_RESERVED
 0x„

	)

404 
	#PCI_EA_P_UNAVAILABLE
 0xf‡

	)

405 
	#PCI_EA_WRITABLE
 0x40000000

	)

406 
	#PCI_EA_ENABLE
 0x80000000

	)

407 
	#PCI_EA_BASE
 4

	)

408 
	#PCI_EA_MAX_OFFSET
 8

	)

410 
	#PCI_EA_IS_64
 0x00000002

	)

411 
	#PCI_EA_FIELD_MASK
 0xfffffff¯

	)

415 
	#PCI_X_CMD
 2

	)

416 
	#PCI_X_CMD_DPERR_E
 0x0001

	)

417 
	#PCI_X_CMD_ERO
 0x0002

	)

418 
	#PCI_X_CMD_READ_512
 0x0000

	)

419 
	#PCI_X_CMD_READ_1K
 0x0004

	)

420 
	#PCI_X_CMD_READ_2K
 0x0008

	)

421 
	#PCI_X_CMD_READ_4K
 0x000¯

	)

422 
	#PCI_X_CMD_MAX_READ
 0x000¯

	)

424 
	#PCI_X_CMD_SPLIT_1
 0x0000

	)

425 
	#PCI_X_CMD_SPLIT_2
 0x0010

	)

426 
	#PCI_X_CMD_SPLIT_3
 0x0020

	)

427 
	#PCI_X_CMD_SPLIT_4
 0x0030

	)

428 
	#PCI_X_CMD_SPLIT_8
 0x0040

	)

429 
	#PCI_X_CMD_SPLIT_12
 0x0050

	)

430 
	#PCI_X_CMD_SPLIT_16
 0x0060

	)

431 
	#PCI_X_CMD_SPLIT_32
 0x0070

	)

432 
	#PCI_X_CMD_MAX_SPLIT
 0x0070

	)

433 
	#PCI_X_CMD_VERSION
(
x
Ë(((xË>> 12Ë& 3Ë

	)

434 
	#PCI_X_STATUS
 4

	)

435 
	#PCI_X_STATUS_DEVFN
 0x000000f‡

	)

436 
	#PCI_X_STATUS_BUS
 0x0000ff00

	)

437 
	#PCI_X_STATUS_64BIT
 0x00010000

	)

438 
	#PCI_X_STATUS_133MHZ
 0x00020000

	)

439 
	#PCI_X_STATUS_SPL_DISC
 0x00040000

	)

440 
	#PCI_X_STATUS_UNX_SPL
 0x00080000

	)

441 
	#PCI_X_STATUS_COMPLEX
 0x00100000

	)

442 
	#PCI_X_STATUS_MAX_READ
 0x00600000

	)

443 
	#PCI_X_STATUS_MAX_SPLIT
 0x03800000

	)

444 
	#PCI_X_STATUS_MAX_CUM
 0x1c000000

	)

445 
	#PCI_X_STATUS_SPL_ERR
 0x20000000

	)

446 
	#PCI_X_STATUS_266MHZ
 0x40000000

	)

447 
	#PCI_X_STATUS_533MHZ
 0x80000000

	)

448 
	#PCI_X_ECC_CSR
 8

	)

449 
	#PCI_CAP_PCIX_SIZEOF_V0
 8

	)

450 
	#PCI_CAP_PCIX_SIZEOF_V1
 24

	)

451 
	#PCI_CAP_PCIX_SIZEOF_V2
 
PCI_CAP_PCIX_SIZEOF_V1


	)

455 
	#PCI_X_BRIDGE_SSTATUS
 2

	)

456 
	#PCI_X_SSTATUS_64BIT
 0x0001

	)

457 
	#PCI_X_SSTATUS_133MHZ
 0x0002

	)

458 
	#PCI_X_SSTATUS_FREQ
 0x03c0

	)

459 
	#PCI_X_SSTATUS_VERS
 0x3000

	)

460 
	#PCI_X_SSTATUS_V1
 0x1000

	)

461 
	#PCI_X_SSTATUS_V2
 0x2000

	)

462 
	#PCI_X_SSTATUS_266MHZ
 0x4000

	)

463 
	#PCI_X_SSTATUS_533MHZ
 0x8000

	)

464 
	#PCI_X_BRIDGE_STATUS
 4

	)

468 
	#PCI_SSVID_VENDOR_ID
 4

	)

469 
	#PCI_SSVID_DEVICE_ID
 6

	)

473 
	#PCI_EXP_FLAGS
 2

	)

474 
	#PCI_EXP_FLAGS_VERS
 0x000‡

	)

475 
	#PCI_EXP_FLAGS_TYPE
 0x00f0

	)

476 
	#PCI_EXP_TYPE_ENDPOINT
 0x0

	)

477 
	#PCI_EXP_TYPE_LEG_END
 0x1

	)

478 
	#PCI_EXP_TYPE_ROOT_PORT
 0x4

	)

479 
	#PCI_EXP_TYPE_UPSTREAM
 0x5

	)

480 
	#PCI_EXP_TYPE_DOWNSTREAM
 0x6

	)

481 
	#PCI_EXP_TYPE_PCI_BRIDGE
 0x7

	)

482 
	#PCI_EXP_TYPE_PCIE_BRIDGE
 0x8

	)

483 
	#PCI_EXP_TYPE_RC_END
 0x9

	)

484 
	#PCI_EXP_TYPE_RC_EC
 0x®

	)

485 
	#PCI_EXP_FLAGS_SLOT
 0x0100

	)

486 
	#PCI_EXP_FLAGS_IRQ
 0x3e00

	)

487 
	#PCI_EXP_DEVCAP
 4

	)

488 
	#PCI_EXP_DEVCAP_PAYLOAD
 0x00000007

	)

489 
	#PCI_EXP_DEVCAP_PHANTOM
 0x00000018

	)

490 
	#PCI_EXP_DEVCAP_EXT_TAG
 0x00000020

	)

491 
	#PCI_EXP_DEVCAP_L0S
 0x000001c0

	)

492 
	#PCI_EXP_DEVCAP_L1
 0x00000e00

	)

493 
	#PCI_EXP_DEVCAP_ATN_BUT
 0x00001000

	)

494 
	#PCI_EXP_DEVCAP_ATN_IND
 0x00002000

	)

495 
	#PCI_EXP_DEVCAP_PWR_IND
 0x00004000

	)

496 
	#PCI_EXP_DEVCAP_RBER
 0x00008000

	)

497 
	#PCI_EXP_DEVCAP_PWR_VAL
 0x03fc0000

	)

498 
	#PCI_EXP_DEVCAP_PWR_SCL
 0x0c000000

	)

499 
	#PCI_EXP_DEVCAP_FLR
 0x10000000

	)

500 
	#PCI_EXP_DEVCTL
 8

	)

501 
	#PCI_EXP_DEVCTL_CERE
 0x0001

	)

502 
	#PCI_EXP_DEVCTL_NFERE
 0x0002

	)

503 
	#PCI_EXP_DEVCTL_FERE
 0x0004

	)

504 
	#PCI_EXP_DEVCTL_URRE
 0x0008

	)

505 
	#PCI_EXP_DEVCTL_RELAX_EN
 0x0010

	)

506 
	#PCI_EXP_DEVCTL_PAYLOAD
 0x00e0

	)

507 
	#PCI_EXP_DEVCTL_PAYLOAD_128B
 0x0000

	)

508 
	#PCI_EXP_DEVCTL_PAYLOAD_256B
 0x0020

	)

509 
	#PCI_EXP_DEVCTL_PAYLOAD_512B
 0x0040

	)

510 
	#PCI_EXP_DEVCTL_PAYLOAD_1024B
 0x0060

	)

511 
	#PCI_EXP_DEVCTL_PAYLOAD_2048B
 0x0080

	)

512 
	#PCI_EXP_DEVCTL_PAYLOAD_4096B
 0x00a0

	)

513 
	#PCI_EXP_DEVCTL_EXT_TAG
 0x0100

	)

514 
	#PCI_EXP_DEVCTL_PHANTOM
 0x0200

	)

515 
	#PCI_EXP_DEVCTL_AUX_PME
 0x0400

	)

516 
	#PCI_EXP_DEVCTL_NOSNOOP_EN
 0x0800

	)

517 
	#PCI_EXP_DEVCTL_READRQ
 0x7000

	)

518 
	#PCI_EXP_DEVCTL_READRQ_128B
 0x0000

	)

519 
	#PCI_EXP_DEVCTL_READRQ_256B
 0x1000

	)

520 
	#PCI_EXP_DEVCTL_READRQ_512B
 0x2000

	)

521 
	#PCI_EXP_DEVCTL_READRQ_1024B
 0x3000

	)

522 
	#PCI_EXP_DEVCTL_READRQ_2048B
 0x4000

	)

523 
	#PCI_EXP_DEVCTL_READRQ_4096B
 0x5000

	)

524 
	#PCI_EXP_DEVCTL_BCR_FLR
 0x8000

	)

525 
	#PCI_EXP_DEVSTA
 10

	)

526 
	#PCI_EXP_DEVSTA_CED
 0x0001

	)

527 
	#PCI_EXP_DEVSTA_NFED
 0x0002

	)

528 
	#PCI_EXP_DEVSTA_FED
 0x0004

	)

529 
	#PCI_EXP_DEVSTA_URD
 0x0008

	)

530 
	#PCI_EXP_DEVSTA_AUXPD
 0x0010

	)

531 
	#PCI_EXP_DEVSTA_TRPND
 0x0020

	)

532 
	#PCI_CAP_EXP_RC_ENDPOINT_SIZEOF_V1
 12

	)

533 
	#PCI_EXP_LNKCAP
 12

	)

534 
	#PCI_EXP_LNKCAP_SLS
 0x0000000‡

	)

535 
	#PCI_EXP_LNKCAP_SLS_2_5GB
 0x00000001

	)

536 
	#PCI_EXP_LNKCAP_SLS_5_0GB
 0x00000002

	)

537 
	#PCI_EXP_LNKCAP_SLS_8_0GB
 0x00000003

	)

538 
	#PCI_EXP_LNKCAP_SLS_16_0GB
 0x00000004

	)

539 
	#PCI_EXP_LNKCAP_SLS_32_0GB
 0x00000005

	)

540 
	#PCI_EXP_LNKCAP_SLS_64_0GB
 0x00000006

	)

541 
	#PCI_EXP_LNKCAP_MLW
 0x000003f0

	)

542 
	#PCI_EXP_LNKCAP_ASPMS
 0x00000c00

	)

543 
	#PCI_EXP_LNKCAP_ASPM_L0S
 0x00000400

	)

544 
	#PCI_EXP_LNKCAP_ASPM_L1
 0x00000800

	)

545 
	#PCI_EXP_LNKCAP_L0SEL
 0x00007000

	)

546 
	#PCI_EXP_LNKCAP_L1EL
 0x00038000

	)

547 
	#PCI_EXP_LNKCAP_CLKPM
 0x00040000

	)

548 
	#PCI_EXP_LNKCAP_SDERC
 0x00080000

	)

549 
	#PCI_EXP_LNKCAP_DLLLARC
 0x00100000

	)

550 
	#PCI_EXP_LNKCAP_LBNC
 0x00200000

	)

551 
	#PCI_EXP_LNKCAP_PN
 0xff000000

	)

552 
	#PCI_EXP_LNKCTL
 16

	)

553 
	#PCI_EXP_LNKCTL_ASPMC
 0x0003

	)

554 
	#PCI_EXP_LNKCTL_ASPM_L0S
 0x0001

	)

555 
	#PCI_EXP_LNKCTL_ASPM_L1
 0x0002

	)

556 
	#PCI_EXP_LNKCTL_RCB
 0x0008

	)

557 
	#PCI_EXP_LNKCTL_LD
 0x0010

	)

558 
	#PCI_EXP_LNKCTL_RL
 0x0020

	)

559 
	#PCI_EXP_LNKCTL_CCC
 0x0040

	)

560 
	#PCI_EXP_LNKCTL_ES
 0x0080

	)

561 
	#PCI_EXP_LNKCTL_CLKREQ_EN
 0x0100

	)

562 
	#PCI_EXP_LNKCTL_HAWD
 0x0200

	)

563 
	#PCI_EXP_LNKCTL_LBMIE
 0x0400

	)

564 
	#PCI_EXP_LNKCTL_LABIE
 0x0800

	)

565 
	#PCI_EXP_LNKSTA
 18

	)

566 
	#PCI_EXP_LNKSTA_CLS
 0x000‡

	)

567 
	#PCI_EXP_LNKSTA_CLS_2_5GB
 0x0001

	)

568 
	#PCI_EXP_LNKSTA_CLS_5_0GB
 0x0002

	)

569 
	#PCI_EXP_LNKSTA_CLS_8_0GB
 0x0003

	)

570 
	#PCI_EXP_LNKSTA_CLS_16_0GB
 0x0004

	)

571 
	#PCI_EXP_LNKSTA_CLS_32_0GB
 0x0005

	)

572 
	#PCI_EXP_LNKSTA_CLS_64_0GB
 0x0006

	)

573 
	#PCI_EXP_LNKSTA_NLW
 0x03f0

	)

574 
	#PCI_EXP_LNKSTA_NLW_X1
 0x0010

	)

575 
	#PCI_EXP_LNKSTA_NLW_X2
 0x0020

	)

576 
	#PCI_EXP_LNKSTA_NLW_X4
 0x0040

	)

577 
	#PCI_EXP_LNKSTA_NLW_X8
 0x0080

	)

578 
	#PCI_EXP_LNKSTA_NLW_SHIFT
 4

	)

579 
	#PCI_EXP_LNKSTA_LT
 0x0800

	)

580 
	#PCI_EXP_LNKSTA_SLC
 0x1000

	)

581 
	#PCI_EXP_LNKSTA_DLLLA
 0x2000

	)

582 
	#PCI_EXP_LNKSTA_LBMS
 0x4000

	)

583 
	#PCI_EXP_LNKSTA_LABS
 0x8000

	)

584 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V1
 20

	)

585 
	#PCI_EXP_SLTCAP
 20

	)

586 
	#PCI_EXP_SLTCAP_ABP
 0x00000001

	)

587 
	#PCI_EXP_SLTCAP_PCP
 0x00000002

	)

588 
	#PCI_EXP_SLTCAP_MRLSP
 0x00000004

	)

589 
	#PCI_EXP_SLTCAP_AIP
 0x00000008

	)

590 
	#PCI_EXP_SLTCAP_PIP
 0x00000010

	)

591 
	#PCI_EXP_SLTCAP_HPS
 0x00000020

	)

592 
	#PCI_EXP_SLTCAP_HPC
 0x00000040

	)

593 
	#PCI_EXP_SLTCAP_SPLV
 0x00007f80

	)

594 
	#PCI_EXP_SLTCAP_SPLS
 0x00018000

	)

595 
	#PCI_EXP_SLTCAP_EIP
 0x00020000

	)

596 
	#PCI_EXP_SLTCAP_NCCS
 0x00040000

	)

597 
	#PCI_EXP_SLTCAP_PSN
 0xfff80000

	)

598 
	#PCI_EXP_SLTCTL
 24

	)

599 
	#PCI_EXP_SLTCTL_ABPE
 0x0001

	)

600 
	#PCI_EXP_SLTCTL_PFDE
 0x0002

	)

601 
	#PCI_EXP_SLTCTL_MRLSCE
 0x0004

	)

602 
	#PCI_EXP_SLTCTL_PDCE
 0x0008

	)

603 
	#PCI_EXP_SLTCTL_CCIE
 0x0010

	)

604 
	#PCI_EXP_SLTCTL_HPIE
 0x0020

	)

605 
	#PCI_EXP_SLTCTL_AIC
 0x00c0

	)

606 
	#PCI_EXP_SLTCTL_ATTN_IND_SHIFT
 6

	)

607 
	#PCI_EXP_SLTCTL_ATTN_IND_ON
 0x0040

	)

608 
	#PCI_EXP_SLTCTL_ATTN_IND_BLINK
 0x0080

	)

609 
	#PCI_EXP_SLTCTL_ATTN_IND_OFF
 0x00c0

	)

610 
	#PCI_EXP_SLTCTL_PIC
 0x0300

	)

611 
	#PCI_EXP_SLTCTL_PWR_IND_ON
 0x0100

	)

612 
	#PCI_EXP_SLTCTL_PWR_IND_BLINK
 0x0200

	)

613 
	#PCI_EXP_SLTCTL_PWR_IND_OFF
 0x0300

	)

614 
	#PCI_EXP_SLTCTL_PCC
 0x0400

	)

615 
	#PCI_EXP_SLTCTL_PWR_ON
 0x0000

	)

616 
	#PCI_EXP_SLTCTL_PWR_OFF
 0x0400

	)

617 
	#PCI_EXP_SLTCTL_EIC
 0x0800

	)

618 
	#PCI_EXP_SLTCTL_DLLSCE
 0x1000

	)

619 
	#PCI_EXP_SLTCTL_IBPD_DISABLE
 0x4000

	)

620 
	#PCI_EXP_SLTSTA
 26

	)

621 
	#PCI_EXP_SLTSTA_ABP
 0x0001

	)

622 
	#PCI_EXP_SLTSTA_PFD
 0x0002

	)

623 
	#PCI_EXP_SLTSTA_MRLSC
 0x0004

	)

624 
	#PCI_EXP_SLTSTA_PDC
 0x0008

	)

625 
	#PCI_EXP_SLTSTA_CC
 0x0010

	)

626 
	#PCI_EXP_SLTSTA_MRLSS
 0x0020

	)

627 
	#PCI_EXP_SLTSTA_PDS
 0x0040

	)

628 
	#PCI_EXP_SLTSTA_EIS
 0x0080

	)

629 
	#PCI_EXP_SLTSTA_DLLSC
 0x0100

	)

630 
	#PCI_EXP_RTCTL
 28

	)

631 
	#PCI_EXP_RTCTL_SECEE
 0x0001

	)

632 
	#PCI_EXP_RTCTL_SENFEE
 0x0002

	)

633 
	#PCI_EXP_RTCTL_SEFEE
 0x0004

	)

634 
	#PCI_EXP_RTCTL_PMEIE
 0x0008

	)

635 
	#PCI_EXP_RTCTL_CRSSVE
 0x0010

	)

636 
	#PCI_EXP_RTCAP
 30

	)

637 
	#PCI_EXP_RTCAP_CRSVIS
 0x0001

	)

638 
	#PCI_EXP_RTSTA
 32

	)

639 
	#PCI_EXP_RTSTA_PME
 0x00010000

	)

640 
	#PCI_EXP_RTSTA_PENDING
 0x00020000

	)

649 
	#PCI_EXP_DEVCAP2
 36

	)

650 
	#PCI_EXP_DEVCAP2_COMP_TMOUT_DIS
 0x00000010

	)

651 
	#PCI_EXP_DEVCAP2_ARI
 0x00000020

	)

652 
	#PCI_EXP_DEVCAP2_ATOMIC_ROUTE
 0x00000040

	)

653 
	#PCI_EXP_DEVCAP2_ATOMIC_COMP32
 0x00000080

	)

654 
	#PCI_EXP_DEVCAP2_ATOMIC_COMP64
 0x00000100

	)

655 
	#PCI_EXP_DEVCAP2_ATOMIC_COMP128
 0x00000200

	)

656 
	#PCI_EXP_DEVCAP2_LTR
 0x00000800

	)

657 
	#PCI_EXP_DEVCAP2_OBFF_MASK
 0x000c0000

	)

658 
	#PCI_EXP_DEVCAP2_OBFF_MSG
 0x00040000

	)

659 
	#PCI_EXP_DEVCAP2_OBFF_WAKE
 0x00080000

	)

660 
	#PCI_EXP_DEVCAP2_EE_PREFIX
 0x00200000

	)

661 
	#PCI_EXP_DEVCTL2
 40

	)

662 
	#PCI_EXP_DEVCTL2_COMP_TIMEOUT
 0x000‡

	)

663 
	#PCI_EXP_DEVCTL2_COMP_TMOUT_DIS
 0x0010

	)

664 
	#PCI_EXP_DEVCTL2_ARI
 0x0020

	)

665 
	#PCI_EXP_DEVCTL2_ATOMIC_REQ
 0x0040

	)

666 
	#PCI_EXP_DEVCTL2_ATOMIC_EGRESS_BLOCK
 0x0080

	)

667 
	#PCI_EXP_DEVCTL2_IDO_REQ_EN
 0x0100

	)

668 
	#PCI_EXP_DEVCTL2_IDO_CMP_EN
 0x0200

	)

669 
	#PCI_EXP_DEVCTL2_LTR_EN
 0x0400

	)

670 
	#PCI_EXP_DEVCTL2_OBFF_MSGA_EN
 0x2000

	)

671 
	#PCI_EXP_DEVCTL2_OBFF_MSGB_EN
 0x4000

	)

672 
	#PCI_EXP_DEVCTL2_OBFF_WAKE_EN
 0x6000

	)

673 
	#PCI_EXP_DEVSTA2
 42

	)

674 
	#PCI_CAP_EXP_RC_ENDPOINT_SIZEOF_V2
 44

	)

675 
	#PCI_EXP_LNKCAP2
 44

	)

676 
	#PCI_EXP_LNKCAP2_SLS_2_5GB
 0x00000002

	)

677 
	#PCI_EXP_LNKCAP2_SLS_5_0GB
 0x00000004

	)

678 
	#PCI_EXP_LNKCAP2_SLS_8_0GB
 0x00000008

	)

679 
	#PCI_EXP_LNKCAP2_SLS_16_0GB
 0x00000010

	)

680 
	#PCI_EXP_LNKCAP2_SLS_32_0GB
 0x00000020

	)

681 
	#PCI_EXP_LNKCAP2_SLS_64_0GB
 0x00000040

	)

682 
	#PCI_EXP_LNKCAP2_CROSSLINK
 0x00000100

	)

683 
	#PCI_EXP_LNKCTL2
 48

	)

684 
	#PCI_EXP_LNKCTL2_TLS
 0x000f

	)

685 
	#PCI_EXP_LNKCTL2_TLS_2_5GT
 0x0001

	)

686 
	#PCI_EXP_LNKCTL2_TLS_5_0GT
 0x0002

	)

687 
	#PCI_EXP_LNKCTL2_TLS_8_0GT
 0x0003

	)

688 
	#PCI_EXP_LNKCTL2_TLS_16_0GT
 0x0004

	)

689 
	#PCI_EXP_LNKCTL2_TLS_32_0GT
 0x0005

	)

690 
	#PCI_EXP_LNKCTL2_TLS_64_0GT
 0x0006

	)

691 
	#PCI_EXP_LNKCTL2_ENTER_COMP
 0x0010

	)

692 
	#PCI_EXP_LNKCTL2_TX_MARGIN
 0x0380

	)

693 
	#PCI_EXP_LNKCTL2_HASD
 0x0020

	)

694 
	#PCI_EXP_LNKSTA2
 50

	)

695 
	#PCI_CAP_EXP_ENDPOINT_SIZEOF_V2
 52

	)

696 
	#PCI_EXP_SLTCAP2
 52

	)

697 
	#PCI_EXP_SLTCAP2_IBPD
 0x00000001

	)

698 
	#PCI_EXP_SLTCTL2
 56

	)

699 
	#PCI_EXP_SLTSTA2
 58

	)

702 
	#PCI_EXT_CAP_ID
(
hódî
Ë(hódî & 0x0000ffff)

	)

703 
	#PCI_EXT_CAP_VER
(
hódî
Ë((hódî >> 16Ë& 0xf)

	)

704 
	#PCI_EXT_CAP_NEXT
(
hódî
Ë((hódî >> 20Ë& 0xffc)

	)

706 
	#PCI_EXT_CAP_ID_ERR
 0x01

	)

707 
	#PCI_EXT_CAP_ID_VC
 0x02

	)

708 
	#PCI_EXT_CAP_ID_DSN
 0x03

	)

709 
	#PCI_EXT_CAP_ID_PWR
 0x04

	)

710 
	#PCI_EXT_CAP_ID_RCLD
 0x05

	)

711 
	#PCI_EXT_CAP_ID_RCILC
 0x06

	)

712 
	#PCI_EXT_CAP_ID_RCEC
 0x07

	)

713 
	#PCI_EXT_CAP_ID_MFVC
 0x08

	)

714 
	#PCI_EXT_CAP_ID_VC9
 0x09

	)

715 
	#PCI_EXT_CAP_ID_RCRB
 0x0A

	)

716 
	#PCI_EXT_CAP_ID_VNDR
 0x0B

	)

717 
	#PCI_EXT_CAP_ID_CAC
 0x0C

	)

718 
	#PCI_EXT_CAP_ID_ACS
 0x0D

	)

719 
	#PCI_EXT_CAP_ID_ARI
 0x0E

	)

720 
	#PCI_EXT_CAP_ID_ATS
 0x0F

	)

721 
	#PCI_EXT_CAP_ID_SRIOV
 0x10

	)

722 
	#PCI_EXT_CAP_ID_MRIOV
 0x11

	)

723 
	#PCI_EXT_CAP_ID_MCAST
 0x12

	)

724 
	#PCI_EXT_CAP_ID_PRI
 0x13

	)

725 
	#PCI_EXT_CAP_ID_AMD_XXX
 0x14

	)

726 
	#PCI_EXT_CAP_ID_REBAR
 0x15

	)

727 
	#PCI_EXT_CAP_ID_DPA
 0x16

	)

728 
	#PCI_EXT_CAP_ID_TPH
 0x17

	)

729 
	#PCI_EXT_CAP_ID_LTR
 0x18

	)

730 
	#PCI_EXT_CAP_ID_SECPCI
 0x19

	)

731 
	#PCI_EXT_CAP_ID_PMUX
 0x1A

	)

732 
	#PCI_EXT_CAP_ID_PASID
 0x1B

	)

733 
	#PCI_EXT_CAP_ID_DPC
 0x1D

	)

734 
	#PCI_EXT_CAP_ID_L1SS
 0x1E

	)

735 
	#PCI_EXT_CAP_ID_PTM
 0x1F

	)

736 
	#PCI_EXT_CAP_ID_DVSEC
 0x23

	)

737 
	#PCI_EXT_CAP_ID_DLF
 0x25

	)

738 
	#PCI_EXT_CAP_ID_PL_16GT
 0x26

	)

739 
	#PCI_EXT_CAP_ID_MAX
 
PCI_EXT_CAP_ID_PL_16GT


	)

741 
	#PCI_EXT_CAP_DSN_SIZEOF
 12

	)

742 
	#PCI_EXT_CAP_MCAST_ENDPOINT_SIZEOF
 40

	)

745 
	#PCI_ERR_UNCOR_STATUS
 4

	)

746 
	#PCI_ERR_UNC_UND
 0x00000001

	)

747 
	#PCI_ERR_UNC_DLP
 0x00000010

	)

748 
	#PCI_ERR_UNC_SURPDN
 0x00000020

	)

749 
	#PCI_ERR_UNC_POISON_TLP
 0x00001000

	)

750 
	#PCI_ERR_UNC_FCP
 0x00002000

	)

751 
	#PCI_ERR_UNC_COMP_TIME
 0x00004000

	)

752 
	#PCI_ERR_UNC_COMP_ABORT
 0x00008000

	)

753 
	#PCI_ERR_UNC_UNX_COMP
 0x00010000

	)

754 
	#PCI_ERR_UNC_RX_OVER
 0x00020000

	)

755 
	#PCI_ERR_UNC_MALF_TLP
 0x00040000

	)

756 
	#PCI_ERR_UNC_ECRC
 0x00080000

	)

757 
	#PCI_ERR_UNC_UNSUP
 0x00100000

	)

758 
	#PCI_ERR_UNC_ACSV
 0x00200000

	)

759 
	#PCI_ERR_UNC_INTN
 0x00400000

	)

760 
	#PCI_ERR_UNC_MCBTLP
 0x00800000

	)

761 
	#PCI_ERR_UNC_ATOMEG
 0x01000000

	)

762 
	#PCI_ERR_UNC_TLPPRE
 0x02000000

	)

763 
	#PCI_ERR_UNCOR_MASK
 8

	)

765 
	#PCI_ERR_UNCOR_SEVER
 12

	)

767 
	#PCI_ERR_COR_STATUS
 16

	)

768 
	#PCI_ERR_COR_RCVR
 0x00000001

	)

769 
	#PCI_ERR_COR_BAD_TLP
 0x00000040

	)

770 
	#PCI_ERR_COR_BAD_DLLP
 0x00000080

	)

771 
	#PCI_ERR_COR_REP_ROLL
 0x00000100

	)

772 
	#PCI_ERR_COR_REP_TIMER
 0x00001000

	)

773 
	#PCI_ERR_COR_ADV_NFAT
 0x00002000

	)

774 
	#PCI_ERR_COR_INTERNAL
 0x00004000

	)

775 
	#PCI_ERR_COR_LOG_OVER
 0x00008000

	)

776 
	#PCI_ERR_COR_MASK
 20

	)

778 
	#PCI_ERR_CAP
 24

	)

779 
	#PCI_ERR_CAP_FEP
(
x
Ë((xË& 31Ë

	)

780 
	#PCI_ERR_CAP_ECRC_GENC
 0x00000020

	)

781 
	#PCI_ERR_CAP_ECRC_GENE
 0x00000040

	)

782 
	#PCI_ERR_CAP_ECRC_CHKC
 0x00000080

	)

783 
	#PCI_ERR_CAP_ECRC_CHKE
 0x00000100

	)

784 
	#PCI_ERR_HEADER_LOG
 28

	)

785 
	#PCI_ERR_ROOT_COMMAND
 44

	)

786 
	#PCI_ERR_ROOT_CMD_COR_EN
 0x00000001

	)

787 
	#PCI_ERR_ROOT_CMD_NONFATAL_EN
 0x00000002

	)

788 
	#PCI_ERR_ROOT_CMD_FATAL_EN
 0x00000004

	)

789 
	#PCI_ERR_ROOT_STATUS
 48

	)

790 
	#PCI_ERR_ROOT_COR_RCV
 0x00000001

	)

791 
	#PCI_ERR_ROOT_MULTI_COR_RCV
 0x00000002

	)

792 
	#PCI_ERR_ROOT_UNCOR_RCV
 0x00000004

	)

793 
	#PCI_ERR_ROOT_MULTI_UNCOR_RCV
 0x00000008

	)

794 
	#PCI_ERR_ROOT_FIRST_FATAL
 0x00000010

	)

795 
	#PCI_ERR_ROOT_NONFATAL_RCV
 0x00000020

	)

796 
	#PCI_ERR_ROOT_FATAL_RCV
 0x00000040

	)

797 
	#PCI_ERR_ROOT_AER_IRQ
 0xf8000000

	)

798 
	#PCI_ERR_ROOT_ERR_SRC
 52

	)

801 
	#PCI_VC_PORT_CAP1
 4

	)

802 
	#PCI_VC_CAP1_EVCC
 0x00000007

	)

803 
	#PCI_VC_CAP1_LPEVCC
 0x00000070

	)

804 
	#PCI_VC_CAP1_ARB_SIZE
 0x00000c00

	)

805 
	#PCI_VC_PORT_CAP2
 8

	)

806 
	#PCI_VC_CAP2_32_PHASE
 0x00000002

	)

807 
	#PCI_VC_CAP2_64_PHASE
 0x00000004

	)

808 
	#PCI_VC_CAP2_128_PHASE
 0x00000008

	)

809 
	#PCI_VC_CAP2_ARB_OFF
 0xff000000

	)

810 
	#PCI_VC_PORT_CTRL
 12

	)

811 
	#PCI_VC_PORT_CTRL_LOAD_TABLE
 0x00000001

	)

812 
	#PCI_VC_PORT_STATUS
 14

	)

813 
	#PCI_VC_PORT_STATUS_TABLE
 0x00000001

	)

814 
	#PCI_VC_RES_CAP
 16

	)

815 
	#PCI_VC_RES_CAP_32_PHASE
 0x00000002

	)

816 
	#PCI_VC_RES_CAP_64_PHASE
 0x00000004

	)

817 
	#PCI_VC_RES_CAP_128_PHASE
 0x00000008

	)

818 
	#PCI_VC_RES_CAP_128_PHASE_TB
 0x00000010

	)

819 
	#PCI_VC_RES_CAP_256_PHASE
 0x00000020

	)

820 
	#PCI_VC_RES_CAP_ARB_OFF
 0xff000000

	)

821 
	#PCI_VC_RES_CTRL
 20

	)

822 
	#PCI_VC_RES_CTRL_LOAD_TABLE
 0x00010000

	)

823 
	#PCI_VC_RES_CTRL_ARB_SELECT
 0x000e0000

	)

824 
	#PCI_VC_RES_CTRL_ID
 0x07000000

	)

825 
	#PCI_VC_RES_CTRL_ENABLE
 0x80000000

	)

826 
	#PCI_VC_RES_STATUS
 26

	)

827 
	#PCI_VC_RES_STATUS_TABLE
 0x00000001

	)

828 
	#PCI_VC_RES_STATUS_NEGO
 0x00000002

	)

829 
	#PCI_CAP_VC_BASE_SIZEOF
 0x10

	)

830 
	#PCI_CAP_VC_PER_VC_SIZEOF
 0x0C

	)

833 
	#PCI_PWR_DSR
 4

	)

834 
	#PCI_PWR_DATA
 8

	)

835 
	#PCI_PWR_DATA_BASE
(
x
Ë((xË& 0xffË

	)

836 
	#PCI_PWR_DATA_SCALE
(
x
Ë(((xË>> 8Ë& 3Ë

	)

837 
	#PCI_PWR_DATA_PM_SUB
(
x
Ë(((xË>> 10Ë& 7Ë

	)

838 
	#PCI_PWR_DATA_PM_STATE
(
x
Ë(((xË>> 13Ë& 3Ë

	)

839 
	#PCI_PWR_DATA_TYPE
(
x
Ë(((xË>> 15Ë& 7Ë

	)

840 
	#PCI_PWR_DATA_RAIL
(
x
Ë(((xË>> 18Ë& 7Ë

	)

841 
	#PCI_PWR_CAP
 12

	)

842 
	#PCI_PWR_CAP_BUDGET
(
x
Ë((xË& 1Ë

	)

843 
	#PCI_EXT_CAP_PWR_SIZEOF
 16

	)

846 
	#PCI_RCEC_RCIEP_BITMAP
 4

	)

847 
	#PCI_RCEC_BUSN
 8

	)

848 
	#PCI_RCEC_BUSN_REG_VER
 0x02

	)

849 
	#PCI_RCEC_BUSN_NEXT
(
x
Ë(((xË>> 8Ë& 0xff)

	)

850 
	#PCI_RCEC_BUSN_LAST
(
x
Ë(((xË>> 16Ë& 0xff)

	)

853 
	#PCI_VNDR_HEADER
 4

	)

854 
	#PCI_VNDR_HEADER_ID
(
x
Ë((xË& 0xffff)

	)

855 
	#PCI_VNDR_HEADER_REV
(
x
Ë(((xË>> 16Ë& 0xf)

	)

856 
	#PCI_VNDR_HEADER_LEN
(
x
Ë(((xË>> 20Ë& 0xfff)

	)

866 
	#HT_3BIT_CAP_MASK
 0xE0

	)

867 
	#HT_CAPTYPE_SLAVE
 0x00

	)

868 
	#HT_CAPTYPE_HOST
 0x20

	)

870 
	#HT_5BIT_CAP_MASK
 0xF8

	)

871 
	#HT_CAPTYPE_IRQ
 0x80

	)

872 
	#HT_CAPTYPE_REMAPPING_40
 0xA0

	)

873 
	#HT_CAPTYPE_REMAPPING_64
 0xA2

	)

874 
	#HT_CAPTYPE_UNITID_CLUMP
 0x90

	)

875 
	#HT_CAPTYPE_EXTCONF
 0x98

	)

876 
	#HT_CAPTYPE_MSI_MAPPING
 0xA8

	)

877 
	#HT_MSI_FLAGS
 0x02

	)

878 
	#HT_MSI_FLAGS_ENABLE
 0x1

	)

879 
	#HT_MSI_FLAGS_FIXED
 0x2

	)

880 
	#HT_MSI_FIXED_ADDR
 0x00000000FEE00000ULL

	)

881 
	#HT_MSI_ADDR_LO
 0x04

	)

882 
	#HT_MSI_ADDR_LO_MASK
 0xFFF00000

	)

883 
	#HT_MSI_ADDR_HI
 0x08

	)

884 
	#HT_CAPTYPE_DIRECT_ROUTE
 0xB0

	)

885 
	#HT_CAPTYPE_VCSET
 0xB8

	)

886 
	#HT_CAPTYPE_ERROR_RETRY
 0xC0

	)

887 
	#HT_CAPTYPE_GEN3
 0xD0

	)

888 
	#HT_CAPTYPE_PM
 0xE0

	)

889 
	#HT_CAP_SIZEOF_LONG
 28

	)

890 
	#HT_CAP_SIZEOF_SHORT
 24

	)

893 
	#PCI_ARI_CAP
 0x04

	)

894 
	#PCI_ARI_CAP_MFVC
 0x0001

	)

895 
	#PCI_ARI_CAP_ACS
 0x0002

	)

896 
	#PCI_ARI_CAP_NFN
(
x
Ë(((xË>> 8Ë& 0xffË

	)

897 
	#PCI_ARI_CTRL
 0x06

	)

898 
	#PCI_ARI_CTRL_MFVC
 0x0001

	)

899 
	#PCI_ARI_CTRL_ACS
 0x0002

	)

900 
	#PCI_ARI_CTRL_FG
(
x
Ë(((xË>> 4Ë& 7Ë

	)

901 
	#PCI_EXT_CAP_ARI_SIZEOF
 8

	)

904 
	#PCI_ATS_CAP
 0x04

	)

905 
	#PCI_ATS_CAP_QDEP
(
x
Ë((xË& 0x1fË

	)

906 
	#PCI_ATS_MAX_QDEP
 32

	)

907 
	#PCI_ATS_CAP_PAGE_ALIGNED
 0x0020

	)

908 
	#PCI_ATS_CTRL
 0x06

	)

909 
	#PCI_ATS_CTRL_ENABLE
 0x8000

	)

910 
	#PCI_ATS_CTRL_STU
(
x
Ë((xË& 0x1fË

	)

911 
	#PCI_ATS_MIN_STU
 12

	)

912 
	#PCI_EXT_CAP_ATS_SIZEOF
 8

	)

915 
	#PCI_PRI_CTRL
 0x04

	)

916 
	#PCI_PRI_CTRL_ENABLE
 0x0001

	)

917 
	#PCI_PRI_CTRL_RESET
 0x0002

	)

918 
	#PCI_PRI_STATUS
 0x06

	)

919 
	#PCI_PRI_STATUS_RF
 0x0001

	)

920 
	#PCI_PRI_STATUS_UPRGI
 0x0002

	)

921 
	#PCI_PRI_STATUS_STOPPED
 0x0100

	)

922 
	#PCI_PRI_STATUS_PASID
 0x8000

	)

923 
	#PCI_PRI_MAX_REQ
 0x08

	)

924 
	#PCI_PRI_ALLOC_REQ
 0x0¯

	)

925 
	#PCI_EXT_CAP_PRI_SIZEOF
 16

	)

928 
	#PCI_PASID_CAP
 0x04

	)

929 
	#PCI_PASID_CAP_EXEC
 0x02

	)

930 
	#PCI_PASID_CAP_PRIV
 0x04

	)

931 
	#PCI_PASID_CTRL
 0x06

	)

932 
	#PCI_PASID_CTRL_ENABLE
 0x01

	)

933 
	#PCI_PASID_CTRL_EXEC
 0x02

	)

934 
	#PCI_PASID_CTRL_PRIV
 0x04

	)

935 
	#PCI_EXT_CAP_PASID_SIZEOF
 8

	)

938 
	#PCI_SRIOV_CAP
 0x04

	)

939 
	#PCI_SRIOV_CAP_VFM
 0x00000001

	)

940 
	#PCI_SRIOV_CAP_INTR
(
x
Ë((xË>> 21Ë

	)

941 
	#PCI_SRIOV_CTRL
 0x08

	)

942 
	#PCI_SRIOV_CTRL_VFE
 0x0001

	)

943 
	#PCI_SRIOV_CTRL_VFM
 0x0002

	)

944 
	#PCI_SRIOV_CTRL_INTR
 0x0004

	)

945 
	#PCI_SRIOV_CTRL_MSE
 0x0008

	)

946 
	#PCI_SRIOV_CTRL_ARI
 0x0010

	)

947 
	#PCI_SRIOV_STATUS
 0x0®

	)

948 
	#PCI_SRIOV_STATUS_VFM
 0x0001

	)

949 
	#PCI_SRIOV_INITIAL_VF
 0x0¯

	)

950 
	#PCI_SRIOV_TOTAL_VF
 0x0ê

	)

951 
	#PCI_SRIOV_NUM_VF
 0x10

	)

952 
	#PCI_SRIOV_FUNC_LINK
 0x12

	)

953 
	#PCI_SRIOV_VF_OFFSET
 0x14

	)

954 
	#PCI_SRIOV_VF_STRIDE
 0x16

	)

955 
	#PCI_SRIOV_VF_DID
 0x1®

	)

956 
	#PCI_SRIOV_SUP_PGSIZE
 0x1¯

	)

957 
	#PCI_SRIOV_SYS_PGSIZE
 0x20

	)

958 
	#PCI_SRIOV_BAR
 0x24

	)

959 
	#PCI_SRIOV_NUM_BARS
 6

	)

960 
	#PCI_SRIOV_VFM
 0x3¯

	)

961 
	#PCI_SRIOV_VFM_BIR
(
x
Ë((xË& 7Ë

	)

962 
	#PCI_SRIOV_VFM_OFFSET
(
x
Ë((xË& ~7Ë

	)

963 
	#PCI_SRIOV_VFM_UA
 0x0

	)

964 
	#PCI_SRIOV_VFM_MI
 0x1

	)

965 
	#PCI_SRIOV_VFM_MO
 0x2

	)

966 
	#PCI_SRIOV_VFM_AV
 0x3

	)

967 
	#PCI_EXT_CAP_SRIOV_SIZEOF
 64

	)

969 
	#PCI_LTR_MAX_SNOOP_LAT
 0x4

	)

970 
	#PCI_LTR_MAX_NOSNOOP_LAT
 0x6

	)

971 
	#PCI_LTR_VALUE_MASK
 0x000003ff

	)

972 
	#PCI_LTR_SCALE_MASK
 0x00001c00

	)

973 
	#PCI_LTR_SCALE_SHIFT
 10

	)

974 
	#PCI_EXT_CAP_LTR_SIZEOF
 8

	)

977 
	#PCI_ACS_CAP
 0x04

	)

978 
	#PCI_ACS_SV
 0x0001

	)

979 
	#PCI_ACS_TB
 0x0002

	)

980 
	#PCI_ACS_RR
 0x0004

	)

981 
	#PCI_ACS_CR
 0x0008

	)

982 
	#PCI_ACS_UF
 0x0010

	)

983 
	#PCI_ACS_EC
 0x0020

	)

984 
	#PCI_ACS_DT
 0x0040

	)

985 
	#PCI_ACS_EGRESS_BITS
 0x05

	)

986 
	#PCI_ACS_CTRL
 0x06

	)

987 
	#PCI_ACS_EGRESS_CTL_V
 0x08

	)

989 
	#PCI_VSEC_HDR
 4

	)

990 
	#PCI_VSEC_HDR_LEN_SHIFT
 20

	)

993 
	#PCI_SATA_REGS
 4

	)

994 
	#PCI_SATA_REGS_MASK
 0xF

	)

995 
	#PCI_SATA_REGS_INLINE
 0xF

	)

996 
	#PCI_SATA_SIZEOF_SHORT
 8

	)

997 
	#PCI_SATA_SIZEOF_LONG
 16

	)

1000 
	#PCI_REBAR_CAP
 4

	)

1001 
	#PCI_REBAR_CAP_SIZES
 0x00FFFFF0

	)

1002 
	#PCI_REBAR_CTRL
 8

	)

1003 
	#PCI_REBAR_CTRL_BAR_IDX
 0x00000007

	)

1004 
	#PCI_REBAR_CTRL_NBAR_MASK
 0x000000E0

	)

1005 
	#PCI_REBAR_CTRL_NBAR_SHIFT
 5

	)

1006 
	#PCI_REBAR_CTRL_BAR_SIZE
 0x00001F00

	)

1007 
	#PCI_REBAR_CTRL_BAR_SHIFT
 8

	)

1010 
	#PCI_DPA_CAP
 4

	)

1011 
	#PCI_DPA_CAP_SUBSTATE_MASK
 0x1F

	)

1012 
	#PCI_DPA_BASE_SIZEOF
 16

	)

1015 
	#PCI_TPH_CAP
 4

	)

1016 
	#PCI_TPH_CAP_LOC_MASK
 0x600

	)

1017 
	#PCI_TPH_LOC_NONE
 0x000

	)

1018 
	#PCI_TPH_LOC_CAP
 0x200

	)

1019 
	#PCI_TPH_LOC_MSIX
 0x400

	)

1020 
	#PCI_TPH_CAP_ST_MASK
 0x07FF0000

	)

1021 
	#PCI_TPH_CAP_ST_SHIFT
 16

	)

1022 
	#PCI_TPH_BASE_SIZEOF
 12

	)

1025 
	#PCI_EXP_DPC_CAP
 4

	)

1026 
	#PCI_EXP_DPC_IRQ
 0x001F

	)

1027 
	#PCI_EXP_DPC_CAP_RP_EXT
 0x0020

	)

1028 
	#PCI_EXP_DPC_CAP_POISONED_TLP
 0x0040

	)

1029 
	#PCI_EXP_DPC_CAP_SW_TRIGGER
 0x0080

	)

1030 
	#PCI_EXP_DPC_RP_PIO_LOG_SIZE
 0x0F00

	)

1031 
	#PCI_EXP_DPC_CAP_DL_ACTIVE
 0x1000

	)

1033 
	#PCI_EXP_DPC_CTL
 6

	)

1034 
	#PCI_EXP_DPC_CTL_EN_FATAL
 0x0001

	)

1035 
	#PCI_EXP_DPC_CTL_EN_NONFATAL
 0x0002

	)

1036 
	#PCI_EXP_DPC_CTL_INT_EN
 0x0008

	)

1038 
	#PCI_EXP_DPC_STATUS
 8

	)

1039 
	#PCI_EXP_DPC_STATUS_TRIGGER
 0x0001

	)

1040 
	#PCI_EXP_DPC_STATUS_TRIGGER_RSN
 0x0006

	)

1041 
	#PCI_EXP_DPC_STATUS_INTERRUPT
 0x0008

	)

1042 
	#PCI_EXP_DPC_RP_BUSY
 0x0010

	)

1043 
	#PCI_EXP_DPC_STATUS_TRIGGER_RSN_EXT
 0x0060

	)

1045 
	#PCI_EXP_DPC_SOURCE_ID
 10

	)

1047 
	#PCI_EXP_DPC_RP_PIO_STATUS
 0x0C

	)

1048 
	#PCI_EXP_DPC_RP_PIO_MASK
 0x10

	)

1049 
	#PCI_EXP_DPC_RP_PIO_SEVERITY
 0x14

	)

1050 
	#PCI_EXP_DPC_RP_PIO_SYSERROR
 0x18

	)

1051 
	#PCI_EXP_DPC_RP_PIO_EXCEPTION
 0x1C

	)

1052 
	#PCI_EXP_DPC_RP_PIO_HEADER_LOG
 0x20

	)

1053 
	#PCI_EXP_DPC_RP_PIO_IMPSPEC_LOG
 0x30

	)

1054 
	#PCI_EXP_DPC_RP_PIO_TLPPREFIX_LOG
 0x34

	)

1057 
	#PCI_PTM_CAP
 0x04

	)

1058 
	#PCI_PTM_CAP_REQ
 0x00000001

	)

1059 
	#PCI_PTM_CAP_ROOT
 0x00000004

	)

1060 
	#PCI_PTM_GRANULARITY_MASK
 0x0000FF00

	)

1061 
	#PCI_PTM_CTRL
 0x08

	)

1062 
	#PCI_PTM_CTRL_ENABLE
 0x00000001

	)

1063 
	#PCI_PTM_CTRL_ROOT
 0x00000002

	)

1066 
	#PCI_L1SS_CAP
 0x04

	)

1067 
	#PCI_L1SS_CAP_PCIPM_L1_2
 0x00000001

	)

1068 
	#PCI_L1SS_CAP_PCIPM_L1_1
 0x00000002

	)

1069 
	#PCI_L1SS_CAP_ASPM_L1_2
 0x00000004

	)

1070 
	#PCI_L1SS_CAP_ASPM_L1_1
 0x00000008

	)

1071 
	#PCI_L1SS_CAP_L1_PM_SS
 0x00000010

	)

1072 
	#PCI_L1SS_CAP_CM_RESTORE_TIME
 0x0000ff00

	)

1073 
	#PCI_L1SS_CAP_P_PWR_ON_SCALE
 0x00030000

	)

1074 
	#PCI_L1SS_CAP_P_PWR_ON_VALUE
 0x00f80000

	)

1075 
	#PCI_L1SS_CTL1
 0x08

	)

1076 
	#PCI_L1SS_CTL1_PCIPM_L1_2
 0x00000001

	)

1077 
	#PCI_L1SS_CTL1_PCIPM_L1_1
 0x00000002

	)

1078 
	#PCI_L1SS_CTL1_ASPM_L1_2
 0x00000004

	)

1079 
	#PCI_L1SS_CTL1_ASPM_L1_1
 0x00000008

	)

1080 
	#PCI_L1SS_CTL1_L1_2_MASK
 0x00000005

	)

1081 
	#PCI_L1SS_CTL1_L1SS_MASK
 0x0000000f

	)

1082 
	#PCI_L1SS_CTL1_CM_RESTORE_TIME
 0x0000ff00

	)

1083 
	#PCI_L1SS_CTL1_LTR_L12_TH_VALUE
 0x03ff0000

	)

1084 
	#PCI_L1SS_CTL1_LTR_L12_TH_SCALE
 0xe0000000

	)

1085 
	#PCI_L1SS_CTL2
 0x0¯

	)

1088 
	#PCI_DVSEC_HEADER1
 0x4

	)

1089 
	#PCI_DVSEC_HEADER2
 0x8

	)

1092 
	#PCI_DLF_CAP
 0x04

	)

1093 
	#PCI_DLF_EXCHANGE_ENABLE
 0x80000000

	)

1096 
	#PCI_PL_16GT_LE_CTRL
 0x20

	)

1097 
	#PCI_PL_16GT_LE_CTRL_DSP_TX_PRESET_MASK
 0x0000000F

	)

1098 
	#PCI_PL_16GT_LE_CTRL_USP_TX_PRESET_MASK
 0x000000F0

	)

1099 
	#PCI_PL_16GT_LE_CTRL_USP_TX_PRESET_SHIFT
 4

	)

	@/usr/include/linux/posix_types.h

2 #i‚de‡
_LINUX_POSIX_TYPES_H


3 
	#_LINUX_POSIX_TYPES_H


	)

5 
	~<löux/°ddef.h
>

22 #unde‡
__FD_SETSIZE


23 
	#__FD_SETSIZE
 1024

	)

26 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

27 } 
	t__kî√l_fd_£t
;

30 (*
	t__kî√l_sigh™dÀr_t
)();

33 
	t__kî√l_key_t
;

34 
	t__kî√l_mqd_t
;

36 
	~<asm/posix_ty≥s.h
>

	@/usr/include/linux/socket.h

2 #i‚de‡
_LINUX_SOCKET_H


3 
	#_LINUX_SOCKET_H


	)

8 
	#_K_SS_MAXSIZE
 128

	)

10 
	t__kî√l_ß_Ámûy_t
;

16 
	s__kî√l_sockaddr_°‹age
 {

19 
__kî√l_ß_Ámûy_t
 
	mss_Ámûy
;

21 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

25 *
	m__Æign
;

29 
	#SOCK_SNDBUF_LOCK
 1

	)

30 
	#SOCK_RCVBUF_LOCK
 2

	)

32 
	#SOCK_BUF_LOCK_MASK
 (
SOCK_SNDBUF_LOCK
 | 
SOCK_RCVBUF_LOCK
)

	)

	@/usr/include/linux/stddef.h

2 #i‚de‡
_LINUX_STDDEF_H


3 
	#_LINUX_STDDEF_H


	)

7 #i‚de‡
__Æways_ölöe


8 
	#__Æways_ölöe
 
__ölöe__


	)

26 
	#__°ru˘_group
(
TAG
, 
NAME
, 
ATTRS
, 
MEMBERS
...) \

28 °ru˘ { 
MEMBERS
 } 
ATTRS
; \

29 
	sTAG
 { 
MEMBERS
 } 
ATTRS
 
NAME
; \

30 } 
ATTRS


	)

42 
	#__DECLARE_FLEX_ARRAY
(
TYPE
, 
NAME
) \

44 °ru˘ { } 
__em±y_
 ## 
NAME
; \

45 
TYPE
 
NAME
[]; \

46 }

	)

	@/usr/include/linux/sysinfo.h

2 #i‚de‡
_LINUX_SYSINFO_H


3 
	#_LINUX_SYSINFO_H


	)

5 
	~<löux/ty≥s.h
>

7 
	#SI_LOAD_SHIFT
 16

	)

8 
	ssysöfo
 {

9 
__kî√l_l⁄g_t
 
	mu±ime
;

10 
__kî√l_ul⁄g_t
 
	mlﬂds
[3];

11 
__kî√l_ul⁄g_t
 
	mtŸÆøm
;

12 
__kî√l_ul⁄g_t
 
	m‰ìøm
;

13 
__kî√l_ul⁄g_t
 
	msh¨edøm
;

14 
__kî√l_ul⁄g_t
 
	mbuf„ºam
;

15 
__kî√l_ul⁄g_t
 
	mtŸÆsw≠
;

16 
__kî√l_ul⁄g_t
 
	m‰ìsw≠
;

17 
__u16
 
	m¥ocs
;

18 
__u16
 
	m∑d
;

19 
__kî√l_ul⁄g_t
 
	mtŸÆhigh
;

20 
__kî√l_ul⁄g_t
 
	m‰ìhigh
;

21 
__u32
 
	mmem_unô
;

22 
	m_f
[20-2*(
__kî√l_ul⁄g_t
)-(
__u32
)];

	@/usr/include/linux/time_types.h

2 #i‚de‡
_LINUX_TIME_TYPES_H


3 
	#_LINUX_TIME_TYPES_H


	)

5 
	~<löux/ty≥s.h
>

7 
	s__kî√l_time•ec
 {

8 
__kî√l_time64_t
 
	mtv_£c
;

9 
	mtv_n£c
;

12 
	s__kî√l_ôimî•ec
 {

13 
__kî√l_time•ec
 
	mô_öãrvÆ
;

14 
__kî√l_time•ec
 
	mô_vÆue
;

24 #i‚de‡
__kî√l_ﬁd_timevÆ


25 
	s__kî√l_ﬁd_timevÆ
 {

26 
__kî√l_l⁄g_t
 
	mtv_£c
;

27 
__kî√l_l⁄g_t
 
	mtv_u£c
;

31 
	s__kî√l_ﬁd_time•ec
 {

32 
__kî√l_ﬁd_time_t
 
	mtv_£c
;

33 
	mtv_n£c
;

36 
	s__kî√l_ﬁd_ôimîvÆ
 {

37 
__kî√l_ﬁd_timevÆ
 
	mô_öãrvÆ
;

38 
__kî√l_ﬁd_timevÆ
 
	mô_vÆue
;

41 
	s__kî√l_sock_timevÆ
 {

42 
__s64
 
	mtv_£c
;

43 
__s64
 
	mtv_u£c
;

	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<bôs/libc-hódî-°¨t.h
>

28 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

36 #i‡
deföed
 
__˝lu•lus
 && (
__GNUC_PREREQ
 (4, 4) \

37 || 
	$__glibc_˛™g_¥îeq
 (3, 5))

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

43 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

44 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

47 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

48 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

53 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN
 || 
	`__GLIBC_USE
 (
ISOC2X
)

54 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
	`__©å_ac˚ss
 ((
__wrôe_⁄ly__
, 1, 4));

61 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

64 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

65 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

80 
	$__memcm≥q
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

81 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

84 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


87 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

88 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

89 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

90 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

92 #ifde‡
__OPTIMIZE__


93 
__exã∫_Æways_ölöe
 *

94 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


96  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

99 
__exã∫_Æways_ölöe
 const *

100 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


102  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

105 
	}
}

107 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

108 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

111 #ifde‡
__USE_GNU


114 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

116 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

117 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

118 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

120 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

121 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

125 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


126 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

127 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1))

128 
	`__©å_ac˚ss
 ((
__ªad_⁄ly__
, 1, 3));

129 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

130 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1))

131 
	`__©å_ac˚ss
 ((
__ªad_⁄ly__
, 1, 3));

133 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

134 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1))

135 
	`__©å_ac˚ss
 ((
__ªad_⁄ly__
, 1, 3));

141 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

142 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

144 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

145 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

146 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

149 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

150 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

152 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

153 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

156 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

157 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

159 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

160 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

163 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

164 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

166 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

167 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

168 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
	`__©å_ac˚ss
 ((
__wrôe_⁄ly__
, 1, 3));

170 #ifde‡
__USE_XOPEN2K8


172 
	~<bôs/ty≥s/loˇÀ_t.h
>

175 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
loˇÀ_t
 
__l
)

176 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

179 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

180 
loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4))

181 
	`__©å_ac˚ss
 ((
__wrôe_⁄ly__
, 1, 3));

184 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8
 \

185 || 
	`__GLIBC_USE
 (
LIB_EXT2
Ë|| 
	$__GLIBC_USE
 (
ISOC2X
))

187 *
	$°rdup
 (c⁄° *
__s
)

188 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

194 #i‡
deföed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
Ë|| __GLIBC_USE (
ISOC2X
)

195 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

196 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

199 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


201 
	#°rdu∑
(
s
) \

202 (
__exãnsi⁄__
 \

204 c⁄° *
__ﬁd
 = (
s
); \

205 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

206 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

207 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

208 
	}
}))

	)

211 
	#°∫du∑
(
s
, 
n
) \

212 (
__exãnsi⁄__
 \

214 c⁄° *
__ﬁd
 = (
s
); \

215 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

216 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

217 
__√w
[
__Àn
] = '\0'; \

218 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

219 }))

	)

223 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


226 *
°rchr
 (*
__s
, 
__c
)

227 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

228 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

229 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

231 #ifde‡
__OPTIMIZE__


232 
__exã∫_Æways_ölöe
 *

233 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


235  
__buûtö_°rchr
 (
__s
, 
__c
);

238 
__exã∫_Æways_ölöe
 const *

239 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


241  
__buûtö_°rchr
 (
__s
, 
__c
);

246 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

247 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

250 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


253 *
	`°ºchr
 (*
__s
, 
__c
)

254 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

255 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

256 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

258 #ifde‡
__OPTIMIZE__


259 
__exã∫_Æways_ölöe
 *

260 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


262  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

265 
__exã∫_Æways_ölöe
 const *

266 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


268  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

271 
	}
}

273 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

274 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

277 #ifde‡
__USE_GNU


280 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


281 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

282 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

283 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

284 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

286 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

287 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

293 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

294 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

297 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

298 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

300 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


303 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

304 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

305 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

306 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

308 #ifde‡
__OPTIMIZE__


309 
__exã∫_Æways_ölöe
 *

310 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


312  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

315 
__exã∫_Æways_ölöe
 const *

316 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


318  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

321 
	}
}

323 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

324 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

327 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


330 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

331 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

332 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

333 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

335 #ifde‡
__OPTIMIZE__


336 
__exã∫_Æways_ölöe
 *

337 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


339  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

342 
__exã∫_Æways_ölöe
 const *

343 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


345  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

348 
	}
}

350 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

351 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

356 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

357 
__THROW
 
	`__n⁄nuŒ
 ((2));

361 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

362 c⁄° *
__ª°ri˘
 
__dñim
,

363 **
__ª°ri˘
 
__ßve_±r
)

364 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

365 #ifde‡
__USE_POSIX


366 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

367 **
__ª°ri˘
 
__ßve_±r
)

368 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

371 #ifde‡
__USE_GNU


373 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


374 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

375 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

376 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

377 c⁄° *
__√edÀ
)

378 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

380 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

381 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

385 #ifde‡
__USE_GNU


389 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

390 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

391 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3))

392 
	`__©å_ac˚ss
 ((
__ªad_⁄ly__
, 1, 2))

393 
	`__©å_ac˚ss
 ((
__ªad_⁄ly__
, 3, 4));

397 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

398 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

399 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

400 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

401 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

402 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

407 
size_t
 
	$°æí
 (c⁄° *
__s
)

408 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

410 #ifdef 
__USE_XOPEN2K8


413 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

414 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

419 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

420 #ifde‡
__USE_XOPEN2K


428 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


431 #ifde‡
__REDIRECT_NTH


432 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

433 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

434 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2))

435 
	`__©å_ac˚ss
 ((
__wrôe_⁄ly__
, 2, 3));

437 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

438 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
	`__©å_ac˚ss
 ((
__wrôe_⁄ly__
, 2, 3));

439 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

444 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

445 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
 
	`__©å_ac˚ss
 ((
__wrôe_⁄ly__
, 2, 3));

448 #ifde‡
__USE_GNU


450 c⁄° *
	$°ªº‹desc_≈
 (
__îr
Ë
__THROW
;

452 c⁄° *
	$°ªº‹«me_≈
 (
__îr
Ë
__THROW
;

456 #ifde‡
__USE_XOPEN2K8


458 *
	$°ªº‹_l
 (
__î∫um
, 
loˇÀ_t
 
__l
Ë
__THROW
;

461 #ifde‡
__USE_MISC


462 
	~<°rögs.h
>

466 
	$ex∂icô_bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1))

467 
	`__f‹tifõd_©å_ac˚ss
 (
__wrôe_⁄ly__
, 1, 2);

471 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

472 c⁄° *
__ª°ri˘
 
__dñim
)

473 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

476 #ifdef 
__USE_XOPEN2K8


478 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

480 #ifde‡
__USE_GNU


482 c⁄° *
	$sigabbªv_≈
 (
__sig
Ë
__THROW
;

485 c⁄° *
	$sigdes¸_≈
 (
__sig
Ë
__THROW
;

489 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

490 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

491 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

492 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

496 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

497 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

498 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

499 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

500 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

501 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

504 #ifdef 
__USE_GNU


506 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

507 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

510 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

513 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1))

514 
	`__©å_ac˚ss
 ((
__ªad_wrôe__
, 1, 2));

516 #i‚de‡
ba£«me


521 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


522 "C++" *
	$ba£«me
 (*
__fûíame
)

523 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

524 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

525 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

527 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

532 #i‡
	`__GNUC_PREREQ
 (3,4)

533 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


535 
	~<bôs/°rög_f‹tifõd.h
>

539 
__END_DECLS


	@/usr/include/linux/hdlc/ioctl.h

2 #i‚de‡
__HDLC_IOCTL_H__


3 
	#__HDLC_IOCTL_H__


	)

6 
	#GENERIC_HDLC_VERSION
 4

	)

8 
	#CLOCK_DEFAULT
 0

	)

9 
	#CLOCK_EXT
 1

	)

10 
	#CLOCK_INT
 2

	)

11 
	#CLOCK_TXINT
 3

	)

12 
	#CLOCK_TXFROMRX
 4

	)

15 
	#ENCODING_DEFAULT
 0

	)

16 
	#ENCODING_NRZ
 1

	)

17 
	#ENCODING_NRZI
 2

	)

18 
	#ENCODING_FM_MARK
 3

	)

19 
	#ENCODING_FM_SPACE
 4

	)

20 
	#ENCODING_MANCHESTER
 5

	)

23 
	#PARITY_DEFAULT
 0

	)

24 
	#PARITY_NONE
 1

	)

25 
	#PARITY_CRC16_PR0
 2

	)

26 
	#PARITY_CRC16_PR1
 3

	)

27 
	#PARITY_CRC16_PR0_CCITT
 4

	)

28 
	#PARITY_CRC16_PR1_CCITT
 5

	)

29 
	#PARITY_CRC32_PR0_CCITT
 6

	)

30 
	#PARITY_CRC32_PR1_CCITT
 7

	)

32 
	#LMI_DEFAULT
 0

	)

33 
	#LMI_NONE
 1

	)

34 
	#LMI_ANSI
 2

	)

35 
	#LMI_CCITT
 3

	)

36 
	#LMI_CISCO
 4

	)

38 #i‚de‡
__ASSEMBLY__


41 
	m˛ock_øã
;

42 
	m˛ock_ty≥
;

43 
	mlo›back
;

44 } 
	tsync_£rül_£âögs
;

47 
	m˛ock_øã
;

48 
	m˛ock_ty≥
;

49 
	mlo›back
;

50 
	m¶Ÿ_m≠
;

51 } 
	tã1_£âögs
;

54 
	mícodög
;

55 
	m∑rôy
;

56 } 
	tøw_hdlc_¥Ÿo
;

59 
	mt391
;

60 
	mt392
;

61 
	mn391
;

62 
	mn392
;

63 
	mn393
;

64 
	mlmi
;

65 
	md˚
;

66 } 
	t‰_¥Ÿo
;

69 
	mdlci
;

70 } 
	t‰_¥Ÿo_pvc
;

73 
	mdlci
;

74 
	mma°î
[
IFNAMSIZ
];

75 }
	t‰_¥Ÿo_pvc_öfo
;

78 
	möãrvÆ
;

79 
	mtimeout
;

80 } 
	tcisco_¥Ÿo
;

83 
	md˚
;

84 
	mmodulo
;

85 
	mwödow
;

86 
	mt1
;

87 
	mt2
;

88 
	mn2
;

89 } 
	tx25_hdlc_¥Ÿo
;

	@/usr/include/strings.h

18 #i‚def 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

21 
	~<„©uªs.h
>

22 
	#__√ed_size_t


	)

23 
	~<°ddef.h
>

26 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

27 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

30 
	g__BEGIN_DECLS


32 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


34 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

35 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

38 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

39 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

42 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

45 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


48 *
	`ödex
 (*
__s
, 
__c
)

49 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

50 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

51 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

53 #i‡
deföed
 
__OPTIMIZE__


54 
__exã∫_Æways_ölöe
 *

55 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


57  
	`__buûtö_ödex
 (
__s
, 
__c
);

60 
__exã∫_Æways_ölöe
 const *

61 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


63  
	`__buûtö_ödex
 (
__s
, 
__c
);

66 
	}
}

68 *
	$ödex
 (c⁄° *
__s
, 
__c
)

69 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

73 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


76 *
	`rödex
 (*
__s
, 
__c
)

77 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

78 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

79 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

81 #i‡
deföed
 
__OPTIMIZE__


82 
__exã∫_Æways_ölöe
 *

83 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


85  
	`__buûtö_rödex
 (
__s
, 
__c
);

88 
__exã∫_Æways_ölöe
 const *

89 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


91  
	`__buûtö_rödex
 (
__s
, 
__c
);

94 
	}
}

96 *
	$rödex
 (c⁄° *
__s
, 
__c
)

97 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

101 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8
 || deföed 
__USE_XOPEN2K8XSI


104 
	$ffs
 (
__i
Ë
__THROW
 
__©åibuã_c⁄°__
;

109 #ifdef 
__USE_MISC


110 
	$ff¶
 (
__l
Ë
__THROW
 
__©åibuã_c⁄°__
;

111 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

112 
__THROW
 
__©åibuã_c⁄°__
;

116 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

117 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

120 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

123 #ifdef 
__USE_XOPEN2K8


125 
	~<bôs/ty≥s/loˇÀ_t.h
>

128 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
loˇÀ_t
 
__loc
)

129 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

133 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

134 
size_t
 
__n
, 
loˇÀ_t
 
__loc
)

135 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

138 
__END_DECLS


140 #i‡
	`__GNUC_PREREQ
 (3,4Ë&& 
__USE_FORTIFY_LEVEL
 > 0 \

141 && 
deföed
 
__f‹tify_fun˘i⁄


143 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


144 
	~<bôs/°rögs_f‹tifõd.h
>

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

126 #unde‡
__USE_ISOC11


127 #unde‡
__USE_ISOC99


128 #unde‡
__USE_ISOC95


129 #unde‡
__USE_ISOCXX11


130 #unde‡
__USE_POSIX


131 #unde‡
__USE_POSIX2


132 #unde‡
__USE_POSIX199309


133 #unde‡
__USE_POSIX199506


134 #unde‡
__USE_XOPEN


135 #unde‡
__USE_XOPEN_EXTENDED


136 #unde‡
__USE_UNIX98


137 #unde‡
__USE_XOPEN2K


138 #unde‡
__USE_XOPEN2KXSI


139 #unde‡
__USE_XOPEN2K8


140 #unde‡
__USE_XOPEN2K8XSI


141 #unde‡
__USE_LARGEFILE


142 #unde‡
__USE_LARGEFILE64


143 #unde‡
__USE_FILE_OFFSET64


144 #unde‡
__USE_MISC


145 #unde‡
__USE_ATFILE


146 #unde‡
__USE_DYNAMIC_STACK_SIZE


147 #unde‡
__USE_GNU


148 #unde‡
__USE_FORTIFY_LEVEL


149 #unde‡
__KERNEL_STRICT_NAMES


150 #unde‡
__GLIBC_USE_ISOC2X


151 #unde‡
__GLIBC_USE_DEPRECATED_GETS


152 #unde‡
__GLIBC_USE_DEPRECATED_SCANF


156 #i‚de‡
_LOOSE_KERNEL_NAMES


157 
	#__KERNEL_STRICT_NAMES


	)

167 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


168 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

169 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

171 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

178 #i‡
deföed
 
__˛™g_maj‹__
 && deföed 
__˛™g_mö‹__


179 
	#__glibc_˛™g_¥îeq
(
maj
, 
mö
) \

180 ((
__˛™g_maj‹__
 << 16Ë+ 
__˛™g_mö‹__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

182 
	#__glibc_˛™g_¥îeq
(
maj
, 
mö
Ë0

	)

186 
	#__GLIBC_USE
(
F
Ë
__GLIBC_USE_
 ## 
	)
F

192 #i‡(
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE
) \

193 && !
deföed
 
	g_DEFAULT_SOURCE


195 #unde‡
_DEFAULT_SOURCE


196 
	#_DEFAULT_SOURCE
 1

	)

200 #ifde‡
_GNU_SOURCE


201 #unde‡
_ISOC95_SOURCE


202 
	#_ISOC95_SOURCE
 1

	)

203 #unde‡
_ISOC99_SOURCE


204 
	#_ISOC99_SOURCE
 1

	)

205 #unde‡
_ISOC11_SOURCE


206 
	#_ISOC11_SOURCE
 1

	)

207 #unde‡
_ISOC2X_SOURCE


208 
	#_ISOC2X_SOURCE
 1

	)

209 #unde‡
_POSIX_SOURCE


210 
	#_POSIX_SOURCE
 1

	)

211 #unde‡
_POSIX_C_SOURCE


212 
	#_POSIX_C_SOURCE
 200809L

	)

213 #unde‡
_XOPEN_SOURCE


214 
	#_XOPEN_SOURCE
 700

	)

215 #unde‡
_XOPEN_SOURCE_EXTENDED


216 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

217 #unde‡
_LARGEFILE64_SOURCE


218 
	#_LARGEFILE64_SOURCE
 1

	)

219 #unde‡
_DEFAULT_SOURCE


220 
	#_DEFAULT_SOURCE
 1

	)

221 #unde‡
_ATFILE_SOURCE


222 
	#_ATFILE_SOURCE
 1

	)

223 #unde‡
_DYNAMIC_STACK_SIZE_SOURCE


224 
	#_DYNAMIC_STACK_SIZE_SOURCE
 1

	)

229 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

230 || (!
deföed
 
	g__STRICT_ANSI__
 \

231 && !
deföed
 
	g_ISOC99_SOURCE
 && !deföed 
	g_ISOC11_SOURCE
 \

232 && !
deföed
 
	g_ISOC2X_SOURCE
 \

233 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

234 && !
deföed
 
	g_XOPEN_SOURCE
))

235 #unde‡
_DEFAULT_SOURCE


236 
	#_DEFAULT_SOURCE
 1

	)

240 #i‡(
deföed
 
_ISOC2X_SOURCE
 \

241 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ > 201710L))

242 
	#__GLIBC_USE_ISOC2X
 1

	)

244 
	#__GLIBC_USE_ISOC2X
 0

	)

248 #i‡(
deföed
 
_ISOC11_SOURCE
 || deföed 
_ISOC2X_SOURCE
 \

249 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

250 
	#__USE_ISOC11
 1

	)

254 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

255 || 
deföed
 
_ISOC2X_SOURCE
 \

256 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

257 
	#__USE_ISOC99
 1

	)

261 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

262 || 
deföed
 
_ISOC2X_SOURCE
 \

263 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

264 
	#__USE_ISOC95
 1

	)

267 #ifde‡
__˝lu•lus


269 #i‡
__˝lu•lus
 >= 201703L

270 
	#__USE_ISOC11
 1

	)

274 #i‡
__˝lu•lus
 >201103L || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__


275 
	#__USE_ISOCXX11
 1

	)

276 
	#__USE_ISOC99
 1

	)

283 #ifde‡
_DEFAULT_SOURCE


284 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


285 
	#__USE_POSIX_IMPLICITLY
 1

	)

287 #unde‡
_POSIX_SOURCE


288 
	#_POSIX_SOURCE
 1

	)

289 #unde‡
_POSIX_C_SOURCE


290 
	#_POSIX_C_SOURCE
 200809L

	)

293 #i‡((!
deföed
 
__STRICT_ANSI__
 \

294 || (
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

295 && !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

296 
	#_POSIX_SOURCE
 1

	)

297 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

298 
	#_POSIX_C_SOURCE
 2

	)

299 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

300 
	#_POSIX_C_SOURCE
 199506L

	)

301 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

302 
	#_POSIX_C_SOURCE
 200112L

	)

304 
	#_POSIX_C_SOURCE
 200809L

	)

306 
	#__USE_POSIX_IMPLICITLY
 1

	)

315 #i‡((!
deföed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

316 && (
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE
))

317 
	#_POSIX_SOURCE
 1

	)

318 #unde‡
_POSIX_C_SOURCE


319 
	#_POSIX_C_SOURCE
 199506L

	)

322 #i‡(
deföed
 
_POSIX_SOURCE
 \

323 || (
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

324 || 
deföed
 
_XOPEN_SOURCE
)

325 
	#__USE_POSIX
 1

	)

328 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


329 
	#__USE_POSIX2
 1

	)

332 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

333 
	#__USE_POSIX199309
 1

	)

336 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

337 
	#__USE_POSIX199506
 1

	)

340 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

341 
	#__USE_XOPEN2K
 1

	)

342 #unde‡
__USE_ISOC95


343 
	#__USE_ISOC95
 1

	)

344 #unde‡
__USE_ISOC99


345 
	#__USE_ISOC99
 1

	)

348 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

349 
	#__USE_XOPEN2K8
 1

	)

350 #unde‡
_ATFILE_SOURCE


351 
	#_ATFILE_SOURCE
 1

	)

354 #ifdef 
_XOPEN_SOURCE


355 
	#__USE_XOPEN
 1

	)

356 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

357 
	#__USE_XOPEN_EXTENDED
 1

	)

358 
	#__USE_UNIX98
 1

	)

359 #unde‡
_LARGEFILE_SOURCE


360 
	#_LARGEFILE_SOURCE
 1

	)

361 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

362 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

363 
	#__USE_XOPEN2K8
 1

	)

364 
	#__USE_XOPEN2K8XSI
 1

	)

366 
	#__USE_XOPEN2K
 1

	)

367 
	#__USE_XOPEN2KXSI
 1

	)

368 #unde‡
__USE_ISOC95


369 
	#__USE_ISOC95
 1

	)

370 #unde‡
__USE_ISOC99


371 
	#__USE_ISOC99
 1

	)

374 #ifde‡
_XOPEN_SOURCE_EXTENDED


375 
	#__USE_XOPEN_EXTENDED
 1

	)

380 #ifde‡
_LARGEFILE_SOURCE


381 
	#__USE_LARGEFILE
 1

	)

384 #ifde‡
_LARGEFILE64_SOURCE


385 
	#__USE_LARGEFILE64
 1

	)

388 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

389 
	#__USE_FILE_OFFSET64
 1

	)

392 
	~<„©uªs-time64.h
>

394 #i‡
deföed
 
_DEFAULT_SOURCE


395 
	#__USE_MISC
 1

	)

398 #ifdef 
_ATFILE_SOURCE


399 
	#__USE_ATFILE
 1

	)

402 #ifdef 
_DYNAMIC_STACK_SIZE_SOURCE


403 
	#__USE_DYNAMIC_STACK_SIZE
 1

	)

406 #ifdef 
_GNU_SOURCE


407 
	#__USE_GNU
 1

	)

410 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0

411 #i‡!
deföed
 
__OPTIMIZE__
 || __OPTIMIZE__ <= 0

412 #ñi‡!
__GNUC_PREREQ
 (4, 1)

413 #ñi‡
_FORTIFY_SOURCE
 > 2 && (
__glibc_˛™g_¥îeq
 (9, 0) \

414 || 
	$__GNUC_PREREQ
 (12, 0))

416 #i‡
_FORTIFY_SOURCE
 > 3

418 
	#__USE_FORTIFY_LEVEL
 3

	)

419 #ñi‡
_FORTIFY_SOURCE
 > 1

420 #i‡
_FORTIFY_SOURCE
 > 2

422 
	#__USE_FORTIFY_LEVEL
 2

	)

424 
	#__USE_FORTIFY_LEVEL
 1

	)

427 #i‚de‡
__USE_FORTIFY_LEVEL


428 
	#__USE_FORTIFY_LEVEL
 0

	)

435 #i‡
deföed
 
__˝lu•lus
 ? __˝lu•lu†>201402L : deföed 
__USE_ISOC11


436 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

438 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

453 #i‡(
deföed
 
__USE_GNU
 \

454 && (
deföed
 
__˝lu•lus
 \

455 ? (
__˝lu•lus
 < 201103L && !
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
) \

456 : (!
deföed
 
__STDC_VERSION__
 || __STDC_VERSION__ < 199901L)))

457 
	#__GLIBC_USE_DEPRECATED_SCANF
 1

	)

459 
	#__GLIBC_USE_DEPRECATED_SCANF
 0

	)

464 
	~<°dc-¥edef.h
>

472 #unde‡
__GNU_LIBRARY__


473 
	#__GNU_LIBRARY__
 6

	)

477 
	#__GLIBC__
 2

	)

478 
	#__GLIBC_MINOR__
 35

	)

480 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

481 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

484 #i‚de‡
__ASSEMBLER__


485 #i‚de‡
_SYS_CDEFS_H


486 
	~<sys/cdefs.h
>

491 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


492 
	#__USE_LARGEFILE
 1

	)

493 
	#__USE_LARGEFILE64
 1

	)

499 #i‡
	`__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

500 && !
deföed
 
__OPTIMIZE_SIZE__
 && !deföed 
__NO_INLINE__
 \

501 && 
deföed
 
__exã∫_ölöe


502 
	#__USE_EXTERN_INLINES
 1

	)

510 
	~<gnu/°ubs.h
>

	@/usr/include/features-time64.h

20 
	~<bôs/w‹dsize.h
>

21 
	~<bôs/timesize.h
>

23 #i‡
deföed
 
_TIME_BITS


24 #i‡
_TIME_BITS
 == 64

25 #i‡! 
deföed
 (
_FILE_OFFSET_BITS
) || _FILE_OFFSET_BITS != 64

27 #ñi‡
__TIMESIZE
 == 32

28 
	#__USE_TIME_BITS64
 1

	)

30 #ñi‡
_TIME_BITS
 == 32

31 #i‡
__TIMESIZE
 > 32

35 #îr‹ 
InvÆid
 
_TIME_BITS
 
vÆue
 (
ˇn
 
⁄ly
 
be
 32 
‹
 64-
bô
)

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

39 
	#__STDC_IEC_60559_BFP__
 201404L

	)

42 
	#__STDC_IEC_559__
 1

	)

43 
	#__STDC_IEC_60559_BFP__
 201404L

	)

46 #ifde‡
__GCC_IEC_559_COMPLEX


47 #i‡
__GCC_IEC_559_COMPLEX
 > 0

48 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_60559_COMPLEX__
 201404L

	)

52 
	#__STDC_IEC_559_COMPLEX__
 1

	)

53 
	#__STDC_IEC_60559_COMPLEX__
 201404L

	)

62 
	#__STDC_ISO_10646__
 201706L

	)

	@
1
.
1
/usr/include
245
3918
cfg/1000.c
cfg/2000.c
cfg/22000.c
cfg/5000.c
cfg/6000.c
cfg/7000.c
cfg/8000.c
cfg/9000.c
cfg/ax210.c
cfg/bz.c
cfg/sc.c
dvm/agn.h
dvm/calib.c
dvm/calib.h
dvm/commands.h
dvm/debugfs.c
dvm/dev.h
dvm/devices.c
dvm/iwldvm.mod.c
dvm/led.c
dvm/led.h
dvm/lib.c
dvm/mac80211.c
dvm/main.c
dvm/power.c
dvm/power.h
dvm/rs.c
dvm/rs.h
dvm/rx.c
dvm/rxon.c
dvm/scan.c
dvm/sta.c
dvm/tt.c
dvm/tt.h
dvm/tx.c
dvm/ucode.c
fw/acpi.c
fw/acpi.h
fw/api/alive.h
fw/api/binding.h
fw/api/cmdhdr.h
fw/api/coex.h
fw/api/commands.h
fw/api/config.h
fw/api/context.h
fw/api/d3.h
fw/api/datapath.h
fw/api/dbg-tlv.h
fw/api/debug.h
fw/api/filter.h
fw/api/led.h
fw/api/location.h
fw/api/mac-cfg.h
fw/api/mac.h
fw/api/nvm-reg.h
fw/api/offload.h
fw/api/paging.h
fw/api/phy-ctxt.h
fw/api/phy.h
fw/api/power.h
fw/api/rfi.h
fw/api/rs.h
fw/api/rx.h
fw/api/scan.h
fw/api/sf.h
fw/api/sta.h
fw/api/stats.h
fw/api/system.h
fw/api/tdls.h
fw/api/time-event.h
fw/api/tx.h
fw/api/txq.h
fw/dbg.c
fw/dbg.h
fw/debugfs.c
fw/debugfs.h
fw/dump.c
fw/error-dump.h
fw/file.h
fw/img.c
fw/img.h
fw/init.c
fw/notif-wait.c
fw/notif-wait.h
fw/paging.c
fw/pnvm.c
fw/pnvm.h
fw/regulatory.c
fw/regulatory.h
fw/rs.c
fw/runtime.h
fw/smem.c
fw/uefi.c
fw/uefi.h
iwl-agn-hw.h
iwl-config.h
iwl-context-info-gen3.h
iwl-context-info.h
iwl-csr.h
iwl-dbg-tlv.c
iwl-dbg-tlv.h
iwl-debug.c
iwl-debug.h
iwl-devtrace-data.h
iwl-devtrace-io.h
iwl-devtrace-iwlwifi.h
iwl-devtrace-msg.h
iwl-devtrace-ucode.h
iwl-devtrace.c
iwl-devtrace.h
iwl-drv.c
iwl-drv.h
iwl-eeprom-parse.c
iwl-eeprom-parse.h
iwl-eeprom-read.c
iwl-eeprom-read.h
iwl-fh.h
iwl-io.c
iwl-io.h
iwl-modparams.h
iwl-nvm-parse.c
iwl-nvm-parse.h
iwl-op-mode.h
iwl-phy-db.c
iwl-phy-db.h
iwl-prph.h
iwl-scd.h
iwl-trans.c
iwl-trans.h
iwlwifi.mod.c
mei/internal.h
mei/iwl-mei.h
mei/main.c
mei/net.c
mei/sap.h
mei/trace-data.h
mei/trace.c
mei/trace.h
mvm/binding.c
mvm/coex.c
mvm/constants.h
mvm/d3.c
mvm/debugfs-vif.c
mvm/debugfs.c
mvm/debugfs.h
mvm/ftm-initiator.c
mvm/ftm-responder.c
mvm/fw-api.h
mvm/fw.c
mvm/iwlmvm.mod.c
mvm/led.c
mvm/link.c
mvm/mac-ctxt.c
mvm/mac80211.c
mvm/mld-key.c
mvm/mld-mac.c
mvm/mld-mac80211.c
mvm/mld-sta.c
mvm/mvm.h
mvm/nvm.c
mvm/offloading.c
mvm/ops.c
mvm/phy-ctxt.c
mvm/power.c
mvm/ptp.c
mvm/quota.c
mvm/rfi.c
mvm/rs-fw.c
mvm/rs.c
mvm/rs.h
mvm/rx.c
mvm/rxmq.c
mvm/scan.c
mvm/sf.c
mvm/sta.c
mvm/sta.h
mvm/tdls.c
mvm/testmode.h
mvm/time-event.c
mvm/time-event.h
mvm/time-sync.c
mvm/time-sync.h
mvm/tt.c
mvm/tx.c
mvm/utils.c
mvm/vendor-cmd.c
pcie/ctxt-info-gen3.c
pcie/ctxt-info.c
pcie/drv.c
pcie/internal.h
pcie/rx.c
pcie/trans-gen2.c
pcie/trans.c
pcie/tx-gen2.c
pcie/tx.c
queue/tx.c
queue/tx.h
tests/devinfo.c
tests/module.c
/usr/include/linux/fs.h
/usr/include/linux/icmp.h
/usr/include/linux/if_arp.h
/usr/include/linux/if_ether.h
/usr/include/linux/in6.h
/usr/include/linux/ip.h
/usr/include/linux/kernel.h
/usr/include/linux/module.h
/usr/include/linux/netdevice.h
/usr/include/linux/nl80211-vnd-intel.h
/usr/include/linux/nl80211.h
/usr/include/linux/pci.h
/usr/include/linux/rtnetlink.h
/usr/include/linux/sched.h
/usr/include/linux/string.h
/usr/include/linux/tcp.h
/usr/include/linux/thermal.h
/usr/include/linux/time.h
/usr/include/linux/types.h
/usr/include/linux/udp.h
/usr/include/linux/uuid.h
/usr/include/linux/wait.h
/usr/include/linux/const.h
/usr/include/linux/fscrypt.h
/usr/include/linux/if.h
/usr/include/linux/if_addr.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/ioctl.h
/usr/include/linux/libc-compat.h
/usr/include/linux/limits.h
/usr/include/linux/mount.h
/usr/include/linux/neighbour.h
/usr/include/linux/netlink.h
/usr/include/linux/pci_regs.h
/usr/include/linux/posix_types.h
/usr/include/linux/socket.h
/usr/include/linux/stddef.h
/usr/include/linux/sysinfo.h
/usr/include/linux/time_types.h
/usr/include/string.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/strings.h
/usr/include/features.h
/usr/include/features-time64.h
/usr/include/stdc-predef.h
