cscope 15 /home/bharathi/Desktop/kernel_692/net/mac80211               0002281585
	@aead_api.c

10 
	~<lšux/k”Ãl.h
>

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/”r.h
>

13 
	~<lšux/sÿ‰”li¡.h
>

14 
	~<üy±o/«ad.h
>

16 
	~"«ad_­i.h
"

18 
	$«ad_’üy±
(
üy±o_«ad
 *
tfm
, 
u8
 *
b_0
, u8 *
¯d
, 
size_t
 
¯d_Ën
,

19 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
)

21 
size_t
 
mic_Ën
 = 
	`üy±o_«ad_authsize
(
tfm
);

22 
sÿ‰”li¡
 
sg
[3];

23 
«ad_»que¡
 *
«ad_»q
;

24 
»qsize
 = (*
«ad_»q
è+ 
	`üy±o_«ad_»qsize
(
tfm
);

25 
u8
 *
__¯d
;

26 
»t
;

28 
«ad_»q
 = 
	`kz®loc
(
»qsize
 + 
¯d_Ën
, 
GFP_ATOMIC
);

29 ià(!
«ad_»q
)

30  -
ENOMEM
;

32 
__¯d
 = (
u8
 *)
«ad_»q
 + 
»qsize
;

33 
	`memıy
(
__¯d
, 
¯d
, 
¯d_Ën
);

35 
	`sg_š™_bË
(
sg
, 3);

36 
	`sg_£t_buf
(&
sg
[0], 
__¯d
, 
¯d_Ën
);

37 
	`sg_£t_buf
(&
sg
[1], 
d©a
, 
d©a_Ën
);

38 
	`sg_£t_buf
(&
sg
[2], 
mic
, 
mic_Ën
);

40 
	`«ad_»que¡_£t_tfm
(
«ad_»q
, 
tfm
);

41 
	`«ad_»que¡_£t_üy±
(
«ad_»q
, 
sg
, sg, 
d©a_Ën
, 
b_0
);

42 
	`«ad_»que¡_£t_ad
(
«ad_»q
, 
sg
[0].
Ëngth
);

44 
»t
 = 
	`üy±o_«ad_’üy±
(
«ad_»q
);

45 
	`kä“_£ns™ive
(
«ad_»q
);

47  
»t
;

48 
	}
}

50 
	$«ad_deüy±
(
üy±o_«ad
 *
tfm
, 
u8
 *
b_0
, u8 *
¯d
, 
size_t
 
¯d_Ën
,

51 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
)

53 
size_t
 
mic_Ën
 = 
	`üy±o_«ad_authsize
(
tfm
);

54 
sÿ‰”li¡
 
sg
[3];

55 
«ad_»que¡
 *
«ad_»q
;

56 
»qsize
 = (*
«ad_»q
è+ 
	`üy±o_«ad_»qsize
(
tfm
);

57 
u8
 *
__¯d
;

58 
”r
;

60 ià(
d©a_Ën
 == 0)

61  -
EINVAL
;

63 
«ad_»q
 = 
	`kz®loc
(
»qsize
 + 
¯d_Ën
, 
GFP_ATOMIC
);

64 ià(!
«ad_»q
)

65  -
ENOMEM
;

67 
__¯d
 = (
u8
 *)
«ad_»q
 + 
»qsize
;

68 
	`memıy
(
__¯d
, 
¯d
, 
¯d_Ën
);

70 
	`sg_š™_bË
(
sg
, 3);

71 
	`sg_£t_buf
(&
sg
[0], 
__¯d
, 
¯d_Ën
);

72 
	`sg_£t_buf
(&
sg
[1], 
d©a
, 
d©a_Ën
);

73 
	`sg_£t_buf
(&
sg
[2], 
mic
, 
mic_Ën
);

75 
	`«ad_»que¡_£t_tfm
(
«ad_»q
, 
tfm
);

76 
	`«ad_»que¡_£t_üy±
(
«ad_»q
, 
sg
, sg, 
d©a_Ën
 + 
mic_Ën
, 
b_0
);

77 
	`«ad_»que¡_£t_ad
(
«ad_»q
, 
sg
[0].
Ëngth
);

79 
”r
 = 
	`üy±o_«ad_deüy±
(
«ad_»q
);

80 
	`kä“_£ns™ive
(
«ad_»q
);

82  
”r
;

83 
	}
}

85 
üy±o_«ad
 *

86 
	$«ad_key_£tup_’üy±
(cÚ¡ *
®g
, cÚ¡ 
u8
 
key
[],

87 
size_t
 
key_Ën
, size_ˆ
mic_Ën
)

89 
üy±o_«ad
 *
tfm
;

90 
”r
;

92 
tfm
 = 
	`üy±o_®loc_«ad
(
®g
, 0, 
CRYPTO_ALG_ASYNC
);

93 ià(
	`IS_ERR
(
tfm
))

94  
tfm
;

96 
”r
 = 
	`üy±o_«ad_£tkey
(
tfm
, 
key
, 
key_Ën
);

97 ià(
”r
)

98 
ä“_«ad
;

99 
”r
 = 
	`üy±o_«ad_£uthsize
(
tfm
, 
mic_Ën
);

100 ià(
”r
)

101 
ä“_«ad
;

103  
tfm
;

105 
ä“_«ad
:

106 
	`üy±o_ä“_«ad
(
tfm
);

107  
	`ERR_PTR
(
”r
);

108 
	}
}

110 
	$«ad_key_ä“
(
üy±o_«ad
 *
tfm
)

112 
	`üy±o_ä“_«ad
(
tfm
);

113 
	}
}

	@aead_api.h

3 #iâdeà
_AEAD_API_H


4 
	#_AEAD_API_H


	)

6 
	~<üy±o/«ad.h
>

7 
	~<lšux/üy±o.h
>

9 
üy±o_«ad
 *

10 
«ad_key_£tup_’üy±
(cÚ¡ *
®g
, cÚ¡ 
u8
 
key
[],

11 
size_t
 
key_Ën
, size_ˆ
mic_Ën
);

13 
«ad_’üy±
(
üy±o_«ad
 *
tfm
, 
u8
 *
b_0
, u8 *
¯d
,

14 
size_t
 
¯d_Ën
, 
u8
 *
d©a
,

15 
size_t
 
d©a_Ën
, 
u8
 *
mic
);

17 
«ad_deüy±
(
üy±o_«ad
 *
tfm
, 
u8
 *
b_0
, u8 *
¯d
,

18 
size_t
 
¯d_Ën
, 
u8
 *
d©a
,

19 
size_t
 
d©a_Ën
, 
u8
 *
mic
);

21 
«ad_key_ä“
(
üy±o_«ad
 *
tfm
);

	@aes_ccm.h

7 #iâdeà
AES_CCM_H


8 
	#AES_CCM_H


	)

10 
	~"«ad_­i.h
"

12 
	#CCM_AAD_LEN
 32

	)

14 
šlše
 
üy±o_«ad
 *

15 
	$›“80211_«s_key_£tup_’üy±
(cÚ¡ 
u8
 
key
[], 
size_t
 
key_Ën
, size_ˆ
mic_Ën
)

17  
	`«ad_key_£tup_’üy±
("ccm×es)", 
key
, 
key_Ën
, 
mic_Ën
);

18 
	}
}

20 
šlše
 

21 
	$›“80211_«s_ccm_’üy±
(
üy±o_«ad
 *
tfm
,

22 
u8
 *
b_0
, u8 *
¯d
, u8 *
d©a
,

23 
size_t
 
d©a_Ën
, 
u8
 *
mic
)

25  
	`«ad_’üy±
(
tfm
, 
b_0
, 
¯d
 + 2,

26 
	`be16_to_ıup
((
__be16
 *)
¯d
),

27 
d©a
, 
d©a_Ën
, 
mic
);

28 
	}
}

30 
šlše
 

31 
	$›“80211_«s_ccm_deüy±
(
üy±o_«ad
 *
tfm
,

32 
u8
 *
b_0
, u8 *
¯d
, u8 *
d©a
,

33 
size_t
 
d©a_Ën
, 
u8
 *
mic
)

35  
	`«ad_deüy±
(
tfm
, 
b_0
, 
¯d
 + 2,

36 
	`be16_to_ıup
((
__be16
 *)
¯d
),

37 
d©a
, 
d©a_Ën
, 
mic
);

38 
	}
}

40 
šlše
 
	$›“80211_«s_key_ä“
(
üy±o_«ad
 *
tfm
)

42  
	`«ad_key_ä“
(
tfm
);

43 
	}
}

	@aes_cmac.c

8 
	~<lšux/k”Ãl.h
>

9 
	~<lšux/ty³s.h
>

10 
	~<lšux/üy±o.h
>

11 
	~<lšux/expÜt.h
>

12 
	~<lšux/”r.h
>

13 
	~<üy±o/«s.h
>

15 
	~<Ãt/mac80211.h
>

16 
	~"key.h
"

17 
	~"«s_cmac.h
"

19 
	#CMAC_TLEN
 8

	)

20 
	#CMAC_TLEN_256
 16

	)

21 
	#AAD_LEN
 20

	)

23 cÚ¡ 
u8
 
	gz”o
[
CMAC_TLEN_256
];

25 
	$›“80211_«s_cmac
(
üy±o_shash
 *
tfm
, cÚ¡ 
u8
 *
¯d
,

26 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
)

28 
	`SHASH_DESC_ON_STACK
(
desc
, 
tfm
);

29 
u8
 
out
[
AES_BLOCK_SIZE
];

30 cÚ¡ 
__Ë16
 *
fc
;

32 
desc
->
tfm
 =fm;

34 
	`üy±o_shash_š™
(
desc
);

35 
	`üy±o_shash_upd©e
(
desc
, 
¯d
, 
AAD_LEN
);

36 
fc
 = (cÚ¡ 
__Ë16
 *)
¯d
;

37 ià(
	`›“80211_is_b—cÚ
(*
fc
)) {

39 
	`üy±o_shash_upd©e
(
desc
, 
z”o
, 8);

40 
	`üy±o_shash_upd©e
(
desc
, 
d©a
 + 8, 
d©a_Ën
 - 8 - 
CMAC_TLEN
);

42 
	`üy±o_shash_upd©e
(
desc
, 
d©a
, 
d©a_Ën
 - 
CMAC_TLEN
);

44 
	`üy±o_shash_fšup
(
desc
, 
z”o
, 
CMAC_TLEN
, 
out
);

46 
	`memıy
(
mic
, 
out
, 
CMAC_TLEN
);

47 
	}
}

49 
	$›“80211_«s_cmac_256
(
üy±o_shash
 *
tfm
, cÚ¡ 
u8
 *
¯d
,

50 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
)

52 
	`SHASH_DESC_ON_STACK
(
desc
, 
tfm
);

53 cÚ¡ 
__Ë16
 *
fc
;

55 
desc
->
tfm
 =fm;

57 
	`üy±o_shash_š™
(
desc
);

58 
	`üy±o_shash_upd©e
(
desc
, 
¯d
, 
AAD_LEN
);

59 
fc
 = (cÚ¡ 
__Ë16
 *)
¯d
;

60 ià(
	`›“80211_is_b—cÚ
(*
fc
)) {

62 
	`üy±o_shash_upd©e
(
desc
, 
z”o
, 8);

63 
	`üy±o_shash_upd©e
(
desc
, 
d©a
 + 8,

64 
d©a_Ën
 - 8 - 
CMAC_TLEN_256
);

66 
	`üy±o_shash_upd©e
(
desc
, 
d©a
, 
d©a_Ën
 - 
CMAC_TLEN_256
);

68 
	`üy±o_shash_fšup
(
desc
, 
z”o
, 
CMAC_TLEN_256
, 
mic
);

69 
	}
}

71 
üy±o_shash
 *
	$›“80211_«s_cmac_key_£tup
(cÚ¡ 
u8
 
key
[],

72 
size_t
 
key_Ën
)

74 
üy±o_shash
 *
tfm
;

76 
tfm
 = 
	`üy±o_®loc_shash
("cmac(aes)", 0, 0);

77 ià(!
	`IS_ERR
(
tfm
)) {

78 
”r
 = 
	`üy±o_shash_£tkey
(
tfm
, 
key
, 
key_Ën
);

80 ià(
”r
) {

81 
	`üy±o_ä“_shash
(
tfm
);

82  
	`ERR_PTR
(
”r
);

86  
tfm
;

87 
	}
}

89 
	$›“80211_«s_cmac_key_ä“
(
üy±o_shash
 *
tfm
)

91 
	`üy±o_ä“_shash
(
tfm
);

92 
	}
}

	@aes_cmac.h

6 #iâdeà
AES_CMAC_H


7 
	#AES_CMAC_H


	)

9 
	~<lšux/üy±o.h
>

10 
	~<üy±o/hash.h
>

12 
üy±o_shash
 *
›“80211_«s_cmac_key_£tup
(cÚ¡ 
u8
 
key
[],

13 
size_t
 
key_Ën
);

14 
›“80211_«s_cmac
(
üy±o_shash
 *
tfm
, cÚ¡ 
u8
 *
¯d
,

15 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
);

16 
›“80211_«s_cmac_256
(
üy±o_shash
 *
tfm
, cÚ¡ 
u8
 *
¯d
,

17 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
);

18 
›“80211_«s_cmac_key_ä“
(
üy±o_shash
 *
tfm
);

	@aes_gcm.h

6 #iâdeà
AES_GCM_H


7 
	#AES_GCM_H


	)

9 
	~"«ad_­i.h
"

11 
	#GCM_AAD_LEN
 32

	)

13 
šlše
 
	$›“80211_«s_gcm_’üy±
(
üy±o_«ad
 *
tfm
,

14 
u8
 *
j_0
, u8 *
¯d
, u8 *
d©a
,

15 
size_t
 
d©a_Ën
, 
u8
 *
mic
)

17  
	`«ad_’üy±
(
tfm
, 
j_0
, 
¯d
 + 2,

18 
	`be16_to_ıup
((
__be16
 *)
¯d
),

19 
d©a
, 
d©a_Ën
, 
mic
);

20 
	}
}

22 
šlše
 
	$›“80211_«s_gcm_deüy±
(
üy±o_«ad
 *
tfm
,

23 
u8
 *
j_0
, u8 *
¯d
, u8 *
d©a
,

24 
size_t
 
d©a_Ën
, 
u8
 *
mic
)

26  
	`«ad_deüy±
(
tfm
, 
j_0
, 
¯d
 + 2,

27 
	`be16_to_ıup
((
__be16
 *)
¯d
),

28 
d©a
, 
d©a_Ën
, 
mic
);

29 
	}
}

31 
šlše
 
üy±o_«ad
 *

32 
	$›“80211_«s_gcm_key_£tup_’üy±
(cÚ¡ 
u8
 
key
[], 
size_t
 
key_Ën
)

34  
	`«ad_key_£tup_’üy±
("gcm×es)", 
key
,

35 
key_Ën
, 
IEEE80211_GCMP_MIC_LEN
);

36 
	}
}

38 
šlše
 
	$›“80211_«s_gcm_key_ä“
(
üy±o_«ad
 *
tfm
)

40  
	`«ad_key_ä“
(
tfm
);

41 
	}
}

	@aes_gmac.c

7 
	~<lšux/k”Ãl.h
>

8 
	~<lšux/ty³s.h
>

9 
	~<lšux/”r.h
>

10 
	~<üy±o/«ad.h
>

11 
	~<üy±o/«s.h
>

13 
	~<Ãt/mac80211.h
>

14 
	~"key.h
"

15 
	~"«s_gmac.h
"

17 
	$›“80211_«s_gmac
(
üy±o_«ad
 *
tfm
, cÚ¡ 
u8
 *
¯d
, u8 *
nÚû
,

18 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
)

20 
sÿ‰”li¡
 
sg
[5];

21 
u8
 *
z”o
, *
__¯d
, 
iv
[
AES_BLOCK_SIZE
];

22 
«ad_»que¡
 *
«ad_»q
;

23 
»qsize
 = (*
«ad_»q
è+ 
	`üy±o_«ad_»qsize
(
tfm
);

24 cÚ¡ 
__Ë16
 *
fc
;

25 
»t
;

27 ià(
d©a_Ën
 < 
GMAC_MIC_LEN
)

28  -
EINVAL
;

30 
«ad_»q
 = 
	`kz®loc
(
»qsize
 + 
GMAC_MIC_LEN
 + 
GMAC_AAD_LEN
, 
GFP_ATOMIC
);

31 ià(!
«ad_»q
)

32  -
ENOMEM
;

34 
z”o
 = (
u8
 *)
«ad_»q
 + 
»qsize
;

35 
__¯d
 = 
z”o
 + 
GMAC_MIC_LEN
;

36 
	`memıy
(
__¯d
, 
¯d
, 
GMAC_AAD_LEN
);

38 
fc
 = (cÚ¡ 
__Ë16
 *)
¯d
;

39 ià(
	`›“80211_is_b—cÚ
(*
fc
)) {

41 
	`sg_š™_bË
(
sg
, 5);

42 
	`sg_£t_buf
(&
sg
[0], 
__¯d
, 
GMAC_AAD_LEN
);

43 
	`sg_£t_buf
(&
sg
[1], 
z”o
, 8);

44 
	`sg_£t_buf
(&
sg
[2], 
d©a
 + 8, 
d©a_Ën
 - 8 - 
GMAC_MIC_LEN
);

45 
	`sg_£t_buf
(&
sg
[3], 
z”o
, 
GMAC_MIC_LEN
);

46 
	`sg_£t_buf
(&
sg
[4], 
mic
, 
GMAC_MIC_LEN
);

48 
	`sg_š™_bË
(
sg
, 4);

49 
	`sg_£t_buf
(&
sg
[0], 
__¯d
, 
GMAC_AAD_LEN
);

50 
	`sg_£t_buf
(&
sg
[1], 
d©a
, 
d©a_Ën
 - 
GMAC_MIC_LEN
);

51 
	`sg_£t_buf
(&
sg
[2], 
z”o
, 
GMAC_MIC_LEN
);

52 
	`sg_£t_buf
(&
sg
[3], 
mic
, 
GMAC_MIC_LEN
);

55 
	`memıy
(
iv
, 
nÚû
, 
GMAC_NONCE_LEN
);

56 
	`mem£t
(
iv
 + 
GMAC_NONCE_LEN
, 0, (iv) - GMAC_NONCE_LEN);

57 
iv
[
AES_BLOCK_SIZE
 - 1] = 0x01;

59 
	`«ad_»que¡_£t_tfm
(
«ad_»q
, 
tfm
);

60 
	`«ad_»que¡_£t_üy±
(
«ad_»q
, 
sg
, sg, 0, 
iv
);

61 
	`«ad_»que¡_£t_ad
(
«ad_»q
, 
GMAC_AAD_LEN
 + 
d©a_Ën
);

63 
»t
 = 
	`üy±o_«ad_’üy±
(
«ad_»q
);

64 
	`kä“_£ns™ive
(
«ad_»q
);

66  
»t
;

67 
	}
}

69 
üy±o_«ad
 *
	$›“80211_«s_gmac_key_£tup
(cÚ¡ 
u8
 
key
[],

70 
size_t
 
key_Ën
)

72 
üy±o_«ad
 *
tfm
;

73 
”r
;

75 
tfm
 = 
	`üy±o_®loc_«ad
("gcm×es)", 0, 
CRYPTO_ALG_ASYNC
);

76 ià(
	`IS_ERR
(
tfm
))

77  
tfm
;

79 
”r
 = 
	`üy±o_«ad_£tkey
(
tfm
, 
key
, 
key_Ën
);

80 ià(!
”r
)

81 
”r
 = 
	`üy±o_«ad_£uthsize
(
tfm
, 
GMAC_MIC_LEN
);

82 ià(!
”r
)

83  
tfm
;

85 
	`üy±o_ä“_«ad
(
tfm
);

86  
	`ERR_PTR
(
”r
);

87 
	}
}

89 
	$›“80211_«s_gmac_key_ä“
(
üy±o_«ad
 *
tfm
)

91 
	`üy±o_ä“_«ad
(
tfm
);

92 
	}
}

	@aes_gmac.h

6 #iâdeà
AES_GMAC_H


7 
	#AES_GMAC_H


	)

9 
	~<lšux/üy±o.h
>

11 
	#GMAC_AAD_LEN
 20

	)

12 
	#GMAC_MIC_LEN
 16

	)

13 
	#GMAC_NONCE_LEN
 12

	)

15 
üy±o_«ad
 *
›“80211_«s_gmac_key_£tup
(cÚ¡ 
u8
 
key
[],

16 
size_t
 
key_Ën
);

17 
›“80211_«s_gmac
(
üy±o_«ad
 *
tfm
, cÚ¡ 
u8
 *
¯d
, u8 *
nÚû
,

18 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
);

19 
›“80211_«s_gmac_key_ä“
(
üy±o_«ad
 *
tfm
);

	@agg-rx.c

38 
	~<lšux/›“80211.h
>

39 
	~<lšux/¦ab.h
>

40 
	~<lšux/expÜt.h
>

41 
	~<Ãt/mac80211.h
>

42 
	~"›“80211_i.h
"

43 
	~"driv”-İs.h
"

45 
	$›“80211_ä“_tid_rx
(
rcu_h—d
 *
h
)

47 
tid_ampdu_rx
 *
tid_rx
 =

48 
	`cÚš”_of
(
h
, 
tid_ampdu_rx
, 
rcu_h—d
);

49 
i
;

51 
i
 = 0; i < 
tid_rx
->
buf_size
; i++)

52 
	`__skb_queue_purge
(&
tid_rx
->
»Üd”_buf
[
i
]);

53 
	`kä“
(
tid_rx
->
»Üd”_buf
);

54 
	`kä“
(
tid_rx
->
»Üd”_time
);

55 
	`kä“
(
tid_rx
);

56 
	}
}

58 
	$__›“80211_¡İ_rx_ba_£ssiÚ
(
¡a_šfo
 *
¡a
, 
u16
 
tid
,

59 
u16
 
š™ŸtÜ
, u16 
»asÚ
, 
boŞ
 
tx
)

61 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

62 
tid_ampdu_rx
 *
tid_rx
;

63 
›“80211_ampdu_·¿ms
 
·¿ms
 = {

64 .
¡a
 = &sta->sta,

65 .
aùiÚ
 = 
IEEE80211_AMPDU_RX_STOP
,

66 .
tid
 =id,

67 .
amsdu
 = 
çl£
,

68 .
timeout
 = 0,

69 .
s¢
 = 0,

72 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

74 
tid_rx
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
ampdu_mlme
.tid_rx[
tid
],

75 
	`lockd•_is_h–d
(&
¡a
->
loÿl
->
hw
.
why
->
mtx
));

77 ià(!
	`‹¡_b™
(
tid
, 
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
))

80 
	`RCU_INIT_POINTER
(
¡a
->
ampdu_mlme
.
tid_rx
[
tid
], 
NULL
);

81 
	`__ş—r_b™
(
tid
, 
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
);

83 
	`ht_dbg
(
¡a
->
sd©a
,

85 
¡a
->¡a.
addr
, 
tid
,

86 
š™ŸtÜ
 =ğ
WLAN_BACK_RECIPIENT
 ? "recipient" : "initiator",

87 ()
»asÚ
);

89 ià(
	`drv_ampdu_aùiÚ
(
loÿl
, 
¡a
->
sd©a
, &
·¿ms
))

90 
	`sd©a_šfo
(
¡a
->
sd©a
,

92 
¡a
->¡a.
addr
, 
tid
);

95 ià(
š™ŸtÜ
 =ğ
WLAN_BACK_RECIPIENT
 && 
tx
)

96 
	`›“80211_£nd_d–ba
(
¡a
->
sd©a
, s->¡a.
addr
,

97 
tid
, 
WLAN_BACK_RECIPIENT
, 
»asÚ
);

103 ià(!
tid_rx
)

106 
	`d–_tim”_sync
(&
tid_rx
->
£ssiÚ_tim”
);

109 
	`¥š_lock_bh
(&
tid_rx
->
»Üd”_lock
);

110 
tid_rx
->
»moved
 = 
Œue
;

111 
	`¥š_uÆock_bh
(&
tid_rx
->
»Üd”_lock
);

112 
	`d–_tim”_sync
(&
tid_rx
->
»Üd”_tim”
);

114 
	`ÿÎ_rcu
(&
tid_rx
->
rcu_h—d
, 
›“80211_ä“_tid_rx
);

115 
	}
}

117 
	$›“80211_¡İ_rx_ba_£ssiÚ
(
›“80211_vif
 *
vif
, 
u16
 
ba_rx_b™m­
,

118 cÚ¡ 
u8
 *
addr
)

120 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

121 
¡a_šfo
 *
¡a
;

122 
i
;

124 
	`rcu_»ad_lock
();

125 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
addr
);

126 ià(!
¡a
) {

127 
	`rcu_»ad_uÆock
();

131 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

132 ià(
ba_rx_b™m­
 & 
	`BIT
(
i
))

133 
	`£t_b™
(
i
, 
¡a
->
ampdu_mlme
.
tid_rx_¡İ_»que¡ed
);

135 
	`why_wÜk_queue
(
¡a
->
loÿl
->
hw
.
why
, &¡a->
ampdu_mlme
.
wÜk
);

136 
	`rcu_»ad_uÆock
();

137 
	}
}

138 
EXPORT_SYMBOL
(
›“80211_¡İ_rx_ba_£ssiÚ
);

144 
	$¡a_rx_agg_£ssiÚ_tim”_expœed
(
tim”_li¡
 *
t
)

146 
tid_ampdu_rx
 *
tid_rx
 = 
	`äom_tim”
Ñid_rx, 
t
, 
£ssiÚ_tim”
);

147 
¡a_šfo
 *
¡a
 = 
tid_rx
->sta;

148 
u8
 
tid
 = 
tid_rx
->tid;

149 
timeout
;

151 
timeout
 = 
tid_rx
->
Ï¡_rx
 + 
	`TU_TO_JIFFIES
(tid_rx->timeout);

152 ià(
	`time_is_aá”_jiff›s
(
timeout
)) {

153 
	`mod_tim”
(&
tid_rx
->
£ssiÚ_tim”
, 
timeout
);

157 
	`ht_dbg
(
¡a
->
sd©a
, "RX sessionimerƒxpired on %pMid %d\n",

158 
¡a
->¡a.
addr
, 
tid
);

160 
	`£t_b™
(
tid
, 
¡a
->
ampdu_mlme
.
tid_rx_tim”_expœed
);

161 
	`why_wÜk_queue
(
¡a
->
loÿl
->
hw
.
why
, &¡a->
ampdu_mlme
.
wÜk
);

162 
	}
}

164 
	$¡a_rx_agg_»Üd”_tim”_expœed
(
tim”_li¡
 *
t
)

166 
tid_ampdu_rx
 *
tid_rx
 = 
	`äom_tim”
Ñid_rx, 
t
, 
»Üd”_tim”
);

168 
	`rcu_»ad_lock
();

169 
	`›“80211_»Ëa£_»Üd”_timeout
(
tid_rx
->
¡a
,id_rx->
tid
);

170 
	`rcu_»ad_uÆock
();

171 
	}
}

173 
	$›“80211_add_addb«xt
(
›“80211_sub_if_d©a
 *
sd©a
,

174 
sk_buff
 *
skb
,

175 cÚ¡ 
›“80211_addba_ext_›
 *
»q
,

176 
u16
 
buf_size
)

178 
›“80211_addba_ext_›
 *
»¥
;

179 
u8
 *
pos
;

181 
pos
 = 
	`skb_put_z”o
(
skb
, 2 + (
›“80211_addba_ext_›
));

182 *
pos
++ = 
WLAN_EID_ADDBA_EXT
;

183 *
pos
++ = (
›“80211_addba_ext_›
);

184 
»¥
 = (
›“80211_addba_ext_›
 *)
pos
;

185 
»¥
->
d©a
 = 
»q
->d©¨& 
IEEE80211_ADDBA_EXT_NO_FRAG
;

187 
»¥
->
d©a
 |ğ
	`u8_’code_b™s
(
buf_size
 >> 
IEEE80211_ADDBA_EXT_BUF_SIZE_SHIFT
,

188 
IEEE80211_ADDBA_EXT_BUF_SIZE_MASK
);

189 
	}
}

191 
	$›“80211_£nd_addba_»¥
(
¡a_šfo
 *
¡a
, 
u8
 *
da
, 
u16
 
tid
,

192 
u8
 
dŸlog_tok’
, 
u16
 
¡©us
, u16 
pŞicy
,

193 
u16
 
buf_size
, u16 
timeout
,

194 cÚ¡ 
›“80211_addba_ext_›
 *
addb«xt
)

196 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

197 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

198 
sk_buff
 *
skb
;

199 
›“80211_mgmt
 *
mgmt
;

200 
boŞ
 
amsdu
 = 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_AMSDU_IN_AMPDU
);

201 
u16
 
ÿ·b
;

203 
skb
 = 
	`dev_®loc_skb
((*
mgmt
) +

204 2 + (
›“80211_addba_ext_›
) +

205 
loÿl
->
hw
.
exŒa_tx_h—droom
);

206 ià(!
skb
)

209 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

210 
mgmt
 = 
	`skb_put_z”o
(
skb
, 24);

211 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

212 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

213 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

214 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 ||

215 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
)

216 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

217 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

218 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

219 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

220 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
u
.
ibss
.bssid, 
ETH_ALEN
);

222 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

223 
IEEE80211_STYPE_ACTION
);

225 
	`skb_put
(
skb
, 1 + (
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
));

226 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
;

227 
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
aùiÚ_code
 = 
WLAN_ACTION_ADDBA_RESP
;

228 
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
dŸlog_tok’
 = dialog_token;

230 
ÿ·b
 = 
	`u16_’code_b™s
(
amsdu
, 
IEEE80211_ADDBA_PARAM_AMSDU_MASK
);

231 
ÿ·b
 |ğ
	`u16_’code_b™s
(
pŞicy
, 
IEEE80211_ADDBA_PARAM_POLICY_MASK
);

232 
ÿ·b
 |ğ
	`u16_’code_b™s
(
tid
, 
IEEE80211_ADDBA_PARAM_TID_MASK
);

233 
ÿ·b
 |ğ
	`u16_’code_b™s
(
buf_size
, 
IEEE80211_ADDBA_PARAM_BUF_SIZE_MASK
);

235 
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
ÿ·b
 = 
	`ıu_to_Ë16
(capab);

236 
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
timeout
 = 
	`ıu_to_Ë16
(timeout);

237 
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
¡©us
 = 
	`ıu_to_Ë16
(status);

239 ià(
¡a
->¡a.
deæšk
.
he_ÿp
.
has_he
 && 
addb«xt
)

240 
	`›“80211_add_addb«xt
(
sd©a
, 
skb
, 
addb«xt
, 
buf_size
);

242 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

243 
	}
}

245 
	$__›“80211_¡¬t_rx_ba_£ssiÚ
(
¡a_šfo
 *
¡a
,

246 
u8
 
dŸlog_tok’
, 
u16
 
timeout
,

247 
u16
 
¡¬t_£q_num
, u16 
ba_pŞicy
, u16 
tid
,

248 
u16
 
buf_size
, 
boŞ
 
tx
, boŞ 
auto_£q
,

249 cÚ¡ 
›“80211_addba_ext_›
 *
addb«xt
)

251 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

252 
tid_ampdu_rx
 *
tid_agg_rx
;

253 
›“80211_ampdu_·¿ms
 
·¿ms
 = {

254 .
¡a
 = &sta->sta,

255 .
aùiÚ
 = 
IEEE80211_AMPDU_RX_START
,

256 .
tid
 =id,

257 .
amsdu
 = 
çl£
,

258 .
timeout
 =imeout,

259 .
s¢
 = 
¡¬t_£q_num
,

261 
i
, 
»t
 = -
EOPNOTSUPP
;

262 
u16
 
¡©us
 = 
WLAN_STATUS_REQUEST_DECLINED
;

263 
u16
 
max_buf_size
;

265 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

267 ià(
tid
 >ğ
IEEE80211_FIRST_TSPEC_TSID
) {

268 
	`ht_dbg
(
¡a
->
sd©a
,

270 
¡a
->¡a.
addr
, 
tid
);

271 
’d
;

274 ià(!
¡a
->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
 &&

275 !
¡a
->¡a.
deæšk
.
he_ÿp
.
has_he
) {

276 
	`ht_dbg
(
¡a
->
sd©a
,

278 
¡a
->¡a.
addr
, 
tid
);

280 
’d
;

283 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
)) {

284 
	`ht_dbg
(
¡a
->
sd©a
,

286 
¡a
->¡a.
addr
, 
tid
);

287 
’d
;

290 ià(
¡a
->¡a.
deæšk
.
eht_ÿp
.
has_eht
)

291 
max_buf_size
 = 
IEEE80211_MAX_AMPDU_BUF_EHT
;

292 ià(
¡a
->¡a.
deæšk
.
he_ÿp
.
has_he
)

293 
max_buf_size
 = 
IEEE80211_MAX_AMPDU_BUF_HE
;

295 
max_buf_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
;

301 ià(((
ba_pŞicy
 != 1) &&

302 (!(
¡a
->¡a.
deæšk
.
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_DELAY_BA
))) ||

303 (
buf_size
 > 
max_buf_size
)) {

304 
¡©us
 = 
WLAN_STATUS_INVALID_QOS_PARAM
;

305 
	`ht_dbg_¿‹lim™ed
(
¡a
->
sd©a
,

307 
¡a
->¡a.
addr
, 
tid
, 
ba_pŞicy
, 
buf_size
);

308 
’d
;

311 ià(
buf_size
 == 0)

312 
buf_size
 = 
max_buf_size
;

315 ià(
buf_size
 > 
¡a
->¡a.
max_rx_agg»g©iÚ_subäames
)

316 
buf_size
 = 
¡a
->¡a.
max_rx_agg»g©iÚ_subäames
;

317 
·¿ms
.
buf_size
 = buf_size;

319 
	`ht_dbg
(
¡a
->
sd©a
, "AddBA Req buf_size=%d for %pM\n",

320 
buf_size
, 
¡a
->¡a.
addr
);

322 ià(
	`‹¡_b™
(
tid
, 
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
)) {

323 ià(
¡a
->
ampdu_mlme
.
tid_rx_tok’
[
tid
] =ğ
dŸlog_tok’
) {

324 
tid_ampdu_rx
 *
tid_rx
;

326 
	`ht_dbg_¿‹lim™ed
(
¡a
->
sd©a
,

328 
¡a
->¡a.
addr
, 
tid
);

334 
	`rcu_»ad_lock
();

335 
tid_rx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_rx[
tid
]);

336 ià(
tid_rx
 &&id_rx->
timeout
 ==imeout)

337 
¡©us
 = 
WLAN_STATUS_SUCCESS
;

339 
¡©us
 = 
WLAN_STATUS_REQUEST_DECLINED
;

340 
	`rcu_»ad_uÆock
();

341 
’d
;

344 
	`ht_dbg_¿‹lim™ed
(
¡a
->
sd©a
,

346 
¡a
->¡a.
addr
, 
tid
);

349 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(
¡a
, 
tid
, 
WLAN_BACK_RECIPIENT
,

350 
WLAN_STATUS_UNSPECIFIED_QOS
,

351 
çl£
);

354 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_REORDERING_BUFFER
)) {

355 
»t
 = 
	`drv_ampdu_aùiÚ
(
loÿl
, 
¡a
->
sd©a
, &
·¿ms
);

356 
	`ht_dbg
(
¡a
->
sd©a
,

358 
¡a
->¡a.
addr
, 
tid
, 
»t
);

359 ià(!
»t
)

360 
¡©us
 = 
WLAN_STATUS_SUCCESS
;

361 
’d
;

365 
tid_agg_rx
 = 
	`kz®loc
((*tid_agg_rx), 
GFP_KERNEL
);

366 ià(!
tid_agg_rx
)

367 
’d
;

369 
	`¥š_lock_š™
(&
tid_agg_rx
->
»Üd”_lock
);

372 
	`tim”_£tup
(&
tid_agg_rx
->
£ssiÚ_tim”
,

373 
¡a_rx_agg_£ssiÚ_tim”_expœed
, 
TIMER_DEFERRABLE
);

376 
	`tim”_£tup
(&
tid_agg_rx
->
»Üd”_tim”
,

377 
¡a_rx_agg_»Üd”_tim”_expœed
, 0);

380 
tid_agg_rx
->
»Üd”_buf
 =

381 
	`kÿÎoc
(
buf_size
, (
sk_buff_h—d
), 
GFP_KERNEL
);

382 
tid_agg_rx
->
»Üd”_time
 =

383 
	`kÿÎoc
(
buf_size
, (), 
GFP_KERNEL
);

384 ià(!
tid_agg_rx
->
»Üd”_buf
 || !tid_agg_rx->
»Üd”_time
) {

385 
	`kä“
(
tid_agg_rx
->
»Üd”_buf
);

386 
	`kä“
(
tid_agg_rx
->
»Üd”_time
);

387 
	`kä“
(
tid_agg_rx
);

388 
’d
;

391 
i
 = 0; i < 
buf_size
; i++)

392 
	`__skb_queue_h—d_š™
(&
tid_agg_rx
->
»Üd”_buf
[
i
]);

394 
»t
 = 
	`drv_ampdu_aùiÚ
(
loÿl
, 
¡a
->
sd©a
, &
·¿ms
);

395 
	`ht_dbg
(
¡a
->
sd©a
, "Rx A-MPDU„equest on %pMid %d„esult %d\n",

396 
¡a
->¡a.
addr
, 
tid
, 
»t
);

397 ià(
»t
) {

398 
	`kä“
(
tid_agg_rx
->
»Üd”_buf
);

399 
	`kä“
(
tid_agg_rx
->
»Üd”_time
);

400 
	`kä“
(
tid_agg_rx
);

401 
’d
;

405 
tid_agg_rx
->
s¢
 = 
¡¬t_£q_num
;

406 
tid_agg_rx
->
h—d_£q_num
 = 
¡¬t_£q_num
;

407 
tid_agg_rx
->
buf_size
 = buf_size;

408 
tid_agg_rx
->
timeout
 =imeout;

409 
tid_agg_rx
->
¡Üed_mpdu_num
 = 0;

410 
tid_agg_rx
->
auto_£q
 =‡uto_seq;

411 
tid_agg_rx
->
¡¬‹d
 = 
çl£
;

412 
tid_agg_rx
->
»Üd”_buf_f‹»d
 = 0;

413 
tid_agg_rx
->
tid
 =id;

414 
tid_agg_rx
->
¡a
 = sta;

415 
¡©us
 = 
WLAN_STATUS_SUCCESS
;

418 
	`rcu_assign_poš‹r
(
¡a
->
ampdu_mlme
.
tid_rx
[
tid
], 
tid_agg_rx
);

420 ià(
timeout
) {

421 
	`mod_tim”
(&
tid_agg_rx
->
£ssiÚ_tim”
, 
	`TU_TO_EXP_TIME
(
timeout
));

422 
tid_agg_rx
->
Ï¡_rx
 = 
jiff›s
;

425 
’d
:

426 ià(
¡©us
 =ğ
WLAN_STATUS_SUCCESS
) {

427 
	`__£t_b™
(
tid
, 
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
);

428 
	`__ş—r_b™
(
tid
, 
¡a
->
ampdu_mlme
.
uÃx³ùed_agg
);

429 
¡a
->
ampdu_mlme
.
tid_rx_tok’
[
tid
] = 
dŸlog_tok’
;

432 ià(
tx
)

433 
	`›“80211_£nd_addba_»¥
(
¡a
, s->¡a.
addr
, 
tid
,

434 
dŸlog_tok’
, 
¡©us
, 1, 
buf_size
,

435 
timeout
, 
addb«xt
);

436 
	}
}

438 
	$›“80211_´oûss_addba_»que¡
(
›“80211_loÿl
 *
loÿl
,

439 
¡a_šfo
 *
¡a
,

440 
›“80211_mgmt
 *
mgmt
,

441 
size_t
 
Ën
)

443 
u16
 
ÿ·b
, 
tid
, 
timeout
, 
ba_pŞicy
, 
buf_size
, 
¡¬t_£q_num
;

444 
›“802_11_–ems
 *
–ems
 = 
NULL
;

445 
u8
 
dŸlog_tok’
;

446 
›s_Ën
;

449 
dŸlog_tok’
 = 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.dialog_token;

450 
timeout
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.timeout);

451 
¡¬t_£q_num
 =

452 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
¡¬t_£q_num
) >> 4;

454 
ÿ·b
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.capab);

455 
ba_pŞicy
 = (
ÿ·b
 & 
IEEE80211_ADDBA_PARAM_POLICY_MASK
) >> 1;

456 
tid
 = (
ÿ·b
 & 
IEEE80211_ADDBA_PARAM_TID_MASK
) >> 2;

457 
buf_size
 = (
ÿ·b
 & 
IEEE80211_ADDBA_PARAM_BUF_SIZE_MASK
) >> 6;

459 
›s_Ën
 = 
Ën
 - 
	`off£tof
(
›“80211_mgmt
,

460 
u
.
aùiÚ
.u.
addba_»q
.
v¬ŸbË
);

461 ià(
›s_Ën
) {

462 
–ems
 = 
	`›“802_11_·r£_–ems
(
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
v¬ŸbË
,

463 
›s_Ën
, 
Œue
, 
NULL
);

464 ià(!
–ems
 ||ƒËms->
·r£_”rÜ
)

465 
ä“
;

468 ià(
¡a
->¡a.
deæšk
.
eht_ÿp
.
has_eht
 && 
–ems
 &&ƒËms->
addba_ext_›
) {

469 
u8
 
buf_size_1k
 = 
	`u8_g‘_b™s
(
–ems
->
addba_ext_›
->
d©a
,

470 
IEEE80211_ADDBA_EXT_BUF_SIZE_MASK
);

472 
buf_size
 |ğ
buf_size_1k
 << 
IEEE80211_ADDBA_EXT_BUF_SIZE_SHIFT
;

475 
	`__›“80211_¡¬t_rx_ba_£ssiÚ
(
¡a
, 
dŸlog_tok’
, 
timeout
,

476 
¡¬t_£q_num
, 
ba_pŞicy
, 
tid
,

477 
buf_size
, 
Œue
, 
çl£
,

478 
–ems
 ?ƒËms->
addba_ext_›
 : 
NULL
);

479 
ä“
:

480 
	`kä“
(
–ems
);

481 
	}
}

483 
	$›“80211_mªage_rx_ba_ofæ
(
›“80211_vif
 *
vif
,

484 cÚ¡ 
u8
 *
addr
, 
tid
)

486 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

487 
¡a_šfo
 *
¡a
;

489 
	`rcu_»ad_lock
();

490 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
addr
);

491 ià(!
¡a
)

492 
uÆock
;

494 
	`£t_b™
(
tid
, 
¡a
->
ampdu_mlme
.
tid_rx_mªage_ofæ
);

495 
	`why_wÜk_queue
(
¡a
->
loÿl
->
hw
.
why
, &¡a->
ampdu_mlme
.
wÜk
);

496 
uÆock
:

497 
	`rcu_»ad_uÆock
();

498 
	}
}

499 
EXPORT_SYMBOL
(
›“80211_mªage_rx_ba_ofæ
);

501 
	$›“80211_rx_ba_tim”_expœed
(
›“80211_vif
 *
vif
,

502 cÚ¡ 
u8
 *
addr
, 
tid
)

504 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

505 
¡a_šfo
 *
¡a
;

507 
	`rcu_»ad_lock
();

508 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
addr
);

509 ià(!
¡a
)

510 
uÆock
;

512 
	`£t_b™
(
tid
, 
¡a
->
ampdu_mlme
.
tid_rx_tim”_expœed
);

513 
	`why_wÜk_queue
(
¡a
->
loÿl
->
hw
.
why
, &¡a->
ampdu_mlme
.
wÜk
);

515 
uÆock
:

516 
	`rcu_»ad_uÆock
();

517 
	}
}

518 
EXPORT_SYMBOL
(
›“80211_rx_ba_tim”_expœed
);

	@agg-tx.c

15 
	~<lšux/›“80211.h
>

16 
	~<lšux/¦ab.h
>

17 
	~<lšux/expÜt.h
>

18 
	~<Ãt/mac80211.h
>

19 
	~"›“80211_i.h
"

20 
	~"driv”-İs.h
"

21 
	~"wme.h
"

61 
	$›“80211_£nd_addba_»que¡
(
›“80211_sub_if_d©a
 *
sd©a
,

62 cÚ¡ 
u8
 *
da
, 
u16
 
tid
,

63 
u8
 
dŸlog_tok’
, 
u16
 
¡¬t_£q_num
,

64 
u16
 
agg_size
, u16 
timeout
)

66 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

67 
sk_buff
 *
skb
;

68 
›“80211_mgmt
 *
mgmt
;

69 
u16
 
ÿ·b
;

71 
skb
 = 
	`dev_®loc_skb
((*
mgmt
è+ 
loÿl
->
hw
.
exŒa_tx_h—droom
);

73 ià(!
skb
)

76 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

77 
mgmt
 = 
	`skb_put_z”o
(
skb
, 24);

78 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

79 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

80 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

81 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 ||

82 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
)

83 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

84 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

85 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

86 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

87 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
u
.
ibss
.bssid, 
ETH_ALEN
);

89 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

90 
IEEE80211_STYPE_ACTION
);

92 
	`skb_put
(
skb
, 1 + (
mgmt
->
u
.
aùiÚ
.u.
addba_»q
));

94 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
;

95 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
aùiÚ_code
 = 
WLAN_ACTION_ADDBA_REQ
;

97 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
dŸlog_tok’
 = dialog_token;

98 
ÿ·b
 = 
IEEE80211_ADDBA_PARAM_AMSDU_MASK
;

99 
ÿ·b
 |ğ
IEEE80211_ADDBA_PARAM_POLICY_MASK
;

100 
ÿ·b
 |ğ
	`u16_’code_b™s
(
tid
, 
IEEE80211_ADDBA_PARAM_TID_MASK
);

101 
ÿ·b
 |ğ
	`u16_’code_b™s
(
agg_size
, 
IEEE80211_ADDBA_PARAM_BUF_SIZE_MASK
);

103 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
ÿ·b
 = 
	`ıu_to_Ë16
(capab);

105 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
timeout
 = 
	`ıu_to_Ë16
(timeout);

106 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
¡¬t_£q_num
 =

107 
	`ıu_to_Ë16
(
¡¬t_£q_num
 << 4);

109 
	`›“80211_tx_skb_tid
(
sd©a
, 
skb
, 
tid
, -1);

110 
	}
}

112 
	$›“80211_£nd_b¬
(
›“80211_vif
 *
vif
, 
u8
 *
¿
, 
u16
 
tid
, u16 
s¢
)

114 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

115 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

116 
sk_buff
 *
skb
;

117 
›“80211_b¬
 *
b¬
;

118 
u16
 
b¬_cÚŒŞ
 = 0;

120 
skb
 = 
	`dev_®loc_skb
((*
b¬
è+ 
loÿl
->
hw
.
exŒa_tx_h—droom
);

121 ià(!
skb
)

124 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

125 
b¬
 = 
	`skb_put_z”o
(
skb
, (*bar));

126 
b¬
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_CTL
 |

127 
IEEE80211_STYPE_BACK_REQ
);

128 
	`memıy
(
b¬
->
¿
,„a, 
ETH_ALEN
);

129 
	`memıy
(
b¬
->

, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

130 
b¬_cÚŒŞ
 |ğ(
u16
)
IEEE80211_BAR_CTRL_ACK_POLICY_NORMAL
;

131 
b¬_cÚŒŞ
 |ğ(
u16
)
IEEE80211_BAR_CTRL_CBMTID_COMPRESSED_BA
;

132 
b¬_cÚŒŞ
 |ğ(
u16
)(
tid
 << 
IEEE80211_BAR_CTRL_TID_INFO_SHIFT
);

133 
b¬
->
cÚŒŞ
 = 
	`ıu_to_Ë16
(
b¬_cÚŒŞ
);

134 
b¬
->
¡¬t_£q_num
 = 
	`ıu_to_Ë16
(
s¢
);

136 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
 |

137 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

138 
	`›“80211_tx_skb_tid
(
sd©a
, 
skb
, 
tid
, -1);

139 
	}
}

140 
EXPORT_SYMBOL
(
›“80211_£nd_b¬
);

142 
	$›“80211_assign_tid_tx
(
¡a_šfo
 *
¡a
, 
tid
,

143 
tid_ampdu_tx
 *
tid_tx
)

145 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

146 
	`lockd•_as£¹_h–d
(&
¡a
->
lock
);

147 
	`rcu_assign_poš‹r
(
¡a
->
ampdu_mlme
.
tid_tx
[
tid
],id_tx);

148 
	}
}

161 
	$__acquœes
(
agg_queue
)

162 
	$›“80211_¡İ_queue_agg
(
›“80211_sub_if_d©a
 *
sd©a
, 
tid
)

164 
queue
 = 
sd©a
->
vif
.
hw_queue
[
	`›“80211_ac_äom_tid
(
tid
)];

168 ià(
	`©omic_šc_»tuº
(&
sd©a
->
loÿl
->
agg_queue_¡İ
[
queue
]) == 1)

169 
	`›“80211_¡İ_queue_by_»asÚ
(

170 &
sd©a
->
loÿl
->
hw
, 
queue
,

171 
IEEE80211_QUEUE_STOP_REASON_AGGREGATION
,

172 
çl£
);

173 
	`__acquœe
(
agg_queue
);

174 
	}
}

176 
	$__»Ëa£s
(
agg_queue
)

177 
	$›“80211_wake_queue_agg
(
›“80211_sub_if_d©a
 *
sd©a
, 
tid
)

179 
queue
 = 
sd©a
->
vif
.
hw_queue
[
	`›“80211_ac_äom_tid
(
tid
)];

181 ià(
	`©omic_dec_»tuº
(&
sd©a
->
loÿl
->
agg_queue_¡İ
[
queue
]) == 0)

182 
	`›“80211_wake_queue_by_»asÚ
(

183 &
sd©a
->
loÿl
->
hw
, 
queue
,

184 
IEEE80211_QUEUE_STOP_REASON_AGGREGATION
,

185 
çl£
);

186 
	`__»Ëa£
(
agg_queue
);

187 
	}
}

190 
	$›“80211_agg_¡İ_txq
(
¡a_šfo
 *
¡a
, 
tid
)

192 
›“80211_txq
 *
txq
 = 
¡a
->¡a.txq[
tid
];

193 
›“80211_sub_if_d©a
 *
sd©a
;

194 
fq
 *fq;

195 
txq_šfo
 *
txqi
;

197 ià(!
txq
)

200 
txqi
 = 
	`to_txq_šfo
(
txq
);

201 
sd©a
 = 
	`vif_to_sd©a
(
txq
->
vif
);

202 
fq
 = &
sd©a
->
loÿl
->fq;

205 
	`¥š_lock_bh
(&
fq
->
lock
);

206 
	`£t_b™
(
IEEE80211_TXQ_STOP
, &
txqi
->
æags
);

207 
	`¥š_uÆock_bh
(&
fq
->
lock
);

208 
	}
}

211 
	$›“80211_agg_¡¬t_txq
(
¡a_šfo
 *
¡a
, 
tid
, 
boŞ
 
’abË
)

213 
›“80211_txq
 *
txq
 = 
¡a
->¡a.txq[
tid
];

214 
txq_šfo
 *
txqi
;

216 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

218 ià(!
txq
)

221 
txqi
 = 
	`to_txq_šfo
(
txq
);

223 ià(
’abË
)

224 
	`£t_b™
(
IEEE80211_TXQ_AMPDU
, &
txqi
->
æags
);

226 
	`ş—r_b™
(
IEEE80211_TXQ_AMPDU
, &
txqi
->
æags
);

228 
	`ş—r_b™
(
IEEE80211_TXQ_STOP
, &
txqi
->
æags
);

229 
	`loÿl_bh_di§bË
();

230 
	`rcu_»ad_lock
();

231 
	`scheduË_ªd_wake_txq
(
¡a
->
sd©a
->
loÿl
, 
txqi
);

232 
	`rcu_»ad_uÆock
();

233 
	`loÿl_bh_’abË
();

234 
	}
}

240 
	$__acquœes
(
agg_queue
)

241 
	$›“80211_agg_¥liû_·ck‘s
(
›“80211_sub_if_d©a
 *
sd©a
,

242 
tid_ampdu_tx
 *
tid_tx
, 
u16
 
tid
)

244 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

245 
queue
 = 
sd©a
->
vif
.
hw_queue
[
	`›“80211_ac_äom_tid
(
tid
)];

246 
æags
;

248 
	`›“80211_¡İ_queue_agg
(
sd©a
, 
tid
);

250 ià(
	`WARN
(!
tid_tx
,

252 
tid
))

255 ià(!
	`skb_queue_em±y
(&
tid_tx
->
³ndšg
)) {

256 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

258 
	`skb_queue_¥liû__š™
(&
tid_tx
->
³ndšg
,

259 &
loÿl
->
³ndšg
[
queue
]);

260 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

262 
	}
}

264 
	$__»Ëa£s
(
agg_queue
)

265 
	$›“80211_agg_¥liû_fšish
(
›“80211_sub_if_d©a
 *
sd©a
, 
u16
 
tid
)

267 
	`›“80211_wake_queue_agg
(
sd©a
, 
tid
);

268 
	}
}

270 
	$›“80211_»move_tid_tx
(
¡a_šfo
 *
¡a
, 
tid
)

272 
tid_ampdu_tx
 *
tid_tx
;

274 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

275 
	`lockd•_as£¹_h–d
(&
¡a
->
lock
);

277 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

289 
	`›“80211_agg_¥liû_·ck‘s
(
¡a
->
sd©a
, 
tid_tx
, 
tid
);

292 
	`›“80211_assign_tid_tx
(
¡a
, 
tid
, 
NULL
);

294 
	`›“80211_agg_¥liû_fšish
(
¡a
->
sd©a
, 
tid
);

296 
	`kä“_rcu
(
tid_tx
, 
rcu_h—d
);

297 
	}
}

299 
	$__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a_šfo
 *
¡a
, 
u16
 
tid
,

300 
›“80211_agg_¡İ_»asÚ
 
»asÚ
)

302 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

303 
tid_ampdu_tx
 *
tid_tx
;

304 
›“80211_ampdu_·¿ms
 
·¿ms
 = {

305 .
¡a
 = &sta->sta,

306 .
tid
 =id,

307 .
buf_size
 = 0,

308 .
amsdu
 = 
çl£
,

309 .
timeout
 = 0,

310 .
s¢
 = 0,

312 
»t
;

314 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

316 
»asÚ
) {

317 
AGG_STOP_DECLINED
:

318 
AGG_STOP_LOCAL_REQUEST
:

319 
AGG_STOP_PEER_REQUEST
:

320 
·¿ms
.
aùiÚ
 = 
IEEE80211_AMPDU_TX_STOP_CONT
;

322 
AGG_STOP_DESTROY_STA
:

323 
·¿ms
.
aùiÚ
 = 
IEEE80211_AMPDU_TX_STOP_FLUSH
;

326 
	`WARN_ON_ONCE
(1);

327  -
EINVAL
;

330 
	`¥š_lock_bh
(&
¡a
->
lock
);

333 
tid_tx
 = 
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
tid
];

334 
	`kä“
(
tid_tx
);

335 
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
tid
] = 
NULL
;

337 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

338 ià(!
tid_tx
) {

339 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

340  -
ENOENT
;

347 ià(
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
)) {

348 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

349 ià(
»asÚ
 !ğ
AGG_STOP_DESTROY_STA
)

350  -
EALREADY
;

351 
·¿ms
.
aùiÚ
 = 
IEEE80211_AMPDU_TX_STOP_FLUSH_CONT
;

352 
»t
 = 
	`drv_ampdu_aùiÚ
(
loÿl
, 
¡a
->
sd©a
, &
·¿ms
);

353 
	`WARN_ON_ONCE
(
»t
);

357 ià(
	`‹¡_b™
(
HT_AGG_STATE_WANT_START
, &
tid_tx
->
¡©e
)) {

359 
	`›“80211_assign_tid_tx
(
¡a
, 
tid
, 
NULL
);

360 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

361 
	`kä“_rcu
(
tid_tx
, 
rcu_h—d
);

365 
	`£t_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
);

367 
	`›“80211_agg_¡İ_txq
(
¡a
, 
tid
);

369 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

371 
	`ht_dbg
(
¡a
->
sd©a
, "Tx BA session stop„equested for %pMid %u\n",

372 
¡a
->¡a.
addr
, 
tid
);

374 
	`d–_tim”_sync
(&
tid_tx
->
addba_»¥_tim”
);

375 
	`d–_tim”_sync
(&
tid_tx
->
£ssiÚ_tim”
);

382 
	`ş—r_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
);

396 ià(!
loÿl
->
š_»cÚfig
)

397 
	`synchrÚize_Ãt
();

399 
tid_tx
->
¡İ_š™ŸtÜ
 = 
»asÚ
 =ğ
AGG_STOP_PEER_REQUEST
 ?

400 
WLAN_BACK_RECIPIENT
 :

401 
WLAN_BACK_INITIATOR
;

402 
tid_tx
->
tx_¡İ
 = 
»asÚ
 =ğ
AGG_STOP_LOCAL_REQUEST
;

404 
»t
 = 
	`drv_ampdu_aùiÚ
(
loÿl
, 
¡a
->
sd©a
, &
·¿ms
);

407 ià(
	`WARN_ON
(
»t
)) {

425 
	}
}

432 
	$¡a_addba_»¥_tim”_expœed
(
tim”_li¡
 *
t
)

434 
tid_ampdu_tx
 *
tid_tx
 = 
	`äom_tim”
Ñid_tx, 
t
, 
addba_»¥_tim”
);

435 
¡a_šfo
 *
¡a
 = 
tid_tx
->sta;

436 
u8
 
tid
 = 
tid_tx
->tid;

439 ià(
	`‹¡_b™
(
HT_AGG_STATE_RESPONSE_RECEIVED
, &
tid_tx
->
¡©e
)) {

440 
	`ht_dbg
(
¡a
->
sd©a
,

442 
¡a
->¡a.
addr
, 
tid
);

446 
	`ht_dbg
(
¡a
->
sd©a
, "addBA„esponseimerƒxpired on %pMid %d\n",

447 
¡a
->¡a.
addr
, 
tid
);

449 
	`›“80211_¡İ_tx_ba_£ssiÚ
(&
¡a
->¡a, 
tid
);

450 
	}
}

452 
	$›“80211_£nd_addba_w™h_timeout
(
¡a_šfo
 *
¡a
,

453 
tid_ampdu_tx
 *
tid_tx
)

455 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

456 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

457 
u8
 
tid
 = 
tid_tx
->tid;

458 
u16
 
buf_size
;

460 ià(
	`WARN_ON_ONCE
(
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
) ||

461 
	`‹¡_b™
(
HT_AGG_STATE_WANT_STOP
, &
tid_tx
->
¡©e
)))

464 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

467 
	`mod_tim”
(&
tid_tx
->
addba_»¥_tim”
, 
jiff›s
 + 
ADDBA_RESP_INTERVAL
);

468 
	`ht_dbg
(
sd©a
, "activated‡ddBA„esponseimer on %pMid %d\n",

469 
¡a
->¡a.
addr
, 
tid
);

471 
	`¥š_lock_bh
(&
¡a
->
lock
);

472 
¡a
->
ampdu_mlme
.
Ï¡_addba_»q_time
[
tid
] = 
jiff›s
;

473 
¡a
->
ampdu_mlme
.
addba_»q_num
[
tid
]++;

474 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

476 ià(
¡a
->¡a.
deæšk
.
he_ÿp
.
has_he
) {

477 
buf_size
 = 
loÿl
->
hw
.
max_tx_agg»g©iÚ_subäames
;

485 
buf_size
 = 
IEEE80211_MAX_AMPDU_BUF_HT
;

489 
	`›“80211_£nd_addba_»que¡
(
sd©a
, 
¡a
->¡a.
addr
, 
tid
,

490 
tid_tx
->
dŸlog_tok’
,id_tx->
s¢
,

491 
buf_size
, 
tid_tx
->
timeout
);

493 
	`WARN_ON
(
	`‹¡_ªd_£t_b™
(
HT_AGG_STATE_SENT_ADDBA
, &
tid_tx
->
¡©e
));

494 
	}
}

496 
	$›“80211_tx_ba_£ssiÚ_hªdË_¡¬t
(
¡a_šfo
 *
¡a
, 
tid
)

498 
tid_ampdu_tx
 *
tid_tx
;

499 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

500 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

501 
›“80211_ampdu_·¿ms
 
·¿ms
 = {

502 .
¡a
 = &sta->sta,

503 .
aùiÚ
 = 
IEEE80211_AMPDU_TX_START
,

504 .
tid
 =id,

505 .
buf_size
 = 0,

506 .
amsdu
 = 
çl£
,

507 .
timeout
 = 0,

509 
»t
;

511 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

518 
	`ş—r_b™
(
HT_AGG_STATE_WANT_START
, &
tid_tx
->
¡©e
);

526 
	`synchrÚize_Ãt
();

528 
·¿ms
.
s¢
 = 
¡a
->
tid_£q
[
tid
] >> 4;

529 
»t
 = 
	`drv_ampdu_aùiÚ
(
loÿl
, 
sd©a
, &
·¿ms
);

530 
tid_tx
->
s¢
 = 
·¿ms
.ssn;

531 ià(
»t
 =ğ
IEEE80211_AMPDU_TX_START_DELAY_ADDBA
) {

533 } ià(
»t
 =ğ
IEEE80211_AMPDU_TX_START_IMMEDIATE
) {

539 
	`£t_b™
(
HT_AGG_STATE_DRV_READY
, &
tid_tx
->
¡©e
);

540 } ià(
»t
) {

541 
	`ht_dbg
(
sd©a
,

543 
¡a
->¡a.
addr
, 
tid
);

544 
	`¥š_lock_bh
(&
¡a
->
lock
);

545 
	`›“80211_agg_¥liû_·ck‘s
(
sd©a
, 
tid_tx
, 
tid
);

546 
	`›“80211_assign_tid_tx
(
¡a
, 
tid
, 
NULL
);

547 
	`›“80211_agg_¥liû_fšish
(
sd©a
, 
tid
);

548 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

550 
	`›“80211_agg_¡¬t_txq
(
¡a
, 
tid
, 
çl£
);

552 
	`kä“_rcu
(
tid_tx
, 
rcu_h—d
);

556 
	`›“80211_£nd_addba_w™h_timeout
(
¡a
, 
tid_tx
);

557 
	}
}

559 
	$›“80211_»äesh_tx_agg_£ssiÚ_tim”
(
›“80211_¡a
 *
pub¡a
,

560 
u16
 
tid
)

562 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

563 
tid_ampdu_tx
 *
tid_tx
;

565 ià(
	`WARN_ON_ONCE
(
tid
 >ğ
IEEE80211_NUM_TIDS
))

568 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

569 ià(!
tid_tx
)

572 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

573 
	}
}

574 
EXPORT_SYMBOL
(
›“80211_»äesh_tx_agg_£ssiÚ_tim”
);

580 
	$¡a_tx_agg_£ssiÚ_tim”_expœed
(
tim”_li¡
 *
t
)

582 
tid_ampdu_tx
 *
tid_tx
 = 
	`äom_tim”
Ñid_tx, 
t
, 
£ssiÚ_tim”
);

583 
¡a_šfo
 *
¡a
 = 
tid_tx
->sta;

584 
u8
 
tid
 = 
tid_tx
->tid;

585 
timeout
;

587 ià(
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
)) {

591 
timeout
 = 
tid_tx
->
Ï¡_tx
 + 
	`TU_TO_JIFFIES
(tid_tx->timeout);

592 ià(
	`time_is_aá”_jiff›s
(
timeout
)) {

593 
	`mod_tim”
(&
tid_tx
->
£ssiÚ_tim”
, 
timeout
);

597 
	`ht_dbg
(
¡a
->
sd©a
, "tx sessionimerƒxpired on %pMid %d\n",

598 
¡a
->¡a.
addr
, 
tid
);

600 
	`›“80211_¡İ_tx_ba_£ssiÚ
(&
¡a
->¡a, 
tid
);

601 
	}
}

603 
	$›“80211_¡¬t_tx_ba_£ssiÚ
(
›“80211_¡a
 *
pub¡a
, 
u16
 
tid
,

604 
u16
 
timeout
)

606 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

607 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

608 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

609 
tid_ampdu_tx
 *
tid_tx
;

610 
»t
 = 0;

612 
	`Œaû_­i_¡¬t_tx_ba_£ssiÚ
(
pub¡a
, 
tid
);

614 ià(
	`WARN
(
¡a
->
»£rved_tid
 =ğ
tid
,

615 "Reque¡edØ¡¬ˆBA sessiÚ oÀ»£rvedid=%d", 
tid
))

616  -
EINVAL
;

618 ià(!
pub¡a
->
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
 &&

619 
¡a
->
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
->
bªd
 !ğ
NL80211_BAND_6GHZ
)

620  -
EINVAL
;

622 ià(
	`WARN_ON_ONCE
(!
loÿl
->
İs
->
ampdu_aùiÚ
))

623  -
EINVAL
;

625 ià((
tid
 >ğ
IEEE80211_NUM_TIDS
) ||

626 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_AGGREGATION
) ||

627 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TX_AMPDU_SETUP_IN_HW
))

628  -
EINVAL
;

630 ià(
	`WARN_ON
(
tid
 >ğ
IEEE80211_FIRST_TSPEC_TSID
))

631  -
EINVAL
;

633 
	`ht_dbg
(
sd©a
, "Open BA session„equested for %pMid %u\n",

634 
pub¡a
->
addr
, 
tid
);

636 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 &&

637 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
 &&

638 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

639 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

640 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

641  -
EINVAL
;

643 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
)) {

644 
	`ht_dbg
(
sd©a
,

646 
¡a
->¡a.
addr
, 
tid
);

647  -
EINVAL
;

650 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_MFP
) &&

651 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
)) {

652 
	`ht_dbg
(
sd©a
,

654 
¡a
->¡a.
addr
, 
tid
);

655  -
EINVAL
;

670 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
 &&

671 !
¡a
->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
) {

672 
	`ht_dbg
(
sd©a
,

674 
pub¡a
->
addr
);

675  -
EINVAL
;

678 
	`¥š_lock_bh
(&
¡a
->
lock
);

681 ià(
¡a
->
ampdu_mlme
.
addba_»q_num
[
tid
] > 
HT_AGG_MAX_RETRIES
) {

682 
»t
 = -
EBUSY
;

683 
”r_uÆock_¡a
;

691 ià(
¡a
->
ampdu_mlme
.
addba_»q_num
[
tid
] > 
HT_AGG_BURST_RETRIES
 &&

692 
	`time_befÜe
(
jiff›s
, 
¡a
->
ampdu_mlme
.
Ï¡_addba_»q_time
[
tid
] +

693 
HT_AGG_RETRIES_PERIOD
)) {

694 
	`ht_dbg
(
sd©a
,

696 
¡a
->
ampdu_mlme
.
addba_»q_num
[
tid
], s->¡a.
addr
,id);

697 
»t
 = -
EBUSY
;

698 
”r_uÆock_¡a
;

701 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

703 ià(
tid_tx
 || 
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
tid
]) {

704 
	`ht_dbg
(
sd©a
,

706 
¡a
->¡a.
addr
, 
tid
);

707 
»t
 = -
EAGAIN
;

708 
”r_uÆock_¡a
;

712 
tid_tx
 = 
	`kz®loc
((
tid_ampdu_tx
), 
GFP_ATOMIC
);

713 ià(!
tid_tx
) {

714 
»t
 = -
ENOMEM
;

715 
”r_uÆock_¡a
;

718 
	`skb_queue_h—d_š™
(&
tid_tx
->
³ndšg
);

719 
	`__£t_b™
(
HT_AGG_STATE_WANT_START
, &
tid_tx
->
¡©e
);

721 
tid_tx
->
timeout
 =imeout;

722 
tid_tx
->
¡a
 = sta;

723 
tid_tx
->
tid
 =id;

726 
	`tim”_£tup
(&
tid_tx
->
addba_»¥_tim”
, 
¡a_addba_»¥_tim”_expœed
, 0);

729 
	`tim”_£tup
(&
tid_tx
->
£ssiÚ_tim”
,

730 
¡a_tx_agg_£ssiÚ_tim”_expœed
, 
TIMER_DEFERRABLE
);

733 
¡a
->
ampdu_mlme
.
dŸlog_tok’_®loÿtÜ
++;

734 
tid_tx
->
dŸlog_tok’
 = 
¡a
->
ampdu_mlme
.
dŸlog_tok’_®loÿtÜ
;

740 
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
tid
] = 
tid_tx
;

742 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
¡a
->
ampdu_mlme
.
wÜk
);

745 
”r_uÆock_¡a
:

746 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

747  
»t
;

748 
	}
}

749 
EXPORT_SYMBOL
(
›“80211_¡¬t_tx_ba_£ssiÚ
);

751 
	$›“80211_agg_tx_İ”©iÚ®
(
›“80211_loÿl
 *
loÿl
,

752 
¡a_šfo
 *
¡a
, 
u16
 
tid
)

754 
tid_ampdu_tx
 *
tid_tx
;

755 
›“80211_ampdu_·¿ms
 
·¿ms
 = {

756 .
¡a
 = &sta->sta,

757 .
aùiÚ
 = 
IEEE80211_AMPDU_TX_OPERATIONAL
,

758 .
tid
 =id,

759 .
timeout
 = 0,

760 .
s¢
 = 0,

763 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

765 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

766 
·¿ms
.
buf_size
 = 
tid_tx
->buf_size;

767 
·¿ms
.
amsdu
 = 
tid_tx
->amsdu;

769 
	`ht_dbg
(
¡a
->
sd©a
, "Aggregation is on for %pMid %d\n",

770 
¡a
->¡a.
addr
, 
tid
);

772 
	`drv_ampdu_aùiÚ
(
loÿl
, 
¡a
->
sd©a
, &
·¿ms
);

778 
	`¥š_lock_bh
(&
¡a
->
lock
);

780 
	`›“80211_agg_¥liû_·ck‘s
(
¡a
->
sd©a
, 
tid_tx
, 
tid
);

786 
	`£t_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
);

787 
	`›“80211_agg_¥liû_fšish
(
¡a
->
sd©a
, 
tid
);

789 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

791 
	`›“80211_agg_¡¬t_txq
(
¡a
, 
tid
, 
Œue
);

792 
	}
}

794 
	$›“80211_¡¬t_tx_ba_cb
(
¡a_šfo
 *
¡a
, 
tid
,

795 
tid_ampdu_tx
 *
tid_tx
)

797 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

798 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

800 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

802 ià(
	`WARN_ON
(
	`‹¡_ªd_£t_b™
(
HT_AGG_STATE_DRV_READY
, &
tid_tx
->
¡©e
)))

805 ià(
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
) ||

806 
	`‹¡_b™
(
HT_AGG_STATE_WANT_STOP
, &
tid_tx
->
¡©e
))

809 ià(!
	`‹¡_b™
(
HT_AGG_STATE_SENT_ADDBA
, &
tid_tx
->
¡©e
)) {

810 
	`›“80211_£nd_addba_w™h_timeout
(
¡a
, 
tid_tx
);

815 ià(
	`‹¡_b™
(
HT_AGG_STATE_RESPONSE_RECEIVED
, &
tid_tx
->
¡©e
))

816 
	`›“80211_agg_tx_İ”©iÚ®
(
loÿl
, 
¡a
, 
tid
);

817 
	}
}

819 
tid_ampdu_tx
 *

820 
	$›“80211_lookup_tid_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

821 cÚ¡ 
u8
 *
¿
, 
u16
 
tid
, 
¡a_šfo
 **
¡a
)

823 
tid_ampdu_tx
 *
tid_tx
;

825 ià(
tid
 >ğ
IEEE80211_NUM_TIDS
) {

826 
	`ht_dbg
(
sd©a
, "Bad TID value:id = %d (>= %d)\n",

827 
tid
, 
IEEE80211_NUM_TIDS
);

828  
NULL
;

831 *
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
¿
);

832 ià(!*
¡a
) {

833 
	`ht_dbg
(
sd©a
, "Could‚Ù fšd stiÚ: %pM\n", 
¿
);

834  
NULL
;

837 
tid_tx
 = 
	`rcu_d”eã»nû
((*
¡a
)->
ampdu_mlme
.tid_tx[
tid
]);

839 ià(
	`WARN_ON
(!
tid_tx
))

840 
	`ht_dbg
(
sd©a
, "addBA was‚ot„equested!\n");

842  
tid_tx
;

843 
	}
}

845 
	$›“80211_¡¬t_tx_ba_cb_œq§ã
(
›“80211_vif
 *
vif
,

846 cÚ¡ 
u8
 *
¿
, 
u16
 
tid
)

848 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

849 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

850 
¡a_šfo
 *
¡a
;

851 
tid_ampdu_tx
 *
tid_tx
;

853 
	`Œaû_­i_¡¬t_tx_ba_cb
(
sd©a
, 
¿
, 
tid
);

855 
	`rcu_»ad_lock
();

856 
tid_tx
 = 
	`›“80211_lookup_tid_tx
(
sd©a
, 
¿
, 
tid
, &
¡a
);

857 ià(!
tid_tx
)

858 
out
;

860 
	`£t_b™
(
HT_AGG_STATE_START_CB
, &
tid_tx
->
¡©e
);

861 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
¡a
->
ampdu_mlme
.
wÜk
);

862 
out
:

863 
	`rcu_»ad_uÆock
();

864 
	}
}

865 
EXPORT_SYMBOL
(
›“80211_¡¬t_tx_ba_cb_œq§ã
);

867 
	$›“80211_¡İ_tx_ba_£ssiÚ
(
›“80211_¡a
 *
pub¡a
, 
u16
 
tid
)

869 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

870 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

871 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

872 
tid_ampdu_tx
 *
tid_tx
;

873 
»t
 = 0;

875 
	`Œaû_­i_¡İ_tx_ba_£ssiÚ
(
pub¡a
, 
tid
);

877 ià(!
loÿl
->
İs
->
ampdu_aùiÚ
)

878  -
EINVAL
;

880 ià(
tid
 >ğ
IEEE80211_NUM_TIDS
)

881  -
EINVAL
;

883 
	`¥š_lock_bh
(&
¡a
->
lock
);

884 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

886 ià(!
tid_tx
) {

887 
»t
 = -
ENOENT
;

888 
uÆock
;

891 
	`WARN
(
¡a
->
»£rved_tid
 =ğ
tid
,

892 "Reque¡edØ¡İ BA sessiÚ oÀ»£rvedid=%d", 
tid
);

894 ià(
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
)) {

896 
»t
 = 0;

897 
uÆock
;

900 
	`£t_b™
(
HT_AGG_STATE_WANT_STOP
, &
tid_tx
->
¡©e
);

901 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
¡a
->
ampdu_mlme
.
wÜk
);

903 
uÆock
:

904 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

905  
»t
;

906 
	}
}

907 
EXPORT_SYMBOL
(
›“80211_¡İ_tx_ba_£ssiÚ
);

909 
	$›“80211_¡İ_tx_ba_cb
(
¡a_šfo
 *
¡a
, 
tid
,

910 
tid_ampdu_tx
 *
tid_tx
)

912 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

913 
boŞ
 
£nd_d–ba
 = 
çl£
;

914 
boŞ
 
¡¬t_txq
 = 
çl£
;

916 
	`ht_dbg
(
sd©a
, "Stopping Tx BA session for %pMid %d\n",

917 
¡a
->¡a.
addr
, 
tid
);

919 
	`¥š_lock_bh
(&
¡a
->
lock
);

921 ià(!
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
)) {

922 
	`ht_dbg
(
sd©a
,

924 
¡a
->¡a.
addr
, 
tid
);

925 
uÆock_¡a
;

928 ià(
tid_tx
->
¡İ_š™ŸtÜ
 =ğ
WLAN_BACK_INITIATOR
 &&id_tx->
tx_¡İ
)

929 
£nd_d–ba
 = 
Œue
;

931 
	`›“80211_»move_tid_tx
(
¡a
, 
tid
);

932 
¡¬t_txq
 = 
Œue
;

934 
uÆock_¡a
:

935 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

937 ià(
¡¬t_txq
)

938 
	`›“80211_agg_¡¬t_txq
(
¡a
, 
tid
, 
çl£
);

940 ià(
£nd_d–ba
)

941 
	`›“80211_£nd_d–ba
(
sd©a
, 
¡a
->¡a.
addr
, 
tid
,

942 
WLAN_BACK_INITIATOR
, 
WLAN_REASON_QSTA_NOT_USE
);

943 
	}
}

945 
	$›“80211_¡İ_tx_ba_cb_œq§ã
(
›“80211_vif
 *
vif
,

946 cÚ¡ 
u8
 *
¿
, 
u16
 
tid
)

948 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

949 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

950 
¡a_šfo
 *
¡a
;

951 
tid_ampdu_tx
 *
tid_tx
;

953 
	`Œaû_­i_¡İ_tx_ba_cb
(
sd©a
, 
¿
, 
tid
);

955 
	`rcu_»ad_lock
();

956 
tid_tx
 = 
	`›“80211_lookup_tid_tx
(
sd©a
, 
¿
, 
tid
, &
¡a
);

957 ià(!
tid_tx
)

958 
out
;

960 
	`£t_b™
(
HT_AGG_STATE_STOP_CB
, &
tid_tx
->
¡©e
);

961 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
¡a
->
ampdu_mlme
.
wÜk
);

962 
out
:

963 
	`rcu_»ad_uÆock
();

964 
	}
}

965 
EXPORT_SYMBOL
(
›“80211_¡İ_tx_ba_cb_œq§ã
);

968 
	$›“80211_´oûss_addba_»¥
(
›“80211_loÿl
 *
loÿl
,

969 
¡a_šfo
 *
¡a
,

970 
›“80211_mgmt
 *
mgmt
,

971 
size_t
 
Ën
)

973 
tid_ampdu_tx
 *
tid_tx
;

974 
›“80211_txq
 *
txq
;

975 
u16
 
ÿ·b
, 
tid
, 
buf_size
;

976 
boŞ
 
amsdu
;

978 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

980 
ÿ·b
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.capab);

981 
amsdu
 = 
ÿ·b
 & 
IEEE80211_ADDBA_PARAM_AMSDU_MASK
;

982 
tid
 = 
	`u16_g‘_b™s
(
ÿ·b
, 
IEEE80211_ADDBA_PARAM_TID_MASK
);

983 
buf_size
 = 
	`u16_g‘_b™s
(
ÿ·b
, 
IEEE80211_ADDBA_PARAM_BUF_SIZE_MASK
);

984 
buf_size
 = 
	`mš
(buf_size, 
loÿl
->
hw
.
max_tx_agg»g©iÚ_subäames
);

986 
txq
 = 
¡a
->¡a.txq[
tid
];

987 ià(!
amsdu
 && 
txq
)

988 
	`£t_b™
(
IEEE80211_TXQ_NO_AMSDU
, &
	`to_txq_šfo
(
txq
)->
æags
);

990 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

991 ià(!
tid_tx
)

994 ià(
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
dŸlog_tok’
 !ğ
tid_tx
->dialog_token) {

995 
	`ht_dbg
(
¡a
->
sd©a
, "wrong‡ddBA„esponseoken, %pMid %d\n",

996 
¡a
->¡a.
addr
, 
tid
);

1000 
	`d–_tim”_sync
(&
tid_tx
->
addba_»¥_tim”
);

1002 
	`ht_dbg
(
¡a
->
sd©a
, "switched off‡ddBAimer for %pMid %d\n",

1003 
¡a
->¡a.
addr
, 
tid
);

1010 ià(
	`‹¡_b™
(
HT_AGG_STATE_WANT_STOP
, &
tid_tx
->
¡©e
) ||

1011 
	`‹¡_b™
(
HT_AGG_STATE_STOPPING
, &
tid_tx
->
¡©e
)) {

1012 
	`ht_dbg
(
¡a
->
sd©a
,

1014 
¡a
->¡a.
addr
, 
tid
);

1024 ià(
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
¡©us
)

1025 =ğ
WLAN_STATUS_SUCCESS
 && 
buf_size
) {

1026 ià(
	`‹¡_ªd_£t_b™
(
HT_AGG_STATE_RESPONSE_RECEIVED
,

1027 &
tid_tx
->
¡©e
)) {

1032 
tid_tx
->
buf_size
 = buf_size;

1033 
tid_tx
->
amsdu
 =‡msdu;

1035 ià(
	`‹¡_b™
(
HT_AGG_STATE_DRV_READY
, &
tid_tx
->
¡©e
))

1036 
	`›“80211_agg_tx_İ”©iÚ®
(
loÿl
, 
¡a
, 
tid
);

1038 
¡a
->
ampdu_mlme
.
addba_»q_num
[
tid
] = 0;

1040 
tid_tx
->
timeout
 =

1041 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
.
timeout
);

1043 ià(
tid_tx
->
timeout
) {

1044 
	`mod_tim”
(&
tid_tx
->
£ssiÚ_tim”
,

1045 
	`TU_TO_EXP_TIME
(
tid_tx
->
timeout
));

1046 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

1050 
	`__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a
, 
tid
, 
AGG_STOP_DECLINED
);

1052 
	}
}

	@airtime.c

7 
	~<Ãt/mac80211.h
>

8 
	~"›“80211_i.h
"

9 
	~"¡a_šfo.h
"

11 
	#AVG_PKT_SIZE
 1024

	)

14 
	#MCS_NBITS
 (
AVG_PKT_SIZE
 << 3)

	)

19 
	#MCS_N_KSYMS
(
bps
è
	`DIV_ROUND_UP
(
MCS_NBITS
 << 10, (bps))

	)

24 
	#MCS_SYMBOL_TIME
(
sgi
, 
ksyms
) \

25 (
sgi
 ? \

26 ((
ksyms
) * 4 * 18) / 20 : \

27 ((
ksyms
) * 4) \

28 )

	)

31 
	#MCS_DURATION
(
¡»ams
, 
sgi
, 
bps
) \

32 ((
u32
)
	`MCS_SYMBOL_TIME
(
sgi
, 
	`MCS_N_KSYMS
((
¡»ams
è* (
bps
))))

	)

34 
	#MCS_DURATION_S
(
shiá
, 
¡»ams
, 
sgi
, 
bps
) \

35 ((
u16
)((
	`MCS_DURATION
(
¡»ams
, 
sgi
, 
bps
è>> 
shiá
)))

	)

38 
	#HE_GI_08
 0

	)

39 
	#HE_GI_16
 1

	)

40 
	#HE_GI_32
 2

	)

43 
	#HE_SYMBOL_TIME
(
gi
, 
ksyms
) \

44 (
gi
 =ğ
HE_GI_08
 ? \

45 ((
ksyms
) * 16 * 17) / 20 : \

46 (
gi
 =ğ
HE_GI_16
 ? \

47 ((
ksyms
) * 16 * 18) / 20 : \

48 ((
ksyms
) * 16) \

49 ))

	)

52 
	#HE_DURATION
(
¡»ams
, 
gi
, 
bps
) \

53 ((
u32
)
	`HE_SYMBOL_TIME
(
gi
, 
	`MCS_N_KSYMS
((
¡»ams
è* (
bps
))))

	)

55 
	#HE_DURATION_S
(
shiá
, 
¡»ams
, 
gi
, 
bps
) \

56 (
	`HE_DURATION
(
¡»ams
, 
gi
, 
bps
è>> 
shiá
)

	)

58 
	#BW_20
 0

	)

59 
	#BW_40
 1

	)

60 
	#BW_80
 2

	)

61 
	#BW_160
 3

	)

66 
	#IEEE80211_MAX_STREAMS
 4

	)

67 
	#IEEE80211_HT_STREAM_GROUPS
 4

	)

68 
	#IEEE80211_VHT_STREAM_GROUPS
 8

	)

70 
	#IEEE80211_HE_MAX_STREAMS
 8

	)

72 
	#IEEE80211_HT_GROUPS_NB
 (
IEEE80211_MAX_STREAMS
 * \

73 
IEEE80211_HT_STREAM_GROUPS
)

	)

74 
	#IEEE80211_VHT_GROUPS_NB
 (
IEEE80211_MAX_STREAMS
 * \

75 
IEEE80211_VHT_STREAM_GROUPS
)

	)

77 
	#IEEE80211_HT_GROUP_0
 0

	)

78 
	#IEEE80211_VHT_GROUP_0
 (
IEEE80211_HT_GROUP_0
 + 
IEEE80211_HT_GROUPS_NB
)

	)

79 
	#IEEE80211_HE_GROUP_0
 (
IEEE80211_VHT_GROUP_0
 + 
IEEE80211_VHT_GROUPS_NB
)

	)

81 
	#MCS_GROUP_RATES
 12

	)

83 
	#HT_GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_ht40
) \

84 
IEEE80211_HT_GROUP_0
 + \

85 
IEEE80211_MAX_STREAMS
 * 2 * 
_ht40
 + \

86 
IEEE80211_MAX_STREAMS
 * 
_sgi
 + \

87 
_¡»ams
 - 1

	)

89 
	#_MAX
(
a
, 
b
è((×)>(b))?×):(b))

	)

91 
	#GROUP_SHIFT
(
du¿tiÚ
) \

92 
	`_MAX
(0, 16 - 
	`__butš_şz
(
du¿tiÚ
))

	)

95 
	#__MCS_GROUP
(
_¡»ams
, 
_sgi
, 
_ht40
, 
_s
) \

96 [
	`HT_GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_ht40
)] = { \

97 .
shiá
 = 
_s
, \

98 .
du¿tiÚ
 = { \

99 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 54 : 26), \

100 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 108 : 52), \

101 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 162 : 78), \

102 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 216 : 104), \

103 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 324 : 156), \

104 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 432 : 208), \

105 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 486 : 234), \

106 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, 
_ht40
 ? 540 : 260) \

108 }

	)

110 
	#MCS_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_ht40
) \

111 
	`GROUP_SHIFT
(
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 54 : 26))

	)

113 
	#MCS_GROUP
(
_¡»ams
, 
_sgi
, 
_ht40
) \

114 
	`__MCS_GROUP
(
_¡»ams
, 
_sgi
, 
_ht40
, \

115 
	`MCS_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_ht40
))

	)

117 
	#VHT_GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_bw
) \

118 (
IEEE80211_VHT_GROUP_0
 + \

119 
IEEE80211_MAX_STREAMS
 * 2 * (
_bw
) + \

120 
IEEE80211_MAX_STREAMS
 * (
_sgi
) + \

121 (
_¡»ams
è- 1)

	)

123 
	#BW2VBPS
(
_bw
, 
r4
, 
r3
, 
r2
, 
r1
) \

124 (
_bw
 =ğ
BW_160
 ? 
r4
 : _bw =ğ
BW_80
 ? 
r3
 : _bw =ğ
BW_40
 ? 
r2
 : 
r1
)

	)

126 
	#__VHT_GROUP
(
_¡»ams
, 
_sgi
, 
_bw
, 
_s
) \

127 [
	`VHT_GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_bw
)] = { \

128 .
shiá
 = 
_s
, \

129 .
du¿tiÚ
 = { \

130 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

131 
	`BW2VBPS
(
_bw
, 234, 117, 54, 26)), \

132 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

133 
	`BW2VBPS
(
_bw
, 468, 234, 108, 52)), \

134 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

135 
	`BW2VBPS
(
_bw
, 702, 351, 162, 78)), \

136 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

137 
	`BW2VBPS
(
_bw
, 936, 468, 216, 104)), \

138 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

139 
	`BW2VBPS
(
_bw
, 1404, 702, 324, 156)), \

140 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

141 
	`BW2VBPS
(
_bw
, 1872, 936, 432, 208)), \

142 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

143 
	`BW2VBPS
(
_bw
, 2106, 1053, 486, 234)), \

144 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

145 
	`BW2VBPS
(
_bw
, 2340, 1170, 540, 260)), \

146 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

147 
	`BW2VBPS
(
_bw
, 2808, 1404, 648, 312)), \

148 
	`MCS_DURATION_S
(
_s
, 
_¡»ams
, 
_sgi
, \

149 
	`BW2VBPS
(
_bw
, 3120, 1560, 720, 346)) \

151 }

	)

153 
	#VHT_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_bw
) \

154 
	`GROUP_SHIFT
(
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

155 
	`BW2VBPS
(
_bw
, 243, 117, 54, 26)))

	)

157 
	#VHT_GROUP
(
_¡»ams
, 
_sgi
, 
_bw
) \

158 
	`__VHT_GROUP
(
_¡»ams
, 
_sgi
, 
_bw
, \

159 
	`VHT_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_bw
))

	)

162 
	#HE_GROUP_IDX
(
_¡»ams
, 
_gi
, 
_bw
) \

163 (
IEEE80211_HE_GROUP_0
 + \

164 
IEEE80211_HE_MAX_STREAMS
 * 3 * (
_bw
) + \

165 
IEEE80211_HE_MAX_STREAMS
 * (
_gi
) + \

166 (
_¡»ams
è- 1)

	)

168 
	#__HE_GROUP
(
_¡»ams
, 
_gi
, 
_bw
, 
_s
) \

169 [
	`HE_GROUP_IDX
(
_¡»ams
, 
_gi
, 
_bw
)] = { \

170 .
shiá
 = 
_s
, \

171 .
du¿tiÚ
 = { \

172 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

173 
	`BW2VBPS
(
_bw
, 979, 489, 230, 115)), \

174 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

175 
	`BW2VBPS
(
_bw
, 1958, 979, 475, 230)), \

176 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

177 
	`BW2VBPS
(
_bw
, 2937, 1468, 705, 345)), \

178 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

179 
	`BW2VBPS
(
_bw
, 3916, 1958, 936, 475)), \

180 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

181 
	`BW2VBPS
(
_bw
, 5875, 2937, 1411, 705)), \

182 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

183 
	`BW2VBPS
(
_bw
, 7833, 3916, 1872, 936)), \

184 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

185 
	`BW2VBPS
(
_bw
, 8827, 4406, 2102, 1051)), \

186 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

187 
	`BW2VBPS
(
_bw
, 9806, 4896, 2347, 1166)), \

188 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

189 
	`BW2VBPS
(
_bw
, 11764, 5875, 2808, 1411)), \

190 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

191 
	`BW2VBPS
(
_bw
, 13060, 6523, 3124, 1555)), \

192 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

193 
	`BW2VBPS
(
_bw
, 14702, 7344, 3513, 1756)), \

194 
	`HE_DURATION_S
(
_s
, 
_¡»ams
, 
_gi
, \

195 
	`BW2VBPS
(
_bw
, 16329, 8164, 3902, 1944)) \

197 }

	)

199 
	#HE_GROUP_SHIFT
(
_¡»ams
, 
_gi
, 
_bw
) \

200 
	`GROUP_SHIFT
(
	`HE_DURATION
(
_¡»ams
, 
_gi
, \

201 
	`BW2VBPS
(
_bw
, 979, 489, 230, 115)))

	)

203 
	#HE_GROUP
(
_¡»ams
, 
_gi
, 
_bw
) \

204 
	`__HE_GROUP
(
_¡»ams
, 
_gi
, 
_bw
, \

205 
	`HE_GROUP_SHIFT
(
_¡»ams
, 
_gi
, 
_bw
))

	)

206 
	smcs_group
 {

207 
u8
 
	mshiá
;

208 
u16
 
	mdu¿tiÚ
[
MCS_GROUP_RATES
];

211 cÚ¡ 
mcs_group
 
	gaœtime_mcs_groups
[] = {

212 
MCS_GROUP
(1, 0, 
BW_20
),

213 
MCS_GROUP
(2, 0, 
BW_20
),

214 
MCS_GROUP
(3, 0, 
BW_20
),

215 
MCS_GROUP
(4, 0, 
BW_20
),

217 
MCS_GROUP
(1, 1, 
BW_20
),

218 
MCS_GROUP
(2, 1, 
BW_20
),

219 
MCS_GROUP
(3, 1, 
BW_20
),

220 
MCS_GROUP
(4, 1, 
BW_20
),

222 
MCS_GROUP
(1, 0, 
BW_40
),

223 
MCS_GROUP
(2, 0, 
BW_40
),

224 
MCS_GROUP
(3, 0, 
BW_40
),

225 
MCS_GROUP
(4, 0, 
BW_40
),

227 
MCS_GROUP
(1, 1, 
BW_40
),

228 
MCS_GROUP
(2, 1, 
BW_40
),

229 
MCS_GROUP
(3, 1, 
BW_40
),

230 
MCS_GROUP
(4, 1, 
BW_40
),

232 
VHT_GROUP
(1, 0, 
BW_20
),

233 
VHT_GROUP
(2, 0, 
BW_20
),

234 
VHT_GROUP
(3, 0, 
BW_20
),

235 
VHT_GROUP
(4, 0, 
BW_20
),

237 
VHT_GROUP
(1, 1, 
BW_20
),

238 
VHT_GROUP
(2, 1, 
BW_20
),

239 
VHT_GROUP
(3, 1, 
BW_20
),

240 
VHT_GROUP
(4, 1, 
BW_20
),

242 
VHT_GROUP
(1, 0, 
BW_40
),

243 
VHT_GROUP
(2, 0, 
BW_40
),

244 
VHT_GROUP
(3, 0, 
BW_40
),

245 
VHT_GROUP
(4, 0, 
BW_40
),

247 
VHT_GROUP
(1, 1, 
BW_40
),

248 
VHT_GROUP
(2, 1, 
BW_40
),

249 
VHT_GROUP
(3, 1, 
BW_40
),

250 
VHT_GROUP
(4, 1, 
BW_40
),

252 
VHT_GROUP
(1, 0, 
BW_80
),

253 
VHT_GROUP
(2, 0, 
BW_80
),

254 
VHT_GROUP
(3, 0, 
BW_80
),

255 
VHT_GROUP
(4, 0, 
BW_80
),

257 
VHT_GROUP
(1, 1, 
BW_80
),

258 
VHT_GROUP
(2, 1, 
BW_80
),

259 
VHT_GROUP
(3, 1, 
BW_80
),

260 
VHT_GROUP
(4, 1, 
BW_80
),

262 
VHT_GROUP
(1, 0, 
BW_160
),

263 
VHT_GROUP
(2, 0, 
BW_160
),

264 
VHT_GROUP
(3, 0, 
BW_160
),

265 
VHT_GROUP
(4, 0, 
BW_160
),

267 
VHT_GROUP
(1, 1, 
BW_160
),

268 
VHT_GROUP
(2, 1, 
BW_160
),

269 
VHT_GROUP
(3, 1, 
BW_160
),

270 
VHT_GROUP
(4, 1, 
BW_160
),

272 
HE_GROUP
(1, 
HE_GI_08
, 
BW_20
),

273 
HE_GROUP
(2, 
HE_GI_08
, 
BW_20
),

274 
HE_GROUP
(3, 
HE_GI_08
, 
BW_20
),

275 
HE_GROUP
(4, 
HE_GI_08
, 
BW_20
),

276 
HE_GROUP
(5, 
HE_GI_08
, 
BW_20
),

277 
HE_GROUP
(6, 
HE_GI_08
, 
BW_20
),

278 
HE_GROUP
(7, 
HE_GI_08
, 
BW_20
),

279 
HE_GROUP
(8, 
HE_GI_08
, 
BW_20
),

281 
HE_GROUP
(1, 
HE_GI_16
, 
BW_20
),

282 
HE_GROUP
(2, 
HE_GI_16
, 
BW_20
),

283 
HE_GROUP
(3, 
HE_GI_16
, 
BW_20
),

284 
HE_GROUP
(4, 
HE_GI_16
, 
BW_20
),

285 
HE_GROUP
(5, 
HE_GI_16
, 
BW_20
),

286 
HE_GROUP
(6, 
HE_GI_16
, 
BW_20
),

287 
HE_GROUP
(7, 
HE_GI_16
, 
BW_20
),

288 
HE_GROUP
(8, 
HE_GI_16
, 
BW_20
),

290 
HE_GROUP
(1, 
HE_GI_32
, 
BW_20
),

291 
HE_GROUP
(2, 
HE_GI_32
, 
BW_20
),

292 
HE_GROUP
(3, 
HE_GI_32
, 
BW_20
),

293 
HE_GROUP
(4, 
HE_GI_32
, 
BW_20
),

294 
HE_GROUP
(5, 
HE_GI_32
, 
BW_20
),

295 
HE_GROUP
(6, 
HE_GI_32
, 
BW_20
),

296 
HE_GROUP
(7, 
HE_GI_32
, 
BW_20
),

297 
HE_GROUP
(8, 
HE_GI_32
, 
BW_20
),

299 
HE_GROUP
(1, 
HE_GI_08
, 
BW_40
),

300 
HE_GROUP
(2, 
HE_GI_08
, 
BW_40
),

301 
HE_GROUP
(3, 
HE_GI_08
, 
BW_40
),

302 
HE_GROUP
(4, 
HE_GI_08
, 
BW_40
),

303 
HE_GROUP
(5, 
HE_GI_08
, 
BW_40
),

304 
HE_GROUP
(6, 
HE_GI_08
, 
BW_40
),

305 
HE_GROUP
(7, 
HE_GI_08
, 
BW_40
),

306 
HE_GROUP
(8, 
HE_GI_08
, 
BW_40
),

308 
HE_GROUP
(1, 
HE_GI_16
, 
BW_40
),

309 
HE_GROUP
(2, 
HE_GI_16
, 
BW_40
),

310 
HE_GROUP
(3, 
HE_GI_16
, 
BW_40
),

311 
HE_GROUP
(4, 
HE_GI_16
, 
BW_40
),

312 
HE_GROUP
(5, 
HE_GI_16
, 
BW_40
),

313 
HE_GROUP
(6, 
HE_GI_16
, 
BW_40
),

314 
HE_GROUP
(7, 
HE_GI_16
, 
BW_40
),

315 
HE_GROUP
(8, 
HE_GI_16
, 
BW_40
),

317 
HE_GROUP
(1, 
HE_GI_32
, 
BW_40
),

318 
HE_GROUP
(2, 
HE_GI_32
, 
BW_40
),

319 
HE_GROUP
(3, 
HE_GI_32
, 
BW_40
),

320 
HE_GROUP
(4, 
HE_GI_32
, 
BW_40
),

321 
HE_GROUP
(5, 
HE_GI_32
, 
BW_40
),

322 
HE_GROUP
(6, 
HE_GI_32
, 
BW_40
),

323 
HE_GROUP
(7, 
HE_GI_32
, 
BW_40
),

324 
HE_GROUP
(8, 
HE_GI_32
, 
BW_40
),

326 
HE_GROUP
(1, 
HE_GI_08
, 
BW_80
),

327 
HE_GROUP
(2, 
HE_GI_08
, 
BW_80
),

328 
HE_GROUP
(3, 
HE_GI_08
, 
BW_80
),

329 
HE_GROUP
(4, 
HE_GI_08
, 
BW_80
),

330 
HE_GROUP
(5, 
HE_GI_08
, 
BW_80
),

331 
HE_GROUP
(6, 
HE_GI_08
, 
BW_80
),

332 
HE_GROUP
(7, 
HE_GI_08
, 
BW_80
),

333 
HE_GROUP
(8, 
HE_GI_08
, 
BW_80
),

335 
HE_GROUP
(1, 
HE_GI_16
, 
BW_80
),

336 
HE_GROUP
(2, 
HE_GI_16
, 
BW_80
),

337 
HE_GROUP
(3, 
HE_GI_16
, 
BW_80
),

338 
HE_GROUP
(4, 
HE_GI_16
, 
BW_80
),

339 
HE_GROUP
(5, 
HE_GI_16
, 
BW_80
),

340 
HE_GROUP
(6, 
HE_GI_16
, 
BW_80
),

341 
HE_GROUP
(7, 
HE_GI_16
, 
BW_80
),

342 
HE_GROUP
(8, 
HE_GI_16
, 
BW_80
),

344 
HE_GROUP
(1, 
HE_GI_32
, 
BW_80
),

345 
HE_GROUP
(2, 
HE_GI_32
, 
BW_80
),

346 
HE_GROUP
(3, 
HE_GI_32
, 
BW_80
),

347 
HE_GROUP
(4, 
HE_GI_32
, 
BW_80
),

348 
HE_GROUP
(5, 
HE_GI_32
, 
BW_80
),

349 
HE_GROUP
(6, 
HE_GI_32
, 
BW_80
),

350 
HE_GROUP
(7, 
HE_GI_32
, 
BW_80
),

351 
HE_GROUP
(8, 
HE_GI_32
, 
BW_80
),

353 
HE_GROUP
(1, 
HE_GI_08
, 
BW_160
),

354 
HE_GROUP
(2, 
HE_GI_08
, 
BW_160
),

355 
HE_GROUP
(3, 
HE_GI_08
, 
BW_160
),

356 
HE_GROUP
(4, 
HE_GI_08
, 
BW_160
),

357 
HE_GROUP
(5, 
HE_GI_08
, 
BW_160
),

358 
HE_GROUP
(6, 
HE_GI_08
, 
BW_160
),

359 
HE_GROUP
(7, 
HE_GI_08
, 
BW_160
),

360 
HE_GROUP
(8, 
HE_GI_08
, 
BW_160
),

362 
HE_GROUP
(1, 
HE_GI_16
, 
BW_160
),

363 
HE_GROUP
(2, 
HE_GI_16
, 
BW_160
),

364 
HE_GROUP
(3, 
HE_GI_16
, 
BW_160
),

365 
HE_GROUP
(4, 
HE_GI_16
, 
BW_160
),

366 
HE_GROUP
(5, 
HE_GI_16
, 
BW_160
),

367 
HE_GROUP
(6, 
HE_GI_16
, 
BW_160
),

368 
HE_GROUP
(7, 
HE_GI_16
, 
BW_160
),

369 
HE_GROUP
(8, 
HE_GI_16
, 
BW_160
),

371 
HE_GROUP
(1, 
HE_GI_32
, 
BW_160
),

372 
HE_GROUP
(2, 
HE_GI_32
, 
BW_160
),

373 
HE_GROUP
(3, 
HE_GI_32
, 
BW_160
),

374 
HE_GROUP
(4, 
HE_GI_32
, 
BW_160
),

375 
HE_GROUP
(5, 
HE_GI_32
, 
BW_160
),

376 
HE_GROUP
(6, 
HE_GI_32
, 
BW_160
),

377 
HE_GROUP
(7, 
HE_GI_32
, 
BW_160
),

378 
HE_GROUP
(8, 
HE_GI_32
, 
BW_160
),

381 
u32


382 
	$›“80211_ÿlc_Ëgacy_¿‹_du¿tiÚ
(
u16
 
b™¿‹
, 
boŞ
 
shÜt_´e
,

383 
boŞ
 
cck
, 
Ën
)

385 
u32
 
du¿tiÚ
;

387 ià(
cck
) {

388 
du¿tiÚ
 = 144 + 48;

389 ià(
shÜt_´e
)

390 
du¿tiÚ
 >>= 1;

392 
du¿tiÚ
 += 10;

394 
du¿tiÚ
 = 20 + 16;

397 
Ën
 <<= 3;

398 
du¿tiÚ
 +ğ(
Ën
 * 10è/ 
b™¿‹
;

400  
du¿tiÚ
;

401 
	}
}

403 
u32
 
	$›“80211_g‘_¿‹_du¿tiÚ
(
›“80211_hw
 *
hw
,

404 
›“80211_rx_¡©us
 *
¡©us
,

405 
u32
 *
ov”h—d
)

407 
boŞ
 
sgi
 = 
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
;

408 
bw
, 
¡»ams
;

409 
group
, 
idx
;

410 
u32
 
du¿tiÚ
;

412 
¡©us
->
bw
) {

413 
RATE_INFO_BW_20
:

414 
bw
 = 
BW_20
;

416 
RATE_INFO_BW_40
:

417 
bw
 = 
BW_40
;

419 
RATE_INFO_BW_80
:

420 
bw
 = 
BW_80
;

422 
RATE_INFO_BW_160
:

423 
bw
 = 
BW_160
;

426 
	`WARN_ON_ONCE
(1);

430 
¡©us
->
’codšg
) {

431 
RX_ENC_VHT
:

432 
¡»ams
 = 
¡©us
->
nss
;

433 
idx
 = 
¡©us
->
¿‹_idx
;

434 
group
 = 
	`VHT_GROUP_IDX
(
¡»ams
, 
sgi
, 
bw
);

436 
RX_ENC_HT
:

437 
¡»ams
 = ((
¡©us
->
¿‹_idx
 >> 3) & 3) + 1;

438 
idx
 = 
¡©us
->
¿‹_idx
 & 7;

439 
group
 = 
	`HT_GROUP_IDX
(
¡»ams
, 
sgi
, 
bw
);

441 
RX_ENC_HE
:

442 
¡»ams
 = 
¡©us
->
nss
;

443 
idx
 = 
¡©us
->
¿‹_idx
;

444 
group
 = 
	`HE_GROUP_IDX
(
¡»ams
, 
¡©us
->
he_gi
, 
bw
);

447 
	`WARN_ON_ONCE
(1);

451 ià(
	`WARN_ON_ONCE
((
¡©us
->
’codšg
 !ğ
RX_ENC_HE
 && 
¡»ams
 > 4) ||

452 (
¡©us
->
’codšg
 =ğ
RX_ENC_HE
 && 
¡»ams
 > 8)))

455 ià(
idx
 >ğ
MCS_GROUP_RATES
)

458 
du¿tiÚ
 = 
aœtime_mcs_groups
[
group
].du¿tiÚ[
idx
];

459 
du¿tiÚ
 <<ğ
aœtime_mcs_groups
[
group
].
shiá
;

460 *
ov”h—d
 = 36 + (
¡»ams
 << 2);

462  
du¿tiÚ
;

463 
	}
}

466 
u32
 
	$›“80211_ÿlc_rx_aœtime
(
›“80211_hw
 *
hw
,

467 
›“80211_rx_¡©us
 *
¡©us
,

468 
Ën
)

470 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

471 
u32
 
du¿tiÚ
, 
ov”h—d
 = 0;

473 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_LEGACY
) {

474 cÚ¡ 
›“80211_¿‹
 *
¿‹
;

475 
boŞ
 
¥
 = 
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORTPRE
;

476 
boŞ
 
cck
;

479 ià(
	`WARN_ON_ONCE
(
¡©us
->
bªd
 =ğ
NL80211_BAND_60GHZ
 ||

480 
¡©us
->
bªd
 =ğ
NL80211_BAND_S1GHZ
))

483 
sbªd
 = 
hw
->
why
->
bªds
[
¡©us
->
bªd
];

484 ià(!
sbªd
 || 
¡©us
->
¿‹_idx
 >ğsbªd->
n_b™¿‹s
)

487 
¿‹
 = &
sbªd
->
b™¿‹s
[
¡©us
->
¿‹_idx
];

488 
cck
 = 
¿‹
->
æags
 & 
IEEE80211_RATE_MANDATORY_B
;

490  
	`›“80211_ÿlc_Ëgacy_¿‹_du¿tiÚ
(
¿‹
->
b™¿‹
, 
¥
,

491 
cck
, 
Ën
);

494 
du¿tiÚ
 = 
	`›“80211_g‘_¿‹_du¿tiÚ
(
hw
, 
¡©us
, &
ov”h—d
);

495 ià(!
du¿tiÚ
)

498 
du¿tiÚ
 *ğ
Ën
;

499 
du¿tiÚ
 /ğ
AVG_PKT_SIZE
;

500 
du¿tiÚ
 /= 1024;

502  
du¿tiÚ
 + 
ov”h—d
;

503 
	}
}

504 
EXPORT_SYMBOL_GPL
(
›“80211_ÿlc_rx_aœtime
);

506 
boŞ
 
	$›“80211_fl_¿‹_šfo
(
›“80211_hw
 *
hw
,

507 
›“80211_rx_¡©us
 *
¡©
, 
u8
 
bªd
,

508 
¿‹_šfo
 *
ri
)

510 
›“80211_suµÜ‹d_bªd
 *
sbªd
 = 
hw
->
why
->
bªds
[
bªd
];

511 
i
;

513 ià(!
ri
 || !
sbªd
)

514  
çl£
;

516 
¡©
->
bw
 = 
ri
->bw;

517 
¡©
->
nss
 = 
ri
->nss;

518 
¡©
->
¿‹_idx
 = 
ri
->
mcs
;

520 ià(
ri
->
æags
 & 
RATE_INFO_FLAGS_HE_MCS
)

521 
¡©
->
’codšg
 = 
RX_ENC_HE
;

522 ià(
ri
->
æags
 & 
RATE_INFO_FLAGS_VHT_MCS
)

523 
¡©
->
’codšg
 = 
RX_ENC_VHT
;

524 ià(
ri
->
æags
 & 
RATE_INFO_FLAGS_MCS
)

525 
¡©
->
’codšg
 = 
RX_ENC_HT
;

527 
¡©
->
’codšg
 = 
RX_ENC_LEGACY
;

529 ià(
ri
->
æags
 & 
RATE_INFO_FLAGS_SHORT_GI
)

530 
¡©
->
’c_æags
 |ğ
RX_ENC_FLAG_SHORT_GI
;

532 
¡©
->
he_gi
 = 
ri
->he_gi;

534 ià(
¡©
->
’codšg
 !ğ
RX_ENC_LEGACY
)

535  
Œue
;

537 
¡©
->
¿‹_idx
 = 0;

538 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

539 ià(
ri
->
Ëgacy
 !ğ
sbªd
->
b™¿‹s
[
i
].
b™¿‹
)

542 
¡©
->
¿‹_idx
 = 
i
;

543  
Œue
;

546  
çl£
;

547 
	}
}

549 
	$›“80211_fl_rx_¡©us
(
›“80211_rx_¡©us
 *
¡©
,

550 
›“80211_hw
 *
hw
,

551 
›“80211_tx_¿‹
 *
¿‹
,

552 
¿‹_šfo
 *
ri
, 
u8
 
bªd
, 
Ën
)

554 
	`mem£t
(
¡©
, 0, (*stat));

555 
¡©
->
bªd
 = band;

557 ià(
	`›“80211_fl_¿‹_šfo
(
hw
, 
¡©
, 
bªd
, 
ri
))

560 ià(!
	`›“80211_¿‹_v®id
(
¿‹
))

563 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_160_MHZ_WIDTH
)

564 
¡©
->
bw
 = 
RATE_INFO_BW_160
;

565 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

566 
¡©
->
bw
 = 
RATE_INFO_BW_80
;

567 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

568 
¡©
->
bw
 = 
RATE_INFO_BW_40
;

570 
¡©
->
bw
 = 
RATE_INFO_BW_20
;

572 
¡©
->
’c_æags
 = 0;

573 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
)

574 
¡©
->
’c_æags
 |ğ
RX_ENC_FLAG_SHORTPRE
;

575 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_SHORT_GI
)

576 
¡©
->
’c_æags
 |ğ
RX_ENC_FLAG_SHORT_GI
;

578 
¡©
->
¿‹_idx
 = 
¿‹
->
idx
;

579 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

580 
¡©
->
’codšg
 = 
RX_ENC_VHT
;

581 
¡©
->
¿‹_idx
 = 
	`›“80211_¿‹_g‘_vht_mcs
(
¿‹
);

582 
¡©
->
nss
 = 
	`›“80211_¿‹_g‘_vht_nss
(
¿‹
);

583 } ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_MCS
) {

584 
¡©
->
’codšg
 = 
RX_ENC_HT
;

586 
¡©
->
’codšg
 = 
RX_ENC_LEGACY
;

590 
	}
}

592 
u32
 
	$›“80211_ÿlc_tx_aœtime_¿‹
(
›“80211_hw
 *
hw
,

593 
›“80211_tx_¿‹
 *
¿‹
,

594 
¿‹_šfo
 *
ri
,

595 
u8
 
bªd
, 
Ën
)

597 
›“80211_rx_¡©us
 
¡©
;

599 ià(
	`›“80211_fl_rx_¡©us
(&
¡©
, 
hw
, 
¿‹
, 
ri
, 
bªd
, 
Ën
))

602  
	`›“80211_ÿlc_rx_aœtime
(
hw
, &
¡©
, 
Ën
);

603 
	}
}

605 
u32
 
	$›“80211_ÿlc_tx_aœtime
(
›“80211_hw
 *
hw
,

606 
›“80211_tx_šfo
 *
šfo
,

607 
Ën
)

609 
u32
 
du¿tiÚ
 = 0;

610 
i
;

612 
i
 = 0; i < 
	`ARRAY_SIZE
(
šfo
->
¡©us
.
¿‹s
); i++) {

613 
›“80211_tx_¿‹
 *
¿‹
 = &
šfo
->
¡©us
.
¿‹s
[
i
];

614 
u32
 
cur_du¿tiÚ
;

616 
cur_du¿tiÚ
 = 
	`›“80211_ÿlc_tx_aœtime_¿‹
(
hw
, 
¿‹
, 
NULL
,

617 
šfo
->
bªd
, 
Ën
);

618 ià(!
cur_du¿tiÚ
)

621 
du¿tiÚ
 +ğ
cur_du¿tiÚ
 * 
¿‹
->
couÁ
;

624  
du¿tiÚ
;

625 
	}
}

626 
EXPORT_SYMBOL_GPL
(
›“80211_ÿlc_tx_aœtime
);

628 
u32
 
	$›“80211_ÿlc_ex³ùed_tx_aœtime
(
›“80211_hw
 *
hw
,

629 
›“80211_vif
 *
vif
,

630 
›“80211_¡a
 *
pub¡a
,

631 
Ën
, 
boŞ
 
ampdu
)

633 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

634 
›“80211_chªùx_cÚf
 *
cÚf
;

635 
¿‹idx
;

636 
boŞ
 
cck
, 
shÜt_´—m
;

637 
u32
 
basic_¿‹s
;

638 
u8
 
bªd
 = 0;

639 
u16
 
¿‹
;

641 
Ën
 += 38;

643 
cÚf
 = 
	`rcu_d”eã»nû
(
vif
->
bss_cÚf
.
chªùx_cÚf
);

644 ià(
cÚf
)

645 
bªd
 = 
cÚf
->
def
.
chª
->band;

647 ià(
pub¡a
) {

648 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info,

649 
¡a
);

650 
›“80211_rx_¡©us
 
¡©
;

651 
›“80211_tx_¿‹
 *
tx_¿‹
 = &
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
;

652 
¿‹_šfo
 *
ri
 = &
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹_šfo
;

653 
u32
 
du¿tiÚ
, 
ov”h—d
;

654 
u8
 
agg_shiá
;

656 ià(
	`›“80211_fl_rx_¡©us
(&
¡©
, 
hw
, 
tx_¿‹
, 
ri
, 
bªd
, 
Ën
))

659 ià(
¡©
.
’codšg
 =ğ
RX_ENC_LEGACY
 || !
ampdu
)

660  
	`›“80211_ÿlc_rx_aœtime
(
hw
, &
¡©
, 
Ën
);

662 
du¿tiÚ
 = 
	`›“80211_g‘_¿‹_du¿tiÚ
(
hw
, &
¡©
, &
ov”h—d
);

671 ià(
du¿tiÚ
 > 400 * 1024)

672 
agg_shiá
 = 1;

673 ià(
du¿tiÚ
 > 250 * 1024)

674 
agg_shiá
 = 2;

675 ià(
du¿tiÚ
 > 150 * 1024)

676 
agg_shiá
 = 3;

677 ià(
du¿tiÚ
 > 70 * 1024)

678 
agg_shiá
 = 4;

679 ià(
¡©
.
’codšg
 !ğ
RX_ENC_HE
 ||

680 
du¿tiÚ
 > 20 * 1024)

681 
agg_shiá
 = 5;

683 
agg_shiá
 = 6;

685 
du¿tiÚ
 *ğ
Ën
;

686 
du¿tiÚ
 /ğ
AVG_PKT_SIZE
;

687 
du¿tiÚ
 /= 1024;

688 
du¿tiÚ
 +ğ(
ov”h—d
 >> 
agg_shiá
);

690  
	`max_t
(
u32
, 
du¿tiÚ
, 4);

693 ià(!
cÚf
)

699 
sbªd
 = 
hw
->
why
->
bªds
[
bªd
];

701 
basic_¿‹s
 = 
vif
->
bss_cÚf
.basic_rates;

702 
shÜt_´—m
 = 
vif
->
bss_cÚf
.
u£_shÜt_´—mbË
;

704 
¿‹idx
 = 
basic_¿‹s
 ? 
	`ffs
(basic_rates) - 1 : 0;

705 
¿‹
 = 
sbªd
->
b™¿‹s
[
¿‹idx
].
b™¿‹
;

706 
cck
 = 
sbªd
->
b™¿‹s
[
¿‹idx
].
æags
 & 
IEEE80211_RATE_MANDATORY_B
;

708  
	`›“80211_ÿlc_Ëgacy_¿‹_du¿tiÚ
(
¿‹
, 
shÜt_´—m
, 
cck
, 
Ën
);

709 
	}
}

	@cfg.c

11 
	~<lšux/›“80211.h
>

12 
	~<lšux/Æ80211.h
>

13 
	~<lšux/¹Ãšk.h
>

14 
	~<lšux/¦ab.h
>

15 
	~<Ãt/Ãt_Çme¥aû.h
>

16 
	~<lšux/rcupd©e.h
>

17 
	~<lšux/fs.h
>

18 
	~<lšux/if_‘h”.h
>

19 
	~<Ãt/cfg80211.h
>

20 
	~"›“80211_i.h
"

21 
	~"driv”-İs.h
"

22 
	~"¿‹.h
"

23 
	~"mesh.h
"

24 
	~"wme.h
"

26 
›“80211_lšk_d©a
 *

27 
	$›“80211_lšk_Ü_deæšk
(
›“80211_sub_if_d©a
 *
sd©a
, 
lšk_id
,

28 
boŞ
 
»quœe_v®id
)

30 
›“80211_lšk_d©a
 *
lšk
;

32 ià(
lšk_id
 < 0) {

38 ià(
»quœe_v®id
 && 
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

39  
	`ERR_PTR
(-
EINVAL
);

41  &
sd©a
->
deæšk
;

44 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

45 ià(!
lšk
)

46  
	`ERR_PTR
(-
ENOLINK
);

47  
lšk
;

48 
	}
}

50 
	$›“80211_£t_mu_mimo_fŞlow
(
›“80211_sub_if_d©a
 *
sd©a
,

51 
vif_·¿ms
 *
·¿ms
)

53 
boŞ
 
mu_mimo_groups
 = 
çl£
;

54 
boŞ
 
mu_mimo_fŞlow
 = 
çl£
;

56 ià(
·¿ms
->
vht_mumimo_groups
) {

57 
u64
 
memb”sh
;

59 
	`BUILD_BUG_ON
((
memb”sh
è!ğ
WLAN_MEMBERSHIP_LEN
);

61 
	`memıy
(
sd©a
->
vif
.
bss_cÚf
.
mu_group
.
memb”sh
,

62 
·¿ms
->
vht_mumimo_groups
, 
WLAN_MEMBERSHIP_LEN
);

63 
	`memıy
(
sd©a
->
vif
.
bss_cÚf
.
mu_group
.
pos™iÚ
,

64 
·¿ms
->
vht_mumimo_groups
 + 
WLAN_MEMBERSHIP_LEN
,

65 
WLAN_USER_POSITION_LEN
);

66 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

67 
BSS_CHANGED_MU_GROUPS
);

69 
	`memıy
(&
memb”sh
, 
·¿ms
->
vht_mumimo_groups
,

70 
WLAN_MEMBERSHIP_LEN
);

71 
mu_mimo_groups
 = 
memb”sh
 != 0;

74 ià(
·¿ms
->
vht_mumimo_fŞlow_addr
) {

75 
mu_mimo_fŞlow
 =

76 
	`is_v®id_‘h”_addr
(
·¿ms
->
vht_mumimo_fŞlow_addr
);

77 
	`‘h”_addr_cİy
(
sd©a
->
u
.
mÁr
.
mu_fŞlow_addr
,

78 
·¿ms
->
vht_mumimo_fŞlow_addr
);

81 
sd©a
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
 = 
mu_mimo_groups
 || 
mu_mimo_fŞlow
;

82 
	}
}

84 
	$›“80211_£t_mÚ_İtiÚs
(
›“80211_sub_if_d©a
 *
sd©a
,

85 
vif_·¿ms
 *
·¿ms
)

87 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

88 
›“80211_sub_if_d©a
 *
mÚ™Ü_sd©a
;

91 ià(
·¿ms
->
æags
 && 
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

92 
u32
 
mask
 = 
MONITOR_FLAG_COOK_FRAMES
 | 
MONITOR_FLAG_ACTIVE
;

103 ià((
·¿ms
->
æags
 & 
mask
è!ğ(
sd©a
->
u
.
mÁr
.flags & mask))

104  -
EBUSY
;

108 
mÚ™Ü_sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

109 
loÿl
->
mÚ™Ü_sd©a
);

111 ià(!
mÚ™Ü_sd©a
 &&

112 (
·¿ms
->
vht_mumimo_groups
 ||…¬ams->
vht_mumimo_fŞlow_addr
))

113  -
EOPNOTSUPP
;

117 ià(
mÚ™Ü_sd©a
)

118 
	`›“80211_£t_mu_mimo_fŞlow
(
mÚ™Ü_sd©a
, 
·¿ms
);

120 ià(
·¿ms
->
æags
) {

121 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

122 
	`›“80211_adju¡_mÚ™Ü_æags
(
sd©a
, -1);

123 
sd©a
->
u
.
mÁr
.
æags
 = 
·¿ms
->flags;

124 
	`›“80211_adju¡_mÚ™Ü_æags
(
sd©a
, 1);

126 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

133 
sd©a
->
u
.
mÁr
.
æags
 = 
·¿ms
->flags;

138 
	}
}

140 
	$›“80211_£t_­_mbssid_İtiÚs
(
›“80211_sub_if_d©a
 *
sd©a
,

141 
cfg80211_mbssid_cÚfig
 
·¿ms
,

142 
›“80211_bss_cÚf
 *
lšk_cÚf
)

144 
›“80211_sub_if_d©a
 *
tx_sd©a
;

146 
sd©a
->
vif
.
mbssid_tx_vif
 = 
NULL
;

147 
lšk_cÚf
->
bssid_šdex
 = 0;

148 
lšk_cÚf
->
nÚŒªsm™‹d
 = 
çl£
;

149 
lšk_cÚf
->
ema_­
 = 
çl£
;

150 
lšk_cÚf
->
bssid_šdiÿtÜ
 = 0;

152 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 || !
·¿ms
.
tx_wdev
)

153  -
EINVAL
;

155 
tx_sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
·¿ms
.
tx_wdev
);

156 ià(!
tx_sd©a
)

157  -
EINVAL
;

159 ià(
tx_sd©a
 =ğ
sd©a
) {

160 
sd©a
->
vif
.
mbssid_tx_vif
 = &sdata->vif;

162 
sd©a
->
vif
.
mbssid_tx_vif
 = &
tx_sd©a
->vif;

163 
lšk_cÚf
->
nÚŒªsm™‹d
 = 
Œue
;

164 
lšk_cÚf
->
bssid_šdex
 = 
·¿ms
.
šdex
;

166 ià(
·¿ms
.
ema
)

167 
lšk_cÚf
->
ema_­
 = 
Œue
;

170 
	}
}

172 
wœ–ess_dev
 *
	$›“80211_add_içû
(
why
 *wiphy,

173 cÚ¡ *
Çme
,

174 
Çme_assign_ty³
,

175 
Æ80211_iáy³
 
ty³
,

176 
vif_·¿ms
 *
·¿ms
)

178 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

179 
wœ–ess_dev
 *
wdev
;

180 
›“80211_sub_if_d©a
 *
sd©a
;

181 
”r
;

183 
”r
 = 
	`›“80211_if_add
(
loÿl
, 
Çme
, 
Çme_assign_ty³
, &
wdev
, 
ty³
, 
·¿ms
);

184 ià(
”r
)

185  
	`ERR_PTR
(
”r
);

187 
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

189 ià(
ty³
 =ğ
NL80211_IFTYPE_MONITOR
) {

190 
”r
 = 
	`›“80211_£t_mÚ_İtiÚs
(
sd©a
, 
·¿ms
);

191 ià(
”r
) {

192 
	`›“80211_if_»move
(
sd©a
);

193  
NULL
;

197  
wdev
;

198 
	}
}

200 
	$›“80211_d–_içû
(
why
 *why, 
wœ–ess_dev
 *
wdev
)

202 
	`›“80211_if_»move
(
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
));

205 
	}
}

207 
	$›“80211_chªge_içû
(
why
 *wiphy,

208 
Ãt_deviû
 *
dev
,

209 
Æ80211_iáy³
 
ty³
,

210 
vif_·¿ms
 *
·¿ms
)

212 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

213 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

214 
¡a_šfo
 *
¡a
;

215 
»t
;

217 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

219 
»t
 = 
	`›“80211_if_chªge_ty³
(
sd©a
, 
ty³
);

220 ià(
»t
)

221  
»t
;

223 ià(
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 && 
·¿ms
->
u£_4addr
 == 0) {

224 
	`RCU_INIT_POINTER
(
sd©a
->
u
.
vÏn
.
¡a
, 
NULL
);

225 
	`›“80211_check_ç¡_rx_içû
(
sd©a
);

226 } ià(
ty³
 =ğ
NL80211_IFTYPE_STATION
 && 
·¿ms
->
u£_4addr
 >= 0) {

227 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

229 ià(
·¿ms
->
u£_4addr
 =ğ
ifmgd
->use_4addr)

233 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

234  -
EOPNOTSUPP
;

236 
sd©a
->
u
.
mgd
.
u£_4addr
 = 
·¿ms
->use_4addr;

237 ià(!
ifmgd
->
assocŸ‹d
)

240 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
deæšk
.
u
.
mgd
.
bssid
);

241 ià(
¡a
)

242 
	`drv_¡a_£t_4addr
(
loÿl
, 
sd©a
, &
¡a
->sta,

243 
·¿ms
->
u£_4addr
);

245 ià(
·¿ms
->
u£_4addr
)

246 
	`›“80211_£nd_4addr_nuÎfunc
(
loÿl
, 
sd©a
);

249 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
) {

250 
»t
 = 
	`›“80211_£t_mÚ_İtiÚs
(
sd©a
, 
·¿ms
);

251 ià(
»t
)

252  
»t
;

256 
	}
}

258 
	$›“80211_¡¬t_p2p_deviû
(
why
 *wiphy,

259 
wœ–ess_dev
 *
wdev
)

261 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

262 
»t
;

264 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

266 
»t
 = 
	`›“80211_check_combš©iÚs
(
sd©a
, 
NULL
, 0, 0);

267 ià(
»t
 < 0)

268  
»t
;

270  
	`›“80211_do_İ’
(
wdev
, 
Œue
);

271 
	}
}

273 
	$›“80211_¡İ_p2p_deviû
(
why
 *wiphy,

274 
wœ–ess_dev
 *
wdev
)

276 
	`›“80211_sd©a_¡İ
(
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
));

277 
	}
}

279 
	$›“80211_¡¬t_Çn
(
why
 *wiphy,

280 
wœ–ess_dev
 *
wdev
,

281 
cfg80211_Çn_cÚf
 *
cÚf
)

283 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

284 
»t
;

286 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

288 
»t
 = 
	`›“80211_check_combš©iÚs
(
sd©a
, 
NULL
, 0, 0);

289 ià(
»t
 < 0)

290  
»t
;

292 
»t
 = 
	`›“80211_do_İ’
(
wdev
, 
Œue
);

293 ià(
»t
)

294  
»t
;

296 
»t
 = 
	`drv_¡¬t_Çn
(
sd©a
->
loÿl
, sd©a, 
cÚf
);

297 ià(
»t
)

298 
	`›“80211_sd©a_¡İ
(
sd©a
);

300 
sd©a
->
u
.
Çn
.
cÚf
 = *conf;

302  
»t
;

303 
	}
}

305 
	$›“80211_¡İ_Çn
(
why
 *wiphy,

306 
wœ–ess_dev
 *
wdev
)

308 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

310 
	`drv_¡İ_Çn
(
sd©a
->
loÿl
, sdata);

311 
	`›“80211_sd©a_¡İ
(
sd©a
);

312 
	}
}

314 
	$›“80211_Çn_chªge_cÚf
(
why
 *wiphy,

315 
wœ–ess_dev
 *
wdev
,

316 
cfg80211_Çn_cÚf
 *
cÚf
,

317 
u32
 
chªges
)

319 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

320 
cfg80211_Çn_cÚf
 
Ãw_cÚf
;

321 
»t
 = 0;

323 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_NAN
)

324  -
EOPNOTSUPP
;

326 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

327  -
ENETDOWN
;

329 
Ãw_cÚf
 = 
sd©a
->
u
.
Çn
.
cÚf
;

331 ià(
chªges
 & 
CFG80211_NAN_CONF_CHANGED_PREF
)

332 
Ãw_cÚf
.
ma¡”_´ef
 = 
cÚf
->master_pref;

334 ià(
chªges
 & 
CFG80211_NAN_CONF_CHANGED_BANDS
)

335 
Ãw_cÚf
.
bªds
 = 
cÚf
->bands;

337 
»t
 = 
	`drv_Çn_chªge_cÚf
(
sd©a
->
loÿl
, sd©a, &
Ãw_cÚf
, 
chªges
);

338 ià(!
»t
)

339 
sd©a
->
u
.
Çn
.
cÚf
 = 
Ãw_cÚf
;

341  
»t
;

342 
	}
}

344 
	$›“80211_add_Çn_func
(
why
 *wiphy,

345 
wœ–ess_dev
 *
wdev
,

346 
cfg80211_Çn_func
 *
Çn_func
)

348 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

349 
»t
;

351 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_NAN
)

352  -
EOPNOTSUPP
;

354 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

355  -
ENETDOWN
;

357 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

359 
»t
 = 
	`idr_®loc
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
,

360 
Çn_func
, 1, 
sd©a
->
loÿl
->
hw
.
max_Çn_de_’Œ›s
 + 1,

361 
GFP_ATOMIC
);

362 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

364 ià(
»t
 < 0)

365  
»t
;

367 
Çn_func
->
š¡ªû_id
 = 
»t
;

369 
	`WARN_ON
(
Çn_func
->
š¡ªû_id
 == 0);

371 
»t
 = 
	`drv_add_Çn_func
(
sd©a
->
loÿl
, sd©a, 
Çn_func
);

372 ià(
»t
) {

373 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

374 
	`idr_»move
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
,

375 
Çn_func
->
š¡ªû_id
);

376 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

379  
»t
;

380 
	}
}

382 
cfg80211_Çn_func
 *

383 
	$›“80211_fšd_Çn_func_by_cook›
(
›“80211_sub_if_d©a
 *
sd©a
,

384 
u64
 
cook›
)

386 
cfg80211_Çn_func
 *
func
;

387 
id
;

389 
	`lockd•_as£¹_h–d
(&
sd©a
->
u
.
Çn
.
func_lock
);

391 
	`idr_fÜ_—ch_’Œy
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
func
, 
id
) {

392 ià(
func
->
cook›
 == cookie)

393  
func
;

396  
NULL
;

397 
	}
}

399 
	$›“80211_d–_Çn_func
(
why
 *wiphy,

400 
wœ–ess_dev
 *
wdev
, 
u64
 
cook›
)

402 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

403 
cfg80211_Çn_func
 *
func
;

404 
u8
 
š¡ªû_id
 = 0;

406 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_NAN
 ||

407 !
	`›“80211_sd©a_ruÂšg
(
sd©a
))

410 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

412 
func
 = 
	`›“80211_fšd_Çn_func_by_cook›
(
sd©a
, 
cook›
);

413 ià(
func
)

414 
š¡ªû_id
 = 
func
->instance_id;

416 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

418 ià(
š¡ªû_id
)

419 
	`drv_d–_Çn_func
(
sd©a
->
loÿl
, sd©a, 
š¡ªû_id
);

420 
	}
}

422 
	$›“80211_£t_nßck_m­
(
why
 *wiphy,

423 
Ãt_deviû
 *
dev
,

424 
u16
 
nßck_m­
)

426 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

428 
sd©a
->
nßck_m­
 =‚oack_map;

430 
	`›“80211_check_ç¡_xm™_içû
(
sd©a
);

433 
	}
}

435 
	$›“80211_£t_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

436 cÚ¡ 
u8
 *
mac_addr
, u8 
key_idx
)

438 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

439 
›“80211_key
 *
key
;

440 
¡a_šfo
 *
¡a
;

441 
»t
 = -
EINVAL
;

443 ià(!
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
,

444 
NL80211_EXT_FEATURE_EXT_KEY_ID
))

445  -
EINVAL
;

447 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mac_addr
);

449 ià(!
¡a
)

450  -
EINVAL
;

452 ià(
¡a
->
±k_idx
 =ğ
key_idx
)

455 
key
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
, 
¡a
->
±k
[
key_idx
]);

457 ià(
key
 && key->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_NO_AUTO_TX
)

458 
»t
 = 
	`›“80211_£t_tx_key
(
key
);

460  
»t
;

461 
	}
}

463 
	$›“80211_add_key
(
why
 *why, 
Ãt_deviû
 *
dev
,

464 
lšk_id
, 
u8
 
key_idx
, 
boŞ
 
·œwi£
,

465 cÚ¡ 
u8
 *
mac_addr
, 
key_·¿ms
 *
·¿ms
)

467 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

468 
›“80211_lšk_d©a
 *
lšk
 =

469 
	`›“80211_lšk_Ü_deæšk
(
sd©a
, 
lšk_id
, 
çl£
);

470 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

471 
¡a_šfo
 *
¡a
 = 
NULL
;

472 
›“80211_key
 *
key
;

473 
”r
;

475 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

477 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

478  -
ENETDOWN
;

480 ià(
	`IS_ERR
(
lšk
))

481  
	`PTR_ERR
(
lšk
);

483 ià(
·œwi£
 && 
·¿ms
->
mode
 =ğ
NL80211_KEY_SET_TX
)

484  
	`›“80211_£t_tx
(
sd©a
, 
mac_addr
, 
key_idx
);

487 
·¿ms
->
ch”
) {

488 
WLAN_CIPHER_SUITE_WEP40
:

489 
WLAN_CIPHER_SUITE_TKIP
:

490 
WLAN_CIPHER_SUITE_WEP104
:

491 ià(
lšk_id
 >= 0)

492  -
EINVAL
;

493 ià(
	`WARN_ON_ONCE
(
fs_’abËd
))

494  -
EINVAL
;

500 
key
 = 
	`›“80211_key_®loc
(
·¿ms
->
ch”
, 
key_idx
,…¬ams->
key_Ën
,

501 
·¿ms
->
key
,…¬ams->
£q_Ën
,…¬ams->
£q
);

502 ià(
	`IS_ERR
(
key
))

503  
	`PTR_ERR
(
key
);

505 
key
->
cÚf
.
lšk_id
 =†ink_id;

507 ià(
·œwi£
)

508 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_PAIRWISE
;

510 ià(
·¿ms
->
mode
 =ğ
NL80211_KEY_NO_TX
)

511 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_NO_AUTO_TX
;

513 ià(
mac_addr
) {

514 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mac_addr
);

525 ià(!
¡a
 || !
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_ASSOC
)) {

526 
	`›“80211_key_ä“_unu£d
(
key
);

527  -
ENOENT
;

531 
sd©a
->
vif
.
ty³
) {

532 
NL80211_IFTYPE_STATION
:

533 ià(
sd©a
->
u
.
mgd
.
må
 !ğ
IEEE80211_MFP_DISABLED
)

534 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_RX_MGMT
;

536 
NL80211_IFTYPE_AP
:

537 
NL80211_IFTYPE_AP_VLAN
:

539 ià(
¡a
 && 
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_MFP
))

540 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_RX_MGMT
;

542 
NL80211_IFTYPE_ADHOC
:

545 
NL80211_IFTYPE_MESH_POINT
:

546 #ifdeà
CONFIG_MAC80211_MESH


547 ià(
sd©a
->
u
.
mesh
.
£cur™y
 !ğ
IEEE80211_MESH_SEC_NONE
)

548 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_RX_MGMT
;

551 
NL80211_IFTYPE_WDS
:

552 
NL80211_IFTYPE_MONITOR
:

553 
NL80211_IFTYPE_P2P_DEVICE
:

554 
NL80211_IFTYPE_NAN
:

555 
NL80211_IFTYPE_UNSPECIFIED
:

556 
NUM_NL80211_IFTYPES
:

557 
NL80211_IFTYPE_P2P_CLIENT
:

558 
NL80211_IFTYPE_P2P_GO
:

559 
NL80211_IFTYPE_OCB
:

561 
	`WARN_ON_ONCE
(1);

565 
”r
 = 
	`›“80211_key_lšk
(
key
, 
lšk
, 
¡a
);

567 ià(
”r
 =ğ-
EALREADY
)

568 
”r
 = 0;

570  
”r
;

571 
	}
}

573 
›“80211_key
 *

574 
	$›“80211_lookup_key
(
›“80211_sub_if_d©a
 *
sd©a
, 
lšk_id
,

575 
u8
 
key_idx
, 
boŞ
 
·œwi£
, cÚ¡ u8 *
mac_addr
)

577 
›“80211_loÿl
 *
loÿl
 
__maybe_unu£d
 = 
sd©a
->local;

578 
›“80211_lšk_d©a
 *
lšk
 = &
sd©a
->
deæšk
;

579 
›“80211_key
 *
key
;

581 ià(
lšk_id
 >= 0) {

582 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

583 ià(!
lšk
)

584  
NULL
;

587 ià(
mac_addr
) {

588 
¡a_šfo
 *
¡a
;

589 
lšk_¡a_šfo
 *
lšk_¡a
;

591 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mac_addr
);

592 ià(!
¡a
)

593  
NULL
;

595 ià(
lšk_id
 >= 0) {

596 
lšk_¡a
 = 
	`rcu_d”eã»nû_check
(
¡a
->
lšk
[
lšk_id
],

597 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

598 ià(!
lšk_¡a
)

599  
NULL
;

601 
lšk_¡a
 = &
¡a
->
deæšk
;

604 ià(
·œwi£
 && 
key_idx
 < 
NUM_DEFAULT_KEYS
)

605  
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

606 
¡a
->
±k
[
key_idx
]);

608 ià(!
·œwi£
 &&

609 
key_idx
 < 
NUM_DEFAULT_KEYS
 +

610 
NUM_DEFAULT_MGMT_KEYS
 +

611 
NUM_DEFAULT_BEACON_KEYS
)

612  
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

613 
lšk_¡a
->
gtk
[
key_idx
]);

615  
NULL
;

618 ià(
·œwi£
 && 
key_idx
 < 
NUM_DEFAULT_KEYS
)

619  
	`why_d”eã»nû
(
loÿl
->
hw
.
why
, 
sd©a
->
keys
[
key_idx
]);

621 
key
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
, 
lšk
->
gtk
[
key_idx
]);

622 ià(
key
)

623  
key
;

626 ià(
key_idx
 < 
NUM_DEFAULT_KEYS
)

627  
	`why_d”eã»nû
(
loÿl
->
hw
.
why
, 
sd©a
->
keys
[
key_idx
]);

629  
NULL
;

630 
	}
}

632 
	$›“80211_d–_key
(
why
 *why, 
Ãt_deviû
 *
dev
,

633 
lšk_id
, 
u8
 
key_idx
, 
boŞ
 
·œwi£
,

634 cÚ¡ 
u8
 *
mac_addr
)

636 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

637 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

638 
›“80211_key
 *
key
;

640 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

642 
key
 = 
	`›“80211_lookup_key
(
sd©a
, 
lšk_id
, 
key_idx
, 
·œwi£
, 
mac_addr
);

643 ià(!
key
)

644  -
ENOENT
;

646 
	`›“80211_key_ä“
(
key
, 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
);

649 
	}
}

651 
	$›“80211_g‘_key
(
why
 *why, 
Ãt_deviû
 *
dev
,

652 
lšk_id
, 
u8
 
key_idx
, 
boŞ
 
·œwi£
,

653 cÚ¡ 
u8
 *
mac_addr
, *
cook›
,

654 (*
ÿÎback
)(*
cook›
,

655 
key_·¿ms
 *
·¿ms
))

657 
›“80211_sub_if_d©a
 *
sd©a
;

658 
u8
 
£q
[6] = {0};

659 
key_·¿ms
 
·¿ms
;

660 
›“80211_key
 *
key
;

661 
u64
 
²64
;

662 
u32
 
iv32
;

663 
u16
 
iv16
;

664 
”r
 = -
ENOENT
;

665 
›“80211_key_£q
 
k£q
 = {};

667 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

669 
	`rcu_»ad_lock
();

671 
key
 = 
	`›“80211_lookup_key
(
sd©a
, 
lšk_id
, 
key_idx
, 
·œwi£
, 
mac_addr
);

672 ià(!
key
)

673 
out
;

675 
	`mem£t
(&
·¿ms
, 0, (params));

677 
·¿ms
.
ch”
 = 
key
->
cÚf
.cipher;

679 
key
->
cÚf
.
ch”
) {

680 
WLAN_CIPHER_SUITE_TKIP
:

681 
²64
 = 
	`©omic64_»ad
(&
key
->
cÚf
.
tx_²
);

682 
iv32
 = 
	`TKIP_PN_TO_IV32
(
²64
);

683 
iv16
 = 
	`TKIP_PN_TO_IV16
(
²64
);

685 ià(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
 &&

686 !(
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
)) {

687 
	`drv_g‘_key_£q
(
sd©a
->
loÿl
, 
key
, &
k£q
);

688 
iv32
 = 
k£q
.
tk
.iv32;

689 
iv16
 = 
k£q
.
tk
.iv16;

692 
£q
[0] = 
iv16
 & 0xff;

693 
£q
[1] = (
iv16
 >> 8) & 0xff;

694 
£q
[2] = 
iv32
 & 0xff;

695 
£q
[3] = (
iv32
 >> 8) & 0xff;

696 
£q
[4] = (
iv32
 >> 16) & 0xff;

697 
£q
[5] = (
iv32
 >> 24) & 0xff;

698 
·¿ms
.
£q
 = seq;

699 
·¿ms
.
£q_Ën
 = 6;

701 
WLAN_CIPHER_SUITE_CCMP
:

702 
WLAN_CIPHER_SUITE_CCMP_256
:

703 
WLAN_CIPHER_SUITE_AES_CMAC
:

704 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

705 
	`BUILD_BUG_ON
(
	`off£tof
(
	`ty³of
(
k£q
), 
ccmp
) !=

706 
	`off£tof
(
	`ty³of
(
k£q
), 
«s_cmac
));

707 
çÎthrough
;

708 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

709 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

710 
	`BUILD_BUG_ON
(
	`off£tof
(
	`ty³of
(
k£q
), 
ccmp
) !=

711 
	`off£tof
(
	`ty³of
(
k£q
), 
«s_gmac
));

712 
çÎthrough
;

713 
WLAN_CIPHER_SUITE_GCMP
:

714 
WLAN_CIPHER_SUITE_GCMP_256
:

715 
	`BUILD_BUG_ON
(
	`off£tof
(
	`ty³of
(
k£q
), 
ccmp
) !=

716 
	`off£tof
(
	`ty³of
(
k£q
), 
gcmp
));

718 ià(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
 &&

719 !(
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
)) {

720 
	`drv_g‘_key_£q
(
sd©a
->
loÿl
, 
key
, &
k£q
);

721 
	`memıy
(
£q
, 
k£q
.
ccmp
.
²
, 6);

723 
²64
 = 
	`©omic64_»ad
(&
key
->
cÚf
.
tx_²
);

724 
£q
[0] = 
²64
;

725 
£q
[1] = 
²64
 >> 8;

726 
£q
[2] = 
²64
 >> 16;

727 
£q
[3] = 
²64
 >> 24;

728 
£q
[4] = 
²64
 >> 32;

729 
£q
[5] = 
²64
 >> 40;

731 
·¿ms
.
£q
 = seq;

732 
·¿ms
.
£q_Ën
 = 6;

735 ià(!(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
))

737 ià(
	`WARN_ON
(
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
))

739 
	`drv_g‘_key_£q
(
sd©a
->
loÿl
, 
key
, &
k£q
);

740 
·¿ms
.
£q
 = 
k£q
.
hw
.seq;

741 
·¿ms
.
£q_Ën
 = 
k£q
.
hw
.seq_len;

745 
·¿ms
.
key
 = key->
cÚf
.key;

746 
·¿ms
.
key_Ën
 = 
key
->
cÚf
.
keyËn
;

748 
	`ÿÎback
(
cook›
, &
·¿ms
);

749 
”r
 = 0;

751 
out
:

752 
	`rcu_»ad_uÆock
();

753  
”r
;

754 
	}
}

756 
	$›“80211_cÚfig_deçuÉ_key
(
why
 *wiphy,

757 
Ãt_deviû
 *
dev
,

758 
lšk_id
, 
u8
 
key_idx
, 
boŞ
 
uni
,

759 
boŞ
 
muÉi
)

761 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

762 
›“80211_lšk_d©a
 *
lšk
 =

763 
	`›“80211_lšk_Ü_deæšk
(
sd©a
, 
lšk_id
, 
çl£
);

765 ià(
	`IS_ERR
(
lšk
))

766  
	`PTR_ERR
(
lšk
);

768 
	`›“80211_£t_deçuÉ_key
(
lšk
, 
key_idx
, 
uni
, 
muÉi
);

771 
	}
}

773 
	$›“80211_cÚfig_deçuÉ_mgmt_key
(
why
 *wiphy,

774 
Ãt_deviû
 *
dev
,

775 
lšk_id
, 
u8
 
key_idx
)

777 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

778 
›“80211_lšk_d©a
 *
lšk
 =

779 
	`›“80211_lšk_Ü_deæšk
(
sd©a
, 
lšk_id
, 
Œue
);

781 ià(
	`IS_ERR
(
lšk
))

782  
	`PTR_ERR
(
lšk
);

784 
	`›“80211_£t_deçuÉ_mgmt_key
(
lšk
, 
key_idx
);

787 
	}
}

789 
	$›“80211_cÚfig_deçuÉ_b—cÚ_key
(
why
 *wiphy,

790 
Ãt_deviû
 *
dev
,

791 
lšk_id
, 
u8
 
key_idx
)

793 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

794 
›“80211_lšk_d©a
 *
lšk
 =

795 
	`›“80211_lšk_Ü_deæšk
(
sd©a
, 
lšk_id
, 
Œue
);

797 ià(
	`IS_ERR
(
lšk
))

798  
	`PTR_ERR
(
lšk
);

800 
	`›“80211_£t_deçuÉ_b—cÚ_key
(
lšk
, 
key_idx
);

803 
	}
}

805 
	$¡a_£t_¿‹_šfo_tx
(
¡a_šfo
 *
¡a
,

806 cÚ¡ 
›“80211_tx_¿‹
 *
¿‹
,

807 
¿‹_šfo
 *
ršfo
)

809 
ršfo
->
æags
 = 0;

810 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_MCS
) {

811 
ršfo
->
æags
 |ğ
RATE_INFO_FLAGS_MCS
;

812 
ršfo
->
mcs
 = 
¿‹
->
idx
;

813 } ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

814 
ršfo
->
æags
 |ğ
RATE_INFO_FLAGS_VHT_MCS
;

815 
ršfo
->
mcs
 = 
	`›“80211_¿‹_g‘_vht_mcs
(
¿‹
);

816 
ršfo
->
nss
 = 
	`›“80211_¿‹_g‘_vht_nss
(
¿‹
);

818 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

820 
sbªd
 = 
	`›“80211_g‘_sbªd
(
¡a
->
sd©a
);

821 
	`WARN_ON_ONCE
(
sbªd
 && !sbªd->
b™¿‹s
);

822 ià(
sbªd
 && sbªd->
b™¿‹s
)

823 
ršfo
->
Ëgacy
 = 
sbªd
->
b™¿‹s
[
¿‹
->
idx
].
b™¿‹
;

825 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

826 
ršfo
->
bw
 = 
RATE_INFO_BW_40
;

827 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

828 
ršfo
->
bw
 = 
RATE_INFO_BW_80
;

829 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_160_MHZ_WIDTH
)

830 
ršfo
->
bw
 = 
RATE_INFO_BW_160
;

832 
ršfo
->
bw
 = 
RATE_INFO_BW_20
;

833 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_SHORT_GI
)

834 
ršfo
->
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

835 
	}
}

837 
	$›“80211_dump_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

838 
idx
, 
u8
 *
mac
, 
¡©iÚ_šfo
 *
sšfo
)

840 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

841 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

842 
¡a_šfo
 *
¡a
;

843 
»t
 = -
ENOENT
;

845 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

847 
¡a
 = 
	`¡a_šfo_g‘_by_idx
(
sd©a
, 
idx
);

848 ià(
¡a
) {

849 
»t
 = 0;

850 
	`memıy
(
mac
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

851 
	`¡a_£t_sšfo
(
¡a
, 
sšfo
, 
Œue
);

854  
»t
;

855 
	}
}

857 
	$›“80211_dump_survey
(
why
 *why, 
Ãt_deviû
 *
dev
,

858 
idx
, 
survey_šfo
 *
survey
)

860 
›“80211_loÿl
 *
loÿl
 = 
	`wdev_´iv
(
dev
->
›“80211_±r
);

862  
	`drv_g‘_survey
(
loÿl
, 
idx
, 
survey
);

863 
	}
}

865 
	$›“80211_g‘_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

866 cÚ¡ 
u8
 *
mac
, 
¡©iÚ_šfo
 *
sšfo
)

868 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

869 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

870 
¡a_šfo
 *
¡a
;

871 
»t
 = -
ENOENT
;

873 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

875 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mac
);

876 ià(
¡a
) {

877 
»t
 = 0;

878 
	`¡a_£t_sšfo
(
¡a
, 
sšfo
, 
Œue
);

881  
»t
;

882 
	}
}

884 
	$›“80211_£t_mÚ™Ü_chªÃl
(
why
 *wiphy,

885 
cfg80211_chª_def
 *
chªdef
)

887 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

888 
›“80211_sub_if_d©a
 *
sd©a
;

889 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = *
chªdef
 };

890 
»t
;

892 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

894 ià(
	`cfg80211_chªdef_id’tiÿl
(&
loÿl
->
mÚ™Ü_chª»q
.
İ”
,

895 &
chª»q
.
İ”
))

898 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

899 
loÿl
->
mÚ™Ü_sd©a
);

900 ià(!
sd©a
)

901 
dÚe
;

903 ià(
	`cfg80211_chªdef_id’tiÿl
(&
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
,

904 &
chª»q
.
İ”
))

907 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

908 
»t
 = 
	`›“80211_lšk_u£_chªÃl
(&
sd©a
->
deæšk
, &
chª»q
,

909 
IEEE80211_CHANCTX_EXCLUSIVE
);

910 ià(
»t
)

911  
»t
;

912 
dÚe
:

913 
loÿl
->
mÚ™Ü_chª»q
 = 
chª»q
;

915 
	}
}

918 
	$›“80211_£t_´obe_»¥
(
›“80211_sub_if_d©a
 *
sd©a
,

919 cÚ¡ 
u8
 *
»¥
, 
size_t
 
»¥_Ën
,

920 cÚ¡ 
›“80211_c§_£‰šgs
 *
c§
,

921 cÚ¡ 
›“80211_cŞÜ_chªge_£‰šgs
 *
cÿ
,

922 
›“80211_lšk_d©a
 *
lšk
)

924 
´obe_»¥
 *
Ãw
, *
Şd
;

926 ià(!
»¥
 || !
»¥_Ën
)

929 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
´obe_»¥
, 
sd©a
);

931 
Ãw
 = 
	`kz®loc
((
´obe_»¥
è+ 
»¥_Ën
, 
GFP_KERNEL
);

932 ià(!
Ãw
)

933  -
ENOMEM
;

935 
Ãw
->
Ën
 = 
»¥_Ën
;

936 
	`memıy
(
Ãw
->
d©a
, 
»¥
, 
»¥_Ën
);

938 ià(
c§
)

939 
	`memıy
(
Ãw
->
útdwn_couÁ”_off£ts
, 
c§
->
couÁ”_off£ts_´e¥
,

940 
c§
->
n_couÁ”_off£ts_´e¥
 *

941 (
Ãw
->
útdwn_couÁ”_off£ts
[0]));

942 ià(
cÿ
)

943 
Ãw
->
útdwn_couÁ”_off£ts
[0] = 
cÿ
->
couÁ”_off£t_´e¥
;

945 
	`rcu_assign_poš‹r
(
lšk
->
u
.
­
.
´obe_»¥
, 
Ãw
);

946 ià(
Şd
)

947 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

950 
	}
}

952 
	$›“80211_£t_fs_discov”y
(
›“80211_sub_if_d©a
 *
sd©a
,

953 
cfg80211_fs_discov”y
 *
·¿ms
,

954 
›“80211_lšk_d©a
 *
lšk
,

955 
›“80211_bss_cÚf
 *
lšk_cÚf
,

956 
u64
 *
chªged
)

958 
fs_discov”y_d©a
 *
Ãw
, *
Şd
 = 
NULL
;

959 
›“80211_fs_discov”y
 *
fd
;

961 ià(!
·¿ms
->
upd©e
)

964 
fd
 = &
lšk_cÚf
->
fs_discov”y
;

965 
fd
->
mš_š‹rv®
 = 
·¿ms
->min_interval;

966 
fd
->
max_š‹rv®
 = 
·¿ms
->max_interval;

968 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
fs_discov”y
, 
sd©a
);

969 ià(
Şd
)

970 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

972 ià(
·¿ms
->
tm¶
 &&…¬ams->
tm¶_Ën
) {

973 
Ãw
 = 
	`kz®loc
((*Ãwè+ 
·¿ms
->
tm¶_Ën
, 
GFP_KERNEL
);

974 ià(!
Ãw
)

975  -
ENOMEM
;

976 
Ãw
->
Ën
 = 
·¿ms
->
tm¶_Ën
;

977 
	`memıy
(
Ãw
->
d©a
, 
·¿ms
->
tm¶
,…¬ams->
tm¶_Ën
);

978 
	`rcu_assign_poš‹r
(
lšk
->
u
.
­
.
fs_discov”y
, 
Ãw
);

980 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
fs_discov”y
, 
NULL
);

983 *
chªged
 |ğ
BSS_CHANGED_FILS_DISCOVERY
;

985 
	}
}

988 
	$›“80211_£t_unsŞ_bÿ¡_´obe_»¥
(
›“80211_sub_if_d©a
 *
sd©a
,

989 
cfg80211_unsŞ_bÿ¡_´obe_»¥
 *
·¿ms
,

990 
›“80211_lšk_d©a
 *
lšk
,

991 
›“80211_bss_cÚf
 *
lšk_cÚf
,

992 
u64
 *
chªged
)

994 
unsŞ_bÿ¡_´obe_»¥_d©a
 *
Ãw
, *
Şd
 = 
NULL
;

996 ià(!
·¿ms
->
upd©e
)

999 
lšk_cÚf
->
unsŞ_bÿ¡_´obe_»¥_š‹rv®
 = 
·¿ms
->
š‹rv®
;

1001 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
unsŞ_bÿ¡_´obe_»¥
, 
sd©a
);

1002 ià(
Şd
)

1003 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

1005 ià(
·¿ms
->
tm¶
 &&…¬ams->
tm¶_Ën
) {

1006 
Ãw
 = 
	`kz®loc
((*Ãwè+ 
·¿ms
->
tm¶_Ën
, 
GFP_KERNEL
);

1007 ià(!
Ãw
)

1008  -
ENOMEM
;

1009 
Ãw
->
Ën
 = 
·¿ms
->
tm¶_Ën
;

1010 
	`memıy
(
Ãw
->
d©a
, 
·¿ms
->
tm¶
,…¬ams->
tm¶_Ën
);

1011 
	`rcu_assign_poš‹r
(
lšk
->
u
.
­
.
unsŞ_bÿ¡_´obe_»¥
, 
Ãw
);

1013 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
unsŞ_bÿ¡_´obe_»¥
, 
NULL
);

1016 *
chªged
 |ğ
BSS_CHANGED_UNSOL_BCAST_PROBE_RESP
;

1018 
	}
}

1020 
	$›“80211_£t_ám_»¥Úd”_·¿ms
(

1021 
›“80211_sub_if_d©a
 *
sd©a
,

1022 cÚ¡ 
u8
 *
lci
, 
size_t
 
lci_Ën
,

1023 cÚ¡ 
u8
 *
civişoc
, 
size_t
 
civişoc_Ën
,

1024 
›“80211_bss_cÚf
 *
lšk_cÚf
)

1026 
›“80211_ám_»¥Úd”_·¿ms
 *
Ãw
, *
Şd
;

1027 
u8
 *
pos
;

1028 
Ën
;

1030 ià(!
lci_Ën
 && !
civişoc_Ën
)

1033 
Şd
 = 
lšk_cÚf
->
ámr_·¿ms
;

1034 
Ën
 = 
lci_Ën
 + 
civişoc_Ën
;

1036 
Ãw
 = 
	`kz®loc
((*Ãwè+ 
Ën
, 
GFP_KERNEL
);

1037 ià(!
Ãw
)

1038  -
ENOMEM
;

1040 
pos
 = (
u8
 *)(
Ãw
 + 1);

1041 ià(
lci_Ën
) {

1042 
Ãw
->
lci_Ën
 =†ci_len;

1043 
Ãw
->
lci
 = 
pos
;

1044 
	`memıy
(
pos
, 
lci
, 
lci_Ën
);

1045 
pos
 +ğ
lci_Ën
;

1048 ià(
civişoc_Ën
) {

1049 
Ãw
->
civişoc_Ën
 = civicloc_len;

1050 
Ãw
->
civişoc
 = 
pos
;

1051 
	`memıy
(
pos
, 
civişoc
, 
civişoc_Ën
);

1052 
pos
 +ğ
civişoc_Ën
;

1055 
lšk_cÚf
->
ámr_·¿ms
 = 
Ãw
;

1056 
	`kä“
(
Şd
);

1059 
	}
}

1062 
	$›“80211_cİy_mbssid_b—cÚ
(
u8
 *
pos
, 
cfg80211_mbssid_–ems
 *
d¡
,

1063 
cfg80211_mbssid_–ems
 *
¤c
)

1065 
i
, 
off£t
 = 0;

1067 
i
 = 0; i < 
¤c
->
út
; i++) {

1068 
	`memıy
(
pos
 + 
off£t
, 
¤c
->
–em
[
i
].
d©a
, src->–em[i].
Ën
);

1069 
d¡
->
–em
[
i
].
Ën
 = 
¤c
->elem[i].len;

1070 
d¡
->
–em
[
i
].
d©a
 = 
pos
 + 
off£t
;

1071 
off£t
 +ğ
d¡
->
–em
[
i
].
Ën
;

1073 
d¡
->
út
 = 
¤c
->cnt;

1075  
off£t
;

1076 
	}
}

1079 
	$›“80211_cİy_ºr_b—cÚ
(
u8
 *
pos
, 
cfg80211_ºr_–ems
 *
d¡
,

1080 
cfg80211_ºr_–ems
 *
¤c
)

1082 
i
, 
off£t
 = 0;

1084 
i
 = 0; i < 
¤c
->
út
; i++) {

1085 
	`memıy
(
pos
 + 
off£t
, 
¤c
->
–em
[
i
].
d©a
, src->–em[i].
Ën
);

1086 
d¡
->
–em
[
i
].
Ën
 = 
¤c
->elem[i].len;

1087 
d¡
->
–em
[
i
].
d©a
 = 
pos
 + 
off£t
;

1088 
off£t
 +ğ
d¡
->
–em
[
i
].
Ën
;

1090 
d¡
->
út
 = 
¤c
->cnt;

1092  
off£t
;

1093 
	}
}

1096 
	$›“80211_assign_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1097 
›“80211_lšk_d©a
 *
lšk
,

1098 
cfg80211_b—cÚ_d©a
 *
·¿ms
,

1099 cÚ¡ 
›“80211_c§_£‰šgs
 *
c§
,

1100 cÚ¡ 
›“80211_cŞÜ_chªge_£‰šgs
 *
cÿ
,

1101 
u64
 *
chªged
)

1103 
cfg80211_mbssid_–ems
 *
mbssid
 = 
NULL
;

1104 
cfg80211_ºr_–ems
 *
ºr
 = 
NULL
;

1105 
b—cÚ_d©a
 *
Ãw
, *
Şd
;

1106 
Ãw_h—d_Ën
, 
Ãw__Ën
;

1107 
size
, 
”r
;

1108 
u64
 
_chªged
 = 
BSS_CHANGED_BEACON
;

1109 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1111 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
);

1114 ià(!
·¿ms
->
h—d
 && !
Şd
)

1115  -
EINVAL
;

1118 ià(
·¿ms
->
h—d
)

1119 
Ãw_h—d_Ën
 = 
·¿ms
->
h—d_Ën
;

1121 
Ãw_h—d_Ën
 = 
Şd
->
h—d_Ën
;

1124 ià(
·¿ms
->

 || !
Şd
)

1126 
Ãw__Ën
 = 
·¿ms
->
_Ën
;

1128 
Ãw__Ën
 = 
Şd
->
_Ën
;

1130 
size
 = (*
Ãw
è+ 
Ãw_h—d_Ën
 + 
Ãw__Ën
;

1133 ià(
·¿ms
->
mbssid_›s
) {

1134 
mbssid
 = 
·¿ms
->
mbssid_›s
;

1135 
size
 +ğ
	`¡ruù_size
(
Ãw
->
mbssid_›s
, 
–em
, 
mbssid
->
út
);

1136 ià(
·¿ms
->
ºr_›s
) {

1137 
ºr
 = 
·¿ms
->
ºr_›s
;

1138 
size
 +ğ
	`¡ruù_size
(
Ãw
->
ºr_›s
, 
–em
, 
ºr
->
út
);

1140 
size
 +ğ
	`›“80211_g‘_mbssid_b—cÚ_Ën
(
mbssid
, 
ºr
,

1141 
mbssid
->
út
);

1142 } ià(
Şd
 && old->
mbssid_›s
) {

1143 
mbssid
 = 
Şd
->
mbssid_›s
;

1144 
size
 +ğ
	`¡ruù_size
(
Ãw
->
mbssid_›s
, 
–em
, 
mbssid
->
út
);

1145 ià(
Şd
 && old->
ºr_›s
) {

1146 
ºr
 = 
Şd
->
ºr_›s
;

1147 
size
 +ğ
	`¡ruù_size
(
Ãw
->
ºr_›s
, 
–em
, 
ºr
->
út
);

1149 
size
 +ğ
	`›“80211_g‘_mbssid_b—cÚ_Ën
(
mbssid
, 
ºr
,

1150 
mbssid
->
út
);

1153 
Ãw
 = 
	`kz®loc
(
size
, 
GFP_KERNEL
);

1154 ià(!
Ãw
)

1155  -
ENOMEM
;

1163 
Ãw
->
h—d
 = ((
u8
 *)‚ew) + (*new);

1164 
Ãw
->

 =‚ew->
h—d
 + 
Ãw_h—d_Ën
;

1165 
Ãw
->
h—d_Ën
 = 
Ãw_h—d_Ën
;

1166 
Ãw
->
_Ën
 = 
Ãw__Ën
;

1168 ià(
mbssid
) {

1169 
u8
 *
pos
 = 
Ãw
->

 +‚ew->
_Ën
;

1171 
Ãw
->
mbssid_›s
 = (*)
pos
;

1172 
pos
 +ğ
	`¡ruù_size
(
Ãw
->
mbssid_›s
, 
–em
, 
mbssid
->
út
);

1173 
pos
 +ğ
	`›“80211_cİy_mbssid_b—cÚ
Õos, 
Ãw
->
mbssid_›s
,

1174 
mbssid
);

1175 ià(
ºr
) {

1176 
Ãw
->
ºr_›s
 = (*)
pos
;

1177 
pos
 +ğ
	`¡ruù_size
(
Ãw
->
ºr_›s
, 
–em
, 
ºr
->
út
);

1178 
	`›“80211_cİy_ºr_b—cÚ
(
pos
, 
Ãw
->
ºr_›s
, 
ºr
);

1181 
lšk_cÚf
->
bssid_šdiÿtÜ
 =

1182 
	`og2
(
	`__roundup_pow_of_two
(
mbssid
->
út
 + 1));

1185 ià(
c§
) {

1186 
Ãw
->
útdwn_cu¼’t_couÁ”
 = 
c§
->
couÁ
;

1187 
	`memıy
(
Ãw
->
útdwn_couÁ”_off£ts
, 
c§
->
couÁ”_off£ts_b—cÚ
,

1188 
c§
->
n_couÁ”_off£ts_b—cÚ
 *

1189 (
Ãw
->
útdwn_couÁ”_off£ts
[0]));

1190 } ià(
cÿ
) {

1191 
Ãw
->
útdwn_cu¼’t_couÁ”
 = 
cÿ
->
couÁ
;

1192 
Ãw
->
útdwn_couÁ”_off£ts
[0] = 
cÿ
->
couÁ”_off£t_b—cÚ
;

1196 ià(
·¿ms
->
h—d
)

1197 
	`memıy
(
Ãw
->
h—d
, 
·¿ms
->h—d, 
Ãw_h—d_Ën
);

1199 
	`memıy
(
Ãw
->
h—d
, 
Şd
->h—d, 
Ãw_h—d_Ën
);

1202 ià(
·¿ms
->

)

1203 
	`memıy
(
Ãw
->

, 
·¿ms
->, 
Ãw__Ën
);

1205 ià(
Şd
)

1206 
	`memıy
(
Ãw
->

, 
Şd
->, 
Ãw__Ën
);

1208 
”r
 = 
	`›“80211_£t_´obe_»¥
(
sd©a
, 
·¿ms
->
´obe_»¥
,

1209 
·¿ms
->
´obe_»¥_Ën
, 
c§
, 
cÿ
, 
lšk
);

1210 ià(
”r
 < 0) {

1211 
	`kä“
(
Ãw
);

1212  
”r
;

1214 ià(
”r
 == 0)

1215 
_chªged
 |ğ
BSS_CHANGED_AP_PROBE_RESP
;

1217 ià(
·¿ms
->
ám_»¥Úd”
 != -1) {

1218 
lšk_cÚf
->
ám_»¥Úd”
 = 
·¿ms
->ftm_responder;

1219 
”r
 = 
	`›“80211_£t_ám_»¥Úd”_·¿ms
(
sd©a
,

1220 
·¿ms
->
lci
,

1221 
·¿ms
->
lci_Ën
,

1222 
·¿ms
->
civişoc
,

1223 
·¿ms
->
civişoc_Ën
,

1224 
lšk_cÚf
);

1226 ià(
”r
 < 0) {

1227 
	`kä“
(
Ãw
);

1228  
”r
;

1231 
_chªged
 |ğ
BSS_CHANGED_FTM_RESPONDER
;

1234 
	`rcu_assign_poš‹r
(
lšk
->
u
.
­
.
b—cÚ
, 
Ãw
);

1235 
sd©a
->
u
.
­
.
aùive
 = 
Œue
;

1237 ià(
Şd
)

1238 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

1240 *
chªged
 |ğ
_chªged
;

1242 
	}
}

1244 
u8
 
	$›“80211_num_b—cÚšg_lšks
(
›“80211_sub_if_d©a
 *
sd©a
)

1246 
›“80211_lšk_d©a
 *
lšk
;

1247 
u8
 
lšk_id
, 
num
 = 0;

1249 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

1250 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_P2P_GO
)

1251  
num
;

1253 ià(!
sd©a
->
vif
.
v®id_lšks
)

1254  
num
;

1256 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

1257 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

1258 ià(!
lšk
)

1261 ià(
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
))

1262 
num
++;

1265  
num
;

1266 
	}
}

1268 
	$›“80211_¡¬t_­
(
why
 *why, 
Ãt_deviû
 *
dev
,

1269 
cfg80211_­_£‰šgs
 *
·¿ms
)

1271 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1272 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1273 
b—cÚ_d©a
 *
Şd
;

1274 
›“80211_sub_if_d©a
 *
vÏn
;

1275 
u64
 
chªged
 = 
BSS_CHANGED_BEACON_INT
 |

1276 
BSS_CHANGED_BEACON_ENABLED
 |

1277 
BSS_CHANGED_BEACON
 |

1278 
BSS_CHANGED_P2P_PS
 |

1279 
BSS_CHANGED_TXPOWER
 |

1280 
BSS_CHANGED_TWT
;

1281 
i
, 
”r
;

1282 
´ev_b—cÚ_št
;

1283 
lšk_id
 = 
·¿ms
->
b—cÚ
.link_id;

1284 
›“80211_lšk_d©a
 *
lšk
;

1285 
›“80211_bss_cÚf
 *
lšk_cÚf
;

1286 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = 
·¿ms
->
chªdef
 };

1288 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1290 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

1291 ià(!
lšk
)

1292  -
ENOLINK
;

1294 
lšk_cÚf
 = 
lšk
->
cÚf
;

1296 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
);

1297 ià(
Şd
)

1298  -
EALREADY
;

1300 ià(
·¿ms
->
smps_mode
 !ğ
NL80211_SMPS_OFF
)

1301  -
EOPNOTSUPP
;

1303 
lšk
->
smps_mode
 = 
IEEE80211_SMPS_OFF
;

1305 
lšk
->
Ãeded_rx_chašs
 = 
sd©a
->
loÿl
->
rx_chašs
;

1307 
´ev_b—cÚ_št
 = 
lšk_cÚf
->
b—cÚ_št
;

1308 
lšk_cÚf
->
b—cÚ_št
 = 
·¿ms
->
b—cÚ_š‹rv®
;

1310 ià(
·¿ms
->
ht_ÿp
)

1311 
lšk_cÚf
->
ht_ldpc
 =

1312 
·¿ms
->
ht_ÿp
->
ÿp_šfo
 &

1313 
	`ıu_to_Ë16
(
IEEE80211_HT_CAP_LDPC_CODING
);

1315 ià(
·¿ms
->
vht_ÿp
) {

1316 
lšk_cÚf
->
vht_ldpc
 =

1317 
·¿ms
->
vht_ÿp
->
vht_ÿp_šfo
 &

1318 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_RXLDPC
);

1319 
lšk_cÚf
->
vht_su_b—mfÜm”
 =

1320 
·¿ms
->
vht_ÿp
->
vht_ÿp_šfo
 &

1321 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
);

1322 
lšk_cÚf
->
vht_su_b—mfÜm“
 =

1323 
·¿ms
->
vht_ÿp
->
vht_ÿp_šfo
 &

1324 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
);

1325 
lšk_cÚf
->
vht_mu_b—mfÜm”
 =

1326 
·¿ms
->
vht_ÿp
->
vht_ÿp_šfo
 &

1327 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_MU_BEAMFORMER_CAPABLE
);

1328 
lšk_cÚf
->
vht_mu_b—mfÜm“
 =

1329 
·¿ms
->
vht_ÿp
->
vht_ÿp_šfo
 &

1330 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
);

1333 ià(
·¿ms
->
he_ÿp
 &&…¬ams->
he_İ”
) {

1334 
lšk_cÚf
->
he_suµÜt
 = 
Œue
;

1335 
lšk_cÚf
->
htc_Œig_ba£d_pkt_ext
 =

1336 
	`Ë32_g‘_b™s
(
·¿ms
->
he_İ”
->
he_İ”_·¿ms
,

1337 
IEEE80211_HE_OPERATION_DFLT_PE_DURATION_MASK
);

1338 
lšk_cÚf
->
äame_time_¹s_th
 =

1339 
	`Ë32_g‘_b™s
(
·¿ms
->
he_İ”
->
he_İ”_·¿ms
,

1340 
IEEE80211_HE_OPERATION_RTS_THRESHOLD_MASK
);

1341 
chªged
 |ğ
BSS_CHANGED_HE_OBSS_PD
;

1343 ià(
·¿ms
->
b—cÚ
.
he_bss_cŞÜ
.
’abËd
)

1344 
chªged
 |ğ
BSS_CHANGED_HE_BSS_COLOR
;

1347 ià(
·¿ms
->
he_ÿp
) {

1348 
lšk_cÚf
->
he_ldpc
 =

1349 
·¿ms
->
he_ÿp
->
phy_ÿp_šfo
[1] &

1350 
IEEE80211_HE_PHY_CAP1_LDPC_CODING_IN_PAYLOAD
;

1351 
lšk_cÚf
->
he_su_b—mfÜm”
 =

1352 
·¿ms
->
he_ÿp
->
phy_ÿp_šfo
[3] &

1353 
IEEE80211_HE_PHY_CAP3_SU_BEAMFORMER
;

1354 
lšk_cÚf
->
he_su_b—mfÜm“
 =

1355 
·¿ms
->
he_ÿp
->
phy_ÿp_šfo
[4] &

1356 
IEEE80211_HE_PHY_CAP4_SU_BEAMFORMEE
;

1357 
lšk_cÚf
->
he_mu_b—mfÜm”
 =

1358 
·¿ms
->
he_ÿp
->
phy_ÿp_šfo
[4] &

1359 
IEEE80211_HE_PHY_CAP4_MU_BEAMFORMER
;

1360 
lšk_cÚf
->
he_fuÎ_ul_mumimo
 =

1361 
·¿ms
->
he_ÿp
->
phy_ÿp_šfo
[2] &

1362 
IEEE80211_HE_PHY_CAP2_UL_MU_FULL_MU_MIMO
;

1365 ià(
·¿ms
->
eht_ÿp
) {

1366 ià(!
lšk_cÚf
->
he_suµÜt
)

1367  -
EOPNOTSUPP
;

1369 
lšk_cÚf
->
eht_suµÜt
 = 
Œue
;

1371 
lšk_cÚf
->
eht_su_b—mfÜm”
 =

1372 
·¿ms
->
eht_ÿp
->
fixed
.
phy_ÿp_šfo
[0] &

1373 
IEEE80211_EHT_PHY_CAP0_SU_BEAMFORMER
;

1374 
lšk_cÚf
->
eht_su_b—mfÜm“
 =

1375 
·¿ms
->
eht_ÿp
->
fixed
.
phy_ÿp_šfo
[0] &

1376 
IEEE80211_EHT_PHY_CAP0_SU_BEAMFORMEE
;

1377 
lšk_cÚf
->
eht_mu_b—mfÜm”
 =

1378 
·¿ms
->
eht_ÿp
->
fixed
.
phy_ÿp_šfo
[7] &

1379 (
IEEE80211_EHT_PHY_CAP7_MU_BEAMFORMER_80MHZ
 |

1380 
IEEE80211_EHT_PHY_CAP7_MU_BEAMFORMER_160MHZ
 |

1381 
IEEE80211_EHT_PHY_CAP7_MU_BEAMFORMER_320MHZ
);

1383 
lšk_cÚf
->
eht_su_b—mfÜm”
 = 
çl£
;

1384 
lšk_cÚf
->
eht_su_b—mfÜm“
 = 
çl£
;

1385 
lšk_cÚf
->
eht_mu_b—mfÜm”
 = 
çl£
;

1388 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 &&

1389 
·¿ms
->
mbssid_cÚfig
.
tx_wdev
) {

1390 
”r
 = 
	`›“80211_£t_­_mbssid_İtiÚs
(
sd©a
,

1391 
·¿ms
->
mbssid_cÚfig
,

1392 
lšk_cÚf
);

1393 ià(
”r
)

1394  
”r
;

1397 
”r
 = 
	`›“80211_lšk_u£_chªÃl
(
lšk
, &
chª»q
,

1398 
IEEE80211_CHANCTX_SHARED
);

1399 ià(!
”r
)

1400 
	`›“80211_lšk_cİy_chªùx_to_vÏns
(
lšk
, 
çl£
);

1401 ià(
”r
) {

1402 
lšk_cÚf
->
b—cÚ_št
 = 
´ev_b—cÚ_št
;

1403  
”r
;

1410 
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 = 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_‘h”ty³
;

1411 
sd©a
->
cÚŒŞ_pÜt_no_’üy±
 = 
·¿ms
->
üy±o
.control_port_no_encrypt;

1412 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
 =

1413 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_ov”_Æ80211
;

1414 
sd©a
->
cÚŒŞ_pÜt_no_´—uth
 =

1415 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_no_´—uth
;

1417 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
) {

1418 
vÏn
->
cÚŒŞ_pÜt_´ÙocŞ
 =

1419 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_‘h”ty³
;

1420 
vÏn
->
cÚŒŞ_pÜt_no_’üy±
 =

1421 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_no_’üy±
;

1422 
vÏn
->
cÚŒŞ_pÜt_ov”_Æ80211
 =

1423 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_ov”_Æ80211
;

1424 
vÏn
->
cÚŒŞ_pÜt_no_´—uth
 =

1425 
·¿ms
->
üy±o
.
cÚŒŞ_pÜt_no_´—uth
;

1428 
lšk_cÚf
->
dtim_³riod
 = 
·¿ms
->dtim_period;

1429 
lšk_cÚf
->
’abË_b—cÚ
 = 
Œue
;

1430 
lšk_cÚf
->
®low_p2p_go_ps
 = 
sd©a
->
vif
.
p2p
;

1431 
lšk_cÚf
->
twt_»¥Úd”
 = 
·¿ms
->twt_responder;

1432 
lšk_cÚf
->
he_obss_pd
 = 
·¿ms
->he_obss_pd;

1433 
lšk_cÚf
->
he_bss_cŞÜ
 = 
·¿ms
->
b—cÚ
.he_bss_color;

1434 
sd©a
->
vif
.
cfg
.
s1g
 = 
·¿ms
->
chªdef
.
chª
->
bªd
 ==

1435 
NL80211_BAND_S1GHZ
;

1437 
sd©a
->
vif
.
cfg
.
ssid_Ën
 = 
·¿ms
->ssid_len;

1438 ià(
·¿ms
->
ssid_Ën
)

1439 
	`memıy
(
sd©a
->
vif
.
cfg
.
ssid
, 
·¿ms
->ssid,

1440 
·¿ms
->
ssid_Ën
);

1441 
lšk_cÚf
->
hidd’_ssid
 =

1442 (
·¿ms
->
hidd’_ssid
 !ğ
NL80211_HIDDEN_SSID_NOT_IN_USE
);

1444 
	`mem£t
(&
lšk_cÚf
->
p2p_nß_©Œ
, 0,

1445 (
lšk_cÚf
->
p2p_nß_©Œ
));

1446 
lšk_cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
 =

1447 
·¿ms
->
p2p_ùwšdow
 & 
IEEE80211_P2P_OPPPS_CTWINDOW_MASK
;

1448 ià(
·¿ms
->
p2p_İp_ps
)

1449 
lšk_cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
 |=

1450 
IEEE80211_P2P_OPPPS_ENABLE_BIT
;

1452 
sd©a
->
b—cÚ_¿‹_£t
 = 
çl£
;

1453 ià(
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
,

1454 
NL80211_EXT_FEATURE_BEACON_RATE_LEGACY
)) {

1455 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

1456 
sd©a
->
b—cÚ_¿‹idx_mask
[
i
] =

1457 
·¿ms
->
b—cÚ_¿‹
.
cÚŒŞ
[
i
].
Ëgacy
;

1458 ià(
sd©a
->
b—cÚ_¿‹idx_mask
[
i
])

1459 
sd©a
->
b—cÚ_¿‹_£t
 = 
Œue
;

1463 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
))

1464 
lšk_cÚf
->
b—cÚ_tx_¿‹
 = 
·¿ms
->
b—cÚ_¿‹
;

1466 
”r
 = 
	`›“80211_assign_b—cÚ
(
sd©a
, 
lšk
, &
·¿ms
->
b—cÚ
, 
NULL
, NULL,

1467 &
chªged
);

1468 ià(
”r
 < 0)

1469 
”rÜ
;

1471 
”r
 = 
	`›“80211_£t_fs_discov”y
(
sd©a
, &
·¿ms
->
fs_discov”y
,

1472 
lšk
, 
lšk_cÚf
, &
chªged
);

1473 ià(
”r
 < 0)

1474 
”rÜ
;

1476 
”r
 = 
	`›“80211_£t_unsŞ_bÿ¡_´obe_»¥
(
sd©a
,

1477 &
·¿ms
->
unsŞ_bÿ¡_´obe_»¥
,

1478 
lšk
, 
lšk_cÚf
, &
chªged
);

1479 ià(
”r
 < 0)

1480 
”rÜ
;

1482 
”r
 = 
	`drv_¡¬t_­
(
sd©a
->
loÿl
, sd©a, 
lšk_cÚf
);

1483 ià(
”r
) {

1484 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
);

1486 ià(
Şd
)

1487 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

1488 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
b—cÚ
, 
NULL
);

1489 
sd©a
->
u
.
­
.
aùive
 = 
çl£
;

1490 
”rÜ
;

1493 
	`›“80211_»ÿlc_dtim
(
loÿl
, 
sd©a
);

1494 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_SSID
);

1495 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

1497 ià(
	`›“80211_num_b—cÚšg_lšks
(
sd©a
) <= 1)

1498 
	`Ãtif_ÿ¼›r_Ú
(
dev
);

1500 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
)

1501 
	`Ãtif_ÿ¼›r_Ú
(
vÏn
->
dev
);

1505 
”rÜ
:

1506 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

1508  
”r
;

1509 
	}
}

1511 
	$›“80211_chªge_b—cÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

1512 
cfg80211_­_upd©e
 *
·¿ms
)

1515 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1516 
›“80211_lšk_d©a
 *
lšk
;

1517 
cfg80211_b—cÚ_d©a
 *
b—cÚ
 = &
·¿ms
->beacon;

1518 
b—cÚ_d©a
 *
Şd
;

1519 
”r
;

1520 
›“80211_bss_cÚf
 *
lšk_cÚf
;

1521 
u64
 
chªged
 = 0;

1523 
	`lockd•_as£¹_why
(
why
);

1525 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
b—cÚ
->
lšk_id
], sdata);

1526 ià(!
lšk
)

1527  -
ENOLINK
;

1529 
lšk_cÚf
 = 
lšk
->
cÚf
;

1534 ià(
lšk_cÚf
->
c§_aùive
 ||†šk_cÚf->
cŞÜ_chªge_aùive
)

1535  -
EBUSY
;

1537 
Şd
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
);

1538 ià(!
Şd
)

1539  -
ENOENT
;

1541 
”r
 = 
	`›“80211_assign_b—cÚ
(
sd©a
, 
lšk
, 
b—cÚ
, 
NULL
, NULL,

1542 &
chªged
);

1543 ià(
”r
 < 0)

1544  
”r
;

1546 
”r
 = 
	`›“80211_£t_fs_discov”y
(
sd©a
, &
·¿ms
->
fs_discov”y
,

1547 
lšk
, 
lšk_cÚf
, &
chªged
);

1548 ià(
”r
 < 0)

1549  
”r
;

1551 
”r
 = 
	`›“80211_£t_unsŞ_bÿ¡_´obe_»¥
(
sd©a
,

1552 &
·¿ms
->
unsŞ_bÿ¡_´obe_»¥
,

1553 
lšk
, 
lšk_cÚf
, &
chªged
);

1554 ià(
”r
 < 0)

1555  
”r
;

1557 ià(
b—cÚ
->
he_bss_cŞÜ_v®id
 &&

1558 
b—cÚ
->
he_bss_cŞÜ
.
’abËd
 !ğ
lšk_cÚf
->he_bss_color.enabled) {

1559 
lšk_cÚf
->
he_bss_cŞÜ
.
’abËd
 = 
b—cÚ
->he_bss_color.enabled;

1560 
chªged
 |ğ
BSS_CHANGED_HE_BSS_COLOR
;

1563 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

1565 
	}
}

1567 
	$›“80211_ä“_Ãxt_b—cÚ
(
›“80211_lšk_d©a
 *
lšk
)

1569 ià(!
lšk
->
u
.
­
.
Ãxt_b—cÚ
)

1572 
	`kä“
(
lšk
->
u
.
­
.
Ãxt_b—cÚ
->
mbssid_›s
);

1573 
	`kä“
(
lšk
->
u
.
­
.
Ãxt_b—cÚ
->
ºr_›s
);

1574 
	`kä“
(
lšk
->
u
.
­
.
Ãxt_b—cÚ
);

1575 
lšk
->
u
.
­
.
Ãxt_b—cÚ
 = 
NULL
;

1576 
	}
}

1578 
	$›“80211_¡İ_­
(
why
 *why, 
Ãt_deviû
 *
dev
,

1579 
lšk_id
)

1581 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1582 
›“80211_sub_if_d©a
 *
vÏn
;

1583 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1584 
b—cÚ_d©a
 *
Şd_b—cÚ
;

1585 
´obe_»¥
 *
Şd_´obe_»¥
;

1586 
fs_discov”y_d©a
 *
Şd_fs_discov”y
;

1587 
unsŞ_bÿ¡_´obe_»¥_d©a
 *
Şd_unsŞ_bÿ¡_´obe_»¥
;

1588 
cfg80211_chª_def
 
chªdef
;

1589 
›“80211_lšk_d©a
 *
lšk
 =

1590 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
], sdata);

1591 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1592 
	`LIST_HEAD
(
keys
);

1594 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1596 
Şd_b—cÚ
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
);

1597 ià(!
Şd_b—cÚ
)

1598  -
ENOENT
;

1599 
Şd_´obe_»¥
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
´obe_»¥
,

1600 
sd©a
);

1601 
Şd_fs_discov”y
 = 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
fs_discov”y
,

1602 
sd©a
);

1603 
Şd_unsŞ_bÿ¡_´obe_»¥
 =

1604 
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
unsŞ_bÿ¡_´obe_»¥
,

1605 
sd©a
);

1608 
lšk_cÚf
->
c§_aùive
 = 
çl£
;

1609 
lšk_cÚf
->
cŞÜ_chªge_aùive
 = 
çl£
;

1610 ià(
sd©a
->
c§_blocked_tx
) {

1611 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

1612 
IEEE80211_QUEUE_STOP_REASON_CSA
);

1613 
sd©a
->
c§_blocked_tx
 = 
çl£
;

1616 
	`›“80211_ä“_Ãxt_b—cÚ
(
lšk
);

1619 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
)

1620 
	`Ãtif_ÿ¼›r_off
(
vÏn
->
dev
);

1622 ià(
	`›“80211_num_b—cÚšg_lšks
(
sd©a
) <= 1)

1623 
	`Ãtif_ÿ¼›r_off
(
dev
);

1626 
sd©a
->
u
.
­
.
aùive
 = 
çl£
;

1627 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
b—cÚ
, 
NULL
);

1628 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
´obe_»¥
, 
NULL
);

1629 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
fs_discov”y
, 
NULL
);

1630 
	`RCU_INIT_POINTER
(
lšk
->
u
.
­
.
unsŞ_bÿ¡_´obe_»¥
, 
NULL
);

1631 
	`kä“_rcu
(
Şd_b—cÚ
, 
rcu_h—d
);

1632 ià(
Şd_´obe_»¥
)

1633 
	`kä“_rcu
(
Şd_´obe_»¥
, 
rcu_h—d
);

1634 ià(
Şd_fs_discov”y
)

1635 
	`kä“_rcu
(
Şd_fs_discov”y
, 
rcu_h—d
);

1636 ià(
Şd_unsŞ_bÿ¡_´obe_»¥
)

1637 
	`kä“_rcu
(
Şd_unsŞ_bÿ¡_´obe_»¥
, 
rcu_h—d
);

1639 
	`kä“
(
lšk_cÚf
->
ámr_·¿ms
);

1640 
lšk_cÚf
->
ámr_·¿ms
 = 
NULL
;

1642 
sd©a
->
vif
.
mbssid_tx_vif
 = 
NULL
;

1643 
lšk_cÚf
->
bssid_šdex
 = 0;

1644 
lšk_cÚf
->
nÚŒªsm™‹d
 = 
çl£
;

1645 
lšk_cÚf
->
ema_­
 = 
çl£
;

1646 
lšk_cÚf
->
bssid_šdiÿtÜ
 = 0;

1648 
	`__¡a_šfo_æush
(
sd©a
, 
Œue
, 
lšk_id
);

1650 
	`›“80211_»move_lšk_keys
(
lšk
, &
keys
);

1651 ià(!
	`li¡_em±y
(&
keys
)) {

1652 
	`synchrÚize_Ãt
();

1653 
	`›“80211_ä“_key_li¡
(
loÿl
, &
keys
);

1656 
lšk_cÚf
->
’abË_b—cÚ
 = 
çl£
;

1657 
sd©a
->
b—cÚ_¿‹_£t
 = 
çl£
;

1658 
sd©a
->
vif
.
cfg
.
ssid_Ën
 = 0;

1659 
	`ş—r_b™
(
SDATA_STATE_OFFCHANNEL_BEACON_STOPPED
, &
sd©a
->
¡©e
);

1660 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

1661 
BSS_CHANGED_BEACON_ENABLED
);

1663 ià(
sd©a
->
wdev
.
ÿc_¡¬‹d
) {

1664 
chªdef
 = 
lšk_cÚf
->
chª»q
.
İ”
;

1665 
	`why_d–ayed_wÜk_ÿnûl
(
why
, &
lšk
->
dfs_ÿc_tim”_wÜk
);

1666 
	`cfg80211_ÿc_ev’t
(
sd©a
->
dev
, &
chªdef
,

1667 
NL80211_RADAR_CAC_ABORTED
,

1668 
GFP_KERNEL
);

1671 
	`drv_¡İ_­
(
sd©a
->
loÿl
, sd©a, 
lšk_cÚf
);

1674 
loÿl
->
tÙ®_ps_bufã»d
 -ğ
	`skb_queue_Ën
(&
sd©a
->
u
.
­
.
ps
.
bc_buf
);

1675 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
, &
sd©a
->
u
.
­
.
ps
.
bc_buf
);

1677 
	`›“80211_lšk_cİy_chªùx_to_vÏns
(
lšk
, 
Œue
);

1678 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

1681 
	}
}

1683 
	$¡a_­¶y_auth_æags
(
›“80211_loÿl
 *
loÿl
,

1684 
¡a_šfo
 *
¡a
,

1685 
u32
 
mask
, u32 
£t
)

1687 
»t
;

1689 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
) &&

1690 
£t
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
) &&

1691 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTH
)) {

1692 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTH
);

1693 ià(
»t
)

1694  
»t
;

1697 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
) &&

1698 
£t
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
) &&

1699 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_ASSOC
)) {

1705 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_RATE_CONTROL
))

1706 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

1708 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
);

1709 ià(
»t
)

1710  
»t
;

1713 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
)) {

1714 ià(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
))

1715 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTHORIZED
);

1716 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

1717 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
);

1719 
»t
 = 0;

1720 ià(
»t
)

1721  
»t
;

1724 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
) &&

1725 !(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
)) &&

1726 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_ASSOC
)) {

1727 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTH
);

1728 ià(
»t
)

1729  
»t
;

1732 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
) &&

1733 !(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
)) &&

1734 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTH
)) {

1735 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_NONE
);

1736 ià(
»t
)

1737  
»t
;

1741 
	}
}

1743 
	$¡a_­¶y_mesh_·¿ms
(
›“80211_loÿl
 *
loÿl
,

1744 
¡a_šfo
 *
¡a
,

1745 
¡©iÚ_·¿m‘”s
 *
·¿ms
)

1747 #ifdeà
CONFIG_MAC80211_MESH


1748 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1749 
u64
 
chªged
 = 0;

1751 ià(
·¿ms
->
¡a_modify_mask
 & 
STATION_PARAM_APPLY_PLINK_STATE
) {

1752 
·¿ms
->
¶šk_¡©e
) {

1753 
NL80211_PLINK_ESTAB
:

1754 ià(
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
)

1755 
chªged
 = 
	`mesh_¶šk_šc_e¡ab_couÁ
(
sd©a
);

1756 
¡a
->
mesh
->
¶šk_¡©e
 = 
·¿ms
->plink_state;

1757 
¡a
->
mesh
->
aid
 = 
·¿ms
->
³”_aid
;

1759 
	`›“80211_mps_¡a_¡©us_upd©e
(
¡a
);

1760 
chªged
 |ğ
	`›“80211_mps_£t_¡a_loÿl_pm
(
¡a
,

1761 
sd©a
->
u
.
mesh
.
mshcfg
.
pow”_mode
);

1763 
	`ewma_mesh_tx_¿‹_avg_š™
(&
¡a
->
mesh
->
tx_¿‹_avg
);

1765 
	`ewma_mesh_tx_¿‹_avg_add
(&
¡a
->
mesh
->
tx_¿‹_avg
, 10);

1768 
NL80211_PLINK_LISTEN
:

1769 
NL80211_PLINK_BLOCKED
:

1770 
NL80211_PLINK_OPN_SNT
:

1771 
NL80211_PLINK_OPN_RCVD
:

1772 
NL80211_PLINK_CNF_RCVD
:

1773 
NL80211_PLINK_HOLDING
:

1774 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

1775 
chªged
 = 
	`mesh_¶šk_dec_e¡ab_couÁ
(
sd©a
);

1776 
¡a
->
mesh
->
¶šk_¡©e
 = 
·¿ms
->plink_state;

1778 
	`›“80211_mps_¡a_¡©us_upd©e
(
¡a
);

1779 
chªged
 |ğ
	`›“80211_mps_£t_¡a_loÿl_pm
(
¡a
,

1780 
NL80211_MESH_POWER_UNKNOWN
);

1788 
·¿ms
->
¶šk_aùiÚ
) {

1789 
NL80211_PLINK_ACTION_NO_ACTION
:

1792 
NL80211_PLINK_ACTION_OPEN
:

1793 
chªged
 |ğ
	`mesh_¶šk_İ’
(
¡a
);

1795 
NL80211_PLINK_ACTION_BLOCK
:

1796 
chªged
 |ğ
	`mesh_¶šk_block
(
¡a
);

1800 ià(
·¿ms
->
loÿl_pm
)

1801 
chªged
 |ğ
	`›“80211_mps_£t_¡a_loÿl_pm
(
¡a
,

1802 
·¿ms
->
loÿl_pm
);

1804 
	`›“80211_mbss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

1806 
	}
}

1808 
	$¡a_lšk_­¶y_·¿m‘”s
(
›“80211_loÿl
 *
loÿl
,

1809 
¡a_šfo
 *
¡a
, 
boŞ
 
Ãw_lšk
,

1810 
lšk_¡©iÚ_·¿m‘”s
 *
·¿ms
)

1812 
»t
 = 0;

1813 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1814 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1815 
u32
 
lšk_id
 = 
·¿ms
->link_id < 0 ? 0 :…arams->link_id;

1816 
›“80211_lšk_d©a
 *
lšk
 =

1817 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
], sdata);

1818 
lšk_¡a_šfo
 *
lšk_¡a
 =

1819 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
lšk_id
],

1820 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1826 ià(
·¿ms
->
lšk_id
 >ğ0 && !
Ãw_lšk
 &&

1827 !
·¿ms
->
lšk_mac
 && !·¿ms->
txpwr_£t
 &&

1828 !
·¿ms
->
suµÜ‹d_¿‹s_Ën
 &&

1829 !
·¿ms
->
ht_ÿ·
 && !·¿ms->
vht_ÿ·
 &&

1830 !
·¿ms
->
he_ÿ·
 && !·¿ms->
eht_ÿ·
 &&

1831 !
·¿ms
->
İmode_nÙif_u£d
)

1834 ià(!
lšk
 || !
lšk_¡a
)

1835  -
EINVAL
;

1837 
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

1838 ià(!
sbªd
)

1839  -
EINVAL
;

1841 ià(
·¿ms
->
lšk_mac
) {

1842 ià(
Ãw_lšk
) {

1843 
	`memıy
(
lšk_¡a
->
addr
, 
·¿ms
->
lšk_mac
, 
ETH_ALEN
);

1844 
	`memıy
(
lšk_¡a
->
pub
->
addr
, 
·¿ms
->
lšk_mac
, 
ETH_ALEN
);

1845 } ià(!
	`‘h”_addr_equ®
(
lšk_¡a
->
addr
,

1846 
·¿ms
->
lšk_mac
)) {

1847  -
EINVAL
;

1849 } ià(
Ãw_lšk
) {

1850  -
EINVAL
;

1853 ià(
·¿ms
->
txpwr_£t
) {

1854 
lšk_¡a
->
pub
->
txpwr
.
ty³
 = 
·¿ms
->txpwr.type;

1855 ià(
·¿ms
->
txpwr
.
ty³
 =ğ
NL80211_TX_POWER_LIMITED
)

1856 
lšk_¡a
->
pub
->
txpwr
.
pow”
 = 
·¿ms
->txpwr.power;

1857 
»t
 = 
	`drv_¡a_£t_txpwr
(
loÿl
, 
sd©a
, 
¡a
);

1858 ià(
»t
)

1859  
»t
;

1862 ià(
·¿ms
->
suµÜ‹d_¿‹s
 &&

1863 
·¿ms
->
suµÜ‹d_¿‹s_Ën
) {

1864 
	`›“80211_·r£_b™¿‹s
(
lšk
->
cÚf
->
chª»q
.
İ”
.
width
,

1865 
sbªd
, 
·¿ms
->
suµÜ‹d_¿‹s
,

1866 
·¿ms
->
suµÜ‹d_¿‹s_Ën
,

1867 &
lšk_¡a
->
pub
->
suµ_¿‹s
[
sbªd
->
bªd
]);

1870 ià(
·¿ms
->
ht_ÿ·
)

1871 
	`›“80211_ht_ÿp_›_to_¡a_ht_ÿp
(
sd©a
, 
sbªd
,

1872 
·¿ms
->
ht_ÿ·
, 
lšk_¡a
);

1875 ià(
·¿ms
->
vht_ÿ·
)

1876 
	`›“80211_vht_ÿp_›_to_¡a_vht_ÿp
(
sd©a
, 
sbªd
,

1877 
·¿ms
->
vht_ÿ·
, 
NULL
,

1878 
lšk_¡a
);

1880 ià(
·¿ms
->
he_ÿ·
)

1881 
	`›“80211_he_ÿp_›_to_¡a_he_ÿp
(
sd©a
, 
sbªd
,

1882 (*)
·¿ms
->
he_ÿ·
,

1883 
·¿ms
->
he_ÿ·_Ën
,

1884 (*)
·¿ms
->
he_6ghz_ÿ·
,

1885 
lšk_¡a
);

1887 ià(
·¿ms
->
he_ÿ·
 &&…¬ams->
eht_ÿ·
)

1888 
	`›“80211_eht_ÿp_›_to_¡a_eht_ÿp
(
sd©a
, 
sbªd
,

1889 (
u8
 *)
·¿ms
->
he_ÿ·
,

1890 
·¿ms
->
he_ÿ·_Ën
,

1891 
·¿ms
->
eht_ÿ·
,

1892 
·¿ms
->
eht_ÿ·_Ën
,

1893 
lšk_¡a
);

1895 ià(
·¿ms
->
İmode_nÙif_u£d
) {

1899 
	`__›“80211_vht_hªdË_İmode
(
sd©a
, 
lšk_¡a
,

1900 
·¿ms
->
İmode_nÙif
,

1901 
sbªd
->
bªd
);

1904 
	`›“80211_¡a_š™_nss
(
lšk_¡a
);

1906  
»t
;

1907 
	}
}

1909 
	$¡a_­¶y_·¿m‘”s
(
›“80211_loÿl
 *
loÿl
,

1910 
¡a_šfo
 *
¡a
,

1911 
¡©iÚ_·¿m‘”s
 *
·¿ms
)

1913 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1914 
u32
 
mask
, 
£t
;

1915 
»t
 = 0;

1917 
mask
 = 
·¿ms
->
¡a_æags_mask
;

1918 
£t
 = 
·¿ms
->
¡a_æags_£t
;

1920 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

1925 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
))

1926 
mask
 |ğ
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
);

1927 ià(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
))

1928 
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
);

1929 } ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
)) {

1935 ià(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
)) {

1936 
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
) |

1937 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
);

1938 
mask
 |ğ
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
) |

1939 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
);

1943 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_WME
) &&

1944 
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
)

1945 
¡a
->¡a.
wme
 = 
£t
 & 
	`BIT
(
NL80211_STA_FLAG_WME
);

1949 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
) &&

1950 !((
mask
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
)) &&

1951 (
£t
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
)))) {

1952 
»t
 = 
	`¡a_­¶y_auth_æags
(
loÿl
, 
¡a
, 
mask
, 
£t
);

1953 ià(
»t
)

1954  
»t
;

1957 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_SHORT_PREAMBLE
)) {

1958 ià(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_SHORT_PREAMBLE
))

1959 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_SHORT_PREAMBLE
);

1961 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_SHORT_PREAMBLE
);

1964 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_MFP
)) {

1965 
¡a
->¡a.
må
 = !!(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_MFP
));

1966 ià(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_MFP
))

1967 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_MFP
);

1969 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_MFP
);

1972 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_TDLS_PEER
)) {

1973 ià(
£t
 & 
	`BIT
(
NL80211_STA_FLAG_TDLS_PEER
))

1974 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
);

1976 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
);

1979 ià(
mask
 & 
	`BIT
(
NL80211_STA_FLAG_SPP_AMSDU
))

1980 
¡a
->¡a.
¥p_amsdu
 = 
£t
 & 
	`BIT
(
NL80211_STA_FLAG_SPP_AMSDU
);

1983 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
) &&

1984 !
sd©a
->
deæšk
.
u
.
mgd
.
tdls_chª_sw™ch_´ohib™ed
 &&

1985 
·¿ms
->
ext_ÿ·b_Ën
 >= 4 &&

1986 
·¿ms
->
ext_ÿ·b
[3] & 
WLAN_EXT_CAPA4_TDLS_CHAN_SWITCH
)

1987 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_CHAN_SWITCH
);

1989 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
) &&

1990 !
sd©a
->
u
.
mgd
.
tdls_wid”_bw_´ohib™ed
 &&

1991 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TDLS_WIDER_BW
) &&

1992 
·¿ms
->
ext_ÿ·b_Ën
 >= 8 &&

1993 
·¿ms
->
ext_ÿ·b
[7] & 
WLAN_EXT_CAPA8_TDLS_WIDE_BW_ENABLED
)

1994 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_WIDER_BW
);

1996 ià(
·¿ms
->
¡a_modify_mask
 & 
STATION_PARAM_APPLY_UAPSD
) {

1997 
¡a
->¡a.
u­sd_queues
 = 
·¿ms
->uapsd_queues;

1998 
¡a
->¡a.
max_¥
 = 
·¿ms
->max_sp;

2001 
	`›“80211_¡a_£t_max_amsdu_subäames
(
¡a
, 
·¿ms
->
ext_ÿ·b
,

2002 
·¿ms
->
ext_ÿ·b_Ën
);

2008 ià(
·¿ms
->
aid
)

2009 
¡a
->¡a.
aid
 = 
·¿ms
->aid;

2019 ià(
·¿ms
->
li¡’_š‹rv®
 >= 0)

2020 
¡a
->
li¡’_š‹rv®
 = 
·¿ms
->listen_interval;

2022 
»t
 = 
	`¡a_lšk_­¶y_·¿m‘”s
(
loÿl
, 
¡a
, 
çl£
,

2023 &
·¿ms
->
lšk_¡a_·¿ms
);

2024 ià(
»t
)

2025  
»t
;

2027 ià(
·¿ms
->
suµÜt_p2p_ps
 >= 0)

2028 
¡a
->¡a.
suµÜt_p2p_ps
 = 
·¿ms
->support_p2p_ps;

2030 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

2031 
	`¡a_­¶y_mesh_·¿ms
(
loÿl
, 
¡a
, 
·¿ms
);

2033 ià(
·¿ms
->
aœtime_weight
)

2034 
¡a
->
aœtime_weight
 = 
·¿ms
->airtime_weight;

2037 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
) ||

2038 
£t
 & 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
)) {

2039 
»t
 = 
	`¡a_­¶y_auth_æags
(
loÿl
, 
¡a
, 
mask
, 
£t
);

2040 ià(
»t
)

2041  
»t
;

2045 ià(
·¿ms
->
lšk_¡a_·¿ms
.
mld_mac
)

2046 
¡a
->¡a.
mlo
 = 
Œue
;

2049 
	}
}

2051 
	$›“80211_add_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

2052 cÚ¡ 
u8
 *
mac
,

2053 
¡©iÚ_·¿m‘”s
 *
·¿ms
)

2055 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

2056 
¡a_šfo
 *
¡a
;

2057 
›“80211_sub_if_d©a
 *
sd©a
;

2058 
”r
;

2060 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2062 ià(
·¿ms
->
vÏn
) {

2063 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
·¿ms
->
vÏn
);

2065 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

2066 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

2067  -
EINVAL
;

2069 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2071 ià(
	`‘h”_addr_equ®
(
mac
, 
sd©a
->
vif
.
addr
))

2072  -
EINVAL
;

2074 ià(!
	`is_v®id_‘h”_addr
(
mac
))

2075  -
EINVAL
;

2077 ià(
·¿ms
->
¡a_æags_£t
 & 
	`BIT
(
NL80211_STA_FLAG_TDLS_PEER
) &&

2078 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

2079 !
sd©a
->
u
.
mgd
.
assocŸ‹d
)

2080  -
EINVAL
;

2087 ià(
·¿ms
->
lšk_¡a_·¿ms
.
lšk_id
 >= 0)

2088 
¡a
 = 
	`¡a_šfo_®loc_w™h_lšk
(
sd©a
, 
mac
,

2089 
·¿ms
->
lšk_¡a_·¿ms
.
lšk_id
,

2090 
·¿ms
->
lšk_¡a_·¿ms
.
lšk_mac
 ?: 
mac
,

2091 
GFP_KERNEL
);

2093 
¡a
 = 
	`¡a_šfo_®loc
(
sd©a
, 
mac
, 
GFP_KERNEL
);

2095 ià(!
¡a
)

2096  -
ENOMEM
;

2098 ià(
·¿ms
->
¡a_æags_£t
 & 
	`BIT
(
NL80211_STA_FLAG_TDLS_PEER
))

2099 
¡a
->¡a.
tdls
 = 
Œue
;

2105 
”r
 = 
	`¡a_­¶y_·¿m‘”s
(
loÿl
, 
¡a
, 
·¿ms
);

2106 ià(
”r
) {

2107 
	`¡a_šfo_ä“
(
loÿl
, 
¡a
);

2108  
”r
;

2116 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
) &&

2117 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_ASSOC
))

2118 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

2120  
	`¡a_šfo_š£¹
(
¡a
);

2121 
	}
}

2123 
	$›“80211_d–_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

2124 
¡©iÚ_d–_·¿m‘”s
 *
·¿ms
)

2126 
›“80211_sub_if_d©a
 *
sd©a
;

2128 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2130 ià(
·¿ms
->
mac
)

2131  
	`¡a_šfo_de¡roy_addr_bss
(
sd©a
, 
·¿ms
->
mac
);

2133 
	`¡a_šfo_æush
(
sd©a
, 
·¿ms
->
lšk_id
);

2135 
	}
}

2137 
	$›“80211_chªge_¡©iÚ
(
why
 *wiphy,

2138 
Ãt_deviû
 *
dev
, cÚ¡ 
u8
 *
mac
,

2139 
¡©iÚ_·¿m‘”s
 *
·¿ms
)

2141 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2142 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

2143 
¡a_šfo
 *
¡a
;

2144 
›“80211_sub_if_d©a
 *
vÏnsd©a
;

2145 
cfg80211_¡©iÚ_ty³
 
¡©y³
;

2146 
”r
;

2148 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2150 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mac
);

2151 ià(!
¡a
)

2152  -
ENOENT
;

2154 
sd©a
->
vif
.
ty³
) {

2155 
NL80211_IFTYPE_MESH_POINT
:

2156 ià(
sd©a
->
u
.
mesh
.
u£r_mpm
)

2157 
¡©y³
 = 
CFG80211_STA_MESH_PEER_USER
;

2159 
¡©y³
 = 
CFG80211_STA_MESH_PEER_KERNEL
;

2161 
NL80211_IFTYPE_ADHOC
:

2162 
¡©y³
 = 
CFG80211_STA_IBSS
;

2164 
NL80211_IFTYPE_STATION
:

2165 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
)) {

2166 
¡©y³
 = 
CFG80211_STA_AP_STA
;

2169 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

2170 
¡©y³
 = 
CFG80211_STA_TDLS_PEER_ACTIVE
;

2172 
¡©y³
 = 
CFG80211_STA_TDLS_PEER_SETUP
;

2174 
NL80211_IFTYPE_AP
:

2175 
NL80211_IFTYPE_AP_VLAN
:

2176 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_ASSOC
))

2177 
¡©y³
 = 
CFG80211_STA_AP_CLIENT
;

2179 
¡©y³
 = 
CFG80211_STA_AP_CLIENT_UNASSOC
;

2182  -
EOPNOTSUPP
;

2185 
”r
 = 
	`cfg80211_check_¡©iÚ_chªge
(
why
, 
·¿ms
, 
¡©y³
);

2186 ià(
”r
)

2187  
”r
;

2189 ià(
·¿ms
->
vÏn
 &&…¬ams->vÏÀ!ğ
¡a
->
sd©a
->
dev
) {

2190 
vÏnsd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
·¿ms
->
vÏn
);

2192 ià(
·¿ms
->
vÏn
->
›“80211_±r
->
u£_4addr
) {

2193 ià(
vÏnsd©a
->
u
.
vÏn
.
¡a
)

2194  -
EBUSY
;

2196 
	`rcu_assign_poš‹r
(
vÏnsd©a
->
u
.
vÏn
.
¡a
, sta);

2197 
	`__›“80211_check_ç¡_rx_içû
(
vÏnsd©a
);

2198 
	`drv_¡a_£t_4addr
(
loÿl
, 
¡a
->
sd©a
, &¡a->¡a, 
Œue
);

2201 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

2202 
¡a
->
sd©a
->
u
.
vÏn
.sta)

2203 
	`RCU_INIT_POINTER
(
¡a
->
sd©a
->
u
.
vÏn
.¡a, 
NULL
);

2205 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

2206 
	`›“80211_vif_dec_num_mÿ¡
(
¡a
->
sd©a
);

2208 
¡a
->
sd©a
 = 
vÏnsd©a
;

2209 
	`›“80211_check_ç¡_rx
(
¡a
);

2210 
	`›“80211_check_ç¡_xm™
(
¡a
);

2212 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
)) {

2213 
	`›“80211_vif_šc_num_mÿ¡
(
¡a
->
sd©a
);

2214 
	`cfg80211_£nd_Ïy”2_upd©e
(
¡a
->
sd©a
->
dev
,

2215 
¡a
->¡a.
addr
);

2219 
”r
 = 
	`¡a_­¶y_·¿m‘”s
(
loÿl
, 
¡a
, 
·¿ms
);

2220 ià(
”r
)

2221  
”r
;

2223 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

2224 
·¿ms
->
¡a_æags_mask
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
)) {

2225 
	`›“80211_»ÿlc_ps
(
loÿl
);

2226 
	`›“80211_»ÿlc_ps_vif
(
sd©a
);

2230 
	}
}

2232 #ifdeà
CONFIG_MAC80211_MESH


2233 
	$›“80211_add_m·th
(
why
 *why, 
Ãt_deviû
 *
dev
,

2234 cÚ¡ 
u8
 *
d¡
, cÚ¡ u8 *
Ãxt_hİ
)

2236 
›“80211_sub_if_d©a
 *
sd©a
;

2237 
mesh_·th
 *
m·th
;

2238 
¡a_šfo
 *
¡a
;

2240 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2242 
	`rcu_»ad_lock
();

2243 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
Ãxt_hİ
);

2244 ià(!
¡a
) {

2245 
	`rcu_»ad_uÆock
();

2246  -
ENOENT
;

2249 
m·th
 = 
	`mesh_·th_add
(
sd©a
, 
d¡
);

2250 ià(
	`IS_ERR
(
m·th
)) {

2251 
	`rcu_»ad_uÆock
();

2252  
	`PTR_ERR
(
m·th
);

2255 
	`mesh_·th_fix_Ãxthİ
(
m·th
, 
¡a
);

2257 
	`rcu_»ad_uÆock
();

2259 
	}
}

2261 
	$›“80211_d–_m·th
(
why
 *why, 
Ãt_deviû
 *
dev
,

2262 cÚ¡ 
u8
 *
d¡
)

2264 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2266 ià(
d¡
)

2267  
	`mesh_·th_d–
(
sd©a
, 
d¡
);

2269 
	`mesh_·th_æush_by_içû
(
sd©a
);

2271 
	}
}

2273 
	$›“80211_chªge_m·th
(
why
 *why, 
Ãt_deviû
 *
dev
,

2274 cÚ¡ 
u8
 *
d¡
, cÚ¡ u8 *
Ãxt_hİ
)

2276 
›“80211_sub_if_d©a
 *
sd©a
;

2277 
mesh_·th
 *
m·th
;

2278 
¡a_šfo
 *
¡a
;

2280 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2282 
	`rcu_»ad_lock
();

2284 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
Ãxt_hİ
);

2285 ià(!
¡a
) {

2286 
	`rcu_»ad_uÆock
();

2287  -
ENOENT
;

2290 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
d¡
);

2291 ià(!
m·th
) {

2292 
	`rcu_»ad_uÆock
();

2293  -
ENOENT
;

2296 
	`mesh_·th_fix_Ãxthİ
(
m·th
, 
¡a
);

2298 
	`rcu_»ad_uÆock
();

2300 
	}
}

2302 
	$m·th_£t_pšfo
(
mesh_·th
 *
m·th
, 
u8
 *
Ãxt_hİ
,

2303 
m·th_šfo
 *
pšfo
)

2305 
¡a_šfo
 *
Ãxt_hİ_¡a
 = 
	`rcu_d”eã»nû
(
m·th
->
Ãxt_hİ
);

2307 ià(
Ãxt_hİ_¡a
)

2308 
	`memıy
(
Ãxt_hİ
, 
Ãxt_hİ_¡a
->
¡a
.
addr
, 
ETH_ALEN
);

2310 
	`‘h_z”o_addr
(
Ãxt_hİ
);

2312 
	`mem£t
(
pšfo
, 0, (*pinfo));

2314 
pšfo
->
g’”©iÚ
 = 
m·th
->
sd©a
->
u
.
mesh
.
mesh_·ths_g’”©iÚ
;

2316 
pšfo
->
fËd
 = 
MPATH_INFO_FRAME_QLEN
 |

2317 
MPATH_INFO_SN
 |

2318 
MPATH_INFO_METRIC
 |

2319 
MPATH_INFO_EXPTIME
 |

2320 
MPATH_INFO_DISCOVERY_TIMEOUT
 |

2321 
MPATH_INFO_DISCOVERY_RETRIES
 |

2322 
MPATH_INFO_FLAGS
 |

2323 
MPATH_INFO_HOP_COUNT
 |

2324 
MPATH_INFO_PATH_CHANGE
;

2326 
pšfo
->
äame_qËn
 = 
m·th
->
äame_queue
.
qËn
;

2327 
pšfo
->
¢
 = 
m·th
->sn;

2328 
pšfo
->
m‘ric
 = 
m·th
->metric;

2329 ià(
	`time_befÜe
(
jiff›s
, 
m·th
->
exp_time
))

2330 
pšfo
->
ex±ime
 = 
	`jiff›s_to_m£cs
(
m·th
->
exp_time
 - 
jiff›s
);

2331 
pšfo
->
discov”y_timeout
 =

2332 
	`jiff›s_to_m£cs
(
m·th
->
discov”y_timeout
);

2333 
pšfo
->
discov”y_»Œ›s
 = 
m·th
->discovery_retries;

2334 ià(
m·th
->
æags
 & 
MESH_PATH_ACTIVE
)

2335 
pšfo
->
æags
 |ğ
NL80211_MPATH_FLAG_ACTIVE
;

2336 ià(
m·th
->
æags
 & 
MESH_PATH_RESOLVING
)

2337 
pšfo
->
æags
 |ğ
NL80211_MPATH_FLAG_RESOLVING
;

2338 ià(
m·th
->
æags
 & 
MESH_PATH_SN_VALID
)

2339 
pšfo
->
æags
 |ğ
NL80211_MPATH_FLAG_SN_VALID
;

2340 ià(
m·th
->
æags
 & 
MESH_PATH_FIXED
)

2341 
pšfo
->
æags
 |ğ
NL80211_MPATH_FLAG_FIXED
;

2342 ià(
m·th
->
æags
 & 
MESH_PATH_RESOLVED
)

2343 
pšfo
->
æags
 |ğ
NL80211_MPATH_FLAG_RESOLVED
;

2344 
pšfo
->
hİ_couÁ
 = 
m·th
->hop_count;

2345 
pšfo
->
·th_chªge_couÁ
 = 
m·th
->path_change_count;

2346 
	}
}

2348 
	$›“80211_g‘_m·th
(
why
 *why, 
Ãt_deviû
 *
dev
,

2349 
u8
 *
d¡
, u8 *
Ãxt_hİ
, 
m·th_šfo
 *
pšfo
)

2352 
›“80211_sub_if_d©a
 *
sd©a
;

2353 
mesh_·th
 *
m·th
;

2355 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2357 
	`rcu_»ad_lock
();

2358 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
d¡
);

2359 ià(!
m·th
) {

2360 
	`rcu_»ad_uÆock
();

2361  -
ENOENT
;

2363 
	`memıy
(
d¡
, 
m·th
->d¡, 
ETH_ALEN
);

2364 
	`m·th_£t_pšfo
(
m·th
, 
Ãxt_hİ
, 
pšfo
);

2365 
	`rcu_»ad_uÆock
();

2367 
	}
}

2369 
	$›“80211_dump_m·th
(
why
 *why, 
Ãt_deviû
 *
dev
,

2370 
idx
, 
u8
 *
d¡
, u8 *
Ãxt_hİ
,

2371 
m·th_šfo
 *
pšfo
)

2373 
›“80211_sub_if_d©a
 *
sd©a
;

2374 
mesh_·th
 *
m·th
;

2376 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2378 
	`rcu_»ad_lock
();

2379 
m·th
 = 
	`mesh_·th_lookup_by_idx
(
sd©a
, 
idx
);

2380 ià(!
m·th
) {

2381 
	`rcu_»ad_uÆock
();

2382  -
ENOENT
;

2384 
	`memıy
(
d¡
, 
m·th
->d¡, 
ETH_ALEN
);

2385 
	`m·th_£t_pšfo
(
m·th
, 
Ãxt_hİ
, 
pšfo
);

2386 
	`rcu_»ad_uÆock
();

2388 
	}
}

2390 
	$mµ_£t_pšfo
(
mesh_·th
 *
m·th
, 
u8
 *
mµ
,

2391 
m·th_šfo
 *
pšfo
)

2393 
	`mem£t
(
pšfo
, 0, (*pinfo));

2394 
	`memıy
(
mµ
, 
m·th
->mµ, 
ETH_ALEN
);

2396 
pšfo
->
g’”©iÚ
 = 
m·th
->
sd©a
->
u
.
mesh
.
mµ_·ths_g’”©iÚ
;

2397 
	}
}

2399 
	$›“80211_g‘_mµ
(
why
 *why, 
Ãt_deviû
 *
dev
,

2400 
u8
 *
d¡
, u8 *
mµ
, 
m·th_šfo
 *
pšfo
)

2403 
›“80211_sub_if_d©a
 *
sd©a
;

2404 
mesh_·th
 *
m·th
;

2406 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2408 
	`rcu_»ad_lock
();

2409 
m·th
 = 
	`mµ_·th_lookup
(
sd©a
, 
d¡
);

2410 ià(!
m·th
) {

2411 
	`rcu_»ad_uÆock
();

2412  -
ENOENT
;

2414 
	`memıy
(
d¡
, 
m·th
->d¡, 
ETH_ALEN
);

2415 
	`mµ_£t_pšfo
(
m·th
, 
mµ
, 
pšfo
);

2416 
	`rcu_»ad_uÆock
();

2418 
	}
}

2420 
	$›“80211_dump_mµ
(
why
 *why, 
Ãt_deviû
 *
dev
,

2421 
idx
, 
u8
 *
d¡
, u8 *
mµ
,

2422 
m·th_šfo
 *
pšfo
)

2424 
›“80211_sub_if_d©a
 *
sd©a
;

2425 
mesh_·th
 *
m·th
;

2427 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2429 
	`rcu_»ad_lock
();

2430 
m·th
 = 
	`mµ_·th_lookup_by_idx
(
sd©a
, 
idx
);

2431 ià(!
m·th
) {

2432 
	`rcu_»ad_uÆock
();

2433  -
ENOENT
;

2435 
	`memıy
(
d¡
, 
m·th
->d¡, 
ETH_ALEN
);

2436 
	`mµ_£t_pšfo
(
m·th
, 
mµ
, 
pšfo
);

2437 
	`rcu_»ad_uÆock
();

2439 
	}
}

2441 
	$›“80211_g‘_mesh_cÚfig
(
why
 *wiphy,

2442 
Ãt_deviû
 *
dev
,

2443 
mesh_cÚfig
 *
cÚf
)

2445 
›“80211_sub_if_d©a
 *
sd©a
;

2446 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2448 
	`memıy
(
cÚf
, &(
sd©a
->
u
.
mesh
.
mshcfg
), (
mesh_cÚfig
));

2450 
	}
}

2452 
šlše
 
boŞ
 
	$_chg_mesh_©Œ
(
Æ80211_meshcÚf_·¿ms
 
·rm
, 
u32
 
mask
)

2454  (
mask
 >> (
·rm
-1)) & 0x1;

2455 
	}
}

2457 
	$cİy_mesh_£tup
(
›“80211_if_mesh
 *
ifmsh
,

2458 cÚ¡ 
mesh_£tup
 *
£tup
)

2460 
u8
 *
Ãw_›
;

2461 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`cÚš”_of
(
ifmsh
,

2462 
›“80211_sub_if_d©a
, 
u
.
mesh
);

2463 
i
;

2466 
Ãw_›
 = 
NULL
;

2468 ià(
£tup
->
›_Ën
) {

2469 
Ãw_›
 = 
	`kmemdup
(
£tup
->
›
, s‘up->
›_Ën
,

2470 
GFP_KERNEL
);

2471 ià(!
Ãw_›
)

2472  -
ENOMEM
;

2474 
ifmsh
->
›_Ën
 = 
£tup
->ie_len;

2475 
ifmsh
->
›
 = 
Ãw_›
;

2478 
ifmsh
->
mesh_id_Ën
 = 
£tup
->mesh_id_len;

2479 
	`memıy
(
ifmsh
->
mesh_id
, 
£tup
->mesh_id, ifmsh->
mesh_id_Ën
);

2480 
ifmsh
->
mesh_¥_id
 = 
£tup
->
sync_m‘hod
;

2481 
ifmsh
->
mesh_µ_id
 = 
£tup
->
·th_£l_´Ùo
;

2482 
ifmsh
->
mesh_pm_id
 = 
£tup
->
·th_m‘ric
;

2483 
ifmsh
->
u£r_mpm
 = 
£tup
->user_mpm;

2484 
ifmsh
->
mesh_auth_id
 = 
£tup
->
auth_id
;

2485 
ifmsh
->
£cur™y
 = 
IEEE80211_MESH_SEC_NONE
;

2486 
ifmsh
->
u£r¥aû_hªdËs_dfs
 = 
£tup
->userspace_handles_dfs;

2487 ià(
£tup
->
is_auth’tiÿ‹d
)

2488 
ifmsh
->
£cur™y
 |ğ
IEEE80211_MESH_SEC_AUTHED
;

2489 ià(
£tup
->
is_£cu»
)

2490 
ifmsh
->
£cur™y
 |ğ
IEEE80211_MESH_SEC_SECURED
;

2493 
	`memıy
(
sd©a
->
vif
.
bss_cÚf
.
mÿ¡_¿‹
, 
£tup
->mcast_rate,

2494 (
£tup
->
mÿ¡_¿‹
));

2495 
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
 = 
£tup
->basic_rates;

2497 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
 = 
£tup
->
b—cÚ_š‹rv®
;

2498 
sd©a
->
vif
.
bss_cÚf
.
dtim_³riod
 = 
£tup
->dtim_period;

2500 
sd©a
->
b—cÚ_¿‹_£t
 = 
çl£
;

2501 ià(
	`why_ext_ã©u»_is£t
(
sd©a
->
loÿl
->
hw
.
why
,

2502 
NL80211_EXT_FEATURE_BEACON_RATE_LEGACY
)) {

2503 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

2504 
sd©a
->
b—cÚ_¿‹idx_mask
[
i
] =

2505 
£tup
->
b—cÚ_¿‹
.
cÚŒŞ
[
i
].
Ëgacy
;

2506 ià(
sd©a
->
b—cÚ_¿‹idx_mask
[
i
])

2507 
sd©a
->
b—cÚ_¿‹_£t
 = 
Œue
;

2512 
	}
}

2514 
	$›“80211_upd©e_mesh_cÚfig
(
why
 *wiphy,

2515 
Ãt_deviû
 *
dev
, 
u32
 
mask
,

2516 cÚ¡ 
mesh_cÚfig
 *
ncÚf
)

2518 
mesh_cÚfig
 *
cÚf
;

2519 
›“80211_sub_if_d©a
 *
sd©a
;

2520 
›“80211_if_mesh
 *
ifmsh
;

2522 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2523 
ifmsh
 = &
sd©a
->
u
.
mesh
;

2526 
cÚf
 = &(
sd©a
->
u
.
mesh
.
mshcfg
);

2527 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_RETRY_TIMEOUT
, 
mask
))

2528 
cÚf
->
dÙ11MeshR‘ryTimeout
 = 
ncÚf
->dot11MeshRetryTimeout;

2529 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_CONFIRM_TIMEOUT
, 
mask
))

2530 
cÚf
->
dÙ11MeshCÚfœmTimeout
 = 
ncÚf
->dot11MeshConfirmTimeout;

2531 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HOLDING_TIMEOUT
, 
mask
))

2532 
cÚf
->
dÙ11MeshHŞdšgTimeout
 = 
ncÚf
->dot11MeshHoldingTimeout;

2533 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_MAX_PEER_LINKS
, 
mask
))

2534 
cÚf
->
dÙ11MeshMaxP“rLšks
 = 
ncÚf
->dot11MeshMaxPeerLinks;

2535 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_MAX_RETRIES
, 
mask
))

2536 
cÚf
->
dÙ11MeshMaxR‘r›s
 = 
ncÚf
->dot11MeshMaxRetries;

2537 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_TTL
, 
mask
))

2538 
cÚf
->
dÙ11MeshTTL
 = 
ncÚf
->dot11MeshTTL;

2539 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_ELEMENT_TTL
, 
mask
))

2540 
cÚf
->
–em’t_‰l
 = 
ncÚf
->element_ttl;

2541 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_AUTO_OPEN_PLINKS
, 
mask
)) {

2542 ià(
ifmsh
->
u£r_mpm
)

2543  -
EBUSY
;

2544 
cÚf
->
auto_İ’_¶šks
 = 
ncÚf
->auto_open_plinks;

2546 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_SYNC_OFFSET_MAX_NEIGHBOR
, 
mask
))

2547 
cÚf
->
dÙ11MeshNbrOff£tMaxNeighbÜ
 =

2548 
ncÚf
->
dÙ11MeshNbrOff£tMaxNeighbÜ
;

2549 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_MAX_PREQ_RETRIES
, 
mask
))

2550 
cÚf
->
dÙ11MeshHWMPmaxPREQ»Œ›s
 =

2551 
ncÚf
->
dÙ11MeshHWMPmaxPREQ»Œ›s
;

2552 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_PATH_REFRESH_TIME
, 
mask
))

2553 
cÚf
->
·th_»äesh_time
 = 
ncÚf
->path_refresh_time;

2554 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_MIN_DISCOVERY_TIMEOUT
, 
mask
))

2555 
cÚf
->
mš_discov”y_timeout
 = 
ncÚf
->min_discovery_timeout;

2556 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_ACTIVE_PATH_TIMEOUT
, 
mask
))

2557 
cÚf
->
dÙ11MeshHWMPaùiveP©hTimeout
 =

2558 
ncÚf
->
dÙ11MeshHWMPaùiveP©hTimeout
;

2559 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_PREQ_MIN_INTERVAL
, 
mask
))

2560 
cÚf
->
dÙ11MeshHWMP´eqMšIÁ”v®
 =

2561 
ncÚf
->
dÙ11MeshHWMP´eqMšIÁ”v®
;

2562 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_PERR_MIN_INTERVAL
, 
mask
))

2563 
cÚf
->
dÙ11MeshHWMP³¼MšIÁ”v®
 =

2564 
ncÚf
->
dÙ11MeshHWMP³¼MšIÁ”v®
;

2565 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_NET_DIAM_TRVS_TIME
,

2566 
mask
))

2567 
cÚf
->
dÙ11MeshHWMPÃtDŸm‘”T¿v”§lTime
 =

2568 
ncÚf
->
dÙ11MeshHWMPÃtDŸm‘”T¿v”§lTime
;

2569 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_ROOTMODE
, 
mask
)) {

2570 
cÚf
->
dÙ11MeshHWMPRoÙMode
 = 
ncÚf
->dot11MeshHWMPRootMode;

2571 
	`›“80211_mesh_roÙ_£tup
(
ifmsh
);

2573 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_GATE_ANNOUNCEMENTS
, 
mask
)) {

2577 ià(
ncÚf
->
dÙ11MeshG©eAÂounûm’tPrÙocŞ
 &&

2578 !(
cÚf
->
dÙ11MeshHWMPRoÙMode
 > 
IEEE80211_ROOTMODE_ROOT
)) {

2579 
cÚf
->
dÙ11MeshHWMPRoÙMode
 = 
IEEE80211_PROACTIVE_RANN
;

2580 
	`›“80211_mesh_roÙ_£tup
(
ifmsh
);

2582 
cÚf
->
dÙ11MeshG©eAÂounûm’tPrÙocŞ
 =

2583 
ncÚf
->
dÙ11MeshG©eAÂounûm’tPrÙocŞ
;

2585 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_RANN_INTERVAL
, 
mask
))

2586 
cÚf
->
dÙ11MeshHWMPRªnIÁ”v®
 =

2587 
ncÚf
->
dÙ11MeshHWMPRªnIÁ”v®
;

2588 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_FORWARDING
, 
mask
))

2589 
cÚf
->
dÙ11MeshFÜw¬dšg
 = 
ncÚf
->dot11MeshForwarding;

2590 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_RSSI_THRESHOLD
, 
mask
)) {

2594 ià(!
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
SIGNAL_DBM
))

2595  -
EOPNOTSUPP
;

2596 
cÚf
->
rssi_th»shŞd
 = 
ncÚf
->rssi_threshold;

2598 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HT_OPMODE
, 
mask
)) {

2599 
cÚf
->
ht_İmode
 = 
ncÚf
->ht_opmode;

2600 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
 = 
ncÚf
->
ht_İmode
;

2601 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

2602 
BSS_CHANGED_HT
);

2604 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_PATH_TO_ROOT_TIMEOUT
, 
mask
))

2605 
cÚf
->
dÙ11MeshHWMPaùiveP©hToRoÙTimeout
 =

2606 
ncÚf
->
dÙ11MeshHWMPaùiveP©hToRoÙTimeout
;

2607 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_ROOT_INTERVAL
, 
mask
))

2608 
cÚf
->
dÙ11MeshHWMProÙIÁ”v®
 =

2609 
ncÚf
->
dÙ11MeshHWMProÙIÁ”v®
;

2610 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_HWMP_CONFIRMATION_INTERVAL
, 
mask
))

2611 
cÚf
->
dÙ11MeshHWMPcÚfœm©iÚIÁ”v®
 =

2612 
ncÚf
->
dÙ11MeshHWMPcÚfœm©iÚIÁ”v®
;

2613 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_POWER_MODE
, 
mask
)) {

2614 
cÚf
->
pow”_mode
 = 
ncÚf
->power_mode;

2615 
	`›“80211_mps_loÿl_¡©us_upd©e
(
sd©a
);

2617 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_AWAKE_WINDOW
, 
mask
))

2618 
cÚf
->
dÙ11MeshAwakeWšdowDu¿tiÚ
 =

2619 
ncÚf
->
dÙ11MeshAwakeWšdowDu¿tiÚ
;

2620 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_PLINK_TIMEOUT
, 
mask
))

2621 
cÚf
->
¶šk_timeout
 = 
ncÚf
->plink_timeout;

2622 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_CONNECTED_TO_GATE
, 
mask
))

2623 
cÚf
->
dÙ11MeshCÚÃùedToMeshG©e
 =

2624 
ncÚf
->
dÙ11MeshCÚÃùedToMeshG©e
;

2625 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_NOLEARN
, 
mask
))

2626 
cÚf
->
dÙ11MeshNŞ—º
 = 
ncÚf
->dot11MeshNolearn;

2627 ià(
	`_chg_mesh_©Œ
(
NL80211_MESHCONF_CONNECTED_TO_AS
, 
mask
))

2628 
cÚf
->
dÙ11MeshCÚÃùedToAuthS”v”
 =

2629 
ncÚf
->
dÙ11MeshCÚÃùedToAuthS”v”
;

2630 
	`›“80211_mbss_šfo_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_BEACON
);

2632 
	}
}

2634 
	$›“80211_još_mesh
(
why
 *why, 
Ãt_deviû
 *
dev
,

2635 cÚ¡ 
mesh_cÚfig
 *
cÚf
,

2636 cÚ¡ 
mesh_£tup
 *
£tup
)

2638 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2639 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = 
£tup
->
chªdef
 };

2640 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

2641 
”r
;

2643 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2645 
	`memıy
(&
ifmsh
->
mshcfg
, 
cÚf
, (
mesh_cÚfig
));

2646 
”r
 = 
	`cİy_mesh_£tup
(
ifmsh
, 
£tup
);

2647 ià(
”r
)

2648  
”r
;

2650 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
 = 
£tup
->control_port_over_nl80211;

2653 
sd©a
->
deæšk
.
smps_mode
 = 
IEEE80211_SMPS_OFF
;

2654 
sd©a
->
deæšk
.
Ãeded_rx_chašs
 = sd©a->
loÿl
->
rx_chašs
;

2656 
”r
 = 
	`›“80211_lšk_u£_chªÃl
(&
sd©a
->
deæšk
, &
chª»q
,

2657 
IEEE80211_CHANCTX_SHARED
);

2658 ià(
”r
)

2659  
”r
;

2661  
	`›“80211_¡¬t_mesh
(
sd©a
);

2662 
	}
}

2664 
	$›“80211_Ëave_mesh
(
why
 *why, 
Ãt_deviû
 *
dev
)

2666 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2668 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2670 
	`›“80211_¡İ_mesh
(
sd©a
);

2671 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

2672 
	`kä“
(
sd©a
->
u
.
mesh
.
›
);

2675 
	}
}

2678 
	$›“80211_chªge_bss
(
why
 *wiphy,

2679 
Ãt_deviû
 *
dev
,

2680 
bss_·¿m‘”s
 *
·¿ms
)

2682 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2683 
›“80211_lšk_d©a
 *
lšk
;

2684 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

2685 
u64
 
chªged
 = 0;

2687 
lšk
 = 
	`›“80211_lšk_Ü_deæšk
(
sd©a
, 
·¿ms
->
lšk_id
, 
Œue
);

2688 ià(
	`IS_ERR
(
lšk
))

2689  
	`PTR_ERR
(
lšk
);

2691 ià(!
	`sd©a_d”eã»nû
(
lšk
->
u
.
­
.
b—cÚ
, 
sd©a
))

2692  -
ENOENT
;

2694 
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

2695 ià(!
sbªd
)

2696  -
EINVAL
;

2698 ià(
·¿ms
->
basic_¿‹s
) {

2699 ià(!
	`›“80211_·r£_b™¿‹s
(
lšk
->
cÚf
->
chª»q
.
İ”
.
width
,

2700 
why
->
bªds
[
sbªd
->
bªd
],

2701 
·¿ms
->
basic_¿‹s
,

2702 
·¿ms
->
basic_¿‹s_Ën
,

2703 &
lšk
->
cÚf
->
basic_¿‹s
))

2704  -
EINVAL
;

2705 
chªged
 |ğ
BSS_CHANGED_BASIC_RATES
;

2706 
	`›“80211_check_¿‹_mask
(
lšk
);

2709 ià(
·¿ms
->
u£_ùs_´Ù
 >= 0) {

2710 
lšk
->
cÚf
->
u£_ùs_´Ù
 = 
·¿ms
->use_cts_prot;

2711 
chªged
 |ğ
BSS_CHANGED_ERP_CTS_PROT
;

2713 ià(
·¿ms
->
u£_shÜt_´—mbË
 >= 0) {

2714 
lšk
->
cÚf
->
u£_shÜt_´—mbË
 = 
·¿ms
->use_short_preamble;

2715 
chªged
 |ğ
BSS_CHANGED_ERP_PREAMBLE
;

2718 ià(!
lšk
->
cÚf
->
u£_shÜt_¦Ù
 &&

2719 (
sbªd
->
bªd
 =ğ
NL80211_BAND_5GHZ
 ||

2720 
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)) {

2721 
lšk
->
cÚf
->
u£_shÜt_¦Ù
 = 
Œue
;

2722 
chªged
 |ğ
BSS_CHANGED_ERP_SLOT
;

2725 ià(
·¿ms
->
u£_shÜt_¦Ù_time
 >= 0) {

2726 
lšk
->
cÚf
->
u£_shÜt_¦Ù
 = 
·¿ms
->
u£_shÜt_¦Ù_time
;

2727 
chªged
 |ğ
BSS_CHANGED_ERP_SLOT
;

2730 ià(
·¿ms
->
­_isŞ©e
 >= 0) {

2731 ià(
·¿ms
->
­_isŞ©e
)

2732 
sd©a
->
æags
 |ğ
IEEE80211_SDATA_DONT_BRIDGE_PACKETS
;

2734 
sd©a
->
æags
 &ğ~
IEEE80211_SDATA_DONT_BRIDGE_PACKETS
;

2735 
	`›“80211_check_ç¡_rx_içû
(
sd©a
);

2738 ià(
·¿ms
->
ht_İmode
 >= 0) {

2739 
lšk
->
cÚf
->
ht_İ”©iÚ_mode
 = (
u16
)
·¿ms
->
ht_İmode
;

2740 
chªged
 |ğ
BSS_CHANGED_HT
;

2743 ià(
·¿ms
->
p2p_ùwšdow
 >= 0) {

2744 
lšk
->
cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
 &=

2745 ~
IEEE80211_P2P_OPPPS_CTWINDOW_MASK
;

2746 
lšk
->
cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
 |=

2747 
·¿ms
->
p2p_ùwšdow
 & 
IEEE80211_P2P_OPPPS_CTWINDOW_MASK
;

2748 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

2751 ià(
·¿ms
->
p2p_İp_ps
 > 0) {

2752 
lšk
->
cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
 |=

2753 
IEEE80211_P2P_OPPPS_ENABLE_BIT
;

2754 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

2755 } ià(
·¿ms
->
p2p_İp_ps
 == 0) {

2756 
lšk
->
cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
 &=

2757 ~
IEEE80211_P2P_OPPPS_ENABLE_BIT
;

2758 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

2761 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

2764 
	}
}

2766 
	$›“80211_£t_txq_·¿ms
(
why
 *wiphy,

2767 
Ãt_deviû
 *
dev
,

2768 
›“80211_txq_·¿ms
 *
·¿ms
)

2770 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

2771 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2772 
›“80211_lšk_d©a
 *
lšk
 =

2773 
	`›“80211_lšk_Ü_deæšk
(
sd©a
, 
·¿ms
->
lšk_id
, 
Œue
);

2774 
›“80211_tx_queue_·¿ms
 
p
;

2776 ià(!
loÿl
->
İs
->
cÚf_tx
)

2777  -
EOPNOTSUPP
;

2779 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

2780  -
EOPNOTSUPP
;

2782 ià(
	`IS_ERR
(
lšk
))

2783  
	`PTR_ERR
(
lšk
);

2785 
	`mem£t
(&
p
, 0, (p));

2786 
p
.
aifs
 = 
·¿ms
->aifs;

2787 
p
.
cw_max
 = 
·¿ms
->
cwmax
;

2788 
p
.
cw_mš
 = 
·¿ms
->
cwmš
;

2789 
p
.
txİ
 = 
·¿ms
->txop;

2795 
p
.
u­sd
 = 
çl£
;

2797 
	`›“80211_»guÏtÜy_lim™_wmm_·¿ms
(
sd©a
, &
p
, 
·¿ms
->
ac
);

2799 
lšk
->
tx_cÚf
[
·¿ms
->
ac
] = 
p
;

2800 ià(
	`drv_cÚf_tx
(
loÿl
, 
lšk
, 
·¿ms
->
ac
, &
p
)) {

2801 
	`why_debug
(
loÿl
->
hw
.
why
,

2803 
·¿ms
->
ac
);

2804  -
EINVAL
;

2807 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

2808 
BSS_CHANGED_QOS
);

2811 
	}
}

2813 #ifdeà
CONFIG_PM


2814 
	$›“80211_su¥’d
(
why
 *wiphy,

2815 
cfg80211_wowÏn
 *
wowÏn
)

2817  
	`__›“80211_su¥’d
(
	`why_´iv
(
why
), 
wowÏn
);

2818 
	}
}

2820 
	$›“80211_»sume
(
why
 *wiphy)

2822  
	`__›“80211_»sume
(
	`why_´iv
(
why
));

2823 
	}
}

2825 
	#›“80211_su¥’d
 
NULL


	)

2826 
	#›“80211_»sume
 
NULL


	)

2829 
	$›“80211_sÿn
(
why
 *wiphy,

2830 
cfg80211_sÿn_»que¡
 *
»q
)

2832 
›“80211_sub_if_d©a
 *
sd©a
;

2834 
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
»q
->
wdev
);

2836 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
)) {

2837 
NL80211_IFTYPE_STATION
:

2838 
NL80211_IFTYPE_ADHOC
:

2839 
NL80211_IFTYPE_MESH_POINT
:

2840 
NL80211_IFTYPE_P2P_CLIENT
:

2841 
NL80211_IFTYPE_P2P_DEVICE
:

2843 
NL80211_IFTYPE_P2P_GO
:

2844 ià(
sd©a
->
loÿl
->
İs
->
hw_sÿn
)

2851 
çÎthrough
;

2852 
NL80211_IFTYPE_AP
:

2860 ià(
sd©a
->
deæšk
.
u
.
­
.
b—cÚ
 &&

2861 (!(
why
->
ã©u»s
 & 
NL80211_FEATURE_AP_SCAN
) ||

2862 !(
»q
->
æags
 & 
NL80211_SCAN_FLAG_AP
)))

2863  -
EOPNOTSUPP
;

2865 
NL80211_IFTYPE_NAN
:

2867  -
EOPNOTSUPP
;

2870  
	`›“80211_»que¡_sÿn
(
sd©a
, 
»q
);

2871 
	}
}

2873 
	$›“80211_abÜt_sÿn
(
why
 *why, 
wœ–ess_dev
 *
wdev
)

2875 
	`›“80211_sÿn_ÿnûl
(
	`why_´iv
(
why
));

2876 
	}
}

2879 
	$›“80211_sched_sÿn_¡¬t
(
why
 *wiphy,

2880 
Ãt_deviû
 *
dev
,

2881 
cfg80211_sched_sÿn_»que¡
 *
»q
)

2883 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2885 ià(!
sd©a
->
loÿl
->
İs
->
sched_sÿn_¡¬t
)

2886  -
EOPNOTSUPP
;

2888  
	`›“80211_»que¡_sched_sÿn_¡¬t
(
sd©a
, 
»q
);

2889 
	}
}

2892 
	$›“80211_sched_sÿn_¡İ
(
why
 *why, 
Ãt_deviû
 *
dev
,

2893 
u64
 
»qid
)

2895 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

2897 ià(!
loÿl
->
İs
->
sched_sÿn_¡İ
)

2898  -
EOPNOTSUPP
;

2900  
	`›“80211_»que¡_sched_sÿn_¡İ
(
loÿl
);

2901 
	}
}

2903 
	$›“80211_auth
(
why
 *why, 
Ãt_deviû
 *
dev
,

2904 
cfg80211_auth_»que¡
 *
»q
)

2906  
	`›“80211_mgd_auth
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
), 
»q
);

2907 
	}
}

2909 
	$›“80211_assoc
(
why
 *why, 
Ãt_deviû
 *
dev
,

2910 
cfg80211_assoc_»que¡
 *
»q
)

2912  
	`›“80211_mgd_assoc
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
), 
»q
);

2913 
	}
}

2915 
	$›“80211_d—uth
(
why
 *why, 
Ãt_deviû
 *
dev
,

2916 
cfg80211_d—uth_»que¡
 *
»q
)

2918  
	`›“80211_mgd_d—uth
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
), 
»q
);

2919 
	}
}

2921 
	$›“80211_di§ssoc
(
why
 *why, 
Ãt_deviû
 *
dev
,

2922 
cfg80211_di§ssoc_»que¡
 *
»q
)

2924  
	`›“80211_mgd_di§ssoc
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
), 
»q
);

2925 
	}
}

2927 
	$›“80211_još_ibss
(
why
 *why, 
Ãt_deviû
 *
dev
,

2928 
cfg80211_ibss_·¿ms
 *
·¿ms
)

2930  
	`›“80211_ibss_još
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
), 
·¿ms
);

2931 
	}
}

2933 
	$›“80211_Ëave_ibss
(
why
 *why, 
Ãt_deviû
 *
dev
)

2935  
	`›“80211_ibss_Ëave
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
));

2936 
	}
}

2938 
	$›“80211_još_ocb
(
why
 *why, 
Ãt_deviû
 *
dev
,

2939 
ocb_£tup
 *
£tup
)

2941  
	`›“80211_ocb_još
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
), 
£tup
);

2942 
	}
}

2944 
	$›“80211_Ëave_ocb
(
why
 *why, 
Ãt_deviû
 *
dev
)

2946  
	`›“80211_ocb_Ëave
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
));

2947 
	}
}

2949 
	$›“80211_£t_mÿ¡_¿‹
(
why
 *why, 
Ãt_deviû
 *
dev
,

2950 
¿‹
[
NUM_NL80211_BANDS
])

2952 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2954 
	`memıy
(
sd©a
->
vif
.
bss_cÚf
.
mÿ¡_¿‹
, 
¿‹
,

2955 (è* 
NUM_NL80211_BANDS
);

2957 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

2958 
BSS_CHANGED_MCAST_RATE
);

2961 
	}
}

2963 
	$›“80211_£t_why_·¿ms
(
why
 *why, 
u32
 
chªged
)

2965 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

2966 
”r
;

2968 ià(
chªged
 & 
WIPHY_PARAM_FRAG_THRESHOLD
) {

2969 
	`›“80211_check_ç¡_xm™_®l
(
loÿl
);

2971 
”r
 = 
	`drv_£t_äag_th»shŞd
(
loÿl
, 
why
->
äag_th»shŞd
);

2973 ià(
”r
) {

2974 
	`›“80211_check_ç¡_xm™_®l
(
loÿl
);

2975  
”r
;

2979 ià((
chªged
 & 
WIPHY_PARAM_COVERAGE_CLASS
) ||

2980 (
chªged
 & 
WIPHY_PARAM_DYN_ACK
)) {

2981 
s16
 
cov”age_şass
;

2983 
cov”age_şass
 = 
chªged
 & 
WIPHY_PARAM_COVERAGE_CLASS
 ?

2984 
why
->
cov”age_şass
 : -1;

2985 
”r
 = 
	`drv_£t_cov”age_şass
(
loÿl
, 
cov”age_şass
);

2987 ià(
”r
)

2988  
”r
;

2991 ià(
chªged
 & 
WIPHY_PARAM_RTS_THRESHOLD
) {

2992 
”r
 = 
	`drv_£t_¹s_th»shŞd
(
loÿl
, 
why
->
¹s_th»shŞd
);

2994 ià(
”r
)

2995  
”r
;

2998 ià(
chªged
 & 
WIPHY_PARAM_RETRY_SHORT
) {

2999 ià(
why
->
»Œy_shÜt
 > 
IEEE80211_MAX_TX_RETRY
)

3000  -
EINVAL
;

3001 
loÿl
->
hw
.
cÚf
.
shÜt_äame_max_tx_couÁ
 = 
why
->
»Œy_shÜt
;

3003 ià(
chªged
 & 
WIPHY_PARAM_RETRY_LONG
) {

3004 ià(
why
->
»Œy_lÚg
 > 
IEEE80211_MAX_TX_RETRY
)

3005  -
EINVAL
;

3006 
loÿl
->
hw
.
cÚf
.
lÚg_äame_max_tx_couÁ
 = 
why
->
»Œy_lÚg
;

3008 ià(
chªged
 &

3009 (
WIPHY_PARAM_RETRY_SHORT
 | 
WIPHY_PARAM_RETRY_LONG
))

3010 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_RETRY_LIMITS
);

3012 ià(
chªged
 & (
WIPHY_PARAM_TXQ_LIMIT
 |

3013 
WIPHY_PARAM_TXQ_MEMORY_LIMIT
 |

3014 
WIPHY_PARAM_TXQ_QUANTUM
))

3015 
	`›“80211_txq_£t_·¿ms
(
loÿl
);

3018 
	}
}

3020 
	$›“80211_£t_tx_pow”
(
why
 *wiphy,

3021 
wœ–ess_dev
 *
wdev
,

3022 
Æ80211_tx_pow”_£‰šg
 
ty³
, 
mbm
)

3024 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

3025 
›“80211_sub_if_d©a
 *
sd©a
;

3026 
Æ80211_tx_pow”_£‰šg
 
txp_ty³
 = 
ty³
;

3027 
boŞ
 
upd©e_txp_ty³
 = 
çl£
;

3028 
boŞ
 
has_mÚ™Ü
 = 
çl£
;

3030 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3032 ià(
wdev
) {

3033 
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

3035 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
) {

3036 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

3037 
loÿl
->
mÚ™Ü_sd©a
);

3038 ià(!
sd©a
)

3039  -
EOPNOTSUPP
;

3042 
ty³
) {

3043 
NL80211_TX_POWER_AUTOMATIC
:

3044 
sd©a
->
deæšk
.
u£r_pow”_Ëv–
 =

3045 
IEEE80211_UNSET_POWER_LEVEL
;

3046 
txp_ty³
 = 
NL80211_TX_POWER_LIMITED
;

3048 
NL80211_TX_POWER_LIMITED
:

3049 
NL80211_TX_POWER_FIXED
:

3050 ià(
mbm
 < 0 || (mbm % 100))

3051  -
EOPNOTSUPP
;

3052 
sd©a
->
deæšk
.
u£r_pow”_Ëv–
 = 
	`MBM_TO_DBM
(
mbm
);

3056 ià(
txp_ty³
 !ğ
sd©a
->
vif
.
bss_cÚf
.
txpow”_ty³
) {

3057 
upd©e_txp_ty³
 = 
Œue
;

3058 
sd©a
->
vif
.
bss_cÚf
.
txpow”_ty³
 = 
txp_ty³
;

3061 
	`›“80211_»ÿlc_txpow”
(
sd©a
, 
upd©e_txp_ty³
);

3066 
ty³
) {

3067 
NL80211_TX_POWER_AUTOMATIC
:

3068 
loÿl
->
u£r_pow”_Ëv–
 = 
IEEE80211_UNSET_POWER_LEVEL
;

3069 
txp_ty³
 = 
NL80211_TX_POWER_LIMITED
;

3071 
NL80211_TX_POWER_LIMITED
:

3072 
NL80211_TX_POWER_FIXED
:

3073 ià(
mbm
 < 0 || (mbm % 100))

3074  -
EOPNOTSUPP
;

3075 
loÿl
->
u£r_pow”_Ëv–
 = 
	`MBM_TO_DBM
(
mbm
);

3079 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

3080 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
) {

3081 
has_mÚ™Ü
 = 
Œue
;

3084 
sd©a
->
deæšk
.
u£r_pow”_Ëv–
 = 
loÿl
->user_power_level;

3085 ià(
txp_ty³
 !ğ
sd©a
->
vif
.
bss_cÚf
.
txpow”_ty³
)

3086 
upd©e_txp_ty³
 = 
Œue
;

3087 
sd©a
->
vif
.
bss_cÚf
.
txpow”_ty³
 = 
txp_ty³
;

3089 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

3090 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
)

3092 
	`›“80211_»ÿlc_txpow”
(
sd©a
, 
upd©e_txp_ty³
);

3095 ià(
has_mÚ™Ü
) {

3096 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

3097 
loÿl
->
mÚ™Ü_sd©a
);

3098 ià(
sd©a
) {

3099 
sd©a
->
deæšk
.
u£r_pow”_Ëv–
 = 
loÿl
->user_power_level;

3100 ià(
txp_ty³
 !ğ
sd©a
->
vif
.
bss_cÚf
.
txpow”_ty³
)

3101 
upd©e_txp_ty³
 = 
Œue
;

3102 
sd©a
->
vif
.
bss_cÚf
.
txpow”_ty³
 = 
txp_ty³
;

3104 
	`›“80211_»ÿlc_txpow”
(
sd©a
, 
upd©e_txp_ty³
);

3109 
	}
}

3111 
	$›“80211_g‘_tx_pow”
(
why
 *wiphy,

3112 
wœ–ess_dev
 *
wdev
,

3113 *
dbm
)

3115 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

3116 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

3118 ià(
loÿl
->
İs
->
g‘_txpow”
)

3119  
	`drv_g‘_txpow”
(
loÿl
, 
sd©a
, 
dbm
);

3121 ià(
loÿl
->
emuÏ‹_chªùx
)

3122 *
dbm
 = 
loÿl
->
hw
.
cÚf
.
pow”_Ëv–
;

3124 *
dbm
 = 
sd©a
->
vif
.
bss_cÚf
.
txpow”
;

3127 ià(*
dbm
 =ğ
INT_MIN
)

3128  -
EINVAL
;

3131 
	}
}

3133 
	$›“80211_rfkl_pŞl
(
why
 *wiphy)

3135 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

3137 
	`drv_rfkl_pŞl
(
loÿl
);

3138 
	}
}

3140 #ifdeà
CONFIG_NL80211_TESTMODE


3141 
	$›“80211_‹¡mode_cmd
(
why
 *wiphy,

3142 
wœ–ess_dev
 *
wdev
,

3143 *
d©a
, 
Ën
)

3145 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

3146 
›“80211_vif
 *
vif
 = 
NULL
;

3148 ià(!
loÿl
->
İs
->
‹¡mode_cmd
)

3149  -
EOPNOTSUPP
;

3151 ià(
wdev
) {

3152 
›“80211_sub_if_d©a
 *
sd©a
;

3154 
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

3155 ià(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
)

3156 
vif
 = &
sd©a
->vif;

3159  
loÿl
->
İs
->
	`‹¡mode_cmd
(&loÿl->
hw
, 
vif
, 
d©a
, 
Ën
);

3160 
	}
}

3162 
	$›“80211_‹¡mode_dump
(
why
 *wiphy,

3163 
sk_buff
 *
skb
,

3164 
Ãšk_ÿÎback
 *
cb
,

3165 *
d©a
, 
Ën
)

3167 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

3169 ià(!
loÿl
->
İs
->
‹¡mode_dump
)

3170  -
EOPNOTSUPP
;

3172  
loÿl
->
İs
->
	`‹¡mode_dump
(&loÿl->
hw
, 
skb
, 
cb
, 
d©a
, 
Ën
);

3173 
	}
}

3176 
	$__›“80211_»que¡_smps_mgd
(
›“80211_sub_if_d©a
 *
sd©a
,

3177 
›“80211_lšk_d©a
 *
lšk
,

3178 
›“80211_smps_mode
 
smps_mode
)

3180 cÚ¡ 
u8
 *
­
;

3181 
›“80211_smps_mode
 
Şd_»q
;

3182 
”r
;

3183 
¡a_šfo
 *
¡a
;

3184 
boŞ
 
tdls_³”_found
 = 
çl£
;

3186 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3188 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
))

3189  -
EINVAL
;

3191 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk
->
lšk_id
))

3194 
Şd_»q
 = 
lšk
->
u
.
mgd
.
»q_smps
;

3195 
lšk
->
u
.
mgd
.
»q_smps
 = 
smps_mode
;

3200 ià(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_EML_ACTIVE
)

3203 ià(
Şd_»q
 =ğ
smps_mode
 &&

3204 
smps_mode
 !ğ
IEEE80211_SMPS_AUTOMATIC
)

3212 ià(!
sd©a
->
u
.
mgd
.
assocŸ‹d
 ||

3213 
lšk
->
cÚf
->
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
)

3216 
­
 = 
sd©a
->
vif
.
cfg
.
­_addr
;

3218 
	`rcu_»ad_lock
();

3219 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
sd©a
->
loÿl
->
¡a_li¡
, 
li¡
) {

3220 ià(!
¡a
->¡a.
tdls
 || s->
sd©a
 !ğsd©¨|| !¡a->
u¶ßded
 ||

3221 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

3224 
tdls_³”_found
 = 
Œue
;

3227 
	`rcu_»ad_uÆock
();

3229 ià(
smps_mode
 =ğ
IEEE80211_SMPS_AUTOMATIC
) {

3230 ià(
tdls_³”_found
 || !
sd©a
->
u
.
mgd
.
pow”§ve
)

3231 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

3233 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

3237 
”r
 = 
	`›“80211_£nd_smps_aùiÚ
(
sd©a
, 
smps_mode
,

3238 
­
,‡p,

3239 
	`›“80211_vif_is_mld
(&
sd©a
->
vif
) ?

3240 
lšk
->
lšk_id
 : -1);

3241 ià(
”r
)

3242 
lšk
->
u
.
mgd
.
»q_smps
 = 
Şd_»q
;

3243 ià(
smps_mode
 !ğ
IEEE80211_SMPS_OFF
 && 
tdls_³”_found
)

3244 
	`›“80211_‹¬down_tdls_³”s
(
lšk
);

3246  
”r
;

3247 
	}
}

3249 
	$›“80211_£t_pow”_mgmt
(
why
 *why, 
Ãt_deviû
 *
dev
,

3250 
boŞ
 
’abËd
, 
timeout
)

3252 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3253 
›“80211_loÿl
 *
loÿl
 = 
	`wdev_´iv
(
dev
->
›“80211_±r
);

3254 
lšk_id
;

3256 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3257  -
EOPNOTSUPP
;

3259 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_PS
))

3260  -
EOPNOTSUPP
;

3262 ià(
’abËd
 =ğ
sd©a
->
u
.
mgd
.
pow”§ve
 &&

3263 
timeout
 =ğ
loÿl
->
dyÇmic_ps_fÜûd_timeout
)

3266 
sd©a
->
u
.
mgd
.
pow”§ve
 = 
’abËd
;

3267 
loÿl
->
dyÇmic_ps_fÜûd_timeout
 = 
timeout
;

3270 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
(
sd©a
->
lšk
);†ink_id++) {

3271 
›“80211_lšk_d©a
 *
lšk
;

3273 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

3275 ià(!
lšk
)

3277 
	`__›“80211_»que¡_smps_mgd
(
sd©a
, 
lšk
,

3278 
lšk
->
u
.
mgd
.
»q_smps
);

3281 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
))

3282 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

3284 
	`›“80211_»ÿlc_ps
(
loÿl
);

3285 
	`›“80211_»ÿlc_ps_vif
(
sd©a
);

3286 
	`›“80211_check_ç¡_rx_içû
(
sd©a
);

3289 
	}
}

3291 
	$›“80211_£t_cqm_rssi_lšk
(
›“80211_sub_if_d©a
 *
sd©a
,

3292 
›“80211_lšk_d©a
 *
lšk
,

3293 
s32
 
rssi_thŞd
, 
u32
 
rssi_hy¡
,

3294 
s32
 
rssi_low
, s32 
rssi_high
)

3296 
›“80211_bss_cÚf
 *
cÚf
;

3298 ià(!
lšk
 || !lšk->
cÚf
)

3301 
cÚf
 = 
lšk
->conf;

3303 ià(
rssi_thŞd
 && 
rssi_hy¡
 &&

3304 
rssi_thŞd
 =ğ
cÚf
->
cqm_rssi_thŞd
 &&

3305 
rssi_hy¡
 =ğ
cÚf
->
cqm_rssi_hy¡
)

3308 
cÚf
->
cqm_rssi_thŞd
 = 
rssi_thŞd
;

3309 
cÚf
->
cqm_rssi_hy¡
 = 
rssi_hy¡
;

3310 
cÚf
->
cqm_rssi_low
 = 
rssi_low
;

3311 
cÚf
->
cqm_rssi_high
 = 
rssi_high
;

3312 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
 = 0;

3314 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk
->
lšk_id
))

3317 ià(
sd©a
->
u
.
mgd
.
assocŸ‹d
 &&

3318 (
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
))

3319 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
BSS_CHANGED_CQM
);

3320 
	}
}

3322 
	$›“80211_£t_cqm_rssi_cÚfig
(
why
 *wiphy,

3323 
Ãt_deviû
 *
dev
,

3324 
s32
 
rssi_thŞd
, 
u32
 
rssi_hy¡
)

3326 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3327 
›“80211_vif
 *
vif
 = &
sd©a
->vif;

3328 
lšk_id
;

3330 ià(
vif
->
driv”_æags
 & 
IEEE80211_VIF_BEACON_FILTER
 &&

3331 !(
vif
->
driv”_æags
 & 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
))

3332  -
EOPNOTSUPP
;

3335 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

3336 
›“80211_lšk_d©a
 *
lšk
 =

3337 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
], sdata);

3339 
	`›“80211_£t_cqm_rssi_lšk
(
sd©a
, 
lšk
, 
rssi_thŞd
, 
rssi_hy¡
,

3344 
	}
}

3346 
	$›“80211_£t_cqm_rssi_¿nge_cÚfig
(
why
 *wiphy,

3347 
Ãt_deviû
 *
dev
,

3348 
s32
 
rssi_low
, s32 
rssi_high
)

3350 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3351 
›“80211_vif
 *
vif
 = &
sd©a
->vif;

3352 
lšk_id
;

3354 ià(
vif
->
driv”_æags
 & 
IEEE80211_VIF_BEACON_FILTER
)

3355  -
EOPNOTSUPP
;

3358 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

3359 
›“80211_lšk_d©a
 *
lšk
 =

3360 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
], sdata);

3362 
	`›“80211_£t_cqm_rssi_lšk
(
sd©a
, 
lšk
, 0, 0,

3363 
rssi_low
, 
rssi_high
);

3367 
	}
}

3369 
	$›“80211_£t_b™¿‹_mask
(
why
 *wiphy,

3370 
Ãt_deviû
 *
dev
,

3371 
lšk_id
,

3372 cÚ¡ 
u8
 *
addr
,

3373 cÚ¡ 
cfg80211_b™¿‹_mask
 *
mask
)

3375 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3376 
›“80211_loÿl
 *
loÿl
 = 
	`wdev_´iv
(
dev
->
›“80211_±r
);

3377 
i
, 
»t
;

3379 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

3380  -
ENETDOWN
;

3388 ià(
	`rcu_acûss_poš‹r
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
) &&

3389 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
) {

3390 
u32
 
basic_¿‹s
 = 
sd©a
->
vif
.
bss_cÚf
.basic_rates;

3391 
Æ80211_bªd
 
bªd
;

3393 
bªd
 = 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
->band;

3395 ià(!(
mask
->
cÚŒŞ
[
bªd
].
Ëgacy
 & 
basic_¿‹s
))

3396  -
EINVAL
;

3399 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
)) {

3400 
»t
 = 
	`drv_£t_b™¿‹_mask
(
loÿl
, 
sd©a
, 
mask
);

3401 ià(
»t
)

3402  
»t
;

3405 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

3406 
›“80211_suµÜ‹d_bªd
 *
sbªd
 = 
why
->
bªds
[
i
];

3407 
j
;

3409 
sd©a
->
rc_¿‹idx_mask
[
i
] = 
mask
->
cÚŒŞ
[i].
Ëgacy
;

3410 
	`memıy
(
sd©a
->
rc_¿‹idx_mcs_mask
[
i
], 
mask
->
cÚŒŞ
[i].
ht_mcs
,

3411 (
mask
->
cÚŒŞ
[
i
].
ht_mcs
));

3412 
	`memıy
(
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
i
],

3413 
mask
->
cÚŒŞ
[
i
].
vht_mcs
,

3414 (
mask
->
cÚŒŞ
[
i
].
vht_mcs
));

3416 
sd©a
->
rc_has_mcs_mask
[
i
] = 
çl£
;

3417 
sd©a
->
rc_has_vht_mcs_mask
[
i
] = 
çl£
;

3418 ià(!
sbªd
)

3421 
j
 = 0; j < 
IEEE80211_HT_MCS_MASK_LEN
; j++) {

3422 ià(
sd©a
->
rc_¿‹idx_mcs_mask
[
i
][
j
] != 0xff) {

3423 
sd©a
->
rc_has_mcs_mask
[
i
] = 
Œue
;

3428 
j
 = 0; j < 
NL80211_VHT_NSS_MAX
; j++) {

3429 ià(
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
i
][
j
] != 0xffff) {

3430 
sd©a
->
rc_has_vht_mcs_mask
[
i
] = 
Œue
;

3437 
	}
}

3439 
	$›“80211_¡¬t_¿d¬_d‘eùiÚ
(
why
 *wiphy,

3440 
Ãt_deviû
 *
dev
,

3441 
cfg80211_chª_def
 *
chªdef
,

3442 
u32
 
ÿc_time_ms
)

3444 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3445 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = *
chªdef
 };

3446 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3447 
”r
;

3449 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3451 ià(!
	`li¡_em±y
(&
loÿl
->
roc_li¡
è||†oÿl->
sÿÂšg
) {

3452 
”r
 = -
EBUSY
;

3453 
out_uÆock
;

3457 
sd©a
->
deæšk
.
smps_mode
 = 
IEEE80211_SMPS_OFF
;

3458 
sd©a
->
deæšk
.
Ãeded_rx_chašs
 = 
loÿl
->
rx_chašs
;

3460 
”r
 = 
	`›“80211_lšk_u£_chªÃl
(&
sd©a
->
deæšk
, &
chª»q
,

3461 
IEEE80211_CHANCTX_SHARED
);

3462 ià(
”r
)

3463 
out_uÆock
;

3465 
	`why_d–ayed_wÜk_queue
(
why
, &
sd©a
->
deæšk
.
dfs_ÿc_tim”_wÜk
,

3466 
	`m£cs_to_jiff›s
(
ÿc_time_ms
));

3468 
out_uÆock
:

3469  
”r
;

3470 
	}
}

3472 
	$›“80211_’d_ÿc
(
why
 *wiphy,

3473 
Ãt_deviû
 *
dev
)

3475 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3476 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3478 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3480 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

3485 
	`why_d–ayed_wÜk_ÿnûl
(
why
,

3486 &
sd©a
->
deæšk
.
dfs_ÿc_tim”_wÜk
);

3488 ià(
sd©a
->
wdev
.
ÿc_¡¬‹d
) {

3489 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

3490 
sd©a
->
wdev
.
ÿc_¡¬‹d
 = 
çl£
;

3493 
	}
}

3495 
cfg80211_b—cÚ_d©a
 *

3496 
	$cfg80211_b—cÚ_dup
(
cfg80211_b—cÚ_d©a
 *
b—cÚ
)

3498 
cfg80211_b—cÚ_d©a
 *
Ãw_b—cÚ
;

3499 
u8
 *
pos
;

3500 
Ën
;

3502 
Ën
 = 
b—cÚ
->
h—d_Ën
 + b—cÚ->
_Ën
 + b—cÚ->
b—cÚ_›s_Ën
 +

3503 
b—cÚ
->
´ob”e¥_›s_Ën
 + b—cÚ->
assoüe¥_›s_Ën
 +

3504 
b—cÚ
->
´obe_»¥_Ën
 + b—cÚ->
lci_Ën
 + b—cÚ->
civişoc_Ën
;

3506 ià(
b—cÚ
->
mbssid_›s
)

3507 
Ën
 +ğ
	`›“80211_g‘_mbssid_b—cÚ_Ën
(
b—cÚ
->
mbssid_›s
,

3508 
b—cÚ
->
ºr_›s
,

3509 
b—cÚ
->
mbssid_›s
->
út
);

3511 
Ãw_b—cÚ
 = 
	`kz®loc
((*Ãw_b—cÚè+ 
Ën
, 
GFP_KERNEL
);

3512 ià(!
Ãw_b—cÚ
)

3513  
NULL
;

3515 ià(
b—cÚ
->
mbssid_›s
 && b—cÚ->mbssid_›s->
út
) {

3516 
Ãw_b—cÚ
->
mbssid_›s
 =

3517 
	`kz®loc
(
	`¡ruù_size
(
Ãw_b—cÚ
->
mbssid_›s
,

3518 
–em
, 
b—cÚ
->
mbssid_›s
->
út
),

3519 
GFP_KERNEL
);

3520 ià(!
Ãw_b—cÚ
->
mbssid_›s
) {

3521 
	`kä“
(
Ãw_b—cÚ
);

3522  
NULL
;

3525 ià(
b—cÚ
->
ºr_›s
 && b—cÚ->ºr_›s->
út
) {

3526 
Ãw_b—cÚ
->
ºr_›s
 =

3527 
	`kz®loc
(
	`¡ruù_size
(
Ãw_b—cÚ
->
ºr_›s
,

3528 
–em
, 
b—cÚ
->
ºr_›s
->
út
),

3529 
GFP_KERNEL
);

3530 ià(!
Ãw_b—cÚ
->
ºr_›s
) {

3531 
	`kä“
(
Ãw_b—cÚ
->
mbssid_›s
);

3532 
	`kä“
(
Ãw_b—cÚ
);

3533  
NULL
;

3538 
pos
 = (
u8
 *)(
Ãw_b—cÚ
 + 1);

3539 ià(
b—cÚ
->
h—d_Ën
) {

3540 
Ãw_b—cÚ
->
h—d_Ën
 = 
b—cÚ
->head_len;

3541 
Ãw_b—cÚ
->
h—d
 = 
pos
;

3542 
	`memıy
(
pos
, 
b—cÚ
->
h—d
, b—cÚ->
h—d_Ën
);

3543 
pos
 +ğ
b—cÚ
->
h—d_Ën
;

3545 ià(
b—cÚ
->
_Ën
) {

3546 
Ãw_b—cÚ
->
_Ën
 = 
b—cÚ
->tail_len;

3547 
Ãw_b—cÚ
->

 = 
pos
;

3548 
	`memıy
(
pos
, 
b—cÚ
->

, b—cÚ->
_Ën
);

3549 
pos
 +ğ
b—cÚ
->
_Ën
;

3551 ià(
b—cÚ
->
b—cÚ_›s_Ën
) {

3552 
Ãw_b—cÚ
->
b—cÚ_›s_Ën
 = 
b—cÚ
->beacon_ies_len;

3553 
Ãw_b—cÚ
->
b—cÚ_›s
 = 
pos
;

3554 
	`memıy
(
pos
, 
b—cÚ
->
b—cÚ_›s
, b—cÚ->
b—cÚ_›s_Ën
);

3555 
pos
 +ğ
b—cÚ
->
b—cÚ_›s_Ën
;

3557 ià(
b—cÚ
->
´ob”e¥_›s_Ën
) {

3558 
Ãw_b—cÚ
->
´ob”e¥_›s_Ën
 = 
b—cÚ
->proberesp_ies_len;

3559 
Ãw_b—cÚ
->
´ob”e¥_›s
 = 
pos
;

3560 
	`memıy
(
pos
, 
b—cÚ
->
´ob”e¥_›s
, b—cÚ->
´ob”e¥_›s_Ën
);

3561 
pos
 +ğ
b—cÚ
->
´ob”e¥_›s_Ën
;

3563 ià(
b—cÚ
->
assoüe¥_›s_Ën
) {

3564 
Ãw_b—cÚ
->
assoüe¥_›s_Ën
 = 
b—cÚ
->assocresp_ies_len;

3565 
Ãw_b—cÚ
->
assoüe¥_›s
 = 
pos
;

3566 
	`memıy
(
pos
, 
b—cÚ
->
assoüe¥_›s
, b—cÚ->
assoüe¥_›s_Ën
);

3567 
pos
 +ğ
b—cÚ
->
assoüe¥_›s_Ën
;

3569 ià(
b—cÚ
->
´obe_»¥_Ën
) {

3570 
Ãw_b—cÚ
->
´obe_»¥_Ën
 = 
b—cÚ
->probe_resp_len;

3571 
Ãw_b—cÚ
->
´obe_»¥
 = 
pos
;

3572 
	`memıy
(
pos
, 
b—cÚ
->
´obe_»¥
, b—cÚ->
´obe_»¥_Ën
);

3573 
pos
 +ğ
b—cÚ
->
´obe_»¥_Ën
;

3575 ià(
b—cÚ
->
mbssid_›s
 && b—cÚ->mbssid_›s->
út
) {

3576 
pos
 +ğ
	`›“80211_cİy_mbssid_b—cÚ
(pos,

3577 
Ãw_b—cÚ
->
mbssid_›s
,

3578 
b—cÚ
->
mbssid_›s
);

3579 ià(
b—cÚ
->
ºr_›s
 && b—cÚ->ºr_›s->
út
)

3580 
pos
 +ğ
	`›“80211_cİy_ºr_b—cÚ
(pos,

3581 
Ãw_b—cÚ
->
ºr_›s
,

3582 
b—cÚ
->
ºr_›s
);

3586 
Ãw_b—cÚ
->
ám_»¥Úd”
 = 
b—cÚ
->ftm_responder;

3587 ià(
b—cÚ
->
lci
) {

3588 
Ãw_b—cÚ
->
lci_Ën
 = 
b—cÚ
->lci_len;

3589 
Ãw_b—cÚ
->
lci
 = 
pos
;

3590 
	`memıy
(
pos
, 
b—cÚ
->
lci
, b—cÚ->
lci_Ën
);

3591 
pos
 +ğ
b—cÚ
->
lci_Ën
;

3593 ià(
b—cÚ
->
civişoc
) {

3594 
Ãw_b—cÚ
->
civişoc_Ën
 = 
b—cÚ
->civicloc_len;

3595 
Ãw_b—cÚ
->
civişoc
 = 
pos
;

3596 
	`memıy
(
pos
, 
b—cÚ
->
civişoc
, b—cÚ->
civişoc_Ën
);

3597 
pos
 +ğ
b—cÚ
->
civişoc_Ën
;

3600  
Ãw_b—cÚ
;

3601 
	}
}

3603 
	$›“80211_c§_fšish
(
›“80211_vif
 *
vif
, 
lšk_id
)

3605 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3606 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3607 
›“80211_lšk_d©a
 *
lšk_d©a
;

3609 ià(
	`WARN_ON
(
lšk_id
 >ğ
IEEE80211_MLD_MAX_NUM_LINKS
))

3612 
	`rcu_»ad_lock
();

3614 
lšk_d©a
 = 
	`rcu_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
]);

3615 ià(
	`WARN_ON
(!
lšk_d©a
)) {

3616 
	`rcu_»ad_uÆock
();

3621 ià(
vif
->
mbssid_tx_vif
 == vif) {

3626 
›“80211_sub_if_d©a
 *
™”
;

3628 
	`li¡_fÜ_—ch_’Œy_rcu
(
™”
, &
loÿl
->
š‹rçûs
, 
li¡
) {

3629 ià(!
	`›“80211_sd©a_ruÂšg
(
™”
))

3632 ià(
™”
 =ğ
sd©a
 || i‹r->
vif
.
mbssid_tx_vif
 != vif)

3635 
	`why_wÜk_queue
(
™”
->
loÿl
->
hw
.
why
,

3636 &
™”
->
deæšk
.
c§_fš®ize_wÜk
);

3639 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
lšk_d©a
->
c§_fš®ize_wÜk
);

3641 
	`rcu_»ad_uÆock
();

3642 
	}
}

3643 
EXPORT_SYMBOL
(
›“80211_c§_fšish
);

3645 
	$›“80211_chªÃl_sw™ch_discÚÃù
(
›“80211_vif
 *
vif
, 
boŞ
 
block_tx
)

3647 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3648 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3649 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3651 
sd©a
->
c§_blocked_tx
 = 
block_tx
;

3652 
	`sd©a_šfo
(
sd©a
, "channel switch failed, disconnecting\n");

3653 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
);

3654 
	}
}

3655 
EXPORT_SYMBOL
(
›“80211_chªÃl_sw™ch_discÚÃù
);

3657 
	$›“80211_£t_aá”_c§_b—cÚ
(
›“80211_lšk_d©a
 *
lšk_d©a
,

3658 
u64
 *
chªged
)

3660 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk_d©a
->sdata;

3661 
”r
;

3663 
sd©a
->
vif
.
ty³
) {

3664 
NL80211_IFTYPE_AP
:

3665 ià(!
lšk_d©a
->
u
.
­
.
Ãxt_b—cÚ
)

3666  -
EINVAL
;

3668 
”r
 = 
	`›“80211_assign_b—cÚ
(
sd©a
, 
lšk_d©a
,

3669 
lšk_d©a
->
u
.
­
.
Ãxt_b—cÚ
,

3670 
NULL
, NULL, 
chªged
);

3671 
	`›“80211_ä“_Ãxt_b—cÚ
(
lšk_d©a
);

3673 ià(
”r
 < 0)

3674  
”r
;

3676 
NL80211_IFTYPE_ADHOC
:

3677 
”r
 = 
	`›“80211_ibss_fšish_c§
(
sd©a
, 
chªged
);

3678 ià(
”r
 < 0)

3679  
”r
;

3681 #ifdeà
CONFIG_MAC80211_MESH


3682 
NL80211_IFTYPE_MESH_POINT
:

3683 
”r
 = 
	`›“80211_mesh_fšish_c§
(
sd©a
, 
chªged
);

3684 ià(
”r
 < 0)

3685  
”r
;

3689 
	`WARN_ON
(1);

3690  -
EINVAL
;

3694 
	}
}

3696 
	$__›“80211_c§_fš®ize
(
›“80211_lšk_d©a
 *
lšk_d©a
)

3698 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk_d©a
->sdata;

3699 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3700 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk_d©a
->
cÚf
;

3701 
u64
 
chªged
 = 0;

3702 
”r
;

3704 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3713 ià(
lšk_d©a
->
»£rved_chªùx
) {

3719 ià(
lšk_d©a
->
»£rved_»ady
)

3722  
	`›“80211_lšk_u£_»£rved_cÚ‹xt
(
lšk_d©a
);

3725 ià(!
	`cfg80211_chªdef_id’tiÿl
(&
lšk_cÚf
->
chª»q
.
İ”
,

3726 &
lšk_d©a
->
c§_chª»q
.
İ”
))

3727  -
EINVAL
;

3729 
lšk_cÚf
->
c§_aùive
 = 
çl£
;

3731 
”r
 = 
	`›“80211_£t_aá”_c§_b—cÚ
(
lšk_d©a
, &
chªged
);

3732 ià(
”r
)

3733  
”r
;

3735 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk_d©a
, 
chªged
);

3737 ià(
sd©a
->
c§_blocked_tx
) {

3738 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

3739 
IEEE80211_QUEUE_STOP_REASON_CSA
);

3740 
sd©a
->
c§_blocked_tx
 = 
çl£
;

3743 
”r
 = 
	`drv_po¡_chªÃl_sw™ch
(
lšk_d©a
);

3744 ià(
”r
)

3745  
”r
;

3747 
	`cfg80211_ch_sw™ch_nÙify
(
sd©a
->
dev
, &
lšk_d©a
->
c§_chª»q
.
İ”
,

3748 
lšk_d©a
->
lšk_id
);

3751 
	}
}

3753 
	$›“80211_c§_fš®ize
(
›“80211_lšk_d©a
 *
lšk_d©a
)

3755 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk_d©a
->sdata;

3757 ià(
	`__›“80211_c§_fš®ize
(
lšk_d©a
)) {

3758 
	`sd©a_šfo
(
sd©a
, "failedo finalize CSA on†ink %d, disconnecting\n",

3759 
lšk_d©a
->
lšk_id
);

3760 
	`cfg80211_¡İ_içû
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wdev
,

3761 
GFP_KERNEL
);

3763 
	}
}

3765 
	$›“80211_c§_fš®ize_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
)

3767 
›“80211_lšk_d©a
 *
lšk
 =

3768 
	`cÚš”_of
(
wÜk
, 
›“80211_lšk_d©a
, 
c§_fš®ize_wÜk
);

3769 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

3770 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3772 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3775 ià(!
lšk
->
cÚf
->
c§_aùive
)

3778 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

3781 
	`›“80211_c§_fš®ize
(
lšk
);

3782 
	}
}

3784 
	$›“80211_£t_c§_b—cÚ
(
›“80211_lšk_d©a
 *
lšk_d©a
,

3785 
cfg80211_c§_£‰šgs
 *
·¿ms
,

3786 
u64
 *
chªged
)

3788 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk_d©a
->sdata;

3789 
›“80211_c§_£‰šgs
 
c§
 = {};

3790 
”r
;

3792 
sd©a
->
vif
.
ty³
) {

3793 
NL80211_IFTYPE_AP
:

3794 
lšk_d©a
->
u
.
­
.
Ãxt_b—cÚ
 =

3795 
	`cfg80211_b—cÚ_dup
(&
·¿ms
->
b—cÚ_aá”
);

3796 ià(!
lšk_d©a
->
u
.
­
.
Ãxt_b—cÚ
)

3797  -
ENOMEM
;

3815 ià(
·¿ms
->
couÁ
 <= 1)

3818 ià((
·¿ms
->
n_couÁ”_off£ts_b—cÚ
 >

3819 
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
) ||

3820 (
·¿ms
->
n_couÁ”_off£ts_´e¥
 >

3821 
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
)) {

3822 
	`›“80211_ä“_Ãxt_b—cÚ
(
lšk_d©a
);

3823  -
EINVAL
;

3826 
c§
.
couÁ”_off£ts_b—cÚ
 = 
·¿ms
->counter_offsets_beacon;

3827 
c§
.
couÁ”_off£ts_´e¥
 = 
·¿ms
->counter_offsets_presp;

3828 
c§
.
n_couÁ”_off£ts_b—cÚ
 = 
·¿ms
->n_counter_offsets_beacon;

3829 
c§
.
n_couÁ”_off£ts_´e¥
 = 
·¿ms
->n_counter_offsets_presp;

3830 
c§
.
couÁ
 = 
·¿ms
->count;

3832 
”r
 = 
	`›“80211_assign_b—cÚ
(
sd©a
, 
lšk_d©a
,

3833 &
·¿ms
->
b—cÚ_c§
, &
c§
,

3834 
NULL
, 
chªged
);

3835 ià(
”r
 < 0) {

3836 
	`›“80211_ä“_Ãxt_b—cÚ
(
lšk_d©a
);

3837  
”r
;

3841 
NL80211_IFTYPE_ADHOC
:

3842 ià(!
sd©a
->
vif
.
cfg
.
ibss_jošed
)

3843  -
EINVAL
;

3845 ià(
·¿ms
->
chªdef
.
width
 !ğ
sd©a
->
u
.
ibss
.chandef.width)

3846  -
EINVAL
;

3848 
·¿ms
->
chªdef
.
width
) {

3849 
NL80211_CHAN_WIDTH_40
:

3850 ià(
	`cfg80211_g‘_chªdef_ty³
(&
·¿ms
->
chªdef
) !=

3851 
	`cfg80211_g‘_chªdef_ty³
(&
sd©a
->
u
.
ibss
.
chªdef
))

3852  -
EINVAL
;

3854 
NL80211_CHAN_WIDTH_5
:

3855 
NL80211_CHAN_WIDTH_10
:

3856 
NL80211_CHAN_WIDTH_20_NOHT
:

3857 
NL80211_CHAN_WIDTH_20
:

3860  -
EINVAL
;

3864 ià(
sd©a
->
u
.
ibss
.
chªdef
.
chª
->
bªd
 !=

3865 
·¿ms
->
chªdef
.
chª
->
bªd
)

3866  -
EINVAL
;

3869 ià(
·¿ms
->
couÁ
 > 1) {

3870 
”r
 = 
	`›“80211_ibss_c§_b—cÚ
(
sd©a
, 
·¿ms
, 
chªged
);

3871 ià(
”r
 < 0)

3872  
”r
;

3875 
	`›“80211_£nd_aùiÚ_c§
(
sd©a
, 
·¿ms
);

3878 #ifdeà
CONFIG_MAC80211_MESH


3879 
NL80211_IFTYPE_MESH_POINT
: {

3880 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

3883 ià(
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
->
bªd
 !=

3884 
·¿ms
->
chªdef
.
chª
->
bªd
)

3885  -
EINVAL
;

3887 ià(
ifmsh
->
c§_rŞe
 =ğ
IEEE80211_MESH_CSA_ROLE_NONE
) {

3888 
ifmsh
->
c§_rŞe
 = 
IEEE80211_MESH_CSA_ROLE_INIT
;

3889 ià(!
ifmsh
->
´e_v®ue
)

3890 
ifmsh
->
´e_v®ue
 = 1;

3892 
ifmsh
->
´e_v®ue
++;

3896 ià(
·¿ms
->
couÁ
 > 1) {

3897 
”r
 = 
	`›“80211_mesh_c§_b—cÚ
(
sd©a
, 
·¿ms
, 
chªged
);

3898 ià(
”r
 < 0) {

3899 
ifmsh
->
c§_rŞe
 = 
IEEE80211_MESH_CSA_ROLE_NONE
;

3900  
”r
;

3904 ià(
ifmsh
->
c§_rŞe
 =ğ
IEEE80211_MESH_CSA_ROLE_INIT
)

3905 
	`›“80211_£nd_aùiÚ_c§
(
sd©a
, 
·¿ms
);

3911  -
EOPNOTSUPP
;

3915 
	}
}

3917 
	$›“80211_cŞÜ_chªge_abÜt
(
›“80211_sub_if_d©a
 *
sd©a
)

3919 
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_aùive
 = 
çl£
;

3921 
	`›“80211_ä“_Ãxt_b—cÚ
(&
sd©a
->
deæšk
);

3923 
	`cfg80211_cŞÜ_chªge_abÜ‹d_nÙify
(
sd©a
->
dev
);

3924 
	}
}

3927 
	$__›“80211_chªÃl_sw™ch
(
why
 *why, 
Ãt_deviû
 *
dev
,

3928 
cfg80211_c§_£‰šgs
 *
·¿ms
)

3930 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

3931 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = 
·¿ms
->
chªdef
 };

3932 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3933 
›“80211_chªÃl_sw™ch
 
ch_sw™ch
 = {

3934 .
lšk_id
 = 
·¿ms
->link_id,

3936 
›“80211_chªùx_cÚf
 *
cÚf
;

3937 
›“80211_chªùx
 *
chªùx
;

3938 
›“80211_bss_cÚf
 *
lšk_cÚf
;

3939 
›“80211_lšk_d©a
 *
lšk_d©a
;

3940 
u64
 
chªged
 = 0;

3941 
u8
 
lšk_id
 = 
·¿ms
->link_id;

3942 
”r
;

3944 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3946 ià(!
	`li¡_em±y
(&
loÿl
->
roc_li¡
è||†oÿl->
sÿÂšg
)

3947  -
EBUSY
;

3949 ià(
sd©a
->
wdev
.
ÿc_¡¬‹d
)

3950  -
EBUSY
;

3952 ià(
	`WARN_ON
(
lšk_id
 >ğ
IEEE80211_MLD_MAX_NUM_LINKS
))

3953  -
EINVAL
;

3955 
lšk_d©a
 = 
	`why_d”eã»nû
(
why
, 
sd©a
->
lšk
[
lšk_id
]);

3956 ià(!
lšk_d©a
)

3957  -
ENOLINK
;

3959 
lšk_cÚf
 = 
lšk_d©a
->
cÚf
;

3961 ià(
chª»q
.
İ”
.
punùu»d
 && !
lšk_cÚf
->
eht_suµÜt
)

3962  -
EINVAL
;

3965 ià(
lšk_cÚf
->
c§_aùive
)

3966  -
EBUSY
;

3968 
cÚf
 = 
	`why_d”eã»nû
(
why
, 
lšk_cÚf
->
chªùx_cÚf
);

3969 ià(!
cÚf
) {

3970 
”r
 = -
EBUSY
;

3971 
out
;

3974 ià(
·¿ms
->
chªdef
.
chª
->
äeq_off£t
) {

3976 
”r
 = -
EOPNOTSUPP
;

3977 
out
;

3980 
chªùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

3982 
ch_sw™ch
.
time¡amp
 = 0;

3983 
ch_sw™ch
.
deviû_time¡amp
 = 0;

3984 
ch_sw™ch
.
block_tx
 = 
·¿ms
->block_tx;

3985 
ch_sw™ch
.
chªdef
 = 
chª»q
.
İ”
;

3986 
ch_sw™ch
.
couÁ
 = 
·¿ms
->count;

3988 
”r
 = 
	`drv_´e_chªÃl_sw™ch
(
sd©a
, &
ch_sw™ch
);

3989 ià(
”r
)

3990 
out
;

3992 
”r
 = 
	`›“80211_lšk_»£rve_chªùx
(
lšk_d©a
, &
chª»q
,

3993 
chªùx
->
mode
,

3994 
·¿ms
->
¿d¬_»quœed
);

3995 ià(
”r
)

3996 
out
;

3999 
”r
 = 
	`›“80211_check_combš©iÚs
(
sd©a
, 
NULL
, 
chªùx
->
mode
, 0);

4000 ià(
”r
) {

4001 
	`›“80211_lšk_uÄe£rve_chªùx
(
lšk_d©a
);

4002 
out
;

4006 ià(
lšk_cÚf
->
cŞÜ_chªge_aùive
)

4007 
	`›“80211_cŞÜ_chªge_abÜt
(
sd©a
);

4009 
”r
 = 
	`›“80211_£t_c§_b—cÚ
(
lšk_d©a
, 
·¿ms
, &
chªged
);

4010 ià(
”r
) {

4011 
	`›“80211_lšk_uÄe£rve_chªùx
(
lšk_d©a
);

4012 
out
;

4015 
lšk_d©a
->
c§_chª»q
 = 
chª»q
;

4016 
lšk_cÚf
->
c§_aùive
 = 
Œue
;

4018 ià(
·¿ms
->
block_tx
 &&

4019 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HANDLES_QUIET_CSA
)) {

4020 
	`›“80211_¡İ_vif_queues
(
loÿl
, 
sd©a
,

4021 
IEEE80211_QUEUE_STOP_REASON_CSA
);

4022 
sd©a
->
c§_blocked_tx
 = 
Œue
;

4025 
	`cfg80211_ch_sw™ch_¡¬‹d_nÙify
(
sd©a
->
dev
,

4026 &
lšk_d©a
->
c§_chª»q
.
İ”
, 0,

4027 
·¿ms
->
couÁ
,…¬ams->
block_tx
);

4029 ià(
chªged
) {

4030 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk_d©a
, 
chªged
);

4031 
	`drv_chªÃl_sw™ch_b—cÚ
(
sd©a
, &
lšk_d©a
->
c§_chª»q
.
İ”
);

4034 
	`›“80211_c§_fš®ize
(
lšk_d©a
);

4037 
out
:

4038  
”r
;

4039 
	}
}

4041 
	$›“80211_chªÃl_sw™ch
(
why
 *why, 
Ãt_deviû
 *
dev
,

4042 
cfg80211_c§_£‰šgs
 *
·¿ms
)

4044 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4045 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4047 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4049  
	`__›“80211_chªÃl_sw™ch
(
why
, 
dev
, 
·¿ms
);

4050 
	}
}

4052 
u64
 
	$›“80211_mgmt_tx_cook›
(
›“80211_loÿl
 *
loÿl
)

4054 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4056 
loÿl
->
roc_cook›_couÁ”
++;

4059 ià(
	`WARN_ON
(
loÿl
->
roc_cook›_couÁ”
 == 0))

4060 
loÿl
->
roc_cook›_couÁ”
++;

4062  
loÿl
->
roc_cook›_couÁ”
;

4063 
	}
}

4065 
	$›“80211_©ch_ack_skb
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
,

4066 
u64
 *
cook›
, 
gå_t
 
gå
)

4068 
¥š_æags
;

4069 
sk_buff
 *
ack_skb
;

4070 
id
;

4072 
ack_skb
 = 
	`skb_cİy
(
skb
, 
gå
);

4073 ià(!
ack_skb
)

4074  -
ENOMEM
;

4076 
	`¥š_lock_œq§ve
(&
loÿl
->
ack_¡©us_lock
, 
¥š_æags
);

4077 
id
 = 
	`idr_®loc
(&
loÿl
->
ack_¡©us_äames
, 
ack_skb
,

4078 1, 0x2000, 
GFP_ATOMIC
);

4079 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
ack_¡©us_lock
, 
¥š_æags
);

4081 ià(
id
 < 0) {

4082 
	`kä“_skb
(
ack_skb
);

4083  -
ENOMEM
;

4086 
	`IEEE80211_SKB_CB
(
skb
)->
¡©us_d©a_idr
 = 1;

4087 
	`IEEE80211_SKB_CB
(
skb
)->
¡©us_d©a
 = 
id
;

4089 *
cook›
 = 
	`›“80211_mgmt_tx_cook›
(
loÿl
);

4090 
	`IEEE80211_SKB_CB
(
ack_skb
)->
ack
.
cook›
 = *cookie;

4093 
	}
}

4096 
	$›“80211_upd©e_mgmt_äame_»gi¡¿tiÚs
(
why
 *wiphy,

4097 
wœ–ess_dev
 *
wdev
,

4098 
mgmt_äame_»gs
 *
upd
)

4100 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4101 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

4102 
u32
 
´eq_mask
 = 
	`BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4);

4103 
u32
 
aùiÚ_mask
 = 
	`BIT
(
IEEE80211_STYPE_ACTION
 >> 4);

4104 
boŞ
 
glob®_chªge
, 
štf_chªge
;

4106 
glob®_chªge
 =

4107 (
loÿl
->
´obe_»q_»g
 !ğ!!(
upd
->
glob®_¡y³s
 & 
´eq_mask
)) ||

4108 (
loÿl
->
rx_mÿ¡_aùiÚ_»g
 !=

4109 !!(
upd
->
glob®_mÿ¡_¡y³s
 & 
aùiÚ_mask
));

4110 
loÿl
->
´obe_»q_»g
 = 
upd
->
glob®_¡y³s
 & 
´eq_mask
;

4111 
loÿl
->
rx_mÿ¡_aùiÚ_»g
 = 
upd
->
glob®_mÿ¡_¡y³s
 & 
aùiÚ_mask
;

4113 
štf_chªge
 = (
sd©a
->
vif
.
´obe_»q_»g
 !=

4114 !!(
upd
->
š‹rçû_¡y³s
 & 
´eq_mask
)) ||

4115 (
sd©a
->
vif
.
rx_mÿ¡_aùiÚ_»g
 !=

4116 !!(
upd
->
š‹rçû_mÿ¡_¡y³s
 & 
aùiÚ_mask
));

4117 
sd©a
->
vif
.
´obe_»q_»g
 = 
upd
->
š‹rçû_¡y³s
 & 
´eq_mask
;

4118 
sd©a
->
vif
.
rx_mÿ¡_aùiÚ_»g
 =

4119 
upd
->
š‹rçû_mÿ¡_¡y³s
 & 
aùiÚ_mask
;

4121 ià(!
loÿl
->
İ’_couÁ
)

4124 ià(
štf_chªge
 && 
	`›“80211_sd©a_ruÂšg
(
sd©a
))

4125 
	`drv_cÚfig_içû_f‹r
(
loÿl
, 
sd©a
,

4126 
sd©a
->
vif
.
´obe_»q_»g
 ?

4127 
FIF_PROBE_REQ
 : 0,

4128 
FIF_PROBE_REQ
);

4130 ià(
glob®_chªge
)

4131 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

4132 
	}
}

4134 
	$›“80211_£t_ª‹Âa
(
why
 *why, 
u32
 
tx_ªt
, u32 
rx_ªt
)

4136 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4137 
»t
;

4139 ià(
loÿl
->
¡¬‹d
)

4140  -
EOPNOTSUPP
;

4142 
»t
 = 
	`drv_£t_ª‹Âa
(
loÿl
, 
tx_ªt
, 
rx_ªt
);

4143 ià(
»t
)

4144  
»t
;

4146 
loÿl
->
rx_chašs
 = 
	`hweight8
(
rx_ªt
);

4148 
	}
}

4150 
	$›“80211_g‘_ª‹Âa
(
why
 *why, 
u32
 *
tx_ªt
, u32 *
rx_ªt
)

4152 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4154  
	`drv_g‘_ª‹Âa
(
loÿl
, 
tx_ªt
, 
rx_ªt
);

4155 
	}
}

4157 
	$›“80211_£t_»key_d©a
(
why
 *wiphy,

4158 
Ãt_deviû
 *
dev
,

4159 
cfg80211_gtk_»key_d©a
 *
d©a
)

4161 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4162 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4164 ià(!
loÿl
->
İs
->
£t_»key_d©a
)

4165  -
EOPNOTSUPP
;

4167 
	`drv_£t_»key_d©a
(
loÿl
, 
sd©a
, 
d©a
);

4170 
	}
}

4172 
	$›“80211_´obe_ş›Á
(
why
 *why, 
Ãt_deviû
 *
dev
,

4173 cÚ¡ 
u8
 *
³”
, 
u64
 *
cook›
)

4175 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4176 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4177 
›“80211_qos_hdr
 *
nuÎfunc
;

4178 
sk_buff
 *
skb
;

4179 
size
 = (*
nuÎfunc
);

4180 
__Ë16
 
fc
;

4181 
boŞ
 
qos
;

4182 
›“80211_tx_šfo
 *
šfo
;

4183 
¡a_šfo
 *
¡a
;

4184 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

4185 
Æ80211_bªd
 
bªd
;

4186 
»t
;

4189 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4191 
	`rcu_»ad_lock
();

4192 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
³”
);

4193 ià(!
¡a
) {

4194 
»t
 = -
ENOLINK
;

4195 
uÆock
;

4198 
qos
 = 
¡a
->¡a.
wme
;

4200 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

4201 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

4202 
»t
 = -
EINVAL
;

4203 
uÆock
;

4205 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

4207 ià(
qos
) {

4208 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 |

4209 
IEEE80211_STYPE_QOS_NULLFUNC
 |

4210 
IEEE80211_FCTL_FROMDS
);

4212 
size
 -= 2;

4213 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 |

4214 
IEEE80211_STYPE_NULLFUNC
 |

4215 
IEEE80211_FCTL_FROMDS
);

4218 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
size
);

4219 ià(!
skb
) {

4220 
»t
 = -
ENOMEM
;

4221 
uÆock
;

4224 
skb
->
dev
 = dev;

4226 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

4228 
nuÎfunc
 = 
	`skb_put
(
skb
, 
size
);

4229 
nuÎfunc
->
äame_cÚŒŞ
 = 
fc
;

4230 
nuÎfunc
->
du¿tiÚ_id
 = 0;

4231 
	`memıy
(
nuÎfunc
->
addr1
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

4232 
	`memıy
(
nuÎfunc
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

4233 
	`memıy
(
nuÎfunc
->
addr3
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

4234 
nuÎfunc
->
£q_ù¾
 = 0;

4236 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

4238 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
 |

4239 
IEEE80211_TX_INTFL_NL80211_FRAME_TX
;

4240 
šfo
->
bªd
 = band;

4242 
	`skb_£t_queue_m­pšg
(
skb
, 
IEEE80211_AC_VO
);

4243 
skb
->
´iÜ™y
 = 7;

4244 ià(
qos
)

4245 
nuÎfunc
->
qos_ù¾
 = 
	`ıu_to_Ë16
(7);

4247 
»t
 = 
	`›“80211_©ch_ack_skb
(
loÿl
, 
skb
, 
cook›
, 
GFP_ATOMIC
);

4248 ià(
»t
) {

4249 
	`kä“_skb
(
skb
);

4250 
uÆock
;

4253 
	`loÿl_bh_di§bË
();

4254 
	`›“80211_xm™
(
sd©a
, 
¡a
, 
skb
);

4255 
	`loÿl_bh_’abË
();

4257 
»t
 = 0;

4258 
uÆock
:

4259 
	`rcu_»ad_uÆock
();

4261  
»t
;

4262 
	}
}

4264 
	$›“80211_cfg_g‘_chªÃl
(
why
 *wiphy,

4265 
wœ–ess_dev
 *
wdev
,

4266 
lšk_id
,

4267 
cfg80211_chª_def
 *
chªdef
)

4269 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

4270 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4271 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

4272 
›“80211_lšk_d©a
 *
lšk
;

4273 
»t
 = -
ENODATA
;

4275 
	`rcu_»ad_lock
();

4276 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

4277 ià(!
lšk
) {

4278 
»t
 = -
ENOLINK
;

4279 
out
;

4282 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
lšk
->
cÚf
->chanctx_conf);

4283 ià(
chªùx_cÚf
) {

4284 *
chªdef
 = 
lšk
->
cÚf
->
chª»q
.
İ”
;

4285 
»t
 = 0;

4286 } ià(
loÿl
->
İ’_couÁ
 > 0 &&

4287 
loÿl
->
İ’_couÁ
 =ğloÿl->
mÚ™Üs
 &&

4288 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
) {

4289 *
chªdef
 = 
loÿl
->
mÚ™Ü_chª»q
.
İ”
;

4290 
»t
 = 0;

4292 
out
:

4293 
	`rcu_»ad_uÆock
();

4295  
»t
;

4296 
	}
}

4298 #ifdeà
CONFIG_PM


4299 
	$›“80211_£t_wakeup
(
why
 *why, 
boŞ
 
’abËd
)

4301 
	`drv_£t_wakeup
(
	`why_´iv
(
why
), 
’abËd
);

4302 
	}
}

4305 
	$›“80211_£t_qos_m­
(
why
 *wiphy,

4306 
Ãt_deviû
 *
dev
,

4307 
cfg80211_qos_m­
 *
qos_m­
)

4309 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4310 
mac80211_qos_m­
 *
Ãw_qos_m­
, *
Şd_qos_m­
;

4312 ià(
qos_m­
) {

4313 
Ãw_qos_m­
 = 
	`kz®loc
((*Ãw_qos_m­), 
GFP_KERNEL
);

4314 ià(!
Ãw_qos_m­
)

4315  -
ENOMEM
;

4316 
	`memıy
(&
Ãw_qos_m­
->
qos_m­
, qos_map, (*qos_map));

4319 
Ãw_qos_m­
 = 
NULL
;

4322 
Şd_qos_m­
 = 
	`sd©a_d”eã»nû
(
sd©a
->
qos_m­
, sdata);

4323 
	`rcu_assign_poš‹r
(
sd©a
->
qos_m­
, 
Ãw_qos_m­
);

4324 ià(
Şd_qos_m­
)

4325 
	`kä“_rcu
(
Şd_qos_m­
, 
rcu_h—d
);

4328 
	}
}

4330 
	$›“80211_£t_­_chªwidth
(
why
 *wiphy,

4331 
Ãt_deviû
 *
dev
,

4332 
lšk_id
,

4333 
cfg80211_chª_def
 *
chªdef
)

4335 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4336 
›“80211_lšk_d©a
 *
lšk
;

4337 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = *
chªdef
 };

4338 
»t
;

4339 
u64
 
chªged
 = 0;

4341 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

4343 
»t
 = 
	`›“80211_lšk_chªge_chª»q
(
lšk
, &
chª»q
, &
chªged
);

4344 ià(
»t
 == 0)

4345 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

4347  
»t
;

4348 
	}
}

4350 
	$›“80211_add_tx_ts
(
why
 *why, 
Ãt_deviû
 *
dev
,

4351 
u8
 
tsid
, cÚ¡ u8 *
³”
, u8 
up
,

4352 
u16
 
adm™‹d_time
)

4354 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4355 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

4356 
ac
 = 
›“802_1d_to_ac
[
up
];

4358 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

4359  -
EOPNOTSUPP
;

4361 ià(!(
sd©a
->
wmm_acm
 & 
	`BIT
(
up
)))

4362  -
EINVAL
;

4364 ià(
ifmgd
->
tx_t¥ec
[
ac
].
adm™‹d_time
)

4365  -
EBUSY
;

4367 ià(
adm™‹d_time
) {

4368 
ifmgd
->
tx_t¥ec
[
ac
].
adm™‹d_time
 = 32 *‡dmitted_time;

4369 
ifmgd
->
tx_t¥ec
[
ac
].
tsid
 =sid;

4370 
ifmgd
->
tx_t¥ec
[
ac
].
up
 = up;

4374 
	}
}

4376 
	$›“80211_d–_tx_ts
(
why
 *why, 
Ãt_deviû
 *
dev
,

4377 
u8
 
tsid
, cÚ¡ u8 *
³”
)

4379 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4380 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

4381 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4382 
ac
;

4384 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

4385 
›“80211_¡a_tx_t¥ec
 *
tx_t¥ec
 = &
ifmgd
->tx_t¥ec[
ac
];

4388 ià(!
tx_t¥ec
->
adm™‹d_time
)

4391 ià(
tx_t¥ec
->
tsid
 !=sid)

4395 
tx_t¥ec
->
up
 = -1;

4401 
	`synchrÚize_Ãt
();

4402 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
çl£
);

4407 
tx_t¥ec
->
aùiÚ
 = 
TX_TSPEC_ACTION_STOP_DOWNGRADE
;

4408 
tx_t¥ec
->
downg¿ded
 = 
çl£
;

4409 
	`›“80211_¡a_hªdË_t¥ec_ac_·¿ms
(
sd©a
);

4412 
	`mem£t
(
tx_t¥ec
, 0, (*tx_tspec));

4417  -
ENOENT
;

4418 
	}
}

4420 
	$›“80211_Çn_func_‹rmš©ed
(
›“80211_vif
 *
vif
,

4421 
u8
 
š¡_id
,

4422 
Æ80211_Çn_func_‹rm_»asÚ
 
»asÚ
,

4423 
gå_t
 
gå
)

4425 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

4426 
cfg80211_Çn_func
 *
func
;

4427 
u64
 
cook›
;

4429 ià(
	`WARN_ON
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_NAN
))

4432 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

4434 
func
 = 
	`idr_fšd
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
š¡_id
);

4435 ià(
	`WARN_ON
(!
func
)) {

4436 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

4440 
cook›
 = 
func
->cookie;

4441 
	`idr_»move
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
š¡_id
);

4443 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

4445 
	`cfg80211_ä“_Çn_func
(
func
);

4447 
	`cfg80211_Çn_func_‹rmš©ed
(
	`›“80211_vif_to_wdev
(
vif
), 
š¡_id
,

4448 
»asÚ
, 
cook›
, 
gå
);

4449 
	}
}

4450 
EXPORT_SYMBOL
(
›“80211_Çn_func_‹rmš©ed
);

4452 
	$›“80211_Çn_func_m©ch
(
›“80211_vif
 *
vif
,

4453 
cfg80211_Çn_m©ch_·¿ms
 *
m©ch
,

4454 
gå_t
 
gå
)

4456 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

4457 
cfg80211_Çn_func
 *
func
;

4459 ià(
	`WARN_ON
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_NAN
))

4462 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

4464 
func
 = 
	`idr_fšd
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
m©ch
->
š¡_id
);

4465 ià(
	`WARN_ON
(!
func
)) {

4466 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

4469 
m©ch
->
cook›
 = 
func
->cookie;

4471 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

4473 
	`cfg80211_Çn_m©ch
(
	`›“80211_vif_to_wdev
(
vif
), 
m©ch
, 
gå
);

4474 
	}
}

4475 
EXPORT_SYMBOL
(
›“80211_Çn_func_m©ch
);

4477 
	$›“80211_£t_muÉiÿ¡_to_uniÿ¡
(
why
 *wiphy,

4478 
Ãt_deviû
 *
dev
,

4479 cÚ¡ 
boŞ
 
’abËd
)

4481 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4483 
sd©a
->
u
.
­
.
muÉiÿ¡_to_uniÿ¡
 = 
’abËd
;

4486 
	}
}

4488 
	$›“80211_fl_txq_¡©s
(
cfg80211_txq_¡©s
 *
txq¡©s
,

4489 
txq_šfo
 *
txqi
)

4491 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_BACKLOG_BYTES
))) {

4492 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_BACKLOG_BYTES
);

4493 
txq¡©s
->
backlog_by‹s
 = 
txqi
->
tš
.backlog_bytes;

4496 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_BACKLOG_PACKETS
))) {

4497 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_BACKLOG_PACKETS
);

4498 
txq¡©s
->
backlog_·ck‘s
 = 
txqi
->
tš
.backlog_packets;

4501 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_FLOWS
))) {

4502 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_FLOWS
);

4503 
txq¡©s
->
æows
 = 
txqi
->
tš
.flows;

4506 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_DROPS
))) {

4507 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_DROPS
);

4508 
txq¡©s
->
drİs
 = 
txqi
->
c¡©s
.
drİ_couÁ
;

4511 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_ECN_MARKS
))) {

4512 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_ECN_MARKS
);

4513 
txq¡©s
->
eú_m¬ks
 = 
txqi
->
c¡©s
.
eú_m¬k
;

4516 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_OVERLIMIT
))) {

4517 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_OVERLIMIT
);

4518 
txq¡©s
->
ov”lim™
 = 
txqi
->
tš
.overlimit;

4521 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_COLLISIONS
))) {

4522 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_COLLISIONS
);

4523 
txq¡©s
->
cŞlisiÚs
 = 
txqi
->
tš
.collisions;

4526 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_TX_BYTES
))) {

4527 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_TX_BYTES
);

4528 
txq¡©s
->
tx_by‹s
 = 
txqi
->
tš
.tx_bytes;

4531 ià(!(
txq¡©s
->
fËd
 & 
	`BIT
(
NL80211_TXQ_STATS_TX_PACKETS
))) {

4532 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_TX_PACKETS
);

4533 
txq¡©s
->
tx_·ck‘s
 = 
txqi
->
tš
.tx_packets;

4535 
	}
}

4537 
	$›“80211_g‘_txq_¡©s
(
why
 *wiphy,

4538 
wœ–ess_dev
 *
wdev
,

4539 
cfg80211_txq_¡©s
 *
txq¡©s
)

4541 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4542 
›“80211_sub_if_d©a
 *
sd©a
;

4543 
»t
 = 0;

4545 
	`¥š_lock_bh
(&
loÿl
->
fq
.
lock
);

4546 
	`rcu_»ad_lock
();

4548 ià(
wdev
) {

4549 
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

4550 ià(!
sd©a
->
vif
.
txq
) {

4551 
»t
 = 1;

4552 
out
;

4554 
	`›“80211_fl_txq_¡©s
(
txq¡©s
, 
	`to_txq_šfo
(
sd©a
->
vif
.
txq
));

4557 
txq¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TXQ_STATS_BACKLOG_PACKETS
) |

4558 
	`BIT
(
NL80211_TXQ_STATS_BACKLOG_BYTES
) |

4559 
	`BIT
(
NL80211_TXQ_STATS_OVERLIMIT
) |

4560 
	`BIT
(
NL80211_TXQ_STATS_OVERMEMORY
) |

4561 
	`BIT
(
NL80211_TXQ_STATS_COLLISIONS
) |

4562 
	`BIT
(
NL80211_TXQ_STATS_MAX_FLOWS
);

4563 
txq¡©s
->
backlog_·ck‘s
 = 
loÿl
->
fq
.
backlog
;

4564 
txq¡©s
->
backlog_by‹s
 = 
loÿl
->
fq
.
memÜy_u§ge
;

4565 
txq¡©s
->
ov”lim™
 = 
loÿl
->
fq
.overlimit;

4566 
txq¡©s
->
ov”memÜy
 = 
loÿl
->
fq
.overmemory;

4567 
txq¡©s
->
cŞlisiÚs
 = 
loÿl
->
fq
.collisions;

4568 
txq¡©s
->
max_æows
 = 
loÿl
->
fq
.
æows_út
;

4571 
out
:

4572 
	`rcu_»ad_uÆock
();

4573 
	`¥š_uÆock_bh
(&
loÿl
->
fq
.
lock
);

4575  
»t
;

4576 
	}
}

4579 
	$›“80211_g‘_ám_»¥Úd”_¡©s
(
why
 *wiphy,

4580 
Ãt_deviû
 *
dev
,

4581 
cfg80211_ám_»¥Úd”_¡©s
 *
ám_¡©s
)

4583 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4584 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4586  
	`drv_g‘_ám_»¥Úd”_¡©s
(
loÿl
, 
sd©a
, 
ám_¡©s
);

4587 
	}
}

4590 
	$›“80211_¡¬t_pm¤
(
why
 *why, 
wœ–ess_dev
 *
dev
,

4591 
cfg80211_pm¤_»que¡
 *
»que¡
)

4593 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4594 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
dev
);

4596  
	`drv_¡¬t_pm¤
(
loÿl
, 
sd©a
, 
»que¡
);

4597 
	}
}

4600 
	$›“80211_abÜt_pm¤
(
why
 *why, 
wœ–ess_dev
 *
dev
,

4601 
cfg80211_pm¤_»que¡
 *
»que¡
)

4603 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4604 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
dev
);

4606  
	`drv_abÜt_pm¤
(
loÿl
, 
sd©a
, 
»que¡
);

4607 
	}
}

4609 
	$›“80211_£t_tid_cÚfig
(
why
 *wiphy,

4610 
Ãt_deviû
 *
dev
,

4611 
cfg80211_tid_cÚfig
 *
tid_cÚf
)

4613 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4614 
¡a_šfo
 *
¡a
;

4616 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4618 ià(!
sd©a
->
loÿl
->
İs
->
£t_tid_cÚfig
)

4619  -
EOPNOTSUPP
;

4621 ià(!
tid_cÚf
->
³”
)

4622  
	`drv_£t_tid_cÚfig
(
sd©a
->
loÿl
, sd©a, 
NULL
, 
tid_cÚf
);

4624 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
tid_cÚf
->
³”
);

4625 ià(!
¡a
)

4626  -
ENOENT
;

4628  
	`drv_£t_tid_cÚfig
(
sd©a
->
loÿl
, sd©a, &
¡a
->¡a, 
tid_cÚf
);

4629 
	}
}

4631 
	$›“80211_»£t_tid_cÚfig
(
why
 *wiphy,

4632 
Ãt_deviû
 *
dev
,

4633 cÚ¡ 
u8
 *
³”
, u8 
tids
)

4635 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4636 
¡a_šfo
 *
¡a
;

4638 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4640 ià(!
sd©a
->
loÿl
->
İs
->
»£t_tid_cÚfig
)

4641  -
EOPNOTSUPP
;

4643 ià(!
³”
)

4644  
	`drv_»£t_tid_cÚfig
(
sd©a
->
loÿl
, sd©a, 
NULL
, 
tids
);

4646 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
³”
);

4647 ià(!
¡a
)

4648  -
ENOENT
;

4650  
	`drv_»£t_tid_cÚfig
(
sd©a
->
loÿl
, sd©a, &
¡a
->¡a, 
tids
);

4651 
	}
}

4653 
	$›“80211_£t_§r_¥ecs
(
why
 *wiphy,

4654 
cfg80211_§r_¥ecs
 *
§r
)

4656 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4658 ià(!
loÿl
->
İs
->
£t_§r_¥ecs
)

4659  -
EOPNOTSUPP
;

4661  
loÿl
->
İs
->
	`£t_§r_¥ecs
(&loÿl->
hw
, 
§r
);

4662 
	}
}

4665 
	$›“80211_£t_aá”_cŞÜ_chªge_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

4666 
u64
 *
chªged
)

4668 
sd©a
->
vif
.
ty³
) {

4669 
NL80211_IFTYPE_AP
: {

4670 
»t
;

4672 ià(!
sd©a
->
deæšk
.
u
.
­
.
Ãxt_b—cÚ
)

4673  -
EINVAL
;

4675 
»t
 = 
	`›“80211_assign_b—cÚ
(
sd©a
, &sd©a->
deæšk
,

4676 
sd©a
->
deæšk
.
u
.
­
.
Ãxt_b—cÚ
,

4677 
NULL
, NULL, 
chªged
);

4678 
	`›“80211_ä“_Ãxt_b—cÚ
(&
sd©a
->
deæšk
);

4680 ià(
»t
 < 0)

4681  
»t
;

4686 
	`WARN_ON_ONCE
(1);

4687  -
EINVAL
;

4691 
	}
}

4694 
	$›“80211_£t_cŞÜ_chªge_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

4695 
cfg80211_cŞÜ_chªge_£‰šgs
 *
·¿ms
,

4696 
u64
 *
chªged
)

4698 
›“80211_cŞÜ_chªge_£‰šgs
 
cŞÜ_chªge
 = {};

4699 
”r
;

4701 
sd©a
->
vif
.
ty³
) {

4702 
NL80211_IFTYPE_AP
:

4703 
sd©a
->
deæšk
.
u
.
­
.
Ãxt_b—cÚ
 =

4704 
	`cfg80211_b—cÚ_dup
(&
·¿ms
->
b—cÚ_Ãxt
);

4705 ià(!
sd©a
->
deæšk
.
u
.
­
.
Ãxt_b—cÚ
)

4706  -
ENOMEM
;

4708 ià(
·¿ms
->
couÁ
 <= 1)

4711 
cŞÜ_chªge
.
couÁ”_off£t_b—cÚ
 =

4712 
·¿ms
->
couÁ”_off£t_b—cÚ
;

4713 
cŞÜ_chªge
.
couÁ”_off£t_´e¥
 =

4714 
·¿ms
->
couÁ”_off£t_´e¥
;

4715 
cŞÜ_chªge
.
couÁ
 = 
·¿ms
->count;

4717 
”r
 = 
	`›“80211_assign_b—cÚ
(
sd©a
, &sd©a->
deæšk
,

4718 &
·¿ms
->
b—cÚ_cŞÜ_chªge
,

4719 
NULL
, &
cŞÜ_chªge
, 
chªged
);

4720 ià(
”r
 < 0) {

4721 
	`›“80211_ä“_Ãxt_b—cÚ
(&
sd©a
->
deæšk
);

4722  
”r
;

4726  -
EOPNOTSUPP
;

4730 
	}
}

4733 
	$›“80211_cŞÜ_chªge_bss_cÚfig_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

4734 
u8
 
cŞÜ
, 
’abË
, 
u64
 
chªged
)

4736 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4738 
sd©a
->
vif
.
bss_cÚf
.
he_bss_cŞÜ
.
cŞÜ
 = color;

4739 
sd©a
->
vif
.
bss_cÚf
.
he_bss_cŞÜ
.
’abËd
 = 
’abË
;

4740 
chªged
 |ğ
BSS_CHANGED_HE_BSS_COLOR
;

4742 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
, 
chªged
);

4744 ià(!
sd©a
->
vif
.
bss_cÚf
.
nÚŒªsm™‹d
 && sd©a->vif.
mbssid_tx_vif
) {

4745 
›“80211_sub_if_d©a
 *
chd
;

4747 
	`li¡_fÜ_—ch_’Œy
(
chd
, &
sd©a
->
loÿl
->
š‹rçûs
, 
li¡
) {

4748 ià(
chd
 !ğ
sd©a
 && chd->
vif
.
mbssid_tx_vif
 == &sdata->vif) {

4749 
chd
->
vif
.
bss_cÚf
.
he_bss_cŞÜ
.
cŞÜ
 = color;

4750 
chd
->
vif
.
bss_cÚf
.
he_bss_cŞÜ
.
’abËd
 = 
’abË
;

4751 
	`›“80211_lšk_šfo_chªge_nÙify
(
chd
,

4752 &
chd
->
deæšk
,

4753 
BSS_CHANGED_HE_BSS_COLOR
);

4757 
	}
}

4759 
	$›“80211_cŞÜ_chªge_fš®ize
(
›“80211_sub_if_d©a
 *
sd©a
)

4761 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4762 
u64
 
chªged
 = 0;

4763 
”r
;

4765 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4767 
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_aùive
 = 
çl£
;

4769 
”r
 = 
	`›“80211_£t_aá”_cŞÜ_chªge_b—cÚ
(
sd©a
, &
chªged
);

4770 ià(
”r
) {

4771 
	`cfg80211_cŞÜ_chªge_abÜ‹d_nÙify
(
sd©a
->
dev
);

4772  
”r
;

4775 
	`›“80211_cŞÜ_chªge_bss_cÚfig_nÙify
(
sd©a
,

4776 
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_cŞÜ
,

4777 1, 
chªged
);

4778 
	`cfg80211_cŞÜ_chªge_nÙify
(
sd©a
->
dev
);

4781 
	}
}

4783 
	$›“80211_cŞÜ_chªge_fš®ize_wÜk
(
why
 *wiphy,

4784 
why_wÜk
 *
wÜk
)

4786 
›“80211_sub_if_d©a
 *
sd©a
 =

4787 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

4788 
deæšk
.
cŞÜ_chªge_fš®ize_wÜk
);

4789 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4791 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4794 ià(!
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_aùive
)

4797 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

4800 
	`›“80211_cŞÜ_chªge_fš®ize
(
sd©a
);

4801 
	}
}

4803 
	$›“80211_cŞÜ_cŞlisiÚ_d‘eùiÚ_wÜk
(
wÜk_¡ruù
 *
wÜk
)

4805 
d–ayed_wÜk
 *d–ayed_wÜk = 
	`to_d–ayed_wÜk
(
wÜk
);

4806 
›“80211_lšk_d©a
 *
lšk
 =

4807 
	`cÚš”_of
(
d–ayed_wÜk
, 
›“80211_lšk_d©a
,

4808 
cŞÜ_cŞlisiÚ_d‘eù_wÜk
);

4809 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

4811 
	`cfg80211_obss_cŞÜ_cŞlisiÚ_nÙify
(
sd©a
->
dev
, 
lšk
->
cŞÜ_b™m­
);

4812 
	}
}

4814 
	$›“80211_cŞÜ_chªge_fšish
(
›“80211_vif
 *
vif
)

4816 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

4818 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

4819 &
sd©a
->
deæšk
.
cŞÜ_chªge_fš®ize_wÜk
);

4820 
	}
}

4821 
EXPORT_SYMBOL_GPL
(
›“80211_cŞÜ_chªge_fšish
);

4824 
	$›“80211_obss_cŞÜ_cŞlisiÚ_nÙify
(
›“80211_vif
 *
vif
,

4825 
u64
 
cŞÜ_b™m­
)

4827 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

4828 
›“80211_lšk_d©a
 *
lšk
 = &
sd©a
->
deæšk
;

4830 ià(
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_aùive
 || sd©a->vif.bss_cÚf.
c§_aùive
)

4833 ià(
	`d–ayed_wÜk_³ndšg
(&
lšk
->
cŞÜ_cŞlisiÚ_d‘eù_wÜk
))

4836 
lšk
->
cŞÜ_b™m­
 = color_bitmap;

4840 
	`›“80211_queue_d–ayed_wÜk
(&
sd©a
->
loÿl
->
hw
,

4841 &
lšk
->
cŞÜ_cŞlisiÚ_d‘eù_wÜk
,

4842 
	`m£cs_to_jiff›s
(500));

4843 
	}
}

4844 
EXPORT_SYMBOL_GPL
(
›“80211_obss_cŞÜ_cŞlisiÚ_nÙify
);

4847 
	$›“80211_cŞÜ_chªge
(
why
 *why, 
Ãt_deviû
 *
dev
,

4848 
cfg80211_cŞÜ_chªge_£‰šgs
 *
·¿ms
)

4850 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4851 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4852 
u64
 
chªged
 = 0;

4853 
”r
;

4855 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4857 ià(
sd©a
->
vif
.
bss_cÚf
.
nÚŒªsm™‹d
)

4858  -
EINVAL
;

4863 ià(
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_aùive
 || sd©a->vif.bss_cÚf.
c§_aùive
) {

4864 
”r
 = -
EBUSY
;

4865 
out
;

4868 
”r
 = 
	`›“80211_£t_cŞÜ_chªge_b—cÚ
(
sd©a
, 
·¿ms
, &
chªged
);

4869 ià(
”r
)

4870 
out
;

4872 
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_aùive
 = 
Œue
;

4873 
sd©a
->
vif
.
bss_cÚf
.
cŞÜ_chªge_cŞÜ
 = 
·¿ms
->
cŞÜ
;

4875 
	`cfg80211_cŞÜ_chªge_¡¬‹d_nÙify
(
sd©a
->
dev
, 
·¿ms
->
couÁ
);

4877 ià(
chªged
)

4878 
	`›“80211_cŞÜ_chªge_bss_cÚfig_nÙify
(
sd©a
, 0, 0, 
chªged
);

4881 
	`›“80211_cŞÜ_chªge_fš®ize
(
sd©a
);

4883 
out
:

4885  
”r
;

4886 
	}
}

4889 
	$›“80211_£t_¿d¬_background
(
why
 *wiphy,

4890 
cfg80211_chª_def
 *
chªdef
)

4892 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4894 ià(!
loÿl
->
İs
->
£t_¿d¬_background
)

4895  -
EOPNOTSUPP
;

4897  
loÿl
->
İs
->
	`£t_¿d¬_background
(&loÿl->
hw
, 
chªdef
);

4898 
	}
}

4900 
	$›“80211_add_štf_lšk
(
why
 *wiphy,

4901 
wœ–ess_dev
 *
wdev
,

4902 
lšk_id
)

4904 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

4906 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4908 ià(
wdev
->
u£_4addr
)

4909  -
EOPNOTSUPP
;

4911  
	`›“80211_vif_£t_lšks
(
sd©a
, 
wdev
->
v®id_lšks
, 0);

4912 
	}
}

4914 
	$›“80211_d–_štf_lšk
(
why
 *wiphy,

4915 
wœ–ess_dev
 *
wdev
,

4916 
lšk_id
)

4918 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

4920 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4922 
	`›“80211_vif_£t_lšks
(
sd©a
, 
wdev
->
v®id_lšks
, 0);

4923 
	}
}

4925 
	$¡a_add_lšk_¡©iÚ
(
›“80211_loÿl
 *
loÿl
,

4926 
›“80211_sub_if_d©a
 *
sd©a
,

4927 
lšk_¡©iÚ_·¿m‘”s
 *
·¿ms
)

4929 
¡a_šfo
 *
¡a
;

4930 
»t
;

4932 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
·¿ms
->
mld_mac
);

4933 ià(!
¡a
)

4934  -
ENOENT
;

4936 ià(!
¡a
->¡a.
v®id_lšks
)

4937  -
EINVAL
;

4939 ià(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
·¿ms
->
lšk_id
))

4940  -
EALREADY
;

4942 
»t
 = 
	`›“80211_¡a_®loÿ‹_lšk
(
¡a
, 
·¿ms
->
lšk_id
);

4943 ià(
»t
)

4944  
»t
;

4946 
»t
 = 
	`¡a_lšk_­¶y_·¿m‘”s
(
loÿl
, 
¡a
, 
Œue
, 
·¿ms
);

4947 ià(
»t
) {

4948 
	`›“80211_¡a_ä“_lšk
(
¡a
, 
·¿ms
->
lšk_id
);

4949  
»t
;

4953  
	`›“80211_¡a_aùiv©e_lšk
(
¡a
, 
·¿ms
->
lšk_id
);

4954 
	}
}

4957 
	$›“80211_add_lšk_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

4958 
lšk_¡©iÚ_·¿m‘”s
 *
·¿ms
)

4960 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4961 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4963 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4965  
	`¡a_add_lšk_¡©iÚ
(
loÿl
, 
sd©a
, 
·¿ms
);

4966 
	}
}

4968 
	$¡a_mod_lšk_¡©iÚ
(
›“80211_loÿl
 *
loÿl
,

4969 
›“80211_sub_if_d©a
 *
sd©a
,

4970 
lšk_¡©iÚ_·¿m‘”s
 *
·¿ms
)

4972 
¡a_šfo
 *
¡a
;

4974 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
·¿ms
->
mld_mac
);

4975 ià(!
¡a
)

4976  -
ENOENT
;

4978 ià(!(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
·¿ms
->
lšk_id
)))

4979  -
EINVAL
;

4981  
	`¡a_lšk_­¶y_·¿m‘”s
(
loÿl
, 
¡a
, 
çl£
, 
·¿ms
);

4982 
	}
}

4985 
	$›“80211_mod_lšk_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

4986 
lšk_¡©iÚ_·¿m‘”s
 *
·¿ms
)

4988 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4989 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

4991 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4993  
	`¡a_mod_lšk_¡©iÚ
(
loÿl
, 
sd©a
, 
·¿ms
);

4994 
	}
}

4996 
	$¡a_d–_lšk_¡©iÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

4997 
lšk_¡©iÚ_d–_·¿m‘”s
 *
·¿ms
)

4999 
¡a_šfo
 *
¡a
;

5001 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
·¿ms
->
mld_mac
);

5002 ià(!
¡a
)

5003  -
ENOENT
;

5005 ià(!(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
·¿ms
->
lšk_id
)))

5006  -
EINVAL
;

5009 ià(
¡a
->¡a.
v®id_lšks
 =ğ
	`BIT
(
·¿ms
->
lšk_id
))

5010  -
EINVAL
;

5012 
	`›“80211_¡a_»move_lšk
(
¡a
, 
·¿ms
->
lšk_id
);

5015 
	}
}

5018 
	$›“80211_d–_lšk_¡©iÚ
(
why
 *why, 
Ãt_deviû
 *
dev
,

5019 
lšk_¡©iÚ_d–_·¿m‘”s
 *
·¿ms
)

5021 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

5023 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

5025  
	`¡a_d–_lšk_¡©iÚ
(
sd©a
, 
·¿ms
);

5026 
	}
}

5028 
	$›“80211_£t_hw_time¡amp
(
why
 *wiphy,

5029 
Ãt_deviû
 *
dev
,

5030 
cfg80211_£t_hw_time¡amp
 *
hwts
)

5032 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

5033 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

5035 ià(!
loÿl
->
İs
->
£t_hw_time¡amp
)

5036  -
EOPNOTSUPP
;

5038 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

5039  -
EIO
;

5041  
loÿl
->
İs
->
	`£t_hw_time¡amp
(&loÿl->
hw
, &
sd©a
->
vif
, 
hwts
);

5042 
	}
}

5045 
	$›“80211_£t_‰lm
(
why
 *why, 
Ãt_deviû
 *
dev
,

5046 
cfg80211_‰lm_·¿ms
 *
·¿ms
)

5048 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

5050 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

5052  
	`›“80211_»q_Ãg_‰lm
(
sd©a
, 
·¿ms
);

5053 
	}
}

5055 cÚ¡ 
cfg80211_İs
 
	gmac80211_cÚfig_İs
 = {

5056 .
add_vœtu®_štf
 = 
›“80211_add_içû
,

5057 .
	gd–_vœtu®_štf
 = 
›“80211_d–_içû
,

5058 .
	gchªge_vœtu®_štf
 = 
›“80211_chªge_içû
,

5059 .
	g¡¬t_p2p_deviû
 = 
›“80211_¡¬t_p2p_deviû
,

5060 .
	g¡İ_p2p_deviû
 = 
›“80211_¡İ_p2p_deviû
,

5061 .
	gadd_key
 = 
›“80211_add_key
,

5062 .
	gd–_key
 = 
›“80211_d–_key
,

5063 .
	gg‘_key
 = 
›“80211_g‘_key
,

5064 .
	g£t_deçuÉ_key
 = 
›“80211_cÚfig_deçuÉ_key
,

5065 .
	g£t_deçuÉ_mgmt_key
 = 
›“80211_cÚfig_deçuÉ_mgmt_key
,

5066 .
	g£t_deçuÉ_b—cÚ_key
 = 
›“80211_cÚfig_deçuÉ_b—cÚ_key
,

5067 .
	g¡¬t_­
 = 
›“80211_¡¬t_­
,

5068 .
	gchªge_b—cÚ
 = 
›“80211_chªge_b—cÚ
,

5069 .
	g¡İ_­
 = 
›“80211_¡İ_­
,

5070 .
	gadd_¡©iÚ
 = 
›“80211_add_¡©iÚ
,

5071 .
	gd–_¡©iÚ
 = 
›“80211_d–_¡©iÚ
,

5072 .
	gchªge_¡©iÚ
 = 
›“80211_chªge_¡©iÚ
,

5073 .
	gg‘_¡©iÚ
 = 
›“80211_g‘_¡©iÚ
,

5074 .
	gdump_¡©iÚ
 = 
›“80211_dump_¡©iÚ
,

5075 .
	gdump_survey
 = 
›“80211_dump_survey
,

5076 #ifdeà
CONFIG_MAC80211_MESH


5077 .
	gadd_m·th
 = 
›“80211_add_m·th
,

5078 .
	gd–_m·th
 = 
›“80211_d–_m·th
,

5079 .
	gchªge_m·th
 = 
›“80211_chªge_m·th
,

5080 .
	gg‘_m·th
 = 
›“80211_g‘_m·th
,

5081 .
	gdump_m·th
 = 
›“80211_dump_m·th
,

5082 .
	gg‘_mµ
 = 
›“80211_g‘_mµ
,

5083 .
	gdump_mµ
 = 
›“80211_dump_mµ
,

5084 .
	gupd©e_mesh_cÚfig
 = 
›“80211_upd©e_mesh_cÚfig
,

5085 .
	gg‘_mesh_cÚfig
 = 
›“80211_g‘_mesh_cÚfig
,

5086 .
	gjoš_mesh
 = 
›“80211_još_mesh
,

5087 .
	gËave_mesh
 = 
›“80211_Ëave_mesh
,

5089 .
	gjoš_ocb
 = 
›“80211_još_ocb
,

5090 .
	gËave_ocb
 = 
›“80211_Ëave_ocb
,

5091 .
	gchªge_bss
 = 
›“80211_chªge_bss
,

5092 .
	gšfÜm_bss
 = 
›“80211_šfÜm_bss
,

5093 .
	g£t_txq_·¿ms
 = 
›“80211_£t_txq_·¿ms
,

5094 .
	g£t_mÚ™Ü_chªÃl
 = 
›“80211_£t_mÚ™Ü_chªÃl
,

5095 .
	gsu¥’d
 = 
›“80211_su¥’d
,

5096 .
	g»sume
 = 
›“80211_»sume
,

5097 .
	gsÿn
 = 
›“80211_sÿn
,

5098 .
	gabÜt_sÿn
 = 
›“80211_abÜt_sÿn
,

5099 .
	gsched_sÿn_¡¬t
 = 
›“80211_sched_sÿn_¡¬t
,

5100 .
	gsched_sÿn_¡İ
 = 
›“80211_sched_sÿn_¡İ
,

5101 .
	gauth
 = 
›“80211_auth
,

5102 .
	gassoc
 = 
›“80211_assoc
,

5103 .
	gd—uth
 = 
›“80211_d—uth
,

5104 .
	gdi§ssoc
 = 
›“80211_di§ssoc
,

5105 .
	gjoš_ibss
 = 
›“80211_još_ibss
,

5106 .
	gËave_ibss
 = 
›“80211_Ëave_ibss
,

5107 .
	g£t_mÿ¡_¿‹
 = 
›“80211_£t_mÿ¡_¿‹
,

5108 .
	g£t_why_·¿ms
 = 
›“80211_£t_why_·¿ms
,

5109 .
	g£t_tx_pow”
 = 
›“80211_£t_tx_pow”
,

5110 .
	gg‘_tx_pow”
 = 
›“80211_g‘_tx_pow”
,

5111 .
	grfkl_pŞl
 = 
›“80211_rfkl_pŞl
,

5112 
CFG80211_TESTMODE_CMD
(
›“80211_‹¡mode_cmd
)

5113 
CFG80211_TESTMODE_DUMP
(
›“80211_‹¡mode_dump
)

5114 .
	g£t_pow”_mgmt
 = 
›“80211_£t_pow”_mgmt
,

5115 .
	g£t_b™¿‹_mask
 = 
›“80211_£t_b™¿‹_mask
,

5116 .
	g»maš_Ú_chªÃl
 = 
›“80211_»maš_Ú_chªÃl
,

5117 .
	gÿnûl_»maš_Ú_chªÃl
 = 
›“80211_ÿnûl_»maš_Ú_chªÃl
,

5118 .
	gmgmt_tx
 = 
›“80211_mgmt_tx
,

5119 .
	gmgmt_tx_ÿnûl_wa™
 = 
›“80211_mgmt_tx_ÿnûl_wa™
,

5120 .
	g£t_cqm_rssi_cÚfig
 = 
›“80211_£t_cqm_rssi_cÚfig
,

5121 .
	g£t_cqm_rssi_¿nge_cÚfig
 = 
›“80211_£t_cqm_rssi_¿nge_cÚfig
,

5122 .
	gupd©e_mgmt_äame_»gi¡¿tiÚs
 =

5123 
›“80211_upd©e_mgmt_äame_»gi¡¿tiÚs
,

5124 .
	g£t_ª‹Âa
 = 
›“80211_£t_ª‹Âa
,

5125 .
	gg‘_ª‹Âa
 = 
›“80211_g‘_ª‹Âa
,

5126 .
	g£t_»key_d©a
 = 
›“80211_£t_»key_d©a
,

5127 .
	gtdls_İ”
 = 
›“80211_tdls_İ”
,

5128 .
	gtdls_mgmt
 = 
›“80211_tdls_mgmt
,

5129 .
	gtdls_chªÃl_sw™ch
 = 
›“80211_tdls_chªÃl_sw™ch
,

5130 .
	gtdls_ÿnûl_chªÃl_sw™ch
 = 
›“80211_tdls_ÿnûl_chªÃl_sw™ch
,

5131 .
	g´obe_ş›Á
 = 
›“80211_´obe_ş›Á
,

5132 .
	g£t_nßck_m­
 = 
›“80211_£t_nßck_m­
,

5133 #ifdeà
CONFIG_PM


5134 .
	g£t_wakeup
 = 
›“80211_£t_wakeup
,

5136 .
	gg‘_chªÃl
 = 
›“80211_cfg_g‘_chªÃl
,

5137 .
	g¡¬t_¿d¬_d‘eùiÚ
 = 
›“80211_¡¬t_¿d¬_d‘eùiÚ
,

5138 .
	g’d_ÿc
 = 
›“80211_’d_ÿc
,

5139 .
	gchªÃl_sw™ch
 = 
›“80211_chªÃl_sw™ch
,

5140 .
	g£t_qos_m­
 = 
›“80211_£t_qos_m­
,

5141 .
	g£t_­_chªwidth
 = 
›“80211_£t_­_chªwidth
,

5142 .
	gadd_tx_ts
 = 
›“80211_add_tx_ts
,

5143 .
	gd–_tx_ts
 = 
›“80211_d–_tx_ts
,

5144 .
	g¡¬t_Çn
 = 
›“80211_¡¬t_Çn
,

5145 .
	g¡İ_Çn
 = 
›“80211_¡İ_Çn
,

5146 .
	gÇn_chªge_cÚf
 = 
›“80211_Çn_chªge_cÚf
,

5147 .
	gadd_Çn_func
 = 
›“80211_add_Çn_func
,

5148 .
	gd–_Çn_func
 = 
›“80211_d–_Çn_func
,

5149 .
	g£t_muÉiÿ¡_to_uniÿ¡
 = 
›“80211_£t_muÉiÿ¡_to_uniÿ¡
,

5150 .
	gtx_cÚŒŞ_pÜt
 = 
›“80211_tx_cÚŒŞ_pÜt
,

5151 .
	gg‘_txq_¡©s
 = 
›“80211_g‘_txq_¡©s
,

5152 .
	gg‘_ám_»¥Úd”_¡©s
 = 
›“80211_g‘_ám_»¥Úd”_¡©s
,

5153 .
	g¡¬t_pm¤
 = 
›“80211_¡¬t_pm¤
,

5154 .
	gabÜt_pm¤
 = 
›“80211_abÜt_pm¤
,

5155 .
	g´obe_mesh_lšk
 = 
›“80211_´obe_mesh_lšk
,

5156 .
	g£t_tid_cÚfig
 = 
›“80211_£t_tid_cÚfig
,

5157 .
	g»£t_tid_cÚfig
 = 
›“80211_»£t_tid_cÚfig
,

5158 .
	g£t_§r_¥ecs
 = 
›“80211_£t_§r_¥ecs
,

5159 .
	gcŞÜ_chªge
 = 
›“80211_cŞÜ_chªge
,

5160 .
	g£t_¿d¬_background
 = 
›“80211_£t_¿d¬_background
,

5161 .
	gadd_štf_lšk
 = 
›“80211_add_štf_lšk
,

5162 .
	gd–_štf_lšk
 = 
›“80211_d–_štf_lšk
,

5163 .
	gadd_lšk_¡©iÚ
 = 
›“80211_add_lšk_¡©iÚ
,

5164 .
	gmod_lšk_¡©iÚ
 = 
›“80211_mod_lšk_¡©iÚ
,

5165 .
	gd–_lšk_¡©iÚ
 = 
›“80211_d–_lšk_¡©iÚ
,

5166 .
	g£t_hw_time¡amp
 = 
›“80211_£t_hw_time¡amp
,

5167 .
	g£t_‰lm
 = 
›“80211_£t_‰lm
,

	@chan.c

7 
	~<lšux/Æ80211.h
>

8 
	~<lšux/expÜt.h
>

9 
	~<lšux/¹Ãšk.h
>

10 
	~<Ãt/cfg80211.h
>

11 
	~"›“80211_i.h
"

12 
	~"driv”-İs.h
"

13 
	~"¿‹.h
"

15 
	$›“80211_chªùx_num_assigÃd
(
›“80211_loÿl
 *
loÿl
,

16 
›“80211_chªùx
 *
ùx
)

18 
›“80211_lšk_d©a
 *
lšk
;

19 
num
 = 0;

21 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

23 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
assigÃd_lšks
, 
assigÃd_chªùx_li¡
)

24 
num
++;

26  
num
;

27 
	}
}

29 
	$›“80211_chªùx_num_»£rved
(
›“80211_loÿl
 *
loÿl
,

30 
›“80211_chªùx
 *
ùx
)

32 
›“80211_lšk_d©a
 *
lšk
;

33 
num
 = 0;

35 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

37 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»£rved_lšks
, 
»£rved_chªùx_li¡
)

38 
num
++;

40  
num
;

41 
	}
}

43 
	$›“80211_chªùx_»fcouÁ
(
›“80211_loÿl
 *
loÿl
,

44 
›“80211_chªùx
 *
ùx
)

46  
	`›“80211_chªùx_num_assigÃd
(
loÿl
, 
ùx
) +

47 
	`›“80211_chªùx_num_»£rved
(
loÿl
, 
ùx
);

48 
	}
}

50 
	$›“80211_num_chªùx
(
›“80211_loÿl
 *
loÿl
)

52 
›“80211_chªùx
 *
ùx
;

53 
num
 = 0;

55 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

57 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
)

58 
num
++;

60  
num
;

61 
	}
}

63 
boŞ
 
	$›“80211_ÿn_ü—‹_Ãw_chªùx
(
›“80211_loÿl
 *
loÿl
)

65 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

67  
	`›“80211_num_chªùx
(
loÿl
è< 
	`›“80211_max_num_chªÃls
(local);

68 
	}
}

70 
›“80211_chªùx
 *

71 
	$›“80211_lšk_g‘_chªùx
(
›“80211_lšk_d©a
 *
lšk
)

73 
›“80211_loÿl
 *
loÿl
 
__maybe_unu£d
 = 
lšk
->
sd©a
->local;

74 
›“80211_chªùx_cÚf
 *
cÚf
;

76 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk
->cÚf->
chªùx_cÚf
,

77 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

78 ià(!
cÚf
)

79  
NULL
;

81  
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

82 
	}
}

84 
boŞ
 
	$›“80211_chª»q_id’tiÿl
(cÚ¡ 
›“80211_chª_»q
 *
a
,

85 cÚ¡ 
›“80211_chª_»q
 *
b
)

87 ià(!
	`cfg80211_chªdef_id’tiÿl
(&
a
->
İ”
, &
b
->oper))

88  
çl£
;

89 ià(!
a
->
­
.
chª
 && !
b
->ap.chan)

90  
Œue
;

91  
	`cfg80211_chªdef_id’tiÿl
(&
a
->
­
, &
b
->ap);

92 
	}
}

94 cÚ¡ 
›“80211_chª_»q
 *

95 
	$›“80211_chª»q_com·tibË
(cÚ¡ 
›“80211_chª_»q
 *
a
,

96 cÚ¡ 
›“80211_chª_»q
 *
b
,

97 
›“80211_chª_»q
 *
tmp
)

99 cÚ¡ 
cfg80211_chª_def
 *
com·t
;

101 ià(
a
->
­
.
chª
 && 
b
->ap.chan &&

102 !
	`cfg80211_chªdef_id’tiÿl
(&
a
->
­
, &
b
->ap))

103  
NULL
;

105 
com·t
 = 
	`cfg80211_chªdef_com·tibË
(&
a
->
İ”
, &
b
->oper);

106 ià(!
com·t
)

107  
NULL
;

110 
tmp
->
İ”
 = *
com·t
;

111 
tmp
->
­
 = 
a
->­.
chª
 ?‡->­ : 
b
->ap;

112  
tmp
;

113 
	}
}

115 cÚ¡ 
›“80211_chª_»q
 *

116 
	$›“80211_chªùx_com·tibË
(
›“80211_chªùx
 *
ùx
,

117 cÚ¡ 
›“80211_chª_»q
 *
»q
,

118 
›“80211_chª_»q
 *
tmp
)

120 cÚ¡ 
›“80211_chª_»q
 *
»t
;

121 
›“80211_chª_»q
 
tmp2
;

123 *
tmp
 = (
›“80211_chª_»q
){

124 .
İ”
 = 
ùx
->
cÚf
.
def
,

125 .
­
 = 
ùx
->
cÚf
.ap,

128 
»t
 = 
	`›“80211_chª»q_com·tibË
(
tmp
, 
»q
, &
tmp2
);

129 ià(!
»t
)

130  
NULL
;

131 *
tmp
 = *
»t
;

132  
tmp
;

133 
	}
}

135 cÚ¡ 
›“80211_chª_»q
 *

136 
	$›“80211_chªùx_»£rved_chª»q
(
›“80211_loÿl
 *
loÿl
,

137 
›“80211_chªùx
 *
ùx
,

138 cÚ¡ 
›“80211_chª_»q
 *
»q
,

139 
›“80211_chª_»q
 *
tmp
)

141 
›“80211_lšk_d©a
 *
lšk
;

143 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

145 ià(
	`WARN_ON
(!
»q
))

146  
NULL
;

148 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»£rved_lšks
, 
»£rved_chªùx_li¡
) {

149 
»q
 = 
	`›“80211_chª»q_com·tibË
(&
lšk
->
»£rved
,„eq, 
tmp
);

150 ià(!
»q
)

154  
»q
;

155 
	}
}

157 cÚ¡ 
›“80211_chª_»q
 *

158 
	$›“80211_chªùx_nÚ_»£rved_chªdef
(
›“80211_loÿl
 *
loÿl
,

159 
›“80211_chªùx
 *
ùx
,

160 cÚ¡ 
›“80211_chª_»q
 *
com·t
,

161 
›“80211_chª_»q
 *
tmp
)

163 
›“80211_lšk_d©a
 *
lšk
;

164 cÚ¡ 
›“80211_chª_»q
 *
comp_def
 = 
com·t
;

166 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

168 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
assigÃd_lšks
, 
assigÃd_chªùx_li¡
) {

169 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

171 ià(
lšk
->
»£rved_chªùx
)

174 
comp_def
 = 
	`›“80211_chª»q_com·tibË
(&
lšk_cÚf
->
chª»q
,

175 
comp_def
, 
tmp
);

176 ià(!
comp_def
)

180  
comp_def
;

181 
	}
}

183 
boŞ


184 
	$›“80211_chªùx_ÿn_»£rve
(
›“80211_loÿl
 *
loÿl
,

185 
›“80211_chªùx
 *
ùx
,

186 cÚ¡ 
›“80211_chª_»q
 *
»q
)

188 
›“80211_chª_»q
 
tmp
;

190 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

192 ià(!
	`›“80211_chªùx_»£rved_chª»q
(
loÿl
, 
ùx
, 
»q
, &
tmp
))

193  
çl£
;

195 ià(!
	`›“80211_chªùx_nÚ_»£rved_chªdef
(
loÿl
, 
ùx
, 
»q
, &
tmp
))

196  
çl£
;

198 ià(!
	`li¡_em±y
(&
ùx
->
»£rved_lšks
) &&

199 
	`›“80211_chªùx_»£rved_chª»q
(
loÿl
, 
ùx
, 
»q
, &
tmp
))

200  
Œue
;

202  
çl£
;

203 
	}
}

205 
›“80211_chªùx
 *

206 
	$›“80211_fšd_»£rv©iÚ_chªùx
(
›“80211_loÿl
 *
loÿl
,

207 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

208 
›“80211_chªùx_mode
 
mode
)

210 
›“80211_chªùx
 *
ùx
;

212 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

214 ià(
mode
 =ğ
IEEE80211_CHANCTX_EXCLUSIVE
)

215  
NULL
;

217 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

218 ià(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
)

221 ià(
ùx
->
mode
 =ğ
IEEE80211_CHANCTX_EXCLUSIVE
)

224 ià(!
	`›“80211_chªùx_ÿn_»£rve
(
loÿl
, 
ùx
, 
chª»q
))

227  
ùx
;

230  
NULL
;

231 
	}
}

233 
Æ80211_chª_width
 
	$›“80211_g‘_¡a_bw
(
¡a_šfo
 *
¡a
,

234 
lšk_id
)

236 
›“80211_¡a_rx_bªdwidth
 
width
;

237 
lšk_¡a_šfo
 *
lšk_¡a
;

239 
lšk_¡a
 = 
	`why_d”eã»nû
(
¡a
->
loÿl
->
hw
.
why
, s->
lšk
[
lšk_id
]);

242 ià(!
lšk_¡a
)

243  
NL80211_CHAN_WIDTH_20_NOHT
;

245 
width
 = 
	`›“80211_¡a_ÿp_rx_bw
(
lšk_¡a
);

247 
width
) {

248 
IEEE80211_STA_RX_BW_20
:

249 ià(
lšk_¡a
->
pub
->
ht_ÿp
.
ht_suµÜ‹d
)

250  
NL80211_CHAN_WIDTH_20
;

252  
NL80211_CHAN_WIDTH_20_NOHT
;

253 
IEEE80211_STA_RX_BW_40
:

254  
NL80211_CHAN_WIDTH_40
;

255 
IEEE80211_STA_RX_BW_80
:

256  
NL80211_CHAN_WIDTH_80
;

257 
IEEE80211_STA_RX_BW_160
:

267  
NL80211_CHAN_WIDTH_160
;

268 
IEEE80211_STA_RX_BW_320
:

269  
NL80211_CHAN_WIDTH_320
;

271 
	`WARN_ON
(1);

272  
NL80211_CHAN_WIDTH_20
;

274 
	}
}

276 
Æ80211_chª_width


277 
	$›“80211_g‘_max_»quœed_bw
(
›“80211_lšk_d©a
 *
lšk
)

279 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

280 
lšk_id
 = 
lšk
->link_id;

281 
Æ80211_chª_width
 
max_bw
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

282 
¡a_šfo
 *
¡a
;

284 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
sd©a
->
loÿl
->
¡a_li¡
, 
li¡
) {

285 ià(
sd©a
 !ğ
¡a
->sdata &&

286 !(
¡a
->
sd©a
->
bss
 && sta->sdata->bss == sdata->bss))

289 
max_bw
 = 
	`max
(max_bw, 
	`›“80211_g‘_¡a_bw
(
¡a
, 
lšk_id
));

292  
max_bw
;

293 
	}
}

295 
Æ80211_chª_width


296 
	$›“80211_g‘_chªùx_max_»quœed_bw
(
›“80211_loÿl
 *
loÿl
,

297 
›“80211_chªùx
 *
ùx
,

298 
›“80211_lšk_d©a
 *
rsvd_fÜ
)

300 
›“80211_sub_if_d©a
 *
sd©a
;

301 
›“80211_lšk_d©a
 *
lšk
;

302 
Æ80211_chª_width
 
max_bw
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

304 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
lšk
) {

305 
Æ80211_chª_width
 
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

307 ià(
lšk
 !ğ
rsvd_fÜ
 &&

308 
	`rcu_acûss_poš‹r
(
lšk
->
cÚf
->
chªùx_cÚf
è!ğ&
ùx
->conf)

311 
lšk
->
sd©a
->
vif
.
ty³
) {

312 
NL80211_IFTYPE_AP
:

313 
NL80211_IFTYPE_AP_VLAN
:

314 
width
 = 
	`›“80211_g‘_max_»quœed_bw
(
lšk
);

316 
NL80211_IFTYPE_STATION
:

322 
width
 = 
	`max
(
lšk
->
cÚf
->
chª»q
.
İ”
.width,

323 
	`›“80211_g‘_max_»quœed_bw
(
lšk
));

325 
NL80211_IFTYPE_P2P_DEVICE
:

326 
NL80211_IFTYPE_NAN
:

328 
NL80211_IFTYPE_ADHOC
:

329 
NL80211_IFTYPE_MESH_POINT
:

330 
NL80211_IFTYPE_OCB
:

331 
width
 = 
lšk
->
cÚf
->
chª»q
.
İ”
.width;

333 
NL80211_IFTYPE_WDS
:

334 
NL80211_IFTYPE_UNSPECIFIED
:

335 
NUM_NL80211_IFTYPES
:

336 
NL80211_IFTYPE_MONITOR
:

337 
NL80211_IFTYPE_P2P_CLIENT
:

338 
NL80211_IFTYPE_P2P_GO
:

339 
	`WARN_ON_ONCE
(1);

342 
max_bw
 = 
	`max
(max_bw, 
width
);

346 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,†oÿl->
mÚ™Ü_sd©a
);

347 ià(
sd©a
 &&

348 
	`rcu_acûss_poš‹r
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
è=ğ&
ùx
->
cÚf
)

349 
max_bw
 = 
	`max
(max_bw, 
ùx
->
cÚf
.
def
.
width
);

351  
max_bw
;

352 
	}
}

359 
u32


360 
	$_›“80211_»ÿlc_chªùx_mš_def
(
›“80211_loÿl
 *
loÿl
,

361 
›“80211_chªùx
 *
ùx
,

362 
›“80211_lšk_d©a
 *
rsvd_fÜ
)

364 
Æ80211_chª_width
 
max_bw
;

365 
cfg80211_chª_def
 
mš_def
;

367 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

370 ià(
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

371 
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_10
 ||

372 
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_1
 ||

373 
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_2
 ||

374 
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_4
 ||

375 
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_8
 ||

376 
ùx
->
cÚf
.
def
.
width
 =ğ
NL80211_CHAN_WIDTH_16
 ||

377 
ùx
->
cÚf
.
¿d¬_’abËd
) {

378 
ùx
->
cÚf
.
mš_def
 = ctx->cÚf.
def
;

382 
max_bw
 = 
	`›“80211_g‘_chªùx_max_»quœed_bw
(
loÿl
, 
ùx
, 
rsvd_fÜ
);

385 
mš_def
 = 
ùx
->
cÚf
.
def
;

386 
mš_def
.
width
 > 
max_bw
)

387 
	`›“80211_chªdef_downg¿de
(&
mš_def
, 
NULL
);

389 ià(
	`cfg80211_chªdef_id’tiÿl
(&
ùx
->
cÚf
.
mš_def
, &min_def))

392 
ùx
->
cÚf
.
mš_def
 = min_def;

393 ià(!
ùx
->
driv”_´e£Á
)

396  
IEEE80211_CHANCTX_CHANGE_MIN_WIDTH
;

397 
	}
}

402 
	$›“80211_chª_bw_chªge
(
›“80211_loÿl
 *
loÿl
,

403 
›“80211_chªùx
 *
ùx
,

404 
boŞ
 
Ç¼owed
)

406 
¡a_šfo
 *
¡a
;

407 
›“80211_suµÜ‹d_bªd
 *
sbªd
 =

408 
loÿl
->
hw
.
why
->
bªds
[
ùx
->
cÚf
.
def
.
chª
->
bªd
];

410 
	`rcu_»ad_lock
();

411 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
,

412 
li¡
) {

413 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

414 
›“80211_¡a_rx_bªdwidth
 
Ãw_¡a_bw
;

415 
lšk_id
;

417 ià(!
	`›“80211_sd©a_ruÂšg
(
¡a
->
sd©a
))

420 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
(
¡a
->
sd©a
->
lšk
);†ink_id++) {

421 
›“80211_bss_cÚf
 *
lšk_cÚf
 =

422 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[
lšk_id
]);

423 
lšk_¡a_šfo
 *
lšk_¡a
;

425 ià(!
lšk_cÚf
)

428 ià(
	`rcu_acûss_poš‹r
(
lšk_cÚf
->
chªùx_cÚf
è!ğ&
ùx
->
cÚf
)

431 
lšk_¡a
 = 
	`rcu_d”eã»nû
(
¡a
->
lšk
[
lšk_id
]);

432 ià(!
lšk_¡a
)

435 
Ãw_¡a_bw
 = 
	`›“80211_¡a_cur_vht_bw
(
lšk_¡a
);

438 ià(
Ãw_¡a_bw
 =ğ
lšk_¡a
->
pub
->
bªdwidth
)

443 ià((
Ãw_¡a_bw
 < 
lšk_¡a
->
pub
->
bªdwidth
è=ğ!
Ç¼owed
)

446 
lšk_¡a
->
pub
->
bªdwidth
 = 
Ãw_¡a_bw
;

447 
	`¿‹_cÚŒŞ_¿‹_upd©e
(
loÿl
, 
sbªd
, 
¡a
, 
lšk_id
,

448 
IEEE80211_RC_BW_CHANGED
);

451 
	`rcu_»ad_uÆock
();

452 
	}
}

459 
	$›“80211_»ÿlc_chªùx_mš_def
(
›“80211_loÿl
 *
loÿl
,

460 
›“80211_chªùx
 *
ùx
,

461 
›“80211_lšk_d©a
 *
rsvd_fÜ
)

463 
u32
 
chªged
 = 
	`_›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
ùx
, 
rsvd_fÜ
);

465 ià(!
chªged
)

469 
	`›“80211_chª_bw_chªge
(
loÿl
, 
ùx
, 
Œue
);

471 
	`drv_chªge_chªùx
(
loÿl
, 
ùx
, 
chªged
);

474 
	`›“80211_chª_bw_chªge
(
loÿl
, 
ùx
, 
çl£
);

475 
	}
}

477 
	$_›“80211_chªge_chªùx
(
›“80211_loÿl
 *
loÿl
,

478 
›“80211_chªùx
 *
ùx
,

479 
›“80211_chªùx
 *
Şd_ùx
,

480 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

481 
›“80211_lšk_d©a
 *
rsvd_fÜ
)

483 cÚ¡ 
cfg80211_chª_def
 *
chªdef
 = &
chª»q
->
İ”
;

484 
›“80211_chª_»q
 
ùx_»q
 = {

485 .
İ”
 = 
ùx
->
cÚf
.
def
,

486 .
­
 = 
ùx
->
cÚf
.ap,

488 
u32
 
chªged
 = 0;

491 
chªdef
->
width
) {

492 
NL80211_CHAN_WIDTH_20_NOHT
:

493 
NL80211_CHAN_WIDTH_20
:

494 
NL80211_CHAN_WIDTH_40
:

495 
NL80211_CHAN_WIDTH_80
:

496 
NL80211_CHAN_WIDTH_80P80
:

497 
NL80211_CHAN_WIDTH_160
:

498 
NL80211_CHAN_WIDTH_320
:

501 
	`WARN_ON
(1);

508 
	`›“80211_chª_bw_chªge
(
loÿl
, 
Şd_ùx
, 
Œue
);

510 ià(
	`›“80211_chª»q_id’tiÿl
(&
ùx_»q
, 
chª»q
)) {

511 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
ùx
, 
rsvd_fÜ
);

515 
	`WARN_ON
(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
ùx
) > 1 &&

516 !
	`cfg80211_chªdef_com·tibË
(&
ùx
->
cÚf
.
def
, &
chª»q
->
İ”
));

518 
	`›“80211_»move_wbrf
(
loÿl
, &
ùx
->
cÚf
.
def
);

520 ià(!
	`cfg80211_chªdef_id’tiÿl
(&
ùx
->
cÚf
.
def
, &
chª»q
->
İ”
)) {

521 ià(
ùx
->
cÚf
.
def
.
width
 !ğ
chª»q
->
İ”
.width)

522 
chªged
 |ğ
IEEE80211_CHANCTX_CHANGE_WIDTH
;

523 ià(
ùx
->
cÚf
.
def
.
punùu»d
 !ğ
chª»q
->
İ”
.punctured)

524 
chªged
 |ğ
IEEE80211_CHANCTX_CHANGE_PUNCTURING
;

526 ià(!
	`cfg80211_chªdef_id’tiÿl
(&
ùx
->
cÚf
.
­
, &
chª»q
->ap))

527 
chªged
 |ğ
IEEE80211_CHANCTX_CHANGE_AP
;

528 
ùx
->
cÚf
.
def
 = *
chªdef
;

529 
ùx
->
cÚf
.
­
 = 
chª»q
->ap;

532 
chªged
 |ğ
	`_›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
ùx
, 
rsvd_fÜ
);

534 
	`›“80211_add_wbrf
(
loÿl
, &
ùx
->
cÚf
.
def
);

536 
	`drv_chªge_chªùx
(
loÿl
, 
ùx
, 
chªged
);

539 
	`›“80211_chª_bw_chªge
(
loÿl
, 
Şd_ùx
, 
çl£
);

540 
	}
}

542 
	$›“80211_chªge_chªùx
(
›“80211_loÿl
 *
loÿl
,

543 
›“80211_chªùx
 *
ùx
,

544 
›“80211_chªùx
 *
Şd_ùx
,

545 cÚ¡ 
›“80211_chª_»q
 *
chª»q
)

547 
	`_›“80211_chªge_chªùx
(
loÿl
, 
ùx
, 
Şd_ùx
, 
chª»q
, 
NULL
);

548 
	}
}

550 
›“80211_chªùx
 *

551 
	$›“80211_fšd_chªùx
(
›“80211_loÿl
 *
loÿl
,

552 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

553 
›“80211_chªùx_mode
 
mode
)

555 
›“80211_chª_»q
 
tmp
;

556 
›“80211_chªùx
 *
ùx
;

558 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

560 ià(
mode
 =ğ
IEEE80211_CHANCTX_EXCLUSIVE
)

561  
NULL
;

563 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

564 cÚ¡ 
›“80211_chª_»q
 *
com·t
;

566 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACE_NONE
)

569 ià(
ùx
->
mode
 =ğ
IEEE80211_CHANCTX_EXCLUSIVE
)

572 
com·t
 = 
	`›“80211_chªùx_com·tibË
(
ùx
, 
chª»q
, &
tmp
);

573 ià(!
com·t
)

576 
com·t
 = 
	`›“80211_chªùx_»£rved_chª»q
(
loÿl
, 
ùx
,

577 
com·t
, &
tmp
);

578 ià(!
com·t
)

581 
	`›“80211_chªge_chªùx
(
loÿl
, 
ùx
, ctx, 
com·t
);

583  
ùx
;

586  
NULL
;

587 
	}
}

589 
boŞ
 
	$›“80211_is_¿d¬_»quœed
(
›“80211_loÿl
 *
loÿl
)

591 
›“80211_lšk_d©a
 *
lšk
;

593 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

595 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
lšk
) {

596 ià(
lšk
->
¿d¬_»quœed
)

597  
Œue
;

600  
çl£
;

601 
	}
}

603 
boŞ


604 
	$›“80211_chªùx_¿d¬_»quœed
(
›“80211_loÿl
 *
loÿl
,

605 
›“80211_chªùx
 *
ùx
)

607 
›“80211_chªùx_cÚf
 *
cÚf
 = &
ùx
->conf;

608 
›“80211_lšk_d©a
 *
lšk
;

610 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

612 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
lšk
) {

613 ià(
	`rcu_acûss_poš‹r
(
lšk
->
cÚf
->
chªùx_cÚf
) != conf)

615 ià(!
lšk
->
¿d¬_»quœed
)

617  
Œue
;

620  
çl£
;

621 
	}
}

623 
›“80211_chªùx
 *

624 
	$›“80211_®loc_chªùx
(
›“80211_loÿl
 *
loÿl
,

625 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

626 
›“80211_chªùx_mode
 
mode
)

628 
›“80211_chªùx
 *
ùx
;

630 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

632 
ùx
 = 
	`kz®loc
((*ùxè+ 
loÿl
->
hw
.
chªùx_d©a_size
, 
GFP_KERNEL
);

633 ià(!
ùx
)

634  
NULL
;

636 
	`INIT_LIST_HEAD
(&
ùx
->
assigÃd_lšks
);

637 
	`INIT_LIST_HEAD
(&
ùx
->
»£rved_lšks
);

638 
ùx
->
cÚf
.
def
 = 
chª»q
->
İ”
;

639 
ùx
->
cÚf
.
­
 = 
chª»q
->ap;

640 
ùx
->
cÚf
.
rx_chašs_¡©ic
 = 1;

641 
ùx
->
cÚf
.
rx_chašs_dyÇmic
 = 1;

642 
ùx
->
mode
 = mode;

643 
ùx
->
cÚf
.
¿d¬_’abËd
 = 
çl£
;

644 
	`_›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
ùx
, 
NULL
);

646  
ùx
;

647 
	}
}

649 
	$›“80211_add_chªùx
(
›“80211_loÿl
 *
loÿl
,

650 
›“80211_chªùx
 *
ùx
)

652 
u32
 
chªged
;

653 
”r
;

655 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

657 
	`›“80211_add_wbrf
(
loÿl
, &
ùx
->
cÚf
.
def
);

660 
chªged
 = 
	`›“80211_idË_off
(
loÿl
);

661 ià(
chªged
)

662 
	`›“80211_hw_cÚfig
(
loÿl
, 
chªged
);

664 
”r
 = 
	`drv_add_chªùx
(
loÿl
, 
ùx
);

665 ià(
”r
) {

666 
	`›“80211_»ÿlc_idË
(
loÿl
);

667  
”r
;

671 
	}
}

673 
›“80211_chªùx
 *

674 
	$›“80211_Ãw_chªùx
(
›“80211_loÿl
 *
loÿl
,

675 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

676 
›“80211_chªùx_mode
 
mode
)

678 
›“80211_chªùx
 *
ùx
;

679 
”r
;

681 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

683 
ùx
 = 
	`›“80211_®loc_chªùx
(
loÿl
, 
chª»q
, 
mode
);

684 ià(!
ùx
)

685  
	`ERR_PTR
(-
ENOMEM
);

687 
”r
 = 
	`›“80211_add_chªùx
(
loÿl
, 
ùx
);

688 ià(
”r
) {

689 
	`kä“
(
ùx
);

690  
	`ERR_PTR
(
”r
);

693 
	`li¡_add_rcu
(&
ùx
->
li¡
, &
loÿl
->
chªùx_li¡
);

694  
ùx
;

695 
	}
}

697 
	$›“80211_d–_chªùx
(
›“80211_loÿl
 *
loÿl
,

698 
›“80211_chªùx
 *
ùx
)

700 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

702 
	`drv_»move_chªùx
(
loÿl
, 
ùx
);

704 
	`›“80211_»ÿlc_idË
(
loÿl
);

706 
	`›“80211_»move_wbrf
(
loÿl
, &
ùx
->
cÚf
.
def
);

707 
	}
}

709 
	$›“80211_ä“_chªùx
(
›“80211_loÿl
 *
loÿl
,

710 
›“80211_chªùx
 *
ùx
)

712 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

714 
	`WARN_ON_ONCE
(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
ùx
) != 0);

716 
	`li¡_d–_rcu
(&
ùx
->
li¡
);

717 
	`›“80211_d–_chªùx
(
loÿl
, 
ùx
);

718 
	`kä“_rcu
(
ùx
, 
rcu_h—d
);

719 
	}
}

721 
	$›“80211_»ÿlc_chªùx_chªty³
(
›“80211_loÿl
 *
loÿl
,

722 
›“80211_chªùx
 *
ùx
)

724 
›“80211_chªùx_cÚf
 *
cÚf
 = &
ùx
->conf;

725 cÚ¡ 
›“80211_chª_»q
 *
com·t
 = 
NULL
;

726 
›“80211_lšk_d©a
 *
lšk
;

727 
›“80211_chª_»q
 
tmp
;

728 
¡a_šfo
 *
¡a
;

730 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

732 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
lšk
) {

733 
›“80211_bss_cÚf
 *
lšk_cÚf
;

735 ià(
lšk
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

738 
lšk_cÚf
 = 
lšk
->
cÚf
;

740 ià(
	`rcu_acûss_poš‹r
(
lšk_cÚf
->
chªùx_cÚf
è!ğ
cÚf
)

743 ià(!
com·t
)

744 
com·t
 = &
lšk_cÚf
->
chª»q
;

746 
com·t
 = 
	`›“80211_chª»q_com·tibË
(&
lšk_cÚf
->
chª»q
,

747 
com·t
, &
tmp
);

748 ià(
	`WARN_ON_ONCE
(!
com·t
))

752 ià(
	`WARN_ON_ONCE
(!
com·t
))

756 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

757 
›“80211_chª_»q
 
tdls_chª»q
 = {};

758 ià(!
¡a
->
u¶ßded
 ||

759 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_WIDER_BW
) ||

760 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
) ||

761 !
¡a
->
tdls_chªdef
.
chª
)

764 
tdls_chª»q
.
İ”
 = 
¡a
->
tdls_chªdef
;

767 
com·t
 = 
	`›“80211_chª»q_com·tibË
(&
tdls_chª»q
,

768 
com·t
, &
tmp
);

769 ià(
	`WARN_ON_ONCE
(!
com·t
))

773 
	`›“80211_chªge_chªùx
(
loÿl
, 
ùx
, ctx, 
com·t
);

774 
	}
}

776 
	$›“80211_»ÿlc_¿d¬_chªùx
(
›“80211_loÿl
 *
loÿl
,

777 
›“80211_chªùx
 *
chªùx
)

779 
boŞ
 
¿d¬_’abËd
;

781 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

783 
¿d¬_’abËd
 = 
	`›“80211_chªùx_¿d¬_»quœed
(
loÿl
, 
chªùx
);

785 ià(
¿d¬_’abËd
 =ğ
chªùx
->
cÚf
.radar_enabled)

788 
chªùx
->
cÚf
.
¿d¬_’abËd
 =„adar_enabled;

790 
	`drv_chªge_chªùx
(
loÿl
, 
chªùx
, 
IEEE80211_CHANCTX_CHANGE_RADAR
);

791 
	}
}

793 
	$›“80211_assign_lšk_chªùx
(
›“80211_lšk_d©a
 *
lšk
,

794 
›“80211_chªùx
 *
Ãw_ùx
)

796 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

797 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

798 
›“80211_chªùx_cÚf
 *
cÚf
;

799 
›“80211_chªùx
 *
cu¼_ùx
 = 
NULL
;

800 
boŞ
 
Ãw_idË
;

801 
»t
 = 0;

803 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_NAN
))

804  -
EOPNOTSUPP
;

806 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk
->cÚf->
chªùx_cÚf
,

807 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

809 ià(
cÚf
) {

810 
cu¼_ùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

812 
	`drv_uÇssign_vif_chªùx
(
loÿl
, 
sd©a
, 
lšk
->
cÚf
, 
cu¼_ùx
);

813 
cÚf
 = 
NULL
;

814 
	`li¡_d–
(&
lšk
->
assigÃd_chªùx_li¡
);

817 ià(
Ãw_ùx
) {

819 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
Ãw_ùx
, 
lšk
);

821 
»t
 = 
	`drv_assign_vif_chªùx
(
loÿl
, 
sd©a
, 
lšk
->
cÚf
, 
Ãw_ùx
);

822 ià(
»t
)

823 
out
;

825 
cÚf
 = &
Ãw_ùx
->conf;

826 
	`li¡_add
(&
lšk
->
assigÃd_chªùx_li¡
,

827 &
Ãw_ùx
->
assigÃd_lšks
);

830 
out
:

831 
	`rcu_assign_poš‹r
(
lšk
->
cÚf
->
chªùx_cÚf
, conf);

833 ià(
cu¼_ùx
 && 
	`›“80211_chªùx_num_assigÃd
(
loÿl
, curr_ctx) > 0) {

834 
	`›“80211_»ÿlc_chªùx_chªty³
(
loÿl
, 
cu¼_ùx
);

835 
	`›“80211_»ÿlc_smps_chªùx
(
loÿl
, 
cu¼_ùx
);

836 
	`›“80211_»ÿlc_¿d¬_chªùx
(
loÿl
, 
cu¼_ùx
);

837 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
cu¼_ùx
, 
NULL
);

840 ià(
Ãw_ùx
 && 
	`›“80211_chªùx_num_assigÃd
(
loÿl
,‚ew_ctx) > 0) {

841 
	`›“80211_»ÿlc_txpow”
(
sd©a
, 
çl£
);

842 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
Ãw_ùx
, 
NULL
);

845 ià(
cÚf
) {

846 
Ãw_idË
 = 
çl£
;

848 
›“80211_lšk_d©a
 *
tmp
;

850 
Ãw_idË
 = 
Œue
;

851 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
tmp
) {

852 ià(
	`rcu_acûss_poš‹r
(
tmp
->
cÚf
->
chªùx_cÚf
)) {

853 
Ãw_idË
 = 
çl£
;

859 ià(
Ãw_idË
 !ğ
sd©a
->
vif
.
cfg
.
idË
) {

860 
sd©a
->
vif
.
cfg
.
idË
 = 
Ãw_idË
;

862 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_P2P_DEVICE
 &&

863 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
)

864 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_IDLE
);

867 
	`›“80211_check_ç¡_xm™_içû
(
sd©a
);

869  
»t
;

870 
	}
}

872 
	$›“80211_»ÿlc_smps_chªùx
(
›“80211_loÿl
 *
loÿl
,

873 
›“80211_chªùx
 *
chªùx
)

875 
›“80211_sub_if_d©a
 *
sd©a
;

876 
u8
 
rx_chašs_¡©ic
, 
rx_chašs_dyÇmic
;

877 
›“80211_lšk_d©a
 *
lšk
;

879 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

881 
rx_chašs_¡©ic
 = 1;

882 
rx_chašs_dyÇmic
 = 1;

884 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
lšk
) {

885 
u8
 
Ãeded_¡©ic
, 
Ãeded_dyÇmic
;

887 
lšk
->
sd©a
->
vif
.
ty³
) {

888 
NL80211_IFTYPE_STATION
:

889 ià(!
lšk
->
sd©a
->
u
.
mgd
.
assocŸ‹d
)

892 
NL80211_IFTYPE_AP
:

893 
NL80211_IFTYPE_ADHOC
:

894 
NL80211_IFTYPE_MESH_POINT
:

895 
NL80211_IFTYPE_OCB
:

901 ià(
	`rcu_acûss_poš‹r
(
lšk
->
cÚf
->
chªùx_cÚf
è!ğ&
chªùx
->conf)

904 
lšk
->
smps_mode
) {

906 
	`WARN_ONCE
(1, "Invalid SMPS mode %d\n",

907 
lšk
->
smps_mode
);

908 
çÎthrough
;

909 
IEEE80211_SMPS_OFF
:

910 
Ãeded_¡©ic
 = 
lšk
->
Ãeded_rx_chašs
;

911 
Ãeded_dyÇmic
 = 
lšk
->
Ãeded_rx_chašs
;

913 
IEEE80211_SMPS_DYNAMIC
:

914 
Ãeded_¡©ic
 = 1;

915 
Ãeded_dyÇmic
 = 
lšk
->
Ãeded_rx_chašs
;

917 
IEEE80211_SMPS_STATIC
:

918 
Ãeded_¡©ic
 = 1;

919 
Ãeded_dyÇmic
 = 1;

923 
rx_chašs_¡©ic
 = 
	`max
Ôx_chašs_¡©ic, 
Ãeded_¡©ic
);

924 
rx_chašs_dyÇmic
 = 
	`max
Ôx_chašs_dyÇmic, 
Ãeded_dyÇmic
);

928 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,†oÿl->
mÚ™Ü_sd©a
);

929 ià(
sd©a
 &&

930 
	`rcu_acûss_poš‹r
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
è=ğ&
chªùx
->
cÚf
)

931 
rx_chašs_dyÇmic
 = 
rx_chašs_¡©ic
 = 
loÿl
->
rx_chašs
;

933 ià(
rx_chašs_¡©ic
 =ğ
chªùx
->
cÚf
.rx_chains_static &&

934 
rx_chašs_dyÇmic
 =ğ
chªùx
->
cÚf
.rx_chains_dynamic)

937 
chªùx
->
cÚf
.
rx_chašs_¡©ic
 =„x_chains_static;

938 
chªùx
->
cÚf
.
rx_chašs_dyÇmic
 =„x_chains_dynamic;

939 
	`drv_chªge_chªùx
(
loÿl
, 
chªùx
, 
IEEE80211_CHANCTX_CHANGE_RX_CHAINS
);

940 
	}
}

943 
	$__›“80211_lšk_cİy_chªùx_to_vÏns
(
›“80211_lšk_d©a
 *
lšk
,

944 
boŞ
 
ş—r
)

946 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

947 
lšk_id
 = 
lšk
->link_id;

948 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

949 
›“80211_loÿl
 *
loÿl
 
__maybe_unu£d
 = 
sd©a
->local;

950 
›“80211_sub_if_d©a
 *
vÏn
;

951 
›“80211_chªùx_cÚf
 *
cÚf
;

953 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
))

956 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

964 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk_cÚf
->
chªùx_cÚf
,

965 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

966 
	`WARN_ON
(!
cÚf
);

968 ià(
ş—r
)

969 
cÚf
 = 
NULL
;

971 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
) {

972 
›“80211_bss_cÚf
 *
vÏn_cÚf
;

974 
vÏn_cÚf
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

975 
vÏn
->
vif
.
lšk_cÚf
[
lšk_id
]);

976 ià(
	`WARN_ON
(!
vÏn_cÚf
))

979 
	`rcu_assign_poš‹r
(
vÏn_cÚf
->
chªùx_cÚf
, 
cÚf
);

981 
	}
}

983 
	$›“80211_lšk_cİy_chªùx_to_vÏns
(
›“80211_lšk_d©a
 *
lšk
,

984 
boŞ
 
ş—r
)

986 
›“80211_loÿl
 *
loÿl
 = 
lšk
->
sd©a
->local;

988 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

990 
	`__›“80211_lšk_cİy_chªùx_to_vÏns
(
lšk
, 
ş—r
);

991 
	}
}

993 
	$›“80211_lšk_uÄe£rve_chªùx
(
›“80211_lšk_d©a
 *
lšk
)

995 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

996 
›“80211_chªùx
 *
ùx
 = 
lšk
->
»£rved_chªùx
;

998 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1000 ià(
	`WARN_ON
(!
ùx
))

1001  -
EINVAL
;

1003 
	`li¡_d–
(&
lšk
->
»£rved_chªùx_li¡
);

1004 
lšk
->
»£rved_chªùx
 = 
NULL
;

1006 ià(
	`›“80211_chªùx_»fcouÁ
(
sd©a
->
loÿl
, 
ùx
) == 0) {

1007 ià(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_REPLACES_OTHER
) {

1008 ià(
	`WARN_ON
(!
ùx
->
»¶aû_ùx
))

1009  -
EINVAL
;

1011 
	`WARN_ON
(
ùx
->
»¶aû_ùx
->
»¶aû_¡©e
 !=

1012 
IEEE80211_CHANCTX_WILL_BE_REPLACED
);

1013 
	`WARN_ON
(
ùx
->
»¶aû_ùx
->replace_ctx != ctx);

1015 
ùx
->
»¶aû_ùx
->»¶aû_ùx = 
NULL
;

1016 
ùx
->
»¶aû_ùx
->
»¶aû_¡©e
 =

1017 
IEEE80211_CHANCTX_REPLACE_NONE
;

1019 
	`li¡_d–_rcu
(&
ùx
->
li¡
);

1020 
	`kä“_rcu
(
ùx
, 
rcu_h—d
);

1022 
	`›“80211_ä“_chªùx
(
sd©a
->
loÿl
, 
ùx
);

1027 
	}
}

1029 
	$›“80211_lšk_»£rve_chªùx
(
›“80211_lšk_d©a
 *
lšk
,

1030 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

1031 
›“80211_chªùx_mode
 
mode
,

1032 
boŞ
 
¿d¬_»quœed
)

1034 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1035 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1036 
›“80211_chªùx
 *
Ãw_ùx
, *
cu¼_ùx
, *
ùx
;

1038 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1040 
cu¼_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1041 ià(
cu¼_ùx
 && !
loÿl
->
İs
->
sw™ch_vif_chªùx
)

1042  -
EOPNOTSUPP
;

1044 
Ãw_ùx
 = 
	`›“80211_fšd_»£rv©iÚ_chªùx
(
loÿl
, 
chª»q
, 
mode
);

1045 ià(!
Ãw_ùx
) {

1046 ià(
	`›“80211_ÿn_ü—‹_Ãw_chªùx
(
loÿl
)) {

1047 
Ãw_ùx
 = 
	`›“80211_Ãw_chªùx
(
loÿl
, 
chª»q
, 
mode
);

1048 ià(
	`IS_ERR
(
Ãw_ùx
))

1049  
	`PTR_ERR
(
Ãw_ùx
);

1051 ià(!
cu¼_ùx
 ||

1052 (
cu¼_ùx
->
»¶aû_¡©e
 ==

1053 
IEEE80211_CHANCTX_WILL_BE_REPLACED
) ||

1054 !
	`li¡_em±y
(&
cu¼_ùx
->
»£rved_lšks
)) {

1077 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
,

1078 
li¡
) {

1079 ià(
ùx
->
»¶aû_¡©e
 !=

1080 
IEEE80211_CHANCTX_REPLACE_NONE
)

1083 ià(!
	`li¡_em±y
(&
ùx
->
»£rved_lšks
))

1086 
cu¼_ùx
 = 
ùx
;

1095 ià(!
cu¼_ùx
 ||

1096 (
cu¼_ùx
->
»¶aû_¡©e
 ==

1097 
IEEE80211_CHANCTX_WILL_BE_REPLACED
) ||

1098 !
	`li¡_em±y
(&
cu¼_ùx
->
»£rved_lšks
))

1099  -
EBUSY
;

1101 
Ãw_ùx
 = 
	`›“80211_®loc_chªùx
(
loÿl
, 
chª»q
, 
mode
);

1102 ià(!
Ãw_ùx
)

1103  -
ENOMEM
;

1105 
Ãw_ùx
->
»¶aû_ùx
 = 
cu¼_ùx
;

1106 
Ãw_ùx
->
»¶aû_¡©e
 =

1107 
IEEE80211_CHANCTX_REPLACES_OTHER
;

1109 
cu¼_ùx
->
»¶aû_ùx
 = 
Ãw_ùx
;

1110 
cu¼_ùx
->
»¶aû_¡©e
 =

1111 
IEEE80211_CHANCTX_WILL_BE_REPLACED
;

1113 
	`li¡_add_rcu
(&
Ãw_ùx
->
li¡
, &
loÿl
->
chªùx_li¡
);

1117 
	`li¡_add
(&
lšk
->
»£rved_chªùx_li¡
, &
Ãw_ùx
->
»£rved_lšks
);

1118 
lšk
->
»£rved_chªùx
 = 
Ãw_ùx
;

1119 
lšk
->
»£rved
 = *
chª»q
;

1120 
lšk
->
»£rved_¿d¬_»quœed
 = 
¿d¬_»quœed
;

1121 
lšk
->
»£rved_»ady
 = 
çl£
;

1124 
	}
}

1127 
	$›“80211_lšk_chªùx_»£rv©iÚ_com¶‘e
(
›“80211_lšk_d©a
 *
lšk
)

1129 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1131 
sd©a
->
vif
.
ty³
) {

1132 
NL80211_IFTYPE_ADHOC
:

1133 
NL80211_IFTYPE_AP
:

1134 
NL80211_IFTYPE_MESH_POINT
:

1135 
NL80211_IFTYPE_OCB
:

1136 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1137 &
lšk
->
c§_fš®ize_wÜk
);

1139 
NL80211_IFTYPE_STATION
:

1140 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1141 &
lšk
->
u
.
mgd
.
chsw™ch_wÜk
, 0);

1143 
NL80211_IFTYPE_UNSPECIFIED
:

1144 
NL80211_IFTYPE_AP_VLAN
:

1145 
NL80211_IFTYPE_WDS
:

1146 
NL80211_IFTYPE_MONITOR
:

1147 
NL80211_IFTYPE_P2P_CLIENT
:

1148 
NL80211_IFTYPE_P2P_GO
:

1149 
NL80211_IFTYPE_P2P_DEVICE
:

1150 
NL80211_IFTYPE_NAN
:

1151 
NUM_NL80211_IFTYPES
:

1152 
	`WARN_ON
(1);

1155 
	}
}

1158 
	$›“80211_lšk_upd©e_chª»q
(
›“80211_lšk_d©a
 *
lšk
,

1159 cÚ¡ 
›“80211_chª_»q
 *
chª»q
)

1161 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1162 
lšk_id
 = 
lšk
->link_id;

1163 
›“80211_sub_if_d©a
 *
vÏn
;

1165 
lšk
->
cÚf
->
chª»q
 = *chanreq;

1167 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

1170 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
) {

1171 
›“80211_bss_cÚf
 *
vÏn_cÚf
;

1173 
vÏn_cÚf
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

1174 
vÏn
->
vif
.
lšk_cÚf
[
lšk_id
]);

1175 ià(
	`WARN_ON
(!
vÏn_cÚf
))

1178 
vÏn_cÚf
->
chª»q
 = *chanreq;

1180 
	}
}

1183 
	$›“80211_lšk_u£_»£rved_»assign
(
›“80211_lšk_d©a
 *
lšk
)

1185 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1186 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1187 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1188 
›“80211_vif_chªùx_sw™ch
 
vif_chsw
[1] = {};

1189 
›“80211_chªùx
 *
Şd_ùx
, *
Ãw_ùx
;

1190 cÚ¡ 
›“80211_chª_»q
 *
chª»q
;

1191 
›“80211_chª_»q
 
tmp
;

1192 
u64
 
chªged
 = 0;

1193 
”r
;

1195 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1197 
Ãw_ùx
 = 
lšk
->
»£rved_chªùx
;

1198 
Şd_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1200 ià(
	`WARN_ON
(!
lšk
->
»£rved_»ady
))

1201  -
EBUSY
;

1203 ià(
	`WARN_ON
(!
Ãw_ùx
))

1204  -
EINVAL
;

1206 ià(
	`WARN_ON
(!
Şd_ùx
))

1207  -
EINVAL
;

1209 ià(
	`WARN_ON
(
Ãw_ùx
->
»¶aû_¡©e
 ==

1210 
IEEE80211_CHANCTX_REPLACES_OTHER
))

1211  -
EINVAL
;

1213 
chª»q
 = 
	`›“80211_chªùx_nÚ_»£rved_chªdef
(
loÿl
, 
Ãw_ùx
,

1214 &
lšk
->
»£rved
,

1215 &
tmp
);

1216 ià(
	`WARN_ON
(!
chª»q
))

1217  -
EINVAL
;

1219 ià(
lšk_cÚf
->
chª»q
.
İ”
.
width
 !ğ
lšk
->
»£rved
.oper.width)

1220 
chªged
 = 
BSS_CHANGED_BANDWIDTH
;

1222 
	`›“80211_lšk_upd©e_chª»q
(
lšk
, &lšk->
»£rved
);

1224 
	`_›“80211_chªge_chªùx
(
loÿl
, 
Ãw_ùx
, 
Şd_ùx
, 
chª»q
, 
lšk
);

1226 
vif_chsw
[0].
vif
 = &
sd©a
->vif;

1227 
vif_chsw
[0].
Şd_ùx
 = &Şd_ùx->
cÚf
;

1228 
vif_chsw
[0].
Ãw_ùx
 = &Ãw_ùx->
cÚf
;

1229 
vif_chsw
[0].
lšk_cÚf
 = 
lšk
->
cÚf
;

1231 
	`li¡_d–
(&
lšk
->
»£rved_chªùx_li¡
);

1232 
lšk
->
»£rved_chªùx
 = 
NULL
;

1234 
”r
 = 
	`drv_sw™ch_vif_chªùx
(
loÿl
, 
vif_chsw
, 1,

1235 
CHANCTX_SWMODE_REASSIGN_VIF
);

1236 ià(
”r
) {

1237 ià(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
Ãw_ùx
) == 0)

1238 
	`›“80211_ä“_chªùx
(
loÿl
, 
Ãw_ùx
);

1240 
out
;

1243 
	`li¡_move
(&
lšk
->
assigÃd_chªùx_li¡
, &
Ãw_ùx
->
assigÃd_lšks
);

1244 
	`rcu_assign_poš‹r
(
lšk_cÚf
->
chªùx_cÚf
, &
Ãw_ùx
->
cÚf
);

1246 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

1247 
	`__›“80211_lšk_cİy_chªùx_to_vÏns
(
lšk
, 
çl£
);

1249 
	`›“80211_check_ç¡_xm™_içû
(
sd©a
);

1251 ià(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
Şd_ùx
) == 0)

1252 
	`›“80211_ä“_chªùx
(
loÿl
, 
Şd_ùx
);

1254 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
Ãw_ùx
, 
NULL
);

1255 
	`›“80211_»ÿlc_smps_chªùx
(
loÿl
, 
Ãw_ùx
);

1256 
	`›“80211_»ÿlc_¿d¬_chªùx
(
loÿl
, 
Ãw_ùx
);

1258 ià(
chªged
)

1259 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

1261 
out
:

1262 
	`›“80211_lšk_chªùx_»£rv©iÚ_com¶‘e
(
lšk
);

1263  
”r
;

1264 
	}
}

1267 
	$›“80211_lšk_u£_»£rved_assign
(
›“80211_lšk_d©a
 *
lšk
)

1269 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1270 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1271 
›“80211_chªùx
 *
Şd_ùx
, *
Ãw_ùx
;

1272 cÚ¡ 
›“80211_chª_»q
 *
chª»q
;

1273 
›“80211_chª_»q
 
tmp
;

1274 
”r
;

1276 
Şd_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1277 
Ãw_ùx
 = 
lšk
->
»£rved_chªùx
;

1279 ià(
	`WARN_ON
(!
lšk
->
»£rved_»ady
))

1280  -
EINVAL
;

1282 ià(
	`WARN_ON
(
Şd_ùx
))

1283  -
EINVAL
;

1285 ià(
	`WARN_ON
(!
Ãw_ùx
))

1286  -
EINVAL
;

1288 ià(
	`WARN_ON
(
Ãw_ùx
->
»¶aû_¡©e
 ==

1289 
IEEE80211_CHANCTX_REPLACES_OTHER
))

1290  -
EINVAL
;

1292 
chª»q
 = 
	`›“80211_chªùx_nÚ_»£rved_chªdef
(
loÿl
, 
Ãw_ùx
,

1293 &
lšk
->
»£rved
,

1294 &
tmp
);

1295 ià(
	`WARN_ON
(!
chª»q
))

1296  -
EINVAL
;

1298 
	`›“80211_chªge_chªùx
(
loÿl
, 
Ãw_ùx
,‚ew_ùx, 
chª»q
);

1300 
	`li¡_d–
(&
lšk
->
»£rved_chªùx_li¡
);

1301 
lšk
->
»£rved_chªùx
 = 
NULL
;

1303 
”r
 = 
	`›“80211_assign_lšk_chªùx
(
lšk
, 
Ãw_ùx
);

1304 ià(
”r
) {

1305 ià(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
Ãw_ùx
) == 0)

1306 
	`›“80211_ä“_chªùx
(
loÿl
, 
Ãw_ùx
);

1308 
out
;

1311 
out
:

1312 
	`›“80211_lšk_chªùx_»£rv©iÚ_com¶‘e
(
lšk
);

1313  
”r
;

1314 
	}
}

1316 
boŞ


1317 
	$›“80211_lšk_has_š_¶aû_»£rv©iÚ
(
›“80211_lšk_d©a
 *
lšk
)

1319 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1320 
›“80211_chªùx
 *
Şd_ùx
, *
Ãw_ùx
;

1322 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1324 
Ãw_ùx
 = 
lšk
->
»£rved_chªùx
;

1325 
Şd_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1327 ià(!
Şd_ùx
)

1328  
çl£
;

1330 ià(
	`WARN_ON
(!
Ãw_ùx
))

1331  
çl£
;

1333 ià(
Şd_ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
)

1334  
çl£
;

1336 ià(
Ãw_ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1337  
çl£
;

1339  
Œue
;

1340 
	}
}

1342 
	$›“80211_chsw_sw™ch_vifs
(
›“80211_loÿl
 *
loÿl
,

1343 
n_vifs
)

1345 
›“80211_vif_chªùx_sw™ch
 *
vif_chsw
;

1346 
›“80211_lšk_d©a
 *
lšk
;

1347 
›“80211_chªùx
 *
ùx
, *
Şd_ùx
;

1348 
i
, 
”r
;

1350 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1352 
vif_chsw
 = 
	`kÿÎoc
(
n_vifs
, (vif_chsw[0]), 
GFP_KERNEL
);

1353 ià(!
vif_chsw
)

1354  -
ENOMEM
;

1356 
i
 = 0;

1357 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1358 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1361 ià(
	`WARN_ON
(!
ùx
->
»¶aû_ùx
)) {

1362 
”r
 = -
EINVAL
;

1363 
out
;

1366 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»£rved_lšks
,

1367 
»£rved_chªùx_li¡
) {

1368 ià(!
	`›“80211_lšk_has_š_¶aû_»£rv©iÚ
(
lšk
))

1371 
Şd_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1372 
vif_chsw
[
i
].
vif
 = &
lšk
->
sd©a
->vif;

1373 
vif_chsw
[
i
].
Şd_ùx
 = &Şd_ùx->
cÚf
;

1374 
vif_chsw
[
i
].
Ãw_ùx
 = &
ùx
->
cÚf
;

1375 
vif_chsw
[
i
].
lšk_cÚf
 = 
lšk
->
cÚf
;

1377 
i
++;

1381 
”r
 = 
	`drv_sw™ch_vif_chªùx
(
loÿl
, 
vif_chsw
, 
n_vifs
,

1382 
CHANCTX_SWMODE_SWAP_CONTEXTS
);

1384 
out
:

1385 
	`kä“
(
vif_chsw
);

1386  
”r
;

1387 
	}
}

1389 
	$›“80211_chsw_sw™ch_ùxs
(
›“80211_loÿl
 *
loÿl
)

1391 
›“80211_chªùx
 *
ùx
;

1392 
”r
;

1394 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1396 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1397 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1400 ià(!
	`li¡_em±y
(&
ùx
->
»¶aû_ùx
->
assigÃd_lšks
))

1403 
	`›“80211_d–_chªùx
(
loÿl
, 
ùx
->
»¶aû_ùx
);

1404 
”r
 = 
	`›“80211_add_chªùx
(
loÿl
, 
ùx
);

1405 ià(
”r
)

1406 
”r
;

1411 
”r
:

1412 
	`WARN_ON
(
	`›“80211_add_chªùx
(
loÿl
, 
ùx
));

1413 
	`li¡_fÜ_—ch_’Œy_cÚtšue_»v”£
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1414 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1417 ià(!
	`li¡_em±y
(&
ùx
->
»¶aû_ùx
->
assigÃd_lšks
))

1420 
	`›“80211_d–_chªùx
(
loÿl
, 
ùx
);

1421 
	`WARN_ON
(
	`›“80211_add_chªùx
(
loÿl
, 
ùx
->
»¶aû_ùx
));

1424  
”r
;

1425 
	}
}

1427 
	$›“80211_vif_u£_»£rved_sw™ch
(
›“80211_loÿl
 *
loÿl
)

1429 
›“80211_chªùx
 *
ùx
, *
ùx_tmp
, *
Şd_ùx
;

1430 
”r
, 
n_assigÃd
, 
n_»£rved
, 
n_»ady
;

1431 
n_ùx
 = 0, 
n_vifs_sw™ch
 = 0, 
n_vifs_assign
 = 0, 
n_vifs_ùxËss
 = 0;

1433 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1451 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1452 
›“80211_lšk_d©a
 *
lšk
;

1454 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1457 ià(
	`WARN_ON
(!
ùx
->
»¶aû_ùx
)) {

1458 
”r
 = -
EINVAL
;

1459 
”r
;

1462 
n_ùx
++;

1464 
n_assigÃd
 = 0;

1465 
n_»£rved
 = 0;

1466 
n_»ady
 = 0;

1468 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»¶aû_ùx
->
assigÃd_lšks
,

1469 
assigÃd_chªùx_li¡
) {

1470 
n_assigÃd
++;

1471 ià(
lšk
->
»£rved_chªùx
) {

1472 
n_»£rved
++;

1473 ià(
lšk
->
»£rved_»ady
)

1474 
n_»ady
++;

1478 ià(
n_assigÃd
 !ğ
n_»£rved
) {

1479 ià(
n_»ady
 =ğ
n_»£rved
) {

1480 
	`why_šfo
(
loÿl
->
hw
.
why
,

1482 
”r
 = -
EBUSY
;

1483 
”r
;

1486  -
EAGAIN
;

1489 
ùx
->
cÚf
.
¿d¬_’abËd
 = 
çl£
;

1490 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»£rved_lšks
,

1491 
»£rved_chªùx_li¡
) {

1492 ià(
	`›“80211_lšk_has_š_¶aû_»£rv©iÚ
(
lšk
) &&

1493 !
lšk
->
»£rved_»ady
)

1494  -
EAGAIN
;

1496 
Şd_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1497 ià(
Şd_ùx
) {

1498 ià(
Şd_ùx
->
»¶aû_¡©e
 ==

1499 
IEEE80211_CHANCTX_WILL_BE_REPLACED
)

1500 
n_vifs_sw™ch
++;

1502 
n_vifs_assign
++;

1504 
n_vifs_ùxËss
++;

1507 ià(
lšk
->
»£rved_¿d¬_»quœed
)

1508 
ùx
->
cÚf
.
¿d¬_’abËd
 = 
Œue
;

1512 ià(
	`WARN_ON
(
n_ùx
 == 0) ||

1513 
	`WARN_ON
(
n_vifs_sw™ch
 == 0 &&

1514 
n_vifs_assign
 == 0 &&

1515 
n_vifs_ùxËss
 == 0)) {

1516 
”r
 = -
EINVAL
;

1517 
”r
;

1525 ià(
n_vifs_sw™ch
 > 0) {

1526 
”r
 = 
	`›“80211_chsw_sw™ch_vifs
(
loÿl
, 
n_vifs_sw™ch
);

1527 ià(
”r
)

1528 
”r
;

1531 ià(
n_vifs_assign
 > 0 || 
n_vifs_ùxËss
 > 0) {

1532 
”r
 = 
	`›“80211_chsw_sw™ch_ùxs
(
loÿl
);

1533 ià(
”r
)

1534 
”r
;

1541 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1542 
›“80211_lšk_d©a
 *
lšk
, *
lšk_tmp
;

1544 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1547 ià(
	`WARN_ON
(!
ùx
->
»¶aû_ùx
)) {

1548 
”r
 = -
EINVAL
;

1549 
”r
;

1552 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»£rved_lšks
,

1553 
»£rved_chªùx_li¡
) {

1554 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1555 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1556 
u64
 
chªged
 = 0;

1558 ià(!
	`›“80211_lšk_has_š_¶aû_»£rv©iÚ
(
lšk
))

1561 
	`rcu_assign_poš‹r
(
lšk_cÚf
->
chªùx_cÚf
,

1562 &
ùx
->
cÚf
);

1564 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

1565 
	`__›“80211_lšk_cİy_chªùx_to_vÏns
(
lšk
,

1566 
çl£
);

1568 
	`›“80211_check_ç¡_xm™_içû
(
sd©a
);

1570 
lšk
->
¿d¬_»quœed
 =†šk->
»£rved_¿d¬_»quœed
;

1572 ià(
lšk_cÚf
->
chª»q
.
İ”
.
width
 !ğ
lšk
->
»£rved
.oper.width)

1573 
chªged
 = 
BSS_CHANGED_BANDWIDTH
;

1575 
	`›“80211_lšk_upd©e_chª»q
(
lšk
, &lšk->
»£rved
);

1576 ià(
chªged
)

1577 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
,

1578 
lšk
,

1579 
chªged
);

1581 
	`›“80211_»ÿlc_txpow”
(
sd©a
, 
çl£
);

1584 
	`›“80211_»ÿlc_chªùx_chªty³
(
loÿl
, 
ùx
);

1585 
	`›“80211_»ÿlc_smps_chªùx
(
loÿl
, 
ùx
);

1586 
	`›“80211_»ÿlc_¿d¬_chªùx
(
loÿl
, 
ùx
);

1587 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
ùx
, 
NULL
);

1589 
	`li¡_fÜ_—ch_’Œy_§ã
(
lšk
, 
lšk_tmp
, &
ùx
->
»£rved_lšks
,

1590 
»£rved_chªùx_li¡
) {

1591 ià(
	`›“80211_lšk_g‘_chªùx
(
lšk
è!ğ
ùx
)

1594 
	`li¡_d–
(&
lšk
->
»£rved_chªùx_li¡
);

1595 
	`li¡_move
(&
lšk
->
assigÃd_chªùx_li¡
,

1596 &
ùx
->
assigÃd_lšks
);

1597 
lšk
->
»£rved_chªùx
 = 
NULL
;

1599 
	`›“80211_lšk_chªùx_»£rv©iÚ_com¶‘e
(
lšk
);

1609 
	`li¡_fÜ_—ch_’Œy_§ã
(
lšk
, 
lšk_tmp
, &
ùx
->
»£rved_lšks
,

1610 
»£rved_chªùx_li¡
) {

1611 ià(
	`WARN_ON
(
	`›“80211_lšk_has_š_¶aû_»£rv©iÚ
(
lšk
)))

1614 ià(
	`WARN_ON
(
lšk
->
»£rved_chªùx
 !ğ
ùx
))

1617 ià(!
lšk
->
»£rved_»ady
)

1620 ià(
	`›“80211_lšk_g‘_chªùx
(
lšk
))

1621 
”r
 = 
	`›“80211_lšk_u£_»£rved_»assign
(
lšk
);

1623 
”r
 = 
	`›“80211_lšk_u£_»£rved_assign
(
lšk
);

1625 ià(
”r
) {

1626 
	`lšk_šfo
(
lšk
,

1628 
”r
);

1629 
	`›“80211_lšk_uÄe£rve_chªùx
(
lšk
);

1630 
	`cfg80211_¡İ_içû
(
loÿl
->
hw
.
why
,

1631 &
lšk
->
sd©a
->
wdev
,

1632 
GFP_KERNEL
);

1641 
	`li¡_fÜ_—ch_’Œy_§ã
(
ùx
, 
ùx_tmp
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1642 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
)

1645 
ùx
->
»¶aû_ùx
->»¶aû_ùx = 
NULL
;

1646 
ùx
->
»¶aû_ùx
->
»¶aû_¡©e
 =

1647 
IEEE80211_CHANCTX_REPLACE_NONE
;

1649 
	`li¡_d–_rcu
(&
ùx
->
li¡
);

1650 
	`kä“_rcu
(
ùx
, 
rcu_h—d
);

1655 
”r
:

1656 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

1657 
›“80211_lšk_d©a
 *
lšk
, *
lšk_tmp
;

1659 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1662 
	`li¡_fÜ_—ch_’Œy_§ã
(
lšk
, 
lšk_tmp
, &
ùx
->
»£rved_lšks
,

1663 
»£rved_chªùx_li¡
) {

1664 
	`›“80211_lšk_uÄe£rve_chªùx
(
lšk
);

1665 
	`›“80211_lšk_chªùx_»£rv©iÚ_com¶‘e
(
lšk
);

1669  
”r
;

1670 
	}
}

1672 
	$__›“80211_lšk_»Ëa£_chªÃl
(
›“80211_lšk_d©a
 *
lšk
)

1674 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1675 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1676 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1677 
›“80211_chªùx_cÚf
 *
cÚf
;

1678 
›“80211_chªùx
 *
ùx
;

1679 
boŞ
 
u£_»£rved_sw™ch
 = 
çl£
;

1681 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1683 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk_cÚf
->
chªùx_cÚf
,

1684 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1685 ià(!
cÚf
)

1688 
ùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

1690 ià(
lšk
->
»£rved_chªùx
) {

1691 ià(
lšk
->
»£rved_chªùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_REPLACES_OTHER
 &&

1692 
	`›“80211_chªùx_num_»£rved
(
loÿl
, 
lšk
->
»£rved_chªùx
) > 1)

1693 
u£_»£rved_sw™ch
 = 
Œue
;

1695 
	`›“80211_lšk_uÄe£rve_chªùx
(
lšk
);

1698 
	`›“80211_assign_lšk_chªùx
(
lšk
, 
NULL
);

1699 ià(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
ùx
) == 0)

1700 
	`›“80211_ä“_chªùx
(
loÿl
, 
ùx
);

1702 
lšk
->
¿d¬_»quœed
 = 
çl£
;

1705 ià(
u£_»£rved_sw™ch
)

1706 
	`›“80211_vif_u£_»£rved_sw™ch
(
loÿl
);

1707 
	}
}

1709 
	$›“80211_lšk_u£_chªÃl
(
›“80211_lšk_d©a
 *
lšk
,

1710 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

1711 
›“80211_chªùx_mode
 
mode
)

1713 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1714 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1715 
›“80211_chªùx
 *
ùx
;

1716 
u8
 
¿d¬_d‘eù_width
 = 0;

1717 
»t
;

1719 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1721 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk
->
lšk_id
)) {

1722 
	`›“80211_lšk_upd©e_chª»q
(
lšk
, 
chª»q
);

1726 
»t
 = 
	`cfg80211_chªdef_dfs_»quœed
(
loÿl
->
hw
.
why
,

1727 &
chª»q
->
İ”
,

1728 
sd©a
->
wdev
.
iáy³
);

1729 ià(
»t
 < 0)

1730 
out
;

1731 ià(
»t
 > 0)

1732 
¿d¬_d‘eù_width
 = 
	`BIT
(
chª»q
->
İ”
.
width
);

1734 
lšk
->
¿d¬_»quœed
 = 
»t
;

1736 
»t
 = 
	`›“80211_check_combš©iÚs
(
sd©a
, &
chª»q
->
İ”
, 
mode
,

1737 
¿d¬_d‘eù_width
);

1738 ià(
»t
 < 0)

1739 
out
;

1741 
	`__›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

1743 
ùx
 = 
	`›“80211_fšd_chªùx
(
loÿl
, 
chª»q
, 
mode
);

1744 ià(!
ùx
)

1745 
ùx
 = 
	`›“80211_Ãw_chªùx
(
loÿl
, 
chª»q
, 
mode
);

1746 ià(
	`IS_ERR
(
ùx
)) {

1747 
»t
 = 
	`PTR_ERR
(
ùx
);

1748 
out
;

1751 
	`›“80211_lšk_upd©e_chª»q
(
lšk
, 
chª»q
);

1753 
»t
 = 
	`›“80211_assign_lšk_chªùx
(
lšk
, 
ùx
);

1754 ià(
»t
) {

1756 ià(
	`›“80211_chªùx_»fcouÁ
(
loÿl
, 
ùx
) == 0)

1757 
	`›“80211_ä“_chªùx
(
loÿl
, 
ùx
);

1758 
out
;

1761 
	`›“80211_»ÿlc_smps_chªùx
(
loÿl
, 
ùx
);

1762 
	`›“80211_»ÿlc_¿d¬_chªùx
(
loÿl
, 
ùx
);

1763 
out
:

1764 ià(
»t
)

1765 
lšk
->
¿d¬_»quœed
 = 
çl£
;

1767  
»t
;

1768 
	}
}

1770 
	$›“80211_lšk_u£_»£rved_cÚ‹xt
(
›“80211_lšk_d©a
 *
lšk
)

1772 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1773 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1774 
›“80211_chªùx
 *
Ãw_ùx
;

1775 
›“80211_chªùx
 *
Şd_ùx
;

1776 
”r
;

1778 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1780 
Ãw_ùx
 = 
lšk
->
»£rved_chªùx
;

1781 
Şd_ùx
 = 
	`›“80211_lšk_g‘_chªùx
(
lšk
);

1783 ià(
	`WARN_ON
(!
Ãw_ùx
))

1784  -
EINVAL
;

1786 ià(
	`WARN_ON
(
Ãw_ùx
->
»¶aû_¡©e
 ==

1787 
IEEE80211_CHANCTX_WILL_BE_REPLACED
))

1788  -
EINVAL
;

1790 ià(
	`WARN_ON
(
lšk
->
»£rved_»ady
))

1791  -
EINVAL
;

1793 
lšk
->
»£rved_»ady
 = 
Œue
;

1795 ià(
Ãw_ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_REPLACE_NONE
) {

1796 ià(
Şd_ùx
)

1797  
	`›“80211_lšk_u£_»£rved_»assign
(
lšk
);

1799  
	`›“80211_lšk_u£_»£rved_assign
(
lšk
);

1813 ià((
Şd_ùx
 &&

1814 
Şd_ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
) ||

1815 
Ãw_ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_REPLACES_OTHER
) {

1816 
”r
 = 
	`›“80211_vif_u£_»£rved_sw™ch
(
loÿl
);

1817 ià(
”r
 &&ƒ¼ !ğ-
EAGAIN
) {

1818 ià(
Ãw_ùx
->
»¶aû_¡©e
 ==

1819 
IEEE80211_CHANCTX_REPLACES_OTHER
)

1820  
”r
;

1822 
	`why_šfo
(
loÿl
->
hw
.
why
,

1824 
”r
);

1829 
	}
}

1840 cÚ¡ 
›“80211_chª_»q
 *

1841 
	$›“80211_chªùx_»check
(
›“80211_loÿl
 *
loÿl
,

1842 
›“80211_lšk_d©a
 *
sk_lšk
,

1843 
›“80211_chªùx
 *
ùx
,

1844 cÚ¡ 
›“80211_chª_»q
 *
»q
,

1845 
›“80211_chª_»q
 *
tmp
)

1847 cÚ¡ 
›“80211_chª_»q
 *
»t
 = 
»q
;

1848 
›“80211_lšk_d©a
 *
lšk
;

1850 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1852 
	`fÜ_—ch_sd©a_lšk
(
loÿl
, 
lšk
) {

1853 ià(
lšk
 =ğ
sk_lšk
)

1856 ià(
	`rcu_acûss_poš‹r
(
lšk
->
cÚf
->
chªùx_cÚf
è=ğ&
ùx
->conf) {

1857 
»t
 = 
	`›“80211_chª»q_com·tibË
(ret,

1858 &
lšk
->
cÚf
->
chª»q
,

1859 
tmp
);

1860 ià(!
»t
)

1861  
NULL
;

1864 ià(
lšk
->
»£rved_chªùx
 =ğ
ùx
) {

1865 
»t
 = 
	`›“80211_chª»q_com·tibË
(ret,

1866 &
lšk
->
»£rved
,

1867 
tmp
);

1868 ià(!
»t
)

1869  
NULL
;

1873 *
tmp
 = *
»t
;

1874  
tmp
;

1875 
	}
}

1877 
	$›“80211_lšk_chªge_chª»q
(
›“80211_lšk_d©a
 *
lšk
,

1878 cÚ¡ 
›“80211_chª_»q
 *
chª»q
,

1879 
u64
 *
chªged
)

1881 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1882 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1883 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1884 
›“80211_chªùx_cÚf
 *
cÚf
;

1885 
›“80211_chªùx
 *
ùx
;

1886 cÚ¡ 
›“80211_chª_»q
 *
com·t
;

1887 
›“80211_chª_»q
 
tmp
;

1889 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1891 ià(!
	`cfg80211_chªdef_u§bË
(
sd©a
->
loÿl
->
hw
.
why
,

1892 &
chª»q
->
İ”
,

1893 
IEEE80211_CHAN_DISABLED
))

1894  -
EINVAL
;

1897 ià(
chª»q
->
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 &&

1898 
	`cfg80211_chªdef_id’tiÿl
(&
chª»q
->
İ”
, &
lšk_cÚf
->chanreq.oper))

1902 ià(
chª»q
->
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

1903 
lšk_cÚf
->
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
)

1904  -
EINVAL
;

1906 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk_cÚf
->
chªùx_cÚf
,

1907 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1908 ià(!
cÚf
)

1909  -
EINVAL
;

1911 
ùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

1913 
com·t
 = 
	`›“80211_chªùx_»check
(
loÿl
, 
lšk
, 
ùx
, 
chª»q
, &
tmp
);

1914 ià(!
com·t
)

1915  -
EINVAL
;

1917 
ùx
->
»¶aû_¡©e
) {

1918 
IEEE80211_CHANCTX_REPLACE_NONE
:

1919 ià(!
	`›“80211_chªùx_»£rved_chª»q
(
loÿl
, 
ùx
, 
com·t
,

1920 &
tmp
))

1921  -
EBUSY
;

1923 
IEEE80211_CHANCTX_WILL_BE_REPLACED
:

1926  -
EBUSY
;

1927 
IEEE80211_CHANCTX_REPLACES_OTHER
:

1931 
	`WARN_ON
(1);

1935 
	`›“80211_lšk_upd©e_chª»q
(
lšk
, 
chª»q
);

1937 
	`›“80211_»ÿlc_chªùx_chªty³
(
loÿl
, 
ùx
);

1939 *
chªged
 |ğ
BSS_CHANGED_BANDWIDTH
;

1941 
	}
}

1943 
	$›“80211_lšk_»Ëa£_chªÃl
(
›“80211_lšk_d©a
 *
lšk
)

1945 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1947 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1949 ià(
	`rcu_acûss_poš‹r
(
lšk
->
cÚf
->
chªùx_cÚf
))

1950 
	`__›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

1951 
	}
}

1953 
	$›“80211_lšk_vÏn_cİy_chªùx
(
›“80211_lšk_d©a
 *
lšk
)

1955 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1956 
lšk_id
 = 
lšk
->link_id;

1957 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

1958 
›“80211_bss_cÚf
 *
­_cÚf
;

1959 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1960 
›“80211_sub_if_d©a
 *
­
;

1961 
›“80211_chªùx_cÚf
 *
cÚf
;

1963 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1965 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 || !sd©a->
bss
))

1968 
­
 = 
	`cÚš”_of
(
sd©a
->
bss
, 
›“80211_sub_if_d©a
, 
u
.ap);

1970 
­_cÚf
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

1971 
­
->
vif
.
lšk_cÚf
[
lšk_id
]);

1972 
cÚf
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,

1973 
­_cÚf
->
chªùx_cÚf
);

1974 
	`rcu_assign_poš‹r
(
lšk_cÚf
->
chªùx_cÚf
, 
cÚf
);

1975 
	}
}

1977 
	$›“80211_™”_chª_cÚ‹xts_©omic
(

1978 
›“80211_hw
 *
hw
,

1979 (*
™”
)(
›“80211_hw
 *
hw
,

1980 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
,

1981 *
d©a
),

1982 *
™”_d©a
)

1984 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1985 
›“80211_chªùx
 *
ùx
;

1987 
	`rcu_»ad_lock
();

1988 
	`li¡_fÜ_—ch_’Œy_rcu
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
)

1989 ià(
ùx
->
driv”_´e£Á
)

1990 
	`™”
(
hw
, &
ùx
->
cÚf
, 
™”_d©a
);

1991 
	`rcu_»ad_uÆock
();

1992 
	}
}

1993 
EXPORT_SYMBOL_GPL
(
›“80211_™”_chª_cÚ‹xts_©omic
);

	@debug.h

6 #iâdeà
__MAC80211_DEBUG_H


7 
	#__MAC80211_DEBUG_H


	)

8 
	~<Ãt/cfg80211.h
>

10 #ifdeà
CONFIG_MAC80211_OCB_DEBUG


11 
	#MAC80211_OCB_DEBUG
 1

	)

13 
	#MAC80211_OCB_DEBUG
 0

	)

16 #ifdeà
CONFIG_MAC80211_IBSS_DEBUG


17 
	#MAC80211_IBSS_DEBUG
 1

	)

19 
	#MAC80211_IBSS_DEBUG
 0

	)

22 #ifdeà
CONFIG_MAC80211_PS_DEBUG


23 
	#MAC80211_PS_DEBUG
 1

	)

25 
	#MAC80211_PS_DEBUG
 0

	)

28 #ifdeà
CONFIG_MAC80211_HT_DEBUG


29 
	#MAC80211_HT_DEBUG
 1

	)

31 
	#MAC80211_HT_DEBUG
 0

	)

34 #ifdeà
CONFIG_MAC80211_MPL_DEBUG


35 
	#MAC80211_MPL_DEBUG
 1

	)

37 
	#MAC80211_MPL_DEBUG
 0

	)

40 #ifdeà
CONFIG_MAC80211_MPATH_DEBUG


41 
	#MAC80211_MPATH_DEBUG
 1

	)

43 
	#MAC80211_MPATH_DEBUG
 0

	)

46 #ifdeà
CONFIG_MAC80211_MHWMP_DEBUG


47 
	#MAC80211_MHWMP_DEBUG
 1

	)

49 
	#MAC80211_MHWMP_DEBUG
 0

	)

52 #ifdeà
CONFIG_MAC80211_MESH_SYNC_DEBUG


53 
	#MAC80211_MESH_SYNC_DEBUG
 1

	)

55 
	#MAC80211_MESH_SYNC_DEBUG
 0

	)

58 #ifdeà
CONFIG_MAC80211_MESH_CSA_DEBUG


59 
	#MAC80211_MESH_CSA_DEBUG
 1

	)

61 
	#MAC80211_MESH_CSA_DEBUG
 0

	)

64 #ifdeà
CONFIG_MAC80211_MESH_PS_DEBUG


65 
	#MAC80211_MESH_PS_DEBUG
 1

	)

67 
	#MAC80211_MESH_PS_DEBUG
 0

	)

70 #ifdeà
CONFIG_MAC80211_TDLS_DEBUG


71 
	#MAC80211_TDLS_DEBUG
 1

	)

73 
	#MAC80211_TDLS_DEBUG
 0

	)

76 #ifdeà
CONFIG_MAC80211_STA_DEBUG


77 
	#MAC80211_STA_DEBUG
 1

	)

79 
	#MAC80211_STA_DEBUG
 0

	)

82 #ifdeà
CONFIG_MAC80211_MLME_DEBUG


83 
	#MAC80211_MLME_DEBUG
 1

	)

85 
	#MAC80211_MLME_DEBUG
 0

	)

88 #ifdeà
CONFIG_MAC80211_MESSAGE_TRACING


89 
	$__sd©a_šfo
(cÚ¡ *
fmt
, ...è
	`__´štf
(1, 2);

90 
	$__sd©a_dbg
(
boŞ
 
´št
, cÚ¡ *
fmt
, ...è
	`__´štf
(2, 3);

91 
	$__sd©a_”r
(cÚ¡ *
fmt
, ...è
	`__´štf
(1, 2);

92 
	$__why_dbg
(
why
 *why, 
boŞ
 
´št
, cÚ¡ *
fmt
, ...)

93 
	`__´štf
(3, 4);

95 
	#_sd©a_šfo
(
sd©a
, 
fmt
, ...) \

96 
	`__sd©a_šfo
("%s: " 
fmt
, (
sd©a
)->
Çme
, ##
__VA_ARGS__
)

	)

97 
	#_sd©a_dbg
(
´št
, 
sd©a
, 
fmt
, ...) \

98 
	`__sd©a_dbg
(
´št
, "%s: " 
fmt
, (
sd©a
)->
Çme
, ##
__VA_ARGS__
)

	)

99 
	#_sd©a_”r
(
sd©a
, 
fmt
, ...) \

100 
	`__sd©a_”r
("%s: " 
fmt
, (
sd©a
)->
Çme
, ##
__VA_ARGS__
)

	)

101 
	#_why_dbg
(
´št
, 
why
, 
fmt
, ...) \

102 
	`__why_dbg
(
why
, 
´št
, 
fmt
, ##
__VA_ARGS__
)

	)

104 
	#_sd©a_šfo
(
sd©a
, 
fmt
, ...) \

106 
	`´_šfo
("%s: " 
fmt
, \

107 (
sd©a
)->
Çme
, ##
__VA_ARGS__
); \

108 
	}
} 0)

	)

110 
	#_sd©a_dbg
(
´št
, 
sd©a
, 
fmt
, ...) \

112 ià(
´št
) \

113 
	`´_debug
("%s: " 
fmt
, \

114 (
sd©a
)->
Çme
, ##
__VA_ARGS__
); \

115 } 0)

	)

117 
	#_sd©a_”r
(
sd©a
, 
fmt
, ...) \

119 
	`´_”r
("%s: " 
fmt
, \

120 (
sd©a
)->
Çme
, ##
__VA_ARGS__
); \

121 } 0)

	)

123 
	#_why_dbg
(
´št
, 
why
, 
fmt
, ...) \

125 ià(
´št
) \

126 
	`why_dbg
((
why
), 
fmt
, ##
__VA_ARGS__
); \

127 } 0)

	)

130 
	#sd©a_šfo
(
sd©a
, 
fmt
, ...) \

131 
	`_sd©a_šfo
(
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

132 
	#sd©a_”r
(
sd©a
, 
fmt
, ...) \

133 
	`_sd©a_”r
(
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

134 
	#sd©a_dbg
(
sd©a
, 
fmt
, ...) \

135 
	`_sd©a_dbg
(1, 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

137 
	#lšk_šfo
(
lšk
, 
fmt
, ...) \

139 ià(
	`›“80211_vif_is_mld
(&(
lšk
)->
sd©a
->
vif
)) \

140 
	`_sd©a_šfo
((
lšk
)->
sd©a
, "[lšk %d] " 
fmt
, \

141 (
lšk
)->
lšk_id
, \

142 ##
__VA_ARGS__
); \

144 
	`_sd©a_šfo
((
lšk
)->
sd©a
, 
fmt
, ##
__VA_ARGS__
); \

145 } 0)

	)

146 
	#lšk_”r
(
lšk
, 
fmt
, ...) \

148 ià(
	`›“80211_vif_is_mld
(&(
lšk
)->
sd©a
->
vif
)) \

149 
	`_sd©a_”r
((
lšk
)->
sd©a
, "[lšk %d] " 
fmt
, \

150 (
lšk
)->
lšk_id
, \

151 ##
__VA_ARGS__
); \

153 
	`_sd©a_”r
((
lšk
)->
sd©a
, 
fmt
, ##
__VA_ARGS__
); \

154 } 0)

	)

155 
	#_lšk_id_dbg
(
´št
, 
sd©a
, 
lšk_id
, 
fmt
, ...) \

157 ià(
	`›“80211_vif_is_mld
(&(
sd©a
)->
vif
)) \

158 
	`_sd©a_dbg
(
´št
, 
sd©a
, "[lšk %d] " 
fmt
, \

159 
lšk_id
, ##
__VA_ARGS__
); \

161 
	`_sd©a_dbg
(
´št
, 
sd©a
, 
fmt
, ##
__VA_ARGS__
); \

162 } 0)

	)

163 
	#lšk_dbg
(
lšk
, 
fmt
, ...) \

164 
	`_lšk_id_dbg
(1, (
lšk
)->
sd©a
, (lšk)->
lšk_id
, \

165 
fmt
, ##
__VA_ARGS__
)

	)

167 
	#ht_dbg
(
sd©a
, 
fmt
, ...) \

168 
	`_sd©a_dbg
(
MAC80211_HT_DEBUG
, \

169 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

171 
	#ht_dbg_¿‹lim™ed
(
sd©a
, 
fmt
, ...) \

172 
	`_sd©a_dbg
(
MAC80211_HT_DEBUG
 && 
	`Ãt_¿‹lim™
(), \

173 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

175 
	#ocb_dbg
(
sd©a
, 
fmt
, ...) \

176 
	`_sd©a_dbg
(
MAC80211_OCB_DEBUG
, \

177 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

179 
	#ibss_dbg
(
sd©a
, 
fmt
, ...) \

180 
	`_sd©a_dbg
(
MAC80211_IBSS_DEBUG
, \

181 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

183 
	#ps_dbg
(
sd©a
, 
fmt
, ...) \

184 
	`_sd©a_dbg
(
MAC80211_PS_DEBUG
, \

185 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

187 
	#ps_dbg_hw
(
hw
, 
fmt
, ...) \

188 
	`_why_dbg
(
MAC80211_PS_DEBUG
, \

189 (
hw
)->
why
, 
fmt
, ##
__VA_ARGS__
)

	)

191 
	#ps_dbg_¿‹lim™ed
(
sd©a
, 
fmt
, ...) \

192 
	`_sd©a_dbg
(
MAC80211_PS_DEBUG
 && 
	`Ãt_¿‹lim™
(), \

193 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

195 
	#m¶_dbg
(
sd©a
, 
fmt
, ...) \

196 
	`_sd©a_dbg
(
MAC80211_MPL_DEBUG
, \

197 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

199 
	#m·th_dbg
(
sd©a
, 
fmt
, ...) \

200 
	`_sd©a_dbg
(
MAC80211_MPATH_DEBUG
, \

201 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

203 
	#mhwmp_dbg
(
sd©a
, 
fmt
, ...) \

204 
	`_sd©a_dbg
(
MAC80211_MHWMP_DEBUG
, \

205 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

207 
	#msync_dbg
(
sd©a
, 
fmt
, ...) \

208 
	`_sd©a_dbg
(
MAC80211_MESH_SYNC_DEBUG
, \

209 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

211 
	#mc§_dbg
(
sd©a
, 
fmt
, ...) \

212 
	`_sd©a_dbg
(
MAC80211_MESH_CSA_DEBUG
, \

213 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

215 
	#mps_dbg
(
sd©a
, 
fmt
, ...) \

216 
	`_sd©a_dbg
(
MAC80211_MESH_PS_DEBUG
, \

217 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

219 
	#tdls_dbg
(
sd©a
, 
fmt
, ...) \

220 
	`_sd©a_dbg
(
MAC80211_TDLS_DEBUG
, \

221 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

223 
	#¡a_dbg
(
sd©a
, 
fmt
, ...) \

224 
	`_sd©a_dbg
(
MAC80211_STA_DEBUG
, \

225 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

227 
	#mlme_dbg
(
sd©a
, 
fmt
, ...) \

228 
	`_sd©a_dbg
(
MAC80211_MLME_DEBUG
, \

229 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

230 
	#mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
, 
fmt
, ...) \

231 
	`_lšk_id_dbg
(
MAC80211_MLME_DEBUG
, 
sd©a
, 
lšk_id
, \

232 
fmt
, ##
__VA_ARGS__
)

	)

234 
	#mlme_dbg_¿‹lim™ed
(
sd©a
, 
fmt
, ...) \

235 
	`_sd©a_dbg
(
MAC80211_MLME_DEBUG
 && 
	`Ãt_¿‹lim™
(), \

236 
sd©a
, 
fmt
, ##
__VA_ARGS__
)

	)

	@debugfs.c

10 
	~<lšux/debugfs.h
>

11 
	~<lšux/¹Ãšk.h
>

12 
	~<lšux/vm®loc.h
>

13 
	~"›“80211_i.h
"

14 
	~"driv”-İs.h
"

15 
	~"¿‹.h
"

16 
	~"debugfs.h
"

18 
	#DEBUGFS_FORMAT_BUFFER_SIZE
 100

	)

20 
	$mac80211_fÜm©_bufãr
(
__u£r
 *
u£rbuf
, 
size_t
 
couÁ
,

21 
loff_t
 *
µos
, *
fmt
, ...)

23 
va_li¡
 
¬gs
;

24 
buf
[
DEBUGFS_FORMAT_BUFFER_SIZE
];

25 
»s
;

27 
	`va_¡¬t
(
¬gs
, 
fmt
);

28 
»s
 = 
	`vsú´štf
(
buf
, (buf), 
fmt
, 
¬gs
);

29 
	`va_’d
(
¬gs
);

31  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
»s
);

32 
	}
}

34 
	#DEBUGFS_READONLY_FILE_FN
(
Çme
, 
fmt
, 
v®ue
...) \

35 
ssize_t
 
Çme
## 
	`_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
, \

36 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

38 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
; \

40  
	`mac80211_fÜm©_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, \

41 
fmt
 "\n", ##
v®ue
); \

42 }

	)

44 
	#DEBUGFS_READONLY_FILE_OPS
(
Çme
) \

45 cÚ¡ 
fe_İ”©iÚs
 
Çme
## 
_İs
 = { \

46 .
»ad
 = 
Çme
## 
_»ad
, \

47 .
İ’
 = 
sim¶e_İ’
, \

48 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

49 };

	)

51 
	#DEBUGFS_READONLY_FILE
(
Çme
, 
fmt
, 
v®ue
...) \

52 
	`DEBUGFS_READONLY_FILE_FN
(
Çme
, 
fmt
, 
v®ue
) \

53 
	`DEBUGFS_READONLY_FILE_OPS
(
Çme
)

	)

55 
	#DEBUGFS_ADD
(
Çme
) \

56 
	`debugfs_ü—‹_fe
(#Çme, 0400, 
phyd
, 
loÿl
, &
Çme
## 
_İs
)

	)

58 
	#DEBUGFS_ADD_MODE
(
Çme
, 
mode
) \

59 
	`debugfs_ü—‹_fe
(#Çme, 
mode
, 
phyd
, 
loÿl
, &
Çme
## 
_İs
);

	)

62 
DEBUGFS_READONLY_FILE
(
hw_cÚf
, "%x",

63 
loÿl
->
hw
.
cÚf
.
æags
);

64 
DEBUGFS_READONLY_FILE
(
u£r_pow”
, "%d",

65 
loÿl
->
u£r_pow”_Ëv–
);

66 
DEBUGFS_READONLY_FILE
(
pow”
, "%d",

67 
loÿl
->
hw
.
cÚf
.
pow”_Ëv–
);

68 
DEBUGFS_READONLY_FILE
(
tÙ®_ps_bufã»d
, "%d",

69 
loÿl
->
tÙ®_ps_bufã»d
);

70 
DEBUGFS_READONLY_FILE
(
w•_iv
, "%#08x",

71 
loÿl
->
w•_iv
 & 0xffffff);

72 
DEBUGFS_READONLY_FILE
(
¿‹_ù¾_®g
, "%s",

73 
loÿl
->
¿‹_ù¾
 ?†oÿl->¿‹_ù¾->
İs
->
Çme
 : "hw/driver");

75 
ssize_t
 
	$aqm_»ad
(
fe
 *file,

76 
__u£r
 *
u£r_buf
,

77 
size_t
 
couÁ
,

78 
loff_t
 *
µos
)

80 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

81 
fq
 *fq = &
loÿl
->fq;

82 
buf
[200];

83 
Ën
 = 0;

85 
	`¥š_lock_bh
(&
loÿl
->
fq
.
lock
);

86 
	`rcu_»ad_lock
();

88 
Ën
 = 
	`sú´štf
(
buf
, (buf),

99 
fq
->
æows_út
,

100 
fq
->
backlog
,

101 
fq
->
ov”memÜy
,

102 
fq
->
ov”lim™
,

103 
fq
->
cŞlisiÚs
,

104 
fq
->
memÜy_u§ge
,

105 
fq
->
memÜy_lim™
,

106 
fq
->
lim™
,

107 
fq
->
quªtum
);

109 
	`rcu_»ad_uÆock
();

110 
	`¥š_uÆock_bh
(&
loÿl
->
fq
.
lock
);

112  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
,

113 
buf
, 
Ën
);

114 
	}
}

116 
ssize_t
 
	$aqm_wr™e
(
fe
 *file,

117 cÚ¡ 
__u£r
 *
u£r_buf
,

118 
size_t
 
couÁ
,

119 
loff_t
 *
µos
)

121 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

122 
buf
[100];

124 ià(
couÁ
 >ğ(
buf
))

125  -
EINVAL
;

127 ià(
	`cİy_äom_u£r
(
buf
, 
u£r_buf
, 
couÁ
))

128  -
EFAULT
;

130 ià(
couÁ
 && 
buf
[count - 1] == '\n')

131 
buf
[
couÁ
 - 1] = '\0';

133 
buf
[
couÁ
] = '\0';

135 ià(
	`ssÿnf
(
buf
, "fq_lim™ %u", &
loÿl
->
fq
.
lim™
) == 1)

136  
couÁ
;

137 ià(
	`ssÿnf
(
buf
, "fq_memÜy_lim™ %u", &
loÿl
->
fq
.
memÜy_lim™
) == 1)

138  
couÁ
;

139 ià(
	`ssÿnf
(
buf
, "fq_quªtum %u", &
loÿl
->
fq
.
quªtum
) == 1)

140  
couÁ
;

142  -
EINVAL
;

143 
	}
}

145 cÚ¡ 
fe_İ”©iÚs
 
	gaqm_İs
 = {

146 .
wr™e
 = 
aqm_wr™e
,

147 .
	g»ad
 = 
aqm_»ad
,

148 .
	gİ’
 = 
sim¶e_İ’
,

149 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

152 
ssize_t
 
	$aœtime_æags_»ad
(
fe
 *file,

153 
__u£r
 *
u£r_buf
,

154 
size_t
 
couÁ
, 
loff_t
 *
µos
)

156 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

157 
buf
[128] = {}, *
pos
, *
’d
;

159 
pos
 = 
buf
;

160 
’d
 = 
pos
 + (
buf
) - 1;

162 ià(
loÿl
->
aœtime_æags
 & 
AIRTIME_USE_TX
)

163 
pos
 +ğ
	`sú´štf
Õos, 
’d
 -…os, "AIRTIME_TX\t(%lx)\n",

164 
AIRTIME_USE_TX
);

165 ià(
loÿl
->
aœtime_æags
 & 
AIRTIME_USE_RX
)

166 
pos
 +ğ
	`sú´štf
Õos, 
’d
 -…os, "AIRTIME_RX\t(%lx)\n",

167 
AIRTIME_USE_RX
);

169  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
, 
buf
,

170 
	`¡¾’
(
buf
));

171 
	}
}

173 
ssize_t
 
	$aœtime_æags_wr™e
(
fe
 *file,

174 cÚ¡ 
__u£r
 *
u£r_buf
,

175 
size_t
 
couÁ
, 
loff_t
 *
µos
)

177 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

178 
buf
[16];

180 ià(
couÁ
 >ğ(
buf
))

181  -
EINVAL
;

183 ià(
	`cİy_äom_u£r
(
buf
, 
u£r_buf
, 
couÁ
))

184  -
EFAULT
;

186 ià(
couÁ
 && 
buf
[count - 1] == '\n')

187 
buf
[
couÁ
 - 1] = '\0';

189 
buf
[
couÁ
] = '\0';

191 ià(
	`k¡¹ou16
(
buf
, 0, &
loÿl
->
aœtime_æags
))

192  -
EINVAL
;

194  
couÁ
;

195 
	}
}

197 cÚ¡ 
fe_İ”©iÚs
 
	gaœtime_æags_İs
 = {

198 .
wr™e
 = 
aœtime_æags_wr™e
,

199 .
	g»ad
 = 
aœtime_æags_»ad
,

200 .
	gİ’
 = 
sim¶e_İ’
,

201 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

204 
ssize_t
 
	$aql_³ndšg_»ad
(
fe
 *file,

205 
__u£r
 *
u£r_buf
,

206 
size_t
 
couÁ
, 
loff_t
 *
µos
)

208 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

209 
buf
[400];

210 
Ën
 = 0;

212 
Ën
 = 
	`sú´štf
(
buf
, (buf),

219 
	`©omic_»ad
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
IEEE80211_AC_VO
]),

220 
	`©omic_»ad
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
IEEE80211_AC_VI
]),

221 
	`©omic_»ad
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
IEEE80211_AC_BE
]),

222 
	`©omic_»ad
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
IEEE80211_AC_BK
]),

223 
	`©omic_»ad
(&
loÿl
->
aql_tÙ®_³ndšg_aœtime
));

224  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
,

225 
buf
, 
Ën
);

226 
	}
}

228 cÚ¡ 
fe_İ”©iÚs
 
	gaql_³ndšg_İs
 = {

229 .
»ad
 = 
aql_³ndšg_»ad
,

230 .
	gİ’
 = 
sim¶e_İ’
,

231 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

234 
ssize_t
 
	$aql_txq_lim™_»ad
(
fe
 *file,

235 
__u£r
 *
u£r_buf
,

236 
size_t
 
couÁ
,

237 
loff_t
 *
µos
)

239 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

240 
buf
[400];

241 
Ën
 = 0;

243 
Ën
 = 
	`sú´štf
(
buf
, (buf),

249 
loÿl
->
aql_txq_lim™_low
[
IEEE80211_AC_VO
],

250 
loÿl
->
aql_txq_lim™_high
[
IEEE80211_AC_VO
],

251 
loÿl
->
aql_txq_lim™_low
[
IEEE80211_AC_VI
],

252 
loÿl
->
aql_txq_lim™_high
[
IEEE80211_AC_VI
],

253 
loÿl
->
aql_txq_lim™_low
[
IEEE80211_AC_BE
],

254 
loÿl
->
aql_txq_lim™_high
[
IEEE80211_AC_BE
],

255 
loÿl
->
aql_txq_lim™_low
[
IEEE80211_AC_BK
],

256 
loÿl
->
aql_txq_lim™_high
[
IEEE80211_AC_BK
]);

257  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
,

258 
buf
, 
Ën
);

259 
	}
}

261 
ssize_t
 
	$aql_txq_lim™_wr™e
(
fe
 *file,

262 cÚ¡ 
__u£r
 *
u£r_buf
,

263 
size_t
 
couÁ
,

264 
loff_t
 *
µos
)

266 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

267 
buf
[100];

268 
u32
 
ac
, 
q_lim™_low
, 
q_lim™_high
, 
q_lim™_low_Şd
, 
q_lim™_high_Şd
;

269 
¡a_šfo
 *
¡a
;

271 ià(
couÁ
 >ğ(
buf
))

272  -
EINVAL
;

274 ià(
	`cİy_äom_u£r
(
buf
, 
u£r_buf
, 
couÁ
))

275  -
EFAULT
;

277 ià(
couÁ
 && 
buf
[count - 1] == '\n')

278 
buf
[
couÁ
 - 1] = '\0';

280 
buf
[
couÁ
] = '\0';

282 ià(
	`ssÿnf
(
buf
, "%u %u %u", &
ac
, &
q_lim™_low
, &
q_lim™_high
) != 3)

283  -
EINVAL
;

285 ià(
ac
 >ğ
IEEE80211_NUM_ACS
)

286  -
EINVAL
;

288 
q_lim™_low_Şd
 = 
loÿl
->
aql_txq_lim™_low
[
ac
];

289 
q_lim™_high_Şd
 = 
loÿl
->
aql_txq_lim™_high
[
ac
];

291 
	`why_lock
(
loÿl
->
hw
.
why
);

292 
loÿl
->
aql_txq_lim™_low
[
ac
] = 
q_lim™_low
;

293 
loÿl
->
aql_txq_lim™_high
[
ac
] = 
q_lim™_high
;

295 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

297 ià(
¡a
->
aœtime
[
ac
].
aql_lim™_low
 =ğ
q_lim™_low_Şd
 &&

298 
¡a
->
aœtime
[
ac
].
aql_lim™_high
 =ğ
q_lim™_high_Şd
) {

299 
¡a
->
aœtime
[
ac
].
aql_lim™_low
 = 
q_lim™_low
;

300 
¡a
->
aœtime
[
ac
].
aql_lim™_high
 = 
q_lim™_high
;

303 
	`why_uÆock
(
loÿl
->
hw
.
why
);

305  
couÁ
;

306 
	}
}

308 cÚ¡ 
fe_İ”©iÚs
 
	gaql_txq_lim™_İs
 = {

309 .
wr™e
 = 
aql_txq_lim™_wr™e
,

310 .
	g»ad
 = 
aql_txq_lim™_»ad
,

311 .
	gİ’
 = 
sim¶e_İ’
,

312 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

315 
ssize_t
 
	$aql_’abË_»ad
(
fe
 *fe, 
__u£r
 *
u£r_buf
,

316 
size_t
 
couÁ
, 
loff_t
 *
µos
)

318 
buf
[3];

319 
Ën
;

321 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%d\n",

322 !
	`¡©ic_key_çl£
(&
aql_di§bË
.
key
));

324  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
, 
buf
, 
Ën
);

325 
	}
}

327 
ssize_t
 
	$aql_’abË_wr™e
(
fe
 *fe, cÚ¡ 
__u£r
 *
u£r_buf
,

328 
size_t
 
couÁ
, 
loff_t
 *
µos
)

330 
boŞ
 
aql_di§bËd
 = 
	`¡©ic_key_çl£
(&
aql_di§bË
.
key
);

331 
buf
[3];

332 
size_t
 
Ën
;

334 ià(
couÁ
 > (
buf
))

335  -
EINVAL
;

337 ià(
	`cİy_äom_u£r
(
buf
, 
u£r_buf
, 
couÁ
))

338  -
EFAULT
;

340 
buf
[(buf) - 1] = '\0';

341 
Ën
 = 
	`¡¾’
(
buf
);

342 ià(
Ën
 > 0 && 
buf
[len - 1] == '\n')

343 
buf
[
Ën
 - 1] = 0;

345 ià(
buf
[0] == '0' && buf[1] == '\0') {

346 ià(!
aql_di§bËd
)

347 
	`¡©ic_b¿nch_šc
(&
aql_di§bË
);

348 } ià(
buf
[0] == '1' && buf[1] == '\0') {

349 ià(
aql_di§bËd
)

350 
	`¡©ic_b¿nch_dec
(&
aql_di§bË
);

352  -
EINVAL
;

355  
couÁ
;

356 
	}
}

358 cÚ¡ 
fe_İ”©iÚs
 
	gaql_’abË_İs
 = {

359 .
wr™e
 = 
aql_’abË_wr™e
,

360 .
	g»ad
 = 
aql_’abË_»ad
,

361 .
	gİ’
 = 
sim¶e_İ’
,

362 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

365 
ssize_t
 
	$fÜû_tx_¡©us_»ad
(
fe
 *file,

366 
__u£r
 *
u£r_buf
,

367 
size_t
 
couÁ
,

368 
loff_t
 *
µos
)

370 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

371 
buf
[3];

372 
Ën
 = 0;

374 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%d\n", ()
loÿl
->
fÜû_tx_¡©us
);

376  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
,

377 
buf
, 
Ën
);

378 
	}
}

380 
ssize_t
 
	$fÜû_tx_¡©us_wr™e
(
fe
 *file,

381 cÚ¡ 
__u£r
 *
u£r_buf
,

382 
size_t
 
couÁ
,

383 
loff_t
 *
µos
)

385 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

386 
buf
[3];

388 ià(
couÁ
 >ğ(
buf
))

389  -
EINVAL
;

391 ià(
	`cİy_äom_u£r
(
buf
, 
u£r_buf
, 
couÁ
))

392  -
EFAULT
;

394 ià(
couÁ
 && 
buf
[count - 1] == '\n')

395 
buf
[
couÁ
 - 1] = '\0';

397 
buf
[
couÁ
] = '\0';

399 ià(
buf
[0] == '0' && buf[1] == '\0')

400 
loÿl
->
fÜû_tx_¡©us
 = 0;

401 ià(
buf
[0] == '1' && buf[1] == '\0')

402 
loÿl
->
fÜû_tx_¡©us
 = 1;

404  -
EINVAL
;

406  
couÁ
;

407 
	}
}

409 cÚ¡ 
fe_İ”©iÚs
 
	gfÜû_tx_¡©us_İs
 = {

410 .
wr™e
 = 
fÜû_tx_¡©us_wr™e
,

411 .
	g»ad
 = 
fÜû_tx_¡©us_»ad
,

412 .
	gİ’
 = 
sim¶e_İ’
,

413 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

416 #ifdeà
CONFIG_PM


417 
ssize_t
 
	$»£t_wr™e
(
fe
 *fe, cÚ¡ 
__u£r
 *
u£r_buf
,

418 
size_t
 
couÁ
, 
loff_t
 *
µos
)

420 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

421 
»t
;

423 
	`¹Æ_lock
();

424 
	`why_lock
(
loÿl
->
hw
.
why
);

425 
	`__›“80211_su¥’d
(&
loÿl
->
hw
, 
NULL
);

426 
»t
 = 
	`__›“80211_»sume
(&
loÿl
->
hw
);

427 
	`why_uÆock
(
loÿl
->
hw
.
why
);

429 ià(
»t
)

430 
	`cfg80211_shutdown_®l_š‹rçûs
(
loÿl
->
hw
.
why
);

432 
	`¹Æ_uÆock
();

434  
couÁ
;

435 
	}
}

437 cÚ¡ 
fe_İ”©iÚs
 
	g»£t_İs
 = {

438 .
wr™e
 = 
»£t_wr™e
,

439 .
	gİ’
 = 
sim¶e_İ’
,

440 .
	gÎ£ek
 = 
noİ_Î£ek
,

444 cÚ¡ *
	ghw_æag_Çmes
[] = {

445 
	#FLAG
(
F
è[
IEEE80211_HW_
##F] = #F

	)

446 
FLAG
(
HAS_RATE_CONTROL
),

447 
FLAG
(
RX_INCLUDES_FCS
),

448 
FLAG
(
HOST_BROADCAST_PS_BUFFERING
),

449 
FLAG
(
SIGNAL_UNSPEC
),

450 
FLAG
(
SIGNAL_DBM
),

451 
FLAG
(
NEED_DTIM_BEFORE_ASSOC
),

452 
FLAG
(
SPECTRUM_MGMT
),

453 
FLAG
(
AMPDU_AGGREGATION
),

454 
FLAG
(
SUPPORTS_PS
),

455 
FLAG
(
PS_NULLFUNC_STACK
),

456 
FLAG
(
SUPPORTS_DYNAMIC_PS
),

457 
FLAG
(
MFP_CAPABLE
),

458 
FLAG
(
WANT_MONITOR_VIF
),

459 
FLAG
(
NO_AUTO_VIF
),

460 
FLAG
(
SW_CRYPTO_CONTROL
),

461 
FLAG
(
SUPPORT_FAST_XMIT
),

462 
FLAG
(
REPORTS_TX_ACK_STATUS
),

463 
FLAG
(
CONNECTION_MONITOR
),

464 
FLAG
(
QUEUE_CONTROL
),

465 
FLAG
(
SUPPORTS_PER_STA_GTK
),

466 
FLAG
(
AP_LINK_PS
),

467 
FLAG
(
TX_AMPDU_SETUP_IN_HW
),

468 
FLAG
(
SUPPORTS_RC_TABLE
),

469 
FLAG
(
P2P_DEV_ADDR_FOR_INTF
),

470 
FLAG
(
TIMING_BEACON_ONLY
),

471 
FLAG
(
SUPPORTS_HT_CCK_RATES
),

472 
FLAG
(
CHANCTX_STA_CSA
),

473 
FLAG
(
SUPPORTS_CLONED_SKBS
),

474 
FLAG
(
SINGLE_SCAN_ON_ALL_BANDS
),

475 
FLAG
(
TDLS_WIDER_BW
),

476 
FLAG
(
SUPPORTS_AMSDU_IN_AMPDU
),

477 
FLAG
(
BEACON_TX_STATUS
),

478 
FLAG
(
NEEDS_UNIQUE_STA_ADDR
),

479 
FLAG
(
SUPPORTS_REORDERING_BUFFER
),

480 
FLAG
(
USES_RSS
),

481 
FLAG
(
TX_AMSDU
),

482 
FLAG
(
TX_FRAG_LIST
),

483 
FLAG
(
REPORTS_LOW_ACK
),

484 
FLAG
(
SUPPORTS_TX_FRAG
),

485 
FLAG
(
SUPPORTS_TDLS_BUFFER_STA
),

486 
FLAG
(
DEAUTH_NEED_MGD_TX_PREP
),

487 
FLAG
(
DOESNT_SUPPORT_QOS_NDP
),

488 
FLAG
(
BUFF_MMPDU_TXQ
),

489 
FLAG
(
SUPPORTS_VHT_EXT_NSS_BW
),

490 
FLAG
(
STA_MMPDU_TXQ
),

491 
FLAG
(
TX_STATUS_NO_AMPDU_LEN
),

492 
FLAG
(
SUPPORTS_MULTI_BSSID
),

493 
FLAG
(
SUPPORTS_ONLY_HE_MULTI_BSSID
),

494 
FLAG
(
AMPDU_KEYBORDER_SUPPORT
),

495 
FLAG
(
SUPPORTS_TX_ENCAP_OFFLOAD
),

496 
FLAG
(
SUPPORTS_RX_DECAP_OFFLOAD
),

497 
FLAG
(
SUPPORTS_CONC_MON_RX_DECAP
),

498 
FLAG
(
DETECTS_COLOR_COLLISION
),

499 
FLAG
(
MLO_MCAST_MULTI_LINK_TX
),

500 
FLAG
(
DISALLOW_PUNCTURING
),

501 
FLAG
(
HANDLES_QUIET_CSA
),

502 #undeà
FLAG


505 
ssize_t
 
	$hwæags_»ad
(
fe
 *fe, 
__u£r
 *
u£r_buf
,

506 
size_t
 
couÁ
, 
loff_t
 *
µos
)

508 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

509 
size_t
 
bufsz
 = 30 * 
NUM_IEEE80211_HW_FLAGS
;

510 *
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
);

511 *
pos
 = 
buf
, *
’d
 = buà+ 
bufsz
 - 1;

512 
ssize_t
 
rv
;

513 
i
;

515 ià(!
buf
)

516  -
ENOMEM
;

521 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
hw_æag_Çmes
è!ğ
NUM_IEEE80211_HW_FLAGS
);

523 
i
 = 0; i < 
NUM_IEEE80211_HW_FLAGS
; i++) {

524 ià(
	`‹¡_b™
(
i
, 
loÿl
->
hw
.
æags
))

525 
pos
 +ğ
	`sú´štf
Õos, 
’d
 -…os, "%s\n",

526 
hw_æag_Çmes
[
i
]);

529 
rv
 = 
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
, 
buf
, 
	`¡¾’
(buf));

530 
	`kä“
(
buf
);

531  
rv
;

532 
	}
}

534 
ssize_t
 
	$misc_»ad
(
fe
 *fe, 
__u£r
 *
u£r_buf
,

535 
size_t
 
couÁ
, 
loff_t
 *
µos
)

537 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

539 
size_t
 
bufsz
 = 
IEEE80211_MAX_QUEUES
 * 16 + 9;

540 *
buf
;

541 *
pos
, *
’d
;

542 
ssize_t
 
rv
;

543 
i
;

544 
Ê
;

546 
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
);

547 ià(!
buf
)

548  -
ENOMEM
;

550 
pos
 = 
buf
;

551 
’d
 = 
buf
 + 
bufsz
 - 1;

553 
pos
 +ğ
	`sú´štf
Õos, 
’d
 -…os, "pending:\n");

555 
i
 = 0; i < 
IEEE80211_MAX_QUEUES
; i++) {

556 
Ê
 = 
	`skb_queue_Ën
(&
loÿl
->
³ndšg
[
i
]);

557 
pos
 +ğ
	`sú´štf
Õos, 
’d
 -…os, "[%i] %d\n",

558 
i
, 
Ê
);

561 
rv
 = 
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
, 
buf
, 
	`¡¾’
(buf));

562 
	`kä“
(
buf
);

563  
rv
;

564 
	}
}

566 
ssize_t
 
	$queues_»ad
(
fe
 *fe, 
__u£r
 *
u£r_buf
,

567 
size_t
 
couÁ
, 
loff_t
 *
µos
)

569 
›“80211_loÿl
 *
loÿl
 = 
fe
->
´iv©e_d©a
;

570 
æags
;

571 
buf
[
IEEE80211_MAX_QUEUES
 * 20];

572 
q
, 
»s
 = 0;

574 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

575 
q
 = 0; q < 
loÿl
->
hw
.
queues
; q++)

576 
»s
 +ğ
	`¥rštf
(
buf
 +„es, "%02d: %#.8lx/%d\n", 
q
,

577 
loÿl
->
queue_¡İ_»asÚs
[
q
],

578 
	`skb_queue_Ën
(&
loÿl
->
³ndšg
[
q
]));

579 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

581  
	`sim¶e_»ad_äom_bufãr
(
u£r_buf
, 
couÁ
, 
µos
, 
buf
, 
»s
);

582 
	}
}

584 
DEBUGFS_READONLY_FILE_OPS
(
hwæags
);

585 
DEBUGFS_READONLY_FILE_OPS
(
queues
);

586 
DEBUGFS_READONLY_FILE_OPS
(
misc
);

590 
ssize_t
 
	$fÜm©_dev¡©_couÁ”
(
›“80211_loÿl
 *
loÿl
,

591 
__u£r
 *
u£rbuf
,

592 
size_t
 
couÁ
, 
loff_t
 *
µos
,

593 (*
´štv®ue
)(
›“80211_low_Ëv–_¡©s
 *
¡©s
, *
buf
,

594 
buæ’
))

596 
›“80211_low_Ëv–_¡©s
 
¡©s
;

597 
buf
[20];

598 
»s
;

600 
	`why_lock
(
loÿl
->
hw
.
why
);

601 
»s
 = 
	`drv_g‘_¡©s
(
loÿl
, &
¡©s
);

602 
	`why_uÆock
(
loÿl
->
hw
.
why
);

603 ià(
»s
)

604  
»s
;

605 
»s
 = 
	`´štv®ue
(&
¡©s
, 
buf
, (buf));

606  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
»s
);

607 
	}
}

609 
	#DEBUGFS_DEVSTATS_FILE
(
Çme
) \

610 
´št_dev¡©s_
##
	`Çme
(
›“80211_low_Ëv–_¡©s
 *
¡©s
,\

611 *
buf
, 
buæ’
) \

613  
	`sú´štf
(
buf
, 
buæ’
, "%u\n", 
¡©s
->
Çme
); \

615 
ssize_t
 
¡©s_
 ##
Çme
## 
	`_»ad
(
fe
 *file, \

616 
__u£r
 *
u£rbuf
, \

617 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

619  
	`fÜm©_dev¡©_couÁ”
(
fe
->
´iv©e_d©a
, \

620 
u£rbuf
, \

621 
couÁ
, \

622 
µos
, \

623 
´št_dev¡©s_
##
Çme
); \

626 cÚ¡ 
fe_İ”©iÚs
 
¡©s_
 ##
Çme
## 
_İs
 = { \

627 .
»ad
 = 
¡©s_
 ##
Çme
## 
_»ad
, \

628 .
İ’
 = 
sim¶e_İ’
, \

629 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

630 };

	)

632 #ifdeà
CONFIG_MAC80211_DEBUG_COUNTERS


633 
	#DEBUGFS_STATS_ADD
(
Çme
) \

634 
	`debugfs_ü—‹_u32
(#Çme, 0400, 
¡©sd
, &
loÿl
->
Çme
);

	)

636 
	#DEBUGFS_DEVSTATS_ADD
(
Çme
) \

637 
	`debugfs_ü—‹_fe
(#Çme, 0400, 
¡©sd
, 
loÿl
, &
¡©s_
 ##
Çme
## 
_İs
);

	)

639 
DEBUGFS_DEVSTATS_FILE
(
dÙ11ACKFau»CouÁ
);

640 
DEBUGFS_DEVSTATS_FILE
(
dÙ11RTSFau»CouÁ
);

641 
DEBUGFS_DEVSTATS_FILE
(
dÙ11FCSE¼ÜCouÁ
);

642 
DEBUGFS_DEVSTATS_FILE
(
dÙ11RTSSucûssCouÁ
);

644 
	$debugfs_hw_add
(
›“80211_loÿl
 *
loÿl
)

646 
d’Œy
 *
phyd
 = 
loÿl
->
hw
.
why
->
debugfsdœ
;

647 
d’Œy
 *
¡©sd
;

649 ià(!
phyd
)

652 
loÿl
->
debugfs
.
keys
 = 
	`debugfs_ü—‹_dœ
("keys", 
phyd
);

654 
	`DEBUGFS_ADD
(
tÙ®_ps_bufã»d
);

655 
	`DEBUGFS_ADD
(
w•_iv
);

656 
	`DEBUGFS_ADD
(
¿‹_ù¾_®g
);

657 
	`DEBUGFS_ADD
(
queues
);

658 
	`DEBUGFS_ADD
(
misc
);

659 #ifdeà
CONFIG_PM


660 
	`DEBUGFS_ADD_MODE
(
»£t
, 0200);

662 
	`DEBUGFS_ADD
(
hwæags
);

663 
	`DEBUGFS_ADD
(
u£r_pow”
);

664 
	`DEBUGFS_ADD
(
pow”
);

665 
	`DEBUGFS_ADD
(
hw_cÚf
);

666 
	`DEBUGFS_ADD_MODE
(
fÜû_tx_¡©us
, 0600);

667 
	`DEBUGFS_ADD_MODE
(
aql_’abË
, 0600);

668 
	`DEBUGFS_ADD
(
aql_³ndšg
);

669 
	`DEBUGFS_ADD_MODE
(
aqm
, 0600);

671 
	`DEBUGFS_ADD_MODE
(
aœtime_æags
, 0600);

673 
	`DEBUGFS_ADD
(
aql_txq_lim™
);

674 
	`debugfs_ü—‹_u32
("aql_threshold", 0600,

675 
phyd
, &
loÿl
->
aql_th»shŞd
);

677 
¡©sd
 = 
	`debugfs_ü—‹_dœ
("¡©i¡ics", 
phyd
);

679 #ifdeà
CONFIG_MAC80211_DEBUG_COUNTERS


680 
	`DEBUGFS_STATS_ADD
(
dÙ11T¿nsm™‹dF¿gm’tCouÁ
);

681 
	`DEBUGFS_STATS_ADD
(
dÙ11MuÉiÿ¡T¿nsm™‹dF¿meCouÁ
);

682 
	`DEBUGFS_STATS_ADD
(
dÙ11FaedCouÁ
);

683 
	`DEBUGFS_STATS_ADD
(
dÙ11R‘ryCouÁ
);

684 
	`DEBUGFS_STATS_ADD
(
dÙ11MuÉËR‘ryCouÁ
);

685 
	`DEBUGFS_STATS_ADD
(
dÙ11F¿meDu¶iÿ‹CouÁ
);

686 
	`DEBUGFS_STATS_ADD
(
dÙ11ReûivedF¿gm’tCouÁ
);

687 
	`DEBUGFS_STATS_ADD
(
dÙ11MuÉiÿ¡ReûivedF¿meCouÁ
);

688 
	`DEBUGFS_STATS_ADD
(
dÙ11T¿nsm™‹dF¿meCouÁ
);

689 
	`DEBUGFS_STATS_ADD
(
tx_hªdËrs_drİ
);

690 
	`DEBUGFS_STATS_ADD
(
tx_hªdËrs_queued
);

691 
	`DEBUGFS_STATS_ADD
(
tx_hªdËrs_drİ_w•
);

692 
	`DEBUGFS_STATS_ADD
(
tx_hªdËrs_drİ_nÙ_assoc
);

693 
	`DEBUGFS_STATS_ADD
(
tx_hªdËrs_drİ_uÇuth_pÜt
);

694 
	`DEBUGFS_STATS_ADD
(
rx_hªdËrs_drİ
);

695 
	`DEBUGFS_STATS_ADD
(
rx_hªdËrs_queued
);

696 
	`DEBUGFS_STATS_ADD
(
rx_hªdËrs_drİ_nuÎfunc
);

697 
	`DEBUGFS_STATS_ADD
(
rx_hªdËrs_drİ_deäag
);

698 
	`DEBUGFS_STATS_ADD
(
tx_ex·nd_skb_h—d
);

699 
	`DEBUGFS_STATS_ADD
(
tx_ex·nd_skb_h—d_şÚed
);

700 
	`DEBUGFS_STATS_ADD
(
rx_ex·nd_skb_h—d_deäag
);

701 
	`DEBUGFS_STATS_ADD
(
rx_hªdËrs_äagm’ts
);

702 
	`DEBUGFS_STATS_ADD
(
tx_¡©us_drİ
);

704 
	`DEBUGFS_DEVSTATS_ADD
(
dÙ11ACKFau»CouÁ
);

705 
	`DEBUGFS_DEVSTATS_ADD
(
dÙ11RTSFau»CouÁ
);

706 
	`DEBUGFS_DEVSTATS_ADD
(
dÙ11FCSE¼ÜCouÁ
);

707 
	`DEBUGFS_DEVSTATS_ADD
(
dÙ11RTSSucûssCouÁ
);

708 
	}
}

	@debugfs.h

2 #iâdeà
__MAC80211_DEBUGFS_H


3 
	#__MAC80211_DEBUGFS_H


	)

5 
	~"›“80211_i.h
"

7 #ifdeà
CONFIG_MAC80211_DEBUGFS


8 
debugfs_hw_add
(
›“80211_loÿl
 *
loÿl
);

9 
	$__´štf
(4, 5è
	`mac80211_fÜm©_bufãr
(
__u£r
 *
u£rbuf
, 
size_t
 
couÁ
,

10 
loff_t
 *
µos
, *
fmt
, ...);

12 
šlše
 
	$debugfs_hw_add
(
›“80211_loÿl
 *
loÿl
)

14 
	}
}

	@debugfs_key.c

10 
	~<lšux/kobjeù.h
>

11 
	~<lšux/¦ab.h
>

12 
	~"›“80211_i.h
"

13 
	~"key.h
"

14 
	~"debugfs.h
"

15 
	~"debugfs_key.h
"

17 
	#KEY_READ
(
Çme
, 
´İ
, 
fÜm©_¡ršg
) \

18 
ssize_t
 
key_
##
Çme
##
	`_»ad
(
fe
 *file, \

19 
__u£r
 *
u£rbuf
, \

20 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

22 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
; \

23  
	`mac80211_fÜm©_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, \

24 
fÜm©_¡ršg
, 
key
->
´İ
); \

25 }

	)

26 
	#KEY_READ_X
(
Çme
è
	`KEY_READ
Òame,‚ame, "0x%x\n")

	)

28 
	#KEY_OPS
(
Çme
) \

29 cÚ¡ 
fe_İ”©iÚs
 
key_
 ##
Çme
## 
_İs
 = { \

30 .
»ad
 = 
key_
##
Çme
##
_»ad
, \

31 .
İ’
 = 
sim¶e_İ’
, \

32 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

33 }

	)

35 
	#KEY_OPS_W
(
Çme
) \

36 cÚ¡ 
fe_İ”©iÚs
 
key_
 ##
Çme
## 
_İs
 = { \

37 .
»ad
 = 
key_
##
Çme
##
_»ad
, \

38 .
wr™e
 = 
key_
##
Çme
##
_wr™e
, \

39 .
İ’
 = 
sim¶e_İ’
, \

40 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

41 }

	)

43 
	#KEY_FILE
(
Çme
, 
fÜm©
) \

44 
KEY_READ_
##
	`fÜm©
(
Çme
) \

45 
	`KEY_OPS
(
Çme
)

	)

47 
	#KEY_CONF_READ
(
Çme
, 
fÜm©_¡ršg
) \

48 
	`KEY_READ
(
cÚf_
##
Çme
, 
cÚf
.Çme, 
fÜm©_¡ršg
)

	)

49 
	#KEY_CONF_READ_D
(
Çme
è
	`KEY_CONF_READ
Òame, "%d\n")

	)

51 
	#KEY_CONF_OPS
(
Çme
) \

52 cÚ¡ 
fe_İ”©iÚs
 
key_
 ##
Çme
## 
_İs
 = { \

53 .
»ad
 = 
key_cÚf_
##
Çme
##
_»ad
, \

54 .
İ’
 = 
sim¶e_İ’
, \

55 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

56 }

	)

58 
	#KEY_CONF_FILE
(
Çme
, 
fÜm©
) \

59 
KEY_CONF_READ_
##
	`fÜm©
(
Çme
) \

60 
	`KEY_CONF_OPS
(
Çme
)

	)

62 
KEY_CONF_FILE
(
keyËn
, 
D
);

63 
KEY_CONF_FILE
(
keyidx
, 
D
);

64 
KEY_CONF_FILE
(
hw_key_idx
, 
D
);

65 
KEY_FILE
(
æags
, 
X
);

66 
KEY_READ
(
ifšdex
, 
sd©a
->
Çme
, "%s\n");

67 
KEY_OPS
(
ifšdex
);

69 
ssize_t
 
	$key_®gÜ™hm_»ad
(
fe
 *file,

70 
__u£r
 *
u£rbuf
,

71 
size_t
 
couÁ
, 
loff_t
 *
µos
)

73 
buf
[15];

74 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

75 
u32
 
c
 = 
key
->
cÚf
.
ch”
;

77 
	`¥rštf
(
buf
, "%.2x-%.2x-%.2x:%d\n",

78 
c
 >> 24, (c >> 16) & 0xff, (c >> 8) & 0xff, c & 0xff);

79  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
	`¡¾’
(buf));

80 
	}
}

81 
KEY_OPS
(
®gÜ™hm
);

83 
ssize_t
 
	$key_tx_¥ec_wr™e
(
fe
 *fe, cÚ¡ 
__u£r
 *
u£rbuf
,

84 
size_t
 
couÁ
, 
loff_t
 *
µos
)

86 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

87 
u64
 
²
;

88 
»t
;

90 
key
->
cÚf
.
ch”
) {

91 
WLAN_CIPHER_SUITE_WEP40
:

92 
WLAN_CIPHER_SUITE_WEP104
:

93  -
EINVAL
;

94 
WLAN_CIPHER_SUITE_TKIP
:

96  -
EOPNOTSUPP
;

97 
WLAN_CIPHER_SUITE_CCMP
:

98 
WLAN_CIPHER_SUITE_CCMP_256
:

99 
WLAN_CIPHER_SUITE_AES_CMAC
:

100 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

101 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

102 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

103 
WLAN_CIPHER_SUITE_GCMP
:

104 
WLAN_CIPHER_SUITE_GCMP_256
:

105 
»t
 = 
	`k¡¹ou64_äom_u£r
(
u£rbuf
, 
couÁ
, 16, &
²
);

106 ià(
»t
)

107  
»t
;

109 ià(
²
 >= (1ULL << 48))

110  -
ERANGE
;

111 
	`©omic64_£t
(&
key
->
cÚf
.
tx_²
, 
²
);

112  
couÁ
;

116 
	}
}

118 
ssize_t
 
	$key_tx_¥ec_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

119 
size_t
 
couÁ
, 
loff_t
 *
µos
)

121 
u64
 
²
;

122 
buf
[20];

123 
Ën
;

124 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

126 
key
->
cÚf
.
ch”
) {

127 
WLAN_CIPHER_SUITE_WEP40
:

128 
WLAN_CIPHER_SUITE_WEP104
:

129 
Ën
 = 
	`sú´štf
(
buf
, (buf), "\n");

131 
WLAN_CIPHER_SUITE_TKIP
:

132 
²
 = 
	`©omic64_»ad
(&
key
->
cÚf
.
tx_²
);

133 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%08x %04x\n",

134 
	`TKIP_PN_TO_IV32
(
²
),

135 
	`TKIP_PN_TO_IV16
(
²
));

137 
WLAN_CIPHER_SUITE_CCMP
:

138 
WLAN_CIPHER_SUITE_CCMP_256
:

139 
WLAN_CIPHER_SUITE_AES_CMAC
:

140 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

141 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

142 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

143 
WLAN_CIPHER_SUITE_GCMP
:

144 
WLAN_CIPHER_SUITE_GCMP_256
:

145 
²
 = 
	`©omic64_»ad
(&
key
->
cÚf
.
tx_²
);

146 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%02x%02x%02x%02x%02x%02x\n",

147 (
u8
)(
²
 >> 40), (u8)(pn >> 32), (u8)(pn >> 24),

148 (
u8
)(
²
 >> 16), (u8)(pn >> 8), (u8)pn);

153  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
Ën
);

154 
	}
}

155 
KEY_OPS_W
(
tx_¥ec
);

157 
ssize_t
 
	$key_rx_¥ec_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

158 
size_t
 
couÁ
, 
loff_t
 *
µos
)

160 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

161 
buf
[14*
IEEE80211_NUM_TIDS
+1], *
p
 = buf;

162 
i
, 
Ën
;

163 cÚ¡ 
u8
 *
½n
;

165 
key
->
cÚf
.
ch”
) {

166 
WLAN_CIPHER_SUITE_WEP40
:

167 
WLAN_CIPHER_SUITE_WEP104
:

168 
Ën
 = 
	`sú´štf
(
buf
, (buf), "\n");

170 
WLAN_CIPHER_SUITE_TKIP
:

171 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

172 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p,

174 
key
->
u
.
tk
.
rx
[
i
].
iv32
,

175 
key
->
u
.
tk
.
rx
[
i
].
iv16
);

176 
Ën
 = 
p
 - 
buf
;

178 
WLAN_CIPHER_SUITE_CCMP
:

179 
WLAN_CIPHER_SUITE_CCMP_256
:

180 
i
 = 0; i < 
IEEE80211_NUM_TIDS
 + 1; i++) {

181 
½n
 = 
key
->
u
.
ccmp
.
rx_²
[
i
];

182 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p,

184 
½n
[0],„pn[1],„pn[2],

185 
½n
[3],„pn[4],„pn[5]);

187 
Ën
 = 
p
 - 
buf
;

189 
WLAN_CIPHER_SUITE_AES_CMAC
:

190 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

191 
½n
 = 
key
->
u
.
«s_cmac
.
rx_²
;

192 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p,

194 
½n
[0],„pn[1],„pn[2],

195 
½n
[3],„pn[4],„pn[5]);

196 
Ën
 = 
p
 - 
buf
;

198 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

199 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

200 
½n
 = 
key
->
u
.
«s_gmac
.
rx_²
;

201 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p,

203 
½n
[0],„pn[1],„pn[2],

204 
½n
[3],„pn[4],„pn[5]);

205 
Ën
 = 
p
 - 
buf
;

207 
WLAN_CIPHER_SUITE_GCMP
:

208 
WLAN_CIPHER_SUITE_GCMP_256
:

209 
i
 = 0; i < 
IEEE80211_NUM_TIDS
 + 1; i++) {

210 
½n
 = 
key
->
u
.
gcmp
.
rx_²
[
i
];

211 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p,

213 
½n
[0],„pn[1],„pn[2],

214 
½n
[3],„pn[4],„pn[5]);

216 
Ën
 = 
p
 - 
buf
;

221  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
Ën
);

222 
	}
}

223 
KEY_OPS
(
rx_¥ec
);

225 
ssize_t
 
	$key_»¶ays_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

226 
size_t
 
couÁ
, 
loff_t
 *
µos
)

228 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

229 
buf
[20];

230 
Ën
;

232 
key
->
cÚf
.
ch”
) {

233 
WLAN_CIPHER_SUITE_CCMP
:

234 
WLAN_CIPHER_SUITE_CCMP_256
:

235 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n", 
key
->
u
.
ccmp
.
»¶ays
);

237 
WLAN_CIPHER_SUITE_AES_CMAC
:

238 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

239 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n",

240 
key
->
u
.
«s_cmac
.
»¶ays
);

242 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

243 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

244 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n",

245 
key
->
u
.
«s_gmac
.
»¶ays
);

247 
WLAN_CIPHER_SUITE_GCMP
:

248 
WLAN_CIPHER_SUITE_GCMP_256
:

249 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n", 
key
->
u
.
gcmp
.
»¶ays
);

254  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
Ën
);

255 
	}
}

256 
KEY_OPS
(
»¶ays
);

258 
ssize_t
 
	$key_icv”rÜs_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

259 
size_t
 
couÁ
, 
loff_t
 *
µos
)

261 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

262 
buf
[20];

263 
Ën
;

265 
key
->
cÚf
.
ch”
) {

266 
WLAN_CIPHER_SUITE_AES_CMAC
:

267 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

268 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n",

269 
key
->
u
.
«s_cmac
.
icv”rÜs
);

271 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

272 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

273 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n",

274 
key
->
u
.
«s_gmac
.
icv”rÜs
);

279  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
Ën
);

280 
	}
}

281 
KEY_OPS
(
icv”rÜs
);

283 
ssize_t
 
	$key_mic_çu»s_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

284 
size_t
 
couÁ
, 
loff_t
 *
µos
)

286 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

287 
buf
[20];

288 
Ën
;

290 ià(
key
->
cÚf
.
ch”
 !ğ
WLAN_CIPHER_SUITE_TKIP
)

291  -
EINVAL
;

293 
Ën
 = 
	`sú´štf
(
buf
, (buf), "%u\n", 
key
->
u
.
tk
.
mic_çu»s
);

295  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
Ën
);

296 
	}
}

297 
KEY_OPS
(
mic_çu»s
);

299 
ssize_t
 
	$key_key_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

300 
size_t
 
couÁ
, 
loff_t
 *
µos
)

302 
›“80211_key
 *
key
 = 
fe
->
´iv©e_d©a
;

303 
i
, 
bufsize
 = 2 * 
key
->
cÚf
.
keyËn
 + 2;

304 *
buf
 = 
	`km®loc
(
bufsize
, 
GFP_KERNEL
);

305 *
p
 = 
buf
;

306 
ssize_t
 
»s
;

308 ià(!
buf
)

309  -
ENOMEM
;

311 
i
 = 0; i < 
key
->
cÚf
.
keyËn
; i++)

312 
p
 +ğ
	`sú´štf
Õ, 
bufsize
 + 
buf
 -…, "%02x", 
key
->
cÚf
.key[
i
]);

313 
p
 +ğ
	`sú´štf
Õ, 
bufsize
+
buf
-p, "\n");

314 
»s
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

315 
	`kä“
(
buf
);

316  
»s
;

317 
	}
}

318 
KEY_OPS
(
key
);

320 
	#DEBUGFS_ADD
(
Çme
) \

321 
	`debugfs_ü—‹_fe
(#Çme, 0400, 
key
->
debugfs
.
dœ
, \

322 
key
, &
key_
##
Çme
##
_İs
)

	)

323 
	#DEBUGFS_ADD_W
(
Çme
) \

324 
	`debugfs_ü—‹_fe
(#Çme, 0600, 
key
->
debugfs
.
dœ
, \

325 
key
, &
key_
##
Çme
##
_İs
);

	)

327 
	$›“80211_debugfs_key_add
(
›“80211_key
 *
key
)

329 
keycouÁ
;

330 
buf
[100];

331 
¡a_šfo
 *
¡a
;

333 ià(!
key
->
loÿl
->
debugfs
.
keys
)

336 
	`¥rštf
(
buf
, "%d", 
keycouÁ
);

337 
key
->
debugfs
.
út
 = 
keycouÁ
;

338 
keycouÁ
++;

339 
key
->
debugfs
.
dœ
 = 
	`debugfs_ü—‹_dœ
(
buf
,

340 
key
->
loÿl
->
debugfs
.
keys
);

342 
¡a
 = 
key
->sta;

343 ià(
¡a
) {

344 
	`¥rštf
(
buf
, "../../netdev:%s/stations/%pM",

345 
¡a
->
sd©a
->
Çme
, s->¡a.
addr
);

346 
key
->
debugfs
.
¡®šk
 =

347 
	`debugfs_ü—‹_symlšk
("¡©iÚ", 
key
->
debugfs
.
dœ
, 
buf
);

350 
	`DEBUGFS_ADD
(
keyËn
);

351 
	`DEBUGFS_ADD
(
æags
);

352 
	`DEBUGFS_ADD
(
keyidx
);

353 
	`DEBUGFS_ADD
(
hw_key_idx
);

354 
	`DEBUGFS_ADD
(
®gÜ™hm
);

355 
	`DEBUGFS_ADD_W
(
tx_¥ec
);

356 
	`DEBUGFS_ADD
(
rx_¥ec
);

357 
	`DEBUGFS_ADD
(
»¶ays
);

358 
	`DEBUGFS_ADD
(
icv”rÜs
);

359 
	`DEBUGFS_ADD
(
mic_çu»s
);

360 
	`DEBUGFS_ADD
(
key
);

361 
	`DEBUGFS_ADD
(
ifšdex
);

362 
	}
};

364 
	$›“80211_debugfs_key_»move
(
›“80211_key
 *
key
)

366 ià(!
key
)

369 
	`debugfs_»move_»cursive
(
key
->
debugfs
.
dœ
);

370 
key
->
debugfs
.
dœ
 = 
NULL
;

371 
	}
}

373 
	$›“80211_debugfs_key_upd©e_deçuÉ
(
›“80211_sub_if_d©a
 *
sd©a
)

375 
buf
[50];

376 
›“80211_key
 *
key
;

378 ià(!
sd©a
->
vif
.
debugfs_dœ
)

381 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

383 
	`debugfs_»move
(
sd©a
->
debugfs
.
deçuÉ_uniÿ¡_key
);

384 
sd©a
->
debugfs
.
deçuÉ_uniÿ¡_key
 = 
NULL
;

386 ià(
sd©a
->
deçuÉ_uniÿ¡_key
) {

387 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

388 
sd©a
->
deçuÉ_uniÿ¡_key
);

389 
	`¥rštf
(
buf
, "../keys/%d", 
key
->
debugfs
.
út
);

390 
sd©a
->
debugfs
.
deçuÉ_uniÿ¡_key
 =

391 
	`debugfs_ü—‹_symlšk
("default_unicast_key",

392 
sd©a
->
vif
.
debugfs_dœ
, 
buf
);

395 
	`debugfs_»move
(
sd©a
->
debugfs
.
deçuÉ_muÉiÿ¡_key
);

396 
sd©a
->
debugfs
.
deçuÉ_muÉiÿ¡_key
 = 
NULL
;

398 ià(
sd©a
->
deæšk
.
deçuÉ_muÉiÿ¡_key
) {

399 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

400 
sd©a
->
deæšk
.
deçuÉ_muÉiÿ¡_key
);

401 
	`¥rštf
(
buf
, "../keys/%d", 
key
->
debugfs
.
út
);

402 
sd©a
->
debugfs
.
deçuÉ_muÉiÿ¡_key
 =

403 
	`debugfs_ü—‹_symlšk
("default_multicast_key",

404 
sd©a
->
vif
.
debugfs_dœ
, 
buf
);

406 
	}
}

408 
	$›“80211_debugfs_key_add_mgmt_deçuÉ
(
›“80211_sub_if_d©a
 *
sd©a
)

410 
buf
[50];

411 
›“80211_key
 *
key
;

413 ià(!
sd©a
->
vif
.
debugfs_dœ
)

416 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

417 
sd©a
->
deæšk
.
deçuÉ_mgmt_key
);

418 ià(
key
) {

419 
	`¥rštf
(
buf
, "../keys/%d", 
key
->
debugfs
.
út
);

420 
sd©a
->
debugfs
.
deçuÉ_mgmt_key
 =

421 
	`debugfs_ü—‹_symlšk
("default_mgmt_key",

422 
sd©a
->
vif
.
debugfs_dœ
, 
buf
);

424 
	`›“80211_debugfs_key_»move_mgmt_deçuÉ
(
sd©a
);

425 
	}
}

427 
	$›“80211_debugfs_key_»move_mgmt_deçuÉ
(
›“80211_sub_if_d©a
 *
sd©a
)

429 ià(!
sd©a
)

432 
	`debugfs_»move
(
sd©a
->
debugfs
.
deçuÉ_mgmt_key
);

433 
sd©a
->
debugfs
.
deçuÉ_mgmt_key
 = 
NULL
;

434 
	}
}

437 
	$›“80211_debugfs_key_add_b—cÚ_deçuÉ
(
›“80211_sub_if_d©a
 *
sd©a
)

439 
buf
[50];

440 
›“80211_key
 *
key
;

442 ià(!
sd©a
->
vif
.
debugfs_dœ
)

445 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

446 
sd©a
->
deæšk
.
deçuÉ_b—cÚ_key
);

447 ià(
key
) {

448 
	`¥rštf
(
buf
, "../keys/%d", 
key
->
debugfs
.
út
);

449 
sd©a
->
debugfs
.
deçuÉ_b—cÚ_key
 =

450 
	`debugfs_ü—‹_symlšk
("default_beacon_key",

451 
sd©a
->
vif
.
debugfs_dœ
, 
buf
);

453 
	`›“80211_debugfs_key_»move_b—cÚ_deçuÉ
(
sd©a
);

455 
	}
}

458 
	$›“80211_debugfs_key_»move_b—cÚ_deçuÉ
(
›“80211_sub_if_d©a
 *
sd©a
)

460 ià(!
sd©a
)

463 
	`debugfs_»move
(
sd©a
->
debugfs
.
deçuÉ_b—cÚ_key
);

464 
sd©a
->
debugfs
.
deçuÉ_b—cÚ_key
 = 
NULL
;

465 
	}
}

467 
	$›“80211_debugfs_key_¡a_d–
(
›“80211_key
 *
key
,

468 
¡a_šfo
 *
¡a
)

470 
	`debugfs_»move
(
key
->
debugfs
.
¡®šk
);

471 
key
->
debugfs
.
¡®šk
 = 
NULL
;

472 
	}
}

	@debugfs_key.h

2 #iâdeà
__MAC80211_DEBUGFS_KEY_H


3 
	#__MAC80211_DEBUGFS_KEY_H


	)

5 #ifdeà
CONFIG_MAC80211_DEBUGFS


6 
›“80211_debugfs_key_add
(
›“80211_key
 *
key
);

7 
›“80211_debugfs_key_»move
(
›“80211_key
 *
key
);

8 
›“80211_debugfs_key_upd©e_deçuÉ
(
›“80211_sub_if_d©a
 *
sd©a
);

9 
›“80211_debugfs_key_add_mgmt_deçuÉ
(

10 
›“80211_sub_if_d©a
 *
sd©a
);

11 
›“80211_debugfs_key_»move_mgmt_deçuÉ
(

12 
›“80211_sub_if_d©a
 *
sd©a
);

13 
›“80211_debugfs_key_add_b—cÚ_deçuÉ
(

14 
›“80211_sub_if_d©a
 *
sd©a
);

15 
›“80211_debugfs_key_»move_b—cÚ_deçuÉ
(

16 
›“80211_sub_if_d©a
 *
sd©a
);

17 
›“80211_debugfs_key_¡a_d–
(
›“80211_key
 *
key
,

18 
¡a_šfo
 *
¡a
);

20 
šlše
 
	$›“80211_debugfs_key_add
(
›“80211_key
 *
key
)

21 {
	}
}

22 
šlše
 
	$›“80211_debugfs_key_»move
(
›“80211_key
 *
key
)

23 {
	}
}

24 
šlše
 
	$›“80211_debugfs_key_upd©e_deçuÉ
(

25 
›“80211_sub_if_d©a
 *
sd©a
)

26 {
	}
}

27 
šlše
 
	$›“80211_debugfs_key_add_mgmt_deçuÉ
(

28 
›“80211_sub_if_d©a
 *
sd©a
)

29 {
	}
}

30 
šlše
 
	$›“80211_debugfs_key_»move_mgmt_deçuÉ
(

31 
›“80211_sub_if_d©a
 *
sd©a
)

32 {
	}
}

33 
šlše
 
	$›“80211_debugfs_key_add_b—cÚ_deçuÉ
(

34 
›“80211_sub_if_d©a
 *
sd©a
)

35 {
	}
}

36 
šlše
 
	$›“80211_debugfs_key_»move_b—cÚ_deçuÉ
(

37 
›“80211_sub_if_d©a
 *
sd©a
)

38 {
	}
}

39 
šlše
 
	$›“80211_debugfs_key_¡a_d–
(
›“80211_key
 *
key
,

40 
¡a_šfo
 *
¡a
)

41 {
	}
}

	@debugfs_netdev.c

8 
	~<lšux/k”Ãl.h
>

9 
	~<lšux/deviû.h
>

10 
	~<lšux/if.h
>

11 
	~<lšux/if_‘h”.h
>

12 
	~<lšux/š‹¼u±.h
>

13 
	~<lšux/Ãtdeviû.h
>

14 
	~<lšux/¹Ãšk.h
>

15 
	~<lšux/¦ab.h
>

16 
	~<lšux/nÙif›r.h
>

17 
	~<Ãt/mac80211.h
>

18 
	~<Ãt/cfg80211.h
>

19 
	~"›“80211_i.h
"

20 
	~"¿‹.h
"

21 
	~"debugfs.h
"

22 
	~"debugfs_Ãtdev.h
"

23 
	~"driv”-İs.h
"

25 
	s›“80211_if_»ad_sd©a_d©a
 {

26 
ssize_t
 (*
fÜm©
)(cÚ¡ 
	m›“80211_sub_if_d©a
 *, *, );

27 
›“80211_sub_if_d©a
 *
	msd©a
;

30 
ssize_t
 
	$›“80211_if_»ad_sd©a_hªdËr
(
why
 *wiphy,

31 
fe
 *file,

32 *
buf
,

33 
size_t
 
bufsize
,

34 *
d©a
)

36 
›“80211_if_»ad_sd©a_d©a
 *
d
 = 
d©a
;

38  
d
->
	`fÜm©
(d->
sd©a
, 
buf
, 
bufsize
);

39 
	}
}

41 
ssize_t
 
	$›“80211_if_»ad_sd©a
(

42 
fe
 *file,

43 
__u£r
 *
u£rbuf
,

44 
size_t
 
couÁ
, 
loff_t
 *
µos
,

45 
	$ssize_t
 (*
fÜm©
)(cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *, ))

47 
›“80211_sub_if_d©a
 *
sd©a
 = 
fe
->
´iv©e_d©a
;

48 
›“80211_if_»ad_sd©a_d©a
 
d©a
 = {

49 .
fÜm©
 = format,

50 .
sd©a
 = sdata,

52 
buf
[200];

54  
	`why_locked_debugfs_»ad
(
sd©a
->
loÿl
->
hw
.
why
,

55 
fe
, 
buf
, (buf),

56 
u£rbuf
, 
couÁ
, 
µos
,

57 
›“80211_if_»ad_sd©a_hªdËr
,

58 &
d©a
);

59 
	}
}

61 
	s›“80211_if_wr™e_sd©a_d©a
 {

62 
ssize_t
 (*
wr™e
)(
	m›“80211_sub_if_d©a
 *, const *, );

63 
›“80211_sub_if_d©a
 *
	msd©a
;

66 
ssize_t
 
	$›“80211_if_wr™e_sd©a_hªdËr
(
why
 *wiphy,

67 
fe
 *file,

68 *
buf
,

69 
size_t
 
couÁ
,

70 *
d©a
)

72 
›“80211_if_wr™e_sd©a_d©a
 *
d
 = 
d©a
;

74  
d
->
	`wr™e
(d->
sd©a
, 
buf
, 
couÁ
);

75 
	}
}

77 
ssize_t
 
	$›“80211_if_wr™e_sd©a
(

78 
fe
 *file,

79 cÚ¡ 
__u£r
 *
u£rbuf
,

80 
size_t
 
couÁ
, 
loff_t
 *
µos
,

81 
	$ssize_t
 (*
wr™e
)(
›“80211_sub_if_d©a
 *
sd©a
, const *, ))

83 
›“80211_sub_if_d©a
 *
sd©a
 = 
fe
->
´iv©e_d©a
;

84 
›“80211_if_wr™e_sd©a_d©a
 
d©a
 = {

85 .
wr™e
 = write,

86 .
sd©a
 = sdata,

88 
buf
[64];

90  
	`why_locked_debugfs_wr™e
(
sd©a
->
loÿl
->
hw
.
why
,

91 
fe
, 
buf
, (buf),

92 
u£rbuf
, 
couÁ
,

93 
›“80211_if_wr™e_sd©a_hªdËr
,

94 &
d©a
);

95 
	}
}

97 
	s›“80211_if_»ad_lšk_d©a
 {

98 
ssize_t
 (*
fÜm©
)(cÚ¡ 
	m›“80211_lšk_d©a
 *, *, );

99 
›“80211_lšk_d©a
 *
	mlšk
;

102 
ssize_t
 
	$›“80211_if_»ad_lšk_hªdËr
(
why
 *wiphy,

103 
fe
 *file,

104 *
buf
,

105 
size_t
 
bufsize
,

106 *
d©a
)

108 
›“80211_if_»ad_lšk_d©a
 *
d
 = 
d©a
;

110  
d
->
	`fÜm©
(d->
lšk
, 
buf
, 
bufsize
);

111 
	}
}

113 
ssize_t
 
	$›“80211_if_»ad_lšk
(

114 
fe
 *file,

115 
__u£r
 *
u£rbuf
,

116 
size_t
 
couÁ
, 
loff_t
 *
µos
,

117 
	$ssize_t
 (*
fÜm©
)(cÚ¡ 
›“80211_lšk_d©a
 *
lšk
, *, ))

119 
›“80211_lšk_d©a
 *
lšk
 = 
fe
->
´iv©e_d©a
;

120 
›“80211_if_»ad_lšk_d©a
 
d©a
 = {

121 .
fÜm©
 = format,

122 .
lšk
 =†ink,

124 
buf
[200];

126  
	`why_locked_debugfs_»ad
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
,

127 
fe
, 
buf
, (buf),

128 
u£rbuf
, 
couÁ
, 
µos
,

129 
›“80211_if_»ad_lšk_hªdËr
,

130 &
d©a
);

131 
	}
}

133 
	s›“80211_if_wr™e_lšk_d©a
 {

134 
ssize_t
 (*
wr™e
)(
	m›“80211_lšk_d©a
 *, const *, );

135 
›“80211_lšk_d©a
 *
	mlšk
;

138 
ssize_t
 
	$›“80211_if_wr™e_lšk_hªdËr
(
why
 *wiphy,

139 
fe
 *file,

140 *
buf
,

141 
size_t
 
couÁ
,

142 *
d©a
)

144 
›“80211_if_wr™e_sd©a_d©a
 *
d
 = 
d©a
;

146  
d
->
	`wr™e
(d->
sd©a
, 
buf
, 
couÁ
);

147 
	}
}

149 
ssize_t
 
	$›“80211_if_wr™e_lšk
(

150 
fe
 *file,

151 cÚ¡ 
__u£r
 *
u£rbuf
,

152 
size_t
 
couÁ
, 
loff_t
 *
µos
,

153 
	$ssize_t
 (*
wr™e
)(
›“80211_lšk_d©a
 *
lšk
, const *, ))

155 
›“80211_lšk_d©a
 *
lšk
 = 
fe
->
´iv©e_d©a
;

156 
›“80211_if_wr™e_lšk_d©a
 
d©a
 = {

157 .
wr™e
 = write,

158 .
lšk
 =†ink,

160 
buf
[64];

162  
	`why_locked_debugfs_wr™e
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
,

163 
fe
, 
buf
, (buf),

164 
u£rbuf
, 
couÁ
,

165 
›“80211_if_wr™e_lšk_hªdËr
,

166 &
d©a
);

167 
	}
}

169 
	#IEEE80211_IF_FMT
(
Çme
, 
ty³
, 
f›ld
, 
fÜm©_¡ršg
) \

170 
ssize_t
 
›“80211_if_fmt_
##
	`Çme
( \

171 cÚ¡ 
ty³
 *
d©a
, *
buf
, \

172 
buæ’
) \

174  
	`sú´štf
(
buf
, 
buæ’
, 
fÜm©_¡ršg
, 
d©a
->
f›ld
); \

175 }

	)

176 
	#IEEE80211_IF_FMT_DEC
(
Çme
, 
ty³
, 
f›ld
) \

177 
	`IEEE80211_IF_FMT
(
Çme
, 
ty³
, 
f›ld
, "%d\n")

	)

178 
	#IEEE80211_IF_FMT_HEX
(
Çme
, 
ty³
, 
f›ld
) \

179 
	`IEEE80211_IF_FMT
(
Çme
, 
ty³
, 
f›ld
, "%#x\n")

	)

180 
	#IEEE80211_IF_FMT_LHEX
(
Çme
, 
ty³
, 
f›ld
) \

181 
	`IEEE80211_IF_FMT
(
Çme
, 
ty³
, 
f›ld
, "%#lx\n")

	)

183 
	#IEEE80211_IF_FMT_HEXARRAY
(
Çme
, 
ty³
, 
f›ld
) \

184 
ssize_t
 
›“80211_if_fmt_
##
	`Çme
( \

185 cÚ¡ 
ty³
 *
d©a
, \

186 *
buf
, 
buæ’
) \

188 *
p
 = 
buf
; \

189 
i
; \

190 
i
 = 0; i < (
d©a
->
f›ld
); i++) { \

191 
p
 +ğ
	`sú´štf
Õ, 
buæ’
 + 
buf
 -…, "%.2x ", \

192 
d©a
->
f›ld
[
i
]); \

194 
p
 +ğ
	`sú´štf
Õ, 
buæ’
 + 
buf
 -…, "\n"); \

195  
p
 - 
buf
; \

196 }

	)

198 
	#IEEE80211_IF_FMT_ATOMIC
(
Çme
, 
ty³
, 
f›ld
) \

199 
ssize_t
 
›“80211_if_fmt_
##
	`Çme
( \

200 cÚ¡ 
ty³
 *
d©a
, \

201 *
buf
, 
buæ’
) \

203  
	`sú´štf
(
buf
, 
buæ’
, "%d\n", 
	`©omic_»ad
(&
d©a
->
f›ld
));\

204 }

	)

206 
	#IEEE80211_IF_FMT_MAC
(
Çme
, 
ty³
, 
f›ld
) \

207 
ssize_t
 
›“80211_if_fmt_
##
	`Çme
( \

208 cÚ¡ 
ty³
 *
d©a
, *
buf
, \

209 
buæ’
) \

211  
	`sú´štf
(
buf
, 
buæ’
, "%pM\n", 
d©a
->
f›ld
); \

212 }

	)

214 
	#IEEE80211_IF_FMT_JIFFIES_TO_MS
(
Çme
, 
ty³
, 
f›ld
) \

215 
ssize_t
 
›“80211_if_fmt_
##
	`Çme
( \

216 cÚ¡ 
ty³
 *
d©a
, \

217 *
buf
, 
buæ’
) \

219  
	`sú´štf
(
buf
, 
buæ’
, "%d\n", \

220 
	`jiff›s_to_m£cs
(
d©a
->
f›ld
)); \

221 }

	)

223 
	#_IEEE80211_IF_FILE_OPS
(
Çme
, 
_»ad
, 
_wr™e
) \

224 cÚ¡ 
fe_İ”©iÚs
 
Çme
##
_İs
 = { \

225 .
»ad
 = (
_»ad
), \

226 .
wr™e
 = (
_wr™e
), \

227 .
İ’
 = 
sim¶e_İ’
, \

228 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

229 }

	)

231 
	#_IEEE80211_IF_FILE_R_FN
(
Çme
) \

232 
ssize_t
 
›“80211_if_»ad_
##
	`Çme
(
fe
 *file, \

233 
__u£r
 *
u£rbuf
, \

234 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

236  
	`›“80211_if_»ad_sd©a
(
fe
, \

237 
u£rbuf
, 
couÁ
, 
µos
, \

238 
›“80211_if_fmt_
##
Çme
); \

239 }

	)

241 
	#_IEEE80211_IF_FILE_W_FN
(
Çme
) \

242 
ssize_t
 
›“80211_if_wr™e_
##
	`Çme
(
fe
 *file, \

243 cÚ¡ 
__u£r
 *
u£rbuf
, \

244 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

246  
	`›“80211_if_wr™e_sd©a
(
fe
, 
u£rbuf
, \

247 
couÁ
, 
µos
, \

248 
›“80211_if_·r£_
##
Çme
); \

249 }

	)

251 
	#IEEE80211_IF_FILE_R
(
Çme
) \

252 
	`_IEEE80211_IF_FILE_R_FN
(
Çme
) \

253 
	`_IEEE80211_IF_FILE_OPS
(
Çme
, 
›“80211_if_»ad_
##Çme, 
NULL
)

	)

255 
	#IEEE80211_IF_FILE_W
(
Çme
) \

256 
	`_IEEE80211_IF_FILE_W_FN
(
Çme
) \

257 
	`_IEEE80211_IF_FILE_OPS
(
Çme
, 
NULL
, 
›“80211_if_wr™e_
##Çme)

	)

259 
	#IEEE80211_IF_FILE_RW
(
Çme
) \

260 
	`_IEEE80211_IF_FILE_R_FN
(
Çme
) \

261 
	`_IEEE80211_IF_FILE_W_FN
(
Çme
) \

262 
	`_IEEE80211_IF_FILE_OPS
(
Çme
, 
›“80211_if_»ad_
##name, \

263 
›“80211_if_wr™e_
##
Çme
)

	)

265 
	#IEEE80211_IF_FILE
(
Çme
, 
f›ld
, 
fÜm©
) \

266 
IEEE80211_IF_FMT_
##
	`fÜm©
(
Çme
, 
›“80211_sub_if_d©a
, 
f›ld
) \

267 
	`IEEE80211_IF_FILE_R
(
Çme
)

	)

269 
	#_IEEE80211_IF_LINK_R_FN
(
Çme
) \

270 
ssize_t
 
›“80211_if_»ad_
##
	`Çme
(
fe
 *file, \

271 
__u£r
 *
u£rbuf
, \

272 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

274  
	`›“80211_if_»ad_lšk
(
fe
, \

275 
u£rbuf
, 
couÁ
, 
µos
, \

276 
›“80211_if_fmt_
##
Çme
); \

277 }

	)

279 
	#_IEEE80211_IF_LINK_W_FN
(
Çme
) \

280 
ssize_t
 
›“80211_if_wr™e_
##
	`Çme
(
fe
 *file, \

281 cÚ¡ 
__u£r
 *
u£rbuf
, \

282 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

284  
	`›“80211_if_wr™e_lšk
(
fe
, 
u£rbuf
, \

285 
couÁ
, 
µos
, \

286 
›“80211_if_·r£_
##
Çme
); \

287 }

	)

289 
	#IEEE80211_IF_LINK_FILE_R
(
Çme
) \

290 
	`_IEEE80211_IF_LINK_R_FN
(
Çme
) \

291 
	`_IEEE80211_IF_FILE_OPS
(
lšk_
##
Çme
, 
›“80211_if_»ad_
##Çme, 
NULL
)

	)

293 
	#IEEE80211_IF_LINK_FILE_W
(
Çme
) \

294 
	`_IEEE80211_IF_LINK_W_FN
(
Çme
) \

295 
	`_IEEE80211_IF_FILE_OPS
(
lšk_
##
Çme
, 
NULL
, 
›“80211_if_wr™e_
##Çme)

	)

297 
	#IEEE80211_IF_LINK_FILE_RW
(
Çme
) \

298 
	`_IEEE80211_IF_LINK_R_FN
(
Çme
) \

299 
	`_IEEE80211_IF_LINK_W_FN
(
Çme
) \

300 
	`_IEEE80211_IF_FILE_OPS
(
lšk_
##
Çme
, 
›“80211_if_»ad_
##name, \

301 
›“80211_if_wr™e_
##
Çme
)

	)

303 
	#IEEE80211_IF_LINK_FILE
(
Çme
, 
f›ld
, 
fÜm©
) \

304 
IEEE80211_IF_FMT_
##
	`fÜm©
(
Çme
, 
›“80211_lšk_d©a
, 
f›ld
) \

305 
	`IEEE80211_IF_LINK_FILE_R
(
Çme
)

	)

308 
IEEE80211_IF_FILE
(
rc_¿‹idx_mask_2ghz
, 
rc_¿‹idx_mask
[
NL80211_BAND_2GHZ
],

309 
HEX
);

310 
IEEE80211_IF_FILE
(
rc_¿‹idx_mask_5ghz
, 
rc_¿‹idx_mask
[
NL80211_BAND_5GHZ
],

311 
HEX
);

312 
IEEE80211_IF_FILE
(
rc_¿‹idx_mcs_mask_2ghz
,

313 
rc_¿‹idx_mcs_mask
[
NL80211_BAND_2GHZ
], 
HEXARRAY
);

314 
IEEE80211_IF_FILE
(
rc_¿‹idx_mcs_mask_5ghz
,

315 
rc_¿‹idx_mcs_mask
[
NL80211_BAND_5GHZ
], 
HEXARRAY
);

317 
ssize_t
 
	$›“80211_if_fmt_rc_¿‹idx_vht_mcs_mask_2ghz
(

318 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
,

319 *
buf
, 
buæ’
)

321 
i
, 
Ën
 = 0;

322 cÚ¡ 
u16
 *
mask
 = 
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
NL80211_BAND_2GHZ
];

324 
i
 = 0; i < 
NL80211_VHT_NSS_MAX
; i++)

325 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†’, "%04x ", 
mask
[
i
]);

326 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†en, "\n");

328  
Ën
;

329 
	}
}

331 
IEEE80211_IF_FILE_R
(
rc_¿‹idx_vht_mcs_mask_2ghz
);

333 
ssize_t
 
	$›“80211_if_fmt_rc_¿‹idx_vht_mcs_mask_5ghz
(

334 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
,

335 *
buf
, 
buæ’
)

337 
i
, 
Ën
 = 0;

338 cÚ¡ 
u16
 *
mask
 = 
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
NL80211_BAND_5GHZ
];

340 
i
 = 0; i < 
NL80211_VHT_NSS_MAX
; i++)

341 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†’, "%04x ", 
mask
[
i
]);

342 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†en, "\n");

344  
Ën
;

345 
	}
}

347 
IEEE80211_IF_FILE_R
(
rc_¿‹idx_vht_mcs_mask_5ghz
);

349 
IEEE80211_IF_FILE
(
æags
, fÏgs, 
HEX
);

350 
IEEE80211_IF_FILE
(
¡©e
, s‹, 
LHEX
);

351 
IEEE80211_IF_LINK_FILE
(
txpow”
, 
cÚf
->txpow”, 
DEC
);

352 
IEEE80211_IF_LINK_FILE
(
­_pow”_Ëv–
,‡p_pow”_Ëv–, 
DEC
);

353 
IEEE80211_IF_LINK_FILE
(
u£r_pow”_Ëv–
, u£r_pow”_Ëv–, 
DEC
);

355 
ssize_t


356 
	$›“80211_if_fmt_hw_queues
(cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
,

357 *
buf
, 
buæ’
)

359 
Ën
;

361 
Ën
 = 
	`sú´štf
(
buf
, 
buæ’
, "AC queues: VO:%d VI:%d BE:%d BK:%d\n",

362 
sd©a
->
vif
.
hw_queue
[
IEEE80211_AC_VO
],

363 
sd©a
->
vif
.
hw_queue
[
IEEE80211_AC_VI
],

364 
sd©a
->
vif
.
hw_queue
[
IEEE80211_AC_BE
],

365 
sd©a
->
vif
.
hw_queue
[
IEEE80211_AC_BK
]);

367 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

368 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†en, "cab queue: %d\n",

369 
sd©a
->
vif
.
ÿb_queue
);

371  
Ën
;

372 
	}
}

373 
IEEE80211_IF_FILE_R
(
hw_queues
);

376 
IEEE80211_IF_FILE
(
bssid
, 
deæšk
.
u
.
mgd
.bssid, 
MAC
);

377 
IEEE80211_IF_FILE
(
aid
, 
vif
.
cfg
.aid, 
DEC
);

378 
IEEE80211_IF_FILE
(
b—cÚ_timeout
, 
u
.
mgd
.b—cÚ_timeout, 
JIFFIES_TO_MS
);

380 
	$›“80211_£t_smps
(
›“80211_lšk_d©a
 *
lšk
,

381 
›“80211_smps_mode
 
smps_mode
)

383 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

384 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

389 ià(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_EML_ACTIVE
)

390  -
EOPNOTSUPP
;

392 ià(!(
loÿl
->
hw
.
why
->
ã©u»s
 & 
NL80211_FEATURE_STATIC_SMPS
) &&

393 
smps_mode
 =ğ
IEEE80211_SMPS_STATIC
)

394  -
EINVAL
;

397 ià(!(
loÿl
->
hw
.
why
->
ã©u»s
 & 
NL80211_FEATURE_DYNAMIC_SMPS
) &&

398 (
smps_mode
 =ğ
IEEE80211_SMPS_DYNAMIC
 ||

399 
smps_mode
 =ğ
IEEE80211_SMPS_AUTOMATIC
))

400  -
EINVAL
;

402 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

403  -
EOPNOTSUPP
;

405  
	`__›“80211_»que¡_smps_mgd
(
lšk
->
sd©a
,†šk, 
smps_mode
);

406 
	}
}

408 cÚ¡ *
	gsmps_modes
[
IEEE80211_SMPS_NUM_MODES
] = {

409 [
IEEE80211_SMPS_AUTOMATIC
] = "auto",

410 [
IEEE80211_SMPS_OFF
] = "off",

411 [
IEEE80211_SMPS_STATIC
] = "static",

412 [
IEEE80211_SMPS_DYNAMIC
] = "dynamic",

415 
ssize_t
 
	$›“80211_if_fmt_smps
(cÚ¡ 
›“80211_lšk_d©a
 *
lšk
,

416 *
buf
, 
buæ’
)

418 ià(
lšk
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

419  
	`¢´štf
(
buf
, 
buæ’
, "request: %s\nused: %s\n",

420 
smps_modes
[
lšk
->
u
.
mgd
.
»q_smps
],

421 
smps_modes
[
lšk
->
smps_mode
]);

422  -
EINVAL
;

423 
	}
}

425 
ssize_t
 
	$›“80211_if_·r£_smps
(
›“80211_lšk_d©a
 *
lšk
,

426 cÚ¡ *
buf
, 
buæ’
)

428 
›“80211_smps_mode
 
mode
;

430 
mode
 = 0; mod< 
IEEE80211_SMPS_NUM_MODES
; mode++) {

431 ià(
	`¡ºcmp
(
buf
, 
smps_modes
[
mode
], 
buæ’
) == 0) {

432 
”r
 = 
	`›“80211_£t_smps
(
lšk
, 
mode
);

433 ià(!
”r
)

434  
buæ’
;

435  
”r
;

439  -
EINVAL
;

440 
	}
}

441 
IEEE80211_IF_LINK_FILE_RW
(
smps
);

443 
ssize_t
 
	$›“80211_if_·r£_tk_mic_‹¡
(

444 
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ *
buf
, 
buæ’
)

446 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

447 
u8
 
addr
[
ETH_ALEN
];

448 
sk_buff
 *
skb
;

449 
›“80211_hdr
 *
hdr
;

450 
__Ë16
 
fc
;

452 ià(!
	`mac_±Ú
(
buf
, 
addr
))

453  -
EINVAL
;

455 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

456  -
ENOTCONN
;

458 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 24 + 100);

459 ià(!
skb
)

460  -
ENOMEM
;

461 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

463 
hdr
 = 
	`skb_put_z”o
(
skb
, 24);

464 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_DATA
);

466 
sd©a
->
vif
.
ty³
) {

467 
NL80211_IFTYPE_AP
:

468 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
);

470 
	`memıy
(
hdr
->
addr1
, 
addr
, 
ETH_ALEN
);

471 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

472 
	`memıy
(
hdr
->
addr3
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

474 
NL80211_IFTYPE_STATION
:

475 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_TODS
);

477 ià(!
sd©a
->
u
.
mgd
.
assocŸ‹d
) {

478 
	`dev_kä“_skb
(
skb
);

479  -
ENOTCONN
;

481 
	`memıy
(
hdr
->
addr1
, 
sd©a
->
deæšk
.
u
.
mgd
.
bssid
, 
ETH_ALEN
);

482 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

483 
	`memıy
(
hdr
->
addr3
, 
addr
, 
ETH_ALEN
);

486 
	`dev_kä“_skb
(
skb
);

487  -
EOPNOTSUPP
;

489 
hdr
->
äame_cÚŒŞ
 = 
fc
;

496 
	`skb_put_z”o
(
skb
, 50);

498 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_TKIP_MIC_FAILURE
;

500 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

502  
buæ’
;

503 
	}
}

504 
IEEE80211_IF_FILE_W
(
tk_mic_‹¡
);

506 
ssize_t
 
	$›“80211_if_·r£_b—cÚ_loss
(

507 
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ *
buf
, 
buæ’
)

509 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
è|| !sd©a->
vif
.
cfg
.
assoc
)

510  -
ENOTCONN
;

512 
	`›“80211_b—cÚ_loss
(&
sd©a
->
vif
);

514  
buæ’
;

515 
	}
}

516 
IEEE80211_IF_FILE_W
(
b—cÚ_loss
);

518 
ssize_t
 
	$›“80211_if_fmt_u­sd_queues
(

519 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *
buf
, 
buæ’
)

521 cÚ¡ 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

523  
	`¢´štf
(
buf
, 
buæ’
, "0x%x\n", 
ifmgd
->
u­sd_queues
);

524 
	}
}

526 
ssize_t
 
	$›“80211_if_·r£_u­sd_queues
(

527 
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ *
buf
, 
buæ’
)

529 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

530 
u8
 
v®
;

531 
»t
;

533 
»t
 = 
	`k¡¹ou8
(
buf
, 0, &
v®
);

534 ià(
»t
)

535  
»t
;

537 ià(
v®
 & ~
IEEE80211_WMM_IE_STA_QOSINFO_AC_MASK
)

538  -
ERANGE
;

540 
ifmgd
->
u­sd_queues
 = 
v®
;

542  
buæ’
;

543 
	}
}

544 
IEEE80211_IF_FILE_RW
(
u­sd_queues
);

546 
ssize_t
 
	$›“80211_if_fmt_u­sd_max_¥_Ën
(

547 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *
buf
, 
buæ’
)

549 cÚ¡ 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

551  
	`¢´štf
(
buf
, 
buæ’
, "0x%x\n", 
ifmgd
->
u­sd_max_¥_Ën
);

552 
	}
}

554 
ssize_t
 
	$›“80211_if_·r£_u­sd_max_¥_Ën
(

555 
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ *
buf
, 
buæ’
)

557 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

558 
v®
;

559 
»t
;

561 
»t
 = 
	`k¡¹oul
(
buf
, 0, &
v®
);

562 ià(
»t
)

563  -
EINVAL
;

565 ià(
v®
 & ~
IEEE80211_WMM_IE_STA_QOSINFO_SP_MASK
)

566  -
ERANGE
;

568 
ifmgd
->
u­sd_max_¥_Ën
 = 
v®
;

570  
buæ’
;

571 
	}
}

572 
IEEE80211_IF_FILE_RW
(
u­sd_max_¥_Ën
);

574 
ssize_t
 
	$›“80211_if_fmt_tdls_wid”_bw
(

575 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *
buf
, 
buæ’
)

577 cÚ¡ 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

578 
boŞ
 
tdls_wid”_bw
;

580 
tdls_wid”_bw
 = 
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
TDLS_WIDER_BW
) &&

581 !
ifmgd
->
tdls_wid”_bw_´ohib™ed
;

583  
	`¢´štf
(
buf
, 
buæ’
, "%d\n", 
tdls_wid”_bw
);

584 
	}
}

586 
ssize_t
 
	$›“80211_if_·r£_tdls_wid”_bw
(

587 
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ *
buf
, 
buæ’
)

589 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

590 
u8
 
v®
;

591 
»t
;

593 
»t
 = 
	`k¡¹ou8
(
buf
, 0, &
v®
);

594 ià(
»t
)

595  
»t
;

597 
ifmgd
->
tdls_wid”_bw_´ohib™ed
 = !
v®
;

598  
buæ’
;

599 
	}
}

600 
IEEE80211_IF_FILE_RW
(
tdls_wid”_bw
);

603 
IEEE80211_IF_FILE
(
num_mÿ¡_¡a
, 
u
.
­
.num_mÿ¡_¡a, 
ATOMIC
);

604 
IEEE80211_IF_FILE
(
num_¡a_ps
, 
u
.
­
.
ps
.num_¡a_ps, 
ATOMIC
);

605 
IEEE80211_IF_FILE
(
dtim_couÁ
, 
u
.
­
.
ps
.dtim_couÁ, 
DEC
);

606 
IEEE80211_IF_FILE
(
num_mÿ¡_¡a_vÏn
, 
u
.
vÏn
.
num_mÿ¡_¡a
, 
ATOMIC
);

608 
ssize_t
 
	$›“80211_if_fmt_num_bufã»d_muÉiÿ¡
(

609 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *
buf
, 
buæ’
)

611  
	`sú´štf
(
buf
, 
buæ’
, "%u\n",

612 
	`skb_queue_Ën
(&
sd©a
->
u
.
­
.
ps
.
bc_buf
));

613 
	}
}

614 
IEEE80211_IF_FILE_R
(
num_bufã»d_muÉiÿ¡
);

616 
ssize_t
 
	$›“80211_if_fmt_aqm
(

617 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *
buf
, 
buæ’
)

619 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

620 
txq_šfo
 *
txqi
;

621 
Ën
;

623 ià(!
sd©a
->
vif
.
txq
)

626 
txqi
 = 
	`to_txq_šfo
(
sd©a
->
vif
.
txq
);

628 
	`¥š_lock_bh
(&
loÿl
->
fq
.
lock
);

629 
	`rcu_»ad_lock
();

631 
Ën
 = 
	`sú´štf
(
buf
,

632 
buæ’
,

635 
txqi
->
txq
.
ac
,

636 
txqi
->
tš
.
backlog_by‹s
,

637 
txqi
->
tš
.
backlog_·ck‘s
,

638 
txqi
->
tš
.
æows
,

639 
txqi
->
c¡©s
.
drİ_couÁ
,

640 
txqi
->
c¡©s
.
eú_m¬k
,

641 
txqi
->
tš
.
ov”lim™
,

642 
txqi
->
tš
.
cŞlisiÚs
,

643 
txqi
->
tš
.
tx_by‹s
,

644 
txqi
->
tš
.
tx_·ck‘s
);

646 
	`rcu_»ad_uÆock
();

647 
	`¥š_uÆock_bh
(&
loÿl
->
fq
.
lock
);

649  
Ën
;

650 
	}
}

651 
IEEE80211_IF_FILE_R
(
aqm
);

653 
IEEE80211_IF_FILE
(
muÉiÿ¡_to_uniÿ¡
, 
u
.
­
.muÉiÿ¡_to_uniÿ¡, 
HEX
);

656 
ssize_t
 
	$›“80211_if_fmt_tsf
(

657 cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
, *
buf
, 
buæ’
)

659 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

660 
u64
 
tsf
;

662 
tsf
 = 
	`drv_g‘_tsf
(
loÿl
, (
›“80211_sub_if_d©a
 *)
sd©a
);

664  
	`sú´štf
(
buf
, 
buæ’
, "0x%016Îx\n", (è
tsf
);

665 
	}
}

667 
ssize_t
 
	$›“80211_if_·r£_tsf
(

668 
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ *
buf
, 
buæ’
)

670 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

671 
tsf
;

672 
»t
;

673 
tsf_is_d–
 = 0;

675 ià(
	`¡ºcmp
(
buf
, "reset", 5) == 0) {

676 ià(
loÿl
->
İs
->
»£t_tsf
) {

677 
	`drv_»£t_tsf
(
loÿl
, 
sd©a
);

678 
	`why_šfo
(
loÿl
->
hw
.
why
, "debugfs„eset TSF\n");

681 ià(
buæ’
 > 10 && 
buf
[1] == '=') {

682 ià(
buf
[0] == '+')

683 
tsf_is_d–
 = 1;

684 ià(
buf
[0] == '-')

685 
tsf_is_d–
 = -1;

687  -
EINVAL
;

688 
buf
 += 2;

690 
»t
 = 
	`k¡¹ouÎ
(
buf
, 10, &
tsf
);

691 ià(
»t
 < 0)

692  
»t
;

693 ià(
tsf_is_d–
 && 
loÿl
->
İs
->
off£t_tsf
) {

694 
	`drv_off£t_tsf
(
loÿl
, 
sd©a
, 
tsf_is_d–
 * 
tsf
);

695 
	`why_šfo
(
loÿl
->
hw
.
why
,

697 
tsf_is_d–
 * 
tsf
);

698 } ià(
loÿl
->
İs
->
£t_tsf
) {

699 ià(
tsf_is_d–
)

700 
tsf
 = 
	`drv_g‘_tsf
(
loÿl
, 
sd©a
) +

701 
tsf_is_d–
 * 
tsf
;

702 
	`drv_£t_tsf
(
loÿl
, 
sd©a
, 
tsf
);

703 
	`why_šfo
(
loÿl
->
hw
.
why
,

704 "debugf £ˆTSFØ%#018Îx\n", 
tsf
);

708 
	`›“80211_»ÿlc_dtim
(
loÿl
, 
sd©a
);

709  
buæ’
;

710 
	}
}

711 
IEEE80211_IF_FILE_RW
(
tsf
);

713 
ssize_t
 
	$›“80211_if_fmt_v®id_lšks
(cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
,

714 *
buf
, 
buæ’
)

716  
	`¢´štf
(
buf
, 
buæ’
, "0x%x\n", 
sd©a
->
vif
.
v®id_lšks
);

717 
	}
}

718 
IEEE80211_IF_FILE_R
(
v®id_lšks
);

720 
ssize_t
 
	$›“80211_if_fmt_aùive_lšks
(cÚ¡ 
›“80211_sub_if_d©a
 *
sd©a
,

721 *
buf
, 
buæ’
)

723  
	`¢´štf
(
buf
, 
buæ’
, "0x%x\n", 
sd©a
->
vif
.
aùive_lšks
);

724 
	}
}

726 
ssize_t
 
	$›“80211_if_·r£_aùive_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

727 cÚ¡ *
buf
, 
buæ’
)

729 
u16
 
aùive_lšks
;

731 ià(
	`k¡¹ou16
(
buf
, 0, &
aùive_lšks
))

732  -
EINVAL
;

734  
	`›“80211_£t_aùive_lšks
(&
sd©a
->
vif
, 
aùive_lšks
è?: 
buæ’
;

735 
	}
}

736 
IEEE80211_IF_FILE_RW
(
aùive_lšks
);

738 
IEEE80211_IF_LINK_FILE
(
addr
, 
cÚf
->addr, 
MAC
);

740 #ifdeà
CONFIG_MAC80211_MESH


741 
IEEE80211_IF_FILE
(
e¡ab_¶šks
, 
u
.
mesh
.e¡ab_¶šks, 
ATOMIC
);

744 
IEEE80211_IF_FILE
(
fwded_mÿ¡
, 
u
.
mesh
.
msh¡©s
.fwded_mÿ¡, 
DEC
);

745 
IEEE80211_IF_FILE
(
fwded_uniÿ¡
, 
u
.
mesh
.
msh¡©s
.fwded_uniÿ¡, 
DEC
);

746 
IEEE80211_IF_FILE
(
fwded_äames
, 
u
.
mesh
.
msh¡©s
.fwded_äames, 
DEC
);

747 
IEEE80211_IF_FILE
(
drİ³d_äames_‰l
, 
u
.
mesh
.
msh¡©s
.drİ³d_äames_‰l, 
DEC
);

748 
IEEE80211_IF_FILE
(
drİ³d_äames_no_rou‹
,

749 
u
.
mesh
.
msh¡©s
.
drİ³d_äames_no_rou‹
, 
DEC
);

752 
IEEE80211_IF_FILE
(
dÙ11MeshMaxR‘r›s
,

753 
u
.
mesh
.
mshcfg
.
dÙ11MeshMaxR‘r›s
, 
DEC
);

754 
IEEE80211_IF_FILE
(
dÙ11MeshR‘ryTimeout
,

755 
u
.
mesh
.
mshcfg
.
dÙ11MeshR‘ryTimeout
, 
DEC
);

756 
IEEE80211_IF_FILE
(
dÙ11MeshCÚfœmTimeout
,

757 
u
.
mesh
.
mshcfg
.
dÙ11MeshCÚfœmTimeout
, 
DEC
);

758 
IEEE80211_IF_FILE
(
dÙ11MeshHŞdšgTimeout
,

759 
u
.
mesh
.
mshcfg
.
dÙ11MeshHŞdšgTimeout
, 
DEC
);

760 
IEEE80211_IF_FILE
(
dÙ11MeshTTL
, 
u
.
mesh
.
mshcfg
.dÙ11MeshTTL, 
DEC
);

761 
IEEE80211_IF_FILE
(
–em’t_‰l
, 
u
.
mesh
.
mshcfg
.–em’t_‰l, 
DEC
);

762 
IEEE80211_IF_FILE
(
auto_İ’_¶šks
, 
u
.
mesh
.
mshcfg
.auto_İ’_¶šks, 
DEC
);

763 
IEEE80211_IF_FILE
(
dÙ11MeshMaxP“rLšks
,

764 
u
.
mesh
.
mshcfg
.
dÙ11MeshMaxP“rLšks
, 
DEC
);

765 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPaùiveP©hTimeout
,

766 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPaùiveP©hTimeout
, 
DEC
);

767 
IEEE80211_IF_FILE
(
dÙ11MeshHWMP´eqMšIÁ”v®
,

768 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMP´eqMšIÁ”v®
, 
DEC
);

769 
IEEE80211_IF_FILE
(
dÙ11MeshHWMP³¼MšIÁ”v®
,

770 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMP³¼MšIÁ”v®
, 
DEC
);

771 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPÃtDŸm‘”T¿v”§lTime
,

772 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPÃtDŸm‘”T¿v”§lTime
, 
DEC
);

773 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPmaxPREQ»Œ›s
,

774 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPmaxPREQ»Œ›s
, 
DEC
);

775 
IEEE80211_IF_FILE
(
·th_»äesh_time
,

776 
u
.
mesh
.
mshcfg
.
·th_»äesh_time
, 
DEC
);

777 
IEEE80211_IF_FILE
(
mš_discov”y_timeout
,

778 
u
.
mesh
.
mshcfg
.
mš_discov”y_timeout
, 
DEC
);

779 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPRoÙMode
,

780 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPRoÙMode
, 
DEC
);

781 
IEEE80211_IF_FILE
(
dÙ11MeshG©eAÂounûm’tPrÙocŞ
,

782 
u
.
mesh
.
mshcfg
.
dÙ11MeshG©eAÂounûm’tPrÙocŞ
, 
DEC
);

783 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPRªnIÁ”v®
,

784 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPRªnIÁ”v®
, 
DEC
);

785 
IEEE80211_IF_FILE
(
dÙ11MeshFÜw¬dšg
, 
u
.
mesh
.
mshcfg
.dÙ11MeshFÜw¬dšg, 
DEC
);

786 
IEEE80211_IF_FILE
(
rssi_th»shŞd
, 
u
.
mesh
.
mshcfg
.rssi_th»shŞd, 
DEC
);

787 
IEEE80211_IF_FILE
(
ht_İmode
, 
u
.
mesh
.
mshcfg
.ht_İmode, 
DEC
);

788 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPaùiveP©hToRoÙTimeout
,

789 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPaùiveP©hToRoÙTimeout
, 
DEC
);

790 
IEEE80211_IF_FILE
(
dÙ11MeshHWMProÙIÁ”v®
,

791 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMProÙIÁ”v®
, 
DEC
);

792 
IEEE80211_IF_FILE
(
dÙ11MeshHWMPcÚfœm©iÚIÁ”v®
,

793 
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPcÚfœm©iÚIÁ”v®
, 
DEC
);

794 
IEEE80211_IF_FILE
(
pow”_mode
, 
u
.
mesh
.
mshcfg
.pow”_mode, 
DEC
);

795 
IEEE80211_IF_FILE
(
dÙ11MeshAwakeWšdowDu¿tiÚ
,

796 
u
.
mesh
.
mshcfg
.
dÙ11MeshAwakeWšdowDu¿tiÚ
, 
DEC
);

797 
IEEE80211_IF_FILE
(
dÙ11MeshCÚÃùedToMeshG©e
,

798 
u
.
mesh
.
mshcfg
.
dÙ11MeshCÚÃùedToMeshG©e
, 
DEC
);

799 
IEEE80211_IF_FILE
(
dÙ11MeshNŞ—º
, 
u
.
mesh
.
mshcfg
.dÙ11MeshNŞ—º, 
DEC
);

800 
IEEE80211_IF_FILE
(
dÙ11MeshCÚÃùedToAuthS”v”
,

801 
u
.
mesh
.
mshcfg
.
dÙ11MeshCÚÃùedToAuthS”v”
, 
DEC
);

804 
	#DEBUGFS_ADD_MODE
(
Çme
, 
mode
) \

805 
	`debugfs_ü—‹_fe
(#Çme, 
mode
, 
sd©a
->
vif
.
debugfs_dœ
, \

806 
sd©a
, &
Çme
##
_İs
)

	)

808 
	#DEBUGFS_ADD_X
(
_b™s
, 
_Çme
, 
_mode
) \

809 
debugfs_ü—‹_x
##
	`_b™s
(#_Çme, 
_mode
, 
sd©a
->
vif
.
debugfs_dœ
, \

810 &
sd©a
->
vif
.
_Çme
)

	)

812 
	#DEBUGFS_ADD_X8
(
_Çme
, 
_mode
) \

813 
	`DEBUGFS_ADD_X
(8, 
_Çme
, 
_mode
)

	)

815 
	#DEBUGFS_ADD_X16
(
_Çme
, 
_mode
) \

816 
	`DEBUGFS_ADD_X
(16, 
_Çme
, 
_mode
)

	)

818 
	#DEBUGFS_ADD_X32
(
_Çme
, 
_mode
) \

819 
	`DEBUGFS_ADD_X
(32, 
_Çme
, 
_mode
)

	)

821 
	#DEBUGFS_ADD
(
Çme
è
	`DEBUGFS_ADD_MODE
Òame, 0400)

	)

823 
	$add_commÚ_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

825 
	`DEBUGFS_ADD
(
rc_¿‹idx_mask_2ghz
);

826 
	`DEBUGFS_ADD
(
rc_¿‹idx_mask_5ghz
);

827 
	`DEBUGFS_ADD
(
rc_¿‹idx_mcs_mask_2ghz
);

828 
	`DEBUGFS_ADD
(
rc_¿‹idx_mcs_mask_5ghz
);

829 
	`DEBUGFS_ADD
(
rc_¿‹idx_vht_mcs_mask_2ghz
);

830 
	`DEBUGFS_ADD
(
rc_¿‹idx_vht_mcs_mask_5ghz
);

831 
	`DEBUGFS_ADD
(
hw_queues
);

833 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_P2P_DEVICE
 &&

834 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_NAN
)

835 
	`DEBUGFS_ADD
(
aqm
);

836 
	}
}

838 
	$add_¡a_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

840 
	`DEBUGFS_ADD
(
bssid
);

841 
	`DEBUGFS_ADD
(
aid
);

842 
	`DEBUGFS_ADD
(
b—cÚ_timeout
);

843 
	`DEBUGFS_ADD_MODE
(
tk_mic_‹¡
, 0200);

844 
	`DEBUGFS_ADD_MODE
(
b—cÚ_loss
, 0200);

845 
	`DEBUGFS_ADD_MODE
(
u­sd_queues
, 0600);

846 
	`DEBUGFS_ADD_MODE
(
u­sd_max_¥_Ën
, 0600);

847 
	`DEBUGFS_ADD_MODE
(
tdls_wid”_bw
, 0600);

848 
	`DEBUGFS_ADD_MODE
(
v®id_lšks
, 0400);

849 
	`DEBUGFS_ADD_MODE
(
aùive_lšks
, 0600);

850 
	`DEBUGFS_ADD_X16
(
dÜmªt_lšks
, 0400);

851 
	}
}

853 
	$add_­_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

855 
	`DEBUGFS_ADD
(
num_mÿ¡_¡a
);

856 
	`DEBUGFS_ADD
(
num_¡a_ps
);

857 
	`DEBUGFS_ADD
(
dtim_couÁ
);

858 
	`DEBUGFS_ADD
(
num_bufã»d_muÉiÿ¡
);

859 
	`DEBUGFS_ADD_MODE
(
tk_mic_‹¡
, 0200);

860 
	`DEBUGFS_ADD_MODE
(
muÉiÿ¡_to_uniÿ¡
, 0600);

861 
	}
}

863 
	$add_vÏn_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

866 
	`debugfs_ü—‹_fe
("num_mÿ¡_¡a", 0400, 
sd©a
->
vif
.
debugfs_dœ
,

867 
sd©a
, &
num_mÿ¡_¡a_vÏn_İs
);

868 
	}
}

870 
	$add_ibss_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

872 
	`DEBUGFS_ADD_MODE
(
tsf
, 0600);

873 
	}
}

875 #ifdeà
CONFIG_MAC80211_MESH


877 
	$add_mesh_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

879 
	`DEBUGFS_ADD_MODE
(
tsf
, 0600);

880 
	`DEBUGFS_ADD_MODE
(
e¡ab_¶šks
, 0400);

881 
	}
}

883 
	$add_mesh_¡©s
(
›“80211_sub_if_d©a
 *
sd©a
)

885 
d’Œy
 *
dœ
 = 
	`debugfs_ü—‹_dœ
("mesh_stats",

886 
sd©a
->
vif
.
debugfs_dœ
);

887 
	#MESHSTATS_ADD
(
Çme
)\

888 
	`debugfs_ü—‹_fe
(#Çme, 0400, 
dœ
, 
sd©a
, &
Çme
##
_İs
)

	)

890 
	`MESHSTATS_ADD
(
fwded_mÿ¡
);

891 
	`MESHSTATS_ADD
(
fwded_uniÿ¡
);

892 
	`MESHSTATS_ADD
(
fwded_äames
);

893 
	`MESHSTATS_ADD
(
drİ³d_äames_‰l
);

894 
	`MESHSTATS_ADD
(
drİ³d_äames_no_rou‹
);

895 #undeà
MESHSTATS_ADD


896 
	}
}

898 
	$add_mesh_cÚfig
(
›“80211_sub_if_d©a
 *
sd©a
)

900 
d’Œy
 *
dœ
 = 
	`debugfs_ü—‹_dœ
("mesh_config",

901 
sd©a
->
vif
.
debugfs_dœ
);

903 
	#MESHPARAMS_ADD
(
Çme
) \

904 
	`debugfs_ü—‹_fe
(#Çme, 0600, 
dœ
, 
sd©a
, &
Çme
##
_İs
)

	)

906 
	`MESHPARAMS_ADD
(
dÙ11MeshMaxR‘r›s
);

907 
	`MESHPARAMS_ADD
(
dÙ11MeshR‘ryTimeout
);

908 
	`MESHPARAMS_ADD
(
dÙ11MeshCÚfœmTimeout
);

909 
	`MESHPARAMS_ADD
(
dÙ11MeshHŞdšgTimeout
);

910 
	`MESHPARAMS_ADD
(
dÙ11MeshTTL
);

911 
	`MESHPARAMS_ADD
(
–em’t_‰l
);

912 
	`MESHPARAMS_ADD
(
auto_İ’_¶šks
);

913 
	`MESHPARAMS_ADD
(
dÙ11MeshMaxP“rLšks
);

914 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPaùiveP©hTimeout
);

915 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMP´eqMšIÁ”v®
);

916 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMP³¼MšIÁ”v®
);

917 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPÃtDŸm‘”T¿v”§lTime
);

918 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPmaxPREQ»Œ›s
);

919 
	`MESHPARAMS_ADD
(
·th_»äesh_time
);

920 
	`MESHPARAMS_ADD
(
mš_discov”y_timeout
);

921 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPRoÙMode
);

922 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPRªnIÁ”v®
);

923 
	`MESHPARAMS_ADD
(
dÙ11MeshFÜw¬dšg
);

924 
	`MESHPARAMS_ADD
(
dÙ11MeshG©eAÂounûm’tPrÙocŞ
);

925 
	`MESHPARAMS_ADD
(
rssi_th»shŞd
);

926 
	`MESHPARAMS_ADD
(
ht_İmode
);

927 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPaùiveP©hToRoÙTimeout
);

928 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMProÙIÁ”v®
);

929 
	`MESHPARAMS_ADD
(
dÙ11MeshHWMPcÚfœm©iÚIÁ”v®
);

930 
	`MESHPARAMS_ADD
(
pow”_mode
);

931 
	`MESHPARAMS_ADD
(
dÙ11MeshAwakeWšdowDu¿tiÚ
);

932 
	`MESHPARAMS_ADD
(
dÙ11MeshCÚÃùedToMeshG©e
);

933 
	`MESHPARAMS_ADD
(
dÙ11MeshNŞ—º
);

934 
	`MESHPARAMS_ADD
(
dÙ11MeshCÚÃùedToAuthS”v”
);

935 #undeà
MESHPARAMS_ADD


936 
	}
}

939 
	$add_fes
(
›“80211_sub_if_d©a
 *
sd©a
)

941 ià(!
sd©a
->
vif
.
debugfs_dœ
)

944 
	`DEBUGFS_ADD
(
æags
);

945 
	`DEBUGFS_ADD
(
¡©e
);

947 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
)

948 
	`add_commÚ_fes
(
sd©a
);

950 
sd©a
->
vif
.
ty³
) {

951 
NL80211_IFTYPE_MESH_POINT
:

952 #ifdeà
CONFIG_MAC80211_MESH


953 
	`add_mesh_fes
(
sd©a
);

954 
	`add_mesh_¡©s
(
sd©a
);

955 
	`add_mesh_cÚfig
(
sd©a
);

958 
NL80211_IFTYPE_STATION
:

959 
	`add_¡a_fes
(
sd©a
);

961 
NL80211_IFTYPE_ADHOC
:

962 
	`add_ibss_fes
(
sd©a
);

964 
NL80211_IFTYPE_AP
:

965 
	`add_­_fes
(
sd©a
);

967 
NL80211_IFTYPE_AP_VLAN
:

968 
	`add_vÏn_fes
(
sd©a
);

973 
	}
}

975 #undeà
DEBUGFS_ADD_MODE


976 #undeà
DEBUGFS_ADD


978 
	#DEBUGFS_ADD_MODE
(
d’Œy
, 
Çme
, 
mode
) \

979 
	`debugfs_ü—‹_fe
(#Çme, 
mode
, 
d’Œy
, \

980 
lšk
, &
lšk_
##
Çme
##
_İs
)

	)

982 
	#DEBUGFS_ADD
(
d’Œy
, 
Çme
è
	`DEBUGFS_ADD_MODE
(d’Œy,‚ame, 0400)

	)

984 
	$add_lšk_fes
(
›“80211_lšk_d©a
 *
lšk
,

985 
d’Œy
 *dentry)

987 
	`DEBUGFS_ADD
(
d’Œy
, 
txpow”
);

988 
	`DEBUGFS_ADD
(
d’Œy
, 
u£r_pow”_Ëv–
);

989 
	`DEBUGFS_ADD
(
d’Œy
, 
­_pow”_Ëv–
);

991 
lšk
->
sd©a
->
vif
.
ty³
) {

992 
NL80211_IFTYPE_STATION
:

993 
	`DEBUGFS_ADD_MODE
(
d’Œy
, 
smps
, 0600);

998 
	}
}

1000 
	$›“80211_debugfs_add_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
,

1001 
boŞ
 
mld_vif
)

1003 
buf
[10+
IFNAMSIZ
];

1005 
	`¥rštf
(
buf
, "Ãtdev:%s", 
sd©a
->
Çme
);

1006 
sd©a
->
vif
.
debugfs_dœ
 = 
	`debugfs_ü—‹_dœ
(
buf
,

1007 
sd©a
->
loÿl
->
hw
.
why
->
debugfsdœ
);

1009 
sd©a
->
deæšk
.
debugfs_dœ
 = sd©a->
vif
.debugfs_dir;

1010 
sd©a
->
debugfs
.
subdœ_¡©iÚs
 = 
	`debugfs_ü—‹_dœ
("stations",

1011 
sd©a
->
vif
.
debugfs_dœ
);

1012 
	`add_fes
(
sd©a
);

1013 ià(!
mld_vif
)

1014 
	`add_lšk_fes
(&
sd©a
->
deæšk
, sd©a->
vif
.
debugfs_dœ
);

1015 
	}
}

1017 
	$›“80211_debugfs_»move_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
)

1019 ià(!
sd©a
->
vif
.
debugfs_dœ
)

1022 
	`debugfs_»move_»cursive
(
sd©a
->
vif
.
debugfs_dœ
);

1023 
sd©a
->
vif
.
debugfs_dœ
 = 
NULL
;

1024 
sd©a
->
debugfs
.
subdœ_¡©iÚs
 = 
NULL
;

1025 
	}
}

1027 
	$›“80211_debugfs_»Çme_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
)

1029 
d’Œy
 *
dœ
;

1030 
buf
[10 + 
IFNAMSIZ
];

1032 
dœ
 = 
sd©a
->
vif
.
debugfs_dœ
;

1034 ià(
	`IS_ERR_OR_NULL
(
dœ
))

1037 
	`¥rštf
(
buf
, "Ãtdev:%s", 
sd©a
->
Çme
);

1038 
	`debugfs_»Çme
(
dœ
->
d_·»Á
, dœ, dœ->d_·»Á, 
buf
);

1039 
	}
}

1041 
	$›“80211_debugfs_»ü—‹_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
,

1042 
boŞ
 
mld_vif
)

1044 
	`›“80211_debugfs_»move_Ãtdev
(
sd©a
);

1045 
	`›“80211_debugfs_add_Ãtdev
(
sd©a
, 
mld_vif
);

1047 ià(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
) {

1048 
	`drv_vif_add_debugfs
(
sd©a
->
loÿl
, sdata);

1049 ià(!
mld_vif
)

1050 
	`›“80211_lšk_debugfs_drv_add
(&
sd©a
->
deæšk
);

1052 
	}
}

1054 
	$›“80211_lšk_debugfs_add
(
›“80211_lšk_d©a
 *
lšk
)

1056 
lšk_dœ_Çme
[10];

1058 ià(
	`WARN_ON
(!
lšk
->
sd©a
->
vif
.
debugfs_dœ
 ||†ink->debugfs_dir))

1062 ià(
	`WARN_ON
(!(
lšk
->
sd©a
->
loÿl
->
hw
.
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_MLO
)))

1065 
	`¢´štf
(
lšk_dœ_Çme
, (link_dir_name),

1066 "lšk-%d", 
lšk
->
lšk_id
);

1068 
lšk
->
debugfs_dœ
 =

1069 
	`debugfs_ü—‹_dœ
(
lšk_dœ_Çme
,

1070 
lšk
->
sd©a
->
vif
.
debugfs_dœ
);

1072 
	`DEBUGFS_ADD
(
lšk
->
debugfs_dœ
, 
addr
);

1073 
	`add_lšk_fes
(
lšk
,†šk->
debugfs_dœ
);

1074 
	}
}

1076 
	$›“80211_lšk_debugfs_»move
(
›“80211_lšk_d©a
 *
lšk
)

1078 ià(!
lšk
->
sd©a
->
vif
.
debugfs_dœ
 || !link->debugfs_dir) {

1079 
lšk
->
debugfs_dœ
 = 
NULL
;

1083 ià(
lšk
->
debugfs_dœ
 =ğlšk->
sd©a
->
vif
.debugfs_dir) {

1084 
	`WARN_ON
(
lšk
 !ğ&lšk->
sd©a
->
deæšk
);

1085 
lšk
->
debugfs_dœ
 = 
NULL
;

1089 
	`debugfs_»move_»cursive
(
lšk
->
debugfs_dœ
);

1090 
lšk
->
debugfs_dœ
 = 
NULL
;

1091 
	}
}

1093 
	$›“80211_lšk_debugfs_drv_add
(
›“80211_lšk_d©a
 *
lšk
)

1095 ià(
lšk
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 ||

1096 
	`WARN_ON
(!
lšk
->
debugfs_dœ
))

1099 
	`drv_lšk_add_debugfs
(
lšk
->
sd©a
->
loÿl
,†ink->sdata,

1100 
lšk
->
cÚf
,†šk->
debugfs_dœ
);

1101 
	}
}

1103 
	$›“80211_lšk_debugfs_drv_»move
(
›“80211_lšk_d©a
 *
lšk
)

1105 ià(!
lšk
 || !lšk->
debugfs_dœ
)

1108 ià(
	`WARN_ON
(
lšk
->
debugfs_dœ
 =ğlšk->
sd©a
->
vif
.debugfs_dir))

1112 
	`debugfs_»move_»cursive
(
lšk
->
debugfs_dœ
);

1113 
lšk
->
debugfs_dœ
 = 
NULL
;

1115 
	`›“80211_lšk_debugfs_add
(
lšk
);

1116 
	}
}

	@debugfs_netdev.h

8 #iâdeà
__IEEE80211_DEBUGFS_NETDEV_H


9 
	#__IEEE80211_DEBUGFS_NETDEV_H


	)

11 
	~"›“80211_i.h
"

13 #ifdeà
CONFIG_MAC80211_DEBUGFS


14 
›“80211_debugfs_»move_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
);

15 
›“80211_debugfs_»Çme_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
);

16 
›“80211_debugfs_»ü—‹_Ãtdev
(
›“80211_sub_if_d©a
 *
sd©a
,

17 
boŞ
 
mld_vif
);

19 
›“80211_lšk_debugfs_add
(
›“80211_lšk_d©a
 *
lšk
);

20 
›“80211_lšk_debugfs_»move
(
›“80211_lšk_d©a
 *
lšk
);

22 
›“80211_lšk_debugfs_drv_add
(
›“80211_lšk_d©a
 *
lšk
);

23 
›“80211_lšk_debugfs_drv_»move
(
›“80211_lšk_d©a
 *
lšk
);

25 
šlše
 
	$›“80211_debugfs_»move_Ãtdev
(

26 
›“80211_sub_if_d©a
 *
sd©a
)

27 {
	}
}

28 
šlše
 
	$›“80211_debugfs_»Çme_Ãtdev
(

29 
›“80211_sub_if_d©a
 *
sd©a
)

30 {
	}
}

31 
šlše
 
	$›“80211_debugfs_»ü—‹_Ãtdev
(

32 
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
mld_vif
)

33 {
	}
}

34 
šlše
 
	$›“80211_lšk_debugfs_add
(
›“80211_lšk_d©a
 *
lšk
)

35 {
	}
}

36 
šlše
 
	$›“80211_lšk_debugfs_»move
(
›“80211_lšk_d©a
 *
lšk
)

37 {
	}
}

39 
šlše
 
	$›“80211_lšk_debugfs_drv_add
(
›“80211_lšk_d©a
 *
lšk
)

40 {
	}
}

41 
šlše
 
	$›“80211_lšk_debugfs_drv_»move
(
›“80211_lšk_d©a
 *
lšk
)

42 {
	}
}

	@debugfs_sta.c

11 
	~<lšux/debugfs.h
>

12 
	~<lšux/›“80211.h
>

13 
	~"›“80211_i.h
"

14 
	~"debugfs.h
"

15 
	~"debugfs_¡a.h
"

16 
	~"¡a_šfo.h
"

17 
	~"driv”-İs.h
"

21 
	#STA_READ
(
Çme
, 
f›ld
, 
fÜm©_¡ršg
) \

22 
ssize_t
 
¡a_
 ##
Çme
## 
	`_»ad
(
fe
 *file, \

23 
__u£r
 *
u£rbuf
, \

24 
size_t
 
couÁ
, 
loff_t
 *
µos
) \

26 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
; \

27  
	`mac80211_fÜm©_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, \

28 
fÜm©_¡ršg
, 
¡a
->
f›ld
); \

29 }

	)

30 
	#STA_READ_D
(
Çme
, 
f›ld
è
	`STA_READ
Òame, f›ld, "%d\n")

	)

32 
	#STA_OPS
(
Çme
) \

33 cÚ¡ 
fe_İ”©iÚs
 
¡a_
 ##
Çme
## 
_İs
 = { \

34 .
»ad
 = 
¡a_
##
Çme
##
_»ad
, \

35 .
İ’
 = 
sim¶e_İ’
, \

36 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

37 }

	)

39 
	#STA_OPS_RW
(
Çme
) \

40 cÚ¡ 
fe_İ”©iÚs
 
¡a_
 ##
Çme
## 
_İs
 = { \

41 .
»ad
 = 
¡a_
##
Çme
##
_»ad
, \

42 .
wr™e
 = 
¡a_
##
Çme
##
_wr™e
, \

43 .
İ’
 = 
sim¶e_İ’
, \

44 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

45 }

	)

47 
	#STA_FILE
(
Çme
, 
f›ld
, 
fÜm©
) \

48 
STA_READ_
##
	`fÜm©
(
Çme
, 
f›ld
) \

49 
	`STA_OPS
(
Çme
)

	)

51 
STA_FILE
(
aid
, 
¡a
.aid, 
D
);

53 cÚ¡ * cÚ¡ 
	g¡a_æag_Çmes
[] = {

54 
	#FLAG
(
F
è[
WLAN_STA_
##F] = #F

	)

55 
FLAG
(
AUTH
),

56 
FLAG
(
ASSOC
),

57 
FLAG
(
PS_STA
),

58 
FLAG
(
AUTHORIZED
),

59 
FLAG
(
SHORT_PREAMBLE
),

60 
FLAG
(
WDS
),

61 
FLAG
(
CLEAR_PS_FILT
),

62 
FLAG
(
MFP
),

63 
FLAG
(
BLOCK_BA
),

64 
FLAG
(
PS_DRIVER
),

65 
FLAG
(
PSPOLL
),

66 
FLAG
(
TDLS_PEER
),

67 
FLAG
(
TDLS_PEER_AUTH
),

68 
FLAG
(
TDLS_INITIATOR
),

69 
FLAG
(
TDLS_CHAN_SWITCH
),

70 
FLAG
(
TDLS_OFF_CHANNEL
),

71 
FLAG
(
TDLS_WIDER_BW
),

72 
FLAG
(
UAPSD
),

73 
FLAG
(
SP
),

74 
FLAG
(4ADD
R_EVENT
),

75 
FLAG
(
INSERTED
),

76 
FLAG
(
RATE_CONTROL
),

77 
FLAG
(
TOFFSET_KNOWN
),

78 
FLAG
(
MPSP_OWNER
),

79 
FLAG
(
MPSP_RECIPIENT
),

80 
FLAG
(
PS_DELIVER
),

81 
FLAG
(
USES_ENCRYPTION
),

82 
FLAG
(
DECAP_OFFLOAD
),

83 #undeà
FLAG


86 
ssize_t
 
	$¡a_æags_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

87 
size_t
 
couÁ
, 
loff_t
 *
µos
)

89 
buf
[16 * 
NUM_WLAN_STA_FLAGS
], *
pos
 = buf;

90 *
’d
 = 
buf
 + (buf) - 1;

91 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

92 
æg
;

94 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
¡a_æag_Çmes
è!ğ
NUM_WLAN_STA_FLAGS
);

96 
æg
 = 0; flg < 
NUM_WLAN_STA_FLAGS
; flg++) {

97 ià(
	`‹¡_¡a_æag
(
¡a
, 
æg
))

98 
pos
 +ğ
	`sú´štf
Õos, 
’d
 -…os, "%s\n",

99 
¡a_æag_Çmes
[
æg
]);

102  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
	`¡¾’
(buf));

103 
	}
}

104 
STA_OPS
(
æags
);

106 
ssize_t
 
	$¡a_num_ps_buf_äames_»ad
(
fe
 *file,

107 
__u£r
 *
u£rbuf
,

108 
size_t
 
couÁ
, 
loff_t
 *
µos
)

110 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

111 
buf
[17*
IEEE80211_NUM_ACS
], *
p
 = buf;

112 
ac
;

114 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

115 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p, "AC%d: %d\n", 
ac
,

116 
	`skb_queue_Ën
(&
¡a
->
ps_tx_buf
[
ac
]) +

117 
	`skb_queue_Ën
(&
¡a
->
tx_f‹»d
[
ac
]));

118  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

119 
	}
}

120 
STA_OPS
(
num_ps_buf_äames
);

122 
ssize_t
 
	$¡a_Ï¡_£q_ù¾_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

123 
size_t
 
couÁ
, 
loff_t
 *
µos
)

125 
buf
[15*
IEEE80211_NUM_TIDS
], *
p
 = buf;

126 
i
;

127 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

128 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

129 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p, "%x ",

130 
	`Ë16_to_ıu
(
¡a
->
Ï¡_£q_ù¾
[
i
]));

131 
p
 +ğ
	`sú´štf
Õ, (
buf
)+buf-p, "\n");

132  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

133 
	}
}

134 
STA_OPS
(
Ï¡_£q_ù¾
);

136 
	#AQM_TXQ_ENTRY_LEN
 130

	)

138 
ssize_t
 
	$¡a_aqm_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

139 
size_t
 
couÁ
, 
loff_t
 *
µos
)

141 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

142 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

143 
size_t
 
bufsz
 = 
AQM_TXQ_ENTRY_LEN
 * (
IEEE80211_NUM_TIDS
 + 2);

144 *
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
), *
p
 = buf;

145 
txq_šfo
 *
txqi
;

146 
ssize_t
 
rv
;

147 
i
;

149 ià(!
buf
)

150  -
ENOMEM
;

152 
	`¥š_lock_bh
(&
loÿl
->
fq
.
lock
);

153 
	`rcu_»ad_lock
();

155 
p
 +ğ
	`sú´štf
(p,

156 
bufsz
 + 
buf
 - 
p
,

158 
	`cod–_time_to_us
(
¡a
->
ı¬ams
.
rg‘
),

159 
	`cod–_time_to_us
(
¡a
->
ı¬ams
.
š‹rv®
),

160 
¡a
->
ı¬ams
.
eú
 ? "yes" : "no");

161 
p
 +ğ
	`sú´štf
(p,

162 
bufsz
 + 
buf
 - 
p
,

165 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->¡a.
txq
); i++) {

166 ià(!
¡a
->¡a.
txq
[
i
])

168 
txqi
 = 
	`to_txq_šfo
(
¡a
->¡a.
txq
[
i
]);

169 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

171 
txqi
->
txq
.
tid
,

172 
txqi
->
txq
.
ac
,

173 
txqi
->
tš
.
backlog_by‹s
,

174 
txqi
->
tš
.
backlog_·ck‘s
,

175 
txqi
->
tš
.
æows
,

176 
txqi
->
c¡©s
.
drİ_couÁ
,

177 
txqi
->
c¡©s
.
eú_m¬k
,

178 
txqi
->
tš
.
ov”lim™
,

179 
txqi
->
tš
.
cŞlisiÚs
,

180 
txqi
->
tš
.
tx_by‹s
,

181 
txqi
->
tš
.
tx_·ck‘s
,

182 
txqi
->
æags
,

183 
	`‹¡_b™
(
IEEE80211_TXQ_STOP
, &
txqi
->
æags
) ? "STOP" : "RUN",

184 
	`‹¡_b™
(
IEEE80211_TXQ_AMPDU
, &
txqi
->
æags
) ? " AMPDU" : "",

185 
	`‹¡_b™
(
IEEE80211_TXQ_NO_AMSDU
, &
txqi
->
æags
) ? " NO-AMSDU" : "",

186 
	`‹¡_b™
(
IEEE80211_TXQ_DIRTY
, &
txqi
->
æags
) ? " DIRTY" : "");

189 
	`rcu_»ad_uÆock
();

190 
	`¥š_uÆock_bh
(&
loÿl
->
fq
.
lock
);

192 
rv
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

193 
	`kä“
(
buf
);

194  
rv
;

195 
	}
}

196 
STA_OPS
(
aqm
);

198 
ssize_t
 
	$¡a_aœtime_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

199 
size_t
 
couÁ
, 
loff_t
 *
µos
)

201 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

202 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

203 
size_t
 
bufsz
 = 400;

204 *
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
), *
p
 = buf;

205 
u64
 
rx_aœtime
 = 0, 
tx_aœtime
 = 0;

206 
s32
 
defic™
[
IEEE80211_NUM_ACS
];

207 
ssize_t
 
rv
;

208 
ac
;

210 ià(!
buf
)

211  -
ENOMEM
;

213 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

214 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

215 
rx_aœtime
 +ğ
¡a
->
aœtime
[
ac
].rx_airtime;

216 
tx_aœtime
 +ğ
¡a
->
aœtime
[
ac
].tx_airtime;

217 
defic™
[
ac
] = 
¡a
->
aœtime
[ac].deficit;

218 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

221 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

224 
rx_aœtime
, 
tx_aœtime
, 
¡a
->
aœtime_weight
,

225 
defic™
[0], deficit[1], deficit[2], deficit[3]);

227 
rv
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

228 
	`kä“
(
buf
);

229  
rv
;

230 
	}
}

232 
ssize_t
 
	$¡a_aœtime_wr™e
(
fe
 *fe, cÚ¡ 
__u£r
 *
u£rbuf
,

233 
size_t
 
couÁ
, 
loff_t
 *
µos
)

235 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

236 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

237 
ac
;

239 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

240 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

241 
¡a
->
aœtime
[
ac
].
rx_aœtime
 = 0;

242 
¡a
->
aœtime
[
ac
].
tx_aœtime
 = 0;

243 
¡a
->
aœtime
[
ac
].
defic™
 = s->
aœtime_weight
;

244 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

247  
couÁ
;

248 
	}
}

249 
STA_OPS_RW
(
aœtime
);

251 
ssize_t
 
	$¡a_aql_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

252 
size_t
 
couÁ
, 
loff_t
 *
µos
)

254 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

255 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

256 
size_t
 
bufsz
 = 400;

257 *
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
), *
p
 = buf;

258 
u32
 
q_d•th
[
IEEE80211_NUM_ACS
];

259 
u32
 
q_lim™_l
[
IEEE80211_NUM_ACS
], 
q_lim™_h
[IEEE80211_NUM_ACS];

260 
ssize_t
 
rv
;

261 
ac
;

263 ià(!
buf
)

264  -
ENOMEM
;

266 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

267 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

268 
q_lim™_l
[
ac
] = 
¡a
->
aœtime
[ac].
aql_lim™_low
;

269 
q_lim™_h
[
ac
] = 
¡a
->
aœtime
[ac].
aql_lim™_high
;

270 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

271 
q_d•th
[
ac
] = 
	`©omic_»ad
(&
¡a
->
aœtime
[ac].
aql_tx_³ndšg
);

274 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

277 
q_d•th
[0], q_depth[1], q_depth[2], q_depth[3],

278 
q_lim™_l
[0], 
q_lim™_h
[0], q_limit_l[1], q_limit_h[1],

279 
q_lim™_l
[2], 
q_lim™_h
[2], q_limit_l[3], q_limit_h[3]);

281 
rv
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

282 
	`kä“
(
buf
);

283  
rv
;

284 
	}
}

286 
ssize_t
 
	$¡a_aql_wr™e
(
fe
 *fe, cÚ¡ 
__u£r
 *
u£rbuf
,

287 
size_t
 
couÁ
, 
loff_t
 *
µos
)

289 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

290 
u32
 
ac
, 
q_lim™_l
, 
q_lim™_h
;

291 
_buf
[100] = {}, *
buf
 = _buf;

293 ià(
couÁ
 > (
_buf
))

294  -
EINVAL
;

296 ià(
	`cİy_äom_u£r
(
buf
, 
u£rbuf
, 
couÁ
))

297  -
EFAULT
;

299 
buf
[(
_buf
) - 1] = '\0';

300 ià(
	`ssÿnf
(
buf
, "lim™ %u %u %u", &
ac
, &
q_lim™_l
, &
q_lim™_h
)

302  -
EINVAL
;

304 ià(
ac
 >ğ
IEEE80211_NUM_ACS
)

305  -
EINVAL
;

307 
¡a
->
aœtime
[
ac
].
aql_lim™_low
 = 
q_lim™_l
;

308 
¡a
->
aœtime
[
ac
].
aql_lim™_high
 = 
q_lim™_h
;

310  
couÁ
;

311 
	}
}

312 
STA_OPS_RW
(
aql
);

315 
ssize_t
 
	$¡a_agg_¡©us_do_»ad
(
why
 *why, 
fe
 *file,

316 *
buf
, 
size_t
 
bufsz
, *
d©a
)

318 
¡a_šfo
 *
¡a
 = 
d©a
;

319 *
p
 = 
buf
;

320 
i
;

321 
tid_ampdu_rx
 *
tid_rx
;

322 
tid_ampdu_tx
 *
tid_tx
;

324 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "next dialog_token: %#02x\n",

325 
¡a
->
ampdu_mlme
.
dŸlog_tok’_®loÿtÜ
 + 1);

326 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

329 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++) {

330 
boŞ
 
tid_rx_v®id
;

332 
tid_rx
 = 
	`why_d”eã»nû
(
why
, 
¡a
->
ampdu_mlme
.tid_rx[
i
]);

333 
tid_tx
 = 
	`why_d”eã»nû
(
why
, 
¡a
->
ampdu_mlme
.tid_tx[
i
]);

334 
tid_rx_v®id
 = 
	`‹¡_b™
(
i
, 
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
);

336 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "%02d", 
i
);

337 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t\t%x",

338 
tid_rx_v®id
);

339 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t%#.2x",

340 
tid_rx_v®id
 ?

341 
¡a
->
ampdu_mlme
.
tid_rx_tok’
[
i
] : 0);

342 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t%#.3x",

343 
tid_rx
 ?id_rx->
s¢
 : 0);

345 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t\t%x", !!
tid_tx
);

346 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t%#.2x",

347 
tid_tx
 ?id_tx->
dŸlog_tok’
 : 0);

348 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t%03d",

349 
tid_tx
 ? 
	`skb_queue_Ën
(&tid_tx->
³ndšg
) : 0);

350 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\n");

353  
p
 - 
buf
;

354 
	}
}

356 
ssize_t
 
	$¡a_agg_¡©us_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

357 
size_t
 
couÁ
, 
loff_t
 *
µos
)

359 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

360 
why
 *why = 
¡a
->
loÿl
->
hw
.wiphy;

361 
size_t
 
bufsz
 = 71 + 
IEEE80211_NUM_TIDS
 * 40;

362 *
buf
 = 
	`km®loc
(
bufsz
, 
GFP_KERNEL
);

363 
ssize_t
 
»t
;

365 ià(!
buf
)

366  -
ENOMEM
;

368 
»t
 = 
	`why_locked_debugfs_»ad
(
why
, 
fe
, 
buf
, 
bufsz
,

369 
u£rbuf
, 
couÁ
, 
µos
,

370 
¡a_agg_¡©us_do_»ad
, 
¡a
);

371 
	`kä“
(
buf
);

373  
»t
;

374 
	}
}

376 
ssize_t
 
	$¡a_agg_¡©us_do_wr™e
(
why
 *why, 
fe
 *file,

377 *
buf
, 
size_t
 
couÁ
, *
d©a
)

379 
¡a_šfo
 *
¡a
 = 
d©a
;

380 
boŞ
 
¡¬t
, 
tx
;

381 
tid
;

382 *
pos
 = 
buf
;

383 
»t
, 
timeout
 = 5000;

385 
buf
 = 
	`¡r£p
(&
pos
, " ");

386 ià(!
buf
)

387  -
EINVAL
;

389 ià(!
	`¡rcmp
(
buf
, "tx"))

390 
tx
 = 
Œue
;

391 ià(!
	`¡rcmp
(
buf
, "rx"))

392 
tx
 = 
çl£
;

394  -
EINVAL
;

396 
buf
 = 
	`¡r£p
(&
pos
, " ");

397 ià(!
buf
)

398  -
EINVAL
;

399 ià(!
	`¡rcmp
(
buf
, "start")) {

400 
¡¬t
 = 
Œue
;

401 ià(!
tx
)

402  -
EINVAL
;

403 } ià(!
	`¡rcmp
(
buf
, "stop")) {

404 
¡¬t
 = 
çl£
;

406  -
EINVAL
;

409 
buf
 = 
	`¡r£p
(&
pos
, " ");

410 ià(!
buf
)

411  -
EINVAL
;

412 ià(
	`ssÿnf
(
buf
, "timeout=%d", &
timeout
) == 1) {

413 
buf
 = 
	`¡r£p
(&
pos
, " ");

414 ià(!
buf
 || !
tx
 || !
¡¬t
)

415  -
EINVAL
;

418 
»t
 = 
	`k¡¹oul
(
buf
, 0, &
tid
);

419 ià(
»t
 || 
tid
 >ğ
IEEE80211_NUM_TIDS
)

420  -
EINVAL
;

422 ià(
tx
) {

423 ià(
¡¬t
)

424 
»t
 = 
	`›“80211_¡¬t_tx_ba_£ssiÚ
(&
¡a
->¡a, 
tid
,

425 
timeout
);

427 
»t
 = 
	`›“80211_¡İ_tx_ba_£ssiÚ
(&
¡a
->¡a, 
tid
);

429 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(
¡a
, 
tid
, 
WLAN_BACK_RECIPIENT
,

430 3, 
Œue
);

431 
»t
 = 0;

434  
»t
 ?: 
couÁ
;

435 
	}
}

437 
ssize_t
 
	$¡a_agg_¡©us_wr™e
(
fe
 *file,

438 cÚ¡ 
__u£r
 *
u£rbuf
,

439 
size_t
 
couÁ
, 
loff_t
 *
µos
)

441 
¡a_šfo
 *
¡a
 = 
fe
->
´iv©e_d©a
;

442 
why
 *why = 
¡a
->
loÿl
->
hw
.wiphy;

443 
_buf
[26];

445  
	`why_locked_debugfs_wr™e
(
why
, 
fe
, 
_buf
, (_buf),

446 
u£rbuf
, 
couÁ
,

447 
¡a_agg_¡©us_do_wr™e
, 
¡a
);

448 
	}
}

449 
STA_OPS_RW
(
agg_¡©us
);

452 
	#LINK_STA_OPS
(
Çme
) \

453 cÚ¡ 
fe_İ”©iÚs
 
lšk_¡a_
 ##
Çme
## 
_İs
 = { \

454 .
»ad
 = 
lšk_¡a_
##
Çme
##
_»ad
, \

455 .
İ’
 = 
sim¶e_İ’
, \

456 .
Î£ek
 = 
g’”ic_fe_Î£ek
, \

457 }

	)

459 
ssize_t
 
	$lšk_¡a_addr_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

460 
size_t
 
couÁ
, 
loff_t
 *
µos
)

462 
lšk_¡a_šfo
 *
lšk_¡a
 = 
fe
->
´iv©e_d©a
;

463 
u8
 
mac
[3 * 
ETH_ALEN
 + 1];

465 
	`¢´štf
(
mac
, (mac), "%pM\n", 
lšk_¡a
->
pub
->
addr
);

467  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
mac
, 3 * 
ETH_ALEN
);

468 
	}
}

470 
LINK_STA_OPS
(
addr
);

472 
ssize_t
 
	$lšk_¡a_ht_ÿ·_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

473 
size_t
 
couÁ
, 
loff_t
 *
µos
)

475 
	#PRINT_HT_CAP
(
_cÚd
, 
_¡r
) \

477 ià(
_cÚd
) \

478 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\t" 
_¡r
 "\n"); \

479 } 0)

	)

480 *
buf
, *
p
;

481 
i
;

482 
ssize_t
 
bufsz
 = 512;

483 
lšk_¡a_šfo
 *
lšk_¡a
 = 
fe
->
´iv©e_d©a
;

484 
›“80211_¡a_ht_ÿp
 *
htc
 = &
lšk_¡a
->
pub
->
ht_ÿp
;

485 
ssize_t
 
»t
;

487 
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
);

488 ià(!
buf
)

489  -
ENOMEM
;

490 
p
 = 
buf
;

492 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "ht %ssupported\n",

493 
htc
->
ht_suµÜ‹d
 ? "" : "not ");

494 ià(
htc
->
ht_suµÜ‹d
) {

495 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "ÿp: %#.4x\n", 
htc
->
ÿp
);

497 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(0)), "RX LDPC");

498 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(1)), "HT20/HT40");

499 
	`PRINT_HT_CAP
(!(
htc
->
ÿp
 & 
	`BIT
(1)), "HT20");

501 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 2) & 0x3) == 0, "Static SM Power Save");

502 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 2) & 0x3) == 1, "Dynamic SM Power Save");

503 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 2) & 0x3) == 3, "SM Power Save disabled");

505 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(4)), "RX Greenfield");

506 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(5)), "RX HT20 SGI");

507 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(6)), "RX HT40 SGI");

508 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(7)), "TX STBC");

510 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 8) & 0x3) == 0, "No RX STBC");

511 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 8) & 0x3) == 1, "RX STBC 1-stream");

512 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 8) & 0x3) == 2, "RX STBC 2-streams");

513 
	`PRINT_HT_CAP
(((
htc
->
ÿp
 >> 8) & 0x3) == 3, "RX STBC 3-streams");

515 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(10)), "HT Delayed Block Ack");

517 
	`PRINT_HT_CAP
(!(
htc
->
ÿp
 & 
	`BIT
(11)), "Max AMSDU†ength: "

519 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(11)), "Max AMSDU†ength: "

528 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(12)), "DSSS/CCK HT40");

529 
	`PRINT_HT_CAP
(!(
htc
->
ÿp
 & 
	`BIT
(12)), "No DSSS/CCK HT40");

533 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(14)), "40 MHz Intolerant");

535 
	`PRINT_HT_CAP
((
htc
->
ÿp
 & 
	`BIT
(15)), "L-SIG TXOP…rotection");

537 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "ampdu factor/density: %d/%d\n",

538 
htc
->
ampdu_çùÜ
, htc->
ampdu_d’s™y
);

539 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "MCS mask:");

541 
i
 = 0; i < 
IEEE80211_HT_MCS_MASK_LEN
; i++)

542 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, " %.2x",

543 
htc
->
mcs
.
rx_mask
[
i
]);

544 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "\n");

547 ià(
	`Ë16_to_ıu
(
htc
->
mcs
.
rx_highe¡
)) {

548 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

550 
	`Ë16_to_ıu
(
htc
->
mcs
.
rx_highe¡
));

553 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "MCSx…arams: %x\n",

554 
htc
->
mcs
.
tx_·¿ms
);

557 
»t
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

558 
	`kä“
(
buf
);

559  
»t
;

560 
	}
}

561 
LINK_STA_OPS
(
ht_ÿ·
);

563 
ssize_t
 
	$lšk_¡a_vht_ÿ·_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

564 
size_t
 
couÁ
, 
loff_t
 *
µos
)

566 *
buf
, *
p
;

567 
lšk_¡a_šfo
 *
lšk_¡a
 = 
fe
->
´iv©e_d©a
;

568 
›“80211_¡a_vht_ÿp
 *
vhtc
 = &
lšk_¡a
->
pub
->
vht_ÿp
;

569 
ssize_t
 
»t
;

570 
ssize_t
 
bufsz
 = 512;

572 
buf
 = 
	`kz®loc
(
bufsz
, 
GFP_KERNEL
);

573 ià(!
buf
)

574  -
ENOMEM
;

575 
p
 = 
buf
;

577 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "VHT %ssupported\n",

578 
vhtc
->
vht_suµÜ‹d
 ? "" : "not ");

579 ià(
vhtc
->
vht_suµÜ‹d
) {

580 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "cap: %#.8x\n",

581 
vhtc
->
ÿp
);

582 
	#PFLAG
(
a
, 
b
) \

584 ià(
vhtc
->
ÿp
 & 
IEEE80211_VHT_CAP_
 ## 
a
) \

585 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, \

586 "\t\t%s\n", 
b
); \

587 } 0)

	)

589 
vhtc
->
ÿp
 & 0x3) {

590 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_3895
:

591 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

594 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991
:

595 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

598 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
:

599 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

603 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

606 
vhtc
->
ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
) {

608 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

611 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
:

612 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

615 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
:

616 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

620 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

622 (
vhtc
->
ÿp
 >> 2) & 0x3);

624 
	`PFLAG
(
RXLDPC
, "RXLDPC");

625 
	`PFLAG
(
SHORT_GI_80
, "SHORT-GI-80");

626 
	`PFLAG
(
SHORT_GI_160
, "SHORT-GI-160");

627 
	`PFLAG
(
TXSTBC
, "TXSTBC");

628 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

629 "\t\tRXSTBC_%d\n", (
vhtc
->
ÿp
 >> 8) & 0x7);

630 
	`PFLAG
(
SU_BEAMFORMER_CAPABLE
, "SU-BEAMFORMER-CAPABLE");

631 
	`PFLAG
(
SU_BEAMFORMEE_CAPABLE
, "SU-BEAMFORMEE-CAPABLE");

632 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

634 (
vhtc
->
ÿp
 & 
IEEE80211_VHT_CAP_BEAMFORMEE_STS_MASK
) >>

635 
IEEE80211_VHT_CAP_BEAMFORMEE_STS_SHIFT
);

636 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

638 (
vhtc
->
ÿp
 & 
IEEE80211_VHT_CAP_SOUNDING_DIMENSIONS_MASK
)

639 >> 
IEEE80211_VHT_CAP_SOUNDING_DIMENSIONS_SHIFT
);

640 
	`PFLAG
(
MU_BEAMFORMER_CAPABLE
, "MU-BEAMFORMER-CAPABLE");

641 
	`PFLAG
(
MU_BEAMFORMEE_CAPABLE
, "MU-BEAMFORMEE-CAPABLE");

642 
	`PFLAG
(
VHT_TXOP_PS
, "TXOP-PS");

643 
	`PFLAG
(
HTC_VHT
, "HTC-VHT");

644 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

646 (
vhtc
->
ÿp
 & 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
) >>

647 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_SHIFT
);

648 
	`PFLAG
(
VHT_LINK_ADAPTATION_VHT_UNSOL_MFB
,

650 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

652 (
vhtc
->
ÿp
 & 
IEEE80211_VHT_CAP_VHT_LINK_ADAPTATION_VHT_MRQ_MFB
) >> 26);

653 
	`PFLAG
(
RX_ANTENNA_PATTERN
, "RX-ANTENNA-PATTERN");

654 
	`PFLAG
(
TX_ANTENNA_PATTERN
, "TX-ANTENNA-PATTERN");

656 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "RX MCS: %.4x\n",

657 
	`Ë16_to_ıu
(
vhtc
->
vht_mcs
.
rx_mcs_m­
));

658 ià(
vhtc
->
vht_mcs
.
rx_highe¡
)

659 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

661 
	`Ë16_to_ıu
(
vhtc
->
vht_mcs
.
rx_highe¡
));

662 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…, "TX MCS: %.4x\n",

663 
	`Ë16_to_ıu
(
vhtc
->
vht_mcs
.
tx_mcs_m­
));

664 ià(
vhtc
->
vht_mcs
.
tx_highe¡
)

665 
p
 +ğ
	`sú´štf
Õ, 
bufsz
 + 
buf
 -…,

667 
	`Ë16_to_ıu
(
vhtc
->
vht_mcs
.
tx_highe¡
));

668 #undeà
PFLAG


671 
»t
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

672 
	`kä“
(
buf
);

673  
»t
;

674 
	}
}

675 
LINK_STA_OPS
(
vht_ÿ·
);

677 
ssize_t
 
	$lšk_¡a_he_ÿ·_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

678 
size_t
 
couÁ
, 
loff_t
 *
µos
)

680 *
buf
, *
p
;

681 
size_t
 
buf_sz
 = 
PAGE_SIZE
;

682 
lšk_¡a_šfo
 *
lšk_¡a
 = 
fe
->
´iv©e_d©a
;

683 
›“80211_¡a_he_ÿp
 *
hec
 = &
lšk_¡a
->
pub
->
he_ÿp
;

684 
›“80211_he_mcs_nss_suµ
 *
nss
 = &
hec
->
he_mcs_nss_suµ
;

685 
u8
 
µe_size
;

686 
u8
 *
ÿp
;

687 
i
;

688 
ssize_t
 
»t
;

690 
buf
 = 
	`km®loc
(
buf_sz
, 
GFP_KERNEL
);

691 ià(!
buf
)

692  -
ENOMEM
;

693 
p
 = 
buf
;

695 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "HE %ssupported\n",

696 
hec
->
has_he
 ? "" : "not ");

697 ià(!
hec
->
has_he
)

698 
out
;

700 
ÿp
 = 
hec
->
he_ÿp_–em
.
mac_ÿp_šfo
;

701 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…,

703 
ÿp
[0], cap[1], cap[2], cap[3], cap[4], cap[5]);

705 
	#PRINT
(
fmt
, ...) \

706 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "\t\t" 
fmt
 "\n", \

707 ##
__VA_ARGS__
)

	)

709 
	#PFLAG
(
t
, 
n
, 
a
, 
b
) \

711 ià(
ÿp
[
n
] & 
IEEE80211_HE_
##
t
##
_CAP
##n##
_
##
a
) \

712 
	`PRINT
("%s", 
b
); \

713 } 0)

	)

715 
	#PFLAG_RANGE
(
t
, 
i
, 
n
, 
s
, 
m
, 
off
, 
fmt
) \

717 
u8
 
msk
 = 
IEEE80211_HE_
##
t
##
_CAP
##
i
##
_
##
n
##
_MASK
; \

718 
u8
 
idx
 = ((
ÿp
[
i
] & 
msk
è>> (
	`ffs
(mskè- 1)è+ 
off
; \

719 
	`PRINT
(
fmt
, (
s
 << 
idx
è+ (
m
 * idx)); \

720 } 0)

	)

722 
	#PFLAG_RANGE_DEFAULT
(
t
, 
i
, 
n
, 
s
, 
m
, 
off
, 
fmt
, 
a
, 
b
) \

724 ià(
ÿp
[
i
] =ğ
IEEE80211_HE_
##
t
 ##
_CAP
##i##
_
##
n
##_##
a
) { \

725 
	`PRINT
("%s", 
b
); \

728 
	`PFLAG_RANGE
(
t
, 
i
, 
n
, 
s
, 
m
, 
off
, 
fmt
); \

729 } 0)

	)

731 
	`PFLAG
(
MAC
, 0, 
HTC_HE
, "HTC-HE");

732 
	`PFLAG
(
MAC
, 0, 
TWT_REQ
, "TWT-REQ");

733 
	`PFLAG
(
MAC
, 0, 
TWT_RES
, "TWT-RES");

734 
	`PFLAG_RANGE_DEFAULT
(
MAC
, 0, 
DYNAMIC_FRAG
, 0, 1, 0,

735 "DYNAMIC-FRAG-LEVEL-%d", 
NOT_SUPP
, "NOT-SUPP");

736 
	`PFLAG_RANGE_DEFAULT
(
MAC
, 0, 
MAX_NUM_FRAG_MSDU
, 1, 0, 0,

737 "MAX-NUM-FRAG-MSDU-%d", 
UNLIMITED
, "UNLIMITED");

739 
	`PFLAG_RANGE_DEFAULT
(
MAC
, 1, 
MIN_FRAG_SIZE
, 128, 0, -1,

740 "MIN-FRAG-SIZE-%d", 
UNLIMITED
, "UNLIMITED");

741 
	`PFLAG_RANGE_DEFAULT
(
MAC
, 1, 
TF_MAC_PAD_DUR
, 0, 8, 0,

742 "TF-MAC-PAD-DUR-%dUS", 
MASK
, "UNKNOWN");

743 
	`PFLAG_RANGE
(
MAC
, 1, 
MULTI_TID_AGG_RX_QOS
, 0, 1, 1,

746 ià(
ÿp
[0] & 
IEEE80211_HE_MAC_CAP0_HTC_HE
) {

747 ((
ÿp
[2] << 1) | (cap[1] >> 7)) & 0x3) {

749 
	`PRINT
("LINK-ADAPTATION-NO-FEEDBACK");

752 
	`PRINT
("LINK-ADAPTATION-RESERVED");

755 
	`PRINT
("LINK-ADAPTATION-UNSOLICITED-FEEDBACK");

758 
	`PRINT
("LINK-ADAPTATION-BOTH");

763 
	`PFLAG
(
MAC
, 2, 
ALL_ACK
, "ALL-ACK");

764 
	`PFLAG
(
MAC
, 2, 
TRS
, "TRS");

765 
	`PFLAG
(
MAC
, 2, 
BSR
, "BSR");

766 
	`PFLAG
(
MAC
, 2, 
BCAST_TWT
, "BCAST-TWT");

767 
	`PFLAG
(
MAC
, 2, 32B
IT_BA_BITMAP
, "32BIT-BA-BITMAP");

768 
	`PFLAG
(
MAC
, 2, 
MU_CASCADING
, "MU-CASCADING");

769 
	`PFLAG
(
MAC
, 2, 
ACK_EN
, "ACK-EN");

771 
	`PFLAG
(
MAC
, 3, 
OMI_CONTROL
, "OMI-CONTROL");

772 
	`PFLAG
(
MAC
, 3, 
OFDMA_RA
, "OFDMA-RA");

774 
ÿp
[3] & 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_MASK
) {

775 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_0
:

776 
	`PRINT
("MAX-AMPDU-LEN-EXP-USE-EXT-0");

778 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_1
:

779 
	`PRINT
("MAX-AMPDU-LEN-EXP-VHT-EXT-1");

781 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_2
:

782 
	`PRINT
("MAX-AMPDU-LEN-EXP-VHT-EXT-2");

784 
IEEE80211_HE_MAC_CAP3_MAX_AMPDU_LEN_EXP_EXT_3
:

785 
	`PRINT
("MAX-AMPDU-LEN-EXP-VHT-EXT-3");

789 
	`PFLAG
(
MAC
, 3, 
AMSDU_FRAG
, "AMSDU-FRAG");

790 
	`PFLAG
(
MAC
, 3, 
FLEX_TWT_SCHED
, "FLEX-TWT-SCHED");

791 
	`PFLAG
(
MAC
, 3, 
RX_CTRL_FRAME_TO_MULTIBSS
, "RX-CTRL-FRAME-TO-MULTIBSS");

793 
	`PFLAG
(
MAC
, 4, 
BSRP_BQRP_A_MPDU_AGG
, "BSRP-BQRP-A-MPDU-AGG");

794 
	`PFLAG
(
MAC
, 4, 
QTP
, "QTP");

795 
	`PFLAG
(
MAC
, 4, 
BQR
, "BQR");

796 
	`PFLAG
(
MAC
, 4, 
PSR_RESP
, "PSR-RESP");

797 
	`PFLAG
(
MAC
, 4, 
NDP_FB_REP
, "NDP-FB-REP");

798 
	`PFLAG
(
MAC
, 4, 
OPS
, "OPS");

799 
	`PFLAG
(
MAC
, 4, 
AMSDU_IN_AMPDU
, "AMSDU-IN-AMPDU");

801 
	`PRINT
("MULTI-TID-AGG-TX-QOS-%d", ((
ÿp
[5] << 1) | (cap[4] >> 7)) & 0x7);

803 
	`PFLAG
(
MAC
, 5, 
SUBCHAN_SELECTIVE_TRANSMISSION
,

805 
	`PFLAG
(
MAC
, 5, 
UL_2x996_TONE_RU
, "UL-2x996-TONE-RU");

806 
	`PFLAG
(
MAC
, 5, 
OM_CTRL_UL_MU_DATA_DIS_RX
, "OM-CTRL-UL-MU-DATA-DIS-RX");

807 
	`PFLAG
(
MAC
, 5, 
HE_DYNAMIC_SM_PS
, "HE-DYNAMIC-SM-PS");

808 
	`PFLAG
(
MAC
, 5, 
PUNCTURED_SOUNDING
, "PUNCTURED-SOUNDING");

809 
	`PFLAG
(
MAC
, 5, 
HT_VHT_TRIG_FRAME_RX
, "HT-VHT-TRIG-FRAME-RX");

811 
ÿp
 = 
hec
->
he_ÿp_–em
.
phy_ÿp_šfo
;

812 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…,

814 
ÿp
[0], cap[1], cap[2], cap[3], cap[4], cap[5], cap[6],

815 
ÿp
[7], cap[8], cap[9], cap[10]);

817 
	`PFLAG
(
PHY
, 0, 
CHANNEL_WIDTH_SET_40MHZ_IN_2G
,

819 
	`PFLAG
(
PHY
, 0, 
CHANNEL_WIDTH_SET_40MHZ_80MHZ_IN_5G
,

821 
	`PFLAG
(
PHY
, 0, 
CHANNEL_WIDTH_SET_160MHZ_IN_5G
,

823 
	`PFLAG
(
PHY
, 0, 
CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
,

825 
	`PFLAG
(
PHY
, 0, 
CHANNEL_WIDTH_SET_RU_MAPPING_IN_2G
,

827 
	`PFLAG
(
PHY
, 0, 
CHANNEL_WIDTH_SET_RU_MAPPING_IN_5G
,

830 
ÿp
[1] & 
IEEE80211_HE_PHY_CAP1_PREAMBLE_PUNC_RX_MASK
) {

831 
IEEE80211_HE_PHY_CAP1_PREAMBLE_PUNC_RX_80MHZ_ONLY_SECOND_20MHZ
:

832 
	`PRINT
("PREAMBLE-PUNC-RX-80MHZ-ONLY-SECOND-20MHZ");

834 
IEEE80211_HE_PHY_CAP1_PREAMBLE_PUNC_RX_80MHZ_ONLY_SECOND_40MHZ
:

835 
	`PRINT
("PREAMBLE-PUNC-RX-80MHZ-ONLY-SECOND-40MHZ");

837 
IEEE80211_HE_PHY_CAP1_PREAMBLE_PUNC_RX_160MHZ_ONLY_SECOND_20MHZ
:

838 
	`PRINT
("PREAMBLE-PUNC-RX-160MHZ-ONLY-SECOND-20MHZ");

840 
IEEE80211_HE_PHY_CAP1_PREAMBLE_PUNC_RX_160MHZ_ONLY_SECOND_40MHZ
:

841 
	`PRINT
("PREAMBLE-PUNC-RX-160MHZ-ONLY-SECOND-40MHZ");

845 
	`PFLAG
(
PHY
, 1, 
DEVICE_CLASS_A
,

847 
	`PFLAG
(
PHY
, 1, 
LDPC_CODING_IN_PAYLOAD
,

849 
	`PFLAG
(
PHY
, 1, 
HE_LTF_AND_GI_FOR_HE_PPDUS_0_8US
,

851 
	`PRINT
("MIDAMBLE-RX-MAX-NSTS-%d", ((
ÿp
[2] << 1) | (cap[1] >> 7)) & 0x3);

853 
	`PFLAG
(
PHY
, 2, 
NDP_4x_LTF_AND_3_2US
, "NDP-4X-LTF-AND-3-2US");

854 
	`PFLAG
(
PHY
, 2, 
STBC_TX_UNDER_80MHZ
, "STBC-TX-UNDER-80MHZ");

855 
	`PFLAG
(
PHY
, 2, 
STBC_RX_UNDER_80MHZ
, "STBC-RX-UNDER-80MHZ");

856 
	`PFLAG
(
PHY
, 2, 
DOPPLER_TX
, "DOPPLER-TX");

857 
	`PFLAG
(
PHY
, 2, 
DOPPLER_RX
, "DOPPLER-RX");

858 
	`PFLAG
(
PHY
, 2, 
UL_MU_FULL_MU_MIMO
, "UL-MU-FULL-MU-MIMO");

859 
	`PFLAG
(
PHY
, 2, 
UL_MU_PARTIAL_MU_MIMO
, "UL-MU-PARTIAL-MU-MIMO");

861 
ÿp
[3] & 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_MASK
) {

862 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_NO_DCM
:

863 
	`PRINT
("DCM-MAX-CONST-TX-NO-DCM");

865 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_BPSK
:

866 
	`PRINT
("DCM-MAX-CONST-TX-BPSK");

868 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_QPSK
:

869 
	`PRINT
("DCM-MAX-CONST-TX-QPSK");

871 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_TX_16_QAM
:

872 
	`PRINT
("DCM-MAX-CONST-TX-16-QAM");

876 
	`PFLAG
(
PHY
, 3, 
DCM_MAX_TX_NSS_1
, "DCM-MAX-TX-NSS-1");

877 
	`PFLAG
(
PHY
, 3, 
DCM_MAX_TX_NSS_2
, "DCM-MAX-TX-NSS-2");

879 
ÿp
[3] & 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_MASK
) {

880 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_NO_DCM
:

881 
	`PRINT
("DCM-MAX-CONST-RX-NO-DCM");

883 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_BPSK
:

884 
	`PRINT
("DCM-MAX-CONST-RX-BPSK");

886 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_QPSK
:

887 
	`PRINT
("DCM-MAX-CONST-RX-QPSK");

889 
IEEE80211_HE_PHY_CAP3_DCM_MAX_CONST_RX_16_QAM
:

890 
	`PRINT
("DCM-MAX-CONST-RX-16-QAM");

894 
	`PFLAG
(
PHY
, 3, 
DCM_MAX_RX_NSS_1
, "DCM-MAX-RX-NSS-1");

895 
	`PFLAG
(
PHY
, 3, 
DCM_MAX_RX_NSS_2
, "DCM-MAX-RX-NSS-2");

896 
	`PFLAG
(
PHY
, 3, 
RX_PARTIAL_BW_SU_IN_20MHZ_MU
,

898 
	`PFLAG
(
PHY
, 3, 
SU_BEAMFORMER
, "SU-BEAMFORMER");

900 
	`PFLAG
(
PHY
, 4, 
SU_BEAMFORMEE
, "SU-BEAMFORMEE");

901 
	`PFLAG
(
PHY
, 4, 
MU_BEAMFORMER
, "MU-BEAMFORMER");

903 
	`PFLAG_RANGE
(
PHY
, 4, 
BEAMFORMEE_MAX_STS_UNDER_80MHZ
, 0, 1, 4,

905 
	`PFLAG_RANGE
(
PHY
, 4, 
BEAMFORMEE_MAX_STS_ABOVE_80MHZ
, 0, 1, 4,

908 
	`PFLAG_RANGE
(
PHY
, 5, 
BEAMFORMEE_NUM_SND_DIM_UNDER_80MHZ
, 0, 1, 1,

910 
	`PFLAG_RANGE
(
PHY
, 5, 
BEAMFORMEE_NUM_SND_DIM_ABOVE_80MHZ
, 0, 1, 1,

912 
	`PFLAG
(
PHY
, 5, 
NG16_SU_FEEDBACK
, "NG16-SU-FEEDBACK");

913 
	`PFLAG
(
PHY
, 5, 
NG16_MU_FEEDBACK
, "NG16-MU-FEEDBACK");

915 
	`PFLAG
(
PHY
, 6, 
CODEBOOK_SIZE_42_SU
, "CODEBOOK-SIZE-42-SU");

916 
	`PFLAG
(
PHY
, 6, 
CODEBOOK_SIZE_75_MU
, "CODEBOOK-SIZE-75-MU");

917 
	`PFLAG
(
PHY
, 6, 
TRIG_SU_BEAMFORMING_FB
, "TRIG-SU-BEAMFORMING-FB");

918 
	`PFLAG
(
PHY
, 6, 
TRIG_MU_BEAMFORMING_PARTIAL_BW_FB
,

920 
	`PFLAG
(
PHY
, 6, 
TRIG_CQI_FB
, "TRIG-CQI-FB");

921 
	`PFLAG
(
PHY
, 6, 
PARTIAL_BW_EXT_RANGE
, "PARTIAL-BW-EXT-RANGE");

922 
	`PFLAG
(
PHY
, 6, 
PARTIAL_BANDWIDTH_DL_MUMIMO
,

924 
	`PFLAG
(
PHY
, 6, 
PPE_THRESHOLD_PRESENT
, "PPE-THRESHOLD-PRESENT");

926 
	`PFLAG
(
PHY
, 7, 
PSR_BASED_SR
, "PSR-BASED-SR");

927 
	`PFLAG
(
PHY
, 7, 
POWER_BOOST_FACTOR_SUPP
, "POWER-BOOST-FACTOR-SUPP");

928 
	`PFLAG
(
PHY
, 7, 
HE_SU_MU_PPDU_4XLTF_AND_08_US_GI
,

930 
	`PFLAG_RANGE
(
PHY
, 7, 
MAX_NC
, 0, 1, 1, "MAX-NC-%d");

931 
	`PFLAG
(
PHY
, 7, 
STBC_TX_ABOVE_80MHZ
, "STBC-TX-ABOVE-80MHZ");

932 
	`PFLAG
(
PHY
, 7, 
STBC_RX_ABOVE_80MHZ
, "STBC-RX-ABOVE-80MHZ");

934 
	`PFLAG
(
PHY
, 8, 
HE_ER_SU_PPDU_4XLTF_AND_08_US_GI
,

936 
	`PFLAG
(
PHY
, 8, 20
MHZ_IN_40MHZ_HE_PPDU_IN_2G
,

938 
	`PFLAG
(
PHY
, 8, 20
MHZ_IN_160MHZ_HE_PPDU
, "20MHZ-IN-160MHZ-HE-PPDU");

939 
	`PFLAG
(
PHY
, 8, 80
MHZ_IN_160MHZ_HE_PPDU
, "80MHZ-IN-160MHZ-HE-PPDU");

940 
	`PFLAG
(
PHY
, 8, 
HE_ER_SU_1XLTF_AND_08_US_GI
,

942 
	`PFLAG
(
PHY
, 8, 
MIDAMBLE_RX_TX_2X_AND_1XLTF
,

945 
ÿp
[8] & 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_MASK
) {

946 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_242
:

947 
	`PRINT
("DCM-MAX-RU-242");

949 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_484
:

950 
	`PRINT
("DCM-MAX-RU-484");

952 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_996
:

953 
	`PRINT
("DCM-MAX-RU-996");

955 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_2x996
:

956 
	`PRINT
("DCM-MAX-RU-2x996");

960 
	`PFLAG
(
PHY
, 9, 
LONGER_THAN_16_SIGB_OFDM_SYM
,

962 
	`PFLAG
(
PHY
, 9, 
NON_TRIGGERED_CQI_FEEDBACK
,

964 
	`PFLAG
(
PHY
, 9, 
TX_1024_QAM_LESS_THAN_242_TONE_RU
,

966 
	`PFLAG
(
PHY
, 9, 
RX_1024_QAM_LESS_THAN_242_TONE_RU
,

968 
	`PFLAG
(
PHY
, 9, 
RX_FULL_BW_SU_USING_MU_WITH_COMP_SIGB
,

970 
	`PFLAG
(
PHY
, 9, 
RX_FULL_BW_SU_USING_MU_WITH_NON_COMP_SIGB
,

973 
	`u8_g‘_b™s
(
ÿp
[9],

974 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_MASK
)) {

975 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_0US
:

976 
	`PRINT
("NOMINAL-PACKET-PADDING-0US");

978 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_8US
:

979 
	`PRINT
("NOMINAL-PACKET-PADDING-8US");

981 
IEEE80211_HE_PHY_CAP9_NOMINAL_PKT_PADDING_16US
:

982 
	`PRINT
("NOMINAL-PACKET-PADDING-16US");

986 #undeà
PFLAG_RANGE_DEFAULT


987 #undeà
PFLAG_RANGE


988 #undeà
PFLAG


990 
	#PRINT_NSS_SUPP
(
f
, 
n
) \

992 
_i
; \

993 
u16
 
v
 = 
	`Ë16_to_ıu
(
nss
->
f
); \

994 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, 
n
 ": %#.4x\n", 
v
); \

995 
_i
 = 0; _i < 8; _i += 2) { \

996 (
v
 >> 
_i
) & 0x3) { \

998 
	`PRINT
(
n
 "-%d-SUPPORT-0-7", 
_i
 / 2); \

1001 
	`PRINT
(
n
 "-%d-SUPPORT-0-9", 
_i
 / 2); \

1004 
	`PRINT
(
n
 "-%d-SUPPORT-0-11", 
_i
 / 2); \

1007 
	`PRINT
(
n
 "-%d-NOT-SUPPORTED", 
_i
 / 2); \

1011 } 0)

	)

1013 
	`PRINT_NSS_SUPP
(
rx_mcs_80
, "RX-MCS-80");

1014 
	`PRINT_NSS_SUPP
(
tx_mcs_80
, "TX-MCS-80");

1016 ià(
ÿp
[0] & 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
) {

1017 
	`PRINT_NSS_SUPP
(
rx_mcs_160
, "RX-MCS-160");

1018 
	`PRINT_NSS_SUPP
(
tx_mcs_160
, "TX-MCS-160");

1021 ià(
ÿp
[0] &

1022 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
) {

1023 
	`PRINT_NSS_SUPP
(
rx_mcs_80p80
, "RX-MCS-80P80");

1024 
	`PRINT_NSS_SUPP
(
tx_mcs_80p80
, "TX-MCS-80P80");

1027 #undeà
PRINT_NSS_SUPP


1028 #undeà
PRINT


1030 ià(!(
ÿp
[6] & 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
))

1031 
out
;

1033 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "PPE-THRESHOLDS: %#.2x",

1034 
hec
->
µe_th»s
[0]);

1036 
µe_size
 = 
	`›“80211_he_µe_size
(
hec
->
µe_th»s
[0], 
ÿp
);

1037 
i
 = 1; i < 
µe_size
; i++) {

1038 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, " %#.2x",

1039 
hec
->
µe_th»s
[
i
]);

1041 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "\n");

1043 
out
:

1044 
»t
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

1045 
	`kä“
(
buf
);

1046  
»t
;

1047 
	}
}

1048 
LINK_STA_OPS
(
he_ÿ·
);

1050 
ssize_t
 
	$lšk_¡a_eht_ÿ·_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

1051 
size_t
 
couÁ
, 
loff_t
 *
µos
)

1053 *
buf
, *
p
;

1054 
size_t
 
buf_sz
 = 
PAGE_SIZE
;

1055 
lšk_¡a_šfo
 *
lšk_¡a
 = 
fe
->
´iv©e_d©a
;

1056 
›“80211_¡a_eht_ÿp
 *
bec
 = &
lšk_¡a
->
pub
->
eht_ÿp
;

1057 
›“80211_eht_ÿp_–em_fixed
 *
fixed
 = &
bec
->
eht_ÿp_–em
;

1058 
›“80211_eht_mcs_nss_suµ
 *
nss
 = &
bec
->
eht_mcs_nss_suµ
;

1059 
u8
 *
ÿp
;

1060 
i
;

1061 
ssize_t
 
»t
;

1062 cÚ¡ *
mcs_desc
[] = { "0-7", "8-9", "10-11", "12-13"};

1064 
buf
 = 
	`km®loc
(
buf_sz
, 
GFP_KERNEL
);

1065 ià(!
buf
)

1066  -
ENOMEM
;

1067 
p
 = 
buf
;

1069 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "EHT %ssupported\n",

1070 
bec
->
has_eht
 ? "" : "not ");

1071 ià(!
bec
->
has_eht
)

1072 
out
;

1074 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…,

1076 
fixed
->
mac_ÿp_šfo
[0], fixed->mac_cap_info[1]);

1077 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…,

1079 
fixed
->
phy_ÿp_šfo
[0], fixed->phy_cap_info[1],

1080 
fixed
->
phy_ÿp_šfo
[2], fixed->phy_cap_info[3],

1081 
fixed
->
phy_ÿp_šfo
[4], fixed->phy_cap_info[5],

1082 
fixed
->
phy_ÿp_šfo
[6], fixed->phy_cap_info[7],

1083 
fixed
->
phy_ÿp_šfo
[8]);

1085 
	#PRINT
(
fmt
, ...) \

1086 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "\t\t" 
fmt
 "\n", \

1087 ##
__VA_ARGS__
)

	)

1089 
	#PFLAG
(
t
, 
n
, 
a
, 
b
) \

1091 ià(
ÿp
[
n
] & 
IEEE80211_EHT_
##
t
##
_CAP
##n##
_
##
a
) \

1092 
	`PRINT
("%s", 
b
); \

1093 } 0)

	)

1095 
ÿp
 = 
fixed
->
mac_ÿp_šfo
;

1096 
	`PFLAG
(
MAC
, 0, 
EPCS_PRIO_ACCESS
, "EPCS-PRIO-ACCESS");

1097 
	`PFLAG
(
MAC
, 0, 
OM_CONTROL
, "OM-CONTROL");

1098 
	`PFLAG
(
MAC
, 0, 
TRIG_TXOP_SHARING_MODE1
, "TRIG-TXOP-SHARING-MODE1");

1099 
	`PFLAG
(
MAC
, 0, 
TRIG_TXOP_SHARING_MODE2
, "TRIG-TXOP-SHARING-MODE2");

1100 
	`PFLAG
(
MAC
, 0, 
RESTRICTED_TWT
, "RESTRICTED-TWT");

1101 
	`PFLAG
(
MAC
, 0, 
SCS_TRAFFIC_DESC
, "SCS-TRAFFIC-DESC");

1102 (
ÿp
[0] & 0xc0) >> 6) {

1103 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_3895
:

1104 
	`PRINT
("MAX-MPDU-LEN: 3985");

1106 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_7991
:

1107 
	`PRINT
("MAX-MPDU-LEN: 7991");

1109 
IEEE80211_EHT_MAC_CAP0_MAX_MPDU_LEN_11454
:

1110 
	`PRINT
("MAX-MPDU-LEN: 11454");

1114 
ÿp
 = 
fixed
->
phy_ÿp_šfo
;

1115 
	`PFLAG
(
PHY
, 0, 320
MHZ_IN_6GHZ
, "320MHZ-IN-6GHZ");

1116 
	`PFLAG
(
PHY
, 0, 242
_TONE_RU_GT20MHZ
, "242-TONE-RU-GT20MHZ");

1117 
	`PFLAG
(
PHY
, 0, 
NDP_4_EHT_LFT_32_GI
, "NDP-4-EHT-LFT-32-GI");

1118 
	`PFLAG
(
PHY
, 0, 
PARTIAL_BW_UL_MU_MIMO
, "PARTIAL-BW-UL-MU-MIMO");

1119 
	`PFLAG
(
PHY
, 0, 
SU_BEAMFORMER
, "SU-BEAMFORMER");

1120 
	`PFLAG
(
PHY
, 0, 
SU_BEAMFORMEE
, "SU-BEAMFORMEE");

1121 
i
 = 
ÿp
[0] >> 7;

1122 
i
 |ğ(
ÿp
[1] & 0x3) << 1;

1123 
	`PRINT
("BEAMFORMEE-80-NSS: %i", 
i
);

1124 
	`PRINT
("BEAMFORMEE-160-NSS: %i", (
ÿp
[1] >> 2) & 0x7);

1125 
	`PRINT
("BEAMFORMEE-320-NSS: %i", (
ÿp
[1] >> 5) & 0x7);

1126 
	`PRINT
("SOUNDING-DIM-80-NSS: %i", (
ÿp
[2] & 0x7));

1127 
	`PRINT
("SOUNDING-DIM-160-NSS: %i", (
ÿp
[2] >> 3) & 0x7);

1128 
i
 = 
ÿp
[2] >> 6;

1129 
i
 |ğ(
ÿp
[3] & 0x1) << 3;

1130 
	`PRINT
("SOUNDING-DIM-320-NSS: %i", 
i
);

1132 
	`PFLAG
(
PHY
, 3, 
NG_16_SU_FEEDBACK
, "NG-16-SU-FEEDBACK");

1133 
	`PFLAG
(
PHY
, 3, 
NG_16_MU_FEEDBACK
, "NG-16-MU-FEEDBACK");

1134 
	`PFLAG
(
PHY
, 3, 
CODEBOOK_4_2_SU_FDBK
, "CODEBOOK-4-2-SU-FDBK");

1135 
	`PFLAG
(
PHY
, 3, 
CODEBOOK_7_5_MU_FDBK
, "CODEBOOK-7-5-MU-FDBK");

1136 
	`PFLAG
(
PHY
, 3, 
TRIG_SU_BF_FDBK
, "TRIG-SU-BF-FDBK");

1137 
	`PFLAG
(
PHY
, 3, 
TRIG_MU_BF_PART_BW_FDBK
, "TRIG-MU-BF-PART-BW-FDBK");

1138 
	`PFLAG
(
PHY
, 3, 
TRIG_CQI_FDBK
, "TRIG-CQI-FDBK");

1140 
	`PFLAG
(
PHY
, 4, 
PART_BW_DL_MU_MIMO
, "PART-BW-DL-MU-MIMO");

1141 
	`PFLAG
(
PHY
, 4, 
PSR_SR_SUPP
, "PSR-SR-SUPP");

1142 
	`PFLAG
(
PHY
, 4, 
POWER_BOOST_FACT_SUPP
, "POWER-BOOST-FACT-SUPP");

1143 
	`PFLAG
(
PHY
, 4, 
EHT_MU_PPDU_4_EHT_LTF_08_GI
, "EHT-MU-PPDU-4-EHT-LTF-08-GI");

1144 
	`PRINT
("MAX_NC: %i", 
ÿp
[4] >> 4);

1146 
	`PFLAG
(
PHY
, 5, 
NON_TRIG_CQI_FEEDBACK
, "NON-TRIG-CQI-FEEDBACK");

1147 
	`PFLAG
(
PHY
, 5, 
TX_LESS_242_TONE_RU_SUPP
, "TX-LESS-242-TONE-RU-SUPP");

1148 
	`PFLAG
(
PHY
, 5, 
RX_LESS_242_TONE_RU_SUPP
, "RX-LESS-242-TONE-RU-SUPP");

1149 
	`PFLAG
(
PHY
, 5, 
PPE_THRESHOLD_PRESENT
, "PPE_THRESHOLD_PRESENT");

1150 
ÿp
[5] >> 4 & 0x3) {

1151 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_0US
:

1152 
	`PRINT
("NOMINAL_PKT_PAD: 0us");

1154 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_8US
:

1155 
	`PRINT
("NOMINAL_PKT_PAD: 8us");

1157 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_16US
:

1158 
	`PRINT
("NOMINAL_PKT_PAD: 16us");

1160 
IEEE80211_EHT_PHY_CAP5_COMMON_NOMINAL_PKT_PAD_20US
:

1161 
	`PRINT
("NOMINAL_PKT_PAD: 20us");

1164 
i
 = 
ÿp
[5] >> 6;

1165 
i
 |ğ
ÿp
[6] & 0x7;

1166 
	`PRINT
("MAX-NUM-SUPP-EHT-LTF: %i", 
i
);

1167 
	`PFLAG
(
PHY
, 5, 
SUPP_EXTRA_EHT_LTF
, "SUPP-EXTRA-EHT-LTF");

1169 
i
 = (
ÿp
[6] >> 3) & 0xf;

1170 
	`PRINT
("MCS15-SUPP-MASK: %i", 
i
);

1171 
	`PFLAG
(
PHY
, 6, 
EHT_DUP_6GHZ_SUPP
, "EHT-DUP-6GHZ-SUPP");

1173 
	`PFLAG
(
PHY
, 7, 20
MHZ_STA_RX_NDP_WIDER_BW
, "20MHZ-STA-RX-NDP-WIDER-BW");

1174 
	`PFLAG
(
PHY
, 7, 
NON_OFDMA_UL_MU_MIMO_80MHZ
, "NON-OFDMA-UL-MU-MIMO-80MHZ");

1175 
	`PFLAG
(
PHY
, 7, 
NON_OFDMA_UL_MU_MIMO_160MHZ
, "NON-OFDMA-UL-MU-MIMO-160MHZ");

1176 
	`PFLAG
(
PHY
, 7, 
NON_OFDMA_UL_MU_MIMO_320MHZ
, "NON-OFDMA-UL-MU-MIMO-320MHZ");

1177 
	`PFLAG
(
PHY
, 7, 
MU_BEAMFORMER_80MHZ
, "MU-BEAMFORMER-80MHZ");

1178 
	`PFLAG
(
PHY
, 7, 
MU_BEAMFORMER_160MHZ
, "MU-BEAMFORMER-160MHZ");

1179 
	`PFLAG
(
PHY
, 7, 
MU_BEAMFORMER_320MHZ
, "MU-BEAMFORMER-320MHZ");

1180 
	`PFLAG
(
PHY
, 7, 
TB_SOUNDING_FDBK_RATE_LIMIT
, "TB-SOUNDING-FDBK-RATE-LIMIT");

1182 
	`PFLAG
(
PHY
, 8, 
RX_1024QAM_WIDER_BW_DL_OFDMA
, "RX-1024QAM-WIDER-BW-DL-OFDMA");

1183 
	`PFLAG
(
PHY
, 8, 
RX_4096QAM_WIDER_BW_DL_OFDMA
, "RX-4096QAM-WIDER-BW-DL-OFDMA");

1185 #undeà
PFLAG


1187 
	`PRINT
("");

1188 ià(!(
lšk_¡a
->
pub
->
he_ÿp
.
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

1189 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_MASK_ALL
)) {

1190 
u8
 *
mcs_v®s
 = (u8 *)(&
nss
->
Úly_20mhz
);

1192 
i
 = 0; i < 4; i++)

1193 
	`PRINT
("EHT bw=20 MHz, max NSS for MCS %s: Rx=%u, Tx=%u",

1194 
mcs_desc
[
i
],

1195 
mcs_v®s
[
i
] & 0xf, mcs_vals[i] >> 4);

1197 
u8
 *
mcs_v®s
 = (u8 *)(&
nss
->
bw
.
_80
);

1199 
i
 = 0; i < 3; i++)

1200 
	`PRINT
("EHT bw <= 80 MHz, max NSS for MCS %s: Rx=%u, Tx=%u",

1201 
mcs_desc
[
i
 + 1],

1202 
mcs_v®s
[
i
] & 0xf, mcs_vals[i] >> 4);

1204 
mcs_v®s
 = (
u8
 *)(&
nss
->
bw
.
_160
);

1205 
i
 = 0; i < 3; i++)

1206 
	`PRINT
("EHT bw <= 160 MHz, max NSS for MCS %s: Rx=%u, Tx=%u",

1207 
mcs_desc
[
i
 + 1],

1208 
mcs_v®s
[
i
] & 0xf, mcs_vals[i] >> 4);

1210 
mcs_v®s
 = (
u8
 *)(&
nss
->
bw
.
_320
);

1211 
i
 = 0; i < 3; i++)

1212 
	`PRINT
("EHT bw <= 320 MHz, max NSS for MCS %s: Rx=%u, Tx=%u",

1213 
mcs_desc
[
i
 + 1],

1214 
mcs_v®s
[
i
] & 0xf, mcs_vals[i] >> 4);

1217 ià(
ÿp
[5] & 
IEEE80211_EHT_PHY_CAP5_PPE_THRESHOLD_PRESENT
) {

1218 
u8
 
µe_size
 = 
	`›“80211_eht_µe_size
(
bec
->
eht_µe_th»s
[0], 
ÿp
);

1220 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "EHT PPE Thresholds: ");

1221 
i
 = 0; i < 
µe_size
; i++)

1222 
p
 +ğ
	`sú´štf
Õ, 
buf_sz
 + 
buf
 -…, "0x%02x ",

1223 
bec
->
eht_µe_th»s
[
i
]);

1224 
	`PRINT
("");

1227 
out
:

1228 
»t
 = 
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
, 
buf
, 
p
 - buf);

1229 
	`kä“
(
buf
);

1230  
»t
;

1231 
	}
}

1232 
LINK_STA_OPS
(
eht_ÿ·
);

1234 
	#DEBUGFS_ADD
(
Çme
) \

1235 
	`debugfs_ü—‹_fe
(#name, 0400, \

1236 
¡a
->
debugfs_dœ
, s, &
¡a_
 ##
Çme
## 
_İs
)

	)

1238 
	#DEBUGFS_ADD_COUNTER
(
Çme
, 
f›ld
) \

1239 
	`debugfs_ü—‹_ulÚg
(#Çme, 0400, 
¡a
->
debugfs_dœ
, &¡a->
f›ld
);

	)

1241 
	$›“80211_¡a_debugfs_add
(
¡a_šfo
 *
¡a
)

1243 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

1244 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1245 
d’Œy
 *
¡©iÚs_dœ
 = 
¡a
->
sd©a
->
debugfs
.
subdœ_¡©iÚs
;

1246 
u8
 
mac
[3*
ETH_ALEN
];

1248 ià(!
¡©iÚs_dœ
)

1251 
	`¢´štf
(
mac
, (mac), "%pM", 
¡a
->¡a.
addr
);

1262 
¡a
->
debugfs_dœ
 = 
	`debugfs_ü—‹_dœ
(
mac
, 
¡©iÚs_dœ
);

1264 
	`DEBUGFS_ADD
(
æags
);

1265 
	`DEBUGFS_ADD
(
aid
);

1266 
	`DEBUGFS_ADD
(
num_ps_buf_äames
);

1267 
	`DEBUGFS_ADD
(
Ï¡_£q_ù¾
);

1268 
	`DEBUGFS_ADD
(
agg_¡©us
);

1270 
	`DEBUGFS_ADD_COUNTER
(
tx_f‹»d
, 
deæšk
.
¡©us_¡©s
.
f‹»d
);

1272 
	`DEBUGFS_ADD
(
aqm
);

1273 
	`DEBUGFS_ADD
(
aœtime
);

1275 ià(
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
,

1276 
NL80211_EXT_FEATURE_AQL
))

1277 
	`DEBUGFS_ADD
(
aql
);

1279 
	`debugfs_ü—‹_xul
("driv”_bufã»d_tids", 0400, 
¡a
->
debugfs_dœ
,

1280 &
¡a
->
driv”_bufã»d_tids
);

1282 
	`drv_¡a_add_debugfs
(
loÿl
, 
sd©a
, &
¡a
->¡a, s->
debugfs_dœ
);

1283 
	}
}

1285 
	$›“80211_¡a_debugfs_»move
(
¡a_šfo
 *
¡a
)

1287 
	`debugfs_»move_»cursive
(
¡a
->
debugfs_dœ
);

1288 
¡a
->
debugfs_dœ
 = 
NULL
;

1289 
	}
}

1291 #undeà
DEBUGFS_ADD


1292 #undeà
DEBUGFS_ADD_COUNTER


1294 
	#DEBUGFS_ADD
(
Çme
) \

1295 
	`debugfs_ü—‹_fe
(#name, 0400, \

1296 
lšk_¡a
->
debugfs_dœ
,†šk_¡a, &
lšk_¡a_
 ##
Çme
## 
_İs
)

	)

1297 
	#DEBUGFS_ADD_COUNTER
(
Çme
, 
f›ld
) \

1298 
	`debugfs_ü—‹_ulÚg
(#Çme, 0400, 
lšk_¡a
->
debugfs_dœ
, &lšk_¡a->
f›ld
)

	)

1300 
	$›“80211_lšk_¡a_debugfs_add
(
lšk_¡a_šfo
 *
lšk_¡a
)

1302 ià(
	`WARN_ON
(!
lšk_¡a
->
¡a
->
debugfs_dœ
))

1306 ià(
lšk_¡a
->
¡a
->¡a.
v®id_lšks
) {

1307 
lšk_dœ_Çme
[10];

1309 
	`¢´štf
(
lšk_dœ_Çme
, (link_dir_name),

1310 "lšk-%d", 
lšk_¡a
->
lšk_id
);

1312 
lšk_¡a
->
debugfs_dœ
 =

1313 
	`debugfs_ü—‹_dœ
(
lšk_dœ_Çme
,

1314 
lšk_¡a
->
¡a
->
debugfs_dœ
);

1316 
	`DEBUGFS_ADD
(
addr
);

1318 ià(
	`WARN_ON
(
lšk_¡a
 !ğ&lšk_¡a->
¡a
->
deæšk
))

1321 
lšk_¡a
->
debugfs_dœ
 =†šk_¡a->
¡a
->debugfs_dir;

1324 
	`DEBUGFS_ADD
(
ht_ÿ·
);

1325 
	`DEBUGFS_ADD
(
vht_ÿ·
);

1326 
	`DEBUGFS_ADD
(
he_ÿ·
);

1327 
	`DEBUGFS_ADD
(
eht_ÿ·
);

1329 
	`DEBUGFS_ADD_COUNTER
(
rx_du¶iÿ‹s
, 
rx_¡©s
.
num_du¶iÿ‹s
);

1330 
	`DEBUGFS_ADD_COUNTER
(
rx_äagm’ts
, 
rx_¡©s
.
äagm’ts
);

1331 
	}
}

1333 
	$›“80211_lšk_¡a_debugfs_»move
(
lšk_¡a_šfo
 *
lšk_¡a
)

1335 ià(!
lšk_¡a
->
debugfs_dœ
 || !lšk_¡a->
¡a
->debugfs_dir) {

1336 
lšk_¡a
->
debugfs_dœ
 = 
NULL
;

1340 ià(
lšk_¡a
->
debugfs_dœ
 =ğlšk_¡a->
¡a
->debugfs_dir) {

1341 
	`WARN_ON
(
lšk_¡a
 !ğ&lšk_¡a->
¡a
->
deæšk
);

1342 
lšk_¡a
->
¡a
->
debugfs_dœ
 = 
NULL
;

1346 
	`debugfs_»move_»cursive
(
lšk_¡a
->
debugfs_dœ
);

1347 
lšk_¡a
->
debugfs_dœ
 = 
NULL
;

1348 
	}
}

1350 
	$›“80211_lšk_¡a_debugfs_drv_add
(
lšk_¡a_šfo
 *
lšk_¡a
)

1352 ià(
	`WARN_ON
(!
lšk_¡a
->
debugfs_dœ
))

1355 
	`drv_lšk_¡a_add_debugfs
(
lšk_¡a
->
¡a
->
loÿl
,†šk_¡a->¡a->
sd©a
,

1356 
lšk_¡a
->
pub
,†šk_¡a->
debugfs_dœ
);

1357 
	}
}

1359 
	$›“80211_lšk_¡a_debugfs_drv_»move
(
lšk_¡a_šfo
 *
lšk_¡a
)

1361 ià(!
lšk_¡a
->
debugfs_dœ
)

1364 ià(
	`WARN_ON
(
lšk_¡a
->
debugfs_dœ
 =ğlšk_¡a->
¡a
->debugfs_dir))

1368 
	`debugfs_»move_»cursive
(
lšk_¡a
->
debugfs_dœ
);

1369 
lšk_¡a
->
debugfs_dœ
 = 
NULL
;

1371 
	`›“80211_lšk_¡a_debugfs_add
(
lšk_¡a
);

1372 
	}
}

	@debugfs_sta.h

2 #iâdeà
__MAC80211_DEBUGFS_STA_H


3 
	#__MAC80211_DEBUGFS_STA_H


	)

5 
	~"¡a_šfo.h
"

7 #ifdeà
CONFIG_MAC80211_DEBUGFS


8 
›“80211_¡a_debugfs_add
(
¡a_šfo
 *
¡a
);

9 
›“80211_¡a_debugfs_»move
(
¡a_šfo
 *
¡a
);

11 
›“80211_lšk_¡a_debugfs_add
(
lšk_¡a_šfo
 *
lšk_¡a
);

12 
›“80211_lšk_¡a_debugfs_»move
(
lšk_¡a_šfo
 *
lšk_¡a
);

14 
›“80211_lšk_¡a_debugfs_drv_add
(
lšk_¡a_šfo
 *
lšk_¡a
);

15 
›“80211_lšk_¡a_debugfs_drv_»move
(
lšk_¡a_šfo
 *
lšk_¡a
);

17 
šlše
 
	$›“80211_¡a_debugfs_add
(
¡a_šfo
 *
¡a
è{
	}
}

18 
šlše
 
	$›“80211_¡a_debugfs_»move
(
¡a_šfo
 *
¡a
è{
	}
}

20 
šlše
 
	$›“80211_lšk_¡a_debugfs_add
(
lšk_¡a_šfo
 *
lšk_¡a
è{
	}
}

21 
šlše
 
	$›“80211_lšk_¡a_debugfs_»move
(
lšk_¡a_šfo
 *
lšk_¡a
è{
	}
}

23 
šlše
 
	$›“80211_lšk_¡a_debugfs_drv_add
(
lšk_¡a_šfo
 *
lšk_¡a
è{
	}
}

24 
šlše
 
	$›“80211_lšk_¡a_debugfs_drv_»move
(
lšk_¡a_šfo
 *
lšk_¡a
è{
	}
}

	@driver-ops.c

6 
	~<Ãt/mac80211.h
>

7 
	~"›“80211_i.h
"

8 
	~"Œaû.h
"

9 
	~"driv”-İs.h
"

10 
	~"debugfs_¡a.h
"

11 
	~"debugfs_Ãtdev.h
"

13 
	$drv_¡¬t
(
›“80211_loÿl
 *
loÿl
)

15 
»t
;

17 
	`might_¦“p
();

18 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

20 ià(
	`WARN_ON
(
loÿl
->
¡¬‹d
))

21  -
EALREADY
;

23 
	`Œaû_drv_¡¬t
(
loÿl
);

24 
loÿl
->
¡¬‹d
 = 
Œue
;

26 
	`smp_mb
();

27 
»t
 = 
loÿl
->
İs
->
	`¡¬t
(&loÿl->
hw
);

28 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

30 ià(
»t
)

31 
loÿl
->
¡¬‹d
 = 
çl£
;

33  
»t
;

34 
	}
}

36 
	$drv_¡İ
(
›“80211_loÿl
 *
loÿl
)

38 
	`might_¦“p
();

39 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

41 ià(
	`WARN_ON
(!
loÿl
->
¡¬‹d
))

44 
	`Œaû_drv_¡İ
(
loÿl
);

45 
loÿl
->
İs
->
	`¡İ
(&loÿl->
hw
);

46 
	`Œaû_drv_»tuº_void
(
loÿl
);

49 
	`skËt_di§bË
(&
loÿl
->
skËt
);

50 
	`skËt_’abË
(&
loÿl
->
skËt
);

52 
	`b¬r›r
();

54 
loÿl
->
¡¬‹d
 = 
çl£
;

55 
	}
}

57 
	$drv_add_š‹rçû
(
›“80211_loÿl
 *
loÿl
,

58 
›“80211_sub_if_d©a
 *
sd©a
)

60 
»t
;

62 
	`might_¦“p
();

63 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

65 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 ||

66 (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 &&

67 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
WANT_MONITOR_VIF
) &&

68 !(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
))))

69  -
EINVAL
;

71 
	`Œaû_drv_add_š‹rçû
(
loÿl
, 
sd©a
);

72 
»t
 = 
loÿl
->
İs
->
	`add_š‹rçû
(&loÿl->
hw
, &
sd©a
->
vif
);

73 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

75 ià(
»t
)

76  
»t
;

78 ià(!(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
)) {

79 
sd©a
->
æags
 |ğ
IEEE80211_SDATA_IN_DRIVER
;

81 
	`drv_vif_add_debugfs
(
loÿl
, 
sd©a
);

83 
	`›“80211_lšk_debugfs_drv_add
(&
sd©a
->
deæšk
);

87 
	}
}

89 
	$drv_chªge_š‹rçû
(
›“80211_loÿl
 *
loÿl
,

90 
›“80211_sub_if_d©a
 *
sd©a
,

91 
Æ80211_iáy³
 
ty³
, 
boŞ
 
p2p
)

93 
»t
;

95 
	`might_¦“p
();

96 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

98 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

99  -
EIO
;

101 
	`Œaû_drv_chªge_š‹rçû
(
loÿl
, 
sd©a
, 
ty³
, 
p2p
);

102 
»t
 = 
loÿl
->
İs
->
	`chªge_š‹rçû
(&loÿl->
hw
, &
sd©a
->
vif
, 
ty³
, 
p2p
);

103 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

104  
»t
;

105 
	}
}

107 
	$drv_»move_š‹rçû
(
›“80211_loÿl
 *
loÿl
,

108 
›“80211_sub_if_d©a
 *
sd©a
)

110 
	`might_¦“p
();

111 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

113 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

116 
sd©a
->
æags
 &ğ~
IEEE80211_SDATA_IN_DRIVER
;

119 
	`›“80211_debugfs_»ü—‹_Ãtdev
(
sd©a
, sd©a->
vif
.
v®id_lšks
);

121 
	`Œaû_drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

122 
loÿl
->
İs
->
	`»move_š‹rçû
(&loÿl->
hw
, &
sd©a
->
vif
);

123 
	`Œaû_drv_»tuº_void
(
loÿl
);

124 
	}
}

126 
__mu¡_check


127 
	$drv_¡a_¡©e
(
›“80211_loÿl
 *
loÿl
,

128 
›“80211_sub_if_d©a
 *
sd©a
,

129 
¡a_šfo
 *
¡a
,

130 
›“80211_¡a_¡©e
 
Şd_¡©e
,

131 
›“80211_¡a_¡©e
 
Ãw_¡©e
)

133 
»t
 = 0;

135 
	`might_¦“p
();

136 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

138 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

139 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

140  -
EIO
;

142 
	`Œaû_drv_¡a_¡©e
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
Şd_¡©e
, 
Ãw_¡©e
);

143 ià(
loÿl
->
İs
->
¡a_¡©e
) {

144 
»t
 = 
loÿl
->
İs
->
	`¡a_¡©e
(&loÿl->
hw
, &
sd©a
->
vif
, &
¡a
->sta,

145 
Şd_¡©e
, 
Ãw_¡©e
);

146 } ià(
Şd_¡©e
 =ğ
IEEE80211_STA_AUTH
 &&

147 
Ãw_¡©e
 =ğ
IEEE80211_STA_ASSOC
) {

148 
»t
 = 
	`drv_¡a_add
(
loÿl
, 
sd©a
, &
¡a
->sta);

149 ià(
»t
 == 0) {

150 
¡a
->
u¶ßded
 = 
Œue
;

151 ià(
	`rcu_acûss_poš‹r
(
¡a
->¡a.
¿‹s
))

152 
	`drv_¡a_¿‹_tbl_upd©e
(
loÿl
, 
sd©a
, &
¡a
->sta);

154 } ià(
Şd_¡©e
 =ğ
IEEE80211_STA_ASSOC
 &&

155 
Ãw_¡©e
 =ğ
IEEE80211_STA_AUTH
) {

156 
	`drv_¡a_»move
(
loÿl
, 
sd©a
, &
¡a
->sta);

158 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

159  
»t
;

160 
	}
}

162 
__mu¡_check


163 
	$drv_¡a_£t_txpwr
(
›“80211_loÿl
 *
loÿl
,

164 
›“80211_sub_if_d©a
 *
sd©a
,

165 
¡a_šfo
 *
¡a
)

167 
»t
 = -
EOPNOTSUPP
;

169 
	`might_¦“p
();

170 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

172 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

173 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

174  -
EIO
;

176 
	`Œaû_drv_¡a_£t_txpwr
(
loÿl
, 
sd©a
, &
¡a
->sta);

177 ià(
loÿl
->
İs
->
¡a_£t_txpwr
)

178 
»t
 = 
loÿl
->
İs
->
	`¡a_£t_txpwr
(&loÿl->
hw
, &
sd©a
->
vif
,

179 &
¡a
->sta);

180 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

181  
»t
;

182 
	}
}

184 
	$drv_¡a_rc_upd©e
(
›“80211_loÿl
 *
loÿl
,

185 
›“80211_sub_if_d©a
 *
sd©a
,

186 
›“80211_¡a
 *
¡a
, 
u32
 
chªged
)

188 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

189 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

192 
	`WARN_ON
(
chªged
 & 
IEEE80211_RC_SUPP_RATES_CHANGED
 &&

193 (
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

194 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
));

196 
	`Œaû_drv_¡a_rc_upd©e
(
loÿl
, 
sd©a
, 
¡a
, 
chªged
);

197 ià(
loÿl
->
İs
->
¡a_rc_upd©e
)

198 
loÿl
->
İs
->
	`¡a_rc_upd©e
(&loÿl->
hw
, &
sd©a
->
vif
,

199 
¡a
, 
chªged
);

201 
	`Œaû_drv_»tuº_void
(
loÿl
);

202 
	}
}

204 
	$drv_cÚf_tx
(
›“80211_loÿl
 *
loÿl
,

205 
›“80211_lšk_d©a
 *
lšk
, 
u16
 
ac
,

206 cÚ¡ 
›“80211_tx_queue_·¿ms
 *
·¿ms
)

208 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

209 
»t
 = -
EOPNOTSUPP
;

211 
	`might_¦“p
();

212 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

214 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

215  -
EIO
;

217 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk
->
lšk_id
))

220 ià(
·¿ms
->
cw_mš
 =ğ0 ||…¬ams->cw_mš >…¬ams->
cw_max
) {

225 
	`WARN_ONCE
(
loÿl
->
İs
->
cÚf_tx
,

227 
sd©a
->
Çme
, 
·¿ms
->
cw_mš
,…¬ams->
cw_max
);

228  -
EINVAL
;

231 
	`Œaû_drv_cÚf_tx
(
loÿl
, 
sd©a
, 
lšk
->
lšk_id
, 
ac
, 
·¿ms
);

232 ià(
loÿl
->
İs
->
cÚf_tx
)

233 
»t
 = 
loÿl
->
İs
->
	`cÚf_tx
(&loÿl->
hw
, &
sd©a
->
vif
,

234 
lšk
->
lšk_id
, 
ac
, 
·¿ms
);

235 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

236  
»t
;

237 
	}
}

239 
u64
 
	$drv_g‘_tsf
(
›“80211_loÿl
 *
loÿl
,

240 
›“80211_sub_if_d©a
 *
sd©a
)

242 
u64
 
»t
 = -1ULL;

244 
	`might_¦“p
();

245 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

247 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

248  
»t
;

250 
	`Œaû_drv_g‘_tsf
(
loÿl
, 
sd©a
);

251 ià(
loÿl
->
İs
->
g‘_tsf
)

252 
»t
 = 
loÿl
->
İs
->
	`g‘_tsf
(&loÿl->
hw
, &
sd©a
->
vif
);

253 
	`Œaû_drv_»tuº_u64
(
loÿl
, 
»t
);

254  
»t
;

255 
	}
}

257 
	$drv_£t_tsf
(
›“80211_loÿl
 *
loÿl
,

258 
›“80211_sub_if_d©a
 *
sd©a
,

259 
u64
 
tsf
)

261 
	`might_¦“p
();

262 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

264 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

267 
	`Œaû_drv_£t_tsf
(
loÿl
, 
sd©a
, 
tsf
);

268 ià(
loÿl
->
İs
->
£t_tsf
)

269 
loÿl
->
İs
->
	`£t_tsf
(&loÿl->
hw
, &
sd©a
->
vif
, 
tsf
);

270 
	`Œaû_drv_»tuº_void
(
loÿl
);

271 
	}
}

273 
	$drv_off£t_tsf
(
›“80211_loÿl
 *
loÿl
,

274 
›“80211_sub_if_d©a
 *
sd©a
,

275 
s64
 
off£t
)

277 
	`might_¦“p
();

278 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

280 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

283 
	`Œaû_drv_off£t_tsf
(
loÿl
, 
sd©a
, 
off£t
);

284 ià(
loÿl
->
İs
->
off£t_tsf
)

285 
loÿl
->
İs
->
	`off£t_tsf
(&loÿl->
hw
, &
sd©a
->
vif
, 
off£t
);

286 
	`Œaû_drv_»tuº_void
(
loÿl
);

287 
	}
}

289 
	$drv_»£t_tsf
(
›“80211_loÿl
 *
loÿl
,

290 
›“80211_sub_if_d©a
 *
sd©a
)

292 
	`might_¦“p
();

293 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

295 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

298 
	`Œaû_drv_»£t_tsf
(
loÿl
, 
sd©a
);

299 ià(
loÿl
->
İs
->
»£t_tsf
)

300 
loÿl
->
İs
->
	`»£t_tsf
(&loÿl->
hw
, &
sd©a
->
vif
);

301 
	`Œaû_drv_»tuº_void
(
loÿl
);

302 
	}
}

304 
	$drv_assign_vif_chªùx
(
›“80211_loÿl
 *
loÿl
,

305 
›“80211_sub_if_d©a
 *
sd©a
,

306 
›“80211_bss_cÚf
 *
lšk_cÚf
,

307 
›“80211_chªùx
 *
ùx
)

309 
»t
 = 0;

311 
	`might_¦“p
();

312 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

314 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

315  -
EIO
;

317 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk_cÚf
->
lšk_id
))

320 
	`Œaû_drv_assign_vif_chªùx
(
loÿl
, 
sd©a
, 
lšk_cÚf
, 
ùx
);

321 ià(
loÿl
->
İs
->
assign_vif_chªùx
) {

322 
	`WARN_ON_ONCE
(!
ùx
->
driv”_´e£Á
);

323 
»t
 = 
loÿl
->
İs
->
	`assign_vif_chªùx
(&loÿl->
hw
,

324 &
sd©a
->
vif
,

325 
lšk_cÚf
,

326 &
ùx
->
cÚf
);

328 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

330  
»t
;

331 
	}
}

333 
	$drv_uÇssign_vif_chªùx
(
›“80211_loÿl
 *
loÿl
,

334 
›“80211_sub_if_d©a
 *
sd©a
,

335 
›“80211_bss_cÚf
 *
lšk_cÚf
,

336 
›“80211_chªùx
 *
ùx
)

338 
	`might_¦“p
();

339 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

341 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

344 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk_cÚf
->
lšk_id
))

347 
	`Œaû_drv_uÇssign_vif_chªùx
(
loÿl
, 
sd©a
, 
lšk_cÚf
, 
ùx
);

348 ià(
loÿl
->
İs
->
uÇssign_vif_chªùx
) {

349 
	`WARN_ON_ONCE
(!
ùx
->
driv”_´e£Á
);

350 
loÿl
->
İs
->
	`uÇssign_vif_chªùx
(&loÿl->
hw
,

351 &
sd©a
->
vif
,

352 
lšk_cÚf
,

353 &
ùx
->
cÚf
);

355 
	`Œaû_drv_»tuº_void
(
loÿl
);

356 
	}
}

358 
	$drv_sw™ch_vif_chªùx
(
›“80211_loÿl
 *
loÿl
,

359 
›“80211_vif_chªùx_sw™ch
 *
vifs
,

360 
n_vifs
, 
›“80211_chªùx_sw™ch_mode
 
mode
)

362 
»t
 = 0;

363 
i
;

365 
	`might_¦“p
();

366 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

368 ià(!
loÿl
->
İs
->
sw™ch_vif_chªùx
)

369  -
EOPNOTSUPP
;

371 
i
 = 0; i < 
n_vifs
; i++) {

372 
›“80211_chªùx
 *
Ãw_ùx
 =

373 
	`cÚš”_of
(
vifs
[
i
].
Ãw_ùx
,

374 
›“80211_chªùx
,

375 
cÚf
);

376 
›“80211_chªùx
 *
Şd_ùx
 =

377 
	`cÚš”_of
(
vifs
[
i
].
Şd_ùx
,

378 
›“80211_chªùx
,

379 
cÚf
);

381 
	`WARN_ON_ONCE
(!
Şd_ùx
->
driv”_´e£Á
);

382 
	`WARN_ON_ONCE
((
mode
 =ğ
CHANCTX_SWMODE_SWAP_CONTEXTS
 &&

383 
Ãw_ùx
->
driv”_´e£Á
) ||

384 (
mode
 =ğ
CHANCTX_SWMODE_REASSIGN_VIF
 &&

385 !
Ãw_ùx
->
driv”_´e£Á
));

388 
	`Œaû_drv_sw™ch_vif_chªùx
(
loÿl
, 
vifs
, 
n_vifs
, 
mode
);

389 
»t
 = 
loÿl
->
İs
->
	`sw™ch_vif_chªùx
(&loÿl->
hw
,

390 
vifs
, 
n_vifs
, 
mode
);

391 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

393 ià(!
»t
 && 
mode
 =ğ
CHANCTX_SWMODE_SWAP_CONTEXTS
) {

394 
i
 = 0; i < 
n_vifs
; i++) {

395 
›“80211_chªùx
 *
Ãw_ùx
 =

396 
	`cÚš”_of
(
vifs
[
i
].
Ãw_ùx
,

397 
›“80211_chªùx
,

398 
cÚf
);

399 
›“80211_chªùx
 *
Şd_ùx
 =

400 
	`cÚš”_of
(
vifs
[
i
].
Şd_ùx
,

401 
›“80211_chªùx
,

402 
cÚf
);

404 
Ãw_ùx
->
driv”_´e£Á
 = 
Œue
;

405 
Şd_ùx
->
driv”_´e£Á
 = 
çl£
;

409  
»t
;

410 
	}
}

412 
	$drv_ampdu_aùiÚ
(
›“80211_loÿl
 *
loÿl
,

413 
›“80211_sub_if_d©a
 *
sd©a
,

414 
›“80211_ampdu_·¿ms
 *
·¿ms
)

416 
»t
 = -
EOPNOTSUPP
;

418 
	`might_¦“p
();

419 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

421 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

422 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

423  -
EIO
;

425 
	`Œaû_drv_ampdu_aùiÚ
(
loÿl
, 
sd©a
, 
·¿ms
);

427 ià(
loÿl
->
İs
->
ampdu_aùiÚ
)

428 
»t
 = 
loÿl
->
İs
->
	`ampdu_aùiÚ
(&loÿl->
hw
, &
sd©a
->
vif
, 
·¿ms
);

430 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

432  
»t
;

433 
	}
}

435 
	$drv_lšk_šfo_chªged
(
›“80211_loÿl
 *
loÿl
,

436 
›“80211_sub_if_d©a
 *
sd©a
,

437 
›“80211_bss_cÚf
 *
šfo
,

438 
lšk_id
, 
u64
 
chªged
)

440 
	`might_¦“p
();

441 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

443 ià(
	`WARN_ON_ONCE
(
chªged
 & (
BSS_CHANGED_BEACON
 |

444 
BSS_CHANGED_BEACON_ENABLED
) &&

445 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

446 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

447 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
 &&

448 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_OCB
))

451 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_P2P_DEVICE
 ||

452 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_NAN
 ||

453 (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 &&

454 !
sd©a
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
 &&

455 !(
chªged
 & 
BSS_CHANGED_TXPOWER
))))

458 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

461 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk_id
))

464 
	`Œaû_drv_lšk_šfo_chªged
(
loÿl
, 
sd©a
, 
šfo
, 
chªged
);

465 ià(
loÿl
->
İs
->
lšk_šfo_chªged
)

466 
loÿl
->
İs
->
	`lšk_šfo_chªged
(&loÿl->
hw
, &
sd©a
->
vif
,

467 
šfo
, 
chªged
);

468 ià(
loÿl
->
İs
->
bss_šfo_chªged
)

469 
loÿl
->
İs
->
	`bss_šfo_chªged
(&loÿl->
hw
, &
sd©a
->
vif
,

470 
šfo
, 
chªged
);

471 
	`Œaû_drv_»tuº_void
(
loÿl
);

472 
	}
}

474 
	$drv_£t_key
(
›“80211_loÿl
 *
loÿl
,

475 
£t_key_cmd
 
cmd
,

476 
›“80211_sub_if_d©a
 *
sd©a
,

477 
›“80211_¡a
 *
¡a
,

478 
›“80211_key_cÚf
 *
key
)

480 
»t
;

482 
	`might_¦“p
();

483 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

485 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

486 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

487  -
EIO
;

489 ià(
	`WARN_ON
(
key
->
lšk_id
 >ğ0 && 
sd©a
->
vif
.
aùive_lšks
 &&

490 !(
sd©a
->
vif
.
aùive_lšks
 & 
	`BIT
(
key
->
lšk_id
))))

491  -
ENOLINK
;

493 
	`Œaû_drv_£t_key
(
loÿl
, 
cmd
, 
sd©a
, 
¡a
, 
key
);

494 
»t
 = 
loÿl
->
İs
->
	`£t_key
(&loÿl->
hw
, 
cmd
, &
sd©a
->
vif
, 
¡a
, 
key
);

495 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

496  
»t
;

497 
	}
}

499 
	$drv_chªge_vif_lšks
(
›“80211_loÿl
 *
loÿl
,

500 
›“80211_sub_if_d©a
 *
sd©a
,

501 
u16
 
Şd_lšks
, u16 
Ãw_lšks
,

502 
›“80211_bss_cÚf
 *
Şd
[
IEEE80211_MLD_MAX_NUM_LINKS
])

504 
›“80211_lšk_d©a
 *
lšk
;

505 
lšks_to_add
;

506 
lšks_to_»m
;

507 
lšk_id
;

508 
»t
 = -
EOPNOTSUPP
;

510 
	`might_¦“p
();

511 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

513 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

514  -
EIO
;

516 ià(
Şd_lšks
 =ğ
Ãw_lšks
)

519 
lšks_to_add
 = ~
Şd_lšks
 & 
Ãw_lšks
;

520 
lšks_to_»m
 = 
Şd_lšks
 & ~
Ãw_lšks
;

522 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
lšks_to_»m
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

523 
lšk
 = 
	`rcu_acûss_poš‹r
(
sd©a
->lšk[
lšk_id
]);

525 
	`›“80211_lšk_debugfs_drv_»move
(
lšk
);

528 
	`Œaû_drv_chªge_vif_lšks
(
loÿl
, 
sd©a
, 
Şd_lšks
, 
Ãw_lšks
);

529 ià(
loÿl
->
İs
->
chªge_vif_lšks
)

530 
»t
 = 
loÿl
->
İs
->
	`chªge_vif_lšks
(&loÿl->
hw
, &
sd©a
->
vif
,

531 
Şd_lšks
, 
Ãw_lšks
, 
Şd
);

532 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

534 ià(
»t
)

535  
»t
;

537 ià(!
loÿl
->
š_»cÚfig
 && !loÿl->
»sumšg
) {

538 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
lšks_to_add
,

539 
IEEE80211_MLD_MAX_NUM_LINKS
) {

540 
lšk
 = 
	`rcu_acûss_poš‹r
(
sd©a
->lšk[
lšk_id
]);

542 
	`›“80211_lšk_debugfs_drv_add
(
lšk
);

547 
	}
}

549 
	$drv_chªge_¡a_lšks
(
›“80211_loÿl
 *
loÿl
,

550 
›“80211_sub_if_d©a
 *
sd©a
,

551 
›“80211_¡a
 *
¡a
,

552 
u16
 
Şd_lšks
, u16 
Ãw_lšks
)

554 
¡a_šfo
 *
šfo
 = 
	`cÚš”_of
(
¡a
, sta_info, sta);

555 
lšk_¡a_šfo
 *
lšk_¡a
;

556 
lšks_to_add
;

557 
lšks_to_»m
;

558 
lšk_id
;

559 
»t
 = -
EOPNOTSUPP
;

561 
	`might_¦“p
();

562 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

564 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

565  -
EIO
;

567 
Şd_lšks
 &ğ
sd©a
->
vif
.
aùive_lšks
;

568 
Ãw_lšks
 &ğ
sd©a
->
vif
.
aùive_lšks
;

570 ià(
Şd_lšks
 =ğ
Ãw_lšks
)

573 
lšks_to_add
 = ~
Şd_lšks
 & 
Ãw_lšks
;

574 
lšks_to_»m
 = 
Şd_lšks
 & ~
Ãw_lšks
;

576 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
lšks_to_»m
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

577 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
šfo
->
lšk
[
lšk_id
],

578 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

580 
	`›“80211_lšk_¡a_debugfs_drv_»move
(
lšk_¡a
);

583 
	`Œaû_drv_chªge_¡a_lšks
(
loÿl
, 
sd©a
, 
¡a
, 
Şd_lšks
, 
Ãw_lšks
);

584 ià(
loÿl
->
İs
->
chªge_¡a_lšks
)

585 
»t
 = 
loÿl
->
İs
->
	`chªge_¡a_lšks
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
,

586 
Şd_lšks
, 
Ãw_lšks
);

587 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

589 ià(
»t
)

590  
»t
;

593 ià(
loÿl
->
š_»cÚfig
 ||†oÿl->
»sumšg
)

596 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
lšks_to_add
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

597 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
šfo
->
lšk
[
lšk_id
],

598 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

599 
	`›“80211_lšk_¡a_debugfs_drv_add
(
lšk_¡a
);

603 
	}
}

	@driver-ops.h

8 #iâdeà
__MAC80211_DRIVER_OPS


9 
	#__MAC80211_DRIVER_OPS


	)

11 
	~<Ãt/mac80211.h
>

12 
	~"›“80211_i.h
"

13 
	~"Œaû.h
"

15 
	#check_sd©a_š_driv”
(
sd©a
) ({ \

16 
	`WARN_ONCE
(!
sd©a
->
loÿl
->
»cÚfig_çu»
 && \

17 !(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
), \

19 
sd©a
->
dev
 ? sd©a->dev->
Çme
 : sd©a->Çme, sd©a->
æags
); \

20 !!(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
); \

21 })

	)

23 
šlše
 
›“80211_sub_if_d©a
 *

24 
	$g‘_bss_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

26 ià(
sd©a
 && sd©a->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

27 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
, 
›“80211_sub_if_d©a
,

28 
u
.
­
);

30  
sd©a
;

31 
	}
}

33 
šlše
 
	$drv_tx
(
›“80211_loÿl
 *
loÿl
,

34 
›“80211_tx_cÚŒŞ
 *
cÚŒŞ
,

35 
sk_buff
 *
skb
)

37 
loÿl
->
İs
->
	`tx
(&loÿl->
hw
, 
cÚŒŞ
, 
skb
);

38 
	}
}

40 
šlše
 
	$drv_sync_rx_queues
(
›“80211_loÿl
 *
loÿl
,

41 
¡a_šfo
 *
¡a
)

43 
	`might_¦“p
();

44 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

46 ià(
loÿl
->
İs
->
sync_rx_queues
) {

47 
	`Œaû_drv_sync_rx_queues
(
loÿl
, 
¡a
->
sd©a
, &sta->sta);

48 
loÿl
->
İs
->
	`sync_rx_queues
(&loÿl->
hw
);

49 
	`Œaû_drv_»tuº_void
(
loÿl
);

51 
	}
}

53 
šlše
 
	$drv_g‘_‘_¡ršgs
(
›“80211_sub_if_d©a
 *
sd©a
,

54 
u32
 
s£t
, 
u8
 *
d©a
)

56 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

57 ià(
loÿl
->
İs
->
g‘_‘_¡ršgs
) {

58 
	`Œaû_drv_g‘_‘_¡ršgs
(
loÿl
, 
s£t
);

59 
loÿl
->
İs
->
	`g‘_‘_¡ršgs
(&loÿl->
hw
, &
sd©a
->
vif
, 
s£t
, 
d©a
);

60 
	`Œaû_drv_»tuº_void
(
loÿl
);

62 
	}
}

64 
šlše
 
	$drv_g‘_‘_¡©s
(
›“80211_sub_if_d©a
 *
sd©a
,

65 
‘htoŞ_¡©s
 *
¡©s
,

66 
u64
 *
d©a
)

68 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

69 ià(
loÿl
->
İs
->
g‘_‘_¡©s
) {

70 
	`Œaû_drv_g‘_‘_¡©s
(
loÿl
);

71 
loÿl
->
İs
->
	`g‘_‘_¡©s
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡©s
, 
d©a
);

72 
	`Œaû_drv_»tuº_void
(
loÿl
);

74 
	}
}

76 
šlše
 
	$drv_g‘_‘_s£t_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
,

77 
s£t
)

79 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

80 
rv
 = 0;

81 ià(
loÿl
->
İs
->
g‘_‘_s£t_couÁ
) {

82 
	`Œaû_drv_g‘_‘_s£t_couÁ
(
loÿl
, 
s£t
);

83 
rv
 = 
loÿl
->
İs
->
	`g‘_‘_s£t_couÁ
(&loÿl->
hw
, &
sd©a
->
vif
,

84 
s£t
);

85 
	`Œaû_drv_»tuº_št
(
loÿl
, 
rv
);

87  
rv
;

88 
	}
}

90 
drv_¡¬t
(
›“80211_loÿl
 *
loÿl
);

91 
drv_¡İ
(
›“80211_loÿl
 *
loÿl
);

93 #ifdeà
CONFIG_PM


94 
šlše
 
	$drv_su¥’d
(
›“80211_loÿl
 *
loÿl
,

95 
cfg80211_wowÏn
 *
wowÏn
)

97 
»t
;

99 
	`might_¦“p
();

100 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

102 
	`Œaû_drv_su¥’d
(
loÿl
);

103 
»t
 = 
loÿl
->
İs
->
	`su¥’d
(&loÿl->
hw
, 
wowÏn
);

104 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

105  
»t
;

106 
	}
}

108 
šlše
 
	$drv_»sume
(
›“80211_loÿl
 *
loÿl
)

110 
»t
;

112 
	`might_¦“p
();

113 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

115 
	`Œaû_drv_»sume
(
loÿl
);

116 
»t
 = 
loÿl
->
İs
->
	`»sume
(&loÿl->
hw
);

117 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

118  
»t
;

119 
	}
}

121 
šlše
 
	$drv_£t_wakeup
(
›“80211_loÿl
 *
loÿl
,

122 
boŞ
 
’abËd
)

124 
	`might_¦“p
();

125 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

127 ià(!
loÿl
->
İs
->
£t_wakeup
)

130 
	`Œaû_drv_£t_wakeup
(
loÿl
, 
’abËd
);

131 
loÿl
->
İs
->
	`£t_wakeup
(&loÿl->
hw
, 
’abËd
);

132 
	`Œaû_drv_»tuº_void
(
loÿl
);

133 
	}
}

136 
drv_add_š‹rçû
(
›“80211_loÿl
 *
loÿl
,

137 
›“80211_sub_if_d©a
 *
sd©a
);

139 
drv_chªge_š‹rçû
(
›“80211_loÿl
 *
loÿl
,

140 
›“80211_sub_if_d©a
 *
sd©a
,

141 
Æ80211_iáy³
 
ty³
, 
boŞ
 
p2p
);

143 
drv_»move_š‹rçû
(
›“80211_loÿl
 *
loÿl
,

144 
›“80211_sub_if_d©a
 *
sd©a
);

146 
šlše
 
	$drv_cÚfig
(
›“80211_loÿl
 *
loÿl
, 
u32
 
chªged
)

148 
»t
;

150 
	`might_¦“p
();

151 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

153 
	`Œaû_drv_cÚfig
(
loÿl
, 
chªged
);

154 
»t
 = 
loÿl
->
İs
->
	`cÚfig
(&loÿl->
hw
, 
chªged
);

155 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

156  
»t
;

157 
	}
}

159 
šlše
 
	$drv_vif_cfg_chªged
(
›“80211_loÿl
 *
loÿl
,

160 
›“80211_sub_if_d©a
 *
sd©a
,

161 
u64
 
chªged
)

163 
	`might_¦“p
();

164 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

166 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

169 
	`Œaû_drv_vif_cfg_chªged
(
loÿl
, 
sd©a
, 
chªged
);

170 ià(
loÿl
->
İs
->
vif_cfg_chªged
)

171 
loÿl
->
İs
->
	`vif_cfg_chªged
(&loÿl->
hw
, &
sd©a
->
vif
, 
chªged
);

172 ià(
loÿl
->
İs
->
bss_šfo_chªged
)

173 
loÿl
->
İs
->
	`bss_šfo_chªged
(&loÿl->
hw
, &
sd©a
->
vif
,

174 &
sd©a
->
vif
.
bss_cÚf
, 
chªged
);

175 
	`Œaû_drv_»tuº_void
(
loÿl
);

176 
	}
}

178 
drv_lšk_šfo_chªged
(
›“80211_loÿl
 *
loÿl
,

179 
›“80211_sub_if_d©a
 *
sd©a
,

180 
›“80211_bss_cÚf
 *
šfo
,

181 
lšk_id
, 
u64
 
chªged
);

183 
šlše
 
u64
 
	$drv_´•¬e_muÉiÿ¡
(
›“80211_loÿl
 *
loÿl
,

184 
Ãtdev_hw_addr_li¡
 *
mc_li¡
)

186 
u64
 
»t
 = 0;

188 
	`Œaû_drv_´•¬e_muÉiÿ¡
(
loÿl
, 
mc_li¡
->
couÁ
);

190 ià(
loÿl
->
İs
->
´•¬e_muÉiÿ¡
)

191 
»t
 = 
loÿl
->
İs
->
	`´•¬e_muÉiÿ¡
(&loÿl->
hw
, 
mc_li¡
);

193 
	`Œaû_drv_»tuº_u64
(
loÿl
, 
»t
);

195  
»t
;

196 
	}
}

198 
šlše
 
	$drv_cÚfigu»_f‹r
(
›“80211_loÿl
 *
loÿl
,

199 
chªged_æags
,

200 *
tÙ®_æags
,

201 
u64
 
muÉiÿ¡
)

203 
	`might_¦“p
();

204 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

206 
	`Œaû_drv_cÚfigu»_f‹r
(
loÿl
, 
chªged_æags
, 
tÙ®_æags
,

207 
muÉiÿ¡
);

208 
loÿl
->
İs
->
	`cÚfigu»_f‹r
(&loÿl->
hw
, 
chªged_æags
, 
tÙ®_æags
,

209 
muÉiÿ¡
);

210 
	`Œaû_drv_»tuº_void
(
loÿl
);

211 
	}
}

213 
šlše
 
	$drv_cÚfig_içû_f‹r
(
›“80211_loÿl
 *
loÿl
,

214 
›“80211_sub_if_d©a
 *
sd©a
,

215 
f‹r_æags
,

216 
chªged_æags
)

218 
	`might_¦“p
();

219 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

221 
	`Œaû_drv_cÚfig_içû_f‹r
(
loÿl
, 
sd©a
, 
f‹r_æags
,

222 
chªged_æags
);

223 ià(
loÿl
->
İs
->
cÚfig_içû_f‹r
)

224 
loÿl
->
İs
->
	`cÚfig_içû_f‹r
(&loÿl->
hw
, &
sd©a
->
vif
,

225 
f‹r_æags
,

226 
chªged_æags
);

227 
	`Œaû_drv_»tuº_void
(
loÿl
);

228 
	}
}

230 
šlše
 
	$drv_£t_tim
(
›“80211_loÿl
 *
loÿl
,

231 
›“80211_¡a
 *
¡a
, 
boŞ
 
£t
)

233 
»t
 = 0;

234 
	`Œaû_drv_£t_tim
(
loÿl
, 
¡a
, 
£t
);

235 ià(
loÿl
->
İs
->
£t_tim
)

236 
»t
 = 
loÿl
->
İs
->
	`£t_tim
(&loÿl->
hw
, 
¡a
, 
£t
);

237 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

238  
»t
;

239 
	}
}

241 
drv_£t_key
(
›“80211_loÿl
 *
loÿl
,

242 
£t_key_cmd
 
cmd
,

243 
›“80211_sub_if_d©a
 *
sd©a
,

244 
›“80211_¡a
 *
¡a
,

245 
›“80211_key_cÚf
 *
key
);

247 
šlše
 
	$drv_upd©e_tk_key
(
›“80211_loÿl
 *
loÿl
,

248 
›“80211_sub_if_d©a
 *
sd©a
,

249 
›“80211_key_cÚf
 *
cÚf
,

250 
¡a_šfo
 *
¡a
, 
u32
 
iv32
,

251 
u16
 *
pha£1key
)

253 
›“80211_¡a
 *
i¡a
 = 
NULL
;

255 ià(
¡a
)

256 
i¡a
 = &
¡a
->sta;

258 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

259 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

262 
	`Œaû_drv_upd©e_tk_key
(
loÿl
, 
sd©a
, 
cÚf
, 
i¡a
, 
iv32
);

263 ià(
loÿl
->
İs
->
upd©e_tk_key
)

264 
loÿl
->
İs
->
	`upd©e_tk_key
(&loÿl->
hw
, &
sd©a
->
vif
, 
cÚf
,

265 
i¡a
, 
iv32
, 
pha£1key
);

266 
	`Œaû_drv_»tuº_void
(
loÿl
);

267 
	}
}

269 
šlše
 
	$drv_hw_sÿn
(
›“80211_loÿl
 *
loÿl
,

270 
›“80211_sub_if_d©a
 *
sd©a
,

271 
›“80211_sÿn_»que¡
 *
»q
)

273 
»t
;

275 
	`might_¦“p
();

276 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

278 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

279  -
EIO
;

281 
	`Œaû_drv_hw_sÿn
(
loÿl
, 
sd©a
);

282 
»t
 = 
loÿl
->
İs
->
	`hw_sÿn
(&loÿl->
hw
, &
sd©a
->
vif
, 
»q
);

283 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

284  
»t
;

285 
	}
}

287 
šlše
 
	$drv_ÿnûl_hw_sÿn
(
›“80211_loÿl
 *
loÿl
,

288 
›“80211_sub_if_d©a
 *
sd©a
)

290 
	`might_¦“p
();

291 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

293 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

296 
	`Œaû_drv_ÿnûl_hw_sÿn
(
loÿl
, 
sd©a
);

297 
loÿl
->
İs
->
	`ÿnûl_hw_sÿn
(&loÿl->
hw
, &
sd©a
->
vif
);

298 
	`Œaû_drv_»tuº_void
(
loÿl
);

299 
	}
}

301 
šlše
 

302 
	$drv_sched_sÿn_¡¬t
(
›“80211_loÿl
 *
loÿl
,

303 
›“80211_sub_if_d©a
 *
sd©a
,

304 
cfg80211_sched_sÿn_»que¡
 *
»q
,

305 
›“80211_sÿn_›s
 *
›s
)

307 
»t
;

309 
	`might_¦“p
();

310 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

312 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

313  -
EIO
;

315 
	`Œaû_drv_sched_sÿn_¡¬t
(
loÿl
, 
sd©a
);

316 
»t
 = 
loÿl
->
İs
->
	`sched_sÿn_¡¬t
(&loÿl->
hw
, &
sd©a
->
vif
,

317 
»q
, 
›s
);

318 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

319  
»t
;

320 
	}
}

322 
šlše
 
	$drv_sched_sÿn_¡İ
(
›“80211_loÿl
 *
loÿl
,

323 
›“80211_sub_if_d©a
 *
sd©a
)

325 
»t
;

327 
	`might_¦“p
();

328 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

330 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

331  -
EIO
;

333 
	`Œaû_drv_sched_sÿn_¡İ
(
loÿl
, 
sd©a
);

334 
»t
 = 
loÿl
->
İs
->
	`sched_sÿn_¡İ
(&loÿl->
hw
, &
sd©a
->
vif
);

335 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

337  
»t
;

338 
	}
}

340 
šlše
 
	$drv_sw_sÿn_¡¬t
(
›“80211_loÿl
 *
loÿl
,

341 
›“80211_sub_if_d©a
 *
sd©a
,

342 cÚ¡ 
u8
 *
mac_addr
)

344 
	`might_¦“p
();

345 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

347 
	`Œaû_drv_sw_sÿn_¡¬t
(
loÿl
, 
sd©a
, 
mac_addr
);

348 ià(
loÿl
->
İs
->
sw_sÿn_¡¬t
)

349 
loÿl
->
İs
->
	`sw_sÿn_¡¬t
(&loÿl->
hw
, &
sd©a
->
vif
, 
mac_addr
);

350 
	`Œaû_drv_»tuº_void
(
loÿl
);

351 
	}
}

353 
šlše
 
	$drv_sw_sÿn_com¶‘e
(
›“80211_loÿl
 *
loÿl
,

354 
›“80211_sub_if_d©a
 *
sd©a
)

356 
	`might_¦“p
();

357 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

359 
	`Œaû_drv_sw_sÿn_com¶‘e
(
loÿl
, 
sd©a
);

360 ià(
loÿl
->
İs
->
sw_sÿn_com¶‘e
)

361 
loÿl
->
İs
->
	`sw_sÿn_com¶‘e
(&loÿl->
hw
, &
sd©a
->
vif
);

362 
	`Œaû_drv_»tuº_void
(
loÿl
);

363 
	}
}

365 
šlše
 
	$drv_g‘_¡©s
(
›“80211_loÿl
 *
loÿl
,

366 
›“80211_low_Ëv–_¡©s
 *
¡©s
)

368 
»t
 = -
EOPNOTSUPP
;

370 
	`might_¦“p
();

371 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

373 ià(
loÿl
->
İs
->
g‘_¡©s
)

374 
»t
 = 
loÿl
->
İs
->
	`g‘_¡©s
(&loÿl->
hw
, 
¡©s
);

375 
	`Œaû_drv_g‘_¡©s
(
loÿl
, 
¡©s
, 
»t
);

377  
»t
;

378 
	}
}

380 
šlše
 
	$drv_g‘_key_£q
(
›“80211_loÿl
 *
loÿl
,

381 
›“80211_key
 *
key
,

382 
›“80211_key_£q
 *
£q
)

384 ià(
loÿl
->
İs
->
g‘_key_£q
)

385 
loÿl
->
İs
->
	`g‘_key_£q
(&loÿl->
hw
, &
key
->
cÚf
, 
£q
);

386 
	`Œaû_drv_g‘_key_£q
(
loÿl
, &
key
->
cÚf
);

387 
	}
}

389 
šlše
 
	$drv_£t_äag_th»shŞd
(
›“80211_loÿl
 *
loÿl
,

390 
u32
 
v®ue
)

392 
»t
 = 0;

394 
	`might_¦“p
();

395 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

397 
	`Œaû_drv_£t_äag_th»shŞd
(
loÿl
, 
v®ue
);

398 ià(
loÿl
->
İs
->
£t_äag_th»shŞd
)

399 
»t
 = 
loÿl
->
İs
->
	`£t_äag_th»shŞd
(&loÿl->
hw
, 
v®ue
);

400 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

401  
»t
;

402 
	}
}

404 
šlše
 
	$drv_£t_¹s_th»shŞd
(
›“80211_loÿl
 *
loÿl
,

405 
u32
 
v®ue
)

407 
»t
 = 0;

409 
	`might_¦“p
();

410 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

412 
	`Œaû_drv_£t_¹s_th»shŞd
(
loÿl
, 
v®ue
);

413 ià(
loÿl
->
İs
->
£t_¹s_th»shŞd
)

414 
»t
 = 
loÿl
->
İs
->
	`£t_¹s_th»shŞd
(&loÿl->
hw
, 
v®ue
);

415 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

416  
»t
;

417 
	}
}

419 
šlše
 
	$drv_£t_cov”age_şass
(
›“80211_loÿl
 *
loÿl
,

420 
s16
 
v®ue
)

422 
»t
 = 0;

423 
	`might_¦“p
();

424 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

426 
	`Œaû_drv_£t_cov”age_şass
(
loÿl
, 
v®ue
);

427 ià(
loÿl
->
İs
->
£t_cov”age_şass
)

428 
loÿl
->
İs
->
	`£t_cov”age_şass
(&loÿl->
hw
, 
v®ue
);

430 
»t
 = -
EOPNOTSUPP
;

432 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

433  
»t
;

434 
	}
}

436 
šlše
 
	$drv_¡a_nÙify
(
›“80211_loÿl
 *
loÿl
,

437 
›“80211_sub_if_d©a
 *
sd©a
,

438 
¡a_nÙify_cmd
 
cmd
,

439 
›“80211_¡a
 *
¡a
)

441 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

442 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

445 
	`Œaû_drv_¡a_nÙify
(
loÿl
, 
sd©a
, 
cmd
, 
¡a
);

446 ià(
loÿl
->
İs
->
¡a_nÙify
)

447 
loÿl
->
İs
->
	`¡a_nÙify
(&loÿl->
hw
, &
sd©a
->
vif
, 
cmd
, 
¡a
);

448 
	`Œaû_drv_»tuº_void
(
loÿl
);

449 
	}
}

451 
šlše
 
	$drv_¡a_add
(
›“80211_loÿl
 *
loÿl
,

452 
›“80211_sub_if_d©a
 *
sd©a
,

453 
›“80211_¡a
 *
¡a
)

455 
»t
 = 0;

457 
	`might_¦“p
();

458 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

460 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

461 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

462  -
EIO
;

464 
	`Œaû_drv_¡a_add
(
loÿl
, 
sd©a
, 
¡a
);

465 ià(
loÿl
->
İs
->
¡a_add
)

466 
»t
 = 
loÿl
->
İs
->
	`¡a_add
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
);

468 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

470  
»t
;

471 
	}
}

473 
šlše
 
	$drv_¡a_»move
(
›“80211_loÿl
 *
loÿl
,

474 
›“80211_sub_if_d©a
 *
sd©a
,

475 
›“80211_¡a
 *
¡a
)

477 
	`might_¦“p
();

478 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

480 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

481 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

484 
	`Œaû_drv_¡a_»move
(
loÿl
, 
sd©a
, 
¡a
);

485 ià(
loÿl
->
İs
->
¡a_»move
)

486 
loÿl
->
İs
->
	`¡a_»move
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
);

488 
	`Œaû_drv_»tuº_void
(
loÿl
);

489 
	}
}

491 #ifdeà
CONFIG_MAC80211_DEBUGFS


492 
šlše
 
	$drv_vif_add_debugfs
(
›“80211_loÿl
 *
loÿl
,

493 
›“80211_sub_if_d©a
 *
sd©a
)

495 
	`might_¦“p
();

497 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 ||

498 
	`WARN_ON
(!
sd©a
->
vif
.
debugfs_dœ
))

501 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

502 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

505 ià(
loÿl
->
İs
->
vif_add_debugfs
)

506 
loÿl
->
İs
->
	`vif_add_debugfs
(&loÿl->
hw
, &
sd©a
->
vif
);

507 
	}
}

509 
šlše
 
	$drv_lšk_add_debugfs
(
›“80211_loÿl
 *
loÿl
,

510 
›“80211_sub_if_d©a
 *
sd©a
,

511 
›“80211_bss_cÚf
 *
lšk_cÚf
,

512 
d’Œy
 *
dœ
)

514 
	`might_¦“p
();

515 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

517 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

518 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

521 ià(
loÿl
->
İs
->
lšk_add_debugfs
)

522 
loÿl
->
İs
->
	`lšk_add_debugfs
(&loÿl->
hw
, &
sd©a
->
vif
,

523 
lšk_cÚf
, 
dœ
);

524 
	}
}

526 
šlše
 
	$drv_¡a_add_debugfs
(
›“80211_loÿl
 *
loÿl
,

527 
›“80211_sub_if_d©a
 *
sd©a
,

528 
›“80211_¡a
 *
¡a
,

529 
d’Œy
 *
dœ
)

531 
	`might_¦“p
();

532 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

534 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

535 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

538 ià(
loÿl
->
İs
->
¡a_add_debugfs
)

539 
loÿl
->
İs
->
	`¡a_add_debugfs
(&loÿl->
hw
, &
sd©a
->
vif
,

540 
¡a
, 
dœ
);

541 
	}
}

543 
šlše
 
	$drv_lšk_¡a_add_debugfs
(
›“80211_loÿl
 *
loÿl
,

544 
›“80211_sub_if_d©a
 *
sd©a
,

545 
›“80211_lšk_¡a
 *
lšk_¡a
,

546 
d’Œy
 *
dœ
)

548 
	`might_¦“p
();

549 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

551 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

552 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

555 ià(
loÿl
->
İs
->
lšk_¡a_add_debugfs
)

556 
loÿl
->
İs
->
	`lšk_¡a_add_debugfs
(&loÿl->
hw
, &
sd©a
->
vif
,

557 
lšk_¡a
, 
dœ
);

558 
	}
}

560 
šlše
 
	$drv_vif_add_debugfs
(
›“80211_loÿl
 *
loÿl
,

561 
›“80211_sub_if_d©a
 *
sd©a
)

563 
	`might_¦“p
();

564 
	}
}

567 
šlše
 
	$drv_¡a_´e_rcu_»move
(
›“80211_loÿl
 *
loÿl
,

568 
›“80211_sub_if_d©a
 *
sd©a
,

569 
¡a_šfo
 *
¡a
)

571 
	`might_¦“p
();

572 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

574 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

575 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

578 
	`Œaû_drv_¡a_´e_rcu_»move
(
loÿl
, 
sd©a
, &
¡a
->sta);

579 ià(
loÿl
->
İs
->
¡a_´e_rcu_»move
)

580 
loÿl
->
İs
->
	`¡a_´e_rcu_»move
(&loÿl->
hw
, &
sd©a
->
vif
,

581 &
¡a
->sta);

582 
	`Œaû_drv_»tuº_void
(
loÿl
);

583 
	}
}

585 
__mu¡_check


586 
drv_¡a_¡©e
(
›“80211_loÿl
 *
loÿl
,

587 
›“80211_sub_if_d©a
 *
sd©a
,

588 
¡a_šfo
 *
¡a
,

589 
›“80211_¡a_¡©e
 
Şd_¡©e
,

590 
›“80211_¡a_¡©e
 
Ãw_¡©e
);

592 
__mu¡_check


593 
drv_¡a_£t_txpwr
(
›“80211_loÿl
 *
loÿl
,

594 
›“80211_sub_if_d©a
 *
sd©a
,

595 
¡a_šfo
 *
¡a
);

597 
drv_¡a_rc_upd©e
(
›“80211_loÿl
 *
loÿl
,

598 
›“80211_sub_if_d©a
 *
sd©a
,

599 
›“80211_¡a
 *
¡a
, 
u32
 
chªged
);

601 
šlše
 
	$drv_¡a_¿‹_tbl_upd©e
(
›“80211_loÿl
 *
loÿl
,

602 
›“80211_sub_if_d©a
 *
sd©a
,

603 
›“80211_¡a
 *
¡a
)

605 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

606 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

609 
	`Œaû_drv_¡a_¿‹_tbl_upd©e
(
loÿl
, 
sd©a
, 
¡a
);

610 ià(
loÿl
->
İs
->
¡a_¿‹_tbl_upd©e
)

611 
loÿl
->
İs
->
	`¡a_¿‹_tbl_upd©e
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
);

613 
	`Œaû_drv_»tuº_void
(
loÿl
);

614 
	}
}

616 
šlše
 
	$drv_¡a_¡©i¡ics
(
›“80211_loÿl
 *
loÿl
,

617 
›“80211_sub_if_d©a
 *
sd©a
,

618 
›“80211_¡a
 *
¡a
,

619 
¡©iÚ_šfo
 *
sšfo
)

621 
	`might_¦“p
();

622 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

624 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

625 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

628 
	`Œaû_drv_¡a_¡©i¡ics
(
loÿl
, 
sd©a
, 
¡a
);

629 ià(
loÿl
->
İs
->
¡a_¡©i¡ics
)

630 
loÿl
->
İs
->
	`¡a_¡©i¡ics
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
, 
sšfo
);

631 
	`Œaû_drv_»tuº_void
(
loÿl
);

632 
	}
}

634 
drv_cÚf_tx
(
›“80211_loÿl
 *
loÿl
,

635 
›“80211_lšk_d©a
 *
lšk
, 
u16
 
ac
,

636 cÚ¡ 
›“80211_tx_queue_·¿ms
 *
·¿ms
);

638 
u64
 
drv_g‘_tsf
(
›“80211_loÿl
 *
loÿl
,

639 
›“80211_sub_if_d©a
 *
sd©a
);

640 
drv_£t_tsf
(
›“80211_loÿl
 *
loÿl
,

641 
›“80211_sub_if_d©a
 *
sd©a
,

642 
u64
 
tsf
);

643 
drv_off£t_tsf
(
›“80211_loÿl
 *
loÿl
,

644 
›“80211_sub_if_d©a
 *
sd©a
,

645 
s64
 
off£t
);

646 
drv_»£t_tsf
(
›“80211_loÿl
 *
loÿl
,

647 
›“80211_sub_if_d©a
 *
sd©a
);

649 
šlše
 
	$drv_tx_Ï¡_b—cÚ
(
›“80211_loÿl
 *
loÿl
)

651 
»t
 = 0;

653 
	`might_¦“p
();

654 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

656 
	`Œaû_drv_tx_Ï¡_b—cÚ
(
loÿl
);

657 ià(
loÿl
->
İs
->
tx_Ï¡_b—cÚ
)

658 
»t
 = 
loÿl
->
İs
->
	`tx_Ï¡_b—cÚ
(&loÿl->
hw
);

659 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

660  
»t
;

661 
	}
}

663 
drv_ampdu_aùiÚ
(
›“80211_loÿl
 *
loÿl
,

664 
›“80211_sub_if_d©a
 *
sd©a
,

665 
›“80211_ampdu_·¿ms
 *
·¿ms
);

667 
šlše
 
	$drv_g‘_survey
(
›“80211_loÿl
 *
loÿl
, 
idx
,

668 
survey_šfo
 *
survey
)

670 
»t
 = -
EOPNOTSUPP
;

672 
	`might_¦“p
();

673 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

675 
	`Œaû_drv_g‘_survey
(
loÿl
, 
idx
, 
survey
);

677 ià(
loÿl
->
İs
->
g‘_survey
)

678 
»t
 = 
loÿl
->
İs
->
	`g‘_survey
(&loÿl->
hw
, 
idx
, 
survey
);

680 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

682  
»t
;

683 
	}
}

685 
šlše
 
	$drv_rfkl_pŞl
(
›“80211_loÿl
 *
loÿl
)

687 
	`might_¦“p
();

688 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

690 ià(
loÿl
->
İs
->
rfkl_pŞl
)

691 
loÿl
->
İs
->
	`rfkl_pŞl
(&loÿl->
hw
);

692 
	}
}

694 
šlše
 
	$drv_æush
(
›“80211_loÿl
 *
loÿl
,

695 
›“80211_sub_if_d©a
 *
sd©a
,

696 
u32
 
queues
, 
boŞ
 
drİ
)

698 
›“80211_vif
 *
vif
;

700 
	`might_¦“p
();

701 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

703 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

704 
vif
 = 
sd©a
 ? &sd©a->vià: 
NULL
;

706 ià(
sd©a
 && !
	`check_sd©a_š_driv”
(sdata))

709 
	`Œaû_drv_æush
(
loÿl
, 
queues
, 
drİ
);

710 ià(
loÿl
->
İs
->
æush
)

711 
loÿl
->
İs
->
	`æush
(&loÿl->
hw
, 
vif
, 
queues
, 
drİ
);

712 
	`Œaû_drv_»tuº_void
(
loÿl
);

713 
	}
}

715 
šlše
 
	$drv_æush_¡a
(
›“80211_loÿl
 *
loÿl
,

716 
›“80211_sub_if_d©a
 *
sd©a
,

717 
¡a_šfo
 *
¡a
)

719 
	`might_¦“p
();

720 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

722 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

724 ià(
sd©a
 && !
	`check_sd©a_š_driv”
(sdata))

727 
	`Œaû_drv_æush_¡a
(
loÿl
, 
sd©a
, &
¡a
->sta);

728 ià(
loÿl
->
İs
->
æush_¡a
)

729 
loÿl
->
İs
->
	`æush_¡a
(&loÿl->
hw
, &
sd©a
->
vif
, &
¡a
->sta);

730 
	`Œaû_drv_»tuº_void
(
loÿl
);

731 
	}
}

733 
šlše
 
	$drv_chªÃl_sw™ch
(
›“80211_loÿl
 *
loÿl
,

734 
›“80211_sub_if_d©a
 *
sd©a
,

735 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
)

737 
	`might_¦“p
();

738 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

740 
	`Œaû_drv_chªÃl_sw™ch
(
loÿl
, 
sd©a
, 
ch_sw™ch
);

741 
loÿl
->
İs
->
	`chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
, 
ch_sw™ch
);

742 
	`Œaû_drv_»tuº_void
(
loÿl
);

743 
	}
}

746 
šlše
 
	$drv_£t_ª‹Âa
(
›“80211_loÿl
 *
loÿl
,

747 
u32
 
tx_ªt
, u32 
rx_ªt
)

749 
»t
 = -
EOPNOTSUPP
;

750 
	`might_¦“p
();

751 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

752 ià(
loÿl
->
İs
->
£t_ª‹Âa
)

753 
»t
 = 
loÿl
->
İs
->
	`£t_ª‹Âa
(&loÿl->
hw
, 
tx_ªt
, 
rx_ªt
);

754 
	`Œaû_drv_£t_ª‹Âa
(
loÿl
, 
tx_ªt
, 
rx_ªt
, 
»t
);

755  
»t
;

756 
	}
}

758 
šlše
 
	$drv_g‘_ª‹Âa
(
›“80211_loÿl
 *
loÿl
,

759 
u32
 *
tx_ªt
, u32 *
rx_ªt
)

761 
»t
 = -
EOPNOTSUPP
;

762 
	`might_¦“p
();

763 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

764 ià(
loÿl
->
İs
->
g‘_ª‹Âa
)

765 
»t
 = 
loÿl
->
İs
->
	`g‘_ª‹Âa
(&loÿl->
hw
, 
tx_ªt
, 
rx_ªt
);

766 
	`Œaû_drv_g‘_ª‹Âa
(
loÿl
, *
tx_ªt
, *
rx_ªt
, 
»t
);

767  
»t
;

768 
	}
}

770 
šlše
 
	$drv_»maš_Ú_chªÃl
(
›“80211_loÿl
 *
loÿl
,

771 
›“80211_sub_if_d©a
 *
sd©a
,

772 
›“80211_chªÃl
 *
chª
,

773 
du¿tiÚ
,

774 
›“80211_roc_ty³
 
ty³
)

776 
»t
;

778 
	`might_¦“p
();

779 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

781 
	`Œaû_drv_»maš_Ú_chªÃl
(
loÿl
, 
sd©a
, 
chª
, 
du¿tiÚ
, 
ty³
);

782 
»t
 = 
loÿl
->
İs
->
	`»maš_Ú_chªÃl
(&loÿl->
hw
, &
sd©a
->
vif
,

783 
chª
, 
du¿tiÚ
, 
ty³
);

784 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

786  
»t
;

787 
	}
}

789 
šlše
 

790 
	$drv_ÿnûl_»maš_Ú_chªÃl
(
›“80211_loÿl
 *
loÿl
,

791 
›“80211_sub_if_d©a
 *
sd©a
)

793 
»t
;

795 
	`might_¦“p
();

796 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

798 
	`Œaû_drv_ÿnûl_»maš_Ú_chªÃl
(
loÿl
, 
sd©a
);

799 
»t
 = 
loÿl
->
İs
->
	`ÿnûl_»maš_Ú_chªÃl
(&loÿl->
hw
, &
sd©a
->
vif
);

800 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

802  
»t
;

803 
	}
}

805 
šlše
 
	$drv_£t_ršg·¿m
(
›“80211_loÿl
 *
loÿl
,

806 
u32
 
tx
, u32 
rx
)

808 
»t
 = -
EOPNOTSUPP
;

810 
	`might_¦“p
();

811 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

813 
	`Œaû_drv_£t_ršg·¿m
(
loÿl
, 
tx
, 
rx
);

814 ià(
loÿl
->
İs
->
£t_ršg·¿m
)

815 
»t
 = 
loÿl
->
İs
->
	`£t_ršg·¿m
(&loÿl->
hw
, 
tx
, 
rx
);

816 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

818  
»t
;

819 
	}
}

821 
šlše
 
	$drv_g‘_ršg·¿m
(
›“80211_loÿl
 *
loÿl
,

822 
u32
 *
tx
, u32 *
tx_max
, u32 *
rx
, u32 *
rx_max
)

824 
	`might_¦“p
();

825 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

827 
	`Œaû_drv_g‘_ršg·¿m
(
loÿl
, 
tx
, 
tx_max
, 
rx
, 
rx_max
);

828 ià(
loÿl
->
İs
->
g‘_ršg·¿m
)

829 
loÿl
->
İs
->
	`g‘_ršg·¿m
(&loÿl->
hw
, 
tx
, 
tx_max
, 
rx
, 
rx_max
);

830 
	`Œaû_drv_»tuº_void
(
loÿl
);

831 
	}
}

833 
šlše
 
boŞ
 
	$drv_tx_äames_³ndšg
(
›“80211_loÿl
 *
loÿl
)

835 
boŞ
 
»t
 = 
çl£
;

837 
	`might_¦“p
();

838 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

840 
	`Œaû_drv_tx_äames_³ndšg
(
loÿl
);

841 ià(
loÿl
->
İs
->
tx_äames_³ndšg
)

842 
»t
 = 
loÿl
->
İs
->
	`tx_äames_³ndšg
(&loÿl->
hw
);

843 
	`Œaû_drv_»tuº_boŞ
(
loÿl
, 
»t
);

845  
»t
;

846 
	}
}

848 
šlše
 
	$drv_£t_b™¿‹_mask
(
›“80211_loÿl
 *
loÿl
,

849 
›“80211_sub_if_d©a
 *
sd©a
,

850 cÚ¡ 
cfg80211_b™¿‹_mask
 *
mask
)

852 
»t
 = -
EOPNOTSUPP
;

854 
	`might_¦“p
();

855 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

857 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

858  -
EIO
;

860 
	`Œaû_drv_£t_b™¿‹_mask
(
loÿl
, 
sd©a
, 
mask
);

861 ià(
loÿl
->
İs
->
£t_b™¿‹_mask
)

862 
»t
 = 
loÿl
->
İs
->
	`£t_b™¿‹_mask
(&loÿl->
hw
,

863 &
sd©a
->
vif
, 
mask
);

864 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

866  
»t
;

867 
	}
}

869 
šlše
 
	$drv_£t_»key_d©a
(
›“80211_loÿl
 *
loÿl
,

870 
›“80211_sub_if_d©a
 *
sd©a
,

871 
cfg80211_gtk_»key_d©a
 *
d©a
)

873 
	`might_¦“p
();

874 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

876 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

879 
	`Œaû_drv_£t_»key_d©a
(
loÿl
, 
sd©a
, 
d©a
);

880 ià(
loÿl
->
İs
->
£t_»key_d©a
)

881 
loÿl
->
İs
->
	`£t_»key_d©a
(&loÿl->
hw
, &
sd©a
->
vif
, 
d©a
);

882 
	`Œaû_drv_»tuº_void
(
loÿl
);

883 
	}
}

885 
šlše
 
	$drv_ev’t_ÿÎback
(
›“80211_loÿl
 *
loÿl
,

886 
›“80211_sub_if_d©a
 *
sd©a
,

887 cÚ¡ 
›“80211_ev’t
 *
ev’t
)

889 
	`Œaû_drv_ev’t_ÿÎback
(
loÿl
, 
sd©a
, 
ev’t
);

890 ià(
loÿl
->
İs
->
ev’t_ÿÎback
)

891 
loÿl
->
İs
->
	`ev’t_ÿÎback
(&loÿl->
hw
, &
sd©a
->
vif
, 
ev’t
);

892 
	`Œaû_drv_»tuº_void
(
loÿl
);

893 
	}
}

895 
šlše
 

896 
	$drv_»Ëa£_bufã»d_äames
(
›“80211_loÿl
 *
loÿl
,

897 
¡a_šfo
 *
¡a
, 
u16
 
tids
, 
num_äames
,

898 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

899 
boŞ
 
mÜe_d©a
)

901 
	`Œaû_drv_»Ëa£_bufã»d_äames
(
loÿl
, &
¡a
->¡a, 
tids
, 
num_äames
,

902 
»asÚ
, 
mÜe_d©a
);

903 ià(
loÿl
->
İs
->
»Ëa£_bufã»d_äames
)

904 
loÿl
->
İs
->
	`»Ëa£_bufã»d_äames
(&loÿl->
hw
, &
¡a
->¡a, 
tids
,

905 
num_äames
, 
»asÚ
,

906 
mÜe_d©a
);

907 
	`Œaû_drv_»tuº_void
(
loÿl
);

908 
	}
}

910 
šlše
 

911 
	$drv_®low_bufã»d_äames
(
›“80211_loÿl
 *
loÿl
,

912 
¡a_šfo
 *
¡a
, 
u16
 
tids
, 
num_äames
,

913 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

914 
boŞ
 
mÜe_d©a
)

916 
	`Œaû_drv_®low_bufã»d_äames
(
loÿl
, &
¡a
->¡a, 
tids
, 
num_äames
,

917 
»asÚ
, 
mÜe_d©a
);

918 ià(
loÿl
->
İs
->
®low_bufã»d_äames
)

919 
loÿl
->
İs
->
	`®low_bufã»d_äames
(&loÿl->
hw
, &
¡a
->sta,

920 
tids
, 
num_äames
, 
»asÚ
,

921 
mÜe_d©a
);

922 
	`Œaû_drv_»tuº_void
(
loÿl
);

923 
	}
}

925 
šlše
 
	$drv_mgd_´•¬e_tx
(
›“80211_loÿl
 *
loÿl
,

926 
›“80211_sub_if_d©a
 *
sd©a
,

927 
›“80211_´•_tx_šfo
 *
šfo
)

929 
	`might_¦“p
();

930 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

932 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

934 
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
);

936 
šfo
->
lšk_id
 = info->link_id < 0 ? 0 : info->link_id;

937 
	`Œaû_drv_mgd_´•¬e_tx
(
loÿl
, 
sd©a
, 
šfo
->
du¿tiÚ
,

938 
šfo
->
subty³
, info->
sucûss
);

939 ià(
loÿl
->
İs
->
mgd_´•¬e_tx
)

940 
loÿl
->
İs
->
	`mgd_´•¬e_tx
(&loÿl->
hw
, &
sd©a
->
vif
, 
šfo
);

941 
	`Œaû_drv_»tuº_void
(
loÿl
);

942 
	}
}

944 
šlše
 
	$drv_mgd_com¶‘e_tx
(
›“80211_loÿl
 *
loÿl
,

945 
›“80211_sub_if_d©a
 *
sd©a
,

946 
›“80211_´•_tx_šfo
 *
šfo
)

948 
	`might_¦“p
();

949 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

951 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

953 
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
);

955 
	`Œaû_drv_mgd_com¶‘e_tx
(
loÿl
, 
sd©a
, 
šfo
->
du¿tiÚ
,

956 
šfo
->
subty³
, info->
sucûss
);

957 ià(
loÿl
->
İs
->
mgd_com¶‘e_tx
)

958 
loÿl
->
İs
->
	`mgd_com¶‘e_tx
(&loÿl->
hw
, &
sd©a
->
vif
, 
šfo
);

959 
	`Œaû_drv_»tuº_void
(
loÿl
);

960 
	}
}

962 
šlše
 

963 
	$drv_mgd_´Ùeù_tdls_discov”
(
›“80211_loÿl
 *
loÿl
,

964 
›“80211_sub_if_d©a
 *
sd©a
,

965 
lšk_id
)

967 
	`might_¦“p
();

968 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

970 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

972 
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
);

974 
lšk_id
 =†ink_id > 0 ?†ink_id : 0;

976 
	`Œaû_drv_mgd_´Ùeù_tdls_discov”
(
loÿl
, 
sd©a
);

977 ià(
loÿl
->
İs
->
mgd_´Ùeù_tdls_discov”
)

978 
loÿl
->
İs
->
	`mgd_´Ùeù_tdls_discov”
(&loÿl->
hw
, &
sd©a
->
vif
,

979 
lšk_id
);

980 
	`Œaû_drv_»tuº_void
(
loÿl
);

981 
	}
}

983 
šlše
 
	$drv_add_chªùx
(
›“80211_loÿl
 *
loÿl
,

984 
›“80211_chªùx
 *
ùx
)

986 
»t
 = -
EOPNOTSUPP
;

988 
	`might_¦“p
();

989 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

991 
	`Œaû_drv_add_chªùx
(
loÿl
, 
ùx
);

992 ià(
loÿl
->
İs
->
add_chªùx
)

993 
»t
 = 
loÿl
->
İs
->
	`add_chªùx
(&loÿl->
hw
, &
ùx
->
cÚf
);

994 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

995 ià(!
»t
)

996 
ùx
->
driv”_´e£Á
 = 
Œue
;

998  
»t
;

999 
	}
}

1001 
šlše
 
	$drv_»move_chªùx
(
›“80211_loÿl
 *
loÿl
,

1002 
›“80211_chªùx
 *
ùx
)

1004 
	`might_¦“p
();

1005 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1007 ià(
	`WARN_ON
(!
ùx
->
driv”_´e£Á
))

1010 
	`Œaû_drv_»move_chªùx
(
loÿl
, 
ùx
);

1011 ià(
loÿl
->
İs
->
»move_chªùx
)

1012 
loÿl
->
İs
->
	`»move_chªùx
(&loÿl->
hw
, &
ùx
->
cÚf
);

1013 
	`Œaû_drv_»tuº_void
(
loÿl
);

1014 
ùx
->
driv”_´e£Á
 = 
çl£
;

1015 
	}
}

1017 
šlše
 
	$drv_chªge_chªùx
(
›“80211_loÿl
 *
loÿl
,

1018 
›“80211_chªùx
 *
ùx
,

1019 
u32
 
chªged
)

1021 
	`might_¦“p
();

1022 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1024 
	`Œaû_drv_chªge_chªùx
(
loÿl
, 
ùx
, 
chªged
);

1025 ià(
loÿl
->
İs
->
chªge_chªùx
) {

1026 
	`WARN_ON_ONCE
(!
ùx
->
driv”_´e£Á
);

1027 
loÿl
->
İs
->
	`chªge_chªùx
(&loÿl->
hw
, &
ùx
->
cÚf
, 
chªged
);

1029 
	`Œaû_drv_»tuº_void
(
loÿl
);

1030 
	}
}

1032 
drv_assign_vif_chªùx
(
›“80211_loÿl
 *
loÿl
,

1033 
›“80211_sub_if_d©a
 *
sd©a
,

1034 
›“80211_bss_cÚf
 *
lšk_cÚf
,

1035 
›“80211_chªùx
 *
ùx
);

1036 
drv_uÇssign_vif_chªùx
(
›“80211_loÿl
 *
loÿl
,

1037 
›“80211_sub_if_d©a
 *
sd©a
,

1038 
›“80211_bss_cÚf
 *
lšk_cÚf
,

1039 
›“80211_chªùx
 *
ùx
);

1040 
drv_sw™ch_vif_chªùx
(
›“80211_loÿl
 *
loÿl
,

1041 
›“80211_vif_chªùx_sw™ch
 *
vifs
,

1042 
n_vifs
, 
›“80211_chªùx_sw™ch_mode
 
mode
);

1044 
šlše
 
	$drv_¡¬t_­
(
›“80211_loÿl
 *
loÿl
,

1045 
›“80211_sub_if_d©a
 *
sd©a
,

1046 
›“80211_bss_cÚf
 *
lšk_cÚf
)

1048 
»t
 = 0;

1050 
	`might_¦“p
();

1051 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1053 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1054  -
EIO
;

1056 
	`Œaû_drv_¡¬t_­
(
loÿl
, 
sd©a
, 
lšk_cÚf
);

1057 ià(
loÿl
->
İs
->
¡¬t_­
)

1058 
»t
 = 
loÿl
->
İs
->
	`¡¬t_­
(&loÿl->
hw
, &
sd©a
->
vif
, 
lšk_cÚf
);

1059 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1060  
»t
;

1061 
	}
}

1063 
šlše
 
	$drv_¡İ_­
(
›“80211_loÿl
 *
loÿl
,

1064 
›“80211_sub_if_d©a
 *
sd©a
,

1065 
›“80211_bss_cÚf
 *
lšk_cÚf
)

1067 
	`might_¦“p
();

1068 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1070 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1073 
	`Œaû_drv_¡İ_­
(
loÿl
, 
sd©a
, 
lšk_cÚf
);

1074 ià(
loÿl
->
İs
->
¡İ_­
)

1075 
loÿl
->
İs
->
	`¡İ_­
(&loÿl->
hw
, &
sd©a
->
vif
, 
lšk_cÚf
);

1076 
	`Œaû_drv_»tuº_void
(
loÿl
);

1077 
	}
}

1079 
šlše
 

1080 
	$drv_»cÚfig_com¶‘e
(
›“80211_loÿl
 *
loÿl
,

1081 
›“80211_»cÚfig_ty³
 
»cÚfig_ty³
)

1083 
	`might_¦“p
();

1084 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1086 
	`Œaû_drv_»cÚfig_com¶‘e
(
loÿl
, 
»cÚfig_ty³
);

1087 ià(
loÿl
->
İs
->
»cÚfig_com¶‘e
)

1088 
loÿl
->
İs
->
	`»cÚfig_com¶‘e
(&loÿl->
hw
, 
»cÚfig_ty³
);

1089 
	`Œaû_drv_»tuº_void
(
loÿl
);

1090 
	}
}

1092 
šlše
 

1093 
	$drv_£t_deçuÉ_uniÿ¡_key
(
›“80211_loÿl
 *
loÿl
,

1094 
›“80211_sub_if_d©a
 *
sd©a
,

1095 
key_idx
)

1097 
	`might_¦“p
();

1098 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1100 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1103 
	`WARN_ON_ONCE
(
key_idx
 < -1 || key_idx > 3);

1105 
	`Œaû_drv_£t_deçuÉ_uniÿ¡_key
(
loÿl
, 
sd©a
, 
key_idx
);

1106 ià(
loÿl
->
İs
->
£t_deçuÉ_uniÿ¡_key
)

1107 
loÿl
->
İs
->
	`£t_deçuÉ_uniÿ¡_key
(&loÿl->
hw
, &
sd©a
->
vif
,

1108 
key_idx
);

1109 
	`Œaû_drv_»tuº_void
(
loÿl
);

1110 
	}
}

1112 #ià
IS_ENABLED
(
CONFIG_IPV6
)

1113 
šlše
 
	$drv_v6_addr_chªge
(
›“80211_loÿl
 *
loÿl
,

1114 
›“80211_sub_if_d©a
 *
sd©a
,

1115 
š‘6_dev
 *
idev
)

1117 
	`Œaû_drv_v6_addr_chªge
(
loÿl
, 
sd©a
);

1118 ià(
loÿl
->
İs
->
v6_addr_chªge
)

1119 
loÿl
->
İs
->
	`v6_addr_chªge
(&loÿl->
hw
, &
sd©a
->
vif
, 
idev
);

1120 
	`Œaû_drv_»tuº_void
(
loÿl
);

1121 
	}
}

1124 
šlše
 

1125 
	$drv_chªÃl_sw™ch_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1126 
cfg80211_chª_def
 *
chªdef
)

1128 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1130 
	`might_¦“p
();

1131 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1133 ià(
loÿl
->
İs
->
chªÃl_sw™ch_b—cÚ
) {

1134 
	`Œaû_drv_chªÃl_sw™ch_b—cÚ
(
loÿl
, 
sd©a
, 
chªdef
);

1135 
loÿl
->
İs
->
	`chªÃl_sw™ch_b—cÚ
(&loÿl->
hw
, &
sd©a
->
vif
,

1136 
chªdef
);

1138 
	}
}

1140 
šlše
 

1141 
	$drv_´e_chªÃl_sw™ch
(
›“80211_sub_if_d©a
 *
sd©a
,

1142 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
)

1144 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1145 
»t
 = 0;

1147 
	`might_¦“p
();

1148 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1150 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1151  -
EIO
;

1153 
	`Œaû_drv_´e_chªÃl_sw™ch
(
loÿl
, 
sd©a
, 
ch_sw™ch
);

1154 ià(
loÿl
->
İs
->
´e_chªÃl_sw™ch
)

1155 
»t
 = 
loÿl
->
İs
->
	`´e_chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
,

1156 
ch_sw™ch
);

1157 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1158  
»t
;

1159 
	}
}

1161 
šlše
 

1162 
	$drv_po¡_chªÃl_sw™ch
(
›“80211_lšk_d©a
 *
lšk
)

1164 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1165 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1166 
»t
 = 0;

1168 
	`might_¦“p
();

1169 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1171 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1172  -
EIO
;

1174 
	`Œaû_drv_po¡_chªÃl_sw™ch
(
loÿl
, 
sd©a
);

1175 ià(
loÿl
->
İs
->
po¡_chªÃl_sw™ch
)

1176 
»t
 = 
loÿl
->
İs
->
	`po¡_chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
,

1177 
lšk
->
cÚf
);

1178 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1179  
»t
;

1180 
	}
}

1182 
šlše
 

1183 
	$drv_abÜt_chªÃl_sw™ch
(
›“80211_lšk_d©a
 *
lšk
)

1185 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1186 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1188 
	`might_¦“p
();

1189 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1191 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1194 
	`Œaû_drv_abÜt_chªÃl_sw™ch
(
loÿl
, 
sd©a
);

1196 ià(
loÿl
->
İs
->
abÜt_chªÃl_sw™ch
)

1197 
loÿl
->
İs
->
	`abÜt_chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
,

1198 
lšk
->
cÚf
);

1199 
	}
}

1201 
šlše
 

1202 
	$drv_chªÃl_sw™ch_rx_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1203 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
)

1205 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1207 
	`might_¦“p
();

1208 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1210 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1213 
	`Œaû_drv_chªÃl_sw™ch_rx_b—cÚ
(
loÿl
, 
sd©a
, 
ch_sw™ch
);

1214 ià(
loÿl
->
İs
->
chªÃl_sw™ch_rx_b—cÚ
)

1215 
loÿl
->
İs
->
	`chªÃl_sw™ch_rx_b—cÚ
(&loÿl->
hw
, &
sd©a
->
vif
,

1216 
ch_sw™ch
);

1217 
	}
}

1219 
šlše
 
	$drv_još_ibss
(
›“80211_loÿl
 *
loÿl
,

1220 
›“80211_sub_if_d©a
 *
sd©a
)

1222 
»t
 = 0;

1224 
	`might_¦“p
();

1225 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1226 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1227  -
EIO
;

1229 
	`Œaû_drv_još_ibss
(
loÿl
, 
sd©a
, &sd©a->
vif
.
bss_cÚf
);

1230 ià(
loÿl
->
İs
->
još_ibss
)

1231 
»t
 = 
loÿl
->
İs
->
	`još_ibss
(&loÿl->
hw
, &
sd©a
->
vif
);

1232 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1233  
»t
;

1234 
	}
}

1236 
šlše
 
	$drv_Ëave_ibss
(
›“80211_loÿl
 *
loÿl
,

1237 
›“80211_sub_if_d©a
 *
sd©a
)

1239 
	`might_¦“p
();

1240 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1241 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1244 
	`Œaû_drv_Ëave_ibss
(
loÿl
, 
sd©a
);

1245 ià(
loÿl
->
İs
->
Ëave_ibss
)

1246 
loÿl
->
İs
->
	`Ëave_ibss
(&loÿl->
hw
, &
sd©a
->
vif
);

1247 
	`Œaû_drv_»tuº_void
(
loÿl
);

1248 
	}
}

1250 
šlše
 
u32
 
	$drv_g‘_ex³ùed_throughput
(
›“80211_loÿl
 *
loÿl
,

1251 
¡a_šfo
 *
¡a
)

1253 
u32
 
»t
 = 0;

1255 
	`Œaû_drv_g‘_ex³ùed_throughput
(&
¡a
->sta);

1256 ià(
loÿl
->
İs
->
g‘_ex³ùed_throughput
 && 
¡a
->
u¶ßded
)

1257 
»t
 = 
loÿl
->
İs
->
	`g‘_ex³ùed_throughput
(&loÿl->
hw
, &
¡a
->sta);

1258 
	`Œaû_drv_»tuº_u32
(
loÿl
, 
»t
);

1260  
»t
;

1261 
	}
}

1263 
šlše
 
	$drv_g‘_txpow”
(
›“80211_loÿl
 *
loÿl
,

1264 
›“80211_sub_if_d©a
 *
sd©a
, *
dbm
)

1266 
»t
;

1268 
	`might_¦“p
();

1269 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1271 ià(!
loÿl
->
İs
->
g‘_txpow”
)

1272  -
EOPNOTSUPP
;

1274 
»t
 = 
loÿl
->
İs
->
	`g‘_txpow”
(&loÿl->
hw
, &
sd©a
->
vif
, 
dbm
);

1275 
	`Œaû_drv_g‘_txpow”
(
loÿl
, 
sd©a
, *
dbm
, 
»t
);

1277  
»t
;

1278 
	}
}

1280 
šlše
 

1281 
	$drv_tdls_chªÃl_sw™ch
(
›“80211_loÿl
 *
loÿl
,

1282 
›“80211_sub_if_d©a
 *
sd©a
,

1283 
›“80211_¡a
 *
¡a
, 
u8
 
İ”_şass
,

1284 
cfg80211_chª_def
 *
chªdef
,

1285 
sk_buff
 *
tm¶_skb
, 
u32
 
ch_sw_tm_›
)

1287 
»t
;

1289 
	`might_¦“p
();

1290 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1291 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1292  -
EIO
;

1294 ià(!
loÿl
->
İs
->
tdls_chªÃl_sw™ch
)

1295  -
EOPNOTSUPP
;

1297 
	`Œaû_drv_tdls_chªÃl_sw™ch
(
loÿl
, 
sd©a
, 
¡a
, 
İ”_şass
, 
chªdef
);

1298 
»t
 = 
loÿl
->
İs
->
	`tdls_chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
,

1299 
İ”_şass
, 
chªdef
, 
tm¶_skb
,

1300 
ch_sw_tm_›
);

1301 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1302  
»t
;

1303 
	}
}

1305 
šlše
 

1306 
	$drv_tdls_ÿnûl_chªÃl_sw™ch
(
›“80211_loÿl
 *
loÿl
,

1307 
›“80211_sub_if_d©a
 *
sd©a
,

1308 
›“80211_¡a
 *
¡a
)

1310 
	`might_¦“p
();

1311 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1312 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1315 ià(!
loÿl
->
İs
->
tdls_ÿnûl_chªÃl_sw™ch
)

1318 
	`Œaû_drv_tdls_ÿnûl_chªÃl_sw™ch
(
loÿl
, 
sd©a
, 
¡a
);

1319 
loÿl
->
İs
->
	`tdls_ÿnûl_chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
);

1320 
	`Œaû_drv_»tuº_void
(
loÿl
);

1321 
	}
}

1323 
šlše
 

1324 
	$drv_tdls_»cv_chªÃl_sw™ch
(
›“80211_loÿl
 *
loÿl
,

1325 
›“80211_sub_if_d©a
 *
sd©a
,

1326 
›“80211_tdls_ch_sw_·¿ms
 *
·¿ms
)

1328 
	`Œaû_drv_tdls_»cv_chªÃl_sw™ch
(
loÿl
, 
sd©a
, 
·¿ms
);

1329 ià(
loÿl
->
İs
->
tdls_»cv_chªÃl_sw™ch
)

1330 
loÿl
->
İs
->
	`tdls_»cv_chªÃl_sw™ch
(&loÿl->
hw
, &
sd©a
->
vif
,

1331 
·¿ms
);

1332 
	`Œaû_drv_»tuº_void
(
loÿl
);

1333 
	}
}

1335 
šlše
 
	$drv_wake_tx_queue
(
›“80211_loÿl
 *
loÿl
,

1336 
txq_šfo
 *
txq
)

1338 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
txq
->txq.
vif
);

1341 ià(
loÿl
->
š_»cÚfig
) {

1342 
	`£t_b™
(
IEEE80211_TXQ_DIRTY
, &
txq
->
æags
);

1346 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1349 
	`Œaû_drv_wake_tx_queue
(
loÿl
, 
sd©a
, 
txq
);

1350 
loÿl
->
İs
->
	`wake_tx_queue
(&loÿl->
hw
, &
txq
->txq);

1351 
	}
}

1353 
šlše
 
	$scheduË_ªd_wake_txq
(
›“80211_loÿl
 *
loÿl
,

1354 
txq_šfo
 *
txqi
)

1356 
	`›“80211_scheduË_txq
(&
loÿl
->
hw
, &
txqi
->
txq
);

1357 
	`drv_wake_tx_queue
(
loÿl
, 
txqi
);

1358 
	}
}

1360 
šlše
 
	$drv_ÿn_agg»g©e_š_amsdu
(
›“80211_loÿl
 *
loÿl
,

1361 
sk_buff
 *
h—d
,

1362 
sk_buff
 *
skb
)

1364 ià(!
loÿl
->
İs
->
ÿn_agg»g©e_š_amsdu
)

1365  
Œue
;

1367  
loÿl
->
İs
->
	`ÿn_agg»g©e_š_amsdu
(&loÿl->
hw
, 
h—d
, 
skb
);

1368 
	}
}

1370 
šlše
 

1371 
	$drv_g‘_ám_»¥Úd”_¡©s
(
›“80211_loÿl
 *
loÿl
,

1372 
›“80211_sub_if_d©a
 *
sd©a
,

1373 
cfg80211_ám_»¥Úd”_¡©s
 *
ám_¡©s
)

1375 
u32
 
»t
 = -
EOPNOTSUPP
;

1377 
	`might_¦“p
();

1378 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1379 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1380  -
EIO
;

1382 ià(
loÿl
->
İs
->
g‘_ám_»¥Úd”_¡©s
)

1383 
»t
 = 
loÿl
->
İs
->
	`g‘_ám_»¥Úd”_¡©s
(&loÿl->
hw
,

1384 &
sd©a
->
vif
,

1385 
ám_¡©s
);

1386 
	`Œaû_drv_g‘_ám_»¥Úd”_¡©s
(
loÿl
, 
sd©a
, 
ám_¡©s
);

1388  
»t
;

1389 
	}
}

1391 
šlše
 
	$drv_¡¬t_pm¤
(
›“80211_loÿl
 *
loÿl
,

1392 
›“80211_sub_if_d©a
 *
sd©a
,

1393 
cfg80211_pm¤_»que¡
 *
»que¡
)

1395 
»t
 = -
EOPNOTSUPP
;

1397 
	`might_¦“p
();

1398 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1399 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1400  -
EIO
;

1402 
	`Œaû_drv_¡¬t_pm¤
(
loÿl
, 
sd©a
);

1404 ià(
loÿl
->
İs
->
¡¬t_pm¤
)

1405 
»t
 = 
loÿl
->
İs
->
	`¡¬t_pm¤
(&loÿl->
hw
, &
sd©a
->
vif
, 
»que¡
);

1406 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1408  
»t
;

1409 
	}
}

1411 
šlše
 
	$drv_abÜt_pm¤
(
›“80211_loÿl
 *
loÿl
,

1412 
›“80211_sub_if_d©a
 *
sd©a
,

1413 
cfg80211_pm¤_»que¡
 *
»que¡
)

1415 
	`Œaû_drv_abÜt_pm¤
(
loÿl
, 
sd©a
);

1417 
	`might_¦“p
();

1418 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1419 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1422 ià(
loÿl
->
İs
->
abÜt_pm¤
)

1423 
loÿl
->
İs
->
	`abÜt_pm¤
(&loÿl->
hw
, &
sd©a
->
vif
, 
»que¡
);

1424 
	`Œaû_drv_»tuº_void
(
loÿl
);

1425 
	}
}

1427 
šlše
 
	$drv_¡¬t_Çn
(
›“80211_loÿl
 *
loÿl
,

1428 
›“80211_sub_if_d©a
 *
sd©a
,

1429 
cfg80211_Çn_cÚf
 *
cÚf
)

1431 
»t
;

1433 
	`might_¦“p
();

1434 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1435 
	`check_sd©a_š_driv”
(
sd©a
);

1437 
	`Œaû_drv_¡¬t_Çn
(
loÿl
, 
sd©a
, 
cÚf
);

1438 
»t
 = 
loÿl
->
İs
->
	`¡¬t_Çn
(&loÿl->
hw
, &
sd©a
->
vif
, 
cÚf
);

1439 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1440  
»t
;

1441 
	}
}

1443 
šlše
 
	$drv_¡İ_Çn
(
›“80211_loÿl
 *
loÿl
,

1444 
›“80211_sub_if_d©a
 *
sd©a
)

1446 
	`might_¦“p
();

1447 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1448 
	`check_sd©a_š_driv”
(
sd©a
);

1450 
	`Œaû_drv_¡İ_Çn
(
loÿl
, 
sd©a
);

1451 
loÿl
->
İs
->
	`¡İ_Çn
(&loÿl->
hw
, &
sd©a
->
vif
);

1452 
	`Œaû_drv_»tuº_void
(
loÿl
);

1453 
	}
}

1455 
šlše
 
	$drv_Çn_chªge_cÚf
(
›“80211_loÿl
 *
loÿl
,

1456 
›“80211_sub_if_d©a
 *
sd©a
,

1457 
cfg80211_Çn_cÚf
 *
cÚf
,

1458 
u32
 
chªges
)

1460 
»t
;

1462 
	`might_¦“p
();

1463 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1464 
	`check_sd©a_š_driv”
(
sd©a
);

1466 ià(!
loÿl
->
İs
->
Çn_chªge_cÚf
)

1467  -
EOPNOTSUPP
;

1469 
	`Œaû_drv_Çn_chªge_cÚf
(
loÿl
, 
sd©a
, 
cÚf
, 
chªges
);

1470 
»t
 = 
loÿl
->
İs
->
	`Çn_chªge_cÚf
(&loÿl->
hw
, &
sd©a
->
vif
, 
cÚf
,

1471 
chªges
);

1472 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1474  
»t
;

1475 
	}
}

1477 
šlše
 
	$drv_add_Çn_func
(
›“80211_loÿl
 *
loÿl
,

1478 
›“80211_sub_if_d©a
 *
sd©a
,

1479 cÚ¡ 
cfg80211_Çn_func
 *
Çn_func
)

1481 
»t
;

1483 
	`might_¦“p
();

1484 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1485 
	`check_sd©a_š_driv”
(
sd©a
);

1487 ià(!
loÿl
->
İs
->
add_Çn_func
)

1488  -
EOPNOTSUPP
;

1490 
	`Œaû_drv_add_Çn_func
(
loÿl
, 
sd©a
, 
Çn_func
);

1491 
»t
 = 
loÿl
->
İs
->
	`add_Çn_func
(&loÿl->
hw
, &
sd©a
->
vif
, 
Çn_func
);

1492 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1494  
»t
;

1495 
	}
}

1497 
šlše
 
	$drv_d–_Çn_func
(
›“80211_loÿl
 *
loÿl
,

1498 
›“80211_sub_if_d©a
 *
sd©a
,

1499 
u8
 
š¡ªû_id
)

1501 
	`might_¦“p
();

1502 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1503 
	`check_sd©a_š_driv”
(
sd©a
);

1505 
	`Œaû_drv_d–_Çn_func
(
loÿl
, 
sd©a
, 
š¡ªû_id
);

1506 ià(
loÿl
->
İs
->
d–_Çn_func
)

1507 
loÿl
->
İs
->
	`d–_Çn_func
(&loÿl->
hw
, &
sd©a
->
vif
, 
š¡ªû_id
);

1508 
	`Œaû_drv_»tuº_void
(
loÿl
);

1509 
	}
}

1511 
šlše
 
	$drv_£t_tid_cÚfig
(
›“80211_loÿl
 *
loÿl
,

1512 
›“80211_sub_if_d©a
 *
sd©a
,

1513 
›“80211_¡a
 *
¡a
,

1514 
cfg80211_tid_cÚfig
 *
tid_cÚf
)

1516 
»t
;

1518 
	`might_¦“p
();

1519 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1520 
»t
 = 
loÿl
->
İs
->
	`£t_tid_cÚfig
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
,

1521 
tid_cÚf
);

1522 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1524  
»t
;

1525 
	}
}

1527 
šlše
 
	$drv_»£t_tid_cÚfig
(
›“80211_loÿl
 *
loÿl
,

1528 
›“80211_sub_if_d©a
 *
sd©a
,

1529 
›“80211_¡a
 *
¡a
, 
u8
 
tids
)

1531 
»t
;

1533 
	`might_¦“p
();

1534 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1535 
»t
 = 
loÿl
->
İs
->
	`»£t_tid_cÚfig
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
, 
tids
);

1536 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1538  
»t
;

1539 
	}
}

1541 
šlše
 
	$drv_upd©e_vif_ofæßd
(
›“80211_loÿl
 *
loÿl
,

1542 
›“80211_sub_if_d©a
 *
sd©a
)

1544 
	`might_¦“p
();

1545 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1546 
	`check_sd©a_š_driv”
(
sd©a
);

1548 ià(!
loÿl
->
İs
->
upd©e_vif_ofæßd
)

1551 
	`Œaû_drv_upd©e_vif_ofæßd
(
loÿl
, 
sd©a
);

1552 
loÿl
->
İs
->
	`upd©e_vif_ofæßd
(&loÿl->
hw
, &
sd©a
->
vif
);

1553 
	`Œaû_drv_»tuº_void
(
loÿl
);

1554 
	}
}

1556 
šlše
 
	$drv_¡a_£t_4addr
(
›“80211_loÿl
 *
loÿl
,

1557 
›“80211_sub_if_d©a
 *
sd©a
,

1558 
›“80211_¡a
 *
¡a
, 
boŞ
 
’abËd
)

1560 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

1562 
	`might_¦“p
();

1563 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1564 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1567 
	`Œaû_drv_¡a_£t_4addr
(
loÿl
, 
sd©a
, 
¡a
, 
’abËd
);

1568 ià(
loÿl
->
İs
->
¡a_£t_4addr
)

1569 
loÿl
->
İs
->
	`¡a_£t_4addr
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
, 
’abËd
);

1570 
	`Œaû_drv_»tuº_void
(
loÿl
);

1571 
	}
}

1573 
šlše
 
	$drv_¡a_£t_deÿp_ofæßd
(
›“80211_loÿl
 *
loÿl
,

1574 
›“80211_sub_if_d©a
 *
sd©a
,

1575 
›“80211_¡a
 *
¡a
,

1576 
boŞ
 
’abËd
)

1578 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

1580 
	`might_¦“p
();

1581 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1582 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1585 
	`Œaû_drv_¡a_£t_deÿp_ofæßd
(
loÿl
, 
sd©a
, 
¡a
, 
’abËd
);

1586 ià(
loÿl
->
İs
->
¡a_£t_deÿp_ofæßd
)

1587 
loÿl
->
İs
->
	`¡a_£t_deÿp_ofæßd
(&loÿl->
hw
, &
sd©a
->
vif
, 
¡a
,

1588 
’abËd
);

1589 
	`Œaû_drv_»tuº_void
(
loÿl
);

1590 
	}
}

1592 
šlše
 
	$drv_add_twt_£tup
(
›“80211_loÿl
 *
loÿl
,

1593 
›“80211_sub_if_d©a
 *
sd©a
,

1594 
›“80211_¡a
 *
¡a
,

1595 
›“80211_twt_£tup
 *
twt
)

1597 
›“80211_twt_·¿ms
 *
twt_ag¹
;

1599 
	`might_¦“p
();

1600 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1602 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1605 
twt_ag¹
 = (*)
twt
->
·¿ms
;

1607 
	`Œaû_drv_add_twt_£tup
(
loÿl
, 
¡a
, 
twt
, 
twt_ag¹
);

1608 
loÿl
->
İs
->
	`add_twt_£tup
(&loÿl->
hw
, 
¡a
, 
twt
);

1609 
	`Œaû_drv_»tuº_void
(
loÿl
);

1610 
	}
}

1612 
šlše
 
	$drv_twt_‹¬down_»que¡
(
›“80211_loÿl
 *
loÿl
,

1613 
›“80211_sub_if_d©a
 *
sd©a
,

1614 
›“80211_¡a
 *
¡a
,

1615 
u8
 
æowid
)

1617 
	`might_¦“p
();

1618 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1619 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1622 ià(!
loÿl
->
İs
->
twt_‹¬down_»que¡
)

1625 
	`Œaû_drv_twt_‹¬down_»que¡
(
loÿl
, 
¡a
, 
æowid
);

1626 
loÿl
->
İs
->
	`twt_‹¬down_»que¡
(&loÿl->
hw
, 
¡a
, 
æowid
);

1627 
	`Œaû_drv_»tuº_void
(
loÿl
);

1628 
	}
}

1630 
šlše
 
	$drv_Ãt_fl_fÜw¬d_·th
(
›“80211_loÿl
 *
loÿl
,

1631 
›“80211_sub_if_d©a
 *
sd©a
,

1632 
›“80211_¡a
 *
¡a
,

1633 
Ãt_deviû_·th_ùx
 *
ùx
,

1634 
Ãt_deviû_·th
 *
·th
)

1636 
»t
 = -
EOPNOTSUPP
;

1638 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

1639 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1640  -
EIO
;

1642 
	`Œaû_drv_Ãt_fl_fÜw¬d_·th
(
loÿl
, 
sd©a
, 
¡a
);

1643 ià(
loÿl
->
İs
->
Ãt_fl_fÜw¬d_·th
)

1644 
»t
 = 
loÿl
->
İs
->
	`Ãt_fl_fÜw¬d_·th
(&loÿl->
hw
,

1645 &
sd©a
->
vif
, 
¡a
,

1646 
ùx
, 
·th
);

1647 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1649  
»t
;

1650 
	}
}

1652 
šlše
 
	$drv_Ãt_£tup_tc
(
›“80211_loÿl
 *
loÿl
,

1653 
›“80211_sub_if_d©a
 *
sd©a
,

1654 
Ãt_deviû
 *
dev
,

1655 
tc_£tup_ty³
 
ty³
, *
ty³_d©a
)

1657 
»t
 = -
EOPNOTSUPP
;

1659 
	`might_¦“p
();

1661 
sd©a
 = 
	`g‘_bss_sd©a
(sdata);

1662 
	`Œaû_drv_Ãt_£tup_tc
(
loÿl
, 
sd©a
, 
ty³
);

1663 ià(
loÿl
->
İs
->
Ãt_£tup_tc
)

1664 
»t
 = 
loÿl
->
İs
->
	`Ãt_£tup_tc
(&loÿl->
hw
, &
sd©a
->
vif
, 
dev
,

1665 
ty³
, 
ty³_d©a
);

1666 
	`Œaû_drv_»tuº_št
(
loÿl
, 
»t
);

1668  
»t
;

1669 
	}
}

1671 
šlše
 
boŞ
 
	$drv_ÿn_aùiv©e_lšks
(
›“80211_loÿl
 *
loÿl
,

1672 
›“80211_sub_if_d©a
 *
sd©a
,

1673 
u16
 
aùive_lšks
)

1675 
boŞ
 
»t
 = 
Œue
;

1677 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1679 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1680  
çl£
;

1682 
	`Œaû_drv_ÿn_aùiv©e_lšks
(
loÿl
, 
sd©a
, 
aùive_lšks
);

1683 ià(
loÿl
->
İs
->
ÿn_aùiv©e_lšks
)

1684 
»t
 = 
loÿl
->
İs
->
	`ÿn_aùiv©e_lšks
(&loÿl->
hw
, &
sd©a
->
vif
,

1685 
aùive_lšks
);

1686 
	`Œaû_drv_»tuº_boŞ
(
loÿl
, 
»t
);

1688  
»t
;

1689 
	}
}

1691 
drv_chªge_vif_lšks
(
›“80211_loÿl
 *
loÿl
,

1692 
›“80211_sub_if_d©a
 *
sd©a
,

1693 
u16
 
Şd_lšks
, u16 
Ãw_lšks
,

1694 
›“80211_bss_cÚf
 *
Şd
[
IEEE80211_MLD_MAX_NUM_LINKS
]);

1695 
drv_chªge_¡a_lšks
(
›“80211_loÿl
 *
loÿl
,

1696 
›“80211_sub_if_d©a
 *
sd©a
,

1697 
›“80211_¡a
 *
¡a
,

1698 
u16
 
Şd_lšks
, u16 
Ãw_lšks
);

1700 
šlše
 
›“80211_Ãg_‰lm_»s


1701 
	$drv_ÿn_Ãg_‰lm
(
›“80211_loÿl
 *
loÿl
,

1702 
›“80211_sub_if_d©a
 *
sd©a
,

1703 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
)

1705 
›“80211_Ãg_‰lm_»s
 
»s
 = 
NEG_TTLM_RES_REJECT
;

1707 
	`might_¦“p
();

1708 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

1709  -
EIO
;

1711 
	`Œaû_drv_ÿn_Ãg_‰lm
(
loÿl
, 
sd©a
, 
Ãg_‰lm
);

1712 ià(
loÿl
->
İs
->
ÿn_Ãg_‰lm
)

1713 
»s
 = 
loÿl
->
İs
->
	`ÿn_Ãg_‰lm
(&loÿl->
hw
, &
sd©a
->
vif
,

1714 
Ãg_‰lm
);

1715 
	`Œaû_drv_Ãg_‰lm_»s
(
loÿl
, 
sd©a
, 
»s
, 
Ãg_‰lm
);

1717  
»s
;

1718 
	}
}

	@drop.h

8 #iâdeà
MAC80211_DROP_H


9 
	#MAC80211_DROP_H


	)

10 
	~<Ãt/drİ»asÚ.h
>

12 
	t__b™wi£
 
	t›“80211_rx_»suÉ
;

14 
	#MAC80211_DROP_REASONS_MONITOR
(
R
) \

15 
	`R
(
RX_DROP_M_UNEXPECTED_4ADDR_FRAME
) \

16 
	`R
(
RX_DROP_M_BAD_BCN_KEYIDX
) \

17 
	`R
(
RX_DROP_M_BAD_MGMT_KEYIDX
) \

18 

	)

20 
	#MAC80211_DROP_REASONS_UNUSABLE
(
R
) \

22 
	`R
(
RX_DROP_U_MIC_FAIL
) \

23 
	`R
(
RX_DROP_U_REPLAY
) \

24 
	`R
(
RX_DROP_U_BAD_MMIE
) \

25 
	`R
(
RX_DROP_U_DUP
) \

26 
	`R
(
RX_DROP_U_SPURIOUS
) \

27 
	`R
(
RX_DROP_U_DECRYPT_FAIL
) \

28 
	`R
(
RX_DROP_U_NO_KEY_ID
) \

29 
	`R
(
RX_DROP_U_BAD_CIPHER
) \

30 
	`R
(
RX_DROP_U_OOM
) \

31 
	`R
(
RX_DROP_U_NONSEQ_PN
) \

32 
	`R
(
RX_DROP_U_BAD_KEY_COLOR
) \

33 
	`R
(
RX_DROP_U_BAD_4ADDR
) \

34 
	`R
(
RX_DROP_U_BAD_AMSDU
) \

35 
	`R
(
RX_DROP_U_BAD_AMSDU_CIPHER
) \

36 
	`R
(
RX_DROP_U_INVALID_8023
) \

38 
	`R
(
RX_DROP_U_RUNT_ACTION
) \

39 
	`R
(
RX_DROP_U_UNPROT_ACTION
) \

40 
	`R
(
RX_DROP_U_UNPROT_DUAL
) \

41 
	`R
(
RX_DROP_U_UNPROT_UCAST_MGMT
) \

42 
	`R
(
RX_DROP_U_UNPROT_MCAST_MGMT
) \

43 
	`R
(
RX_DROP_U_UNPROT_BEACON
) \

44 
	`R
(
RX_DROP_U_UNPROT_UNICAST_PUB_ACTION
) \

45 
	`R
(
RX_DROP_U_UNPROT_ROBUST_ACTION
) \

46 
	`R
(
RX_DROP_U_ACTION_UNKNOWN_SRC
) \

47 
	`R
(
RX_DROP_U_REJECTED_ACTION_RESPONSE
) \

48 
	`R
(
RX_DROP_U_EXPECT_DEFRAG_PROT
) \

49 
	`R
(
RX_DROP_U_WEP_DEC_FAIL
) \

50 
	`R
(
RX_DROP_U_NO_IV
) \

51 
	`R
(
RX_DROP_U_NO_ICV
) \

52 
	`R
(
RX_DROP_U_AP_RX_GROUPCAST
) \

53 
	`R
(
RX_DROP_U_SHORT_MMIC
) \

55 
	`R
(
RX_DROP_U_MMIC_FAIL
) \

56 
	`R
(
RX_DROP_U_SHORT_TKIP
) \

57 
	`R
(
RX_DROP_U_TKIP_FAIL
) \

58 
	`R
(
RX_DROP_U_SHORT_CCMP
) \

59 
	`R
(
RX_DROP_U_SHORT_CCMP_MIC
) \

60 
	`R
(
RX_DROP_U_SHORT_GCMP
) \

61 
	`R
(
RX_DROP_U_SHORT_GCMP_MIC
) \

62 
	`R
(
RX_DROP_U_SHORT_CMAC
) \

63 
	`R
(
RX_DROP_U_SHORT_CMAC256
) \

64 
	`R
(
RX_DROP_U_SHORT_GMAC
) \

65 
	`R
(
RX_DROP_U_UNEXPECTED_VLAN_4ADDR
) \

66 
	`R
(
RX_DROP_U_UNEXPECTED_STA_4ADDR
) \

67 
	`R
(
RX_DROP_U_UNEXPECTED_VLAN_MCAST
) \

68 
	`R
(
RX_DROP_U_NOT_PORT_CONTROL
) \

69 

	)

72 
	e___mac80211_drİ_»asÚ
 {

74 
	m___RX_CONTINUE
 = 
SKB_CONSUMED
,

77 
	m___RX_QUEUED
 = 
SKB_NOT_DROPPED_YET
,

79 
	#ENUM
(
x
è
___
 ## x,

	)

80 
	m___RX_DROP_MONITOR
 = 
SKB_DROP_REASON_SUBSYS_MAC80211_MONITOR
 <<

81 
SKB_DROP_REASON_SUBSYS_SHIFT
,

82 
MAC80211_DROP_REASONS_MONITOR
(
ENUM
)

84 
	m___RX_DROP_UNUSABLE
 = 
SKB_DROP_REASON_SUBSYS_MAC80211_UNUSABLE
 <<

85 
SKB_DROP_REASON_SUBSYS_SHIFT
,

86 
MAC80211_DROP_REASONS_UNUSABLE
(
ENUM
)

87 #undeà
ENUM


90 
	emac80211_drİ_»asÚ
 {

91 
	mRX_CONTINUE
 = (
__fÜû
 
›“80211_rx_»suÉ
)
___RX_CONTINUE
,

92 
	mRX_QUEUED
 = (
__fÜû
 
›“80211_rx_»suÉ
)
___RX_QUEUED
,

93 
	mRX_DROP_MONITOR
 = (
__fÜû
 
›“80211_rx_»suÉ
)
___RX_DROP_MONITOR
,

94 
	#DEF
(
x
èx = (
__fÜû
 
›“80211_rx_»suÉ
)
___
 ## x,

	)

95 
MAC80211_DROP_REASONS_MONITOR
(
DEF
)

96 
MAC80211_DROP_REASONS_UNUSABLE
(
DEF
)

97 #undeà
DEF


100 
	#RX_RES_IS_UNUSABLE
(
»suÉ
) \

101 (((
__fÜû
 
u32
)(
»suÉ
è& 
SKB_DROP_REASON_SUBSYS_MASK
è=ğ
___RX_DROP_UNUSABLE
)

	)

	@eht.c

8 
	~"›“80211_i.h
"

11 
	$›“80211_eht_ÿp_›_to_¡a_eht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

12 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

13 cÚ¡ 
u8
 *
he_ÿp_›
, u8 
he_ÿp_Ën
,

14 cÚ¡ 
›“80211_eht_ÿp_–em
 *
eht_ÿp_›_–em
,

15 
u8
 
eht_ÿp_Ën
,

16 
lšk_¡a_šfo
 *
lšk_¡a
)

18 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
 = &
lšk_¡a
->
pub
->eht_cap;

19 
›“80211_he_ÿp_–em
 *
he_ÿp_›_–em
 = (*)
he_ÿp_›
;

20 
u8
 
eht_µe_size
 = 0;

21 
u8
 
mcs_nss_size
;

22 
u8
 
eht_tÙ®_size
 = (
eht_ÿp
->
eht_ÿp_–em
);

23 
u8
 *
pos
 = (u8 *)
eht_ÿp_›_–em
;

25 
	`mem£t
(
eht_ÿp
, 0, (*eht_cap));

27 ià(!
eht_ÿp_›_–em
 ||

28 !
	`›“80211_g‘_eht_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
))

31 
mcs_nss_size
 = 
	`›“80211_eht_mcs_nss_size
(
he_ÿp_›_–em
,

32 &
eht_ÿp_›_–em
->
fixed
,

33 
sd©a
->
vif
.
ty³
 ==

34 
NL80211_IFTYPE_STATION
);

36 
eht_tÙ®_size
 +ğ
mcs_nss_size
;

39 ià(
eht_ÿp_›_–em
->
fixed
.
phy_ÿp_šfo
[5] &

40 
IEEE80211_EHT_PHY_CAP5_PPE_THRESHOLD_PRESENT
) {

41 
u16
 
eht_µe_hdr
;

43 ià(
eht_ÿp_Ën
 < 
eht_tÙ®_size
 + (
u16
))

46 
eht_µe_hdr
 = 
	`g‘_uÇligÃd_Ë16
(
eht_ÿp_›_–em
->
İtiÚ®
 + 
mcs_nss_size
);

47 
eht_µe_size
 =

48 
	`›“80211_eht_µe_size
(
eht_µe_hdr
,

49 
eht_ÿp_›_–em
->
fixed
.
phy_ÿp_šfo
);

50 
eht_tÙ®_size
 +ğ
eht_µe_size
;

53 ià(
eht_µe_size
 > (
eht_ÿp
->
eht_µe_th»s
))

57 ià(
eht_ÿp_Ën
 < 
eht_tÙ®_size
)

61 
	`memıy
(&
eht_ÿp
->
eht_ÿp_–em
, 
pos
, (eht_cap->eht_cap_elem));

62 
pos
 +ğ(
eht_ÿp
->
eht_ÿp_–em
);

65 
	`mem£t
(&
eht_ÿp
->
eht_mcs_nss_suµ
, 0,

66 (
eht_ÿp
->
eht_mcs_nss_suµ
));

67 
	`memıy
(&
eht_ÿp
->
eht_mcs_nss_suµ
, 
pos
, 
mcs_nss_size
);

69 ià(
eht_µe_size
)

70 
	`memıy
(
eht_ÿp
->
eht_µe_th»s
,

71 &
eht_ÿp_›_–em
->
İtiÚ®
[
mcs_nss_size
],

72 
eht_µe_size
);

74 
eht_ÿp
->
has_eht
 = 
Œue
;

76 
lšk_¡a
->
cur_max_bªdwidth
 = 
	`›“80211_¡a_ÿp_rx_bw
(link_sta);

77 
lšk_¡a
->
pub
->
bªdwidth
 = 
	`›“80211_¡a_cur_vht_bw
(link_sta);

78 
	}
}

	@ethtool.c

10 
	~<lšux/ty³s.h
>

11 
	~<Ãt/cfg80211.h
>

12 
	~"›“80211_i.h
"

13 
	~"¡a_šfo.h
"

14 
	~"driv”-İs.h
"

16 
	$›“80211_£t_ršg·¿m
(
Ãt_deviû
 *
dev
,

17 
‘htoŞ_ršg·¿m
 *
½
,

18 
k”Ãl_‘htoŞ_ršg·¿m
 *
k”Ãl_½
,

19 
Ãšk_ext_ack
 *
exck
)

21 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
dev
->
›“80211_±r
->
why
);

22 
»t
;

24 ià(
½
->
rx_mši_³ndšg
 !ğ0 ||„p->
rx_jumbo_³ndšg
 != 0)

25  -
EINVAL
;

27 
	`why_lock
(
loÿl
->
hw
.
why
);

28 
»t
 = 
	`drv_£t_ršg·¿m
(
loÿl
, 
½
->
tx_³ndšg
,„p->
rx_³ndšg
);

29 
	`why_uÆock
(
loÿl
->
hw
.
why
);

31  
»t
;

32 
	}
}

34 
	$›“80211_g‘_ršg·¿m
(
Ãt_deviû
 *
dev
,

35 
‘htoŞ_ršg·¿m
 *
½
,

36 
k”Ãl_‘htoŞ_ršg·¿m
 *
k”Ãl_½
,

37 
Ãšk_ext_ack
 *
exck
)

39 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
dev
->
›“80211_±r
->
why
);

41 
	`mem£t
(
½
, 0, (*rp));

43 
	`why_lock
(
loÿl
->
hw
.
why
);

44 
	`drv_g‘_ršg·¿m
(
loÿl
, &
½
->
tx_³ndšg
, &½->
tx_max_³ndšg
,

45 &
½
->
rx_³ndšg
, &½->
rx_max_³ndšg
);

46 
	`why_uÆock
(
loÿl
->
hw
.
why
);

47 
	}
}

49 cÚ¡ 
	g›“80211_g¡ršgs_¡a_¡©s
[][
ETH_GSTRING_LEN
] = {

58 
	#STA_STATS_LEN
 
	`ARRAY_SIZE
(
›“80211_g¡ršgs_¡a_¡©s
)

	)

60 
	$›“80211_g‘_s£t_couÁ
(
Ãt_deviû
 *
dev
, 
s£t
)

62 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

63 
rv
 = 0;

65 ià(
s£t
 =ğ
ETH_SS_STATS
)

66 
rv
 +ğ
STA_STATS_LEN
;

68 
rv
 +ğ
	`drv_g‘_‘_s£t_couÁ
(
sd©a
, 
s£t
);

70 ià(
rv
 == 0)

71  -
EOPNOTSUPP
;

72  
rv
;

73 
	}
}

75 
	$›“80211_g‘_¡©s
(
Ãt_deviû
 *
dev
,

76 
‘htoŞ_¡©s
 *
¡©s
,

77 
u64
 *
d©a
)

79 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

80 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

81 
›“80211_chªÃl
 *
chªÃl
;

82 
¡a_šfo
 *
¡a
;

83 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

84 
¡©iÚ_šfo
 
sšfo
;

85 
survey_šfo
 
survey
;

86 
i
, 
q
;

87 
	#STA_STATS_SURVEY_LEN
 7

	)

89 
	`mem£t
(
d©a
, 0, (
u64
è* 
STA_STATS_LEN
);

91 
	#ADD_STA_STATS
(
¡a
) \

93 
d©a
[
i
++] +ğ
sšfo
.
rx_·ck‘s
; \

94 
d©a
[
i
++] +ğ
sšfo
.
rx_by‹s
; \

95 
d©a
[
i
++] +ğ(
¡a
)->
rx_¡©s
.
num_du¶iÿ‹s
; \

96 
d©a
[
i
++] +ğ(
¡a
)->
rx_¡©s
.
äagm’ts
; \

97 
d©a
[
i
++] +ğ
sšfo
.
rx_drİ³d_misc
; \

99 
d©a
[
i
++] +ğ
sšfo
.
tx_·ck‘s
; \

100 
d©a
[
i
++] +ğ
sšfo
.
tx_by‹s
; \

101 
d©a
[
i
++] +ğ(
¡a
)->
¡©us_¡©s
.
f‹»d
; \

102 
d©a
[
i
++] +ğ
sšfo
.
tx_çed
; \

103 
d©a
[
i
++] +ğ
sšfo
.
tx_»Œ›s
; \

104 } 0)

	)

112 
	`why_lock
(
loÿl
->
hw
.
why
);

114 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

115 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, sd©a->
deæšk
.
u
.
mgd
.
bssid
);

117 ià(!(
¡a
 && !
	`WARN_ON
(¡a->
sd©a
->
dev
 != dev)))

118 
do_survey
;

120 
	`mem£t
(&
sšfo
, 0, (sinfo));

121 
	`¡a_£t_sšfo
(
¡a
, &
sšfo
, 
çl£
);

123 
i
 = 0;

124 
	`ADD_STA_STATS
(&
¡a
->
deæšk
);

126 
d©a
[
i
++] = 
¡a
->
¡a_¡©e
;

129 ià(
sšfo
.
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_TX_BITRATE
))

130 
d©a
[
i
] = 100000ULL *

131 
	`cfg80211_ÿlcuÏ‹_b™¿‹
(&
sšfo
.
tx¿‹
);

132 
i
++;

133 ià(
sšfo
.
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_RX_BITRATE
))

134 
d©a
[
i
] = 100000ULL *

135 
	`cfg80211_ÿlcuÏ‹_b™¿‹
(&
sšfo
.
rx¿‹
);

136 
i
++;

138 ià(
sšfo
.
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_SIGNAL_AVG
))

139 
d©a
[
i
] = (
u8
)
sšfo
.
sigÇl_avg
;

140 
i
++;

142 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

144 ià(
¡a
->
sd©a
->
dev
 != dev)

147 
	`mem£t
(&
sšfo
, 0, (sinfo));

148 
	`¡a_£t_sšfo
(
¡a
, &
sšfo
, 
çl£
);

149 
i
 = 0;

150 
	`ADD_STA_STATS
(&
¡a
->
deæšk
);

154 
do_survey
:

155 
i
 = 
STA_STATS_LEN
 - 
STA_STATS_SURVEY_LEN
;

157 
survey
.
fËd
 = 0;

159 
	`rcu_»ad_lock
();

160 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

161 ià(
chªùx_cÚf
)

162 
chªÃl
 = 
chªùx_cÚf
->
def
.
chª
;

164 
chªÃl
 = 
NULL
;

165 
	`rcu_»ad_uÆock
();

167 ià(
chªÃl
) {

168 
q
 = 0;

170 
survey
.
fËd
 = 0;

171 ià(
	`drv_g‘_survey
(
loÿl
, 
q
, &
survey
) != 0) {

172 
survey
.
fËd
 = 0;

175 
q
++;

176 } 
chªÃl
 !ğ
survey
.channel);

179 ià(
survey
.
fËd
)

180 
d©a
[
i
++] = 
survey
.
chªÃl
->
ûÁ”_äeq
;

182 
d©a
[
i
++] = 0;

183 ià(
survey
.
fËd
 & 
SURVEY_INFO_NOISE_DBM
)

184 
d©a
[
i
++] = (
u8
)
survey
.
noi£
;

186 
d©a
[
i
++] = -1LL;

187 ià(
survey
.
fËd
 & 
SURVEY_INFO_TIME
)

188 
d©a
[
i
++] = 
survey
.
time
;

190 
d©a
[
i
++] = -1LL;

191 ià(
survey
.
fËd
 & 
SURVEY_INFO_TIME_BUSY
)

192 
d©a
[
i
++] = 
survey
.
time_busy
;

194 
d©a
[
i
++] = -1LL;

195 ià(
survey
.
fËd
 & 
SURVEY_INFO_TIME_EXT_BUSY
)

196 
d©a
[
i
++] = 
survey
.
time_ext_busy
;

198 
d©a
[
i
++] = -1LL;

199 ià(
survey
.
fËd
 & 
SURVEY_INFO_TIME_RX
)

200 
d©a
[
i
++] = 
survey
.
time_rx
;

202 
d©a
[
i
++] = -1LL;

203 ià(
survey
.
fËd
 & 
SURVEY_INFO_TIME_TX
)

204 
d©a
[
i
++] = 
survey
.
time_tx
;

206 
d©a
[
i
++] = -1LL;

208 ià(
	`WARN_ON
(
i
 !ğ
STA_STATS_LEN
)) {

209 
	`why_uÆock
(
loÿl
->
hw
.
why
);

213 
	`drv_g‘_‘_¡©s
(
sd©a
, 
¡©s
, &(
d©a
[
STA_STATS_LEN
]));

214 
	`why_uÆock
(
loÿl
->
hw
.
why
);

215 
	}
}

217 
	$›“80211_g‘_¡ršgs
(
Ãt_deviû
 *
dev
, 
u32
 
s£t
, 
u8
 *
d©a
)

219 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

220 
sz_¡a_¡©s
 = 0;

222 ià(
s£t
 =ğ
ETH_SS_STATS
) {

223 
sz_¡a_¡©s
 = (
›“80211_g¡ršgs_¡a_¡©s
);

224 
	`memıy
(
d©a
, 
›“80211_g¡ršgs_¡a_¡©s
, 
sz_¡a_¡©s
);

226 
	`drv_g‘_‘_¡ršgs
(
sd©a
, 
s£t
, &(
d©a
[
sz_¡a_¡©s
]));

227 
	}
}

229 
	$›“80211_g‘_»gs_Ën
(
Ãt_deviû
 *
dev
)

232 
	}
}

234 
	$›“80211_g‘_»gs
(
Ãt_deviû
 *
dev
,

235 
‘htoŞ_»gs
 *
»gs
,

236 *
d©a
)

238 
wœ–ess_dev
 *
wdev
 = 
dev
->
›“80211_±r
;

240 
»gs
->
v”siÚ
 = 
wdev
->
why
->
hw_v”siÚ
;

241 
»gs
->
Ën
 = 0;

242 
	}
}

244 cÚ¡ 
‘htoŞ_İs
 
	g›“80211_‘htoŞ_İs
 = {

245 .
g‘_drvšfo
 = 
cfg80211_g‘_drvšfo
,

246 .
	gg‘_»gs_Ën
 = 
›“80211_g‘_»gs_Ën
,

247 .
	gg‘_»gs
 = 
›“80211_g‘_»gs
,

248 .
	gg‘_lšk
 = 
‘htoŞ_İ_g‘_lšk
,

249 .
	gg‘_ršg·¿m
 = 
›“80211_g‘_ršg·¿m
,

250 .
	g£t_ršg·¿m
 = 
›“80211_£t_ršg·¿m
,

251 .
	gg‘_¡ršgs
 = 
›“80211_g‘_¡ršgs
,

252 .
	gg‘_‘htoŞ_¡©s
 = 
›“80211_g‘_¡©s
,

253 .
	gg‘_s£t_couÁ
 = 
›“80211_g‘_s£t_couÁ
,

	@fils_aead.c

7 
	~<üy±o/«s.h
>

8 
	~<üy±o/hash.h
>

9 
	~<üy±o/skch”.h
>

10 
	~<üy±o/uts.h
>

12 
	~"›“80211_i.h
"

13 
	~"«s_cmac.h
"

14 
	~"fs_«ad.h
"

16 
	$gf_mulx
(
u8
 *
·d
)

18 
u64
 
a
 = 
	`g‘_uÇligÃd_be64
(
·d
);

19 
u64
 
b
 = 
	`g‘_uÇligÃd_be64
(
·d
 + 8);

21 
	`put_uÇligÃd_be64
((
a
 << 1è| (
b
 >> 63), 
·d
);

22 
	`put_uÇligÃd_be64
((
b
 << 1è^ ((
a
 >> 63è? 0x87 : 0), 
·d
 + 8);

23 
	}
}

25 
	$«s_s2v
(
üy±o_shash
 *
tfm
,

26 
size_t
 
num_–em
, cÚ¡ 
u8
 *
addr
[], size_ˆ
Ën
[], u8 *
v
)

28 
u8
 
d
[
AES_BLOCK_SIZE
], 
tmp
[AES_BLOCK_SIZE] = {};

29 
	`SHASH_DESC_ON_STACK
(
desc
, 
tfm
);

30 
size_t
 
i
;

32 
desc
->
tfm
 =fm;

35 
	`üy±o_shash_dige¡
(
desc
, 
tmp
, 
AES_BLOCK_SIZE
, 
d
);

37 
i
 = 0; i < 
num_–em
 - 1; i++) {

39 
	`gf_mulx
(
d
);

40 
	`üy±o_shash_dige¡
(
desc
, 
addr
[
i
], 
Ën
[i], 
tmp
);

41 
	`üy±o_xÜ
(
d
, 
tmp
, 
AES_BLOCK_SIZE
);

44 
	`üy±o_shash_š™
(
desc
);

46 ià(
Ën
[
i
] >ğ
AES_BLOCK_SIZE
) {

49 
	`üy±o_shash_upd©e
(
desc
, 
addr
[
i
], 
Ën
[i] - 
AES_BLOCK_SIZE
);

50 
	`üy±o_xÜ
(
d
, 
addr
[
i
] + 
Ën
[i] - 
AES_BLOCK_SIZE
,

51 
AES_BLOCK_SIZE
);

55 
	`gf_mulx
(
d
);

56 
	`üy±o_xÜ
(
d
, 
addr
[
i
], 
Ën
[i]);

57 
d
[
Ën
[
i
]] ^= 0x80;

60 
	`üy±o_shash_fšup
(
desc
, 
d
, 
AES_BLOCK_SIZE
, 
v
);

63 
	}
}

66 
	$«s_siv_’üy±
(cÚ¡ 
u8
 *
key
, 
size_t
 
key_Ën
,

67 cÚ¡ 
u8
 *
¶aš
, 
size_t
 
¶aš_Ën
,

68 
size_t
 
num_–em
, cÚ¡ 
u8
 *
addr
[],

69 
size_t
 
Ën
[], 
u8
 *
out
)

71 
u8
 
v
[
AES_BLOCK_SIZE
];

72 
üy±o_shash
 *
tfm
;

73 
üy±o_skch”
 *
tfm2
;

74 
skch”_»que¡
 *
»q
;

75 
»s
;

76 
sÿ‰”li¡
 
¤c
[1], 
d¡
[1];

77 
u8
 *
tmp
;

79 
key_Ën
 /= 2;

81 
addr
[
num_–em
] = 
¶aš
;

82 
Ën
[
num_–em
] = 
¶aš_Ën
;

83 
num_–em
++;

87 
tfm
 = 
	`üy±o_®loc_shash
("cmac(aes)", 0, 0);

88 ià(
	`IS_ERR
(
tfm
))

89  
	`PTR_ERR
(
tfm
);

91 
»s
 = 
	`üy±o_shash_£tkey
(
tfm
, 
key
, 
key_Ën
);

92 ià(!
»s
)

93 
»s
 = 
	`«s_s2v
(
tfm
, 
num_–em
, 
addr
, 
Ën
, 
v
);

94 
	`üy±o_ä“_shash
(
tfm
);

95 ià(
»s
)

96  
»s
;

101 
tmp
 = 
	`kmemdup
(
¶aš
, 
¶aš_Ën
, 
GFP_KERNEL
);

102 ià(!
tmp
)

103  -
ENOMEM
;

106 
	`memıy
(
out
, 
v
, 
AES_BLOCK_SIZE
);

111 
v
[8] &= 0x7f;

112 
v
[12] &= 0x7f;

116 
tfm2
 = 
	`üy±o_®loc_skch”
("ùr×es)", 0, 
CRYPTO_ALG_ASYNC
);

117 ià(
	`IS_ERR
(
tfm2
)) {

118 
	`kä“
(
tmp
);

119  
	`PTR_ERR
(
tfm2
);

122 
»s
 = 
	`üy±o_skch”_£tkey
(
tfm2
, 
key
 + 
key_Ën
, key_len);

123 ià(
»s
)

124 
ç
;

126 
»q
 = 
	`skch”_»que¡_®loc
(
tfm2
, 
GFP_KERNEL
);

127 ià(!
»q
) {

128 
»s
 = -
ENOMEM
;

129 
ç
;

132 
	`sg_š™_Úe
(
¤c
, 
tmp
, 
¶aš_Ën
);

133 
	`sg_š™_Úe
(
d¡
, 
out
 + 
AES_BLOCK_SIZE
, 
¶aš_Ën
);

134 
	`skch”_»que¡_£t_üy±
(
»q
, 
¤c
, 
d¡
, 
¶aš_Ën
, 
v
);

135 
»s
 = 
	`üy±o_skch”_’üy±
(
»q
);

136 
	`skch”_»que¡_ä“
(
»q
);

137 
ç
:

138 
	`kä“
(
tmp
);

139 
	`üy±o_ä“_skch”
(
tfm2
);

140  
»s
;

141 
	}
}

144 
	$«s_siv_deüy±
(cÚ¡ 
u8
 *
key
, 
size_t
 
key_Ën
,

145 cÚ¡ 
u8
 *
iv_üy±
, 
size_t
 
iv_c_Ën
,

146 
size_t
 
num_–em
, cÚ¡ 
u8
 *
addr
[], size_ˆ
Ën
[],

147 
u8
 *
out
)

149 
üy±o_shash
 *
tfm
;

150 
üy±o_skch”
 *
tfm2
;

151 
skch”_»que¡
 *
»q
;

152 
sÿ‰”li¡
 
¤c
[1], 
d¡
[1];

153 
size_t
 
üy±_Ën
;

154 
»s
;

155 
u8
 
äame_iv
[
AES_BLOCK_SIZE
], 
iv
[AES_BLOCK_SIZE];

156 
u8
 
check
[
AES_BLOCK_SIZE
];

158 
üy±_Ën
 = 
iv_c_Ën
 - 
AES_BLOCK_SIZE
;

159 
key_Ën
 /= 2;

160 
addr
[
num_–em
] = 
out
;

161 
Ën
[
num_–em
] = 
üy±_Ën
;

162 
num_–em
++;

164 
	`memıy
(
iv
, 
iv_üy±
, 
AES_BLOCK_SIZE
);

165 
	`memıy
(
äame_iv
, 
iv_üy±
, 
AES_BLOCK_SIZE
);

170 
iv
[8] &= 0x7f;

171 
iv
[12] &= 0x7f;

175 
tfm2
 = 
	`üy±o_®loc_skch”
("ùr×es)", 0, 
CRYPTO_ALG_ASYNC
);

176 ià(
	`IS_ERR
(
tfm2
))

177  
	`PTR_ERR
(
tfm2
);

179 
»s
 = 
	`üy±o_skch”_£tkey
(
tfm2
, 
key
 + 
key_Ën
, key_len);

180 ià(
»s
) {

181 
	`üy±o_ä“_skch”
(
tfm2
);

182  
»s
;

185 
»q
 = 
	`skch”_»que¡_®loc
(
tfm2
, 
GFP_KERNEL
);

186 ià(!
»q
) {

187 
	`üy±o_ä“_skch”
(
tfm2
);

188  -
ENOMEM
;

191 
	`sg_š™_Úe
(
¤c
, 
iv_üy±
 + 
AES_BLOCK_SIZE
, 
üy±_Ën
);

192 
	`sg_š™_Úe
(
d¡
, 
out
, 
üy±_Ën
);

193 
	`skch”_»que¡_£t_üy±
(
»q
, 
¤c
, 
d¡
, 
üy±_Ën
, 
iv
);

194 
»s
 = 
	`üy±o_skch”_deüy±
(
»q
);

195 
	`skch”_»que¡_ä“
(
»q
);

196 
	`üy±o_ä“_skch”
(
tfm2
);

197 ià(
»s
)

198  
»s
;

202 
tfm
 = 
	`üy±o_®loc_shash
("cmac(aes)", 0, 0);

203 ià(
	`IS_ERR
(
tfm
))

204  
	`PTR_ERR
(
tfm
);

206 
»s
 = 
	`üy±o_shash_£tkey
(
tfm
, 
key
, 
key_Ën
);

207 ià(!
»s
)

208 
»s
 = 
	`«s_s2v
(
tfm
, 
num_–em
, 
addr
, 
Ën
, 
check
);

209 
	`üy±o_ä“_shash
(
tfm
);

210 ià(
»s
)

211  
»s
;

212 ià(
	`memcmp
(
check
, 
äame_iv
, 
AES_BLOCK_SIZE
) != 0)

213  -
EINVAL
;

215 
	}
}

217 
	$fs_’üy±_assoc_»q
(
sk_buff
 *
skb
,

218 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
)

220 
›“80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

221 
u8
 *
ÿ·b
, *
›s
, *
’ü
;

222 cÚ¡ 
u8
 *
addr
[5 + 1];

223 cÚ¡ 
–em’t
 *
£ssiÚ
;

224 
size_t
 
Ën
[5 + 1];

225 
size_t
 
üy±_Ën
;

227 ià(
	`›“80211_is_»assoc_»q
(
mgmt
->
äame_cÚŒŞ
)) {

228 
ÿ·b
 = (
u8
 *)&
mgmt
->
u
.
»assoc_»q
.
ÿ·b_šfo
;

229 
›s
 = 
mgmt
->
u
.
»assoc_»q
.
v¬ŸbË
;

231 
ÿ·b
 = (
u8
 *)&
mgmt
->
u
.
assoc_»q
.
ÿ·b_šfo
;

232 
›s
 = 
mgmt
->
u
.
assoc_»q
.
v¬ŸbË
;

235 
£ssiÚ
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_FILS_SESSION
,

236 
›s
, 
skb
->
d©a
 + skb->
Ën
 - ies);

237 ià(!
£ssiÚ
 || sessiÚ->
d©®’
 != 1 + 8)

238  -
EINVAL
;

240 
’ü
 = (
u8
 *)
£ssiÚ
->
d©a
 + 1 + 8;

245 
addr
[0] = 
mgmt
->
§
;

246 
Ën
[0] = 
ETH_ALEN
;

248 
addr
[1] = 
mgmt
->
da
;

249 
Ën
[1] = 
ETH_ALEN
;

251 
addr
[2] = 
assoc_d©a
->
fs_nÚûs
;

252 
Ën
[2] = 
FILS_NONCE_LEN
;

254 
addr
[3] = &
assoc_d©a
->
fs_nÚûs
[
FILS_NONCE_LEN
];

255 
Ën
[3] = 
FILS_NONCE_LEN
;

259 
addr
[4] = 
ÿ·b
;

260 
Ën
[4] = 
’ü
 - 
ÿ·b
;

262 
üy±_Ën
 = 
skb
->
d©a
 + skb->
Ën
 - 
’ü
;

263 
	`skb_put
(
skb
, 
AES_BLOCK_SIZE
);

264  
	`«s_siv_’üy±
(
assoc_d©a
->
fs_kek
,‡ssoc_d©a->
fs_kek_Ën
,

265 
’ü
, 
üy±_Ën
, 5, 
addr
, 
Ën
,ƒncr);

266 
	}
}

268 
	$fs_deüy±_assoc_»¥
(
›“80211_sub_if_d©a
 *
sd©a
,

269 
u8
 *
äame
, 
size_t
 *
äame_Ën
,

270 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
)

272 
›“80211_mgmt
 *
mgmt
 = (*)
äame
;

273 
u8
 *
ÿ·b
, *
›s
, *
’ü
;

274 cÚ¡ 
u8
 *
addr
[5 + 1];

275 cÚ¡ 
–em’t
 *
£ssiÚ
;

276 
size_t
 
Ën
[5 + 1];

277 
»s
;

278 
size_t
 
üy±_Ën
;

280 ià(*
äame_Ën
 < 24 + 6)

281  -
EINVAL
;

283 
ÿ·b
 = (
u8
 *)&
mgmt
->
u
.
assoc_»¥
.
ÿ·b_šfo
;

284 
›s
 = 
mgmt
->
u
.
assoc_»¥
.
v¬ŸbË
;

285 
£ssiÚ
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_FILS_SESSION
,

286 
›s
, 
äame
 + *
äame_Ën
 - ies);

287 ià(!
£ssiÚ
 || sessiÚ->
d©®’
 != 1 + 8) {

288 
	`mlme_dbg
(
sd©a
,

290 
mgmt
->
§
);

291  -
EINVAL
;

294 
’ü
 = (
u8
 *)
£ssiÚ
->
d©a
 + 1 + 8;

299 
addr
[0] = 
mgmt
->
§
;

300 
Ën
[0] = 
ETH_ALEN
;

302 
addr
[1] = 
mgmt
->
da
;

303 
Ën
[1] = 
ETH_ALEN
;

305 
addr
[2] = &
assoc_d©a
->
fs_nÚûs
[
FILS_NONCE_LEN
];

306 
Ën
[2] = 
FILS_NONCE_LEN
;

308 
addr
[3] = 
assoc_d©a
->
fs_nÚûs
;

309 
Ën
[3] = 
FILS_NONCE_LEN
;

313 
addr
[4] = 
ÿ·b
;

314 
Ën
[4] = 
’ü
 - 
ÿ·b
;

316 
üy±_Ën
 = 
äame
 + *
äame_Ën
 - 
’ü
;

317 ià(
üy±_Ën
 < 
AES_BLOCK_SIZE
) {

318 
	`mlme_dbg
(
sd©a
,

320 
mgmt
->
§
);

321  -
EINVAL
;

323 
»s
 = 
	`«s_siv_deüy±
(
assoc_d©a
->
fs_kek
,‡ssoc_d©a->
fs_kek_Ën
,

324 
’ü
, 
üy±_Ën
, 5, 
addr
, 
Ën
,ƒncr);

325 ià(
»s
 != 0) {

326 
	`mlme_dbg
(
sd©a
,

328 
mgmt
->
§
);

329  
»s
;

331 *
äame_Ën
 -ğ
AES_BLOCK_SIZE
;

333 
	}
}

	@fils_aead.h

7 #iâdeà
FILS_AEAD_H


8 
	#FILS_AEAD_H


	)

10 
fs_’üy±_assoc_»q
(
sk_buff
 *
skb
,

11 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
);

12 
fs_deüy±_assoc_»¥
(
›“80211_sub_if_d©a
 *
sd©a
,

13 
u8
 *
äame
, 
size_t
 *
äame_Ën
,

14 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
);

	@he.c

9 
	~"›“80211_i.h
"

12 
	$›“80211_upd©e_äom_he_6ghz_ÿ·
(cÚ¡ 
›“80211_he_6ghz_ÿ·
 *
he_6ghz_ÿ·
,

13 
lšk_¡a_šfo
 *
lšk_¡a
)

15 
¡a_šfo
 *
¡a
 = 
lšk_¡a
->sta;

16 
›“80211_smps_mode
 
smps_mode
;

18 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

19 
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

20 
	`Ë16_g‘_b™s
(
he_6ghz_ÿ·
->
ÿ·
,

21 
IEEE80211_HE_6GHZ_CAP_SM_PS
)) {

22 
WLAN_HT_CAP_SM_PS_INVALID
:

23 
WLAN_HT_CAP_SM_PS_STATIC
:

24 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

26 
WLAN_HT_CAP_SM_PS_DYNAMIC
:

27 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

29 
WLAN_HT_CAP_SM_PS_DISABLED
:

30 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

34 
lšk_¡a
->
pub
->
smps_mode
 = smps_mode;

36 
lšk_¡a
->
pub
->
smps_mode
 = 
IEEE80211_SMPS_OFF
;

39 
	`Ë16_g‘_b™s
(
he_6ghz_ÿ·
->
ÿ·
,

40 
IEEE80211_HE_6GHZ_CAP_MAX_MPDU_LEN
)) {

41 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
:

42 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_VHT_11454
;

44 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991
:

45 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_VHT_7991
;

47 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_3895
:

49 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_VHT_3895
;

53 
	`›“80211_¡a_»ÿlc_agg»g©es
(&
¡a
->sta);

55 
lšk_¡a
->
pub
->
he_6ghz_ÿ·
 = *he_6ghz_capa;

56 
	}
}

58 
	$›“80211_he_mcs_di§bË
(
__Ë16
 *
he_mcs
)

60 
u32
 
i
;

62 
i
 = 0; i < 8; i++)

63 *
he_mcs
 |ğ
	`ıu_to_Ë16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 
i
 * 2);

64 
	}
}

66 
	$›“80211_he_mcs_š‹r£ùiÚ
(
__Ë16
 *
he_own_rx
, __Ë16 *
he_³”_rx
,

67 
__Ë16
 *
he_own_tx
, __Ë16 *
he_³”_tx
)

69 
u32
 
i
;

70 
u16
 
own_rx
, 
own_tx
, 
³”_rx
, 
³”_tx
;

72 
i
 = 0; i < 8; i++) {

73 
own_rx
 = 
	`Ë16_to_ıu
(*
he_own_rx
);

74 
own_rx
 = (own_rx >> 
i
 * 2è& 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

76 
own_tx
 = 
	`Ë16_to_ıu
(*
he_own_tx
);

77 
own_tx
 = (own_tx >> 
i
 * 2è& 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

79 
³”_rx
 = 
	`Ë16_to_ıu
(*
he_³”_rx
);

80 
³”_rx
 = (³”_rx >> 
i
 * 2è& 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

82 
³”_tx
 = 
	`Ë16_to_ıu
(*
he_³”_tx
);

83 
³”_tx
 = (³”_tx >> 
i
 * 2è& 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

85 ià(
³”_tx
 !ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

86 ià(
own_rx
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
)

87 
³”_tx
 = 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

88 ià(
own_rx
 < 
³”_tx
)

89 
³”_tx
 = 
own_rx
;

92 ià(
³”_rx
 !ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

93 ià(
own_tx
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
)

94 
³”_rx
 = 
IEEE80211_HE_MCS_NOT_SUPPORTED
;

95 ià(
own_tx
 < 
³”_rx
)

96 
³”_rx
 = 
own_tx
;

99 *
he_³”_rx
 &=

100 ~
	`ıu_to_Ë16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 
i
 * 2);

101 *
he_³”_rx
 |ğ
	`ıu_to_Ë16
(
³”_rx
 << 
i
 * 2);

103 *
he_³”_tx
 &=

104 ~
	`ıu_to_Ë16
(
IEEE80211_HE_MCS_NOT_SUPPORTED
 << 
i
 * 2);

105 *
he_³”_tx
 |ğ
	`ıu_to_Ë16
(
³”_tx
 << 
i
 * 2);

107 
	}
}

110 
	$›“80211_he_ÿp_›_to_¡a_he_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

111 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

112 cÚ¡ 
u8
 *
he_ÿp_›
, u8 
he_ÿp_Ën
,

113 cÚ¡ 
›“80211_he_6ghz_ÿ·
 *
he_6ghz_ÿ·
,

114 
lšk_¡a_šfo
 *
lšk_¡a
)

116 
›“80211_¡a_he_ÿp
 *
he_ÿp
 = &
lšk_¡a
->
pub
->he_cap;

117 cÚ¡ 
›“80211_¡a_he_ÿp
 *
own_he_ÿp_±r
;

118 
›“80211_¡a_he_ÿp
 
own_he_ÿp
;

119 
›“80211_he_ÿp_–em
 *
he_ÿp_›_–em
 = (*)
he_ÿp_›
;

120 
u8
 
he_µe_size
;

121 
u8
 
mcs_nss_size
;

122 
u8
 
he_tÙ®_size
;

123 
boŞ
 
own_160
, 
³”_160
, 
own_80p80
, 
³”_80p80
;

125 
	`mem£t
(
he_ÿp
, 0, (*he_cap));

127 ià(!
he_ÿp_›
)

130 
own_he_ÿp_±r
 =

131 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

132 ià(!
own_he_ÿp_±r
)

135 
own_he_ÿp
 = *
own_he_ÿp_±r
;

138 
mcs_nss_size
 = 
	`›“80211_he_mcs_nss_size
(
he_ÿp_›_–em
);

139 
he_µe_size
 =

140 
	`›“80211_he_µe_size
(
he_ÿp_›
[(
he_ÿp
->
he_ÿp_–em
) +

141 
mcs_nss_size
],

142 
he_ÿp_›_–em
->
phy_ÿp_šfo
);

143 
he_tÙ®_size
 = (
he_ÿp
->
he_ÿp_–em
è+ 
mcs_nss_size
 +

144 
he_µe_size
;

145 ià(
he_ÿp_Ën
 < 
he_tÙ®_size
)

148 
	`memıy
(&
he_ÿp
->
he_ÿp_–em
, 
he_ÿp_›
, (he_cap->he_cap_elem));

151 
	`memıy
(&
he_ÿp
->
he_mcs_nss_suµ
,

152 &
he_ÿp_›
[(
he_ÿp
->
he_ÿp_–em
)], 
mcs_nss_size
);

155 ià(
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[6] &

156 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
)

157 
	`memıy
(
he_ÿp
->
µe_th»s
,

158 &
he_ÿp_›
[(
he_ÿp
->
he_ÿp_–em
è+ 
mcs_nss_size
],

159 
he_µe_size
);

161 
he_ÿp
->
has_he
 = 
Œue
;

163 
lšk_¡a
->
cur_max_bªdwidth
 = 
	`›“80211_¡a_ÿp_rx_bw
(link_sta);

164 
lšk_¡a
->
pub
->
bªdwidth
 = 
	`›“80211_¡a_cur_vht_bw
(link_sta);

166 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
 && 
he_6ghz_ÿ·
)

167 
	`›“80211_upd©e_äom_he_6ghz_ÿ·
(
he_6ghz_ÿ·
, 
lšk_¡a
);

169 
	`›“80211_he_mcs_š‹r£ùiÚ
(&
own_he_ÿp
.
he_mcs_nss_suµ
.
rx_mcs_80
,

170 &
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_80
,

171 &
own_he_ÿp
.
he_mcs_nss_suµ
.
tx_mcs_80
,

172 &
he_ÿp
->
he_mcs_nss_suµ
.
tx_mcs_80
);

174 
own_160
 = 
own_he_ÿp
.
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

175 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

176 
³”_160
 = 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

177 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

179 ià(
³”_160
 && 
own_160
) {

180 
	`›“80211_he_mcs_š‹r£ùiÚ
(&
own_he_ÿp
.
he_mcs_nss_suµ
.
rx_mcs_160
,

181 &
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_160
,

182 &
own_he_ÿp
.
he_mcs_nss_suµ
.
tx_mcs_160
,

183 &
he_ÿp
->
he_mcs_nss_suµ
.
tx_mcs_160
);

184 } ià(
³”_160
 && !
own_160
) {

185 
	`›“80211_he_mcs_di§bË
(&
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_160
);

186 
	`›“80211_he_mcs_di§bË
(&
he_ÿp
->
he_mcs_nss_suµ
.
tx_mcs_160
);

187 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &=

188 ~
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

191 
own_80p80
 = 
own_he_ÿp
.
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

192 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
;

193 
³”_80p80
 = 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

194 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
;

196 ià(
³”_80p80
 && 
own_80p80
) {

197 
	`›“80211_he_mcs_š‹r£ùiÚ
(&
own_he_ÿp
.
he_mcs_nss_suµ
.
rx_mcs_80p80
,

198 &
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_80p80
,

199 &
own_he_ÿp
.
he_mcs_nss_suµ
.
tx_mcs_80p80
,

200 &
he_ÿp
->
he_mcs_nss_suµ
.
tx_mcs_80p80
);

201 } ià(
³”_80p80
 && !
own_80p80
) {

202 
	`›“80211_he_mcs_di§bË
(&
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_80p80
);

203 
	`›“80211_he_mcs_di§bË
(&
he_ÿp
->
he_mcs_nss_suµ
.
tx_mcs_80p80
);

204 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &=

205 ~
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
;

207 
	}
}

210 
	$›“80211_he_İ_›_to_bss_cÚf
(
›“80211_vif
 *
vif
,

211 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ_›
)

213 
	`mem£t
(&
vif
->
bss_cÚf
.
he_İ”
, 0, (vif->bss_conf.he_oper));

214 ià(!
he_İ_›
)

217 
vif
->
bss_cÚf
.
he_İ”
.
·¿ms
 = 
	`__Ë32_to_ıu
(
he_İ_›
->
he_İ”_·¿ms
);

218 
vif
->
bss_cÚf
.
he_İ”
.
nss_£t
 = 
	`__Ë16_to_ıu
(
he_İ_›
->
he_mcs_nss_£t
);

219 
	}
}

222 
	$›“80211_he_¥r_›_to_bss_cÚf
(
›“80211_vif
 *
vif
,

223 cÚ¡ 
›“80211_he_¥r
 *
he_¥r_›_–em
)

225 
›“80211_he_obss_pd
 *
he_obss_pd
 =

226 &
vif
->
bss_cÚf
.
he_obss_pd
;

227 cÚ¡ 
u8
 *
d©a
;

229 
	`mem£t
(
he_obss_pd
, 0, (*he_obss_pd));

231 ià(!
he_¥r_›_–em
)

233 
d©a
 = 
he_¥r_›_–em
->
İtiÚ®
;

235 ià(
he_¥r_›_–em
->
he_¤_cÚŒŞ
 &

236 
IEEE80211_HE_SPR_NON_SRG_OFFSET_PRESENT
)

237 
d©a
++;

238 ià(
he_¥r_›_–em
->
he_¤_cÚŒŞ
 &

239 
IEEE80211_HE_SPR_SRG_INFORMATION_PRESENT
) {

240 
he_obss_pd
->
max_off£t
 = *
d©a
++;

241 
he_obss_pd
->
mš_off£t
 = *
d©a
++;

242 
he_obss_pd
->
’abË
 = 
Œue
;

244 
	}
}

	@ht.c

15 
	~<lšux/›“80211.h
>

16 
	~<lšux/expÜt.h
>

17 
	~<Ãt/mac80211.h
>

18 
	~"›“80211_i.h
"

19 
	~"¿‹.h
"

21 
	$__check_htÿp_di§bË
(
›“80211_ht_ÿp
 *
ht_ÿ·
,

22 
›“80211_ht_ÿp
 *
ht_ÿ·_mask
,

23 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
,

24 
u16
 
æag
)

26 
__Ë16
 
Ë_æag
 = 
	`ıu_to_Ë16
(
æag
);

27 ià(
ht_ÿ·_mask
->
ÿp_šfo
 & 
Ë_æag
) {

28 ià(!(
ht_ÿ·
->
ÿp_šfo
 & 
Ë_æag
))

29 
ht_ÿp
->
ÿp
 &ğ~
æag
;

31 
	}
}

33 
	$__check_htÿp_’abË
(
›“80211_ht_ÿp
 *
ht_ÿ·
,

34 
›“80211_ht_ÿp
 *
ht_ÿ·_mask
,

35 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
,

36 
u16
 
æag
)

38 
__Ë16
 
Ë_æag
 = 
	`ıu_to_Ë16
(
æag
);

40 ià((
ht_ÿ·_mask
->
ÿp_šfo
 & 
Ë_æag
) &&

41 (
ht_ÿ·
->
ÿp_šfo
 & 
Ë_æag
))

42 
ht_ÿp
->
ÿp
 |ğ
æag
;

43 
	}
}

45 
	$›“80211_­¶y_htÿp_ov”rides
(
›“80211_sub_if_d©a
 *
sd©a
,

46 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
)

48 
›“80211_ht_ÿp
 *
ht_ÿ·
, *
ht_ÿ·_mask
;

49 
u8
 *
sÿps
, *
smask
;

50 
i
;

52 ià(!
ht_ÿp
->
ht_suµÜ‹d
)

55 
sd©a
->
vif
.
ty³
) {

56 
NL80211_IFTYPE_STATION
:

57 
ht_ÿ·
 = &
sd©a
->
u
.
mgd
.ht_capa;

58 
ht_ÿ·_mask
 = &
sd©a
->
u
.
mgd
.ht_capa_mask;

60 
NL80211_IFTYPE_ADHOC
:

61 
ht_ÿ·
 = &
sd©a
->
u
.
ibss
.ht_capa;

62 
ht_ÿ·_mask
 = &
sd©a
->
u
.
ibss
.ht_capa_mask;

65 
	`WARN_ON_ONCE
(1);

69 
sÿps
 = (
u8
 *)(&
ht_ÿ·
->
mcs
.
rx_mask
);

70 
smask
 = (
u8
 *)(&
ht_ÿ·_mask
->
mcs
.
rx_mask
);

79 
i
 = 0; i < 
IEEE80211_HT_MCS_MASK_LEN
; i++) {

80 
u8
 
m
 = 
smask
[
i
];

81 
ht_ÿp
->
mcs
.
rx_mask
[
i
] &ğ~
m
;

83 
ht_ÿp
->
mcs
.
rx_mask
[
i
] |ğ(
m
 & 
sÿps
[i]);

87 
	`__check_htÿp_di§bË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

88 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
);

89 
	`__check_htÿp_di§bË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

90 
IEEE80211_HT_CAP_SGI_40
);

93 
	`__check_htÿp_di§bË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

94 
IEEE80211_HT_CAP_SGI_20
);

97 
	`__check_htÿp_di§bË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

98 
IEEE80211_HT_CAP_MAX_AMSDU
);

101 
	`__check_htÿp_di§bË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

102 
IEEE80211_HT_CAP_LDPC_CODING
);

105 
	`__check_htÿp_’abË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

106 
IEEE80211_HT_CAP_40MHZ_INTOLERANT
);

109 
	`__check_htÿp_’abË
(
ht_ÿ·
, 
ht_ÿ·_mask
, 
ht_ÿp
,

110 
IEEE80211_HT_CAP_TX_STBC
);

113 ià(
ht_ÿ·_mask
->
ÿp_šfo
 & 
	`ıu_to_Ë16
(
IEEE80211_HT_CAP_RX_STBC
))

114 
ht_ÿp
->
ÿp
 |ğ
	`Ë16_to_ıu
(
ht_ÿ·
->
ÿp_šfo
) &

115 
IEEE80211_HT_CAP_RX_STBC
;

118 ià(
ht_ÿ·_mask
->
ampdu_·¿ms_šfo
 &

119 
IEEE80211_HT_AMPDU_PARM_FACTOR
) {

120 
u8
 
n
 = 
ht_ÿ·
->
ampdu_·¿ms_šfo
 &

121 
IEEE80211_HT_AMPDU_PARM_FACTOR
;

122 ià(
n
 < 
ht_ÿp
->
ampdu_çùÜ
)

123 
ht_ÿp
->
ampdu_çùÜ
 = 
n
;

127 ià(
ht_ÿ·_mask
->
ampdu_·¿ms_šfo
 &

128 
IEEE80211_HT_AMPDU_PARM_DENSITY
) {

129 
u8
 
n
 = (
ht_ÿ·
->
ampdu_·¿ms_šfo
 &

130 
IEEE80211_HT_AMPDU_PARM_DENSITY
)

131 >> 
IEEE80211_HT_AMPDU_PARM_DENSITY_SHIFT
;

132 ià(
n
 > 
ht_ÿp
->
ampdu_d’s™y
)

133 
ht_ÿp
->
ampdu_d’s™y
 = 
n
;

135 
	}
}

138 
boŞ
 
	$›“80211_ht_ÿp_›_to_¡a_ht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

139 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

140 cÚ¡ 
›“80211_ht_ÿp
 *
ht_ÿp_›
,

141 
lšk_¡a_šfo
 *
lšk_¡a
)

143 
›“80211_bss_cÚf
 *
lšk_cÚf
;

144 
¡a_šfo
 *
¡a
 = 
lšk_¡a
->sta;

145 
›“80211_¡a_ht_ÿp
 
ht_ÿp
, 
own_ÿp
;

146 
u8
 
ampdu_šfo
, 
tx_mcs_£t_ÿp
;

147 
i
, 
max_tx_¡»ams
;

148 
boŞ
 
chªged
;

149 
›“80211_¡a_rx_bªdwidth
 
bw
;

150 
Æ80211_chª_width
 
width
;

152 
	`mem£t
(&
ht_ÿp
, 0, (ht_cap));

154 ià(!
ht_ÿp_›
 || !
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
)

155 
­¶y
;

157 
ht_ÿp
.
ht_suµÜ‹d
 = 
Œue
;

159 
own_ÿp
 = 
sbªd
->
ht_ÿp
;

167 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 ||

168 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

169 
	`›“80211_­¶y_htÿp_ov”rides
(
sd©a
, &
own_ÿp
);

177 
ht_ÿp
.
ÿp
 = 
	`Ë16_to_ıu
(
ht_ÿp_›
->
ÿp_šfo
) &

178 (
own_ÿp
.
ÿp
 | ~(
IEEE80211_HT_CAP_LDPC_CODING
 |

179 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

180 
IEEE80211_HT_CAP_GRN_FLD
 |

181 
IEEE80211_HT_CAP_SGI_20
 |

182 
IEEE80211_HT_CAP_SGI_40
 |

183 
IEEE80211_HT_CAP_DSSSCCK40
));

189 ià(!(
own_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_TX_STBC
))

190 
ht_ÿp
.
ÿp
 &ğ~
IEEE80211_HT_CAP_RX_STBC
;

191 ià(!(
own_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_RX_STBC
))

192 
ht_ÿp
.
ÿp
 &ğ~
IEEE80211_HT_CAP_TX_STBC
;

194 
ampdu_šfo
 = 
ht_ÿp_›
->
ampdu_·¿ms_šfo
;

195 
ht_ÿp
.
ampdu_çùÜ
 =

196 
ampdu_šfo
 & 
IEEE80211_HT_AMPDU_PARM_FACTOR
;

197 
ht_ÿp
.
ampdu_d’s™y
 =

198 (
ampdu_šfo
 & 
IEEE80211_HT_AMPDU_PARM_DENSITY
) >> 2;

201 
tx_mcs_£t_ÿp
 = 
own_ÿp
.
mcs
.
tx_·¿ms
;

204 
ht_ÿp
.
mcs
.
tx_·¿ms
 = 
ht_ÿp_›
->mcs.tx_params;

207 ià(!(
tx_mcs_£t_ÿp
 & 
IEEE80211_HT_MCS_TX_DEFINED
))

208 
­¶y
;

211 ià(
tx_mcs_£t_ÿp
 & 
IEEE80211_HT_MCS_TX_RX_DIFF
)

212 
max_tx_¡»ams
 =

213 ((
tx_mcs_£t_ÿp
 & 
IEEE80211_HT_MCS_TX_MAX_STREAMS_MASK
)

214 >> 
IEEE80211_HT_MCS_TX_MAX_STREAMS_SHIFT
) + 1;

216 
max_tx_¡»ams
 = 
IEEE80211_HT_MCS_TX_MAX_STREAMS
;

225 
i
 = 0; i < 
max_tx_¡»ams
; i++)

226 
ht_ÿp
.
mcs
.
rx_mask
[
i
] =

227 
own_ÿp
.
mcs
.
rx_mask
[
i
] & 
ht_ÿp_›
->mcs.rx_mask[i];

229 ià(
tx_mcs_£t_ÿp
 & 
IEEE80211_HT_MCS_TX_UNEQUAL_MODULATION
)

230 
i
 = 
IEEE80211_HT_MCS_UNEQUAL_MODULATION_START_BYTE
;

231 
i
 < 
IEEE80211_HT_MCS_MASK_LEN
; i++)

232 
ht_ÿp
.
mcs
.
rx_mask
[
i
] =

233 
own_ÿp
.
mcs
.
rx_mask
[
i
] &

234 
ht_ÿp_›
->
mcs
.
rx_mask
[
i
];

237 ià(
own_ÿp
.
mcs
.
rx_mask
[32/8] & 
ht_ÿp_›
->mcs.rx_mask[32/8] & 1)

238 
ht_ÿp
.
mcs
.
rx_mask
[32/8] |= 1;

241 
ht_ÿp
.
mcs
.
rx_highe¡
 = 
ht_ÿp_›
->mcs.rx_highest;

243 ià(
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_MAX_AMSDU
)

244 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_HT_7935
;

246 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_HT_3839
;

248 
	`›“80211_¡a_»ÿlc_agg»g©es
(&
¡a
->sta);

250 
­¶y
:

251 
chªged
 = 
	`memcmp
(&
lšk_¡a
->
pub
->
ht_ÿp
, &ht_cap, (ht_cap));

253 
	`memıy
(&
lšk_¡a
->
pub
->
ht_ÿp
, &ht_cap, (ht_cap));

255 
	`rcu_»ad_lock
();

256 
lšk_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.lšk_cÚf[
lšk_¡a
->
lšk_id
]);

257 ià(
	`WARN_ON
(!
lšk_cÚf
))

258 
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

260 
width
 = 
lšk_cÚf
->
chª»q
.
İ”
.width;

262 
width
) {

264 
	`WARN_ON_ONCE
(1);

265 
çÎthrough
;

266 
NL80211_CHAN_WIDTH_20_NOHT
:

267 
NL80211_CHAN_WIDTH_20
:

268 
bw
 = 
IEEE80211_STA_RX_BW_20
;

270 
NL80211_CHAN_WIDTH_40
:

271 
NL80211_CHAN_WIDTH_80
:

272 
NL80211_CHAN_WIDTH_80P80
:

273 
NL80211_CHAN_WIDTH_160
:

274 
NL80211_CHAN_WIDTH_320
:

275 
bw
 = 
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 ?

276 
IEEE80211_STA_RX_BW_40
 : 
IEEE80211_STA_RX_BW_20
;

279 
	`rcu_»ad_uÆock
();

281 
lšk_¡a
->
pub
->
bªdwidth
 = 
bw
;

283 
lšk_¡a
->
cur_max_bªdwidth
 =

284 
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 ?

285 
IEEE80211_STA_RX_BW_40
 : 
IEEE80211_STA_RX_BW_20
;

287 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

288 
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

289 
›“80211_smps_mode
 
smps_mode
;

291 (
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SM_PS
)

292 >> 
IEEE80211_HT_CAP_SM_PS_SHIFT
) {

293 
WLAN_HT_CAP_SM_PS_INVALID
:

294 
WLAN_HT_CAP_SM_PS_STATIC
:

295 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

297 
WLAN_HT_CAP_SM_PS_DYNAMIC
:

298 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

300 
WLAN_HT_CAP_SM_PS_DISABLED
:

301 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

305 ià(
smps_mode
 !ğ
lšk_¡a
->
pub
->smps_mode)

306 
chªged
 = 
Œue
;

307 
lšk_¡a
->
pub
->
smps_mode
 = smps_mode;

309 
lšk_¡a
->
pub
->
smps_mode
 = 
IEEE80211_SMPS_OFF
;

312  
chªged
;

313 
	}
}

315 
	$›“80211_¡a_‹¬_down_BA_£ssiÚs
(
¡a_šfo
 *
¡a
,

316 
›“80211_agg_¡İ_»asÚ
 
»asÚ
)

318 
i
;

320 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

322 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

323 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(
¡a
, 
i
, 
WLAN_BACK_RECIPIENT
,

324 
WLAN_REASON_QSTA_LEAVE_QBSS
,

325 
»asÚ
 !ğ
AGG_STOP_DESTROY_STA
 &&

326 
»asÚ
 !ğ
AGG_STOP_PEER_REQUEST
);

328 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

329 
	`__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a
, 
i
, 
»asÚ
);

336 if(
»asÚ
 =ğ
AGG_STOP_DESTROY_STA
) {

337 
	`why_wÜk_ÿnûl
(
¡a
->
loÿl
->
hw
.
why
, &¡a->
ampdu_mlme
.
wÜk
);

339 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++) {

340 
tid_ampdu_tx
 *
tid_tx
 =

341 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
i
);

343 ià(!
tid_tx
)

346 ià(
	`‹¡_ªd_ş—r_b™
(
HT_AGG_STATE_STOP_CB
, &
tid_tx
->
¡©e
))

347 
	`›“80211_¡İ_tx_ba_cb
(
¡a
, 
i
, 
tid_tx
);

350 
	}
}

352 
	$›“80211_ba_£ssiÚ_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
)

354 
¡a_šfo
 *
¡a
 =

355 
	`cÚš”_of
(
wÜk
, 
¡a_šfo
, 
ampdu_mlme
.work);

356 
tid_ampdu_tx
 *
tid_tx
;

357 
boŞ
 
blocked
;

358 
tid
;

360 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

363 
blocked
 = 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

365 
tid
 = 0;id < 
IEEE80211_NUM_TIDS
;id++) {

366 ià(
	`‹¡_ªd_ş—r_b™
(
tid
, 
¡a
->
ampdu_mlme
.
tid_rx_tim”_expœed
))

367 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(

368 
¡a
, 
tid
, 
WLAN_BACK_RECIPIENT
,

369 
WLAN_REASON_QSTA_TIMEOUT
, 
Œue
);

371 ià(
	`‹¡_ªd_ş—r_b™
(
tid
,

372 
¡a
->
ampdu_mlme
.
tid_rx_¡İ_»que¡ed
))

373 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(

374 
¡a
, 
tid
, 
WLAN_BACK_RECIPIENT
,

375 
WLAN_REASON_UNSPECIFIED
, 
Œue
);

377 ià(!
blocked
 &&

378 
	`‹¡_ªd_ş—r_b™
(
tid
,

379 
¡a
->
ampdu_mlme
.
tid_rx_mªage_ofæ
))

380 
	`__›“80211_¡¬t_rx_ba_£ssiÚ
(
¡a
, 0, 0, 0, 1, 
tid
,

381 
IEEE80211_MAX_AMPDU_BUF_HT
,

382 
çl£
, 
Œue
, 
NULL
);

384 ià(
	`‹¡_ªd_ş—r_b™
(
tid
 + 
IEEE80211_NUM_TIDS
,

385 
¡a
->
ampdu_mlme
.
tid_rx_mªage_ofæ
))

386 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(

387 
¡a
, 
tid
, 
WLAN_BACK_RECIPIENT
,

388 0, 
çl£
);

390 
	`¥š_lock_bh
(&
¡a
->
lock
);

392 
tid_tx
 = 
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
tid
];

393 ià(!
blocked
 && 
tid_tx
) {

394 
txq_šfo
 *
txqi
 = 
	`to_txq_šfo
(
¡a
->¡a.
txq
[
tid
]);

395 
›“80211_sub_if_d©a
 *
sd©a
 =

396 
	`vif_to_sd©a
(
txqi
->
txq
.
vif
);

397 
fq
 *fq = &
sd©a
->
loÿl
->fq;

399 
	`¥š_lock_bh
(&
fq
->
lock
);

402 
	`£t_b™
(
IEEE80211_TXQ_STOP
, &
txqi
->
æags
);

404 ià(!
	`skb_queue_em±y
(&
txqi
->
äags
)) {

409 
	`¥š_uÆock_bh
(&
fq
->
lock
);

410 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

415 
	`synchrÚize_Ãt
();

417 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, 
wÜk
);

421 
	`¥š_uÆock_bh
(&
fq
->
lock
);

428 
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
tid
] = 
NULL
;

430 ià(
¡a
->
ampdu_mlme
.
tid_tx
[
tid
])

431 
	`kä“
(
tid_tx
);

433 
	`›“80211_assign_tid_tx
(
¡a
, 
tid
, 
tid_tx
);

434 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

436 
	`›“80211_tx_ba_£ssiÚ_hªdË_¡¬t
(
¡a
, 
tid
);

439 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

441 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
);

442 ià(!
tid_tx
)

445 ià(!
blocked
 &&

446 
	`‹¡_ªd_ş—r_b™
(
HT_AGG_STATE_START_CB
, &
tid_tx
->
¡©e
))

447 
	`›“80211_¡¬t_tx_ba_cb
(
¡a
, 
tid
, 
tid_tx
);

448 ià(
	`‹¡_ªd_ş—r_b™
(
HT_AGG_STATE_WANT_STOP
, &
tid_tx
->
¡©e
))

449 
	`__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a
, 
tid
,

450 
AGG_STOP_LOCAL_REQUEST
);

451 ià(
	`‹¡_ªd_ş—r_b™
(
HT_AGG_STATE_STOP_CB
, &
tid_tx
->
¡©e
))

452 
	`›“80211_¡İ_tx_ba_cb
(
¡a
, 
tid
, 
tid_tx
);

454 
	}
}

456 
	$›“80211_£nd_d–ba
(
›“80211_sub_if_d©a
 *
sd©a
,

457 cÚ¡ 
u8
 *
da
, 
u16
 
tid
,

458 
u16
 
š™ŸtÜ
, u16 
»asÚ_code
)

460 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

461 
sk_buff
 *
skb
;

462 
›“80211_mgmt
 *
mgmt
;

463 
u16
 
·¿ms
;

465 
skb
 = 
	`dev_®loc_skb
((*
mgmt
è+ 
loÿl
->
hw
.
exŒa_tx_h—droom
);

466 ià(!
skb
)

469 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

470 
mgmt
 = 
	`skb_put_z”o
(
skb
, 24);

471 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

472 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

473 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

474 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 ||

475 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
)

476 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

477 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

478 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
deæšk
.
u
.
mgd
.bssid, 
ETH_ALEN
);

479 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

480 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
u
.
ibss
.bssid, 
ETH_ALEN
);

482 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

483 
IEEE80211_STYPE_ACTION
);

485 
	`skb_put
(
skb
, 1 + (
mgmt
->
u
.
aùiÚ
.u.
d–ba
));

487 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
;

488 
mgmt
->
u
.
aùiÚ
.u.
d–ba
.
aùiÚ_code
 = 
WLAN_ACTION_DELBA
;

489 
·¿ms
 = (
u16
)(
š™ŸtÜ
 << 11);

490 
·¿ms
 |ğ(
u16
)(
tid
 << 12);

492 
mgmt
->
u
.
aùiÚ
.u.
d–ba
.
·¿ms
 = 
	`ıu_to_Ë16
(params);

493 
mgmt
->
u
.
aùiÚ
.u.
d–ba
.
»asÚ_code
 = 
	`ıu_to_Ë16
(reason_code);

495 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

496 
	}
}

498 
	$›“80211_´oûss_d–ba
(
›“80211_sub_if_d©a
 *
sd©a
,

499 
¡a_šfo
 *
¡a
,

500 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

502 
u16
 
tid
, 
·¿ms
;

503 
u16
 
š™ŸtÜ
;

505 
·¿ms
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
d–ba
.params);

506 
tid
 = (
·¿ms
 & 
IEEE80211_DELBA_PARAM_TID_MASK
) >> 12;

507 
š™ŸtÜ
 = (
·¿ms
 & 
IEEE80211_DELBA_PARAM_INITIATOR_MASK
) >> 11;

509 
	`ht_dbg_¿‹lim™ed
(
sd©a
, "delba from %pM (%s)id %d„eason code %d\n",

510 
mgmt
->
§
, 
š™ŸtÜ
 ? "initiator" : "recipient",

511 
tid
,

512 
	`Ë16_to_ıu
(
mgmt
->
u
.
aùiÚ
.u.
d–ba
.
»asÚ_code
));

514 ià(
š™ŸtÜ
 =ğ
WLAN_BACK_INITIATOR
)

515 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(
¡a
, 
tid
, 
WLAN_BACK_INITIATOR
, 0,

516 
Œue
);

518 
	`__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a
, 
tid
, 
AGG_STOP_PEER_REQUEST
);

519 
	}
}

521 
Æ80211_smps_mode


522 
	$›“80211_smps_mode_to_smps_mode
(
›“80211_smps_mode
 
smps
)

524 
smps
) {

525 
IEEE80211_SMPS_OFF
:

526  
NL80211_SMPS_OFF
;

527 
IEEE80211_SMPS_STATIC
:

528  
NL80211_SMPS_STATIC
;

529 
IEEE80211_SMPS_DYNAMIC
:

530  
NL80211_SMPS_DYNAMIC
;

532  
NL80211_SMPS_OFF
;

534 
	}
}

536 
	$›“80211_£nd_smps_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

537 
›“80211_smps_mode
 
smps
, cÚ¡ 
u8
 *
da
,

538 cÚ¡ 
u8
 *
bssid
, 
lšk_id
)

540 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

541 
sk_buff
 *
skb
;

542 
›“80211_mgmt
 *
aùiÚ_äame
;

543 
›“80211_tx_šfo
 *
šfo
;

544 
u8
 
¡©us_lšk_id
 = 
lšk_id
 < 0 ? 0 :†ink_id;

547 
skb
 = 
	`dev_®loc_skb
(27 + 
loÿl
->
hw
.
exŒa_tx_h—droom
);

548 ià(!
skb
)

549  -
ENOMEM
;

551 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

552 
aùiÚ_äame
 = 
	`skb_put
(
skb
, 27);

553 
	`memıy
(
aùiÚ_äame
->
da
, da, 
ETH_ALEN
);

554 
	`memıy
(
aùiÚ_äame
->
§
, 
sd©a
->
dev
->
dev_addr
, 
ETH_ALEN
);

555 
	`memıy
(
aùiÚ_äame
->
bssid
, bssid, 
ETH_ALEN
);

556 
aùiÚ_äame
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

557 
IEEE80211_STYPE_ACTION
);

558 
aùiÚ_äame
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_HT
;

559 
aùiÚ_äame
->
u
.
aùiÚ
.u.
ht_smps
.aùiÚ = 
WLAN_HT_ACTION_SMPS
;

560 
smps
) {

561 
IEEE80211_SMPS_AUTOMATIC
:

562 
IEEE80211_SMPS_NUM_MODES
:

563 
	`WARN_ON
(1);

564 
smps
 = 
IEEE80211_SMPS_OFF
;

565 
çÎthrough
;

566 
IEEE80211_SMPS_OFF
:

567 
aùiÚ_äame
->
u
.
aùiÚ
.u.
ht_smps
.
smps_cÚŒŞ
 =

568 
WLAN_HT_SMPS_CONTROL_DISABLED
;

570 
IEEE80211_SMPS_STATIC
:

571 
aùiÚ_äame
->
u
.
aùiÚ
.u.
ht_smps
.
smps_cÚŒŞ
 =

572 
WLAN_HT_SMPS_CONTROL_STATIC
;

574 
IEEE80211_SMPS_DYNAMIC
:

575 
aùiÚ_äame
->
u
.
aùiÚ
.u.
ht_smps
.
smps_cÚŒŞ
 =

576 
WLAN_HT_SMPS_CONTROL_DYNAMIC
;

581 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

582 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

584 
šfo
->
¡©us_d©a
 = 
IEEE80211_STATUS_TYPE_SMPS
 |

585 
	`u16_’code_b™s
(
¡©us_lšk_id
 << 2 | 
smps
,

586 
IEEE80211_STATUS_SUBDATA_MASK
);

587 
	`›“80211_tx_skb_tid
(
sd©a
, 
skb
, 7, 
lšk_id
);

590 
	}
}

592 
	$›“80211_»que¡_smps
(
›“80211_vif
 *
vif
, 
lšk_id
,

593 
›“80211_smps_mode
 
smps_mode
)

595 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

596 
›“80211_lšk_d©a
 *
lšk
;

598 ià(
	`WARN_ON_ONCE
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_STATION
))

601 
	`rcu_»ad_lock
();

602 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

603 ià(
	`WARN_ON
(!
lšk
))

604 
out
;

606 
	`Œaû_­i_»que¡_smps
(
sd©a
->
loÿl
, sd©a, 
lšk
, 
smps_mode
);

608 ià(
lšk
->
u
.
mgd
.
driv”_smps_mode
 =ğ
smps_mode
)

609 
out
;

611 
lšk
->
u
.
mgd
.
driv”_smps_mode
 = 
smps_mode
;

612 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

613 &
lšk
->
u
.
mgd
.
»que¡_smps_wÜk
);

614 
out
:

615 
	`rcu_»ad_uÆock
();

616 
	}
}

618 
EXPORT_SYMBOL_GPL
(
›“80211_»que¡_smps
);

	@ibss.c

15 
	~<lšux/d–ay.h
>

16 
	~<lšux/¦ab.h
>

17 
	~<lšux/if_‘h”.h
>

18 
	~<lšux/skbuff.h
>

19 
	~<lšux/if_¬p.h
>

20 
	~<lšux/‘h”deviû.h
>

21 
	~<lšux/¹Ãšk.h
>

22 
	~<Ãt/mac80211.h
>

24 
	~"›“80211_i.h
"

25 
	~"driv”-İs.h
"

26 
	~"¿‹.h
"

28 
	#IEEE80211_SCAN_INTERVAL
 (2 * 
HZ
)

	)

29 
	#IEEE80211_IBSS_JOIN_TIMEOUT
 (7 * 
HZ
)

	)

31 
	#IEEE80211_IBSS_MERGE_INTERVAL
 (30 * 
HZ
)

	)

32 
	#IEEE80211_IBSS_INACTIVITY_LIMIT
 (60 * 
HZ
)

	)

33 
	#IEEE80211_IBSS_RSN_INACTIVITY_LIMIT
 (10 * 
HZ
)

	)

35 
	#IEEE80211_IBSS_MAX_STA_ENTRIES
 128

	)

37 
b—cÚ_d©a
 *

38 
	$›“80211_ibss_bud_´e¥
(
›“80211_sub_if_d©a
 *
sd©a
,

39 cÚ¡ 
b—cÚ_št
, cÚ¡ 
u32
 
basic_¿‹s
,

40 cÚ¡ 
u16
 
ÿ·b™y
, 
u64
 
tsf
,

41 
cfg80211_chª_def
 *
chªdef
,

42 
boŞ
 *
have_high”_thª_11mb™
,

43 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
)

45 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

46 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

47 
¿‹s_n
 = 0, 
i
, 
ri
;

48 
›“80211_mgmt
 *
mgmt
;

49 
u8
 *
pos
;

50 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

51 
u32
 
¿‹_æags
, 
¿‹s
 = 0, 
¿‹s_added
 = 0;

52 
b—cÚ_d©a
 *
´e¥
;

53 
äame_Ën
;

56 
äame_Ën
 = (
›“80211_hdr_3addr
) +

58 2 + 
IEEE80211_MAX_SSID_LEN
 +

63 2 + (
IEEE80211_MAX_SUPP_RATES
 - 8) +

64 2 + (
›“80211_ht_ÿp
) +

65 2 + (
›“80211_ht_İ”©iÚ
) +

66 2 + (
›“80211_vht_ÿp
) +

67 2 + (
›“80211_vht_İ”©iÚ
) +

68 
ifibss
->
›_Ën
;

69 
´e¥
 = 
	`kz®loc
((*´e¥è+ 
äame_Ën
, 
GFP_KERNEL
);

70 ià(!
´e¥
)

71  
NULL
;

73 
´e¥
->
h—d
 = (*)(presp + 1);

75 
mgmt
 = (*è
´e¥
->
h—d
;

76 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

77 
IEEE80211_STYPE_PROBE_RESP
);

78 
	`‘h_brßdÿ¡_addr
(
mgmt
->
da
);

79 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

80 
	`memıy
(
mgmt
->
bssid
, 
ifibss
->bssid, 
ETH_ALEN
);

81 
mgmt
->
u
.
b—cÚ
.
b—cÚ_št
 = 
	`ıu_to_Ë16
(beacon_int);

82 
mgmt
->
u
.
b—cÚ
.
time¡amp
 = 
	`ıu_to_Ë64
(
tsf
);

83 
mgmt
->
u
.
b—cÚ
.
ÿ·b_šfo
 = 
	`ıu_to_Ë16
(
ÿ·b™y
);

85 
pos
 = (
u8
 *)
mgmt
 + 
	`off£tof
(
›“80211_mgmt
, 
u
.
b—cÚ
.
v¬ŸbË
);

87 *
pos
++ = 
WLAN_EID_SSID
;

88 *
pos
++ = 
ifibss
->
ssid_Ën
;

89 
	`memıy
(
pos
, 
ifibss
->
ssid
, ifibss->
ssid_Ën
);

90 
pos
 +ğ
ifibss
->
ssid_Ën
;

92 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
chªdef
->
chª
->
bªd
];

93 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(
chªdef
);

94 
¿‹s_n
 = 0;

95 ià(
have_high”_thª_11mb™
)

96 *
have_high”_thª_11mb™
 = 
çl£
;

98 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

99 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
i
].
æags
) !=„ate_flags)

101 ià(
sbªd
->
b™¿‹s
[
i
].
b™¿‹
 > 110 &&

102 
have_high”_thª_11mb™
)

103 *
have_high”_thª_11mb™
 = 
Œue
;

105 
¿‹s
 |ğ
	`BIT
(
i
);

106 
¿‹s_n
++;

109 *
pos
++ = 
WLAN_EID_SUPP_RATES
;

110 *
pos
++ = 
	`mš_t
(, 8, 
¿‹s_n
);

111 
ri
 = 0;„˜< 
sbªd
->
n_b™¿‹s
;„i++) {

112 
¿‹
 = 
	`DIV_ROUND_UP
(
sbªd
->
b™¿‹s
[
ri
].
b™¿‹
, 5);

113 
u8
 
basic
 = 0;

114 ià(!(
¿‹s
 & 
	`BIT
(
ri
)))

117 ià(
basic_¿‹s
 & 
	`BIT
(
ri
))

118 
basic
 = 0x80;

119 *
pos
++ = 
basic
 | (
u8
è
¿‹
;

120 ià(++
¿‹s_added
 == 8) {

121 
ri
++;

126 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_2GHZ
) {

127 *
pos
++ = 
WLAN_EID_DS_PARAMS
;

128 *
pos
++ = 1;

129 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(

130 
chªdef
->
chª
->
ûÁ”_äeq
);

133 *
pos
++ = 
WLAN_EID_IBSS_PARAMS
;

134 *
pos
++ = 2;

136 *
pos
++ = 0;

137 *
pos
++ = 0;

139 ià(
c§_£‰šgs
) {

140 *
pos
++ = 
WLAN_EID_CHANNEL_SWITCH
;

141 *
pos
++ = 3;

142 *
pos
++ = 
c§_£‰šgs
->
block_tx
 ? 1 : 0;

143 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(

144 
c§_£‰šgs
->
chªdef
.
chª
->
ûÁ”_äeq
);

145 
´e¥
->
útdwn_couÁ”_off£ts
[0] = (
pos
 -…»¥->
h—d
);

146 *
pos
++ = 
c§_£‰šgs
->
couÁ
;

147 
´e¥
->
útdwn_cu¼’t_couÁ”
 = 
c§_£‰šgs
->
couÁ
;

151 ià(
¿‹s_n
 > 8) {

152 *
pos
++ = 
WLAN_EID_EXT_SUPP_RATES
;

153 *
pos
++ = 
¿‹s_n
 - 8;

154 ; 
ri
 < 
sbªd
->
n_b™¿‹s
;„i++) {

155 
¿‹
 = 
	`DIV_ROUND_UP
(
sbªd
->
b™¿‹s
[
ri
].
b™¿‹
, 5);

156 
u8
 
basic
 = 0;

157 ià(!(
¿‹s
 & 
	`BIT
(
ri
)))

160 ià(
basic_¿‹s
 & 
	`BIT
(
ri
))

161 
basic
 = 0x80;

162 *
pos
++ = 
basic
 | (
u8
è
¿‹
;

166 ià(
ifibss
->
›_Ën
) {

167 
	`memıy
(
pos
, 
ifibss
->
›
, ifibss->
›_Ën
);

168 
pos
 +ğ
ifibss
->
›_Ën
;

172 ià(
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_20_NOHT
 &&

173 
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_5
 &&

174 
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_10
 &&

175 
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
) {

176 
›“80211_¡a_ht_ÿp
 
ht_ÿp
;

178 
	`memıy
(&
ht_ÿp
, &
sbªd
->ht_cap, (ht_cap));

179 
	`›“80211_­¶y_htÿp_ov”rides
(
sd©a
, &
ht_ÿp
);

181 
pos
 = 
	`›“80211_›_bud_ht_ÿp
Õos, &
ht_ÿp
, ht_ÿp.
ÿp
);

187 
pos
 = 
	`›“80211_›_bud_ht_İ”
Õos, &
sbªd
->
ht_ÿp
,

188 
chªdef
, 0, 
çl£
);

191 ià(
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_20
 &&

192 
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_40
 &&

193 
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
) {

194 
pos
 = 
	`›“80211_›_bud_vht_ÿp
Õos, &
sbªd
->
vht_ÿp
,

195 
sbªd
->
vht_ÿp
.
ÿp
);

196 
pos
 = 
	`›“80211_›_bud_vht_İ”
Õos, &
sbªd
->
vht_ÿp
,

197 
chªdef
);

201 ià(
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
)

202 
pos
 = 
	`›“80211_add_wmm_šfo_›
(pos, 0);

204 
´e¥
->
h—d_Ën
 = 
pos
 -…»¥->
h—d
;

205 ià(
	`WARN_ON
(
´e¥
->
h—d_Ën
 > 
äame_Ën
))

206 
”rÜ
;

208  
´e¥
;

209 
”rÜ
:

210 
	`kä“
(
´e¥
);

211  
NULL
;

212 
	}
}

214 
	$__›“80211_¡a_još_ibss
(
›“80211_sub_if_d©a
 *
sd©a
,

215 cÚ¡ 
u8
 *
bssid
, cÚ¡ 
b—cÚ_št
,

216 
cfg80211_chª_def
 *
»q_chªdef
,

217 cÚ¡ 
u32
 
basic_¿‹s
,

218 cÚ¡ 
u16
 
ÿ·b™y
, 
u64
 
tsf
,

219 
boŞ
 
ü—tÜ
)

221 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

222 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

223 
›“80211_mgmt
 *
mgmt
;

224 
cfg80211_bss
 *
bss
;

225 
u64
 
bss_chªge
;

226 
›“80211_chª_»q
 
chª»q
 = {};

227 
›“80211_chªÃl
 *
chª
;

228 
b—cÚ_d©a
 *
´e¥
;

229 
cfg80211_šfÜm_bss
 
bss_m‘a
 = {};

230 
boŞ
 
have_high”_thª_11mb™
;

231 
boŞ
 
¿d¬_»quœed
;

232 
”r
;

234 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

237 
	`drv_»£t_tsf
(
loÿl
, 
sd©a
);

239 ià(!
	`‘h”_addr_equ®
(
ifibss
->
bssid
, bssid))

240 
	`¡a_šfo_æush
(
sd©a
, -1);

243 ià(
sd©a
->
vif
.
cfg
.
ibss_jošed
) {

244 
sd©a
->
vif
.
cfg
.
ibss_jošed
 = 
çl£
;

245 
sd©a
->
vif
.
cfg
.
ibss_ü—tÜ
 = 
çl£
;

246 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
çl£
;

247 
	`Ãtif_ÿ¼›r_off
(
sd©a
->
dev
);

248 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
,

249 
BSS_CHANGED_IBSS
 |

250 
BSS_CHANGED_BEACON_ENABLED
);

251 
	`drv_Ëave_ibss
(
loÿl
, 
sd©a
);

254 
´e¥
 = 
	`sd©a_d”eã»nû
(
ifibss
->´e¥, 
sd©a
);

255 
	`RCU_INIT_POINTER
(
ifibss
->
´e¥
, 
NULL
);

256 ià(
´e¥
)

257 
	`kä“_rcu
(
´e¥
, 
rcu_h—d
);

260 
chª»q
.
İ”
 = *
»q_chªdef
;

261 
chª
 = 
chª»q
.
İ”
.chan;

262 ià(!
	`cfg80211_»g_ÿn_b—cÚ
(
loÿl
->
hw
.
why
, &
chª»q
.
İ”
,

263 
NL80211_IFTYPE_ADHOC
)) {

264 ià(
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

265 
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
 ||

266 
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

267 
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20
) {

268 
	`sd©a_šfo
(
sd©a
,

272 
chª»q
.
İ”
.
width
 = 
NL80211_CHAN_WIDTH_20
;

273 
chª»q
.
İ”
.
ûÁ”_äeq1
 = 
chª
->
ûÁ”_äeq
;

275 ià(!
	`cfg80211_»g_ÿn_b—cÚ
(
loÿl
->
hw
.
why
, &
chª»q
.
İ”
,

276 
NL80211_IFTYPE_ADHOC
)) {

277 
	`sd©a_šfo
(
sd©a
,

283 
”r
 = 
	`cfg80211_chªdef_dfs_»quœed
(
sd©a
->
loÿl
->
hw
.
why
,

284 &
chª»q
.
İ”
, 
NL80211_IFTYPE_ADHOC
);

285 ià(
”r
 < 0) {

286 
	`sd©a_šfo
(
sd©a
,

290 ià(
”r
 > 0 && !
ifibss
->
u£r¥aû_hªdËs_dfs
) {

291 
	`sd©a_šfo
(
sd©a
,

296 
¿d¬_»quœed
 = 
”r
;

298 ià(
	`›“80211_lšk_u£_chªÃl
(&
sd©a
->
deæšk
, &
chª»q
,

299 
ifibss
->
fixed_chªÃl
 ?

300 
IEEE80211_CHANCTX_SHARED
 :

301 
IEEE80211_CHANCTX_EXCLUSIVE
)) {

302 
	`sd©a_šfo
(
sd©a
, "Failedo join IBSS,‚o channel context\n");

305 
sd©a
->
deæšk
.
¿d¬_»quœed
 =„adar_required;

307 
	`memıy
(
ifibss
->
bssid
, bssid, 
ETH_ALEN
);

309 
´e¥
 = 
	`›“80211_ibss_bud_´e¥
(
sd©a
, 
b—cÚ_št
, 
basic_¿‹s
,

310 
ÿ·b™y
, 
tsf
, &
chª»q
.
İ”
,

311 &
have_high”_thª_11mb™
, 
NULL
);

312 ià(!
´e¥
)

315 
	`rcu_assign_poš‹r
(
ifibss
->
´e¥
,…resp);

316 
mgmt
 = (*)
´e¥
->
h—d
;

318 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
Œue
;

319 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
 = beacon_int;

320 
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
 = basic_rates;

321 
sd©a
->
vif
.
cfg
.
ssid_Ën
 = 
ifibss
->ssid_len;

322 
	`memıy
(
sd©a
->
vif
.
cfg
.
ssid
, 
ifibss
->ssid, ifibss->
ssid_Ën
);

323 
bss_chªge
 = 
BSS_CHANGED_BEACON_INT
;

324 
bss_chªge
 |ğ
	`›“80211_»£t_”p_šfo
(
sd©a
);

325 
bss_chªge
 |ğ
BSS_CHANGED_BSSID
;

326 
bss_chªge
 |ğ
BSS_CHANGED_BEACON
;

327 
bss_chªge
 |ğ
BSS_CHANGED_BEACON_ENABLED
;

328 
bss_chªge
 |ğ
BSS_CHANGED_BASIC_RATES
;

329 
bss_chªge
 |ğ
BSS_CHANGED_HT
;

330 
bss_chªge
 |ğ
BSS_CHANGED_IBSS
;

331 
bss_chªge
 |ğ
BSS_CHANGED_SSID
;

343 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_¦Ù
 = 
chª
->
bªd
 =ğ
NL80211_BAND_5GHZ
;

344 
bss_chªge
 |ğ
BSS_CHANGED_ERP_SLOT
;

347 
sd©a
->
deæšk
.
İ”©šg_11g_mode
 =

348 
chª
->
bªd
 =ğ
NL80211_BAND_2GHZ
 && 
have_high”_thª_11mb™
;

350 
	`›“80211_£t_wmm_deçuÉ
(&
sd©a
->
deæšk
, 
Œue
, 
çl£
);

352 
sd©a
->
vif
.
cfg
.
ibss_jošed
 = 
Œue
;

353 
sd©a
->
vif
.
cfg
.
ibss_ü—tÜ
 = 
ü—tÜ
;

355 
”r
 = 
	`drv_još_ibss
(
loÿl
, 
sd©a
);

356 ià(
”r
) {

357 
sd©a
->
vif
.
cfg
.
ibss_jošed
 = 
çl£
;

358 
sd©a
->
vif
.
cfg
.
ibss_ü—tÜ
 = 
çl£
;

359 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
çl£
;

360 
sd©a
->
vif
.
cfg
.
ssid_Ën
 = 0;

361 
	`RCU_INIT_POINTER
(
ifibss
->
´e¥
, 
NULL
);

362 
	`kä“_rcu
(
´e¥
, 
rcu_h—d
);

363 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

364 
	`sd©a_šfo
(
sd©a
, "Failedo join IBSS, driver failure: %d\n",

365 
”r
);

369 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
bss_chªge
);

371 
ifibss
->
¡©e
 = 
IEEE80211_IBSS_MLME_JOINED
;

372 
	`mod_tim”
(&
ifibss
->
tim”
,

373 
	`round_jiff›s
(
jiff›s
 + 
IEEE80211_IBSS_MERGE_INTERVAL
));

375 
bss_m‘a
.
chª
 = chan;

376 
bss
 = 
	`cfg80211_šfÜm_bss_äame_d©a
(
loÿl
->
hw
.
why
, &
bss_m‘a
, 
mgmt
,

377 
´e¥
->
h—d_Ën
, 
GFP_KERNEL
);

379 
	`cfg80211_put_bss
(
loÿl
->
hw
.
why
, 
bss
);

380 
	`Ãtif_ÿ¼›r_Ú
(
sd©a
->
dev
);

381 
	`cfg80211_ibss_jošed
(
sd©a
->
dev
, 
ifibss
->
bssid
, 
chª
, 
GFP_KERNEL
);

382 
	}
}

384 
	$›“80211_¡a_još_ibss
(
›“80211_sub_if_d©a
 *
sd©a
,

385 
›“80211_bss
 *
bss
)

387 
cfg80211_bss
 *
cbss
 =

388 
	`cÚš”_of
((*)
bss
, 
cfg80211_bss
, 
´iv
);

389 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

390 
cfg80211_chª_def
 
chªdef
;

391 
u32
 
basic_¿‹s
;

392 
i
, 
j
;

393 
u16
 
b—cÚ_št
 = 
cbss
->
b—cÚ_š‹rv®
;

394 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

395 
Æ80211_chªÃl_ty³
 
chª_ty³
;

396 
u64
 
tsf
;

397 
u32
 
¿‹_æags
;

399 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

401 ià(
b—cÚ_št
 < 10)

402 
b—cÚ_št
 = 10;

404 
sd©a
->
u
.
ibss
.
chªdef
.
width
) {

405 
NL80211_CHAN_WIDTH_20_NOHT
:

406 
NL80211_CHAN_WIDTH_20
:

407 
NL80211_CHAN_WIDTH_40
:

408 
chª_ty³
 = 
	`cfg80211_g‘_chªdef_ty³
(&
sd©a
->
u
.
ibss
.
chªdef
);

409 
	`cfg80211_chªdef_ü—‹
(&
chªdef
, 
cbss
->
chªÃl
, 
chª_ty³
);

411 
NL80211_CHAN_WIDTH_5
:

412 
NL80211_CHAN_WIDTH_10
:

413 
	`cfg80211_chªdef_ü—‹
(&
chªdef
, 
cbss
->
chªÃl
,

414 
NL80211_CHAN_NO_HT
);

415 
chªdef
.
width
 = 
sd©a
->
u
.
ibss
.chandef.width;

417 
NL80211_CHAN_WIDTH_80
:

418 
NL80211_CHAN_WIDTH_80P80
:

419 
NL80211_CHAN_WIDTH_160
:

420 
chªdef
 = 
sd©a
->
u
.
ibss
.chandef;

421 
chªdef
.
chª
 = 
cbss
->
chªÃl
;

425 
	`cfg80211_chªdef_ü—‹
(&
chªdef
, 
cbss
->
chªÃl
,

426 
NL80211_CHAN_NO_HT
);

430 
sbªd
 = 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
cbss
->
chªÃl
->
bªd
];

431 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(&
sd©a
->
u
.
ibss
.
chªdef
);

433 
basic_¿‹s
 = 0;

435 
i
 = 0; i < 
bss
->
suµ_¿‹s_Ën
; i++) {

436 
¿‹
 = 
bss
->
suµ_¿‹s
[
i
] & 0x7f;

437 
boŞ
 
is_basic
 = !!(
bss
->
suµ_¿‹s
[
i
] & 0x80);

439 
j
 = 0; j < 
sbªd
->
n_b™¿‹s
; j++) {

440 
b¿‹
;

441 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
j
].
æags
)

442 !ğ
¿‹_æags
)

445 
b¿‹
 = 
	`DIV_ROUND_UP
(
sbªd
->
b™¿‹s
[
j
].
b™¿‹
, 5);

446 ià(
b¿‹
 =ğ
¿‹
) {

447 ià(
is_basic
)

448 
basic_¿‹s
 |ğ
	`BIT
(
j
);

454 
	`rcu_»ad_lock
();

455 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

456 
tsf
 = 
›s
->tsf;

457 
	`rcu_»ad_uÆock
();

459 
	`__›“80211_¡a_još_ibss
(
sd©a
, 
cbss
->
bssid
,

460 
b—cÚ_št
,

461 &
chªdef
,

462 
basic_¿‹s
,

463 
cbss
->
ÿ·b™y
,

464 
tsf
, 
çl£
);

465 
	}
}

467 
	$›“80211_ibss_c§_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

468 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
,

469 
u64
 *
chªged
)

471 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

472 
b—cÚ_d©a
 *
´e¥
, *
Şd_´e¥
;

473 
cfg80211_bss
 *
cbss
;

474 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

475 
u16
 
ÿ·b™y
 = 
WLAN_CAPABILITY_IBSS
;

476 
u64
 
tsf
;

478 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

480 ià(
ifibss
->
´ivacy
)

481 
ÿ·b™y
 |ğ
WLAN_CAPABILITY_PRIVACY
;

483 
cbss
 = 
	`cfg80211_g‘_bss
(
sd©a
->
loÿl
->
hw
.
why
, 
ifibss
->
chªdef
.
chª
,

484 
ifibss
->
bssid
, ifibss->
ssid
,

485 
ifibss
->
ssid_Ën
, 
IEEE80211_BSS_TYPE_IBSS
,

486 
	`IEEE80211_PRIVACY
(
ifibss
->
´ivacy
));

488 ià(
	`uÆik–y
(!
cbss
))

489  -
EINVAL
;

491 
	`rcu_»ad_lock
();

492 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

493 
tsf
 = 
›s
->tsf;

494 
	`rcu_»ad_uÆock
();

495 
	`cfg80211_put_bss
(
sd©a
->
loÿl
->
hw
.
why
, 
cbss
);

497 
Şd_´e¥
 = 
	`sd©a_d”eã»nû
(
ifibss
->
´e¥
, 
sd©a
);

499 
´e¥
 = 
	`›“80211_ibss_bud_´e¥
(
sd©a
,

500 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
,

501 
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
,

502 
ÿ·b™y
, 
tsf
, &
ifibss
->
chªdef
,

503 
NULL
, 
c§_£‰šgs
);

504 ià(!
´e¥
)

505  -
ENOMEM
;

507 
	`rcu_assign_poš‹r
(
ifibss
->
´e¥
,…resp);

508 ià(
Şd_´e¥
)

509 
	`kä“_rcu
(
Şd_´e¥
, 
rcu_h—d
);

511 *
chªged
 |ğ
BSS_CHANGED_BEACON
;

513 
	}
}

515 
	$›“80211_ibss_fšish_c§
(
›“80211_sub_if_d©a
 *
sd©a
, 
u64
 *
chªged
)

517 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

518 
cfg80211_bss
 *
cbss
;

520 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

523 ià(
ifibss
->
¡©e
 !ğ
IEEE80211_IBSS_MLME_JOINED
)

524  -
ENOLINK
;

527 ià(!
	`is_z”o_‘h”_addr
(
ifibss
->
bssid
)) {

528 
cbss
 = 
	`cfg80211_g‘_bss
(
sd©a
->
loÿl
->
hw
.
why
,

529 
ifibss
->
chªdef
.
chª
,

530 
ifibss
->
bssid
, ifibss->
ssid
,

531 
ifibss
->
ssid_Ën
,

532 
IEEE80211_BSS_TYPE_IBSS
,

533 
	`IEEE80211_PRIVACY
(
ifibss
->
´ivacy
));

535 ià(
cbss
) {

536 
cbss
->
chªÃl
 = 
sd©a
->
deæšk
.
c§_chª»q
.
İ”
.
chª
;

537 
	`cfg80211_put_bss
(
sd©a
->
loÿl
->
hw
.
why
, 
cbss
);

541 
ifibss
->
chªdef
 = 
sd©a
->
deæšk
.
c§_chª»q
.
İ”
;

544  
	`›“80211_ibss_c§_b—cÚ
(
sd©a
, 
NULL
, 
chªged
);

545 
	}
}

547 
	$›“80211_ibss_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
)

549 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

551 
	`why_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

552 &
ifibss
->
c§_cÚÃùiÚ_drİ_wÜk
);

553 
	}
}

555 
¡a_šfo
 *
	$›“80211_ibss_fšish_¡a
(
¡a_šfo
 *
¡a
)

556 
	$__acquœes
(
RCU
)

558 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

559 
u8
 
addr
[
ETH_ALEN
];

561 
	`memıy
(
addr
, 
¡a
->¡a.addr, 
ETH_ALEN
);

563 
	`ibss_dbg
(
sd©a
, "Addšg‚ew IBSS stiÚ %pM\n", 
addr
);

565 
	`¡a_šfo_´e_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTH
);

566 
	`¡a_šfo_´e_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
);

569 ià(!
¡a
->
sd©a
->
u
.
ibss
.
cÚŒŞ_pÜt
)

570 
	`¡a_šfo_´e_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTHORIZED
);

572 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

575 ià(
	`¡a_šfo_š£¹_rcu
(
¡a
))

576  
	`¡a_šfo_g‘
(
sd©a
, 
addr
);

577  
¡a
;

578 
	}
}

580 
¡a_šfo
 *

581 
	$›“80211_ibss_add_¡a
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
bssid
,

582 cÚ¡ 
u8
 *
addr
, 
u32
 
suµ_¿‹s
)

583 
	$__acquœes
(
RCU
)

585 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

586 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

587 
¡a_šfo
 *
¡a
;

588 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

589 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

590 
bªd
;

596 ià(
loÿl
->
num_¡a
 >ğ
IEEE80211_IBSS_MAX_STA_ENTRIES
) {

597 
	`Ãt_šfo_¿‹lim™ed
("%s: No„oom for‡‚ew IBSS STAƒntry %pM\n",

598 
sd©a
->
Çme
, 
addr
);

599 
	`rcu_»ad_lock
();

600  
NULL
;

603 ià(
ifibss
->
¡©e
 =ğ
IEEE80211_IBSS_MLME_SEARCH
) {

604 
	`rcu_»ad_lock
();

605  
NULL
;

608 ià(!
	`‘h”_addr_equ®
(
bssid
, 
sd©a
->
u
.
ibss
.bssid)) {

609 
	`rcu_»ad_lock
();

610  
NULL
;

613 
	`rcu_»ad_lock
();

614 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

615 ià(
	`WARN_ON_ONCE
(!
chªùx_cÚf
))

616  
NULL
;

617 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

618 
	`rcu_»ad_uÆock
();

620 
¡a
 = 
	`¡a_šfo_®loc
(
sd©a
, 
addr
, 
GFP_KERNEL
);

621 ià(!
¡a
) {

622 
	`rcu_»ad_lock
();

623  
NULL
;

627 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

628 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
] = supp_rates |

629 
	`›“80211_mªd©Üy_¿‹s
(
sbªd
);

631  
	`›“80211_ibss_fšish_¡a
(
¡a
);

632 
	}
}

634 
	$›“80211_¡a_aùive_ibss
(
›“80211_sub_if_d©a
 *
sd©a
)

636 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

637 
aùive
 = 0;

638 
¡a_šfo
 *
¡a
;

640 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

642 
	`rcu_»ad_lock
();

644 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

645 
Ï¡_aùive
 = 
	`›“80211_¡a_Ï¡_aùive
(
¡a
);

647 ià(
¡a
->
sd©a
 == sdata &&

648 
	`time_is_aá”_jiff›s
(
Ï¡_aùive
 +

649 
IEEE80211_IBSS_MERGE_INTERVAL
)) {

650 
aùive
++;

655 
	`rcu_»ad_uÆock
();

657  
aùive
;

658 
	}
}

660 
	$›“80211_ibss_discÚÃù
(
›“80211_sub_if_d©a
 *
sd©a
)

662 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

663 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

664 
cfg80211_bss
 *
cbss
;

665 
b—cÚ_d©a
 *
´e¥
;

666 
¡a_šfo
 *
¡a
;

668 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

670 ià(!
	`is_z”o_‘h”_addr
(
ifibss
->
bssid
)) {

671 
cbss
 = 
	`cfg80211_g‘_bss
(
loÿl
->
hw
.
why
, 
ifibss
->
chªdef
.
chª
,

672 
ifibss
->
bssid
, ifibss->
ssid
,

673 
ifibss
->
ssid_Ën
,

674 
IEEE80211_BSS_TYPE_IBSS
,

675 
	`IEEE80211_PRIVACY
(
ifibss
->
´ivacy
));

677 ià(
cbss
) {

678 
	`cfg80211_uÆšk_bss
(
loÿl
->
hw
.
why
, 
cbss
);

679 
	`cfg80211_put_bss
(
sd©a
->
loÿl
->
hw
.
why
, 
cbss
);

683 
ifibss
->
¡©e
 = 
IEEE80211_IBSS_MLME_SEARCH
;

685 
	`¡a_šfo_æush
(
sd©a
, -1);

687 
	`¥š_lock_bh
(&
ifibss
->
šcom¶‘e_lock
);

688 !
	`li¡_em±y
(&
ifibss
->
šcom¶‘e_¡©iÚs
)) {

689 
¡a
 = 
	`li¡_fœ¡_’Œy
(&
ifibss
->
šcom¶‘e_¡©iÚs
,

690 
¡a_šfo
, 
li¡
);

691 
	`li¡_d–
(&
¡a
->
li¡
);

692 
	`¥š_uÆock_bh
(&
ifibss
->
šcom¶‘e_lock
);

694 
	`¡a_šfo_ä“
(
loÿl
, 
¡a
);

695 
	`¥š_lock_bh
(&
ifibss
->
šcom¶‘e_lock
);

697 
	`¥š_uÆock_bh
(&
ifibss
->
šcom¶‘e_lock
);

699 
	`Ãtif_ÿ¼›r_off
(
sd©a
->
dev
);

701 
sd©a
->
vif
.
cfg
.
ibss_jošed
 = 
çl£
;

702 
sd©a
->
vif
.
cfg
.
ibss_ü—tÜ
 = 
çl£
;

703 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
çl£
;

704 
sd©a
->
vif
.
cfg
.
ssid_Ën
 = 0;

707 
´e¥
 = 
	`sd©a_d”eã»nû
(
ifibss
->´e¥, 
sd©a
);

708 
	`RCU_INIT_POINTER
(
sd©a
->
u
.
ibss
.
´e¥
, 
NULL
);

709 ià(
´e¥
)

710 
	`kä“_rcu
(
´e¥
, 
rcu_h—d
);

712 
	`ş—r_b™
(
SDATA_STATE_OFFCHANNEL_BEACON_STOPPED
, &
sd©a
->
¡©e
);

713 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_BEACON_ENABLED
 |

714 
BSS_CHANGED_IBSS
);

715 
	`drv_Ëave_ibss
(
loÿl
, 
sd©a
);

716 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

717 
	}
}

719 
	$›“80211_c§_cÚÃùiÚ_drİ_wÜk
(
why
 *wiphy,

720 
why_wÜk
 *
wÜk
)

722 
›“80211_sub_if_d©a
 *
sd©a
 =

723 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

724 
u
.
ibss
.
c§_cÚÃùiÚ_drİ_wÜk
);

726 
	`›“80211_ibss_discÚÃù
(
sd©a
);

727 
	`synchrÚize_rcu
();

728 
	`skb_queue_purge
(&
sd©a
->
skb_queue
);

731 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

732 
	}
}

734 
	$›“80211_ibss_c§_m¬k_¿d¬
(
›“80211_sub_if_d©a
 *
sd©a
)

736 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

737 
”r
;

742 
”r
 = 
	`cfg80211_chªdef_dfs_»quœed
(
sd©a
->
loÿl
->
hw
.
why
,

743 &
ifibss
->
chªdef
,

744 
NL80211_IFTYPE_ADHOC
);

745 ià(
”r
 > 0)

746 
	`cfg80211_¿d¬_ev’t
(
sd©a
->
loÿl
->
hw
.
why
, &
ifibss
->
chªdef
,

747 
GFP_ATOMIC
);

748 
	}
}

750 
boŞ


751 
	$›“80211_ibss_´oûss_chªsw™ch
(
›“80211_sub_if_d©a
 *
sd©a
,

752 
›“802_11_–ems
 *
–ems
,

753 
boŞ
 
b—cÚ
)

755 
cfg80211_c§_£‰šgs
 
·¿ms
;

756 
›“80211_c§_›
 
c§_›
;

757 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

758 
Æ80211_chªÃl_ty³
 
ch_ty³
;

759 
”r
;

760 
›“80211_cÚn_£‰šgs
 
cÚn
 = {

761 .
mode
 = 
IEEE80211_CONN_MODE_HT
,

762 .
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_40
,

764 
u32
 
vht_ÿp_šfo
 = 0;

766 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

768 
ifibss
->
chªdef
.
width
) {

769 
NL80211_CHAN_WIDTH_5
:

770 
NL80211_CHAN_WIDTH_10
:

771 
NL80211_CHAN_WIDTH_20_NOHT
:

772 
cÚn
.
mode
 = 
IEEE80211_CONN_MODE_LEGACY
;

773 
çÎthrough
;

774 
NL80211_CHAN_WIDTH_20
:

775 
cÚn
.
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

781 ià(
–ems
->
vht_ÿp_–em
)

782 
vht_ÿp_šfo
 = 
	`Ë32_to_ıu
(
–ems
->
vht_ÿp_–em
->vht_cap_info);

784 
	`mem£t
(&
·¿ms
, 0, (params));

785 
”r
 = 
	`›“80211_·r£_ch_sw™ch_›
(
sd©a
, 
–ems
,

786 
ifibss
->
chªdef
.
chª
->
bªd
,

787 
vht_ÿp_šfo
, &
cÚn
,

788 
ifibss
->
bssid
, &
c§_›
);

790 ià(
”r
 < 0)

791 
discÚÃù
;

794 ià(
”r
)

795  
çl£
;

798 ià(!(
sd©a
->
loÿl
->
hw
.
why
->
æags
 & 
WIPHY_FLAG_HAS_CHANNEL_SWITCH
))

799 
discÚÃù
;

801 
·¿ms
.
couÁ
 = 
c§_›
.count;

802 
·¿ms
.
chªdef
 = 
c§_›
.
chª»q
.
İ”
;

804 
ifibss
->
chªdef
.
width
) {

805 
NL80211_CHAN_WIDTH_20_NOHT
:

806 
NL80211_CHAN_WIDTH_20
:

807 
NL80211_CHAN_WIDTH_40
:

813 
ch_ty³
 = 
	`cfg80211_g‘_chªdef_ty³
(&
ifibss
->
chªdef
);

814 
	`cfg80211_chªdef_ü—‹
(&
·¿ms
.
chªdef
,…¬ams.chªdef.
chª
,

815 
ch_ty³
);

817 
NL80211_CHAN_WIDTH_5
:

818 
NL80211_CHAN_WIDTH_10
:

819 ià(
·¿ms
.
chªdef
.
width
 !ğ
ifibss
->chandef.width) {

820 
	`sd©a_šfo
(
sd©a
,

822 
ifibss
->
bssid
,

823 
·¿ms
.
chªdef
.
chª
->
ûÁ”_äeq
,

824 
·¿ms
.
chªdef
.
width
,

825 
·¿ms
.
chªdef
.
ûÁ”_äeq1
,

826 
·¿ms
.
chªdef
.
ûÁ”_äeq2
);

827 
discÚÃù
;

832 
	`WARN_ON
(1);

833 
discÚÃù
;

836 ià(!
	`cfg80211_»g_ÿn_b—cÚ
(
sd©a
->
loÿl
->
hw
.
why
, &
·¿ms
.
chªdef
,

837 
NL80211_IFTYPE_ADHOC
)) {

838 
	`sd©a_šfo
(
sd©a
,

840 
ifibss
->
bssid
,

841 
·¿ms
.
chªdef
.
chª
->
ûÁ”_äeq
,

842 
·¿ms
.
chªdef
.
width
,

843 
·¿ms
.
chªdef
.
ûÁ”_äeq1
,

844 
·¿ms
.
chªdef
.
ûÁ”_äeq2
);

845 
discÚÃù
;

848 
”r
 = 
	`cfg80211_chªdef_dfs_»quœed
(
sd©a
->
loÿl
->
hw
.
why
,

849 &
·¿ms
.
chªdef
,

850 
NL80211_IFTYPE_ADHOC
);

851 ià(
”r
 < 0)

852 
discÚÃù
;

853 ià(
”r
 > 0 && !
ifibss
->
u£r¥aû_hªdËs_dfs
) {

855 
discÚÃù
;

858 
·¿ms
.
¿d¬_»quœed
 = 
”r
;

860 ià(
	`cfg80211_chªdef_id’tiÿl
(&
·¿ms
.
chªdef
,

861 &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
)) {

862 
	`ibss_dbg
(
sd©a
,

864  
Œue
;

868 
	`ibss_dbg
(
sd©a
,

870 
·¿ms
.
chªdef
.
chª
->
ûÁ”_äeq
);

872 
·¿ms
.
block_tx
 = !!
c§_›
.
mode
;

874 ià(
	`›“80211_chªÃl_sw™ch
(
sd©a
->
loÿl
->
hw
.
why
, sd©a->
dev
,

875 &
·¿ms
))

876 
discÚÃù
;

878 
	`›“80211_ibss_c§_m¬k_¿d¬
(
sd©a
);

880  
Œue
;

881 
discÚÃù
:

882 
	`ibss_dbg
(
sd©a
, "Can't handle channel switch, disconnect\n");

883 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

884 &
ifibss
->
c§_cÚÃùiÚ_drİ_wÜk
);

886 
	`›“80211_ibss_c§_m¬k_¿d¬
(
sd©a
);

888  
Œue
;

889 
	}
}

892 
	$›“80211_rx_mgmt_¥eùrum_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

893 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

894 
›“80211_rx_¡©us
 *
rx_¡©us
,

895 
›“802_11_–ems
 *
–ems
)

897 
»quœed_Ën
;

899 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 1)

903 ià(
mgmt
->
u
.
aùiÚ
.u.
m—su»m’t
.
aùiÚ_code
 !=

904 
WLAN_ACTION_SPCT_CHL_SWITCH
)

907 
»quœed_Ën
 = 
IEEE80211_MIN_ACTION_SIZE
 +

908 (
mgmt
->
u
.
aùiÚ
.u.
chª_sw™ch
);

909 ià(
Ën
 < 
»quœed_Ën
)

912 ià(!
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
)

913 
	`›“80211_ibss_´oûss_chªsw™ch
(
sd©a
, 
–ems
, 
çl£
);

914 
	}
}

916 
	$›“80211_rx_mgmt_d—uth_ibss
(
›“80211_sub_if_d©a
 *
sd©a
,

917 
›“80211_mgmt
 *
mgmt
,

918 
size_t
 
Ën
)

920 
u16
 
»asÚ
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
d—uth
.
»asÚ_code
);

922 ià(
Ën
 < 
IEEE80211_DEAUTH_FRAME_LEN
)

925 
	`ibss_dbg
(
sd©a
, "RX DeAuth SA=%pM DA=%pM\n", 
mgmt
->
§
, mgmt->
da
);

926 
	`ibss_dbg
(
sd©a
, "\tBSSID=%pM (»asÚ: %d)\n", 
mgmt
->
bssid
, 
»asÚ
);

927 
	`¡a_šfo_de¡roy_addr
(
sd©a
, 
mgmt
->
§
);

928 
	}
}

930 
	$›“80211_rx_mgmt_auth_ibss
(
›“80211_sub_if_d©a
 *
sd©a
,

931 
›“80211_mgmt
 *
mgmt
,

932 
size_t
 
Ën
)

934 
u16
 
auth_®g
, 
auth_Œª§ùiÚ
;

936 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

938 ià(
Ën
 < 24 + 6)

941 
auth_®g
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
auth
.auth_alg);

942 
auth_Œª§ùiÚ
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
auth
.auth_transaction);

944 
	`ibss_dbg
(
sd©a
, "RX Auth SA=%pM DA=%pM\n", 
mgmt
->
§
, mgmt->
da
);

945 
	`ibss_dbg
(
sd©a
, "\tBSSID=%pM (auth_transaction=%d)\n",

946 
mgmt
->
bssid
, 
auth_Œª§ùiÚ
);

948 ià(
auth_®g
 !ğ
WLAN_AUTH_OPEN
 || 
auth_Œª§ùiÚ
 != 1)

957 
	`›“80211_£nd_auth
(
sd©a
, 2, 
WLAN_AUTH_OPEN
, 0, 
NULL
, 0,

958 
mgmt
->
§
, 
sd©a
->
u
.
ibss
.
bssid
, 
NULL
, 0, 0, 0);

959 
	}
}

961 
	$›“80211_upd©e_¡a_šfo
(
›“80211_sub_if_d©a
 *
sd©a
,

962 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

963 
›“80211_rx_¡©us
 *
rx_¡©us
,

964 
›“802_11_–ems
 *
–ems
,

965 
›“80211_chªÃl
 *
chªÃl
)

967 
¡a_šfo
 *
¡a
;

968 
Æ80211_bªd
 
bªd
 = 
rx_¡©us
->band;

969 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

970 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

971 
boŞ
 
¿‹s_upd©ed
 = 
çl£
;

972 
u32
 
suµ_¿‹s
 = 0;

974 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

977 ià(!
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
sd©a
->
u
.
ibss
.bssid))

980 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

981 ià(
	`WARN_ON
(!
sbªd
))

984 
	`rcu_»ad_lock
();

985 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
);

987 ià(
–ems
->
suµ_¿‹s
) {

988 
suµ_¿‹s
 = 
	`›“80211_¡a_g‘_¿‹s
(
sd©a
, 
–ems
,

989 
bªd
, 
NULL
);

990 ià(
¡a
) {

991 
u32
 
´ev_¿‹s
;

993 
´ev_¿‹s
 = 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
];

995 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
] = supp_rates |

996 
	`›“80211_mªd©Üy_¿‹s
(
sbªd
);

997 ià(
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
] !ğ
´ev_¿‹s
) {

998 
	`ibss_dbg
(
sd©a
,

1000 
¡a
->¡a.
addr
, 
´ev_¿‹s
,

1001 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
]);

1002 
¿‹s_upd©ed
 = 
Œue
;

1005 
	`rcu_»ad_uÆock
();

1006 
¡a
 = 
	`›“80211_ibss_add_¡a
(
sd©a
, 
mgmt
->
bssid
,

1007 
mgmt
->
§
, 
suµ_¿‹s
);

1011 ià(
¡a
 && !¡a->¡a.
wme
 &&

1012 (
–ems
->
wmm_šfo
 ||ƒËms->
s1g_ÿ·b
) &&

1013 
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
) {

1014 
¡a
->¡a.
wme
 = 
Œue
;

1015 
	`›“80211_check_ç¡_xm™
(
¡a
);

1018 ià(
¡a
 && 
–ems
->
ht_İ”©iÚ
 &&ƒËms->
ht_ÿp_–em
 &&

1019 
sd©a
->
u
.
ibss
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_20_NOHT
 &&

1020 
sd©a
->
u
.
ibss
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_5
 &&

1021 
sd©a
->
u
.
ibss
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_10
) {

1023 
›“80211_ht_ÿp
 
htÿp_›
;

1024 
cfg80211_chª_def
 
chªdef
;

1025 
›“80211_¡a_rx_bªdwidth
 
bw
 = 
¡a
->¡a.
deæšk
.
bªdwidth
;

1027 
	`cfg80211_chªdef_ü—‹
(&
chªdef
, 
chªÃl
, 
NL80211_CHAN_NO_HT
);

1028 
	`›“80211_chªdef_ht_İ”
(
–ems
->
ht_İ”©iÚ
, &
chªdef
);

1030 
	`memıy
(&
htÿp_›
, 
–ems
->
ht_ÿp_–em
, (htcap_ie));

1031 
¿‹s_upd©ed
 |ğ
	`›“80211_ht_ÿp_›_to_¡a_ht_ÿp
(
sd©a
, 
sbªd
,

1032 &
htÿp_›
,

1033 &
¡a
->
deæšk
);

1035 ià(
–ems
->
vht_İ”©iÚ
 &&ƒËms->
vht_ÿp_–em
 &&

1036 
sd©a
->
u
.
ibss
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_20
 &&

1037 
sd©a
->
u
.
ibss
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_40
) {

1039 
›“80211_vht_ÿp
 
ÿp_›
;

1040 
›“80211_¡a_vht_ÿp
 
ÿp
 = 
¡a
->¡a.
deæšk
.
vht_ÿp
;

1041 
u32
 
vht_ÿp_šfo
 =

1042 
	`Ë32_to_ıu
(
–ems
->
vht_ÿp_–em
->
vht_ÿp_šfo
);

1044 
	`›“80211_chªdef_vht_İ”
(&
loÿl
->
hw
, 
vht_ÿp_šfo
,

1045 
–ems
->
vht_İ”©iÚ
,

1046 
–ems
->
ht_İ”©iÚ
,

1047 &
chªdef
);

1048 
	`memıy
(&
ÿp_›
, 
–ems
->
vht_ÿp_–em
, (cap_ie));

1049 
	`›“80211_vht_ÿp_›_to_¡a_vht_ÿp
(
sd©a
, 
sbªd
,

1050 &
ÿp_›
, 
NULL
,

1051 &
¡a
->
deæšk
);

1052 ià(
	`memcmp
(&
ÿp
, &
¡a
->¡a.
deæšk
.
vht_ÿp
, (cap)))

1053 
¿‹s_upd©ed
 |ğ
Œue
;

1056 ià(
bw
 !ğ
¡a
->¡a.
deæšk
.
bªdwidth
)

1057 
¿‹s_upd©ed
 |ğ
Œue
;

1059 ià(!
	`cfg80211_chªdef_com·tibË
(&
sd©a
->
u
.
ibss
.
chªdef
,

1060 &
chªdef
))

1061 
	`WARN_ON_ONCE
(1);

1064 ià(
¡a
 && 
¿‹s_upd©ed
) {

1065 
u32
 
chªged
 = 
IEEE80211_RC_SUPP_RATES_CHANGED
;

1066 
u8
 
rx_nss
 = 
¡a
->¡a.
deæšk
.rx_nss;

1069 
¡a
->¡a.
deæšk
.
rx_nss
 = 0;

1070 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

1071 ià(
¡a
->¡a.
deæšk
.
rx_nss
 !=„x_nss)

1072 
chªged
 |ğ
IEEE80211_RC_NSS_CHANGED
;

1074 
	`drv_¡a_rc_upd©e
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
chªged
);

1077 
	`rcu_»ad_uÆock
();

1078 
	}
}

1080 
	$›“80211_rx_bss_šfo
(
›“80211_sub_if_d©a
 *
sd©a
,

1081 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

1082 
›“80211_rx_¡©us
 *
rx_¡©us
,

1083 
›“802_11_–ems
 *
–ems
)

1085 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1086 
cfg80211_bss
 *
cbss
;

1087 
›“80211_bss
 *
bss
;

1088 
›“80211_chªÃl
 *
chªÃl
;

1089 
u64
 
b—cÚ_time¡amp
, 
rx_time¡amp
;

1090 
u32
 
suµ_¿‹s
 = 0;

1091 
Æ80211_bªd
 
bªd
 = 
rx_¡©us
->band;

1093 
chªÃl
 = 
	`›“80211_g‘_chªÃl
(
loÿl
->
hw
.
why
, 
rx_¡©us
->
äeq
);

1094 ià(!
chªÃl
)

1097 
	`›“80211_upd©e_¡a_šfo
(
sd©a
, 
mgmt
, 
Ën
, 
rx_¡©us
, 
–ems
, 
chªÃl
);

1099 
bss
 = 
	`›“80211_bss_šfo_upd©e
(
loÿl
, 
rx_¡©us
, 
mgmt
, 
Ën
, 
chªÃl
);

1100 ià(!
bss
)

1103 
cbss
 = 
	`cÚš”_of
((*)
bss
, 
cfg80211_bss
, 
´iv
);

1106 
b—cÚ_time¡amp
 = 
	`Ë64_to_ıu
(
mgmt
->
u
.
b—cÚ
.
time¡amp
);

1111 ià(!(
cbss
->
ÿ·b™y
 & 
WLAN_CAPABILITY_IBSS
))

1112 
put_bss
;

1115 ià(
sd©a
->
u
.
ibss
.
fixed_chªÃl
 &&

1116 
sd©a
->
u
.
ibss
.
chªdef
.
chª
 !ğ
cbss
->
chªÃl
)

1117 
put_bss
;

1120 ià(
–ems
->
ssid_Ën
 !ğ
sd©a
->
u
.
ibss
.ssid_len ||

1121 
	`memcmp
(
–ems
->
ssid
, 
sd©a
->
u
.
ibss
.ssid,

1122 
sd©a
->
u
.
ibss
.
ssid_Ën
))

1123 
put_bss
;

1126 ià(
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 ||

1127 
	`›“80211_ibss_´oûss_chªsw™ch
(
sd©a
, 
–ems
, 
Œue
))

1128 
put_bss
;

1131 ià(
	`‘h”_addr_equ®
(
cbss
->
bssid
, 
sd©a
->
u
.
ibss
.bssid))

1132 
put_bss
;

1135 ià(
sd©a
->
u
.
ibss
.
fixed_bssid
)

1136 
put_bss
;

1138 ià(
	`›“80211_have_rx_time¡amp
(
rx_¡©us
)) {

1140 
rx_time¡amp
 =

1141 
	`›“80211_ÿlcuÏ‹_rx_time¡amp
(
loÿl
, 
rx_¡©us
,

1142 
Ën
 + 
FCS_LEN
, 24);

1148 
rx_time¡amp
 = 
	`drv_g‘_tsf
(
loÿl
, 
sd©a
);

1151 
	`ibss_dbg
(
sd©a
, "RX beacon SA=%pM BSSID=%pM TSF=0x%llx\n",

1152 
mgmt
->
§
, mgmt->
bssid
,

1153 ()
rx_time¡amp
);

1154 
	`ibss_dbg
(
sd©a
, "\tBCN=0x%llx diff=%lld @%lu\n",

1155 ()
b—cÚ_time¡amp
,

1156 ()(
rx_time¡amp
 - 
b—cÚ_time¡amp
),

1157 
jiff›s
);

1159 ià(
b—cÚ_time¡amp
 > 
rx_time¡amp
) {

1160 
	`ibss_dbg
(
sd©a
,

1162 
mgmt
->
bssid
);

1163 
	`›“80211_¡a_još_ibss
(
sd©a
, 
bss
);

1164 
suµ_¿‹s
 = 
	`›“80211_¡a_g‘_¿‹s
(
sd©a
, 
–ems
, 
bªd
, 
NULL
);

1165 
	`›“80211_ibss_add_¡a
(
sd©a
, 
mgmt
->
bssid
, mgmt->
§
,

1166 
suµ_¿‹s
);

1167 
	`rcu_»ad_uÆock
();

1170 
put_bss
:

1171 
	`›“80211_rx_bss_put
(
loÿl
, 
bss
);

1172 
	}
}

1174 
	$›“80211_ibss_rx_no_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

1175 cÚ¡ 
u8
 *
bssid
, cÚ¡ u8 *
addr
,

1176 
u32
 
suµ_¿‹s
)

1178 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1179 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1180 
¡a_šfo
 *
¡a
;

1181 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

1182 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1183 
bªd
;

1189 ià(
loÿl
->
num_¡a
 >ğ
IEEE80211_IBSS_MAX_STA_ENTRIES
) {

1190 
	`Ãt_šfo_¿‹lim™ed
("%s: No„oom for‡‚ew IBSS STAƒntry %pM\n",

1191 
sd©a
->
Çme
, 
addr
);

1195 ià(
ifibss
->
¡©e
 =ğ
IEEE80211_IBSS_MLME_SEARCH
)

1198 ià(!
	`‘h”_addr_equ®
(
bssid
, 
sd©a
->
u
.
ibss
.bssid))

1201 
	`rcu_»ad_lock
();

1202 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

1203 ià(
	`WARN_ON_ONCE
(!
chªùx_cÚf
)) {

1204 
	`rcu_»ad_uÆock
();

1207 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

1208 
	`rcu_»ad_uÆock
();

1210 
¡a
 = 
	`¡a_šfo_®loc
(
sd©a
, 
addr
, 
GFP_ATOMIC
);

1211 ià(!
¡a
)

1215 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1216 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
] = supp_rates |

1217 
	`›“80211_mªd©Üy_¿‹s
(
sbªd
);

1219 
	`¥š_lock
(&
ifibss
->
šcom¶‘e_lock
);

1220 
	`li¡_add
(&
¡a
->
li¡
, &
ifibss
->
šcom¶‘e_¡©iÚs
);

1221 
	`¥š_uÆock
(&
ifibss
->
šcom¶‘e_lock
);

1222 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

1223 
	}
}

1225 
	$›“80211_ibss_¡a_expœe
(
›“80211_sub_if_d©a
 *
sd©a
)

1227 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1228 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1229 
¡a_šfo
 *
¡a
, *
tmp
;

1230 
exp_time
 = 
IEEE80211_IBSS_INACTIVITY_LIMIT
;

1231 
exp_r¢
 = 
IEEE80211_IBSS_RSN_INACTIVITY_LIMIT
;

1233 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1235 
	`li¡_fÜ_—ch_’Œy_§ã
(
¡a
, 
tmp
, &
loÿl
->
¡a_li¡
, 
li¡
) {

1236 
Ï¡_aùive
 = 
	`›“80211_¡a_Ï¡_aùive
(
¡a
);

1238 ià(
sd©a
 !ğ
¡a
->sdata)

1241 ià(
	`time_is_befÜe_jiff›s
(
Ï¡_aùive
 + 
exp_time
) ||

1242 (
	`time_is_befÜe_jiff›s
(
Ï¡_aùive
 + 
exp_r¢
) &&

1243 
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_AUTHORIZED
)) {

1244 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

1246 
	`¡a_dbg
(
¡a
->
sd©a
, "expiring inactive %sSTA %pM\n",

1247 
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_AUTHORIZED
 ?

1248 "nÙ‡uthÜized " : "", 
¡a
->¡a.
addr
);

1250 
	`›“80211_£nd_d—uth_di§ssoc
(
sd©a
, 
¡a
->¡a.
addr
,

1251 
ifibss
->
bssid
,

1252 
IEEE80211_STYPE_DEAUTH
,

1253 
WLAN_REASON_DEAUTH_LEAVING
,

1254 
Œue
, 
äame_buf
);

1255 
	`WARN_ON
(
	`__¡a_šfo_de¡roy
(
¡a
));

1258 
	}
}

1264 
	$›“80211_¡a_m”ge_ibss
(
›“80211_sub_if_d©a
 *
sd©a
)

1266 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1268 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1270 
	`mod_tim”
(&
ifibss
->
tim”
,

1271 
	`round_jiff›s
(
jiff›s
 + 
IEEE80211_IBSS_MERGE_INTERVAL
));

1273 
	`›“80211_ibss_¡a_expœe
(
sd©a
);

1275 ià(
	`time_befÜe
(
jiff›s
, 
ifibss
->
Ï¡_sÿn_com¶‘ed
 +

1276 
IEEE80211_IBSS_MERGE_INTERVAL
))

1279 ià(
	`›“80211_¡a_aùive_ibss
(
sd©a
))

1282 ià(
ifibss
->
fixed_chªÃl
)

1285 
	`sd©a_šfo
(
sd©a
,

1288 
	`›“80211_»que¡_ibss_sÿn
(
sd©a
, 
ifibss
->
ssid
, ifibss->
ssid_Ën
,

1289 
NULL
, 0);

1290 
	}
}

1292 
	$›“80211_¡a_ü—‹_ibss
(
›“80211_sub_if_d©a
 *
sd©a
)

1294 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1295 
u8
 
bssid
[
ETH_ALEN
];

1296 
u16
 
ÿ·b™y
;

1297 
i
;

1299 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1301 ià(
ifibss
->
fixed_bssid
) {

1302 
	`memıy
(
bssid
, 
ifibss
->bssid, 
ETH_ALEN
);

1307 
	`g‘_¿ndom_by‹s
(
bssid
, 
ETH_ALEN
);

1308 
i
 = 0; i < 
ETH_ALEN
; i++)

1309 
bssid
[
i
] ^ğ
sd©a
->
vif
.
addr
[i];

1310 
bssid
[0] &= ~0x01;

1311 
bssid
[0] |= 0x02;

1314 
	`sd©a_šfo
(
sd©a
, "C»©šg‚ew IBSS‚‘wÜk, BSSID %pM\n", 
bssid
);

1316 
ÿ·b™y
 = 
WLAN_CAPABILITY_IBSS
;

1318 ià(
ifibss
->
´ivacy
)

1319 
ÿ·b™y
 |ğ
WLAN_CAPABILITY_PRIVACY
;

1321 
	`__›“80211_¡a_još_ibss
(
sd©a
, 
bssid
, sd©a->
vif
.
bss_cÚf
.
b—cÚ_št
,

1322 &
ifibss
->
chªdef
, ifibss->
basic_¿‹s
,

1323 
ÿ·b™y
, 0, 
Œue
);

1324 
	}
}

1326 
	$ibss_£tup_chªÃls
(
why
 *wiphy,

1327 
›“80211_chªÃl
 **
chªÃls
,

1328 
chªÃls_max
,

1329 
u32
 
ûÁ”_äeq
, u32 
width
)

1331 
›“80211_chªÃl
 *
chª
 = 
NULL
;

1332 
n_chª
 = 0;

1333 
u32
 
¡¬t_äeq
, 
’d_äeq
, 
äeq
;

1335 ià(
width
 <= 20) {

1336 
¡¬t_äeq
 = 
ûÁ”_äeq
;

1337 
’d_äeq
 = 
ûÁ”_äeq
;

1339 
¡¬t_äeq
 = 
ûÁ”_äeq
 - 
width
 / 2 + 10;

1340 
’d_äeq
 = 
ûÁ”_äeq
 + 
width
 / 2 - 10;

1343 
äeq
 = 
¡¬t_äeq
; f»q <ğ
’d_äeq
; freq += 20) {

1344 
chª
 = 
	`›“80211_g‘_chªÃl
(
why
, 
äeq
);

1345 ià(!
chª
)

1347 ià(
n_chª
 >ğ
chªÃls_max
)

1348  
n_chª
;

1350 
chªÃls
[
n_chª
] = 
chª
;

1351 
n_chª
++;

1354  
n_chª
;

1355 
	}
}

1358 
	$›“80211_ibss_£tup_sÿn_chªÃls
(
why
 *wiphy,

1359 cÚ¡ 
cfg80211_chª_def
 *
chªdef
,

1360 
›“80211_chªÃl
 **
chªÃls
,

1361 
chªÃls_max
)

1363 
n_chª
 = 0;

1364 
u32
 
width
, 
cf1
, 
cf2
 = 0;

1366 
chªdef
->
width
) {

1367 
NL80211_CHAN_WIDTH_40
:

1368 
width
 = 40;

1370 
NL80211_CHAN_WIDTH_80P80
:

1371 
cf2
 = 
chªdef
->
ûÁ”_äeq2
;

1372 
çÎthrough
;

1373 
NL80211_CHAN_WIDTH_80
:

1374 
width
 = 80;

1376 
NL80211_CHAN_WIDTH_160
:

1377 
width
 = 160;

1380 
width
 = 20;

1384 
cf1
 = 
chªdef
->
ûÁ”_äeq1
;

1386 
n_chª
 = 
	`ibss_£tup_chªÃls
(
why
, 
chªÃls
, 
chªÃls_max
, 
cf1
, 
width
);

1388 ià(
cf2
)

1389 
n_chª
 +ğ
	`ibss_£tup_chªÃls
(
why
, &
chªÃls
[n_chan],

1390 
chªÃls_max
 - 
n_chª
, 
cf2
,

1391 
width
);

1393  
n_chª
;

1394 
	}
}

1400 
	$›“80211_¡a_fšd_ibss
(
›“80211_sub_if_d©a
 *
sd©a
)

1402 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1403 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1404 
cfg80211_bss
 *
cbss
;

1405 
›“80211_chªÃl
 *
chª
 = 
NULL
;

1406 cÚ¡ 
u8
 *
bssid
 = 
NULL
;

1407 
aùive_ibss
;

1409 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1411 
aùive_ibss
 = 
	`›“80211_¡a_aùive_ibss
(
sd©a
);

1412 
	`ibss_dbg
(
sd©a
, "¡a_fšd_ibs ×ùive_ibss=%d)\n", 
aùive_ibss
);

1414 ià(
aùive_ibss
)

1417 ià(
ifibss
->
fixed_bssid
)

1418 
bssid
 = 
ifibss
->bssid;

1419 ià(
ifibss
->
fixed_chªÃl
)

1420 
chª
 = 
ifibss
->
chªdef
.chan;

1421 ià(!
	`is_z”o_‘h”_addr
(
ifibss
->
bssid
))

1422 
bssid
 = 
ifibss
->bssid;

1423 
cbss
 = 
	`cfg80211_g‘_bss
(
loÿl
->
hw
.
why
, 
chª
, 
bssid
,

1424 
ifibss
->
ssid
, ifibss->
ssid_Ën
,

1425 
IEEE80211_BSS_TYPE_IBSS
,

1426 
	`IEEE80211_PRIVACY
(
ifibss
->
´ivacy
));

1428 ià(
cbss
) {

1429 
›“80211_bss
 *
bss
;

1431 
bss
 = (*)
cbss
->
´iv
;

1432 
	`ibss_dbg
(
sd©a
,

1434 
cbss
->
bssid
, 
ifibss
->bssid);

1435 
	`sd©a_šfo
(
sd©a
,

1437 
cbss
->
bssid
);

1439 
	`›“80211_¡a_još_ibss
(
sd©a
, 
bss
);

1440 
	`›“80211_rx_bss_put
(
loÿl
, 
bss
);

1447 ià(
ifibss
->
fixed_bssid
 && ifibss->
fixed_chªÃl
) {

1448 
	`sd©a_šfo
(
sd©a
, "Created IBSS using…reconfigured BSSID %pM\n",

1449 
bssid
);

1450 
	`›“80211_¡a_ü—‹_ibss
(
sd©a
);

1455 
	`ibss_dbg
(
sd©a
, "sta_find_ibss: did‚otryo join ibss\n");

1458 ià(
	`time_aá”
(
jiff›s
, 
ifibss
->
Ï¡_sÿn_com¶‘ed
 +

1459 
IEEE80211_SCAN_INTERVAL
)) {

1460 
›“80211_chªÃl
 *
chªÃls
[8];

1461 
num
;

1463 
	`sd©a_šfo
(
sd©a
, "Trigger‚ew scano find‡n IBSSo join\n");

1465 ià(
ifibss
->
fixed_chªÃl
) {

1466 
num
 = 
	`›“80211_ibss_£tup_sÿn_chªÃls
(
loÿl
->
hw
.
why
,

1467 &
ifibss
->
chªdef
,

1468 
chªÃls
,

1469 
	`ARRAY_SIZE
(
chªÃls
));

1470 
	`›“80211_»que¡_ibss_sÿn
(
sd©a
, 
ifibss
->
ssid
,

1471 
ifibss
->
ssid_Ën
, 
chªÃls
,

1472 
num
);

1474 
	`›“80211_»que¡_ibss_sÿn
(
sd©a
, 
ifibss
->
ssid
,

1475 
ifibss
->
ssid_Ën
, 
NULL
, 0);

1478 
š‹rv®
 = 
IEEE80211_SCAN_INTERVAL
;

1480 ià(
	`time_aá”
(
jiff›s
, 
ifibss
->
ibss_još_»q
 +

1481 
IEEE80211_IBSS_JOIN_TIMEOUT
))

1482 
	`›“80211_¡a_ü—‹_ibss
(
sd©a
);

1484 
	`mod_tim”
(&
ifibss
->
tim”
,

1485 
	`round_jiff›s
(
jiff›s
 + 
š‹rv®
));

1487 
	}
}

1489 
	$›“80211_rx_mgmt_´obe_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

1490 
sk_buff
 *
»q
)

1492 
›“80211_mgmt
 *
mgmt
 = (*)
»q
->
d©a
;

1493 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1494 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1495 
tx_Ï¡_b—cÚ
, 
Ën
 = 
»q
->len;

1496 
sk_buff
 *
skb
;

1497 
b—cÚ_d©a
 *
´e¥
;

1498 
u8
 *
pos
, *
’d
;

1500 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1502 
´e¥
 = 
	`sd©a_d”eã»nû
(
ifibss
->´e¥, 
sd©a
);

1504 ià(
ifibss
->
¡©e
 !ğ
IEEE80211_IBSS_MLME_JOINED
 ||

1505 
Ën
 < 24 + 2 || !
´e¥
)

1508 
tx_Ï¡_b—cÚ
 = 
	`drv_tx_Ï¡_b—cÚ
(
loÿl
);

1510 
	`ibss_dbg
(
sd©a
, "RX ProbeReq SA=%pM DA=%pM\n", 
mgmt
->
§
, mgmt->
da
);

1511 
	`ibss_dbg
(
sd©a
, "\tBSSID=%pM (tx_last_beacon=%d)\n",

1512 
mgmt
->
bssid
, 
tx_Ï¡_b—cÚ
);

1514 ià(!
tx_Ï¡_b—cÚ
 && 
	`is_muÉiÿ¡_‘h”_addr
(
mgmt
->
da
))

1517 ià(!
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
ifibss
->bssid) &&

1518 !
	`is_brßdÿ¡_‘h”_addr
(
mgmt
->
bssid
))

1521 
’d
 = ((
u8
 *è
mgmt
è+ 
Ën
;

1522 
pos
 = 
mgmt
->
u
.
´obe_»q
.
v¬ŸbË
;

1523 ià(
pos
[0] !ğ
WLAN_EID_SSID
 ||

1524 
pos
 + 2 +…os[1] > 
’d
) {

1525 
	`ibss_dbg
(
sd©a
, "Invalid SSID IE in ProbeReq from %pM\n",

1526 
mgmt
->
§
);

1529 ià(
pos
[1] != 0 &&

1530 (
pos
[1] !ğ
ifibss
->
ssid_Ën
 ||

1531 
	`memcmp
(
pos
 + 2, 
ifibss
->
ssid
, ifibss->
ssid_Ën
))) {

1537 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
´e¥
->
h—d_Ën
);

1538 ià(!
skb
)

1541 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

1542 
	`skb_put_d©a
(
skb
, 
´e¥
->
h—d
,…»¥->
h—d_Ën
);

1544 
	`memıy
(((
›“80211_mgmt
 *è
skb
->
d©a
)->
da
, 
mgmt
->
§
, 
ETH_ALEN
);

1545 
	`ibss_dbg
(
sd©a
, "S’dšg ProbeRe¥Ø%pM\n", 
mgmt
->
§
);

1546 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1549 ià(
pos
[1] == 0)

1550 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

1552 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1553 
	}
}

1556 
	$›“80211_rx_mgmt_´obe_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1557 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

1558 
›“80211_rx_¡©us
 *
rx_¡©us
)

1560 
size_t
 
ba£Ën
;

1561 
›“802_11_–ems
 *
–ems
;

1563 
	`BUILD_BUG_ON
(
	`off£tof
(
	`ty³of
(
mgmt
->
u
.
´obe_»¥
), 
v¬ŸbË
) !=

1564 
	`off£tof
(
	`ty³of
(
mgmt
->
u
.
b—cÚ
), 
v¬ŸbË
));

1570 
ba£Ën
 = (
u8
 *è
mgmt
->
u
.
´obe_»¥
.
v¬ŸbË
 - (u8 *) mgmt;

1571 ià(
ba£Ën
 > 
Ën
)

1574 
–ems
 = 
	`›“802_11_·r£_–ems
(
mgmt
->
u
.
´obe_»¥
.
v¬ŸbË
,

1575 
Ën
 - 
ba£Ën
, 
çl£
, 
NULL
);

1577 ià(
–ems
) {

1578 
	`›“80211_rx_bss_šfo
(
sd©a
, 
mgmt
, 
Ën
, 
rx_¡©us
, 
–ems
);

1579 
	`kä“
(
–ems
);

1581 
	}
}

1583 
	$›“80211_ibss_rx_queued_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

1584 
sk_buff
 *
skb
)

1586 
›“80211_rx_¡©us
 *
rx_¡©us
;

1587 
›“80211_mgmt
 *
mgmt
;

1588 
u16
 
fc
;

1589 
›“802_11_–ems
 *
–ems
;

1590 
›s_Ën
;

1592 
rx_¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1593 
mgmt
 = (
›“80211_mgmt
 *è
skb
->
d©a
;

1594 
fc
 = 
	`Ë16_to_ıu
(
mgmt
->
äame_cÚŒŞ
);

1596 ià(!
sd©a
->
u
.
ibss
.
ssid_Ën
)

1599 
fc
 & 
IEEE80211_FCTL_STYPE
) {

1600 
IEEE80211_STYPE_PROBE_REQ
:

1601 
	`›“80211_rx_mgmt_´obe_»q
(
sd©a
, 
skb
);

1603 
IEEE80211_STYPE_PROBE_RESP
:

1604 
IEEE80211_STYPE_BEACON
:

1605 
	`›“80211_rx_mgmt_´obe_b—cÚ
(
sd©a
, 
mgmt
, 
skb
->
Ën
,

1606 
rx_¡©us
);

1608 
IEEE80211_STYPE_AUTH
:

1609 
	`›“80211_rx_mgmt_auth_ibss
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

1611 
IEEE80211_STYPE_DEAUTH
:

1612 
	`›“80211_rx_mgmt_d—uth_ibss
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

1614 
IEEE80211_STYPE_ACTION
:

1615 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
) {

1616 
WLAN_CATEGORY_SPECTRUM_MGMT
:

1617 
›s_Ën
 = 
skb
->
Ën
 -

1618 
	`off£tof
(
›“80211_mgmt
,

1619 
u
.
aùiÚ
.u.
chª_sw™ch
.
v¬ŸbË
);

1621 ià(
›s_Ën
 < 0)

1624 
–ems
 = 
	`›“802_11_·r£_–ems
(

1625 
mgmt
->
u
.
aùiÚ
.u.
chª_sw™ch
.
v¬ŸbË
,

1626 
›s_Ën
, 
Œue
, 
NULL
);

1628 ià(
–ems
 && !–ems->
·r£_”rÜ
)

1629 
	`›“80211_rx_mgmt_¥eùrum_mgmt
(
sd©a
, 
mgmt
,

1630 
skb
->
Ën
,

1631 
rx_¡©us
,

1632 
–ems
);

1633 
	`kä“
(
–ems
);

1637 
	}
}

1639 
	$›“80211_ibss_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
)

1641 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1642 
¡a_šfo
 *
¡a
;

1649 ià(!
ifibss
->
ssid_Ën
)

1652 
	`¥š_lock_bh
(&
ifibss
->
šcom¶‘e_lock
);

1653 !
	`li¡_em±y
(&
ifibss
->
šcom¶‘e_¡©iÚs
)) {

1654 
¡a
 = 
	`li¡_fœ¡_’Œy
(&
ifibss
->
šcom¶‘e_¡©iÚs
,

1655 
¡a_šfo
, 
li¡
);

1656 
	`li¡_d–
(&
¡a
->
li¡
);

1657 
	`¥š_uÆock_bh
(&
ifibss
->
šcom¶‘e_lock
);

1659 
	`›“80211_ibss_fšish_¡a
(
¡a
);

1660 
	`rcu_»ad_uÆock
();

1661 
	`¥š_lock_bh
(&
ifibss
->
šcom¶‘e_lock
);

1663 
	`¥š_uÆock_bh
(&
ifibss
->
šcom¶‘e_lock
);

1665 
ifibss
->
¡©e
) {

1666 
IEEE80211_IBSS_MLME_SEARCH
:

1667 
	`›“80211_¡a_fšd_ibss
(
sd©a
);

1669 
IEEE80211_IBSS_MLME_JOINED
:

1670 
	`›“80211_¡a_m”ge_ibss
(
sd©a
);

1673 
	`WARN_ON
(1);

1676 
	}
}

1678 
	$›“80211_ibss_tim”
(
tim”_li¡
 *
t
)

1680 
›“80211_sub_if_d©a
 *
sd©a
 =

1681 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
ibss
.
tim”
);

1683 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

1684 
	}
}

1686 
	$›“80211_ibss_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

1688 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1690 
	`tim”_£tup
(&
ifibss
->
tim”
, 
›“80211_ibss_tim”
, 0);

1691 
	`INIT_LIST_HEAD
(&
ifibss
->
šcom¶‘e_¡©iÚs
);

1692 
	`¥š_lock_š™
(&
ifibss
->
šcom¶‘e_lock
);

1693 
	`why_wÜk_š™
(&
ifibss
->
c§_cÚÃùiÚ_drİ_wÜk
,

1694 
›“80211_c§_cÚÃùiÚ_drİ_wÜk
);

1695 
	}
}

1698 
	$›“80211_ibss_nÙify_sÿn_com¶‘ed
(
›“80211_loÿl
 *
loÿl
)

1700 
›“80211_sub_if_d©a
 *
sd©a
;

1702 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1704 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1705 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1707 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

1709 
sd©a
->
u
.
ibss
.
Ï¡_sÿn_com¶‘ed
 = 
jiff›s
;

1711 
	}
}

1713 
	$›“80211_ibss_još
(
›“80211_sub_if_d©a
 *
sd©a
,

1714 
cfg80211_ibss_·¿ms
 *
·¿ms
)

1716 
u64
 
chªged
 = 0;

1717 
u32
 
¿‹_æags
;

1718 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1719 
›“80211_chªùx_mode
 
chªmode
;

1720 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1721 
¿d¬_d‘eù_width
 = 0;

1722 
i
;

1723 
»t
;

1725 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1727 ià(
·¿ms
->
chªdef
.
chª
->
äeq_off£t
) {

1729  -
EOPNOTSUPP
;

1732 
»t
 = 
	`cfg80211_chªdef_dfs_»quœed
(
loÿl
->
hw
.
why
,

1733 &
·¿ms
->
chªdef
,

1734 
sd©a
->
wdev
.
iáy³
);

1735 ià(
»t
 < 0)

1736  
»t
;

1738 ià(
»t
 > 0) {

1739 ià(!
·¿ms
->
u£r¥aû_hªdËs_dfs
)

1740  -
EINVAL
;

1741 
¿d¬_d‘eù_width
 = 
	`BIT
(
·¿ms
->
chªdef
.
width
);

1744 
chªmode
 = (
·¿ms
->
chªÃl_fixed
 && !
»t
) ?

1745 
IEEE80211_CHANCTX_SHARED
 : 
IEEE80211_CHANCTX_EXCLUSIVE
;

1747 
»t
 = 
	`›“80211_check_combš©iÚs
(
sd©a
, &
·¿ms
->
chªdef
, 
chªmode
,

1748 
¿d¬_d‘eù_width
);

1749 ià(
»t
 < 0)

1750  
»t
;

1752 ià(
·¿ms
->
bssid
) {

1753 
	`memıy
(
sd©a
->
u
.
ibss
.
bssid
, 
·¿ms
->bssid, 
ETH_ALEN
);

1754 
sd©a
->
u
.
ibss
.
fixed_bssid
 = 
Œue
;

1756 
sd©a
->
u
.
ibss
.
fixed_bssid
 = 
çl£
;

1758 
sd©a
->
u
.
ibss
.
´ivacy
 = 
·¿ms
->privacy;

1759 
sd©a
->
u
.
ibss
.
cÚŒŞ_pÜt
 = 
·¿ms
->control_port;

1760 
sd©a
->
u
.
ibss
.
u£r¥aû_hªdËs_dfs
 = 
·¿ms
->userspace_handles_dfs;

1761 
sd©a
->
u
.
ibss
.
basic_¿‹s
 = 
·¿ms
->basic_rates;

1762 
sd©a
->
u
.
ibss
.
Ï¡_sÿn_com¶‘ed
 = 
jiff›s
;

1765 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(&
·¿ms
->
chªdef
);

1766 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
·¿ms
->
chªdef
.
chª
->
bªd
];

1767 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

1768 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
i
].
æags
) !=„ate_flags)

1769 
sd©a
->
u
.
ibss
.
basic_¿‹s
 &ğ~
	`BIT
(
i
);

1771 
	`memıy
(
sd©a
->
vif
.
bss_cÚf
.
mÿ¡_¿‹
, 
·¿ms
->mcast_rate,

1772 (
·¿ms
->
mÿ¡_¿‹
));

1774 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
 = 
·¿ms
->
b—cÚ_š‹rv®
;

1776 
sd©a
->
u
.
ibss
.
chªdef
 = 
·¿ms
->chandef;

1777 
sd©a
->
u
.
ibss
.
fixed_chªÃl
 = 
·¿ms
->
chªÃl_fixed
;

1779 ià(
·¿ms
->
›
) {

1780 
sd©a
->
u
.
ibss
.
›
 = 
	`kmemdup
(
·¿ms
->›,…¬ams->
›_Ën
,

1781 
GFP_KERNEL
);

1782 ià(
sd©a
->
u
.
ibss
.
›
)

1783 
sd©a
->
u
.
ibss
.
›_Ën
 = 
·¿ms
->ie_len;

1786 
sd©a
->
u
.
ibss
.
¡©e
 = 
IEEE80211_IBSS_MLME_SEARCH
;

1787 
sd©a
->
u
.
ibss
.
ibss_još_»q
 = 
jiff›s
;

1789 
	`memıy
(
sd©a
->
u
.
ibss
.
ssid
, 
·¿ms
->ssid,…¬ams->
ssid_Ën
);

1790 
sd©a
->
u
.
ibss
.
ssid_Ën
 = 
·¿ms
->ssid_len;

1792 
	`memıy
(&
sd©a
->
u
.
ibss
.
ht_ÿ·
, &
·¿ms
->ht_capa,

1793 (
sd©a
->
u
.
ibss
.
ht_ÿ·
));

1794 
	`memıy
(&
sd©a
->
u
.
ibss
.
ht_ÿ·_mask
, &
·¿ms
->ht_capa_mask,

1795 (
sd©a
->
u
.
ibss
.
ht_ÿ·_mask
));

1807 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
 |=

1808 
IEEE80211_HT_OP_MODE_PROTECTION_NONHT_MIXED


1809 | 
IEEE80211_HT_PARAM_RIFS_MODE
;

1811 
chªged
 |ğ
BSS_CHANGED_HT
 | 
BSS_CHANGED_MCAST_RATE
;

1812 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
, 
chªged
);

1814 
sd©a
->
deæšk
.
smps_mode
 = 
IEEE80211_SMPS_OFF
;

1815 
sd©a
->
deæšk
.
Ãeded_rx_chašs
 = 
loÿl
->
rx_chašs
;

1816 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
 = 
·¿ms
->control_port_over_nl80211;

1818 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

1821 
	}
}

1823 
	$›“80211_ibss_Ëave
(
›“80211_sub_if_d©a
 *
sd©a
)

1825 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

1827 
	`›“80211_ibss_discÚÃù
(
sd©a
);

1828 
ifibss
->
ssid_Ën
 = 0;

1829 
	`‘h_z”o_addr
(
ifibss
->
bssid
);

1832 
	`kä“
(
sd©a
->
u
.
ibss
.
›
);

1833 
sd©a
->
u
.
ibss
.
›
 = 
NULL
;

1834 
sd©a
->
u
.
ibss
.
›_Ën
 = 0;

1837 
	`mem£t
(&
ifibss
->
ht_ÿ·
, 0, (ifibss->ht_capa));

1838 
	`mem£t
(&
ifibss
->
ht_ÿ·_mask
, 0, (ifibss->ht_capa_mask));

1840 
	`synchrÚize_rcu
();

1842 
	`skb_queue_purge
(&
sd©a
->
skb_queue
);

1844 
	`d–_tim”_sync
(&
sd©a
->
u
.
ibss
.
tim”
);

1847 
	}
}

	@ieee80211_i.h

11 #iâdeà
IEEE80211_I_H


12 
	#IEEE80211_I_H


	)

14 
	~<lšux/k”Ãl.h
>

15 
	~<lšux/deviû.h
>

16 
	~<lšux/if_‘h”.h
>

17 
	~<lšux/š‹¼u±.h
>

18 
	~<lšux/li¡.h
>

19 
	~<lšux/Ãtdeviû.h
>

20 
	~<lšux/skbuff.h
>

21 
	~<lšux/wÜkqueue.h
>

22 
	~<lšux/ty³s.h
>

23 
	~<lšux/¥šlock.h
>

24 
	~<lšux/‘h”deviû.h
>

25 
	~<lšux/Ëds.h
>

26 
	~<lšux/idr.h
>

27 
	~<lšux/rhashbË.h
>

28 
	~<lšux/rbŒ“.h
>

29 
	~<Ãt/›“80211_¿diÙ­.h
>

30 
	~<Ãt/cfg80211.h
>

31 
	~<Ãt/mac80211.h
>

32 
	~<Ãt/fq.h
>

33 
	~"key.h
"

34 
	~"¡a_šfo.h
"

35 
	~"debug.h
"

36 
	~"drİ.h
"

38 cÚ¡ 
cfg80211_İs
 
mac80211_cÚfig_İs
;

40 
	g›“80211_loÿl
;

41 
	g›“80211_mesh_ç¡_tx
;

45 
	#AP_MAX_BC_BUFFER
 128

	)

50 
	#TOTAL_MAX_TX_BUFFER
 512

	)

53 
	#IEEE80211_ENCRYPT_HEADROOM
 8

	)

54 
	#IEEE80211_ENCRYPT_TAILROOM
 18

	)

57 
	#IEEE80211_UNSET_POWER_LEVEL
 
INT_MIN


	)

77 
	#IEEE80211_DEFAULT_UAPSD_QUEUES
 0

	)

79 
	#IEEE80211_DEFAULT_MAX_SP_LEN
 \

80 
IEEE80211_WMM_IE_STA_QOSINFO_SP_ALL


	)

82 cÚ¡ 
u8
 
›“80211_ac_to_qos_mask
[
IEEE80211_NUM_ACS
];

84 
	#IEEE80211_DEAUTH_FRAME_LEN
 (24 + 2 )

	)

86 
	#IEEE80211_MAX_NAN_INSTANCE_ID
 255

	)

88 
	e›“80211_¡©us_d©a
 {

89 
	mIEEE80211_STATUS_TYPE_MASK
 = 0x00f,

90 
	mIEEE80211_STATUS_TYPE_INVALID
 = 0,

91 
	mIEEE80211_STATUS_TYPE_SMPS
 = 1,

92 
	mIEEE80211_STATUS_SUBDATA_MASK
 = 0xff0,

95 
šlše
 
boŞ


96 
	$›“80211_¡a_k“p_aùive
(
¡a_šfo
 *
¡a
, 
u8
 
ac
)

101  
	`time_befÜe_eq
(
jiff›s
, 
¡a
->
aœtime
[
ac
].
Ï¡_aùive
 + 
HZ
 / 10);

102 
	}
}

104 
	s›“80211_bss
 {

105 
u32
 
	mdeviû_ts_b—cÚ
, 
	mdeviû_ts_´e¥
;

107 
boŞ
 
	mwmm_u£d
;

108 
boŞ
 
	mu­sd_suµÜ‹d
;

110 
	#IEEE80211_MAX_SUPP_RATES
 32

	)

111 
u8
 
	msuµ_¿‹s
[
IEEE80211_MAX_SUPP_RATES
];

112 
size_t
 
	msuµ_¿‹s_Ën
;

113 
›“80211_¿‹
 *
	mb—cÚ_¿‹
;

115 
u32
 
	mvht_ÿp_šfo
;

123 
boŞ
 
	mhas_”p_v®ue
;

124 
u8
 
	m”p_v®ue
;

127 
u8
 
	mcÜru±_d©a
;

130 
u8
 
	mv®id_d©a
;

141 
	e›“80211_bss_cÜru±_d©a_æags
 {

142 
	mIEEE80211_BSS_CORRUPT_BEACON
 = 
BIT
(0),

143 
	mIEEE80211_BSS_CORRUPT_PROBE_RESP
 = 
BIT
(1)

157 
	e›“80211_bss_v®id_d©a_æags
 {

158 
	mIEEE80211_BSS_VALID_WMM
 = 
BIT
(1),

159 
	mIEEE80211_BSS_VALID_RATES
 = 
BIT
(2),

160 
	mIEEE80211_BSS_VALID_ERP
 = 
BIT
(3)

163 
	t__b™wi£
 
	t›“80211_tx_»suÉ
;

164 
	#TX_CONTINUE
 ((
__fÜû
 
›“80211_tx_»suÉ
è0u)

	)

165 
	#TX_DROP
 ((
__fÜû
 
›“80211_tx_»suÉ
è1u)

	)

166 
	#TX_QUEUED
 ((
__fÜû
 
›“80211_tx_»suÉ
è2u)

	)

168 
	#IEEE80211_TX_UNICAST
 
	`BIT
(1)

	)

169 
	#IEEE80211_TX_PS_BUFFERED
 
	`BIT
(2)

	)

171 
	s›“80211_tx_d©a
 {

172 
sk_buff
 *
	mskb
;

173 
sk_buff_h—d
 
	mskbs
;

174 
›“80211_loÿl
 *
	mloÿl
;

175 
›“80211_sub_if_d©a
 *
	msd©a
;

176 
¡a_šfo
 *
	m¡a
;

177 
›“80211_key
 *
	mkey
;

178 
›“80211_tx_¿‹
 
	m¿‹
;

180 
	mæags
;

192 
	e›“80211_·ck‘_rx_æags
 {

193 
	mIEEE80211_RX_AMSDU
 = 
BIT
(3),

194 
	mIEEE80211_RX_MALFORMED_ACTION_FRM
 = 
BIT
(4),

195 
	mIEEE80211_RX_DEFERRED_RELEASE
 = 
BIT
(5),

208 
	e›“80211_rx_æags
 {

209 
	mIEEE80211_RX_CMNTR
 = 
BIT
(0),

210 
	mIEEE80211_RX_BEACON_REPORTED
 = 
BIT
(1),

213 
	s›“80211_rx_d©a
 {

214 
li¡_h—d
 *
	mli¡
;

215 
sk_buff
 *
	mskb
;

216 
›“80211_loÿl
 *
	mloÿl
;

217 
›“80211_sub_if_d©a
 *
	msd©a
;

218 
›“80211_lšk_d©a
 *
	mlšk
;

219 
¡a_šfo
 *
	m¡a
;

220 
lšk_¡a_šfo
 *
	mlšk_¡a
;

221 
›“80211_key
 *
	mkey
;

223 
	mæags
;

230 
	m£qno_idx
;

238 
	m£cur™y_idx
;

240 
	mlšk_id
;

244 
u32
 
	miv32
;

245 
u16
 
	miv16
;

246 } 
	mtk
;

248 
u8
 
	m²
[
IEEE80211_CCMP_PN_LEN
];

249 } 
	mccm_gcm
;

253 
	s›“80211_c§_£‰šgs
 {

254 cÚ¡ 
u16
 *
	mcouÁ”_off£ts_b—cÚ
;

255 cÚ¡ 
u16
 *
	mcouÁ”_off£ts_´e¥
;

257 
	mn_couÁ”_off£ts_b—cÚ
;

258 
	mn_couÁ”_off£ts_´e¥
;

260 
u8
 
	mcouÁ
;

263 
	s›“80211_cŞÜ_chªge_£‰šgs
 {

264 
u16
 
	mcouÁ”_off£t_b—cÚ
;

265 
u16
 
	mcouÁ”_off£t_´e¥
;

266 
u8
 
	mcouÁ
;

269 
	sb—cÚ_d©a
 {

270 
u8
 *
	mh—d
, *
	m
;

271 
	mh—d_Ën
, 
	m_Ën
;

272 
›“80211_meshcÚf_›
 *
	mmeshcÚf
;

273 
u16
 
	mútdwn_couÁ”_off£ts
[
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
];

274 
u8
 
	mútdwn_cu¼’t_couÁ”
;

275 
cfg80211_mbssid_–ems
 *
	mmbssid_›s
;

276 
cfg80211_ºr_–ems
 *
	mºr_›s
;

277 
rcu_h—d
 
	mrcu_h—d
;

280 
	s´obe_»¥
 {

281 
rcu_h—d
 
	mrcu_h—d
;

282 
	mËn
;

283 
u16
 
	mútdwn_couÁ”_off£ts
[
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
];

284 
u8
 
	md©a
[];

287 
	sfs_discov”y_d©a
 {

288 
rcu_h—d
 
	mrcu_h—d
;

289 
	mËn
;

290 
u8
 
	md©a
[];

293 
	sunsŞ_bÿ¡_´obe_»¥_d©a
 {

294 
rcu_h—d
 
	mrcu_h—d
;

295 
	mËn
;

296 
u8
 
	md©a
[];

299 
	sps_d©a
 {

303 
u8
 
	mtim
[(è* 
BITS_TO_LONGS
(
IEEE80211_MAX_AID
 + 1)]

304 
__®igÃd
(
__®ignof__
());

305 
sk_buff_h—d
 
	mbc_buf
;

306 
©omic_t
 
	mnum_¡a_ps
;

307 
	mdtim_couÁ
;

308 
boŞ
 
	mdtim_bc_mc
;

311 
	s›“80211_if_­
 {

312 
li¡_h—d
 
	mvÏns
;

314 
ps_d©a
 
	mps
;

315 
©omic_t
 
	mnum_mÿ¡_¡a
;

317 
boŞ
 
	mmuÉiÿ¡_to_uniÿ¡
;

318 
boŞ
 
	maùive
;

321 
	s›“80211_if_vÏn
 {

322 
li¡_h—d
 
	mli¡
;

325 
¡a_šfo
 
__rcu
 *
	m¡a
;

326 
©omic_t
 
	mnum_mÿ¡_¡a
;

329 
	smesh_¡©s
 {

330 
__u32
 
	mfwded_mÿ¡
;

331 
__u32
 
	mfwded_uniÿ¡
;

332 
__u32
 
	mfwded_äames
;

333 
__u32
 
	mdrİ³d_äames_‰l
;

334 
__u32
 
	mdrİ³d_äames_no_rou‹
;

337 
	#PREQ_Q_F_START
 0x1

	)

338 
	#PREQ_Q_F_REFRESH
 0x2

	)

339 
	smesh_´eq_queue
 {

340 
li¡_h—d
 
	mli¡
;

341 
u8
 
	md¡
[
ETH_ALEN
];

342 
u8
 
	mæags
;

345 
	s›“80211_roc_wÜk
 {

346 
li¡_h—d
 
	mli¡
;

348 
›“80211_sub_if_d©a
 *
	msd©a
;

350 
›“80211_chªÃl
 *
	mchª
;

352 
boŞ
 
	m¡¬‹d
, 
	mabÜt
, 
	mhw_begun
, 
	mnÙif›d
;

353 
boŞ
 
	mÚ_chªÃl
;

355 
	m¡¬t_time
;

357 
u32
 
	mdu¿tiÚ
, 
	m»q_du¿tiÚ
;

358 
sk_buff
 *
	mäame
;

359 
u64
 
	mcook›
, 
	mmgmt_tx_cook›
;

360 
›“80211_roc_ty³
 
	mty³
;

364 
	e›“80211_¡a_æags
 {

365 
	mIEEE80211_STA_CONNECTION_POLL
 = 
BIT
(1),

366 
	mIEEE80211_STA_CONTROL_PORT
 = 
BIT
(2),

367 
	mIEEE80211_STA_MFP_ENABLED
 = 
BIT
(6),

368 
	mIEEE80211_STA_UAPSD_ENABLED
 = 
BIT
(7),

369 
	mIEEE80211_STA_NULLFUNC_ACKED
 = 
BIT
(8),

370 
	mIEEE80211_STA_ENABLE_RRM
 = 
BIT
(15),

373 
	e›“80211_cÚn_mode
 {

374 
	mIEEE80211_CONN_MODE_S1G
,

375 
	mIEEE80211_CONN_MODE_LEGACY
,

376 
	mIEEE80211_CONN_MODE_HT
,

377 
	mIEEE80211_CONN_MODE_VHT
,

378 
	mIEEE80211_CONN_MODE_HE
,

379 
	mIEEE80211_CONN_MODE_EHT
,

382 
	#IEEE80211_CONN_MODE_HIGHEST
 
IEEE80211_CONN_MODE_EHT


	)

384 
	e›“80211_cÚn_bw_lim™
 {

385 
	mIEEE80211_CONN_BW_LIMIT_20
,

386 
	mIEEE80211_CONN_BW_LIMIT_40
,

387 
	mIEEE80211_CONN_BW_LIMIT_80
,

388 
	mIEEE80211_CONN_BW_LIMIT_160
,

389 
	mIEEE80211_CONN_BW_LIMIT_320
,

392 
	s›“80211_cÚn_£‰šgs
 {

393 
›“80211_cÚn_mode
 
	mmode
;

394 
›“80211_cÚn_bw_lim™
 
	mbw_lim™
;

397 cÚ¡ 
›“80211_cÚn_£‰šgs
 
›“80211_cÚn_£‰šgs_uÆim™ed
;

399 
	s›“80211_mgd_auth_d©a
 {

400 
cfg80211_bss
 *
	mbss
;

401 
	mtimeout
;

402 
	mŒ›s
;

403 
u16
 
	m®gÜ™hm
, 
	mex³ùed_Œª§ùiÚ
;

405 
u8
 
	mkey
[
WLAN_KEY_LEN_WEP104
];

406 
u8
 
	mkey_Ën
, 
	mkey_idx
;

407 
boŞ
 
	mdÚe
, 
	mwa™šg
;

408 
boŞ
 
	m³”_cÚfœmed
;

409 
boŞ
 
	mtimeout_¡¬‹d
;

410 
	mlšk_id
;

412 
u8
 
	m­_addr
[
ETH_ALEN
] 
__®igÃd
(2);

414 
u16
 
	m§e_Œªs
, 
	m§e_¡©us
;

415 
size_t
 
	md©a_Ën
;

416 
u8
 
	md©a
[];

419 
	s›“80211_mgd_assoc_d©a
 {

421 
cfg80211_bss
 *
	mbss
;

423 
u8
 
	maddr
[
ETH_ALEN
] 
__®igÃd
(2);

425 
u8
 
	m­_ht_·¿m
;

427 
›“80211_vht_ÿp
 
	m­_vht_ÿp
;

429 
size_t
 
	m–ems_Ën
;

430 
u8
 *
	m–ems
;

432 
›“80211_cÚn_£‰šgs
 
	mcÚn
;

434 
u16
 
	m¡©us
;

436 
boŞ
 
	mdi§bËd
;

437 } 
	mlšk
[
IEEE80211_MLD_MAX_NUM_LINKS
];

439 
u8
 
	m­_addr
[
ETH_ALEN
] 
__®igÃd
(2);

442 cÚ¡ 
u8
 *
	msuµ_¿‹s
;

443 
u8
 
	msuµ_¿‹s_Ën
;

445 
	mtimeout
;

446 
	mŒ›s
;

448 
u8
 
	m´ev_­_addr
[
ETH_ALEN
];

449 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

450 
u8
 
	mssid_Ën
;

451 
boŞ
 
	mwmm
, 
	mu­sd
;

452 
boŞ
 
	mÃed_b—cÚ
;

453 
boŞ
 
	msynûd
;

454 
boŞ
 
	mtimeout_¡¬‹d
;

455 
boŞ
 
	mcomeback
;

456 
boŞ
 
	ms1g
;

457 
boŞ
 
	m¥p_amsdu
;

459 
	massoc_lšk_id
;

461 
u8
 
	mfs_nÚûs
[2 * 
FILS_NONCE_LEN
];

462 
u8
 
	mfs_kek
[
FILS_MAX_KEK_LEN
];

463 
size_t
 
	mfs_kek_Ën
;

465 
size_t
 
	m›_Ën
;

466 
u8
 *
	m›_pos
;

467 
u8
 
	m›
[];

470 
	s›“80211_¡a_tx_t¥ec
 {

472 
	mtime_¦iû_¡¬t
;

474 
u32
 
	madm™‹d_time
;

475 
u8
 
	mtsid
;

476 
s8
 
	mup
;

479 
u32
 
	mcÚsumed_tx_time
;

481 
	mTX_TSPEC_ACTION_NONE
 = 0,

482 
	mTX_TSPEC_ACTION_DOWNGRADE
,

483 
	mTX_TSPEC_ACTION_STOP_DOWNGRADE
,

484 } 
	maùiÚ
;

485 
boŞ
 
	mdowng¿ded
;

489 
	s›“80211_adv_‰lm_šfo
 {

493 
u16
 
	msw™ch_time
;

494 
u32
 
	mdu¿tiÚ
;

495 
u16
 
	mm­
;

496 
boŞ
 
	maùive
;

499 
	$DECLARE_EWMA
(
b—cÚ_sigÇl
, 4, 4)

501 
	s›“80211_if_mªaged
 {

502 
tim”_li¡
 
tim”
;

503 
tim”_li¡
 
cÚn_mÚ_tim”
;

504 
tim”_li¡
 
bú_mÚ_tim”
;

505 
why_wÜk
 
mÚ™Ü_wÜk
;

506 
why_wÜk
 
b—cÚ_cÚÃùiÚ_loss_wÜk
;

507 
why_wÜk
 
c§_cÚÃùiÚ_drİ_wÜk
;

509 
b—cÚ_timeout
;

510 
´obe_timeout
;

511 
´obe_£nd_couÁ
;

512 
boŞ
 
nuÎfunc_çed
;

513 
u8
 
cÚÃùiÚ_loss
:1,

514 
driv”_discÚÃù
:1,

515 
»cÚÃù
:1,

516 
assocŸ‹d
:1;

518 
›“80211_mgd_auth_d©a
 *
auth_d©a
;

519 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
;

521 
boŞ
 
pow”§ve
;

522 
boŞ
 
brok’_­
;

524 
æags
;

526 
u16
 
mÿ¡_£q_Ï¡
;

528 
boŞ
 
¡©us_acked
;

529 
boŞ
 
¡©us_»ûived
;

530 
__Ë16
 
¡©us_fc
;

533 
IEEE80211_MFP_DISABLED
,

534 
IEEE80211_MFP_OPTIONAL
,

535 
IEEE80211_MFP_REQUIRED


536 } 
må
;

543 
u­sd_queues
;

550 
u­sd_max_¥_Ën
;

552 
u8
 
u£_4addr
;

559 
rssi_mš_thŞd
, 
rssi_max_thŞd
;

561 
›“80211_ht_ÿp
 
ht_ÿ·
;

562 
›“80211_ht_ÿp
 
ht_ÿ·_mask
;

563 
›“80211_vht_ÿp
 
vht_ÿ·
;

564 
›“80211_vht_ÿp
 
vht_ÿ·_mask
;

565 
›“80211_s1g_ÿp
 
s1g_ÿ·
;

566 
›“80211_s1g_ÿp
 
s1g_ÿ·_mask
;

569 
u8
 
tdls_³”
[
ETH_ALEN
] 
	`__®igÃd
(2);

570 
why_d–ayed_wÜk
 
tdls_³”_d–_wÜk
;

571 
sk_buff
 *
Üig_‹¬down_skb
;

572 
sk_buff
 *
‹¬down_skb
;

573 
¥šlock_t
 
‹¬down_lock
;

574 
boŞ
 
tdls_wid”_bw_´ohib™ed
;

577 
›“80211_¡a_tx_t¥ec
 
tx_t¥ec
[
IEEE80211_NUM_ACS
];

584 
why_d–ayed_wÜk
 
tx_t¥ec_wk
;

589 
u8
 *
assoc_»q_›s
;

590 
size_t
 
assoc_»q_›s_Ën
;

592 
why_d–ayed_wÜk
 
ml_»cÚf_wÜk
;

593 
u16
 
»moved_lšks
;

596 
why_d–ayed_wÜk
 
‰lm_wÜk
;

597 
›“80211_adv_‰lm_šfo
 
‰lm_šfo
;

600 
u8
 
dŸlog_tok’_®loc
;

601 
why_d–ayed_wÜk
 
Ãg_‰lm_timeout_wÜk
;

604 
	s›“80211_if_ibss
 {

605 
tim”_li¡
 
tim”
;

606 
why_wÜk
 
c§_cÚÃùiÚ_drİ_wÜk
;

608 
Ï¡_sÿn_com¶‘ed
;

610 
u32
 
basic_¿‹s
;

612 
boŞ
 
fixed_bssid
;

613 
boŞ
 
fixed_chªÃl
;

614 
boŞ
 
´ivacy
;

616 
boŞ
 
cÚŒŞ_pÜt
;

617 
boŞ
 
u£r¥aû_hªdËs_dfs
;

619 
u8
 
bssid
[
ETH_ALEN
] 
	`__®igÃd
(2);

620 
u8
 
ssid
[
IEEE80211_MAX_SSID_LEN
];

621 
u8
 
ssid_Ën
, 
›_Ën
;

622 
u8
 *
›
;

623 
cfg80211_chª_def
 
chªdef
;

625 
ibss_još_»q
;

627 
b—cÚ_d©a
 
__rcu
 *
´e¥
;

629 
›“80211_ht_ÿp
 
ht_ÿ·
;

630 
›“80211_ht_ÿp
 
ht_ÿ·_mask
;

632 
¥šlock_t
 
šcom¶‘e_lock
;

633 
li¡_h—d
 
šcom¶‘e_¡©iÚs
;

636 
IEEE80211_IBSS_MLME_SEARCH
,

637 
IEEE80211_IBSS_MLME_JOINED
,

638 } 
¡©e
;

650 
	s›“80211_if_ocb
 {

651 
tim”_li¡
 
hou£k“pšg_tim”
;

652 
wrkq_æags
;

654 
¥šlock_t
 
šcom¶‘e_lock
;

655 
li¡_h—d
 
šcom¶‘e_¡©iÚs
;

657 
boŞ
 
jošed
;

669 
	s›“80211_mesh_sync_İs
 {

670 (*
rx_bú_´e¥
)(
›“80211_sub_if_d©a
 *
sd©a
, 
u16
 
¡y³
,

671 
›“80211_mgmt
 *
mgmt
, 
Ën
,

672 cÚ¡ 
›“80211_meshcÚf_›
 *
mesh_cfg
,

673 
›“80211_rx_¡©us
 *
rx_¡©us
);

676 (*
adju¡_tsf
)(
›“80211_sub_if_d©a
 *
sd©a
,

677 
b—cÚ_d©a
 *
b—cÚ
);

681 
	smesh_c§_£‰šgs
 {

682 
rcu_h—d
„cu_head;

683 
cfg80211_c§_£‰šgs
 
£‰šgs
;

697 
	smesh_bË
 {

698 
hli¡_h—d
 
known_g©es
;

699 
¥šlock_t
 
g©es_lock
;

700 
rhashbË
 
rh—d
;

701 
hli¡_h—d
 
w®k_h—d
;

702 
¥šlock_t
 
w®k_lock
;

703 
©omic_t
 
’Œ›s
;

713 
	smesh_tx_ÿche
 {

714 
rhashbË
 
rht
;

715 
hli¡_h—d
 
w®k_h—d
;

716 
¥šlock_t
 
w®k_lock
;

719 
	s›“80211_if_mesh
 {

720 
tim”_li¡
 
hou£k“pšg_tim”
;

721 
tim”_li¡
 
mesh_·th_tim”
;

722 
tim”_li¡
 
mesh_·th_roÙ_tim”
;

724 
wrkq_æags
;

725 
mbss_chªged
[64 / 
BITS_PER_LONG
];

727 
boŞ
 
u£r¥aû_hªdËs_dfs
;

729 
u8
 
mesh_id
[
IEEE80211_MAX_MESH_ID_LEN
];

730 
size_t
 
mesh_id_Ën
;

732 
u8
 
mesh_µ_id
;

734 
u8
 
mesh_pm_id
;

736 
u8
 
mesh_cc_id
;

738 
u8
 
mesh_¥_id
;

740 
u8
 
mesh_auth_id
;

742 
u32
 
¢
;

744 
u32
 
´eq_id
;

745 
©omic_t
 
m·ths
;

747 
Ï¡_¢_upd©e
;

749 
Ãxt_³¼
;

751 
Ï¡_´eq
;

752 
mesh_rmc
 *
rmc
;

753 
¥šlock_t
 
mesh_´eq_queue_lock
;

754 
mesh_´eq_queue
 
´eq_queue
;

755 
´eq_queue_Ën
;

756 
mesh_¡©s
 
msh¡©s
;

757 
mesh_cÚfig
 
mshcfg
;

758 
©omic_t
 
e¡ab_¶šks
;

759 
©omic_t
 
mesh_£qnum
;

760 
boŞ
 
acû±šg_¶šks
;

761 
num_g©es
;

762 
b—cÚ_d©a
 
__rcu
 *
b—cÚ
;

763 cÚ¡ 
u8
 *
›
;

764 
u8
 
›_Ën
;

766 
IEEE80211_MESH_SEC_NONE
 = 0x0,

767 
IEEE80211_MESH_SEC_AUTHED
 = 0x1,

768 
IEEE80211_MESH_SEC_SECURED
 = 0x2,

769 } 
£cur™y
;

770 
boŞ
 
u£r_mpm
;

772 cÚ¡ 
›“80211_mesh_sync_İs
 *
sync_İs
;

773 
s64
 
sync_off£t_şockdriá_max
;

774 
¥šlock_t
 
sync_off£t_lock
;

776 
Æ80211_mesh_pow”_mode
 
nÚ³”_pm
;

777 
ps_³”s_light_¦“p
;

778 
ps_³”s_d“p_¦“p
;

779 
ps_d©a
 
ps
;

781 
mesh_c§_£‰šgs
 
__rcu
 *
c§
;

783 
IEEE80211_MESH_CSA_ROLE_NONE
,

784 
IEEE80211_MESH_CSA_ROLE_INIT
,

785 
IEEE80211_MESH_CSA_ROLE_REPEATER
,

786 } 
c§_rŞe
;

787 
u8
 
chsw_‰l
;

788 
u16
 
´e_v®ue
;

791 
meshcÚf_off£t
;

793 
mesh_bË
 
mesh_·ths
;

794 
mesh_bË
 
mµ_·ths
;

795 
mesh_·ths_g’”©iÚ
;

796 
mµ_·ths_g’”©iÚ
;

797 
mesh_tx_ÿche
 
tx_ÿche
;

800 #ifdeà
CONFIG_MAC80211_MESH


801 
	#IEEE80211_IFSTA_MESH_CTR_INC
(
msh
, 
Çme
) \

802 dØ{ (
msh
)->
msh¡©s
.
Çme
++; 
	}
} 0)

	)

804 
	#IEEE80211_IFSTA_MESH_CTR_INC
(
msh
, 
Çme
) \

805 dØ{ } 0)

	)

820 
	e›“80211_sub_if_d©a_æags
 {

821 
	mIEEE80211_SDATA_ALLMULTI
 = 
BIT
(0),

822 
	mIEEE80211_SDATA_DONT_BRIDGE_PACKETS
 = 
BIT
(3),

823 
	mIEEE80211_SDATA_DISCONNECT_RESUME
 = 
BIT
(4),

824 
	mIEEE80211_SDATA_IN_DRIVER
 = 
BIT
(5),

825 
	mIEEE80211_SDATA_DISCONNECT_HW_RESTART
 = 
BIT
(6),

838 
	e›“80211_sd©a_¡©e_b™s
 {

839 
	mSDATA_STATE_RUNNING
,

840 
	mSDATA_STATE_OFFCHANNEL
,

841 
	mSDATA_STATE_OFFCHANNEL_BEACON_STOPPED
,

853 
	e›“80211_chªùx_mode
 {

854 
	mIEEE80211_CHANCTX_SHARED
,

855 
	mIEEE80211_CHANCTX_EXCLUSIVE


870 
	e›“80211_chªùx_»¶aû_¡©e
 {

871 
	mIEEE80211_CHANCTX_REPLACE_NONE
,

872 
	mIEEE80211_CHANCTX_WILL_BE_REPLACED
,

873 
	mIEEE80211_CHANCTX_REPLACES_OTHER
,

876 
	s›“80211_chªùx
 {

877 
li¡_h—d
 
	mli¡
;

878 
rcu_h—d
 
	mrcu_h—d
;

880 
li¡_h—d
 
	massigÃd_lšks
;

881 
li¡_h—d
 
	m»£rved_lšks
;

883 
›“80211_chªùx_»¶aû_¡©e
 
	m»¶aû_¡©e
;

884 
›“80211_chªùx
 *
	m»¶aû_ùx
;

886 
›“80211_chªùx_mode
 
	mmode
;

887 
boŞ
 
	mdriv”_´e£Á
;

890 
›“80211_chª_»q
 
	m»q
;

892 
›“80211_chªùx_cÚf
 
	mcÚf
;

895 
	smac80211_qos_m­
 {

896 
cfg80211_qos_m­
 
	mqos_m­
;

897 
rcu_h—d
 
	mrcu_h—d
;

900 
	etxq_šfo_æags
 {

901 
	mIEEE80211_TXQ_STOP
,

902 
	mIEEE80211_TXQ_AMPDU
,

903 
	mIEEE80211_TXQ_NO_AMSDU
,

904 
	mIEEE80211_TXQ_DIRTY
,

919 
	stxq_šfo
 {

920 
fq_tš
 
	mtš
;

921 
cod–_v¬s
 
	mdef_cv¬s
;

922 
cod–_¡©s
 
	mc¡©s
;

924 
u16
 
	mscheduË_round
;

925 
li¡_h—d
 
	mscheduË_Üd”
;

927 
sk_buff_h—d
 
	mäags
;

929 
	mæags
;

932 
›“80211_txq
 
	mtxq
;

935 
	s›“80211_if_mÁr
 {

936 
u32
 
	mæags
;

937 
u8
 
	mmu_fŞlow_addr
[
ETH_ALEN
] 
__®igÃd
(2);

939 
li¡_h—d
 
	mli¡
;

949 
	s›“80211_if_Çn
 {

950 
cfg80211_Çn_cÚf
 
	mcÚf
;

953 
¥šlock_t
 
	mfunc_lock
;

954 
idr
 
	mfunùiÚ_š¡_ids
;

957 
	s›“80211_lšk_d©a_mªaged
 {

958 
u8
 
	mbssid
[
ETH_ALEN
] 
__®igÃd
(2);

960 
u8
 
	mdtim_³riod
;

961 
›“80211_smps_mode
 
	m»q_smps
,

962 
	mdriv”_smps_mode
;

964 
›“80211_cÚn_£‰šgs
 
	mcÚn
;

966 
s16
 
	mp2p_nß_šdex
;

968 
boŞ
 
	mtdls_chª_sw™ch_´ohib™ed
;

970 
boŞ
 
	mhave_b—cÚ
;

971 
boŞ
 
	mŒackšg_sigÇl_avg
;

972 
boŞ
 
	mdi§bË_wmm_Œackšg
;

973 
boŞ
 
	mİ”©šg_11g_mode
;

975 
boŞ
 
	mc§_wa™šg_bú
;

976 
boŞ
 
	mc§_ignÜed_§me_chª
;

977 
why_d–ayed_wÜk
 
	mchsw™ch_wÜk
;

979 
why_wÜk
 
	m»que¡_smps_wÜk
;

981 
why_wÜk
 
	m»ÿlc_smps
;

983 
boŞ
 
	mb—cÚ_üc_v®id
;

984 
u32
 
	mb—cÚ_üc
;

985 
ewma_b—cÚ_sigÇl
 
	mave_b—cÚ_sigÇl
;

986 
	mÏ¡_ave_b—cÚ_sigÇl
;

993 
	mcouÁ_b—cÚ_sigÇl
;

996 
	mb—cÚ_loss_couÁ
;

1003 
	mÏ¡_cqm_ev’t_sigÇl
;

1005 
	mwmm_Ï¡_·¿m_£t
;

1006 
	mmu_edÿ_Ï¡_·¿m_£t
;

1008 
u8
 
	mbss_·¿m_ch_út
;

1011 
	s›“80211_lšk_d©a_­
 {

1012 
b—cÚ_d©a
 
__rcu
 *
	mb—cÚ
;

1013 
´obe_»¥
 
__rcu
 *
	m´obe_»¥
;

1014 
fs_discov”y_d©a
 
__rcu
 *
	mfs_discov”y
;

1015 
unsŞ_bÿ¡_´obe_»¥_d©a
 
__rcu
 *
	munsŞ_bÿ¡_´obe_»¥
;

1018 
cfg80211_b—cÚ_d©a
 *
	mÃxt_b—cÚ
;

1021 
	s›“80211_lšk_d©a
 {

1022 
›“80211_sub_if_d©a
 *
	msd©a
;

1023 
	mlšk_id
;

1025 
li¡_h—d
 
	massigÃd_chªùx_li¡
;

1026 
li¡_h—d
 
	m»£rved_chªùx_li¡
;

1029 
›“80211_key
 
__rcu
 *
	mgtk
[
NUM_DEFAULT_KEYS
 +

1030 
NUM_DEFAULT_MGMT_KEYS
 +

1031 
NUM_DEFAULT_BEACON_KEYS
];

1032 
›“80211_key
 
__rcu
 *
	mdeçuÉ_muÉiÿ¡_key
;

1033 
›“80211_key
 
__rcu
 *
	mdeçuÉ_mgmt_key
;

1034 
›“80211_key
 
__rcu
 *
	mdeçuÉ_b—cÚ_key
;

1036 
why_wÜk
 
	mc§_fš®ize_wÜk
;

1038 
boŞ
 
	mİ”©šg_11g_mode
;

1040 
›“80211_chª_»q
 
	mc§_chª»q
;

1042 
why_wÜk
 
	mcŞÜ_chªge_fš®ize_wÜk
;

1043 
d–ayed_wÜk
 
	mcŞÜ_cŞlisiÚ_d‘eù_wÜk
;

1044 
u64
 
	mcŞÜ_b™m­
;

1047 
›“80211_chªùx
 *
	m»£rved_chªùx
;

1048 
›“80211_chª_»q
 
	m»£rved
;

1049 
boŞ
 
	m»£rved_¿d¬_»quœed
;

1050 
boŞ
 
	m»£rved_»ady
;

1052 
u8
 
	mÃeded_rx_chašs
;

1053 
›“80211_smps_mode
 
	msmps_mode
;

1055 
	mu£r_pow”_Ëv–
;

1056 
	m­_pow”_Ëv–
;

1058 
boŞ
 
	m¿d¬_»quœed
;

1059 
why_d–ayed_wÜk
 
	mdfs_ÿc_tim”_wÜk
;

1062 
›“80211_lšk_d©a_mªaged
 
	mmgd
;

1063 
›“80211_lšk_d©a_­
 
	m­
;

1064 } 
	mu
;

1066 
›“80211_tx_queue_·¿ms
 
	mtx_cÚf
[
IEEE80211_NUM_ACS
];

1068 
›“80211_bss_cÚf
 *
	mcÚf
;

1070 #ifdeà
CONFIG_MAC80211_DEBUGFS


1071 
d’Œy
 *
	mdebugfs_dœ
;

1075 
	s›“80211_sub_if_d©a
 {

1076 
li¡_h—d
 
	mli¡
;

1078 
wœ–ess_dev
 
	mwdev
;

1081 
li¡_h—d
 
	mkey_li¡
;

1084 
	müy±o_tx_room_Ãeded_út
;

1085 
	müy±o_tx_room_³ndšg_dec
;

1086 
why_d–ayed_wÜk
 
	mdec_room_Ãeded_wk
;

1088 
Ãt_deviû
 *
	mdev
;

1089 
›“80211_loÿl
 *
	mloÿl
;

1091 
	mæags
;

1093 
	m¡©e
;

1095 
boŞ
 
	mc§_blocked_tx
;

1097 
	mÇme
[
IFNAMSIZ
];

1099 
›“80211_äagm’t_ÿche
 
	mäags
;

1102 
u16
 
	mnßck_m­
;

1105 
u8
 
	mwmm_acm
;

1107 
›“80211_key
 
__rcu
 *
	mkeys
[
NUM_DEFAULT_KEYS
];

1108 
›“80211_key
 
__rcu
 *
	mdeçuÉ_uniÿ¡_key
;

1110 
u16
 
	m£qu’û_numb”
;

1111 
u16
 
	mmld_mÿ¡_£q
;

1112 
__be16
 
	mcÚŒŞ_pÜt_´ÙocŞ
;

1113 
boŞ
 
	mcÚŒŞ_pÜt_no_’üy±
;

1114 
boŞ
 
	mcÚŒŞ_pÜt_no_´—uth
;

1115 
boŞ
 
	mcÚŒŞ_pÜt_ov”_Æ80211
;

1117 
©omic_t
 
	mnum_tx_queued
;

1118 
mac80211_qos_m­
 
__rcu
 *
	mqos_m­
;

1120 
why_wÜk
 
	mwÜk
;

1121 
sk_buff_h—d
 
	mskb_queue
;

1122 
sk_buff_h—d
 
	m¡©us_queue
;

1129 
›“80211_if_­
 *
	mbss
;

1132 
u32
 
	mrc_¿‹idx_mask
[
NUM_NL80211_BANDS
];

1134 
boŞ
 
	mrc_has_mcs_mask
[
NUM_NL80211_BANDS
];

1135 
u8
 
	mrc_¿‹idx_mcs_mask
[
NUM_NL80211_BANDS
][
IEEE80211_HT_MCS_MASK_LEN
];

1137 
boŞ
 
	mrc_has_vht_mcs_mask
[
NUM_NL80211_BANDS
];

1138 
u16
 
	mrc_¿‹idx_vht_mcs_mask
[
NUM_NL80211_BANDS
][
NL80211_VHT_NSS_MAX
];

1141 
u32
 
	mb—cÚ_¿‹idx_mask
[
NUM_NL80211_BANDS
];

1142 
boŞ
 
	mb—cÚ_¿‹_£t
;

1145 
›“80211_if_­
 
	m­
;

1146 
›“80211_if_vÏn
 
	mvÏn
;

1147 
›“80211_if_mªaged
 
	mmgd
;

1148 
›“80211_if_ibss
 
	mibss
;

1149 
›“80211_if_mesh
 
	mmesh
;

1150 
›“80211_if_ocb
 
	mocb
;

1151 
›“80211_if_mÁr
 
	mmÁr
;

1152 
›“80211_if_Çn
 
	mÇn
;

1153 } 
	mu
;

1155 
›“80211_lšk_d©a
 
	mdeæšk
;

1156 
›“80211_lšk_d©a
 
__rcu
 *
	mlšk
[
IEEE80211_MLD_MAX_NUM_LINKS
];

1159 
why_wÜk
 
	maùiv©e_lšks_wÜk
;

1160 
u16
 
	mdesœed_aùive_lšks
;

1162 #ifdeà
CONFIG_MAC80211_DEBUGFS


1164 
d’Œy
 *
	msubdœ_¡©iÚs
;

1165 
d’Œy
 *
	mdeçuÉ_uniÿ¡_key
;

1166 
d’Œy
 *
	mdeçuÉ_muÉiÿ¡_key
;

1167 
d’Œy
 *
	mdeçuÉ_mgmt_key
;

1168 
d’Œy
 *
	mdeçuÉ_b—cÚ_key
;

1169 } 
	mdebugfs
;

1173 
›“80211_vif
 
	mvif
;

1176 
šlše


1177 
›“80211_sub_if_d©a
 *
	$vif_to_sd©a
(
›“80211_vif
 *
p
)

1179  
	`cÚš”_of
(
p
, 
›“80211_sub_if_d©a
, 
vif
);

1180 
	}
}

1182 
	#sd©a_d”eã»nû
(
p
, 
sd©a
) \

1183 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
, 
p
)

	)

1185 
	#fÜ_—ch_sd©a_lšk
(
_loÿl
, 
_lšk
) \

1187 
›“80211_sub_if_d©a
 *
___sd©a
 = 
NULL
; \

1188 !
___sd©a
; \

1189 
___sd©a
 = (*)~0 ) \

1190 
	`li¡_fÜ_—ch_’Œy
(
___sd©a
, &(
_loÿl
)->
š‹rçûs
, 
li¡
) \

1191 ià(
	`›“80211_sd©a_ruÂšg
(
___sd©a
)) \

1192 
___lšk_id
 = 0; \

1193 
___lšk_id
 < 
	`ARRAY_SIZE
(
___sd©a
->
lšk
); \

1194 
___lšk_id
++) \

1195 ià((
_lšk
 = 
	`why_d”eã»nû
((
loÿl
)->
hw
.
why
, \

1196 
___sd©a
->
lšk
[
___lšk_id
])))

	)

1198 
šlše
 

1199 
	$›“80211_g‘_mbssid_b—cÚ_Ën
(
cfg80211_mbssid_–ems
 *
–ems
,

1200 
cfg80211_ºr_–ems
 *
ºr_–ems
,

1201 
u8
 
i
)

1203 
Ën
 = 0;

1205 ià(!
–ems
 || !–ems->
út
 || 
i
 >ƒlems->cnt)

1208 ià(
i
 < 
–ems
->
út
) {

1209 
Ën
 = 
–ems
->
–em
[
i
].len;

1210 ià(
ºr_–ems
) {

1211 
Ën
 +ğ
ºr_–ems
->
–em
[
i
].len;

1212 
i
 = 
–ems
->
út
; i < 
ºr_–ems
->cnt; i++)

1213 
Ën
 +ğ
ºr_–ems
->
–em
[
i
].len;

1215  
Ën
;

1219 
i
 = 0; i < 
–ems
->
út
; i++)

1220 
Ën
 +ğ
–ems
->
–em
[
i
].len;

1222 ià(
ºr_–ems
) {

1223 
i
 = 0; i < 
ºr_–ems
->
út
; i++)

1224 
Ën
 +ğ
ºr_–ems
->
–em
[
i
].len;

1227  
Ën
;

1228 
	}
}

1231 
	mIEEE80211_RX_MSG
 = 1,

1232 
	mIEEE80211_TX_STATUS_MSG
 = 2,

1235 
	equeue_¡İ_»asÚ
 {

1236 
	mIEEE80211_QUEUE_STOP_REASON_DRIVER
,

1237 
	mIEEE80211_QUEUE_STOP_REASON_PS
,

1238 
	mIEEE80211_QUEUE_STOP_REASON_CSA
,

1239 
	mIEEE80211_QUEUE_STOP_REASON_AGGREGATION
,

1240 
	mIEEE80211_QUEUE_STOP_REASON_SUSPEND
,

1241 
	mIEEE80211_QUEUE_STOP_REASON_SKB_ADD
,

1242 
	mIEEE80211_QUEUE_STOP_REASON_OFFCHANNEL
,

1243 
	mIEEE80211_QUEUE_STOP_REASON_FLUSH
,

1244 
	mIEEE80211_QUEUE_STOP_REASON_TDLS_TEARDOWN
,

1245 
	mIEEE80211_QUEUE_STOP_REASON_RESERVE_TID
,

1246 
	mIEEE80211_QUEUE_STOP_REASON_IFTYPE_CHANGE
,

1248 
	mIEEE80211_QUEUE_STOP_REASONS
,

1251 #ifdeà
CONFIG_MAC80211_LEDS


1252 
	st_Ëd_Œigg”
 {

1253 
	mÇme
[32];

1254 cÚ¡ 
›“80211_t_blšk
 *
	mblšk_bË
;

1255 
	mblšk_bË_Ën
;

1256 
tim”_li¡
 
	mtim”
;

1257 
›“80211_loÿl
 *
	mloÿl
;

1258 
	m´ev_Œaffic
;

1259 
	mtx_by‹s
, 
	mrx_by‹s
;

1260 
	maùive
, 
	mwªt
;

1261 
boŞ
 
	mruÂšg
;

1284 
	emac80211_sÿn_æags
 {

1285 
	mSCAN_SW_SCANNING
,

1286 
	mSCAN_HW_SCANNING
,

1287 
	mSCAN_ONCHANNEL_SCANNING
,

1288 
	mSCAN_COMPLETED
,

1289 
	mSCAN_ABORTED
,

1290 
	mSCAN_HW_CANCELLED
,

1291 
	mSCAN_BEACON_WAIT
,

1292 
	mSCAN_BEACON_DONE
,

1308 
	emac80211_sÿn_¡©e
 {

1309 
	mSCAN_DECISION
,

1310 
	mSCAN_SET_CHANNEL
,

1311 
	mSCAN_SEND_PROBE
,

1312 
	mSCAN_SUSPEND
,

1313 
	mSCAN_RESUME
,

1314 
	mSCAN_ABORT
,

1317 
DECLARE_STATIC_KEY_FALSE
(
aql_di§bË
);

1319 
	s›“80211_loÿl
 {

1323 
›“80211_hw
 
	mhw
;

1325 
fq
 
	mfq
;

1326 
cod–_v¬s
 *
	mcv¬s
;

1327 
cod–_·¿ms
 
	mı¬ams
;

1330 
¥šlock_t
 
	maùive_txq_lock
[
IEEE80211_NUM_ACS
];

1331 
li¡_h—d
 
	maùive_txqs
[
IEEE80211_NUM_ACS
];

1332 
u16
 
	mscheduË_round
[
IEEE80211_NUM_ACS
];

1335 
¥šlock_t
 
	mhªdË_wake_tx_queue_lock
;

1337 
u16
 
	maœtime_æags
;

1338 
u32
 
	maql_txq_lim™_low
[
IEEE80211_NUM_ACS
];

1339 
u32
 
	maql_txq_lim™_high
[
IEEE80211_NUM_ACS
];

1340 
u32
 
	maql_th»shŞd
;

1341 
©omic_t
 
	maql_tÙ®_³ndšg_aœtime
;

1342 
©omic_t
 
	maql_ac_³ndšg_aœtime
[
IEEE80211_NUM_ACS
];

1344 cÚ¡ 
›“80211_İs
 *
	mİs
;

1350 
wÜkqueue_¡ruù
 *
	mwÜkqueue
;

1352 
	mqueue_¡İ_»asÚs
[
IEEE80211_MAX_QUEUES
];

1353 
	mq_¡İ_»asÚs
[
IEEE80211_MAX_QUEUES
][
IEEE80211_QUEUE_STOP_REASONS
];

1355 
¥šlock_t
 
	mqueue_¡İ_»asÚ_lock
;

1357 
	mİ’_couÁ
;

1358 
	mmÚ™Üs
, 
	mcooked_mÁrs
;

1360 
	mfif_fcsç
, 
	mfif_¶ıç
, 
	mfif_cÚŒŞ
, 
	mfif_Ùh”_bss
, 
	mfif_p¥Şl
,

1361 
	mfif_´obe_»q
;

1362 
boŞ
 
	m´obe_»q_»g
;

1363 
boŞ
 
	mrx_mÿ¡_aùiÚ_»g
;

1364 
	mf‹r_æags
;

1366 
boŞ
 
	mwhy_ch”s_®loÿ‹d
;

1368 
cfg80211_chª_def
 
	mdæt_chªdef
;

1369 
boŞ
 
	memuÏ‹_chªùx
;

1372 
¥šlock_t
 
	mf‹r_lock
;

1375 
why_wÜk
 
	m»cÚfig_f‹r
;

1378 
Ãtdev_hw_addr_li¡
 
	mmc_li¡
;

1380 
boŞ
 
	mtim_š_locked_£ùiÚ
;

1388 
boŞ
 
	msu¥’ded
;

1391 
boŞ
 
	msu¥’dšg
;

1399 
boŞ
 
	m»sumšg
;

1405 
boŞ
 
	mqu›scšg
;

1408 
boŞ
 
	m¡¬‹d
;

1411 
boŞ
 
	mš_»cÚfig
;

1414 
boŞ
 
	m»cÚfig_çu»
;

1417 
boŞ
 
	mwowÏn
;

1419 
why_wÜk
 
	m¿d¬_d‘eùed_wÜk
;

1422 
u8
 
	mrx_chašs
;

1425 
u8
 
	msbªd_®loÿ‹d
;

1427 
	mtx_h—droom
;

1433 
	#IEEE80211_IRQSAFE_QUEUE_LIMIT
 128

	)

1434 
skËt_¡ruù
 
	mskËt
;

1435 
sk_buff_h—d
 
	mskb_queue
;

1436 
sk_buff_h—d
 
	mskb_queue_uÄ–ŸbË
;

1438 
¥šlock_t
 
	mrx_·th_lock
;

1445 
¥šlock_t
 
	mtim_lock
;

1446 
	mnum_¡a
;

1447 
li¡_h—d
 
	m¡a_li¡
;

1448 
rhÉabË
 
	m¡a_hash
;

1449 
rhÉabË
 
	mlšk_¡a_hash
;

1450 
tim”_li¡
 
	m¡a_ş—nup
;

1451 
	m¡a_g’”©iÚ
;

1453 
sk_buff_h—d
 
	m³ndšg
[
IEEE80211_MAX_QUEUES
];

1454 
skËt_¡ruù
 
	mtx_³ndšg_skËt
;

1455 
skËt_¡ruù
 
	mwake_txqs_skËt
;

1457 
©omic_t
 
	magg_queue_¡İ
[
IEEE80211_MAX_QUEUES
];

1460 
©omic_t
 
	miff_®lmuÉis
;

1462 
¿‹_cÚŒŞ_»f
 *
	m¿‹_ù¾
;

1464 
¬c4_ùx
 
	mw•_tx_ùx
;

1465 
¬c4_ùx
 
	mw•_rx_ùx
;

1466 
u32
 
	mw•_iv
;

1469 
li¡_h—d
 
	mš‹rçûs
;

1470 
li¡_h—d
 
	mmÚ_li¡
;

1471 
mu‹x
 
	miæi¡_mtx
;

1474 
	msÿÂšg
;

1475 
cfg80211_ssid
 
	msÿn_ssid
;

1476 
cfg80211_sÿn_»que¡
 *
	mšt_sÿn_»q
;

1477 
cfg80211_sÿn_»que¡
 
__rcu
 *
	msÿn_»q
;

1478 
›“80211_sÿn_»que¡
 *
	mhw_sÿn_»q
;

1479 
cfg80211_chª_def
 
	msÿn_chªdef
;

1480 
Æ80211_bªd
 
	mhw_sÿn_bªd
;

1481 
	msÿn_chªÃl_idx
;

1482 
	msÿn_›s_Ën
;

1483 
	mhw_sÿn_›s_bufsize
;

1484 
cfg80211_sÿn_šfo
 
	msÿn_šfo
;

1486 
why_wÜk
 
	msched_sÿn_¡İ³d_wÜk
;

1487 
›“80211_sub_if_d©a
 
__rcu
 *
	msched_sÿn_sd©a
;

1488 
cfg80211_sched_sÿn_»que¡
 
__rcu
 *
	msched_sÿn_»q
;

1489 
u8
 
	msÿn_addr
[
ETH_ALEN
];

1491 
	mËave_İ”_chªÃl_time
;

1492 
mac80211_sÿn_¡©e
 
	mÃxt_sÿn_¡©e
;

1493 
why_d–ayed_wÜk
 
	msÿn_wÜk
;

1494 
›“80211_sub_if_d©a
 
__rcu
 *
	msÿn_sd©a
;

1497 
›“80211_chªÃl
 *
	mtmp_chªÃl
;

1500 
li¡_h—d
 
	mchªùx_li¡
;

1502 #ifdeà
CONFIG_MAC80211_LEDS


1503 
Ëd_Œigg”
 
	mtx_Ëd
, 
	mrx_Ëd
, 
	massoc_Ëd
, 
	m¿dio_Ëd
;

1504 
Ëd_Œigg”
 
	mt_Ëd
;

1505 
©omic_t
 
	mtx_Ëd_aùive
, 
	mrx_Ëd_aùive
, 
	massoc_Ëd_aùive
;

1506 
©omic_t
 
	m¿dio_Ëd_aùive
, 
	mt_Ëd_aùive
;

1507 
t_Ëd_Œigg”
 *
	mt_Ëd_Œigg”
;

1510 #ifdeà
CONFIG_MAC80211_DEBUG_COUNTERS


1513 
u32
 
	mdÙ11T¿nsm™‹dF¿gm’tCouÁ
;

1514 
u32
 
	mdÙ11MuÉiÿ¡T¿nsm™‹dF¿meCouÁ
;

1515 
u32
 
	mdÙ11FaedCouÁ
;

1516 
u32
 
	mdÙ11R‘ryCouÁ
;

1517 
u32
 
	mdÙ11MuÉËR‘ryCouÁ
;

1518 
u32
 
	mdÙ11F¿meDu¶iÿ‹CouÁ
;

1519 
u32
 
	mdÙ11ReûivedF¿gm’tCouÁ
;

1520 
u32
 
	mdÙ11MuÉiÿ¡ReûivedF¿meCouÁ
;

1521 
u32
 
	mdÙ11T¿nsm™‹dF¿meCouÁ
;

1524 
	mtx_hªdËrs_drİ
;

1525 
	mtx_hªdËrs_queued
;

1526 
	mtx_hªdËrs_drİ_w•
;

1527 
	mtx_hªdËrs_drİ_nÙ_assoc
;

1528 
	mtx_hªdËrs_drİ_uÇuth_pÜt
;

1529 
	mrx_hªdËrs_drİ
;

1530 
	mrx_hªdËrs_queued
;

1531 
	mrx_hªdËrs_drİ_nuÎfunc
;

1532 
	mrx_hªdËrs_drİ_deäag
;

1533 
	mtx_ex·nd_skb_h—d
;

1534 
	mtx_ex·nd_skb_h—d_şÚed
;

1535 
	mrx_ex·nd_skb_h—d_deäag
;

1536 
	mrx_hªdËrs_äagm’ts
;

1537 
	mtx_¡©us_drİ
;

1538 
	#I802_DEBUG_INC
(
c
è(c)++

	)

1540 
	#I802_DEBUG_INC
(
c
èdØ{ } 0)

	)

1544 
	mtÙ®_ps_bufã»d
;

1548 
boŞ
 
	mp¥Şlšg
;

1553 
›“80211_sub_if_d©a
 *
	mps_sd©a
;

1554 
why_wÜk
 
	mdyÇmic_ps_’abË_wÜk
;

1555 
why_wÜk
 
	mdyÇmic_ps_di§bË_wÜk
;

1556 
tim”_li¡
 
	mdyÇmic_ps_tim”
;

1557 
nÙif›r_block
 
	miç_nÙif›r
;

1558 
nÙif›r_block
 
	miç6_nÙif›r
;

1564 
	mdyÇmic_ps_fÜûd_timeout
;

1566 
	mu£r_pow”_Ëv–
;

1568 
wÜk_¡ruù
 
	m»¡¬t_wÜk
;

1570 #ifdeà
CONFIG_MAC80211_DEBUGFS


1571 
	sloÿl_debugfsd’Œ›s
 {

1572 
d’Œy
 *
	mrcdœ
;

1573 
d’Œy
 *
	mkeys
;

1574 } 
	mdebugfs
;

1575 
boŞ
 
	mfÜû_tx_¡©us
;

1581 
why_d–ayed_wÜk
 
	mroc_wÜk
;

1582 
li¡_h—d
 
	mroc_li¡
;

1583 
why_wÜk
 
	mhw_roc_¡¬t
, 
	mhw_roc_dÚe
;

1584 
	mhw_roc_¡¬t_time
;

1585 
u64
 
	mroc_cook›_couÁ”
;

1587 
idr
 
	mack_¡©us_äames
;

1588 
¥šlock_t
 
	mack_¡©us_lock
;

1590 
›“80211_sub_if_d©a
 
__rcu
 *
	mp2p_sd©a
;

1593 
›“80211_sub_if_d©a
 
__rcu
 *
	mmÚ™Ü_sd©a
;

1594 
›“80211_chª_»q
 
	mmÚ™Ü_chª»q
;

1597 
u8
 
	mext_ÿ·
[8];

1599 
boŞ
 
	mwbrf_suµÜ‹d
;

1602 
šlše
 
›“80211_sub_if_d©a
 *

1603 
	$IEEE80211_DEV_TO_SUB_IF
(cÚ¡ 
Ãt_deviû
 *
dev
)

1605  
	`Ãtdev_´iv
(
dev
);

1606 
	}
}

1608 
šlše
 
›“80211_sub_if_d©a
 *

1609 
	$IEEE80211_WDEV_TO_SUB_IF
(
wœ–ess_dev
 *
wdev
)

1611  
	`cÚš”_of
(
wdev
, 
›“80211_sub_if_d©a
, wdev);

1612 
	}
}

1614 
šlše
 
›“80211_suµÜ‹d_bªd
 *

1615 
	$›“80211_g‘_sbªd
(
›“80211_sub_if_d©a
 *
sd©a
)

1617 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1618 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

1619 
Æ80211_bªd
 
bªd
;

1621 
	`WARN_ON
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
));

1623 
	`rcu_»ad_lock
();

1624 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

1626 ià(!
chªùx_cÚf
) {

1627 
	`rcu_»ad_uÆock
();

1628  
NULL
;

1631 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

1632 
	`rcu_»ad_uÆock
();

1634  
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1635 
	}
}

1637 
šlše
 
›“80211_suµÜ‹d_bªd
 *

1638 
	$›“80211_g‘_lšk_sbªd
(
›“80211_lšk_d©a
 *
lšk
)

1640 
›“80211_loÿl
 *
loÿl
 = 
lšk
->
sd©a
->local;

1641 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

1642 
Æ80211_bªd
 
bªd
;

1644 
	`rcu_»ad_lock
();

1645 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
lšk
->
cÚf
->chanctx_conf);

1646 ià(!
chªùx_cÚf
) {

1647 
	`rcu_»ad_uÆock
();

1648  
NULL
;

1651 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

1652 
	`rcu_»ad_uÆock
();

1654  
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1655 
	}
}

1658 
	s›“80211_c§_›
 {

1659 
›“80211_chª_»q
 
	mchª»q
;

1660 
u8
 
	mmode
;

1661 
u8
 
	mcouÁ
;

1662 
u8
 
	m‰l
;

1663 
u16
 
	m´e_v®ue
;

1664 
u16
 
	m»asÚ_code
;

1665 
u32
 
	mmax_sw™ch_time
;

1668 
	e›“80211_–ems_·r£_”rÜ
 {

1669 
	mIEEE80211_PARSE_ERR_INVALID_END
 = 
BIT
(0),

1670 
	mIEEE80211_PARSE_ERR_DUP_ELEM
 = 
BIT
(1),

1671 
	mIEEE80211_PARSE_ERR_BAD_ELEM_SIZE
 = 
BIT
(2),

1672 
	mIEEE80211_PARSE_ERR_UNEXPECTED_ELEM
 = 
BIT
(3),

1673 
	mIEEE80211_PARSE_ERR_DUP_NEST_ML_BASIC
 = 
BIT
(4),

1677 
	s›“802_11_–ems
 {

1678 cÚ¡ 
u8
 *
	m›_¡¬t
;

1679 
size_t
 
	mtÙ®_Ën
;

1680 
u32
 
	müc
;

1683 cÚ¡ 
›“80211_tdls_Êk›
 *
	mÊk_id
;

1684 cÚ¡ 
›“80211_ch_sw™ch_timšg
 *
	mch_sw_timšg
;

1685 cÚ¡ 
u8
 *
	mext_ÿ·b
;

1686 cÚ¡ 
u8
 *
	mssid
;

1687 cÚ¡ 
u8
 *
	msuµ_¿‹s
;

1688 cÚ¡ 
u8
 *
	mds_·¿ms
;

1689 cÚ¡ 
›“80211_tim_›
 *
	mtim
;

1690 cÚ¡ 
u8
 *
	mr¢
;

1691 cÚ¡ 
u8
 *
	mr¢x
;

1692 cÚ¡ 
u8
 *
	m”p_šfo
;

1693 cÚ¡ 
u8
 *
	mext_suµ_¿‹s
;

1694 cÚ¡ 
u8
 *
	mwmm_šfo
;

1695 cÚ¡ 
u8
 *
	mwmm_·¿m
;

1696 cÚ¡ 
›“80211_ht_ÿp
 *
	mht_ÿp_–em
;

1697 cÚ¡ 
›“80211_ht_İ”©iÚ
 *
	mht_İ”©iÚ
;

1698 cÚ¡ 
›“80211_vht_ÿp
 *
	mvht_ÿp_–em
;

1699 cÚ¡ 
›“80211_vht_İ”©iÚ
 *
	mvht_İ”©iÚ
;

1700 cÚ¡ 
›“80211_meshcÚf_›
 *
	mmesh_cÚfig
;

1701 cÚ¡ 
u8
 *
	mhe_ÿp
;

1702 cÚ¡ 
›“80211_he_İ”©iÚ
 *
	mhe_İ”©iÚ
;

1703 cÚ¡ 
›“80211_he_¥r
 *
	mhe_¥r
;

1704 cÚ¡ 
›“80211_mu_edÿ_·¿m_£t
 *
	mmu_edÿ_·¿m_£t
;

1705 cÚ¡ 
›“80211_he_6ghz_ÿ·
 *
	mhe_6ghz_ÿ·
;

1706 cÚ¡ 
›“80211_tx_pwr_’v
 *
	mtx_pwr_’v
[
IEEE80211_TPE_MAX_IE_COUNT
];

1707 cÚ¡ 
u8
 *
	muÜa_–em’t
;

1708 cÚ¡ 
u8
 *
	mmesh_id
;

1709 cÚ¡ 
u8
 *
	m³”šg
;

1710 cÚ¡ 
__Ë16
 *
	mawake_wšdow
;

1711 cÚ¡ 
u8
 *
	m´eq
;

1712 cÚ¡ 
u8
 *
	m´•
;

1713 cÚ¡ 
u8
 *
	m³¼
;

1714 cÚ¡ 
›“80211_¿Â_›
 *
	m¿Â
;

1715 cÚ¡ 
›“80211_chªÃl_sw_›
 *
	mch_sw™ch_›
;

1716 cÚ¡ 
›“80211_ext_chªsw_›
 *
	mext_chªsw_›
;

1717 cÚ¡ 
›“80211_wide_bw_chªsw_›
 *
	mwide_bw_chªsw_›
;

1718 cÚ¡ 
u8
 *
	mmax_chªÃl_sw™ch_time
;

1719 cÚ¡ 
u8
 *
	mcouÁry_–em
;

1720 cÚ¡ 
u8
 *
	mpwr_cÚ¡r_–em
;

1721 cÚ¡ 
u8
 *
	mcisco_dc_–em
;

1722 cÚ¡ 
›“80211_timeout_š‹rv®_›
 *
	mtimeout_št
;

1723 cÚ¡ 
u8
 *
	mİmode_nÙif
;

1724 cÚ¡ 
›“80211_£c_chª_offs_›
 *
	m£c_chª_offs
;

1725 
›“80211_mesh_chªsw_·¿ms_›
 *
	mmesh_chªsw_·¿ms_›
;

1726 cÚ¡ 
›“80211_bss_max_idË_³riod_›
 *
	mmax_idË_³riod_›
;

1727 cÚ¡ 
›“80211_muÉË_bssid_cÚfigu¿tiÚ
 *
	mmbssid_cÚfig_›
;

1728 cÚ¡ 
›“80211_bssid_šdex
 *
	mbssid_šdex
;

1729 
u8
 
	mmax_bssid_šdiÿtÜ
;

1730 
u8
 
	mdtim_couÁ
;

1731 
u8
 
	mdtim_³riod
;

1732 cÚ¡ 
›“80211_addba_ext_›
 *
	maddba_ext_›
;

1733 cÚ¡ 
›“80211_s1g_ÿp
 *
	ms1g_ÿ·b
;

1734 cÚ¡ 
›“80211_s1g_İ”_›
 *
	ms1g_İ”
;

1735 cÚ¡ 
›“80211_s1g_bú_com·t_›
 *
	ms1g_bú_com·t
;

1736 cÚ¡ 
›“80211_aid_»¥Ú£_›
 *
	maid_»¥
;

1737 cÚ¡ 
›“80211_eht_ÿp_–em
 *
	meht_ÿp
;

1738 cÚ¡ 
›“80211_eht_İ”©iÚ
 *
	meht_İ”©iÚ
;

1739 cÚ¡ 
›“80211_muÉi_lšk_–em
 *
	mml_basic
;

1740 cÚ¡ 
›“80211_muÉi_lšk_–em
 *
	mml_»cÚf
;

1741 cÚ¡ 
›“80211_bªdwidth_šdiÿtiÚ
 *
	mbªdwidth_šdiÿtiÚ
;

1742 cÚ¡ 
›“80211_‰lm_–em
 *
	m‰lm
[
IEEE80211_TTLM_MAX_CNT
];

1745 
u8
 
	mext_ÿ·b_Ën
;

1746 
u8
 
	mssid_Ën
;

1747 
u8
 
	msuµ_¿‹s_Ën
;

1748 
u8
 
	mtim_Ën
;

1749 
u8
 
	mr¢_Ën
;

1750 
u8
 
	mr¢x_Ën
;

1751 
u8
 
	mext_suµ_¿‹s_Ën
;

1752 
u8
 
	mwmm_šfo_Ën
;

1753 
u8
 
	mwmm_·¿m_Ën
;

1754 
u8
 
	mhe_ÿp_Ën
;

1755 
u8
 
	mmesh_id_Ën
;

1756 
u8
 
	m³”šg_Ën
;

1757 
u8
 
	m´eq_Ën
;

1758 
u8
 
	m´•_Ën
;

1759 
u8
 
	m³¼_Ën
;

1760 
u8
 
	mcouÁry_–em_Ën
;

1761 
u8
 
	mbssid_šdex_Ën
;

1762 
u8
 
	mtx_pwr_’v_Ën
[
IEEE80211_TPE_MAX_IE_COUNT
];

1763 
u8
 
	mtx_pwr_’v_num
;

1764 
u8
 
	meht_ÿp_Ën
;

1767 
size_t
 
	mml_basic_Ën
;

1768 
size_t
 
	mml_»cÚf_Ën
;

1770 
u8
 
	m‰lm_num
;

1777 
›“80211_mË_³r_¡a_´ofe
 *
	m´of
;

1778 
size_t
 
	m¡a_´of_Ën
;

1781 
u8
 
	m·r£_”rÜ
;

1784 
šlše
 
›“80211_loÿl
 *
	$hw_to_loÿl
(

1785 
›“80211_hw
 *
hw
)

1787  
	`cÚš”_of
(
hw
, 
›“80211_loÿl
, hw);

1788 
	}
}

1790 
šlše
 
txq_šfo
 *
	$to_txq_šfo
(
›“80211_txq
 *
txq
)

1792  
	`cÚš”_of
(
txq
, 
txq_šfo
,xq);

1793 
	}
}

1795 
šlše
 
boŞ
 
	$txq_has_queue
(
›“80211_txq
 *
txq
)

1797 
txq_šfo
 *
txqi
 = 
	`to_txq_šfo
(
txq
);

1799  !(
	`skb_queue_em±y
(&
txqi
->
äags
è&& !txqi->
tš
.
backlog_·ck‘s
);

1800 
	}
}

1802 
šlše
 
boŞ


1803 
	$›“80211_have_rx_time¡amp
(
›“80211_rx_¡©us
 *
¡©us
)

1805  
¡©us
->
æag
 & 
RX_FLAG_MACTIME
;

1806 
	}
}

1808 
›“80211_vif_šc_num_mÿ¡
(
›“80211_sub_if_d©a
 *
sd©a
);

1809 
›“80211_vif_dec_num_mÿ¡
(
›“80211_sub_if_d©a
 *
sd©a
);

1815 
šlše
 

1816 
	$›“80211_vif_g‘_num_mÿ¡_if
(
›“80211_sub_if_d©a
 *
sd©a
)

1818 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

1819  
	`©omic_»ad
(&
sd©a
->
u
.
­
.
num_mÿ¡_¡a
);

1820 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 && !sd©a->
u
.
vÏn
.
¡a
)

1821  
	`©omic_»ad
(&
sd©a
->
u
.
vÏn
.
num_mÿ¡_¡a
);

1823 
	}
}

1825 
u64
 
›“80211_ÿlcuÏ‹_rx_time¡amp
(
›“80211_loÿl
 *
loÿl
,

1826 
›“80211_rx_¡©us
 *
¡©us
,

1827 
mpdu_Ën
,

1828 
mpdu_off£t
);

1829 
›“80211_hw_cÚfig
(
›“80211_loÿl
 *
loÿl
, 
u32
 
chªged
);

1830 
›“80211_hw_cÚf_chª
(
›“80211_loÿl
 *
loÿl
);

1831 
›“80211_hw_cÚf_š™
(
›“80211_loÿl
 *
loÿl
);

1832 
›“80211_tx_£t_´Ùeùed
(
›“80211_tx_d©a
 *
tx
);

1833 
›“80211_bss_šfo_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

1834 
u64
 
chªged
);

1835 
›“80211_vif_cfg_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

1836 
u64
 
chªged
);

1837 
›“80211_lšk_šfo_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

1838 
›“80211_lšk_d©a
 *
lšk
,

1839 
u64
 
chªged
);

1840 
›“80211_cÚfigu»_f‹r
(
›“80211_loÿl
 *
loÿl
);

1841 
u64
 
›“80211_»£t_”p_šfo
(
›“80211_sub_if_d©a
 *
sd©a
);

1843 
u64
 
›“80211_mgmt_tx_cook›
(
›“80211_loÿl
 *
loÿl
);

1844 
›“80211_©ch_ack_skb
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
,

1845 
u64
 *
cook›
, 
gå_t
 
gå
);

1847 
›“80211_check_ç¡_rx
(
¡a_šfo
 *
¡a
);

1848 
__›“80211_check_ç¡_rx_içû
(
›“80211_sub_if_d©a
 *
sd©a
);

1849 
›“80211_check_ç¡_rx_içû
(
›“80211_sub_if_d©a
 *
sd©a
);

1850 
›“80211_ş—r_ç¡_rx
(
¡a_šfo
 *
¡a
);

1852 
boŞ
 
›“80211_is_our_addr
(
›“80211_sub_if_d©a
 *
sd©a
,

1853 cÚ¡ 
u8
 *
addr
, *
out_lšk_id
);

1856 
›“80211_¡a_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
);

1857 
›“80211_mgd_auth
(
›“80211_sub_if_d©a
 *
sd©a
,

1858 
cfg80211_auth_»que¡
 *
»q
);

1859 
›“80211_mgd_assoc
(
›“80211_sub_if_d©a
 *
sd©a
,

1860 
cfg80211_assoc_»que¡
 *
»q
);

1861 
›“80211_mgd_d—uth
(
›“80211_sub_if_d©a
 *
sd©a
,

1862 
cfg80211_d—uth_»que¡
 *
»q
);

1863 
›“80211_mgd_di§ssoc
(
›“80211_sub_if_d©a
 *
sd©a
,

1864 
cfg80211_di§ssoc_»que¡
 *
»q
);

1865 
›“80211_£nd_p¥Şl
(
›“80211_loÿl
 *
loÿl
,

1866 
›“80211_sub_if_d©a
 *
sd©a
);

1867 
›“80211_»ÿlc_ps
(
›“80211_loÿl
 *
loÿl
);

1868 
›“80211_»ÿlc_ps_vif
(
›“80211_sub_if_d©a
 *
sd©a
);

1869 
›“80211_¡a_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
);

1870 
›“80211_¡a_rx_queued_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

1871 
sk_buff
 *
skb
);

1872 
›“80211_¡a_rx_queued_ext
(
›“80211_sub_if_d©a
 *
sd©a
,

1873 
sk_buff
 *
skb
);

1874 
›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
›“80211_sub_if_d©a
 *
sd©a
);

1875 
›“80211_¡a_»£t_cÚn_mÚ™Ü
(
›“80211_sub_if_d©a
 *
sd©a
);

1876 
›“80211_mgd_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
);

1877 
›“80211_mgd_cÚn_tx_¡©us
(
›“80211_sub_if_d©a
 *
sd©a
,

1878 
__Ë16
 
fc
, 
boŞ
 
acked
);

1879 
›“80211_mgd_qu›sû
(
›“80211_sub_if_d©a
 *
sd©a
);

1880 
›“80211_¡a_»¡¬t
(
›“80211_sub_if_d©a
 *
sd©a
);

1881 
›“80211_¡a_hªdË_t¥ec_ac_·¿ms
(
›“80211_sub_if_d©a
 *
sd©a
);

1882 
›“80211_¡a_cÚÃùiÚ_lo¡
(
›“80211_sub_if_d©a
 *
sd©a
,

1883 
u8
 
»asÚ
, 
boŞ
 
tx
);

1884 
›“80211_mgd_£tup_lšk
(
›“80211_lšk_d©a
 *
lšk
);

1885 
›“80211_mgd_¡İ_lšk
(
›“80211_lšk_d©a
 *
lšk
);

1886 
›“80211_mgd_£t_lšk_qos_·¿ms
(
›“80211_lšk_d©a
 *
lšk
);

1889 
›“80211_ibss_nÙify_sÿn_com¶‘ed
(
›“80211_loÿl
 *
loÿl
);

1890 
›“80211_ibss_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
);

1891 
›“80211_ibss_rx_no_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

1892 cÚ¡ 
u8
 *
bssid
, cÚ¡ u8 *
addr
, 
u32
 
suµ_¿‹s
);

1893 
›“80211_ibss_još
(
›“80211_sub_if_d©a
 *
sd©a
,

1894 
cfg80211_ibss_·¿ms
 *
·¿ms
);

1895 
›“80211_ibss_Ëave
(
›“80211_sub_if_d©a
 *
sd©a
);

1896 
›“80211_ibss_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
);

1897 
›“80211_ibss_rx_queued_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

1898 
sk_buff
 *
skb
);

1899 
›“80211_ibss_c§_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1900 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
,

1901 
u64
 *
chªged
);

1902 
›“80211_ibss_fšish_c§
(
›“80211_sub_if_d©a
 *
sd©a
,

1903 
u64
 *
chªged
);

1904 
›“80211_ibss_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
);

1907 
›“80211_ocb_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
);

1908 
›“80211_ocb_rx_no_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

1909 cÚ¡ 
u8
 *
bssid
, cÚ¡ u8 *
addr
, 
u32
 
suµ_¿‹s
);

1910 
›“80211_ocb_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
);

1911 
›“80211_ocb_još
(
›“80211_sub_if_d©a
 *
sd©a
,

1912 
ocb_£tup
 *
£tup
);

1913 
›“80211_ocb_Ëave
(
›“80211_sub_if_d©a
 *
sd©a
);

1916 
›“80211_mesh_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
);

1917 
›“80211_mesh_rx_queued_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

1918 
sk_buff
 *
skb
);

1919 
›“80211_mesh_c§_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1920 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
,

1921 
u64
 *
chªged
);

1922 
›“80211_mesh_fšish_c§
(
›“80211_sub_if_d©a
 *
sd©a
,

1923 
u64
 *
chªged
);

1926 
›“80211_sÿn_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
);

1927 
›“80211_»que¡_ibss_sÿn
(
›“80211_sub_if_d©a
 *
sd©a
,

1928 cÚ¡ 
u8
 *
ssid
, u8 
ssid_Ën
,

1929 
›“80211_chªÃl
 **
chªÃls
,

1930 
n_chªÃls
);

1931 
›“80211_»que¡_sÿn
(
›“80211_sub_if_d©a
 *
sd©a
,

1932 
cfg80211_sÿn_»que¡
 *
»q
);

1933 
›“80211_sÿn_ÿnûl
(
›“80211_loÿl
 *
loÿl
);

1934 
›“80211_run_deã¼ed_sÿn
(
›“80211_loÿl
 *
loÿl
);

1935 
›“80211_sÿn_rx
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
);

1937 
›“80211_šfÜm_bss
(
why
 *why, 
cfg80211_bss
 *
bss
,

1938 cÚ¡ 
cfg80211_bss_›s
 *
›s
, *
d©a
);

1940 
›“80211_mlme_nÙify_sÿn_com¶‘ed
(
›“80211_loÿl
 *
loÿl
);

1941 
›“80211_bss
 *

1942 
›“80211_bss_šfo_upd©e
(
›“80211_loÿl
 *
loÿl
,

1943 
›“80211_rx_¡©us
 *
rx_¡©us
,

1944 
›“80211_mgmt
 *
mgmt
,

1945 
size_t
 
Ën
,

1946 
›“80211_chªÃl
 *
chªÃl
);

1947 
›“80211_rx_bss_put
(
›“80211_loÿl
 *
loÿl
,

1948 
›“80211_bss
 *
bss
);

1952 
__›“80211_»que¡_sched_sÿn_¡¬t
(
›“80211_sub_if_d©a
 *
sd©a
,

1953 
cfg80211_sched_sÿn_»que¡
 *
»q
);

1954 
›“80211_»que¡_sched_sÿn_¡¬t
(
›“80211_sub_if_d©a
 *
sd©a
,

1955 
cfg80211_sched_sÿn_»que¡
 *
»q
);

1956 
›“80211_»que¡_sched_sÿn_¡İ
(
›“80211_loÿl
 *
loÿl
);

1957 
›“80211_sched_sÿn_’d
(
›“80211_loÿl
 *
loÿl
);

1958 
›“80211_sched_sÿn_¡İ³d_wÜk
(
why
 *wiphy,

1959 
why_wÜk
 *
wÜk
);

1962 
›“80211_offchªÃl_¡İ_vifs
(
›“80211_loÿl
 *
loÿl
);

1963 
›“80211_offchªÃl_»tuº
(
›“80211_loÿl
 *
loÿl
);

1964 
›“80211_roc_£tup
(
›“80211_loÿl
 *
loÿl
);

1965 
›“80211_¡¬t_Ãxt_roc
(
›“80211_loÿl
 *
loÿl
);

1966 
›“80211_roc_purge
(
›“80211_loÿl
 *
loÿl
,

1967 
›“80211_sub_if_d©a
 *
sd©a
);

1968 
›“80211_»maš_Ú_chªÃl
(
why
 *why, 
wœ–ess_dev
 *
wdev
,

1969 
›“80211_chªÃl
 *
chª
,

1970 
du¿tiÚ
, 
u64
 *
cook›
);

1971 
›“80211_ÿnûl_»maš_Ú_chªÃl
(
why
 *wiphy,

1972 
wœ–ess_dev
 *
wdev
, 
u64
 
cook›
);

1973 
›“80211_mgmt_tx
(
why
 *why, 
wœ–ess_dev
 *
wdev
,

1974 
cfg80211_mgmt_tx_·¿ms
 *
·¿ms
, 
u64
 *
cook›
);

1975 
›“80211_mgmt_tx_ÿnûl_wa™
(
why
 *wiphy,

1976 
wœ–ess_dev
 *
wdev
, 
u64
 
cook›
);

1979 
›“80211_c§_fš®ize_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
);

1980 
›“80211_chªÃl_sw™ch
(
why
 *why, 
Ãt_deviû
 *
dev
,

1981 
cfg80211_c§_£‰šgs
 *
·¿ms
);

1984 
›“80211_cŞÜ_chªge_fš®ize_wÜk
(
why
 *wiphy,

1985 
why_wÜk
 *
wÜk
);

1986 
›“80211_cŞÜ_cŞlisiÚ_d‘eùiÚ_wÜk
(
wÜk_¡ruù
 *
wÜk
);

1989 
	#MAC80211_SUPPORTED_FEATURES_TX
 (
NETIF_F_IP_CSUM
 | 
NETIF_F_IPV6_CSUM
 | \

1990 
NETIF_F_HW_CSUM
 | 
NETIF_F_SG
 | \

1991 
NETIF_F_HIGHDMA
 | 
NETIF_F_GSO_SOFTWARE
 | \

1992 
NETIF_F_HW_TC
)

	)

1993 
	#MAC80211_SUPPORTED_FEATURES_RX
 (
NETIF_F_RXCSUM
)

	)

1994 
	#MAC80211_SUPPORTED_FEATURES
 (
MAC80211_SUPPORTED_FEATURES_TX
 | \

1995 
MAC80211_SUPPORTED_FEATURES_RX
)

	)

1997 
›“80211_içû_š™
();

1998 
›“80211_içû_ex™
();

1999 
›“80211_if_add
(
›“80211_loÿl
 *
loÿl
, cÚ¡ *
Çme
,

2000 
Çme_assign_ty³
,

2001 
wœ–ess_dev
 **
Ãw_wdev
, 
Æ80211_iáy³
 
ty³
,

2002 
vif_·¿ms
 *
·¿ms
);

2003 
›“80211_if_chªge_ty³
(
›“80211_sub_if_d©a
 *
sd©a
,

2004 
Æ80211_iáy³
 
ty³
);

2005 
›“80211_if_»move
(
›“80211_sub_if_d©a
 *
sd©a
);

2006 
›“80211_»move_š‹rçûs
(
›“80211_loÿl
 *
loÿl
);

2007 
u32
 
›“80211_idË_off
(
›“80211_loÿl
 *
loÿl
);

2008 
›“80211_»ÿlc_idË
(
›“80211_loÿl
 *
loÿl
);

2009 
›“80211_adju¡_mÚ™Ü_æags
(
›“80211_sub_if_d©a
 *
sd©a
,

2010 cÚ¡ 
off£t
);

2011 
›“80211_do_İ’
(
wœ–ess_dev
 *
wdev
, 
boŞ
 
comšg_up
);

2012 
›“80211_sd©a_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
);

2013 
›“80211_add_vœtu®_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
);

2014 
›“80211_d–_vœtu®_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
);

2016 
boŞ
 
__›“80211_»ÿlc_txpow”
(
›“80211_sub_if_d©a
 *
sd©a
);

2017 
›“80211_»ÿlc_txpow”
(
›“80211_sub_if_d©a
 *
sd©a
,

2018 
boŞ
 
upd©e_bss
);

2019 
›“80211_»ÿlc_ofæßd
(
›“80211_loÿl
 *
loÿl
);

2021 
šlše
 
boŞ
 
	$›“80211_sd©a_ruÂšg
(
›“80211_sub_if_d©a
 *
sd©a
)

2023  
	`‹¡_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
);

2024 
	}
}

2027 
›“80211_lšk_£tup
(
›“80211_lšk_d©a
 *
lšk
);

2028 
›“80211_lšk_š™
(
›“80211_sub_if_d©a
 *
sd©a
,

2029 
lšk_id
,

2030 
›“80211_lšk_d©a
 *
lšk
,

2031 
›“80211_bss_cÚf
 *
lšk_cÚf
);

2032 
›“80211_lšk_¡İ
(
›“80211_lšk_d©a
 *
lšk
);

2033 
›“80211_vif_£t_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

2034 
u16
 
Ãw_lšks
, u16 
dÜmªt_lšks
);

2035 
šlše
 
	$›“80211_vif_ş—r_lšks
(
›“80211_sub_if_d©a
 *
sd©a
)

2037 
	`›“80211_vif_£t_lšks
(
sd©a
, 0, 0);

2038 
	}
}

2041 
›“80211_ş—r_tx_³ndšg
(
›“80211_loÿl
 *
loÿl
);

2042 
›“80211_tx_³ndšg
(
skËt_¡ruù
 *
t
);

2043 
Ãtdev_tx_t
 
›“80211_mÚ™Ü_¡¬t_xm™
(
sk_buff
 *
skb
,

2044 
Ãt_deviû
 *
dev
);

2045 
Ãtdev_tx_t
 
›“80211_subif_¡¬t_xm™
(
sk_buff
 *
skb
,

2046 
Ãt_deviû
 *
dev
);

2047 
Ãtdev_tx_t
 
›“80211_subif_¡¬t_xm™_8023
(
sk_buff
 *
skb
,

2048 
Ãt_deviû
 *
dev
);

2049 
__›“80211_subif_¡¬t_xm™
(
sk_buff
 *
skb
,

2050 
Ãt_deviû
 *
dev
,

2051 
u32
 
šfo_æags
,

2052 
u32
 
ù¾_æags
,

2053 
u64
 *
cook›
);

2054 
›“80211_purge_tx_queue
(
›“80211_hw
 *
hw
,

2055 
sk_buff_h—d
 *
skbs
);

2056 
sk_buff
 *

2057 
›“80211_bud_d©a_‹m¶©e
(
›“80211_sub_if_d©a
 *
sd©a
,

2058 
sk_buff
 *
skb
, 
u32
 
šfo_æags
);

2059 
›“80211_tx_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
,

2060 
»Œy_couÁ
, 
boŞ
 
£nd_to_cooked
,

2061 
›“80211_tx_¡©us
 *
¡©us
);

2063 
›“80211_check_ç¡_xm™
(
¡a_šfo
 *
¡a
);

2064 
›“80211_check_ç¡_xm™_®l
(
›“80211_loÿl
 *
loÿl
);

2065 
›“80211_check_ç¡_xm™_içû
(
›“80211_sub_if_d©a
 *
sd©a
);

2066 
›“80211_ş—r_ç¡_xm™
(
¡a_šfo
 *
¡a
);

2067 
›“80211_tx_cÚŒŞ_pÜt
(
why
 *why, 
Ãt_deviû
 *
dev
,

2068 cÚ¡ 
u8
 *
buf
, 
size_t
 
Ën
,

2069 cÚ¡ 
u8
 *
de¡
, 
__be16
 
´Ùo
, 
boŞ
 
uÃnüy±ed
,

2070 
lšk_id
, 
u64
 *
cook›
);

2071 
›“80211_´obe_mesh_lšk
(
why
 *why, 
Ãt_deviû
 *
dev
,

2072 cÚ¡ 
u8
 *
buf
, 
size_t
 
Ën
);

2073 
__›“80211_xm™_ç¡
(
›“80211_sub_if_d©a
 *
sd©a
,

2074 
¡a_šfo
 *
¡a
,

2075 
›“80211_ç¡_tx
 *
ç¡_tx
,

2076 
sk_buff
 *
skb
, 
boŞ
 
ampdu
,

2077 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
§
);

2078 
›“80211_aggr_check
(
›“80211_sub_if_d©a
 *
sd©a
,

2079 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
);

2082 
›“80211_­¶y_htÿp_ov”rides
(
›“80211_sub_if_d©a
 *
sd©a
,

2083 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
);

2084 
boŞ
 
›“80211_ht_ÿp_›_to_¡a_ht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

2085 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2086 cÚ¡ 
›“80211_ht_ÿp
 *
ht_ÿp_›
,

2087 
lšk_¡a_šfo
 *
lšk_¡a
);

2088 
›“80211_£nd_d–ba
(
›“80211_sub_if_d©a
 *
sd©a
,

2089 cÚ¡ 
u8
 *
da
, 
u16
 
tid
,

2090 
u16
 
š™ŸtÜ
, u16 
»asÚ_code
);

2091 
›“80211_£nd_smps_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

2092 
›“80211_smps_mode
 
smps
, cÚ¡ 
u8
 *
da
,

2093 cÚ¡ 
u8
 *
bssid
, 
lšk_id
);

2094 
boŞ
 
›“80211_smps_is_»¡riùive
(
›“80211_smps_mode
 
smps_mode_Şd
,

2095 
›“80211_smps_mode
 
smps_mode_Ãw
);

2097 
__›“80211_¡İ_rx_ba_£ssiÚ
(
¡a_šfo
 *
¡a
, 
u16
 
tid
,

2098 
u16
 
š™ŸtÜ
, u16 
»asÚ
, 
boŞ
 
¡İ
);

2099 
__›“80211_¡¬t_rx_ba_£ssiÚ
(
¡a_šfo
 *
¡a
,

2100 
u8
 
dŸlog_tok’
, 
u16
 
timeout
,

2101 
u16
 
¡¬t_£q_num
, u16 
ba_pŞicy
, u16 
tid
,

2102 
u16
 
buf_size
, 
boŞ
 
tx
, boŞ 
auto_£q
,

2103 cÚ¡ 
›“80211_addba_ext_›
 *
addb«xt
);

2104 
›“80211_¡a_‹¬_down_BA_£ssiÚs
(
¡a_šfo
 *
¡a
,

2105 
›“80211_agg_¡İ_»asÚ
 
»asÚ
);

2106 
›“80211_´oûss_d–ba
(
›“80211_sub_if_d©a
 *
sd©a
,

2107 
¡a_šfo
 *
¡a
,

2108 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
);

2109 
›“80211_´oûss_addba_»¥
(
›“80211_loÿl
 *
loÿl
,

2110 
¡a_šfo
 *
¡a
,

2111 
›“80211_mgmt
 *
mgmt
,

2112 
size_t
 
Ën
);

2113 
›“80211_´oûss_addba_»que¡
(
›“80211_loÿl
 *
loÿl
,

2114 
¡a_šfo
 *
¡a
,

2115 
›“80211_mgmt
 *
mgmt
,

2116 
size_t
 
Ën
);

2118 
__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a_šfo
 *
¡a
, 
u16
 
tid
,

2119 
›“80211_agg_¡İ_»asÚ
 
»asÚ
);

2120 
›“80211_¡¬t_tx_ba_cb
(
¡a_šfo
 *
¡a
, 
tid
,

2121 
tid_ampdu_tx
 *
tid_tx
);

2122 
›“80211_¡İ_tx_ba_cb
(
¡a_šfo
 *
¡a
, 
tid
,

2123 
tid_ampdu_tx
 *
tid_tx
);

2124 
›“80211_ba_£ssiÚ_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
);

2125 
›“80211_tx_ba_£ssiÚ_hªdË_¡¬t
(
¡a_šfo
 *
¡a
, 
tid
);

2126 
›“80211_»Ëa£_»Üd”_timeout
(
¡a_šfo
 *
¡a
, 
tid
);

2128 
u8
 
›“80211_mcs_to_chašs
(cÚ¡ 
›“80211_mcs_šfo
 *
mcs
);

2129 
Æ80211_smps_mode


2130 
›“80211_smps_mode_to_smps_mode
(
›“80211_smps_mode
 
smps
);

2134 
›“80211_vht_ÿp_›_to_¡a_vht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

2135 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2136 cÚ¡ 
›“80211_vht_ÿp
 *
vht_ÿp_›
,

2137 cÚ¡ 
›“80211_vht_ÿp
 *
vht_ÿp_›2
,

2138 
lšk_¡a_šfo
 *
lšk_¡a
);

2139 
›“80211_¡a_rx_bªdwidth


2140 
›“80211_¡a_ÿp_rx_bw
(
lšk_¡a_šfo
 *
lšk_¡a
);

2141 
›“80211_¡a_rx_bªdwidth


2142 
›“80211_¡a_cur_vht_bw
(
lšk_¡a_šfo
 *
lšk_¡a
);

2143 
›“80211_¡a_š™_nss
(
lšk_¡a_šfo
 *
lšk_¡a
);

2144 
›“80211_¡a_rx_bªdwidth


2145 
›“80211_chª_width_to_rx_bw
(
Æ80211_chª_width
 
width
);

2146 
Æ80211_chª_width


2147 
›“80211_¡a_ÿp_chª_bw
(
lšk_¡a_šfo
 *
lšk_¡a
);

2148 
›“80211_´oûss_mu_groups
(
›“80211_sub_if_d©a
 *
sd©a
,

2149 
›“80211_lšk_d©a
 *
lšk
,

2150 
›“80211_mgmt
 *
mgmt
);

2151 
u32
 
__›“80211_vht_hªdË_İmode
(
›“80211_sub_if_d©a
 *
sd©a
,

2152 
lšk_¡a_šfo
 *
¡a
,

2153 
u8
 
İmode
, 
Æ80211_bªd
 
bªd
);

2154 
›“80211_vht_hªdË_İmode
(
›“80211_sub_if_d©a
 *
sd©a
,

2155 
lšk_¡a_šfo
 *
¡a
,

2156 
u8
 
İmode
, 
Æ80211_bªd
 
bªd
);

2157 
›“80211_­¶y_vhtÿp_ov”rides
(
›“80211_sub_if_d©a
 *
sd©a
,

2158 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
);

2159 
›“80211_g‘_vht_mask_äom_ÿp
(
__Ë16
 
vht_ÿp
,

2160 
u16
 
vht_mask
[
NL80211_VHT_NSS_MAX
]);

2161 
Æ80211_chª_width


2162 
›“80211_¡a_rx_bw_to_chª_width
(
lšk_¡a_šfo
 *
¡a
);

2166 
›“80211_he_ÿp_›_to_¡a_he_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

2167 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2168 cÚ¡ 
u8
 *
he_ÿp_›
, u8 
he_ÿp_Ën
,

2169 cÚ¡ 
›“80211_he_6ghz_ÿ·
 *
he_6ghz_ÿ·
,

2170 
lšk_¡a_šfo
 *
lšk_¡a
);

2172 
›“80211_he_¥r_›_to_bss_cÚf
(
›“80211_vif
 *
vif
,

2173 cÚ¡ 
›“80211_he_¥r
 *
he_¥r_›_–em
);

2176 
›“80211_he_İ_›_to_bss_cÚf
(
›“80211_vif
 *
vif
,

2177 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ_›_–em
);

2180 
›“80211_s1g_¡a_¿‹_š™
(
¡a_šfo
 *
¡a
);

2181 
boŞ
 
›“80211_s1g_is_twt_£tup
(
sk_buff
 *
skb
);

2182 
›“80211_s1g_rx_twt_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

2183 
sk_buff
 *
skb
);

2184 
›“80211_s1g_¡©us_twt_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

2185 
sk_buff
 *
skb
);

2188 
›“80211_´oûss_m—su»m’t_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

2189 
›“80211_mgmt
 *
mgmt
,

2190 
size_t
 
Ën
);

2204 
›“80211_·r£_ch_sw™ch_›
(
›“80211_sub_if_d©a
 *
sd©a
,

2205 
›“802_11_–ems
 *
–ems
,

2206 
Æ80211_bªd
 
cu¼’t_bªd
,

2207 
u32
 
vht_ÿp_šfo
,

2208 
›“80211_cÚn_£‰šgs
 *
cÚn
,

2209 
u8
 *
bssid
,

2210 
›“80211_c§_›
 *
c§_›
);

2213 
›“80211_»cÚfig
(
›“80211_loÿl
 *
loÿl
);

2214 
›“80211_¡İ_deviû
(
›“80211_loÿl
 *
loÿl
);

2216 
__›“80211_su¥’d
(
›“80211_hw
 *
hw
,

2217 
cfg80211_wowÏn
 *
wowÏn
);

2219 
šlše
 
	$__›“80211_»sume
(
›“80211_hw
 *
hw
)

2221 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

2223 
	`WARN
(
	`‹¡_b™
(
SCAN_HW_SCANNING
, &
loÿl
->
sÿÂšg
) &&

2224 !
	`‹¡_b™
(
SCAN_COMPLETED
, &
loÿl
->
sÿÂšg
),

2226 
	`why_Çme
(
hw
->
why
));

2228  
	`›“80211_»cÚfig
(
	`hw_to_loÿl
(
hw
));

2229 
	}
}

2232 cÚ¡ *cÚ¡ 
mac80211_why_´ivid
;

2233 cÚ¡ *
›“80211_cÚn_mode_¡r
(
›“80211_cÚn_mode
 
mode
);

2234 
›“80211_cÚn_bw_lim™


2235 
›“80211_mš_bw_lim™_äom_chªdef
(
cfg80211_chª_def
 *
chªdef
);

2236 
›“80211_äame_du¿tiÚ
(
Æ80211_bªd
 
bªd
, 
size_t
 
Ën
,

2237 
¿‹
, 
”p
, 
shÜt_´—mbË
);

2238 
›“80211_»guÏtÜy_lim™_wmm_·¿ms
(
›“80211_sub_if_d©a
 *
sd©a
,

2239 
›“80211_tx_queue_·¿ms
 *
q·¿m
,

2240 
ac
);

2241 
›“80211_£t_wmm_deçuÉ
(
›“80211_lšk_d©a
 *
lšk
,

2242 
boŞ
 
bss_nÙify
, boŞ 
’abË_qos
);

2243 
›“80211_xm™
(
›“80211_sub_if_d©a
 *
sd©a
,

2244 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
);

2246 
__›“80211_tx_skb_tid_bªd
(
›“80211_sub_if_d©a
 *
sd©a
,

2247 
sk_buff
 *
skb
, 
tid
, 
lšk_id
,

2248 
Æ80211_bªd
 
bªd
);

2251 
›“80211_lookup_¿_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

2252 
sk_buff
 *
skb
,

2253 
¡a_šfo
 **
¡a_out
);

2255 
šlše
 

2256 
	$›“80211_tx_skb_tid_bªd
(
›“80211_sub_if_d©a
 *
sd©a
,

2257 
sk_buff
 *
skb
, 
tid
,

2258 
Æ80211_bªd
 
bªd
)

2260 
	`rcu_»ad_lock
();

2261 
	`__›“80211_tx_skb_tid_bªd
(
sd©a
, 
skb
, 
tid
, -1, 
bªd
);

2262 
	`rcu_»ad_uÆock
();

2263 
	}
}

2265 
›“80211_tx_skb_tid
(
›“80211_sub_if_d©a
 *
sd©a
,

2266 
sk_buff
 *
skb
, 
tid
, 
lšk_id
);

2268 
šlše
 
	$›“80211_tx_skb
(
›“80211_sub_if_d©a
 *
sd©a
,

2269 
sk_buff
 *
skb
)

2272 
	`›“80211_tx_skb_tid
(
sd©a
, 
skb
, 7, -1);

2273 
	}
}

2294 
	s›“80211_–ems_·r£_·¿ms
 {

2295 
›“80211_cÚn_mode
 
	mmode
;

2296 cÚ¡ 
u8
 *
	m¡¬t
;

2297 
size_t
 
	mËn
;

2298 
boŞ
 
	maùiÚ
;

2299 
u64
 
	mf‹r
;

2300 
u32
 
	müc
;

2301 
cfg80211_bss
 *
	mbss
;

2302 
	mlšk_id
;

2303 
boŞ
 
	mäom_­
;

2306 
›“802_11_–ems
 *

2307 
›“802_11_·r£_–ems_fuÎ
(
›“80211_–ems_·r£_·¿ms
 *
·¿ms
);

2309 
šlše
 
›“802_11_–ems
 *

2310 
	$›“802_11_·r£_–ems_üc
(cÚ¡ 
u8
 *
¡¬t
, 
size_t
 
Ën
, 
boŞ
 
aùiÚ
,

2311 
u64
 
f‹r
, 
u32
 
üc
,

2312 
cfg80211_bss
 *
bss
)

2314 
›“80211_–ems_·r£_·¿ms
 
·¿ms
 = {

2315 .
mode
 = 
IEEE80211_CONN_MODE_HIGHEST
,

2316 .
¡¬t
 = start,

2317 .
Ën
 =†en,

2318 .
aùiÚ
 =‡ction,

2319 .
f‹r
 = filter,

2320 .
üc
 = crc,

2321 .
bss
 = bss,

2322 .
lšk_id
 = -1,

2325  
	`›“802_11_·r£_–ems_fuÎ
(&
·¿ms
);

2326 
	}
}

2328 
šlše
 
›“802_11_–ems
 *

2329 
	$›“802_11_·r£_–ems
(cÚ¡ 
u8
 *
¡¬t
, 
size_t
 
Ën
, 
boŞ
 
aùiÚ
,

2330 
cfg80211_bss
 *
bss
)

2332  
	`›“802_11_·r£_–ems_üc
(
¡¬t
, 
Ën
, 
aùiÚ
, 0, 0, 
bss
);

2333 
	}
}

2335 cÚ¡ 
›“802_1d_to_ac
[8];

2337 
šlše
 
	$›“80211_ac_äom_tid
(
tid
)

2339  
›“802_1d_to_ac
[
tid
 & 7];

2340 
	}
}

2342 
›“80211_dyÇmic_ps_’abË_wÜk
(
why
 *wiphy,

2343 
why_wÜk
 *
wÜk
);

2344 
›“80211_dyÇmic_ps_di§bË_wÜk
(
why
 *wiphy,

2345 
why_wÜk
 *
wÜk
);

2346 
›“80211_dyÇmic_ps_tim”
(
tim”_li¡
 *
t
);

2347 
›“80211_£nd_nuÎfunc
(
›“80211_loÿl
 *
loÿl
,

2348 
›“80211_sub_if_d©a
 *
sd©a
,

2349 
boŞ
 
pow”§ve
);

2350 
›“80211_£nd_4addr_nuÎfunc
(
›“80211_loÿl
 *
loÿl
,

2351 
›“80211_sub_if_d©a
 *
sd©a
);

2352 
›“80211_¡a_tx_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

2353 
›“80211_hdr
 *
hdr
, 
boŞ
 
ack
, 
u16
 
tx_time
);

2355 
›“80211_wake_queues_by_»asÚ
(
›“80211_hw
 *
hw
,

2356 
queues
,

2357 
queue_¡İ_»asÚ
 
»asÚ
,

2358 
boŞ
 
»fcouÁed
);

2359 
›“80211_¡İ_vif_queues
(
›“80211_loÿl
 *
loÿl
,

2360 
›“80211_sub_if_d©a
 *
sd©a
,

2361 
queue_¡İ_»asÚ
 
»asÚ
);

2362 
›“80211_wake_vif_queues
(
›“80211_loÿl
 *
loÿl
,

2363 
›“80211_sub_if_d©a
 *
sd©a
,

2364 
queue_¡İ_»asÚ
 
»asÚ
);

2365 
›“80211_¡İ_queues_by_»asÚ
(
›“80211_hw
 *
hw
,

2366 
queues
,

2367 
queue_¡İ_»asÚ
 
»asÚ
,

2368 
boŞ
 
»fcouÁed
);

2369 
›“80211_wake_queue_by_»asÚ
(
›“80211_hw
 *
hw
, 
queue
,

2370 
queue_¡İ_»asÚ
 
»asÚ
,

2371 
boŞ
 
»fcouÁed
);

2372 
›“80211_¡İ_queue_by_»asÚ
(
›“80211_hw
 *
hw
, 
queue
,

2373 
queue_¡İ_»asÚ
 
»asÚ
,

2374 
boŞ
 
»fcouÁed
);

2375 
›“80211_add_³ndšg_skb
(
›“80211_loÿl
 *
loÿl
,

2376 
sk_buff
 *
skb
);

2377 
›“80211_add_³ndšg_skbs
(
›“80211_loÿl
 *
loÿl
,

2378 
sk_buff_h—d
 *
skbs
);

2379 
›“80211_æush_queues
(
›“80211_loÿl
 *
loÿl
,

2380 
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
drİ
);

2381 
__›“80211_æush_queues
(
›“80211_loÿl
 *
loÿl
,

2382 
›“80211_sub_if_d©a
 *
sd©a
,

2383 
queues
, 
boŞ
 
drİ
);

2385 
šlše
 
boŞ
 
	$›“80211_ÿn_run_wÜk”
(
›“80211_loÿl
 *
loÿl
)

2391 ià(
loÿl
->
š_»cÚfig
)

2392  
çl£
;

2400 ià(
loÿl
->
qu›scšg
)

2401  
çl£
;

2416 ià(
loÿl
->
su¥’ded
)

2417  
çl£
;

2419  
Œue
;

2420 
	}
}

2422 
›“80211_txq_£tup_æows
(
›“80211_loÿl
 *
loÿl
);

2423 
›“80211_txq_£t_·¿ms
(
›“80211_loÿl
 *
loÿl
);

2424 
›“80211_txq_‹¬down_æows
(
›“80211_loÿl
 *
loÿl
);

2425 
›“80211_txq_š™
(
›“80211_sub_if_d©a
 *
sd©a
,

2426 
¡a_šfo
 *
¡a
,

2427 
txq_šfo
 *
txq
, 
tid
);

2428 
›“80211_txq_purge
(
›“80211_loÿl
 *
loÿl
,

2429 
txq_šfo
 *
txqi
);

2430 
›“80211_purge_¡a_txqs
(
¡a_šfo
 *
¡a
);

2431 
›“80211_txq_»move_vÏn
(
›“80211_loÿl
 *
loÿl
,

2432 
›“80211_sub_if_d©a
 *
sd©a
);

2433 
›“80211_fl_txq_¡©s
(
cfg80211_txq_¡©s
 *
txq¡©s
,

2434 
txq_šfo
 *
txqi
);

2435 
›“80211_wake_txqs
(
skËt_¡ruù
 *
t
);

2436 
›“80211_£nd_auth
(
›“80211_sub_if_d©a
 *
sd©a
,

2437 
u16
 
Œª§ùiÚ
, u16 
auth_®g
, u16 
¡©us
,

2438 cÚ¡ 
u8
 *
exŒa
, 
size_t
 
exŒa_Ën
, cÚ¡ u8 *
bssid
,

2439 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
key
, u8 
key_Ën
, u8 
key_idx
,

2440 
u32
 
tx_æags
);

2441 
›“80211_£nd_d—uth_di§ssoc
(
›“80211_sub_if_d©a
 *
sd©a
,

2442 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
bssid
,

2443 
u16
 
¡y³
, u16 
»asÚ
,

2444 
boŞ
 
£nd_äame
, 
u8
 *
äame_buf
);

2447 
	mIEEE80211_PROBE_FLAG_DIRECTED
 = 
BIT
(0),

2448 
	mIEEE80211_PROBE_FLAG_MIN_CONTENT
 = 
BIT
(1),

2449 
	mIEEE80211_PROBE_FLAG_RANDOM_SN
 = 
BIT
(2),

2452 
›“80211_bud_´eq_›s
(
›“80211_sub_if_d©a
 *
sd©a
, 
u8
 *
bufãr
,

2453 
size_t
 
bufãr_Ën
,

2454 
›“80211_sÿn_›s
 *
›_desc
,

2455 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

2456 
u8
 
bªds_u£d
, 
u32
 *
¿‹_masks
,

2457 
cfg80211_chª_def
 *
chªdef
,

2458 
u32
 
æags
);

2459 
sk_buff
 *
›“80211_bud_´obe_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

2460 cÚ¡ 
u8
 *
¤c
, cÚ¡ u8 *
d¡
,

2461 
u32
 
¿‹mask
,

2462 
›“80211_chªÃl
 *
chª
,

2463 cÚ¡ 
u8
 *
ssid
, 
size_t
 
ssid_Ën
,

2464 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

2465 
u32
 
æags
);

2466 
u32
 
›“80211_¡a_g‘_¿‹s
(
›“80211_sub_if_d©a
 *
sd©a
,

2467 
›“802_11_–ems
 *
–ems
,

2468 
Æ80211_bªd
 
bªd
, 
u32
 *
basic_¿‹s
);

2469 
__›“80211_»que¡_smps_mgd
(
›“80211_sub_if_d©a
 *
sd©a
,

2470 
›“80211_lšk_d©a
 *
lšk
,

2471 
›“80211_smps_mode
 
smps_mode
);

2472 
›“80211_»ÿlc_smps
(
›“80211_sub_if_d©a
 *
sd©a
,

2473 
›“80211_lšk_d©a
 *
lšk
);

2474 
›“80211_»ÿlc_mš_chªdef
(
›“80211_sub_if_d©a
 *
sd©a
,

2475 
lšk_id
);

2477 
size_t
 
›“80211_›_¥l™_v’dÜ
(cÚ¡ 
u8
 *
›s
, size_ˆ
›Ën
, size_ˆ
off£t
);

2478 
u8
 *
›“80211_›_bud_ht_ÿp
(u8 *
pos
, 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
,

2479 
u16
 
ÿp
);

2480 
u8
 *
›“80211_›_bud_ht_İ”
(u8 *
pos
, 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
,

2481 cÚ¡ 
cfg80211_chª_def
 *
chªdef
,

2482 
u16
 
´Ù_mode
, 
boŞ
 
rifs_mode
);

2483 
›“80211_›_bud_wide_bw_cs
(
u8
 *
pos
,

2484 cÚ¡ 
cfg80211_chª_def
 *
chªdef
);

2485 
u8
 *
›“80211_›_bud_vht_ÿp
(u8 *
pos
, 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
,

2486 
u32
 
ÿp
);

2487 
u8
 *
›“80211_›_bud_vht_İ”
(u8 *
pos
, 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
,

2488 cÚ¡ 
cfg80211_chª_def
 *
chªdef
);

2489 
u8
 
›“80211_›_Ën_he_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
);

2490 
u8
 *
›“80211_›_bud_he_İ”
(u8 *
pos
, 
cfg80211_chª_def
 *
chªdef
);

2491 
u8
 *
›“80211_›_bud_eht_İ”
(u8 *
pos
, 
cfg80211_chª_def
 *
chªdef
,

2492 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
);

2493 
›“80211_·r£_b™¿‹s
(
Æ80211_chª_width
 
width
,

2494 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2495 cÚ¡ 
u8
 *
¤©es
, 
¤©es_Ën
, 
u32
 *
¿‹s
);

2496 
u8
 *
›“80211_add_wmm_šfo_›
(u8 *
buf
, u8 
qosšfo
);

2497 
›“80211_add_s1g_ÿ·b_›
(
›“80211_sub_if_d©a
 *
sd©a
,

2498 
›“80211_¡a_s1g_ÿp
 *
ÿps
,

2499 
sk_buff
 *
skb
);

2500 
›“80211_add_aid_»que¡_›
(
›“80211_sub_if_d©a
 *
sd©a
,

2501 
sk_buff
 *
skb
);

2504 
›“80211_put_¤©es_–em
(
sk_buff
 *
skb
,

2505 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2506 
u32
 
basic_¿‹s
, u32 
¿‹_æags
, u32 
masked_¿‹s
,

2507 
u8
 
–em’t_id
);

2508 
›“80211_put_he_ÿp
(
sk_buff
 *
skb
,

2509 
›“80211_sub_if_d©a
 *
sd©a
,

2510 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2511 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
);

2512 
›“80211_put_he_6ghz_ÿp
(
sk_buff
 *
skb
,

2513 
›“80211_sub_if_d©a
 *
sd©a
,

2514 
›“80211_smps_mode
 
smps_mode
);

2515 
›“80211_put_eht_ÿp
(
sk_buff
 *
skb
,

2516 
›“80211_sub_if_d©a
 *
sd©a
,

2517 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2518 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
);

2521 
boŞ
 
›“80211_chªdef_ht_İ”
(cÚ¡ 
›“80211_ht_İ”©iÚ
 *
ht_İ”
,

2522 
cfg80211_chª_def
 *
chªdef
);

2523 
boŞ
 
›“80211_chªdef_vht_İ”
(
›“80211_hw
 *
hw
, 
u32
 
vht_ÿp_šfo
,

2524 cÚ¡ 
›“80211_vht_İ”©iÚ
 *
İ”
,

2525 cÚ¡ 
›“80211_ht_İ”©iÚ
 *
htİ
,

2526 
cfg80211_chª_def
 *
chªdef
);

2527 
›“80211_chªdef_eht_İ”
(cÚ¡ 
›“80211_eht_İ”©iÚ_šfo
 *
šfo
,

2528 
cfg80211_chª_def
 *
chªdef
);

2529 
boŞ
 
›“80211_chªdef_he_6ghz_İ”
(
›“80211_loÿl
 *
loÿl
,

2530 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ”
,

2531 cÚ¡ 
›“80211_eht_İ”©iÚ
 *
eht_İ”
,

2532 
cfg80211_chª_def
 *
chªdef
);

2533 
boŞ
 
›“80211_chªdef_s1g_İ”
(cÚ¡ 
›“80211_s1g_İ”_›
 *
İ”
,

2534 
cfg80211_chª_def
 *
chªdef
);

2535 
›“80211_chªdef_downg¿de
(
cfg80211_chª_def
 *
chªdef
,

2536 
›“80211_cÚn_£‰šgs
 *
cÚn
);

2537 
šlše
 

2538 
	$›“80211_chª»q_downg¿de
(
›“80211_chª_»q
 *
chª»q
,

2539 
›“80211_cÚn_£‰šgs
 *
cÚn
)

2541 
	`›“80211_chªdef_downg¿de
(&
chª»q
->
İ”
, 
cÚn
);

2542 ià(
	`WARN_ON
(!
cÚn
))

2544 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

2545 
chª»q
->
­
.
chª
 = 
NULL
;

2546 
	}
}

2548 
boŞ
 
›“80211_chª»q_id’tiÿl
(cÚ¡ 
›“80211_chª_»q
 *
a
,

2549 cÚ¡ 
›“80211_chª_»q
 *
b
);

2551 
__mu¡_check


2552 
›“80211_lšk_u£_chªÃl
(
›“80211_lšk_d©a
 *
lšk
,

2553 cÚ¡ 
›“80211_chª_»q
 *
»q
,

2554 
›“80211_chªùx_mode
 
mode
);

2555 
__mu¡_check


2556 
›“80211_lšk_»£rve_chªùx
(
›“80211_lšk_d©a
 *
lšk
,

2557 cÚ¡ 
›“80211_chª_»q
 *
»q
,

2558 
›“80211_chªùx_mode
 
mode
,

2559 
boŞ
 
¿d¬_»quœed
);

2560 
__mu¡_check


2561 
›“80211_lšk_u£_»£rved_cÚ‹xt
(
›“80211_lšk_d©a
 *
lšk
);

2562 
›“80211_lšk_uÄe£rve_chªùx
(
›“80211_lšk_d©a
 *
lšk
);

2564 
__mu¡_check


2565 
›“80211_lšk_chªge_chª»q
(
›“80211_lšk_d©a
 *
lšk
,

2566 cÚ¡ 
›“80211_chª_»q
 *
»q
,

2567 
u64
 *
chªged
);

2568 
›“80211_lšk_»Ëa£_chªÃl
(
›“80211_lšk_d©a
 *
lšk
);

2569 
›“80211_lšk_vÏn_cİy_chªùx
(
›“80211_lšk_d©a
 *
lšk
);

2570 
›“80211_lšk_cİy_chªùx_to_vÏns
(
›“80211_lšk_d©a
 *
lšk
,

2571 
boŞ
 
ş—r
);

2572 
›“80211_chªùx_»fcouÁ
(
›“80211_loÿl
 *
loÿl
,

2573 
›“80211_chªùx
 *
ùx
);

2575 
›“80211_»ÿlc_smps_chªùx
(
›“80211_loÿl
 *
loÿl
,

2576 
›“80211_chªùx
 *
chªùx
);

2577 
›“80211_»ÿlc_chªùx_mš_def
(
›“80211_loÿl
 *
loÿl
,

2578 
›“80211_chªùx
 *
ùx
,

2579 
›“80211_lšk_d©a
 *
rsvd_fÜ
);

2580 
boŞ
 
›“80211_is_¿d¬_»quœed
(
›“80211_loÿl
 *
loÿl
);

2582 
›“80211_dfs_ÿc_tim”_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
);

2583 
›“80211_dfs_ÿc_ÿnûl
(
›“80211_loÿl
 *
loÿl
);

2584 
›“80211_dfs_¿d¬_d‘eùed_wÜk
(
why
 *wiphy,

2585 
why_wÜk
 *
wÜk
);

2586 
›“80211_£nd_aùiÚ_c§
(
›“80211_sub_if_d©a
 *
sd©a
,

2587 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
);

2589 
›“80211_»ÿlc_dtim
(
›“80211_loÿl
 *
loÿl
,

2590 
›“80211_sub_if_d©a
 *
sd©a
);

2591 
›“80211_check_combš©iÚs
(
›“80211_sub_if_d©a
 *
sd©a
,

2592 cÚ¡ 
cfg80211_chª_def
 *
chªdef
,

2593 
›“80211_chªùx_mode
 
chªmode
,

2594 
u8
 
¿d¬_d‘eù
);

2595 
›“80211_max_num_chªÃls
(
›“80211_loÿl
 *
loÿl
);

2596 
›“80211_»ÿlc_chªùx_chªty³
(
›“80211_loÿl
 *
loÿl
,

2597 
›“80211_chªùx
 *
ùx
);

2600 
›“80211_tdls_mgmt
(
why
 *why, 
Ãt_deviû
 *
dev
,

2601 cÚ¡ 
u8
 *
³”
, 
lšk_id
,

2602 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
, 
u16
 
¡©us_code
,

2603 
u32
 
³”_ÿ·b™y
, 
boŞ
 
š™ŸtÜ
,

2604 cÚ¡ 
u8
 *
exŒa_›s
, 
size_t
 
exŒa_›s_Ën
);

2605 
›“80211_tdls_İ”
(
why
 *why, 
Ãt_deviû
 *
dev
,

2606 cÚ¡ 
u8
 *
³”
, 
Æ80211_tdls_İ”©iÚ
 
İ”
);

2607 
›“80211_tdls_³”_d–_wÜk
(
why
 *why, 
why_wÜk
 *
wk
);

2608 
›“80211_tdls_chªÃl_sw™ch
(
why
 *why, 
Ãt_deviû
 *
dev
,

2609 cÚ¡ 
u8
 *
addr
, u8 
İ”_şass
,

2610 
cfg80211_chª_def
 *
chªdef
);

2611 
›“80211_tdls_ÿnûl_chªÃl_sw™ch
(
why
 *wiphy,

2612 
Ãt_deviû
 *
dev
,

2613 cÚ¡ 
u8
 *
addr
);

2614 
›“80211_‹¬down_tdls_³”s
(
›“80211_lšk_d©a
 *
lšk
);

2615 
›“80211_tdls_hªdË_discÚÃù
(
›“80211_sub_if_d©a
 *
sd©a
,

2616 cÚ¡ 
u8
 *
³”
, 
u16
 
»asÚ
);

2618 
›“80211_´oûss_tdls_chªÃl_sw™ch
(
›“80211_sub_if_d©a
 *
sd©a
,

2619 
sk_buff
 *
skb
);

2622 cÚ¡ *
›“80211_g‘_»asÚ_code_¡ršg
(
u16
 
»asÚ_code
);

2623 
u16
 
›“80211_’code_usf
(
v®
);

2624 
u8
 *
›“80211_g‘_bssid
(
›“80211_hdr
 *
hdr
, 
size_t
 
Ën
,

2625 
Æ80211_iáy³
 
ty³
);

2627 cÚ¡ 
‘htoŞ_İs
 
›“80211_‘htoŞ_İs
;

2629 
u32
 
›“80211_ÿlc_ex³ùed_tx_aœtime
(
›“80211_hw
 *
hw
,

2630 
›“80211_vif
 *
vif
,

2631 
›“80211_¡a
 *
pub¡a
,

2632 
Ën
, 
boŞ
 
ampdu
);

2633 #ifdeà
CONFIG_MAC80211_NOINLINE


2634 
	#debug_nošlše
 
nošlše


	)

2636 
	#debug_nošlše


	)

2639 
›“80211_š™_äag_ÿche
(
›“80211_äagm’t_ÿche
 *
ÿche
);

2640 
›“80211_de¡roy_äag_ÿche
(
›“80211_äagm’t_ÿche
 *
ÿche
);

2642 
u8
 
›“80211_›_Ën_eht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
);

2645 
›“80211_eht_ÿp_›_to_¡a_eht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

2646 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2647 cÚ¡ 
u8
 *
he_ÿp_›
, u8 
he_ÿp_Ën
,

2648 cÚ¡ 
›“80211_eht_ÿp_–em
 *
eht_ÿp_›_–em
,

2649 
u8
 
eht_ÿp_Ën
,

2650 
lšk_¡a_šfo
 *
lšk_¡a
);

2651 
›“80211_´oûss_Ãg_‰lm_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

2652 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
);

2653 
›“80211_´oûss_Ãg_‰lm_»s
(
›“80211_sub_if_d©a
 *
sd©a
,

2654 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
);

2655 
›“80211_»q_Ãg_‰lm
(
›“80211_sub_if_d©a
 *
sd©a
,

2656 
cfg80211_‰lm_·¿ms
 *
·¿ms
);

2658 
›“80211_check_wbrf_suµÜt
(
›“80211_loÿl
 *
loÿl
);

2659 
›“80211_add_wbrf
(
›“80211_loÿl
 *
loÿl
, 
cfg80211_chª_def
 *
chªdef
);

2660 
›“80211_»move_wbrf
(
›“80211_loÿl
 *
loÿl
, 
cfg80211_chª_def
 *
chªdef
);

2662 #ià
IS_ENABLED
(
CONFIG_MAC80211_KUNIT_TEST
)

2663 
	#EXPORT_SYMBOL_IF_MAC80211_KUNIT
(
sym
è
	`EXPORT_SYMBOL_IF_KUNIT
(sym)

	)

2664 
	#VISIBLE_IF_MAC80211_KUNIT


	)

2665 
›“80211_rx_»suÉ


2666 
›“80211_drİ_uÃnüy±ed_mgmt
(
›“80211_rx_d©a
 *
rx
);

2668 
	#EXPORT_SYMBOL_IF_MAC80211_KUNIT
(
sym
)

	)

2669 
	#VISIBLE_IF_MAC80211_KUNIT
 

	)

	@iface.c

13 
	~<lšux/¦ab.h
>

14 
	~<lšux/k”Ãl.h
>

15 
	~<lšux/if_¬p.h
>

16 
	~<lšux/Ãtdeviû.h
>

17 
	~<lšux/¹Ãšk.h
>

18 
	~<lšux/kcov.h
>

19 
	~<Ãt/mac80211.h
>

20 
	~<Ãt/›“80211_¿diÙ­.h
>

21 
	~"›“80211_i.h
"

22 
	~"¡a_šfo.h
"

23 
	~"debugfs_Ãtdev.h
"

24 
	~"mesh.h
"

25 
	~"Ëd.h
"

26 
	~"driv”-İs.h
"

27 
	~"wme.h
"

28 
	~"¿‹.h
"

45 
›“80211_içû_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
);

47 
boŞ
 
	$__›“80211_»ÿlc_txpow”
(
›“80211_sub_if_d©a
 *
sd©a
)

49 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

50 
pow”
;

52 
	`rcu_»ad_lock
();

53 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

54 ià(!
chªùx_cÚf
) {

55 
	`rcu_»ad_uÆock
();

56  
çl£
;

59 
pow”
 = 
	`›“80211_chªdef_max_pow”
(&
chªùx_cÚf
->
def
);

60 
	`rcu_»ad_uÆock
();

62 ià(
sd©a
->
deæšk
.
u£r_pow”_Ëv–
 !ğ
IEEE80211_UNSET_POWER_LEVEL
)

63 
pow”
 = 
	`mš
Õow”, 
sd©a
->
deæšk
.
u£r_pow”_Ëv–
);

65 ià(
sd©a
->
deæšk
.
­_pow”_Ëv–
 !ğ
IEEE80211_UNSET_POWER_LEVEL
)

66 
pow”
 = 
	`mš
Õow”, 
sd©a
->
deæšk
.
­_pow”_Ëv–
);

68 ià(
pow”
 !ğ
sd©a
->
vif
.
bss_cÚf
.
txpow”
) {

69 
sd©a
->
vif
.
bss_cÚf
.
txpow”
 = 
pow”
;

70 
	`›“80211_hw_cÚfig
(
sd©a
->
loÿl
, 0);

71  
Œue
;

74  
çl£
;

75 
	}
}

77 
	$›“80211_»ÿlc_txpow”
(
›“80211_sub_if_d©a
 *
sd©a
,

78 
boŞ
 
upd©e_bss
)

80 ià(
	`__›“80211_»ÿlc_txpow”
(
sd©a
) ||

81 (
upd©e_bss
 && 
	`›“80211_sd©a_ruÂšg
(
sd©a
)))

82 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

83 
BSS_CHANGED_TXPOWER
);

84 
	}
}

86 
u32
 
	$__›“80211_idË_off
(
›“80211_loÿl
 *
loÿl
)

88 ià(!(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_IDLE
))

91 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_IDLE
;

92  
IEEE80211_CONF_CHANGE_IDLE
;

93 
	}
}

95 
u32
 
	$__›“80211_idË_Ú
(
›“80211_loÿl
 *
loÿl
)

97 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_IDLE
)

100 
	`›“80211_æush_queues
(
loÿl
, 
NULL
, 
çl£
);

102 
loÿl
->
hw
.
cÚf
.
æags
 |ğ
IEEE80211_CONF_IDLE
;

103  
IEEE80211_CONF_CHANGE_IDLE
;

104 
	}
}

106 
u32
 
	$__›“80211_»ÿlc_idË
(
›“80211_loÿl
 *
loÿl
,

107 
boŞ
 
fÜû_aùive
)

109 
boŞ
 
wÜkšg
, 
sÿÂšg
, 
aùive
;

110 
Ëd_Œig_¡¬t
 = 0, 
Ëd_Œig_¡İ
 = 0;

112 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

114 
aùive
 = 
fÜû_aùive
 ||

115 !
	`li¡_em±y
(&
loÿl
->
chªùx_li¡
) ||

116 
loÿl
->
mÚ™Üs
;

118 
wÜkšg
 = !
loÿl
->
İs
->
»maš_Ú_chªÃl
 &&

119 !
	`li¡_em±y
(&
loÿl
->
roc_li¡
);

121 
sÿÂšg
 = 
	`‹¡_b™
(
SCAN_SW_SCANNING
, &
loÿl
->scanning) ||

122 
	`‹¡_b™
(
SCAN_ONCHANNEL_SCANNING
, &
loÿl
->
sÿÂšg
);

124 ià(
wÜkšg
 || 
sÿÂšg
)

125 
Ëd_Œig_¡¬t
 |ğ
IEEE80211_TPT_LEDTRIG_FL_WORK
;

127 
Ëd_Œig_¡İ
 |ğ
IEEE80211_TPT_LEDTRIG_FL_WORK
;

129 ià(
aùive
)

130 
Ëd_Œig_¡¬t
 |ğ
IEEE80211_TPT_LEDTRIG_FL_CONNECTED
;

132 
Ëd_Œig_¡İ
 |ğ
IEEE80211_TPT_LEDTRIG_FL_CONNECTED
;

134 
	`›“80211_mod_t_Ëd_Œig
(
loÿl
, 
Ëd_Œig_¡¬t
, 
Ëd_Œig_¡İ
);

136 ià(
wÜkšg
 || 
sÿÂšg
 || 
aùive
)

137  
	`__›“80211_idË_off
(
loÿl
);

138  
	`__›“80211_idË_Ú
(
loÿl
);

139 
	}
}

141 
u32
 
	$›“80211_idË_off
(
›“80211_loÿl
 *
loÿl
)

143  
	`__›“80211_»ÿlc_idË
(
loÿl
, 
Œue
);

144 
	}
}

146 
	$›“80211_»ÿlc_idË
(
›“80211_loÿl
 *
loÿl
)

148 
u32
 
chªge
 = 
	`__›“80211_»ÿlc_idË
(
loÿl
, 
çl£
);

149 ià(
chªge
)

150 
	`›“80211_hw_cÚfig
(
loÿl
, 
chªge
);

151 
	}
}

153 
	$›“80211_v”ify_mac
(
›“80211_sub_if_d©a
 *
sd©a
, 
u8
 *
addr
,

154 
boŞ
 
check_dup
)

156 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

157 
›“80211_sub_if_d©a
 *
™”
;

158 
u64
 
Ãw
, 
mask
, 
tmp
;

159 
u8
 *
m
;

160 
»t
 = 0;

162 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

164 ià(
	`is_z”o_‘h”_addr
(
loÿl
->
hw
.
why
->
addr_mask
))

167 
m
 = 
addr
;

168 
Ãw
 = ((
u64
)
m
[0] << 5*8) | ((u64)m[1] << 4*8) |

169 ((
u64
)
m
[2] << 3*8) | ((u64)m[3] << 2*8) |

170 ((
u64
)
m
[4] << 1*8) | ((u64)m[5] << 0*8);

172 
m
 = 
loÿl
->
hw
.
why
->
addr_mask
;

173 
mask
 = ((
u64
)
m
[0] << 5*8) | ((u64)m[1] << 4*8) |

174 ((
u64
)
m
[2] << 3*8) | ((u64)m[3] << 2*8) |

175 ((
u64
)
m
[4] << 1*8) | ((u64)m[5] << 0*8);

177 ià(!
check_dup
)

178  
»t
;

180 
	`li¡_fÜ_—ch_’Œy
(
™”
, &
loÿl
->
š‹rçûs
, 
li¡
) {

181 ià(
™”
 =ğ
sd©a
)

184 ià(
™”
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 &&

185 !(
™”
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
))

188 
m
 = 
™”
->
vif
.
addr
;

189 
tmp
 = ((
u64
)
m
[0] << 5*8) | ((u64)m[1] << 4*8) |

190 ((
u64
)
m
[2] << 3*8) | ((u64)m[3] << 2*8) |

191 ((
u64
)
m
[4] << 1*8) | ((u64)m[5] << 0*8);

193 ià((
Ãw
 & ~
mask
è!ğ(
tmp
 & ~mask)) {

194 
»t
 = -
EINVAL
;

199  
»t
;

200 
	}
}

202 
	$›“80211_ÿn_pow”ed_addr_chªge
(
›“80211_sub_if_d©a
 *
sd©a
)

204 
›“80211_roc_wÜk
 *
roc
;

205 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

206 
›“80211_sub_if_d©a
 *
sÿn_sd©a
;

207 
»t
 = 0;

209 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

215 ià(
	`Ãtif_ÿ¼›r_ok
(
sd©a
->
dev
))

216  -
EBUSY
;

219 
	`li¡_fÜ_—ch_’Œy
(
roc
, &
loÿl
->
roc_li¡
, 
li¡
) {

220 ià(
roc
->
sd©a
 != sdata)

223 ià(
roc
->
¡¬‹d
) {

224 
»t
 = -
EBUSY
;

225 
uÆock
;

230 ià(
loÿl
->
sÿÂšg
) {

231 
sÿn_sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_sdata,

232 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

233 ià(
sd©a
 =ğ
sÿn_sd©a
)

234 
»t
 = -
EBUSY
;

237 
sd©a
->
vif
.
ty³
) {

238 
NL80211_IFTYPE_STATION
:

239 
NL80211_IFTYPE_P2P_CLIENT
:

245 
»t
 = -
EOPNOTSUPP
;

248 
uÆock
:

249  
»t
;

250 
	}
}

252 
	$_›“80211_chªge_mac
(
›“80211_sub_if_d©a
 *
sd©a
,

253 *
addr
)

255 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

256 
sockaddr
 *
§
 = 
addr
;

257 
boŞ
 
check_dup
 = 
Œue
;

258 
boŞ
 
live
 = 
çl£
;

259 
»t
;

261 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

262 
»t
 = 
	`›“80211_ÿn_pow”ed_addr_chªge
(
sd©a
);

263 ià(
»t
)

264  
»t
;

266 
live
 = 
Œue
;

269 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 &&

270 !(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
))

271 
check_dup
 = 
çl£
;

273 
»t
 = 
	`›“80211_v”ify_mac
(
sd©a
, 
§
->
§_d©a
, 
check_dup
);

274 ià(
»t
)

275  
»t
;

277 ià(
live
)

278 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

279 
»t
 = 
	`‘h_mac_addr
(
sd©a
->
dev
, 
§
);

281 ià(
»t
 == 0) {

282 
	`memıy
(
sd©a
->
vif
.
addr
, 
§
->
§_d©a
, 
ETH_ALEN
);

283 
	`‘h”_addr_cİy
(
sd©a
->
vif
.
bss_cÚf
.
addr
, sdata->vif.addr);

289 ià(
live
)

290 
	`WARN_ON
(
	`drv_add_š‹rçû
(
loÿl
, 
sd©a
));

292  
»t
;

293 
	}
}

295 
	$›“80211_chªge_mac
(
Ãt_deviû
 *
dev
, *
addr
)

297 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

298 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

299 
»t
;

306 ià(!
dev
->
›“80211_±r
->
»gi¡”ed
)

309 
	`why_lock
(
loÿl
->
hw
.
why
);

310 
»t
 = 
	`_›“80211_chªge_mac
(
sd©a
, 
addr
);

311 
	`why_uÆock
(
loÿl
->
hw
.
why
);

313  
»t
;

314 
	}
}

316 
šlše
 
	$id’tiÿl_mac_addr_®lowed
(
ty³1
, 
ty³2
)

318  
ty³1
 =ğ
NL80211_IFTYPE_MONITOR
 ||

319 
ty³2
 =ğ
NL80211_IFTYPE_MONITOR
 ||

320 
ty³1
 =ğ
NL80211_IFTYPE_P2P_DEVICE
 ||

321 
ty³2
 =ğ
NL80211_IFTYPE_P2P_DEVICE
 ||

322 (
ty³1
 =ğ
NL80211_IFTYPE_AP
 && 
ty³2
 =ğ
NL80211_IFTYPE_AP_VLAN
) ||

323 (
ty³1
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

324 (
ty³2
 =ğ
NL80211_IFTYPE_AP
 ||

325 
ty³2
 =ğ
NL80211_IFTYPE_AP_VLAN
));

326 
	}
}

328 
	$›“80211_check_cÚcu¼’t_içû
(
›“80211_sub_if_d©a
 *
sd©a
,

329 
Æ80211_iáy³
 
iáy³
)

331 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

332 
›“80211_sub_if_d©a
 *
nsd©a
;

334 
	`ASSERT_RTNL
();

335 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

338 
	`li¡_fÜ_—ch_’Œy
(
nsd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

339 ià(
nsd©a
 !ğ
sd©a
 && 
	`›“80211_sd©a_ruÂšg
(nsdata)) {

343 ià((
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
 &&

344 
nsd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
) ||

345 (
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
 &&

346 
nsd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
))

347  -
EBUSY
;

359 ià(
iáy³
 =ğ
NL80211_IFTYPE_ADHOC
 &&

360 
nsd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

361  -
EBUSY
;

366 ià(
nsd©a
->
vif
.
bss_cÚf
.
c§_aùive
)

367  -
EBUSY
;

373 ià(!
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
,

374 
nsd©a
->
vif
.
addr
))

380 ià(!
	`id’tiÿl_mac_addr_®lowed
(
iáy³
,

381 
nsd©a
->
vif
.
ty³
))

382  -
ENOTUNIQ
;

385 ià(
iáy³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

386 
sd©a
->
wdev
.
u£_4addr
 &&

387 
nsd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 &&

388 
nsd©a
->
vif
.
v®id_lšks
)

389  -
EOPNOTSUPP
;

394 ià(
iáy³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

395 
nsd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

396 
sd©a
->
bss
 = &
nsd©a
->
u
.
­
;

400  
	`›“80211_check_combš©iÚs
(
sd©a
, 
NULL
, 0, 0);

401 
	}
}

403 
	$›“80211_check_queues
(
›“80211_sub_if_d©a
 *
sd©a
,

404 
Æ80211_iáy³
 
iáy³
)

406 
n_queues
 = 
sd©a
->
loÿl
->
hw
.
queues
;

407 
i
;

409 ià(
iáy³
 =ğ
NL80211_IFTYPE_NAN
)

412 ià(
iáy³
 !ğ
NL80211_IFTYPE_P2P_DEVICE
) {

413 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

414 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
hw_queue
[
i
] ==

415 
IEEE80211_INVAL_HW_QUEUE
))

416  -
EINVAL
;

417 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
hw_queue
[
i
] >=

418 
n_queues
))

419  -
EINVAL
;

423 ià((
iáy³
 !ğ
NL80211_IFTYPE_AP
 &&

424 
iáy³
 !ğ
NL80211_IFTYPE_P2P_GO
 &&

425 
iáy³
 !ğ
NL80211_IFTYPE_MESH_POINT
) ||

426 !
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
QUEUE_CONTROL
)) {

427 
sd©a
->
vif
.
ÿb_queue
 = 
IEEE80211_INVAL_HW_QUEUE
;

431 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ÿb_queue
 =ğ
IEEE80211_INVAL_HW_QUEUE
))

432  -
EINVAL
;

434 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ÿb_queue
 >ğ
n_queues
))

435  -
EINVAL
;

438 
	}
}

440 
	$›“80211_İ’
(
Ãt_deviû
 *
dev
)

442 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

443 
”r
;

446 ià(!
	`is_v®id_‘h”_addr
(
dev
->
dev_addr
))

447  -
EADDRNOTAVAIL
;

449 
	`why_lock
(
sd©a
->
loÿl
->
hw
.
why
);

450 
”r
 = 
	`›“80211_check_cÚcu¼’t_içû
(
sd©a
, sd©a->
vif
.
ty³
);

451 ià(
”r
)

452 
out
;

454 
”r
 = 
	`›“80211_do_İ’
(&
sd©a
->
wdev
, 
Œue
);

455 
out
:

456 
	`why_uÆock
(
sd©a
->
loÿl
->
hw
.
why
);

458  
”r
;

459 
	}
}

461 
	$›“80211_do_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
gošg_down
)

463 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

464 
æags
;

465 
sk_buff
 *
skb
, *
tmp
;

466 
u32
 
hw_»cÚf_æags
 = 0;

467 
i
, 
æushed
;

468 
ps_d©a
 *
ps
;

469 
cfg80211_chª_def
 
chªdef
;

470 
boŞ
 
ÿnûl_sÿn
;

471 
cfg80211_Çn_func
 *
func
;

473 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

475 
	`ş—r_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
);

476 
	`synchrÚize_rcu
();

478 
ÿnûl_sÿn
 = 
	`rcu_acûss_poš‹r
(
loÿl
->
sÿn_sd©a
è=ğ
sd©a
;

479 ià(
ÿnûl_sÿn
)

480 
	`›“80211_sÿn_ÿnûl
(
loÿl
);

482 
	`›“80211_roc_purge
(
loÿl
, 
sd©a
);

484 
sd©a
->
vif
.
ty³
) {

485 
NL80211_IFTYPE_STATION
:

486 
	`›“80211_mgd_¡İ
(
sd©a
);

488 
NL80211_IFTYPE_ADHOC
:

489 
	`›“80211_ibss_¡İ
(
sd©a
);

491 
NL80211_IFTYPE_MONITOR
:

492 ià(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_COOK_FRAMES
)

494 
	`li¡_d–_rcu
(&
sd©a
->
u
.
mÁr
.
li¡
);

514 
æushed
 = 
	`¡a_šfo_æush
(
sd©a
, -1);

515 
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 && 
æushed
 > 0);

518 ià(
sd©a
->
æags
 & 
IEEE80211_SDATA_ALLMULTI
)

519 
	`©omic_dec
(&
loÿl
->
iff_®lmuÉis
);

521 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

522 
loÿl
->
fif_p¥Şl
--;

523 
loÿl
->
fif_´obe_»q
--;

524 } ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) {

525 
loÿl
->
fif_´obe_»q
--;

528 ià(
sd©a
->
dev
) {

529 
	`Ãtif_addr_lock_bh
(
sd©a
->
dev
);

530 
	`¥š_lock_bh
(&
loÿl
->
f‹r_lock
);

531 
	`__hw_addr_unsync
(&
loÿl
->
mc_li¡
, &
sd©a
->
dev
->
mc
,

532 
sd©a
->
dev
->
addr_Ën
);

533 
	`¥š_uÆock_bh
(&
loÿl
->
f‹r_lock
);

534 
	`Ãtif_addr_uÆock_bh
(
sd©a
->
dev
);

537 
	`d–_tim”_sync
(&
loÿl
->
dyÇmic_ps_tim”
);

538 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
dyÇmic_ps_’abË_wÜk
);

540 
	`WARN
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
),

542 
sd©a
->
vif
.
v®id_lšks
);

544 
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 = 
çl£
;

545 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

546 
sd©a
->
deæšk
.
u
.
mgd
.
c§_wa™šg_bú
 = 
çl£
;

547 ià(
sd©a
->
c§_blocked_tx
) {

548 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

549 
IEEE80211_QUEUE_STOP_REASON_CSA
);

550 
sd©a
->
c§_blocked_tx
 = 
çl£
;

553 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &
sd©a
->
deæšk
.
c§_fš®ize_wÜk
);

554 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
,

555 &
sd©a
->
deæšk
.
cŞÜ_chªge_fš®ize_wÜk
);

556 
	`why_d–ayed_wÜk_ÿnûl
(
loÿl
->
hw
.
why
,

557 &
sd©a
->
deæšk
.
dfs_ÿc_tim”_wÜk
);

559 ià(
sd©a
->
wdev
.
ÿc_¡¬‹d
) {

560 
chªdef
 = 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
;

561 
	`WARN_ON
(
loÿl
->
su¥’ded
);

562 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

563 
	`cfg80211_ÿc_ev’t
(
sd©a
->
dev
, &
chªdef
,

564 
NL80211_RADAR_CAC_ABORTED
,

565 
GFP_KERNEL
);

568 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

569 
	`WARN_ON
(!
	`li¡_em±y
(&
sd©a
->
u
.
­
.
vÏns
));

570 } ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

572 
ps
 = &
sd©a
->
bss
->ps;

574 
	`¥š_lock_œq§ve
(&
ps
->
bc_buf
.
lock
, 
æags
);

575 
	`skb_queue_w®k_§ã
(&
ps
->
bc_buf
, 
skb
, 
tmp
) {

576 ià(
skb
->
dev
 =ğ
sd©a
->dev) {

577 
	`__skb_uÆšk
(
skb
, &
ps
->
bc_buf
);

578 
loÿl
->
tÙ®_ps_bufã»d
--;

579 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

582 
	`¥š_uÆock_œq»¡Üe
(&
ps
->
bc_buf
.
lock
, 
æags
);

585 ià(
gošg_down
)

586 
loÿl
->
İ’_couÁ
--;

588 
sd©a
->
vif
.
ty³
) {

589 
NL80211_IFTYPE_AP_VLAN
:

590 
	`li¡_d–
(&
sd©a
->
u
.
vÏn
.
li¡
);

591 
	`RCU_INIT_POINTER
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
, 
NULL
);

593 
	`›“80211_ä“_keys
(
sd©a
, 
Œue
);

596 
NL80211_IFTYPE_MONITOR
:

597 ià(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_COOK_FRAMES
) {

598 
loÿl
->
cooked_mÁrs
--;

602 
loÿl
->
mÚ™Üs
--;

603 ià(
loÿl
->
mÚ™Üs
 == 0) {

604 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_MONITOR
;

605 
hw_»cÚf_æags
 |ğ
IEEE80211_CONF_CHANGE_MONITOR
;

608 
	`›“80211_adju¡_mÚ™Ü_æags
(
sd©a
, -1);

610 
NL80211_IFTYPE_NAN
:

612 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

614 
	`idr_fÜ_—ch_’Œy
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
func
, 
i
) {

615 
	`idr_»move
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
i
);

616 
	`cfg80211_ä“_Çn_func
(
func
);

618 
	`idr_de¡roy
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
);

620 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

622 
NL80211_IFTYPE_P2P_DEVICE
:

624 
	`RCU_INIT_POINTER
(
loÿl
->
p2p_sd©a
, 
NULL
);

625 
çÎthrough
;

627 
	`why_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

639 
	`›“80211_ä“_keys
(
sd©a
, 
Œue
);

640 
	`skb_queue_purge
(&
sd©a
->
skb_queue
);

641 
	`skb_queue_purge
(&
sd©a
->
¡©us_queue
);

644 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

645 
i
 = 0; i < 
IEEE80211_MAX_QUEUES
; i++) {

646 
	`skb_queue_w®k_§ã
(&
loÿl
->
³ndšg
[
i
], 
skb
, 
tmp
) {

647 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

648 ià(
šfo
->
cÚŒŞ
.
vif
 =ğ&
sd©a
->vif) {

649 
	`__skb_uÆšk
(
skb
, &
loÿl
->
³ndšg
[
i
]);

650 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

654 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

656 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

657 
	`›“80211_txq_»move_vÏn
(
loÿl
, 
sd©a
);

659 
sd©a
->
bss
 = 
NULL
;

661 ià(
loÿl
->
İ’_couÁ
 == 0)

662 
	`›“80211_ş—r_tx_³ndšg
(
loÿl
);

664 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
 = 0;

675 ià(
loÿl
->
su¥’ded
) {

676 
	`WARN_ON
(
loÿl
->
wowÏn
);

677 
	`WARN_ON
(
	`rcu_acûss_poš‹r
(
loÿl
->
mÚ™Ü_sd©a
));

681 
sd©a
->
vif
.
ty³
) {

682 
NL80211_IFTYPE_AP_VLAN
:

684 
NL80211_IFTYPE_MONITOR
:

685 ià(
loÿl
->
mÚ™Üs
 == 0)

686 
	`›“80211_d–_vœtu®_mÚ™Ü
(
loÿl
);

688 
	`›“80211_»ÿlc_idË
(
loÿl
);

690 ià(!(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
))

693 
çÎthrough
;

695 ià(
gošg_down
)

696 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

699 
	`›“80211_»ÿlc_ps
(
loÿl
);

701 ià(
ÿnûl_sÿn
)

702 
	`why_d–ayed_wÜk_æush
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
);

704 ià(
loÿl
->
İ’_couÁ
 == 0) {

705 
	`›“80211_¡İ_deviû
(
loÿl
);

712 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

713 
	`›“80211_hw_cÚfig
(
loÿl
, 
hw_»cÚf_æags
);

715 ià(
loÿl
->
mÚ™Üs
 =ğloÿl->
İ’_couÁ
)

716 
	`›“80211_add_vœtu®_mÚ™Ü
(
loÿl
);

717 
	}
}

719 
	$›“80211_¡İ_mbssid
(
›“80211_sub_if_d©a
 *
sd©a
)

721 
›“80211_sub_if_d©a
 *
tx_sd©a
, *
nÚ_tx_sd©a
, *
tmp_sd©a
;

722 
›“80211_vif
 *
tx_vif
 = 
sd©a
->
vif
.
mbssid_tx_vif
;

724 ià(!
tx_vif
)

727 
tx_sd©a
 = 
	`vif_to_sd©a
(
tx_vif
);

728 
sd©a
->
vif
.
mbssid_tx_vif
 = 
NULL
;

730 
	`li¡_fÜ_—ch_’Œy_§ã
(
nÚ_tx_sd©a
, 
tmp_sd©a
,

731 &
tx_sd©a
->
loÿl
->
š‹rçûs
, 
li¡
) {

732 ià(
nÚ_tx_sd©a
 !ğ
sd©a
 &&‚Ú_tx_sd©¨!ğ
tx_sd©a
 &&

733 
nÚ_tx_sd©a
->
vif
.
mbssid_tx_vif
 =ğ
tx_vif
 &&

734 
	`›“80211_sd©a_ruÂšg
(
nÚ_tx_sd©a
)) {

735 
nÚ_tx_sd©a
->
vif
.
mbssid_tx_vif
 = 
NULL
;

736 
	`dev_şo£
(
nÚ_tx_sd©a
->
wdev
.
Ãtdev
);

740 ià(
sd©a
 !ğ
tx_sd©a
 && 
	`›“80211_sd©a_ruÂšg
(tx_sdata)) {

741 
tx_sd©a
->
vif
.
mbssid_tx_vif
 = 
NULL
;

742 
	`dev_şo£
(
tx_sd©a
->
wdev
.
Ãtdev
);

744 
	}
}

746 
	$›“80211_¡İ
(
Ãt_deviû
 *
dev
)

748 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

751 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

752 
›“80211_sub_if_d©a
 *
vÏn
, *
tmpsd©a
;

754 
	`li¡_fÜ_—ch_’Œy_§ã
(
vÏn
, 
tmpsd©a
, &
sd©a
->
u
.
­
.
vÏns
,

755 
u
.
vÏn
.
li¡
)

756 
	`dev_şo£
(
vÏn
->
dev
);

758 
	`›“80211_¡İ_mbssid
(
sd©a
);

761 
	`why_lock
(
sd©a
->
loÿl
->
hw
.
why
);

762 
	`why_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
aùiv©e_lšks_wÜk
);

764 
	`›“80211_do_¡İ
(
sd©a
, 
Œue
);

765 
	`why_uÆock
(
sd©a
->
loÿl
->
hw
.
why
);

768 
	}
}

770 
	$›“80211_£t_muÉiÿ¡_li¡
(
Ãt_deviû
 *
dev
)

772 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

773 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

774 
®lmuÉi
, 
sd©a_®lmuÉi
;

776 
®lmuÉi
 = !!(
dev
->
æags
 & 
IFF_ALLMULTI
);

777 
sd©a_®lmuÉi
 = !!(
sd©a
->
æags
 & 
IEEE80211_SDATA_ALLMULTI
);

779 ià(
®lmuÉi
 !ğ
sd©a_®lmuÉi
) {

780 ià(
dev
->
æags
 & 
IFF_ALLMULTI
)

781 
	`©omic_šc
(&
loÿl
->
iff_®lmuÉis
);

783 
	`©omic_dec
(&
loÿl
->
iff_®lmuÉis
);

784 
sd©a
->
æags
 ^ğ
IEEE80211_SDATA_ALLMULTI
;

787 
	`¥š_lock_bh
(&
loÿl
->
f‹r_lock
);

788 
	`__hw_addr_sync
(&
loÿl
->
mc_li¡
, &
dev
->
mc
, dev->
addr_Ën
);

789 
	`¥š_uÆock_bh
(&
loÿl
->
f‹r_lock
);

790 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
»cÚfig_f‹r
);

791 
	}
}

797 
	$›“80211_‹¬down_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

800 
	`›“80211_ä“_keys
(
sd©a
, 
çl£
);

802 
	`›“80211_debugfs_»move_Ãtdev
(
sd©a
);

804 
	`›“80211_de¡roy_äag_ÿche
(&
sd©a
->
äags
);

806 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

807 
	`›“80211_mesh_‹¬down_sd©a
(
sd©a
);

809 
	`›“80211_vif_ş—r_lšks
(
sd©a
);

810 
	`›“80211_lšk_¡İ
(&
sd©a
->
deæšk
);

811 
	}
}

813 
	$›“80211_unš™
(
Ãt_deviû
 *
dev
)

815 
	`›“80211_‹¬down_sd©a
(
	`IEEE80211_DEV_TO_SUB_IF
(
dev
));

816 
	}
}

819 
	$›“80211_g‘_¡©s64
(
Ãt_deviû
 *
dev
, 
¹Æ_lšk_¡©s64
 *
¡©s
)

821 
	`dev_ãtch_sw_Ãt¡©s
(
¡©s
, 
dev
->
t¡©s
);

822 
	}
}

824 
	$›“80211_Ãtdev_£tup_tc
(
Ãt_deviû
 *
dev
,

825 
tc_£tup_ty³
 
ty³
, *
ty³_d©a
)

827 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

828 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

830  
	`drv_Ãt_£tup_tc
(
loÿl
, 
sd©a
, 
dev
, 
ty³
, 
ty³_d©a
);

831 
	}
}

833 cÚ¡ 
Ãt_deviû_İs
 
	g›“80211_d©aif_İs
 = {

834 .
ndo_İ’
 = 
›“80211_İ’
,

835 .
	gndo_¡İ
 = 
›“80211_¡İ
,

836 .
	gndo_unš™
 = 
›“80211_unš™
,

837 .
	gndo_¡¬t_xm™
 = 
›“80211_subif_¡¬t_xm™
,

838 .
	gndo_£t_rx_mode
 = 
›“80211_£t_muÉiÿ¡_li¡
,

839 .
	gndo_£t_mac_add»ss
 = 
›“80211_chªge_mac
,

840 .
	gndo_g‘_¡©s64
 = 
›“80211_g‘_¡©s64
,

841 .
	gndo_£tup_tc
 = 
›“80211_Ãtdev_£tup_tc
,

844 
u16
 
	$›“80211_mÚ™Ü_£Ëù_queue
(
Ãt_deviû
 *
dev
,

845 
sk_buff
 *
skb
,

846 
Ãt_deviû
 *
sb_dev
)

848 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

849 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

850 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

851 
›“80211_hdr
 *
hdr
;

852 
Ën_¹hdr
;

854 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

858 
	`mem£t
(
šfo
, 0, (*info));

860 ià(!
	`›“80211_·r£_tx_¿diÙ­
(
skb
, 
dev
))

863 
Ën_¹hdr
 = 
	`›“80211_g‘_¿diÙ­_Ën
(
skb
->
d©a
);

864 
hdr
 = (
›“80211_hdr
 *)(
skb
->
d©a
 + 
Ën_¹hdr
);

865 ià(
skb
->
Ën
 < 
Ën_¹hdr
 + 2 ||

866 
skb
->
Ën
 < 
Ën_¹hdr
 + 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
))

869  
	`›“80211_£Ëù_queue_80211
(
sd©a
, 
skb
, 
hdr
);

870 
	}
}

872 cÚ¡ 
Ãt_deviû_İs
 
	g›“80211_mÚ™Üif_İs
 = {

873 .
ndo_İ’
 = 
›“80211_İ’
,

874 .
	gndo_¡İ
 = 
›“80211_¡İ
,

875 .
	gndo_unš™
 = 
›“80211_unš™
,

876 .
	gndo_¡¬t_xm™
 = 
›“80211_mÚ™Ü_¡¬t_xm™
,

877 .
	gndo_£t_rx_mode
 = 
›“80211_£t_muÉiÿ¡_li¡
,

878 .
	gndo_£t_mac_add»ss
 = 
›“80211_chªge_mac
,

879 .
	gndo_£Ëù_queue
 = 
›“80211_mÚ™Ü_£Ëù_queue
,

880 .
	gndo_g‘_¡©s64
 = 
›“80211_g‘_¡©s64
,

883 
	$›“80211_Ãtdev_fl_fÜw¬d_·th
(
Ãt_deviû_·th_ùx
 *
ùx
,

884 
Ãt_deviû_·th
 *
·th
)

886 
›“80211_sub_if_d©a
 *
sd©a
;

887 
›“80211_loÿl
 *
loÿl
;

888 
¡a_šfo
 *
¡a
;

889 
»t
 = -
ENOENT
;

891 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
ùx
->
dev
);

892 
loÿl
 = 
sd©a
->local;

894 ià(!
loÿl
->
İs
->
Ãt_fl_fÜw¬d_·th
)

895  -
EOPNOTSUPP
;

897 
	`rcu_»ad_lock
();

898 
sd©a
->
vif
.
ty³
) {

899 
NL80211_IFTYPE_AP_VLAN
:

900 
¡a
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
vÏn
.sta);

901 ià(
¡a
)

903 ià(
sd©a
->
wdev
.
u£_4addr
)

904 
out
;

905 ià(
	`is_muÉiÿ¡_‘h”_addr
(
ùx
->
daddr
))

906 
out
;

907 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
ùx
->
daddr
);

909 
NL80211_IFTYPE_AP
:

910 ià(
	`is_muÉiÿ¡_‘h”_addr
(
ùx
->
daddr
))

911 
out
;

912 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
ùx
->
daddr
);

914 
NL80211_IFTYPE_STATION
:

915 ià(
sd©a
->
wdev
.
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_TDLS
) {

916 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
ùx
->
daddr
);

917 ià(
¡a
 && 
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_TDLS_PEER
)) {

918 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER_AUTH
))

919 
out
;

925 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
deæšk
.
u
.
mgd
.
bssid
);

928 
out
;

931 ià(!
¡a
)

932 
out
;

934 
»t
 = 
	`drv_Ãt_fl_fÜw¬d_·th
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
ùx
, 
·th
);

935 
out
:

936 
	`rcu_»ad_uÆock
();

938  
»t
;

939 
	}
}

941 cÚ¡ 
Ãt_deviû_İs
 
	g›“80211_d©aif_8023_İs
 = {

942 .
ndo_İ’
 = 
›“80211_İ’
,

943 .
	gndo_¡İ
 = 
›“80211_¡İ
,

944 .
	gndo_unš™
 = 
›“80211_unš™
,

945 .
	gndo_¡¬t_xm™
 = 
›“80211_subif_¡¬t_xm™_8023
,

946 .
	gndo_£t_rx_mode
 = 
›“80211_£t_muÉiÿ¡_li¡
,

947 .
	gndo_£t_mac_add»ss
 = 
›“80211_chªge_mac
,

948 .
	gndo_g‘_¡©s64
 = 
›“80211_g‘_¡©s64
,

949 .
	gndo_fl_fÜw¬d_·th
 = 
›“80211_Ãtdev_fl_fÜw¬d_·th
,

950 .
	gndo_£tup_tc
 = 
›“80211_Ãtdev_£tup_tc
,

953 
boŞ
 
	$›“80211_iáy³_suµÜts_hdr_ofæßd
(
Æ80211_iáy³
 
iáy³
)

955 
iáy³
) {

957 
NL80211_IFTYPE_AP
:

958 
NL80211_IFTYPE_STATION
:

959  
Œue
;

961  
çl£
;

963 
	}
}

965 
boŞ
 
	$›“80211_£t_sd©a_ofæßd_æags
(
›“80211_sub_if_d©a
 *
sd©a
)

967 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

968 
u32
 
æags
;

970 
æags
 = 
sd©a
->
vif
.
ofæßd_æags
;

972 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_TX_ENCAP_OFFLOAD
) &&

973 
	`›“80211_iáy³_suµÜts_hdr_ofæßd
(
sd©a
->
vif
.
ty³
)) {

974 
æags
 |ğ
IEEE80211_OFFLOAD_ENCAP_ENABLED
;

976 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_TX_FRAG
) &&

977 
loÿl
->
hw
.
why
->
äag_th»shŞd
 !ğ(
u32
)-1)

978 
æags
 &ğ~
IEEE80211_OFFLOAD_ENCAP_ENABLED
;

980 ià(
loÿl
->
mÚ™Üs
)

981 
æags
 &ğ~
IEEE80211_OFFLOAD_ENCAP_ENABLED
;

983 
æags
 &ğ~
IEEE80211_OFFLOAD_ENCAP_ENABLED
;

986 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_RX_DECAP_OFFLOAD
) &&

987 
	`›“80211_iáy³_suµÜts_hdr_ofæßd
(
sd©a
->
vif
.
ty³
)) {

988 
æags
 |ğ
IEEE80211_OFFLOAD_DECAP_ENABLED
;

990 ià(
loÿl
->
mÚ™Üs
 &&

991 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_CONC_MON_RX_DECAP
))

992 
æags
 &ğ~
IEEE80211_OFFLOAD_DECAP_ENABLED
;

994 
æags
 &ğ~
IEEE80211_OFFLOAD_DECAP_ENABLED
;

997 ià(
sd©a
->
vif
.
ofæßd_æags
 =ğ
æags
)

998  
çl£
;

1000 
sd©a
->
vif
.
ofæßd_æags
 = 
æags
;

1001 
	`›“80211_check_ç¡_rx_içû
(
sd©a
);

1002  
Œue
;

1003 
	}
}

1005 
	$›“80211_£t_vif_’ÿp_İs
(
›“80211_sub_if_d©a
 *
sd©a
)

1007 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1008 
›“80211_sub_if_d©a
 *
bss
 = 
sd©a
;

1009 
boŞ
 
’abËd
;

1011 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

1012 ià(!
sd©a
->
bss
)

1015 
bss
 = 
	`cÚš”_of
(
sd©a
->bss, 
›“80211_sub_if_d©a
, 
u
.
­
);

1018 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_TX_ENCAP_OFFLOAD
) ||

1019 !
	`›“80211_iáy³_suµÜts_hdr_ofæßd
(
bss
->
vif
.
ty³
))

1022 
’abËd
 = 
bss
->
vif
.
ofæßd_æags
 & 
IEEE80211_OFFLOAD_ENCAP_ENABLED
;

1023 ià(
sd©a
->
wdev
.
u£_4addr
 &&

1024 !(
bss
->
vif
.
ofæßd_æags
 & 
IEEE80211_OFFLOAD_ENCAP_4ADDR
))

1025 
’abËd
 = 
çl£
;

1027 
sd©a
->
dev
->
Ãtdev_İs
 = 
’abËd
 ? &
›“80211_d©aif_8023_İs
 :

1028 &
›“80211_d©aif_İs
;

1029 
	}
}

1031 
	$›“80211_»ÿlc_sd©a_ofæßd
(
›“80211_sub_if_d©a
 *
sd©a
)

1033 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1034 
›“80211_sub_if_d©a
 *
vsd©a
;

1036 ià(
	`›“80211_£t_sd©a_ofæßd_æags
(
sd©a
)) {

1037 
	`drv_upd©e_vif_ofæßd
(
loÿl
, 
sd©a
);

1038 
	`›“80211_£t_vif_’ÿp_İs
(
sd©a
);

1041 
	`li¡_fÜ_—ch_’Œy
(
vsd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1042 ià(
vsd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 ||

1043 
vsd©a
->
bss
 !ğ&
sd©a
->
u
.
­
)

1046 
	`›“80211_£t_vif_’ÿp_İs
(
vsd©a
);

1048 
	}
}

1050 
	$›“80211_»ÿlc_ofæßd
(
›“80211_loÿl
 *
loÿl
)

1052 
›“80211_sub_if_d©a
 *
sd©a
;

1054 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_TX_ENCAP_OFFLOAD
))

1057 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1059 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1060 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1063 
	`›“80211_»ÿlc_sd©a_ofæßd
(
sd©a
);

1065 
	}
}

1067 
	$›“80211_adju¡_mÚ™Ü_æags
(
›“80211_sub_if_d©a
 *
sd©a
,

1068 cÚ¡ 
off£t
)

1070 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1071 
u32
 
æags
 = 
sd©a
->
u
.
mÁr
.flags;

1073 
	#ADJUST
(
_f
, 
_s
) do { \

1074 ià(
æags
 & 
MONITOR_FLAG_
##
_f
) \

1075 
loÿl
->
fif_
##
_s
 +ğ
off£t
; \

1076 } 0)

	)

1078 
	`ADJUST
(
FCSFAIL
, 
fcsç
);

1079 
	`ADJUST
(
PLCPFAIL
, 
¶ıç
);

1080 
	`ADJUST
(
CONTROL
, 
cÚŒŞ
);

1081 
	`ADJUST
(
CONTROL
, 
p¥Şl
);

1082 
	`ADJUST
(
OTHER_BSS
, 
Ùh”_bss
);

1084 #undeà
ADJUST


1085 
	}
}

1087 
	$›“80211_£t_deçuÉ_queues
(
›“80211_sub_if_d©a
 *
sd©a
)

1089 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1090 
i
;

1092 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

1093 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
))

1094 
sd©a
->
vif
.
hw_queue
[
i
] = 
IEEE80211_INVAL_HW_QUEUE
;

1095 ià(
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
)

1096 
sd©a
->
vif
.
hw_queue
[
i
] = i;

1098 
sd©a
->
vif
.
hw_queue
[
i
] = 0;

1100 
sd©a
->
vif
.
ÿb_queue
 = 
IEEE80211_INVAL_HW_QUEUE
;

1101 
	}
}

1103 
	$›“80211_sd©a_š™
(
›“80211_loÿl
 *
loÿl
,

1104 
›“80211_sub_if_d©a
 *
sd©a
)

1106 
sd©a
->
loÿl
 =†ocal;

1116 
	`›“80211_lšk_š™
(
sd©a
, -1, &sd©a->
deæšk
, &sd©a->
vif
.
bss_cÚf
);

1117 
	}
}

1119 
	$›“80211_add_vœtu®_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
)

1121 
›“80211_sub_if_d©a
 *
sd©a
;

1122 
»t
;

1124 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
WANT_MONITOR_VIF
))

1127 
	`ASSERT_RTNL
();

1128 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1130 ià(
loÿl
->
mÚ™Ü_sd©a
)

1133 
sd©a
 = 
	`kz®loc
((*sd©aè+ 
loÿl
->
hw
.
vif_d©a_size
, 
GFP_KERNEL
);

1134 ià(!
sd©a
)

1135  -
ENOMEM
;

1138 
sd©a
->
vif
.
ty³
 = 
NL80211_IFTYPE_MONITOR
;

1139 
	`¢´štf
(
sd©a
->
Çme
, 
IFNAMSIZ
, "%s-monitor",

1140 
	`why_Çme
(
loÿl
->
hw
.
why
));

1141 
sd©a
->
wdev
.
iáy³
 = 
NL80211_IFTYPE_MONITOR
;

1142 
sd©a
->
wdev
.
why
 = 
loÿl
->
hw
.wiphy;

1144 
	`›“80211_sd©a_š™
(
loÿl
, 
sd©a
);

1146 
	`›“80211_£t_deçuÉ_queues
(
sd©a
);

1148 
»t
 = 
	`drv_add_š‹rçû
(
loÿl
, 
sd©a
);

1149 ià(
	`WARN_ON
(
»t
)) {

1151 
	`kä“
(
sd©a
);

1152  
»t
;

1155 
	`£t_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
);

1157 
»t
 = 
	`›“80211_check_queues
(
sd©a
, 
NL80211_IFTYPE_MONITOR
);

1158 ià(
»t
) {

1159 
	`kä“
(
sd©a
);

1160  
»t
;

1163 
	`mu‹x_lock
(&
loÿl
->
iæi¡_mtx
);

1164 
	`rcu_assign_poš‹r
(
loÿl
->
mÚ™Ü_sd©a
, 
sd©a
);

1165 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

1167 
»t
 = 
	`›“80211_lšk_u£_chªÃl
(&
sd©a
->
deæšk
, &
loÿl
->
mÚ™Ü_chª»q
,

1168 
IEEE80211_CHANCTX_EXCLUSIVE
);

1169 ià(
»t
) {

1170 
	`mu‹x_lock
(&
loÿl
->
iæi¡_mtx
);

1171 
	`RCU_INIT_POINTER
(
loÿl
->
mÚ™Ü_sd©a
, 
NULL
);

1172 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

1173 
	`synchrÚize_Ãt
();

1174 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

1175 
	`kä“
(
sd©a
);

1176  
»t
;

1179 
	`skb_queue_h—d_š™
(&
sd©a
->
skb_queue
);

1180 
	`skb_queue_h—d_š™
(&
sd©a
->
¡©us_queue
);

1181 
	`why_wÜk_š™
(&
sd©a
->
wÜk
, 
›“80211_içû_wÜk
);

1184 
	}
}

1186 
	$›“80211_d–_vœtu®_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
)

1188 
›“80211_sub_if_d©a
 *
sd©a
;

1190 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
WANT_MONITOR_VIF
))

1193 
	`ASSERT_RTNL
();

1194 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1196 
	`mu‹x_lock
(&
loÿl
->
iæi¡_mtx
);

1198 
sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->
mÚ™Ü_sd©a
,

1199 
	`lockd•_is_h–d
(&
loÿl
->
iæi¡_mtx
));

1200 ià(!
sd©a
) {

1201 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

1205 
	`RCU_INIT_POINTER
(
loÿl
->
mÚ™Ü_sd©a
, 
NULL
);

1206 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

1208 
	`synchrÚize_Ãt
();

1210 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

1212 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

1214 
	`kä“
(
sd©a
);

1215 
	}
}

1222 
	$›“80211_do_İ’
(
wœ–ess_dev
 *
wdev
, 
boŞ
 
comšg_up
)

1224 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

1225 
Ãt_deviû
 *
dev
 = 
wdev
->
Ãtdev
;

1226 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1227 
u64
 
chªged
 = 0;

1228 
»s
;

1229 
u32
 
hw_»cÚf_æags
 = 0;

1231 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1233 
sd©a
->
vif
.
ty³
) {

1234 
NL80211_IFTYPE_AP_VLAN
: {

1235 
›“80211_sub_if_d©a
 *
ma¡”
;

1237 ià(!
sd©a
->
bss
)

1238  -
ENOLINK
;

1240 
	`li¡_add
(&
sd©a
->
u
.
vÏn
.
li¡
, &sd©a->
bss
->
vÏns
);

1242 
ma¡”
 = 
	`cÚš”_of
(
sd©a
->
bss
,

1243 
›“80211_sub_if_d©a
, 
u
.
­
);

1244 
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 =

1245 
ma¡”
->
cÚŒŞ_pÜt_´ÙocŞ
;

1246 
sd©a
->
cÚŒŞ_pÜt_no_’üy±
 =

1247 
ma¡”
->
cÚŒŞ_pÜt_no_’üy±
;

1248 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
 =

1249 
ma¡”
->
cÚŒŞ_pÜt_ov”_Æ80211
;

1250 
sd©a
->
cÚŒŞ_pÜt_no_´—uth
 =

1251 
ma¡”
->
cÚŒŞ_pÜt_no_´—uth
;

1252 
sd©a
->
vif
.
ÿb_queue
 = 
ma¡”
->vif.cab_queue;

1253 
	`memıy
(
sd©a
->
vif
.
hw_queue
, 
ma¡”
->vif.hw_queue,

1254 (
sd©a
->
vif
.
hw_queue
));

1255 
sd©a
->
vif
.
bss_cÚf
.
chª»q
 = 
ma¡”
->vif.bss_conf.chanreq;

1257 
sd©a
->
üy±o_tx_room_Ãeded_út
 +=

1258 
ma¡”
->
üy±o_tx_room_Ãeded_út
;

1262 
NL80211_IFTYPE_AP
:

1263 
sd©a
->
bss
 = &sd©a->
u
.
­
;

1265 
NL80211_IFTYPE_MESH_POINT
:

1266 
NL80211_IFTYPE_STATION
:

1267 
NL80211_IFTYPE_MONITOR
:

1268 
NL80211_IFTYPE_ADHOC
:

1269 
NL80211_IFTYPE_P2P_DEVICE
:

1270 
NL80211_IFTYPE_OCB
:

1271 
NL80211_IFTYPE_NAN
:

1274 
NL80211_IFTYPE_UNSPECIFIED
:

1275 
NUM_NL80211_IFTYPES
:

1276 
NL80211_IFTYPE_P2P_CLIENT
:

1277 
NL80211_IFTYPE_P2P_GO
:

1278 
NL80211_IFTYPE_WDS
:

1280 
	`WARN_ON
(1);

1284 ià(
loÿl
->
İ’_couÁ
 == 0) {

1286 
loÿl
->
»cÚfig_çu»
 = 
çl£
;

1288 
»s
 = 
	`drv_¡¬t
(
loÿl
);

1289 ià(
»s
)

1290 
”r_d–_bss
;

1291 
	`›“80211_Ëd_¿dio
(
loÿl
, 
Œue
);

1292 
	`›“80211_mod_t_Ëd_Œig
(
loÿl
,

1293 
IEEE80211_TPT_LEDTRIG_FL_RADIO
, 0);

1300 ià(
dev
 && 
	`is_z”o_‘h”_addr
(dev->
dev_addr
)) {

1301 
	`‘h_hw_addr_£t
(
dev
, 
loÿl
->
hw
.
why
->
³rm_addr
);

1302 
	`memıy
(
dev
->
³rm_addr
, dev->
dev_addr
, 
ETH_ALEN
);

1304 ià(!
	`is_v®id_‘h”_addr
(
dev
->
dev_addr
)) {

1305 
»s
 = -
EADDRNOTAVAIL
;

1306 
”r_¡İ
;

1310 
sd©a
->
vif
.
ty³
) {

1311 
NL80211_IFTYPE_AP_VLAN
:

1313 ià(
sd©a
->
bss
->
aùive
) {

1314 
	`›“80211_lšk_vÏn_cİy_chªùx
(&
sd©a
->
deæšk
);

1315 
	`Ãtif_ÿ¼›r_Ú
(
dev
);

1316 
	`›“80211_£t_vif_’ÿp_İs
(
sd©a
);

1318 
	`Ãtif_ÿ¼›r_off
(
dev
);

1321 
NL80211_IFTYPE_MONITOR
:

1322 ià(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_COOK_FRAMES
) {

1323 
loÿl
->
cooked_mÁrs
++;

1327 ià(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
) {

1328 
»s
 = 
	`drv_add_š‹rçû
(
loÿl
, 
sd©a
);

1329 ià(
»s
)

1330 
”r_¡İ
;

1331 } ià(
loÿl
->
mÚ™Üs
 =ğ0 &&†oÿl->
İ’_couÁ
 == 0) {

1332 
»s
 = 
	`›“80211_add_vœtu®_mÚ™Ü
(
loÿl
);

1333 ià(
»s
)

1334 
”r_¡İ
;

1338 
loÿl
->
mÚ™Üs
++;

1339 ià(
loÿl
->
mÚ™Üs
 == 1) {

1340 
loÿl
->
hw
.
cÚf
.
æags
 |ğ
IEEE80211_CONF_MONITOR
;

1341 
hw_»cÚf_æags
 |ğ
IEEE80211_CONF_CHANGE_MONITOR
;

1344 
	`›“80211_adju¡_mÚ™Ü_æags
(
sd©a
, 1);

1345 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

1346 
	`›“80211_»ÿlc_ofæßd
(
loÿl
);

1347 
	`›“80211_»ÿlc_idË
(
loÿl
);

1349 
	`Ãtif_ÿ¼›r_Ú
(
dev
);

1352 ià(
comšg_up
) {

1353 
	`›“80211_d–_vœtu®_mÚ™Ü
(
loÿl
);

1354 
	`›“80211_£t_sd©a_ofæßd_æags
(
sd©a
);

1356 
»s
 = 
	`drv_add_š‹rçû
(
loÿl
, 
sd©a
);

1357 ià(
»s
)

1358 
”r_¡İ
;

1360 
	`›“80211_£t_vif_’ÿp_İs
(
sd©a
);

1361 
»s
 = 
	`›“80211_check_queues
(
sd©a
,

1362 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
));

1363 ià(
»s
)

1364 
”r_d–_š‹rçû
;

1367 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

1368 
loÿl
->
fif_p¥Şl
++;

1369 
loÿl
->
fif_´obe_»q
++;

1371 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

1372 } ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) {

1373 
loÿl
->
fif_´obe_»q
++;

1376 ià(
sd©a
->
vif
.
´obe_»q_»g
)

1377 
	`drv_cÚfig_içû_f‹r
(
loÿl
, 
sd©a
,

1378 
FIF_PROBE_REQ
,

1379 
FIF_PROBE_REQ
);

1381 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_P2P_DEVICE
 &&

1382 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_NAN
)

1383 
chªged
 |ğ
	`›“80211_»£t_”p_šfo
(
sd©a
);

1384 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

1385 
chªged
);

1387 
sd©a
->
vif
.
ty³
) {

1388 
NL80211_IFTYPE_STATION
:

1389 
NL80211_IFTYPE_ADHOC
:

1390 
NL80211_IFTYPE_AP
:

1391 
NL80211_IFTYPE_MESH_POINT
:

1392 
NL80211_IFTYPE_OCB
:

1393 
	`Ãtif_ÿ¼›r_off
(
dev
);

1395 
NL80211_IFTYPE_P2P_DEVICE
:

1396 
NL80211_IFTYPE_NAN
:

1400 
	`WARN_ON
(1);

1409 
	`›“80211_£t_wmm_deçuÉ
(&
sd©a
->
deæšk
, 
Œue
,

1410 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
);

1413 
sd©a
->
vif
.
ty³
) {

1414 
NL80211_IFTYPE_P2P_DEVICE
:

1415 
	`rcu_assign_poš‹r
(
loÿl
->
p2p_sd©a
, 
sd©a
);

1417 
NL80211_IFTYPE_MONITOR
:

1418 ià(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_COOK_FRAMES
)

1420 
	`li¡_add__rcu
(&
sd©a
->
u
.
mÁr
.
li¡
, &
loÿl
->
mÚ_li¡
);

1431 ià(
sd©a
->
æags
 & 
IEEE80211_SDATA_ALLMULTI
)

1432 
	`©omic_šc
(&
loÿl
->
iff_®lmuÉis
);

1434 ià(
comšg_up
)

1435 
loÿl
->
İ’_couÁ
++;

1437 ià(
loÿl
->
İ’_couÁ
 == 1)

1438 
	`›“80211_hw_cÚf_š™
(
loÿl
);

1439 ià(
hw_»cÚf_æags
)

1440 
	`›“80211_hw_cÚfig
(
loÿl
, 
hw_»cÚf_æags
);

1442 
	`›“80211_»ÿlc_ps
(
loÿl
);

1444 
	`£t_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
);

1447 
”r_d–_š‹rçû
:

1448 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

1449 
”r_¡İ
:

1450 ià(!
loÿl
->
İ’_couÁ
)

1451 
	`drv_¡İ
(
loÿl
);

1452 
”r_d–_bss
:

1453 
sd©a
->
bss
 = 
NULL
;

1454 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

1455 
	`li¡_d–
(&
sd©a
->
u
.
vÏn
.
li¡
);

1457 
	`ş—r_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
);

1458  
»s
;

1459 
	}
}

1461 
	$›“80211_if_ä“
(
Ãt_deviû
 *
dev
)

1463 
	`ä“_³rıu
(
dev
->
t¡©s
);

1464 
	}
}

1466 
	$›“80211_if_£tup
(
Ãt_deviû
 *
dev
)

1468 
	`‘h”_£tup
(
dev
);

1469 
dev
->
´iv_æags
 &ğ~
IFF_TX_SKB_SHARING
;

1470 
dev
->
´iv_æags
 |ğ
IFF_NO_QUEUE
;

1471 
dev
->
Ãtdev_İs
 = &
›“80211_d©aif_İs
;

1472 
dev
->
Ãeds_ä“_Ãtdev
 = 
Œue
;

1473 
dev
->
´iv_de¡ruùÜ
 = 
›“80211_if_ä“
;

1474 
	}
}

1476 
	$›“80211_içû_´oûss_skb
(
›“80211_loÿl
 *
loÿl
,

1477 
›“80211_sub_if_d©a
 *
sd©a
,

1478 
sk_buff
 *
skb
)

1480 
›“80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

1482 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1484 ià(
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) &&

1485 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_BACK
) {

1486 
¡a_šfo
 *
¡a
;

1487 
Ën
 = 
skb
->len;

1489 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
§
);

1490 ià(
¡a
) {

1491 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
aùiÚ_code
) {

1492 
WLAN_ACTION_ADDBA_REQ
:

1493 
	`›“80211_´oûss_addba_»que¡
(
loÿl
, 
¡a
,

1494 
mgmt
, 
Ën
);

1496 
WLAN_ACTION_ADDBA_RESP
:

1497 
	`›“80211_´oûss_addba_»¥
(
loÿl
, 
¡a
,

1498 
mgmt
, 
Ën
);

1500 
WLAN_ACTION_DELBA
:

1501 
	`›“80211_´oûss_d–ba
(
sd©a
, 
¡a
,

1502 
mgmt
, 
Ën
);

1505 
	`WARN_ON
(1);

1509 } ià(
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) &&

1510 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_VHT
) {

1511 
mgmt
->
u
.
aùiÚ
.u.
vht_group_nÙif
.
aùiÚ_code
) {

1512 
WLAN_VHT_ACTION_OPMODE_NOTIF
: {

1513 
›“80211_rx_¡©us
 *
¡©us
;

1514 
Æ80211_bªd
 
bªd
;

1515 
¡a_šfo
 *
¡a
;

1516 
u8
 
İmode
;

1518 
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1519 
bªd
 = 
¡©us
->band;

1520 
İmode
 = 
mgmt
->
u
.
aùiÚ
.u.
vht_İmode_nÙif
.
İ”©šg_mode
;

1522 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
§
);

1524 ià(
¡a
)

1525 
	`›“80211_vht_hªdË_İmode
(
sd©a
,

1526 &
¡a
->
deæšk
,

1527 
İmode
, 
bªd
);

1531 
WLAN_VHT_ACTION_GROUPID_MGMT
:

1532 
	`›“80211_´oûss_mu_groups
(
sd©a
, &sd©a->
deæšk
,

1533 
mgmt
);

1536 
	`WARN_ON
(1);

1539 } ià(
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) &&

1540 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_S1G
) {

1541 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
) {

1542 
WLAN_S1G_TWT_TEARDOWN
:

1543 
WLAN_S1G_TWT_SETUP
:

1544 
	`›“80211_s1g_rx_twt_aùiÚ
(
sd©a
, 
skb
);

1549 } ià(
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) &&

1550 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_PROTECTED_EHT
) {

1551 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

1552 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.
aùiÚ_code
) {

1553 
WLAN_PROTECTED_EHT_ACTION_TTLM_REQ
:

1554 
	`›“80211_´oûss_Ãg_‰lm_»q
(
sd©a
, 
mgmt
,

1555 
skb
->
Ën
);

1557 
WLAN_PROTECTED_EHT_ACTION_TTLM_RES
:

1558 
	`›“80211_´oûss_Ãg_‰lm_»s
(
sd©a
, 
mgmt
,

1559 
skb
->
Ën
);

1565 } ià(
	`›“80211_is_ext
(
mgmt
->
äame_cÚŒŞ
)) {

1566 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

1567 
	`›“80211_¡a_rx_queued_ext
(
sd©a
, 
skb
);

1569 
	`WARN_ON
(1);

1570 } ià(
	`›“80211_is_d©a_qos
(
mgmt
->
äame_cÚŒŞ
)) {

1571 
›“80211_hdr
 *
hdr
 = (*)
mgmt
;

1572 
¡a_šfo
 *
¡a
;

1582 
	`WARN_ON
(
hdr
->
äame_cÚŒŞ
 &

1583 
	`ıu_to_Ë16
(
IEEE80211_STYPE_NULLFUNC
));

1584 
	`WARN_ON
(!(
hdr
->
£q_ù¾
 &

1585 
	`ıu_to_Ë16
(
IEEE80211_SCTL_FRAG
)));

1591 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
§
);

1592 ià(
¡a
) {

1593 
u16
 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

1595 
	`__›“80211_¡İ_rx_ba_£ssiÚ
(

1596 
¡a
, 
tid
, 
WLAN_BACK_RECIPIENT
,

1597 
WLAN_REASON_QSTA_REQUIRE_SETUP
,

1598 
Œue
);

1600 } 
sd©a
->
vif
.
ty³
) {

1601 
NL80211_IFTYPE_STATION
:

1602 
	`›“80211_¡a_rx_queued_mgmt
(
sd©a
, 
skb
);

1604 
NL80211_IFTYPE_ADHOC
:

1605 
	`›“80211_ibss_rx_queued_mgmt
(
sd©a
, 
skb
);

1607 
NL80211_IFTYPE_MESH_POINT
:

1608 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

1610 
	`›“80211_mesh_rx_queued_mgmt
(
sd©a
, 
skb
);

1613 
	`WARN
(1, "frame for unexpected interfaceype");

1616 
	}
}

1618 
	$›“80211_içû_´oûss_¡©us
(
›“80211_sub_if_d©a
 *
sd©a
,

1619 
sk_buff
 *
skb
)

1621 
›“80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

1623 ià(
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) &&

1624 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_S1G
) {

1625 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
) {

1626 
WLAN_S1G_TWT_TEARDOWN
:

1627 
WLAN_S1G_TWT_SETUP
:

1628 
	`›“80211_s1g_¡©us_twt_aùiÚ
(
sd©a
, 
skb
);

1634 
	}
}

1636 
	$›“80211_içû_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
)

1638 
›“80211_sub_if_d©a
 *
sd©a
 =

1639 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
, work);

1640 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1641 
sk_buff
 *
skb
;

1643 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1646 ià(
	`‹¡_b™
(
SCAN_SW_SCANNING
, &
loÿl
->
sÿÂšg
))

1649 ià(!
	`›“80211_ÿn_run_wÜk”
(
loÿl
))

1653 (
skb
 = 
	`skb_dequeue
(&
sd©a
->
skb_queue
))) {

1654 
	`kcov_»mÙe_¡¬t_commÚ
(
	`skb_g‘_kcov_hªdË
(
skb
));

1656 ià(
skb
->
´ÙocŞ
 =ğ
	`ıu_to_be16
(
ETH_P_TDLS
))

1657 
	`›“80211_´oûss_tdls_chªÃl_sw™ch
(
sd©a
, 
skb
);

1659 
	`›“80211_içû_´oûss_skb
(
loÿl
, 
sd©a
, 
skb
);

1661 
	`kä“_skb
(
skb
);

1662 
	`kcov_»mÙe_¡İ
();

1666 (
skb
 = 
	`skb_dequeue
(&
sd©a
->
¡©us_queue
))) {

1667 
	`kcov_»mÙe_¡¬t_commÚ
(
	`skb_g‘_kcov_hªdË
(
skb
));

1669 
	`›“80211_içû_´oûss_¡©us
(
sd©a
, 
skb
);

1670 
	`kä“_skb
(
skb
);

1672 
	`kcov_»mÙe_¡İ
();

1676 
sd©a
->
vif
.
ty³
) {

1677 
NL80211_IFTYPE_STATION
:

1678 
	`›“80211_¡a_wÜk
(
sd©a
);

1680 
NL80211_IFTYPE_ADHOC
:

1681 
	`›“80211_ibss_wÜk
(
sd©a
);

1683 
NL80211_IFTYPE_MESH_POINT
:

1684 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

1686 
	`›“80211_mesh_wÜk
(
sd©a
);

1688 
NL80211_IFTYPE_OCB
:

1689 
	`›“80211_ocb_wÜk
(
sd©a
);

1694 
	}
}

1696 
	$›“80211_aùiv©e_lšks_wÜk
(
why
 *wiphy,

1697 
why_wÜk
 *
wÜk
)

1699 
›“80211_sub_if_d©a
 *
sd©a
 =

1700 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

1701 
aùiv©e_lšks_wÜk
);

1703 
	`›“80211_£t_aùive_lšks
(&
sd©a
->
vif
, sd©a->
desœed_aùive_lšks
);

1704 
	}
}

1709 
	$›“80211_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
,

1710 
Æ80211_iáy³
 
ty³
)

1712 cÚ¡ 
u8
 
bssid_wdÿrd
[
ETH_ALEN
] = {0xff, 0xff, 0xff,

1716 
	`mem£t
(&
sd©a
->
u
, 0, (sdata->u));

1717 
	`mem£t
(&
sd©a
->
deæšk
.
u
, 0, (sdata->deflink.u));

1720 
sd©a
->
vif
.
ty³
 =ype;

1721 
sd©a
->
vif
.
p2p
 = 
çl£
;

1722 
sd©a
->
wdev
.
iáy³
 = 
ty³
;

1724 
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 = 
	`ıu_to_be16
(
ETH_P_PAE
);

1725 
sd©a
->
cÚŒŞ_pÜt_no_’üy±
 = 
çl£
;

1726 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
 = 
çl£
;

1727 
sd©a
->
cÚŒŞ_pÜt_no_´—uth
 = 
çl£
;

1728 
sd©a
->
vif
.
cfg
.
idË
 = 
Œue
;

1729 
sd©a
->
vif
.
bss_cÚf
.
txpow”
 = 
INT_MIN
;

1731 
sd©a
->
nßck_m­
 = 0;

1734 ià(
sd©a
->
dev
) {

1735 
sd©a
->
dev
->
Ãtdev_İs
 = &
›“80211_d©aif_İs
;

1736 
sd©a
->
dev
->
ty³
 = 
ARPHRD_ETHER
;

1739 
	`skb_queue_h—d_š™
(&
sd©a
->
skb_queue
);

1740 
	`skb_queue_h—d_š™
(&
sd©a
->
¡©us_queue
);

1741 
	`why_wÜk_š™
(&
sd©a
->
wÜk
, 
›“80211_içû_wÜk
);

1742 
	`why_wÜk_š™
(&
sd©a
->
aùiv©e_lšks_wÜk
,

1743 
›“80211_aùiv©e_lšks_wÜk
);

1745 
ty³
) {

1746 
NL80211_IFTYPE_P2P_GO
:

1747 
ty³
 = 
NL80211_IFTYPE_AP
;

1748 
sd©a
->
vif
.
ty³
 =ype;

1749 
sd©a
->
vif
.
p2p
 = 
Œue
;

1750 
çÎthrough
;

1751 
NL80211_IFTYPE_AP
:

1752 
	`skb_queue_h—d_š™
(&
sd©a
->
u
.
­
.
ps
.
bc_buf
);

1753 
	`INIT_LIST_HEAD
(&
sd©a
->
u
.
­
.
vÏns
);

1754 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = sd©a->vif.
addr
;

1756 
NL80211_IFTYPE_P2P_CLIENT
:

1757 
ty³
 = 
NL80211_IFTYPE_STATION
;

1758 
sd©a
->
vif
.
ty³
 =ype;

1759 
sd©a
->
vif
.
p2p
 = 
Œue
;

1760 
çÎthrough
;

1761 
NL80211_IFTYPE_STATION
:

1762 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = sd©a->
deæšk
.
u
.
mgd
.bssid;

1763 
	`›“80211_¡a_£tup_sd©a
(
sd©a
);

1765 
NL80211_IFTYPE_OCB
:

1766 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = 
bssid_wdÿrd
;

1767 
	`›“80211_ocb_£tup_sd©a
(
sd©a
);

1769 
NL80211_IFTYPE_ADHOC
:

1770 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = sd©a->
u
.
ibss
.bssid;

1771 
	`›“80211_ibss_£tup_sd©a
(
sd©a
);

1773 
NL80211_IFTYPE_MESH_POINT
:

1774 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

1775 
	`›“80211_mesh_š™_sd©a
(
sd©a
);

1777 
NL80211_IFTYPE_MONITOR
:

1778 
sd©a
->
dev
->
ty³
 = 
ARPHRD_IEEE80211_RADIOTAP
;

1779 
sd©a
->
dev
->
Ãtdev_İs
 = &
›“80211_mÚ™Üif_İs
;

1780 
sd©a
->
u
.
mÁr
.
æags
 = 
MONITOR_FLAG_CONTROL
 |

1781 
MONITOR_FLAG_OTHER_BSS
;

1783 
NL80211_IFTYPE_NAN
:

1784 
	`idr_š™
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
);

1785 
	`¥š_lock_š™
(&
sd©a
->
u
.
Çn
.
func_lock
);

1786 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = sd©a->vif.
addr
;

1788 
NL80211_IFTYPE_AP_VLAN
:

1789 
NL80211_IFTYPE_P2P_DEVICE
:

1790 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = sd©a->vif.
addr
;

1792 
NL80211_IFTYPE_UNSPECIFIED
:

1793 
NL80211_IFTYPE_WDS
:

1794 
NUM_NL80211_IFTYPES
:

1795 
	`WARN_ON
(1);

1800 
	`›“80211_lšk_£tup
(&
sd©a
->
deæšk
);

1802 
	`›“80211_debugfs_»ü—‹_Ãtdev
(
sd©a
, 
çl£
);

1803 
	}
}

1805 
	$›“80211_ruÁime_chªge_iáy³
(
›“80211_sub_if_d©a
 *
sd©a
,

1806 
Æ80211_iáy³
 
ty³
)

1808 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1809 
»t
, 
”r
;

1810 
Æ80211_iáy³
 
š‹º®_ty³
 = 
ty³
;

1811 
boŞ
 
p2p
 = 
çl£
;

1813 
	`ASSERT_RTNL
();

1815 ià(!
loÿl
->
İs
->
chªge_š‹rçû
)

1816  -
EBUSY
;

1819 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

1820  -
EBUSY
;

1822 
sd©a
->
vif
.
ty³
) {

1823 
NL80211_IFTYPE_AP
:

1824 ià(!
	`li¡_em±y
(&
sd©a
->
u
.
­
.
vÏns
))

1825  -
EBUSY
;

1827 
NL80211_IFTYPE_STATION
:

1828 
NL80211_IFTYPE_ADHOC
:

1829 
NL80211_IFTYPE_OCB
:

1838  -
EBUSY
;

1841 
ty³
) {

1842 
NL80211_IFTYPE_AP
:

1843 
NL80211_IFTYPE_STATION
:

1844 
NL80211_IFTYPE_ADHOC
:

1845 
NL80211_IFTYPE_OCB
:

1851 
NL80211_IFTYPE_P2P_CLIENT
:

1852 
p2p
 = 
Œue
;

1853 
š‹º®_ty³
 = 
NL80211_IFTYPE_STATION
;

1855 
NL80211_IFTYPE_P2P_GO
:

1856 
p2p
 = 
Œue
;

1857 
š‹º®_ty³
 = 
NL80211_IFTYPE_AP
;

1860  -
EBUSY
;

1863 
»t
 = 
	`›“80211_check_cÚcu¼’t_içû
(
sd©a
, 
š‹º®_ty³
);

1864 ià(
»t
)

1865  
»t
;

1867 
	`›“80211_¡İ_vif_queues
(
loÿl
, 
sd©a
,

1868 
IEEE80211_QUEUE_STOP_REASON_IFTYPE_CHANGE
);

1870 
	`›“80211_do_¡İ
(
sd©a
, 
çl£
);

1872 
	`›“80211_‹¬down_sd©a
(
sd©a
);

1874 
	`›“80211_£t_sd©a_ofæßd_æags
(
sd©a
);

1875 
»t
 = 
	`drv_chªge_š‹rçû
(
loÿl
, 
sd©a
, 
š‹º®_ty³
, 
p2p
);

1876 ià(
»t
)

1877 
ty³
 = 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
);

1884 
	`›“80211_check_queues
(
sd©a
, 
ty³
);

1886 
	`›“80211_£tup_sd©a
(
sd©a
, 
ty³
);

1887 
	`›“80211_£t_vif_’ÿp_İs
(
sd©a
);

1889 
”r
 = 
	`›“80211_do_İ’
(&
sd©a
->
wdev
, 
çl£
);

1890 
	`WARN
(
”r
, "type change: do_open„eturned %d",ƒrr);

1892 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

1893 
IEEE80211_QUEUE_STOP_REASON_IFTYPE_CHANGE
);

1894  
»t
;

1895 
	}
}

1897 
	$›“80211_if_chªge_ty³
(
›“80211_sub_if_d©a
 *
sd©a
,

1898 
Æ80211_iáy³
 
ty³
)

1900 
»t
;

1902 
	`ASSERT_RTNL
();

1904 ià(
ty³
 =ğ
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
))

1907 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

1908 
»t
 = 
	`›“80211_ruÁime_chªge_iáy³
(
sd©a
, 
ty³
);

1909 ià(
»t
)

1910  
»t
;

1913 
	`›“80211_‹¬down_sd©a
(
sd©a
);

1914 
	`›“80211_£tup_sd©a
(
sd©a
, 
ty³
);

1918 ià(
ty³
 =ğ
NL80211_IFTYPE_STATION
)

1919 
sd©a
->
u
.
mgd
.
u£_4addr
 = 
çl£
;

1922 
	}
}

1924 
	$›“80211_assign_³rm_addr
(
›“80211_loÿl
 *
loÿl
,

1925 
u8
 *
³rm_addr
, 
Æ80211_iáy³
 
ty³
)

1927 
›“80211_sub_if_d©a
 *
sd©a
;

1928 
u64
 
mask
, 
¡¬t
, 
addr
, 
v®
, 
šc
;

1929 
u8
 *
m
;

1930 
u8
 
tmp_addr
[
ETH_ALEN
];

1931 
i
;

1933 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1936 
	`memıy
(
³rm_addr
, 
loÿl
->
hw
.
why
->³rm_addr, 
ETH_ALEN
);

1938 ià(
	`is_z”o_‘h”_addr
(
loÿl
->
hw
.
why
->
addr_mask
) &&

1939 
loÿl
->
hw
.
why
->
n_add»s£s
 <= 1)

1942 
ty³
) {

1943 
NL80211_IFTYPE_MONITOR
:

1946 
NL80211_IFTYPE_AP_VLAN
:

1948 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1949 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

1951 
	`memıy
(
³rm_addr
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1956 
NL80211_IFTYPE_P2P_CLIENT
:

1957 
NL80211_IFTYPE_P2P_GO
:

1958 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
P2P_DEV_ADDR_FOR_INTF
)) {

1959 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1960 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_P2P_DEVICE
)

1962 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1964 
	`memıy
(
³rm_addr
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1968 
çÎthrough
;

1971 
i
 = 0; i < 
loÿl
->
hw
.
why
->
n_add»s£s
; i++) {

1972 
boŞ
 
u£d
 = 
çl£
;

1974 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1975 ià(
	`‘h”_addr_equ®
(
loÿl
->
hw
.
why
->
add»s£s
[
i
].
addr
,

1976 
sd©a
->
vif
.
addr
)) {

1977 
u£d
 = 
Œue
;

1982 ià(!
u£d
) {

1983 
	`memıy
(
³rm_addr
,

1984 
loÿl
->
hw
.
why
->
add»s£s
[
i
].
addr
,

1985 
ETH_ALEN
);

1991 ià(
	`is_z”o_‘h”_addr
(
loÿl
->
hw
.
why
->
addr_mask
))

1994 
m
 = 
loÿl
->
hw
.
why
->
addr_mask
;

1995 
mask
 = ((
u64
)
m
[0] << 5*8) | ((u64)m[1] << 4*8) |

1996 ((
u64
)
m
[2] << 3*8) | ((u64)m[3] << 2*8) |

1997 ((
u64
)
m
[4] << 1*8) | ((u64)m[5] << 0*8);

1999 ià(
	`__ffs64
(
mask
è+ 
	`hweight64
(maskè!ğ
	`æs64
(mask)) {

2001 
	`´_šfo
("not contiguous\n");

2009 
m
 = 
loÿl
->
hw
.
why
->
³rm_addr
;

2010 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2011 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
)

2013 
m
 = 
sd©a
->
vif
.
addr
;

2016 
¡¬t
 = ((
u64
)
m
[0] << 5*8) | ((u64)m[1] << 4*8) |

2017 ((
u64
)
m
[2] << 3*8) | ((u64)m[3] << 2*8) |

2018 ((
u64
)
m
[4] << 1*8) | ((u64)m[5] << 0*8);

2020 
šc
 = 1ULL<<
	`__ffs64
(
mask
);

2021 
v®
 = (
¡¬t
 & 
mask
);

2022 
addr
 = (
¡¬t
 & ~
mask
è| (
v®
 & mask);

2024 
boŞ
 
u£d
 = 
çl£
;

2026 
tmp_addr
[5] = 
addr
 >> 0*8;

2027 
tmp_addr
[4] = 
addr
 >> 1*8;

2028 
tmp_addr
[3] = 
addr
 >> 2*8;

2029 
tmp_addr
[2] = 
addr
 >> 3*8;

2030 
tmp_addr
[1] = 
addr
 >> 4*8;

2031 
tmp_addr
[0] = 
addr
 >> 5*8;

2033 
v®
 +ğ
šc
;

2035 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2036 ià(
	`‘h”_addr_equ®
(
tmp_addr
, 
sd©a
->
vif
.
addr
)) {

2037 
u£d
 = 
Œue
;

2042 ià(!
u£d
) {

2043 
	`memıy
(
³rm_addr
, 
tmp_addr
, 
ETH_ALEN
);

2046 
addr
 = (
¡¬t
 & ~
mask
è| (
v®
 & mask);

2047 } 
addr
 !ğ
¡¬t
);

2051 
	}
}

2053 
	$›“80211_if_add
(
›“80211_loÿl
 *
loÿl
, cÚ¡ *
Çme
,

2054 
Çme_assign_ty³
,

2055 
wœ–ess_dev
 **
Ãw_wdev
, 
Æ80211_iáy³
 
ty³
,

2056 
vif_·¿ms
 *
·¿ms
)

2058 
Ãt_deviû
 *
ndev
 = 
NULL
;

2059 
›“80211_sub_if_d©a
 *
sd©a
 = 
NULL
;

2060 
txq_šfo
 *
txqi
;

2061 
»t
, 
i
;

2063 
	`ASSERT_RTNL
();

2064 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2066 ià(
ty³
 =ğ
NL80211_IFTYPE_P2P_DEVICE
 ||y³ =ğ
NL80211_IFTYPE_NAN
) {

2067 
wœ–ess_dev
 *
wdev
;

2069 
sd©a
 = 
	`kz®loc
((*sd©aè+ 
loÿl
->
hw
.
vif_d©a_size
,

2070 
GFP_KERNEL
);

2071 ià(!
sd©a
)

2072  -
ENOMEM
;

2073 
wdev
 = &
sd©a
->wdev;

2075 
sd©a
->
dev
 = 
NULL
;

2076 
	`¡rsıy
(
sd©a
->
Çme
,‚ame, 
IFNAMSIZ
);

2077 
	`›“80211_assign_³rm_addr
(
loÿl
, 
wdev
->
add»ss
, 
ty³
);

2078 
	`memıy
(
sd©a
->
vif
.
addr
, 
wdev
->
add»ss
, 
ETH_ALEN
);

2079 
	`‘h”_addr_cİy
(
sd©a
->
vif
.
bss_cÚf
.
addr
, sdata->vif.addr);

2081 
size
 = 
	`ALIGN
((*
sd©a
è+ 
loÿl
->
hw
.
vif_d©a_size
,

2083 
txq_size
 = 0;

2085 ià(
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

2086 (
ty³
 !ğ
NL80211_IFTYPE_MONITOR
 ||

2087 (
·¿ms
->
æags
 & 
MONITOR_FLAG_ACTIVE
)))

2088 
txq_size
 +ğ(
txq_šfo
) +

2089 
loÿl
->
hw
.
txq_d©a_size
;

2091 
ndev
 = 
	`®loc_Ãtdev_mqs
(
size
 + 
txq_size
,

2092 
Çme
, 
Çme_assign_ty³
,

2093 
›“80211_if_£tup
, 1, 1);

2094 ià(!
ndev
)

2095  -
ENOMEM
;

2097 
	`dev_Ãt_£t
(
ndev
, 
	`why_Ãt
(
loÿl
->
hw
.
why
));

2099 
ndev
->
t¡©s
 = 
	`Ãtdev_®loc_pıu_¡©s
(
pıu_sw_Ãt¡©s
);

2100 ià(!
ndev
->
t¡©s
) {

2101 
	`ä“_Ãtdev
(
ndev
);

2102  -
ENOMEM
;

2105 
ndev
->
Ãeded_h—droom
 = 
loÿl
->
tx_h—droom
 +

2110 - 
ETH_HLEN


2111 + 
IEEE80211_ENCRYPT_HEADROOM
;

2112 
ndev
->
Ãeded_room
 = 
IEEE80211_ENCRYPT_TAILROOM
;

2114 
»t
 = 
	`dev_®loc_Çme
(
ndev
,‚dev->
Çme
);

2115 ià(
»t
 < 0) {

2116 
	`›“80211_if_ä“
(
ndev
);

2117 
	`ä“_Ãtdev
(
ndev
);

2118  
»t
;

2121 
	`›“80211_assign_³rm_addr
(
loÿl
, 
ndev
->
³rm_addr
, 
ty³
);

2122 ià(
	`is_v®id_‘h”_addr
(
·¿ms
->
maÿddr
))

2123 
	`‘h_hw_addr_£t
(
ndev
, 
·¿ms
->
maÿddr
);

2125 
	`‘h_hw_addr_£t
(
ndev
,‚dev->
³rm_addr
);

2126 
	`SET_NETDEV_DEV
(
ndev
, 
	`why_dev
(
loÿl
->
hw
.
why
));

2129 
sd©a
 = 
	`Ãtdev_´iv
(
ndev
);

2130 
ndev
->
›“80211_±r
 = &
sd©a
->
wdev
;

2131 
	`memıy
(
sd©a
->
vif
.
addr
, 
ndev
->
dev_addr
, 
ETH_ALEN
);

2132 
	`‘h”_addr_cİy
(
sd©a
->
vif
.
bss_cÚf
.
addr
, sdata->vif.addr);

2133 
	`memıy
(
sd©a
->
Çme
, 
ndev
->Çme, 
IFNAMSIZ
);

2135 ià(
txq_size
) {

2136 
txqi
 = 
	`Ãtdev_´iv
(
ndev
è+ 
size
;

2137 
	`›“80211_txq_š™
(
sd©a
, 
NULL
, 
txqi
, 0);

2140 
sd©a
->
dev
 = 
ndev
;

2144 
sd©a
->
wdev
.
why
 = 
loÿl
->
hw
.wiphy;

2146 
	`›“80211_sd©a_š™
(
loÿl
, 
sd©a
);

2148 
	`›“80211_š™_äag_ÿche
(&
sd©a
->
äags
);

2150 
	`INIT_LIST_HEAD
(&
sd©a
->
key_li¡
);

2152 
	`why_d–ayed_wÜk_š™
(&
sd©a
->
dec_room_Ãeded_wk
,

2153 
›“80211_d–ayed_room_dec
);

2155 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

2156 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

2157 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
i
];

2158 
sd©a
->
rc_¿‹idx_mask
[
i
] =

2159 
sbªd
 ? (1 << sbªd->
n_b™¿‹s
) - 1 : 0;

2160 ià(
sbªd
) {

2161 
__Ë16
 
ÿp
;

2162 
u16
 *
vht_¿‹_mask
;

2164 
	`memıy
(
sd©a
->
rc_¿‹idx_mcs_mask
[
i
],

2165 
sbªd
->
ht_ÿp
.
mcs
.
rx_mask
,

2166 (
sd©a
->
rc_¿‹idx_mcs_mask
[
i
]));

2168 
ÿp
 = 
sbªd
->
vht_ÿp
.
vht_mcs
.
rx_mcs_m­
;

2169 
vht_¿‹_mask
 = 
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
i
];

2170 
	`›“80211_g‘_vht_mask_äom_ÿp
(
ÿp
, 
vht_¿‹_mask
);

2172 
	`mem£t
(
sd©a
->
rc_¿‹idx_mcs_mask
[
i
], 0,

2173 (
sd©a
->
rc_¿‹idx_mcs_mask
[
i
]));

2174 
	`mem£t
(
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
i
], 0,

2175 (
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
i
]));

2179 
	`›“80211_£t_deçuÉ_queues
(
sd©a
);

2181 
sd©a
->
deæšk
.
­_pow”_Ëv–
 = 
IEEE80211_UNSET_POWER_LEVEL
;

2182 
sd©a
->
deæšk
.
u£r_pow”_Ëv–
 = 
loÿl
->user_power_level;

2185 
	`›“80211_£tup_sd©a
(
sd©a
, 
ty³
);

2187 ià(
ndev
) {

2188 
ndev
->
›“80211_±r
->
u£_4addr
 = 
·¿ms
->use_4addr;

2189 ià(
ty³
 =ğ
NL80211_IFTYPE_STATION
)

2190 
sd©a
->
u
.
mgd
.
u£_4addr
 = 
·¿ms
->use_4addr;

2192 
ndev
->
ã©u»s
 |ğ
loÿl
->
hw
.
Ãtdev_ã©u»s
;

2193 
ndev
->
´iv_æags
 |ğ
IFF_LIVE_ADDR_CHANGE
;

2194 
ndev
->
hw_ã©u»s
 |ğndev->
ã©u»s
 &

2195 
MAC80211_SUPPORTED_FEATURES_TX
;

2196 
sd©a
->
vif
.
Ãtdev_ã©u»s
 = 
loÿl
->
hw
.netdev_features;

2198 
	`Ãtdev_£t_deçuÉ_‘htoŞ_İs
(
ndev
, &
›“80211_‘htoŞ_İs
);

2205 
ndev
->
mš_mtu
 = 256;

2206 ià(
ty³
 =ğ
NL80211_IFTYPE_MONITOR
)

2207 
ndev
->
max_mtu
 = 0;

2209 
ndev
->
max_mtu
 = 
loÿl
->
hw
.max_mtu;

2211 
»t
 = 
	`cfg80211_»gi¡”_Ãtdeviû
(
ndev
);

2212 ià(
»t
) {

2213 
	`ä“_Ãtdev
(
ndev
);

2214  
»t
;

2218 
	`mu‹x_lock
(&
loÿl
->
iæi¡_mtx
);

2219 
	`li¡_add__rcu
(&
sd©a
->
li¡
, &
loÿl
->
š‹rçûs
);

2220 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

2222 ià(
Ãw_wdev
)

2223 *
Ãw_wdev
 = &
sd©a
->
wdev
;

2226 
	}
}

2228 
	$›“80211_if_»move
(
›“80211_sub_if_d©a
 *
sd©a
)

2230 
	`ASSERT_RTNL
();

2231 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2233 
	`mu‹x_lock
(&
sd©a
->
loÿl
->
iæi¡_mtx
);

2234 
	`li¡_d–_rcu
(&
sd©a
->
li¡
);

2235 
	`mu‹x_uÆock
(&
sd©a
->
loÿl
->
iæi¡_mtx
);

2237 ià(
sd©a
->
vif
.
txq
)

2238 
	`›“80211_txq_purge
(
sd©a
->
loÿl
, 
	`to_txq_šfo
(sd©a->
vif
.
txq
));

2240 
	`synchrÚize_rcu
();

2242 
	`cfg80211_uÄegi¡”_wdev
(&
sd©a
->
wdev
);

2244 ià(!
sd©a
->
dev
) {

2245 
	`›“80211_‹¬down_sd©a
(
sd©a
);

2246 
	`kä“
(
sd©a
);

2248 
	}
}

2250 
	$›“80211_sd©a_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
)

2252 ià(
	`WARN_ON_ONCE
(!
	`‹¡_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
)))

2254 
	`›“80211_do_¡İ
(
sd©a
, 
Œue
);

2255 
	}
}

2257 
	$›“80211_»move_š‹rçûs
(
›“80211_loÿl
 *
loÿl
)

2259 
›“80211_sub_if_d©a
 *
sd©a
, *
tmp
;

2260 
	`LIST_HEAD
(
uÄeg_li¡
);

2262 
	`ASSERT_RTNL
();

2275 
	`cfg80211_shutdown_®l_š‹rçûs
(
loÿl
->
hw
.
why
);

2277 
	`why_lock
(
loÿl
->
hw
.
why
);

2279 
	`WARN
(
loÿl
->
İ’_couÁ
, "%s: open count„emains %d\n",

2280 
	`why_Çme
(
loÿl
->
hw
.
why
),†oÿl->
İ’_couÁ
);

2282 
	`mu‹x_lock
(&
loÿl
->
iæi¡_mtx
);

2283 
	`li¡_¥liû_š™
(&
loÿl
->
š‹rçûs
, &
uÄeg_li¡
);

2284 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

2286 
	`li¡_fÜ_—ch_’Œy_§ã
(
sd©a
, 
tmp
, &
uÄeg_li¡
, 
li¡
) {

2287 
boŞ
 
Ãtdev
 = 
sd©a
->
dev
;

2295 
sd©a
->
vif
.
cfg
.
¬p_addr_út
 = 0;

2296 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

2297 
sd©a
->
u
.
mgd
.
assocŸ‹d
)

2298 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
,

2299 
BSS_CHANGED_ARP_FILTER
);

2301 
	`li¡_d–
(&
sd©a
->
li¡
);

2302 
	`cfg80211_uÄegi¡”_wdev
(&
sd©a
->
wdev
);

2304 ià(!
Ãtdev
)

2305 
	`kä“
(
sd©a
);

2307 
	`why_uÆock
(
loÿl
->
hw
.
why
);

2308 
	}
}

2310 
	$Ãtdev_nÙify
(
nÙif›r_block
 *
nb
,

2311 
¡©e
, *
±r
)

2313 
Ãt_deviû
 *
dev
 = 
	`Ãtdev_nÙif›r_šfo_to_dev
(
±r
);

2314 
›“80211_sub_if_d©a
 *
sd©a
;

2316 ià(
¡©e
 !ğ
NETDEV_CHANGENAME
)

2317  
NOTIFY_DONE
;

2319 ià(!
dev
->
›“80211_±r
 || !dev->›“80211_±r->
why
)

2320  
NOTIFY_DONE
;

2322 ià(
dev
->
›“80211_±r
->
why
->
´ivid
 !ğ
mac80211_why_´ivid
)

2323  
NOTIFY_DONE
;

2325 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2326 
	`memıy
(
sd©a
->
Çme
, 
dev
->Çme, 
IFNAMSIZ
);

2327 
	`›“80211_debugfs_»Çme_Ãtdev
(
sd©a
);

2329  
NOTIFY_OK
;

2330 
	}
}

2332 
nÙif›r_block
 
	gmac80211_Ãtdev_nÙif›r
 = {

2333 .
nÙif›r_ÿÎ
 = 
Ãtdev_nÙify
,

2336 
	$›“80211_içû_š™
()

2338  
	`»gi¡”_Ãtdeviû_nÙif›r
(&
mac80211_Ãtdev_nÙif›r
);

2339 
	}
}

2341 
	$›“80211_içû_ex™
()

2343 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
mac80211_Ãtdev_nÙif›r
);

2344 
	}
}

2346 
	$›“80211_vif_šc_num_mÿ¡
(
›“80211_sub_if_d©a
 *
sd©a
)

2348 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

2349 
	`©omic_šc
(&
sd©a
->
u
.
­
.
num_mÿ¡_¡a
);

2350 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

2351 
	`©omic_šc
(&
sd©a
->
u
.
vÏn
.
num_mÿ¡_¡a
);

2352 
	}
}

2354 
	$›“80211_vif_dec_num_mÿ¡
(
›“80211_sub_if_d©a
 *
sd©a
)

2356 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

2357 
	`©omic_dec
(&
sd©a
->
u
.
­
.
num_mÿ¡_¡a
);

2358 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

2359 
	`©omic_dec
(&
sd©a
->
u
.
vÏn
.
num_mÿ¡_¡a
);

2360 
	}
}

	@key.c

12 
	~<üy±o/uts.h
>

13 
	~<lšux/if_‘h”.h
>

14 
	~<lšux/‘h”deviû.h
>

15 
	~<lšux/li¡.h
>

16 
	~<lšux/rcupd©e.h
>

17 
	~<lšux/¹Ãšk.h
>

18 
	~<lšux/¦ab.h
>

19 
	~<lšux/expÜt.h
>

20 
	~<Ãt/mac80211.h
>

21 
	~<asm/uÇligÃd.h
>

22 
	~"›“80211_i.h
"

23 
	~"driv”-İs.h
"

24 
	~"debugfs_key.h
"

25 
	~"«s_ccm.h
"

26 
	~"«s_cmac.h
"

27 
	~"«s_gmac.h
"

28 
	~"«s_gcm.h
"

54 cÚ¡ 
u8
 
	gbÿ¡_addr
[
ETH_ALEN
] = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF };

57 
	$upd©e_vÏn_room_Ãed_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
, 
d–
)

59 
›“80211_sub_if_d©a
 *
vÏn
;

61 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

65 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

67 
	`rcu_»ad_lock
();

69 
	`li¡_fÜ_—ch_’Œy_rcu
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
)

70 
vÏn
->
üy±o_tx_room_Ãeded_út
 +ğ
d–
;

72 
	`rcu_»ad_uÆock
();

73 
	}
}

75 
	$šüem’t_room_Ãed_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
)

96 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

98 
	`upd©e_vÏn_room_Ãed_couÁ
(
sd©a
, 1);

100 ià(!
sd©a
->
üy±o_tx_room_Ãeded_út
++) {

105 
	`synchrÚize_Ãt
();

107 
	}
}

109 
	$deü—£_room_Ãed_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
,

110 
d–
)

112 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

114 
	`WARN_ON_ONCE
(
sd©a
->
üy±o_tx_room_Ãeded_út
 < 
d–
);

116 
	`upd©e_vÏn_room_Ãed_couÁ
(
sd©a
, -
d–
);

117 
sd©a
->
üy±o_tx_room_Ãeded_út
 -ğ
d–
;

118 
	}
}

120 
	$›“80211_key_’abË_hw_acûl
(
›“80211_key
 *
key
)

122 
›“80211_sub_if_d©a
 *
sd©a
 = 
key
->sdata;

123 
¡a_šfo
 *
¡a
;

124 
»t
 = -
EOPNOTSUPP
;

126 
	`might_¦“p
();

127 
	`lockd•_as£¹_why
(
key
->
loÿl
->
hw
.
why
);

129 ià(
key
->
æags
 & 
KEY_FLAG_TAINTED
) {

137 ià(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
 &&

138 !(
key
->
cÚf
.
æags
 & (
IEEE80211_KEY_FLAG_GENERATE_MMIC
 |

139 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
 |

140 
IEEE80211_KEY_FLAG_RESERVE_TAILROOM
)))

141 
	`šüem’t_room_Ãed_couÁ
(
sd©a
);

143 
key
->
æags
 &ğ~
KEY_FLAG_UPLOADED_TO_HARDWARE
;

144  -
EINVAL
;

147 ià(!
key
->
loÿl
->
İs
->
£t_key
)

148 
out_unsuµÜ‹d
;

150 
¡a
 = 
key
->sta;

156 ià(
¡a
 && !(
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
) &&

157 !
	`›“80211_hw_check
(&
key
->
loÿl
->
hw
, 
SUPPORTS_PER_STA_GTK
))

158 
out_unsuµÜ‹d
;

160 ià(
¡a
 && !¡a->
u¶ßded
)

161 
out_unsuµÜ‹d
;

163 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

168 ià(!(
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

169 
»t
 = 1;

170 
out_unsuµÜ‹d
;

174 ià(
key
->
cÚf
.
lšk_id
 >ğ0 && 
sd©a
->
vif
.
aùive_lšks
 &&

175 !(
sd©a
->
vif
.
aùive_lšks
 & 
	`BIT
(
key
->
cÚf
.
lšk_id
)))

178 
»t
 = 
	`drv_£t_key
(
key
->
loÿl
, 
SET_KEY
, 
sd©a
,

179 
¡a
 ? &¡a->¡¨: 
NULL
, &
key
->
cÚf
);

181 ià(!
»t
) {

182 
key
->
æags
 |ğ
KEY_FLAG_UPLOADED_TO_HARDWARE
;

184 ià(!(
key
->
cÚf
.
æags
 & (
IEEE80211_KEY_FLAG_GENERATE_MMIC
 |

185 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
 |

186 
IEEE80211_KEY_FLAG_RESERVE_TAILROOM
)))

187 
	`deü—£_room_Ãed_couÁ
(
sd©a
, 1);

189 
	`WARN_ON
((
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
) &&

190 (
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
));

192 
	`WARN_ON
((
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
) &&

193 (
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_MMIC
));

198 ià(
»t
 !ğ-
ENOSPC
 &&„‘ !ğ-
EOPNOTSUPP
 &&„et != 1)

199 
	`sd©a_”r
(
sd©a
,

201 
key
->
cÚf
.
keyidx
,

202 
¡a
 ? s->¡a.
addr
 : 
bÿ¡_addr
, 
»t
);

204 
out_unsuµÜ‹d
:

205 
key
->
cÚf
.
ch”
) {

206 
WLAN_CIPHER_SUITE_WEP40
:

207 
WLAN_CIPHER_SUITE_WEP104
:

208 
WLAN_CIPHER_SUITE_TKIP
:

209 
WLAN_CIPHER_SUITE_CCMP
:

210 
WLAN_CIPHER_SUITE_CCMP_256
:

211 
WLAN_CIPHER_SUITE_GCMP
:

212 
WLAN_CIPHER_SUITE_GCMP_256
:

213 
WLAN_CIPHER_SUITE_AES_CMAC
:

214 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

215 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

216 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

218 ià(
»t
 == 1)

220 ià(
	`›“80211_hw_check
(&
key
->
loÿl
->
hw
, 
SW_CRYPTO_CONTROL
))

221  -
EINVAL
;

224  -
EINVAL
;

226 
	}
}

228 
	$›“80211_key_di§bË_hw_acûl
(
›“80211_key
 *
key
)

230 
›“80211_sub_if_d©a
 *
sd©a
;

231 
¡a_šfo
 *
¡a
;

232 
»t
;

234 
	`might_¦“p
();

236 ià(!
key
 || !key->
loÿl
->
İs
->
£t_key
)

239 ià(!(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
))

242 
¡a
 = 
key
->sta;

243 
sd©a
 = 
key
->sdata;

245 
	`lockd•_as£¹_why
(
key
->
loÿl
->
hw
.
why
);

247 ià(
key
->
cÚf
.
lšk_id
 >ğ0 && 
sd©a
->
vif
.
aùive_lšks
 &&

248 !(
sd©a
->
vif
.
aùive_lšks
 & 
	`BIT
(
key
->
cÚf
.
lšk_id
)))

251 ià(!(
key
->
cÚf
.
æags
 & (
IEEE80211_KEY_FLAG_GENERATE_MMIC
 |

252 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
 |

253 
IEEE80211_KEY_FLAG_RESERVE_TAILROOM
)))

254 
	`šüem’t_room_Ãed_couÁ
(
sd©a
);

256 
key
->
æags
 &ğ~
KEY_FLAG_UPLOADED_TO_HARDWARE
;

257 
»t
 = 
	`drv_£t_key
(
key
->
loÿl
, 
DISABLE_KEY
, 
sd©a
,

258 
¡a
 ? &¡a->¡¨: 
NULL
, &
key
->
cÚf
);

260 ià(
»t
)

261 
	`sd©a_”r
(
sd©a
,

263 
key
->
cÚf
.
keyidx
,

264 
¡a
 ? s->¡a.
addr
 : 
bÿ¡_addr
, 
»t
);

265 
	}
}

267 
	$_›“80211_£t_tx_key
(
›“80211_key
 *
key
, 
boŞ
 
fÜû
)

269 
¡a_šfo
 *
¡a
 = 
key
->sta;

270 
›“80211_loÿl
 *
loÿl
 = 
key
->local;

272 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

274 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_USES_ENCRYPTION
);

276 
¡a
->
±k_idx
 = 
key
->
cÚf
.
keyidx
;

278 ià(
fÜû
 || !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_KEYBORDER_SUPPORT
))

279 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

280 
	`›“80211_check_ç¡_xm™
(
¡a
);

283 
	}
}

285 
	$›“80211_£t_tx_key
(
›“80211_key
 *
key
)

287  
	`_›“80211_£t_tx_key
(
key
, 
çl£
);

288 
	}
}

290 
	$›“80211_·œwi£_»key
(
›“80211_key
 *
Şd
,

291 
›“80211_key
 *
Ãw
)

293 
›“80211_loÿl
 *
loÿl
 = 
Ãw
->local;

294 
¡a_šfo
 *
¡a
 = 
Ãw
->sta;

295 
i
;

297 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

299 ià(
Ãw
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_NO_AUTO_TX
) {

302 ià(
¡a
->
±k_idx
 !ğ
INVALID_PTK_KEYIDX
 &&

303 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_KEYBORDER_SUPPORT
)) {

313 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

314 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

315 
	`__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a
, 
i
,

316 
AGG_STOP_LOCAL_REQUEST
);

318 } ià(
Şd
) {

324 ià(!(
Şd
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
))

328 
Şd
->
æags
 |ğ
KEY_FLAG_TAINTED
;

329 
	`›“80211_ş—r_ç¡_xm™
(
¡a
);

330 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_AGGREGATION
)) {

331 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

332 
	`›“80211_¡a_‹¬_down_BA_£ssiÚs
(
¡a
,

333 
AGG_STOP_LOCAL_REQUEST
);

335 ià(!
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
,

336 
NL80211_EXT_FEATURE_CAN_REPLACE_PTK0
)) {

337 
	`´_w¬n_¿‹lim™ed
("Rekeying PTK for STA %pM but driver can't safely dohat.",

338 
¡a
->¡a.
addr
);

342 
	`›“80211_æush_queues
(
loÿl
, 
Şd
->
sd©a
, 
çl£
);

345 
	}
}

347 
	$__›“80211_£t_deçuÉ_key
(
›“80211_lšk_d©a
 *
lšk
,

348 
idx
, 
boŞ
 
uni
, boŞ 
muÉi
)

350 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

351 
›“80211_key
 *
key
 = 
NULL
;

353 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

355 ià(
idx
 >ğ0 && idx < 
NUM_DEFAULT_KEYS
) {

356 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

357 
sd©a
->
keys
[
idx
]);

358 ià(!
key
)

359 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

360 
lšk
->
gtk
[
idx
]);

363 ià(
uni
) {

364 
	`rcu_assign_poš‹r
(
sd©a
->
deçuÉ_uniÿ¡_key
, 
key
);

365 
	`›“80211_check_ç¡_xm™_içû
(
sd©a
);

366 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
)

367 
	`drv_£t_deçuÉ_uniÿ¡_key
(
sd©a
->
loÿl
, sd©a, 
idx
);

370 ià(
muÉi
)

371 
	`rcu_assign_poš‹r
(
lšk
->
deçuÉ_muÉiÿ¡_key
, 
key
);

373 
	`›“80211_debugfs_key_upd©e_deçuÉ
(
sd©a
);

374 
	}
}

376 
	$›“80211_£t_deçuÉ_key
(
›“80211_lšk_d©a
 *
lšk
, 
idx
,

377 
boŞ
 
uni
, boŞ 
muÉi
)

379 
	`lockd•_as£¹_why
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
);

381 
	`__›“80211_£t_deçuÉ_key
(
lšk
, 
idx
, 
uni
, 
muÉi
);

382 
	}
}

385 
	$__›“80211_£t_deçuÉ_mgmt_key
(
›“80211_lšk_d©a
 *
lšk
, 
idx
)

387 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

388 
›“80211_key
 *
key
 = 
NULL
;

390 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

392 ià(
idx
 >ğ
NUM_DEFAULT_KEYS
 &&

393 
idx
 < 
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
)

394 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

395 
lšk
->
gtk
[
idx
]);

397 
	`rcu_assign_poš‹r
(
lšk
->
deçuÉ_mgmt_key
, 
key
);

399 
	`›“80211_debugfs_key_upd©e_deçuÉ
(
sd©a
);

400 
	}
}

402 
	$›“80211_£t_deçuÉ_mgmt_key
(
›“80211_lšk_d©a
 *
lšk
,

403 
idx
)

405 
	`lockd•_as£¹_why
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
);

407 
	`__›“80211_£t_deçuÉ_mgmt_key
(
lšk
, 
idx
);

408 
	}
}

411 
	$__›“80211_£t_deçuÉ_b—cÚ_key
(
›“80211_lšk_d©a
 *
lšk
, 
idx
)

413 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

414 
›“80211_key
 *
key
 = 
NULL
;

416 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

418 ià(
idx
 >ğ
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
 &&

419 
idx
 < 
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
 +

420 
NUM_DEFAULT_BEACON_KEYS
)

421 
key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

422 
lšk
->
gtk
[
idx
]);

424 
	`rcu_assign_poš‹r
(
lšk
->
deçuÉ_b—cÚ_key
, 
key
);

426 
	`›“80211_debugfs_key_upd©e_deçuÉ
(
sd©a
);

427 
	}
}

429 
	$›“80211_£t_deçuÉ_b—cÚ_key
(
›“80211_lšk_d©a
 *
lšk
,

430 
idx
)

432 
	`lockd•_as£¹_why
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
);

434 
	`__›“80211_£t_deçuÉ_b—cÚ_key
(
lšk
, 
idx
);

435 
	}
}

437 
	$›“80211_key_»¶aû
(
›“80211_sub_if_d©a
 *
sd©a
,

438 
›“80211_lšk_d©a
 *
lšk
,

439 
¡a_šfo
 *
¡a
,

440 
boŞ
 
·œwi£
,

441 
›“80211_key
 *
Şd
,

442 
›“80211_key
 *
Ãw
)

444 
lšk_¡a_šfo
 *
lšk_¡a
 = 
¡a
 ? &¡a->
deæšk
 : 
NULL
;

445 
lšk_id
;

446 
idx
;

447 
»t
 = 0;

448 
boŞ
 
defunikey
, 
defmuÉikey
, 
defmgmtkey
, 
defb—cÚkey
;

449 
boŞ
 
is_w•
;

451 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

454 ià(
	`WARN_ON
(!
Ãw
 && !
Şd
))

457 ià(
Ãw
) {

458 
idx
 = 
Ãw
->
cÚf
.
keyidx
;

459 
is_w•
 = 
Ãw
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_WEP40
 ||

460 
Ãw
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_WEP104
;

461 
lšk_id
 = 
Ãw
->
cÚf
.link_id;

463 
idx
 = 
Şd
->
cÚf
.
keyidx
;

464 
is_w•
 = 
Şd
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_WEP40
 ||

465 
Şd
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_WEP104
;

466 
lšk_id
 = 
Şd
->
cÚf
.link_id;

469 ià(
	`WARN
(
Şd
 && old->
cÚf
.
lšk_id
 !=†ink_id,

471 
Şd
->
cÚf
.
lšk_id
,†ink_id))

472  -
EINVAL
;

474 ià(
lšk_id
 >= 0) {

475 ià(!
lšk
) {

476 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

477 ià(!
lšk
)

478  -
ENOLINK
;

481 ià(
¡a
) {

482 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
lšk_id
],

483 
	`lockd•_is_h–d
(&
¡a
->
loÿl
->
hw
.
why
->
mtx
));

484 ià(!
lšk_¡a
)

485  -
ENOLINK
;

488 
lšk
 = &
sd©a
->
deæšk
;

491 ià((
is_w•
 || 
·œwi£
è&& 
idx
 >ğ
NUM_DEFAULT_KEYS
)

492  -
EINVAL
;

494 
	`WARN_ON
(
Ãw
 && 
Şd
 &&‚ew->
cÚf
.
keyidx
 != old->conf.keyidx);

496 ià(
Ãw
 && 
¡a
 && 
·œwi£
) {

500 
	`›“80211_·œwi£_»key
(
Şd
, 
Ãw
);

503 ià(
Şd
) {

504 ià(
Şd
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
) {

505 
	`›“80211_key_di§bË_hw_acûl
(
Şd
);

507 ià(
Ãw
)

508 
»t
 = 
	`›“80211_key_’abË_hw_acûl
(
Ãw
);

511 ià(!
Ãw
->
loÿl
->
wowÏn
)

512 
»t
 = 
	`›“80211_key_’abË_hw_acûl
(
Ãw
);

514 
Ãw
->
æags
 |ğ
KEY_FLAG_UPLOADED_TO_HARDWARE
;

517 ià(
»t
)

518  
»t
;

520 ià(
Ãw
)

521 
	`li¡_add__rcu
(&
Ãw
->
li¡
, &
sd©a
->
key_li¡
);

523 ià(
¡a
) {

524 ià(
·œwi£
) {

525 
	`rcu_assign_poš‹r
(
¡a
->
±k
[
idx
], 
Ãw
);

526 ià(
Ãw
 &&

527 !(
Ãw
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_NO_AUTO_TX
))

528 
	`_›“80211_£t_tx_key
(
Ãw
, 
Œue
);

530 
	`rcu_assign_poš‹r
(
lšk_¡a
->
gtk
[
idx
], 
Ãw
);

536 ià(
Ãw
 && !
Şd
)

537 
	`›“80211_check_ç¡_rx
(
¡a
);

539 
defunikey
 = 
Şd
 &&

540 
Şd
 =ğ
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

541 
sd©a
->
deçuÉ_uniÿ¡_key
);

542 
defmuÉikey
 = 
Şd
 &&

543 
Şd
 =ğ
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

544 
lšk
->
deçuÉ_muÉiÿ¡_key
);

545 
defmgmtkey
 = 
Şd
 &&

546 
Şd
 =ğ
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

547 
lšk
->
deçuÉ_mgmt_key
);

548 
defb—cÚkey
 = 
Şd
 &&

549 
Şd
 =ğ
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

550 
lšk
->
deçuÉ_b—cÚ_key
);

552 ià(
defunikey
 && !
Ãw
)

553 
	`__›“80211_£t_deçuÉ_key
(
lšk
, -1, 
Œue
, 
çl£
);

554 ià(
defmuÉikey
 && !
Ãw
)

555 
	`__›“80211_£t_deçuÉ_key
(
lšk
, -1, 
çl£
, 
Œue
);

556 ià(
defmgmtkey
 && !
Ãw
)

557 
	`__›“80211_£t_deçuÉ_mgmt_key
(
lšk
, -1);

558 ià(
defb—cÚkey
 && !
Ãw
)

559 
	`__›“80211_£t_deçuÉ_b—cÚ_key
(
lšk
, -1);

561 ià(
is_w•
 || 
·œwi£
)

562 
	`rcu_assign_poš‹r
(
sd©a
->
keys
[
idx
], 
Ãw
);

564 
	`rcu_assign_poš‹r
(
lšk
->
gtk
[
idx
], 
Ãw
);

566 ià(
defunikey
 && 
Ãw
)

567 
	`__›“80211_£t_deçuÉ_key
(
lšk
, 
Ãw
->
cÚf
.
keyidx
,

568 
Œue
, 
çl£
);

569 ià(
defmuÉikey
 && 
Ãw
)

570 
	`__›“80211_£t_deçuÉ_key
(
lšk
, 
Ãw
->
cÚf
.
keyidx
,

571 
çl£
, 
Œue
);

572 ià(
defmgmtkey
 && 
Ãw
)

573 
	`__›“80211_£t_deçuÉ_mgmt_key
(
lšk
,

574 
Ãw
->
cÚf
.
keyidx
);

575 ià(
defb—cÚkey
 && 
Ãw
)

576 
	`__›“80211_£t_deçuÉ_b—cÚ_key
(
lšk
,

577 
Ãw
->
cÚf
.
keyidx
);

580 ià(
Şd
)

581 
	`li¡_d–_rcu
(&
Şd
->
li¡
);

584 
	}
}

586 
›“80211_key
 *

587 
	$›“80211_key_®loc
(
u32
 
ch”
, 
idx
, 
size_t
 
key_Ën
,

588 cÚ¡ 
u8
 *
key_d©a
,

589 
size_t
 
£q_Ën
, cÚ¡ 
u8
 *
£q
)

591 
›“80211_key
 *
key
;

592 
i
, 
j
, 
”r
;

594 ià(
	`WARN_ON
(
idx
 < 0 ||

595 
idx
 >ğ
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
 +

596 
NUM_DEFAULT_BEACON_KEYS
))

597  
	`ERR_PTR
(-
EINVAL
);

599 
key
 = 
	`kz®loc
((
›“80211_key
è+ 
key_Ën
, 
GFP_KERNEL
);

600 ià(!
key
)

601  
	`ERR_PTR
(-
ENOMEM
);

607 
key
->
cÚf
.
æags
 = 0;

608 
key
->
æags
 = 0;

610 
key
->
cÚf
.
lšk_id
 = -1;

611 
key
->
cÚf
.
ch”
 = cipher;

612 
key
->
cÚf
.
keyidx
 = 
idx
;

613 
key
->
cÚf
.
keyËn
 = 
key_Ën
;

614 
ch”
) {

615 
WLAN_CIPHER_SUITE_WEP40
:

616 
WLAN_CIPHER_SUITE_WEP104
:

617 
key
->
cÚf
.
iv_Ën
 = 
IEEE80211_WEP_IV_LEN
;

618 
key
->
cÚf
.
icv_Ën
 = 
IEEE80211_WEP_ICV_LEN
;

620 
WLAN_CIPHER_SUITE_TKIP
:

621 
key
->
cÚf
.
iv_Ën
 = 
IEEE80211_TKIP_IV_LEN
;

622 
key
->
cÚf
.
icv_Ën
 = 
IEEE80211_TKIP_ICV_LEN
;

623 ià(
£q
) {

624 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++) {

625 
key
->
u
.
tk
.
rx
[
i
].
iv32
 =

626 
	`g‘_uÇligÃd_Ë32
(&
£q
[2]);

627 
key
->
u
.
tk
.
rx
[
i
].
iv16
 =

628 
	`g‘_uÇligÃd_Ë16
(
£q
);

631 
	`¥š_lock_š™
(&
key
->
u
.
tk
.
txlock
);

633 
WLAN_CIPHER_SUITE_CCMP
:

634 
key
->
cÚf
.
iv_Ën
 = 
IEEE80211_CCMP_HDR_LEN
;

635 
key
->
cÚf
.
icv_Ën
 = 
IEEE80211_CCMP_MIC_LEN
;

636 ià(
£q
) {

637 
i
 = 0; i < 
IEEE80211_NUM_TIDS
 + 1; i++)

638 
j
 = 0; j < 
IEEE80211_CCMP_PN_LEN
; j++)

639 
key
->
u
.
ccmp
.
rx_²
[
i
][
j
] =

640 
£q
[
IEEE80211_CCMP_PN_LEN
 - 
j
 - 1];

646 
key
->
u
.
ccmp
.
tfm
 = 
	`›“80211_«s_key_£tup_’üy±
(

647 
key_d©a
, 
key_Ën
, 
IEEE80211_CCMP_MIC_LEN
);

648 ià(
	`IS_ERR
(
key
->
u
.
ccmp
.
tfm
)) {

649 
”r
 = 
	`PTR_ERR
(
key
->
u
.
ccmp
.
tfm
);

650 
	`kä“
(
key
);

651  
	`ERR_PTR
(
”r
);

654 
WLAN_CIPHER_SUITE_CCMP_256
:

655 
key
->
cÚf
.
iv_Ën
 = 
IEEE80211_CCMP_256_HDR_LEN
;

656 
key
->
cÚf
.
icv_Ën
 = 
IEEE80211_CCMP_256_MIC_LEN
;

657 
i
 = 0; 
£q
 && i < 
IEEE80211_NUM_TIDS
 + 1; i++)

658 
j
 = 0; j < 
IEEE80211_CCMP_256_PN_LEN
; j++)

659 
key
->
u
.
ccmp
.
rx_²
[
i
][
j
] =

660 
£q
[
IEEE80211_CCMP_256_PN_LEN
 - 
j
 - 1];

664 
key
->
u
.
ccmp
.
tfm
 = 
	`›“80211_«s_key_£tup_’üy±
(

665 
key_d©a
, 
key_Ën
, 
IEEE80211_CCMP_256_MIC_LEN
);

666 ià(
	`IS_ERR
(
key
->
u
.
ccmp
.
tfm
)) {

667 
”r
 = 
	`PTR_ERR
(
key
->
u
.
ccmp
.
tfm
);

668 
	`kä“
(
key
);

669  
	`ERR_PTR
(
”r
);

672 
WLAN_CIPHER_SUITE_AES_CMAC
:

673 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

674 
key
->
cÚf
.
iv_Ën
 = 0;

675 ià(
ch”
 =ğ
WLAN_CIPHER_SUITE_AES_CMAC
)

676 
key
->
cÚf
.
icv_Ën
 = (
›“80211_mm›
);

678 
key
->
cÚf
.
icv_Ën
 = (
›“80211_mm›_16
);

679 ià(
£q
)

680 
j
 = 0; j < 
IEEE80211_CMAC_PN_LEN
; j++)

681 
key
->
u
.
«s_cmac
.
rx_²
[
j
] =

682 
£q
[
IEEE80211_CMAC_PN_LEN
 - 
j
 - 1];

687 
key
->
u
.
«s_cmac
.
tfm
 =

688 
	`›“80211_«s_cmac_key_£tup
(
key_d©a
, 
key_Ën
);

689 ià(
	`IS_ERR
(
key
->
u
.
«s_cmac
.
tfm
)) {

690 
”r
 = 
	`PTR_ERR
(
key
->
u
.
«s_cmac
.
tfm
);

691 
	`kä“
(
key
);

692  
	`ERR_PTR
(
”r
);

695 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

696 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

697 
key
->
cÚf
.
iv_Ën
 = 0;

698 
key
->
cÚf
.
icv_Ën
 = (
›“80211_mm›_16
);

699 ià(
£q
)

700 
j
 = 0; j < 
IEEE80211_GMAC_PN_LEN
; j++)

701 
key
->
u
.
«s_gmac
.
rx_²
[
j
] =

702 
£q
[
IEEE80211_GMAC_PN_LEN
 - 
j
 - 1];

706 
key
->
u
.
«s_gmac
.
tfm
 =

707 
	`›“80211_«s_gmac_key_£tup
(
key_d©a
, 
key_Ën
);

708 ià(
	`IS_ERR
(
key
->
u
.
«s_gmac
.
tfm
)) {

709 
”r
 = 
	`PTR_ERR
(
key
->
u
.
«s_gmac
.
tfm
);

710 
	`kä“
(
key
);

711  
	`ERR_PTR
(
”r
);

714 
WLAN_CIPHER_SUITE_GCMP
:

715 
WLAN_CIPHER_SUITE_GCMP_256
:

716 
key
->
cÚf
.
iv_Ën
 = 
IEEE80211_GCMP_HDR_LEN
;

717 
key
->
cÚf
.
icv_Ën
 = 
IEEE80211_GCMP_MIC_LEN
;

718 
i
 = 0; 
£q
 && i < 
IEEE80211_NUM_TIDS
 + 1; i++)

719 
j
 = 0; j < 
IEEE80211_GCMP_PN_LEN
; j++)

720 
key
->
u
.
gcmp
.
rx_²
[
i
][
j
] =

721 
£q
[
IEEE80211_GCMP_PN_LEN
 - 
j
 - 1];

725 
key
->
u
.
gcmp
.
tfm
 = 
	`›“80211_«s_gcm_key_£tup_’üy±
(
key_d©a
,

726 
key_Ën
);

727 ià(
	`IS_ERR
(
key
->
u
.
gcmp
.
tfm
)) {

728 
”r
 = 
	`PTR_ERR
(
key
->
u
.
gcmp
.
tfm
);

729 
	`kä“
(
key
);

730  
	`ERR_PTR
(
”r
);

734 
	`memıy
(
key
->
cÚf
.key, 
key_d©a
, 
key_Ën
);

735 
	`INIT_LIST_HEAD
(&
key
->
li¡
);

737  
key
;

738 
	}
}

740 
	$›“80211_key_ä“_commÚ
(
›“80211_key
 *
key
)

742 
key
->
cÚf
.
ch”
) {

743 
WLAN_CIPHER_SUITE_CCMP
:

744 
WLAN_CIPHER_SUITE_CCMP_256
:

745 
	`›“80211_«s_key_ä“
(
key
->
u
.
ccmp
.
tfm
);

747 
WLAN_CIPHER_SUITE_AES_CMAC
:

748 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

749 
	`›“80211_«s_cmac_key_ä“
(
key
->
u
.
«s_cmac
.
tfm
);

751 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

752 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

753 
	`›“80211_«s_gmac_key_ä“
(
key
->
u
.
«s_gmac
.
tfm
);

755 
WLAN_CIPHER_SUITE_GCMP
:

756 
WLAN_CIPHER_SUITE_GCMP_256
:

757 
	`›“80211_«s_gcm_key_ä“
(
key
->
u
.
gcmp
.
tfm
);

760 
	`kä“_£ns™ive
(
key
);

761 
	}
}

763 
	$__›“80211_key_de¡roy
(
›“80211_key
 *
key
,

764 
boŞ
 
d–ay_room
)

766 ià(
key
->
loÿl
) {

767 
›“80211_sub_if_d©a
 *
sd©a
 = 
key
->sdata;

769 
	`›“80211_debugfs_key_»move
(
key
);

771 ià(
d–ay_room
) {

773 
sd©a
->
üy±o_tx_room_³ndšg_dec
++;

774 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

775 &
sd©a
->
dec_room_Ãeded_wk
,

776 
HZ
 / 2);

778 
	`deü—£_room_Ãed_couÁ
(
sd©a
, 1);

782 
	`›“80211_key_ä“_commÚ
(
key
);

783 
	}
}

785 
	$›“80211_key_de¡roy
(
›“80211_key
 *
key
,

786 
boŞ
 
d–ay_room
)

788 ià(!
key
)

795 
	`synchrÚize_Ãt
();

797 
	`__›“80211_key_de¡roy
(
key
, 
d–ay_room
);

798 
	}
}

800 
	$›“80211_key_ä“_unu£d
(
›“80211_key
 *
key
)

802 ià(!
key
)

805 
	`WARN_ON
(
key
->
sd©a
 || key->
loÿl
);

806 
	`›“80211_key_ä“_commÚ
(
key
);

807 
	}
}

809 
boŞ
 
	$›“80211_key_id’tiÿl
(
›“80211_sub_if_d©a
 *
sd©a
,

810 
›“80211_key
 *
Şd
,

811 
›“80211_key
 *
Ãw
)

813 
u8
 
tk_Şd
[
WLAN_KEY_LEN_TKIP
], 
tk_Ãw
[WLAN_KEY_LEN_TKIP];

814 
u8
 *
tk_Şd
, *
tk_Ãw
;

816 ià(!
Şd
 || 
Ãw
->
cÚf
.
keyËn
 != old->conf.keylen)

817  
çl£
;

819 
tk_Şd
 = 
Şd
->
cÚf
.
key
;

820 
tk_Ãw
 = 
Ãw
->
cÚf
.
key
;

827 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

828 
Ãw
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_TKIP
 &&

829 
Ãw
->
cÚf
.
keyËn
 =ğ
WLAN_KEY_LEN_TKIP
 &&

830 !(
Ãw
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
)) {

831 
	`memıy
(
tk_Şd
, 
tk_Şd
, 
WLAN_KEY_LEN_TKIP
);

832 
	`memıy
(
tk_Ãw
, 
tk_Ãw
, 
WLAN_KEY_LEN_TKIP
);

833 
	`mem£t
(
tk_Şd
 + 
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
, 0, 8);

834 
	`mem£t
(
tk_Ãw
 + 
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
, 0, 8);

835 
tk_Şd
 = 
tk_Şd
;

836 
tk_Ãw
 = 
tk_Ãw
;

839  !
	`üy±o_memÃq
(
tk_Şd
, 
tk_Ãw
, 
Ãw
->
cÚf
.
keyËn
);

840 
	}
}

842 
	$›“80211_key_lšk
(
›“80211_key
 *
key
,

843 
›“80211_lšk_d©a
 *
lšk
,

844 
¡a_šfo
 *
¡a
)

846 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

847 
©omic_t
 
key_cŞÜ
 = 
	`ATOMIC_INIT
(0);

848 
›“80211_key
 *
Şd_key
 = 
NULL
;

849 
idx
 = 
key
->
cÚf
.
keyidx
;

850 
boŞ
 
·œwi£
 = 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
;

856 
boŞ
 
d–ay_room
 = 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
;

857 
»t
;

859 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

861 ià(
¡a
 && 
·œwi£
) {

862 
›“80211_key
 *
®t_key
;

864 
Şd_key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

865 
¡a
->
±k
[
idx
]);

866 
®t_key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

867 
¡a
->
±k
[
idx
 ^ 1]);

872 ià((
®t_key
 &&‡É_key->
cÚf
.
ch”
 !ğ
key
->conf.cipher) ||

873 (
Şd_key
 && old_key->
cÚf
.
ch”
 !ğ
key
->conf.cipher)) {

874 
»t
 = -
EOPNOTSUPP
;

875 
out
;

877 } ià(
¡a
) {

878 
lšk_¡a_šfo
 *
lšk_¡a
 = &
¡a
->
deæšk
;

879 
lšk_id
 = 
key
->
cÚf
.link_id;

881 ià(
lšk_id
 >= 0) {

882 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
lšk_id
],

883 
	`lockd•_is_h–d
(&
¡a
->
loÿl
->
hw
.
why
->
mtx
));

884 ià(!
lšk_¡a
) {

885 
»t
 = -
ENOLINK
;

886 
out
;

890 
Şd_key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

891 
lšk_¡a
->
gtk
[
idx
]);

893 ià(
idx
 < 
NUM_DEFAULT_KEYS
)

894 
Şd_key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

895 
sd©a
->
keys
[
idx
]);

896 ià(!
Şd_key
)

897 
Şd_key
 = 
	`why_d”eã»nû
(
sd©a
->
loÿl
->
hw
.
why
,

898 
lšk
->
gtk
[
idx
]);

902 ià(!
·œwi£
) {

903 ià(
Şd_key
 && old_key->
cÚf
.
ch”
 !ğ
key
->conf.cipher) {

904 
»t
 = -
EOPNOTSUPP
;

905 
out
;

913 ià(
	`›“80211_key_id’tiÿl
(
sd©a
, 
Şd_key
, 
key
)) {

914 
»t
 = -
EALREADY
;

915 
out
;

918 
key
->
loÿl
 = 
sd©a
->local;

919 
key
->
sd©a
 = sdata;

920 
key
->
¡a
 = sta;

926 
key
->
cŞÜ
 = 
	`©omic_šc_»tuº
(&
key_cŞÜ
);

929 ià(
¡a
 && s->¡a.
¥p_amsdu
)

930 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_SPP_AMSDU
;

932 
	`šüem’t_room_Ãed_couÁ
(
sd©a
);

934 
»t
 = 
	`›“80211_key_»¶aû
(
sd©a
, 
lšk
, 
¡a
, 
·œwi£
, 
Şd_key
, 
key
);

936 ià(!
»t
) {

937 
	`›“80211_debugfs_key_add
(
key
);

938 
	`›“80211_key_de¡roy
(
Şd_key
, 
d–ay_room
);

940 
	`›“80211_key_ä“
(
key
, 
d–ay_room
);

943 
key
 = 
NULL
;

945 
out
:

946 
	`›“80211_key_ä“_unu£d
(
key
);

947  
»t
;

948 
	}
}

950 
	$›“80211_key_ä“
(
›“80211_key
 *
key
, 
boŞ
 
d–ay_room
)

952 ià(!
key
)

958 ià(
key
->
sd©a
)

959 
	`›“80211_key_»¶aû
(
key
->
sd©a
, 
NULL
, key->
¡a
,

960 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
,

961 
key
, 
NULL
);

962 
	`›“80211_key_de¡roy
(
key
, 
d–ay_room
);

963 
	}
}

965 
	$›“80211_»’abË_keys
(
›“80211_sub_if_d©a
 *
sd©a
)

967 
›“80211_key
 *
key
;

968 
›“80211_sub_if_d©a
 *
vÏn
;

970 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

972 
sd©a
->
üy±o_tx_room_Ãeded_út
 = 0;

973 
sd©a
->
üy±o_tx_room_³ndšg_dec
 = 0;

975 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

976 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
) {

977 
vÏn
->
üy±o_tx_room_Ãeded_út
 = 0;

978 
vÏn
->
üy±o_tx_room_³ndšg_dec
 = 0;

982 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

983 
	`li¡_fÜ_—ch_’Œy
(
key
, &
sd©a
->
key_li¡
, 
li¡
) {

984 
	`šüem’t_room_Ãed_couÁ
(
sd©a
);

985 
	`›“80211_key_’abË_hw_acûl
(
key
);

988 
	}
}

990 
	$›“80211_™”_keys
(
›“80211_hw
 *
hw
,

991 
›“80211_vif
 *
vif
,

992 (*
™”
)(
›“80211_hw
 *
hw
,

993 
›“80211_vif
 *
vif
,

994 
›“80211_¡a
 *
¡a
,

995 
›“80211_key_cÚf
 *
key
,

996 *
d©a
),

997 *
™”_d©a
)

999 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1000 
›“80211_key
 *
key
, *
tmp
;

1001 
›“80211_sub_if_d©a
 *
sd©a
;

1003 
	`lockd•_as£¹_why
(
hw
->
why
);

1005 ià(
vif
) {

1006 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1007 
	`li¡_fÜ_—ch_’Œy_§ã
(
key
, 
tmp
, &
sd©a
->
key_li¡
, 
li¡
)

1008 
	`™”
(
hw
, &
sd©a
->
vif
,

1009 
key
->
¡a
 ? &key->¡a->¡¨: 
NULL
,

1010 &
key
->
cÚf
, 
™”_d©a
);

1012 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
)

1013 
	`li¡_fÜ_—ch_’Œy_§ã
(
key
, 
tmp
,

1014 &
sd©a
->
key_li¡
, 
li¡
)

1015 
	`™”
(
hw
, &
sd©a
->
vif
,

1016 
key
->
¡a
 ? &key->¡a->¡¨: 
NULL
,

1017 &
key
->
cÚf
, 
™”_d©a
);

1019 
	}
}

1020 
EXPORT_SYMBOL
(
›“80211_™”_keys
);

1023 
	$_›“80211_™”_keys_rcu
(
›“80211_hw
 *
hw
,

1024 
›“80211_sub_if_d©a
 *
sd©a
,

1025 (*
™”
)(
›“80211_hw
 *
hw
,

1026 
›“80211_vif
 *
vif
,

1027 
›“80211_¡a
 *
¡a
,

1028 
›“80211_key_cÚf
 *
key
,

1029 *
d©a
),

1030 *
™”_d©a
)

1032 
›“80211_key
 *
key
;

1034 
	`li¡_fÜ_—ch_’Œy_rcu
(
key
, &
sd©a
->
key_li¡
, 
li¡
) {

1036 ià(
key
->
¡a
 && key->¡a->
»moved
)

1038 ià(!(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
))

1041 
	`™”
(
hw
, &
sd©a
->
vif
,

1042 
key
->
¡a
 ? &key->¡a->¡¨: 
NULL
,

1043 &
key
->
cÚf
, 
™”_d©a
);

1045 
	}
}

1047 
	$›“80211_™”_keys_rcu
(
›“80211_hw
 *
hw
,

1048 
›“80211_vif
 *
vif
,

1049 (*
™”
)(
›“80211_hw
 *
hw
,

1050 
›“80211_vif
 *
vif
,

1051 
›“80211_¡a
 *
¡a
,

1052 
›“80211_key_cÚf
 *
key
,

1053 *
d©a
),

1054 *
™”_d©a
)

1056 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1057 
›“80211_sub_if_d©a
 *
sd©a
;

1059 ià(
vif
) {

1060 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1061 
	`_›“80211_™”_keys_rcu
(
hw
, 
sd©a
, 
™”
, 
™”_d©a
);

1063 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
)

1064 
	`_›“80211_™”_keys_rcu
(
hw
, 
sd©a
, 
™”
, 
™”_d©a
);

1066 
	}
}

1067 
EXPORT_SYMBOL
(
›“80211_™”_keys_rcu
);

1069 
	$›“80211_ä“_keys_içû
(
›“80211_sub_if_d©a
 *
sd©a
,

1070 
li¡_h—d
 *
keys
)

1072 
›“80211_key
 *
key
, *
tmp
;

1074 
	`deü—£_room_Ãed_couÁ
(
sd©a
,

1075 
sd©a
->
üy±o_tx_room_³ndšg_dec
);

1076 
sd©a
->
üy±o_tx_room_³ndšg_dec
 = 0;

1078 
	`›“80211_debugfs_key_»move_mgmt_deçuÉ
(
sd©a
);

1079 
	`›“80211_debugfs_key_»move_b—cÚ_deçuÉ
(
sd©a
);

1081 
	`li¡_fÜ_—ch_’Œy_§ã
(
key
, 
tmp
, &
sd©a
->
key_li¡
, 
li¡
) {

1082 
	`›“80211_key_»¶aû
(
key
->
sd©a
, 
NULL
, key->
¡a
,

1083 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
,

1084 
key
, 
NULL
);

1085 
	`li¡_add_
(&
key
->
li¡
, 
keys
);

1088 
	`›“80211_debugfs_key_upd©e_deçuÉ
(
sd©a
);

1089 
	}
}

1091 
	$›“80211_»move_lšk_keys
(
›“80211_lšk_d©a
 *
lšk
,

1092 
li¡_h—d
 *
keys
)

1094 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1095 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1096 
›“80211_key
 *
key
, *
tmp
;

1098 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1100 
	`li¡_fÜ_—ch_’Œy_§ã
(
key
, 
tmp
, &
sd©a
->
key_li¡
, 
li¡
) {

1101 ià(
key
->
cÚf
.
lšk_id
 !ğ
lšk
->link_id)

1103 
	`›“80211_key_»¶aû
(
key
->
sd©a
, 
lšk
, key->
¡a
,

1104 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
,

1105 
key
, 
NULL
);

1106 
	`li¡_add_
(&
key
->
li¡
, 
keys
);

1108 
	}
}

1110 
	$›“80211_ä“_key_li¡
(
›“80211_loÿl
 *
loÿl
,

1111 
li¡_h—d
 *
keys
)

1113 
›“80211_key
 *
key
, *
tmp
;

1115 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1117 
	`li¡_fÜ_—ch_’Œy_§ã
(
key
, 
tmp
, 
keys
, 
li¡
)

1118 
	`__›“80211_key_de¡roy
(
key
, 
çl£
);

1119 
	}
}

1121 
	$›“80211_ä“_keys
(
›“80211_sub_if_d©a
 *
sd©a
,

1122 
boŞ
 
fÜû_synchrÚize
)

1124 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1125 
›“80211_sub_if_d©a
 *
vÏn
;

1126 
›“80211_sub_if_d©a
 *
ma¡”
;

1127 
›“80211_key
 *
key
, *
tmp
;

1128 
	`LIST_HEAD
(
keys
);

1130 
	`why_d–ayed_wÜk_ÿnûl
(
loÿl
->
hw
.
why
,

1131 &
sd©a
->
dec_room_Ãeded_wk
);

1133 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1135 
	`›“80211_ä“_keys_içû
(
sd©a
, &
keys
);

1137 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

1138 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
)

1139 
	`›“80211_ä“_keys_içû
(
vÏn
, &
keys
);

1142 ià(!
	`li¡_em±y
(&
keys
è|| 
fÜû_synchrÚize
)

1143 
	`synchrÚize_Ãt
();

1144 
	`li¡_fÜ_—ch_’Œy_§ã
(
key
, 
tmp
, &
keys
, 
li¡
)

1145 
	`__›“80211_key_de¡roy
(
key
, 
çl£
);

1147 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

1148 ià(
sd©a
->
bss
) {

1149 
ma¡”
 = 
	`cÚš”_of
(
sd©a
->
bss
,

1150 
›“80211_sub_if_d©a
,

1151 
u
.
­
);

1153 
	`WARN_ON_ONCE
(
sd©a
->
üy±o_tx_room_Ãeded_út
 !=

1154 
ma¡”
->
üy±o_tx_room_Ãeded_út
);

1157 
	`WARN_ON_ONCE
(
sd©a
->
üy±o_tx_room_Ãeded_út
 ||

1158 
sd©a
->
üy±o_tx_room_³ndšg_dec
);

1161 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

1162 
	`li¡_fÜ_—ch_’Œy
(
vÏn
, &
sd©a
->
u
.
­
.
vÏns
, u.vÏn.
li¡
)

1163 
	`WARN_ON_ONCE
(
vÏn
->
üy±o_tx_room_Ãeded_út
 ||

1164 
vÏn
->
üy±o_tx_room_³ndšg_dec
);

1166 
	}
}

1168 
	$›“80211_ä“_¡a_keys
(
›“80211_loÿl
 *
loÿl
,

1169 
¡a_šfo
 *
¡a
)

1171 
›“80211_key
 *
key
;

1172 
i
;

1174 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1176 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->
deæšk
.
gtk
); i++) {

1177 
key
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
, 
¡a
->
deæšk
.
gtk
[
i
]);

1178 ià(!
key
)

1180 
	`›“80211_key_»¶aû
(
key
->
sd©a
, 
NULL
, key->
¡a
,

1181 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
,

1182 
key
, 
NULL
);

1183 
	`__›“80211_key_de¡roy
(
key
, key->
sd©a
->
vif
.
ty³
 ==

1184 
NL80211_IFTYPE_STATION
);

1187 
i
 = 0; i < 
NUM_DEFAULT_KEYS
; i++) {

1188 
key
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
, 
¡a
->
±k
[
i
]);

1189 ià(!
key
)

1191 
	`›“80211_key_»¶aû
(
key
->
sd©a
, 
NULL
, key->
¡a
,

1192 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PAIRWISE
,

1193 
key
, 
NULL
);

1194 
	`__›“80211_key_de¡roy
(
key
, key->
sd©a
->
vif
.
ty³
 ==

1195 
NL80211_IFTYPE_STATION
);

1197 
	}
}

1199 
	$›“80211_d–ayed_room_dec
(
why
 *wiphy,

1200 
why_wÜk
 *
wk
)

1202 
›“80211_sub_if_d©a
 *
sd©a
;

1204 
sd©a
 = 
	`cÚš”_of
(
wk
, 
›“80211_sub_if_d©a
,

1205 
dec_room_Ãeded_wk
.
wÜk
);

1223 
	`deü—£_room_Ãed_couÁ
(
sd©a
,

1224 
sd©a
->
üy±o_tx_room_³ndšg_dec
);

1225 
sd©a
->
üy±o_tx_room_³ndšg_dec
 = 0;

1226 
	}
}

1228 
	$›“80211_gtk_»key_nÙify
(
›“80211_vif
 *
vif
, cÚ¡ 
u8
 *
bssid
,

1229 cÚ¡ 
u8
 *
»¶ay_ùr
, 
gå_t
 
gå
)

1231 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1233 
	`Œaû_­i_gtk_»key_nÙify
(
sd©a
, 
bssid
, 
»¶ay_ùr
);

1235 
	`cfg80211_gtk_»key_nÙify
(
sd©a
->
dev
, 
bssid
, 
»¶ay_ùr
, 
gå
);

1236 
	}
}

1237 
EXPORT_SYMBOL_GPL
(
›“80211_gtk_»key_nÙify
);

1239 
	$›“80211_g‘_key_rx_£q
(
›“80211_key_cÚf
 *
keycÚf
,

1240 
tid
, 
›“80211_key_£q
 *
£q
)

1242 
›“80211_key
 *
key
;

1243 cÚ¡ 
u8
 *
²
;

1245 
key
 = 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

1247 
key
->
cÚf
.
ch”
) {

1248 
WLAN_CIPHER_SUITE_TKIP
:

1249 ià(
	`WARN_ON
(
tid
 < 0 ||id >ğ
IEEE80211_NUM_TIDS
))

1251 
£q
->
tk
.
iv32
 = 
key
->
u
.tk.
rx
[
tid
].iv32;

1252 
£q
->
tk
.
iv16
 = 
key
->
u
.tk.
rx
[
tid
].iv16;

1254 
WLAN_CIPHER_SUITE_CCMP
:

1255 
WLAN_CIPHER_SUITE_CCMP_256
:

1256 ià(
	`WARN_ON
(
tid
 < -1 ||id >ğ
IEEE80211_NUM_TIDS
))

1258 ià(
tid
 < 0)

1259 
²
 = 
key
->
u
.
ccmp
.
rx_²
[
IEEE80211_NUM_TIDS
];

1261 
²
 = 
key
->
u
.
ccmp
.
rx_²
[
tid
];

1262 
	`memıy
(
£q
->
ccmp
.
²
,…n, 
IEEE80211_CCMP_PN_LEN
);

1264 
WLAN_CIPHER_SUITE_AES_CMAC
:

1265 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1266 ià(
	`WARN_ON
(
tid
 != 0))

1268 
²
 = 
key
->
u
.
«s_cmac
.
rx_²
;

1269 
	`memıy
(
£q
->
«s_cmac
.
²
,…n, 
IEEE80211_CMAC_PN_LEN
);

1271 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1272 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1273 ià(
	`WARN_ON
(
tid
 != 0))

1275 
²
 = 
key
->
u
.
«s_gmac
.
rx_²
;

1276 
	`memıy
(
£q
->
«s_gmac
.
²
,…n, 
IEEE80211_GMAC_PN_LEN
);

1278 
WLAN_CIPHER_SUITE_GCMP
:

1279 
WLAN_CIPHER_SUITE_GCMP_256
:

1280 ià(
	`WARN_ON
(
tid
 < -1 ||id >ğ
IEEE80211_NUM_TIDS
))

1282 ià(
tid
 < 0)

1283 
²
 = 
key
->
u
.
gcmp
.
rx_²
[
IEEE80211_NUM_TIDS
];

1285 
²
 = 
key
->
u
.
gcmp
.
rx_²
[
tid
];

1286 
	`memıy
(
£q
->
gcmp
.
²
,…n, 
IEEE80211_GCMP_PN_LEN
);

1289 
	}
}

1290 
EXPORT_SYMBOL
(
›“80211_g‘_key_rx_£q
);

1292 
	$›“80211_£t_key_rx_£q
(
›“80211_key_cÚf
 *
keycÚf
,

1293 
tid
, 
›“80211_key_£q
 *
£q
)

1295 
›“80211_key
 *
key
;

1296 
u8
 *
²
;

1298 
key
 = 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

1300 
key
->
cÚf
.
ch”
) {

1301 
WLAN_CIPHER_SUITE_TKIP
:

1302 ià(
	`WARN_ON
(
tid
 < 0 ||id >ğ
IEEE80211_NUM_TIDS
))

1304 
key
->
u
.
tk
.
rx
[
tid
].
iv32
 = 
£q
->tkip.iv32;

1305 
key
->
u
.
tk
.
rx
[
tid
].
iv16
 = 
£q
->tkip.iv16;

1307 
WLAN_CIPHER_SUITE_CCMP
:

1308 
WLAN_CIPHER_SUITE_CCMP_256
:

1309 ià(
	`WARN_ON
(
tid
 < -1 ||id >ğ
IEEE80211_NUM_TIDS
))

1311 ià(
tid
 < 0)

1312 
²
 = 
key
->
u
.
ccmp
.
rx_²
[
IEEE80211_NUM_TIDS
];

1314 
²
 = 
key
->
u
.
ccmp
.
rx_²
[
tid
];

1315 
	`memıy
(
²
, 
£q
->
ccmp
.², 
IEEE80211_CCMP_PN_LEN
);

1317 
WLAN_CIPHER_SUITE_AES_CMAC
:

1318 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1319 ià(
	`WARN_ON
(
tid
 != 0))

1321 
²
 = 
key
->
u
.
«s_cmac
.
rx_²
;

1322 
	`memıy
(
²
, 
£q
->
«s_cmac
.², 
IEEE80211_CMAC_PN_LEN
);

1324 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1325 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1326 ià(
	`WARN_ON
(
tid
 != 0))

1328 
²
 = 
key
->
u
.
«s_gmac
.
rx_²
;

1329 
	`memıy
(
²
, 
£q
->
«s_gmac
.², 
IEEE80211_GMAC_PN_LEN
);

1331 
WLAN_CIPHER_SUITE_GCMP
:

1332 
WLAN_CIPHER_SUITE_GCMP_256
:

1333 ià(
	`WARN_ON
(
tid
 < -1 ||id >ğ
IEEE80211_NUM_TIDS
))

1335 ià(
tid
 < 0)

1336 
²
 = 
key
->
u
.
gcmp
.
rx_²
[
IEEE80211_NUM_TIDS
];

1338 
²
 = 
key
->
u
.
gcmp
.
rx_²
[
tid
];

1339 
	`memıy
(
²
, 
£q
->
gcmp
.², 
IEEE80211_GCMP_PN_LEN
);

1342 
	`WARN_ON
(1);

1345 
	}
}

1346 
EXPORT_SYMBOL_GPL
(
›“80211_£t_key_rx_£q
);

1348 
	$›“80211_»move_key
(
›“80211_key_cÚf
 *
keycÚf
)

1350 
›“80211_key
 *
key
;

1352 
key
 = 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

1354 
	`lockd•_as£¹_why
(
key
->
loÿl
->
hw
.
why
);

1360 ià(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
) {

1361 
key
->
æags
 &ğ~
KEY_FLAG_UPLOADED_TO_HARDWARE
;

1363 ià(!(
key
->
cÚf
.
æags
 & (
IEEE80211_KEY_FLAG_GENERATE_MMIC
 |

1364 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
 |

1365 
IEEE80211_KEY_FLAG_RESERVE_TAILROOM
)))

1366 
	`šüem’t_room_Ãed_couÁ
(
key
->
sd©a
);

1369 
	`›“80211_key_ä“
(
key
, 
çl£
);

1370 
	}
}

1371 
EXPORT_SYMBOL_GPL
(
›“80211_»move_key
);

1373 
›“80211_key_cÚf
 *

1374 
	$›“80211_gtk_»key_add
(
›“80211_vif
 *
vif
,

1375 
›“80211_key_cÚf
 *
keycÚf
,

1376 
lšk_id
)

1378 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1379 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1380 
›“80211_key
 *
key
;

1381 
”r
;

1382 
›“80211_lšk_d©a
 *
lšk_d©a
 =

1383 
lšk_id
 < 0 ? &
sd©a
->
deæšk
 :

1384 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
], sdata);

1386 ià(
	`WARN_ON
(!
lšk_d©a
))

1387  
	`ERR_PTR
(-
EINVAL
);

1389 ià(
	`WARN_ON
(!
loÿl
->
wowÏn
))

1390  
	`ERR_PTR
(-
EINVAL
);

1392 ià(
	`WARN_ON
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_STATION
))

1393  
	`ERR_PTR
(-
EINVAL
);

1395 
key
 = 
	`›“80211_key_®loc
(
keycÚf
->
ch”
, keycÚf->
keyidx
,

1396 
keycÚf
->
keyËn
, keycÚf->
key
,

1397 0, 
NULL
);

1398 ià(
	`IS_ERR
(
key
))

1399  
	`ERR_CAST
(
key
);

1401 ià(
sd©a
->
u
.
mgd
.
må
 !ğ
IEEE80211_MFP_DISABLED
)

1402 
key
->
cÚf
.
æags
 |ğ
IEEE80211_KEY_FLAG_RX_MGMT
;

1404 
key
->
cÚf
.
lšk_id
 =†ink_id;

1406 
”r
 = 
	`›“80211_key_lšk
(
key
, 
lšk_d©a
, 
NULL
);

1407 ià(
”r
)

1408  
	`ERR_PTR
(
”r
);

1410  &
key
->
cÚf
;

1411 
	}
}

1412 
EXPORT_SYMBOL_GPL
(
›“80211_gtk_»key_add
);

1414 
	$›“80211_key_mic_çu»
(
›“80211_key_cÚf
 *
keycÚf
)

1416 
›“80211_key
 *
key
;

1418 
key
 = 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

1420 
key
->
cÚf
.
ch”
) {

1421 
WLAN_CIPHER_SUITE_AES_CMAC
:

1422 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1423 
key
->
u
.
«s_cmac
.
icv”rÜs
++;

1425 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1426 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1427 
key
->
u
.
«s_gmac
.
icv”rÜs
++;

1433 
	}
}

1434 
EXPORT_SYMBOL_GPL
(
›“80211_key_mic_çu»
);

1436 
	$›“80211_key_»¶ay
(
›“80211_key_cÚf
 *
keycÚf
)

1438 
›“80211_key
 *
key
;

1440 
key
 = 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

1442 
key
->
cÚf
.
ch”
) {

1443 
WLAN_CIPHER_SUITE_CCMP
:

1444 
WLAN_CIPHER_SUITE_CCMP_256
:

1445 
key
->
u
.
ccmp
.
»¶ays
++;

1447 
WLAN_CIPHER_SUITE_AES_CMAC
:

1448 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1449 
key
->
u
.
«s_cmac
.
»¶ays
++;

1451 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1452 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1453 
key
->
u
.
«s_gmac
.
»¶ays
++;

1455 
WLAN_CIPHER_SUITE_GCMP
:

1456 
WLAN_CIPHER_SUITE_GCMP_256
:

1457 
key
->
u
.
gcmp
.
»¶ays
++;

1460 
	}
}

1461 
EXPORT_SYMBOL_GPL
(
›“80211_key_»¶ay
);

1463 
	$›“80211_key_sw™ch_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

1464 
d–_lšks_mask
,

1465 
add_lšks_mask
)

1467 
›“80211_key
 *
key
;

1468 
»t
;

1470 
	`li¡_fÜ_—ch_’Œy
(
key
, &
sd©a
->
key_li¡
, 
li¡
) {

1471 ià(
key
->
cÚf
.
lšk_id
 < 0 ||

1472 !(
d–_lšks_mask
 & 
	`BIT
(
key
->
cÚf
.
lšk_id
)))

1476 
	`WARN_ON
(
key
->
¡a
);

1478 
	`›“80211_key_di§bË_hw_acûl
(
key
);

1481 
	`li¡_fÜ_—ch_’Œy
(
key
, &
sd©a
->
key_li¡
, 
li¡
) {

1482 ià(
key
->
cÚf
.
lšk_id
 < 0 ||

1483 !(
add_lšks_mask
 & 
	`BIT
(
key
->
cÚf
.
lšk_id
)))

1487 
	`WARN_ON
(
key
->
¡a
);

1489 
»t
 = 
	`›“80211_key_’abË_hw_acûl
(
key
);

1490 ià(
»t
)

1491  
»t
;

1495 
	}
}

	@key.h

8 #iâdeà
IEEE80211_KEY_H


9 
	#IEEE80211_KEY_H


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/li¡.h
>

13 
	~<lšux/üy±o.h
>

14 
	~<lšux/rcupd©e.h
>

15 
	~<üy±o/¬c4.h
>

16 
	~<Ãt/mac80211.h
>

18 
	#NUM_DEFAULT_KEYS
 4

	)

19 
	#NUM_DEFAULT_MGMT_KEYS
 2

	)

20 
	#NUM_DEFAULT_BEACON_KEYS
 2

	)

21 
	#INVALID_PTK_KEYIDX
 2

	)

23 
	g›“80211_loÿl
;

24 
	g›“80211_sub_if_d©a
;

25 
	g›“80211_lšk_d©a
;

26 
	g¡a_šfo
;

35 
	e›“80211_š‹º®_key_æags
 {

36 
	mKEY_FLAG_UPLOADED_TO_HARDWARE
 = 
BIT
(0),

37 
	mKEY_FLAG_TAINTED
 = 
BIT
(1),

40 
	e›“80211_š‹º®_tk_¡©e
 {

41 
	mTKIP_STATE_NOT_INIT
,

42 
	mTKIP_STATE_PHASE1_DONE
,

43 
	mTKIP_STATE_PHASE1_HW_UPLOADED
,

46 
	stk_ùx
 {

47 
u16
 
	mp1k
[5];

48 
u32
 
	mp1k_iv32
;

49 
›“80211_š‹º®_tk_¡©e
 
	m¡©e
;

52 
	stk_ùx_rx
 {

53 
tk_ùx
 
	mùx
;

54 
u32
 
	miv32
;

55 
u16
 
	miv16
;

58 
	s›“80211_key
 {

59 
›“80211_loÿl
 *
	mloÿl
;

60 
›“80211_sub_if_d©a
 *
	msd©a
;

61 
¡a_šfo
 *
	m¡a
;

64 
li¡_h—d
 
	mli¡
;

67 
	mæags
;

72 
¥šlock_t
 
	mtxlock
;

75 
tk_ùx
 
	mtx
;

78 
tk_ùx_rx
 
	mrx
[
IEEE80211_NUM_TIDS
];

81 
u32
 
	mmic_çu»s
;

82 } 
	mtk
;

90 
u8
 
	mrx_²
[
IEEE80211_NUM_TIDS
 + 1][
IEEE80211_CCMP_PN_LEN
];

91 
üy±o_«ad
 *
	mtfm
;

92 
u32
 
	m»¶ays
;

93 } 
	mccmp
;

95 
u8
 
	mrx_²
[
IEEE80211_CMAC_PN_LEN
];

96 
üy±o_shash
 *
	mtfm
;

97 
u32
 
	m»¶ays
;

98 
u32
 
	micv”rÜs
;

99 } 
	m«s_cmac
;

101 
u8
 
	mrx_²
[
IEEE80211_GMAC_PN_LEN
];

102 
üy±o_«ad
 *
	mtfm
;

103 
u32
 
	m»¶ays
;

104 
u32
 
	micv”rÜs
;

105 } 
	m«s_gmac
;

112 
u8
 
	mrx_²
[
IEEE80211_NUM_TIDS
 + 1][
IEEE80211_GCMP_PN_LEN
];

113 
üy±o_«ad
 *
	mtfm
;

114 
u32
 
	m»¶ays
;

115 } 
	mgcmp
;

118 
u8
 
	mrx_²
[
IEEE80211_NUM_TIDS
 + 1][
IEEE80211_MAX_PN_LEN
];

119 } 
	mg’
;

120 } 
	mu
;

122 #ifdeà
CONFIG_MAC80211_DEBUGFS


124 
d’Œy
 *
	m¡®šk
;

125 
d’Œy
 *
	mdœ
;

126 
	mút
;

127 } 
	mdebugfs
;

130 
	mcŞÜ
;

136 
›“80211_key_cÚf
 
	mcÚf
;

139 
›“80211_key
 *

140 
›“80211_key_®loc
(
u32
 
ch”
, 
idx
, 
size_t
 
key_Ën
,

141 cÚ¡ 
u8
 *
key_d©a
,

142 
size_t
 
£q_Ën
, cÚ¡ 
u8
 *
£q
);

147 
›“80211_key_lšk
(
›“80211_key
 *
key
,

148 
›“80211_lšk_d©a
 *
lšk
,

149 
¡a_šfo
 *
¡a
);

150 
›“80211_£t_tx_key
(
›“80211_key
 *
key
);

151 
›“80211_key_ä“
(
›“80211_key
 *
key
, 
boŞ
 
d–ay_room
);

152 
›“80211_key_ä“_unu£d
(
›“80211_key
 *
key
);

153 
›“80211_£t_deçuÉ_key
(
›“80211_lšk_d©a
 *
lšk
, 
idx
,

154 
boŞ
 
uni
, boŞ 
muÉi
);

155 
›“80211_£t_deçuÉ_mgmt_key
(
›“80211_lšk_d©a
 *
lšk
,

156 
idx
);

157 
›“80211_£t_deçuÉ_b—cÚ_key
(
›“80211_lšk_d©a
 *
lšk
,

158 
idx
);

159 
›“80211_»move_lšk_keys
(
›“80211_lšk_d©a
 *
lšk
,

160 
li¡_h—d
 *
keys
);

161 
›“80211_ä“_key_li¡
(
›“80211_loÿl
 *
loÿl
,

162 
li¡_h—d
 *
keys
);

163 
›“80211_ä“_keys
(
›“80211_sub_if_d©a
 *
sd©a
,

164 
boŞ
 
fÜû_synchrÚize
);

165 
›“80211_ä“_¡a_keys
(
›“80211_loÿl
 *
loÿl
,

166 
¡a_šfo
 *
¡a
);

167 
›“80211_»’abË_keys
(
›“80211_sub_if_d©a
 *
sd©a
);

168 
›“80211_key_sw™ch_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

169 
d–_lšks_mask
,

170 
add_lšks_mask
);

171 
›“80211_d–ayed_room_dec
(
why
 *wiphy,

172 
why_wÜk
 *
wk
);

	@led.c

7 
	~<lšux/if.h
>

8 
	~<lšux/¦ab.h
>

9 
	~<lšux/expÜt.h
>

10 
	~"Ëd.h
"

12 
	$›“80211_Ëd_assoc
(
›“80211_loÿl
 *
loÿl
, 
boŞ
 
assocŸ‹d
)

14 ià(!
	`©omic_»ad
(&
loÿl
->
assoc_Ëd_aùive
))

16 ià(
assocŸ‹d
)

17 
	`Ëd_Œigg”_ev’t
(&
loÿl
->
assoc_Ëd
, 
LED_FULL
);

19 
	`Ëd_Œigg”_ev’t
(&
loÿl
->
assoc_Ëd
, 
LED_OFF
);

20 
	}
}

22 
	$›“80211_Ëd_¿dio
(
›“80211_loÿl
 *
loÿl
, 
boŞ
 
’abËd
)

24 ià(!
	`©omic_»ad
(&
loÿl
->
¿dio_Ëd_aùive
))

26 ià(
’abËd
)

27 
	`Ëd_Œigg”_ev’t
(&
loÿl
->
¿dio_Ëd
, 
LED_FULL
);

29 
	`Ëd_Œigg”_ev’t
(&
loÿl
->
¿dio_Ëd
, 
LED_OFF
);

30 
	}
}

32 
	$›“80211_®loc_Ëd_Çmes
(
›“80211_loÿl
 *
loÿl
)

34 
loÿl
->
rx_Ëd
.
Çme
 = 
	`ka¥rštf
(
GFP_KERNEL
, "%srx",

35 
	`why_Çme
(
loÿl
->
hw
.
why
));

36 
loÿl
->
tx_Ëd
.
Çme
 = 
	`ka¥rštf
(
GFP_KERNEL
, "%stx",

37 
	`why_Çme
(
loÿl
->
hw
.
why
));

38 
loÿl
->
assoc_Ëd
.
Çme
 = 
	`ka¥rštf
(
GFP_KERNEL
, "%sassoc",

39 
	`why_Çme
(
loÿl
->
hw
.
why
));

40 
loÿl
->
¿dio_Ëd
.
Çme
 = 
	`ka¥rštf
(
GFP_KERNEL
, "%sradio",

41 
	`why_Çme
(
loÿl
->
hw
.
why
));

42 
	}
}

44 
	$›“80211_ä“_Ëd_Çmes
(
›“80211_loÿl
 *
loÿl
)

46 
	`kä“
(
loÿl
->
rx_Ëd
.
Çme
);

47 
	`kä“
(
loÿl
->
tx_Ëd
.
Çme
);

48 
	`kä“
(
loÿl
->
assoc_Ëd
.
Çme
);

49 
	`kä“
(
loÿl
->
¿dio_Ëd
.
Çme
);

50 
	}
}

52 
	$›“80211_tx_Ëd_aùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

54 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

55 
›“80211_loÿl
,

56 
tx_Ëd
);

58 
	`©omic_šc
(&
loÿl
->
tx_Ëd_aùive
);

61 
	}
}

63 
	$›“80211_tx_Ëd_d—ùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

65 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

66 
›“80211_loÿl
,

67 
tx_Ëd
);

69 
	`©omic_dec
(&
loÿl
->
tx_Ëd_aùive
);

70 
	}
}

72 
	$›“80211_rx_Ëd_aùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

74 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

75 
›“80211_loÿl
,

76 
rx_Ëd
);

78 
	`©omic_šc
(&
loÿl
->
rx_Ëd_aùive
);

81 
	}
}

83 
	$›“80211_rx_Ëd_d—ùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

85 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

86 
›“80211_loÿl
,

87 
rx_Ëd
);

89 
	`©omic_dec
(&
loÿl
->
rx_Ëd_aùive
);

90 
	}
}

92 
	$›“80211_assoc_Ëd_aùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

94 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

95 
›“80211_loÿl
,

96 
assoc_Ëd
);

98 
	`©omic_šc
(&
loÿl
->
assoc_Ëd_aùive
);

101 
	}
}

103 
	$›“80211_assoc_Ëd_d—ùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

105 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

106 
›“80211_loÿl
,

107 
assoc_Ëd
);

109 
	`©omic_dec
(&
loÿl
->
assoc_Ëd_aùive
);

110 
	}
}

112 
	$›“80211_¿dio_Ëd_aùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

114 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

115 
›“80211_loÿl
,

116 
¿dio_Ëd
);

118 
	`©omic_šc
(&
loÿl
->
¿dio_Ëd_aùive
);

121 
	}
}

123 
	$›“80211_¿dio_Ëd_d—ùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

125 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

126 
›“80211_loÿl
,

127 
¿dio_Ëd
);

129 
	`©omic_dec
(&
loÿl
->
¿dio_Ëd_aùive
);

130 
	}
}

132 
	$›“80211_t_Ëd_aùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

134 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

135 
›“80211_loÿl
,

136 
t_Ëd
);

138 
	`©omic_šc
(&
loÿl
->
t_Ëd_aùive
);

141 
	}
}

143 
	$›“80211_t_Ëd_d—ùiv©e
(
Ëd_şassdev
 *
Ëd_cdev
)

145 
›“80211_loÿl
 *
loÿl
 = 
	`cÚš”_of
(
Ëd_cdev
->
Œigg”
,

146 
›“80211_loÿl
,

147 
t_Ëd
);

149 
	`©omic_dec
(&
loÿl
->
t_Ëd_aùive
);

150 
	}
}

152 
	$›“80211_Ëd_š™
(
›“80211_loÿl
 *
loÿl
)

154 
	`©omic_£t
(&
loÿl
->
rx_Ëd_aùive
, 0);

155 
loÿl
->
rx_Ëd
.
aùiv©e
 = 
›“80211_rx_Ëd_aùiv©e
;

156 
loÿl
->
rx_Ëd
.
d—ùiv©e
 = 
›“80211_rx_Ëd_d—ùiv©e
;

157 ià(
loÿl
->
rx_Ëd
.
Çme
 && 
	`Ëd_Œigg”_»gi¡”
(&local->rx_led)) {

158 
	`kä“
(
loÿl
->
rx_Ëd
.
Çme
);

159 
loÿl
->
rx_Ëd
.
Çme
 = 
NULL
;

162 
	`©omic_£t
(&
loÿl
->
tx_Ëd_aùive
, 0);

163 
loÿl
->
tx_Ëd
.
aùiv©e
 = 
›“80211_tx_Ëd_aùiv©e
;

164 
loÿl
->
tx_Ëd
.
d—ùiv©e
 = 
›“80211_tx_Ëd_d—ùiv©e
;

165 ià(
loÿl
->
tx_Ëd
.
Çme
 && 
	`Ëd_Œigg”_»gi¡”
(&local->tx_led)) {

166 
	`kä“
(
loÿl
->
tx_Ëd
.
Çme
);

167 
loÿl
->
tx_Ëd
.
Çme
 = 
NULL
;

170 
	`©omic_£t
(&
loÿl
->
assoc_Ëd_aùive
, 0);

171 
loÿl
->
assoc_Ëd
.
aùiv©e
 = 
›“80211_assoc_Ëd_aùiv©e
;

172 
loÿl
->
assoc_Ëd
.
d—ùiv©e
 = 
›“80211_assoc_Ëd_d—ùiv©e
;

173 ià(
loÿl
->
assoc_Ëd
.
Çme
 && 
	`Ëd_Œigg”_»gi¡”
(&local->assoc_led)) {

174 
	`kä“
(
loÿl
->
assoc_Ëd
.
Çme
);

175 
loÿl
->
assoc_Ëd
.
Çme
 = 
NULL
;

178 
	`©omic_£t
(&
loÿl
->
¿dio_Ëd_aùive
, 0);

179 
loÿl
->
¿dio_Ëd
.
aùiv©e
 = 
›“80211_¿dio_Ëd_aùiv©e
;

180 
loÿl
->
¿dio_Ëd
.
d—ùiv©e
 = 
›“80211_¿dio_Ëd_d—ùiv©e
;

181 ià(
loÿl
->
¿dio_Ëd
.
Çme
 && 
	`Ëd_Œigg”_»gi¡”
(&local->radio_led)) {

182 
	`kä“
(
loÿl
->
¿dio_Ëd
.
Çme
);

183 
loÿl
->
¿dio_Ëd
.
Çme
 = 
NULL
;

186 
	`©omic_£t
(&
loÿl
->
t_Ëd_aùive
, 0);

187 ià(
loÿl
->
t_Ëd_Œigg”
) {

188 
loÿl
->
t_Ëd
.
aùiv©e
 = 
›“80211_t_Ëd_aùiv©e
;

189 
loÿl
->
t_Ëd
.
d—ùiv©e
 = 
›“80211_t_Ëd_d—ùiv©e
;

190 ià(
	`Ëd_Œigg”_»gi¡”
(&
loÿl
->
t_Ëd
)) {

191 
	`kä“
(
loÿl
->
t_Ëd_Œigg”
);

192 
loÿl
->
t_Ëd_Œigg”
 = 
NULL
;

195 
	}
}

197 
	$›“80211_Ëd_ex™
(
›“80211_loÿl
 *
loÿl
)

199 ià(
loÿl
->
¿dio_Ëd
.
Çme
)

200 
	`Ëd_Œigg”_uÄegi¡”
(&
loÿl
->
¿dio_Ëd
);

201 ià(
loÿl
->
assoc_Ëd
.
Çme
)

202 
	`Ëd_Œigg”_uÄegi¡”
(&
loÿl
->
assoc_Ëd
);

203 ià(
loÿl
->
tx_Ëd
.
Çme
)

204 
	`Ëd_Œigg”_uÄegi¡”
(&
loÿl
->
tx_Ëd
);

205 ià(
loÿl
->
rx_Ëd
.
Çme
)

206 
	`Ëd_Œigg”_uÄegi¡”
(&
loÿl
->
rx_Ëd
);

208 ià(
loÿl
->
t_Ëd_Œigg”
) {

209 
	`Ëd_Œigg”_uÄegi¡”
(&
loÿl
->
t_Ëd
);

210 
	`kä“
(
loÿl
->
t_Ëd_Œigg”
);

212 
	}
}

214 cÚ¡ *
	$__›“80211_g‘_¿dio_Ëd_Çme
(
›“80211_hw
 *
hw
)

216 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

218  
loÿl
->
¿dio_Ëd
.
Çme
;

219 
	}
}

220 
EXPORT_SYMBOL
(
__›“80211_g‘_¿dio_Ëd_Çme
);

222 cÚ¡ *
	$__›“80211_g‘_assoc_Ëd_Çme
(
›“80211_hw
 *
hw
)

224 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

226  
loÿl
->
assoc_Ëd
.
Çme
;

227 
	}
}

228 
EXPORT_SYMBOL
(
__›“80211_g‘_assoc_Ëd_Çme
);

230 cÚ¡ *
	$__›“80211_g‘_tx_Ëd_Çme
(
›“80211_hw
 *
hw
)

232 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

234  
loÿl
->
tx_Ëd
.
Çme
;

235 
	}
}

236 
EXPORT_SYMBOL
(
__›“80211_g‘_tx_Ëd_Çme
);

238 cÚ¡ *
	$__›“80211_g‘_rx_Ëd_Çme
(
›“80211_hw
 *
hw
)

240 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

242  
loÿl
->
rx_Ëd
.
Çme
;

243 
	}
}

244 
EXPORT_SYMBOL
(
__›“80211_g‘_rx_Ëd_Çme
);

246 
	$t_Œig_Œaffic
(
›“80211_loÿl
 *
loÿl
,

247 
t_Ëd_Œigg”
 *
t_Œig
)

249 
Œaffic
, 
d–
;

251 
Œaffic
 = 
t_Œig
->
tx_by‹s
 +±_Œig->
rx_by‹s
;

253 
d–
 = 
Œaffic
 - 
t_Œig
->
´ev_Œaffic
;

254 
t_Œig
->
´ev_Œaffic
 = 
Œaffic
;

255  
	`DIV_ROUND_UP
(
d–
, 1024 / 8);

256 
	}
}

258 
	$t_Œig_tim”
(
tim”_li¡
 *
t
)

260 
t_Ëd_Œigg”
 *
t_Œig
 = 
	`äom_tim”
Ñ±_Œig, 
t
, 
tim”
);

261 
›“80211_loÿl
 *
loÿl
 = 
t_Œig
->local;

262 
Ú
, 
off
, 
t
;

263 
i
;

265 ià(!
t_Œig
->
ruÂšg
)

268 
	`mod_tim”
(&
t_Œig
->
tim”
, 
	`round_jiff›s
(
jiff›s
 + 
HZ
));

270 
t
 = 
	`t_Œig_Œaffic
(
loÿl
, 
t_Œig
);

273 
Ú
 = 1;

274 
off
 = 0;

276 
i
 = 
t_Œig
->
blšk_bË_Ën
 - 1; i >= 0; i--) {

277 ià(
t_Œig
->
blšk_bË
[
i
].
throughput
 < 0 ||

278 
t
 > 
t_Œig
->
blšk_bË
[
i
].
throughput
) {

279 
off
 = 
t_Œig
->
blšk_bË
[
i
].
blšk_time
 / 2;

280 
Ú
 = 
t_Œig
->
blšk_bË
[
i
].
blšk_time
 - 
off
;

285 
	`Ëd_Œigg”_blšk
(&
loÿl
->
t_Ëd
, 
Ú
, 
off
);

286 
	}
}

289 
	$__›“80211_ü—‹_t_Ëd_Œigg”
(
›“80211_hw
 *
hw
,

290 
æags
,

291 cÚ¡ 
›“80211_t_blšk
 *
blšk_bË
,

292 
blšk_bË_Ën
)

294 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

295 
t_Ëd_Œigg”
 *
t_Œig
;

297 ià(
	`WARN_ON
(
loÿl
->
t_Ëd_Œigg”
))

298  
NULL
;

300 
t_Œig
 = 
	`kz®loc
((
t_Ëd_Œigg”
), 
GFP_KERNEL
);

301 ià(!
t_Œig
)

302  
NULL
;

304 
	`¢´štf
(
t_Œig
->
Çme
, (tpt_trig->name),

305 "%¡±", 
	`why_Çme
(
loÿl
->
hw
.
why
));

307 
loÿl
->
t_Ëd
.
Çme
 = 
t_Œig
->name;

309 
t_Œig
->
blšk_bË
 = blink_table;

310 
t_Œig
->
blšk_bË_Ën
 = blink_table_len;

311 
t_Œig
->
wªt
 = 
æags
;

312 
t_Œig
->
loÿl
 =†ocal;

314 
	`tim”_£tup
(&
t_Œig
->
tim”
, 
t_Œig_tim”
, 0);

316 
loÿl
->
t_Ëd_Œigg”
 = 
t_Œig
;

318  
t_Œig
->
Çme
;

319 
	}
}

320 
EXPORT_SYMBOL
(
__›“80211_ü—‹_t_Ëd_Œigg”
);

322 
	$›“80211_¡¬t_t_Ëd_Œig
(
›“80211_loÿl
 *
loÿl
)

324 
t_Ëd_Œigg”
 *
t_Œig
 = 
loÿl
->tpt_led_trigger;

326 ià(
t_Œig
->
ruÂšg
)

330 
	`t_Œig_Œaffic
(
loÿl
, 
t_Œig
);

331 
t_Œig
->
ruÂšg
 = 
Œue
;

333 
	`t_Œig_tim”
(&
t_Œig
->
tim”
);

334 
	`mod_tim”
(&
t_Œig
->
tim”
, 
	`round_jiff›s
(
jiff›s
 + 
HZ
));

335 
	}
}

337 
	$›“80211_¡İ_t_Ëd_Œig
(
›“80211_loÿl
 *
loÿl
)

339 
t_Ëd_Œigg”
 *
t_Œig
 = 
loÿl
->tpt_led_trigger;

341 ià(!
t_Œig
->
ruÂšg
)

344 
t_Œig
->
ruÂšg
 = 
çl£
;

345 
	`d–_tim”_sync
(&
t_Œig
->
tim”
);

347 
	`Ëd_Œigg”_ev’t
(&
loÿl
->
t_Ëd
, 
LED_OFF
);

348 
	}
}

350 
	$›“80211_mod_t_Ëd_Œig
(
›“80211_loÿl
 *
loÿl
,

351 
ty³s_Ú
, 
ty³s_off
)

353 
t_Ëd_Œigg”
 *
t_Œig
 = 
loÿl
->tpt_led_trigger;

354 
boŞ
 
®lowed
;

356 
	`WARN_ON
(
ty³s_Ú
 & 
ty³s_off
);

358 ià(!
t_Œig
)

361 
t_Œig
->
aùive
 &ğ~
ty³s_off
;

362 
t_Œig
->
aùive
 |ğ
ty³s_Ú
;

370 
®lowed
 = 
t_Œig
->
aùive
 & 
IEEE80211_TPT_LEDTRIG_FL_RADIO
;

372 ià(!
®lowed
 || !(
t_Œig
->
aùive
 &±_Œig->
wªt
))

373 
	`›“80211_¡İ_t_Ëd_Œig
(
loÿl
);

375 
	`›“80211_¡¬t_t_Ëd_Œig
(
loÿl
);

376 
	}
}

	@led.h

6 
	~<lšux/li¡.h
>

7 
	~<lšux/¥šlock.h
>

8 
	~<lšux/Ëds.h
>

9 
	~"›“80211_i.h
"

11 
	#MAC80211_BLINK_DELAY
 50

	)

13 
šlše
 
	$›“80211_Ëd_rx
(
›“80211_loÿl
 *
loÿl
)

15 #ifdeà
CONFIG_MAC80211_LEDS


16 ià(!
	`©omic_»ad
(&
loÿl
->
rx_Ëd_aùive
))

18 
	`Ëd_Œigg”_blšk_ÚeshÙ
(&
loÿl
->
rx_Ëd
, 
MAC80211_BLINK_DELAY
, MAC80211_BLINK_DELAY, 0);

20 
	}
}

22 
šlše
 
	$›“80211_Ëd_tx
(
›“80211_loÿl
 *
loÿl
)

24 #ifdeà
CONFIG_MAC80211_LEDS


25 ià(!
	`©omic_»ad
(&
loÿl
->
tx_Ëd_aùive
))

27 
	`Ëd_Œigg”_blšk_ÚeshÙ
(&
loÿl
->
tx_Ëd
, 
MAC80211_BLINK_DELAY
, MAC80211_BLINK_DELAY, 0);

29 
	}
}

31 #ifdeà
CONFIG_MAC80211_LEDS


32 
›“80211_Ëd_assoc
(
›“80211_loÿl
 *
loÿl
,

33 
boŞ
 
assocŸ‹d
);

34 
›“80211_Ëd_¿dio
(
›“80211_loÿl
 *
loÿl
,

35 
boŞ
 
’abËd
);

36 
›“80211_®loc_Ëd_Çmes
(
›“80211_loÿl
 *
loÿl
);

37 
›“80211_ä“_Ëd_Çmes
(
›“80211_loÿl
 *
loÿl
);

38 
›“80211_Ëd_š™
(
›“80211_loÿl
 *
loÿl
);

39 
›“80211_Ëd_ex™
(
›“80211_loÿl
 *
loÿl
);

40 
›“80211_mod_t_Ëd_Œig
(
›“80211_loÿl
 *
loÿl
,

41 
ty³s_Ú
, 
ty³s_off
);

43 
šlše
 
	$›“80211_Ëd_assoc
(
›“80211_loÿl
 *
loÿl
,

44 
boŞ
 
assocŸ‹d
)

46 
	}
}

47 
šlše
 
	$›“80211_Ëd_¿dio
(
›“80211_loÿl
 *
loÿl
,

48 
boŞ
 
’abËd
)

50 
	}
}

51 
šlše
 
	$›“80211_®loc_Ëd_Çmes
(
›“80211_loÿl
 *
loÿl
)

53 
	}
}

54 
šlše
 
	$›“80211_ä“_Ëd_Çmes
(
›“80211_loÿl
 *
loÿl
)

56 
	}
}

57 
šlše
 
	$›“80211_Ëd_š™
(
›“80211_loÿl
 *
loÿl
)

59 
	}
}

60 
šlše
 
	$›“80211_Ëd_ex™
(
›“80211_loÿl
 *
loÿl
)

62 
	}
}

63 
šlše
 
	$›“80211_mod_t_Ëd_Œig
(
›“80211_loÿl
 *
loÿl
,

64 
ty³s_Ú
,

65 
ty³s_off
)

67 
	}
}

70 
šlše
 

71 
	$›“80211_t_Ëd_Œig_tx
(
›“80211_loÿl
 *
loÿl
, 
by‹s
)

73 #ifdeà
CONFIG_MAC80211_LEDS


74 ià(
	`©omic_»ad
(&
loÿl
->
t_Ëd_aùive
))

75 
loÿl
->
t_Ëd_Œigg”
->
tx_by‹s
 +ğ
by‹s
;

77 
	}
}

79 
šlše
 

80 
	$›“80211_t_Ëd_Œig_rx
(
›“80211_loÿl
 *
loÿl
, 
by‹s
)

82 #ifdeà
CONFIG_MAC80211_LEDS


83 ià(
	`©omic_»ad
(&
loÿl
->
t_Ëd_aùive
))

84 
loÿl
->
t_Ëd_Œigg”
->
rx_by‹s
 +ğ
by‹s
;

86 
	}
}

	@link.c

7 
	~<lšux/¦ab.h
>

8 
	~<lšux/k”Ãl.h
>

9 
	~<Ãt/mac80211.h
>

10 
	~"›“80211_i.h
"

11 
	~"driv”-İs.h
"

12 
	~"key.h
"

13 
	~"debugfs_Ãtdev.h
"

15 
	$›“80211_lšk_£tup
(
›“80211_lšk_d©a
 *
lšk
)

17 ià(
lšk
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

18 
	`›“80211_mgd_£tup_lšk
(
lšk
);

19 
	}
}

21 
	$›“80211_lšk_š™
(
›“80211_sub_if_d©a
 *
sd©a
,

22 
lšk_id
,

23 
›“80211_lšk_d©a
 *
lšk
,

24 
›“80211_bss_cÚf
 *
lšk_cÚf
)

26 
boŞ
 
deæšk
 = 
lšk_id
 < 0;

28 ià(
lšk_id
 < 0)

29 
lšk_id
 = 0;

31 
	`rcu_assign_poš‹r
(
sd©a
->
vif
.
lšk_cÚf
[
lšk_id
],†ink_conf);

32 
	`rcu_assign_poš‹r
(
sd©a
->
lšk
[
lšk_id
],†ink);

34 
lšk
->
sd©a
 = sdata;

35 
lšk
->
lšk_id
 =†ink_id;

36 
lšk
->
cÚf
 = 
lšk_cÚf
;

37 
lšk_cÚf
->
lšk_id
 =†ink_id;

38 
lšk_cÚf
->
vif
 = &
sd©a
->vif;

40 
	`why_wÜk_š™
(&
lšk
->
c§_fš®ize_wÜk
,

41 
›“80211_c§_fš®ize_wÜk
);

42 
	`why_wÜk_š™
(&
lšk
->
cŞÜ_chªge_fš®ize_wÜk
,

43 
›“80211_cŞÜ_chªge_fš®ize_wÜk
);

44 
	`INIT_DELAYED_WORK
(&
lšk
->
cŞÜ_cŞlisiÚ_d‘eù_wÜk
,

45 
›“80211_cŞÜ_cŞlisiÚ_d‘eùiÚ_wÜk
);

46 
	`INIT_LIST_HEAD
(&
lšk
->
assigÃd_chªùx_li¡
);

47 
	`INIT_LIST_HEAD
(&
lšk
->
»£rved_chªùx_li¡
);

48 
	`why_d–ayed_wÜk_š™
(&
lšk
->
dfs_ÿc_tim”_wÜk
,

49 
›“80211_dfs_ÿc_tim”_wÜk
);

51 ià(!
deæšk
) {

52 
sd©a
->
vif
.
ty³
) {

53 
NL80211_IFTYPE_AP
:

54 
	`‘h”_addr_cİy
(
lšk_cÚf
->
addr
,

55 
sd©a
->
wdev
.
lšks
[
lšk_id
].
addr
);

56 
lšk_cÚf
->
bssid
 =†šk_cÚf->
addr
;

57 
	`WARN_ON
(!(
sd©a
->
wdev
.
v®id_lšks
 & 
	`BIT
(
lšk_id
)));

59 
NL80211_IFTYPE_STATION
:

63 
	`WARN_ON
(1);

66 
	`›“80211_lšk_debugfs_add
(
lšk
);

68 
	}
}

70 
	$›“80211_lšk_¡İ
(
›“80211_lšk_d©a
 *
lšk
)

72 ià(
lšk
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

73 
	`›“80211_mgd_¡İ_lšk
(
lšk
);

75 
	`ÿnûl_d–ayed_wÜk_sync
(&
lšk
->
cŞÜ_cŞlisiÚ_d‘eù_wÜk
);

76 
	`why_wÜk_ÿnûl
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
,

77 &
lšk
->
c§_fš®ize_wÜk
);

78 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

79 
	}
}

81 
	slšk_cÚš”
 {

82 
›“80211_lšk_d©a
 
	md©a
;

83 
›“80211_bss_cÚf
 
	mcÚf
;

86 
	$›“80211_‹¬_down_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

87 
lšk_cÚš”
 **
lšks
, 
u16
 
mask
)

89 
›“80211_lšk_d©a
 *
lšk
;

90 
	`LIST_HEAD
(
keys
);

91 
lšk_id
;

93 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

94 ià(!(
mask
 & 
	`BIT
(
lšk_id
)))

96 
lšk
 = &
lšks
[
lšk_id
]->
d©a
;

97 ià(
lšk_id
 =ğ0 && !
lšk
)

98 
lšk
 = &
sd©a
->
deæšk
;

99 ià(
	`WARN_ON
(!
lšk
))

101 
	`›“80211_»move_lšk_keys
(
lšk
, &
keys
);

102 
	`›“80211_lšk_debugfs_»move
(
lšk
);

103 
	`›“80211_lšk_¡İ
(
lšk
);

106 
	`synchrÚize_rcu
();

108 
	`›“80211_ä“_key_li¡
(
sd©a
->
loÿl
, &
keys
);

109 
	}
}

111 
	$›“80211_ä“_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

112 
lšk_cÚš”
 **
lšks
)

114 
lšk_id
;

116 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++)

117 
	`kä“
(
lšks
[
lšk_id
]);

118 
	}
}

120 
	$›“80211_check_dup_lšk_addrs
(
›“80211_sub_if_d©a
 *
sd©a
)

122 
i
, 
j
;

124 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++) {

125 
›“80211_lšk_d©a
 *
lšk1
;

127 
lšk1
 = 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
i
], sdata);

128 ià(!
lšk1
)

130 
j
 = 
i
 + 1; j < 
IEEE80211_MLD_MAX_NUM_LINKS
; j++) {

131 
›“80211_lšk_d©a
 *
lšk2
;

133 
lšk2
 = 
	`sd©a_d”eã»nû
(
sd©a
->
lšk
[
j
], sdata);

134 ià(!
lšk2
)

137 ià(
	`‘h”_addr_equ®
(
lšk1
->
cÚf
->
addr
,

138 
lšk2
->
cÚf
->
addr
))

139  -
EALREADY
;

144 
	}
}

146 
	$›“80211_£t_vif_lšks_b™m­s
(
›“80211_sub_if_d©a
 *
sd©a
,

147 
u16
 
v®id_lšks
, u16 
dÜmªt_lšks
)

149 
sd©a
->
vif
.
v®id_lšks
 = valid_links;

150 
sd©a
->
vif
.
dÜmªt_lšks
 = dormant_links;

152 ià(!
v®id_lšks
 ||

153 
	`WARN
((~
v®id_lšks
 & 
dÜmªt_lšks
) ||

154 !(
v®id_lšks
 & ~
dÜmªt_lšks
),

156 
v®id_lšks
, 
dÜmªt_lšks
)) {

157 
sd©a
->
vif
.
aùive_lšks
 = 0;

158 
sd©a
->
vif
.
dÜmªt_lšks
 = 0;

162 
sd©a
->
vif
.
ty³
) {

163 
NL80211_IFTYPE_AP
:

165 
sd©a
->
vif
.
aùive_lšks
 = 
v®id_lšks
;

168 
	`WARN_ON
(
dÜmªt_lšks
);

170 
NL80211_IFTYPE_STATION
:

171 ià(
sd©a
->
vif
.
aùive_lšks
)

173 
sd©a
->
vif
.
aùive_lšks
 = 
v®id_lšks
 & ~
dÜmªt_lšks
;

174 
	`WARN_ON
(
	`hweight16
(
sd©a
->
vif
.
aùive_lšks
) > 1);

177 
	`WARN_ON
(1);

179 
	}
}

181 
	$›“80211_vif_upd©e_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

182 
lšk_cÚš”
 **
to_ä“
,

183 
u16
 
Ãw_lšks
, u16 
dÜmªt_lšks
)

185 
u16
 
Şd_lšks
 = 
sd©a
->
vif
.
v®id_lšks
;

186 
u16
 
Şd_aùive
 = 
sd©a
->
vif
.
aùive_lšks
;

187 
add
 = 
Ãw_lšks
 & ~
Şd_lšks
;

188 
»m
 = 
Şd_lšks
 & ~
Ãw_lšks
;

189 
lšk_id
;

190 
»t
;

191 
lšk_cÚš”
 *
lšks
[
IEEE80211_MLD_MAX_NUM_LINKS
] = {}, *
lšk
;

192 
›“80211_bss_cÚf
 *
Şd
[
IEEE80211_MLD_MAX_NUM_LINKS
];

193 
›“80211_lšk_d©a
 *
Şd_d©a
[
IEEE80211_MLD_MAX_NUM_LINKS
];

194 
boŞ
 
u£_deæšk
 = 
Şd_lšks
 == 0;

196 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

198 
	`mem£t
(
to_ä“
, 0, (
lšks
));

200 ià(
Şd_lšks
 =ğ
Ãw_lšks
 && 
dÜmªt_lšks
 =ğ
sd©a
->
vif
.dormant_links)

204 ià(!
Şd_lšks
)

205 
»m
 |ğ
	`BIT
(0);

208 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
add
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

209 
lšk
 = 
	`kz®loc
((*lšk), 
GFP_KERNEL
);

210 ià(!
lšk
) {

211 
»t
 = -
ENOMEM
;

212 
ä“
;

214 
lšks
[
lšk_id
] = 
lšk
;

218 
	`BUILD_BUG_ON
((
Şd
è!ğ(
sd©a
->
vif
.
lšk_cÚf
));

219 
	`memıy
(
Şd
, 
sd©a
->
vif
.
lšk_cÚf
, (old));

221 
	`BUILD_BUG_ON
((
Şd_d©a
è!ğ(
sd©a
->
lšk
));

222 
	`memıy
(
Şd_d©a
, 
sd©a
->
lšk
, (old_data));

225 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
»m
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

226 ià(
	`rcu_acûss_poš‹r
(
sd©a
->
lšk
[
lšk_id
]è!ğ&sd©a->
deæšk
) {

231 
to_ä“
[
lšk_id
] = 
	`cÚš”_of
(
	`rcu_acûss_poš‹r
(
sd©a
->
lšk
[link_id]),

232 
	`ty³of
(*
lšks
[
lšk_id
]),

233 
d©a
);

236 
	`RCU_INIT_POINTER
(
sd©a
->
lšk
[
lšk_id
], 
NULL
);

237 
	`RCU_INIT_POINTER
(
sd©a
->
vif
.
lšk_cÚf
[
lšk_id
], 
NULL
);

240 ià(!
Şd_lšks
)

241 
	`›“80211_debugfs_»ü—‹_Ãtdev
(
sd©a
, 
Œue
);

244 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
add
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

245 
	`WARN_ON
(!
u£_deæšk
 &&

246 
	`rcu_acûss_poš‹r
(
sd©a
->
lšk
[
lšk_id
]è=ğ&sd©a->
deæšk
);

248 
lšk
 = 
lšks
[
lšk_id
];

249 
	`›“80211_lšk_š™
(
sd©a
, 
lšk_id
, &
lšk
->
d©a
, &lšk->
cÚf
);

250 
	`›“80211_lšk_£tup
(&
lšk
->
d©a
);

253 ià(
Ãw_lšks
 == 0)

254 
	`›“80211_lšk_š™
(
sd©a
, -1, &sd©a->
deæšk
,

255 &
sd©a
->
vif
.
bss_cÚf
);

257 
»t
 = 
	`›“80211_check_dup_lšk_addrs
(
sd©a
);

258 ià(!
»t
) {

260 
	`›“80211_‹¬_down_lšks
(
sd©a
, 
to_ä“
, 
»m
);

262 
	`›“80211_£t_vif_lšks_b™m­s
(
sd©a
, 
Ãw_lšks
, 
dÜmªt_lšks
);

265 
»t
 = 
	`drv_chªge_vif_lšks
(
sd©a
->
loÿl
, sdata,

266 
Şd_lšks
 & 
Şd_aùive
,

267 
Ãw_lšks
 & 
sd©a
->
vif
.
aùive_lšks
,

268 
Şd
);

269 ià(!
Ãw_lšks
)

270 
	`›“80211_debugfs_»ü—‹_Ãtdev
(
sd©a
, 
çl£
);

273 ià(
»t
) {

275 
	`memıy
(
sd©a
->
lšk
, 
Şd_d©a
, (old_data));

276 
	`memıy
(
sd©a
->
vif
.
lšk_cÚf
, 
Şd
, (old));

277 
	`›“80211_£t_vif_lšks_b™m­s
(
sd©a
, 
Şd_lšks
, 
dÜmªt_lšks
);

279 
	`mem£t
(
to_ä“
, 0, (
lšks
));

280 
ä“
;

284 
u£_deæšk
 = 
Ãw_lšks
 == 0;

286 
deš™
;

287 
ä“
:

289 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

290 
	`kä“
(
lšks
[
lšk_id
]);

291 
lšks
[
lšk_id
] = 
NULL
;

293 
deš™
:

294 ià(
u£_deæšk
)

295 
	`›“80211_lšk_š™
(
sd©a
, -1, &sd©a->
deæšk
,

296 &
sd©a
->
vif
.
bss_cÚf
);

297  
»t
;

298 
	}
}

300 
	$›“80211_vif_£t_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

301 
u16
 
Ãw_lšks
, u16 
dÜmªt_lšks
)

303 
lšk_cÚš”
 *
lšks
[
IEEE80211_MLD_MAX_NUM_LINKS
];

304 
»t
;

306 
»t
 = 
	`›“80211_vif_upd©e_lšks
(
sd©a
, 
lšks
, 
Ãw_lšks
,

307 
dÜmªt_lšks
);

308 
	`›“80211_ä“_lšks
(
sd©a
, 
lšks
);

310  
»t
;

311 
	}
}

313 
	$_›“80211_£t_aùive_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

314 
u16
 
aùive_lšks
)

316 
›“80211_bss_cÚf
 *
lšk_cÚfs
[
IEEE80211_MLD_MAX_NUM_LINKS
];

317 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

318 
u16
 
Şd_aùive
 = 
sd©a
->
vif
.
aùive_lšks
;

319 
»m
 = 
Şd_aùive
 & ~
aùive_lšks
;

320 
add
 = 
aùive_lšks
 & ~
Şd_aùive
;

321 
¡a_šfo
 *
¡a
;

322 
lšk_id
;

323 
»t
, 
i
;

325 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

326  -
ENETDOWN
;

328 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

329  -
EINVAL
;

331 ià(
aùive_lšks
 & ~
	`›“80211_vif_u§bË_lšks
(&
sd©a
->
vif
))

332  -
EINVAL
;

335 ià(
Şd_aùive
 =ğ
aùive_lšks
)

338 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++)

339 
lšk_cÚfs
[
i
] = 
	`sd©a_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[i],

340 
sd©a
);

342 ià(
add
) {

343 
sd©a
->
vif
.
aùive_lšks
 |=‡ctive_links;

344 
»t
 = 
	`drv_chªge_vif_lšks
(
loÿl
, 
sd©a
,

345 
Şd_aùive
,

346 
sd©a
->
vif
.
aùive_lšks
,

347 
lšk_cÚfs
);

348 ià(
»t
) {

349 
sd©a
->
vif
.
aùive_lšks
 = 
Şd_aùive
;

350  
»t
;

354 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
»m
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

355 
›“80211_lšk_d©a
 *
lšk
;

357 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

359 
	`›“80211_‹¬down_tdls_³”s
(
lšk
);

361 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

364 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

365 ià(
sd©a
 !ğ
¡a
->sdata)

369 
	`__›“80211_¡a_»ÿlc_agg»g©es
(
¡a
,

370 
Şd_aùive
 | 
aùive_lšks
);

372 
»t
 = 
	`drv_chªge_¡a_lšks
(
loÿl
, 
sd©a
, &
¡a
->sta,

373 
Şd_aùive
,

374 
Şd_aùive
 | 
aùive_lšks
);

375 
	`WARN_ON_ONCE
(
»t
);

378 
»t
 = 
	`›“80211_key_sw™ch_lšks
(
sd©a
, 
»m
, 
add
);

379 
	`WARN_ON_ONCE
(
»t
);

381 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

382 ià(
sd©a
 !ğ
¡a
->sdata)

385 
	`__›“80211_¡a_»ÿlc_agg»g©es
(
¡a
, 
aùive_lšks
);

387 
»t
 = 
	`drv_chªge_¡a_lšks
(
loÿl
, 
sd©a
, &
¡a
->sta,

388 
Şd_aùive
 | 
aùive_lšks
,

389 
aùive_lšks
);

390 
	`WARN_ON_ONCE
(
»t
);

399 
	`__›“80211_¡a_»ÿlc_agg»g©es
(
¡a
, 
aùive_lšks
);

402 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
add
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

403 
›“80211_lšk_d©a
 *
lšk
;

405 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

407 
»t
 = 
	`›“80211_lšk_u£_chªÃl
(
lšk
,

408 &
lšk
->
cÚf
->
chª»q
,

409 
IEEE80211_CHANCTX_SHARED
);

410 
	`WARN_ON_ONCE
(
»t
);

412 
	`›“80211_mgd_£t_lšk_qos_·¿ms
(
lšk
);

413 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

414 
BSS_CHANGED_ERP_CTS_PROT
 |

415 
BSS_CHANGED_ERP_PREAMBLE
 |

416 
BSS_CHANGED_ERP_SLOT
 |

417 
BSS_CHANGED_HT
 |

418 
BSS_CHANGED_BASIC_RATES
 |

419 
BSS_CHANGED_BSSID
 |

420 
BSS_CHANGED_CQM
 |

421 
BSS_CHANGED_QOS
 |

422 
BSS_CHANGED_TXPOWER
 |

423 
BSS_CHANGED_BANDWIDTH
 |

424 
BSS_CHANGED_TWT
 |

425 
BSS_CHANGED_HE_OBSS_PD
 |

426 
BSS_CHANGED_HE_BSS_COLOR
);

429 
Şd_aùive
 = 
sd©a
->
vif
.
aùive_lšks
;

430 
sd©a
->
vif
.
aùive_lšks
 =‡ctive_links;

432 ià(
»m
) {

433 
»t
 = 
	`drv_chªge_vif_lšks
(
loÿl
, 
sd©a
, 
Şd_aùive
,

434 
aùive_lšks
, 
lšk_cÚfs
);

435 
	`WARN_ON_ONCE
(
»t
);

439 
	}
}

441 
	$›“80211_£t_aùive_lšks
(
›“80211_vif
 *
vif
, 
u16
 
aùive_lšks
)

443 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

444 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

445 
u16
 
Şd_aùive
;

446 
»t
;

448 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

450 ià(
	`WARN_ON
(!
aùive_lšks
))

451  -
EINVAL
;

453 ià(!
	`drv_ÿn_aùiv©e_lšks
(
loÿl
, 
sd©a
, 
aùive_lšks
))

454  -
EINVAL
;

456 
Şd_aùive
 = 
sd©a
->
vif
.
aùive_lšks
;

457 ià(
Şd_aùive
 & 
aùive_lšks
) {

463 
»t
 = 
	`_›“80211_£t_aùive_lšks
(
sd©a
,

464 
Şd_aùive
 & 
aùive_lšks
);

465 ià(!
»t
)

466 
»t
 = 
	`_›“80211_£t_aùive_lšks
(
sd©a
, 
aùive_lšks
);

469 
»t
 = 
	`_›“80211_£t_aùive_lšks
(
sd©a
, 
aùive_lšks
);

472  
»t
;

473 
	}
}

474 
EXPORT_SYMBOL_GPL
(
›“80211_£t_aùive_lšks
);

476 
	$›“80211_£t_aùive_lšks_async
(
›“80211_vif
 *
vif
,

477 
u16
 
aùive_lšks
)

479 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

481 ià(
	`WARN_ON
(!
aùive_lšks
))

484 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

487 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

490 ià(
aùive_lšks
 & ~
	`›“80211_vif_u§bË_lšks
(&
sd©a
->
vif
))

494 ià(
sd©a
->
vif
.
aùive_lšks
 ==‡ctive_links)

497 
sd©a
->
desœed_aùive_lšks
 = 
aùive_lšks
;

498 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
aùiv©e_lšks_wÜk
);

499 
	}
}

500 
EXPORT_SYMBOL_GPL
(
›“80211_£t_aùive_lšks_async
);

	@mac80211.mod.c

1 
	~<lšux/moduË.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<lšux/bud-§É.h
>

4 
	~<lšux/–âÙe-Éo.h
>

5 
	~<lšux/expÜt-š‹º®.h
>

6 
	~<lšux/v”magic.h
>

7 
	~<lšux/comp”.h
>

9 #ifdeà
CONFIG_UNWINDER_ORC


10 
	~<asm/Üc_h—d”.h
>

11 
	gORC_HEADER
;

14 
	gBUILD_SALT
;

15 
	gBUILD_LTO_INFO
;

17 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

18 
MODULE_INFO
(
Çme
, 
KBUILD_MODNAME
);

20 
__visibË
 
moduË
 
__this_moduË


21 
__£ùiÚ
(".gnu.linkonce.this_module") = {

22 .
Çme
 = 
KBUILD_MODNAME
,

23 .
	gš™
 = 
š™_moduË
,

24 #ifdeà
CONFIG_MODULE_UNLOAD


25 .
	gex™
 = 
ş—nup_moduË
,

27 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

30 
MODULE_INFO
(
šŒ“
, "Y");

32 #ifdeà
CONFIG_MITIGATION_RETPOLINE


33 
MODULE_INFO
(
»Şše
, "Y");

36 
KSYMTAB_FUNC
(
›“80211_emuÏ‹_add_chªùx
, "", "");

37 
KSYMTAB_FUNC
(
›“80211_emuÏ‹_»move_chªùx
, "", "");

38 
KSYMTAB_FUNC
(
›“80211_emuÏ‹_chªge_chªùx
, "", "");

39 
KSYMTAB_FUNC
(
›“80211_emuÏ‹_sw™ch_vif_chªùx
, "", "");

40 
KSYMTAB_FUNC
(
›“80211_»¡¬t_hw
, "", "");

41 
KSYMTAB_FUNC
(
›“80211_®loc_hw_nm
, "", "");

42 
KSYMTAB_FUNC
(
›“80211_»gi¡”_hw
, "", "");

43 
KSYMTAB_FUNC
(
›“80211_uÄegi¡”_hw
, "", "");

44 
KSYMTAB_FUNC
(
›“80211_ä“_hw
, "", "");

45 
KSYMTAB_FUNC
(
›“80211_tx_¡©us_œq§ã
, "", "");

46 
KSYMTAB_FUNC
(
›“80211_tx_¡©us_skb
, "", "");

47 
KSYMTAB_FUNC
(
›“80211_tx_¡©us_ext
, "", "");

48 
KSYMTAB_FUNC
(
›“80211_tx_¿‹_upd©e
, "", "");

49 
KSYMTAB_FUNC
(
›“80211_»pÜt_low_ack
, "", "");

50 
KSYMTAB_FUNC
(
›“80211_ä“_txskb
, "", "");

51 
KSYMTAB_FUNC
(
›“80211_fšd_¡a_by_lšk_addrs
, "_gpl", "");

52 
KSYMTAB_FUNC
(
›“80211_fšd_¡a_by_içddr
, "_gpl", "");

53 
KSYMTAB_FUNC
(
›“80211_fšd_¡a
, "", "");

54 
KSYMTAB_FUNC
(
›“80211_¡a_block_awake
, "", "");

55 
KSYMTAB_FUNC
(
›“80211_¡a_eo¥
, "", "");

56 
KSYMTAB_FUNC
(
›“80211_£nd_eo¥_nuÎfunc
, "", "");

57 
KSYMTAB_FUNC
(
›“80211_¡a_£t_bufã»d
, "", "");

58 
KSYMTAB_FUNC
(
›“80211_¡a_»gi¡”_aœtime
, "", "");

59 
KSYMTAB_FUNC
(
›“80211_¡a_»ÿlc_agg»g©es
, "", "");

60 
KSYMTAB_FUNC
(
›“80211_sÿn_com¶‘ed
, "", "");

61 
KSYMTAB_FUNC
(
›“80211_sched_sÿn_»suÉs
, "", "");

62 
KSYMTAB_FUNC
(
›“80211_sched_sÿn_¡İ³d
, "", "");

63 
KSYMTAB_FUNC
(
›“80211_»ady_Ú_chªÃl
, "_gpl", "");

64 
KSYMTAB_FUNC
(
›“80211_»maš_Ú_chªÃl_expœed
, "_gpl", "");

65 
KSYMTAB_FUNC
(
›“80211_»que¡_smps
, "_gpl", "");

66 
KSYMTAB_FUNC
(
›“80211_£nd_b¬
, "", "");

67 
KSYMTAB_FUNC
(
›“80211_»äesh_tx_agg_£ssiÚ_tim”
, "", "");

68 
KSYMTAB_FUNC
(
›“80211_¡¬t_tx_ba_£ssiÚ
, "", "");

69 
KSYMTAB_FUNC
(
›“80211_¡¬t_tx_ba_cb_œq§ã
, "", "");

70 
KSYMTAB_FUNC
(
›“80211_¡İ_tx_ba_£ssiÚ
, "", "");

71 
KSYMTAB_FUNC
(
›“80211_¡İ_tx_ba_cb_œq§ã
, "", "");

72 
KSYMTAB_FUNC
(
›“80211_¡İ_rx_ba_£ssiÚ
, "", "");

73 
KSYMTAB_FUNC
(
›“80211_mªage_rx_ba_ofæ
, "", "");

74 
KSYMTAB_FUNC
(
›“80211_rx_ba_tim”_expœed
, "", "");

75 
KSYMTAB_FUNC
(
›“80211_upd©e_mu_groups
, "_gpl", "");

76 
KSYMTAB_FUNC
(
›“80211_£t_aùive_lšks
, "_gpl", "");

77 
KSYMTAB_FUNC
(
›“80211_£t_aùive_lšks_async
, "_gpl", "");

78 
KSYMTAB_FUNC
(
›“80211_¿‹_cÚŒŞ_»gi¡”
, "", "");

79 
KSYMTAB_FUNC
(
›“80211_¿‹_cÚŒŞ_uÄegi¡”
, "", "");

80 
KSYMTAB_FUNC
(
›“80211_g‘_tx_¿‹s
, "", "");

81 
KSYMTAB_FUNC
(
¿‹_cÚŒŞ_£t_¿‹s
, "", "");

82 
KSYMTAB_FUNC
(
›“80211_tk_add_iv
, "_gpl", "");

83 
KSYMTAB_FUNC
(
›“80211_g‘_tk_p1k_iv
, "", "");

84 
KSYMTAB_FUNC
(
›“80211_g‘_tk_rx_p1k
, "", "");

85 
KSYMTAB_FUNC
(
›“80211_g‘_tk_p2k
, "", "");

86 
KSYMTAB_FUNC
(
›“80211_c§_fšish
, "", "");

87 
KSYMTAB_FUNC
(
›“80211_chªÃl_sw™ch_discÚÃù
, "", "");

88 
KSYMTAB_FUNC
(
›“80211_Çn_func_‹rmš©ed
, "", "");

89 
KSYMTAB_FUNC
(
›“80211_Çn_func_m©ch
, "", "");

90 
KSYMTAB_FUNC
(
›“80211_cŞÜ_chªge_fšish
, "_gpl", "");

91 
KSYMTAB_FUNC
(
›“80211_obss_cŞÜ_cŞlisiÚ_nÙify
, "_gpl", "");

92 
KSYMTAB_FUNC
(
›“80211_¡a_ps_Œªs™iÚ
, "", "");

93 
KSYMTAB_FUNC
(
›“80211_¡a_p¥Şl
, "", "");

94 
KSYMTAB_FUNC
(
›“80211_¡a_u­sd_Œigg”
, "", "");

95 
KSYMTAB_FUNC
(
›“80211_m¬k_rx_ba_f‹»d_äames
, "", "");

96 
KSYMTAB_FUNC
(
›“80211_rx_li¡
, "", "");

97 
KSYMTAB_FUNC
(
›“80211_rx_Çpi
, "", "");

98 
KSYMTAB_FUNC
(
›“80211_rx_œq§ã
, "", "");

99 
KSYMTAB_FUNC
(
›“80211_tx_´•¬e_skb
, "", "");

100 
KSYMTAB_FUNC
(
›“80211_tx_dequeue
, "", "");

101 
KSYMTAB_FUNC
(
›“80211_Ãxt_txq
, "", "");

102 
KSYMTAB_FUNC
(
__›“80211_scheduË_txq
, "", "");

103 
KSYMTAB_FUNC
(
›“80211_txq_aœtime_check
, "", "");

104 
KSYMTAB_FUNC
(
›“80211_txq_may_Œªsm™
, "", "");

105 
KSYMTAB_FUNC
(
›“80211_txq_scheduË_¡¬t
, "", "");

106 
KSYMTAB_FUNC
(
›“80211_b—cÚ_upd©e_útdwn
, "", "");

107 
KSYMTAB_FUNC
(
›“80211_b—cÚ_£t_útdwn
, "", "");

108 
KSYMTAB_FUNC
(
›“80211_b—cÚ_útdwn_is_com¶‘e
, "", "");

109 
KSYMTAB_FUNC
(
›“80211_b—cÚ_g‘_‹m¶©e
, "", "");

110 
KSYMTAB_FUNC
(
›“80211_b—cÚ_g‘_‹m¶©e_ema_šdex
, "", "");

111 
KSYMTAB_FUNC
(
›“80211_b—cÚ_ä“_ema_li¡
, "", "");

112 
KSYMTAB_FUNC
(
›“80211_b—cÚ_g‘_‹m¶©e_ema_li¡
, "", "");

113 
KSYMTAB_FUNC
(
›“80211_b—cÚ_g‘_tim
, "", "");

114 
KSYMTAB_FUNC
(
›“80211_´ob”e¥_g‘
, "", "");

115 
KSYMTAB_FUNC
(
›“80211_g‘_fs_discov”y_tm¶
, "", "");

116 
KSYMTAB_FUNC
(
›“80211_g‘_unsŞ_bÿ¡_´obe_»¥_tm¶
, "", "");

117 
KSYMTAB_FUNC
(
›“80211_p¥Şl_g‘
, "", "");

118 
KSYMTAB_FUNC
(
›“80211_nuÎfunc_g‘
, "", "");

119 
KSYMTAB_FUNC
(
›“80211_´ob”eq_g‘
, "", "");

120 
KSYMTAB_FUNC
(
›“80211_¹s_g‘
, "", "");

121 
KSYMTAB_FUNC
(
›“80211_ù¡o£lf_g‘
, "", "");

122 
KSYMTAB_FUNC
(
›“80211_g‘_bufã»d_bc
, "", "");

123 
KSYMTAB_FUNC
(
›“80211_»£rve_tid
, "", "");

124 
KSYMTAB_FUNC
(
›“80211_uÄe£rve_tid
, "", "");

125 
KSYMTAB_FUNC
(
›“80211_™”_keys
, "", "");

126 
KSYMTAB_FUNC
(
›“80211_™”_keys_rcu
, "", "");

127 
KSYMTAB_FUNC
(
›“80211_gtk_»key_nÙify
, "_gpl", "");

128 
KSYMTAB_FUNC
(
›“80211_g‘_key_rx_£q
, "", "");

129 
KSYMTAB_FUNC
(
›“80211_£t_key_rx_£q
, "_gpl", "");

130 
KSYMTAB_FUNC
(
›“80211_»move_key
, "_gpl", "");

131 
KSYMTAB_FUNC
(
›“80211_gtk_»key_add
, "_gpl", "");

132 
KSYMTAB_FUNC
(
›“80211_key_mic_çu»
, "_gpl", "");

133 
KSYMTAB_FUNC
(
›“80211_key_»¶ay
, "_gpl", "");

134 
KSYMTAB_FUNC
(
why_to_›“80211_hw
, "", "");

135 
KSYMTAB_FUNC
(
›“80211_g‘_bssid
, "", "");

136 
KSYMTAB_FUNC
(
›“80211_g’”ic_äame_du¿tiÚ
, "", "");

137 
KSYMTAB_FUNC
(
›“80211_¹s_du¿tiÚ
, "", "");

138 
KSYMTAB_FUNC
(
›“80211_ù¡o£lf_du¿tiÚ
, "", "");

139 
KSYMTAB_FUNC
(
›“80211_hªdË_wake_tx_queue
, "", "");

140 
KSYMTAB_FUNC
(
›“80211_wake_queue
, "", "");

141 
KSYMTAB_FUNC
(
›“80211_¡İ_queue
, "", "");

142 
KSYMTAB_FUNC
(
›“80211_¡İ_queues
, "", "");

143 
KSYMTAB_FUNC
(
›“80211_queue_¡İ³d
, "", "");

144 
KSYMTAB_FUNC
(
›“80211_wake_queues
, "", "");

145 
KSYMTAB_FUNC
(
›“80211_™”©e_š‹rçûs
, "_gpl", "");

146 
KSYMTAB_FUNC
(
›“80211_™”©e_aùive_š‹rçûs_©omic
, "_gpl", "");

147 
KSYMTAB_FUNC
(
›“80211_™”©e_aùive_š‹rçûs_mtx
, "_gpl", "");

148 
KSYMTAB_FUNC
(
›“80211_™”©e_¡©iÚs_©omic
, "_gpl", "");

149 
KSYMTAB_FUNC
(
wdev_to_›“80211_vif
, "_gpl", "");

150 
KSYMTAB_FUNC
(
›“80211_vif_to_wdev
, "_gpl", "");

151 
KSYMTAB_FUNC
(
›“80211_queue_wÜk
, "", "");

152 
KSYMTAB_FUNC
(
›“80211_queue_d–ayed_wÜk
, "", "");

153 
KSYMTAB_FUNC
(
›“80211_hw_»¡¬t_discÚÃù
, "_gpl", "");

154 
KSYMTAB_FUNC
(
›“80211_»sume_discÚÃù
, "_gpl", "");

155 
KSYMTAB_FUNC
(
›“80211_ave_rssi
, "_gpl", "");

156 
KSYMTAB_FUNC
(
›“80211_¿d¬_d‘eùed
, "", "");

157 
KSYMTAB_FUNC
(
›“80211_upd©e_p2p_nß
, "", "");

158 
KSYMTAB_FUNC
(
›“80211_·r£_p2p_nß
, "", "");

159 
KSYMTAB_FUNC
(
›“80211_txq_g‘_d•th
, "", "");

160 
KSYMTAB_FUNC
(
›“80211_™”_chª_cÚ‹xts_©omic
, "_gpl", "");

161 
KSYMTAB_FUNC
(
›“80211_chsw™ch_dÚe
, "", "");

162 
KSYMTAB_FUNC
(
›“80211_­_´ob”eq_g‘
, "", "");

163 
KSYMTAB_FUNC
(
›“80211_b—cÚ_loss
, "", "");

164 
KSYMTAB_FUNC
(
›“80211_cÚÃùiÚ_loss
, "", "");

165 
KSYMTAB_FUNC
(
›“80211_discÚÃù
, "", "");

166 
KSYMTAB_FUNC
(
›“80211_cqm_rssi_nÙify
, "", "");

167 
KSYMTAB_FUNC
(
›“80211_cqm_b—cÚ_loss_nÙify
, "", "");

168 
KSYMTAB_FUNC
(
›“80211_’abË_rssi_»pÜts
, "", "");

169 
KSYMTAB_FUNC
(
›“80211_di§bË_rssi_»pÜts
, "", "");

170 
KSYMTAB_FUNC
(
›“80211_tdls_İ”_»que¡
, "", "");

171 
KSYMTAB_FUNC
(
›“80211_ÿlc_rx_aœtime
, "_gpl", "");

172 
KSYMTAB_FUNC
(
›“80211_ÿlc_tx_aœtime
, "_gpl", "");

173 
KSYMTAB_FUNC
(
__›“80211_g‘_¿dio_Ëd_Çme
, "", "");

174 
KSYMTAB_FUNC
(
__›“80211_g‘_assoc_Ëd_Çme
, "", "");

175 
KSYMTAB_FUNC
(
__›“80211_g‘_tx_Ëd_Çme
, "", "");

176 
KSYMTAB_FUNC
(
__›“80211_g‘_rx_Ëd_Çme
, "", "");

177 
KSYMTAB_FUNC
(
__›“80211_ü—‹_t_Ëd_Œigg”
, "", "");

178 
KSYMTAB_FUNC
(
›“80211_»pÜt_wowÏn_wakeup
, "", "");

180 
SYMBOL_CRC
(
›“80211_emuÏ‹_add_chªùx
, 0xaa7bfd3a, "");

181 
SYMBOL_CRC
(
›“80211_emuÏ‹_»move_chªùx
, 0x5fb45228, "");

182 
SYMBOL_CRC
(
›“80211_emuÏ‹_chªge_chªùx
, 0xd92ac356, "");

183 
SYMBOL_CRC
(
›“80211_emuÏ‹_sw™ch_vif_chªùx
, 0x42aef1e5, "");

184 
SYMBOL_CRC
(
›“80211_»¡¬t_hw
, 0x3dbea829, "");

185 
SYMBOL_CRC
(
›“80211_®loc_hw_nm
, 0x81bb2772, "");

186 
SYMBOL_CRC
(
›“80211_»gi¡”_hw
, 0x19ddbf04, "");

187 
SYMBOL_CRC
(
›“80211_uÄegi¡”_hw
, 0x3488fca2, "");

188 
SYMBOL_CRC
(
›“80211_ä“_hw
, 0x8918c4a7, "");

189 
SYMBOL_CRC
(
›“80211_tx_¡©us_œq§ã
, 0xeaf49e99, "");

190 
SYMBOL_CRC
(
›“80211_tx_¡©us_skb
, 0x2d1ea419, "");

191 
SYMBOL_CRC
(
›“80211_tx_¡©us_ext
, 0xe30f4d27, "");

192 
SYMBOL_CRC
(
›“80211_tx_¿‹_upd©e
, 0x08b5a345, "");

193 
SYMBOL_CRC
(
›“80211_»pÜt_low_ack
, 0xc45f6cdd, "");

194 
SYMBOL_CRC
(
›“80211_ä“_txskb
, 0x888e78cb, "");

195 
SYMBOL_CRC
(
›“80211_fšd_¡a_by_lšk_addrs
, 0x8ba06004, "_gpl");

196 
SYMBOL_CRC
(
›“80211_fšd_¡a_by_içddr
, 0x11cd77e2, "_gpl");

197 
SYMBOL_CRC
(
›“80211_fšd_¡a
, 0x74055f1e, "");

198 
SYMBOL_CRC
(
›“80211_¡a_block_awake
, 0x4a98d08a, "");

199 
SYMBOL_CRC
(
›“80211_¡a_eo¥
, 0xff23fb96, "");

200 
SYMBOL_CRC
(
›“80211_£nd_eo¥_nuÎfunc
, 0xfac038d3, "");

201 
SYMBOL_CRC
(
›“80211_¡a_£t_bufã»d
, 0x3615c9e3, "");

202 
SYMBOL_CRC
(
›“80211_¡a_»gi¡”_aœtime
, 0x08778f02, "");

203 
SYMBOL_CRC
(
›“80211_¡a_»ÿlc_agg»g©es
, 0x5e9b4b4f, "");

204 
SYMBOL_CRC
(
›“80211_sÿn_com¶‘ed
, 0xc26d6995, "");

205 
SYMBOL_CRC
(
›“80211_sched_sÿn_»suÉs
, 0xf7920240, "");

206 
SYMBOL_CRC
(
›“80211_sched_sÿn_¡İ³d
, 0xc04d4b1a, "");

207 
SYMBOL_CRC
(
›“80211_»ady_Ú_chªÃl
, 0x1bd7c4a1, "_gpl");

208 
SYMBOL_CRC
(
›“80211_»maš_Ú_chªÃl_expœed
, 0x424163ce, "_gpl");

209 
SYMBOL_CRC
(
›“80211_»que¡_smps
, 0x9c67d88c, "_gpl");

210 
SYMBOL_CRC
(
›“80211_£nd_b¬
, 0xff6d2835, "");

211 
SYMBOL_CRC
(
›“80211_»äesh_tx_agg_£ssiÚ_tim”
, 0x97bdd657, "");

212 
SYMBOL_CRC
(
›“80211_¡¬t_tx_ba_£ssiÚ
, 0xaa23bf22, "");

213 
SYMBOL_CRC
(
›“80211_¡¬t_tx_ba_cb_œq§ã
, 0xf1dd0f69, "");

214 
SYMBOL_CRC
(
›“80211_¡İ_tx_ba_£ssiÚ
, 0xb67d2e72, "");

215 
SYMBOL_CRC
(
›“80211_¡İ_tx_ba_cb_œq§ã
, 0x478a28d7, "");

216 
SYMBOL_CRC
(
›“80211_¡İ_rx_ba_£ssiÚ
, 0xad752c3b, "");

217 
SYMBOL_CRC
(
›“80211_mªage_rx_ba_ofæ
, 0x16661ec3, "");

218 
SYMBOL_CRC
(
›“80211_rx_ba_tim”_expœed
, 0xb7e4e6f4, "");

219 
SYMBOL_CRC
(
›“80211_upd©e_mu_groups
, 0x1f9ff1a8, "_gpl");

220 
SYMBOL_CRC
(
›“80211_£t_aùive_lšks
, 0xfbbae664, "_gpl");

221 
SYMBOL_CRC
(
›“80211_£t_aùive_lšks_async
, 0x092b5233, "_gpl");

222 
SYMBOL_CRC
(
›“80211_¿‹_cÚŒŞ_»gi¡”
, 0x759218d1, "");

223 
SYMBOL_CRC
(
›“80211_¿‹_cÚŒŞ_uÄegi¡”
, 0xd8b3f95e, "");

224 
SYMBOL_CRC
(
›“80211_g‘_tx_¿‹s
, 0x00b3bc09, "");

225 
SYMBOL_CRC
(
¿‹_cÚŒŞ_£t_¿‹s
, 0xaeff1bc1, "");

226 
SYMBOL_CRC
(
›“80211_tk_add_iv
, 0x16ad7c5f, "_gpl");

227 
SYMBOL_CRC
(
›“80211_g‘_tk_p1k_iv
, 0x1cf75d45, "");

228 
SYMBOL_CRC
(
›“80211_g‘_tk_rx_p1k
, 0x391eda45, "");

229 
SYMBOL_CRC
(
›“80211_g‘_tk_p2k
, 0x78d4b9b7, "");

230 
SYMBOL_CRC
(
›“80211_c§_fšish
, 0xb70564f7, "");

231 
SYMBOL_CRC
(
›“80211_chªÃl_sw™ch_discÚÃù
, 0xc00c72ca, "");

232 
SYMBOL_CRC
(
›“80211_Çn_func_‹rmš©ed
, 0xa98a695b, "");

233 
SYMBOL_CRC
(
›“80211_Çn_func_m©ch
, 0x27484766, "");

234 
SYMBOL_CRC
(
›“80211_cŞÜ_chªge_fšish
, 0xd95d43ee, "_gpl");

235 
SYMBOL_CRC
(
›“80211_obss_cŞÜ_cŞlisiÚ_nÙify
, 0xfafd6105, "_gpl");

236 
SYMBOL_CRC
(
›“80211_¡a_ps_Œªs™iÚ
, 0xecd45ecf, "");

237 
SYMBOL_CRC
(
›“80211_¡a_p¥Şl
, 0xc4dbf48c, "");

238 
SYMBOL_CRC
(
›“80211_¡a_u­sd_Œigg”
, 0x0a16d61e, "");

239 
SYMBOL_CRC
(
›“80211_m¬k_rx_ba_f‹»d_äames
, 0x3756fbab, "");

240 
SYMBOL_CRC
(
›“80211_rx_li¡
, 0xfb25c082, "");

241 
SYMBOL_CRC
(
›“80211_rx_Çpi
, 0xa9ed06af, "");

242 
SYMBOL_CRC
(
›“80211_rx_œq§ã
, 0xeb1b750e, "");

243 
SYMBOL_CRC
(
›“80211_tx_´•¬e_skb
, 0x61ea0dd4, "");

244 
SYMBOL_CRC
(
›“80211_tx_dequeue
, 0x5f1aa6f0, "");

245 
SYMBOL_CRC
(
›“80211_Ãxt_txq
, 0x4d8f8bc0, "");

246 
SYMBOL_CRC
(
__›“80211_scheduË_txq
, 0xf649b920, "");

247 
SYMBOL_CRC
(
›“80211_txq_aœtime_check
, 0x41cf6dc2, "");

248 
SYMBOL_CRC
(
›“80211_txq_may_Œªsm™
, 0x2f864cf0, "");

249 
SYMBOL_CRC
(
›“80211_txq_scheduË_¡¬t
, 0xa1bf5e01, "");

250 
SYMBOL_CRC
(
›“80211_b—cÚ_upd©e_útdwn
, 0x5fb7240e, "");

251 
SYMBOL_CRC
(
›“80211_b—cÚ_£t_útdwn
, 0x1fdd9695, "");

252 
SYMBOL_CRC
(
›“80211_b—cÚ_útdwn_is_com¶‘e
, 0xb0f64b8e, "");

253 
SYMBOL_CRC
(
›“80211_b—cÚ_g‘_‹m¶©e
, 0x014bb288, "");

254 
SYMBOL_CRC
(
›“80211_b—cÚ_g‘_‹m¶©e_ema_šdex
, 0xeb021fcd, "");

255 
SYMBOL_CRC
(
›“80211_b—cÚ_ä“_ema_li¡
, 0x3a356f51, "");

256 
SYMBOL_CRC
(
›“80211_b—cÚ_g‘_‹m¶©e_ema_li¡
, 0x32c7a89e, "");

257 
SYMBOL_CRC
(
›“80211_b—cÚ_g‘_tim
, 0x61a9087c, "");

258 
SYMBOL_CRC
(
›“80211_´ob”e¥_g‘
, 0xdf47c7e2, "");

259 
SYMBOL_CRC
(
›“80211_g‘_fs_discov”y_tm¶
, 0x693fbaab, "");

260 
SYMBOL_CRC
(
›“80211_g‘_unsŞ_bÿ¡_´obe_»¥_tm¶
, 0x3f5fa4a7, "");

261 
SYMBOL_CRC
(
›“80211_p¥Şl_g‘
, 0x06546023, "");

262 
SYMBOL_CRC
(
›“80211_nuÎfunc_g‘
, 0x6de3d062, "");

263 
SYMBOL_CRC
(
›“80211_´ob”eq_g‘
, 0x0359d7fe, "");

264 
SYMBOL_CRC
(
›“80211_¹s_g‘
, 0xd357ba53, "");

265 
SYMBOL_CRC
(
›“80211_ù¡o£lf_g‘
, 0x1f39056e, "");

266 
SYMBOL_CRC
(
›“80211_g‘_bufã»d_bc
, 0x967817b8, "");

267 
SYMBOL_CRC
(
›“80211_»£rve_tid
, 0x5885750e, "");

268 
SYMBOL_CRC
(
›“80211_uÄe£rve_tid
, 0x6fe334ad, "");

269 
SYMBOL_CRC
(
›“80211_™”_keys
, 0xbd6280f7, "");

270 
SYMBOL_CRC
(
›“80211_™”_keys_rcu
, 0xc111300b, "");

271 
SYMBOL_CRC
(
›“80211_gtk_»key_nÙify
, 0x724e3201, "_gpl");

272 
SYMBOL_CRC
(
›“80211_g‘_key_rx_£q
, 0xaeb9a917, "");

273 
SYMBOL_CRC
(
›“80211_£t_key_rx_£q
, 0x1dab0efe, "_gpl");

274 
SYMBOL_CRC
(
›“80211_»move_key
, 0xea792270, "_gpl");

275 
SYMBOL_CRC
(
›“80211_gtk_»key_add
, 0x6333ad1c, "_gpl");

276 
SYMBOL_CRC
(
›“80211_key_mic_çu»
, 0xd004ea88, "_gpl");

277 
SYMBOL_CRC
(
›“80211_key_»¶ay
, 0x9e1c1431, "_gpl");

278 
SYMBOL_CRC
(
why_to_›“80211_hw
, 0xfdf326ce, "");

279 
SYMBOL_CRC
(
›“80211_g‘_bssid
, 0x95febea6, "");

280 
SYMBOL_CRC
(
›“80211_g’”ic_äame_du¿tiÚ
, 0xb0d46778, "");

281 
SYMBOL_CRC
(
›“80211_¹s_du¿tiÚ
, 0x4b4487cf, "");

282 
SYMBOL_CRC
(
›“80211_ù¡o£lf_du¿tiÚ
, 0xf6dfd5b5, "");

283 
SYMBOL_CRC
(
›“80211_hªdË_wake_tx_queue
, 0x89849d8c, "");

284 
SYMBOL_CRC
(
›“80211_wake_queue
, 0x6593bf47, "");

285 
SYMBOL_CRC
(
›“80211_¡İ_queue
, 0xd4f99373, "");

286 
SYMBOL_CRC
(
›“80211_¡İ_queues
, 0x902c0607, "");

287 
SYMBOL_CRC
(
›“80211_queue_¡İ³d
, 0x53a386cb, "");

288 
SYMBOL_CRC
(
›“80211_wake_queues
, 0x10edc7c6, "");

289 
SYMBOL_CRC
(
›“80211_™”©e_š‹rçûs
, 0x861a5225, "_gpl");

290 
SYMBOL_CRC
(
›“80211_™”©e_aùive_š‹rçûs_©omic
, 0x0c7c7937, "_gpl");

291 
SYMBOL_CRC
(
›“80211_™”©e_aùive_š‹rçûs_mtx
, 0x3849c458, "_gpl");

292 
SYMBOL_CRC
(
›“80211_™”©e_¡©iÚs_©omic
, 0x4ae9cd9c, "_gpl");

293 
SYMBOL_CRC
(
wdev_to_›“80211_vif
, 0x7d8cd910, "_gpl");

294 
SYMBOL_CRC
(
›“80211_vif_to_wdev
, 0x1c115b90, "_gpl");

295 
SYMBOL_CRC
(
›“80211_queue_wÜk
, 0x84b2de1a, "");

296 
SYMBOL_CRC
(
›“80211_queue_d–ayed_wÜk
, 0x3923f408, "");

297 
SYMBOL_CRC
(
›“80211_hw_»¡¬t_discÚÃù
, 0x1e2689ce, "_gpl");

298 
SYMBOL_CRC
(
›“80211_»sume_discÚÃù
, 0x39ec11f1, "_gpl");

299 
SYMBOL_CRC
(
›“80211_ave_rssi
, 0x4f0ee123, "_gpl");

300 
SYMBOL_CRC
(
›“80211_¿d¬_d‘eùed
, 0x3ea0c76a, "");

301 
SYMBOL_CRC
(
›“80211_upd©e_p2p_nß
, 0x19f37f0d, "");

302 
SYMBOL_CRC
(
›“80211_·r£_p2p_nß
, 0x991a0ca0, "");

303 
SYMBOL_CRC
(
›“80211_txq_g‘_d•th
, 0xdec06ddf, "");

304 
SYMBOL_CRC
(
›“80211_™”_chª_cÚ‹xts_©omic
, 0xe20e7f6c, "_gpl");

305 
SYMBOL_CRC
(
›“80211_chsw™ch_dÚe
, 0x25801464, "");

306 
SYMBOL_CRC
(
›“80211_­_´ob”eq_g‘
, 0xb91dd102, "");

307 
SYMBOL_CRC
(
›“80211_b—cÚ_loss
, 0xc0cd30c3, "");

308 
SYMBOL_CRC
(
›“80211_cÚÃùiÚ_loss
, 0xaed8120c, "");

309 
SYMBOL_CRC
(
›“80211_discÚÃù
, 0xd390a248, "");

310 
SYMBOL_CRC
(
›“80211_cqm_rssi_nÙify
, 0x37659422, "");

311 
SYMBOL_CRC
(
›“80211_cqm_b—cÚ_loss_nÙify
, 0x3d1ea765, "");

312 
SYMBOL_CRC
(
›“80211_’abË_rssi_»pÜts
, 0x7c732380, "");

313 
SYMBOL_CRC
(
›“80211_di§bË_rssi_»pÜts
, 0x352e0c7c, "");

314 
SYMBOL_CRC
(
›“80211_tdls_İ”_»que¡
, 0x89851f83, "");

315 
SYMBOL_CRC
(
›“80211_ÿlc_rx_aœtime
, 0x842e0154, "_gpl");

316 
SYMBOL_CRC
(
›“80211_ÿlc_tx_aœtime
, 0xb62c74bf, "_gpl");

317 
SYMBOL_CRC
(
__›“80211_g‘_¿dio_Ëd_Çme
, 0x46ccce64, "");

318 
SYMBOL_CRC
(
__›“80211_g‘_assoc_Ëd_Çme
, 0x07ab2907, "");

319 
SYMBOL_CRC
(
__›“80211_g‘_tx_Ëd_Çme
, 0xe98e6393, "");

320 
SYMBOL_CRC
(
__›“80211_g‘_rx_Ëd_Çme
, 0x9cdb474e, "");

321 
SYMBOL_CRC
(
__›“80211_ü—‹_t_Ëd_Œigg”
, 0x4e1cc2d5, "");

322 
SYMBOL_CRC
(
›“80211_»pÜt_wowÏn_wakeup
, 0x50dffc92, "");

324 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

325 
__u£d
 
__£ùiÚ
("__versions") = {

718 
MODULE_INFO
(
d•’ds
, "cfg80211,libarc4");

721 
MODULE_INFO
(
¤cv”siÚ
, "BB095EE77446E94801FEB4A");

	@main.c

11 
	~<Ãt/mac80211.h
>

12 
	~<lšux/moduË.h
>

13 
	~<lšux/fs.h
>

14 
	~<lšux/š™.h
>

15 
	~<lšux/Ãtdeviû.h
>

16 
	~<lšux/ty³s.h
>

17 
	~<lšux/¦ab.h
>

18 
	~<lšux/skbuff.h
>

19 
	~<lšux/‘h”deviû.h
>

20 
	~<lšux/if_¬p.h
>

21 
	~<lšux/¹Ãšk.h
>

22 
	~<lšux/b™m­.h
>

23 
	~<lšux/š‘deviû.h
>

24 
	~<Ãt/Ãt_Çme¥aû.h
>

25 
	~<Ãt/drİ»asÚ.h
>

26 
	~<Ãt/cfg80211.h
>

27 
	~<Ãt/addrcÚf.h
>

29 
	~"›“80211_i.h
"

30 
	~"driv”-İs.h
"

31 
	~"¿‹.h
"

32 
	~"mesh.h
"

33 
	~"w•.h
"

34 
	~"Ëd.h
"

35 
	~"debugfs.h
"

37 
	$›“80211_cÚfigu»_f‹r
(
›“80211_loÿl
 *
loÿl
)

39 
u64
 
mc
;

40 
chªged_æags
;

41 
Ãw_æags
 = 0;

43 ià(
	`©omic_»ad
(&
loÿl
->
iff_®lmuÉis
))

44 
Ãw_æags
 |ğ
FIF_ALLMULTI
;

46 ià(
loÿl
->
mÚ™Üs
 || 
	`‹¡_b™
(
SCAN_SW_SCANNING
, &loÿl->
sÿÂšg
) ||

47 
	`‹¡_b™
(
SCAN_ONCHANNEL_SCANNING
, &
loÿl
->
sÿÂšg
))

48 
Ãw_æags
 |ğ
FIF_BCN_PRBRESP_PROMISC
;

50 ià(
loÿl
->
fif_´obe_»q
 ||†oÿl->
´obe_»q_»g
)

51 
Ãw_æags
 |ğ
FIF_PROBE_REQ
;

53 ià(
loÿl
->
fif_fcsç
)

54 
Ãw_æags
 |ğ
FIF_FCSFAIL
;

56 ià(
loÿl
->
fif_¶ıç
)

57 
Ãw_æags
 |ğ
FIF_PLCPFAIL
;

59 ià(
loÿl
->
fif_cÚŒŞ
)

60 
Ãw_æags
 |ğ
FIF_CONTROL
;

62 ià(
loÿl
->
fif_Ùh”_bss
)

63 
Ãw_æags
 |ğ
FIF_OTHER_BSS
;

65 ià(
loÿl
->
fif_p¥Şl
)

66 
Ãw_æags
 |ğ
FIF_PSPOLL
;

68 ià(
loÿl
->
rx_mÿ¡_aùiÚ_»g
)

69 
Ãw_æags
 |ğ
FIF_MCAST_ACTION
;

71 
	`¥š_lock_bh
(&
loÿl
->
f‹r_lock
);

72 
chªged_æags
 = 
loÿl
->
f‹r_æags
 ^ 
Ãw_æags
;

74 
mc
 = 
	`drv_´•¬e_muÉiÿ¡
(
loÿl
, &loÿl->
mc_li¡
);

75 
	`¥š_uÆock_bh
(&
loÿl
->
f‹r_lock
);

78 
Ãw_æags
 |= (1<<31);

80 
	`drv_cÚfigu»_f‹r
(
loÿl
, 
chªged_æags
, &
Ãw_æags
, 
mc
);

82 
	`WARN_ON
(
Ãw_æags
 & (1<<31));

84 
loÿl
->
f‹r_æags
 = 
Ãw_æags
 & ~(1<<31);

85 
	}
}

87 
	$›“80211_»cÚfig_f‹r
(
why
 *wiphy,

88 
why_wÜk
 *
wÜk
)

90 
›“80211_loÿl
 *
loÿl
 =

91 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
»cÚfig_f‹r
);

93 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

94 
	}
}

96 
u32
 
	$›“80211_ÿlc_hw_cÚf_chª
(
›“80211_loÿl
 *
loÿl
,

97 
›“80211_chªùx_cÚf
 *
ùx
)

99 
›“80211_sub_if_d©a
 *
sd©a
;

100 
cfg80211_chª_def
 
chªdef
 = {};

101 
cfg80211_chª_def
 *
İ”
 = 
NULL
;

102 
›“80211_smps_mode
 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

103 
u32
 
chªged
 = 0;

104 
pow”
;

105 
u32
 
offchªÃl_æag
;

107 ià(!
loÿl
->
emuÏ‹_chªùx
)

110 
offchªÃl_æag
 = 
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_OFFCHANNEL
;

112 ià(
ùx
 && !
	`WARN_ON
(!ùx->
def
.
chª
)) {

113 
İ”
 = &
ùx
->
def
;

114 ià(
ùx
->
rx_chašs_¡©ic
 > 1)

115 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

116 ià(
ùx
->
rx_chašs_dyÇmic
 > 1)

117 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

119 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

122 ià(
loÿl
->
sÿn_chªdef
.
chª
) {

123 
chªdef
 = 
loÿl
->
sÿn_chªdef
;

124 } ià(
loÿl
->
tmp_chªÃl
) {

125 
chªdef
.
chª
 = 
loÿl
->
tmp_chªÃl
;

126 
chªdef
.
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

127 
chªdef
.
ûÁ”_äeq1
 = chªdef.
chª
->
ûÁ”_äeq
;

128 
chªdef
.
äeq1_off£t
 = chªdef.
chª
->
äeq_off£t
;

129 } ià(
İ”
) {

130 
chªdef
 = *
İ”
;

132 
chªdef
 = 
loÿl
->
dæt_chªdef
;

135 ià(
	`WARN
(!
	`cfg80211_chªdef_v®id
(&
chªdef
),

137 
chªdef
.
chª
 ? chªdef.chª->
ûÁ”_äeq
 : -1,

138 
chªdef
.
chª
 ? chªdef.chª->
äeq_off£t
 : 0,

139 
chªdef
.
width
, chªdef.
ûÁ”_äeq1
, chªdef.
äeq1_off£t
,

140 
chªdef
.
ûÁ”_äeq2
))

143 ià(!
İ”
 || !
	`cfg80211_chªdef_id’tiÿl
(&
chªdef
, oper))

144 
loÿl
->
hw
.
cÚf
.
æags
 |ğ
IEEE80211_CONF_OFFCHANNEL
;

146 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_OFFCHANNEL
;

148 
offchªÃl_æag
 ^ğ
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_OFFCHANNEL
;

151 ià(
offchªÃl_æag
 || 
loÿl
->
sÿÂšg
 ||

152 !
	`cfg80211_chªdef_id’tiÿl
(&
loÿl
->
hw
.
cÚf
.
chªdef
, &chandef)) {

153 
loÿl
->
hw
.
cÚf
.
chªdef
 = chandef;

154 
chªged
 |ğ
IEEE80211_CONF_CHANGE_CHANNEL
;

157 ià(!
	`cÚf_is_ht
(&
loÿl
->
hw
.
cÚf
)) {

163 
loÿl
->
hw
.
cÚf
.
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

164 } ià(
loÿl
->
hw
.
cÚf
.
smps_mode
 != smps_mode) {

165 
loÿl
->
hw
.
cÚf
.
smps_mode
 = smps_mode;

166 
chªged
 |ğ
IEEE80211_CONF_CHANGE_SMPS
;

169 
pow”
 = 
	`›“80211_chªdef_max_pow”
(&
chªdef
);

171 
	`rcu_»ad_lock
();

172 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

173 ià(!
	`rcu_acûss_poš‹r
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
))

175 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

177 ià(
sd©a
->
vif
.
bss_cÚf
.
txpow”
 =ğ
INT_MIN
)

179 
pow”
 = 
	`mš
Õow”, 
sd©a
->
vif
.
bss_cÚf
.
txpow”
);

181 
	`rcu_»ad_uÆock
();

183 ià(
loÿl
->
hw
.
cÚf
.
pow”_Ëv–
 !ğ
pow”
) {

184 
chªged
 |ğ
IEEE80211_CONF_CHANGE_POWER
;

185 
loÿl
->
hw
.
cÚf
.
pow”_Ëv–
 = 
pow”
;

188  
chªged
;

189 
	}
}

191 
	$›“80211_hw_cÚfig
(
›“80211_loÿl
 *
loÿl
, 
u32
 
chªged
)

193 
»t
 = 0;

195 
	`might_¦“p
();

197 
	`WARN_ON
(
chªged
 & (
IEEE80211_CONF_CHANGE_CHANNEL
 |

198 
IEEE80211_CONF_CHANGE_POWER
 |

199 
IEEE80211_CONF_CHANGE_SMPS
));

201 ià(
chªged
 && 
loÿl
->
İ’_couÁ
) {

202 
»t
 = 
	`drv_cÚfig
(
loÿl
, 
chªged
);

220  
»t
;

221 
	}
}

224 
	$_›“80211_hw_cÚf_chª
(
›“80211_loÿl
 *
loÿl
,

225 
›“80211_chªùx_cÚf
 *
ùx
)

227 
u32
 
chªged
;

229 ià(!
loÿl
->
İ’_couÁ
)

232 
chªged
 = 
	`›“80211_ÿlc_hw_cÚf_chª
(
loÿl
, 
ùx
);

233 ià(!
chªged
)

236  
	`drv_cÚfig
(
loÿl
, 
chªged
);

237 
	}
}

239 
	$›“80211_hw_cÚf_chª
(
›“80211_loÿl
 *
loÿl
)

241 
›“80211_chªùx
 *
ùx
;

243 
ùx
 = 
	`li¡_fœ¡_’Œy_Ü_nuÎ
(&
loÿl
->
chªùx_li¡
,

244 
›“80211_chªùx
,

245 
li¡
);

247  
	`_›“80211_hw_cÚf_chª
(
loÿl
, 
ùx
 ? &ùx->
cÚf
 : 
NULL
);

248 
	}
}

250 
	$›“80211_hw_cÚf_š™
(
›“80211_loÿl
 *
loÿl
)

252 
u32
 
chªged
 = ~(
IEEE80211_CONF_CHANGE_CHANNEL
 |

253 
IEEE80211_CONF_CHANGE_POWER
 |

254 
IEEE80211_CONF_CHANGE_SMPS
);

256 ià(
	`WARN_ON
(!
loÿl
->
İ’_couÁ
))

259 ià(
loÿl
->
emuÏ‹_chªùx
) {

260 
›“80211_chªùx
 *
ùx
;

262 
ùx
 = 
	`li¡_fœ¡_’Œy_Ü_nuÎ
(&
loÿl
->
chªùx_li¡
,

263 
›“80211_chªùx
,

264 
li¡
);

266 
chªged
 |ğ
	`›“80211_ÿlc_hw_cÚf_chª
(
loÿl
,

267 
ùx
 ? &ùx->
cÚf
 : 
NULL
);

270 
	`WARN_ON
(
	`drv_cÚfig
(
loÿl
, 
chªged
));

271 
	}
}

273 
	$›“80211_emuÏ‹_add_chªùx
(
›“80211_hw
 *
hw
,

274 
›“80211_chªùx_cÚf
 *
ùx
)

276 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

278 
loÿl
->
hw
.
cÚf
.
¿d¬_’abËd
 = 
ùx
->radar_enabled;

280  
	`_›“80211_hw_cÚf_chª
(
loÿl
, 
ùx
);

281 
	}
}

282 
EXPORT_SYMBOL
(
›“80211_emuÏ‹_add_chªùx
);

284 
	$›“80211_emuÏ‹_»move_chªùx
(
›“80211_hw
 *
hw
,

285 
›“80211_chªùx_cÚf
 *
ùx
)

287 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

289 
loÿl
->
hw
.
cÚf
.
¿d¬_’abËd
 = 
çl£
;

291 
	`_›“80211_hw_cÚf_chª
(
loÿl
, 
NULL
);

292 
	}
}

293 
EXPORT_SYMBOL
(
›“80211_emuÏ‹_»move_chªùx
);

295 
	$›“80211_emuÏ‹_chªge_chªùx
(
›“80211_hw
 *
hw
,

296 
›“80211_chªùx_cÚf
 *
ùx
,

297 
u32
 
chªged
)

299 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

301 
loÿl
->
hw
.
cÚf
.
¿d¬_’abËd
 = 
ùx
->radar_enabled;

303 
	`_›“80211_hw_cÚf_chª
(
loÿl
, 
ùx
);

304 
	}
}

305 
EXPORT_SYMBOL
(
›“80211_emuÏ‹_chªge_chªùx
);

307 
	$›“80211_emuÏ‹_sw™ch_vif_chªùx
(
›“80211_hw
 *
hw
,

308 
›“80211_vif_chªùx_sw™ch
 *
vifs
,

309 
n_vifs
,

310 
›“80211_chªùx_sw™ch_mode
 
mode
)

312 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

314 ià(
n_vifs
 <= 0)

315  -
EINVAL
;

317 
loÿl
->
hw
.
cÚf
.
¿d¬_’abËd
 = 
vifs
[0].
Ãw_ùx
->radar_enabled;

318 
	`_›“80211_hw_cÚf_chª
(
loÿl
, 
vifs
[0].
Ãw_ùx
);

321 
	}
}

322 
EXPORT_SYMBOL
(
›“80211_emuÏ‹_sw™ch_vif_chªùx
);

324 
	#BSS_CHANGED_VIF_CFG_FLAGS
 (
BSS_CHANGED_ASSOC
 |\

325 
BSS_CHANGED_IDLE
 |\

326 
BSS_CHANGED_PS
 |\

327 
BSS_CHANGED_IBSS
 |\

328 
BSS_CHANGED_ARP_FILTER
 |\

329 
BSS_CHANGED_SSID
 |\

330 
BSS_CHANGED_MLD_VALID_LINKS
 |\

331 
BSS_CHANGED_MLD_TTLM
)

	)

333 
	$›“80211_bss_šfo_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

334 
u64
 
chªged
)

336 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

338 
	`might_¦“p
();

340 ià(!
chªged
 || 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

343 ià(
	`WARN_ON_ONCE
(
chªged
 & (
BSS_CHANGED_BEACON
 |

344 
BSS_CHANGED_BEACON_ENABLED
) &&

345 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

346 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

347 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
 &&

348 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_OCB
))

351 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_P2P_DEVICE
 ||

352 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_NAN
 ||

353 (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 &&

354 !
sd©a
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
 &&

355 !(
chªged
 & 
BSS_CHANGED_TXPOWER
))))

358 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

361 ià(
chªged
 & 
BSS_CHANGED_VIF_CFG_FLAGS
) {

362 
u64
 
ch
 = 
chªged
 & 
BSS_CHANGED_VIF_CFG_FLAGS
;

364 
	`Œaû_drv_vif_cfg_chªged
(
loÿl
, 
sd©a
, 
chªged
);

365 ià(
loÿl
->
İs
->
vif_cfg_chªged
)

366 
loÿl
->
İs
->
	`vif_cfg_chªged
(&loÿl->
hw
, &
sd©a
->
vif
, 
ch
);

369 ià(
chªged
 & ~
BSS_CHANGED_VIF_CFG_FLAGS
) {

370 
u64
 
ch
 = 
chªged
 & ~
BSS_CHANGED_VIF_CFG_FLAGS
;

373 
	`Œaû_drv_lšk_šfo_chªged
(
loÿl
, 
sd©a
, &sd©a->
vif
.
bss_cÚf
,

374 
chªged
);

375 ià(
loÿl
->
İs
->
lšk_šfo_chªged
)

376 
loÿl
->
İs
->
	`lšk_šfo_chªged
(&loÿl->
hw
, &
sd©a
->
vif
,

377 &
sd©a
->
vif
.
bss_cÚf
, 
ch
);

380 ià(
loÿl
->
İs
->
bss_šfo_chªged
)

381 
loÿl
->
İs
->
	`bss_šfo_chªged
(&loÿl->
hw
, &
sd©a
->
vif
,

382 &
sd©a
->
vif
.
bss_cÚf
, 
chªged
);

383 
	`Œaû_drv_»tuº_void
(
loÿl
);

384 
	}
}

386 
	$›“80211_vif_cfg_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

387 
u64
 
chªged
)

389 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

391 
	`WARN_ON_ONCE
(
chªged
 & ~
BSS_CHANGED_VIF_CFG_FLAGS
);

393 ià(!
chªged
 || 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

396 
	`drv_vif_cfg_chªged
(
loÿl
, 
sd©a
, 
chªged
);

397 
	}
}

399 
	$›“80211_lšk_šfo_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

400 
›“80211_lšk_d©a
 *
lšk
,

401 
u64
 
chªged
)

403 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

405 
	`WARN_ON_ONCE
(
chªged
 & 
BSS_CHANGED_VIF_CFG_FLAGS
);

407 ià(!
chªged
 || 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

410 ià(!
	`check_sd©a_š_driv”
(
sd©a
))

413 
	`drv_lšk_šfo_chªged
(
loÿl
, 
sd©a
, 
lšk
->
cÚf
,†šk->
lšk_id
, 
chªged
);

414 
	}
}

416 
u64
 
	$›“80211_»£t_”p_šfo
(
›“80211_sub_if_d©a
 *
sd©a
)

418 
sd©a
->
vif
.
bss_cÚf
.
u£_ùs_´Ù
 = 
çl£
;

419 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
 = 
çl£
;

420 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_¦Ù
 = 
çl£
;

421  
BSS_CHANGED_ERP_CTS_PROT
 |

422 
BSS_CHANGED_ERP_PREAMBLE
 |

423 
BSS_CHANGED_ERP_SLOT
;

424 
	}
}

426 
	$›“80211_skËt_hªdËr
(
skËt_¡ruù
 *
t
)

428 
›“80211_loÿl
 *
loÿl
 = 
	`äom_skËt
Öoÿl, 
t
, 
skËt
);

429 
sk_buff
 *
skb
;

431 (
skb
 = 
	`skb_dequeue
(&
loÿl
->
skb_queue
)) ||

432 (
skb
 = 
	`skb_dequeue
(&
loÿl
->
skb_queue_uÄ–ŸbË
))) {

433 
skb
->
pkt_ty³
) {

434 
IEEE80211_RX_MSG
:

437 
skb
->
pkt_ty³
 = 0;

438 
	`›“80211_rx
(&
loÿl
->
hw
, 
skb
);

440 
IEEE80211_TX_STATUS_MSG
:

441 
skb
->
pkt_ty³
 = 0;

442 
	`›“80211_tx_¡©us_skb
(&
loÿl
->
hw
, 
skb
);

445 
	`WARN
(1, "mac80211: Packet is of unknownype %d\n",

446 
skb
->
pkt_ty³
);

447 
	`dev_kä“_skb
(
skb
);

451 
	}
}

453 
	$›“80211_»¡¬t_wÜk
(
wÜk_¡ruù
 *
wÜk
)

455 
›“80211_loÿl
 *
loÿl
 =

456 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
»¡¬t_wÜk
);

457 
›“80211_sub_if_d©a
 *
sd©a
;

458 
»t
;

460 
	`æush_wÜkqueue
(
loÿl
->
wÜkqueue
);

462 
	`¹Æ_lock
();

464 
	`why_lock
(
loÿl
->
hw
.
why
);

465 
	`why_wÜk_æush
(
loÿl
->
hw
.
why
, 
NULL
);

467 
	`WARN
(
	`‹¡_b™
(
SCAN_HW_SCANNING
, &
loÿl
->
sÿÂšg
),

468 "% ÿÎed w™h h¬dw¬sÿÀš…rog»ss\n", 
__func__
);

470 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

479 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

487 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
,

488 &
sd©a
->
u
.
mgd
.
c§_cÚÃùiÚ_drİ_wÜk
);

489 ià(
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
)

490 
	`›“80211_¡a_cÚÃùiÚ_lo¡
(
sd©a
,

491 
WLAN_REASON_UNSPECIFIED
,

492 
çl£
);

494 
	`why_d–ayed_wÜk_æush
(
loÿl
->
hw
.
why
,

495 &
sd©a
->
dec_room_Ãeded_wk
);

497 
	`›“80211_sÿn_ÿnûl
(
loÿl
);

500 
	`why_d–ayed_wÜk_æush
(
loÿl
->
hw
.
why
, &loÿl->
roc_wÜk
);

501 
	`why_wÜk_æush
(
loÿl
->
hw
.
why
, &loÿl->
hw_roc_dÚe
);

504 
	`synchrÚize_Ãt
();

506 
»t
 = 
	`›“80211_»cÚfig
(
loÿl
);

507 
	`why_uÆock
(
loÿl
->
hw
.
why
);

509 ià(
»t
)

510 
	`cfg80211_shutdown_®l_š‹rçûs
(
loÿl
->
hw
.
why
);

512 
	`¹Æ_uÆock
();

513 
	}
}

515 
	$›“80211_»¡¬t_hw
(
›“80211_hw
 *
hw
)

517 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

519 
	`Œaû_­i_»¡¬t_hw
(
loÿl
);

521 
	`why_šfo
(
hw
->
why
,

525 
	`›“80211_¡İ_queues_by_»asÚ
(
hw
, 
IEEE80211_MAX_QUEUE_MAP
,

526 
IEEE80211_QUEUE_STOP_REASON_SUSPEND
,

527 
çl£
);

533 
loÿl
->
š_»cÚfig
 = 
Œue
;

534 
	`b¬r›r
();

536 
	`queue_wÜk
(
sy¡em_ä“zabË_wq
, &
loÿl
->
»¡¬t_wÜk
);

537 
	}
}

538 
EXPORT_SYMBOL
(
›“80211_»¡¬t_hw
);

540 #ifdeà
CONFIG_INET


541 
	$›“80211_iç_chªged
(
nÙif›r_block
 *
nb
,

542 
d©a
, *
¬g
)

544 
š_içddr
 *
iç
 = 
¬g
;

545 
›“80211_loÿl
 *
loÿl
 =

546 
	`cÚš”_of
(
nb
, 
›“80211_loÿl
,

547 
iç_nÙif›r
);

548 
Ãt_deviû
 *
ndev
 = 
iç
->
iç_dev
->
dev
;

549 
wœ–ess_dev
 *
wdev
 = 
ndev
->
›“80211_±r
;

550 
š_deviû
 *
idev
;

551 
›“80211_sub_if_d©a
 *
sd©a
;

552 
›“80211_vif_cfg
 *
vif_cfg
;

553 
›“80211_if_mªaged
 *
ifmgd
;

554 
c
 = 0;

557 ià(!
wdev
)

558  
NOTIFY_DONE
;

560 ià(
wdev
->
why
 !ğ
loÿl
->
hw
.why || !wdev->
»gi¡”ed
)

561  
NOTIFY_DONE
;

563 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
ndev
);

564 
vif_cfg
 = &
sd©a
->
vif
.
cfg
;

567 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

568  
NOTIFY_DONE
;

570 
idev
 = 
	`__š_dev_g‘_¹Æ
(
sd©a
->
dev
);

571 ià(!
idev
)

572  
NOTIFY_DONE
;

574 
ifmgd
 = &
sd©a
->
u
.
mgd
;

592 
	`mu‹x_lock_Ã¡ed
(&
loÿl
->
hw
.
why
->
mtx
, 1);

593 
	`__acquœe
(&
loÿl
->
hw
.
why
->
mtx
);

596 
iç
 = 
	`¹Æ_d”eã»nû
(
idev
->
iç_li¡
);

597 
iç
) {

598 ià(
c
 < 
IEEE80211_BSS_ARP_ADDR_LIST_LEN
)

599 
vif_cfg
->
¬p_addr_li¡
[
c
] = 
iç
->
iç_add»ss
;

600 
iç
 = 
	`¹Æ_d”eã»nû
(iç->
iç_Ãxt
);

601 
c
++;

604 
vif_cfg
->
¬p_addr_út
 = 
c
;

607 ià(
ifmgd
->
assocŸ‹d
)

608 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_ARP_FILTER
);

610 
	`why_uÆock
(
loÿl
->
hw
.
why
);

612  
NOTIFY_OK
;

613 
	}
}

616 #ià
IS_ENABLED
(
CONFIG_IPV6
)

617 
	$›“80211_iç6_chªged
(
nÙif›r_block
 *
nb
,

618 
d©a
, *
¬g
)

620 
š‘6_içddr
 *
iç
 = (š‘6_içdd¸*)
¬g
;

621 
š‘6_dev
 *
idev
 = 
iç
->idev;

622 
Ãt_deviû
 *
ndev
 = 
iç
->
idev
->
dev
;

623 
›“80211_loÿl
 *
loÿl
 =

624 
	`cÚš”_of
(
nb
, 
›“80211_loÿl
, 
iç6_nÙif›r
);

625 
wœ–ess_dev
 *
wdev
 = 
ndev
->
›“80211_±r
;

626 
›“80211_sub_if_d©a
 *
sd©a
;

629 ià(!
wdev
 || wdev->
why
 !ğ
loÿl
->
hw
.wiphy)

630  
NOTIFY_DONE
;

632 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
ndev
);

638 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

639  
NOTIFY_DONE
;

641 
	`drv_v6_addr_chªge
(
loÿl
, 
sd©a
, 
idev
);

643  
NOTIFY_OK
;

644 
	}
}

648 cÚ¡ 
›“80211_txrx_¡y³s


649 
	g›“80211_deçuÉ_mgmt_¡y³s
[
NUM_NL80211_IFTYPES
] = {

650 [
NL80211_IFTYPE_ADHOC
] = {

651 .
tx
 = 0xffff,

652 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

653 
BIT
(
IEEE80211_STYPE_AUTH
 >> 4) |

654 
BIT
(
IEEE80211_STYPE_DEAUTH
 >> 4) |

655 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4),

657 [
NL80211_IFTYPE_STATION
] = {

658 .
tx
 = 0xffff,

671 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

672 
BIT
(
IEEE80211_STYPE_AUTH
 >> 4) |

673 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4),

675 [
NL80211_IFTYPE_AP
] = {

676 .
tx
 = 0xffff,

677 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ASSOC_REQ
 >> 4) |

678 
BIT
(
IEEE80211_STYPE_REASSOC_REQ
 >> 4) |

679 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4) |

680 
BIT
(
IEEE80211_STYPE_DISASSOC
 >> 4) |

681 
BIT
(
IEEE80211_STYPE_AUTH
 >> 4) |

682 
BIT
(
IEEE80211_STYPE_DEAUTH
 >> 4) |

683 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4),

685 [
NL80211_IFTYPE_AP_VLAN
] = {

687 .
tx
 = 0xffff,

688 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ASSOC_REQ
 >> 4) |

689 
BIT
(
IEEE80211_STYPE_REASSOC_REQ
 >> 4) |

690 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4) |

691 
BIT
(
IEEE80211_STYPE_DISASSOC
 >> 4) |

692 
BIT
(
IEEE80211_STYPE_AUTH
 >> 4) |

693 
BIT
(
IEEE80211_STYPE_DEAUTH
 >> 4) |

694 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4),

696 [
NL80211_IFTYPE_P2P_CLIENT
] = {

697 .
tx
 = 0xffff,

698 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

699 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4),

701 [
NL80211_IFTYPE_P2P_GO
] = {

702 .
tx
 = 0xffff,

703 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ASSOC_REQ
 >> 4) |

704 
BIT
(
IEEE80211_STYPE_REASSOC_REQ
 >> 4) |

705 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4) |

706 
BIT
(
IEEE80211_STYPE_DISASSOC
 >> 4) |

707 
BIT
(
IEEE80211_STYPE_AUTH
 >> 4) |

708 
BIT
(
IEEE80211_STYPE_DEAUTH
 >> 4) |

709 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4),

711 [
NL80211_IFTYPE_MESH_POINT
] = {

712 .
tx
 = 0xffff,

713 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

714 
BIT
(
IEEE80211_STYPE_AUTH
 >> 4) |

715 
BIT
(
IEEE80211_STYPE_DEAUTH
 >> 4),

717 [
NL80211_IFTYPE_P2P_DEVICE
] = {

718 .
tx
 = 0xffff,

719 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

720 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4),

724 cÚ¡ 
›“80211_ht_ÿp
 
	gmac80211_ht_ÿ·_mod_mask
 = {

725 .
ampdu_·¿ms_šfo
 = 
IEEE80211_HT_AMPDU_PARM_FACTOR
 |

726 
IEEE80211_HT_AMPDU_PARM_DENSITY
,

728 .
	gÿp_šfo
 = 
ıu_to_Ë16
(
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

729 
IEEE80211_HT_CAP_MAX_AMSDU
 |

730 
IEEE80211_HT_CAP_SGI_20
 |

731 
IEEE80211_HT_CAP_SGI_40
 |

732 
IEEE80211_HT_CAP_TX_STBC
 |

733 
IEEE80211_HT_CAP_RX_STBC
 |

734 
IEEE80211_HT_CAP_LDPC_CODING
 |

735 
IEEE80211_HT_CAP_40MHZ_INTOLERANT
),

736 .
	gmcs
 = {

737 .
rx_mask
 = { 0xff, 0xff, 0xff, 0xff, 0xff,

742 cÚ¡ 
›“80211_vht_ÿp
 
	gmac80211_vht_ÿ·_mod_mask
 = {

743 .
vht_ÿp_šfo
 =

744 
ıu_to_Ë32
(
IEEE80211_VHT_CAP_RXLDPC
 |

745 
IEEE80211_VHT_CAP_SHORT_GI_80
 |

746 
IEEE80211_VHT_CAP_SHORT_GI_160
 |

747 
IEEE80211_VHT_CAP_RXSTBC_MASK
 |

748 
IEEE80211_VHT_CAP_TXSTBC
 |

749 
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
 |

750 
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
 |

751 
IEEE80211_VHT_CAP_TX_ANTENNA_PATTERN
 |

752 
IEEE80211_VHT_CAP_RX_ANTENNA_PATTERN
 |

753 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
),

754 .
	gsuµ_mcs
 = {

755 .
rx_mcs_m­
 = 
ıu_to_Ë16
(~0),

756 .
	gtx_mcs_m­
 = 
ıu_to_Ë16
(~0),

760 
›“80211_hw
 *
	$›“80211_®loc_hw_nm
(
size_t
 
´iv_d©a_Ën
,

761 cÚ¡ 
›“80211_İs
 *
İs
,

762 cÚ¡ *
»que¡ed_Çme
)

764 
›“80211_loÿl
 *
loÿl
;

765 
´iv_size
, 
i
;

766 
why
 *wiphy;

767 
boŞ
 
emuÏ‹_chªùx
;

769 ià(
	`WARN_ON
(!
İs
->
tx
 || !İs->
¡¬t
 || !İs->
¡İ
 || !İs->
cÚfig
 ||

770 !
İs
->
add_š‹rçû
 || !İs->
»move_š‹rçû
 ||

771 !
İs
->
cÚfigu»_f‹r
 || !İs->
wake_tx_queue
))

772  
NULL
;

774 ià(
	`WARN_ON
(
İs
->
¡a_¡©e
 && (İs->
¡a_add
 || ops->
¡a_»move
)))

775  
NULL
;

777 ià(
	`WARN_ON
(!!
İs
->
lšk_šfo_chªged
 !ğ!!İs->
vif_cfg_chªged
 ||

778 (
İs
->
lšk_šfo_chªged
 && ops->
bss_šfo_chªged
)))

779  
NULL
;

782 ià(
İs
->
add_chªùx
 =ğ
›“80211_emuÏ‹_add_chªùx
 &&

783 
İs
->
»move_chªùx
 =ğ
›“80211_emuÏ‹_»move_chªùx
 &&

784 
İs
->
chªge_chªùx
 =ğ
›“80211_emuÏ‹_chªge_chªùx
) {

785 ià(
	`WARN_ON
(
İs
->
assign_vif_chªùx
 ||

786 
İs
->
uÇssign_vif_chªùx
))

787  
NULL
;

788 
emuÏ‹_chªùx
 = 
Œue
;

790 ià(
	`WARN_ON
(
İs
->
add_chªùx
 =ğ
›“80211_emuÏ‹_add_chªùx
 ||

791 
İs
->
»move_chªùx
 =ğ
›“80211_emuÏ‹_»move_chªùx
 ||

792 
İs
->
chªge_chªùx
 =ğ
›“80211_emuÏ‹_chªge_chªùx
))

793  
NULL
;

794 ià(
	`WARN_ON
(!
İs
->
add_chªùx
 ||

795 !
İs
->
»move_chªùx
 ||

796 !
İs
->
chªge_chªùx
 ||

797 !
İs
->
assign_vif_chªùx
 ||

798 !
İs
->
uÇssign_vif_chªùx
))

799  
NULL
;

800 
emuÏ‹_chªùx
 = 
çl£
;

818 
´iv_size
 = 
	`ALIGN
((*
loÿl
), 
NETDEV_ALIGN
è+ 
´iv_d©a_Ën
;

820 
why
 = 
	`why_Ãw_nm
(&
mac80211_cÚfig_İs
, 
´iv_size
, 
»que¡ed_Çme
);

822 ià(!
why
)

823  
NULL
;

825 
why
->
mgmt_¡y³s
 = 
›“80211_deçuÉ_mgmt_¡y³s
;

827 
why
->
´ivid
 = 
mac80211_why_´ivid
;

829 
why
->
æags
 |ğ
WIPHY_FLAG_NETNS_OK
 |

830 
WIPHY_FLAG_4ADDR_AP
 |

831 
WIPHY_FLAG_4ADDR_STATION
 |

832 
WIPHY_FLAG_REPORTS_OBSS
 |

833 
WIPHY_FLAG_OFFCHAN_TX
;

835 ià(
emuÏ‹_chªùx
 || 
İs
->
»maš_Ú_chªÃl
)

836 
why
->
æags
 |ğ
WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL
;

838 
why
->
ã©u»s
 |ğ
NL80211_FEATURE_SK_TX_STATUS
 |

839 
NL80211_FEATURE_SAE
 |

840 
NL80211_FEATURE_HT_IBSS
 |

841 
NL80211_FEATURE_VIF_TXPOWER
 |

842 
NL80211_FEATURE_MAC_ON_CREATE
 |

843 
NL80211_FEATURE_USERSPACE_MPM
 |

844 
NL80211_FEATURE_FULL_AP_CLIENT_STATE
;

845 
	`why_ext_ã©u»_£t
(
why
, 
NL80211_EXT_FEATURE_FILS_STA
);

846 
	`why_ext_ã©u»_£t
(
why
,

847 
NL80211_EXT_FEATURE_CONTROL_PORT_OVER_NL80211
);

848 
	`why_ext_ã©u»_£t
(
why
,

849 
NL80211_EXT_FEATURE_CONTROL_PORT_NO_PREAUTH
);

850 
	`why_ext_ã©u»_£t
(
why
,

851 
NL80211_EXT_FEATURE_CONTROL_PORT_OVER_NL80211_TX_STATUS
);

852 
	`why_ext_ã©u»_£t
(
why
,

853 
NL80211_EXT_FEATURE_SCAN_FREQ_KHZ
);

854 
	`why_ext_ã©u»_£t
(
why
,

855 
NL80211_EXT_FEATURE_POWERED_ADDR_CHANGE
);

857 ià(!
İs
->
hw_sÿn
) {

858 
why
->
ã©u»s
 |ğ
NL80211_FEATURE_LOW_PRIORITY_SCAN
 |

859 
NL80211_FEATURE_AP_SCAN
;

865 
	`why_ext_ã©u»_£t
(
why
,

866 
NL80211_EXT_FEATURE_SCAN_RANDOM_SN
);

867 
	`why_ext_ã©u»_£t
(
why
,

868 
NL80211_EXT_FEATURE_SCAN_MIN_PREQ_CONTENT
);

871 ià(!
İs
->
£t_key
) {

872 
why
->
æags
 |ğ
WIPHY_FLAG_IBSS_RSN
;

873 
	`why_ext_ã©u»_£t
(
why
,

874 
NL80211_EXT_FEATURE_SPP_AMSDU_SUPPORT
);

877 
	`why_ext_ã©u»_£t
(
why
, 
NL80211_EXT_FEATURE_TXQS
);

878 
	`why_ext_ã©u»_£t
(
why
, 
NL80211_EXT_FEATURE_RRM
);

880 
why
->
bss_´iv_size
 = (
›“80211_bss
);

882 
loÿl
 = 
	`why_´iv
(
why
);

884 ià(
	`¡a_šfo_š™
(
loÿl
))

885 
”r_ä“
;

887 
loÿl
->
hw
.
why
 = wiphy;

889 
loÿl
->
hw
.
´iv
 = (*îoÿÈ+ 
	`ALIGN
((*loÿl), 
NETDEV_ALIGN
);

891 
loÿl
->
İs
 = ops;

892 
loÿl
->
emuÏ‹_chªùx
 =ƒmulate_chanctx;

894 ià(
emuÏ‹_chªùx
)

895 
	`›“80211_hw_£t
(&
loÿl
->
hw
, 
CHANCTX_STA_CSA
);

907 
loÿl
->
hw
.
tx_sk_·cšg_shiá
 = 7;

910 
loÿl
->
hw
.
queues
 = 1;

911 
loÿl
->
hw
.
max_¿‹s
 = 1;

912 
loÿl
->
hw
.
max_»pÜt_¿‹s
 = 0;

913 
loÿl
->
hw
.
max_rx_agg»g©iÚ_subäames
 = 
IEEE80211_MAX_AMPDU_BUF_HT
;

914 
loÿl
->
hw
.
max_tx_agg»g©iÚ_subäames
 = 
IEEE80211_MAX_AMPDU_BUF_HT
;

915 
loÿl
->
hw
.
offchªÃl_tx_hw_queue
 = 
IEEE80211_INVAL_HW_QUEUE
;

916 
loÿl
->
hw
.
cÚf
.
lÚg_äame_max_tx_couÁ
 = 
why
->
»Œy_lÚg
;

917 
loÿl
->
hw
.
cÚf
.
shÜt_äame_max_tx_couÁ
 = 
why
->
»Œy_shÜt
;

918 
loÿl
->
hw
.
¿diÙ­_mcs_d‘as
 = 
IEEE80211_RADIOTAP_MCS_HAVE_MCS
 |

919 
IEEE80211_RADIOTAP_MCS_HAVE_GI
 |

920 
IEEE80211_RADIOTAP_MCS_HAVE_BW
;

921 
loÿl
->
hw
.
¿diÙ­_vht_d‘as
 = 
IEEE80211_RADIOTAP_VHT_KNOWN_GI
 |

922 
IEEE80211_RADIOTAP_VHT_KNOWN_BANDWIDTH
;

923 
loÿl
->
hw
.
u­sd_queues
 = 
IEEE80211_DEFAULT_UAPSD_QUEUES
;

924 
loÿl
->
hw
.
u­sd_max_¥_Ën
 = 
IEEE80211_DEFAULT_MAX_SP_LEN
;

925 
loÿl
->
hw
.
max_mtu
 = 
IEEE80211_MAX_DATA_LEN
;

926 
loÿl
->
u£r_pow”_Ëv–
 = 
IEEE80211_UNSET_POWER_LEVEL
;

927 
why
->
ht_ÿ·_mod_mask
 = &
mac80211_ht_ÿ·_mod_mask
;

928 
why
->
vht_ÿ·_mod_mask
 = &
mac80211_vht_ÿ·_mod_mask
;

930 
loÿl
->
ext_ÿ·
[7] = 
WLAN_EXT_CAPA8_OPMODE_NOTIF
;

932 
why
->
ex‹nded_ÿ·b™›s
 = 
loÿl
->
ext_ÿ·
;

933 
why
->
ex‹nded_ÿ·b™›s_mask
 = 
loÿl
->
ext_ÿ·
;

934 
why
->
ex‹nded_ÿ·b™›s_Ën
 =

935 
	`ARRAY_SIZE
(
loÿl
->
ext_ÿ·
);

937 
	`INIT_LIST_HEAD
(&
loÿl
->
š‹rçûs
);

938 
	`INIT_LIST_HEAD
(&
loÿl
->
mÚ_li¡
);

940 
	`__hw_addr_š™
(&
loÿl
->
mc_li¡
);

942 
	`mu‹x_š™
(&
loÿl
->
iæi¡_mtx
);

943 
	`¥š_lock_š™
(&
loÿl
->
f‹r_lock
);

944 
	`¥š_lock_š™
(&
loÿl
->
rx_·th_lock
);

945 
	`¥š_lock_š™
(&
loÿl
->
queue_¡İ_»asÚ_lock
);

947 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

948 
	`INIT_LIST_HEAD
(&
loÿl
->
aùive_txqs
[
i
]);

949 
	`¥š_lock_š™
(&
loÿl
->
aùive_txq_lock
[
i
]);

950 
loÿl
->
aql_txq_lim™_low
[
i
] = 
IEEE80211_DEFAULT_AQL_TXQ_LIMIT_L
;

951 
loÿl
->
aql_txq_lim™_high
[
i
] =

952 
IEEE80211_DEFAULT_AQL_TXQ_LIMIT_H
;

953 
	`©omic_£t
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
i
], 0);

956 
loÿl
->
aœtime_æags
 = 
AIRTIME_USE_TX
 | 
AIRTIME_USE_RX
;

957 
loÿl
->
aql_th»shŞd
 = 
IEEE80211_AQL_THRESHOLD
;

958 
	`©omic_£t
(&
loÿl
->
aql_tÙ®_³ndšg_aœtime
, 0);

960 
	`¥š_lock_š™
(&
loÿl
->
hªdË_wake_tx_queue_lock
);

962 
	`INIT_LIST_HEAD
(&
loÿl
->
chªùx_li¡
);

964 
	`why_d–ayed_wÜk_š™
(&
loÿl
->
sÿn_wÜk
, 
›“80211_sÿn_wÜk
);

966 
	`INIT_WORK
(&
loÿl
->
»¡¬t_wÜk
, 
›“80211_»¡¬t_wÜk
);

968 
	`why_wÜk_š™
(&
loÿl
->
¿d¬_d‘eùed_wÜk
,

969 
›“80211_dfs_¿d¬_d‘eùed_wÜk
);

971 
	`why_wÜk_š™
(&
loÿl
->
»cÚfig_f‹r
, 
›“80211_»cÚfig_f‹r
);

973 
	`why_wÜk_š™
(&
loÿl
->
dyÇmic_ps_’abË_wÜk
,

974 
›“80211_dyÇmic_ps_’abË_wÜk
);

975 
	`why_wÜk_š™
(&
loÿl
->
dyÇmic_ps_di§bË_wÜk
,

976 
›“80211_dyÇmic_ps_di§bË_wÜk
);

977 
	`tim”_£tup
(&
loÿl
->
dyÇmic_ps_tim”
, 
›“80211_dyÇmic_ps_tim”
, 0);

979 
	`why_wÜk_š™
(&
loÿl
->
sched_sÿn_¡İ³d_wÜk
,

980 
›“80211_sched_sÿn_¡İ³d_wÜk
);

982 
	`¥š_lock_š™
(&
loÿl
->
ack_¡©us_lock
);

983 
	`idr_š™
(&
loÿl
->
ack_¡©us_äames
);

985 
i
 = 0; i < 
IEEE80211_MAX_QUEUES
; i++) {

986 
	`skb_queue_h—d_š™
(&
loÿl
->
³ndšg
[
i
]);

987 
	`©omic_£t
(&
loÿl
->
agg_queue_¡İ
[
i
], 0);

989 
	`skËt_£tup
(&
loÿl
->
tx_³ndšg_skËt
, 
›“80211_tx_³ndšg
);

990 
	`skËt_£tup
(&
loÿl
->
wake_txqs_skËt
, 
›“80211_wake_txqs
);

991 
	`skËt_£tup
(&
loÿl
->
skËt
, 
›“80211_skËt_hªdËr
);

993 
	`skb_queue_h—d_š™
(&
loÿl
->
skb_queue
);

994 
	`skb_queue_h—d_š™
(&
loÿl
->
skb_queue_uÄ–ŸbË
);

996 
	`›“80211_®loc_Ëd_Çmes
(
loÿl
);

998 
	`›“80211_roc_£tup
(
loÿl
);

1000 
loÿl
->
hw
.
¿diÙ­_time¡amp
.
un™s_pos
 = -1;

1001 
loÿl
->
hw
.
¿diÙ­_time¡amp
.
accu¿cy
 = -1;

1003  &
loÿl
->
hw
;

1004 
”r_ä“
:

1005 
	`why_ä“
(
why
);

1006  
NULL
;

1007 
	}
}

1008 
EXPORT_SYMBOL
(
›“80211_®loc_hw_nm
);

1010 
	$›“80211_š™_ch”_su™es
(
›“80211_loÿl
 *
loÿl
)

1012 
boŞ
 
have_w•
 = !
fs_’abËd
;

1013 
boŞ
 
have_må
 = 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
MFP_CAPABLE
);

1014 
r
 = 0, 
w
 = 0;

1015 
u32
 *
su™es
;

1016 cÚ¡ 
u32
 
ch”_su™es
[] = {

1018 
WLAN_CIPHER_SUITE_WEP40
,

1019 
WLAN_CIPHER_SUITE_WEP104
,

1020 
WLAN_CIPHER_SUITE_TKIP
,

1021 
WLAN_CIPHER_SUITE_CCMP
,

1022 
WLAN_CIPHER_SUITE_CCMP_256
,

1023 
WLAN_CIPHER_SUITE_GCMP
,

1024 
WLAN_CIPHER_SUITE_GCMP_256
,

1027 
WLAN_CIPHER_SUITE_AES_CMAC
,

1028 
WLAN_CIPHER_SUITE_BIP_CMAC_256
,

1029 
WLAN_CIPHER_SUITE_BIP_GMAC_128
,

1030 
WLAN_CIPHER_SUITE_BIP_GMAC_256
,

1033 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SW_CRYPTO_CONTROL
) ||

1034 
loÿl
->
hw
.
why
->
ch”_su™es
) {

1038 ià(
have_w•
)

1042 ià(!
loÿl
->
hw
.
why
->
n_ch”_su™es
)

1046 
su™es
 = 
	`kmemdup
(
loÿl
->
hw
.
why
->
ch”_su™es
,

1047 (
u32
è* 
loÿl
->
hw
.
why
->
n_ch”_su™es
,

1048 
GFP_KERNEL
);

1049 ià(!
su™es
)

1050  -
ENOMEM
;

1052 
r
 = 0;„ < 
loÿl
->
hw
.
why
->
n_ch”_su™es
;„++) {

1053 
u32
 
su™e
 = 
loÿl
->
hw
.
why
->
ch”_su™es
[
r
];

1055 ià(
su™e
 =ğ
WLAN_CIPHER_SUITE_WEP40
 ||

1056 
su™e
 =ğ
WLAN_CIPHER_SUITE_WEP104
)

1058 
su™es
[
w
++] = 
su™e
;

1064 
loÿl
->
hw
.
why
->
ch”_su™es
 = cipher_suites;

1065 
loÿl
->
hw
.
why
->
n_ch”_su™es
 = 
	`ARRAY_SIZE
(
ch”_su™es
);

1067 ià(!
have_må
)

1068 
loÿl
->
hw
.
why
->
n_ch”_su™es
 -= 4;

1070 ià(!
have_w•
) {

1071 
loÿl
->
hw
.
why
->
ch”_su™es
 += 2;

1072 
loÿl
->
hw
.
why
->
n_ch”_su™es
 -= 2;

1079 
loÿl
->
hw
.
why
->
ch”_su™es
 = 
su™es
;

1080 
loÿl
->
hw
.
why
->
n_ch”_su™es
 = 
w
;

1081 
loÿl
->
why_ch”s_®loÿ‹d
 = 
Œue
;

1084 
	}
}

1086 
	$›“80211_»gi¡”_hw
(
›“80211_hw
 *
hw
)

1088 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1089 
»suÉ
, 
i
;

1090 
Æ80211_bªd
 
bªd
;

1091 
chªÃls
, 
max_b™¿‹s
;

1092 
boŞ
 
suµ_ht
, 
suµ_vht
, 
suµ_he
, 
suµ_eht
;

1093 
cfg80211_chª_def
 
dæt_chªdef
 = {};

1095 ià(
	`›“80211_hw_check
(
hw
, 
QUEUE_CONTROL
) &&

1096 (
loÿl
->
hw
.
offchªÃl_tx_hw_queue
 =ğ
IEEE80211_INVAL_HW_QUEUE
 ||

1097 
loÿl
->
hw
.
offchªÃl_tx_hw_queue
 >ğloÿl->hw.
queues
))

1098  -
EINVAL
;

1100 ià((
hw
->
why
->
ã©u»s
 & 
NL80211_FEATURE_TDLS_CHANNEL_SWITCH
) &&

1101 (!
loÿl
->
İs
->
tdls_chªÃl_sw™ch
 ||

1102 !
loÿl
->
İs
->
tdls_ÿnûl_chªÃl_sw™ch
 ||

1103 !
loÿl
->
İs
->
tdls_»cv_chªÃl_sw™ch
))

1104  -
EOPNOTSUPP
;

1106 ià(
	`WARN_ON
(
	`›“80211_hw_check
(
hw
, 
SUPPORTS_TX_FRAG
) &&

1107 !
loÿl
->
İs
->
£t_äag_th»shŞd
))

1108  -
EINVAL
;

1110 ià(
	`WARN_ON
(
loÿl
->
hw
.
why
->
š‹rçû_modes
 &

1111 
	`BIT
(
NL80211_IFTYPE_NAN
) &&

1112 (!
loÿl
->
İs
->
¡¬t_Çn
 || !loÿl->İs->
¡İ_Çn
)))

1113  -
EINVAL
;

1115 ià(
hw
->
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_MLO
) {

1122 ià(
	`WARN_ON
(
loÿl
->
emuÏ‹_chªùx
))

1123  -
EINVAL
;

1125 ià(
	`WARN_ON
(!
loÿl
->
İs
->
lšk_šfo_chªged
))

1126  -
EINVAL
;

1128 ià(
	`WARN_ON
(!
	`›“80211_hw_check
(
hw
, 
HAS_RATE_CONTROL
)))

1129  -
EINVAL
;

1131 ià(
	`WARN_ON
(!
	`›“80211_hw_check
(
hw
, 
AMPDU_AGGREGATION
)))

1132  -
EINVAL
;

1134 ià(
	`WARN_ON
(
	`›“80211_hw_check
(
hw
, 
HOST_BROADCAST_PS_BUFFERING
)))

1135  -
EINVAL
;

1137 ià(
	`WARN_ON
(
	`›“80211_hw_check
(
hw
, 
SUPPORTS_PS
) &&

1138 (!
	`›“80211_hw_check
(
hw
, 
SUPPORTS_DYNAMIC_PS
) ||

1139 
	`›“80211_hw_check
(
hw
, 
PS_NULLFUNC_STACK
))))

1140  -
EINVAL
;

1142 ià(
	`WARN_ON
(!
	`›“80211_hw_check
(
hw
, 
MFP_CAPABLE
)))

1143  -
EINVAL
;

1145 ià(
	`WARN_ON
(!
	`›“80211_hw_check
(
hw
, 
CONNECTION_MONITOR
)))

1146  -
EINVAL
;

1148 ià(
	`WARN_ON
(
	`›“80211_hw_check
(
hw
, 
NEED_DTIM_BEFORE_ASSOC
)))

1149  -
EINVAL
;

1151 ià(
	`WARN_ON
(
	`›“80211_hw_check
(
hw
, 
TIMING_BEACON_ONLY
)))

1152  -
EINVAL
;

1154 ià(
	`WARN_ON
(!
	`›“80211_hw_check
(
hw
, 
AP_LINK_PS
)))

1155  -
EINVAL
;

1157 ià(
	`WARN_ON
(
	`›“80211_hw_check
(
hw
, 
DEAUTH_NEED_MGD_TX_PREP
)))

1158  -
EINVAL
;

1161 #ifdeà
CONFIG_PM


1162 ià(
hw
->
why
->
wowÏn
 && (!
loÿl
->
İs
->
su¥’d
 || !loÿl->İs->
»sume
))

1163  -
EINVAL
;

1166 ià(
loÿl
->
emuÏ‹_chªùx
) {

1167 
i
 = 0; i < 
loÿl
->
hw
.
why
->
n_içû_combš©iÚs
; i++) {

1168 cÚ¡ 
›“80211_içû_combš©iÚ
 *
comb
;

1170 
comb
 = &
loÿl
->
hw
.
why
->
içû_combš©iÚs
[
i
];

1172 ià(
comb
->
num_difã»Á_chªÃls
 > 1)

1173  -
EINVAL
;

1177 
i
 = 0; i < 
loÿl
->
hw
.
why
->
n_içû_combš©iÚs
; i++) {

1178 cÚ¡ 
›“80211_içû_combš©iÚ
 *
comb
;

1180 
comb
 = &
loÿl
->
hw
.
why
->
içû_combš©iÚs
[
i
];

1182 ià(
comb
->
¿d¬_d‘eù_widths
 &&

1183 
comb
->
num_difã»Á_chªÃls
 > 1)

1184  -
EINVAL
;

1189 ià(
	`WARN_ON
(
hw
->
Ãtdev_ã©u»s
 & ~
MAC80211_SUPPORTED_FEATURES
))

1190  -
EINVAL
;

1192 ià(
hw
->
max_»pÜt_¿‹s
 == 0)

1193 
hw
->
max_»pÜt_¿‹s
 = hw->
max_¿‹s
;

1195 
loÿl
->
rx_chašs
 = 1;

1202 
chªÃls
 = 0;

1203 
max_b™¿‹s
 = 0;

1204 
suµ_ht
 = 
çl£
;

1205 
suµ_vht
 = 
çl£
;

1206 
suµ_he
 = 
çl£
;

1207 
suµ_eht
 = 
çl£
;

1208 
bªd
 = 0; bªd < 
NUM_NL80211_BANDS
; band++) {

1209 cÚ¡ 
›“80211_sbªd_iáy³_d©a
 *
iád
;

1210 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1212 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1213 ià(!
sbªd
)

1216 ià(!
dæt_chªdef
.
chª
) {

1221 
i
 = 0; i < 
sbªd
->
n_chªÃls
; i++)

1222 ià(!(
sbªd
->
chªÃls
[
i
].
æags
 &

1223 
IEEE80211_CHAN_DISABLED
))

1226 ià(
i
 =ğ
sbªd
->
n_chªÃls
)

1227 
i
 = 0;

1228 
	`cfg80211_chªdef_ü—‹
(&
dæt_chªdef
,

1229 &
sbªd
->
chªÃls
[
i
],

1230 
NL80211_CHAN_NO_HT
);

1232 
loÿl
->
mÚ™Ü_chª»q
.
İ”
 = 
dæt_chªdef
;

1233 ià(
loÿl
->
emuÏ‹_chªùx
) {

1234 
loÿl
->
dæt_chªdef
 = dflt_chandef;

1235 
loÿl
->
hw
.
cÚf
.
chªdef
 = 
dæt_chªdef
;

1239 
chªÃls
 +ğ
sbªd
->
n_chªÃls
;

1246 ià(
	`WARN_ON
(
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
 &&

1247 (
sbªd
->
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_DELAY_BA
) &&

1248 
hw
->
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_MLO
))

1249  -
EINVAL
;

1251 ià(
max_b™¿‹s
 < 
sbªd
->
n_b™¿‹s
)

1252 
max_b™¿‹s
 = 
sbªd
->
n_b™¿‹s
;

1253 
suµ_ht
 = suµ_hˆ|| 
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
;

1254 
suµ_vht
 = suµ_vhˆ|| 
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
;

1256 
	`fÜ_—ch_sbªd_iáy³_d©a
(
sbªd
, 
i
, 
iád
) {

1257 
u8
 
he_40_mhz_ÿp
;

1259 
suµ_he
 = suµ_h|| 
iád
->
he_ÿp
.
has_he
;

1260 
suµ_eht
 = suµ_ehˆ|| 
iád
->
eht_ÿp
.
has_eht
;

1262 ià(
bªd
 =ğ
NL80211_BAND_2GHZ
)

1263 
he_40_mhz_ÿp
 =

1264 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
;

1266 
he_40_mhz_ÿp
 =

1267 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_80MHZ_IN_5G
;

1270 ià(
iád
->
he_ÿp
.
has_he
 &&

1271 
iád
->
ty³s_mask
 & (
	`BIT
(
NL80211_IFTYPE_STATION
) |

1272 
	`BIT
(
NL80211_IFTYPE_P2P_CLIENT
)) &&

1273 
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
 &&

1274 
sbªd
->
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 &&

1275 !(
iád
->
he_ÿp
.
he_ÿp_–em
.
phy_ÿp_šfo
[0] & 
he_40_mhz_ÿp
))

1276  -
EINVAL
;

1280 ià(
	`WARN_ON
(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
 &&

1281 (
suµ_ht
 || 
suµ_vht
 || 
suµ_he
)))

1282  -
EINVAL
;

1285 ià(
	`WARN_ON
(
suµ_eht
 && !
suµ_he
))

1286  -
EINVAL
;

1288 ià(!
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
)

1292 
loÿl
->
rx_chašs
 =

1293 
	`max
(
	`›“80211_mcs_to_chašs
(&
sbªd
->
ht_ÿp
.
mcs
),

1294 
loÿl
->
rx_chašs
);

1297 
sbªd
->
ht_ÿp
.
ÿp
 |ğ
WLAN_HT_CAP_SM_PS_DISABLED
 <<

1298 
IEEE80211_HT_CAP_SM_PS_SHIFT
;

1305 ià(
loÿl
->
hw
.
why
->
š‹rçû_modes
 & 
	`BIT
(
NL80211_IFTYPE_AP
) &&

1306 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SW_CRYPTO_CONTROL
)) {

1307 
hw
->
why
->
š‹rçû_modes
 |ğ
	`BIT
(
NL80211_IFTYPE_AP_VLAN
);

1308 
hw
->
why
->
soáw¬e_iáy³s
 |ğ
	`BIT
(
NL80211_IFTYPE_AP_VLAN
);

1312 
hw
->
why
->
š‹rçû_modes
 |ğ
	`BIT
(
NL80211_IFTYPE_MONITOR
);

1313 
hw
->
why
->
soáw¬e_iáy³s
 |ğ
	`BIT
(
NL80211_IFTYPE_MONITOR
);

1316 
i
 = 0; i < 
hw
->
why
->
n_içû_combš©iÚs
; i++) {

1317 cÚ¡ 
›“80211_içû_combš©iÚ
 *
c
;

1318 
j
;

1320 
c
 = &
hw
->
why
->
içû_combš©iÚs
[
i
];

1322 
j
 = 0; j < 
c
->
n_lim™s
; j++)

1323 ià((
c
->
lim™s
[
j
].
ty³s
 & 
	`BIT
(
NL80211_IFTYPE_ADHOC
)) &&

1324 
c
->
lim™s
[
j
].
max
 > 1)

1325  -
EINVAL
;

1328 
loÿl
->
št_sÿn_»q
 = 
	`kz®loc
((*local->int_scan_req) +

1329 (*è* 
chªÃls
, 
GFP_KERNEL
);

1330 ià(!
loÿl
->
št_sÿn_»q
)

1331  -
ENOMEM
;

1333 
	`‘h_brßdÿ¡_addr
(
loÿl
->
št_sÿn_»q
->
bssid
);

1335 
bªd
 = 0; bªd < 
NUM_NL80211_BANDS
; band++) {

1336 ià(!
loÿl
->
hw
.
why
->
bªds
[
bªd
])

1338 
loÿl
->
št_sÿn_»q
->
¿‹s
[
bªd
] = (
u32
) -1;

1341 #iâdeà
CONFIG_MAC80211_MESH


1343 
loÿl
->
hw
.
why
->
š‹rçû_modes
 &ğ~
	`BIT
(
NL80211_IFTYPE_MESH_POINT
);

1348 ià(
loÿl
->
hw
.
why
->
š‹rçû_modes
 & 
	`BIT
(
NL80211_IFTYPE_MESH_POINT
))

1349 
loÿl
->
hw
.
why
->
æags
 |ğ
WIPHY_FLAG_MESH_AUTH
;

1352 
loÿl
->
hw
.
why
->
æags
 |ğ
WIPHY_FLAG_CONTROL_PORT_PROTOCOL
;

1354 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SIGNAL_DBM
)) {

1355 
loÿl
->
hw
.
why
->
sigÇl_ty³
 = 
CFG80211_SIGNAL_TYPE_MBM
;

1356 } ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SIGNAL_UNSPEC
)) {

1357 
loÿl
->
hw
.
why
->
sigÇl_ty³
 = 
CFG80211_SIGNAL_TYPE_UNSPEC
;

1358 ià(
hw
->
max_sigÇl
 <= 0) {

1359 
»suÉ
 = -
EINVAL
;

1360 
ç_wÜkqueue
;

1367 ià(!
loÿl
->
İs
->
£t_key
) {

1368 
	`why_ext_ã©u»_£t
(
loÿl
->
hw
.
why
,

1369 
NL80211_EXT_FEATURE_CAN_REPLACE_PTK0
);

1370 
	`why_ext_ã©u»_£t
(
loÿl
->
hw
.
why
,

1371 
NL80211_EXT_FEATURE_EXT_KEY_ID
);

1374 ià(
loÿl
->
hw
.
why
->
š‹rçû_modes
 & 
	`BIT
(
NL80211_IFTYPE_ADHOC
))

1375 
	`why_ext_ã©u»_£t
(
loÿl
->
hw
.
why
,

1376 
NL80211_EXT_FEATURE_DEL_IBSS_STA
);

1384 
loÿl
->
sÿn_›s_Ën
 = 4 + 
max_b™¿‹s
 +

1386 ià(
suµ_ht
)

1387 
loÿl
->
sÿn_›s_Ën
 +ğ2 + (
›“80211_ht_ÿp
);

1389 ià(
suµ_vht
)

1390 
loÿl
->
sÿn_›s_Ën
 +=

1391 2 + (
›“80211_vht_ÿp
);

1395 ià(
suµ_he
) {

1396 
loÿl
->
sÿn_›s_Ën
 +=

1397 3 + (
›“80211_he_ÿp_–em
) +

1398 (
›“80211_he_mcs_nss_suµ
) +

1399 
IEEE80211_HE_PPE_THRES_MAX_LEN
;

1401 ià(
suµ_eht
)

1402 
loÿl
->
sÿn_›s_Ën
 +=

1403 3 + (
›“80211_eht_ÿp_–em
) +

1404 (
›“80211_eht_mcs_nss_suµ
) +

1405 
IEEE80211_EHT_PPE_THRES_MAX_LEN
;

1408 ià(!
loÿl
->
İs
->
hw_sÿn
) {

1410 
loÿl
->
hw
.
why
->
max_sÿn_ssids
 = 4;

1411 
loÿl
->
hw
.
why
->
max_sÿn_›_Ën
 = 
IEEE80211_MAX_DATA_LEN
;

1421 ià(
loÿl
->
hw
.
why
->
max_sÿn_›_Ën
)

1422 
loÿl
->
hw
.
why
->
max_sÿn_›_Ën
 -ğloÿl->
sÿn_›s_Ën
;

1424 
»suÉ
 = 
	`›“80211_š™_ch”_su™es
(
loÿl
);

1425 ià(
»suÉ
 < 0)

1426 
ç_wÜkqueue
;

1428 ià(!
loÿl
->
İs
->
»maš_Ú_chªÃl
)

1429 
loÿl
->
hw
.
why
->
max_»maš_Ú_chªÃl_du¿tiÚ
 = 5000;

1432 ià(
loÿl
->
hw
.
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_TDLS
)

1433 
loÿl
->
hw
.
why
->
æags
 |ğ
WIPHY_FLAG_TDLS_EXTERNAL_SETUP
;

1436 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
CHANCTX_STA_CSA
))

1437 
loÿl
->
ext_ÿ·
[0] |ğ
WLAN_EXT_CAPA1_EXT_CHANNEL_SWITCHING
;

1440 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_MULTI_BSSID
)) {

1441 
loÿl
->
hw
.
why
->
suµÜt_mbssid
 = 
Œue
;

1442 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
,

1443 
SUPPORTS_ONLY_HE_MULTI_BSSID
))

1444 
loÿl
->
hw
.
why
->
suµÜt_Úly_he_mbssid
 = 
Œue
;

1446 
loÿl
->
ext_ÿ·
[2] |=

1447 
WLAN_EXT_CAPA3_MULTI_BSSID_SUPPORT
;

1450 
loÿl
->
hw
.
why
->
max_num_c§_couÁ”s
 = 
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
;

1456 ià(
hw
->
queues
 > 
IEEE80211_MAX_QUEUES
)

1457 
hw
->
queues
 = 
IEEE80211_MAX_QUEUES
;

1459 
loÿl
->
wÜkqueue
 =

1460 
	`®loc_Üd”ed_wÜkqueue
("%s", 0, 
	`why_Çme
(
loÿl
->
hw
.
why
));

1461 ià(!
loÿl
->
wÜkqueue
) {

1462 
»suÉ
 = -
ENOMEM
;

1463 
ç_wÜkqueue
;

1471 
loÿl
->
tx_h—droom
 = 
	`max_t
(,†oÿl->
hw
.
exŒa_tx_h—droom
,

1472 
IEEE80211_TX_STATUS_HEADROOM
);

1478 ià(
loÿl
->
hw
.
max_li¡’_š‹rv®
 == 0)

1479 
loÿl
->
hw
.
max_li¡’_š‹rv®
 = 5;

1481 
loÿl
->
hw
.
cÚf
.
li¡’_š‹rv®
 =†oÿl->hw.
max_li¡’_š‹rv®
;

1483 
loÿl
->
dyÇmic_ps_fÜûd_timeout
 = -1;

1485 ià(!
loÿl
->
hw
.
max_Çn_de_’Œ›s
)

1486 
loÿl
->
hw
.
max_Çn_de_’Œ›s
 = 
IEEE80211_MAX_NAN_INSTANCE_ID
;

1488 ià(!
loÿl
->
hw
.
weight_muÉl›r
)

1489 
loÿl
->
hw
.
weight_muÉl›r
 = 1;

1491 
	`›“80211_w•_š™
(
loÿl
);

1493 
loÿl
->
hw
.
cÚf
.
æags
 = 
IEEE80211_CONF_IDLE
;

1495 
	`›“80211_Ëd_š™
(
loÿl
);

1497 
»suÉ
 = 
	`›“80211_txq_£tup_æows
(
loÿl
);

1498 ià(
»suÉ
)

1499 
ç_æows
;

1501 
	`¹Æ_lock
();

1502 
»suÉ
 = 
	`›“80211_š™_¿‹_ù¾_®g
(
loÿl
,

1503 
hw
->
¿‹_cÚŒŞ_®gÜ™hm
);

1504 
	`¹Æ_uÆock
();

1505 ià(
»suÉ
 < 0) {

1506 
	`why_debug
(
loÿl
->
hw
.
why
,

1508 
ç_¿‹
;

1511 ià(
loÿl
->
¿‹_ù¾
) {

1512 
	`ş—r_b™
(
IEEE80211_HW_SUPPORTS_VHT_EXT_NSS_BW
, 
hw
->
æags
);

1513 ià(
loÿl
->
¿‹_ù¾
->
İs
->
ÿ·
 & 
RATE_CTRL_CAPA_VHT_EXT_NSS_BW
)

1514 
	`›“80211_hw_£t
(
hw
, 
SUPPORTS_VHT_EXT_NSS_BW
);

1525 
	`BUILD_BUG_ON
(
NUM_NL80211_BANDS
 > 8 * (
loÿl
->
sbªd_®loÿ‹d
));

1526 
bªd
 = 0; bªd < 
NUM_NL80211_BANDS
; band++) {

1527 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1528 
boŞ
 
loÿl_ÿp
, 
›_ÿp
;

1530 
loÿl_ÿp
 = 
	`›“80211_hw_check
(
hw
, 
SUPPORTS_VHT_EXT_NSS_BW
);

1532 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1533 ià(!
sbªd
 || !sbªd->
vht_ÿp
.
vht_suµÜ‹d
)

1536 
›_ÿp
 = !!(
sbªd
->
vht_ÿp
.
vht_mcs
.
tx_highe¡
 &

1537 
	`ıu_to_Ë16
(
IEEE80211_VHT_EXT_NSS_BW_CAPABLE
));

1539 ià(
loÿl_ÿp
 =ğ
›_ÿp
)

1542 
sbªd
 = 
	`kmemdup
(sbªd, (*sbªd), 
GFP_KERNEL
);

1543 ià(!
sbªd
) {

1544 
»suÉ
 = -
ENOMEM
;

1545 
ç_¿‹
;

1548 
	`why_dbg
(
hw
->
why
, "copying sband (band %d) dueo VHT EXT NSS BW flag\n",

1549 
bªd
);

1551 
sbªd
->
vht_ÿp
.
vht_mcs
.
tx_highe¡
 ^=

1552 
	`ıu_to_Ë16
(
IEEE80211_VHT_EXT_NSS_BW_CAPABLE
);

1554 
loÿl
->
hw
.
why
->
bªds
[
bªd
] = 
sbªd
;

1555 
loÿl
->
sbªd_®loÿ‹d
 |ğ
	`BIT
(
bªd
);

1558 
»suÉ
 = 
	`why_»gi¡”
(
loÿl
->
hw
.
why
);

1559 ià(
»suÉ
 < 0)

1560 
ç_why_»gi¡”
;

1562 
	`debugfs_hw_add
(
loÿl
);

1563 
	`¿‹_cÚŒŞ_add_debugfs
(
loÿl
);

1565 
	`›“80211_check_wbrf_suµÜt
(
loÿl
);

1567 
	`¹Æ_lock
();

1568 
	`why_lock
(
hw
->
why
);

1571 ià(
loÿl
->
hw
.
why
->
š‹rçû_modes
 & 
	`BIT
(
NL80211_IFTYPE_STATION
) &&

1572 !
	`›“80211_hw_check
(
hw
, 
NO_AUTO_VIF
)) {

1573 
vif_·¿ms
 
·¿ms
 = {0};

1575 
»suÉ
 = 
	`›“80211_if_add
(
loÿl
, "wÏn%d", 
NET_NAME_ENUM
, 
NULL
,

1576 
NL80211_IFTYPE_STATION
, &
·¿ms
);

1577 ià(
»suÉ
)

1578 
	`why_w¬n
(
loÿl
->
hw
.
why
,

1582 
	`why_uÆock
(
hw
->
why
);

1583 
	`¹Æ_uÆock
();

1585 #ifdeà
CONFIG_INET


1586 
loÿl
->
iç_nÙif›r
.
nÙif›r_ÿÎ
 = 
›“80211_iç_chªged
;

1587 
»suÉ
 = 
	`»gi¡”_š‘addr_nÙif›r
(&
loÿl
->
iç_nÙif›r
);

1588 ià(
»suÉ
)

1589 
ç_iç
;

1592 #ià
	`IS_ENABLED
(
CONFIG_IPV6
)

1593 
loÿl
->
iç6_nÙif›r
.
nÙif›r_ÿÎ
 = 
›“80211_iç6_chªged
;

1594 
»suÉ
 = 
	`»gi¡”_š‘6addr_nÙif›r
(&
loÿl
->
iç6_nÙif›r
);

1595 ià(
»suÉ
)

1596 
ç_iç6
;

1601 #ià
	`IS_ENABLED
(
CONFIG_IPV6
)

1602 
ç_iç6
:

1603 #ifdeà
CONFIG_INET


1604 
	`uÄegi¡”_š‘addr_nÙif›r
(&
loÿl
->
iç_nÙif›r
);

1607 #ià
	`defšed
(
CONFIG_INET
è|| defšed(
CONFIG_IPV6
)

1608 
ç_iç
:

1610 
	`why_uÄegi¡”
(
loÿl
->
hw
.
why
);

1611 
ç_why_»gi¡”
:

1612 
	`¹Æ_lock
();

1613 
	`¿‹_cÚŒŞ_deš™Ÿlize
(
loÿl
);

1614 
	`›“80211_»move_š‹rçûs
(
loÿl
);

1615 
	`¹Æ_uÆock
();

1616 
ç_¿‹
:

1617 
	`›“80211_txq_‹¬down_æows
(
loÿl
);

1618 
ç_æows
:

1619 
	`›“80211_Ëd_ex™
(
loÿl
);

1620 
	`de¡roy_wÜkqueue
(
loÿl
->
wÜkqueue
);

1621 
ç_wÜkqueue
:

1622 ià(
loÿl
->
why_ch”s_®loÿ‹d
) {

1623 
	`kä“
(
loÿl
->
hw
.
why
->
ch”_su™es
);

1624 
loÿl
->
why_ch”s_®loÿ‹d
 = 
çl£
;

1626 
	`kä“
(
loÿl
->
št_sÿn_»q
);

1627  
»suÉ
;

1628 
	}
}

1629 
EXPORT_SYMBOL
(
›“80211_»gi¡”_hw
);

1631 
	$›“80211_uÄegi¡”_hw
(
›“80211_hw
 *
hw
)

1633 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1635 
	`skËt_kl
(&
loÿl
->
tx_³ndšg_skËt
);

1636 
	`skËt_kl
(&
loÿl
->
skËt
);

1638 #ifdeà
CONFIG_INET


1639 
	`uÄegi¡”_š‘addr_nÙif›r
(&
loÿl
->
iç_nÙif›r
);

1641 #ià
	`IS_ENABLED
(
CONFIG_IPV6
)

1642 
	`uÄegi¡”_š‘6addr_nÙif›r
(&
loÿl
->
iç6_nÙif›r
);

1645 
	`¹Æ_lock
();

1652 
	`›“80211_»move_š‹rçûs
(
loÿl
);

1654 
	`›“80211_txq_‹¬down_æows
(
loÿl
);

1656 
	`why_lock
(
loÿl
->
hw
.
why
);

1657 
	`why_d–ayed_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
roc_wÜk
);

1658 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
»cÚfig_f‹r
);

1659 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
sched_sÿn_¡İ³d_wÜk
);

1660 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
¿d¬_d‘eùed_wÜk
);

1661 
	`why_uÆock
(
loÿl
->
hw
.
why
);

1662 
	`¹Æ_uÆock
();

1664 
	`ÿnûl_wÜk_sync
(&
loÿl
->
»¡¬t_wÜk
);

1666 
	`›“80211_ş—r_tx_³ndšg
(
loÿl
);

1667 
	`¿‹_cÚŒŞ_deš™Ÿlize
(
loÿl
);

1669 ià(
	`skb_queue_Ën
(&
loÿl
->
skb_queue
) ||

1670 
	`skb_queue_Ën
(&
loÿl
->
skb_queue_uÄ–ŸbË
))

1671 
	`why_w¬n
(
loÿl
->
hw
.
why
, "skb_queue‚otƒmpty\n");

1672 
	`skb_queue_purge
(&
loÿl
->
skb_queue
);

1673 
	`skb_queue_purge
(&
loÿl
->
skb_queue_uÄ–ŸbË
);

1675 
	`why_uÄegi¡”
(
loÿl
->
hw
.
why
);

1676 
	`de¡roy_wÜkqueue
(
loÿl
->
wÜkqueue
);

1677 
	`›“80211_Ëd_ex™
(
loÿl
);

1678 
	`kä“
(
loÿl
->
št_sÿn_»q
);

1679 
	}
}

1680 
EXPORT_SYMBOL
(
›“80211_uÄegi¡”_hw
);

1682 
	$›“80211_ä“_ack_äame
(
id
, *
p
, *
d©a
)

1684 
	`WARN_ONCE
(1, "Have…ending‡ck frames!\n");

1685 
	`kä“_skb
(
p
);

1687 
	}
}

1689 
	$›“80211_ä“_hw
(
›“80211_hw
 *
hw
)

1691 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1692 
Æ80211_bªd
 
bªd
;

1694 
	`mu‹x_de¡roy
(&
loÿl
->
iæi¡_mtx
);

1696 ià(
loÿl
->
why_ch”s_®loÿ‹d
) {

1697 
	`kä“
(
loÿl
->
hw
.
why
->
ch”_su™es
);

1698 
loÿl
->
why_ch”s_®loÿ‹d
 = 
çl£
;

1701 
	`idr_fÜ_—ch
(&
loÿl
->
ack_¡©us_äames
,

1702 
›“80211_ä“_ack_äame
, 
NULL
);

1703 
	`idr_de¡roy
(&
loÿl
->
ack_¡©us_äames
);

1705 
	`¡a_šfo_¡İ
(
loÿl
);

1707 
	`›“80211_ä“_Ëd_Çmes
(
loÿl
);

1709 
bªd
 = 0; bªd < 
NUM_NL80211_BANDS
; band++) {

1710 ià(!(
loÿl
->
sbªd_®loÿ‹d
 & 
	`BIT
(
bªd
)))

1712 
	`kä“
(
loÿl
->
hw
.
why
->
bªds
[
bªd
]);

1715 
	`why_ä“
(
loÿl
->
hw
.
why
);

1716 
	}
}

1717 
EXPORT_SYMBOL
(
›“80211_ä“_hw
);

1719 cÚ¡ * cÚ¡ 
	gdrİ_»asÚs_mÚ™Ü
[] = {

1720 
	#V
(
x
è#x,

	)

1722 
MAC80211_DROP_REASONS_MONITOR
(
V
)

1725 
drİ_»asÚ_li¡
 
	gdrİ_»asÚ_li¡_mÚ™Ü
 = {

1726 .
»asÚs
 = 
drİ_»asÚs_mÚ™Ü
,

1727 .
	gn_»asÚs
 = 
ARRAY_SIZE
(
drİ_»asÚs_mÚ™Ü
),

1730 cÚ¡ * cÚ¡ 
	gdrİ_»asÚs_unu§bË
[] = {

1732 
MAC80211_DROP_REASONS_UNUSABLE
(
V
)

1733 #undeà
V


1736 
drİ_»asÚ_li¡
 
	gdrİ_»asÚ_li¡_unu§bË
 = {

1737 .
»asÚs
 = 
drİ_»asÚs_unu§bË
,

1738 .
	gn_»asÚs
 = 
ARRAY_SIZE
(
drİ_»asÚs_unu§bË
),

1741 
__š™
 
	$›“80211_š™
()

1743 
sk_buff
 *
skb
;

1744 
»t
;

1746 
	`BUILD_BUG_ON
((
›“80211_tx_šfo
è> (
skb
->
cb
));

1747 
	`BUILD_BUG_ON
(
	`off£tof
(
›“80211_tx_šfo
, 
driv”_d©a
) +

1748 
IEEE80211_TX_INFO_DRIVER_DATA_SIZE
 > (
skb
->
cb
));

1750 
»t
 = 
	`rc80211_mš¡»l_š™
();

1751 ià(
»t
)

1752  
»t
;

1754 
»t
 = 
	`›“80211_içû_š™
();

1755 ià(
»t
)

1756 
”r_Ãtdev
;

1758 
	`drİ_»asÚs_»gi¡”_subsys
(
SKB_DROP_REASON_SUBSYS_MAC80211_MONITOR
,

1759 &
drİ_»asÚ_li¡_mÚ™Ü
);

1760 
	`drİ_»asÚs_»gi¡”_subsys
(
SKB_DROP_REASON_SUBSYS_MAC80211_UNUSABLE
,

1761 &
drİ_»asÚ_li¡_unu§bË
);

1764 
”r_Ãtdev
:

1765 
	`rc80211_mš¡»l_ex™
();

1767  
»t
;

1768 
	}
}

1770 
__ex™
 
	$›“80211_ex™
()

1772 
	`rc80211_mš¡»l_ex™
();

1774 
	`›“80211s_¡İ
();

1776 
	`›“80211_içû_ex™
();

1778 
	`drİ_»asÚs_uÄegi¡”_subsys
(
SKB_DROP_REASON_SUBSYS_MAC80211_MONITOR
);

1779 
	`drİ_»asÚs_uÄegi¡”_subsys
(
SKB_DROP_REASON_SUBSYS_MAC80211_UNUSABLE
);

1781 
	`rcu_b¬r›r
();

1782 
	}
}

1785 
subsys_š™ÿÎ
(
›“80211_š™
);

1786 
moduË_ex™
(
›“80211_ex™
);

1788 
MODULE_DESCRIPTION
("IEEE 802.11 subsystem");

1789 
MODULE_LICENSE
("GPL");

	@mesh.c

9 
	~<lšux/¦ab.h
>

10 
	~<asm/uÇligÃd.h
>

11 
	~"›“80211_i.h
"

12 
	~"mesh.h
"

13 
	~"wme.h
"

14 
	~"driv”-İs.h
"

16 
	gmesh_®loÿ‹d
;

17 
kmem_ÿche
 *
	grm_ÿche
;

19 
boŞ
 
	$mesh_aùiÚ_is_·th_£l
(
›“80211_mgmt
 *
mgmt
)

21  (
mgmt
->
u
.
aùiÚ
.u.
mesh_aùiÚ
.
aùiÚ_code
 ==

22 
WLAN_MESH_ACTION_HWMP_PATH_SELECTION
);

23 
	}
}

25 
	$›“80211s_š™
()

27 
mesh_®loÿ‹d
 = 1;

28 
rm_ÿche
 = 
	`kmem_ÿche_ü—‹
("mesh_rmc", (
rmc_’Œy
),

29 0, 0, 
NULL
);

30 
	}
}

32 
	$›“80211s_¡İ
()

34 ià(!
mesh_®loÿ‹d
)

36 
	`kmem_ÿche_de¡roy
(
rm_ÿche
);

37 
	}
}

39 
	$›“80211_mesh_hou£k“pšg_tim”
(
tim”_li¡
 *
t
)

41 
›“80211_sub_if_d©a
 *
sd©a
 =

42 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
mesh
.
hou£k“pšg_tim”
);

43 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

44 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

46 
	`£t_b™
(
MESH_WORK_HOUSEKEEPING
, &
ifmsh
->
wrkq_æags
);

48 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

49 
	}
}

62 
boŞ
 
	$mesh_m©ches_loÿl
(
›“80211_sub_if_d©a
 *
sd©a
,

63 
›“802_11_–ems
 *
›
)

65 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

66 
u32
 
basic_¿‹s
 = 0;

67 
cfg80211_chª_def
 
¡a_chª_def
;

68 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

69 
u32
 
vht_ÿp_šfo
 = 0;

81 ià(!(
ifmsh
->
mesh_id_Ën
 =ğ
›
->mesh_id_len &&

82 
	`memcmp
(
ifmsh
->
mesh_id
, 
›
->mesh_id, ie->
mesh_id_Ën
) == 0 &&

83 (
ifmsh
->
mesh_µ_id
 =ğ
›
->
mesh_cÚfig
->
meshcÚf_p£l
) &&

84 (
ifmsh
->
mesh_pm_id
 =ğ
›
->
mesh_cÚfig
->
meshcÚf_pm‘ric
) &&

85 (
ifmsh
->
mesh_cc_id
 =ğ
›
->
mesh_cÚfig
->
meshcÚf_cÚge¡
) &&

86 (
ifmsh
->
mesh_¥_id
 =ğ
›
->
mesh_cÚfig
->
meshcÚf_synch
) &&

87 (
ifmsh
->
mesh_auth_id
 =ğ
›
->
mesh_cÚfig
->
meshcÚf_auth
)))

88  
çl£
;

90 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

91 ià(!
sbªd
)

92  
çl£
;

94 
	`›“80211_¡a_g‘_¿‹s
(
sd©a
, 
›
, 
sbªd
->
bªd
,

95 &
basic_¿‹s
);

97 ià(
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
 != basic_rates)

98  
çl£
;

100 
	`cfg80211_chªdef_ü—‹
(&
¡a_chª_def
, 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
,

101 
NL80211_CHAN_NO_HT
);

102 
	`›“80211_chªdef_ht_İ”
(
›
->
ht_İ”©iÚ
, &
¡a_chª_def
);

104 ià(
›
->
vht_ÿp_–em
)

105 
vht_ÿp_šfo
 = 
	`Ë32_to_ıu
(
›
->
vht_ÿp_–em
->vht_cap_info);

107 
	`›“80211_chªdef_vht_İ”
(&
sd©a
->
loÿl
->
hw
, 
vht_ÿp_šfo
,

108 
›
->
vht_İ”©iÚ
, ie->
ht_İ”©iÚ
,

109 &
¡a_chª_def
);

110 
	`›“80211_chªdef_he_6ghz_İ”
(
sd©a
->
loÿl
, 
›
->
he_İ”©iÚ
,

111 
›
->
eht_İ”©iÚ
,

112 &
¡a_chª_def
);

114 ià(!
	`cfg80211_chªdef_com·tibË
(&
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
,

115 &
¡a_chª_def
))

116  
çl£
;

118  
Œue
;

119 
	}
}

128 
boŞ
 
	$mesh_³”_acû±s_¶šks
(
›“802_11_–ems
 *
›
)

130  (
›
->
mesh_cÚfig
->
meshcÚf_ÿp
 &

131 
IEEE80211_MESHCONF_CAPAB_ACCEPT_PLINKS
) != 0;

132 
	}
}

141 
u64
 
	$mesh_acû±_¶šks_upd©e
(
›“80211_sub_if_d©a
 *
sd©a
)

143 
boŞ
 
ä“_¶šks
;

144 
u64
 
chªged
 = 0;

152 
ä“_¶šks
 = 
	`mesh_¶šk_avaabËs
(
sd©a
);

154 ià(
ä“_¶šks
 !ğ
sd©a
->
u
.
mesh
.
acû±šg_¶šks
) {

155 
sd©a
->
u
.
mesh
.
acû±šg_¶šks
 = 
ä“_¶šks
;

156 
chªged
 = 
BSS_CHANGED_BEACON
;

159  
chªged
;

160 
	}
}

167 
	$mesh_¡a_ş—nup
(
¡a_šfo
 *
¡a
)

169 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

170 
u64
 
chªged
 = 
	`mesh_¶šk_d—ùiv©e
(
¡a
);

172 ià(
chªged
)

173 
	`›“80211_mbss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

174 
	}
}

176 
	$mesh_rmc_š™
(
›“80211_sub_if_d©a
 *
sd©a
)

178 
i
;

180 
sd©a
->
u
.
mesh
.
rmc
 = 
	`km®loc
((
mesh_rmc
), 
GFP_KERNEL
);

181 ià(!
sd©a
->
u
.
mesh
.
rmc
)

182  -
ENOMEM
;

183 
sd©a
->
u
.
mesh
.
rmc
->
idx_mask
 = 
RMC_BUCKETS
 - 1;

184 
i
 = 0; i < 
RMC_BUCKETS
; i++)

185 
	`INIT_HLIST_HEAD
(&
sd©a
->
u
.
mesh
.
rmc
->
buck‘
[
i
]);

187 
	}
}

189 
	$mesh_rmc_ä“
(
›“80211_sub_if_d©a
 *
sd©a
)

191 
mesh_rmc
 *
rmc
 = 
sd©a
->
u
.
mesh
.rmc;

192 
rmc_’Œy
 *
p
;

193 
hli¡_node
 *
n
;

194 
i
;

196 ià(!
sd©a
->
u
.
mesh
.
rmc
)

199 
i
 = 0; i < 
RMC_BUCKETS
; i++) {

200 
	`hli¡_fÜ_—ch_’Œy_§ã
(
p
, 
n
, &
rmc
->
buck‘
[
i
], 
li¡
) {

201 
	`hli¡_d–
(&
p
->
li¡
);

202 
	`kmem_ÿche_ä“
(
rm_ÿche
, 
p
);

206 
	`kä“
(
rmc
);

207 
sd©a
->
u
.
mesh
.
rmc
 = 
NULL
;

208 
	}
}

223 
	$mesh_rmc_check
(
›“80211_sub_if_d©a
 *
sd©a
,

224 cÚ¡ 
u8
 *
§
, 
›“80211s_hdr
 *
mesh_hdr
)

226 
mesh_rmc
 *
rmc
 = 
sd©a
->
u
.
mesh
.rmc;

227 
u32
 
£qnum
 = 0;

228 
’Œ›s
 = 0;

229 
u8
 
idx
;

230 
rmc_’Œy
 *
p
;

231 
hli¡_node
 *
n
;

233 ià(!
rmc
)

237 
	`memıy
(&
£qnum
, &
mesh_hdr
->seqnum, (mesh_hdr->seqnum));

238 
idx
 = 
	`Ë32_to_ıu
(
mesh_hdr
->
£qnum
è& 
rmc
->
idx_mask
;

239 
	`hli¡_fÜ_—ch_’Œy_§ã
(
p
, 
n
, &
rmc
->
buck‘
[
idx
], 
li¡
) {

240 ++
’Œ›s
;

241 ià(
	`time_aá”
(
jiff›s
, 
p
->
exp_time
) ||

242 
’Œ›s
 =ğ
RMC_QUEUE_MAX_LEN
) {

243 
	`hli¡_d–
(&
p
->
li¡
);

244 
	`kmem_ÿche_ä“
(
rm_ÿche
, 
p
);

245 --
’Œ›s
;

246 } ià((
£qnum
 =ğ
p
->£qnumè&& 
	`‘h”_addr_equ®
(
§
,…->sa))

250 
p
 = 
	`kmem_ÿche_®loc
(
rm_ÿche
, 
GFP_ATOMIC
);

251 ià(!
p
)

254 
p
->
£qnum
 = seqnum;

255 
p
->
exp_time
 = 
jiff›s
 + 
RMC_TIMEOUT
;

256 
	`memıy
(
p
->
§
, sa, 
ETH_ALEN
);

257 
	`hli¡_add_h—d
(&
p
->
li¡
, &
rmc
->
buck‘
[
idx
]);

259 
	}
}

261 
	$mesh_add_meshcÚf_›
(
›“80211_sub_if_d©a
 *
sd©a
,

262 
sk_buff
 *
skb
)

264 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

265 
u8
 *
pos
, 
ÃighbÜs
;

266 
u8
 
meshcÚf_Ën
 = (
›“80211_meshcÚf_›
);

267 
boŞ
 
is_cÚÃùed_to_g©e
 = 
ifmsh
->
num_g©es
 > 0 ||

268 
ifmsh
->
mshcfg
.
dÙ11MeshG©eAÂounûm’tPrÙocŞ
 ||

269 
ifmsh
->
mshcfg
.
dÙ11MeshCÚÃùedToMeshG©e
;

270 
boŞ
 
is_cÚÃùed_to_as
 = 
ifmsh
->
mshcfg
.
dÙ11MeshCÚÃùedToAuthS”v”
;

272 ià(
	`skb_room
(
skb
è< 2 + 
meshcÚf_Ën
)

273  -
ENOMEM
;

275 
pos
 = 
	`skb_put
(
skb
, 2 + 
meshcÚf_Ën
);

276 *
pos
++ = 
WLAN_EID_MESH_CONFIG
;

277 *
pos
++ = 
meshcÚf_Ën
;

280 
ifmsh
->
meshcÚf_off£t
 = 
pos
 - 
skb
->
d©a
;

283 *
pos
++ = 
ifmsh
->
mesh_µ_id
;

285 *
pos
++ = 
ifmsh
->
mesh_pm_id
;

287 *
pos
++ = 
ifmsh
->
mesh_cc_id
;

289 *
pos
++ = 
ifmsh
->
mesh_¥_id
;

291 *
pos
++ = 
ifmsh
->
mesh_auth_id
;

293 
ÃighbÜs
 = 
	`©omic_»ad
(&
ifmsh
->
e¡ab_¶šks
);

294 
ÃighbÜs
 = 
	`mš_t
(,‚eighbÜs, 
IEEE80211_MAX_MESH_PEERINGS
);

295 *
pos
++ = (
is_cÚÃùed_to_as
 << 7) |

296 (
ÃighbÜs
 << 1) |

297 
is_cÚÃùed_to_g©e
;

299 *
pos
 = 0x00;

300 *
pos
 |ğ
ifmsh
->
mshcfg
.
dÙ11MeshFÜw¬dšg
 ?

301 
IEEE80211_MESHCONF_CAPAB_FORWARDING
 : 0x00;

302 *
pos
 |ğ
ifmsh
->
acû±šg_¶šks
 ?

303 
IEEE80211_MESHCONF_CAPAB_ACCEPT_PLINKS
 : 0x00;

305 *
pos
 |ğ
ifmsh
->
ps_³”s_d“p_¦“p
 ?

306 
IEEE80211_MESHCONF_CAPAB_POWER_SAVE_LEVEL
 : 0x00;

308 
	}
}

310 
	$mesh_add_meshid_›
(
›“80211_sub_if_d©a
 *
sd©a
, 
sk_buff
 *
skb
)

312 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

313 
u8
 *
pos
;

315 ià(
	`skb_room
(
skb
è< 2 + 
ifmsh
->
mesh_id_Ën
)

316  -
ENOMEM
;

318 
pos
 = 
	`skb_put
(
skb
, 2 + 
ifmsh
->
mesh_id_Ën
);

319 *
pos
++ = 
WLAN_EID_MESH_ID
;

320 *
pos
++ = 
ifmsh
->
mesh_id_Ën
;

321 ià(
ifmsh
->
mesh_id_Ën
)

322 
	`memıy
(
pos
, 
ifmsh
->
mesh_id
, ifmsh->
mesh_id_Ën
);

325 
	}
}

327 
	$mesh_add_awake_wšdow_›
(
›“80211_sub_if_d©a
 *
sd©a
,

328 
sk_buff
 *
skb
)

330 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

331 
u8
 *
pos
;

334 ià(
ifmsh
->
ps_³”s_light_¦“p
 == 0 &&

335 
ifmsh
->
ps_³”s_d“p_¦“p
 == 0 &&

336 
ifmsh
->
nÚ³”_pm
 =ğ
NL80211_MESH_POWER_ACTIVE
)

339 ià(
	`skb_room
(
skb
) < 4)

340  -
ENOMEM
;

342 
pos
 = 
	`skb_put
(
skb
, 2 + 2);

343 *
pos
++ = 
WLAN_EID_MESH_AWAKE_WINDOW
;

344 *
pos
++ = 2;

345 
	`put_uÇligÃd_Ë16
(
ifmsh
->
mshcfg
.
dÙ11MeshAwakeWšdowDu¿tiÚ
, 
pos
);

348 
	}
}

350 
	$mesh_add_v’dÜ_›s
(
›“80211_sub_if_d©a
 *
sd©a
,

351 
sk_buff
 *
skb
)

353 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

354 
u8
 
off£t
, 
Ën
;

355 cÚ¡ 
u8
 *
d©a
;

357 ià(!
ifmsh
->
›
 || !ifmsh->
›_Ën
)

361 
off£t
 = 
	`›“80211_›_¥l™_v’dÜ
(
ifmsh
->
›
, ifmsh->
›_Ën
, 0);

363 ià(
off£t
 < 
ifmsh
->
›_Ën
) {

364 
Ën
 = 
ifmsh
->
›_Ën
 - 
off£t
;

365 
d©a
 = 
ifmsh
->
›
 + 
off£t
;

366 ià(
	`skb_room
(
skb
è< 
Ën
)

367  -
ENOMEM
;

368 
	`skb_put_d©a
(
skb
, 
d©a
, 
Ën
);

372 
	}
}

374 
	$mesh_add_r¢_›
(
›“80211_sub_if_d©a
 *
sd©a
, 
sk_buff
 *
skb
)

376 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

377 
u8
 
Ën
 = 0;

378 cÚ¡ 
u8
 *
d©a
;

380 ià(!
ifmsh
->
›
 || !ifmsh->
›_Ën
)

384 
d©a
 = 
	`cfg80211_fšd_›
(
WLAN_EID_RSN
, 
ifmsh
->
›
, ifmsh->
›_Ën
);

385 ià(!
d©a
)

388 
Ën
 = 
d©a
[1] + 2;

390 ià(
	`skb_room
(
skb
è< 
Ën
)

391  -
ENOMEM
;

392 
	`skb_put_d©a
(
skb
, 
d©a
, 
Ën
);

395 
	}
}

397 
	$mesh_add_ds_·¿ms_›
(
›“80211_sub_if_d©a
 *
sd©a
,

398 
sk_buff
 *
skb
)

400 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

401 
›“80211_chªÃl
 *
chª
;

402 
u8
 *
pos
;

404 ià(
	`skb_room
(
skb
) < 3)

405  -
ENOMEM
;

407 
	`rcu_»ad_lock
();

408 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

409 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

410 
	`rcu_»ad_uÆock
();

411  -
EINVAL
;

413 
chª
 = 
chªùx_cÚf
->
def
.chan;

414 
	`rcu_»ad_uÆock
();

416 
pos
 = 
	`skb_put
(
skb
, 2 + 1);

417 *
pos
++ = 
WLAN_EID_DS_PARAMS
;

418 *
pos
++ = 1;

419 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
chª
->
ûÁ”_äeq
);

422 
	}
}

424 
	$mesh_add_ht_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

425 
sk_buff
 *
skb
)

427 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

428 
u8
 *
pos
;

430 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

431 ià(!
sbªd
)

432  -
EINVAL
;

435 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

438 ià(!
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
 ||

439 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

440 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

441 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

444 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_ht_ÿp
))

445  -
ENOMEM
;

447 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_ht_ÿp
));

448 
	`›“80211_›_bud_ht_ÿp
(
pos
, &
sbªd
->
ht_ÿp
, sbªd->ht_ÿp.
ÿp
);

451 
	}
}

453 
	$mesh_add_ht_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

454 
sk_buff
 *
skb
)

456 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

457 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

458 
›“80211_chªÃl
 *
chªÃl
;

459 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

460 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
;

461 
u8
 *
pos
;

463 
	`rcu_»ad_lock
();

464 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

465 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

466 
	`rcu_»ad_uÆock
();

467  -
EINVAL
;

469 
chªÃl
 = 
chªùx_cÚf
->
def
.
chª
;

470 
	`rcu_»ad_uÆock
();

472 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
chªÃl
->
bªd
];

473 
ht_ÿp
 = &
sbªd
->ht_cap;

476 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

479 ià(!
ht_ÿp
->
ht_suµÜ‹d
 ||

480 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

481 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

482 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

485 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_ht_İ”©iÚ
))

486  -
ENOMEM
;

488 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_ht_İ”©iÚ
));

489 
	`›“80211_›_bud_ht_İ”
(
pos
, 
ht_ÿp
, &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
,

490 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
,

491 
çl£
);

494 
	}
}

496 
	$mesh_add_vht_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

497 
sk_buff
 *
skb
)

499 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

500 
u8
 *
pos
;

502 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

503 ià(!
sbªd
)

504  -
EINVAL
;

507 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

510 ià(!
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
 ||

511 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

512 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

513 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

516 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_vht_ÿp
))

517  -
ENOMEM
;

519 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_vht_ÿp
));

520 
	`›“80211_›_bud_vht_ÿp
(
pos
, &
sbªd
->
vht_ÿp
, sbªd->vht_ÿp.
ÿp
);

523 
	}
}

525 
	$mesh_add_vht_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

526 
sk_buff
 *
skb
)

528 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

529 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

530 
›“80211_chªÃl
 *
chªÃl
;

531 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

532 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
;

533 
u8
 *
pos
;

535 
	`rcu_»ad_lock
();

536 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

537 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

538 
	`rcu_»ad_uÆock
();

539  -
EINVAL
;

541 
chªÃl
 = 
chªùx_cÚf
->
def
.
chª
;

542 
	`rcu_»ad_uÆock
();

544 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
chªÃl
->
bªd
];

545 
vht_ÿp
 = &
sbªd
->vht_cap;

548 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

551 ià(!
vht_ÿp
->
vht_suµÜ‹d
 ||

552 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

553 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

554 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

557 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_vht_İ”©iÚ
))

558  -
ENOMEM
;

560 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_vht_İ”©iÚ
));

561 
	`›“80211_›_bud_vht_İ”
(
pos
, 
vht_ÿp
,

562 &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
);

565 
	}
}

567 
	$mesh_add_he_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

568 
sk_buff
 *
skb
, 
u8
 
›_Ën
)

570 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

572 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

573 ià(!
sbªd
)

574  -
EINVAL
;

576 ià(
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

577 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

578 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

581  
	`›“80211_put_he_ÿp
(
skb
, 
sd©a
, 
sbªd
, 
NULL
);

582 
	}
}

584 
	$mesh_add_he_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

585 
sk_buff
 *
skb
)

587 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
;

588 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

589 
u32
 
Ën
;

590 
u8
 *
pos
;

592 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

593 ià(!
sbªd
)

594  -
EINVAL
;

596 
he_ÿp
 = 
	`›“80211_g‘_he_iáy³_ÿp
(
sbªd
, 
NL80211_IFTYPE_MESH_POINT
);

597 ià(!
he_ÿp
 ||

598 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

599 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

600 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

603 
Ën
 = 2 + 1 + (
›“80211_he_İ”©iÚ
);

604 ià(
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

605 
Ën
 +ğ(
›“80211_he_6ghz_İ”
);

607 ià(
	`skb_room
(
skb
è< 
Ën
)

608  -
ENOMEM
;

610 
pos
 = 
	`skb_put
(
skb
, 
Ën
);

611 
	`›“80211_›_bud_he_İ”
(
pos
, &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
);

614 
	}
}

616 
	$mesh_add_he_6ghz_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

617 
sk_buff
 *
skb
)

619 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

620 cÚ¡ 
›“80211_sbªd_iáy³_d©a
 *
iád
;

622 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

623 ià(!
sbªd
)

624  -
EINVAL
;

626 
iád
 = 
	`›“80211_g‘_sbªd_iáy³_d©a
(
sbªd
,

627 
NL80211_IFTYPE_MESH_POINT
);

629 ià(!
iád
)

632 
	`›“80211_put_he_6ghz_ÿp
(
skb
, 
sd©a
, sd©a->
deæšk
.
smps_mode
);

634 
	}
}

636 
	$mesh_add_eht_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

637 
sk_buff
 *
skb
, 
u8
 
›_Ën
)

639 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

641 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

642 ià(!
sbªd
)

643  -
EINVAL
;

645 ià(
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

646 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

647 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

650  
	`›“80211_put_eht_ÿp
(
skb
, 
sd©a
, 
sbªd
, 
NULL
);

651 
	}
}

653 
	$mesh_add_eht_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
, 
sk_buff
 *
skb
)

655 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
;

656 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

657 
u32
 
Ën
;

658 
u8
 *
pos
;

660 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

661 ià(!
sbªd
)

662  -
EINVAL
;

664 
eht_ÿp
 = 
	`›“80211_g‘_eht_iáy³_ÿp
(
sbªd
, 
NL80211_IFTYPE_MESH_POINT
);

665 ià(!
eht_ÿp
 ||

666 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

667 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

668 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

671 
Ën
 = 2 + 1 + 
	`off£tof
(
›“80211_eht_İ”©iÚ
, 
İtiÚ®
) +

672 
	`off£tof
(
›“80211_eht_İ”©iÚ_šfo
, 
İtiÚ®
);

674 ià(
	`skb_room
(
skb
è< 
Ën
)

675  -
ENOMEM
;

677 
pos
 = 
	`skb_put
(
skb
, 
Ën
);

678 
	`›“80211_›_bud_eht_İ”
(
pos
, &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
, 
eht_ÿp
);

681 
	}
}

683 
	$›“80211_mesh_·th_tim”
(
tim”_li¡
 *
t
)

685 
›“80211_sub_if_d©a
 *
sd©a
 =

686 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
mesh
.
mesh_·th_tim”
);

688 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

689 
	}
}

691 
	$›“80211_mesh_·th_roÙ_tim”
(
tim”_li¡
 *
t
)

693 
›“80211_sub_if_d©a
 *
sd©a
 =

694 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
mesh
.
mesh_·th_roÙ_tim”
);

695 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

697 
	`£t_b™
(
MESH_WORK_ROOT
, &
ifmsh
->
wrkq_æags
);

699 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

700 
	}
}

702 
	$›“80211_mesh_roÙ_£tup
(
›“80211_if_mesh
 *
ifmsh
)

704 ià(
ifmsh
->
mshcfg
.
dÙ11MeshHWMPRoÙMode
 > 
IEEE80211_ROOTMODE_ROOT
)

705 
	`£t_b™
(
MESH_WORK_ROOT
, &
ifmsh
->
wrkq_æags
);

707 
	`ş—r_b™
(
MESH_WORK_ROOT
, &
ifmsh
->
wrkq_æags
);

709 
	`d–_tim”_sync
(&
ifmsh
->
mesh_·th_roÙ_tim”
);

711 
	}
}

714 
	$›“80211_mesh_upd©e_bss_·¿ms
(
›“80211_sub_if_d©a
 *
sd©a
,

715 
u8
 *
›
, u8 
›_Ën
)

717 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

718 cÚ¡ 
–em’t
 *
ÿp
;

719 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ”
 = 
NULL
;

721 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

722 ià(!
sbªd
)

725 ià(!
	`›“80211_g‘_he_iáy³_ÿp
(
sbªd
, 
NL80211_IFTYPE_MESH_POINT
) ||

726 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
 ||

727 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

728 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

731 
sd©a
->
vif
.
bss_cÚf
.
he_suµÜt
 = 
Œue
;

733 
ÿp
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_HE_OPERATION
, 
›
, 
›_Ën
);

734 ià(
ÿp
 && c­->
d©®’
 >ğ1 + (*
he_İ”
) &&

735 
ÿp
->
d©®’
 >ğ1 + 
	`›“80211_he_İ”_size
(ÿp->
d©a
 + 1))

736 
he_İ”
 = (*)(
ÿp
->
d©a
 + 1);

738 ià(
he_İ”
)

739 
sd©a
->
vif
.
bss_cÚf
.
he_İ”
.
·¿ms
 =

740 
	`__Ë32_to_ıu
(
he_İ”
->
he_İ”_·¿ms
);

742 
sd©a
->
vif
.
bss_cÚf
.
eht_suµÜt
 =

743 !!
	`›“80211_g‘_eht_iáy³_ÿp
(
sbªd
, 
NL80211_IFTYPE_MESH_POINT
);

744 
	}
}

746 
boŞ
 
	$›“80211_mesh_xm™_ç¡
(
›“80211_sub_if_d©a
 *
sd©a
,

747 
sk_buff
 *
skb
, 
u32
 
ù¾_æags
)

749 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

750 
›“80211_mesh_ç¡_tx_key
 
key
 = {

751 .
ty³
 = 
MESH_FAST_TX_TYPE_LOCAL


753 
›“80211_mesh_ç¡_tx
 *
’Œy
;

754 
›“80211s_hdr
 *
meshhdr
;

755 
u8
 
§
[
ETH_ALEN
] 
	`__®igÃd
(2);

756 
tid_ampdu_tx
 *
tid_tx
;

757 
¡a_šfo
 *
¡a
;

758 
boŞ
 
cİy_§
 = 
çl£
;

759 
u16
 
‘h”ty³
;

760 
u8
 
tid
;

762 ià(
ù¾_æags
 & 
IEEE80211_TX_CTRL_SKIP_MPATH_LOOKUP
)

763  
çl£
;

765 ià(
ifmsh
->
mshcfg
.
dÙ11MeshNŞ—º
)

766  
çl£
;

769 ià(
ifmsh
->
ps_³”s_light_¦“p
 || ifmsh->
ps_³”s_d“p_¦“p
)

770  
çl£
;

772 ià(
	`is_muÉiÿ¡_‘h”_addr
(
skb
->
d©a
))

773  
çl£
;

775 
‘h”ty³
 = (
skb
->
d©a
[12] << 8) | skb->data[13];

776 ià(
‘h”ty³
 < 
ETH_P_802_3_MIN
)

777  
çl£
;

779 ià(
skb
->
sk
 && 
	`skb_shšfo
(skb)->
tx_æags
 & 
SKBTX_WIFI_STATUS
)

780  
çl£
;

782 ià(
skb
->
_summed
 =ğ
CHECKSUM_PARTIAL
) {

783 
	`skb_£t_Œª¥Üt_h—d”
(
skb
, 
	`skb_checksum_¡¬t_off£t
(skb));

784 ià(
	`skb_checksum_h–p
(
skb
))

785  
çl£
;

788 
	`‘h”_addr_cİy
(
key
.
addr
, 
skb
->
d©a
);

789 ià(!
	`‘h”_addr_equ®
(
skb
->
d©a
 + 
ETH_ALEN
, 
sd©a
->
vif
.
addr
))

790 
key
.
ty³
 = 
MESH_FAST_TX_TYPE_PROXIED
;

791 
’Œy
 = 
	`mesh_ç¡_tx_g‘
(
sd©a
, &
key
);

792 ià(!
’Œy
)

793  
çl£
;

795 ià(
	`skb_h—droom
(
skb
è< 
’Œy
->
hd¾’
 +ƒÁry->
ç¡_tx
.
hdr_Ën
)

796  
çl£
;

798 
¡a
 = 
	`rcu_d”eã»nû
(
’Œy
->
m·th
->
Ãxt_hİ
);

799 ià(!
¡a
)

800  
çl£
;

802 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

803 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

804 ià(
tid_tx
) {

805 ià(!
	`‹¡_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
))

806  
çl£
;

807 ià(
tid_tx
->
timeout
)

808 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

811 
skb
 = 
	`skb_sh¬e_check
(skb, 
GFP_ATOMIC
);

812 ià(!
skb
)

813  
Œue
;

815 
	`skb_£t_queue_m­pšg
(
skb
, 
	`›“80211_£Ëù_queue
(
sd©a
, 
¡a
, skb));

817 
meshhdr
 = (
›“80211s_hdr
 *)
’Œy
->
hdr
;

818 ià((
meshhdr
->
æags
 & 
MESH_FLAGS_AE
è=ğ
MESH_FLAGS_AE_A5_A6
) {

820 
	`‘h”_addr_cİy
(
§
, 
skb
->
d©a
 + 
ETH_ALEN
);

821 
cİy_§
 = 
Œue
;

824 
	`memıy
(
	`skb_push
(
skb
, 
’Œy
->
hd¾’
 - 2 * 
ETH_ALEN
),ƒÁry->
hdr
,

825 
’Œy
->
hd¾’
);

827 
meshhdr
 = (
›“80211s_hdr
 *)
skb
->
d©a
;

828 
	`put_uÇligÃd_Ë32
(
	`©omic_šc_»tuº
(&
sd©a
->
u
.
mesh
.
mesh_£qnum
),

829 &
meshhdr
->
£qnum
);

830 
meshhdr
->
‰l
 = 
sd©a
->
u
.
mesh
.
mshcfg
.
dÙ11MeshTTL
;

831 ià(
cİy_§
)

832 
	`‘h”_addr_cİy
(
meshhdr
->
—ddr2
, 
§
);

834 
	`skb_push
(
skb
, 2 * 
ETH_ALEN
);

835 
	`__›“80211_xm™_ç¡
(
sd©a
, 
¡a
, &
’Œy
->
ç¡_tx
, 
skb
, 
tid_tx
,

836 
’Œy
->
m·th
->
d¡
, 
sd©a
->
vif
.
addr
);

838  
Œue
;

839 
	}
}

851 
	$›“80211_fl_mesh_add»s£s
(
›“80211_hdr
 *
hdr
, 
__Ë16
 *
fc
,

852 cÚ¡ 
u8
 *
meshda
, cÚ¡ u8 *
mesh§
)

854 ià(
	`is_muÉiÿ¡_‘h”_addr
(
meshda
)) {

855 *
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
);

857 
	`memıy
(
hdr
->
addr1
, 
meshda
, 
ETH_ALEN
);

858 
	`memıy
(
hdr
->
addr2
, 
mesh§
, 
ETH_ALEN
);

859 
	`memıy
(
hdr
->
addr3
, 
mesh§
, 
ETH_ALEN
);

862 *
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 | 
IEEE80211_FCTL_TODS
);

864 
	`‘h_z”o_addr
(
hdr
->
addr1
);

865 
	`memıy
(
hdr
->
addr2
, 
mesh§
, 
ETH_ALEN
);

866 
	`memıy
(
hdr
->
addr3
, 
meshda
, 
ETH_ALEN
);

867 
	`memıy
(
hdr
->
addr4
, 
mesh§
, 
ETH_ALEN
);

870 
	}
}

884 
	$›“80211_Ãw_mesh_h—d”
(
›“80211_sub_if_d©a
 *
sd©a
,

885 
›“80211s_hdr
 *
meshhdr
,

886 cÚ¡ *
addr4Ü5
, cÚ¡ *
addr6
)

888 ià(
	`WARN_ON
(!
addr4Ü5
 && 
addr6
))

891 
	`mem£t
(
meshhdr
, 0, (*meshhdr));

893 
meshhdr
->
‰l
 = 
sd©a
->
u
.
mesh
.
mshcfg
.
dÙ11MeshTTL
;

895 
	`put_uÇligÃd_Ë32
(
	`©omic_šc_»tuº
(&
sd©a
->
u
.
mesh
.
mesh_£qnum
),

896 &
meshhdr
->
£qnum
);

897 ià(
addr4Ü5
 && !
addr6
) {

898 
meshhdr
->
æags
 |ğ
MESH_FLAGS_AE_A4
;

899 
	`memıy
(
meshhdr
->
—ddr1
, 
addr4Ü5
, 
ETH_ALEN
);

900  2 * 
ETH_ALEN
;

901 } ià(
addr4Ü5
 && 
addr6
) {

902 
meshhdr
->
æags
 |ğ
MESH_FLAGS_AE_A5_A6
;

903 
	`memıy
(
meshhdr
->
—ddr1
, 
addr4Ü5
, 
ETH_ALEN
);

904 
	`memıy
(
meshhdr
->
—ddr2
, 
addr6
, 
ETH_ALEN
);

905  3 * 
ETH_ALEN
;

908  
ETH_ALEN
;

909 
	}
}

911 
	$›“80211_mesh_hou£k“pšg
(
›“80211_sub_if_d©a
 *
sd©a
)

913 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

914 
u64
 
chªged
;

916 ià(
ifmsh
->
mshcfg
.
¶šk_timeout
 > 0)

917 
	`›“80211_¡a_expœe
(
sd©a
, 
ifmsh
->
mshcfg
.
¶šk_timeout
 * 
HZ
);

918 
	`mesh_·th_expœe
(
sd©a
);

920 
chªged
 = 
	`mesh_acû±_¶šks_upd©e
(
sd©a
);

921 
	`›“80211_mbss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

923 
	`mesh_ç¡_tx_gc
(
sd©a
);

925 
	`mod_tim”
(&
ifmsh
->
hou£k“pšg_tim”
,

926 
	`round_jiff›s
(
jiff›s
 +

927 
IEEE80211_MESH_HOUSEKEEPING_INTERVAL
));

928 
	}
}

930 
	$›“80211_mesh_roÙ·th
(
›“80211_sub_if_d©a
 *
sd©a
)

932 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

933 
u32
 
š‹rv®
;

935 
	`mesh_·th_tx_roÙ_äame
(
sd©a
);

937 ià(
ifmsh
->
mshcfg
.
dÙ11MeshHWMPRoÙMode
 =ğ
IEEE80211_PROACTIVE_RANN
)

938 
š‹rv®
 = 
ifmsh
->
mshcfg
.
dÙ11MeshHWMPRªnIÁ”v®
;

940 
š‹rv®
 = 
ifmsh
->
mshcfg
.
dÙ11MeshHWMProÙIÁ”v®
;

942 
	`mod_tim”
(&
ifmsh
->
mesh_·th_roÙ_tim”
,

943 
	`round_jiff›s
(
	`TU_TO_EXP_TIME
(
š‹rv®
)));

944 
	}
}

947 
	$›“80211_mesh_bud_b—cÚ
(
›“80211_if_mesh
 *
ifmsh
)

949 
b—cÚ_d©a
 *
bú
;

950 
h—d_Ën
, 
_Ën
;

951 
sk_buff
 *
skb
;

952 
›“80211_mgmt
 *
mgmt
;

953 
mesh_c§_£‰šgs
 *
c§
;

954 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

955 
u8
 
›_Ën_he_ÿp
, 
›_Ën_eht_ÿp
;

956 
u8
 *
pos
;

957 
›“80211_sub_if_d©a
 *
sd©a
;

958 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
, 
u
.
b—cÚ
);

959 
u32
 
¿‹_æags
;

961 
sd©a
 = 
	`cÚš”_of
(
ifmsh
, 
›“80211_sub_if_d©a
, 
u
.
mesh
);

963 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

964 
¿‹_æags
 =

965 
	`›“80211_chªdef_¿‹_æags
(&
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
);

967 
›_Ën_he_ÿp
 = 
	`›“80211_›_Ën_he_ÿp
(
sd©a
);

968 
›_Ën_eht_ÿp
 = 
	`›“80211_›_Ën_eht_ÿp
(
sd©a
);

969 
h—d_Ën
 = 
hdr_Ën
 +

972 2 + (
›“80211_chªÃl_sw_›
) +

974 2 + (
›“80211_mesh_chªsw_·¿ms_›
) +

976 2 + 2 + (
›“80211_wide_bw_chªsw_›
) +

977 2 + (
›“80211_£c_chª_offs_›
) +

980 
_Ën
 = 2 + (
IEEE80211_MAX_SUPP_RATES
 - 8) +

981 2 + (
›“80211_ht_ÿp
) +

982 2 + (
›“80211_ht_İ”©iÚ
) +

983 2 + 
ifmsh
->
mesh_id_Ën
 +

984 2 + (
›“80211_meshcÚf_›
) +

985 2 + (
__Ë16
) +

986 2 + (
›“80211_vht_ÿp
) +

987 2 + (
›“80211_vht_İ”©iÚ
) +

988 
›_Ën_he_ÿp
 +

989 2 + 1 + (
›“80211_he_İ”©iÚ
) +

990 (
›“80211_he_6ghz_İ”
) +

991 2 + 1 + (
›“80211_he_6ghz_ÿ·
) +

992 
›_Ën_eht_ÿp
 +

993 2 + 1 + 
	`off£tof
(
›“80211_eht_İ”©iÚ
, 
İtiÚ®
) +

994 
	`off£tof
(
›“80211_eht_İ”©iÚ_šfo
, 
İtiÚ®
) +

995 
ifmsh
->
›_Ën
;

997 
bú
 = 
	`kz®loc
((*búè+ 
h—d_Ën
 + 
_Ën
, 
GFP_KERNEL
);

999 
skb
 = 
	`__dev_®loc_skb
(
	`max
(
h—d_Ën
, 
_Ën
), 
GFP_KERNEL
);

1001 ià(!
bú
 || !
skb
)

1002 
out_ä“
;

1008 
bú
->
h—d
 = ((
u8
 *) bcn) + (*bcn);

1011 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

1012 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

1013 
IEEE80211_STYPE_BEACON
);

1014 
	`‘h_brßdÿ¡_addr
(
mgmt
->
da
);

1015 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1016 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1017 
	`›“80211_mps_£t_äame_æags
(
sd©a
, 
NULL
, (*è
mgmt
);

1018 
mgmt
->
u
.
b—cÚ
.
b—cÚ_št
 =

1019 
	`ıu_to_Ë16
(
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
);

1020 
mgmt
->
u
.
b—cÚ
.
ÿ·b_šfo
 |ğ
	`ıu_to_Ë16
(

1021 
sd©a
->
u
.
mesh
.
£cur™y
 ? 
WLAN_CAPABILITY_PRIVACY
 : 0);

1023 
pos
 = 
	`skb_put
(
skb
, 2);

1024 *
pos
++ = 
WLAN_EID_SSID
;

1025 *
pos
++ = 0x0;

1027 
	`rcu_»ad_lock
();

1028 
c§
 = 
	`rcu_d”eã»nû
(
ifmsh
->csa);

1029 ià(
c§
) {

1030 
Æ80211_chªÃl_ty³
 
ù
;

1031 
cfg80211_chª_def
 *
chªdef
;

1032 
›_Ën
 = 2 + (
›“80211_chªÃl_sw_›
) +

1033 2 + (
›“80211_mesh_chªsw_·¿ms_›
);

1035 
pos
 = 
	`skb_put_z”o
(
skb
, 
›_Ën
);

1036 *
pos
++ = 
WLAN_EID_CHANNEL_SWITCH
;

1037 *
pos
++ = 3;

1038 *
pos
++ = 0x0;

1039 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(

1040 
c§
->
£‰šgs
.
chªdef
.
chª
->
ûÁ”_äeq
);

1041 
bú
->
útdwn_cu¼’t_couÁ”
 = 
c§
->
£‰šgs
.
couÁ
;

1042 
bú
->
útdwn_couÁ”_off£ts
[0] = 
hdr_Ën
 + 6;

1043 *
pos
++ = 
c§
->
£‰šgs
.
couÁ
;

1044 *
pos
++ = 
WLAN_EID_CHAN_SWITCH_PARAM
;

1045 *
pos
++ = 6;

1046 ià(
ifmsh
->
c§_rŞe
 =ğ
IEEE80211_MESH_CSA_ROLE_INIT
) {

1047 *
pos
++ = 
ifmsh
->
mshcfg
.
dÙ11MeshTTL
;

1048 *
pos
 |ğ
WLAN_EID_CHAN_SWITCH_PARAM_INITIATOR
;

1050 *
pos
++ = 
ifmsh
->
chsw_‰l
;

1052 *
pos
++ |ğ
c§
->
£‰šgs
.
block_tx
 ?

1053 
WLAN_EID_CHAN_SWITCH_PARAM_TX_RESTRICT
 : 0x00;

1054 
	`put_uÇligÃd_Ë16
(
WLAN_REASON_MESH_CHAN
, 
pos
);

1055 
pos
 += 2;

1056 
	`put_uÇligÃd_Ë16
(
ifmsh
->
´e_v®ue
, 
pos
);

1057 
pos
 += 2;

1059 
c§
->
£‰šgs
.
chªdef
.
width
) {

1060 
NL80211_CHAN_WIDTH_40
:

1061 
›_Ën
 = 2 + (
›“80211_£c_chª_offs_›
);

1062 
pos
 = 
	`skb_put_z”o
(
skb
, 
›_Ën
);

1064 *
pos
++ = 
WLAN_EID_SECONDARY_CHANNEL_OFFSET
;

1065 *
pos
++ = 1;

1066 
ù
 = 
	`cfg80211_g‘_chªdef_ty³
(&
c§
->
£‰šgs
.
chªdef
);

1067 ià(
ù
 =ğ
NL80211_CHAN_HT40PLUS
)

1068 *
pos
++ = 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
;

1070 *
pos
++ = 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
;

1072 
NL80211_CHAN_WIDTH_80
:

1073 
NL80211_CHAN_WIDTH_80P80
:

1074 
NL80211_CHAN_WIDTH_160
:

1076 
›_Ën
 = 2 + 2 +

1077 (
›“80211_wide_bw_chªsw_›
);

1078 
pos
 = 
	`skb_put_z”o
(
skb
, 
›_Ën
);

1080 *
pos
++ = 
WLAN_EID_CHANNEL_SWITCH_WRAPPER
;

1081 *
pos
++ = 5;

1083 
chªdef
 = &
c§
->
£‰šgs
.chandef;

1084 
	`›“80211_›_bud_wide_bw_cs
(
pos
, 
chªdef
);

1090 
	`rcu_»ad_uÆock
();

1092 ià(
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
,

1093 
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
,

1094 
¿‹_æags
, 0, 
WLAN_EID_SUPP_RATES
) ||

1095 
	`mesh_add_ds_·¿ms_›
(
sd©a
, 
skb
))

1096 
out_ä“
;

1098 
bú
->
h—d_Ën
 = 
skb
->
Ën
;

1099 
	`memıy
(
bú
->
h—d
, 
skb
->
d©a
, bú->
h—d_Ën
);

1102 
	`skb_Œim
(
skb
, 0);

1103 
bú
->

 = bú->
h—d
 + bú->
h—d_Ën
;

1105 ià(
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
,

1106 
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
,

1107 
¿‹_æags
, 0, 
WLAN_EID_EXT_SUPP_RATES
) ||

1108 
	`mesh_add_r¢_›
(
sd©a
, 
skb
) ||

1109 
	`mesh_add_ht_ÿp_›
(
sd©a
, 
skb
) ||

1110 
	`mesh_add_ht_İ”_›
(
sd©a
, 
skb
) ||

1111 
	`mesh_add_meshid_›
(
sd©a
, 
skb
) ||

1112 
	`mesh_add_meshcÚf_›
(
sd©a
, 
skb
) ||

1113 
	`mesh_add_awake_wšdow_›
(
sd©a
, 
skb
) ||

1114 
	`mesh_add_vht_ÿp_›
(
sd©a
, 
skb
) ||

1115 
	`mesh_add_vht_İ”_›
(
sd©a
, 
skb
) ||

1116 
	`mesh_add_he_ÿp_›
(
sd©a
, 
skb
, 
›_Ën_he_ÿp
) ||

1117 
	`mesh_add_he_İ”_›
(
sd©a
, 
skb
) ||

1118 
	`mesh_add_he_6ghz_ÿp_›
(
sd©a
, 
skb
) ||

1119 
	`mesh_add_eht_ÿp_›
(
sd©a
, 
skb
, 
›_Ën_eht_ÿp
) ||

1120 
	`mesh_add_eht_İ”_›
(
sd©a
, 
skb
) ||

1121 
	`mesh_add_v’dÜ_›s
(
sd©a
, 
skb
))

1122 
out_ä“
;

1124 
bú
->
_Ën
 = 
skb
->
Ën
;

1125 
	`memıy
(
bú
->

, 
skb
->
d©a
, bú->
_Ën
);

1126 
	`›“80211_mesh_upd©e_bss_·¿ms
(
sd©a
, 
bú
->

, bú->
_Ën
);

1127 
bú
->
meshcÚf
 = (
›“80211_meshcÚf_›
 *)

1128 (
bú
->

 + 
ifmsh
->
meshcÚf_off£t
);

1130 
	`dev_kä“_skb
(
skb
);

1131 
	`rcu_assign_poš‹r
(
ifmsh
->
b—cÚ
, 
bú
);

1133 
out_ä“
:

1134 
	`kä“
(
bú
);

1135 
	`dev_kä“_skb
(
skb
);

1136  -
ENOMEM
;

1137 
	}
}

1140 
	$›“80211_mesh_»bud_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
)

1142 
b—cÚ_d©a
 *
Şd_bú
;

1143 
»t
;

1145 
Şd_bú
 = 
	`sd©a_d”eã»nû
(
sd©a
->
u
.
mesh
.
b—cÚ
, sdata);

1146 
»t
 = 
	`›“80211_mesh_bud_b—cÚ
(&
sd©a
->
u
.
mesh
);

1147 ià(
»t
)

1149  
»t
;

1151 ià(
Şd_bú
)

1152 
	`kä“_rcu
(
Şd_bú
, 
rcu_h—d
);

1154 
	}
}

1156 
	$›“80211_mbss_šfo_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

1157 
u64
 
chªged
)

1159 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1160 
b™s
 = 
chªged
;

1161 
u32
 
b™
;

1163 ià(!
b™s
)

1167 
	`fÜ_—ch_£t_b™
(
b™
, &
b™s
, (
chªged
è* 
BITS_PER_BYTE
)

1168 
	`£t_b™
(
b™
, 
ifmsh
->
mbss_chªged
);

1169 
	`£t_b™
(
MESH_WORK_MBSS_CHANGED
, &
ifmsh
->
wrkq_æags
);

1170 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

1171 
	}
}

1173 
	$›“80211_¡¬t_mesh
(
›“80211_sub_if_d©a
 *
sd©a
)

1175 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1176 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1177 
u64
 
chªged
 = 
BSS_CHANGED_BEACON
 |

1178 
BSS_CHANGED_BEACON_ENABLED
 |

1179 
BSS_CHANGED_HT
 |

1180 
BSS_CHANGED_BASIC_RATES
 |

1181 
BSS_CHANGED_BEACON_INT
 |

1182 
BSS_CHANGED_MCAST_RATE
;

1184 
loÿl
->
fif_Ùh”_bss
++;

1186 
	`©omic_šc
(&
loÿl
->
iff_®lmuÉis
);

1187 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

1189 
ifmsh
->
mesh_cc_id
 = 0;

1191 
ifmsh
->
sync_İs
 = 
	`›“80211_mesh_sync_İs_g‘
(ifmsh->
mesh_¥_id
);

1192 
ifmsh
->
sync_off£t_şockdriá_max
 = 0;

1193 
	`£t_b™
(
MESH_WORK_HOUSEKEEPING
, &
ifmsh
->
wrkq_æags
);

1194 
	`›“80211_mesh_roÙ_£tup
(
ifmsh
);

1195 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

1196 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
 =

1197 
ifmsh
->
mshcfg
.
ht_İmode
;

1198 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
Œue
;

1200 
chªged
 |ğ
	`›“80211_mps_loÿl_¡©us_upd©e
(
sd©a
);

1202 ià(
	`›“80211_mesh_bud_b—cÚ
(
ifmsh
)) {

1203 
	`›“80211_¡İ_mesh
(
sd©a
);

1204  -
ENOMEM
;

1207 
	`›“80211_»ÿlc_dtim
(
loÿl
, 
sd©a
);

1208 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
, 
chªged
);

1210 
	`Ãtif_ÿ¼›r_Ú
(
sd©a
->
dev
);

1212 
	}
}

1214 
	$›“80211_¡İ_mesh
(
›“80211_sub_if_d©a
 *
sd©a
)

1216 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1217 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1218 
b—cÚ_d©a
 *
bú
;

1220 
	`Ãtif_ÿ¼›r_off
(
sd©a
->
dev
);

1223 
	`¡a_šfo_æush
(
sd©a
, -1);

1224 
	`›“80211_ä“_keys
(
sd©a
, 
Œue
);

1225 
	`mesh_·th_æush_by_içû
(
sd©a
);

1228 
ifmsh
->
mesh_id_Ën
 = 0;

1229 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
çl£
;

1230 
sd©a
->
b—cÚ_¿‹_£t
 = 
çl£
;

1231 
	`ş—r_b™
(
SDATA_STATE_OFFCHANNEL_BEACON_STOPPED
, &
sd©a
->
¡©e
);

1232 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

1233 
BSS_CHANGED_BEACON_ENABLED
);

1236 
bú
 = 
	`sd©a_d”eã»nû
(
ifmsh
->
b—cÚ
, 
sd©a
);

1237 
	`RCU_INIT_POINTER
(
ifmsh
->
b—cÚ
, 
NULL
);

1238 
	`kä“_rcu
(
bú
, 
rcu_h—d
);

1241 
loÿl
->
tÙ®_ps_bufã»d
 -ğ
	`skb_queue_Ën
(&
ifmsh
->
ps
.
bc_buf
);

1242 
	`skb_queue_purge
(&
ifmsh
->
ps
.
bc_buf
);

1244 
	`d–_tim”_sync
(&
sd©a
->
u
.
mesh
.
hou£k“pšg_tim”
);

1245 
	`d–_tim”_sync
(&
sd©a
->
u
.
mesh
.
mesh_·th_roÙ_tim”
);

1246 
	`d–_tim”_sync
(&
sd©a
->
u
.
mesh
.
mesh_·th_tim”
);

1249 
ifmsh
->
wrkq_æags
 = 0;

1250 
	`mem£t
(
ifmsh
->
mbss_chªged
, 0, (ifmsh->mbss_changed));

1252 
loÿl
->
fif_Ùh”_bss
--;

1253 
	`©omic_dec
(&
loÿl
->
iff_®lmuÉis
);

1254 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

1255 
	}
}

1257 
	$›“80211_mesh_c§_m¬k_¿d¬
(
›“80211_sub_if_d©a
 *
sd©a
)

1259 
”r
;

1264 
”r
 = 
	`cfg80211_chªdef_dfs_»quœed
(
sd©a
->
loÿl
->
hw
.
why
,

1265 &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
,

1266 
NL80211_IFTYPE_MESH_POINT
);

1267 ià(
”r
 > 0)

1268 
	`cfg80211_¿d¬_ev’t
(
sd©a
->
loÿl
->
hw
.
why
,

1269 &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
,

1270 
GFP_ATOMIC
);

1271 
	}
}

1273 
boŞ


1274 
	$›“80211_mesh_´oûss_chnsw™ch
(
›“80211_sub_if_d©a
 *
sd©a
,

1275 
›“802_11_–ems
 *
–ems
, 
boŞ
 
b—cÚ
)

1277 
cfg80211_c§_£‰šgs
 
·¿ms
;

1278 
›“80211_c§_›
 
c§_›
;

1279 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1280 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1281 
”r
;

1282 
›“80211_cÚn_£‰šgs
 
cÚn
 = 
›“80211_cÚn_£‰šgs_uÆim™ed
;

1283 
u32
 
vht_ÿp_šfo
 = 0;

1285 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1287 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

1288 ià(!
sbªd
)

1289  
çl£
;

1291 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
) {

1292 
NL80211_CHAN_WIDTH_20_NOHT
:

1293 
cÚn
.
mode
 = 
IEEE80211_CONN_MODE_LEGACY
;

1294 
cÚn
.
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

1296 
NL80211_CHAN_WIDTH_20
:

1297 
cÚn
.
mode
 = 
IEEE80211_CONN_MODE_HT
;

1298 
cÚn
.
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

1300 
NL80211_CHAN_WIDTH_40
:

1301 
cÚn
.
mode
 = 
IEEE80211_CONN_MODE_HT
;

1302 
cÚn
.
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_40
;

1308 ià(
–ems
->
vht_ÿp_–em
)

1309 
vht_ÿp_šfo
 =

1310 
	`Ë32_to_ıu
(
–ems
->
vht_ÿp_–em
->
vht_ÿp_šfo
);

1312 
	`mem£t
(&
·¿ms
, 0, (params));

1313 
”r
 = 
	`›“80211_·r£_ch_sw™ch_›
(
sd©a
, 
–ems
, 
sbªd
->
bªd
,

1314 
vht_ÿp_šfo
, &
cÚn
,

1315 
sd©a
->
vif
.
addr
,

1316 &
c§_›
);

1317 ià(
”r
 < 0)

1318  
çl£
;

1319 ià(
”r
)

1320  
çl£
;

1325 ià(
c§_›
.
»asÚ_code
 =ğ
WLAN_REASON_MESH_CHAN_REGULATORY
)

1326 
	`›“80211_mesh_c§_m¬k_¿d¬
(
sd©a
);

1328 
·¿ms
.
chªdef
 = 
c§_›
.
chª»q
.
İ”
;

1329 
·¿ms
.
couÁ
 = 
c§_›
.count;

1331 ià(!
	`cfg80211_chªdef_u§bË
(
sd©a
->
loÿl
->
hw
.
why
, &
·¿ms
.
chªdef
,

1332 
IEEE80211_CHAN_DISABLED
) ||

1333 !
	`cfg80211_»g_ÿn_b—cÚ
(
sd©a
->
loÿl
->
hw
.
why
, &
·¿ms
.
chªdef
,

1334 
NL80211_IFTYPE_MESH_POINT
)) {

1335 
	`sd©a_šfo
(
sd©a
,

1337 
sd©a
->
vif
.
addr
,

1338 
·¿ms
.
chªdef
.
chª
->
ûÁ”_äeq
,

1339 
·¿ms
.
chªdef
.
width
,

1340 
·¿ms
.
chªdef
.
ûÁ”_äeq1
,

1341 
·¿ms
.
chªdef
.
ûÁ”_äeq2
);

1342  
çl£
;

1345 
”r
 = 
	`cfg80211_chªdef_dfs_»quœed
(
sd©a
->
loÿl
->
hw
.
why
,

1346 &
·¿ms
.
chªdef
,

1347 
NL80211_IFTYPE_MESH_POINT
);

1348 ià(
”r
 < 0)

1349  
çl£
;

1350 ià(
”r
 > 0 && !
ifmsh
->
u£r¥aû_hªdËs_dfs
) {

1351 
	`sd©a_šfo
(
sd©a
,

1353 
sd©a
->
vif
.
addr
,

1354 
·¿ms
.
chªdef
.
chª
->
ûÁ”_äeq
,

1355 
·¿ms
.
chªdef
.
width
,

1356 
·¿ms
.
chªdef
.
ûÁ”_äeq1
,

1357 
·¿ms
.
chªdef
.
ûÁ”_äeq2
);

1358  
çl£
;

1361 
·¿ms
.
¿d¬_»quœed
 = 
”r
;

1363 ià(
	`cfg80211_chªdef_id’tiÿl
(&
·¿ms
.
chªdef
,

1364 &
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
)) {

1365 
	`mc§_dbg
(
sd©a
,

1367  
Œue
;

1370 
	`mc§_dbg
(
sd©a
,

1372 
·¿ms
.
chªdef
.
chª
->
ûÁ”_äeq
);

1374 
·¿ms
.
block_tx
 = 
c§_›
.
mode
 & 
WLAN_EID_CHAN_SWITCH_PARAM_TX_RESTRICT
;

1375 ià(
b—cÚ
) {

1376 
ifmsh
->
chsw_‰l
 = 
c§_›
.
‰l
 - 1;

1377 ià(
ifmsh
->
´e_v®ue
 >ğ
c§_›
.pre_value)

1378  
çl£
;

1379 
ifmsh
->
´e_v®ue
 = 
c§_›
.pre_value;

1382 ià(
ifmsh
->
chsw_‰l
 >ğifmsh->
mshcfg
.
dÙ11MeshTTL
)

1383  
çl£
;

1385 
ifmsh
->
c§_rŞe
 = 
IEEE80211_MESH_CSA_ROLE_REPEATER
;

1387 ià(
	`›“80211_chªÃl_sw™ch
(
sd©a
->
loÿl
->
hw
.
why
, sd©a->
dev
,

1388 &
·¿ms
) < 0)

1389  
çl£
;

1391  
Œue
;

1392 
	}
}

1395 
	$›“80211_mesh_rx_´obe_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

1396 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

1398 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1399 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1400 
sk_buff
 *
´e¥
;

1401 
b—cÚ_d©a
 *
bú
;

1402 
›“80211_mgmt
 *
hdr
;

1403 
›“802_11_–ems
 *
–ems
;

1404 
size_t
 
ba£Ën
;

1405 
u8
 *
pos
;

1407 
pos
 = 
mgmt
->
u
.
´obe_»q
.
v¬ŸbË
;

1408 
ba£Ën
 = (
u8
 *è
pos
 - (u8 *è
mgmt
;

1409 ià(
ba£Ën
 > 
Ën
)

1412 
–ems
 = 
	`›“802_11_·r£_–ems
(
pos
, 
Ën
 - 
ba£Ën
, 
çl£
, 
NULL
);

1413 ià(!
–ems
)

1416 ià(!
–ems
->
mesh_id
)

1417 
ä“
;

1420 ià((!
	`‘h”_addr_equ®
(
mgmt
->
da
, 
sd©a
->
vif
.
addr
) &&

1421 !
	`is_brßdÿ¡_‘h”_addr
(
mgmt
->
da
)) ||

1422 
–ems
->
ssid_Ën
 != 0)

1423 
ä“
;

1425 ià(
–ems
->
mesh_id_Ën
 != 0 &&

1426 (
–ems
->
mesh_id_Ën
 !ğ
ifmsh
->mesh_id_len ||

1427 
	`memcmp
(
–ems
->
mesh_id
, 
ifmsh
->mesh_id, ifmsh->
mesh_id_Ën
)))

1428 
ä“
;

1430 
	`rcu_»ad_lock
();

1431 
bú
 = 
	`rcu_d”eã»nû
(
ifmsh
->
b—cÚ
);

1433 ià(!
bú
)

1434 
out
;

1436 
´e¥
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 +

1437 
bú
->
h—d_Ën
 + bú->
_Ën
);

1438 ià(!
´e¥
)

1439 
out
;

1441 
	`skb_»£rve
(
´e¥
, 
loÿl
->
tx_h—droom
);

1442 
	`skb_put_d©a
(
´e¥
, 
bú
->
h—d
, bú->
h—d_Ën
);

1443 
	`skb_put_d©a
(
´e¥
, 
bú
->

, bú->
_Ën
);

1444 
hdr
 = (
›“80211_mgmt
 *è
´e¥
->
d©a
;

1445 
hdr
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

1446 
IEEE80211_STYPE_PROBE_RESP
);

1447 
	`memıy
(
hdr
->
da
, 
mgmt
->
§
, 
ETH_ALEN
);

1448 
	`IEEE80211_SKB_CB
(
´e¥
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1449 
	`›“80211_tx_skb
(
sd©a
, 
´e¥
);

1450 
out
:

1451 
	`rcu_»ad_uÆock
();

1452 
ä“
:

1453 
	`kä“
(
–ems
);

1454 
	}
}

1456 
	$›“80211_mesh_rx_bú_´e¥
(
›“80211_sub_if_d©a
 *
sd©a
,

1457 
u16
 
¡y³
,

1458 
›“80211_mgmt
 *
mgmt
,

1459 
size_t
 
Ën
,

1460 
›“80211_rx_¡©us
 *
rx_¡©us
)

1462 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1463 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1464 
›“802_11_–ems
 *
–ems
;

1465 
›“80211_chªÃl
 *
chªÃl
;

1466 
size_t
 
ba£Ën
;

1467 
äeq
;

1468 
Æ80211_bªd
 
bªd
 = 
rx_¡©us
->band;

1471 ià(
¡y³
 =ğ
IEEE80211_STYPE_PROBE_RESP
 &&

1472 !
	`‘h”_addr_equ®
(
mgmt
->
da
, 
sd©a
->
vif
.
addr
))

1475 
ba£Ën
 = (
u8
 *è
mgmt
->
u
.
´obe_»¥
.
v¬ŸbË
 - (u8 *) mgmt;

1476 ià(
ba£Ën
 > 
Ën
)

1479 
–ems
 = 
	`›“802_11_·r£_–ems
(
mgmt
->
u
.
´obe_»¥
.
v¬ŸbË
,

1480 
Ën
 - 
ba£Ën
,

1481 
çl£
, 
NULL
);

1482 ià(!
–ems
)

1486 ià((!
–ems
->
mesh_id
 || !–ems->
mesh_cÚfig
) ||

1487 (
–ems
->
r¢
 && 
sd©a
->
u
.
mesh
.
£cur™y
 =ğ
IEEE80211_MESH_SEC_NONE
) ||

1488 (!
–ems
->
r¢
 && 
sd©a
->
u
.
mesh
.
£cur™y
 !ğ
IEEE80211_MESH_SEC_NONE
))

1489 
ä“
;

1491 ià(
–ems
->
ds_·¿ms
)

1492 
äeq
 = 
	`›“80211_chªÃl_to_äequ’cy
(
–ems
->
ds_·¿ms
[0], 
bªd
);

1494 
äeq
 = 
rx_¡©us
->freq;

1496 
chªÃl
 = 
	`›“80211_g‘_chªÃl
(
loÿl
->
hw
.
why
, 
äeq
);

1498 ià(!
chªÃl
 || chªÃl->
æags
 & 
IEEE80211_CHAN_DISABLED
)

1499 
ä“
;

1501 ià(
	`mesh_m©ches_loÿl
(
sd©a
, 
–ems
)) {

1502 
	`m¶_dbg
(
sd©a
, "rssi_threshold=%d,rx_status->signal=%d\n",

1503 
sd©a
->
u
.
mesh
.
mshcfg
.
rssi_th»shŞd
, 
rx_¡©us
->
sigÇl
);

1504 ià(!
sd©a
->
u
.
mesh
.
u£r_mpm
 ||

1505 
sd©a
->
u
.
mesh
.
mshcfg
.
rssi_th»shŞd
 == 0 ||

1506 
sd©a
->
u
.
mesh
.
mshcfg
.
rssi_th»shŞd
 < 
rx_¡©us
->
sigÇl
)

1507 
	`mesh_Ãighbour_upd©e
(
sd©a
, 
mgmt
->
§
, 
–ems
,

1508 
rx_¡©us
);

1510 ià(
ifmsh
->
c§_rŞe
 !ğ
IEEE80211_MESH_CSA_ROLE_INIT
 &&

1511 !
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
)

1512 
	`›“80211_mesh_´oûss_chnsw™ch
(
sd©a
, 
–ems
, 
Œue
);

1515 ià(
ifmsh
->
sync_İs
)

1516 
ifmsh
->
sync_İs
->
	`rx_bú_´e¥
(
sd©a
, 
¡y³
, 
mgmt
, 
Ën
,

1517 
–ems
->
mesh_cÚfig
, 
rx_¡©us
);

1518 
ä“
:

1519 
	`kä“
(
–ems
);

1520 
	}
}

1522 
	$›“80211_mesh_fšish_c§
(
›“80211_sub_if_d©a
 *
sd©a
, 
u64
 *
chªged
)

1524 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1525 
mesh_c§_£‰šgs
 *
tmp_c§_£‰šgs
;

1526 
»t
 = 0;

1529 
ifmsh
->
c§_rŞe
 = 
IEEE80211_MESH_CSA_ROLE_NONE
;

1530 
ifmsh
->
chsw_‰l
 = 0;

1533 
tmp_c§_£‰šgs
 = 
	`sd©a_d”eã»nû
(
ifmsh
->
c§
, 
sd©a
);

1534 
	`RCU_INIT_POINTER
(
ifmsh
->
c§
, 
NULL
);

1535 ià(
tmp_c§_£‰šgs
)

1536 
	`kä“_rcu
(
tmp_c§_£‰šgs
, 
rcu_h—d
);

1537 
»t
 = 
	`›“80211_mesh_»bud_b—cÚ
(
sd©a
);

1538 ià(
»t
)

1539  -
EINVAL
;

1541 *
chªged
 |ğ
BSS_CHANGED_BEACON
;

1543 
	`mc§_dbg
(
sd©a
, "complete switchingo center freq %d MHz",

1544 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
chª
->
ûÁ”_äeq
);

1546 
	}
}

1548 
	$›“80211_mesh_c§_b—cÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1549 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
,

1550 
u64
 *
chªged
)

1552 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1553 
mesh_c§_£‰šgs
 *
tmp_c§_£‰šgs
;

1554 
»t
 = 0;

1556 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1558 
tmp_c§_£‰šgs
 = 
	`km®loc
((*tmp_csa_settings),

1559 
GFP_ATOMIC
);

1560 ià(!
tmp_c§_£‰šgs
)

1561  -
ENOMEM
;

1563 
	`memıy
(&
tmp_c§_£‰šgs
->
£‰šgs
, 
c§_£‰šgs
,

1564 (
cfg80211_c§_£‰šgs
));

1566 
	`rcu_assign_poš‹r
(
ifmsh
->
c§
, 
tmp_c§_£‰šgs
);

1568 
»t
 = 
	`›“80211_mesh_»bud_b—cÚ
(
sd©a
);

1569 ià(
»t
) {

1570 
tmp_c§_£‰šgs
 = 
	`rcu_d”eã»nû
(
ifmsh
->
c§
);

1571 
	`RCU_INIT_POINTER
(
ifmsh
->
c§
, 
NULL
);

1572 
	`kä“_rcu
(
tmp_c§_£‰šgs
, 
rcu_h—d
);

1573  
»t
;

1576 *
chªged
 |ğ
BSS_CHANGED_BEACON
;

1578 
	}
}

1580 
	$mesh_fwd_c§_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

1581 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

1582 
›“802_11_–ems
 *
–ems
)

1584 
›“80211_mgmt
 *
mgmt_fwd
;

1585 
sk_buff
 *
skb
;

1586 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1588 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
Ën
);

1589 ià(!
skb
)

1590  -
ENOMEM
;

1591 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

1592 
mgmt_fwd
 = 
	`skb_put
(
skb
, 
Ën
);

1594 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_‰l
--;

1595 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_æags
 &=

1596 ~
WLAN_EID_CHAN_SWITCH_PARAM_INITIATOR
;

1598 
	`memıy
(
mgmt_fwd
, 
mgmt
, 
Ën
);

1599 
	`‘h_brßdÿ¡_addr
(
mgmt_fwd
->
da
);

1600 
	`memıy
(
mgmt_fwd
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1601 
	`memıy
(
mgmt_fwd
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1603 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1605 
	}
}

1607 
	$mesh_rx_c§_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

1608 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

1610 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1611 
›“802_11_–ems
 *
–ems
;

1612 
u16
 
´e_v®ue
;

1613 
boŞ
 
fwd_c§
 = 
Œue
;

1614 
size_t
 
ba£Ën
;

1615 
u8
 *
pos
;

1617 ià(
mgmt
->
u
.
aùiÚ
.u.
m—su»m’t
.
aùiÚ_code
 !=

1618 
WLAN_ACTION_SPCT_CHL_SWITCH
)

1621 
pos
 = 
mgmt
->
u
.
aùiÚ
.u.
chª_sw™ch
.
v¬ŸbË
;

1622 
ba£Ën
 = 
	`off£tof
(
›“80211_mgmt
,

1623 
u
.
aùiÚ
.u.
chª_sw™ch
.
v¬ŸbË
);

1624 
–ems
 = 
	`›“802_11_·r£_–ems
(
pos
, 
Ën
 - 
ba£Ën
, 
Œue
, 
NULL
);

1625 ià(!
–ems
)

1628 ià(!
	`mesh_m©ches_loÿl
(
sd©a
, 
–ems
))

1629 
ä“
;

1631 
ifmsh
->
chsw_‰l
 = 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_‰l
;

1632 ià(!--
ifmsh
->
chsw_‰l
)

1633 
fwd_c§
 = 
çl£
;

1635 
´e_v®ue
 = 
	`Ë16_to_ıu
(
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_´e_v®ue
);

1636 ià(
ifmsh
->
´e_v®ue
 >=…re_value)

1637 
ä“
;

1639 
ifmsh
->
´e_v®ue
 =…re_value;

1641 ià(!
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 &&

1642 !
	`›“80211_mesh_´oûss_chnsw™ch
(
sd©a
, 
–ems
, 
çl£
)) {

1643 
	`mc§_dbg
(
sd©a
, "Failedo…rocess CSA‡ction frame");

1644 
ä“
;

1648 ià(
fwd_c§
) {

1649 ià(
	`mesh_fwd_c§_äame
(
sd©a
, 
mgmt
, 
Ën
, 
–ems
) < 0)

1650 
	`mc§_dbg
(
sd©a
, "Failedo forwardhe CSA frame");

1652 
ä“
:

1653 
	`kä“
(
–ems
);

1654 
	}
}

1656 
	$›“80211_mesh_rx_mgmt_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1657 
›“80211_mgmt
 *
mgmt
,

1658 
size_t
 
Ën
,

1659 
›“80211_rx_¡©us
 *
rx_¡©us
)

1661 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
) {

1662 
WLAN_CATEGORY_SELF_PROTECTED
:

1663 
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
aùiÚ_code
) {

1664 
WLAN_SP_MESH_PEERING_OPEN
:

1665 
WLAN_SP_MESH_PEERING_CLOSE
:

1666 
WLAN_SP_MESH_PEERING_CONFIRM
:

1667 
	`mesh_rx_¶šk_äame
(
sd©a
, 
mgmt
, 
Ën
, 
rx_¡©us
);

1671 
WLAN_CATEGORY_MESH_ACTION
:

1672 ià(
	`mesh_aùiÚ_is_·th_£l
(
mgmt
))

1673 
	`mesh_rx_·th_£l_äame
(
sd©a
, 
mgmt
, 
Ën
);

1675 
WLAN_CATEGORY_SPECTRUM_MGMT
:

1676 
	`mesh_rx_c§_äame
(
sd©a
, 
mgmt
, 
Ën
);

1679 
	}
}

1681 
	$›“80211_mesh_rx_queued_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

1682 
sk_buff
 *
skb
)

1684 
›“80211_rx_¡©us
 *
rx_¡©us
;

1685 
›“80211_mgmt
 *
mgmt
;

1686 
u16
 
¡y³
;

1688 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1691 ià(!
sd©a
->
u
.
mesh
.
mesh_id_Ën
)

1694 
rx_¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1695 
mgmt
 = (
›“80211_mgmt
 *è
skb
->
d©a
;

1696 
¡y³
 = 
	`Ë16_to_ıu
(
mgmt
->
äame_cÚŒŞ
è& 
IEEE80211_FCTL_STYPE
;

1698 
¡y³
) {

1699 
IEEE80211_STYPE_PROBE_RESP
:

1700 
IEEE80211_STYPE_BEACON
:

1701 
	`›“80211_mesh_rx_bú_´e¥
(
sd©a
, 
¡y³
, 
mgmt
, 
skb
->
Ën
,

1702 
rx_¡©us
);

1704 
IEEE80211_STYPE_PROBE_REQ
:

1705 
	`›“80211_mesh_rx_´obe_»q
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

1707 
IEEE80211_STYPE_ACTION
:

1708 
	`›“80211_mesh_rx_mgmt_aùiÚ
(
sd©a
, 
mgmt
, 
skb
->
Ën
, 
rx_¡©us
);

1711 
	}
}

1713 
	$mesh_bss_šfo_chªged
(
›“80211_sub_if_d©a
 *
sd©a
)

1715 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1716 
u32
 
b™
;

1717 
u64
 
chªged
 = 0;

1719 
	`fÜ_—ch_£t_b™
(
b™
, 
ifmsh
->
mbss_chªged
,

1720 (
chªged
è* 
BITS_PER_BYTE
) {

1721 
	`ş—r_b™
(
b™
, 
ifmsh
->
mbss_chªged
);

1722 
chªged
 |ğ
	`BIT
(
b™
);

1725 ià(
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 &&

1726 (
chªged
 & (
BSS_CHANGED_BEACON
 |

1727 
BSS_CHANGED_HT
 |

1728 
BSS_CHANGED_BASIC_RATES
 |

1729 
BSS_CHANGED_BEACON_INT
)))

1730 ià(
	`›“80211_mesh_»bud_b—cÚ
(
sd©a
))

1733 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
, 
chªged
);

1734 
	}
}

1736 
	$›“80211_mesh_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
)

1738 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1740 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1743 ià(!
sd©a
->
u
.
mesh
.
mesh_id_Ën
)

1746 ià(
ifmsh
->
´eq_queue_Ën
 &&

1747 
	`time_aá”
(
jiff›s
,

1748 
ifmsh
->
Ï¡_´eq
 + 
	`m£cs_to_jiff›s
(ifmsh->
mshcfg
.
dÙ11MeshHWMP´eqMšIÁ”v®
)))

1749 
	`mesh_·th_¡¬t_discov”y
(
sd©a
);

1751 ià(
	`‹¡_ªd_ş—r_b™
(
MESH_WORK_HOUSEKEEPING
, &
ifmsh
->
wrkq_æags
))

1752 
	`›“80211_mesh_hou£k“pšg
(
sd©a
);

1754 ià(
	`‹¡_ªd_ş—r_b™
(
MESH_WORK_ROOT
, &
ifmsh
->
wrkq_æags
))

1755 
	`›“80211_mesh_roÙ·th
(
sd©a
);

1757 ià(
	`‹¡_ªd_ş—r_b™
(
MESH_WORK_DRIFT_ADJUST
, &
ifmsh
->
wrkq_æags
))

1758 
	`mesh_sync_adju¡_tsf
(
sd©a
);

1760 ià(
	`‹¡_ªd_ş—r_b™
(
MESH_WORK_MBSS_CHANGED
, &
ifmsh
->
wrkq_æags
))

1761 
	`mesh_bss_šfo_chªged
(
sd©a
);

1762 
	}
}

1765 
	$›“80211_mesh_š™_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

1767 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1768 
u8
 
z”o_addr
[
ETH_ALEN
] = {};

1770 
	`tim”_£tup
(&
ifmsh
->
hou£k“pšg_tim”
,

1771 
›“80211_mesh_hou£k“pšg_tim”
, 0);

1773 
ifmsh
->
acû±šg_¶šks
 = 
Œue
;

1774 
	`©omic_£t
(&
ifmsh
->
m·ths
, 0);

1775 
	`mesh_rmc_š™
(
sd©a
);

1776 
ifmsh
->
Ï¡_´eq
 = 
jiff›s
;

1777 
ifmsh
->
Ãxt_³¼
 = 
jiff›s
;

1778 
ifmsh
->
c§_rŞe
 = 
IEEE80211_MESH_CSA_ROLE_NONE
;

1780 ià(!
mesh_®loÿ‹d
)

1781 
	`›“80211s_š™
();

1783 
	`mesh_·thtbl_š™
(
sd©a
);

1785 
	`tim”_£tup
(&
ifmsh
->
mesh_·th_tim”
, 
›“80211_mesh_·th_tim”
, 0);

1786 
	`tim”_£tup
(&
ifmsh
->
mesh_·th_roÙ_tim”
,

1787 
›“80211_mesh_·th_roÙ_tim”
, 0);

1788 
	`INIT_LIST_HEAD
(&
ifmsh
->
´eq_queue
.
li¡
);

1789 
	`skb_queue_h—d_š™
(&
ifmsh
->
ps
.
bc_buf
);

1790 
	`¥š_lock_š™
(&
ifmsh
->
mesh_´eq_queue_lock
);

1791 
	`¥š_lock_š™
(&
ifmsh
->
sync_off£t_lock
);

1792 
	`RCU_INIT_POINTER
(
ifmsh
->
b—cÚ
, 
NULL
);

1794 
sd©a
->
vif
.
bss_cÚf
.
bssid
 = 
z”o_addr
;

1795 
	}
}

1797 
	$›“80211_mesh_‹¬down_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

1799 
	`mesh_rmc_ä“
(
sd©a
);

1800 
	`mesh_·thtbl_uÄegi¡”
(
sd©a
);

1801 
	}
}

	@mesh.h

9 #iâdeà
IEEE80211S_H


10 
	#IEEE80211S_H


	)

12 
	~<lšux/ty³s.h
>

13 
	~<lšux/jhash.h
>

14 
	~"›“80211_i.h
"

37 
	emesh_·th_æags
 {

38 
	mMESH_PATH_ACTIVE
 = 
BIT
(0),

39 
	mMESH_PATH_RESOLVING
 = 
BIT
(1),

40 
	mMESH_PATH_SN_VALID
 = 
BIT
(2),

41 
	mMESH_PATH_FIXED
 = 
BIT
(3),

42 
	mMESH_PATH_RESOLVED
 = 
BIT
(4),

43 
	mMESH_PATH_REQ_QUEUED
 = 
BIT
(5),

44 
	mMESH_PATH_DELETED
 = 
BIT
(6),

58 
	emesh_deã¼ed_sk_æags
 {

59 
	mMESH_WORK_HOUSEKEEPING
,

60 
	mMESH_WORK_ROOT
,

61 
	mMESH_WORK_DRIFT_ADJUST
,

62 
	mMESH_WORK_MBSS_CHANGED
,

105 
	smesh_·th
 {

106 
u8
 
	md¡
[
ETH_ALEN
];

107 
u8
 
	mmµ
[
ETH_ALEN
];

108 
rhash_h—d
 
	mrhash
;

109 
hli¡_node
 
	mw®k_li¡
;

110 
hli¡_node
 
	mg©e_li¡
;

111 
›“80211_sub_if_d©a
 *
	msd©a
;

112 
¡a_šfo
 
__rcu
 *
	mÃxt_hİ
;

113 
tim”_li¡
 
	mtim”
;

114 
sk_buff_h—d
 
	mäame_queue
;

115 
rcu_h—d
 
	mrcu
;

116 
u32
 
	m¢
;

117 
u32
 
	mm‘ric
;

118 
u8
 
	mhİ_couÁ
;

119 
	mexp_time
;

120 
u32
 
	mdiscov”y_timeout
;

121 
u8
 
	mdiscov”y_»Œ›s
;

122 
mesh_·th_æags
 
	mæags
;

123 
¥šlock_t
 
	m¡©e_lock
;

124 
u8
 
	m¿Â_¢d_addr
[
ETH_ALEN
];

125 
u32
 
	m¿Â_m‘ric
;

126 
	mÏ¡_´eq_to_roÙ
;

127 
	mç¡_tx_check
;

128 
boŞ
 
	mis_roÙ
;

129 
boŞ
 
	mis_g©e
;

130 
u32
 
	m·th_chªge_couÁ
;

133 
	#MESH_FAST_TX_CACHE_MAX_SIZE
 512

	)

134 
	#MESH_FAST_TX_CACHE_THRESHOLD_SIZE
 384

	)

135 
	#MESH_FAST_TX_CACHE_TIMEOUT
 8000

	)

145 
	e›“80211_mesh_ç¡_tx_ty³
 {

146 
	mMESH_FAST_TX_TYPE_LOCAL
,

147 
	mMESH_FAST_TX_TYPE_PROXIED
,

148 
	mMESH_FAST_TX_TYPE_FORWARDED
,

151 
	mNUM_MESH_FAST_TX_TYPE


161 
	s›“80211_mesh_ç¡_tx_key
 {

162 
u8
 
	maddr
[
ETH_ALEN
] 
__®igÃd
(2);

163 
u16
 
	mty³
;

178 
	s›“80211_mesh_ç¡_tx
 {

179 
rhash_h—d
 
	mrhash
;

180 
›“80211_mesh_ç¡_tx_key
 
	mkey
;

182 
›“80211_ç¡_tx
 
	mç¡_tx
;

183 
u8
 
	mhdr
[(
›“80211s_hdr
è+ (
rfc1042_h—d”
)];

184 
u16
 
	mhd¾’
;

186 
mesh_·th
 *
	mm·th
, *
	mmµ©h
;

187 
hli¡_node
 
	mw®k_li¡
;

188 
	mtime¡amp
;

193 
	#RMC_BUCKETS
 256

	)

194 
	#RMC_QUEUE_MAX_LEN
 4

	)

195 
	#RMC_TIMEOUT
 (3 * 
HZ
)

	)

209 
	srmc_’Œy
 {

210 
hli¡_node
 
	mli¡
;

211 
	mexp_time
;

212 
u32
 
	m£qnum
;

213 
u8
 
	m§
[
ETH_ALEN
];

216 
	smesh_rmc
 {

217 
hli¡_h—d
 
	mbuck‘
[
RMC_BUCKETS
];

218 
u32
 
	midx_mask
;

221 
	#IEEE80211_MESH_HOUSEKEEPING_INTERVAL
 (60 * 
HZ
)

	)

223 
	#MESH_PATH_EXPIRE
 (600 * 
HZ
)

	)

226 
	#MESH_MAX_PLINKS
 256

	)

229 
	#MESH_MAX_MPATHS
 1024

	)

232 
	#MESH_FRAME_QUEUE_LEN
 10

	)

236 
›“80211_fl_mesh_add»s£s
(
›“80211_hdr
 *
hdr
, 
__Ë16
 *
fc
,

237 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
§
);

238 
›“80211_Ãw_mesh_h—d”
(
›“80211_sub_if_d©a
 *
sd©a
,

239 
›“80211s_hdr
 *
meshhdr
,

240 cÚ¡ *
addr4Ü5
, cÚ¡ *
addr6
);

241 
mesh_rmc_check
(
›“80211_sub_if_d©a
 *
sd©a
,

242 cÚ¡ 
u8
 *
addr
, 
›“80211s_hdr
 *
mesh_hdr
);

243 
boŞ
 
mesh_m©ches_loÿl
(
›“80211_sub_if_d©a
 *
sd©a
,

244 
›“802_11_–ems
 *
›
);

245 
mesh_add_meshcÚf_›
(
›“80211_sub_if_d©a
 *
sd©a
,

246 
sk_buff
 *
skb
);

247 
mesh_add_meshid_›
(
›“80211_sub_if_d©a
 *
sd©a
,

248 
sk_buff
 *
skb
);

249 
mesh_add_r¢_›
(
›“80211_sub_if_d©a
 *
sd©a
,

250 
sk_buff
 *
skb
);

251 
mesh_add_v’dÜ_›s
(
›“80211_sub_if_d©a
 *
sd©a
,

252 
sk_buff
 *
skb
);

253 
mesh_add_ht_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

254 
sk_buff
 *
skb
);

255 
mesh_add_ht_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

256 
sk_buff
 *
skb
);

257 
mesh_add_vht_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

258 
sk_buff
 *
skb
);

259 
mesh_add_vht_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

260 
sk_buff
 *
skb
);

261 
mesh_add_he_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

262 
sk_buff
 *
skb
, 
u8
 
›_Ën
);

263 
mesh_add_he_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

264 
sk_buff
 *
skb
);

265 
mesh_add_he_6ghz_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

266 
sk_buff
 *
skb
);

267 
mesh_add_eht_ÿp_›
(
›“80211_sub_if_d©a
 *
sd©a
,

268 
sk_buff
 *
skb
, 
u8
 
›_Ën
);

269 
mesh_add_eht_İ”_›
(
›“80211_sub_if_d©a
 *
sd©a
,

270 
sk_buff
 *
skb
);

271 
mesh_rmc_ä“
(
›“80211_sub_if_d©a
 *
sd©a
);

272 
mesh_rmc_š™
(
›“80211_sub_if_d©a
 *
sd©a
);

273 
›“80211s_š™
();

274 
›“80211s_upd©e_m‘ric
(
›“80211_loÿl
 *
loÿl
,

275 
¡a_šfo
 *
¡a
,

276 
›“80211_tx_¡©us
 *
¡
);

277 
›“80211_mesh_š™_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
);

278 
›“80211_mesh_‹¬down_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
);

279 
›“80211_¡¬t_mesh
(
›“80211_sub_if_d©a
 *
sd©a
);

280 
›“80211_¡İ_mesh
(
›“80211_sub_if_d©a
 *
sd©a
);

281 
›“80211_mesh_roÙ_£tup
(
›“80211_if_mesh
 *
ifmsh
);

282 cÚ¡ 
›“80211_mesh_sync_İs
 *
›“80211_mesh_sync_İs_g‘
(
u8
 
m‘hod
);

284 
›“80211_mbss_šfo_chªge_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

285 
u64
 
chªged
);

288 
u64
 
›“80211_mps_loÿl_¡©us_upd©e
(
›“80211_sub_if_d©a
 *
sd©a
);

289 
u64
 
›“80211_mps_£t_¡a_loÿl_pm
(
¡a_šfo
 *
¡a
,

290 
Æ80211_mesh_pow”_mode
 
pm
);

291 
›“80211_mps_£t_äame_æags
(
›“80211_sub_if_d©a
 *
sd©a
,

292 
¡a_šfo
 *
¡a
,

293 
›“80211_hdr
 *
hdr
);

294 
›“80211_mps_¡a_¡©us_upd©e
(
¡a_šfo
 *
¡a
);

295 
›“80211_mps_rx_h_¡a_´oûss
(
¡a_šfo
 *
¡a
,

296 
›“80211_hdr
 *
hdr
);

297 
›“80211_mp¥_Œigg”_´oûss
(
u8
 *
qc
, 
¡a_šfo
 *
¡a
,

298 
boŞ
 
tx
, boŞ 
acked
);

299 
›“80211_mps_äame_»Ëa£
(
¡a_šfo
 *
¡a
,

300 
›“802_11_–ems
 *
–ems
);

303 
mesh_Ãxthİ_lookup
(
›“80211_sub_if_d©a
 *
sd©a
,

304 
sk_buff
 *
skb
);

305 
mesh_Ãxthİ_»sŞve
(
›“80211_sub_if_d©a
 *
sd©a
,

306 
sk_buff
 *
skb
);

307 
mesh_·th_¡¬t_discov”y
(
›“80211_sub_if_d©a
 *
sd©a
);

308 
mesh_·th
 *
mesh_·th_lookup
(
›“80211_sub_if_d©a
 *
sd©a
,

309 cÚ¡ 
u8
 *
d¡
);

310 
mesh_·th
 *
mµ_·th_lookup
(
›“80211_sub_if_d©a
 *
sd©a
,

311 cÚ¡ 
u8
 *
d¡
);

312 
mµ_·th_add
(
›“80211_sub_if_d©a
 *
sd©a
,

313 cÚ¡ 
u8
 *
d¡
, cÚ¡ u8 *
mµ
);

314 
mesh_·th
 *

315 
mesh_·th_lookup_by_idx
(
›“80211_sub_if_d©a
 *
sd©a
, 
idx
);

316 
mesh_·th
 *

317 
mµ_·th_lookup_by_idx
(
›“80211_sub_if_d©a
 *
sd©a
, 
idx
);

318 
mesh_·th_fix_Ãxthİ
(
mesh_·th
 *
m·th
, 
¡a_šfo
 *
Ãxt_hİ
);

319 
mesh_·th_expœe
(
›“80211_sub_if_d©a
 *
sd©a
);

320 
mesh_rx_·th_£l_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

321 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
);

322 
mesh_·th
 *

323 
mesh_·th_add
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
d¡
);

325 
mesh_·th_add_g©e
(
mesh_·th
 *
m·th
);

326 
mesh_·th_£nd_to_g©es
(
mesh_·th
 *
m·th
);

327 
mesh_g©e_num
(
›“80211_sub_if_d©a
 *
sd©a
);

328 
u32
 
aœtime_lšk_m‘ric_g‘
(
›“80211_loÿl
 *
loÿl
,

329 
¡a_šfo
 *
¡a
);

332 
mesh_Ãighbour_upd©e
(
›“80211_sub_if_d©a
 *
sd©a
,

333 
u8
 *
hw_addr
, 
›“802_11_–ems
 *
›
,

334 
›“80211_rx_¡©us
 *
rx_¡©us
);

335 
boŞ
 
mesh_³”_acû±s_¶šks
(
›“802_11_–ems
 *
›
);

336 
u64
 
mesh_acû±_¶šks_upd©e
(
›“80211_sub_if_d©a
 *
sd©a
);

337 
mesh_¶šk_tim”
(
tim”_li¡
 *
t
);

338 
mesh_¶šk_brok’
(
¡a_šfo
 *
¡a
);

339 
u64
 
mesh_¶šk_d—ùiv©e
(
¡a_šfo
 *
¡a
);

340 
u64
 
mesh_¶šk_İ’
(
¡a_šfo
 *
¡a
);

341 
u64
 
mesh_¶šk_block
(
¡a_šfo
 *
¡a
);

342 
mesh_rx_¶šk_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

343 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

344 
›“80211_rx_¡©us
 *
rx_¡©us
);

345 
mesh_¡a_ş—nup
(
¡a_šfo
 *
¡a
);

349 
mesh_·th_”rÜ_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

350 
u8
 
‰l
, cÚ¡ u8 *
rg‘
, 
u32
 
rg‘_¢
,

351 
u16
 
rg‘_rcode
, cÚ¡ 
u8
 *
¿
);

352 
mesh_·th_assign_Ãxthİ
(
mesh_·th
 *
m·th
, 
¡a_šfo
 *
¡a
);

353 
mesh_·th_æush_³ndšg
(
mesh_·th
 *
m·th
);

354 
mesh_·th_tx_³ndšg
(
mesh_·th
 *
m·th
);

355 
mesh_·thtbl_š™
(
›“80211_sub_if_d©a
 *
sd©a
);

356 
mesh_·thtbl_uÄegi¡”
(
›“80211_sub_if_d©a
 *
sd©a
);

357 
mesh_·th_d–
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
addr
);

358 
mesh_·th_tim”
(
tim”_li¡
 *
t
);

359 
mesh_·th_æush_by_Ãxthİ
(
¡a_šfo
 *
¡a
);

360 
mesh_·th_disÿrd_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

361 
sk_buff
 *
skb
);

362 
mesh_·th_tx_roÙ_äame
(
›“80211_sub_if_d©a
 *
sd©a
);

364 
boŞ
 
mesh_aùiÚ_is_·th_£l
(
›“80211_mgmt
 *
mgmt
);

365 
›“80211_mesh_ç¡_tx
 *

366 
mesh_ç¡_tx_g‘
(
›“80211_sub_if_d©a
 *
sd©a
,

367 
›“80211_mesh_ç¡_tx_key
 *
key
);

368 
boŞ
 
›“80211_mesh_xm™_ç¡
(
›“80211_sub_if_d©a
 *
sd©a
,

369 
sk_buff
 *
skb
, 
u32
 
ù¾_æags
);

370 
mesh_ç¡_tx_ÿche
(
›“80211_sub_if_d©a
 *
sd©a
,

371 
sk_buff
 *
skb
, 
mesh_·th
 *
m·th
);

372 
mesh_ç¡_tx_gc
(
›“80211_sub_if_d©a
 *
sd©a
);

373 
mesh_ç¡_tx_æush_addr
(
›“80211_sub_if_d©a
 *
sd©a
,

374 cÚ¡ 
u8
 *
addr
);

375 
mesh_ç¡_tx_æush_m·th
(
mesh_·th
 *
m·th
);

376 
mesh_ç¡_tx_æush_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

377 
¡a_šfo
 *
¡a
);

378 
mesh_·th_»äesh
(
›“80211_sub_if_d©a
 *
sd©a
,

379 
mesh_·th
 *
m·th
, cÚ¡ 
u8
 *
addr
);

381 #ifdeà
CONFIG_MAC80211_MESH


382 
šlše


383 
u64
 
	$mesh_¶šk_šc_e¡ab_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
)

385 
	`©omic_šc
(&
sd©a
->
u
.
mesh
.
e¡ab_¶šks
);

386  
	`mesh_acû±_¶šks_upd©e
(
sd©a
è| 
BSS_CHANGED_BEACON
;

387 
	}
}

389 
šlše


390 
u64
 
	$mesh_¶šk_dec_e¡ab_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
)

392 
	`©omic_dec
(&
sd©a
->
u
.
mesh
.
e¡ab_¶šks
);

393  
	`mesh_acû±_¶šks_upd©e
(
sd©a
è| 
BSS_CHANGED_BEACON
;

394 
	}
}

396 
šlše
 
	$mesh_¶šk_ä“_couÁ
(
›“80211_sub_if_d©a
 *
sd©a
)

398  
sd©a
->
u
.
mesh
.
mshcfg
.
dÙ11MeshMaxP“rLšks
 -

399 
	`©omic_»ad
(&
sd©a
->
u
.
mesh
.
e¡ab_¶šks
);

400 
	}
}

402 
šlše
 
boŞ
 
	$mesh_¶šk_avaabËs
(
›“80211_sub_if_d©a
 *
sd©a
)

404  (
	`mš_t
(, 
	`mesh_¶šk_ä“_couÁ
(
sd©a
),

405 
MESH_MAX_PLINKS
 - 
sd©a
->
loÿl
->
num_¡a
)) > 0;

406 
	}
}

408 
šlše
 
	$mesh_·th_aùiv©e
(
mesh_·th
 *
m·th
)

410 
m·th
->
æags
 |ğ
MESH_PATH_ACTIVE
 | 
MESH_PATH_RESOLVED
;

411 
	}
}

413 
šlše
 
boŞ
 
	$mesh_·th_£l_is_hwmp
(
›“80211_sub_if_d©a
 *
sd©a
)

415  
sd©a
->
u
.
mesh
.
mesh_µ_id
 =ğ
IEEE80211_PATH_PROTOCOL_HWMP
;

416 
	}
}

418 
mesh_·th_æush_by_içû
(
›“80211_sub_if_d©a
 *
sd©a
);

419 
mesh_sync_adju¡_tsf
(
›“80211_sub_if_d©a
 *
sd©a
);

420 
›“80211s_¡İ
();

422 
šlše
 
boŞ
 
	$mesh_·th_£l_is_hwmp
(
›“80211_sub_if_d©a
 *
sd©a
)

423 {  
çl£
; 
	}
}

424 
šlše
 
	$mesh_·th_æush_by_içû
(
›“80211_sub_if_d©a
 *
sd©a
)

425 {
	}
}

426 
šlše
 
	$›“80211s_¡İ
(è{
	}
}

	@mesh_hwmp.c

8 
	~<lšux/¦ab.h
>

9 
	~<lšux/‘h”deviû.h
>

10 
	~<asm/uÇligÃd.h
>

11 
	~"wme.h
"

12 
	~"mesh.h
"

14 
	#TEST_FRAME_LEN
 8192

	)

15 
	#MAX_METRIC
 0xffffffff

	)

16 
	#ARITH_SHIFT
 8

	)

17 
	#LINK_FAIL_THRESH
 95

	)

19 
	#MAX_PREQ_QUEUE_LEN
 64

	)

21 
mesh_queue_´eq
(
mesh_·th
 *, 
u8
);

23 
šlše
 
u32
 
	$u32_f›ld_g‘
(cÚ¡ 
u8
 *
´eq_–em
, 
off£t
, 
boŞ
 
«
)

25 ià(
«
)

26 
off£t
 += 6;

27  
	`g‘_uÇligÃd_Ë32
(
´eq_–em
 + 
off£t
);

28 
	}
}

30 
šlše
 
u16
 
	$u16_f›ld_g‘
(cÚ¡ 
u8
 *
´eq_–em
, 
off£t
, 
boŞ
 
«
)

32 ià(
«
)

33 
off£t
 += 6;

34  
	`g‘_uÇligÃd_Ë16
(
´eq_–em
 + 
off£t
);

35 
	}
}

38 
	#AE_F
 (1<<6)

	)

39 
	#AE_F_SET
(
x
è(*x & 
AE_F
)

	)

40 
	#PREQ_IE_FLAGS
(
x
è(*(x))

	)

41 
	#PREQ_IE_HOPCOUNT
(
x
è(*(x + 1))

	)

42 
	#PREQ_IE_TTL
(
x
è(*(x + 2))

	)

43 
	#PREQ_IE_PREQ_ID
(
x
è
	`u32_f›ld_g‘
(x, 3, 0)

	)

44 
	#PREQ_IE_ORIG_ADDR
(
x
è(x + 7)

	)

45 
	#PREQ_IE_ORIG_SN
(
x
è
	`u32_f›ld_g‘
(x, 13, 0)

	)

46 
	#PREQ_IE_LIFETIME
(
x
è
	`u32_f›ld_g‘
(x, 17, 
	`AE_F_SET
(x))

	)

47 
	#PREQ_IE_METRIC
(
x
è
	`u32_f›ld_g‘
(x, 21, 
	`AE_F_SET
(x))

	)

48 
	#PREQ_IE_TARGET_F
(
x
è(*(
	`AE_F_SET
(xè? x + 32 : x + 26))

	)

49 
	#PREQ_IE_TARGET_ADDR
(
x
è(
	`AE_F_SET
(xè? x + 33 : x + 27)

	)

50 
	#PREQ_IE_TARGET_SN
(
x
è
	`u32_f›ld_g‘
(x, 33, 
	`AE_F_SET
(x))

	)

53 
	#PREP_IE_FLAGS
(
x
è
	`PREQ_IE_FLAGS
(x)

	)

54 
	#PREP_IE_HOPCOUNT
(
x
è
	`PREQ_IE_HOPCOUNT
(x)

	)

55 
	#PREP_IE_TTL
(
x
è
	`PREQ_IE_TTL
(x)

	)

56 
	#PREP_IE_ORIG_ADDR
(
x
è(
	`AE_F_SET
(xè? x + 27 : x + 21)

	)

57 
	#PREP_IE_ORIG_SN
(
x
è
	`u32_f›ld_g‘
(x, 27, 
	`AE_F_SET
(x))

	)

58 
	#PREP_IE_LIFETIME
(
x
è
	`u32_f›ld_g‘
(x, 13, 
	`AE_F_SET
(x))

	)

59 
	#PREP_IE_METRIC
(
x
è
	`u32_f›ld_g‘
(x, 17, 
	`AE_F_SET
(x))

	)

60 
	#PREP_IE_TARGET_ADDR
(
x
è(x + 3)

	)

61 
	#PREP_IE_TARGET_SN
(
x
è
	`u32_f›ld_g‘
(x, 9, 0)

	)

63 
	#PERR_IE_TTL
(
x
è(*(x))

	)

64 
	#PERR_IE_TARGET_FLAGS
(
x
è(*(x + 2))

	)

65 
	#PERR_IE_TARGET_ADDR
(
x
è(x + 3)

	)

66 
	#PERR_IE_TARGET_SN
(
x
è
	`u32_f›ld_g‘
(x, 9, 0)

	)

67 
	#PERR_IE_TARGET_RCODE
(
x
è
	`u16_f›ld_g‘
(x, 13, 0)

	)

69 
	#MSEC_TO_TU
(
x
è(x*1000/1024)

	)

70 
	#SN_GT
(
x
, 
y
è((
s32
)(y - xè< 0)

	)

71 
	#SN_LT
(
x
, 
y
è((
s32
)(x - yè< 0)

	)

72 
	#MAX_SANE_SN_DELTA
 32

	)

74 
šlše
 
u32
 
	$SN_DELTA
(
u32
 
x
, u32 
y
)

76  
x
 >ğ
y
 ? x - y : y - x;

77 
	}
}

79 
	#Ãt_Œav”§l_jiff›s
(
s
) \

80 
	`m£cs_to_jiff›s
(
s
->
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPÃtDŸm‘”T¿v”§lTime
)

	)

81 
	#deçuÉ_liãtime
(
s
) \

82 
	`MSEC_TO_TU
(
s
->
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPaùiveP©hTimeout
)

	)

83 
	#mš_´eq_št_jiff
(
s
) \

84 (
	`m£cs_to_jiff›s
(
s
->
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMP´eqMšIÁ”v®
))

	)

85 
	#max_´eq_»Œ›s
(
s
è(s->
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPmaxPREQ»Œ›s
)

	)

86 
	#disc_timeout_jiff
(
s
) \

87 
	`m£cs_to_jiff›s
(
sd©a
->
u
.
mesh
.
mshcfg
.
mš_discov”y_timeout
)

	)

88 
	#roÙ_·th_cÚfœm©iÚ_jiff›s
(
s
) \

89 
	`m£cs_to_jiff›s
(
sd©a
->
u
.
mesh
.
mshcfg
.
dÙ11MeshHWMPcÚfœm©iÚIÁ”v®
)

	)

91 
	em·th_äame_ty³
 {

92 
	mMPATH_PREQ
 = 0,

93 
	mMPATH_PREP
,

94 
	mMPATH_PERR
,

95 
	mMPATH_RANN


98 cÚ¡ 
u8
 
	gbrßdÿ¡_addr
[
ETH_ALEN
] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

100 
	$mesh_·th_£l_äame_tx
(
m·th_äame_ty³
 
aùiÚ
, 
u8
 
æags
,

101 cÚ¡ 
u8
 *
Üig_addr
, 
u32
 
Üig_¢
,

102 
u8
 
rg‘_æags
, cÚ¡ u8 *
rg‘
,

103 
u32
 
rg‘_¢
, cÚ¡ 
u8
 *
da
,

104 
u8
 
hİ_couÁ
, u8 
‰l
,

105 
u32
 
liãtime
, u32 
m‘ric
, u32 
´eq_id
,

106 
›“80211_sub_if_d©a
 *
sd©a
)

108 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

109 
sk_buff
 *
skb
;

110 
›“80211_mgmt
 *
mgmt
;

111 
u8
 *
pos
, 
›_Ën
;

112 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
,

113 
u
.
aùiÚ
.u.
mesh_aùiÚ
);

115 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 +

116 
hdr_Ën
 +

118 ià(!
skb
)

120 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

121 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

122 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

123 
IEEE80211_STYPE_ACTION
);

125 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

126 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

128 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

129 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_MESH_ACTION
;

130 
mgmt
->
u
.
aùiÚ
.u.
mesh_aùiÚ
.
aùiÚ_code
 =

131 
WLAN_MESH_ACTION_HWMP_PATH_SELECTION
;

133 
aùiÚ
) {

134 
MPATH_PREQ
:

135 
	`mhwmp_dbg
(
sd©a
, "£ndšg PREQØ%pM\n", 
rg‘
);

136 
›_Ën
 = 37;

137 
pos
 = 
	`skb_put
(
skb
, 2 + 
›_Ën
);

138 *
pos
++ = 
WLAN_EID_PREQ
;

140 
MPATH_PREP
:

141 
	`mhwmp_dbg
(
sd©a
, "£ndšg PREPØ%pM\n", 
Üig_addr
);

142 
›_Ën
 = 31;

143 
pos
 = 
	`skb_put
(
skb
, 2 + 
›_Ën
);

144 *
pos
++ = 
WLAN_EID_PREP
;

146 
MPATH_RANN
:

147 
	`mhwmp_dbg
(
sd©a
, "£ndšg RANN from %pM\n", 
Üig_addr
);

148 
›_Ën
 = (
›“80211_¿Â_›
);

149 
pos
 = 
	`skb_put
(
skb
, 2 + 
›_Ën
);

150 *
pos
++ = 
WLAN_EID_RANN
;

153 
	`kä“_skb
(
skb
);

154  -
EOPNOTSUPP
;

156 *
pos
++ = 
›_Ën
;

157 *
pos
++ = 
æags
;

158 *
pos
++ = 
hİ_couÁ
;

159 *
pos
++ = 
‰l
;

160 ià(
aùiÚ
 =ğ
MPATH_PREP
) {

161 
	`memıy
(
pos
, 
rg‘
, 
ETH_ALEN
);

162 
pos
 +ğ
ETH_ALEN
;

163 
	`put_uÇligÃd_Ë32
(
rg‘_¢
, 
pos
);

164 
pos
 += 4;

166 ià(
aùiÚ
 =ğ
MPATH_PREQ
) {

167 
	`put_uÇligÃd_Ë32
(
´eq_id
, 
pos
);

168 
pos
 += 4;

170 
	`memıy
(
pos
, 
Üig_addr
, 
ETH_ALEN
);

171 
pos
 +ğ
ETH_ALEN
;

172 
	`put_uÇligÃd_Ë32
(
Üig_¢
, 
pos
);

173 
pos
 += 4;

175 
	`put_uÇligÃd_Ë32
(
liãtime
, 
pos
);

176 
pos
 += 4;

177 
	`put_uÇligÃd_Ë32
(
m‘ric
, 
pos
);

178 
pos
 += 4;

179 ià(
aùiÚ
 =ğ
MPATH_PREQ
) {

180 *
pos
++ = 1;

181 *
pos
++ = 
rg‘_æags
;

182 
	`memıy
(
pos
, 
rg‘
, 
ETH_ALEN
);

183 
pos
 +ğ
ETH_ALEN
;

184 
	`put_uÇligÃd_Ë32
(
rg‘_¢
, 
pos
);

185 
pos
 += 4;

186 } ià(
aùiÚ
 =ğ
MPATH_PREP
) {

187 
	`memıy
(
pos
, 
Üig_addr
, 
ETH_ALEN
);

188 
pos
 +ğ
ETH_ALEN
;

189 
	`put_uÇligÃd_Ë32
(
Üig_¢
, 
pos
);

190 
pos
 += 4;

193 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

195 
	}
}

200 
	$´•¬e_äame_fÜ_deã¼ed_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

201 
sk_buff
 *
skb
)

203 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

204 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

206 
	`skb_»£t_mac_h—d”
(
skb
);

207 
	`skb_»£t_ÃtwÜk_h—d”
(
skb
);

208 
	`skb_»£t_Œª¥Üt_h—d”
(
skb
);

211 
	`skb_£t_queue_m­pšg
(
skb
, 
IEEE80211_AC_VO
);

212 
skb
->
´iÜ™y
 = 7;

214 
šfo
->
cÚŒŞ
.
vif
 = &
sd©a
->vif;

215 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

216 
	`›“80211_£t_qos_hdr
(
sd©a
, 
skb
);

217 
	`›“80211_mps_£t_äame_æags
(
sd©a
, 
NULL
, 
hdr
);

218 
	}
}

236 
	$mesh_·th_”rÜ_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

237 
u8
 
‰l
, cÚ¡ u8 *
rg‘
, 
u32
 
rg‘_¢
,

238 
u16
 
rg‘_rcode
, cÚ¡ 
u8
 *
¿
)

240 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

241 
sk_buff
 *
skb
;

242 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

243 
›“80211_mgmt
 *
mgmt
;

244 
u8
 *
pos
, 
›_Ën
;

245 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
,

246 
u
.
aùiÚ
.u.
mesh_aùiÚ
);

248 ià(
	`time_befÜe
(
jiff›s
, 
ifmsh
->
Ãxt_³¼
))

249  -
EAGAIN
;

251 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 +

252 
IEEE80211_ENCRYPT_HEADROOM
 +

253 
IEEE80211_ENCRYPT_TAILROOM
 +

254 
hdr_Ën
 +

256 ià(!
skb
)

258 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
 + 
IEEE80211_ENCRYPT_HEADROOM
);

259 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

260 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

261 
IEEE80211_STYPE_ACTION
);

263 
	`memıy
(
mgmt
->
da
, 
¿
, 
ETH_ALEN
);

264 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

266 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

267 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_MESH_ACTION
;

268 
mgmt
->
u
.
aùiÚ
.u.
mesh_aùiÚ
.
aùiÚ_code
 =

269 
WLAN_MESH_ACTION_HWMP_PATH_SELECTION
;

270 
›_Ën
 = 15;

271 
pos
 = 
	`skb_put
(
skb
, 2 + 
›_Ën
);

272 *
pos
++ = 
WLAN_EID_PERR
;

273 *
pos
++ = 
›_Ën
;

275 *
pos
++ = 
‰l
;

277 *
pos
++ = 1;

281 *
pos
 = 0;

282 
pos
++;

283 
	`memıy
(
pos
, 
rg‘
, 
ETH_ALEN
);

284 
pos
 +ğ
ETH_ALEN
;

285 
	`put_uÇligÃd_Ë32
(
rg‘_¢
, 
pos
);

286 
pos
 += 4;

287 
	`put_uÇligÃd_Ë16
(
rg‘_rcode
, 
pos
);

290 
	`´•¬e_äame_fÜ_deã¼ed_tx
(
sd©a
, 
skb
);

291 
ifmsh
->
Ãxt_³¼
 = 
	`TU_TO_EXP_TIME
(

292 
ifmsh
->
mshcfg
.
dÙ11MeshHWMP³¼MšIÁ”v®
);

293 
	`›“80211_add_³ndšg_skb
(
loÿl
, 
skb
);

295 
	}
}

297 
	$›“80211s_upd©e_m‘ric
(
›“80211_loÿl
 *
loÿl
,

298 
¡a_šfo
 *
¡a
,

299 
›“80211_tx_¡©us
 *
¡
)

301 
›“80211_tx_šfo
 *
txšfo
 = 
¡
->
šfo
;

302 
çed
;

303 
¿‹_šfo
 
ršfo
;

305 
çed
 = !(
txšfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
);

310 
	`ewma_mesh_ç_avg_add
(&
¡a
->
mesh
->
ç_avg
, 
çed
 * 100);

311 ià(
	`ewma_mesh_ç_avg_»ad
(&
¡a
->
mesh
->
ç_avg
) >

312 
LINK_FAIL_THRESH
)

313 
	`mesh_¶šk_brok’
(
¡a
);

316 ià(
¡
->
n_¿‹s
)

317 
ršfo
 = 
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹_šfo
;

319 
	`¡a_£t_¿‹_šfo_tx
(
¡a
, &¡a->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
, &
ršfo
);

321 
	`ewma_mesh_tx_¿‹_avg_add
(&
¡a
->
mesh
->
tx_¿‹_avg
,

322 
	`cfg80211_ÿlcuÏ‹_b™¿‹
(&
ršfo
));

323 
	}
}

325 
u32
 
	$aœtime_lšk_m‘ric_g‘
(
›“80211_loÿl
 *
loÿl
,

326 
¡a_šfo
 *
¡a
)

329 
deviû_cÚ¡ªt
 = 1 << 
ARITH_SHIFT
;

330 
‹¡_äame_Ën
 = 
TEST_FRAME_LEN
 << 
ARITH_SHIFT
;

331 
s_un™
 = 1 << 
ARITH_SHIFT
;

332 
¿‹
, 
”r
;

333 
u32
 
tx_time
, 
e¡im©ed_»tx
;

334 
u64
 
»suÉ
;

335 
ç_avg
 =

336 
	`ewma_mesh_ç_avg_»ad
(&
¡a
->
mesh
->
ç_avg
);

338 ià(
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
)

339  
MAX_METRIC
;

346 
¿‹
 = 
	`DIV_ROUND_UP
(
	`¡a_g‘_ex³ùed_throughput
(
¡a
), 100);

348 ià(
¿‹
) {

349 
”r
 = 0;

351 ià(
ç_avg
 > 
LINK_FAIL_THRESH
)

352  
MAX_METRIC
;

354 
¿‹
 = 
	`ewma_mesh_tx_¿‹_avg_»ad
(&
¡a
->
mesh
->
tx_¿‹_avg
);

355 ià(
	`WARN_ON
(!
¿‹
))

356  
MAX_METRIC
;

358 
”r
 = (
ç_avg
 << 
ARITH_SHIFT
) / 100;

364 
tx_time
 = (
deviû_cÚ¡ªt
 + 10 * 
‹¡_äame_Ën
 / 
¿‹
);

365 
e¡im©ed_»tx
 = ((1 << (2 * 
ARITH_SHIFT
)è/ (
s_un™
 - 
”r
));

366 
»suÉ
 = ((
u64
)
tx_time
 * 
e¡im©ed_»tx
è>> (2 * 
ARITH_SHIFT
);

367  (
u32
)
»suÉ
;

368 
	}
}

387 
u32
 
	$hwmp_rou‹_šfo_g‘
(
›“80211_sub_if_d©a
 *
sd©a
,

388 
›“80211_mgmt
 *
mgmt
,

389 cÚ¡ 
u8
 *
hwmp_›
, 
m·th_äame_ty³
 
aùiÚ
)

391 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

392 
mesh_·th
 *
m·th
;

393 
¡a_šfo
 *
¡a
;

394 
boŞ
 
äesh_šfo
;

395 cÚ¡ 
u8
 *
Üig_addr
, *

;

396 
u32
 
Üig_¢
, 
Üig_m‘ric
;

397 
Üig_liãtime
, 
exp_time
;

398 
u32
 
Ï¡_hİ_m‘ric
, 
Ãw_m‘ric
;

399 
boŞ
 
æush_m·th
 = 
çl£
;

400 
boŞ
 
´oûss
 = 
Œue
;

401 
u8
 
hİcouÁ
;

403 
	`rcu_»ad_lock
();

404 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
);

405 ià(!
¡a
) {

406 
	`rcu_»ad_uÆock
();

410 
Ï¡_hİ_m‘ric
 = 
	`aœtime_lšk_m‘ric_g‘
(
loÿl
, 
¡a
);

412 
äesh_šfo
 = 
Œue
;

414 
aùiÚ
) {

415 
MPATH_PREQ
:

416 
Üig_addr
 = 
	`PREQ_IE_ORIG_ADDR
(
hwmp_›
);

417 
Üig_¢
 = 
	`PREQ_IE_ORIG_SN
(
hwmp_›
);

418 
Üig_liãtime
 = 
	`PREQ_IE_LIFETIME
(
hwmp_›
);

419 
Üig_m‘ric
 = 
	`PREQ_IE_METRIC
(
hwmp_›
);

420 
hİcouÁ
 = 
	`PREQ_IE_HOPCOUNT
(
hwmp_›
) + 1;

422 
MPATH_PREP
:

428 
Üig_addr
 = 
	`PREP_IE_TARGET_ADDR
(
hwmp_›
);

429 
Üig_¢
 = 
	`PREP_IE_TARGET_SN
(
hwmp_›
);

430 
Üig_liãtime
 = 
	`PREP_IE_LIFETIME
(
hwmp_›
);

431 
Üig_m‘ric
 = 
	`PREP_IE_METRIC
(
hwmp_›
);

432 
hİcouÁ
 = 
	`PREP_IE_HOPCOUNT
(
hwmp_›
) + 1;

435 
	`rcu_»ad_uÆock
();

438 
Ãw_m‘ric
 = 
Üig_m‘ric
 + 
Ï¡_hİ_m‘ric
;

439 ià(
Ãw_m‘ric
 < 
Üig_m‘ric
)

440 
Ãw_m‘ric
 = 
MAX_METRIC
;

441 
exp_time
 = 
	`TU_TO_EXP_TIME
(
Üig_liãtime
);

443 ià(
	`‘h”_addr_equ®
(
Üig_addr
, 
sd©a
->
vif
.
addr
)) {

447 
´oûss
 = 
çl£
;

448 
äesh_šfo
 = 
çl£
;

450 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
Üig_addr
);

451 ià(
m·th
) {

452 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

453 ià(
m·th
->
æags
 & 
MESH_PATH_FIXED
)

454 
äesh_šfo
 = 
çl£
;

455 ià((
m·th
->
æags
 & 
MESH_PATH_ACTIVE
) &&

456 (
m·th
->
æags
 & 
MESH_PATH_SN_VALID
)) {

457 ià(
	`SN_GT
(
m·th
->
¢
, 
Üig_¢
) ||

458 (
m·th
->
¢
 =ğ
Üig_¢
 &&

459 (
	`rcu_acûss_poš‹r
(
m·th
->
Ãxt_hİ
) !=

460 
¡a
 ?

461 
	`muÉ_äac
(
Ãw_m‘ric
, 10, 9) :

462 
Ãw_m‘ric
è>ğ
m·th
->
m‘ric
)) {

463 
´oûss
 = 
çl£
;

464 
äesh_šfo
 = 
çl£
;

466 } ià(!(
m·th
->
æags
 & 
MESH_PATH_ACTIVE
)) {

467 
boŞ
 
have_¢
, 
Ãw”_¢
, 
bounûd
;

469 
have_¢
 = 
m·th
->
æags
 & 
MESH_PATH_SN_VALID
;

470 
Ãw”_¢
 = 
have_¢
 && 
	`SN_GT
(
Üig_¢
, 
m·th
->
¢
);

471 
bounûd
 = 
have_¢
 &&

472 (
	`SN_DELTA
(
Üig_¢
, 
m·th
->
¢
) >

473 
MAX_SANE_SN_DELTA
);

475 ià(!
have_¢
 || 
Ãw”_¢
) {

478 } ià(
bounûd
) {

483 
´oûss
 = 
çl£
;

484 
äesh_šfo
 = 
çl£
;

488 
m·th
 = 
	`mesh_·th_add
(
sd©a
, 
Üig_addr
);

489 ià(
	`IS_ERR
(
m·th
)) {

490 
	`rcu_»ad_uÆock
();

493 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

496 ià(
äesh_šfo
) {

497 ià(
	`rcu_acûss_poš‹r
(
m·th
->
Ãxt_hİ
è!ğ
¡a
) {

498 
m·th
->
·th_chªge_couÁ
++;

499 
æush_m·th
 = 
Œue
;

501 
	`mesh_·th_assign_Ãxthİ
(
m·th
, 
¡a
);

502 
m·th
->
æags
 |ğ
MESH_PATH_SN_VALID
;

503 
m·th
->
m‘ric
 = 
Ãw_m‘ric
;

504 
m·th
->
¢
 = 
Üig_¢
;

505 
m·th
->
exp_time
 = 
	`time_aá”
(mpath->exp_time,ƒxp_time)

506 ? 
m·th
->
exp_time
 :ƒxp_time;

507 
m·th
->
hİ_couÁ
 = 
hİcouÁ
;

508 
	`mesh_·th_aùiv©e
(
m·th
);

509 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

510 ià(
æush_m·th
)

511 
	`mesh_ç¡_tx_æush_m·th
(
m·th
);

512 
	`ewma_mesh_ç_avg_š™
(&
¡a
->
mesh
->
ç_avg
);

514 
	`ewma_mesh_ç_avg_add
(&
¡a
->
mesh
->
ç_avg
, 1);

515 
	`mesh_·th_tx_³ndšg
(
m·th
);

520 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

524 

 = 
mgmt
->
§
;

525 ià(
	`‘h”_addr_equ®
(
Üig_addr
, 

))

526 
äesh_šfo
 = 
çl£
;

528 
äesh_šfo
 = 
Œue
;

530 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 

);

531 ià(
m·th
) {

532 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

533 ià((
m·th
->
æags
 & 
MESH_PATH_FIXED
) ||

534 ((
m·th
->
æags
 & 
MESH_PATH_ACTIVE
) &&

535 ((
	`rcu_acûss_poš‹r
(
m·th
->
Ãxt_hİ
è!ğ
¡a
 ?

536 
	`muÉ_äac
(
Ï¡_hİ_m‘ric
, 10, 9) :

537 
Ï¡_hİ_m‘ric
è> 
m·th
->
m‘ric
)))

538 
äesh_šfo
 = 
çl£
;

540 
m·th
 = 
	`mesh_·th_add
(
sd©a
, 

);

541 ià(
	`IS_ERR
(
m·th
)) {

542 
	`rcu_»ad_uÆock
();

545 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

548 ià(
äesh_šfo
) {

549 ià(
	`rcu_acûss_poš‹r
(
m·th
->
Ãxt_hİ
è!ğ
¡a
) {

550 
m·th
->
·th_chªge_couÁ
++;

551 
æush_m·th
 = 
Œue
;

553 
	`mesh_·th_assign_Ãxthİ
(
m·th
, 
¡a
);

554 
m·th
->
m‘ric
 = 
Ï¡_hİ_m‘ric
;

555 
m·th
->
exp_time
 = 
	`time_aá”
(mpath->exp_time,ƒxp_time)

556 ? 
m·th
->
exp_time
 :ƒxp_time;

557 
m·th
->
hİ_couÁ
 = 1;

558 
	`mesh_·th_aùiv©e
(
m·th
);

559 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

560 ià(
æush_m·th
)

561 
	`mesh_ç¡_tx_æush_m·th
(
m·th
);

562 
	`ewma_mesh_ç_avg_š™
(&
¡a
->
mesh
->
ç_avg
);

564 
	`ewma_mesh_ç_avg_add
(&
¡a
->
mesh
->
ç_avg
, 1);

565 
	`mesh_·th_tx_³ndšg
(
m·th
);

567 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

570 
	`rcu_»ad_uÆock
();

572  
´oûss
 ? 
Ãw_m‘ric
 : 0;

573 
	}
}

575 
	$hwmp_´eq_äame_´oûss
(
›“80211_sub_if_d©a
 *
sd©a
,

576 
›“80211_mgmt
 *
mgmt
,

577 cÚ¡ 
u8
 *
´eq_–em
, 
u32
 
Üig_m‘ric
)

579 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

580 
mesh_·th
 *
m·th
 = 
NULL
;

581 cÚ¡ 
u8
 *
rg‘_addr
, *
Üig_addr
;

582 cÚ¡ 
u8
 *
da
;

583 
u8
 
rg‘_æags
, 
‰l
, 
æags
;

584 
u32
 
Üig_¢
, 
rg‘_¢
, 
liãtime
, 
rg‘_m‘ric
 = 0;

585 
boŞ
 
»¶y
 = 
çl£
;

586 
boŞ
 
fÜw¬d
 = 
Œue
;

587 
boŞ
 
roÙ_is_g©e
;

590 
rg‘_addr
 = 
	`PREQ_IE_TARGET_ADDR
(
´eq_–em
);

591 
Üig_addr
 = 
	`PREQ_IE_ORIG_ADDR
(
´eq_–em
);

592 
rg‘_¢
 = 
	`PREQ_IE_TARGET_SN
(
´eq_–em
);

593 
Üig_¢
 = 
	`PREQ_IE_ORIG_SN
(
´eq_–em
);

594 
rg‘_æags
 = 
	`PREQ_IE_TARGET_F
(
´eq_–em
);

596 
æags
 = 
	`PREQ_IE_FLAGS
(
´eq_–em
);

597 
roÙ_is_g©e
 = !!(
æags
 & 
RANN_FLAG_IS_GATE
);

599 
	`mhwmp_dbg
(
sd©a
, "»ûived PREQ from %pM\n", 
Üig_addr
);

601 ià(
	`‘h”_addr_equ®
(
rg‘_addr
, 
sd©a
->
vif
.
addr
)) {

602 
	`mhwmp_dbg
(
sd©a
, "PREQ is for us\n");

603 
fÜw¬d
 = 
çl£
;

604 
»¶y
 = 
Œue
;

605 
rg‘_m‘ric
 = 0;

607 ià(
	`SN_GT
(
rg‘_¢
, 
ifmsh
->
¢
))

608 
ifmsh
->
¢
 = 
rg‘_¢
;

610 ià(
	`time_aá”
(
jiff›s
, 
ifmsh
->
Ï¡_¢_upd©e
 +

611 
	`Ãt_Œav”§l_jiff›s
(
sd©a
)) ||

612 
	`time_befÜe
(
jiff›s
, 
ifmsh
->
Ï¡_¢_upd©e
)) {

613 ++
ifmsh
->
¢
;

614 
ifmsh
->
Ï¡_¢_upd©e
 = 
jiff›s
;

616 
rg‘_¢
 = 
ifmsh
->
¢
;

617 } ià(
	`is_brßdÿ¡_‘h”_addr
(
rg‘_addr
) &&

618 (
rg‘_æags
 & 
IEEE80211_PREQ_TO_FLAG
)) {

619 
	`rcu_»ad_lock
();

620 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
Üig_addr
);

621 ià(
m·th
) {

622 ià(
æags
 & 
IEEE80211_PREQ_PROACTIVE_PREP_FLAG
) {

623 
»¶y
 = 
Œue
;

624 
rg‘_addr
 = 
sd©a
->
vif
.
addr
;

625 
rg‘_¢
 = ++
ifmsh
->
¢
;

626 
rg‘_m‘ric
 = 0;

627 
ifmsh
->
Ï¡_¢_upd©e
 = 
jiff›s
;

629 ià(
roÙ_is_g©e
)

630 
	`mesh_·th_add_g©e
(
m·th
);

632 
	`rcu_»ad_uÆock
();

634 
	`rcu_»ad_lock
();

635 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
rg‘_addr
);

636 ià(
m·th
) {

637 ià((!(
m·th
->
æags
 & 
MESH_PATH_SN_VALID
)) ||

638 
	`SN_LT
(
m·th
->
¢
, 
rg‘_¢
)) {

639 
m·th
->
¢
 = 
rg‘_¢
;

640 
m·th
->
æags
 |ğ
MESH_PATH_SN_VALID
;

641 } ià((!(
rg‘_æags
 & 
IEEE80211_PREQ_TO_FLAG
)) &&

642 (
m·th
->
æags
 & 
MESH_PATH_ACTIVE
)) {

643 
»¶y
 = 
Œue
;

644 
rg‘_m‘ric
 = 
m·th
->
m‘ric
;

645 
rg‘_¢
 = 
m·th
->
¢
;

647 
rg‘_æags
 |ğ
IEEE80211_PREQ_TO_FLAG
;

650 
	`rcu_»ad_uÆock
();

653 ià(
»¶y
) {

654 
liãtime
 = 
	`PREQ_IE_LIFETIME
(
´eq_–em
);

655 
‰l
 = 
ifmsh
->
mshcfg
.
–em’t_‰l
;

656 ià(
‰l
 != 0) {

657 
	`mhwmp_dbg
(
sd©a
, "replyingohe PREQ\n");

658 
	`mesh_·th_£l_äame_tx
(
MPATH_PREP
, 0, 
Üig_addr
,

659 
Üig_¢
, 0, 
rg‘_addr
,

660 
rg‘_¢
, 
mgmt
->
§
, 0, 
‰l
,

661 
liãtime
, 
rg‘_m‘ric
, 0,

662 
sd©a
);

664 
ifmsh
->
msh¡©s
.
drİ³d_äames_‰l
++;

668 ià(
fÜw¬d
 && 
ifmsh
->
mshcfg
.
dÙ11MeshFÜw¬dšg
) {

669 
u32
 
´eq_id
;

670 
u8
 
hİcouÁ
;

672 
‰l
 = 
	`PREQ_IE_TTL
(
´eq_–em
);

673 
liãtime
 = 
	`PREQ_IE_LIFETIME
(
´eq_–em
);

674 ià(
‰l
 <= 1) {

675 
ifmsh
->
msh¡©s
.
drİ³d_äames_‰l
++;

678 
	`mhwmp_dbg
(
sd©a
, "fÜw¬dšghPREQ from %pM\n", 
Üig_addr
);

679 --
‰l
;

680 
´eq_id
 = 
	`PREQ_IE_PREQ_ID
(
´eq_–em
);

681 
hİcouÁ
 = 
	`PREQ_IE_HOPCOUNT
(
´eq_–em
) + 1;

682 
da
 = (
m·th
 && m·th->
is_roÙ
) ?

683 
m·th
->
¿Â_¢d_addr
 : 
brßdÿ¡_addr
;

685 ià(
æags
 & 
IEEE80211_PREQ_PROACTIVE_PREP_FLAG
) {

686 
rg‘_addr
 = 
	`PREQ_IE_TARGET_ADDR
(
´eq_–em
);

687 
rg‘_¢
 = 
	`PREQ_IE_TARGET_SN
(
´eq_–em
);

690 
	`mesh_·th_£l_äame_tx
(
MPATH_PREQ
, 
æags
, 
Üig_addr
,

691 
Üig_¢
, 
rg‘_æags
, 
rg‘_addr
,

692 
rg‘_¢
, 
da
, 
hİcouÁ
, 
‰l
, 
liãtime
,

693 
Üig_m‘ric
, 
´eq_id
, 
sd©a
);

694 ià(!
	`is_muÉiÿ¡_‘h”_addr
(
da
))

695 
ifmsh
->
msh¡©s
.
fwded_uniÿ¡
++;

697 
ifmsh
->
msh¡©s
.
fwded_mÿ¡
++;

698 
ifmsh
->
msh¡©s
.
fwded_äames
++;

700 
	}
}

703 
šlše
 
¡a_šfo
 *

704 
	$Ãxt_hİ_d”ef_´Ùeùed
(
mesh_·th
 *
m·th
)

706  
	`rcu_d”eã»nû_´Ùeùed
(
m·th
->
Ãxt_hİ
,

707 
	`lockd•_is_h–d
(&
m·th
->
¡©e_lock
));

708 
	}
}

711 
	$hwmp_´•_äame_´oûss
(
›“80211_sub_if_d©a
 *
sd©a
,

712 
›“80211_mgmt
 *
mgmt
,

713 cÚ¡ 
u8
 *
´•_–em
, 
u32
 
m‘ric
)

715 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

716 
mesh_·th
 *
m·th
;

717 cÚ¡ 
u8
 *
rg‘_addr
, *
Üig_addr
;

718 
u8
 
‰l
, 
hİcouÁ
, 
æags
;

719 
u8
 
Ãxt_hİ
[
ETH_ALEN
];

720 
u32
 
rg‘_¢
, 
Üig_¢
, 
liãtime
;

722 
	`mhwmp_dbg
(
sd©a
, "received PREP from %pM\n",

723 
	`PREP_IE_TARGET_ADDR
(
´•_–em
));

725 
Üig_addr
 = 
	`PREP_IE_ORIG_ADDR
(
´•_–em
);

726 ià(
	`‘h”_addr_equ®
(
Üig_addr
, 
sd©a
->
vif
.
addr
))

730 ià(!
ifmsh
->
mshcfg
.
dÙ11MeshFÜw¬dšg
)

733 
‰l
 = 
	`PREP_IE_TTL
(
´•_–em
);

734 ià(
‰l
 <= 1) {

735 
sd©a
->
u
.
mesh
.
msh¡©s
.
drİ³d_äames_‰l
++;

739 
	`rcu_»ad_lock
();

740 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
Üig_addr
);

741 ià(
m·th
)

742 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

744 
ç
;

745 ià(!(
m·th
->
æags
 & 
MESH_PATH_ACTIVE
)) {

746 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

747 
ç
;

749 
	`memıy
(
Ãxt_hİ
, 
	`Ãxt_hİ_d”ef_´Ùeùed
(
m·th
)->
¡a
.
addr
, 
ETH_ALEN
);

750 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

751 --
‰l
;

752 
æags
 = 
	`PREP_IE_FLAGS
(
´•_–em
);

753 
liãtime
 = 
	`PREP_IE_LIFETIME
(
´•_–em
);

754 
hİcouÁ
 = 
	`PREP_IE_HOPCOUNT
(
´•_–em
) + 1;

755 
rg‘_addr
 = 
	`PREP_IE_TARGET_ADDR
(
´•_–em
);

756 
rg‘_¢
 = 
	`PREP_IE_TARGET_SN
(
´•_–em
);

757 
Üig_¢
 = 
	`PREP_IE_ORIG_SN
(
´•_–em
);

759 
	`mesh_·th_£l_äame_tx
(
MPATH_PREP
, 
æags
, 
Üig_addr
, 
Üig_¢
, 0,

760 
rg‘_addr
, 
rg‘_¢
, 
Ãxt_hİ
, 
hİcouÁ
,

761 
‰l
, 
liãtime
, 
m‘ric
, 0, 
sd©a
);

762 
	`rcu_»ad_uÆock
();

764 
sd©a
->
u
.
mesh
.
msh¡©s
.
fwded_uniÿ¡
++;

765 
sd©a
->
u
.
mesh
.
msh¡©s
.
fwded_äames
++;

768 
ç
:

769 
	`rcu_»ad_uÆock
();

770 
sd©a
->
u
.
mesh
.
msh¡©s
.
drİ³d_äames_no_rou‹
++;

771 
	}
}

773 
	$hwmp_³¼_äame_´oûss
(
›“80211_sub_if_d©a
 *
sd©a
,

774 
›“80211_mgmt
 *
mgmt
,

775 cÚ¡ 
u8
 *
³¼_–em
)

777 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

778 
mesh_·th
 *
m·th
;

779 
u8
 
‰l
;

780 cÚ¡ 
u8
 *

, *
rg‘_addr
;

781 
u32
 
rg‘_¢
;

782 
u16
 
rg‘_rcode
;

784 

 = 
mgmt
->
§
;

785 
‰l
 = 
	`PERR_IE_TTL
(
³¼_–em
);

786 ià(
‰l
 <= 1) {

787 
ifmsh
->
msh¡©s
.
drİ³d_äames_‰l
++;

790 
‰l
--;

791 
rg‘_addr
 = 
	`PERR_IE_TARGET_ADDR
(
³¼_–em
);

792 
rg‘_¢
 = 
	`PERR_IE_TARGET_SN
(
³¼_–em
);

793 
rg‘_rcode
 = 
	`PERR_IE_TARGET_RCODE
(
³¼_–em
);

795 
	`rcu_»ad_lock
();

796 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
rg‘_addr
);

797 ià(
m·th
) {

798 
¡a_šfo
 *
¡a
;

800 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

801 
¡a
 = 
	`Ãxt_hİ_d”ef_´Ùeùed
(
m·th
);

802 ià(
m·th
->
æags
 & 
MESH_PATH_ACTIVE
 &&

803 
	`‘h”_addr_equ®
(

, 
¡a
->¡a.
addr
) &&

804 !(
m·th
->
æags
 & 
MESH_PATH_FIXED
) &&

805 (!(
m·th
->
æags
 & 
MESH_PATH_SN_VALID
) ||

806 
	`SN_GT
(
rg‘_¢
, 
m·th
->
¢
) ||arget_sn == 0)) {

807 
m·th
->
æags
 &ğ~
MESH_PATH_ACTIVE
;

808 ià(
rg‘_¢
 != 0)

809 
m·th
->
¢
 = 
rg‘_¢
;

811 
m·th
->
¢
 += 1;

812 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

813 ià(!
ifmsh
->
mshcfg
.
dÙ11MeshFÜw¬dšg
)

814 
’d³¼
;

815 
	`mesh_·th_”rÜ_tx
(
sd©a
, 
‰l
, 
rg‘_addr
,

816 
rg‘_¢
, 
rg‘_rcode
,

817 
brßdÿ¡_addr
);

819 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

821 
’d³¼
:

822 
	`rcu_»ad_uÆock
();

823 
	}
}

825 
	$hwmp_¿Â_äame_´oûss
(
›“80211_sub_if_d©a
 *
sd©a
,

826 
›“80211_mgmt
 *
mgmt
,

827 cÚ¡ 
›“80211_¿Â_›
 *
¿Â
)

829 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

830 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

831 
¡a_šfo
 *
¡a
;

832 
mesh_·th
 *
m·th
;

833 
u8
 
‰l
, 
æags
, 
hİcouÁ
;

834 cÚ¡ 
u8
 *
Üig_addr
;

835 
u32
 
Üig_¢
, 
Ãw_m‘ric
, 
Üig_m‘ric
, 
Ï¡_hİ_m‘ric
, 
š‹rv®
;

836 
boŞ
 
roÙ_is_g©e
;

838 
‰l
 = 
¿Â
->
¿Â_‰l
;

839 
æags
 = 
¿Â
->
¿Â_æags
;

840 
roÙ_is_g©e
 = !!(
æags
 & 
RANN_FLAG_IS_GATE
);

841 
Üig_addr
 = 
¿Â
->
¿Â_addr
;

842 
Üig_¢
 = 
	`Ë32_to_ıu
(
¿Â
->
¿Â_£q
);

843 
š‹rv®
 = 
	`Ë32_to_ıu
(
¿Â
->
¿Â_š‹rv®
);

844 
hİcouÁ
 = 
¿Â
->
¿Â_hİcouÁ
;

845 
hİcouÁ
++;

846 
Üig_m‘ric
 = 
	`Ë32_to_ıu
(
¿Â
->
¿Â_m‘ric
);

849 ià(
	`‘h”_addr_equ®
(
Üig_addr
, 
sd©a
->
vif
.
addr
))

852 
	`mhwmp_dbg
(
sd©a
,

854 
Üig_addr
, 
mgmt
->
§
, 
roÙ_is_g©e
);

856 
	`rcu_»ad_lock
();

857 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
);

858 ià(!
¡a
) {

859 
	`rcu_»ad_uÆock
();

863 
Ï¡_hİ_m‘ric
 = 
	`aœtime_lšk_m‘ric_g‘
(
loÿl
, 
¡a
);

864 
Ãw_m‘ric
 = 
Üig_m‘ric
 + 
Ï¡_hİ_m‘ric
;

865 ià(
Ãw_m‘ric
 < 
Üig_m‘ric
)

866 
Ãw_m‘ric
 = 
MAX_METRIC
;

868 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
Üig_addr
);

869 ià(!
m·th
) {

870 
m·th
 = 
	`mesh_·th_add
(
sd©a
, 
Üig_addr
);

871 ià(
	`IS_ERR
(
m·th
)) {

872 
	`rcu_»ad_uÆock
();

873 
sd©a
->
u
.
mesh
.
msh¡©s
.
drİ³d_äames_no_rou‹
++;

878 ià(!(
	`SN_LT
(
m·th
->
¢
, 
Üig_¢
)) &&

879 !(
m·th
->
¢
 =ğ
Üig_¢
 && 
Ãw_m‘ric
 < m·th->
¿Â_m‘ric
)) {

880 
	`rcu_»ad_uÆock
();

884 ià((!(
m·th
->
æags
 & (
MESH_PATH_ACTIVE
 | 
MESH_PATH_RESOLVING
)) ||

885 (
	`time_aá”
(
jiff›s
, 
m·th
->
Ï¡_´eq_to_roÙ
 +

886 
	`roÙ_·th_cÚfœm©iÚ_jiff›s
(
sd©a
)) ||

887 
	`time_befÜe
(
jiff›s
, 
m·th
->
Ï¡_´eq_to_roÙ
))) &&

888 !(
m·th
->
æags
 & 
MESH_PATH_FIXED
è&& (
‰l
 != 0)) {

889 
	`mhwmp_dbg
(
sd©a
,

891 
Üig_addr
);

892 
	`mesh_queue_´eq
(
m·th
, 
PREQ_Q_F_START
 | 
PREQ_Q_F_REFRESH
);

893 
m·th
->
Ï¡_´eq_to_roÙ
 = 
jiff›s
;

896 
m·th
->
¢
 = 
Üig_¢
;

897 
m·th
->
¿Â_m‘ric
 = 
Ãw_m‘ric
;

898 
m·th
->
is_roÙ
 = 
Œue
;

901 
	`memıy
(
m·th
->
¿Â_¢d_addr
, 
mgmt
->
§
, 
ETH_ALEN
);

903 ià(
roÙ_is_g©e
)

904 
	`mesh_·th_add_g©e
(
m·th
);

906 ià(
‰l
 <= 1) {

907 
ifmsh
->
msh¡©s
.
drİ³d_äames_‰l
++;

908 
	`rcu_»ad_uÆock
();

911 
‰l
--;

913 ià(
ifmsh
->
mshcfg
.
dÙ11MeshFÜw¬dšg
) {

914 
	`mesh_·th_£l_äame_tx
(
MPATH_RANN
, 
æags
, 
Üig_addr
,

915 
Üig_¢
, 0, 
NULL
, 0, 
brßdÿ¡_addr
,

916 
hİcouÁ
, 
‰l
, 
š‹rv®
,

917 
Ãw_m‘ric
, 0, 
sd©a
);

920 
	`rcu_»ad_uÆock
();

921 
	}
}

924 
	$mesh_rx_·th_£l_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

925 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

927 
›“802_11_–ems
 *
–ems
;

928 
size_t
 
ba£Ën
;

929 
u32
 
·th_m‘ric
;

930 
¡a_šfo
 *
¡a
;

933 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 1)

936 
	`rcu_»ad_lock
();

937 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
);

938 ià(!
¡a
 || s->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
) {

939 
	`rcu_»ad_uÆock
();

942 
	`rcu_»ad_uÆock
();

944 
ba£Ën
 = (
u8
 *è
mgmt
->
u
.
aùiÚ
.u.
mesh_aùiÚ
.
v¬ŸbË
 - (u8 *) mgmt;

945 
–ems
 = 
	`›“802_11_·r£_–ems
(
mgmt
->
u
.
aùiÚ
.u.
mesh_aùiÚ
.
v¬ŸbË
,

946 
Ën
 - 
ba£Ën
, 
çl£
, 
NULL
);

947 ià(!
–ems
)

950 ià(
–ems
->
´eq
) {

951 ià(
–ems
->
´eq_Ën
 != 37)

953 
ä“
;

954 
·th_m‘ric
 = 
	`hwmp_rou‹_šfo_g‘
(
sd©a
, 
mgmt
, 
–ems
->
´eq
,

955 
MPATH_PREQ
);

956 ià(
·th_m‘ric
)

957 
	`hwmp_´eq_äame_´oûss
(
sd©a
, 
mgmt
, 
–ems
->
´eq
,

958 
·th_m‘ric
);

960 ià(
–ems
->
´•
) {

961 ià(
–ems
->
´•_Ën
 != 31)

963 
ä“
;

964 
·th_m‘ric
 = 
	`hwmp_rou‹_šfo_g‘
(
sd©a
, 
mgmt
, 
–ems
->
´•
,

965 
MPATH_PREP
);

966 ià(
·th_m‘ric
)

967 
	`hwmp_´•_äame_´oûss
(
sd©a
, 
mgmt
, 
–ems
->
´•
,

968 
·th_m‘ric
);

970 ià(
–ems
->
³¼
) {

971 ià(
–ems
->
³¼_Ën
 != 15)

973 
ä“
;

974 
	`hwmp_³¼_äame_´oûss
(
sd©a
, 
mgmt
, 
–ems
->
³¼
);

976 ià(
–ems
->
¿Â
)

977 
	`hwmp_¿Â_äame_´oûss
(
sd©a
, 
mgmt
, 
–ems
->
¿Â
);

978 
ä“
:

979 
	`kä“
(
–ems
);

980 
	}
}

991 
	$mesh_queue_´eq
(
mesh_·th
 *
m·th
, 
u8
 
æags
)

993 
›“80211_sub_if_d©a
 *
sd©a
 = 
m·th
->sdata;

994 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

995 
mesh_´eq_queue
 *
´eq_node
;

997 
´eq_node
 = 
	`km®loc
((
mesh_´eq_queue
), 
GFP_ATOMIC
);

998 ià(!
´eq_node
) {

999 
	`mhwmp_dbg
(
sd©a
, "could‚ot‡llocate PREQ‚ode\n");

1003 
	`¥š_lock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1004 ià(
ifmsh
->
´eq_queue_Ën
 =ğ
MAX_PREQ_QUEUE_LEN
) {

1005 
	`¥š_uÆock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1006 
	`kä“
(
´eq_node
);

1007 ià(
	`´štk_¿‹lim™
())

1008 
	`mhwmp_dbg
(
sd©a
, "PREQ‚ode queue full\n");

1012 
	`¥š_lock
(&
m·th
->
¡©e_lock
);

1013 ià(
m·th
->
æags
 & 
MESH_PATH_REQ_QUEUED
) {

1014 
	`¥š_uÆock
(&
m·th
->
¡©e_lock
);

1015 
	`¥š_uÆock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1016 
	`kä“
(
´eq_node
);

1020 
	`memıy
(
´eq_node
->
d¡
, 
m·th
->d¡, 
ETH_ALEN
);

1021 
´eq_node
->
æags
 = flags;

1023 
m·th
->
æags
 |ğ
MESH_PATH_REQ_QUEUED
;

1024 
	`¥š_uÆock
(&
m·th
->
¡©e_lock
);

1026 
	`li¡_add_
(&
´eq_node
->
li¡
, &
ifmsh
->
´eq_queue
.list);

1027 ++
ifmsh
->
´eq_queue_Ën
;

1028 
	`¥š_uÆock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1030 ià(
	`time_aá”
(
jiff›s
, 
ifmsh
->
Ï¡_´eq
 + 
	`mš_´eq_št_jiff
(
sd©a
)))

1031 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

1033 ià(
	`time_befÜe
(
jiff›s
, 
ifmsh
->
Ï¡_´eq
)) {

1037 
ifmsh
->
Ï¡_´eq
 = 
jiff›s
 - 
	`mš_´eq_št_jiff
(
sd©a
) - 1;

1038 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

1040 
	`mod_tim”
(&
ifmsh
->
mesh_·th_tim”
, ifmsh->
Ï¡_´eq
 +

1041 
	`mš_´eq_št_jiff
(
sd©a
));

1042 
	}
}

1049 
	$mesh_·th_¡¬t_discov”y
(
›“80211_sub_if_d©a
 *
sd©a
)

1051 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1052 
mesh_´eq_queue
 *
´eq_node
;

1053 
mesh_·th
 *
m·th
;

1054 
u8
 
‰l
, 
rg‘_æags
 = 0;

1055 cÚ¡ 
u8
 *
da
;

1056 
u32
 
liãtime
;

1058 
	`¥š_lock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1059 ià(!
ifmsh
->
´eq_queue_Ën
 ||

1060 
	`time_befÜe
(
jiff›s
, 
ifmsh
->
Ï¡_´eq
 +

1061 
	`mš_´eq_št_jiff
(
sd©a
))) {

1062 
	`¥š_uÆock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1066 
´eq_node
 = 
	`li¡_fœ¡_’Œy
(&
ifmsh
->
´eq_queue
.
li¡
,

1067 
mesh_´eq_queue
, 
li¡
);

1068 
	`li¡_d–
(&
´eq_node
->
li¡
);

1069 --
ifmsh
->
´eq_queue_Ën
;

1070 
	`¥š_uÆock_bh
(&
ifmsh
->
mesh_´eq_queue_lock
);

1072 
	`rcu_»ad_lock
();

1073 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
´eq_node
->
d¡
);

1074 ià(!
m·th
)

1075 
’ddiscov”y
;

1077 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

1078 ià(
m·th
->
æags
 & (
MESH_PATH_DELETED
 | 
MESH_PATH_FIXED
)) {

1079 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1080 
’ddiscov”y
;

1082 
m·th
->
æags
 &ğ~
MESH_PATH_REQ_QUEUED
;

1083 ià(
´eq_node
->
æags
 & 
PREQ_Q_F_START
) {

1084 ià(
m·th
->
æags
 & 
MESH_PATH_RESOLVING
) {

1085 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1086 
’ddiscov”y
;

1088 
m·th
->
æags
 &ğ~
MESH_PATH_RESOLVED
;

1089 
m·th
->
æags
 |ğ
MESH_PATH_RESOLVING
;

1090 
m·th
->
discov”y_»Œ›s
 = 0;

1091 
m·th
->
discov”y_timeout
 = 
	`disc_timeout_jiff
(
sd©a
);

1093 } ià(!(
m·th
->
æags
 & 
MESH_PATH_RESOLVING
) ||

1094 
m·th
->
æags
 & 
MESH_PATH_RESOLVED
) {

1095 
m·th
->
æags
 &ğ~
MESH_PATH_RESOLVING
;

1096 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1097 
’ddiscov”y
;

1100 
ifmsh
->
Ï¡_´eq
 = 
jiff›s
;

1102 ià(
	`time_aá”
(
jiff›s
, 
ifmsh
->
Ï¡_¢_upd©e
 +

1103 
	`Ãt_Œav”§l_jiff›s
(
sd©a
)) ||

1104 
	`time_befÜe
(
jiff›s
, 
ifmsh
->
Ï¡_¢_upd©e
)) {

1105 ++
ifmsh
->
¢
;

1106 
sd©a
->
u
.
mesh
.
Ï¡_¢_upd©e
 = 
jiff›s
;

1108 
liãtime
 = 
	`deçuÉ_liãtime
(
sd©a
);

1109 
‰l
 = 
sd©a
->
u
.
mesh
.
mshcfg
.
–em’t_‰l
;

1110 ià(
‰l
 == 0) {

1111 
sd©a
->
u
.
mesh
.
msh¡©s
.
drİ³d_äames_‰l
++;

1112 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1113 
’ddiscov”y
;

1116 ià(
´eq_node
->
æags
 & 
PREQ_Q_F_REFRESH
)

1117 
rg‘_æags
 |ğ
IEEE80211_PREQ_TO_FLAG
;

1119 
rg‘_æags
 &ğ~
IEEE80211_PREQ_TO_FLAG
;

1121 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1122 
da
 = (
m·th
->
is_roÙ
è? m·th->
¿Â_¢d_addr
 : 
brßdÿ¡_addr
;

1123 
	`mesh_·th_£l_äame_tx
(
MPATH_PREQ
, 0, 
sd©a
->
vif
.
addr
, 
ifmsh
->
¢
,

1124 
rg‘_æags
, 
m·th
->
d¡
, m·th->
¢
, 
da
, 0,

1125 
‰l
, 
liãtime
, 0, 
ifmsh
->
´eq_id
++, 
sd©a
);

1127 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

1128 ià(!(
m·th
->
æags
 & 
MESH_PATH_DELETED
))

1129 
	`mod_tim”
(&
m·th
->
tim”
, 
jiff›s
 + m·th->
discov”y_timeout
);

1130 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1132 
’ddiscov”y
:

1133 
	`rcu_»ad_uÆock
();

1134 
	`kä“
(
´eq_node
);

1135 
	}
}

1149 
	$mesh_Ãxthİ_»sŞve
(
›“80211_sub_if_d©a
 *
sd©a
,

1150 
sk_buff
 *
skb
)

1152 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

1153 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1154 
mesh_·th
 *
m·th
;

1155 
sk_buff
 *
skb_to_ä“
 = 
NULL
;

1156 
u8
 *
rg‘_addr
 = 
hdr
->
addr3
;

1159 ià(
	`›“80211_is_qos_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

1163 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_SKIP_MPATH_LOOKUP
)

1166 ià(!
	`mesh_Ãxthİ_lookup
(
sd©a
, 
skb
))

1170 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
rg‘_addr
);

1171 ià(!
m·th
) {

1172 
m·th
 = 
	`mesh_·th_add
(
sd©a
, 
rg‘_addr
);

1173 ià(
	`IS_ERR
(
m·th
)) {

1174 
	`mesh_·th_disÿrd_äame
(
sd©a
, 
skb
);

1175  
	`PTR_ERR
(
m·th
);

1179 ià(!(
m·th
->
æags
 & 
MESH_PATH_RESOLVING
) &&

1180 
	`mesh_·th_£l_is_hwmp
(
sd©a
))

1181 
	`mesh_queue_´eq
(
m·th
, 
PREQ_Q_F_START
);

1183 ià(
	`skb_queue_Ën
(&
m·th
->
äame_queue
è>ğ
MESH_FRAME_QUEUE_LEN
)

1184 
skb_to_ä“
 = 
	`skb_dequeue
(&
m·th
->
äame_queue
);

1186 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

1187 
	`›“80211_£t_qos_hdr
(
sd©a
, 
skb
);

1188 
	`skb_queue_
(&
m·th
->
äame_queue
, 
skb
);

1189 ià(
skb_to_ä“
)

1190 
	`mesh_·th_disÿrd_äame
(
sd©a
, 
skb_to_ä“
);

1192  -
ENOENT
;

1193 
	}
}

1206 
	$mesh_Ãxthİ_lookup_nŞ—º
(
›“80211_sub_if_d©a
 *
sd©a
,

1207 
sk_buff
 *
skb
)

1209 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

1210 
¡a_šfo
 *
¡a
;

1212 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

1213  -
ENOENT
;

1215 
	`rcu_»ad_lock
();

1216 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
hdr
->
addr3
);

1218 ià(!
¡a
 || s->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
) {

1219 
	`rcu_»ad_uÆock
();

1220  -
ENOENT
;

1222 
	`rcu_»ad_uÆock
();

1224 
	`memıy
(
hdr
->
addr1
, hdr->
addr3
, 
ETH_ALEN
);

1225 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1227 
	}
}

1229 
	$mesh_·th_»äesh
(
›“80211_sub_if_d©a
 *
sd©a
,

1230 
mesh_·th
 *
m·th
, cÚ¡ 
u8
 *
addr
)

1232 ià(
m·th
->
æags
 & (
MESH_PATH_REQ_QUEUED
 | 
MESH_PATH_FIXED
 |

1233 
MESH_PATH_RESOLVING
))

1236 ià(
	`time_aá”
(
jiff›s
,

1237 
m·th
->
exp_time
 -

1238 
	`m£cs_to_jiff›s
(
sd©a
->
u
.
mesh
.
mshcfg
.
·th_»äesh_time
)) &&

1239 (!
addr
 || 
	`‘h”_addr_equ®
(
sd©a
->
vif
.addr,‡ddr)))

1240 
	`mesh_queue_´eq
(
m·th
, 
PREQ_Q_F_START
 | 
PREQ_Q_F_REFRESH
);

1241 
	}
}

1253 
	$mesh_Ãxthİ_lookup
(
›“80211_sub_if_d©a
 *
sd©a
,

1254 
sk_buff
 *
skb
)

1256 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1257 
mesh_·th
 *
m·th
;

1258 
¡a_šfo
 *
Ãxt_hİ
;

1259 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

1260 
u8
 *
rg‘_addr
 = 
hdr
->
addr3
;

1262 ià(
ifmsh
->
mshcfg
.
dÙ11MeshNŞ—º
 &&

1263 !
	`mesh_Ãxthİ_lookup_nŞ—º
(
sd©a
, 
skb
))

1266 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
rg‘_addr
);

1267 ià(!
m·th
 || !(m·th->
æags
 & 
MESH_PATH_ACTIVE
))

1268  -
ENOENT
;

1270 
	`mesh_·th_»äesh
(
sd©a
, 
m·th
, 
hdr
->
addr4
);

1272 
Ãxt_hİ
 = 
	`rcu_d”eã»nû
(
m·th
->next_hop);

1273 ià(
Ãxt_hİ
) {

1274 
	`memıy
(
hdr
->
addr1
, 
Ãxt_hİ
->
¡a
.
addr
, 
ETH_ALEN
);

1275 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1276 
	`›“80211_mps_£t_äame_æags
(
sd©a
, 
Ãxt_hİ
, 
hdr
);

1277 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
SUPPORT_FAST_XMIT
))

1278 
	`mesh_ç¡_tx_ÿche
(
sd©a
, 
skb
, 
m·th
);

1282  -
ENOENT
;

1283 
	}
}

1285 
	$mesh_·th_tim”
(
tim”_li¡
 *
t
)

1287 
mesh_·th
 *
m·th
 = 
	`äom_tim”
(m·th, 
t
, 
tim”
);

1288 
›“80211_sub_if_d©a
 *
sd©a
 = 
m·th
->sdata;

1289 
»t
;

1291 ià(
sd©a
->
loÿl
->
qu›scšg
)

1294 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

1295 ià(
m·th
->
æags
 & 
MESH_PATH_RESOLVED
 ||

1296 (!(
m·th
->
æags
 & 
MESH_PATH_RESOLVING
))) {

1297 
m·th
->
æags
 &ğ~(
MESH_PATH_RESOLVING
 | 
MESH_PATH_RESOLVED
);

1298 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1299 } ià(
m·th
->
discov”y_»Œ›s
 < 
	`max_´eq_»Œ›s
(
sd©a
)) {

1300 ++
m·th
->
discov”y_»Œ›s
;

1301 
m·th
->
discov”y_timeout
 *= 2;

1302 
m·th
->
æags
 &ğ~
MESH_PATH_REQ_QUEUED
;

1303 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1304 
	`mesh_queue_´eq
(
m·th
, 0);

1306 
m·th
->
æags
 &ğ~(
MESH_PATH_RESOLVING
 |

1307 
MESH_PATH_RESOLVED
 |

1308 
MESH_PATH_REQ_QUEUED
);

1309 
m·th
->
exp_time
 = 
jiff›s
;

1310 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1311 ià(!
m·th
->
is_g©e
 && 
	`mesh_g©e_num
(
sd©a
) > 0) {

1312 
»t
 = 
	`mesh_·th_£nd_to_g©es
(
m·th
);

1313 ià(
»t
)

1314 
	`mhwmp_dbg
(
sd©a
, "no gate was„eachable\n");

1316 
	`mesh_·th_æush_³ndšg
(
m·th
);

1318 
	}
}

1320 
	$mesh_·th_tx_roÙ_äame
(
›“80211_sub_if_d©a
 *
sd©a
)

1322 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

1323 
u32
 
š‹rv®
 = 
ifmsh
->
mshcfg
.
dÙ11MeshHWMPRªnIÁ”v®
;

1324 
u8
 
æags
, 
rg‘_æags
 = 0;

1326 
æags
 = (
ifmsh
->
mshcfg
.
dÙ11MeshG©eAÂounûm’tPrÙocŞ
)

1327 ? 
RANN_FLAG_IS_GATE
 : 0;

1329 
ifmsh
->
mshcfg
.
dÙ11MeshHWMPRoÙMode
) {

1330 
IEEE80211_PROACTIVE_RANN
:

1331 
	`mesh_·th_£l_äame_tx
(
MPATH_RANN
, 
æags
, 
sd©a
->
vif
.
addr
,

1332 ++
ifmsh
->
¢
, 0, 
NULL
, 0, 
brßdÿ¡_addr
,

1333 0, 
ifmsh
->
mshcfg
.
–em’t_‰l
,

1334 
š‹rv®
, 0, 0, 
sd©a
);

1336 
IEEE80211_PROACTIVE_PREQ_WITH_PREP
:

1337 
æags
 |ğ
IEEE80211_PREQ_PROACTIVE_PREP_FLAG
;

1338 
çÎthrough
;

1339 
IEEE80211_PROACTIVE_PREQ_NO_PREP
:

1340 
š‹rv®
 = 
ifmsh
->
mshcfg
.
dÙ11MeshHWMPaùiveP©hToRoÙTimeout
;

1341 
rg‘_æags
 |ğ
IEEE80211_PREQ_TO_FLAG
 |

1342 
IEEE80211_PREQ_USN_FLAG
;

1343 
	`mesh_·th_£l_äame_tx
(
MPATH_PREQ
, 
æags
, 
sd©a
->
vif
.
addr
,

1344 ++
ifmsh
->
¢
, 
rg‘_æags
,

1345 (
u8
 *è
brßdÿ¡_addr
, 0, broadcast_addr,

1346 0, 
ifmsh
->
mshcfg
.
–em’t_‰l
, 
š‹rv®
,

1347 0, 
ifmsh
->
´eq_id
++, 
sd©a
);

1350 
	`mhwmp_dbg
(
sd©a
, "Proactive mechanism‚ot supported\n");

1353 
	}
}

	@mesh_pathtbl.c

8 
	~<lšux/‘h”deviû.h
>

9 
	~<lšux/li¡.h
>

10 
	~<lšux/¿ndom.h
>

11 
	~<lšux/¦ab.h
>

12 
	~<lšux/¥šlock.h
>

13 
	~<lšux/¡ršg.h
>

14 
	~<Ãt/mac80211.h
>

15 
	~"wme.h
"

16 
	~"›“80211_i.h
"

17 
	~"mesh.h
"

18 
	~<lšux/rhashbË.h
>

20 
mesh_·th_ä“_rcu
(
mesh_bË
 *
tbl
, 
mesh_·th
 *
m·th
);

22 
u32
 
	$mesh_bË_hash
(cÚ¡ *
addr
, 
u32
 
Ën
, u32 
£ed
)

25  
	`jhash_1wÜd
(
	`__g‘_uÇligÃd_ıu32
((
u8
 *)
addr
 + 2), 
£ed
);

26 
	}
}

28 cÚ¡ 
rhashbË_·¿ms
 
	gmesh_rht_·¿ms
 = {

29 .
ÃËm_hšt
 = 2,

30 .
	gautom©ic_shrškšg
 = 
Œue
,

31 .
	gkey_Ën
 = 
ETH_ALEN
,

32 .
	gkey_off£t
 = 
off£tof
(
mesh_·th
, 
d¡
),

33 .
	gh—d_off£t
 = 
off£tof
(
mesh_·th
, 
rhash
),

34 .
	ghashâ
 = 
mesh_bË_hash
,

37 cÚ¡ 
rhashbË_·¿ms
 
	gç¡_tx_rht_·¿ms
 = {

38 .
ÃËm_hšt
 = 10,

39 .
	gautom©ic_shrškšg
 = 
Œue
,

40 .
	gkey_Ën
 = 
sizeof_f›ld
(
›“80211_mesh_ç¡_tx
, 
key
),

41 .
	gkey_off£t
 = 
off£tof
(
›“80211_mesh_ç¡_tx
, 
key
),

42 .
	gh—d_off£t
 = 
off£tof
(
›“80211_mesh_ç¡_tx
, 
rhash
),

43 .
	ghashâ
 = 
mesh_bË_hash
,

46 
	$__mesh_ç¡_tx_’Œy_ä“
(*
±r
, *
tbÍŒ
)

48 
›“80211_mesh_ç¡_tx
 *
’Œy
 = 
±r
;

50 
	`kä“_rcu
(
’Œy
, 
ç¡_tx
.
rcu_h—d
);

51 
	}
}

53 
	$mesh_ç¡_tx_deš™
(
›“80211_sub_if_d©a
 *
sd©a
)

55 
mesh_tx_ÿche
 *
ÿche
;

57 
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

58 
	`rhashbË_ä“_ªd_de¡roy
(&
ÿche
->
rht
,

59 
__mesh_ç¡_tx_’Œy_ä“
, 
NULL
);

60 
	}
}

62 
	$mesh_ç¡_tx_š™
(
›“80211_sub_if_d©a
 *
sd©a
)

64 
mesh_tx_ÿche
 *
ÿche
;

66 
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

67 
	`rhashbË_š™
(&
ÿche
->
rht
, &
ç¡_tx_rht_·¿ms
);

68 
	`INIT_HLIST_HEAD
(&
ÿche
->
w®k_h—d
);

69 
	`¥š_lock_š™
(&
ÿche
->
w®k_lock
);

70 
	}
}

72 
šlše
 
boŞ
 
	$m·th_expœed
(
mesh_·th
 *
m·th
)

74  (
m·th
->
æags
 & 
MESH_PATH_ACTIVE
) &&

75 
	`time_aá”
(
jiff›s
, 
m·th
->
exp_time
) &&

76 !(
m·th
->
æags
 & 
MESH_PATH_FIXED
);

77 
	}
}

79 
	$mesh_·th_rht_ä“
(*
±r
, *
tbÍŒ
)

81 
mesh_·th
 *
m·th
 = 
±r
;

82 
mesh_bË
 *
tbl
 = 
tbÍŒ
;

84 
	`mesh_·th_ä“_rcu
(
tbl
, 
m·th
);

85 
	}
}

87 
	$mesh_bË_š™
(
mesh_bË
 *
tbl
)

89 
	`INIT_HLIST_HEAD
(&
tbl
->
known_g©es
);

90 
	`INIT_HLIST_HEAD
(&
tbl
->
w®k_h—d
);

91 
	`©omic_£t
(&
tbl
->
’Œ›s
, 0);

92 
	`¥š_lock_š™
(&
tbl
->
g©es_lock
);

93 
	`¥š_lock_š™
(&
tbl
->
w®k_lock
);

98 
	`WARN_ON
(
	`rhashbË_š™
(&
tbl
->
rh—d
, &
mesh_rht_·¿ms
));

99 
	}
}

101 
	$mesh_bË_ä“
(
mesh_bË
 *
tbl
)

103 
	`rhashbË_ä“_ªd_de¡roy
(&
tbl
->
rh—d
,

104 
mesh_·th_rht_ä“
, 
tbl
);

105 
	}
}

115 
	$mesh_·th_assign_Ãxthİ
(
mesh_·th
 *
m·th
, 
¡a_šfo
 *
¡a
)

117 
sk_buff
 *
skb
;

118 
›“80211_hdr
 *
hdr
;

119 
æags
;

121 
	`rcu_assign_poš‹r
(
m·th
->
Ãxt_hİ
, 
¡a
);

123 
	`¥š_lock_œq§ve
(&
m·th
->
äame_queue
.
lock
, 
æags
);

124 
	`skb_queue_w®k
(&
m·th
->
äame_queue
, 
skb
) {

125 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

126 
	`memıy
(
hdr
->
addr1
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

127 
	`memıy
(
hdr
->
addr2
, 
m·th
->
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

128 
	`›“80211_mps_£t_äame_æags
(
¡a
->
sd©a
, s, 
hdr
);

131 
	`¥š_uÆock_œq»¡Üe
(&
m·th
->
äame_queue
.
lock
, 
æags
);

132 
	}
}

134 
	$´•¬e_fÜ_g©e
(
sk_buff
 *
skb
, *
d¡_addr
,

135 
mesh_·th
 *
g©e_m·th
)

137 
›“80211_hdr
 *
hdr
;

138 
›“80211s_hdr
 *
mshdr
;

139 
mesh_hd¾’
, 
hd¾’
;

140 *
Ãxt_hİ
;

142 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

143 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

144 
mshdr
 = (
›“80211s_hdr
 *è(
skb
->
d©a
 + 
hd¾’
);

146 ià(!(
mshdr
->
æags
 & 
MESH_FLAGS_AE
)) {

148 
mesh_hd¾’
 = 6;

151 
	`skb_push
(
skb
, 2 * 
ETH_ALEN
);

152 
	`memmove
(
skb
->
d©a
, 
hdr
, 
hd¾’
 + 
mesh_hd¾’
);

154 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

158 
mshdr
 = (
›“80211s_hdr
 *è(
skb
->
d©a
 + 
hd¾’
);

159 
mshdr
->
æags
 = 
MESH_FLAGS_AE_A5_A6
;

160 
	`memıy
(
mshdr
->
—ddr1
, 
hdr
->
addr3
, 
ETH_ALEN
);

161 
	`memıy
(
mshdr
->
—ddr2
, 
hdr
->
addr4
, 
ETH_ALEN
);

165 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

166 
	`rcu_»ad_lock
();

167 
Ãxt_hİ
 = 
	`rcu_d”eã»nû
(
g©e_m·th
->Ãxt_hİ)->
¡a
.
addr
;

168 
	`memıy
(
hdr
->
addr1
, 
Ãxt_hİ
, 
ETH_ALEN
);

169 
	`rcu_»ad_uÆock
();

170 
	`memıy
(
hdr
->
addr2
, 
g©e_m·th
->
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

171 
	`memıy
(
hdr
->
addr3
, 
d¡_addr
, 
ETH_ALEN
);

172 
	}
}

191 
	$mesh_·th_move_to_queue
(
mesh_·th
 *
g©e_m·th
,

192 
mesh_·th
 *
äom_m·th
,

193 
boŞ
 
cİy
)

195 
sk_buff
 *
skb
, *
fskb
, *
tmp
;

196 
sk_buff_h—d
 
çq
;

197 
æags
;

199 ià(
	`WARN_ON
(
g©e_m·th
 =ğ
äom_m·th
))

201 ià(
	`WARN_ON
(!
g©e_m·th
->
Ãxt_hİ
))

204 
	`__skb_queue_h—d_š™
(&
çq
);

206 
	`¥š_lock_œq§ve
(&
äom_m·th
->
äame_queue
.
lock
, 
æags
);

207 
	`skb_queue_¥liû_š™
(&
äom_m·th
->
äame_queue
, &
çq
);

208 
	`¥š_uÆock_œq»¡Üe
(&
äom_m·th
->
äame_queue
.
lock
, 
æags
);

210 
	`skb_queue_w®k_§ã
(&
çq
, 
fskb
, 
tmp
) {

211 ià(
	`skb_queue_Ën
(&
g©e_m·th
->
äame_queue
) >=

212 
MESH_FRAME_QUEUE_LEN
) {

213 
	`m·th_dbg
(
g©e_m·th
->
sd©a
, "mpath queue full!\n");

217 
skb
 = 
	`skb_cİy
(
fskb
, 
GFP_ATOMIC
);

218 ià(
	`WARN_ON
(!
skb
))

221 
	`´•¬e_fÜ_g©e
(
skb
, 
g©e_m·th
->
d¡
, gate_mpath);

222 
	`skb_queue_
(&
g©e_m·th
->
äame_queue
, 
skb
);

224 ià(
cİy
)

227 
	`__skb_uÆšk
(
fskb
, &
çq
);

228 
	`kä“_skb
(
fskb
);

231 
	`m·th_dbg
(
g©e_m·th
->
sd©a
, "Mpath queue for gate %pM has %d frames\n",

232 
g©e_m·th
->
d¡
, 
	`skb_queue_Ën
(&g©e_m·th->
äame_queue
));

234 ià(!
cİy
)

237 
	`¥š_lock_œq§ve
(&
äom_m·th
->
äame_queue
.
lock
, 
æags
);

238 
	`skb_queue_¥liû
(&
çq
, &
äom_m·th
->
äame_queue
);

239 
	`¥š_uÆock_œq»¡Üe
(&
äom_m·th
->
äame_queue
.
lock
, 
æags
);

240 
	}
}

243 
mesh_·th
 *
	$m·th_lookup
(
mesh_bË
 *
tbl
, cÚ¡ 
u8
 *
d¡
,

244 
›“80211_sub_if_d©a
 *
sd©a
)

246 
mesh_·th
 *
m·th
;

248 
m·th
 = 
	`rhashbË_lookup
(&
tbl
->
rh—d
, 
d¡
, 
mesh_rht_·¿ms
);

250 ià(
m·th
 && 
	`m·th_expœed
(mpath)) {

251 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

252 
m·th
->
æags
 &ğ~
MESH_PATH_ACTIVE
;

253 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

255  
m·th
;

256 
	}
}

267 
mesh_·th
 *

268 
	$mesh_·th_lookup
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
d¡
)

270  
	`m·th_lookup
(&
sd©a
->
u
.
mesh
.
mesh_·ths
, 
d¡
, sdata);

271 
	}
}

273 
mesh_·th
 *

274 
	$mµ_·th_lookup
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
d¡
)

276  
	`m·th_lookup
(&
sd©a
->
u
.
mesh
.
mµ_·ths
, 
d¡
, sdata);

277 
	}
}

279 
mesh_·th
 *

280 
	$__mesh_·th_lookup_by_idx
(
mesh_bË
 *
tbl
, 
idx
)

282 
i
 = 0;

283 
mesh_·th
 *
m·th
;

285 
	`hli¡_fÜ_—ch_’Œy_rcu
(
m·th
, &
tbl
->
w®k_h—d
, 
w®k_li¡
) {

286 ià(
i
++ =ğ
idx
)

290 ià(!
m·th
)

291  
NULL
;

293 ià(
	`m·th_expœed
(
m·th
)) {

294 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

295 
m·th
->
æags
 &ğ~
MESH_PATH_ACTIVE
;

296 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

298  
m·th
;

299 
	}
}

310 
mesh_·th
 *

311 
	$mesh_·th_lookup_by_idx
(
›“80211_sub_if_d©a
 *
sd©a
, 
idx
)

313  
	`__mesh_·th_lookup_by_idx
(&
sd©a
->
u
.
mesh
.
mesh_·ths
, 
idx
);

314 
	}
}

325 
mesh_·th
 *

326 
	$mµ_·th_lookup_by_idx
(
›“80211_sub_if_d©a
 *
sd©a
, 
idx
)

328  
	`__mesh_·th_lookup_by_idx
(&
sd©a
->
u
.
mesh
.
mµ_·ths
, 
idx
);

329 
	}
}

337 
	$mesh_·th_add_g©e
(
mesh_·th
 *
m·th
)

339 
mesh_bË
 *
tbl
;

340 
”r
;

342 
	`rcu_»ad_lock
();

343 
tbl
 = &
m·th
->
sd©a
->
u
.
mesh
.
mesh_·ths
;

345 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

346 ià(
m·th
->
is_g©e
) {

347 
”r
 = -
EEXIST
;

348 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

349 
”r_rcu
;

351 
m·th
->
is_g©e
 = 
Œue
;

352 
m·th
->
sd©a
->
u
.
mesh
.
num_g©es
++;

354 
	`¥š_lock
(&
tbl
->
g©es_lock
);

355 
	`hli¡_add_h—d_rcu
(&
m·th
->
g©e_li¡
, &
tbl
->
known_g©es
);

356 
	`¥š_uÆock
(&
tbl
->
g©es_lock
);

358 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

360 
	`m·th_dbg
(
m·th
->
sd©a
,

362 
m·th
->
d¡
, m·th->
sd©a
->
u
.
mesh
.
num_g©es
);

363 
”r
 = 0;

364 
”r_rcu
:

365 
	`rcu_»ad_uÆock
();

366  
”r
;

367 
	}
}

374 
	$mesh_g©e_d–
(
mesh_bË
 *
tbl
, 
mesh_·th
 *
m·th
)

376 
	`lockd•_as£¹_h–d
(&
m·th
->
¡©e_lock
);

377 ià(!
m·th
->
is_g©e
)

380 
m·th
->
is_g©e
 = 
çl£
;

381 
	`¥š_lock_bh
(&
tbl
->
g©es_lock
);

382 
	`hli¡_d–_rcu
(&
m·th
->
g©e_li¡
);

383 
m·th
->
sd©a
->
u
.
mesh
.
num_g©es
--;

384 
	`¥š_uÆock_bh
(&
tbl
->
g©es_lock
);

386 
	`m·th_dbg
(
m·th
->
sd©a
,

388 
m·th
->
d¡
, m·th->
sd©a
->
u
.
mesh
.
num_g©es
);

389 
	}
}

397 
	$mesh_g©e_num
(
›“80211_sub_if_d©a
 *
sd©a
)

399  
sd©a
->
u
.
mesh
.
num_g©es
;

400 
	}
}

403 
mesh_·th
 *
	$mesh_·th_Ãw
(
›“80211_sub_if_d©a
 *
sd©a
,

404 cÚ¡ 
u8
 *
d¡
, 
gå_t
 
gå_æags
)

406 
mesh_·th
 *
Ãw_m·th
;

408 
Ãw_m·th
 = 
	`kz®loc
((
mesh_·th
), 
gå_æags
);

409 ià(!
Ãw_m·th
)

410  
NULL
;

412 
	`memıy
(
Ãw_m·th
->
d¡
, d¡, 
ETH_ALEN
);

413 
	`‘h_brßdÿ¡_addr
(
Ãw_m·th
->
¿Â_¢d_addr
);

414 
Ãw_m·th
->
is_roÙ
 = 
çl£
;

415 
Ãw_m·th
->
sd©a
 = sdata;

416 
Ãw_m·th
->
æags
 = 0;

417 
	`skb_queue_h—d_š™
(&
Ãw_m·th
->
äame_queue
);

418 
Ãw_m·th
->
exp_time
 = 
jiff›s
;

419 
	`¥š_lock_š™
(&
Ãw_m·th
->
¡©e_lock
);

420 
	`tim”_£tup
(&
Ãw_m·th
->
tim”
, 
mesh_·th_tim”
, 0);

422  
Ãw_m·th
;

423 
	}
}

425 
	$mesh_ç¡_tx_’Œy_ä“
(
mesh_tx_ÿche
 *
ÿche
,

426 
›“80211_mesh_ç¡_tx
 *
’Œy
)

428 
	`hli¡_d–_rcu
(&
’Œy
->
w®k_li¡
);

429 
	`rhashbË_»move_ç¡
(&
ÿche
->
rht
, &
’Œy
->
rhash
, 
ç¡_tx_rht_·¿ms
);

430 
	`kä“_rcu
(
’Œy
, 
ç¡_tx
.
rcu_h—d
);

431 
	}
}

433 
›“80211_mesh_ç¡_tx
 *

434 
	$mesh_ç¡_tx_g‘
(
›“80211_sub_if_d©a
 *
sd©a
,

435 
›“80211_mesh_ç¡_tx_key
 *
key
)

437 
›“80211_mesh_ç¡_tx
 *
’Œy
;

438 
mesh_tx_ÿche
 *
ÿche
;

440 
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

441 
’Œy
 = 
	`rhashbË_lookup
(&
ÿche
->
rht
, 
key
, 
ç¡_tx_rht_·¿ms
);

442 ià(!
’Œy
)

443  
NULL
;

445 ià(!(
’Œy
->
m·th
->
æags
 & 
MESH_PATH_ACTIVE
) ||

446 
	`m·th_expœed
(
’Œy
->
m·th
)) {

447 
	`¥š_lock_bh
(&
ÿche
->
w®k_lock
);

448 
’Œy
 = 
	`rhashbË_lookup
(&
ÿche
->
rht
, 
key
, 
ç¡_tx_rht_·¿ms
);

449 ià(
’Œy
)

450 
	`mesh_ç¡_tx_’Œy_ä“
(
ÿche
, 
’Œy
);

451 
	`¥š_uÆock_bh
(&
ÿche
->
w®k_lock
);

452  
NULL
;

455 
	`mesh_·th_»äesh
(
sd©a
, 
’Œy
->
m·th
, 
NULL
);

456 ià(
’Œy
->
mµ©h
)

457 
’Œy
->
mµ©h
->
exp_time
 = 
jiff›s
;

458 
’Œy
->
time¡amp
 = 
jiff›s
;

460  
’Œy
;

461 
	}
}

463 
	$mesh_ç¡_tx_ÿche
(
›“80211_sub_if_d©a
 *
sd©a
,

464 
sk_buff
 *
skb
, 
mesh_·th
 *
m·th
)

466 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

467 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

468 
›“80211_mesh_ç¡_tx
 *
’Œy
, *
´ev
;

469 
›“80211_mesh_ç¡_tx
 
bud
 = {};

470 
›“80211s_hdr
 *
meshhdr
;

471 
mesh_tx_ÿche
 *
ÿche
;

472 
›“80211_key
 *
key
;

473 
mesh_·th
 *
mµ©h
;

474 
¡a_šfo
 *
¡a
;

475 
u8
 *
qc
;

477 ià(
sd©a
->
nßck_m­
 ||

478 !
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
))

481 
bud
.
ç¡_tx
.
hdr_Ën
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

482 
meshhdr
 = (
›“80211s_hdr
 *)(
skb
->
d©a
 + 
bud
.
ç¡_tx
.
hdr_Ën
);

483 
bud
.
hd¾’
 = 
	`›“80211_g‘_mesh_hd¾’
(
meshhdr
);

485 
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

486 ià(
	`©omic_»ad
(&
ÿche
->
rht
.
ÃËms
è>ğ
MESH_FAST_TX_CACHE_MAX_SIZE
)

489 
¡a
 = 
	`rcu_d”eã»nû
(
m·th
->
Ãxt_hİ
);

490 ià(!
¡a
)

493 
bud
.
key
.
ty³
 = 
MESH_FAST_TX_TYPE_LOCAL
;

494 ià((
meshhdr
->
æags
 & 
MESH_FLAGS_AE
è=ğ
MESH_FLAGS_AE_A5_A6
) {

496 
mµ©h
 = 
	`mµ_·th_lookup
(
sd©a
, 
meshhdr
->
—ddr1
);

497 ià(!
mµ©h
)

499 
bud
.
mµ©h
 = mppath;

500 ià(!
	`‘h”_addr_equ®
(
meshhdr
->
—ddr2
, 
sd©a
->
vif
.
addr
))

501 
bud
.
key
.
ty³
 = 
MESH_FAST_TX_TYPE_PROXIED
;

502 } ià(
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
)) {

503 
mµ©h
 = 
m·th
;

508 ià(!
	`‘h”_addr_equ®
(
hdr
->
addr4
, 
sd©a
->
vif
.
addr
))

509 
bud
.
key
.
ty³
 = 
MESH_FAST_TX_TYPE_FORWARDED
;

512 ià(
mµ©h
->
ç¡_tx_check
 =ğ
jiff›s
)

515 
mµ©h
->
ç¡_tx_check
 = 
jiff›s
;

521 
	`¥š_lock_bh
(&
¡a
->
lock
);

522 
key
 = 
	`rcu_acûss_poš‹r
(
¡a
->
±k
[¡a->
±k_idx
]);

523 ià(!
key
)

524 
key
 = 
	`rcu_acûss_poš‹r
(
sd©a
->
deçuÉ_uniÿ¡_key
);

525 
bud
.
ç¡_tx
.
key
 = key;

527 ià(
key
) {

528 
boŞ
 
g’_iv
, 
iv_¥c
;

530 
g’_iv
 = 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
;

531 
iv_¥c
 = 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
;

533 ià(!(
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
) ||

534 (
key
->
æags
 & 
KEY_FLAG_TAINTED
))

535 
uÆock_¡a
;

537 
key
->
cÚf
.
ch”
) {

538 
WLAN_CIPHER_SUITE_CCMP
:

539 
WLAN_CIPHER_SUITE_CCMP_256
:

540 ià(
g’_iv
)

541 
bud
.
ç¡_tx
.
²_offs
 = bud.ç¡_tx.
hdr_Ën
;

542 ià(
g’_iv
 || 
iv_¥c
)

543 
bud
.
ç¡_tx
.
hdr_Ën
 +ğ
IEEE80211_CCMP_HDR_LEN
;

545 
WLAN_CIPHER_SUITE_GCMP
:

546 
WLAN_CIPHER_SUITE_GCMP_256
:

547 ià(
g’_iv
)

548 
bud
.
ç¡_tx
.
²_offs
 = bud.ç¡_tx.
hdr_Ën
;

549 ià(
g’_iv
 || 
iv_¥c
)

550 
bud
.
ç¡_tx
.
hdr_Ën
 +ğ
IEEE80211_GCMP_HDR_LEN
;

553 
uÆock_¡a
;

557 
	`memıy
(
bud
.
key
.
addr
, 
mµ©h
->
d¡
, 
ETH_ALEN
);

558 
bud
.
time¡amp
 = 
jiff›s
;

559 
bud
.
ç¡_tx
.
bªd
 = 
šfo
->band;

560 
bud
.
ç¡_tx
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

561 
bud
.
ç¡_tx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr4
);

562 
bud
.
m·th
 = mpath;

563 
	`memıy
(
bud
.
hdr
, 
meshhdr
, bud.
hd¾’
);

564 
	`memıy
(
bud
.
hdr
 + bud.
hd¾’
, 
rfc1042_h—d”
, (rfc1042_header));

565 
bud
.
hd¾’
 +ğ(
rfc1042_h—d”
);

566 
	`memıy
(
bud
.
ç¡_tx
.
hdr
, hdr, bud.ç¡_tx.
hdr_Ën
);

568 
hdr
 = (
›“80211_hdr
 *)
bud
.
ç¡_tx
.hdr;

569 ià(
bud
.
ç¡_tx
.
key
)

570 
hdr
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

572 
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

573 
qc
[1] |ğ
IEEE80211_QOS_CTL_MESH_CONTROL_PRESENT
 >> 8;

575 
’Œy
 = 
	`kmemdup
(&
bud
, (bud), 
GFP_ATOMIC
);

576 ià(!
’Œy
)

577 
uÆock_¡a
;

579 
	`¥š_lock
(&
ÿche
->
w®k_lock
);

580 
´ev
 = 
	`rhashbË_lookup_g‘_š£¹_ç¡
(&
ÿche
->
rht
,

581 &
’Œy
->
rhash
,

582 
ç¡_tx_rht_·¿ms
);

583 ià(
	`uÆik–y
(
	`IS_ERR
(
´ev
))) {

584 
	`kä“
(
’Œy
);

585 
uÆock_ÿche
;

592 ià(
	`uÆik–y
(
´ev
)) {

593 
	`rhashbË_»¶aû_ç¡
(&
ÿche
->
rht
, &
´ev
->
rhash
,

594 &
’Œy
->
rhash
, 
ç¡_tx_rht_·¿ms
);

595 
	`hli¡_d–_rcu
(&
´ev
->
w®k_li¡
);

596 
	`kä“_rcu
(
´ev
, 
ç¡_tx
.
rcu_h—d
);

599 
	`hli¡_add_h—d
(&
’Œy
->
w®k_li¡
, &
ÿche
->
w®k_h—d
);

601 
uÆock_ÿche
:

602 
	`¥š_uÆock
(&
ÿche
->
w®k_lock
);

603 
uÆock_¡a
:

604 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

605 
	}
}

607 
	$mesh_ç¡_tx_gc
(
›“80211_sub_if_d©a
 *
sd©a
)

609 
timeout
 = 
	`m£cs_to_jiff›s
(
MESH_FAST_TX_CACHE_TIMEOUT
);

610 
mesh_tx_ÿche
 *
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

611 
›“80211_mesh_ç¡_tx
 *
’Œy
;

612 
hli¡_node
 *
n
;

614 ià(
	`©omic_»ad
(&
ÿche
->
rht
.
ÃËms
è< 
MESH_FAST_TX_CACHE_THRESHOLD_SIZE
)

617 
	`¥š_lock_bh
(&
ÿche
->
w®k_lock
);

618 
	`hli¡_fÜ_—ch_’Œy_§ã
(
’Œy
, 
n
, &
ÿche
->
w®k_h—d
, 
w®k_li¡
)

619 ià(!
	`time_is_aá”_jiff›s
(
’Œy
->
time¡amp
 + 
timeout
))

620 
	`mesh_ç¡_tx_’Œy_ä“
(
ÿche
, 
’Œy
);

621 
	`¥š_uÆock_bh
(&
ÿche
->
w®k_lock
);

622 
	}
}

624 
	$mesh_ç¡_tx_æush_m·th
(
mesh_·th
 *
m·th
)

626 
›“80211_sub_if_d©a
 *
sd©a
 = 
m·th
->sdata;

627 
mesh_tx_ÿche
 *
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

628 
›“80211_mesh_ç¡_tx
 *
’Œy
;

629 
hli¡_node
 *
n
;

631 
	`¥š_lock_bh
(&
ÿche
->
w®k_lock
);

632 
	`hli¡_fÜ_—ch_’Œy_§ã
(
’Œy
, 
n
, &
ÿche
->
w®k_h—d
, 
w®k_li¡
)

633 ià(
’Œy
->
m·th
 == mpath)

634 
	`mesh_ç¡_tx_’Œy_ä“
(
ÿche
, 
’Œy
);

635 
	`¥š_uÆock_bh
(&
ÿche
->
w®k_lock
);

636 
	}
}

638 
	$mesh_ç¡_tx_æush_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

639 
¡a_šfo
 *
¡a
)

641 
mesh_tx_ÿche
 *
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

642 
›“80211_mesh_ç¡_tx
 *
’Œy
;

643 
hli¡_node
 *
n
;

645 
	`¥š_lock_bh
(&
ÿche
->
w®k_lock
);

646 
	`hli¡_fÜ_—ch_’Œy_§ã
(
’Œy
, 
n
, &
ÿche
->
w®k_h—d
, 
w®k_li¡
)

647 ià(
	`rcu_acûss_poš‹r
(
’Œy
->
m·th
->
Ãxt_hİ
è=ğ
¡a
)

648 
	`mesh_ç¡_tx_’Œy_ä“
(
ÿche
, 
’Œy
);

649 
	`¥š_uÆock_bh
(&
ÿche
->
w®k_lock
);

650 
	}
}

652 
	$mesh_ç¡_tx_æush_addr
(
›“80211_sub_if_d©a
 *
sd©a
,

653 cÚ¡ 
u8
 *
addr
)

655 
mesh_tx_ÿche
 *
ÿche
 = &
sd©a
->
u
.
mesh
.
tx_ÿche
;

656 
›“80211_mesh_ç¡_tx_key
 
key
 = {};

657 
›“80211_mesh_ç¡_tx
 *
’Œy
;

658 
i
;

660 
	`‘h”_addr_cİy
(
key
.
addr
,‡ddr);

661 
	`¥š_lock_bh
(&
ÿche
->
w®k_lock
);

662 
i
 = 0; i < 
NUM_MESH_FAST_TX_TYPE
; i++) {

663 
key
.
ty³
 = 
i
;

664 
’Œy
 = 
	`rhashbË_lookup_ç¡
(&
ÿche
->
rht
, &
key
, 
ç¡_tx_rht_·¿ms
);

665 ià(
’Œy
)

666 
	`mesh_ç¡_tx_’Œy_ä“
(
ÿche
, 
’Œy
);

668 
	`¥š_uÆock_bh
(&
ÿche
->
w®k_lock
);

669 
	}
}

680 
mesh_·th
 *
	$mesh_·th_add
(
›“80211_sub_if_d©a
 *
sd©a
,

681 cÚ¡ 
u8
 *
d¡
)

683 
mesh_bË
 *
tbl
;

684 
mesh_·th
 *
m·th
, *
Ãw_m·th
;

686 ià(
	`‘h”_addr_equ®
(
d¡
, 
sd©a
->
vif
.
addr
))

688  
	`ERR_PTR
(-
EOPNOTSUPP
);

690 ià(
	`is_muÉiÿ¡_‘h”_addr
(
d¡
))

691  
	`ERR_PTR
(-
EOPNOTSUPP
);

693 ià(
	`©omic_add_uÆess
(&
sd©a
->
u
.
mesh
.
m·ths
, 1, 
MESH_MAX_MPATHS
) == 0)

694  
	`ERR_PTR
(-
ENOSPC
);

696 
Ãw_m·th
 = 
	`mesh_·th_Ãw
(
sd©a
, 
d¡
, 
GFP_ATOMIC
);

697 ià(!
Ãw_m·th
)

698  
	`ERR_PTR
(-
ENOMEM
);

700 
tbl
 = &
sd©a
->
u
.
mesh
.
mesh_·ths
;

701 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

702 
m·th
 = 
	`rhashbË_lookup_g‘_š£¹_ç¡
(&
tbl
->
rh—d
,

703 &
Ãw_m·th
->
rhash
,

704 
mesh_rht_·¿ms
);

705 ià(!
m·th
)

706 
	`hli¡_add_h—d
(&
Ãw_m·th
->
w®k_li¡
, &
tbl
->
w®k_h—d
);

707 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

709 ià(
m·th
) {

710 
	`kä“
(
Ãw_m·th
);

712 ià(
	`IS_ERR
(
m·th
))

713  
m·th
;

715 
Ãw_m·th
 = 
m·th
;

718 
sd©a
->
u
.
mesh
.
mesh_·ths_g’”©iÚ
++;

719  
Ãw_m·th
;

720 
	}
}

722 
	$mµ_·th_add
(
›“80211_sub_if_d©a
 *
sd©a
,

723 cÚ¡ 
u8
 *
d¡
, cÚ¡ u8 *
mµ
)

725 
mesh_bË
 *
tbl
;

726 
mesh_·th
 *
Ãw_m·th
;

727 
»t
;

729 ià(
	`‘h”_addr_equ®
(
d¡
, 
sd©a
->
vif
.
addr
))

731  -
EOPNOTSUPP
;

733 ià(
	`is_muÉiÿ¡_‘h”_addr
(
d¡
))

734  -
EOPNOTSUPP
;

736 
Ãw_m·th
 = 
	`mesh_·th_Ãw
(
sd©a
, 
d¡
, 
GFP_ATOMIC
);

738 ià(!
Ãw_m·th
)

739  -
ENOMEM
;

741 
	`memıy
(
Ãw_m·th
->
mµ
, mµ, 
ETH_ALEN
);

742 
tbl
 = &
sd©a
->
u
.
mesh
.
mµ_·ths
;

744 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

745 
»t
 = 
	`rhashbË_lookup_š£¹_ç¡
(&
tbl
->
rh—d
,

746 &
Ãw_m·th
->
rhash
,

747 
mesh_rht_·¿ms
);

748 ià(!
»t
)

749 
	`hli¡_add_h—d_rcu
(&
Ãw_m·th
->
w®k_li¡
, &
tbl
->
w®k_h—d
);

750 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

752 ià(
»t
)

753 
	`kä“
(
Ãw_m·th
);

755 
	`mesh_ç¡_tx_æush_addr
(
sd©a
, 
d¡
);

757 
sd©a
->
u
.
mesh
.
mµ_·ths_g’”©iÚ
++;

758  
»t
;

759 
	}
}

770 
	$mesh_¶šk_brok’
(
¡a_šfo
 *
¡a
)

772 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

773 
mesh_bË
 *
tbl
 = &
sd©a
->
u
.
mesh
.
mesh_·ths
;

774 cÚ¡ 
u8
 
bÿ¡
[
ETH_ALEN
] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

775 
mesh_·th
 *
m·th
;

777 
	`rcu_»ad_lock
();

778 
	`hli¡_fÜ_—ch_’Œy_rcu
(
m·th
, &
tbl
->
w®k_h—d
, 
w®k_li¡
) {

779 ià(
	`rcu_acûss_poš‹r
(
m·th
->
Ãxt_hİ
è=ğ
¡a
 &&

780 
m·th
->
æags
 & 
MESH_PATH_ACTIVE
 &&

781 !(
m·th
->
æags
 & 
MESH_PATH_FIXED
)) {

782 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

783 
m·th
->
æags
 &ğ~
MESH_PATH_ACTIVE
;

784 ++
m·th
->
¢
;

785 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

786 
	`mesh_·th_”rÜ_tx
(
sd©a
,

787 
sd©a
->
u
.
mesh
.
mshcfg
.
–em’t_‰l
,

788 
m·th
->
d¡
, m·th->
¢
,

789 
WLAN_REASON_MESH_PATH_DEST_UNREACHABLE
, 
bÿ¡
);

792 
	`rcu_»ad_uÆock
();

793 
	}
}

795 
	$mesh_·th_ä“_rcu
(
mesh_bË
 *
tbl
,

796 
mesh_·th
 *
m·th
)

798 
›“80211_sub_if_d©a
 *
sd©a
 = 
m·th
->sdata;

800 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

801 
m·th
->
æags
 |ğ
MESH_PATH_RESOLVING
 | 
MESH_PATH_DELETED
;

802 
	`mesh_g©e_d–
(
tbl
, 
m·th
);

803 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

804 
	`tim”_shutdown_sync
(&
m·th
->
tim”
);

805 
	`©omic_dec
(&
sd©a
->
u
.
mesh
.
m·ths
);

806 
	`©omic_dec
(&
tbl
->
’Œ›s
);

807 
	`mesh_·th_æush_³ndšg
(
m·th
);

808 
	`kä“_rcu
(
m·th
, 
rcu
);

809 
	}
}

811 
	$__mesh_·th_d–
(
mesh_bË
 *
tbl
, 
mesh_·th
 *
m·th
)

813 
	`hli¡_d–_rcu
(&
m·th
->
w®k_li¡
);

814 
	`rhashbË_»move_ç¡
(&
tbl
->
rh—d
, &
m·th
->
rhash
, 
mesh_rht_·¿ms
);

815 ià(
tbl
 =ğ&
m·th
->
sd©a
->
u
.
mesh
.
mµ_·ths
)

816 
	`mesh_ç¡_tx_æush_addr
(
m·th
->
sd©a
, m·th->
d¡
);

818 
	`mesh_ç¡_tx_æush_m·th
(
m·th
);

819 
	`mesh_·th_ä“_rcu
(
tbl
, 
m·th
);

820 
	}
}

833 
	$mesh_·th_æush_by_Ãxthİ
(
¡a_šfo
 *
¡a
)

835 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

836 
mesh_bË
 *
tbl
 = &
sd©a
->
u
.
mesh
.
mesh_·ths
;

837 
mesh_·th
 *
m·th
;

838 
hli¡_node
 *
n
;

840 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

841 
	`hli¡_fÜ_—ch_’Œy_§ã
(
m·th
, 
n
, &
tbl
->
w®k_h—d
, 
w®k_li¡
) {

842 ià(
	`rcu_acûss_poš‹r
(
m·th
->
Ãxt_hİ
è=ğ
¡a
)

843 
	`__mesh_·th_d–
(
tbl
, 
m·th
);

845 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

846 
	}
}

848 
	$mµ_æush_by_´oxy
(
›“80211_sub_if_d©a
 *
sd©a
,

849 cÚ¡ 
u8
 *
´oxy
)

851 
mesh_bË
 *
tbl
 = &
sd©a
->
u
.
mesh
.
mµ_·ths
;

852 
mesh_·th
 *
m·th
;

853 
hli¡_node
 *
n
;

855 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

856 
	`hli¡_fÜ_—ch_’Œy_§ã
(
m·th
, 
n
, &
tbl
->
w®k_h—d
, 
w®k_li¡
) {

857 ià(
	`‘h”_addr_equ®
(
m·th
->
mµ
, 
´oxy
))

858 
	`__mesh_·th_d–
(
tbl
, 
m·th
);

860 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

861 
	}
}

863 
	$bË_æush_by_içû
(
mesh_bË
 *
tbl
)

865 
mesh_·th
 *
m·th
;

866 
hli¡_node
 *
n
;

868 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

869 
	`hli¡_fÜ_—ch_’Œy_§ã
(
m·th
, 
n
, &
tbl
->
w®k_h—d
, 
w®k_li¡
) {

870 
	`__mesh_·th_d–
(
tbl
, 
m·th
);

872 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

873 
	}
}

882 
	$mesh_·th_æush_by_içû
(
›“80211_sub_if_d©a
 *
sd©a
)

884 
	`bË_æush_by_içû
(&
sd©a
->
u
.
mesh
.
mesh_·ths
);

885 
	`bË_æush_by_içû
(&
sd©a
->
u
.
mesh
.
mµ_·ths
);

886 
	}
}

897 
	$bË_·th_d–
(
mesh_bË
 *
tbl
,

898 
›“80211_sub_if_d©a
 *
sd©a
,

899 cÚ¡ 
u8
 *
addr
)

901 
mesh_·th
 *
m·th
;

903 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

904 
m·th
 = 
	`rhashbË_lookup_ç¡
(&
tbl
->
rh—d
, 
addr
, 
mesh_rht_·¿ms
);

905 ià(!
m·th
) {

906 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

907  -
ENXIO
;

910 
	`__mesh_·th_d–
(
tbl
, 
m·th
);

911 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

913 
	}
}

924 
	$mesh_·th_d–
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
addr
)

926 
”r
;

929 
	`mµ_æush_by_´oxy
(
sd©a
, 
addr
);

931 
”r
 = 
	`bË_·th_d–
(&
sd©a
->
u
.
mesh
.
mesh_·ths
, sd©a, 
addr
);

932 
sd©a
->
u
.
mesh
.
mesh_·ths_g’”©iÚ
++;

933  
”r
;

934 
	}
}

944 
	$mesh_·th_tx_³ndšg
(
mesh_·th
 *
m·th
)

946 ià(
m·th
->
æags
 & 
MESH_PATH_ACTIVE
)

947 
	`›“80211_add_³ndšg_skbs
(
m·th
->
sd©a
->
loÿl
,

948 &
m·th
->
äame_queue
);

949 
	}
}

963 
	$mesh_·th_£nd_to_g©es
(
mesh_·th
 *
m·th
)

965 
›“80211_sub_if_d©a
 *
sd©a
 = 
m·th
->sdata;

966 
mesh_bË
 *
tbl
;

967 
mesh_·th
 *
äom_m·th
 = 
m·th
;

968 
mesh_·th
 *
g©e
;

969 
boŞ
 
cİy
 = 
çl£
;

971 
tbl
 = &
sd©a
->
u
.
mesh
.
mesh_·ths
;

973 
	`rcu_»ad_lock
();

974 
	`hli¡_fÜ_—ch_’Œy_rcu
(
g©e
, &
tbl
->
known_g©es
, 
g©e_li¡
) {

975 ià(
g©e
->
æags
 & 
MESH_PATH_ACTIVE
) {

976 
	`m·th_dbg
(
sd©a
, "FÜw¬dšgØ%pM\n", 
g©e
->
d¡
);

977 
	`mesh_·th_move_to_queue
(
g©e
, 
äom_m·th
, 
cİy
);

978 
äom_m·th
 = 
g©e
;

979 
cİy
 = 
Œue
;

981 
	`m·th_dbg
(
sd©a
,

983 
g©e
->
d¡
, g©e->
æags
);

987 
	`hli¡_fÜ_—ch_’Œy_rcu
(
g©e
, &
tbl
->
known_g©es
, 
g©e_li¡
) {

988 
	`m·th_dbg
(
sd©a
, "S’dšgØ%pM\n", 
g©e
->
d¡
);

989 
	`mesh_·th_tx_³ndšg
(
g©e
);

991 
	`rcu_»ad_uÆock
();

993  (
äom_m·th
 =ğ
m·th
è? -
EHOSTUNREACH
 : 0;

994 
	}
}

1004 
	$mesh_·th_disÿrd_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

1005 
sk_buff
 *
skb
)

1007 
	`›“80211_ä“_txskb
(&
sd©a
->
loÿl
->
hw
, 
skb
);

1008 
sd©a
->
u
.
mesh
.
msh¡©s
.
drİ³d_äames_no_rou‹
++;

1009 
	}
}

1018 
	$mesh_·th_æush_³ndšg
(
mesh_·th
 *
m·th
)

1020 
sk_buff
 *
skb
;

1022 (
skb
 = 
	`skb_dequeue
(&
m·th
->
äame_queue
)è!ğ
NULL
)

1023 
	`mesh_·th_disÿrd_äame
(
m·th
->
sd©a
, 
skb
);

1024 
	}
}

1034 
	$mesh_·th_fix_Ãxthİ
(
mesh_·th
 *
m·th
, 
¡a_šfo
 *
Ãxt_hİ
)

1036 
	`¥š_lock_bh
(&
m·th
->
¡©e_lock
);

1037 
	`mesh_·th_assign_Ãxthİ
(
m·th
, 
Ãxt_hİ
);

1038 
m·th
->
¢
 = 0xffff;

1039 
m·th
->
m‘ric
 = 0;

1040 
m·th
->
hİ_couÁ
 = 0;

1041 
m·th
->
exp_time
 = 0;

1042 
m·th
->
æags
 = 
MESH_PATH_FIXED
 | 
MESH_PATH_SN_VALID
;

1043 
	`mesh_·th_aùiv©e
(
m·th
);

1044 
	`mesh_ç¡_tx_æush_m·th
(
m·th
);

1045 
	`¥š_uÆock_bh
(&
m·th
->
¡©e_lock
);

1046 
	`ewma_mesh_ç_avg_š™
(&
Ãxt_hİ
->
mesh
->
ç_avg
);

1048 
	`ewma_mesh_ç_avg_add
(&
Ãxt_hİ
->
mesh
->
ç_avg
, 1);

1049 
	`mesh_·th_tx_³ndšg
(
m·th
);

1050 
	}
}

1052 
	$mesh_·thtbl_š™
(
›“80211_sub_if_d©a
 *
sd©a
)

1054 
	`mesh_bË_š™
(&
sd©a
->
u
.
mesh
.
mesh_·ths
);

1055 
	`mesh_bË_š™
(&
sd©a
->
u
.
mesh
.
mµ_·ths
);

1056 
	`mesh_ç¡_tx_š™
(
sd©a
);

1057 
	}
}

1060 
	$mesh_·th_tbl_expœe
(
›“80211_sub_if_d©a
 *
sd©a
,

1061 
mesh_bË
 *
tbl
)

1063 
mesh_·th
 *
m·th
;

1064 
hli¡_node
 *
n
;

1066 
	`¥š_lock_bh
(&
tbl
->
w®k_lock
);

1067 
	`hli¡_fÜ_—ch_’Œy_§ã
(
m·th
, 
n
, &
tbl
->
w®k_h—d
, 
w®k_li¡
) {

1068 ià((!(
m·th
->
æags
 & 
MESH_PATH_RESOLVING
)) &&

1069 (!(
m·th
->
æags
 & 
MESH_PATH_FIXED
)) &&

1070 
	`time_aá”
(
jiff›s
, 
m·th
->
exp_time
 + 
MESH_PATH_EXPIRE
))

1071 
	`__mesh_·th_d–
(
tbl
, 
m·th
);

1073 
	`¥š_uÆock_bh
(&
tbl
->
w®k_lock
);

1074 
	}
}

1076 
	$mesh_·th_expœe
(
›“80211_sub_if_d©a
 *
sd©a
)

1078 
	`mesh_·th_tbl_expœe
(
sd©a
, &sd©a->
u
.
mesh
.
mesh_·ths
);

1079 
	`mesh_·th_tbl_expœe
(
sd©a
, &sd©a->
u
.
mesh
.
mµ_·ths
);

1080 
	}
}

1082 
	$mesh_·thtbl_uÄegi¡”
(
›“80211_sub_if_d©a
 *
sd©a
)

1084 
	`mesh_ç¡_tx_deš™
(
sd©a
);

1085 
	`mesh_bË_ä“
(&
sd©a
->
u
.
mesh
.
mesh_·ths
);

1086 
	`mesh_bË_ä“
(&
sd©a
->
u
.
mesh
.
mµ_·ths
);

1087 
	}
}

	@mesh_plink.c

7 
	~<lšux/gå.h
>

8 
	~<lšux/k”Ãl.h
>

9 
	~<lšux/¿ndom.h
>

10 
	~<lšux/rculi¡.h
>

12 
	~"›“80211_i.h
"

13 
	~"¿‹.h
"

14 
	~"mesh.h
"

16 
	#PLINK_CNF_AID
(
mgmt
è((mgmt)->
u
.
aùiÚ
.u.
£lf_´Ù
.
v¬ŸbË
 + 2)

	)

17 
	#PLINK_GET_LLID
(
p
èÕ + 2)

	)

18 
	#PLINK_GET_PLID
(
p
èÕ + 4)

	)

20 
	#mod_¶šk_tim”
(
s
, 
t
è(
	`mod_tim”
(&s->
mesh
->
¶šk_tim”
, \

21 
jiff›s
 + 
	`m£cs_to_jiff›s
(
t
)))

	)

23 
	e¶šk_ev’t
 {

24 
	mPLINK_UNDEFINED
,

25 
	mOPN_ACPT
,

26 
	mOPN_RJCT
,

27 
	mOPN_IGNR
,

28 
	mCNF_ACPT
,

29 
	mCNF_RJCT
,

30 
	mCNF_IGNR
,

31 
	mCLS_ACPT
,

32 
	mCLS_IGNR


35 cÚ¡ * cÚ¡ 
	gm¶¡©es
[] = {

36 [
NL80211_PLINK_LISTEN
] = "LISTEN",

37 [
NL80211_PLINK_OPN_SNT
] = "OPN-SNT",

38 [
NL80211_PLINK_OPN_RCVD
] = "OPN-RCVD",

39 [
NL80211_PLINK_CNF_RCVD
] = "CNF_RCVD",

40 [
NL80211_PLINK_ESTAB
] = "ESTAB",

41 [
NL80211_PLINK_HOLDING
] = "HOLDING",

42 [
NL80211_PLINK_BLOCKED
] = "BLOCKED"

45 cÚ¡ * cÚ¡ 
	gm¶ev’ts
[] = {

46 [
PLINK_UNDEFINED
] = "NONE",

47 [
OPN_ACPT
] = "OPN_ACPT",

48 [
OPN_RJCT
] = "OPN_RJCT",

49 [
OPN_IGNR
] = "OPN_IGNR",

50 [
CNF_ACPT
] = "CNF_ACPT",

51 [
CNF_RJCT
] = "CNF_RJCT",

52 [
CNF_IGNR
] = "CNF_IGNR",

53 [
CLS_ACPT
] = "CLS_ACPT",

54 [
CLS_IGNR
] = "CLS_IGNR"

58 
boŞ
 
	$rssi_th»shŞd_check
(
›“80211_sub_if_d©a
 *
sd©a
,

59 
¡a_šfo
 *
¡a
)

61 
s32
 
rssi_th»shŞd
 = 
sd©a
->
u
.
mesh
.
mshcfg
.rssi_threshold;

62  
rssi_th»shŞd
 == 0 ||

63 (
¡a
 &&

64 (
s8
)-
	`ewma_sigÇl_»ad
(&
¡a
->
deæšk
.
rx_¡©s_avg
.
sigÇl
) >

65 
rssi_th»shŞd
);

66 
	}
}

75 
šlše
 
	$mesh_¶šk_fsm_»¡¬t
(
¡a_šfo
 *
¡a
)

77 
	`lockd•_as£¹_h–d
(&
¡a
->
mesh
->
¶šk_lock
);

78 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_LISTEN
;

79 
¡a
->
mesh
->
Îid
 = s->mesh->
¶id
 = s->mesh->
»asÚ
 = 0;

80 
¡a
->
mesh
->
¶šk_»Œ›s
 = 0;

81 
	}
}

93 
u64
 
	$mesh_£t_shÜt_¦Ù_time
(
›“80211_sub_if_d©a
 *
sd©a
)

95 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

96 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

97 
¡a_šfo
 *
¡a
;

98 
u32
 
”p_¿‹s
 = 0;

99 
u64
 
chªged
 = 0;

100 
i
;

101 
boŞ
 
shÜt_¦Ù
 = 
çl£
;

103 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

104 ià(!
sbªd
)

105  
chªged
;

107 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_5GHZ
) {

109 
shÜt_¦Ù
 = 
Œue
;

110 
out
;

111 } ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_2GHZ
) {

112 
out
;

115 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++)

116 ià(
sbªd
->
b™¿‹s
[
i
].
æags
 & 
IEEE80211_RATE_ERP_G
)

117 
”p_¿‹s
 |ğ
	`BIT
(
i
);

119 ià(!
”p_¿‹s
)

120 
out
;

122 
	`rcu_»ad_lock
();

123 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

124 ià(
sd©a
 !ğ
¡a
->sdata ||

125 
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
)

128 
shÜt_¦Ù
 = 
çl£
;

129 ià(
”p_¿‹s
 & 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
sbªd
->
bªd
])

130 
shÜt_¦Ù
 = 
Œue
;

134 
	`rcu_»ad_uÆock
();

136 
out
:

137 ià(
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_¦Ù
 !ğ
shÜt_¦Ù
) {

138 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_¦Ù
 = 
shÜt_¦Ù
;

139 
chªged
 = 
BSS_CHANGED_ERP_SLOT
;

140 
	`m¶_dbg
(
sd©a
, "mesh_plink %pM: ERP short slotime %d\n",

141 
sd©a
->
vif
.
addr
, 
shÜt_¦Ù
);

143  
chªged
;

144 
	}
}

159 
u64
 
	$mesh_£t_ht_´Ù_mode
(
›“80211_sub_if_d©a
 *
sd©a
)

161 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

162 
¡a_šfo
 *
¡a
;

163 
u16
 
ht_İmode
;

164 
boŞ
 
nÚ_ht_¡a
 = 
çl£
, 
ht20_¡a
 = false;

166 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
) {

167 
NL80211_CHAN_WIDTH_20_NOHT
:

168 
NL80211_CHAN_WIDTH_5
:

169 
NL80211_CHAN_WIDTH_10
:

175 
	`rcu_»ad_lock
();

176 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

177 ià(
sd©a
 !ğ
¡a
->sdata ||

178 
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
)

181 ià(
¡a
->¡a.
deæšk
.
bªdwidth
 > 
IEEE80211_STA_RX_BW_20
)

184 ià(!
¡a
->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
) {

185 
	`m¶_dbg
(
sd©a
, "nonHT sta (%pM) is…resent\n",

186 
¡a
->¡a.
addr
);

187 
nÚ_ht_¡a
 = 
Œue
;

191 
	`m¶_dbg
(
sd©a
, "HT20 s (%pMèi ´e£Á\n", 
¡a
->¡a.
addr
);

192 
ht20_¡a
 = 
Œue
;

194 
	`rcu_»ad_uÆock
();

196 ià(
nÚ_ht_¡a
)

197 
ht_İmode
 = 
IEEE80211_HT_OP_MODE_PROTECTION_NONHT_MIXED
;

198 ià(
ht20_¡a
 &&

199 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
 > 
NL80211_CHAN_WIDTH_20
)

200 
ht_İmode
 = 
IEEE80211_HT_OP_MODE_PROTECTION_20MHZ
;

202 
ht_İmode
 = 
IEEE80211_HT_OP_MODE_PROTECTION_NONE
;

204 ià(
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
 =ğ
ht_İmode
)

207 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
 = 
ht_İmode
;

208 
sd©a
->
u
.
mesh
.
mshcfg
.
ht_İmode
 = ht_opmode;

209 
	`m¶_dbg
(
sd©a
, "£Ëùed‚ew HT…rÙeùiÚ mod%d\n", 
ht_İmode
);

210  
BSS_CHANGED_HT
;

211 
	}
}

213 
	$mesh_¶šk_äame_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

214 
¡a_šfo
 *
¡a
,

215 
›“80211_£lf_´Ùeùed_aùiÚcode
 
aùiÚ
,

216 
u8
 *
da
, 
u16
 
Îid
, u16 
¶id
, u16 
»asÚ
)

218 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

219 
sk_buff
 *
skb
;

220 
›“80211_tx_šfo
 *
šfo
;

221 
›“80211_mgmt
 *
mgmt
;

222 
boŞ
 
šşude_¶id
 = 
çl£
;

223 
u16
 
³”šg_´Ùo
 = 0;

224 
u8
 *
pos
, 
›_Ën
 = 4;

225 
u8
 
›_Ën_he_ÿp
, 
›_Ën_eht_ÿp
;

226 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
, 
u
.
aùiÚ
.u.
£lf_´Ù
);

227 
”r
 = -
ENOMEM
;

229 
›_Ën_he_ÿp
 = 
	`›“80211_›_Ën_he_ÿp
(
sd©a
);

230 
›_Ën_eht_ÿp
 = 
	`›“80211_›_Ën_eht_ÿp
(
sd©a
);

231 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 +

232 
hdr_Ën
 +

236 2 + (
IEEE80211_MAX_SUPP_RATES
 - 8) +

237 2 + 
sd©a
->
u
.
mesh
.
mesh_id_Ën
 +

238 2 + (
›“80211_meshcÚf_›
) +

239 2 + (
›“80211_ht_ÿp
) +

240 2 + (
›“80211_ht_İ”©iÚ
) +

241 2 + (
›“80211_vht_ÿp
) +

242 2 + (
›“80211_vht_İ”©iÚ
) +

243 
›_Ën_he_ÿp
 +

244 2 + 1 + (
›“80211_he_İ”©iÚ
) +

245 (
›“80211_he_6ghz_İ”
) +

246 2 + 1 + (
›“80211_he_6ghz_ÿ·
) +

247 
›_Ën_eht_ÿp
 +

248 2 + 1 + 
	`off£tof
(
›“80211_eht_İ”©iÚ
, 
İtiÚ®
) +

249 
	`off£tof
(
›“80211_eht_İ”©iÚ_šfo
, 
İtiÚ®
) +

251 
sd©a
->
u
.
mesh
.
›_Ën
);

252 ià(!
skb
)

253  
”r
;

254 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

255 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

256 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

257 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

258 
IEEE80211_STYPE_ACTION
);

259 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

260 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

261 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

262 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_SELF_PROTECTED
;

263 
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
aùiÚ_code
 =‡ction;

265 ià(
aùiÚ
 !ğ
WLAN_SP_MESH_PEERING_CLOSE
) {

266 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

267 
u32
 
¿‹_æags
, 
basic_¿‹s
;

269 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

270 ià(!
sbªd
) {

271 
”r
 = -
EINVAL
;

272 
ä“
;

276 
pos
 = 
	`skb_put_z”o
(
skb
, 2);

277 ià(
aùiÚ
 =ğ
WLAN_SP_MESH_PEERING_CONFIRM
) {

279 
pos
 = 
	`skb_put
(
skb
, 2);

280 
	`put_uÇligÃd_Ë16
(
¡a
->¡a.
aid
, 
pos
);

283 
¿‹_æags
 =

284 
	`›“80211_chªdef_¿‹_æags
(&
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
);

285 
basic_¿‹s
 = 
sd©a
->
vif
.
bss_cÚf
.basic_rates;

287 ià(
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 
basic_¿‹s
,

288 
¿‹_æags
, 0,

289 
WLAN_EID_SUPP_RATES
) ||

290 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 
basic_¿‹s
,

291 
¿‹_æags
, 0,

292 
WLAN_EID_EXT_SUPP_RATES
) ||

293 
	`mesh_add_r¢_›
(
sd©a
, 
skb
) ||

294 
	`mesh_add_meshid_›
(
sd©a
, 
skb
) ||

295 
	`mesh_add_meshcÚf_›
(
sd©a
, 
skb
))

296 
ä“
;

298 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

299 ià(
	`mesh_add_meshid_›
(
sd©a
, 
skb
))

300 
ä“
;

304 
aùiÚ
) {

305 
WLAN_SP_MESH_PEERING_OPEN
:

307 
WLAN_SP_MESH_PEERING_CONFIRM
:

308 
›_Ën
 += 2;

309 
šşude_¶id
 = 
Œue
;

311 
WLAN_SP_MESH_PEERING_CLOSE
:

312 ià(
¶id
) {

313 
›_Ën
 += 2;

314 
šşude_¶id
 = 
Œue
;

316 
›_Ën
 += 2;

319 
”r
 = -
EINVAL
;

320 
ä“
;

323 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< 2 + 
›_Ën
))

324 
ä“
;

326 
pos
 = 
	`skb_put
(
skb
, 2 + 
›_Ën
);

327 *
pos
++ = 
WLAN_EID_PEER_MGMT
;

328 *
pos
++ = 
›_Ën
;

329 
	`memıy
(
pos
, &
³”šg_´Ùo
, 2);

330 
pos
 += 2;

331 
	`put_uÇligÃd_Ë16
(
Îid
, 
pos
);

332 
pos
 += 2;

333 ià(
šşude_¶id
) {

334 
	`put_uÇligÃd_Ë16
(
¶id
, 
pos
);

335 
pos
 += 2;

337 ià(
aùiÚ
 =ğ
WLAN_SP_MESH_PEERING_CLOSE
) {

338 
	`put_uÇligÃd_Ë16
(
»asÚ
, 
pos
);

339 
pos
 += 2;

342 ià(
aùiÚ
 !ğ
WLAN_SP_MESH_PEERING_CLOSE
) {

343 ià(
	`mesh_add_ht_ÿp_›
(
sd©a
, 
skb
) ||

344 
	`mesh_add_ht_İ”_›
(
sd©a
, 
skb
) ||

345 
	`mesh_add_vht_ÿp_›
(
sd©a
, 
skb
) ||

346 
	`mesh_add_vht_İ”_›
(
sd©a
, 
skb
) ||

347 
	`mesh_add_he_ÿp_›
(
sd©a
, 
skb
, 
›_Ën_he_ÿp
) ||

348 
	`mesh_add_he_İ”_›
(
sd©a
, 
skb
) ||

349 
	`mesh_add_he_6ghz_ÿp_›
(
sd©a
, 
skb
) ||

350 
	`mesh_add_eht_ÿp_›
(
sd©a
, 
skb
, 
›_Ën_eht_ÿp
) ||

351 
	`mesh_add_eht_İ”_›
(
sd©a
, 
skb
))

352 
ä“
;

355 ià(
	`mesh_add_v’dÜ_›s
(
sd©a
, 
skb
))

356 
ä“
;

358 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

360 
ä“
:

361 
	`kä“_skb
(
skb
);

362  
”r
;

363 
	}
}

377 
u64
 
	$__mesh_¶šk_d—ùiv©e
(
¡a_šfo
 *
¡a
)

379 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

380 
u64
 
chªged
 = 0;

382 
	`lockd•_as£¹_h–d
(&
¡a
->
mesh
->
¶šk_lock
);

384 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

385 
chªged
 = 
	`mesh_¶šk_dec_e¡ab_couÁ
(
sd©a
);

386 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_BLOCKED
;

388 
	`›“80211_mps_¡a_¡©us_upd©e
(
¡a
);

389 
chªged
 |ğ
	`›“80211_mps_£t_¡a_loÿl_pm
(
¡a
,

390 
NL80211_MESH_POWER_UNKNOWN
);

392  
chªged
;

393 
	}
}

404 
u64
 
	$mesh_¶šk_d—ùiv©e
(
¡a_šfo
 *
¡a
)

406 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

407 
u64
 
chªged
;

409 
	`¥š_lock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

410 
chªged
 = 
	`__mesh_¶šk_d—ùiv©e
(
¡a
);

412 ià(!
sd©a
->
u
.
mesh
.
u£r_mpm
) {

413 
¡a
->
mesh
->
»asÚ
 = 
WLAN_REASON_MESH_PEER_CANCELED
;

414 
	`mesh_¶šk_äame_tx
(
sd©a
, 
¡a
, 
WLAN_SP_MESH_PEERING_CLOSE
,

415 
¡a
->¡a.
addr
, s->
mesh
->
Îid
,

416 
¡a
->
mesh
->
¶id
, s->mesh->
»asÚ
);

418 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

419 ià(!
sd©a
->
u
.
mesh
.
u£r_mpm
)

420 
	`d–_tim”_sync
(&
¡a
->
mesh
->
¶šk_tim”
);

421 
	`mesh_·th_æush_by_Ãxthİ
(
¡a
);

424 
	`synchrÚize_Ãt
();

426  
chªged
;

427 
	}
}

429 
	$mesh_¡a_šfo_š™
(
›“80211_sub_if_d©a
 *
sd©a
,

430 
¡a_šfo
 *
¡a
,

431 
›“802_11_–ems
 *
–ems
)

433 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

434 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

435 
u32
 
¿‹s
, 
basic_¿‹s
 = 0, 
chªged
 = 0;

436 
›“80211_¡a_rx_bªdwidth
 
bw
 = 
¡a
->¡a.
deæšk
.
bªdwidth
;

438 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

439 ià(!
sbªd
)

442 
¿‹s
 = 
	`›“80211_¡a_g‘_¿‹s
(
sd©a
, 
–ems
, 
sbªd
->
bªd
,

443 &
basic_¿‹s
);

445 
	`¥š_lock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

446 
¡a
->
deæšk
.
rx_¡©s
.
Ï¡_rx
 = 
jiff›s
;

449 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
 &&

450 
¡a
->
mesh
->
´oûs£d_b—cÚ
)

451 
out
;

452 
¡a
->
mesh
->
´oûs£d_b—cÚ
 = 
Œue
;

454 ià(
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
sbªd
->
bªd
] !ğ
¿‹s
)

455 
chªged
 |ğ
IEEE80211_RC_SUPP_RATES_CHANGED
;

456 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
sbªd
->
bªd
] = 
¿‹s
;

458 ià(
	`›“80211_ht_ÿp_›_to_¡a_ht_ÿp
(
sd©a
, 
sbªd
,

459 
–ems
->
ht_ÿp_–em
,

460 &
¡a
->
deæšk
))

461 
chªged
 |ğ
IEEE80211_RC_BW_CHANGED
;

463 
	`›“80211_vht_ÿp_›_to_¡a_vht_ÿp
(
sd©a
, 
sbªd
,

464 
–ems
->
vht_ÿp_–em
, 
NULL
,

465 &
¡a
->
deæšk
);

467 
	`›“80211_he_ÿp_›_to_¡a_he_ÿp
(
sd©a
, 
sbªd
, 
–ems
->
he_ÿp
,

468 
–ems
->
he_ÿp_Ën
,

469 
–ems
->
he_6ghz_ÿ·
,

470 &
¡a
->
deæšk
);

472 
	`›“80211_eht_ÿp_›_to_¡a_eht_ÿp
(
sd©a
, 
sbªd
, 
–ems
->
he_ÿp
,

473 
–ems
->
he_ÿp_Ën
,

474 
–ems
->
eht_ÿp
,ƒËms->
eht_ÿp_Ën
,

475 &
¡a
->
deæšk
);

477 ià(
bw
 !ğ
¡a
->¡a.
deæšk
.
bªdwidth
)

478 
chªged
 |ğ
IEEE80211_RC_BW_CHANGED
;

481 ià(
–ems
->
ht_İ”©iÚ
 &&

482 !(
–ems
->
ht_İ”©iÚ
->
ht_·¿m
 &

483 
IEEE80211_HT_PARAM_CHAN_WIDTH_ANY
)) {

484 ià(
¡a
->¡a.
deæšk
.
bªdwidth
 !ğ
IEEE80211_STA_RX_BW_20
)

485 
chªged
 |ğ
IEEE80211_RC_BW_CHANGED
;

486 
¡a
->¡a.
deæšk
.
bªdwidth
 = 
IEEE80211_STA_RX_BW_20
;

489 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_RATE_CONTROL
))

490 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

492 
	`¿‹_cÚŒŞ_¿‹_upd©e
(
loÿl
, 
sbªd
, 
¡a
, 0, 
chªged
);

493 
out
:

494 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

495 
	}
}

497 
	$mesh_®loÿ‹_aid
(
›“80211_sub_if_d©a
 *
sd©a
)

499 
¡a_šfo
 *
¡a
;

500 *
aid_m­
;

501 
aid
;

503 
aid_m­
 = 
	`b™m­_z®loc
(
IEEE80211_MAX_AID
 + 1, 
GFP_KERNEL
);

504 ià(!
aid_m­
)

505  -
ENOMEM
;

508 
	`__£t_b™
(0, 
aid_m­
);

510 
	`rcu_»ad_lock
();

511 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
sd©a
->
loÿl
->
¡a_li¡
, 
li¡
)

512 
	`__£t_b™
(
¡a
->¡a.
aid
, 
aid_m­
);

513 
	`rcu_»ad_uÆock
();

515 
aid
 = 
	`fšd_fœ¡_z”o_b™
(
aid_m­
, 
IEEE80211_MAX_AID
 + 1);

516 
	`b™m­_ä“
(
aid_m­
);

518 ià(
aid
 > 
IEEE80211_MAX_AID
)

519  -
ENOBUFS
;

521  
aid
;

522 
	}
}

524 
¡a_šfo
 *

525 
	$__mesh_¡a_šfo_®loc
(
›“80211_sub_if_d©a
 *
sd©a
, 
u8
 *
hw_addr
)

527 
¡a_šfo
 *
¡a
;

528 
aid
;

530 ià(
sd©a
->
loÿl
->
num_¡a
 >ğ
MESH_MAX_PLINKS
)

531  
NULL
;

533 
aid
 = 
	`mesh_®loÿ‹_aid
(
sd©a
);

534 ià(
aid
 < 0)

535  
NULL
;

537 
¡a
 = 
	`¡a_šfo_®loc
(
sd©a
, 
hw_addr
, 
GFP_KERNEL
);

538 ià(!
¡a
)

539  
NULL
;

541 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_LISTEN
;

542 
¡a
->¡a.
wme
 = 
Œue
;

543 
¡a
->¡a.
aid
 =‡id;

545 
	`¡a_šfo_´e_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTH
);

546 
	`¡a_šfo_´e_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
);

547 
	`¡a_šfo_´e_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTHORIZED
);

549  
¡a
;

550 
	}
}

552 
¡a_šfo
 *

553 
	$mesh_¡a_šfo_®loc
(
›“80211_sub_if_d©a
 *
sd©a
, 
u8
 *
addr
,

554 
›“802_11_–ems
 *
–ems
,

555 
›“80211_rx_¡©us
 *
rx_¡©us
)

557 
¡a_šfo
 *
¡a
 = 
NULL
;

560 ià(
sd©a
->
u
.
mesh
.
u£r_mpm
 ||

561 
sd©a
->
u
.
mesh
.
£cur™y
 & 
IEEE80211_MESH_SEC_AUTHED
) {

562 ià(
	`mesh_³”_acû±s_¶šks
(
–ems
) &&

563 
	`mesh_¶šk_avaabËs
(
sd©a
)) {

564 
sig
 = 0;

566 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
SIGNAL_DBM
))

567 
sig
 = 
rx_¡©us
->
sigÇl
;

569 
	`cfg80211_nÙify_Ãw_³”_ÿndid©e
(
sd©a
->
dev
, 
addr
,

570 
–ems
->
›_¡¬t
,

571 
–ems
->
tÙ®_Ën
,

572 
sig
, 
GFP_KERNEL
);

575 
¡a
 = 
	`__mesh_¡a_šfo_®loc
(
sd©a
, 
addr
);

577  
¡a
;

578 
	}
}

591 
¡a_šfo
 *

592 
	$mesh_¡a_šfo_g‘
(
›“80211_sub_if_d©a
 *
sd©a
,

593 
u8
 *
addr
, 
›“802_11_–ems
 *
–ems
,

594 
›“80211_rx_¡©us
 *
rx_¡©us
è
	$__acquœes
(
RCU
)

596 
¡a_šfo
 *
¡a
 = 
NULL
;

598 
	`rcu_»ad_lock
();

599 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
addr
);

600 ià(
¡a
) {

601 
	`mesh_¡a_šfo_š™
(
sd©a
, 
¡a
, 
–ems
);

603 
	`rcu_»ad_uÆock
();

605 
¡a
 = 
	`mesh_¡a_šfo_®loc
(
sd©a
, 
addr
, 
–ems
, 
rx_¡©us
);

606 ià(!
¡a
) {

607 
	`rcu_»ad_lock
();

608  
NULL
;

611 
	`mesh_¡a_šfo_š™
(
sd©a
, 
¡a
, 
–ems
);

613 ià(
	`¡a_šfo_š£¹_rcu
(
¡a
))

614  
NULL
;

617  
¡a
;

618 
	}
}

630 
	$mesh_Ãighbour_upd©e
(
›“80211_sub_if_d©a
 *
sd©a
,

631 
u8
 *
hw_addr
,

632 
›“802_11_–ems
 *
–ems
,

633 
›“80211_rx_¡©us
 *
rx_¡©us
)

635 
¡a_šfo
 *
¡a
;

636 
u64
 
chªged
 = 0;

638 
¡a
 = 
	`mesh_¡a_šfo_g‘
(
sd©a
, 
hw_addr
, 
–ems
, 
rx_¡©us
);

639 ià(!
¡a
)

640 
out
;

642 
¡a
->
mesh
->
cÚÃùed_to_g©e
 = 
–ems
->
mesh_cÚfig
->
meshcÚf_fÜm
 &

643 
IEEE80211_MESHCONF_FORM_CONNECTED_TO_GATE
;

645 ià(
	`mesh_³”_acû±s_¶šks
(
–ems
) &&

646 
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_LISTEN
 &&

647 
sd©a
->
u
.
mesh
.
acû±šg_¶šks
 &&

648 
sd©a
->
u
.
mesh
.
mshcfg
.
auto_İ’_¶šks
 &&

649 
	`rssi_th»shŞd_check
(
sd©a
, 
¡a
))

650 
chªged
 = 
	`mesh_¶šk_İ’
(
¡a
);

652 
	`›“80211_mps_äame_»Ëa£
(
¡a
, 
–ems
);

653 
out
:

654 
	`rcu_»ad_uÆock
();

655 
	`›“80211_mbss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

656 
	}
}

658 
	$mesh_¶šk_tim”
(
tim”_li¡
 *
t
)

660 
mesh_¡a
 *
mesh
 = 
	`äom_tim”
(mesh, 
t
, 
¶šk_tim”
);

661 
¡a_šfo
 *
¡a
;

662 
u16
 
»asÚ
 = 0;

663 
›“80211_sub_if_d©a
 *
sd©a
;

664 
mesh_cÚfig
 *
mshcfg
;

665 
›“80211_£lf_´Ùeùed_aùiÚcode
 
aùiÚ
 = 0;

672 
¡a
 = 
mesh
->
¶šk_¡a
;

674 ià(
¡a
->
sd©a
->
loÿl
->
qu›scšg
)

677 
	`¥š_lock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

684 ià(
	`time_befÜe
(
jiff›s
, 
¡a
->
mesh
->
¶šk_tim”
.
expœes
)) {

685 
	`m¶_dbg
(
¡a
->
sd©a
,

687 
¡a
->¡a.
addr
, 
m¶¡©es
[¡a->
mesh
->
¶šk_¡©e
]);

688 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

693 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_LISTEN
 ||

694 
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
) {

695 
	`m¶_dbg
(
¡a
->
sd©a
,

697 
¡a
->¡a.
addr
, 
m¶¡©es
[¡a->
mesh
->
¶šk_¡©e
]);

698 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

702 
	`m¶_dbg
(
¡a
->
sd©a
,

704 
¡a
->¡a.
addr
, 
m¶¡©es
[¡a->
mesh
->
¶šk_¡©e
]);

705 
sd©a
 = 
¡a
->sdata;

706 
mshcfg
 = &
sd©a
->
u
.
mesh
.mshcfg;

708 
¡a
->
mesh
->
¶šk_¡©e
) {

709 
NL80211_PLINK_OPN_RCVD
:

710 
NL80211_PLINK_OPN_SNT
:

712 ià(
¡a
->
mesh
->
¶šk_»Œ›s
 < 
mshcfg
->
dÙ11MeshMaxR‘r›s
) {

713 
u32
 
¿nd
;

714 
	`m¶_dbg
(
¡a
->
sd©a
,

716 
¡a
->¡a.
addr
, s->
mesh
->
¶šk_»Œ›s
,

717 
¡a
->
mesh
->
¶šk_timeout
);

718 
	`g‘_¿ndom_by‹s
(&
¿nd
, (
u32
));

719 
¡a
->
mesh
->
¶šk_timeout
 = sta->mesh->plink_timeout +

720 
¿nd
 % 
¡a
->
mesh
->
¶šk_timeout
;

721 ++
¡a
->
mesh
->
¶šk_»Œ›s
;

722 
	`mod_¶šk_tim”
(
¡a
, s->
mesh
->
¶šk_timeout
);

723 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_OPEN
;

726 
»asÚ
 = 
WLAN_REASON_MESH_MAX_RETRIES
;

727 
çÎthrough
;

728 
NL80211_PLINK_CNF_RCVD
:

730 ià(!
»asÚ
)

731 
»asÚ
 = 
WLAN_REASON_MESH_CONFIRM_TIMEOUT
;

732 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_HOLDING
;

733 
	`mod_¶šk_tim”
(
¡a
, 
mshcfg
->
dÙ11MeshHŞdšgTimeout
);

734 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CLOSE
;

736 
NL80211_PLINK_HOLDING
:

738 
	`d–_tim”
(&
¡a
->
mesh
->
¶šk_tim”
);

739 
	`mesh_¶šk_fsm_»¡¬t
(
¡a
);

744 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

745 ià(
aùiÚ
)

746 
	`mesh_¶šk_äame_tx
(
sd©a
, 
¡a
, 
aùiÚ
, s->¡a.
addr
,

747 
¡a
->
mesh
->
Îid
, s->mesh->
¶id
, 
»asÚ
);

748 
	}
}

750 
šlše
 
	$mesh_¶šk_tim”_£t
(
¡a_šfo
 *
¡a
, 
u32
 
timeout
)

752 
¡a
->
mesh
->
¶šk_timeout
 = 
timeout
;

753 
	`mod_tim”
(&
¡a
->
mesh
->
¶šk_tim”
, 
jiff›s
 + 
	`m£cs_to_jiff›s
(
timeout
));

754 
	}
}

756 
boŞ
 
	$Îid_š_u£
(
›“80211_sub_if_d©a
 *
sd©a
,

757 
u16
 
Îid
)

759 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

760 
boŞ
 
š_u£
 = 
çl£
;

761 
¡a_šfo
 *
¡a
;

763 
	`rcu_»ad_lock
();

764 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

765 ià(
sd©a
 !ğ
¡a
->sdata)

768 ià(!
	`memcmp
(&
¡a
->
mesh
->
Îid
, &llid, (llid))) {

769 
š_u£
 = 
Œue
;

773 
	`rcu_»ad_uÆock
();

775  
š_u£
;

776 
	}
}

778 
u16
 
	$mesh_g‘_Ãw_Îid
(
›“80211_sub_if_d©a
 *
sd©a
)

780 
u16
 
Îid
;

783 
	`g‘_¿ndom_by‹s
(&
Îid
, (llid));

784 } 
	`Îid_š_u£
(
sd©a
, 
Îid
));

786  
Îid
;

787 
	}
}

789 
u64
 
	$mesh_¶šk_İ’
(
¡a_šfo
 *
¡a
)

791 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

792 
u64
 
chªged
;

794 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTH
))

797 
	`¥š_lock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

798 
¡a
->
mesh
->
Îid
 = 
	`mesh_g‘_Ãw_Îid
(
sd©a
);

799 ià(
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_LISTEN
 &&

800 
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_BLOCKED
) {

801 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

804 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_OPN_SNT
;

805 
	`mesh_¶šk_tim”_£t
(
¡a
, 
sd©a
->
u
.
mesh
.
mshcfg
.
dÙ11MeshR‘ryTimeout
);

806 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

807 
	`m¶_dbg
(
sd©a
,

809 
¡a
->¡a.
addr
);

812 
chªged
 = 
	`›“80211_mps_loÿl_¡©us_upd©e
(
sd©a
);

814 
	`mesh_¶šk_äame_tx
(
sd©a
, 
¡a
, 
WLAN_SP_MESH_PEERING_OPEN
,

815 
¡a
->¡a.
addr
, s->
mesh
->
Îid
, 0, 0);

816  
chªged
;

817 
	}
}

819 
u64
 
	$mesh_¶šk_block
(
¡a_šfo
 *
¡a
)

821 
u64
 
chªged
;

823 
	`¥š_lock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

824 
chªged
 = 
	`__mesh_¶šk_d—ùiv©e
(
¡a
);

825 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_BLOCKED
;

826 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

827 
	`mesh_·th_æush_by_Ãxthİ
(
¡a
);

829  
chªged
;

830 
	}
}

832 
	$mesh_¶šk_şo£
(
›“80211_sub_if_d©a
 *
sd©a
,

833 
¡a_šfo
 *
¡a
,

834 
¶šk_ev’t
 
ev’t
)

836 
mesh_cÚfig
 *
mshcfg
 = &
sd©a
->
u
.
mesh
.mshcfg;

837 
u16
 
»asÚ
 = (
ev’t
 =ğ
CLS_ACPT
) ?

838 
WLAN_REASON_MESH_CLOSE
 : 
WLAN_REASON_MESH_CONFIG
;

840 
¡a
->
mesh
->
»asÚ
 =„eason;

841 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_HOLDING
;

842 
	`mod_¶šk_tim”
(
¡a
, 
mshcfg
->
dÙ11MeshHŞdšgTimeout
);

843 
	}
}

845 
u64
 
	$mesh_¶šk_e¡ablish
(
›“80211_sub_if_d©a
 *
sd©a
,

846 
¡a_šfo
 *
¡a
)

848 
mesh_cÚfig
 *
mshcfg
 = &
sd©a
->
u
.
mesh
.mshcfg;

849 
u64
 
chªged
 = 0;

851 
	`d–_tim”
(&
¡a
->
mesh
->
¶šk_tim”
);

852 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_ESTAB
;

853 
chªged
 |ğ
	`mesh_¶šk_šc_e¡ab_couÁ
(
sd©a
);

854 
chªged
 |ğ
	`mesh_£t_ht_´Ù_mode
(
sd©a
);

855 
chªged
 |ğ
	`mesh_£t_shÜt_¦Ù_time
(
sd©a
);

856 
	`m¶_dbg
(
sd©a
, "Mesh…lšk w™h %pM ESTABLISHED\n", 
¡a
->¡a.
addr
);

857 
	`›“80211_mps_¡a_¡©us_upd©e
(
¡a
);

858 
chªged
 |ğ
	`›“80211_mps_£t_¡a_loÿl_pm
(
¡a
, 
mshcfg
->
pow”_mode
);

859  
chªged
;

860 
	}
}

871 
u64
 
	$mesh_¶šk_fsm
(
›“80211_sub_if_d©a
 *
sd©a
,

872 
¡a_šfo
 *
¡a
, 
¶šk_ev’t
 
ev’t
)

874 
mesh_cÚfig
 *
mshcfg
 = &
sd©a
->
u
.
mesh
.mshcfg;

875 
›“80211_£lf_´Ùeùed_aùiÚcode
 
aùiÚ
 = 0;

876 
u64
 
chªged
 = 0;

877 
boŞ
 
æush
 = 
çl£
;

879 
	`m¶_dbg
(
sd©a
, "³” %pM iÀ¡©% gÙƒv’ˆ%s\n", 
¡a
->¡a.
addr
,

880 
m¶¡©es
[
¡a
->
mesh
->
¶šk_¡©e
], 
m¶ev’ts
[
ev’t
]);

882 
	`¥š_lock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

883 
¡a
->
mesh
->
¶šk_¡©e
) {

884 
NL80211_PLINK_LISTEN
:

885 
ev’t
) {

886 
CLS_ACPT
:

887 
	`mesh_¶šk_fsm_»¡¬t
(
¡a
);

889 
OPN_ACPT
:

890 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_OPN_RCVD
;

891 
¡a
->
mesh
->
Îid
 = 
	`mesh_g‘_Ãw_Îid
(
sd©a
);

892 
	`mesh_¶šk_tim”_£t
(
¡a
,

893 
mshcfg
->
dÙ11MeshR‘ryTimeout
);

896 
chªged
 |ğ
	`›“80211_mps_loÿl_¡©us_upd©e
(
sd©a
);

897 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_OPEN
;

903 
NL80211_PLINK_OPN_SNT
:

904 
ev’t
) {

905 
OPN_RJCT
:

906 
CNF_RJCT
:

907 
CLS_ACPT
:

908 
	`mesh_¶šk_şo£
(
sd©a
, 
¡a
, 
ev’t
);

909 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CLOSE
;

911 
OPN_ACPT
:

913 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_OPN_RCVD
;

914 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CONFIRM
;

916 
CNF_ACPT
:

917 
¡a
->
mesh
->
¶šk_¡©e
 = 
NL80211_PLINK_CNF_RCVD
;

918 
	`mod_¶šk_tim”
(
¡a
, 
mshcfg
->
dÙ11MeshCÚfœmTimeout
);

924 
NL80211_PLINK_OPN_RCVD
:

925 
ev’t
) {

926 
OPN_RJCT
:

927 
CNF_RJCT
:

928 
CLS_ACPT
:

929 
	`mesh_¶šk_şo£
(
sd©a
, 
¡a
, 
ev’t
);

930 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CLOSE
;

932 
OPN_ACPT
:

933 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CONFIRM
;

935 
CNF_ACPT
:

936 
chªged
 |ğ
	`mesh_¶šk_e¡ablish
(
sd©a
, 
¡a
);

942 
NL80211_PLINK_CNF_RCVD
:

943 
ev’t
) {

944 
OPN_RJCT
:

945 
CNF_RJCT
:

946 
CLS_ACPT
:

947 
	`mesh_¶šk_şo£
(
sd©a
, 
¡a
, 
ev’t
);

948 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CLOSE
;

950 
OPN_ACPT
:

951 
chªged
 |ğ
	`mesh_¶šk_e¡ablish
(
sd©a
, 
¡a
);

952 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CONFIRM
;

958 
NL80211_PLINK_ESTAB
:

959 
ev’t
) {

960 
CLS_ACPT
:

961 
chªged
 |ğ
	`__mesh_¶šk_d—ùiv©e
(
¡a
);

962 
chªged
 |ğ
	`mesh_£t_ht_´Ù_mode
(
sd©a
);

963 
chªged
 |ğ
	`mesh_£t_shÜt_¦Ù_time
(
sd©a
);

964 
	`mesh_¶šk_şo£
(
sd©a
, 
¡a
, 
ev’t
);

965 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CLOSE
;

966 
æush
 = 
Œue
;

968 
OPN_ACPT
:

969 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CONFIRM
;

975 
NL80211_PLINK_HOLDING
:

976 
ev’t
) {

977 
CLS_ACPT
:

978 
	`d–_tim”
(&
¡a
->
mesh
->
¶šk_tim”
);

979 
	`mesh_¶šk_fsm_»¡¬t
(
¡a
);

981 
OPN_ACPT
:

982 
CNF_ACPT
:

983 
OPN_RJCT
:

984 
CNF_RJCT
:

985 
aùiÚ
 = 
WLAN_SP_MESH_PEERING_CLOSE
;

997 
	`¥š_uÆock_bh
(&
¡a
->
mesh
->
¶šk_lock
);

998 ià(
æush
)

999 
	`mesh_·th_æush_by_Ãxthİ
(
¡a
);

1000 ià(
aùiÚ
) {

1001 
	`mesh_¶šk_äame_tx
(
sd©a
, 
¡a
, 
aùiÚ
, s->¡a.
addr
,

1002 
¡a
->
mesh
->
Îid
, s->mesh->
¶id
,

1003 
¡a
->
mesh
->
»asÚ
);

1006 ià(
aùiÚ
 =ğ
WLAN_SP_MESH_PEERING_OPEN
) {

1007 
	`mesh_¶šk_äame_tx
(
sd©a
, 
¡a
,

1008 
WLAN_SP_MESH_PEERING_CONFIRM
,

1009 
¡a
->¡a.
addr
, s->
mesh
->
Îid
,

1010 
¡a
->
mesh
->
¶id
, 0);

1014  
chªged
;

1015 
	}
}

1030 
¶šk_ev’t


1031 
	$mesh_¶šk_g‘_ev’t
(
›“80211_sub_if_d©a
 *
sd©a
,

1032 
¡a_šfo
 *
¡a
,

1033 
›“802_11_–ems
 *
–ems
,

1034 
›“80211_£lf_´Ùeùed_aùiÚcode
 
áy³
,

1035 
u16
 
Îid
, u16 
¶id
)

1037 
¶šk_ev’t
 
ev’t
 = 
PLINK_UNDEFINED
;

1038 
u8
 
›_Ën
 = 
–ems
->
³”šg_Ën
;

1039 
boŞ
 
m©ches_loÿl
;

1041 
m©ches_loÿl
 = (
áy³
 =ğ
WLAN_SP_MESH_PEERING_CLOSE
 ||

1042 
	`mesh_m©ches_loÿl
(
sd©a
, 
–ems
));

1045 ià(!
m©ches_loÿl
 && !
¡a
) {

1046 
ev’t
 = 
OPN_RJCT
;

1047 
out
;

1050 ià(!
¡a
) {

1051 ià(
áy³
 !ğ
WLAN_SP_MESH_PEERING_OPEN
) {

1052 
	`m¶_dbg
(
sd©a
, "Mesh…link: cls or cnf from unknown…eer\n");

1053 
out
;

1056 ià(!
	`mesh_¶šk_ä“_couÁ
(
sd©a
)) {

1057 
	`m¶_dbg
(
sd©a
, "Mesh…linkƒrror:‚o more free…links\n");

1058 
out
;

1062 
ev’t
 = 
OPN_ACPT
;

1063 
out
;

1065 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTH
)) {

1066 
	`m¶_dbg
(
sd©a
, "Mesh…link: Action frame from‚on-authed…eer\n");

1067 
out
;

1069 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_BLOCKED
)

1070 
out
;

1073 
áy³
) {

1074 
WLAN_SP_MESH_PEERING_OPEN
:

1075 ià(!
m©ches_loÿl
)

1076 
ev’t
 = 
OPN_RJCT
;

1077 ià(!
	`mesh_¶šk_ä“_couÁ
(
sd©a
) ||

1078 (
¡a
->
mesh
->
¶id
 && sta->mesh->plid !=…lid))

1079 
ev’t
 = 
OPN_IGNR
;

1081 
ev’t
 = 
OPN_ACPT
;

1083 
WLAN_SP_MESH_PEERING_CONFIRM
:

1084 ià(!
m©ches_loÿl
)

1085 
ev’t
 = 
CNF_RJCT
;

1086 ià(!
	`mesh_¶šk_ä“_couÁ
(
sd©a
) ||

1087 
¡a
->
mesh
->
Îid
 !=†lid ||

1088 (
¡a
->
mesh
->
¶id
 && sta->mesh->plid !=…lid))

1089 
ev’t
 = 
CNF_IGNR
;

1091 
ev’t
 = 
CNF_ACPT
;

1093 
WLAN_SP_MESH_PEERING_CLOSE
:

1094 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

1104 
ev’t
 = 
CLS_ACPT
;

1105 ià(
¡a
->
mesh
->
¶id
 !=…lid)

1106 
ev’t
 = 
CLS_IGNR
;

1107 ià(
›_Ën
 =ğ8 && 
¡a
->
mesh
->
Îid
 !=†lid)

1108 
ev’t
 = 
CLS_IGNR
;

1110 
ev’t
 = 
CLS_ACPT
;

1113 
	`m¶_dbg
(
sd©a
, "Mesh…link: unknown frame subtype\n");

1117 
out
:

1118  
ev’t
;

1119 
	}
}

1122 
	$mesh_´oûss_¶šk_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

1123 
›“80211_mgmt
 *
mgmt
,

1124 
›“802_11_–ems
 *
–ems
,

1125 
›“80211_rx_¡©us
 *
rx_¡©us
)

1128 
¡a_šfo
 *
¡a
;

1129 
¶šk_ev’t
 
ev’t
;

1130 
›“80211_£lf_´Ùeùed_aùiÚcode
 
áy³
;

1131 
u64
 
chªged
 = 0;

1132 
u8
 
›_Ën
 = 
–ems
->
³”šg_Ën
;

1133 
u16
 
¶id
, 
Îid
 = 0;

1135 ià(!
–ems
->
³”šg
) {

1136 
	`m¶_dbg
(
sd©a
,

1141 ià(
–ems
->
r¢_Ën
 &&

1142 
sd©a
->
u
.
mesh
.
£cur™y
 =ğ
IEEE80211_MESH_SEC_NONE
) {

1143 
	`m¶_dbg
(
sd©a
,

1148 
áy³
 = 
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
aùiÚ_code
;

1149 ià((
áy³
 =ğ
WLAN_SP_MESH_PEERING_OPEN
 && 
›_Ën
 != 4) ||

1150 (
áy³
 =ğ
WLAN_SP_MESH_PEERING_CONFIRM
 && 
›_Ën
 != 6) ||

1151 (
áy³
 =ğ
WLAN_SP_MESH_PEERING_CLOSE
 && 
›_Ën
 != 6

1152 && 
›_Ën
 != 8)) {

1153 
	`m¶_dbg
(
sd©a
,

1155 
áy³
, 
›_Ën
);

1159 ià(
áy³
 !ğ
WLAN_SP_MESH_PEERING_CLOSE
 &&

1160 (!
–ems
->
mesh_id
 || !–ems->
mesh_cÚfig
)) {

1161 
	`m¶_dbg
(
sd©a
, "Mesh…link: missing‚ecessary ie\n");

1167 
¶id
 = 
	`g‘_uÇligÃd_Ë16
(
	`PLINK_GET_LLID
(
–ems
->
³”šg
));

1168 ià(
áy³
 =ğ
WLAN_SP_MESH_PEERING_CONFIRM
 ||

1169 (
áy³
 =ğ
WLAN_SP_MESH_PEERING_CLOSE
 && 
›_Ën
 == 8))

1170 
Îid
 = 
	`g‘_uÇligÃd_Ë16
(
	`PLINK_GET_PLID
(
–ems
->
³”šg
));

1173 
	`rcu_»ad_lock
();

1175 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
);

1177 ià(
áy³
 =ğ
WLAN_SP_MESH_PEERING_OPEN
 &&

1178 !
	`rssi_th»shŞd_check
(
sd©a
, 
¡a
)) {

1179 
	`m¶_dbg
(
sd©a
, "Mesh…link: %pM does‚ot meet„ssihreshold\n",

1180 
mgmt
->
§
);

1181 
uÆock_rcu
;

1185 
ev’t
 = 
	`mesh_¶šk_g‘_ev’t
(
sd©a
, 
¡a
, 
–ems
, 
áy³
, 
Îid
, 
¶id
);

1187 ià(
ev’t
 =ğ
OPN_ACPT
) {

1188 
	`rcu_»ad_uÆock
();

1190 
¡a
 = 
	`mesh_¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
, 
–ems
, 
rx_¡©us
);

1191 ià(!
¡a
) {

1192 
	`m¶_dbg
(
sd©a
, "Mesh…link: failedo init…eer!\n");

1193 
uÆock_rcu
;

1195 
¡a
->
mesh
->
¶id
 =…lid;

1196 } ià(!
¡a
 && 
ev’t
 =ğ
OPN_RJCT
) {

1197 
	`mesh_¶šk_äame_tx
(
sd©a
, 
NULL
, 
WLAN_SP_MESH_PEERING_CLOSE
,

1198 
mgmt
->
§
, 0, 
¶id
,

1199 
WLAN_REASON_MESH_CONFIG
);

1200 
uÆock_rcu
;

1201 } ià(!
¡a
 || 
ev’t
 =ğ
PLINK_UNDEFINED
) {

1203 
uÆock_rcu
;

1206 ià(
ev’t
 =ğ
CNF_ACPT
) {

1208 ià(!
¡a
->
mesh
->
¶id
)

1209 
¡a
->
mesh
->
¶id
 =…lid;

1211 
¡a
->
mesh
->
aid
 = 
	`g‘_uÇligÃd_Ë16
(
	`PLINK_CNF_AID
(
mgmt
));

1214 
chªged
 |ğ
	`mesh_¶šk_fsm
(
sd©a
, 
¡a
, 
ev’t
);

1216 
uÆock_rcu
:

1217 
	`rcu_»ad_uÆock
();

1219 ià(
chªged
)

1220 
	`›“80211_mbss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

1221 
	}
}

1223 
	$mesh_rx_¶šk_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

1224 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

1225 
›“80211_rx_¡©us
 *
rx_¡©us
)

1227 
›“802_11_–ems
 *
–ems
;

1228 
size_t
 
ba£Ën
;

1229 
u8
 *
ba£addr
;

1232 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 3)

1235 ià(
sd©a
->
u
.
mesh
.
u£r_mpm
)

1239 ià(
	`is_muÉiÿ¡_‘h”_addr
(
mgmt
->
da
)) {

1240 
	`m¶_dbg
(
sd©a
,

1245 
ba£addr
 = 
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
v¬ŸbË
;

1246 
ba£Ën
 = (
u8
 *è
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
v¬ŸbË
 - (u8 *) mgmt;

1247 ià(
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
aùiÚ_code
 ==

1248 
WLAN_SP_MESH_PEERING_CONFIRM
) {

1249 
ba£addr
 += 4;

1250 
ba£Ën
 += 4;

1252 ià(
ba£Ën
 > 
Ën
)

1255 
–ems
 = 
	`›“802_11_·r£_–ems
(
ba£addr
, 
Ën
 - 
ba£Ën
, 
Œue
, 
NULL
);

1256 ià(
–ems
) {

1257 
	`mesh_´oûss_¶šk_äame
(
sd©a
, 
mgmt
, 
–ems
, 
rx_¡©us
);

1258 
	`kä“
(
–ems
);

1260 
	}
}

	@mesh_ps.c

9 
	~"mesh.h
"

10 
	~"wme.h
"

21 
sk_buff
 *
	$mps_qos_nuÎ_g‘
(
¡a_šfo
 *
¡a
)

23 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

24 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

25 
›“80211_hdr
 *
nuÎfunc
;

26 
sk_buff
 *
skb
;

27 
size
 = (*
nuÎfunc
);

28 
__Ë16
 
fc
;

30 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
size
 + 2);

31 ià(!
skb
)

32  
NULL
;

33 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

35 
nuÎfunc
 = 
	`skb_put
(
skb
, 
size
);

36 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_QOS_NULLFUNC
);

37 
	`›“80211_fl_mesh_add»s£s
(
nuÎfunc
, &
fc
, 
¡a
->¡a.
addr
,

38 
sd©a
->
vif
.
addr
);

39 
nuÎfunc
->
äame_cÚŒŞ
 = 
fc
;

40 
nuÎfunc
->
du¿tiÚ_id
 = 0;

41 
nuÎfunc
->
£q_ù¾
 = 0;

43 
	`memıy
(
nuÎfunc
->
addr1
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

44 
	`skb_put_z”o
(
skb
, 2);

45 
	`›“80211_mps_£t_äame_æags
(
sd©a
, 
¡a
, 
nuÎfunc
);

47  
skb
;

48 
	}
}

54 
	$mps_qos_nuÎ_tx
(
¡a_šfo
 *
¡a
)

56 
sk_buff
 *
skb
;

58 
skb
 = 
	`mps_qos_nuÎ_g‘
(
¡a
);

59 ià(!
skb
)

62 
	`mps_dbg
(
¡a
->
sd©a
, "announcing…eer-specific…ower modeo %pM\n",

63 
¡a
->¡a.
addr
);

66 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
)) {

67 
u8
 *
qc
 = 
	`›“80211_g‘_qos_ùl
((*è
skb
->
d©a
);

69 
qc
[0] |ğ
IEEE80211_QOS_CTL_EOSP
;

72 
	`›“80211_tx_skb
(
¡a
->
sd©a
, 
skb
);

73 
	}
}

85 
u64
 
	$›“80211_mps_loÿl_¡©us_upd©e
(
›“80211_sub_if_d©a
 *
sd©a
)

87 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

88 
¡a_šfo
 *
¡a
;

89 
boŞ
 
³”šg
 = 
çl£
;

90 
light_¦“p_út
 = 0;

91 
d“p_¦“p_út
 = 0;

92 
u64
 
chªged
 = 0;

93 
Æ80211_mesh_pow”_mode
 
nÚ³”_pm
;

95 
	`rcu_»ad_lock
();

96 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
sd©a
->
loÿl
->
¡a_li¡
, 
li¡
) {

97 ià(
sd©a
 !ğ
¡a
->sdata)

100 
¡a
->
mesh
->
¶šk_¡©e
) {

101 
NL80211_PLINK_OPN_SNT
:

102 
NL80211_PLINK_OPN_RCVD
:

103 
NL80211_PLINK_CNF_RCVD
:

104 
³”šg
 = 
Œue
;

106 
NL80211_PLINK_ESTAB
:

107 ià(
¡a
->
mesh
->
loÿl_pm
 =ğ
NL80211_MESH_POWER_LIGHT_SLEEP
)

108 
light_¦“p_út
++;

109 ià(
¡a
->
mesh
->
loÿl_pm
 =ğ
NL80211_MESH_POWER_DEEP_SLEEP
)

110 
d“p_¦“p_út
++;

116 
	`rcu_»ad_uÆock
();

125 ià(
³”šg
) {

126 
	`mps_dbg
(
sd©a
, "setting‚on-peer PMo‡ctive for…eering\n");

127 
nÚ³”_pm
 = 
NL80211_MESH_POWER_ACTIVE
;

128 } ià(
light_¦“p_út
 || 
d“p_¦“p_út
) {

129 
	`mps_dbg
(
sd©a
, "setting‚on-peer PMo deep sleep\n");

130 
nÚ³”_pm
 = 
NL80211_MESH_POWER_DEEP_SLEEP
;

132 
	`mps_dbg
(
sd©a
, "setting‚on-peer PMo user value\n");

133 
nÚ³”_pm
 = 
ifmsh
->
mshcfg
.
pow”_mode
;

137 ià(
ifmsh
->
nÚ³”_pm
 !=‚onpeer_pm ||

138 !
ifmsh
->
ps_³”s_light_¦“p
 !ğ!
light_¦“p_út
 ||

139 !
ifmsh
->
ps_³”s_d“p_¦“p
 !ğ!
d“p_¦“p_út
)

140 
chªged
 = 
BSS_CHANGED_BEACON
;

142 
ifmsh
->
nÚ³”_pm
 =‚onpeer_pm;

143 
ifmsh
->
ps_³”s_light_¦“p
 = 
light_¦“p_út
;

144 
ifmsh
->
ps_³”s_d“p_¦“p
 = 
d“p_¦“p_út
;

146  
chªged
;

147 
	}
}

156 
u64
 
	$›“80211_mps_£t_¡a_loÿl_pm
(
¡a_šfo
 *
¡a
,

157 
Æ80211_mesh_pow”_mode
 
pm
)

159 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

161 ià(
¡a
->
mesh
->
loÿl_pm
 =ğ
pm
)

164 
	`mps_dbg
(
sd©a
, "local STA operates in mode %d with %pM\n",

165 
pm
, 
¡a
->¡a.
addr
);

167 
¡a
->
mesh
->
loÿl_pm
 = 
pm
;

173 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

174 
	`mps_qos_nuÎ_tx
(
¡a
);

176  
	`›“80211_mps_loÿl_¡©us_upd©e
(
sd©a
);

177 
	}
}

191 
	$›“80211_mps_£t_äame_æags
(
›“80211_sub_if_d©a
 *
sd©a
,

192 
¡a_šfo
 *
¡a
,

193 
›“80211_hdr
 *
hdr
)

195 
Æ80211_mesh_pow”_mode
 
pm
;

196 
u8
 *
qc
;

198 ià(
	`WARN_ON
(
	`is_uniÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

199 
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) &&

200 !
¡a
))

203 ià(
	`is_uniÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

204 
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) &&

205 
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

206 
pm
 = 
¡a
->
mesh
->
loÿl_pm
;

208 
pm
 = 
sd©a
->
u
.
mesh
.
nÚ³”_pm
;

210 ià(
pm
 =ğ
NL80211_MESH_POWER_ACTIVE
)

211 
hdr
->
äame_cÚŒŞ
 &ğ
	`ıu_to_Ë16
(~
IEEE80211_FCTL_PM
);

213 
hdr
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PM
);

215 ià(!
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
))

218 
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

220 ià((
	`is_uniÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

221 
pm
 =ğ
NL80211_MESH_POWER_DEEP_SLEEP
) ||

222 (
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

223 
sd©a
->
u
.
mesh
.
ps_³”s_d“p_¦“p
 > 0))

224 
qc
[1] |ğ(
IEEE80211_QOS_CTL_MESH_PS_LEVEL
 >> 8);

226 
qc
[1] &ğ~(
IEEE80211_QOS_CTL_MESH_PS_LEVEL
 >> 8);

227 
	}
}

236 
	$›“80211_mps_¡a_¡©us_upd©e
(
¡a_šfo
 *
¡a
)

238 
Æ80211_mesh_pow”_mode
 
pm
;

239 
boŞ
 
do_bufãr
;

242 ià(
¡a
->
¡a_¡©e
 < 
IEEE80211_STA_ASSOC
)

249 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
 &&

250 
¡a
->
mesh
->
³”_pm
 !ğ
NL80211_MESH_POWER_UNKNOWN
)

251 
pm
 = 
¡a
->
mesh
->
³”_pm
;

253 
pm
 = 
¡a
->
mesh
->
nÚ³”_pm
;

255 
do_bufãr
 = (
pm
 !ğ
NL80211_MESH_POWER_ACTIVE
);

258 ià(
¡a
->
mesh
->
¶šk_¡©e
 !ğ
NL80211_PLINK_ESTAB
) {

259 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
);

260 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_RECIPIENT
);

261 } ià(!
do_bufãr
) {

262 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
);

266 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
è=ğ
do_bufãr
)

269 ià(
do_bufãr
) {

270 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
);

271 
	`©omic_šc
(&
¡a
->
sd©a
->
u
.
mesh
.
ps
.
num_¡a_ps
);

272 
	`mps_dbg
(
¡a
->
sd©a
, "start PS buffering framesowards %pM\n",

273 
¡a
->¡a.
addr
);

275 
	`›“80211_¡a_ps_d–iv”_wakeup
(
¡a
);

277 
	}
}

279 
	$mps_£t_¡a_³”_pm
(
¡a_šfo
 *
¡a
,

280 
›“80211_hdr
 *
hdr
)

282 
Æ80211_mesh_pow”_mode
 
pm
;

283 
u8
 *
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

295 ià(
	`›“80211_has_pm
(
hdr
->
äame_cÚŒŞ
)) {

296 ià(
qc
[1] & (
IEEE80211_QOS_CTL_MESH_PS_LEVEL
 >> 8))

297 
pm
 = 
NL80211_MESH_POWER_DEEP_SLEEP
;

299 
pm
 = 
NL80211_MESH_POWER_LIGHT_SLEEP
;

301 
pm
 = 
NL80211_MESH_POWER_ACTIVE
;

304 ià(
¡a
->
mesh
->
³”_pm
 =ğ
pm
)

307 
	`mps_dbg
(
¡a
->
sd©a
, "STA %pMƒnters mode %d\n",

308 
¡a
->¡a.
addr
, 
pm
);

310 
¡a
->
mesh
->
³”_pm
 = 
pm
;

312 
	`›“80211_mps_¡a_¡©us_upd©e
(
¡a
);

313 
	}
}

315 
	$mps_£t_¡a_nÚ³”_pm
(
¡a_šfo
 *
¡a
,

316 
›“80211_hdr
 *
hdr
)

318 
Æ80211_mesh_pow”_mode
 
pm
;

320 ià(
	`›“80211_has_pm
(
hdr
->
äame_cÚŒŞ
))

321 
pm
 = 
NL80211_MESH_POWER_DEEP_SLEEP
;

323 
pm
 = 
NL80211_MESH_POWER_ACTIVE
;

325 ià(
¡a
->
mesh
->
nÚ³”_pm
 =ğ
pm
)

328 
	`mps_dbg
(
¡a
->
sd©a
, "STA %pM sets‚on-peer modeo %d\n",

329 
¡a
->¡a.
addr
, 
pm
);

331 
¡a
->
mesh
->
nÚ³”_pm
 = 
pm
;

333 
	`›“80211_mps_¡a_¡©us_upd©e
(
¡a
);

334 
	}
}

342 
	$›“80211_mps_rx_h_¡a_´oûss
(
¡a_šfo
 *
¡a
,

343 
›“80211_hdr
 *
hdr
)

345 ià(
	`is_uniÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

346 
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
)) {

351 
	`mps_£t_¡a_³”_pm
(
¡a
, 
hdr
);

354 
	`›“80211_mp¥_Œigg”_´oûss
(
	`›“80211_g‘_qos_ùl
(
hdr
),

355 
¡a
, 
çl£
, false);

361 
	`mps_£t_¡a_nÚ³”_pm
(
¡a
, 
hdr
);

363 
	}
}

368 
	$mp¥_Œigg”_£nd
(
¡a_šfo
 *
¡a
, 
boŞ
 
r¥i
, boŞ 
eo¥
)

370 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

371 
sk_buff
 *
skb
;

372 
›“80211_hdr
 *
nuÎfunc
;

373 
›“80211_tx_šfo
 *
šfo
;

374 
u8
 *
qc
;

376 
skb
 = 
	`mps_qos_nuÎ_g‘
(
¡a
);

377 ià(!
skb
)

380 
nuÎfunc
 = (
›“80211_hdr
 *è
skb
->
d©a
;

381 ià(!
eo¥
)

382 
nuÎfunc
->
äame_cÚŒŞ
 |=

383 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

392 
qc
 = 
	`›“80211_g‘_qos_ùl
(
nuÎfunc
);

393 ià(
r¥i
)

394 
qc
[1] |ğ(
IEEE80211_QOS_CTL_RSPI
 >> 8);

395 ià(
eo¥
)

396 
qc
[0] |ğ
IEEE80211_QOS_CTL_EOSP
;

398 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

400 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_PS_BUFFER
 |

401 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

403 
	`mps_dbg
(
sd©a
, "sending MPSPrigger%s%so %pM\n",

404 
r¥i
 ? " RSPI" : "", 
eo¥
 ? " EOSP" : "", 
¡a
->¡a.
addr
);

406 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

407 
	}
}

418 
	$mp¥_qos_nuÎ_­³nd
(
¡a_šfo
 *
¡a
,

419 
sk_buff_h—d
 *
äames
)

421 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

422 
sk_buff
 *
Ãw_skb
, *
skb
 = 
	`skb_³ek_
(
äames
);

423 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

424 
›“80211_tx_šfo
 *
šfo
;

426 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
))

429 
Ãw_skb
 = 
	`mps_qos_nuÎ_g‘
(
¡a
);

430 ià(!
Ãw_skb
)

433 
	`mps_dbg
(
sd©a
, "appending QoS Null in MPSPowards %pM\n",

434 
¡a
->¡a.
addr
);

439 
Ãw_skb
->
´iÜ™y
 = 1;

440 
	`skb_£t_queue_m­pšg
(
Ãw_skb
, 
IEEE80211_AC_BK
);

441 
	`›“80211_£t_qos_hdr
(
sd©a
, 
Ãw_skb
);

443 
šfo
 = 
	`IEEE80211_SKB_CB
(
Ãw_skb
);

444 
šfo
->
cÚŒŞ
.
vif
 = &
sd©a
->vif;

445 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

447 
	`__skb_queue_
(
äames
, 
Ãw_skb
);

448 
	}
}

456 
	$mps_äame_d–iv”
(
¡a_šfo
 *
¡a
, 
n_äames
)

458 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

459 
ac
;

460 
sk_buff_h—d
 
äames
;

461 
sk_buff
 *
skb
;

462 
boŞ
 
mÜe_d©a
 = 
çl£
;

464 
	`skb_queue_h—d_š™
(&
äames
);

467 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

468 
n_äames
 != 0) {

469 
skb
 = 
	`skb_dequeue
(&
¡a
->
tx_f‹»d
[
ac
]);

470 ià(!
skb
) {

471 
skb
 = 
	`skb_dequeue
(

472 &
¡a
->
ps_tx_buf
[
ac
]);

473 ià(
skb
)

474 
loÿl
->
tÙ®_ps_bufã»d
--;

476 ià(!
skb
)

478 
n_äames
--;

479 
	`__skb_queue_
(&
äames
, 
skb
);

482 ià(!
	`skb_queue_em±y
(&
¡a
->
tx_f‹»d
[
ac
]) ||

483 !
	`skb_queue_em±y
(&
¡a
->
ps_tx_buf
[
ac
]))

484 
mÜe_d©a
 = 
Œue
;

488 ià(
	`skb_queue_em±y
(&
äames
)) {

489 
	`mp¥_Œigg”_£nd
(
¡a
, 
çl£
, 
Œue
);

494 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
))

495 
	`mp¥_qos_nuÎ_­³nd
(
¡a
, &
äames
);

497 
	`mps_dbg
(
¡a
->
sd©a
, "sending %d frameso PS STA %pM\n",

498 
	`skb_queue_Ën
(&
äames
), 
¡a
->¡a.
addr
);

501 
	`skb_queue_w®k
(&
äames
, 
skb
) {

502 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

503 
›“80211_hdr
 *
hdr
 = (*è
skb
->
d©a
;

510 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_PS_BUFFER
;

512 ià(
mÜe_d©a
 || !
	`skb_queue_is_Ï¡
(&
äames
, 
skb
))

513 
hdr
->
äame_cÚŒŞ
 |=

514 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

516 
hdr
->
äame_cÚŒŞ
 &=

517 
	`ıu_to_Ë16
(~
IEEE80211_FCTL_MOREDATA
);

519 ià(
	`skb_queue_is_Ï¡
(&
äames
, 
skb
) &&

520 
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
)) {

521 
u8
 *
qoshdr
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

524 *
qoshdr
 |ğ
IEEE80211_QOS_CTL_EOSP
;

525 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

529 
	`›“80211_add_³ndšg_skbs
(
loÿl
, &
äames
);

530 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

531 
	}
}

543 
	$›“80211_mp¥_Œigg”_´oûss
(
u8
 *
qc
, 
¡a_šfo
 *
¡a
,

544 
boŞ
 
tx
, boŞ 
acked
)

546 
u8
 
r¥i
 = 
qc
[1] & (
IEEE80211_QOS_CTL_RSPI
 >> 8);

547 
u8
 
eo¥
 = 
qc
[0] & 
IEEE80211_QOS_CTL_EOSP
;

549 ià(
tx
) {

550 ià(
r¥i
 && 
acked
)

551 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_RECIPIENT
);

553 ià(
eo¥
)

554 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
);

555 ià(
acked
 &&

556 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) &&

557 !
	`‹¡_ªd_£t_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
))

558 
	`mps_äame_d–iv”
(
¡a
, -1);

560 ià(
eo¥
)

561 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_RECIPIENT
);

562 ià(
¡a
->
mesh
->
loÿl_pm
 !ğ
NL80211_MESH_POWER_ACTIVE
)

563 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_RECIPIENT
);

565 ià(
r¥i
 && !
	`‹¡_ªd_£t_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
))

566 
	`mps_äame_d–iv”
(
¡a
, -1);

568 
	}
}

581 
	$›“80211_mps_äame_»Ëa£
(
¡a_šfo
 *
¡a
,

582 
›“802_11_–ems
 *
–ems
)

584 
ac
, 
bufãr_loÿl
 = 0;

585 
boŞ
 
has_bufã»d
 = 
çl£
;

587 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

588 
has_bufã»d
 = 
	`›“80211_check_tim
(
–ems
->
tim
,ƒËms->
tim_Ën
,

589 
¡a
->
mesh
->
aid
);

591 ià(
has_bufã»d
)

592 
	`mps_dbg
(
¡a
->
sd©a
, "%pM indicates buffered frames\n",

593 
¡a
->¡a.
addr
);

596 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) &&

597 (!
–ems
->
awake_wšdow
 || !
	`g‘_uÇligÃd_Ë16
(elems->awake_window)))

600 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_MPSP_OWNER
))

601 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

602 
bufãr_loÿl
 +ğ
	`skb_queue_Ën
(&
¡a
->
ps_tx_buf
[
ac
]) +

603 
	`skb_queue_Ën
(&
¡a
->
tx_f‹»d
[
ac
]);

605 ià(!
has_bufã»d
 && !
bufãr_loÿl
)

608 ià(
¡a
->
mesh
->
¶šk_¡©e
 =ğ
NL80211_PLINK_ESTAB
)

609 
	`mp¥_Œigg”_£nd
(
¡a
, 
has_bufã»d
, !
bufãr_loÿl
);

611 
	`mps_äame_d–iv”
(
¡a
, 1);

612 
	}
}

	@mesh_sync.c

9 
	~"›“80211_i.h
"

10 
	~"mesh.h
"

11 
	~"driv”-İs.h
"

16 
	#TOFFSET_MINIMUM_ADJUSTMENT
 10

	)

22 
	#TOFFSET_SET_MARGIN
 20

	)

29 
	#TOFFSET_MAXIMUM_ADJUSTMENT
 800

	)

31 
	ssync_m‘hod
 {

32 
u8
 
	mm‘hod
;

33 
›“80211_mesh_sync_İs
 
	mİs
;

43 
boŞ
 
	$mesh_³”_tb‰_adju¡šg
(cÚ¡ 
›“80211_meshcÚf_›
 *
cfg
)

45  
cfg
 &&

46 (
cfg
->
meshcÚf_ÿp
 & 
IEEE80211_MESHCONF_CAPAB_TBTT_ADJUSTING
);

47 
	}
}

49 
	$mesh_sync_adju¡_tsf
(
›“80211_sub_if_d©a
 *
sd©a
)

51 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

52 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

54 
u64
 
b—cÚ_št_äaùiÚ
 = 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
 * 1024 / 2500;

55 
u64
 
tsf
;

56 
u64
 
tsfd–
;

58 
	`¥š_lock_bh
(&
ifmsh
->
sync_off£t_lock
);

59 ià(
ifmsh
->
sync_off£t_şockdriá_max
 < 
b—cÚ_št_äaùiÚ
) {

60 
	`msync_dbg
(
sd©a
, "TSF : max clockdrift=%lld;‡djusting\n",

61 (è
ifmsh
->
sync_off£t_şockdriá_max
);

62 
tsfd–
 = -
ifmsh
->
sync_off£t_şockdriá_max
;

63 
ifmsh
->
sync_off£t_şockdriá_max
 = 0;

65 
	`msync_dbg
(
sd©a
, "TSF : max clockdrift=%lld;‡djusting by %llu\n",

66 (è
ifmsh
->
sync_off£t_şockdriá_max
,

67 (è
b—cÚ_št_äaùiÚ
);

68 
tsfd–
 = -
b—cÚ_št_äaùiÚ
;

69 
ifmsh
->
sync_off£t_şockdriá_max
 -ğ
b—cÚ_št_äaùiÚ
;

71 
	`¥š_uÆock_bh
(&
ifmsh
->
sync_off£t_lock
);

73 ià(
loÿl
->
İs
->
off£t_tsf
) {

74 
	`drv_off£t_tsf
(
loÿl
, 
sd©a
, 
tsfd–
);

76 
tsf
 = 
	`drv_g‘_tsf
(
loÿl
, 
sd©a
);

77 ià(
tsf
 != -1ULL)

78 
	`drv_£t_tsf
(
loÿl
, 
sd©a
, 
tsf
 + 
tsfd–
);

80 
	}
}

83 
	$mesh_sync_off£t_rx_bú_´e¥
(
›“80211_sub_if_d©a
 *
sd©a
, 
u16
 
¡y³
,

84 
›“80211_mgmt
 *
mgmt
, 
Ën
,

85 cÚ¡ 
›“80211_meshcÚf_›
 *
mesh_cfg
,

86 
›“80211_rx_¡©us
 *
rx_¡©us
)

88 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

89 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

90 
¡a_šfo
 *
¡a
;

91 
u64
 
t_t
, 
t_r
;

93 
	`WARN_ON
(
ifmsh
->
mesh_¥_id
 !ğ
IEEE80211_SYNC_METHOD_NEIGHBOR_OFFSET
);

96 ià(
¡y³
 !ğ
IEEE80211_STYPE_BEACON
)

105 ià(
	`›“80211_have_rx_time¡amp
(
rx_¡©us
))

106 
t_r
 = 
	`›“80211_ÿlcuÏ‹_rx_time¡amp
(
loÿl
, 
rx_¡©us
,

107 
Ën
 + 
FCS_LEN
, 24);

109 
t_r
 = 
	`drv_g‘_tsf
(
loÿl
, 
sd©a
);

111 
	`rcu_»ad_lock
();

112 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
mgmt
->
§
);

113 ià(!
¡a
)

114 
no_sync
;

122 ià(
	`mesh_³”_tb‰_adju¡šg
(
mesh_cfg
)) {

123 
	`msync_dbg
(
sd©a
, "STA %pM : is‡djusting TBTT\n",

124 
¡a
->¡a.
addr
);

125 
no_sync
;

129 
t_t
 = 
	`Ë64_to_ıu
(
mgmt
->
u
.
b—cÚ
.
time¡amp
);

130 
¡a
->
mesh
->
t_off£t
 = 
t_t
 - 
t_r
;

132 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TOFFSET_KNOWN
)) {

133 
s64
 
t_şockdriá
 = 
¡a
->
mesh
->
t_off£t_£ošt
 - s->mesh->
t_off£t
;

134 
	`msync_dbg
(
sd©a
,

136 
¡a
->¡a.
addr
, (è¡a->
mesh
->
t_off£t
,

137 (è
¡a
->
mesh
->
t_off£t_£ošt
,

138 (è
t_şockdriá
);

140 ià(
t_şockdriá
 > 
TOFFSET_MAXIMUM_ADJUSTMENT
 ||

141 
t_şockdriá
 < -
TOFFSET_MAXIMUM_ADJUSTMENT
) {

142 
	`msync_dbg
(
sd©a
,

144 
¡a
->¡a.
addr
,

145 (è
t_şockdriá
);

146 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_TOFFSET_KNOWN
);

147 
no_sync
;

150 
	`¥š_lock_bh
(&
ifmsh
->
sync_off£t_lock
);

151 ià(
t_şockdriá
 > 
ifmsh
->
sync_off£t_şockdriá_max
)

152 
ifmsh
->
sync_off£t_şockdriá_max
 = 
t_şockdriá
;

153 
	`¥š_uÆock_bh
(&
ifmsh
->
sync_off£t_lock
);

155 
¡a
->
mesh
->
t_off£t_£ošt
 = s->mesh->
t_off£t
 - 
TOFFSET_SET_MARGIN
;

156 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TOFFSET_KNOWN
);

157 
	`msync_dbg
(
sd©a
,

159 
¡a
->¡a.
addr
,

160 (è
¡a
->
mesh
->
t_off£t
);

163 
no_sync
:

164 
	`rcu_»ad_uÆock
();

165 
	}
}

167 
	$mesh_sync_off£t_adju¡_tsf
(
›“80211_sub_if_d©a
 *
sd©a
,

168 
b—cÚ_d©a
 *
b—cÚ
)

170 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

172 
	`WARN_ON
(
ifmsh
->
mesh_¥_id
 !ğ
IEEE80211_SYNC_METHOD_NEIGHBOR_OFFSET
);

173 
	`WARN_ON
(!
	`rcu_»ad_lock_h–d
());

175 
	`¥š_lock_bh
(&
ifmsh
->
sync_off£t_lock
);

177 ià(
ifmsh
->
sync_off£t_şockdriá_max
 > 
TOFFSET_MINIMUM_ADJUSTMENT
) {

183 
	`msync_dbg
(
sd©a
,

185 
ifmsh
->
sync_off£t_şockdriá_max
);

186 
	`£t_b™
(
MESH_WORK_DRIFT_ADJUST
, &
ifmsh
->
wrkq_æags
);

188 
	`msync_dbg
(
sd©a
,

190 ()
ifmsh
->
sync_off£t_şockdriá_max
);

191 
ifmsh
->
sync_off£t_şockdriá_max
 = 0;

193 
	`¥š_uÆock_bh
(&
ifmsh
->
sync_off£t_lock
);

194 
	}
}

196 cÚ¡ 
sync_m‘hod
 
	gsync_m‘hods
[] = {

198 .
m‘hod
 = 
IEEE80211_SYNC_METHOD_NEIGHBOR_OFFSET
,

199 .
	gİs
 = {

200 .
rx_bú_´e¥
 = &
mesh_sync_off£t_rx_bú_´e¥
,

201 .
	gadju¡_tsf
 = &
mesh_sync_off£t_adju¡_tsf
,

206 cÚ¡ 
›“80211_mesh_sync_İs
 *
	$›“80211_mesh_sync_İs_g‘
(
u8
 
m‘hod
)

208 
i
;

210 
i
 = 0 ; i < 
	`ARRAY_SIZE
(
sync_m‘hods
); ++i) {

211 ià(
sync_m‘hods
[
i
].
m‘hod
 == method)

212  &
sync_m‘hods
[
i
].
İs
;

214  
NULL
;

215 
	}
}

	@michael.c

6 
	~<lšux/ty³s.h
>

7 
	~<lšux/b™İs.h
>

8 
	~<lšux/›“80211.h
>

9 
	~<asm/uÇligÃd.h
>

11 
	~"mich«l.h
"

13 
	$mich«l_block
(
mich«l_mic_ùx
 *
mùx
, 
u32
 
v®
)

15 
mùx
->
l
 ^ğ
v®
;

16 
mùx
->
r
 ^ğ
	`rŞ32
(mùx->
l
, 17);

17 
mùx
->
l
 +ğmùx->
r
;

18 
mùx
->
r
 ^ğ((mùx->
l
 & 0xff00ff00) >> 8) |

19 ((
mùx
->
l
 & 0x00ff00ff) << 8);

20 
mùx
->
l
 +ğmùx->
r
;

21 
mùx
->
r
 ^ğ
	`rŞ32
(mùx->
l
, 3);

22 
mùx
->
l
 +ğmùx->
r
;

23 
mùx
->
r
 ^ğ
	`rÜ32
(mùx->
l
, 2);

24 
mùx
->
l
 +ğmùx->
r
;

25 
	}
}

27 
	$mich«l_mic_hdr
(
mich«l_mic_ùx
 *
mùx
, cÚ¡ 
u8
 *
key
,

28 
›“80211_hdr
 *
hdr
)

30 
u8
 *
da
, *
§
, 
tid
;

32 
da
 = 
	`›“80211_g‘_DA
(
hdr
);

33 
§
 = 
	`›“80211_g‘_SA
(
hdr
);

34 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
))

35 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

37 
tid
 = 0;

39 
mùx
->
l
 = 
	`g‘_uÇligÃd_Ë32
(
key
);

40 
mùx
->
r
 = 
	`g‘_uÇligÃd_Ë32
(
key
 + 4);

46 
	`mich«l_block
(
mùx
, 
	`g‘_uÇligÃd_Ë32
(
da
));

47 
	`mich«l_block
(
mùx
, 
	`g‘_uÇligÃd_Ë16
(&
da
[4]) |

48 (
	`g‘_uÇligÃd_Ë16
(
§
) << 16));

49 
	`mich«l_block
(
mùx
, 
	`g‘_uÇligÃd_Ë32
(&
§
[2]));

50 
	`mich«l_block
(
mùx
, 
tid
);

51 
	}
}

53 
	$mich«l_mic
(cÚ¡ 
u8
 *
key
, 
›“80211_hdr
 *
hdr
,

54 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
)

56 
u32
 
v®
;

57 
size_t
 
block
, 
blocks
, 
Ëá
;

58 
mich«l_mic_ùx
 
mùx
;

60 
	`mich«l_mic_hdr
(&
mùx
, 
key
, 
hdr
);

63 
blocks
 = 
d©a_Ën
 / 4;

64 
Ëá
 = 
d©a_Ën
 % 4;

66 
block
 = 0; block < 
blocks
; block++)

67 
	`mich«l_block
(&
mùx
, 
	`g‘_uÇligÃd_Ë32
(&
d©a
[
block
 * 4]));

71 
v®
 = 0x5a;

72 
Ëá
 > 0) {

73 
v®
 <<= 8;

74 
Ëá
--;

75 
v®
 |ğ
d©a
[
blocks
 * 4 + 
Ëá
];

78 
	`mich«l_block
(&
mùx
, 
v®
);

79 
	`mich«l_block
(&
mùx
, 0);

81 
	`put_uÇligÃd_Ë32
(
mùx
.
l
, 
mic
);

82 
	`put_uÇligÃd_Ë32
(
mùx
.
r
, 
mic
 + 4);

83 
	}
}

	@michael.h

7 #iâdeà
MICHAEL_H


8 
	#MICHAEL_H


	)

10 
	~<lšux/ty³s.h
>

11 
	~<lšux/›“80211.h
>

13 
	#MICHAEL_MIC_LEN
 8

	)

15 
	smich«l_mic_ùx
 {

16 
u32
 
	ml
, 
	mr
;

19 
mich«l_mic
(cÚ¡ 
u8
 *
key
, 
›“80211_hdr
 *
hdr
,

20 cÚ¡ 
u8
 *
d©a
, 
size_t
 
d©a_Ën
, u8 *
mic
);

	@mlme.c

14 
	~<lšux/d–ay.h
>

15 
	~<lšux/fs.h
>

16 
	~<lšux/if_‘h”.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/if_¬p.h
>

19 
	~<lšux/‘h”deviû.h
>

20 
	~<lšux/moduË·¿m.h
>

21 
	~<lšux/¹Ãšk.h
>

22 
	~<lšux/üc32.h
>

23 
	~<lšux/¦ab.h
>

24 
	~<lšux/expÜt.h
>

25 
	~<Ãt/mac80211.h
>

26 
	~<asm/uÇligÃd.h
>

28 
	~"›“80211_i.h
"

29 
	~"driv”-İs.h
"

30 
	~"¿‹.h
"

31 
	~"Ëd.h
"

32 
	~"fs_«ad.h
"

34 
	#IEEE80211_AUTH_TIMEOUT
 (
HZ
 / 5)

	)

35 
	#IEEE80211_AUTH_TIMEOUT_LONG
 (
HZ
 / 2)

	)

36 
	#IEEE80211_AUTH_TIMEOUT_SHORT
 (
HZ
 / 10)

	)

37 
	#IEEE80211_AUTH_TIMEOUT_SAE
 (
HZ
 * 2)

	)

38 
	#IEEE80211_AUTH_MAX_TRIES
 3

	)

39 
	#IEEE80211_AUTH_WAIT_ASSOC
 (
HZ
 * 5)

	)

40 
	#IEEE80211_AUTH_WAIT_SAE_RETRY
 (
HZ
 * 2)

	)

41 
	#IEEE80211_ASSOC_TIMEOUT
 (
HZ
 / 5)

	)

42 
	#IEEE80211_ASSOC_TIMEOUT_LONG
 (
HZ
 / 2)

	)

43 
	#IEEE80211_ASSOC_TIMEOUT_SHORT
 (
HZ
 / 10)

	)

44 
	#IEEE80211_ASSOC_MAX_TRIES
 3

	)

46 
	#IEEE80211_ADV_TTLM_SAFETY_BUFFER_MS
 
	`m£cs_to_jiff›s
(100)

	)

47 
	#IEEE80211_ADV_TTLM_ST_UNDERFLOW
 0xff00

	)

49 
	#IEEE80211_NEG_TTLM_REQ_TIMEOUT
 (
HZ
 / 5)

	)

51 
	gmax_nuÎfunc_Œ›s
 = 2;

52 
moduË_·¿m
(
max_nuÎfunc_Œ›s
, , 0644);

53 
MODULE_PARM_DESC
(
max_nuÎfunc_Œ›s
,

56 
	gmax_´obe_Œ›s
 = 5;

57 
moduË_·¿m
(
max_´obe_Œ›s
, , 0644);

58 
MODULE_PARM_DESC
(
max_´obe_Œ›s
,

69 
	gb—cÚ_loss_couÁ
 = 7;

70 
moduË_·¿m
(
b—cÚ_loss_couÁ
, , 0644);

71 
MODULE_PARM_DESC
(
b—cÚ_loss_couÁ
,

78 
	#IEEE80211_CONNECTION_IDLE_TIME
 (30 * 
HZ
)

	)

84 
	g´obe_wa™_ms
 = 500;

85 
moduË_·¿m
(
´obe_wa™_ms
, , 0644);

86 
MODULE_PARM_DESC
(
´obe_wa™_ms
,

94 
	#IEEE80211_SIGNAL_AVE_MIN_COUNT
 4

	)

106 
	$run_agaš
(
›“80211_sub_if_d©a
 *
sd©a
,

107 
timeout
)

109 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

111 ià(!
	`tim”_³ndšg
(&
sd©a
->
u
.
mgd
.
tim”
) ||

112 
	`time_befÜe
(
timeout
, 
sd©a
->
u
.
mgd
.
tim”
.
expœes
))

113 
	`mod_tim”
(&
sd©a
->
u
.
mgd
.
tim”
, 
timeout
);

114 
	}
}

116 
	$›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
›“80211_sub_if_d©a
 *
sd©a
)

118 ià(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_BEACON_FILTER
)

121 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
CONNECTION_MONITOR
))

124 
	`mod_tim”
(&
sd©a
->
u
.
mgd
.
bú_mÚ_tim”
,

125 
	`round_jiff›s_up
(
jiff›s
 + 
sd©a
->
u
.
mgd
.
b—cÚ_timeout
));

126 
	}
}

128 
	$›“80211_¡a_»£t_cÚn_mÚ™Ü
(
›“80211_sub_if_d©a
 *
sd©a
)

130 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

132 ià(
	`uÆik–y
(!
ifmgd
->
assocŸ‹d
))

135 ià(
ifmgd
->
´obe_£nd_couÁ
)

136 
ifmgd
->
´obe_£nd_couÁ
 = 0;

138 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
CONNECTION_MONITOR
))

141 
	`mod_tim”
(&
ifmgd
->
cÚn_mÚ_tim”
,

142 
	`round_jiff›s_up
(
jiff›s
 + 
IEEE80211_CONNECTION_IDLE_TIME
));

143 
	}
}

145 
	$ecw2cw
(
ecw
)

147  (1 << 
ecw
) - 1;

148 
	}
}

150 
›“80211_cÚn_mode


151 
	$›“80211_d‘”mše_­_chª
(
›“80211_sub_if_d©a
 *
sd©a
,

152 
›“80211_chªÃl
 *
chªÃl
,

153 
u32
 
vht_ÿp_šfo
,

154 cÚ¡ 
›“802_11_–ems
 *
–ems
,

155 
boŞ
 
ignÜe_ht_chªÃl_mism©ch
,

156 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
,

157 
cfg80211_chª_def
 *
chªdef
)

159 cÚ¡ 
›“80211_ht_İ”©iÚ
 *
ht_İ”
 = 
–ems
->
ht_İ”©iÚ
;

160 cÚ¡ 
›“80211_vht_İ”©iÚ
 *
vht_İ”
 = 
–ems
->
vht_İ”©iÚ
;

161 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ”
 = 
–ems
->
he_İ”©iÚ
;

162 cÚ¡ 
›“80211_eht_İ”©iÚ
 *
eht_İ”
 = 
–ems
->
eht_İ”©iÚ
;

163 
›“80211_suµÜ‹d_bªd
 *
sbªd
 =

164 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
chªÃl
->
bªd
];

165 
cfg80211_chª_def
 
vht_chªdef
;

166 
boŞ
 
no_vht
 = 
çl£
;

167 
u32
 
ht_cäeq
;

169 *
chªdef
 = (
cfg80211_chª_def
) {

170 .
chª
 = 
chªÃl
,

171 .
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
,

172 .
ûÁ”_äeq1
 = 
chªÃl
->
ûÁ”_äeq
,

173 .
äeq1_off£t
 = 
chªÃl
->
äeq_off£t
,

177 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

178 ià(!
	`›“80211_chªdef_s1g_İ”
(
–ems
->
s1g_İ”
, 
chªdef
)) {

179 
	`sd©a_šfo
(
sd©a
,

181 
chªdef
->
width
 = 
	`›“80211_s1g_chªÃl_width
(
chªÃl
);

184  
IEEE80211_CONN_MODE_S1G
;

188 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
) {

189 
›“80211_cÚn_mode
 
mode
 = 
IEEE80211_CONN_MODE_EHT
;

192 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

193  
IEEE80211_CONN_MODE_LEGACY
;

195 ià(!
–ems
->
he_6ghz_ÿ·
 || !–ems->
he_ÿp
) {

196 
	`sd©a_šfo
(
sd©a
,

198  
IEEE80211_CONN_MODE_LEGACY
;

201 ià(!
eht_İ”
 || !
–ems
->
eht_ÿp
) {

202 
eht_İ”
 = 
NULL
;

203 
mode
 = 
IEEE80211_CONN_MODE_HE
;

206 ià(!
	`›“80211_chªdef_he_6ghz_İ”
(
sd©a
->
loÿl
, 
he_İ”
,

207 
eht_İ”
, 
chªdef
)) {

208 
	`sd©a_šfo
(
sd©a
, "bad HE/EHT 6 GHz operation\n");

209  
IEEE80211_CONN_MODE_LEGACY
;

212  
mode
;

216 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_HT
)

217  
IEEE80211_CONN_MODE_LEGACY
;

219 ià(!
ht_İ”
 || !
–ems
->
ht_ÿp_–em
)

220  
IEEE80211_CONN_MODE_LEGACY
;

222 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_20
;

224 
ht_cäeq
 = 
	`›“80211_chªÃl_to_äequ’cy
(
ht_İ”
->
´im¬y_chª
,

225 
chªÃl
->
bªd
);

227 ià(!
ignÜe_ht_chªÃl_mism©ch
 && 
chªÃl
->
ûÁ”_äeq
 !ğ
ht_cäeq
) {

235 
	`sd©a_šfo
(
sd©a
,

237 
chªÃl
->
ûÁ”_äeq
, 
ht_cäeq
,

238 
ht_İ”
->
´im¬y_chª
, 
chªÃl
->
bªd
);

239  
IEEE80211_CONN_MODE_LEGACY
;

242 
	`›“80211_chªdef_ht_İ”
(
ht_İ”
, 
chªdef
);

244 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

245  
IEEE80211_CONN_MODE_HT
;

247 
vht_chªdef
 = *
chªdef
;

253 ià(
–ems
->
he_ÿp
 && 
he_İ”
 &&

254 
he_İ”
->
he_İ”_·¿ms
 & 
	`ıu_to_Ë32
(
IEEE80211_HE_OPERATION_VHT_OPER_INFO
)) {

255 
›“80211_vht_İ”©iÚ
 
he_İ”_vht_ÿp
;

261 
	`memıy
(&
he_İ”_vht_ÿp
, 
he_İ”
->
İtiÚ®
, 3);

262 
he_İ”_vht_ÿp
.
basic_mcs_£t
 = 
	`ıu_to_Ë16
(0);

264 ià(!
	`›“80211_chªdef_vht_İ”
(&
sd©a
->
loÿl
->
hw
, 
vht_ÿp_šfo
,

265 &
he_İ”_vht_ÿp
, 
ht_İ”
,

266 &
vht_chªdef
)) {

267 
	`sd©a_šfo
(
sd©a
,

270  
IEEE80211_CONN_MODE_VHT
;

272 } ià(!
vht_İ”
 || !
–ems
->
vht_ÿp_–em
) {

273 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_5GHZ
) {

274 
	`sd©a_šfo
(
sd©a
,

276  
IEEE80211_CONN_MODE_HT
;

278 
no_vht
 = 
Œue
;

279 } ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_2GHZ
) {

280 
no_vht
 = 
Œue
;

281 } ià(!
	`›“80211_chªdef_vht_İ”
(&
sd©a
->
loÿl
->
hw
,

282 
vht_ÿp_šfo
,

283 
vht_İ”
, 
ht_İ”
,

284 &
vht_chªdef
)) {

285 
	`sd©a_šfo
(
sd©a
,

287  
IEEE80211_CONN_MODE_HT
;

290 ià(!
	`cfg80211_chªdef_com·tibË
(
chªdef
, &
vht_chªdef
)) {

291 
	`sd©a_šfo
(
sd©a
,

293  
IEEE80211_CONN_MODE_HT
;

296 *
chªdef
 = 
vht_chªdef
;

299 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_HE
 ||

300 !
–ems
->
he_İ”©iÚ
 || !–ems->
he_ÿp
) {

301 ià(
no_vht
)

302  
IEEE80211_CONN_MODE_HT
;

303  
IEEE80211_CONN_MODE_VHT
;

307 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_EHT
 ||

308 !
eht_İ”
 || !
–ems
->
eht_ÿp
)

309  
IEEE80211_CONN_MODE_HE
;

316 ià(
eht_İ”
->
·¿ms
 & 
IEEE80211_EHT_OPER_INFO_PRESENT
) {

317 
cfg80211_chª_def
 
eht_chªdef
 = *
chªdef
;

319 
	`›“80211_chªdef_eht_İ”
((cÚ¡ *)
eht_İ”
->
İtiÚ®
,

320 &
eht_chªdef
);

322 
eht_chªdef
.
punùu»d
 =

323 
	`›“80211_eht_İ”_dis_subchª_b™m­
(
eht_İ”
);

325 ià(!
	`cfg80211_chªdef_v®id
(&
eht_chªdef
)) {

326 
	`sd©a_šfo
(
sd©a
,

328  
IEEE80211_CONN_MODE_HE
;

331 ià(!
	`cfg80211_chªdef_com·tibË
(
chªdef
, &
eht_chªdef
)) {

332 
	`sd©a_šfo
(
sd©a
,

334  
IEEE80211_CONN_MODE_HE
;

337 *
chªdef
 = 
eht_chªdef
;

340  
IEEE80211_CONN_MODE_EHT
;

341 
	}
}

343 
boŞ


344 
	$›“80211_v”ify_³”_he_mcs_suµÜt
(
›“80211_sub_if_d©a
 *
sd©a
,

345 cÚ¡ 
›“80211_he_ÿp_–em
 *
he_ÿp
,

346 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ
)

348 
›“80211_he_mcs_nss_suµ
 *
he_mcs_nss_suµ
;

349 
u16
 
mcs_80_m­_tx
, 
mcs_80_m­_rx
;

350 
u16
 
­_mš_»q_£t
;

351 
nss
;

353 ià(!
he_ÿp
)

354  
çl£
;

357 
he_mcs_nss_suµ
 = (*)(
he_ÿp
 + 1);

359 
mcs_80_m­_tx
 = 
	`Ë16_to_ıu
(
he_mcs_nss_suµ
->
tx_mcs_80
);

360 
mcs_80_m­_rx
 = 
	`Ë16_to_ıu
(
he_mcs_nss_suµ
->
rx_mcs_80
);

370 ià((
mcs_80_m­_tx
 & 0x3è=ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

371 (
mcs_80_m­_rx
 & 0x3è=ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

372 
	`sd©a_šfo
(
sd©a
,

374 
mcs_80_m­_tx
, 
mcs_80_m­_rx
);

375  
çl£
;

378 ià(!
he_İ
)

379  
Œue
;

381 
­_mš_»q_£t
 = 
	`Ë16_to_ıu
(
he_İ
->
he_mcs_nss_£t
);

388 ià(!
­_mš_»q_£t
)

389  
Œue
;

404 
nss
 = 8;‚ss > 0;‚ss--) {

405 
u8
 
­_İ_v®
 = (
­_mš_»q_£t
 >> (2 * (
nss
 - 1))) & 3;

406 
u8
 
­_rx_v®
;

407 
u8
 
­_tx_v®
;

409 ià(
­_İ_v®
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
)

412 
­_rx_v®
 = (
mcs_80_m­_rx
 >> (2 * (
nss
 - 1))) & 3;

413 
­_tx_v®
 = (
mcs_80_m­_tx
 >> (2 * (
nss
 - 1))) & 3;

415 ià(
­_rx_v®
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

416 
­_tx_v®
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

417 
­_rx_v®
 < 
­_İ_v®
 || 
­_tx_v®
 <‡p_op_val) {

418 
	`sd©a_šfo
(
sd©a
,

420 
nss
, 
­_rx_v®
,‡p_rx_v®, 
­_İ_v®
);

421  
çl£
;

425  
Œue
;

426 
	}
}

428 
boŞ


429 
	$›“80211_v”ify_¡a_he_mcs_suµÜt
(
›“80211_sub_if_d©a
 *
sd©a
,

430 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

431 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ
)

433 cÚ¡ 
›“80211_¡a_he_ÿp
 *
¡a_he_ÿp
 =

434 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

435 
u16
 
­_mš_»q_£t
;

436 
i
;

438 ià(!
¡a_he_ÿp
 || !
he_İ
)

439  
çl£
;

441 
­_mš_»q_£t
 = 
	`Ë16_to_ıu
(
he_İ
->
he_mcs_nss_£t
);

448 ià(!
­_mš_»q_£t
)

449  
Œue
;

452 
i
 = 0; i < 3; i++) {

453 cÚ¡ 
›“80211_he_mcs_nss_suµ
 *
¡a_mcs_nss_suµ
 =

454 &
¡a_he_ÿp
->
he_mcs_nss_suµ
;

455 
u16
 
¡a_mcs_m­_rx
 =

456 
	`Ë16_to_ıu
(((
__Ë16
 *)
¡a_mcs_nss_suµ
)[2 * 
i
]);

457 
u16
 
¡a_mcs_m­_tx
 =

458 
	`Ë16_to_ıu
(((
__Ë16
 *)
¡a_mcs_nss_suµ
)[2 * 
i
 + 1]);

459 
u8
 
nss
;

460 
boŞ
 
v”if›d
 = 
Œue
;

471 
nss
 = 8;‚ss > 0;‚ss--) {

472 
u8
 
¡a_rx_v®
 = (
¡a_mcs_m­_rx
 >> (2 * (
nss
 - 1))) & 3;

473 
u8
 
¡a_tx_v®
 = (
¡a_mcs_m­_tx
 >> (2 * (
nss
 - 1))) & 3;

474 
u8
 
­_v®
 = (
­_mš_»q_£t
 >> (2 * (
nss
 - 1))) & 3;

476 ià(
­_v®
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
)

491 ià(
¡a_rx_v®
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

492 
¡a_tx_v®
 =ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
 ||

493 (
­_v®
 > 
¡a_rx_v®
è|| (­_v® > 
¡a_tx_v®
)) {

494 
v”if›d
 = 
çl£
;

499 ià(
v”if›d
)

500  
Œue
;

504  
çl£
;

505 
	}
}

507 
u8


508 
	$›“80211_g‘_eht_ÿp_mcs_nss
(cÚ¡ 
›“80211_¡a_he_ÿp
 *
¡a_he_ÿp
,

509 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
¡a_eht_ÿp
,

510 
idx
, 
bw
)

512 
u8
 
he_phy_ÿp0
 = 
¡a_he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0];

513 
u8
 
eht_phy_ÿp0
 = 
¡a_eht_ÿp
->
eht_ÿp_–em
.
phy_ÿp_šfo
[0];

518 ià(!(
he_phy_ÿp0
 & 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_MASK_ALL
))

519  
¡a_eht_ÿp
->
eht_mcs_nss_suµ
.
Úly_20mhz
.
rx_tx_max_nss
[
idx
];

522 ià(
idx
 > 0)

523 
idx
--;

525 
bw
) {

527  
¡a_eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_80
.
rx_tx_max_nss
[
idx
];

529 ià(!(
he_phy_ÿp0
 &

530 (
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
 |

531 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
)))

533  
¡a_eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_160
.
rx_tx_max_nss
[
idx
];

535 ià(!(
eht_phy_ÿp0
 & 
IEEE80211_EHT_PHY_CAP0_320MHZ_IN_6GHZ
))

537  
¡a_eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_320
.
rx_tx_max_nss
[
idx
];

540 
	`WARN_ON
(1);

542 
	}
}

544 
boŞ


545 
	$›“80211_v”ify_¡a_eht_mcs_suµÜt
(
›“80211_sub_if_d©a
 *
sd©a
,

546 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

547 cÚ¡ 
›“80211_eht_İ”©iÚ
 *
eht_İ
)

549 cÚ¡ 
›“80211_¡a_he_ÿp
 *
¡a_he_ÿp
 =

550 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

551 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
¡a_eht_ÿp
 =

552 
	`›“80211_g‘_eht_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

553 cÚ¡ 
›“80211_eht_mcs_nss_suµ_20mhz_Úly
 *
»q
;

554 
i
;

556 ià(!
¡a_he_ÿp
 || !
¡a_eht_ÿp
 || !
eht_İ
)

557  
çl£
;

559 
»q
 = &
eht_İ
->
basic_mcs_nss
;

561 
i
 = 0; i < 
	`ARRAY_SIZE
(
»q
->
rx_tx_max_nss
); i++) {

562 
u8
 
»q_rx_nss
, 
»q_tx_nss
;

563 
bw
;

565 
»q_rx_nss
 = 
	`u8_g‘_b™s
(
»q
->
rx_tx_max_nss
[
i
],

566 
IEEE80211_EHT_MCS_NSS_RX
);

567 
»q_tx_nss
 = 
	`u8_g‘_b™s
(
»q
->
rx_tx_max_nss
[
i
],

568 
IEEE80211_EHT_MCS_NSS_TX
);

570 
bw
 = 0; bw < 3; bw++) {

571 
u8
 
have
, 
have_rx_nss
, 
have_tx_nss
;

573 
have
 = 
	`›“80211_g‘_eht_ÿp_mcs_nss
(
¡a_he_ÿp
,

574 
¡a_eht_ÿp
,

575 
i
, 
bw
);

576 
have_rx_nss
 = 
	`u8_g‘_b™s
(
have
,

577 
IEEE80211_EHT_MCS_NSS_RX
);

578 
have_tx_nss
 = 
	`u8_g‘_b™s
(
have
,

579 
IEEE80211_EHT_MCS_NSS_TX
);

581 ià(
»q_rx_nss
 > 
have_rx_nss
 ||

582 
»q_tx_nss
 > 
have_tx_nss
)

583  
çl£
;

587  
Œue
;

588 
	}
}

590 
boŞ
 
	$›“80211_chªdef_u§bË
(
›“80211_sub_if_d©a
 *
sd©a
,

591 cÚ¡ 
cfg80211_chª_def
 *
chªdef
,

592 
u32
 
´ohib™ed_æags
)

594 ià(!
	`cfg80211_chªdef_u§bË
(
sd©a
->
loÿl
->
hw
.
why
,

595 
chªdef
, 
´ohib™ed_æags
))

596  
çl£
;

598 ià(
chªdef
->
punùu»d
 &&

599 
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
DISALLOW_PUNCTURING
))

600  
çl£
;

602  
Œue
;

603 
	}
}

605 
›“802_11_–ems
 *

606 
	$›“80211_d‘”mše_chª_mode
(
›“80211_sub_if_d©a
 *
sd©a
,

607 
›“80211_cÚn_£‰šgs
 *
cÚn
,

608 
cfg80211_bss
 *
cbss
, 
lšk_id
,

609 
›“80211_chª_»q
 *
chª»q
)

611 cÚ¡ 
cfg80211_bss_›s
 *
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

612 
›“80211_bss
 *
bss
 = (*)
cbss
->
´iv
;

613 
›“80211_chªÃl
 *
chªÃl
 = 
cbss
->channel;

614 
›“80211_–ems_·r£_·¿ms
 
·r£_·¿ms
 = {

615 .
lšk_id
 = -1,

616 .
äom_­
 = 
Œue
,

617 .
¡¬t
 = 
›s
->
d©a
,

618 .
Ën
 = 
›s
->len,

620 
›“802_11_–ems
 *
–ems
;

621 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

622 
cfg80211_chª_def
 
­_chªdef
;

623 
›“80211_cÚn_mode
 
­_mode
;

624 
»t
;

626 
agaš
:

627 
·r£_·¿ms
.
mode
 = 
cÚn
->mode;

628 
–ems
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

629 ià(!
–ems
)

630  
	`ERR_PTR
(-
ENOMEM
);

632 
­_mode
 = 
	`›“80211_d‘”mše_­_chª
(
sd©a
, 
chªÃl
, 
bss
->
vht_ÿp_šfo
,

633 
–ems
, 
çl£
, 
cÚn
, &
­_chªdef
);

636 ià(
	`WARN_ON
(
­_mode
 > 
cÚn
->
mode
)) {

637 
»t
 = -
EINVAL
;

638 
ä“
;

641 ià(
cÚn
->
mode
 !ğ
­_mode
) {

642 
cÚn
->
mode
 = 
­_mode
;

643 
	`kä“
(
–ems
);

644 
agaš
;

647 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
, "determined AP %pMo be %s\n",

648 
cbss
->
bssid
, 
	`›“80211_cÚn_mode_¡r
(
­_mode
));

650 
sbªd
 = 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
chªÃl
->
bªd
];

652 
chªÃl
->
bªd
) {

653 
NL80211_BAND_S1GHZ
:

654 ià(
	`WARN_ON
(
­_mode
 !ğ
IEEE80211_CONN_MODE_S1G
)) {

655 
»t
 = -
EINVAL
;

656 
ä“
;

658  
–ems
;

659 
NL80211_BAND_6GHZ
:

660 ià(
­_mode
 < 
IEEE80211_CONN_MODE_HE
) {

661 
	`sd©a_šfo
(
sd©a
,

663 
»t
 = -
EINVAL
;

664 
ä“
;

668 ià(
	`WARN_ON
(
­_mode
 =ğ
IEEE80211_CONN_MODE_S1G
)) {

669 
»t
 = -
EINVAL
;

670 
ä“
;

674 
­_mode
) {

675 
IEEE80211_CONN_MODE_S1G
:

676 
	`WARN_ON
(1);

677 
»t
 = -
EINVAL
;

678 
ä“
;

679 
IEEE80211_CONN_MODE_LEGACY
:

680 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

682 
IEEE80211_CONN_MODE_HT
:

683 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

684 
cÚn
->
bw_lim™
,

685 
IEEE80211_CONN_BW_LIMIT_40
);

687 
IEEE80211_CONN_MODE_VHT
:

688 
IEEE80211_CONN_MODE_HE
:

689 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

690 
cÚn
->
bw_lim™
,

691 
IEEE80211_CONN_BW_LIMIT_160
);

693 
IEEE80211_CONN_MODE_EHT
:

694 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

695 
cÚn
->
bw_lim™
,

696 
IEEE80211_CONN_BW_LIMIT_320
);

700 
chª»q
->
İ”
 = 
­_chªdef
;

703 ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_EHT
 &&

704 !(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_IGNORE_OFDMA_WIDER_BW
))

705 
chª»q
->
­
 = 
­_chªdef
;

707 
chª»q
->
­
.
chª
 = 
NULL
;

709 !
	`›“80211_chªdef_u§bË
(
sd©a
, &
chª»q
->
İ”
,

710 
IEEE80211_CHAN_DISABLED
)) {

711 ià(
	`WARN_ON
(
chª»q
->
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_20_NOHT
)) {

712 
»t
 = -
EINVAL
;

713 
ä“
;

716 
	`›“80211_chª»q_downg¿de
(
chª»q
, 
cÚn
);

719 ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_HE
 &&

720 !
	`cfg80211_chªdef_u§bË
(
sd©a
->
wdev
.
why
, &
chª»q
->
İ”
,

721 
IEEE80211_CHAN_NO_HE
)) {

722 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_VHT
;

723 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

724 
cÚn
->
bw_lim™
,

725 
IEEE80211_CONN_BW_LIMIT_160
);

728 ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_EHT
 &&

729 !
	`cfg80211_chªdef_u§bË
(
sd©a
->
wdev
.
why
, &
chª»q
->
İ”
,

730 
IEEE80211_CHAN_NO_EHT
)) {

731 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_HE
;

732 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

733 
cÚn
->
bw_lim™
,

734 
IEEE80211_CONN_BW_LIMIT_160
);

737 ià(
chª»q
->
İ”
.
width
 !ğ
­_chªdef
.width || 
­_mode
 !ğ
cÚn
->
mode
)

738 
	`sd©a_šfo
(
sd©a
,

741 ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_HE
 &&

742 (!
	`›“80211_v”ify_³”_he_mcs_suµÜt
(
sd©a
, (*)
–ems
->
he_ÿp
,

743 
–ems
->
he_İ”©iÚ
) ||

744 !
	`›“80211_v”ify_¡a_he_mcs_suµÜt
(
sd©a
, 
sbªd
,

745 
–ems
->
he_İ”©iÚ
))) {

746 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_VHT
;

747 
	`sd©a_šfo
(
sd©a
, "required MCSes‚ot supported, disabling HE\n");

750 ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_EHT
 &&

751 !
	`›“80211_v”ify_¡a_eht_mcs_suµÜt
(
sd©a
, 
sbªd
,

752 
–ems
->
eht_İ”©iÚ
)) {

753 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_HE
;

754 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

755 
cÚn
->
bw_lim™
,

756 
IEEE80211_CONN_BW_LIMIT_160
);

757 
	`sd©a_šfo
(
sd©a
, "required MCSes‚ot supported, disabling EHT\n");

761 ià(
­_mode
 !ğ
cÚn
->
mode
) {

762 
	`kä“
(
–ems
);

763 
agaš
;

766 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

768 
	`›“80211_cÚn_mode_¡r
(
cÚn
->
mode
),

769 20 * (1 << 
cÚn
->
bw_lim™
));

771 ià(
	`WARN_ON_ONCE
(!
	`cfg80211_chªdef_v®id
(&
chª»q
->
İ”
))) {

772 
»t
 = -
EINVAL
;

773 
ä“
;

776  
–ems
;

777 
ä“
:

778 
	`kä“
(
–ems
);

779  
	`ERR_PTR
(
»t
);

780 
	}
}

782 
	$›“80211_cÚfig_bw
(
›“80211_lšk_d©a
 *
lšk
,

783 
›“802_11_–ems
 *
–ems
,

784 
boŞ
 
upd©e
, 
u64
 *
chªged
)

786 
›“80211_chªÃl
 *
chªÃl
 = 
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
;

787 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

788 
›“80211_chª_»q
 
chª»q
 = {};

789 
›“80211_cÚn_mode
 
­_mode
;

790 
u32
 
vht_ÿp_šfo
 = 0;

791 
u16
 
ht_İmode
;

792 
»t
;

795 ià(
lšk
->
u
.
mgd
.
cÚn
.
mode
 =ğ
IEEE80211_CONN_MODE_LEGACY
 ||

796 
lšk
->
u
.
mgd
.
cÚn
.
mode
 =ğ
IEEE80211_CONN_MODE_S1G
)

799 ià(
–ems
->
vht_ÿp_–em
)

800 
vht_ÿp_šfo
 = 
	`Ë32_to_ıu
(
–ems
->
vht_ÿp_–em
->vht_cap_info);

802 
­_mode
 = 
	`›“80211_d‘”mše_­_chª
(
sd©a
, 
chªÃl
, 
vht_ÿp_šfo
,

803 
–ems
, 
Œue
, &
lšk
->
u
.
mgd
.
cÚn
,

804 &
chª»q
.
­
);

806 ià(
­_mode
 !ğ
lšk
->
u
.
mgd
.
cÚn
.
mode
) {

807 
	`lšk_šfo
(
lšk
,

809 
	`›“80211_cÚn_mode_¡r
(
lšk
->
u
.
mgd
.
cÚn
.
mode
),

810 
	`›“80211_cÚn_mode_¡r
(
­_mode
));

811  -
EINVAL
;

814 
chª»q
.
İ”
 = chª»q.
­
;

815 ià(
lšk
->
u
.
mgd
.
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_EHT
 ||

816 
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_IGNORE_OFDMA_WIDER_BW
)

817 
chª»q
.
­
.
chª
 = 
NULL
;

823 ià(
–ems
->
ht_İ”©iÚ
) {

824 
ht_İmode
 = 
	`Ë16_to_ıu
(
–ems
->
ht_İ”©iÚ
->
İ”©iÚ_mode
);

825 ià(
lšk
->
cÚf
->
ht_İ”©iÚ_mode
 !ğ
ht_İmode
) {

826 *
chªged
 |ğ
BSS_CHANGED_HT
;

827 
lšk
->
cÚf
->
ht_İ”©iÚ_mode
 = 
ht_İmode
;

838 
lšk
->
u
.
mgd
.
cÚn
.
bw_lim™
 <

839 
	`›“80211_mš_bw_lim™_äom_chªdef
(&
chª»q
.
İ”
))

840 
	`›“80211_chªdef_downg¿de
(&
chª»q
.
İ”
, 
NULL
);

842 ià(
	`›“80211_chª»q_id’tiÿl
(&
chª»q
, &
lšk
->
cÚf
->chanreq))

845 
	`lšk_šfo
(
lšk
,

847 
lšk
->
u
.
mgd
.
bssid
, 
chª»q
.
İ”
.
chª
->
ûÁ”_äeq
,

848 
chª»q
.
İ”
.
chª
->
äeq_off£t
, chª»q.İ”.
width
,

849 
chª»q
.
İ”
.
ûÁ”_äeq1
, chª»q.İ”.
äeq1_off£t
,

850 
chª»q
.
İ”
.
ûÁ”_äeq2
);

852 ià(!
	`cfg80211_chªdef_v®id
(&
chª»q
.
İ”
)) {

853 
	`sd©a_šfo
(
sd©a
,

855 
lšk
->
u
.
mgd
.
bssid
);

856  -
EINVAL
;

859 ià(!
upd©e
) {

860 
lšk
->
cÚf
->
chª»q
 = chanreq;

881 
»t
 = 
	`›“80211_lšk_chªge_chª»q
(
lšk
, &
chª»q
, 
chªged
);

882 ià(
»t
) {

883 
	`sd©a_šfo
(
sd©a
,

885 
lšk
->
u
.
mgd
.
bssid
);

886  
»t
;

889 
	`cfg80211_scheduË_chªÃls_check
(&
sd©a
->
wdev
);

891 
	}
}

895 
	$›“80211_add_ht_›
(
›“80211_sub_if_d©a
 *
sd©a
,

896 
sk_buff
 *
skb
, 
u8
 
­_ht_·¿m
,

897 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

898 
›“80211_chªÃl
 *
chªÃl
,

899 
›“80211_smps_mode
 
smps
,

900 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
)

902 
u8
 *
pos
;

903 
u32
 
æags
 = 
chªÃl
->flags;

904 
u16
 
ÿp
;

905 
›“80211_¡a_ht_ÿp
 
ht_ÿp
;

907 
	`BUILD_BUG_ON
((
ht_ÿp
è!ğ(
sbªd
->ht_cap));

909 
	`memıy
(&
ht_ÿp
, &
sbªd
->ht_cap, (ht_cap));

910 
	`›“80211_­¶y_htÿp_ov”rides
(
sd©a
, &
ht_ÿp
);

913 
ÿp
 = 
ht_ÿp
.cap;

915 
­_ht_·¿m
 & 
IEEE80211_HT_PARAM_CHA_SEC_OFFSET
) {

916 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
:

917 ià(
æags
 & 
IEEE80211_CHAN_NO_HT40PLUS
) {

918 
ÿp
 &ğ~
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

919 
ÿp
 &ğ~
IEEE80211_HT_CAP_SGI_40
;

922 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
:

923 ià(
æags
 & 
IEEE80211_CHAN_NO_HT40MINUS
) {

924 
ÿp
 &ğ~
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

925 
ÿp
 &ğ~
IEEE80211_HT_CAP_SGI_40
;

935 ià(
cÚn
->
bw_lim™
 <ğ
IEEE80211_CONN_BW_LIMIT_20
) {

936 
ÿp
 &ğ~
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

937 
ÿp
 &ğ~
IEEE80211_HT_CAP_SGI_40
;

941 
ÿp
 &ğ~
IEEE80211_HT_CAP_SM_PS
;

942 
smps
) {

943 
IEEE80211_SMPS_AUTOMATIC
:

944 
IEEE80211_SMPS_NUM_MODES
:

945 
	`WARN_ON
(1);

946 
çÎthrough
;

947 
IEEE80211_SMPS_OFF
:

948 
ÿp
 |ğ
WLAN_HT_CAP_SM_PS_DISABLED
 <<

949 
IEEE80211_HT_CAP_SM_PS_SHIFT
;

951 
IEEE80211_SMPS_STATIC
:

952 
ÿp
 |ğ
WLAN_HT_CAP_SM_PS_STATIC
 <<

953 
IEEE80211_HT_CAP_SM_PS_SHIFT
;

955 
IEEE80211_SMPS_DYNAMIC
:

956 
ÿp
 |ğ
WLAN_HT_CAP_SM_PS_DYNAMIC
 <<

957 
IEEE80211_HT_CAP_SM_PS_SHIFT
;

962 
pos
 = 
	`skb_put
(
skb
, (
›“80211_ht_ÿp
) + 2);

963 
	`›“80211_›_bud_ht_ÿp
(
pos
, &
ht_ÿp
, 
ÿp
);

964 
	}
}

970 
boŞ
 
	$›“80211_add_vht_›
(
›“80211_sub_if_d©a
 *
sd©a
,

971 
sk_buff
 *
skb
,

972 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

973 
›“80211_vht_ÿp
 *
­_vht_ÿp
,

974 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
)

976 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

977 
u8
 *
pos
;

978 
u32
 
ÿp
;

979 
›“80211_¡a_vht_ÿp
 
vht_ÿp
;

980 
u32
 
mask
, 
­_bf_¡s
, 
our_bf_¡s
;

981 
boŞ
 
mu_mimo_owÃr
 = 
çl£
;

983 
	`BUILD_BUG_ON
((
vht_ÿp
è!ğ(
sbªd
->vht_cap));

985 
	`memıy
(&
vht_ÿp
, &
sbªd
->vht_cap, (vht_cap));

986 
	`›“80211_­¶y_vhtÿp_ov”rides
(
sd©a
, &
vht_ÿp
);

989 
ÿp
 = 
vht_ÿp
.cap;

991 ià(
cÚn
->
bw_lim™
 <ğ
IEEE80211_CONN_BW_LIMIT_80
) {

992 
ÿp
 &ğ~
IEEE80211_VHT_CAP_SHORT_GI_160
;

993 
ÿp
 &ğ~
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
;

1000 ià(!(
­_vht_ÿp
->
vht_ÿp_šfo
 &

1001 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
)))

1002 
ÿp
 &ğ~(
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
 |

1003 
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
);

1004 ià(!(
­_vht_ÿp
->
vht_ÿp_šfo
 &

1005 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_MU_BEAMFORMER_CAPABLE
)))

1006 
ÿp
 &ğ~
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
;

1015 ià(
ÿp
 & 
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
) {

1016 
boŞ
 
di§bË_mu_mimo
 = 
çl£
;

1017 
›“80211_sub_if_d©a
 *
Ùh”
;

1019 
	`li¡_fÜ_—ch_’Œy_rcu
(
Ùh”
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1020 ià(
Ùh”
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
) {

1021 
di§bË_mu_mimo
 = 
Œue
;

1025 ià(
di§bË_mu_mimo
)

1026 
ÿp
 &ğ~
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
;

1028 
mu_mimo_owÃr
 = 
Œue
;

1031 
mask
 = 
IEEE80211_VHT_CAP_BEAMFORMEE_STS_MASK
;

1033 
­_bf_¡s
 = 
	`Ë32_to_ıu
(
­_vht_ÿp
->
vht_ÿp_šfo
è& 
mask
;

1034 
our_bf_¡s
 = 
ÿp
 & 
mask
;

1036 ià(
­_bf_¡s
 < 
our_bf_¡s
) {

1037 
ÿp
 &ğ~
mask
;

1038 
ÿp
 |ğ
­_bf_¡s
;

1042 
pos
 = 
	`skb_put
(
skb
, (
›“80211_vht_ÿp
) + 2);

1043 
	`›“80211_›_bud_vht_ÿp
(
pos
, &
vht_ÿp
, 
ÿp
);

1045  
mu_mimo_owÃr
;

1046 
	}
}

1048 
	$›“80211_assoc_add_¿‹s
(
sk_buff
 *
skb
,

1049 
Æ80211_chª_width
 
width
,

1050 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1051 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
)

1053 
u32
 
¿‹s
;

1055 ià(
assoc_d©a
->
suµ_¿‹s_Ën
) {

1062 
	`›“80211_·r£_b™¿‹s
(
width
, 
sbªd
,

1063 
assoc_d©a
->
suµ_¿‹s
,

1064 
assoc_d©a
->
suµ_¿‹s_Ën
,

1065 &
¿‹s
);

1072 
¿‹s
 = ~0;

1075 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 0, 0, ~
¿‹s
,

1076 
WLAN_EID_SUPP_RATES
);

1077 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 0, 0, ~
¿‹s
,

1078 
WLAN_EID_EXT_SUPP_RATES
);

1079 
	}
}

1081 
size_t
 
	$›“80211_add_befÜe_ht_–ems
(
sk_buff
 *
skb
,

1082 cÚ¡ 
u8
 *
–ems
,

1083 
size_t
 
–ems_Ën
,

1084 
size_t
 
off£t
)

1086 
size_t
 
noff£t
;

1088 cÚ¡ 
u8
 
befÜe_ht
[] = {

1089 
WLAN_EID_SSID
,

1090 
WLAN_EID_SUPP_RATES
,

1091 
WLAN_EID_EXT_SUPP_RATES
,

1092 
WLAN_EID_PWR_CAPABILITY
,

1093 
WLAN_EID_SUPPORTED_CHANNELS
,

1094 
WLAN_EID_RSN
,

1095 
WLAN_EID_QOS_CAPA
,

1096 
WLAN_EID_RRM_ENABLED_CAPABILITIES
,

1097 
WLAN_EID_MOBILITY_DOMAIN
,

1098 
WLAN_EID_FAST_BSS_TRANSITION
,

1099 
WLAN_EID_RIC_DATA
,

1100 
WLAN_EID_SUPPORTED_REGULATORY_CLASSES
,

1102 cÚ¡ 
u8
 
aá”_ric
[] = {

1103 
WLAN_EID_SUPPORTED_REGULATORY_CLASSES
,

1104 
WLAN_EID_HT_CAPABILITY
,

1105 
WLAN_EID_BSS_COEX_2040
,

1107 
WLAN_EID_EXT_CAPABILITY
,

1108 
WLAN_EID_QOS_TRAFFIC_CAPA
,

1109 
WLAN_EID_TIM_BCAST_REQ
,

1110 
WLAN_EID_INTERWORKING
,

1112 
WLAN_EID_VHT_CAPABILITY
,

1113 
WLAN_EID_OPMODE_NOTIF
,

1116 ià(!
–ems_Ën
)

1117  
off£t
;

1119 
noff£t
 = 
	`›“80211_›_¥l™_ric
(
–ems
, 
–ems_Ën
,

1120 
befÜe_ht
,

1121 
	`ARRAY_SIZE
(
befÜe_ht
),

1122 
aá”_ric
,

1123 
	`ARRAY_SIZE
(
aá”_ric
),

1124 
off£t
);

1125 
	`skb_put_d©a
(
skb
, 
–ems
 + 
off£t
, 
noff£t
 - offset);

1127  
noff£t
;

1128 
	}
}

1130 
size_t
 
	$›“80211_add_befÜe_vht_–ems
(
sk_buff
 *
skb
,

1131 cÚ¡ 
u8
 *
–ems
,

1132 
size_t
 
–ems_Ën
,

1133 
size_t
 
off£t
)

1135 cÚ¡ 
u8
 
befÜe_vht
[] = {

1140 
WLAN_EID_BSS_COEX_2040
,

1141 
WLAN_EID_EXT_CAPABILITY
,

1142 
WLAN_EID_QOS_TRAFFIC_CAPA
,

1143 
WLAN_EID_TIM_BCAST_REQ
,

1144 
WLAN_EID_INTERWORKING
,

1147 
size_t
 
noff£t
;

1149 ià(!
–ems_Ën
)

1150  
off£t
;

1153 
noff£t
 = 
	`›“80211_›_¥l™
(
–ems
, 
–ems_Ën
,

1154 
befÜe_vht
, 
	`ARRAY_SIZE
(before_vht),

1155 
off£t
);

1156 
	`skb_put_d©a
(
skb
, 
–ems
 + 
off£t
, 
noff£t
 - offset);

1158  
noff£t
;

1159 
	}
}

1161 
size_t
 
	$›“80211_add_befÜe_he_–ems
(
sk_buff
 *
skb
,

1162 cÚ¡ 
u8
 *
–ems
,

1163 
size_t
 
–ems_Ën
,

1164 
size_t
 
off£t
)

1166 cÚ¡ 
u8
 
befÜe_he
[] = {

1171 
WLAN_EID_OPMODE_NOTIF
,

1172 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FUTURE_CHAN_GUIDANCE
,

1174 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FILS_SESSION
,

1175 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FILS_PUBLIC_KEY
,

1176 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FILS_KEY_CONFIRM
,

1177 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FILS_HLP_CONTAINER
,

1178 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FILS_IP_ADDR_ASSIGN
,

1181 
size_t
 
noff£t
;

1183 ià(!
–ems_Ën
)

1184  
off£t
;

1187 
noff£t
 = 
	`›“80211_›_¥l™
(
–ems
, 
–ems_Ën
,

1188 
befÜe_he
, 
	`ARRAY_SIZE
(before_he),

1189 
off£t
);

1190 
	`skb_put_d©a
(
skb
, 
–ems
 + 
off£t
, 
noff£t
 - offset);

1192  
noff£t
;

1193 
	}
}

1195 
	#PRESENT_ELEMS_MAX
 8

	)

1196 
	#PRESENT_ELEM_EXT_OFFS
 0x100

	)

1198 
›“80211_assoc_add_ml_–em
(
›“80211_sub_if_d©a
 *
sd©a
,

1199 
sk_buff
 *
skb
, 
u16
 
ÿ·b
,

1200 cÚ¡ 
–em’t
 *
ext_ÿ·
,

1201 cÚ¡ 
u16
 *
´e£Á_–ems
);

1203 
size_t
 
	$›“80211_assoc_lšk_–ems
(
›“80211_sub_if_d©a
 *
sd©a
,

1204 
sk_buff
 *
skb
, 
u16
 *
ÿ·b
,

1205 cÚ¡ 
–em’t
 *
ext_ÿ·
,

1206 cÚ¡ 
u8
 *
exŒa_–ems
,

1207 
size_t
 
exŒa_–ems_Ën
,

1208 
lšk_id
,

1209 
›“80211_lšk_d©a
 *
lšk
,

1210 
u16
 *
´e£Á_–ems
)

1212 
Æ80211_iáy³
 
iáy³
 = 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
);

1213 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

1214 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
ifmgd
->assoc_data;

1215 
cfg80211_bss
 *
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

1216 
›“80211_chªÃl
 *
chª
 = 
cbss
->
chªÃl
;

1217 cÚ¡ 
›“80211_sbªd_iáy³_d©a
 *
iád
;

1218 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1219 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1220 
Æ80211_chª_width
 
width
 = 
NL80211_CHAN_WIDTH_20
;

1221 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

1222 
›“80211_smps_mode
 
smps_mode
;

1223 
u16
 
Üig_ÿ·b
 = *
ÿ·b
;

1224 
size_t
 
off£t
 = 0;

1225 
´e£Á_–ems_Ën
 = 0;

1226 
u8
 *
pos
;

1227 
i
;

1229 
	#ADD_PRESENT_ELEM
(
id
) do { \

1231 ià(!
	`WARN_ON
(
´e£Á_–ems_Ën
 >ğ
PRESENT_ELEMS_MAX
 - 1)) \

1232 
´e£Á_–ems
[
´e£Á_–ems_Ën
++] = (
id
); \

1233 } 0)

	)

1234 
	#ADD_PRESENT_EXT_ELEM
(
id
è
	`ADD_PRESENT_ELEM
(
PRESENT_ELEM_EXT_OFFS
 | (id))

	)

1236 ià(
lšk
)

1237 
smps_mode
 = 
lšk
->smps_mode;

1238 ià(
sd©a
->
u
.
mgd
.
pow”§ve
)

1239 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

1241 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

1243 ià(
lšk
) {

1249 
	`rcu_»ad_lock
();

1250 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
lšk
->
cÚf
->chanctx_conf);

1251 ià(
chªùx_cÚf
)

1252 
width
 = 
chªùx_cÚf
->
def
.width;

1253 
	`rcu_»ad_uÆock
();

1256 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
chª
->
bªd
];

1257 
iád
 = 
	`›“80211_g‘_sbªd_iáy³_d©a
(
sbªd
, 
iáy³
);

1259 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_2GHZ
) {

1260 *
ÿ·b
 |ğ
WLAN_CAPABILITY_SHORT_SLOT_TIME
;

1261 *
ÿ·b
 |ğ
WLAN_CAPABILITY_SHORT_PREAMBLE
;

1264 ià((
cbss
->
ÿ·b™y
 & 
WLAN_CAPABILITY_SPECTRUM_MGMT
) &&

1265 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SPECTRUM_MGMT
))

1266 *
ÿ·b
 |ğ
WLAN_CAPABILITY_SPECTRUM_MGMT
;

1268 ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_S1GHZ
)

1269 
	`›“80211_assoc_add_¿‹s
(
skb
, 
width
, 
sbªd
, 
assoc_d©a
);

1271 ià(*
ÿ·b
 & 
WLAN_CAPABILITY_SPECTRUM_MGMT
 ||

1272 *
ÿ·b
 & 
WLAN_CAPABILITY_RADIO_MEASURE
) {

1273 
cfg80211_chª_def
 
chªdef
 = {

1274 .
width
 = width,

1275 .
chª
 = chan,

1278 
pos
 = 
	`skb_put
(
skb
, 4);

1279 *
pos
++ = 
WLAN_EID_PWR_CAPABILITY
;

1280 *
pos
++ = 2;

1281 *
pos
++ = 0;

1283 *
pos
++ = 
	`›“80211_chªdef_max_pow”
(&
chªdef
);

1284 
	`ADD_PRESENT_ELEM
(
WLAN_EID_PWR_CAPABILITY
);

1292 ià(*
ÿ·b
 & 
WLAN_CAPABILITY_SPECTRUM_MGMT
 &&

1293 (
sbªd
->
bªd
 !ğ
NL80211_BAND_6GHZ
 ||

1294 !
ext_ÿ·
 ||ƒxt_ÿ·->
d©®’
 < 1 ||

1295 !(
ext_ÿ·
->
d©a
[0] & 
WLAN_EXT_CAPA1_EXT_CHANNEL_SWITCHING
))) {

1297 
pos
 = 
	`skb_put
(
skb
, 2 * 
sbªd
->
n_chªÃls
 + 2);

1298 *
pos
++ = 
WLAN_EID_SUPPORTED_CHANNELS
;

1299 *
pos
++ = 2 * 
sbªd
->
n_chªÃls
;

1300 
i
 = 0; i < 
sbªd
->
n_chªÃls
; i++) {

1301 
cf
 = 
sbªd
->
chªÃls
[
i
].
ûÁ”_äeq
;

1303 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
cf
);

1304 *
pos
++ = 1;

1306 
	`ADD_PRESENT_ELEM
(
WLAN_EID_SUPPORTED_CHANNELS
);

1310 
off£t
 = 
	`›“80211_add_befÜe_ht_–ems
(
skb
, 
exŒa_–ems
,

1311 
exŒa_–ems_Ën
,

1312 
off£t
);

1314 ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_6GHZ
 &&

1315 
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
) {

1316 
	`›“80211_add_ht_›
(
sd©a
, 
skb
,

1317 
assoc_d©a
->
lšk
[
lšk_id
].
­_ht_·¿m
,

1318 
sbªd
, 
chª
, 
smps_mode
,

1319 &
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
);

1320 
	`ADD_PRESENT_ELEM
(
WLAN_EID_HT_CAPABILITY
);

1324 
off£t
 = 
	`›“80211_add_befÜe_vht_–ems
(
skb
, 
exŒa_–ems
,

1325 
exŒa_–ems_Ën
,

1326 
off£t
);

1328 ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_6GHZ
 &&

1329 
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_VHT
 &&

1330 
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
) {

1331 
boŞ
 
mu_mimo_owÃr
 =

1332 
	`›“80211_add_vht_›
(
sd©a
, 
skb
, 
sbªd
,

1333 &
assoc_d©a
->
lšk
[
lšk_id
].
­_vht_ÿp
,

1334 &
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
);

1336 ià(
lšk
)

1337 
lšk
->
cÚf
->
mu_mimo_owÃr
 = mu_mimo_owner;

1338 
	`ADD_PRESENT_ELEM
(
WLAN_EID_VHT_CAPABILITY
);

1342 
off£t
 = 
	`›“80211_add_befÜe_he_–ems
(
skb
, 
exŒa_–ems
,

1343 
exŒa_–ems_Ën
,

1344 
off£t
);

1346 ià(
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HE
) {

1347 
	`›“80211_put_he_ÿp
(
skb
, 
sd©a
, 
sbªd
,

1348 &
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
);

1349 
	`ADD_PRESENT_EXT_ELEM
(
WLAN_EID_EXT_HE_CAPABILITY
);

1350 
	`›“80211_put_he_6ghz_ÿp
(
skb
, 
sd©a
, 
smps_mode
);

1358 ià(
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_EHT
)

1359 
	`ADD_PRESENT_EXT_ELEM
(
WLAN_EID_EXT_EHT_CAPABILITY
);

1361 ià(
lšk_id
 =ğ
assoc_d©a
->
assoc_lšk_id
)

1362 
	`›“80211_assoc_add_ml_–em
(
sd©a
, 
skb
, 
Üig_ÿ·b
, 
ext_ÿ·
,

1363 
´e£Á_–ems
);

1366 
´e£Á_–ems
 = 
NULL
;

1368 ià(
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_EHT
)

1369 
	`›“80211_put_eht_ÿp
(
skb
, 
sd©a
, 
sbªd
,

1370 &
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
);

1372 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

1373 
	`›“80211_add_aid_»que¡_›
(
sd©a
, 
skb
);

1374 
	`›“80211_add_s1g_ÿ·b_›
(
sd©a
, &
sbªd
->
s1g_ÿp
, 
skb
);

1377 ià(
iád
 && iád->
v’dÜ_–ems
.
d©a
 && iád->v’dÜ_–ems.
Ën
)

1378 
	`skb_put_d©a
(
skb
, 
iád
->
v’dÜ_–ems
.
d©a
, iád->v’dÜ_–ems.
Ën
);

1380  
off£t
;

1381 
	}
}

1383 
	$›“80211_add_nÚ_šh”™ªû_–em
(
sk_buff
 *
skb
,

1384 cÚ¡ 
u16
 *
ou‹r
,

1385 cÚ¡ 
u16
 *
šÃr
)

1387 
skb_Ën
 = 
skb
->
Ën
;

1388 
boŞ
 
©_ex‹nsiÚ
 = 
çl£
;

1389 
boŞ
 
added
 = 
çl£
;

1390 
i
, 
j
;

1391 
u8
 *
Ën
, *
li¡_Ën
 = 
NULL
;

1393 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXTENSION
);

1394 
Ën
 = 
	`skb_put
(
skb
, 1);

1395 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXT_NON_INHERITANCE
);

1397 
i
 = 0; i < 
PRESENT_ELEMS_MAX
 && 
ou‹r
[i]; i++) {

1398 
u16
 
–em
 = 
ou‹r
[
i
];

1399 
boŞ
 
have_šÃr
 = 
çl£
;

1402 
	`WARN_ON
(
©_ex‹nsiÚ
 && 
–em
 < 
PRESENT_ELEM_EXT_OFFS
);

1405 ià(!
©_ex‹nsiÚ
 && 
–em
 >ğ
PRESENT_ELEM_EXT_OFFS
) {

1406 
©_ex‹nsiÚ
 = 
Œue
;

1407 ià(!
li¡_Ën
)

1408 
	`skb_put_u8
(
skb
, 0);

1409 
li¡_Ën
 = 
NULL
;

1412 
j
 = 0; j < 
PRESENT_ELEMS_MAX
 && 
šÃr
[j]; j++) {

1413 ià(
–em
 =ğ
šÃr
[
j
]) {

1414 
have_šÃr
 = 
Œue
;

1419 ià(
have_šÃr
)

1422 ià(!
li¡_Ën
) {

1423 
li¡_Ën
 = 
	`skb_put
(
skb
, 1);

1424 *
li¡_Ën
 = 0;

1426 *
li¡_Ën
 += 1;

1427 
	`skb_put_u8
(
skb
, (
u8
)
–em
);

1428 
added
 = 
Œue
;

1432 ià(
added
 && (!
©_ex‹nsiÚ
 || !
li¡_Ën
))

1433 
	`skb_put_u8
(
skb
, 0);

1436 ià(!
added
)

1437 
	`skb_Œim
(
skb
, 
skb_Ën
);

1439 *
Ën
 = 
skb
->ËÀ- 
skb_Ën
 - 2;

1440 
	}
}

1442 
	$›“80211_assoc_add_ml_–em
(
›“80211_sub_if_d©a
 *
sd©a
,

1443 
sk_buff
 *
skb
, 
u16
 
ÿ·b
,

1444 cÚ¡ 
–em’t
 *
ext_ÿ·
,

1445 cÚ¡ 
u16
 *
ou‹r_´e£Á_–ems
)

1447 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1448 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

1449 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
ifmgd
->assoc_data;

1450 
›“80211_muÉi_lšk_–em
 *
ml_–em
;

1451 
›“80211_mË_basic_commÚ_šfo
 *
commÚ
;

1452 cÚ¡ 
why_iáy³_ext_ÿ·b
 *
iá_ext_ÿ·
;

1453 
__Ë16
 
eml_ÿ·
 = 0, 
mld_ÿ·_İs
 = 0;

1454 
lšk_id
;

1455 
u8
 *
ml_–em_Ën
;

1456 *
ÿ·b_pos
;

1458 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

1461 
iá_ext_ÿ·
 = 
	`cfg80211_g‘_iáy³_ext_ÿ·
(
loÿl
->
hw
.
why
,

1462 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
));

1463 ià(
iá_ext_ÿ·
) {

1464 
eml_ÿ·
 = 
	`ıu_to_Ë16
(
iá_ext_ÿ·
->
eml_ÿ·b™›s
);

1465 
mld_ÿ·_İs
 = 
	`ıu_to_Ë16
(
iá_ext_ÿ·
->
mld_ÿ·_ªd_İs
);

1468 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXTENSION
);

1469 
ml_–em_Ën
 = 
	`skb_put
(
skb
, 1);

1470 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXT_EHT_MULTI_LINK
);

1471 
ml_–em
 = 
	`skb_put
(
skb
, (*ml_elem));

1472 
ml_–em
->
cÚŒŞ
 =

1473 
	`ıu_to_Ë16
(
IEEE80211_ML_CONTROL_TYPE_BASIC
 |

1474 
IEEE80211_MLC_BASIC_PRES_MLD_CAPA_OP
);

1475 
commÚ
 = 
	`skb_put
(
skb
, (*common));

1476 
commÚ
->
Ën
 = (*common) +

1478 
	`memıy
(
commÚ
->
mld_mac_addr
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1481 ià(
eml_ÿ·
 &

1482 
	`ıu_to_Ë16
((
IEEE80211_EML_CAP_EMLSR_SUPP
 |

1483 
IEEE80211_EML_CAP_EMLMR_SUPPORT
))) {

1484 
commÚ
->
Ën
 += 2;

1485 
ml_–em
->
cÚŒŞ
 |=

1486 
	`ıu_to_Ë16
(
IEEE80211_MLC_BASIC_PRES_EML_CAPA
);

1487 
	`skb_put_d©a
(
skb
, &
eml_ÿ·
, (eml_capa));

1489 
	`skb_put_d©a
(
skb
, &
mld_ÿ·_İs
, (mld_capa_ops));

1491 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

1492 
u16
 
lšk_´e£Á_–ems
[
PRESENT_ELEMS_MAX
] = {};

1493 cÚ¡ 
u8
 *
exŒa_–ems
;

1494 
size_t
 
exŒa_–ems_Ën
;

1495 
size_t
 
exŒa_u£d
;

1496 
u8
 *
sub–em_Ën
 = 
NULL
;

1497 
__Ë16
 
ù¾
;

1499 ià(!
assoc_d©a
->
lšk
[
lšk_id
].
bss
 ||

1500 
lšk_id
 =ğ
assoc_d©a
->
assoc_lšk_id
)

1503 
exŒa_–ems
 = 
assoc_d©a
->
lšk
[
lšk_id
].
–ems
;

1504 
exŒa_–ems_Ën
 = 
assoc_d©a
->
lšk
[
lšk_id
].
–ems_Ën
;

1506 
	`skb_put_u8
(
skb
, 
IEEE80211_MLE_SUBELEM_PER_STA_PROFILE
);

1507 
sub–em_Ën
 = 
	`skb_put
(
skb
, 1);

1509 
ù¾
 = 
	`ıu_to_Ë16
(
lšk_id
 |

1510 
IEEE80211_MLE_STA_CONTROL_COMPLETE_PROFILE
 |

1511 
IEEE80211_MLE_STA_CONTROL_STA_MAC_ADDR_PRESENT
);

1512 
	`skb_put_d©a
(
skb
, &
ù¾
, (ctrl));

1513 
	`skb_put_u8
(
skb
, 1 + 
ETH_ALEN
);

1514 
	`skb_put_d©a
(
skb
, 
assoc_d©a
->
lšk
[
lšk_id
].
addr
,

1515 
ETH_ALEN
);

1524 
ÿ·b_pos
 = 
	`skb_put
(
skb
, 2);

1526 
exŒa_u£d
 = 
	`›“80211_assoc_lšk_–ems
(
sd©a
, 
skb
, &
ÿ·b
,

1527 
ext_ÿ·
,

1528 
exŒa_–ems
,

1529 
exŒa_–ems_Ën
,

1530 
lšk_id
, 
NULL
,

1531 
lšk_´e£Á_–ems
);

1532 ià(
exŒa_–ems
)

1533 
	`skb_put_d©a
(
skb
, 
exŒa_–ems
 + 
exŒa_u£d
,

1534 
exŒa_–ems_Ën
 - 
exŒa_u£d
);

1536 
	`put_uÇligÃd_Ë16
(
ÿ·b
, 
ÿ·b_pos
);

1538 
	`›“80211_add_nÚ_šh”™ªû_–em
(
skb
, 
ou‹r_´e£Á_–ems
,

1539 
lšk_´e£Á_–ems
);

1541 
	`›“80211_äagm’t_–em’t
(
skb
, 
sub–em_Ën
,

1542 
IEEE80211_MLE_SUBELEM_FRAGMENT
);

1545 
	`›“80211_äagm’t_–em’t
(
skb
, 
ml_–em_Ën
, 
WLAN_EID_FRAGMENT
);

1546 
	}
}

1548 
	$›“80211_£nd_assoc
(
›“80211_sub_if_d©a
 *
sd©a
)

1550 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1551 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

1552 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
ifmgd
->assoc_data;

1553 
›“80211_lšk_d©a
 *
lšk
;

1554 
sk_buff
 *
skb
;

1555 
›“80211_mgmt
 *
mgmt
;

1556 
u8
 *
pos
, 
qos_šfo
, *
›_¡¬t
;

1557 
size_t
 
off£t
, 
noff£t
;

1558 
u16
 
ÿ·b
 = 0, 
lšk_ÿ·b
;

1559 
__Ë16
 
li¡’_št
;

1560 
–em’t
 *
ext_ÿ·
 = 
NULL
;

1561 
Æ80211_iáy³
 
iáy³
 = 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
);

1562 
›“80211_´•_tx_šfo
 
šfo
 = {};

1563 
lšk_id
, 
n_lšks
 = 0;

1564 
u16
 
´e£Á_–ems
[
PRESENT_ELEMS_MAX
] = {};

1565 *
ÿ·b_pos
;

1566 
size_t
 
size
;

1567 
»t
;

1570 ià(
assoc_d©a
->
›_Ën
)

1571 
ext_ÿ·
 = (*)
	`cfg80211_fšd_–em
(
WLAN_EID_EXT_CAPABILITY
,

1572 
assoc_d©a
->
›
,

1573 
assoc_d©a
->
›_Ën
);

1575 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1577 
size
 = 
loÿl
->
hw
.
exŒa_tx_h—droom
 +

1578 (*
mgmt
) +

1579 2 + 
assoc_d©a
->
ssid_Ën
 +

1580 
assoc_d©a
->
›_Ën
 +

1581 (
assoc_d©a
->
fs_kek_Ën
 ? 16 : 0) +

1584 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

1585 
cfg80211_bss
 *
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

1586 cÚ¡ 
›“80211_sbªd_iáy³_d©a
 *
iád
;

1587 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1589 ià(!
cbss
)

1592 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
cbss
->
chªÃl
->
bªd
];

1594 
n_lšks
++;

1596 
size
 +ğ
assoc_d©a
->
lšk
[
lšk_id
].
–ems_Ën
;

1598 
size
 +ğ4 + 
sbªd
->
n_b™¿‹s
;

1600 
size
 +ğ2 + 2 * 
sbªd
->
n_chªÃls
;

1602 
iád
 = 
	`›“80211_g‘_sbªd_iáy³_d©a
(
sbªd
, 
iáy³
);

1603 ià(
iád
)

1604 
size
 +ğ
iád
->
v’dÜ_–ems
.
Ën
;

1607 
size
 += 4;

1610 
size
 +ğ2 + (
›“80211_ht_ÿp
);

1611 
size
 +ğ2 + (
›“80211_vht_ÿp
);

1612 
size
 +ğ2 + 1 + (
›“80211_he_ÿp_–em
) +

1613 (
›“80211_he_mcs_nss_suµ
) +

1614 
IEEE80211_HE_PPE_THRES_MAX_LEN
;

1616 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

1617 
size
 +ğ2 + 1 + (
›“80211_he_6ghz_ÿ·
);

1619 
size
 +ğ2 + 1 + (
›“80211_eht_ÿp_–em
) +

1620 (
›“80211_eht_mcs_nss_suµ
) +

1621 
IEEE80211_EHT_PPE_THRES_MAX_LEN
;

1624 
size
 +ğ2 + 2 + 
PRESENT_ELEMS_MAX
;

1627 ià(
cbss
->
ÿ·b™y
 & 
WLAN_CAPABILITY_PRIVACY
)

1628 
ÿ·b
 |ğ
WLAN_CAPABILITY_PRIVACY
;

1631 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

1633 
size
 +ğ(
›“80211_muÉi_lšk_–em
);

1635 
size
 +ğ(
›“80211_mË_basic_commÚ_šfo
) +

1644 
size
 +ğ(
n_lšks
 - 1) *

1647 1 + 
ETH_ALEN
 + 2 );

1650 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
assoc_d©a
->
assoc_lšk_id
], sdata);

1651 ià(
	`WARN_ON
(!
lšk
))

1652  -
EINVAL
;

1654 ià(
	`WARN_ON
(!
assoc_d©a
->
lšk
[assoc_d©a->
assoc_lšk_id
].
bss
))

1655  -
EINVAL
;

1657 
skb
 = 
	`®loc_skb
(
size
, 
GFP_KERNEL
);

1658 ià(!
skb
)

1659  -
ENOMEM
;

1661 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

1663 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_ENABLE_RRM
)

1664 
ÿ·b
 |ğ
WLAN_CAPABILITY_RADIO_MEASURE
;

1667 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_ONLY_HE_MULTI_BSSID
) &&

1668 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HE
 &&

1669 
ext_ÿ·
 &&ƒxt_ÿ·->
d©®’
 >= 3)

1670 
ext_ÿ·
->
d©a
[2] |ğ
WLAN_EXT_CAPA3_MULTI_BSSID_SUPPORT
;

1672 
mgmt
 = 
	`skb_put_z”o
(
skb
, 24);

1673 
	`memıy
(
mgmt
->
da
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

1674 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1675 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

1677 
li¡’_št
 = 
	`ıu_to_Ë16
(
assoc_d©a
->
s1g
 ?

1678 
	`›“80211_’code_usf
(
loÿl
->
hw
.
cÚf
.
li¡’_š‹rv®
) :

1679 
loÿl
->
hw
.
cÚf
.
li¡’_š‹rv®
);

1680 ià(!
	`is_z”o_‘h”_addr
(
assoc_d©a
->
´ev_­_addr
)) {

1681 
	`skb_put
(
skb
, 10);

1682 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

1683 
IEEE80211_STYPE_REASSOC_REQ
);

1684 
ÿ·b_pos
 = &
mgmt
->
u
.
»assoc_»q
.
ÿ·b_šfo
;

1685 
mgmt
->
u
.
»assoc_»q
.
li¡’_š‹rv®
 = 
li¡’_št
;

1686 
	`memıy
(
mgmt
->
u
.
»assoc_»q
.
cu¼’t_­
,

1687 
assoc_d©a
->
´ev_­_addr
, 
ETH_ALEN
);

1688 
šfo
.
subty³
 = 
IEEE80211_STYPE_REASSOC_REQ
;

1690 
	`skb_put
(
skb
, 4);

1691 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

1692 
IEEE80211_STYPE_ASSOC_REQ
);

1693 
ÿ·b_pos
 = &
mgmt
->
u
.
assoc_»q
.
ÿ·b_šfo
;

1694 
mgmt
->
u
.
assoc_»q
.
li¡’_š‹rv®
 = 
li¡’_št
;

1695 
šfo
.
subty³
 = 
IEEE80211_STYPE_ASSOC_REQ
;

1699 
pos
 = 
	`skb_put
(
skb
, 2 + 
assoc_d©a
->
ssid_Ën
);

1700 
›_¡¬t
 = 
pos
;

1701 *
pos
++ = 
WLAN_EID_SSID
;

1702 *
pos
++ = 
assoc_d©a
->
ssid_Ën
;

1703 
	`memıy
(
pos
, 
assoc_d©a
->
ssid
,‡ssoc_d©a->
ssid_Ën
);

1713 ià(
lšk
->
u
.
mgd
.
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_EHT
)

1714 
ÿ·b
 |ğ
WLAN_CAPABILITY_ESS
;

1717 
lšk_ÿ·b
 = 
ÿ·b
;

1718 
off£t
 = 
	`›“80211_assoc_lšk_–ems
(
sd©a
, 
skb
, &
lšk_ÿ·b
,

1719 
ext_ÿ·
,

1720 
assoc_d©a
->
›
,

1721 
assoc_d©a
->
›_Ën
,

1722 
assoc_d©a
->
assoc_lšk_id
, 
lšk
,

1723 
´e£Á_–ems
);

1724 
	`put_uÇligÃd_Ë16
(
lšk_ÿ·b
, 
ÿ·b_pos
);

1727 ià(
assoc_d©a
->
›_Ën
) {

1728 
noff£t
 = 
	`›“80211_›_¥l™_v’dÜ
(
assoc_d©a
->
›
,

1729 
assoc_d©a
->
›_Ën
,

1730 
off£t
);

1731 
	`skb_put_d©a
(
skb
, 
assoc_d©a
->
›
 + 
off£t
, 
noff£t
 - offset);

1732 
off£t
 = 
noff£t
;

1735 ià(
assoc_d©a
->
wmm
) {

1736 ià(
assoc_d©a
->
u­sd
) {

1737 
qos_šfo
 = 
ifmgd
->
u­sd_queues
;

1738 
qos_šfo
 |ğ(
ifmgd
->
u­sd_max_¥_Ën
 <<

1739 
IEEE80211_WMM_IE_STA_QOSINFO_SP_SHIFT
);

1741 
qos_šfo
 = 0;

1744 
pos
 = 
	`›“80211_add_wmm_šfo_›
(
	`skb_put
(
skb
, 9), 
qos_šfo
);

1748 ià(
assoc_d©a
->
›_Ën
) {

1749 
noff£t
 = 
assoc_d©a
->
›_Ën
;

1750 
	`skb_put_d©a
(
skb
, 
assoc_d©a
->
›
 + 
off£t
, 
noff£t
 - offset);

1753 ià(
assoc_d©a
->
fs_kek_Ën
) {

1754 
»t
 = 
	`fs_’üy±_assoc_»q
(
skb
, 
assoc_d©a
);

1755 ià(
»t
 < 0) {

1756 
	`dev_kä“_skb
(
skb
);

1757  
»t
;

1761 
pos
 = 
	`skb__poš‹r
(
skb
);

1762 
	`kä“
(
ifmgd
->
assoc_»q_›s
);

1763 
ifmgd
->
assoc_»q_›s
 = 
	`kmemdup
(
›_¡¬t
, 
pos
 - ie_¡¬t, 
GFP_ATOMIC
);

1764 ià(!
ifmgd
->
assoc_»q_›s
) {

1765 
	`dev_kä“_skb
(
skb
);

1766  -
ENOMEM
;

1769 
ifmgd
->
assoc_»q_›s_Ën
 = 
pos
 - 
›_¡¬t
;

1771 
šfo
.
lšk_id
 = 
assoc_d©a
->
assoc_lšk_id
;

1772 
	`drv_mgd_´•¬e_tx
(
loÿl
, 
sd©a
, &
šfo
);

1774 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1775 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
))

1776 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
 |

1777 
IEEE80211_TX_INTFL_MLME_CONN_TX
;

1778 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1781 
	}
}

1783 
	$›“80211_£nd_p¥Şl
(
›“80211_loÿl
 *
loÿl
,

1784 
›“80211_sub_if_d©a
 *
sd©a
)

1786 
›“80211_p¥Şl
 *
p¥Şl
;

1787 
sk_buff
 *
skb
;

1789 
skb
 = 
	`›“80211_p¥Şl_g‘
(&
loÿl
->
hw
, &
sd©a
->
vif
);

1790 ià(!
skb
)

1793 
p¥Şl
 = (
›“80211_p¥Şl
 *è
skb
->
d©a
;

1794 
p¥Şl
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PM
);

1796 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1797 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1798 
	}
}

1800 
	$›“80211_£nd_nuÎfunc
(
›“80211_loÿl
 *
loÿl
,

1801 
›“80211_sub_if_d©a
 *
sd©a
,

1802 
boŞ
 
pow”§ve
)

1804 
sk_buff
 *
skb
;

1805 
›“80211_hdr_3addr
 *
nuÎfunc
;

1806 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

1808 
skb
 = 
	`›“80211_nuÎfunc_g‘
(&
loÿl
->
hw
, &
sd©a
->
vif
, -1,

1809 !
	`›“80211_hw_check
(&
loÿl
->
hw
,

1810 
DOESNT_SUPPORT_QOS_NDP
));

1811 ià(!
skb
)

1814 
nuÎfunc
 = (
›“80211_hdr_3addr
 *è
skb
->
d©a
;

1815 ià(
pow”§ve
)

1816 
nuÎfunc
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PM
);

1818 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
 |

1819 
IEEE80211_TX_INTFL_OFFCHAN_TX_OK
;

1821 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
))

1822 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

1824 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_CONNECTION_POLL
)

1825 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_CTL_USE_MINRATE
;

1827 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1828 
	}
}

1830 
	$›“80211_£nd_4addr_nuÎfunc
(
›“80211_loÿl
 *
loÿl
,

1831 
›“80211_sub_if_d©a
 *
sd©a
)

1833 
sk_buff
 *
skb
;

1834 
›“80211_hdr
 *
nuÎfunc
;

1835 
__Ë16
 
fc
;

1837 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
))

1840 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 30);

1841 ià(!
skb
)

1844 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

1846 
nuÎfunc
 = 
	`skb_put_z”o
(
skb
, 30);

1847 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_NULLFUNC
 |

1848 
IEEE80211_FCTL_FROMDS
 | 
IEEE80211_FCTL_TODS
);

1849 
nuÎfunc
->
äame_cÚŒŞ
 = 
fc
;

1850 
	`memıy
(
nuÎfunc
->
addr1
, 
sd©a
->
deæšk
.
u
.
mgd
.
bssid
, 
ETH_ALEN
);

1851 
	`memıy
(
nuÎfunc
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1852 
	`memıy
(
nuÎfunc
->
addr3
, 
sd©a
->
deæšk
.
u
.
mgd
.
bssid
, 
ETH_ALEN
);

1853 
	`memıy
(
nuÎfunc
->
addr4
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1855 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1856 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_CTL_USE_MINRATE
;

1857 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1858 
	}
}

1861 
	$›“80211_chsw™ch_wÜk
(
why
 *wiphy,

1862 
why_wÜk
 *
wÜk
)

1864 
›“80211_lšk_d©a
 *
lšk
 =

1865 
	`cÚš”_of
(
wÜk
, 
›“80211_lšk_d©a
,

1866 
u
.
mgd
.
chsw™ch_wÜk
.
wÜk
);

1867 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1868 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1869 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

1870 
»t
;

1872 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1875 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1877 ià(!
ifmgd
->
assocŸ‹d
)

1880 ià(!
lšk
->
cÚf
->
c§_aùive
)

1890 ià(
lšk
->
»£rved_chªùx
) {

1896 ià(
lšk
->
»£rved_»ady
)

1899 
»t
 = 
	`›“80211_lšk_u£_»£rved_cÚ‹xt
(
lšk
);

1900 ià(
»t
) {

1901 
	`sd©a_šfo
(
sd©a
,

1903 
»t
);

1904 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1905 &
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
);

1910 ià(!
	`›“80211_chª»q_id’tiÿl
(&
lšk
->
cÚf
->
chª»q
,

1911 &
lšk
->
c§_chª»q
)) {

1912 
	`sd©a_šfo
(
sd©a
,

1914 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1915 &
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
);

1919 
lšk
->
u
.
mgd
.
c§_wa™šg_bú
 = 
Œue
;

1921 
	`›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
sd©a
);

1922 
	`›“80211_¡a_»£t_cÚn_mÚ™Ü
(
sd©a
);

1923 
	}
}

1925 
	$›“80211_chsw™ch_po¡_b—cÚ
(
›“80211_lšk_d©a
 *
lšk
)

1927 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1928 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1929 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

1930 
»t
;

1932 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1934 
	`WARN_ON
(!
lšk
->
cÚf
->
c§_aùive
);

1936 ià(
sd©a
->
c§_blocked_tx
) {

1937 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

1938 
IEEE80211_QUEUE_STOP_REASON_CSA
);

1939 
sd©a
->
c§_blocked_tx
 = 
çl£
;

1942 
lšk
->
cÚf
->
c§_aùive
 = 
çl£
;

1943 
lšk
->
u
.
mgd
.
c§_wa™šg_bú
 = 
çl£
;

1945 
»t
 = 
	`drv_po¡_chªÃl_sw™ch
(
lšk
);

1946 ià(
»t
) {

1947 
	`sd©a_šfo
(
sd©a
,

1949 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1950 &
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
);

1954 
	`cfg80211_ch_sw™ch_nÙify
(
sd©a
->
dev
, &
lšk
->
»£rved
.
İ”
,

1955 
lšk
->
lšk_id
);

1956 
	}
}

1958 
	$›“80211_chsw™ch_dÚe
(
›“80211_vif
 *
vif
, 
boŞ
 
sucûss
,

1959 
lšk_id
)

1961 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1963 
	`Œaû_­i_chsw™ch_dÚe
(
sd©a
, 
sucûss
, 
lšk_id
);

1965 
	`rcu_»ad_lock
();

1967 ià(!
sucûss
) {

1968 
	`sd©a_šfo
(
sd©a
,

1970 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1971 &
sd©a
->
u
.
mgd
.
c§_cÚÃùiÚ_drİ_wÜk
);

1973 
›“80211_lšk_d©a
 *
lšk
 =

1974 
	`rcu_d”eã»nû
(
sd©a
->
lšk
[
lšk_id
]);

1976 ià(
	`WARN_ON
(!
lšk
)) {

1977 
	`rcu_»ad_uÆock
();

1981 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1982 &
lšk
->
u
.
mgd
.
chsw™ch_wÜk
, 0);

1985 
	`rcu_»ad_uÆock
();

1986 
	}
}

1987 
EXPORT_SYMBOL
(
›“80211_chsw™ch_dÚe
);

1990 
	$›“80211_¡a_abÜt_chªsw™ch
(
›“80211_lšk_d©a
 *
lšk
)

1992 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

1993 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1995 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1997 ià(!
loÿl
->
İs
->
abÜt_chªÃl_sw™ch
)

2000 
	`›“80211_lšk_uÄe£rve_chªùx
(
lšk
);

2002 ià(
sd©a
->
c§_blocked_tx
) {

2003 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

2004 
IEEE80211_QUEUE_STOP_REASON_CSA
);

2005 
sd©a
->
c§_blocked_tx
 = 
çl£
;

2008 
lšk
->
cÚf
->
c§_aùive
 = 
çl£
;

2010 
	`drv_abÜt_chªÃl_sw™ch
(
lšk
);

2011 
	}
}

2014 
	$›“80211_¡a_´oûss_chªsw™ch
(
›“80211_lšk_d©a
 *
lšk
,

2015 
u64
 
time¡amp
, 
u32
 
deviû_time¡amp
,

2016 
›“802_11_–ems
 *
–ems
,

2017 
boŞ
 
b—cÚ
)

2019 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2020 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2021 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

2022 
cfg80211_bss
 *
cbss
 = 
lšk
->
cÚf
->
bss
;

2023 
›“80211_chªùx_cÚf
 *
cÚf
;

2024 
›“80211_chªùx
 *
chªùx
;

2025 
Æ80211_bªd
 
cu¼’t_bªd
;

2026 
›“80211_c§_›
 
c§_›
;

2027 
›“80211_chªÃl_sw™ch
 
ch_sw™ch
 = {

2028 .
lšk_id
 = 
lšk
->link_id,

2030 
›“80211_bss
 *
bss
;

2031 
timeout
;

2032 
»s
;

2034 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2036 ià(!
cbss
)

2039 
cu¼’t_bªd
 = 
cbss
->
chªÃl
->
bªd
;

2040 
bss
 = (*)
cbss
->
´iv
;

2041 
»s
 = 
	`›“80211_·r£_ch_sw™ch_›
(
sd©a
, 
–ems
, 
cu¼’t_bªd
,

2042 
bss
->
vht_ÿp_šfo
,

2043 &
lšk
->
u
.
mgd
.
cÚn
,

2044 
lšk
->
u
.
mgd
.
bssid
, &
c§_›
);

2046 ià(!
»s
) {

2047 
ch_sw™ch
.
time¡amp
 =imestamp;

2048 
ch_sw™ch
.
deviû_time¡amp
 = device_timestamp;

2049 
ch_sw™ch
.
block_tx
 = 
c§_›
.
mode
;

2050 
ch_sw™ch
.
chªdef
 = 
c§_›
.
chª»q
.
İ”
;

2051 
ch_sw™ch
.
couÁ
 = 
c§_›
.count;

2052 
ch_sw™ch
.
d–ay
 = 
c§_›
.
max_sw™ch_time
;

2055 ià(
»s
 < 0)

2056 
drİ_cÚÃùiÚ
;

2058 ià(
lšk
->
cÚf
->
c§_aùive
) {

2060 ià(!
b—cÚ
)

2063 ià(
lšk
->
u
.
mgd
.
c§_wa™šg_bú
) {

2064 
	`›“80211_chsw™ch_po¡_b—cÚ
(
lšk
);

2071 } ià(
»s
) {

2072 
	`›“80211_¡a_abÜt_chªsw™ch
(
lšk
);

2075 
	`drv_chªÃl_sw™ch_rx_b—cÚ
(
sd©a
, &
ch_sw™ch
);

2081 ià(
»s
)

2084 ià(
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
->
bªd
 !=

2085 
c§_›
.
chª»q
.
İ”
.
chª
->
bªd
) {

2086 
	`sd©a_šfo
(
sd©a
,

2088 
lšk
->
u
.
mgd
.
bssid
,

2089 
c§_›
.
chª»q
.
İ”
.
chª
->
ûÁ”_äeq
,

2090 
c§_›
.
chª»q
.
İ”
.
width
,

2091 
c§_›
.
chª»q
.
İ”
.
ûÁ”_äeq1
,

2092 
c§_›
.
chª»q
.
İ”
.
ûÁ”_äeq2
);

2093 
drİ_cÚÃùiÚ
;

2096 ià(!
	`cfg80211_chªdef_u§bË
(
loÿl
->
hw
.
why
, &
c§_›
.
chª»q
.
İ”
,

2097 
IEEE80211_CHAN_DISABLED
)) {

2098 
	`sd©a_šfo
(
sd©a
,

2102 
lšk
->
u
.
mgd
.
bssid
,

2103 
c§_›
.
chª»q
.
İ”
.
chª
->
ûÁ”_äeq
,

2104 
c§_›
.
chª»q
.
İ”
.
chª
->
äeq_off£t
,

2105 
c§_›
.
chª»q
.
İ”
.
width
,

2106 
c§_›
.
chª»q
.
İ”
.
ûÁ”_äeq1
,

2107 
c§_›
.
chª»q
.
İ”
.
äeq1_off£t
,

2108 
c§_›
.
chª»q
.
İ”
.
ûÁ”_äeq2
);

2109 
drİ_cÚÃùiÚ
;

2112 ià(
	`cfg80211_chªdef_id’tiÿl
(&
c§_›
.
chª»q
.
İ”
,

2113 &
lšk
->
cÚf
->
chª»q
.
İ”
) &&

2114 (!
c§_›
.
mode
 || !
b—cÚ
)) {

2115 ià(
lšk
->
u
.
mgd
.
c§_ignÜed_§me_chª
)

2117 
	`sd©a_šfo
(
sd©a
,

2119 
lšk
->
u
.
mgd
.
bssid
);

2120 
lšk
->
u
.
mgd
.
c§_ignÜed_§me_chª
 = 
Œue
;

2131 
	`›“80211_‹¬down_tdls_³”s
(
lšk
);

2133 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk
->cÚf->
chªùx_cÚf
,

2134 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

2135 ià(!
cÚf
) {

2136 
	`sd©a_šfo
(
sd©a
,

2138 
drİ_cÚÃùiÚ
;

2141 
chªùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

2143 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
CHANCTX_STA_CSA
)) {

2144 
	`sd©a_šfo
(
sd©a
,

2146 
drİ_cÚÃùiÚ
;

2149 ià(
	`drv_´e_chªÃl_sw™ch
(
sd©a
, &
ch_sw™ch
)) {

2150 
	`sd©a_šfo
(
sd©a
,

2152 
drİ_cÚÃùiÚ
;

2155 
»s
 = 
	`›“80211_lšk_»£rve_chªùx
(
lšk
, &
c§_›
.
chª»q
,

2156 
chªùx
->
mode
, 
çl£
);

2157 ià(
»s
) {

2158 
	`sd©a_šfo
(
sd©a
,

2160 
»s
);

2161 
drİ_cÚÃùiÚ
;

2164 
lšk
->
cÚf
->
c§_aùive
 = 
Œue
;

2165 
lšk
->
c§_chª»q
 = 
c§_›
.
chª»q
;

2166 
lšk
->
u
.
mgd
.
c§_ignÜed_§me_chª
 = 
çl£
;

2167 
lšk
->
u
.
mgd
.
b—cÚ_üc_v®id
 = 
çl£
;

2169 ià(
c§_›
.
mode
 &&

2170 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HANDLES_QUIET_CSA
)) {

2171 
	`›“80211_¡İ_vif_queues
(
loÿl
, 
sd©a
,

2172 
IEEE80211_QUEUE_STOP_REASON_CSA
);

2173 
sd©a
->
c§_blocked_tx
 = 
Œue
;

2176 
	`cfg80211_ch_sw™ch_¡¬‹d_nÙify
(
sd©a
->
dev
, &
c§_›
.
chª»q
.
İ”
,

2177 
lšk
->
lšk_id
, 
c§_›
.
couÁ
,

2178 
c§_›
.
mode
);

2180 ià(
loÿl
->
İs
->
chªÃl_sw™ch
) {

2182 
	`drv_chªÃl_sw™ch
(
loÿl
, 
sd©a
, &
ch_sw™ch
);

2187 
timeout
 = 
	`TU_TO_JIFFIES
((
	`max_t
(, 
c§_›
.
couÁ
, 1) - 1) *

2188 
cbss
->
b—cÚ_š‹rv®
);

2189 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
,

2190 &
lšk
->
u
.
mgd
.
chsw™ch_wÜk
,

2191 
timeout
);

2193 
drİ_cÚÃùiÚ
:

2201 
lšk
->
cÚf
->
c§_aùive
 = 
Œue
;

2202 
sd©a
->
c§_blocked_tx
 =

2203 
c§_›
.
mode
 && !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HANDLES_QUIET_CSA
);

2205 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

2206 &
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
);

2207 
	}
}

2209 
boŞ


2210 
	$›“80211_fšd_80211h_pwr_cÚ¡r
(
›“80211_sub_if_d©a
 *
sd©a
,

2211 
›“80211_chªÃl
 *
chªÃl
,

2212 cÚ¡ 
u8
 *
couÁry_›
, u8 
couÁry_›_Ën
,

2213 cÚ¡ 
u8
 *
pwr_cÚ¡r_–em
,

2214 *
chª_pwr
, *
pwr_»duùiÚ
)

2216 
›“80211_couÁry_›_ŒËt
 *
ŒËt
;

2217 
chª
 = 
	`›“80211_äequ’cy_to_chªÃl
(
chªÃl
->
ûÁ”_äeq
);

2218 
i
, 
chª_šüem’t
;

2219 
boŞ
 
have_chª_pwr
 = 
çl£
;

2222 ià(
couÁry_›_Ën
 % 2 || couÁry_›_ËÀ< 
IEEE80211_COUNTRY_IE_MIN_LEN
)

2223  
çl£
;

2225 
ŒËt
 = (*)(
couÁry_›
 + 3);

2226 
couÁry_›_Ën
 -= 3;

2228 
chªÃl
->
bªd
) {

2230 
	`WARN_ON_ONCE
(1);

2231 
çÎthrough
;

2232 
NL80211_BAND_2GHZ
:

2233 
NL80211_BAND_60GHZ
:

2234 
NL80211_BAND_LC
:

2235 
chª_šüem’t
 = 1;

2237 
NL80211_BAND_5GHZ
:

2238 
chª_šüem’t
 = 4;

2240 
NL80211_BAND_6GHZ
:

2248  
çl£
;

2252 
couÁry_›_Ën
 >= 3) {

2253 
u8
 
fœ¡_chªÃl
 = 
ŒËt
->
chªs
.first_channel;

2255 ià(
fœ¡_chªÃl
 >ğ
IEEE80211_COUNTRY_EXTENSION_ID
)

2256 
Ãxt
;

2258 
i
 = 0; i < 
ŒËt
->
chªs
.
num_chªÃls
; i++) {

2259 ià(
fœ¡_chªÃl
 + 
i
 * 
chª_šüem’t
 =ğ
chª
) {

2260 
have_chª_pwr
 = 
Œue
;

2261 *
chª_pwr
 = 
ŒËt
->
chªs
.
max_pow”
;

2265 ià(
have_chª_pwr
)

2268 
Ãxt
:

2269 
ŒËt
++;

2270 
couÁry_›_Ën
 -= 3;

2273 ià(
have_chª_pwr
 && 
pwr_cÚ¡r_–em
)

2274 *
pwr_»duùiÚ
 = *
pwr_cÚ¡r_–em
;

2276 *
pwr_»duùiÚ
 = 0;

2278  
have_chª_pwr
;

2279 
	}
}

2281 
	$›“80211_fšd_cisco_dc
(
›“80211_sub_if_d©a
 *
sd©a
,

2282 
›“80211_chªÃl
 *
chªÃl
,

2283 cÚ¡ 
u8
 *
cisco_dc_›
,

2284 *
pwr_Ëv–
)

2292 *
pwr_Ëv–
 = (
__s8
)
cisco_dc_›
[4];

2293 
	}
}

2295 
u64
 
	$›“80211_hªdË_pwr_cÚ¡r
(
›“80211_lšk_d©a
 *
lšk
,

2296 
›“80211_chªÃl
 *
chªÃl
,

2297 
›“80211_mgmt
 *
mgmt
,

2298 cÚ¡ 
u8
 *
couÁry_›
, u8 
couÁry_›_Ën
,

2299 cÚ¡ 
u8
 *
pwr_cÚ¡r_›
,

2300 cÚ¡ 
u8
 *
cisco_dc_›
)

2302 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2303 
boŞ
 
has_80211h_pwr
 = 
çl£
, 
has_cisco_pwr
 = false;

2304 
chª_pwr
 = 0, 
pwr_»duùiÚ_80211h
 = 0;

2305 
pwr_Ëv–_cisco
, 
pwr_Ëv–_80211h
;

2306 
Ãw_­_Ëv–
;

2307 
__Ë16
 
ÿ·b
 = 
mgmt
->
u
.
´obe_»¥
.
ÿ·b_šfo
;

2309 ià(
	`›“80211_is_s1g_b—cÚ
(
mgmt
->
äame_cÚŒŞ
))

2312 ià(
couÁry_›
 &&

2313 (
ÿ·b
 & 
	`ıu_to_Ë16
(
WLAN_CAPABILITY_SPECTRUM_MGMT
) ||

2314 
ÿ·b
 & 
	`ıu_to_Ë16
(
WLAN_CAPABILITY_RADIO_MEASURE
))) {

2315 
has_80211h_pwr
 = 
	`›“80211_fšd_80211h_pwr_cÚ¡r
(

2316 
sd©a
, 
chªÃl
, 
couÁry_›
, 
couÁry_›_Ën
,

2317 
pwr_cÚ¡r_›
, &
chª_pwr
, &
pwr_»duùiÚ_80211h
);

2318 
pwr_Ëv–_80211h
 =

2319 
	`max_t
(, 0, 
chª_pwr
 - 
pwr_»duùiÚ_80211h
);

2322 ià(
cisco_dc_›
) {

2323 
	`›“80211_fšd_cisco_dc
(

2324 
sd©a
, 
chªÃl
, 
cisco_dc_›
, &
pwr_Ëv–_cisco
);

2325 
has_cisco_pwr
 = 
Œue
;

2328 ià(!
has_80211h_pwr
 && !
has_cisco_pwr
)

2334 ià(
has_80211h_pwr
 &&

2335 (!
has_cisco_pwr
 || 
pwr_Ëv–_80211h
 <ğ
pwr_Ëv–_cisco
)) {

2336 
Ãw_­_Ëv–
 = 
pwr_Ëv–_80211h
;

2338 ià(
lšk
->
­_pow”_Ëv–
 =ğ
Ãw_­_Ëv–
)

2341 
	`sd©a_dbg
(
sd©a
,

2343 
pwr_Ëv–_80211h
, 
chª_pwr
, 
pwr_»duùiÚ_80211h
,

2344 
lšk
->
u
.
mgd
.
bssid
);

2346 
Ãw_­_Ëv–
 = 
pwr_Ëv–_cisco
;

2348 ià(
lšk
->
­_pow”_Ëv–
 =ğ
Ãw_­_Ëv–
)

2351 
	`sd©a_dbg
(
sd©a
,

2353 
pwr_Ëv–_cisco
, 
lšk
->
u
.
mgd
.
bssid
);

2356 
lšk
->
­_pow”_Ëv–
 = 
Ãw_­_Ëv–
;

2357 ià(
	`__›“80211_»ÿlc_txpow”
(
sd©a
))

2358  
BSS_CHANGED_TXPOWER
;

2360 
	}
}

2363 
	$›“80211_’abË_ps
(
›“80211_loÿl
 *
loÿl
,

2364 
›“80211_sub_if_d©a
 *
sd©a
)

2366 
›“80211_cÚf
 *
cÚf
 = &
loÿl
->
hw
.conf;

2372 ià(
loÿl
->
sÿÂšg
)

2375 ià(
cÚf
->
dyÇmic_ps_timeout
 > 0 &&

2376 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
)) {

2377 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

2378 
	`m£cs_to_jiff›s
(
cÚf
->
dyÇmic_ps_timeout
));

2380 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
))

2381 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
Œue
);

2383 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
) &&

2384 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
))

2387 
cÚf
->
æags
 |ğ
IEEE80211_CONF_PS
;

2388 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

2390 
	}
}

2392 
	$›“80211_chªge_ps
(
›“80211_loÿl
 *
loÿl
)

2394 
›“80211_cÚf
 *
cÚf
 = &
loÿl
->
hw
.conf;

2396 ià(
loÿl
->
ps_sd©a
) {

2397 
	`›“80211_’abË_ps
(
loÿl
,†oÿl->
ps_sd©a
);

2398 } ià(
cÚf
->
æags
 & 
IEEE80211_CONF_PS
) {

2399 
cÚf
->
æags
 &ğ~
IEEE80211_CONF_PS
;

2400 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

2401 
	`d–_tim”_sync
(&
loÿl
->
dyÇmic_ps_tim”
);

2402 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
,

2403 &
loÿl
->
dyÇmic_ps_’abË_wÜk
);

2405 
	}
}

2407 
boŞ
 
	$›“80211_pow”§ve_®lowed
(
›“80211_sub_if_d©a
 *
sd©a
)

2409 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2410 
›“80211_if_mªaged
 *
mgd
 = &
sd©a
->
u
.mgd;

2411 
¡a_šfo
 *
¡a
 = 
NULL
;

2412 
boŞ
 
authÜized
 = 
çl£
;

2414 ià(!
mgd
->
pow”§ve
)

2415  
çl£
;

2417 ià(
mgd
->
brok’_­
)

2418  
çl£
;

2420 ià(!
mgd
->
assocŸ‹d
)

2421  
çl£
;

2423 ià(
mgd
->
æags
 & 
IEEE80211_STA_CONNECTION_POLL
)

2424  
çl£
;

2426 ià(!(
loÿl
->
hw
.
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_MLO
) &&

2427 !
sd©a
->
deæšk
.
u
.
mgd
.
have_b—cÚ
)

2428  
çl£
;

2430 
	`rcu_»ad_lock
();

2431 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
vif
.
cfg
.
­_addr
);

2432 ià(
¡a
)

2433 
authÜized
 = 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
);

2434 
	`rcu_»ad_uÆock
();

2436  
authÜized
;

2437 
	}
}

2440 
	$›“80211_»ÿlc_ps
(
›“80211_loÿl
 *
loÿl
)

2442 
›“80211_sub_if_d©a
 *
sd©a
, *
found
 = 
NULL
;

2443 
couÁ
 = 0;

2444 
timeout
;

2446 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_PS
) ||

2447 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
)) {

2448 
loÿl
->
ps_sd©a
 = 
NULL
;

2452 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2453 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

2455 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

2460 
couÁ
 = 0;

2463 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

2465 
found
 = 
sd©a
;

2466 
couÁ
++;

2469 ià(
couÁ
 =ğ1 && 
	`›“80211_pow”§ve_®lowed
(
found
)) {

2470 
u8
 
dtim³r
 = 
found
->
deæšk
.
u
.
mgd
.
dtim_³riod
;

2472 
timeout
 = 
loÿl
->
dyÇmic_ps_fÜûd_timeout
;

2473 ià(
timeout
 < 0)

2474 
timeout
 = 100;

2475 
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
 = 
timeout
;

2478 ià(!
dtim³r
)

2479 
dtim³r
 = 1;

2481 
loÿl
->
hw
.
cÚf
.
ps_dtim_³riod
 = 
dtim³r
;

2482 
loÿl
->
ps_sd©a
 = 
found
;

2484 
loÿl
->
ps_sd©a
 = 
NULL
;

2487 
	`›“80211_chªge_ps
(
loÿl
);

2488 
	}
}

2490 
	$›“80211_»ÿlc_ps_vif
(
›“80211_sub_if_d©a
 *
sd©a
)

2492 
boŞ
 
ps_®lowed
 = 
	`›“80211_pow”§ve_®lowed
(
sd©a
);

2494 ià(
sd©a
->
vif
.
cfg
.
ps
 !ğ
ps_®lowed
) {

2495 
sd©a
->
vif
.
cfg
.
ps
 = 
ps_®lowed
;

2496 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_PS
);

2498 
	}
}

2500 
	$›“80211_dyÇmic_ps_di§bË_wÜk
(
why
 *wiphy,

2501 
why_wÜk
 *
wÜk
)

2503 
›“80211_loÿl
 *
loÿl
 =

2504 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
,

2505 
dyÇmic_ps_di§bË_wÜk
);

2507 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
) {

2508 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_PS
;

2509 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

2512 
	`›“80211_wake_queues_by_»asÚ
(&
loÿl
->
hw
,

2513 
IEEE80211_MAX_QUEUE_MAP
,

2514 
IEEE80211_QUEUE_STOP_REASON_PS
,

2515 
çl£
);

2516 
	}
}

2518 
	$›“80211_dyÇmic_ps_’abË_wÜk
(
why
 *wiphy,

2519 
why_wÜk
 *
wÜk
)

2521 
›“80211_loÿl
 *
loÿl
 =

2522 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
,

2523 
dyÇmic_ps_’abË_wÜk
);

2524 
›“80211_sub_if_d©a
 *
sd©a
 = 
loÿl
->
ps_sd©a
;

2525 
›“80211_if_mªaged
 *
ifmgd
;

2526 
æags
;

2527 
q
;

2530 ià(!
sd©a
)

2533 
ifmgd
 = &
sd©a
->
u
.
mgd
;

2535 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
)

2538 ià(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
 > 0) {

2540 ià(
	`drv_tx_äames_³ndšg
(
loÿl
)) {

2541 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

2542 
	`m£cs_to_jiff›s
(

2543 
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
));

2552 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

2553 
q
 = 0; q < 
loÿl
->
hw
.
queues
; q++) {

2554 ià(
loÿl
->
queue_¡İ_»asÚs
[
q
]) {

2555 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
,

2556 
æags
);

2557 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

2558 
	`m£cs_to_jiff›s
(

2559 
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
));

2563 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

2566 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
) &&

2567 !(
ifmgd
->
æags
 & 
IEEE80211_STA_NULLFUNC_ACKED
)) {

2568 ià(
	`drv_tx_äames_³ndšg
(
loÿl
)) {

2569 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

2570 
	`m£cs_to_jiff›s
(

2571 
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
));

2573 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
Œue
);

2575 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
çl£
);

2579 ià(!(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
) &&

2580 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
)) ||

2581 (
ifmgd
->
æags
 & 
IEEE80211_STA_NULLFUNC_ACKED
)) {

2582 
ifmgd
->
æags
 &ğ~
IEEE80211_STA_NULLFUNC_ACKED
;

2583 
loÿl
->
hw
.
cÚf
.
æags
 |ğ
IEEE80211_CONF_PS
;

2584 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

2586 
	}
}

2588 
	$›“80211_dyÇmic_ps_tim”
(
tim”_li¡
 *
t
)

2590 
›“80211_loÿl
 *
loÿl
 = 
	`äom_tim”
Öoÿl, 
t
, 
dyÇmic_ps_tim”
);

2592 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
dyÇmic_ps_’abË_wÜk
);

2593 
	}
}

2595 
	$›“80211_dfs_ÿc_tim”_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
)

2597 
›“80211_lšk_d©a
 *
lšk
 =

2598 
	`cÚš”_of
(
wÜk
, 
›“80211_lšk_d©a
,

2599 
dfs_ÿc_tim”_wÜk
.
wÜk
);

2600 
cfg80211_chª_def
 
chªdef
 = 
lšk
->
cÚf
->
chª»q
.
İ”
;

2601 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2603 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2605 ià(
sd©a
->
wdev
.
ÿc_¡¬‹d
) {

2606 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

2607 
	`cfg80211_ÿc_ev’t
(
sd©a
->
dev
, &
chªdef
,

2608 
NL80211_RADAR_CAC_FINISHED
,

2609 
GFP_KERNEL
);

2611 
	}
}

2613 
boŞ


2614 
	$__›“80211_¡a_hªdË_t¥ec_ac_·¿ms
(
›“80211_sub_if_d©a
 *
sd©a
)

2616 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2617 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

2618 
boŞ
 
»t
 = 
çl£
;

2619 
ac
;

2621 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

2622  
çl£
;

2624 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

2625 
›“80211_¡a_tx_t¥ec
 *
tx_t¥ec
 = &
ifmgd
->tx_t¥ec[
ac
];

2626 
nÚ_acm_ac
;

2627 
now
 = 
jiff›s
;

2629 ià(
tx_t¥ec
->
aùiÚ
 =ğ
TX_TSPEC_ACTION_NONE
 &&

2630 
tx_t¥ec
->
adm™‹d_time
 &&

2631 
	`time_aá”
(
now
, 
tx_t¥ec
->
time_¦iû_¡¬t
 + 
HZ
)) {

2632 
tx_t¥ec
->
cÚsumed_tx_time
 = 0;

2633 
tx_t¥ec
->
time_¦iû_¡¬t
 = 
now
;

2635 ià(
tx_t¥ec
->
downg¿ded
)

2636 
tx_t¥ec
->
aùiÚ
 =

2637 
TX_TSPEC_ACTION_STOP_DOWNGRADE
;

2640 
tx_t¥ec
->
aùiÚ
) {

2641 
TX_TSPEC_ACTION_STOP_DOWNGRADE
:

2643 ià(
	`drv_cÚf_tx
(
loÿl
, &
sd©a
->
deæšk
, 
ac
,

2644 &
sd©a
->
deæšk
.
tx_cÚf
[
ac
]))

2645 
	`lšk_”r
(&
sd©a
->
deæšk
,

2647 
ac
);

2648 
tx_t¥ec
->
aùiÚ
 = 
TX_TSPEC_ACTION_NONE
;

2649 
tx_t¥ec
->
downg¿ded
 = 
çl£
;

2650 
»t
 = 
Œue
;

2652 
TX_TSPEC_ACTION_DOWNGRADE
:

2653 ià(
	`time_aá”
(
now
, 
tx_t¥ec
->
time_¦iû_¡¬t
 + 
HZ
)) {

2654 
tx_t¥ec
->
aùiÚ
 = 
TX_TSPEC_ACTION_NONE
;

2655 
»t
 = 
Œue
;

2659 
nÚ_acm_ac
 = 
ac
 + 1;

2660 
nÚ_acm_ac
 < 
IEEE80211_NUM_ACS
;

2661 
nÚ_acm_ac
++)

2662 ià(!(
sd©a
->
wmm_acm
 & 
	`BIT
(7 - 2 * 
nÚ_acm_ac
)))

2671 ià(
nÚ_acm_ac
 >ğ
IEEE80211_NUM_ACS
)

2672 
nÚ_acm_ac
 = 
IEEE80211_AC_BK
;

2673 ià(
	`drv_cÚf_tx
(
loÿl
, &
sd©a
->
deæšk
, 
ac
,

2674 &
sd©a
->
deæšk
.
tx_cÚf
[
nÚ_acm_ac
]))

2675 
	`lšk_”r
(&
sd©a
->
deæšk
,

2677 
ac
);

2678 
tx_t¥ec
->
aùiÚ
 = 
TX_TSPEC_ACTION_NONE
;

2679 
»t
 = 
Œue
;

2680 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
,

2681 &
ifmgd
->
tx_t¥ec_wk
,

2682 
tx_t¥ec
->
time_¦iû_¡¬t
 +

2683 
HZ
 - 
now
 + 1);

2685 
TX_TSPEC_ACTION_NONE
:

2691  
»t
;

2692 
	}
}

2694 
	$›“80211_¡a_hªdË_t¥ec_ac_·¿ms
(
›“80211_sub_if_d©a
 *
sd©a
)

2696 ià(
	`__›“80211_¡a_hªdË_t¥ec_ac_·¿ms
(
sd©a
))

2697 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

2698 
BSS_CHANGED_QOS
);

2699 
	}
}

2701 
	$›“80211_¡a_hªdË_t¥ec_ac_·¿ms_wk
(
why
 *wiphy,

2702 
why_wÜk
 *
wÜk
)

2704 
›“80211_sub_if_d©a
 *
sd©a
;

2706 
sd©a
 = 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

2707 
u
.
mgd
.
tx_t¥ec_wk
.
wÜk
);

2708 
	`›“80211_¡a_hªdË_t¥ec_ac_·¿ms
(
sd©a
);

2709 
	}
}

2711 
	$›“80211_mgd_£t_lšk_qos_·¿ms
(
›“80211_lšk_d©a
 *
lšk
)

2713 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2714 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2715 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

2716 
›“80211_tx_queue_·¿ms
 *
·¿ms
 = 
lšk
->
tx_cÚf
;

2717 
u8
 
ac
;

2719 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

2720 
	`mlme_dbg
(
sd©a
,

2722 
ac
, 
·¿ms
[ac].
acm
,

2723 
·¿ms
[
ac
].
aifs
,…¬ams[ac].
cw_mš
,…¬ams[ac].
cw_max
,

2724 
·¿ms
[
ac
].
txİ
,…¬ams[ac].
u­sd
,

2725 
ifmgd
->
tx_t¥ec
[
ac
].
downg¿ded
);

2726 ià(!
ifmgd
->
tx_t¥ec
[
ac
].
downg¿ded
 &&

2727 
	`drv_cÚf_tx
(
loÿl
, 
lšk
, 
ac
, &
·¿ms
[ac]))

2728 
	`lšk_”r
(
lšk
,

2730 
ac
);

2732 
	}
}

2735 
boŞ


2736 
	$›“80211_¡a_wmm_·¿ms
(
›“80211_loÿl
 *
loÿl
,

2737 
›“80211_lšk_d©a
 *
lšk
,

2738 cÚ¡ 
u8
 *
wmm_·¿m
, 
size_t
 
wmm_·¿m_Ën
,

2739 cÚ¡ 
›“80211_mu_edÿ_·¿m_£t
 *
mu_edÿ
)

2741 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2742 
›“80211_tx_queue_·¿ms
 
·¿ms
[
IEEE80211_NUM_ACS
];

2743 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

2744 
size_t
 
Ëá
;

2745 
couÁ
, 
mu_edÿ_couÁ
, 
ac
;

2746 cÚ¡ 
u8
 *
pos
;

2747 
u8
 
u­sd_queues
 = 0;

2749 ià(!
loÿl
->
İs
->
cÚf_tx
)

2750  
çl£
;

2752 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

2753  
çl£
;

2755 ià(!
wmm_·¿m
)

2756  
çl£
;

2758 ià(
wmm_·¿m_Ën
 < 8 || 
wmm_·¿m
[5] != 1)

2759  
çl£
;

2761 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_UAPSD_ENABLED
)

2762 
u­sd_queues
 = 
ifmgd
->uapsd_queues;

2764 
couÁ
 = 
wmm_·¿m
[6] & 0x0f;

2769 
mu_edÿ_couÁ
 = 
mu_edÿ
 ? mu_edÿ->
mu_qos_šfo
 & 0x0f : -1;

2770 ià(
couÁ
 =ğ
lšk
->
u
.
mgd
.
wmm_Ï¡_·¿m_£t
 &&

2771 
mu_edÿ_couÁ
 =ğ
lšk
->
u
.
mgd
.
mu_edÿ_Ï¡_·¿m_£t
)

2772  
çl£
;

2773 
lšk
->
u
.
mgd
.
wmm_Ï¡_·¿m_£t
 = 
couÁ
;

2774 
lšk
->
u
.
mgd
.
mu_edÿ_Ï¡_·¿m_£t
 = 
mu_edÿ_couÁ
;

2776 
pos
 = 
wmm_·¿m
 + 8;

2777 
Ëá
 = 
wmm_·¿m_Ën
 - 8;

2779 
	`mem£t
(&
·¿ms
, 0, (params));

2781 
sd©a
->
wmm_acm
 = 0;

2782 ; 
Ëá
 >ğ4;†eá -ğ4, 
pos
 += 4) {

2783 
aci
 = (
pos
[0] >> 5) & 0x03;

2784 
acm
 = (
pos
[0] >> 4) & 0x01;

2785 
boŞ
 
u­sd
 = 
çl£
;

2787 
aci
) {

2789 
ac
 = 
IEEE80211_AC_BK
;

2790 ià(
acm
)

2791 
sd©a
->
wmm_acm
 |ğ
	`BIT
(1) | BIT(2);

2792 ià(
u­sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BK
)

2793 
u­sd
 = 
Œue
;

2794 
·¿ms
[
ac
].
mu_edÿ
 = !!mu_edca;

2795 ià(
mu_edÿ
)

2796 
·¿ms
[
ac
].
mu_edÿ_·¿m_»c
 = 
mu_edÿ
->
ac_bk
;

2799 
ac
 = 
IEEE80211_AC_VI
;

2800 ià(
acm
)

2801 
sd©a
->
wmm_acm
 |ğ
	`BIT
(4) | BIT(5);

2802 ià(
u­sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VI
)

2803 
u­sd
 = 
Œue
;

2804 
·¿ms
[
ac
].
mu_edÿ
 = !!mu_edca;

2805 ià(
mu_edÿ
)

2806 
·¿ms
[
ac
].
mu_edÿ_·¿m_»c
 = 
mu_edÿ
->
ac_vi
;

2809 
ac
 = 
IEEE80211_AC_VO
;

2810 ià(
acm
)

2811 
sd©a
->
wmm_acm
 |ğ
	`BIT
(6) | BIT(7);

2812 ià(
u­sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VO
)

2813 
u­sd
 = 
Œue
;

2814 
·¿ms
[
ac
].
mu_edÿ
 = !!mu_edca;

2815 ià(
mu_edÿ
)

2816 
·¿ms
[
ac
].
mu_edÿ_·¿m_»c
 = 
mu_edÿ
->
ac_vo
;

2820 
ac
 = 
IEEE80211_AC_BE
;

2821 ià(
acm
)

2822 
sd©a
->
wmm_acm
 |ğ
	`BIT
(0) | BIT(3);

2823 ià(
u­sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BE
)

2824 
u­sd
 = 
Œue
;

2825 
·¿ms
[
ac
].
mu_edÿ
 = !!mu_edca;

2826 ià(
mu_edÿ
)

2827 
·¿ms
[
ac
].
mu_edÿ_·¿m_»c
 = 
mu_edÿ
->
ac_be
;

2831 
·¿ms
[
ac
].
aifs
 = 
pos
[0] & 0x0f;

2833 ià(
·¿ms
[
ac
].
aifs
 < 2) {

2834 
	`lšk_šfo
(
lšk
,

2836 
·¿ms
[
ac
].
aifs
, 
aci
);

2837 
·¿ms
[
ac
].
aifs
 = 2;

2839 
·¿ms
[
ac
].
cw_max
 = 
	`ecw2cw
((
pos
[1] & 0xf0) >> 4);

2840 
·¿ms
[
ac
].
cw_mš
 = 
	`ecw2cw
(
pos
[1] & 0x0f);

2841 
·¿ms
[
ac
].
txİ
 = 
	`g‘_uÇligÃd_Ë16
(
pos
 + 2);

2842 
·¿ms
[
ac
].
acm
 =‡cm;

2843 
·¿ms
[
ac
].
u­sd
 = uapsd;

2845 ià(
·¿ms
[
ac
].
cw_mš
 == 0 ||

2846 
·¿ms
[
ac
].
cw_mš
 >…¬ams[ac].
cw_max
) {

2847 
	`lšk_šfo
(
lšk
,

2849 
·¿ms
[
ac
].
cw_mš
,…¬ams[ac].
cw_max
, 
aci
);

2850  
çl£
;

2852 
	`›“80211_»guÏtÜy_lim™_wmm_·¿ms
(
sd©a
, &
·¿ms
[
ac
],‡c);

2856 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

2857 ià(
·¿ms
[
ac
].
cw_mš
 == 0) {

2858 
	`lšk_šfo
(
lšk
,

2860 
ac
);

2861  
çl£
;

2865 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

2866 
lšk
->
tx_cÚf
[
ac
] = 
·¿ms
[ac];

2868 
	`›“80211_mgd_£t_lšk_qos_·¿ms
(
lšk
);

2871 
lšk
->
cÚf
->
qos
 = 
Œue
;

2872  
Œue
;

2873 
	}
}

2875 
	$__›“80211_¡İ_pŞl
(
›“80211_sub_if_d©a
 *
sd©a
)

2877 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2879 
sd©a
->
u
.
mgd
.
æags
 &ğ~
IEEE80211_STA_CONNECTION_POLL
;

2880 
	`›“80211_run_deã¼ed_sÿn
(
sd©a
->
loÿl
);

2881 
	}
}

2883 
	$›“80211_¡İ_pŞl
(
›“80211_sub_if_d©a
 *
sd©a
)

2885 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2887 
	`__›“80211_¡İ_pŞl
(
sd©a
);

2888 
	}
}

2890 
u64
 
	$›“80211_hªdË_bss_ÿ·b™y
(
›“80211_lšk_d©a
 *
lšk
,

2891 
u16
 
ÿ·b
, 
boŞ
 
”p_v®id
, 
u8
 
”p
)

2893 
›“80211_bss_cÚf
 *
bss_cÚf
 = 
lšk
->
cÚf
;

2894 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

2895 
u64
 
chªged
 = 0;

2896 
boŞ
 
u£_´ÙeùiÚ
;

2897 
boŞ
 
u£_shÜt_´—mbË
;

2898 
boŞ
 
u£_shÜt_¦Ù
;

2900 
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

2901 ià(!
sbªd
)

2902  
chªged
;

2904 ià(
”p_v®id
) {

2905 
u£_´ÙeùiÚ
 = (
”p
 & 
WLAN_ERP_USE_PROTECTION
) != 0;

2906 
u£_shÜt_´—mbË
 = (
”p
 & 
WLAN_ERP_BARKER_PREAMBLE
) == 0;

2908 
u£_´ÙeùiÚ
 = 
çl£
;

2909 
u£_shÜt_´—mbË
 = !!(
ÿ·b
 & 
WLAN_CAPABILITY_SHORT_PREAMBLE
);

2912 
u£_shÜt_¦Ù
 = !!(
ÿ·b
 & 
WLAN_CAPABILITY_SHORT_SLOT_TIME
);

2913 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_5GHZ
 ||

2914 
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

2915 
u£_shÜt_¦Ù
 = 
Œue
;

2917 ià(
u£_´ÙeùiÚ
 !ğ
bss_cÚf
->
u£_ùs_´Ù
) {

2918 
bss_cÚf
->
u£_ùs_´Ù
 = 
u£_´ÙeùiÚ
;

2919 
chªged
 |ğ
BSS_CHANGED_ERP_CTS_PROT
;

2922 ià(
u£_shÜt_´—mbË
 !ğ
bss_cÚf
->use_short_preamble) {

2923 
bss_cÚf
->
u£_shÜt_´—mbË
 = use_short_preamble;

2924 
chªged
 |ğ
BSS_CHANGED_ERP_PREAMBLE
;

2927 ià(
u£_shÜt_¦Ù
 !ğ
bss_cÚf
->use_short_slot) {

2928 
bss_cÚf
->
u£_shÜt_¦Ù
 = use_short_slot;

2929 
chªged
 |ğ
BSS_CHANGED_ERP_SLOT
;

2932  
chªged
;

2933 
	}
}

2935 
u64
 
	$›“80211_lšk_£t_assocŸ‹d
(
›“80211_lšk_d©a
 *
lšk
,

2936 
cfg80211_bss
 *
cbss
)

2938 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2939 
›“80211_bss_cÚf
 *
bss_cÚf
 = 
lšk
->
cÚf
;

2940 
›“80211_bss
 *
bss
 = (*)
cbss
->
´iv
;

2941 
u64
 
chªged
 = 
BSS_CHANGED_QOS
;

2944 
sd©a
->
u
.
mgd
.
b—cÚ_timeout
 =

2945 
	`u£cs_to_jiff›s
(
	`›“80211_tu_to_u£c
(
b—cÚ_loss_couÁ
 *

2946 
bss_cÚf
->
b—cÚ_št
));

2948 
chªged
 |ğ
	`›“80211_hªdË_bss_ÿ·b™y
(
lšk
,

2949 
bss_cÚf
->
assoc_ÿ·b™y
,

2950 
bss
->
has_”p_v®ue
,

2951 
bss
->
”p_v®ue
);

2953 
	`›“80211_check_¿‹_mask
(
lšk
);

2955 
lšk
->
cÚf
->
bss
 = 
cbss
;

2956 
	`memıy
(
lšk
->
u
.
mgd
.
bssid
, 
cbss
->bssid, 
ETH_ALEN
);

2958 ià(
sd©a
->
vif
.
p2p
 ||

2959 
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_GET_NOA_UPDATE
) {

2960 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

2962 
	`rcu_»ad_lock
();

2963 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

2964 ià(
›s
) {

2965 
»t
;

2967 
»t
 = 
	`cfg80211_g‘_p2p_©Œ
(

2968 
›s
->
d©a
, ies->
Ën
,

2969 
IEEE80211_P2P_ATTR_ABSENCE_NOTICE
,

2970 (
u8
 *è&
bss_cÚf
->
p2p_nß_©Œ
,

2971 (
bss_cÚf
->
p2p_nß_©Œ
));

2972 ià(
»t
 >= 2) {

2973 
lšk
->
u
.
mgd
.
p2p_nß_šdex
 =

2974 
bss_cÚf
->
p2p_nß_©Œ
.
šdex
;

2975 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

2978 
	`rcu_»ad_uÆock
();

2981 ià(
lšk
->
u
.
mgd
.
have_b—cÚ
) {

2982 
bss_cÚf
->
b—cÚ_¿‹
 = 
bss
->beacon_rate;

2983 
chªged
 |ğ
BSS_CHANGED_BEACON_INFO
;

2985 
bss_cÚf
->
b—cÚ_¿‹
 = 
NULL
;

2989 ià(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
 &&

2990 
bss_cÚf
->
cqm_rssi_thŞd
)

2991 
chªged
 |ğ
BSS_CHANGED_CQM
;

2993  
chªged
;

2994 
	}
}

2996 
	$›“80211_£t_assocŸ‹d
(
›“80211_sub_if_d©a
 *
sd©a
,

2997 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
,

2998 
u64
 
chªged
[
IEEE80211_MLD_MAX_NUM_LINKS
])

3000 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3001 
›“80211_vif_cfg
 *
vif_cfg
 = &
sd©a
->
vif
.
cfg
;

3002 
u64
 
vif_chªged
 = 
BSS_CHANGED_ASSOC
;

3003 
lšk_id
;

3005 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3007 
sd©a
->
u
.
mgd
.
assocŸ‹d
 = 
Œue
;

3009 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

3010 
cfg80211_bss
 *
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

3011 
›“80211_lšk_d©a
 *
lšk
;

3013 ià(!
cbss
 ||

3014 
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
 !ğ
WLAN_STATUS_SUCCESS
)

3017 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
) &&

3018 !(
	`›“80211_vif_u§bË_lšks
(&
sd©a
->
vif
è& 
	`BIT
(
lšk_id
)))

3021 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

3022 ià(
	`WARN_ON
(!
lšk
))

3025 
chªged
[
lšk_id
] |ğ
	`›“80211_lšk_£t_assocŸ‹d
(
lšk
, 
cbss
);

3029 
	`›“80211_¡İ_pŞl
(
sd©a
);

3031 
	`›“80211_Ëd_assoc
(
loÿl
, 1);

3033 
vif_cfg
->
assoc
 = 1;

3036 ià(
vif_cfg
->
¬p_addr_út
)

3037 
vif_chªged
 |ğ
BSS_CHANGED_ARP_FILTER
;

3039 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

3040 
lšk_id
 = 0;

3041 
lšk_id
 < 
IEEE80211_MLD_MAX_NUM_LINKS
;

3042 
lšk_id
++) {

3043 
›“80211_lšk_d©a
 *
lšk
;

3044 
cfg80211_bss
 *
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

3046 ià(!
cbss
 ||

3047 !(
	`BIT
(
lšk_id
) &

3048 
	`›“80211_vif_u§bË_lšks
(&
sd©a
->
vif
)) ||

3049 
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
 !ğ
WLAN_STATUS_SUCCESS
)

3052 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

3053 ià(
	`WARN_ON
(!
lšk
))

3056 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

3057 
chªged
[
lšk_id
]);

3059 
	`›“80211_»ÿlc_smps
(
sd©a
, 
lšk
);

3062 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
vif_chªged
);

3064 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
,

3065 
vif_chªged
 | 
chªged
[0]);

3068 
	`›“80211_»ÿlc_ps
(
loÿl
);

3071 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

3072 
	`›“80211_»ÿlc_smps
(
sd©a
, &sd©a->
deæšk
);

3073 
	`›“80211_»ÿlc_ps_vif
(
sd©a
);

3075 
	`Ãtif_ÿ¼›r_Ú
(
sd©a
->
dev
);

3076 
	}
}

3078 
	$›“80211_£t_di§ssoc
(
›“80211_sub_if_d©a
 *
sd©a
,

3079 
u16
 
¡y³
, u16 
»asÚ
, 
boŞ
 
tx
,

3080 
u8
 *
äame_buf
)

3082 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3083 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3084 
lšk_id
;

3085 
u64
 
chªged
 = 0;

3086 
›“80211_´•_tx_šfo
 
šfo
 = {

3087 .
subty³
 = 
¡y³
,

3090 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3092 ià(
	`WARN_ON_ONCE
(
tx
 && !
äame_buf
))

3095 ià(
	`WARN_ON
(!
ifmgd
->
assocŸ‹d
))

3098 
	`›“80211_¡İ_pŞl
(
sd©a
);

3100 
ifmgd
->
assocŸ‹d
 = 
çl£
;

3103 
sd©a
->
deæšk
.
cÚf
->
bss
 = 
NULL
;

3104 
sd©a
->
deæšk
.
smps_mode
 = 
IEEE80211_SMPS_OFF
;

3106 
	`Ãtif_ÿ¼›r_off
(
sd©a
->
dev
);

3113 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
) {

3114 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_PS
;

3115 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

3117 
loÿl
->
ps_sd©a
 = 
NULL
;

3120 
	`›“80211_»ÿlc_ps_vif
(
sd©a
);

3123 
	`synchrÚize_Ãt
();

3131 ià(
tx
)

3132 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
Œue
);

3135 ià(
tx
 || 
äame_buf
) {

3142 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
DEAUTH_NEED_MGD_TX_PREP
)) {

3143 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
(
sd©a
->
lšk
);

3144 
lšk_id
++) {

3145 
›“80211_lšk_d©a
 *
lšk
;

3147 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
],

3148 
sd©a
);

3149 ià(!
lšk
)

3151 ià(
lšk
->
u
.
mgd
.
have_b—cÚ
)

3154 ià(
lšk_id
 =ğ
IEEE80211_MLD_MAX_NUM_LINKS
) {

3155 
šfo
.
lšk_id
 = 
	`ffs
(
sd©a
->
vif
.
aùive_lšks
) - 1;

3156 
	`drv_mgd_´•¬e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

3160 
	`›“80211_£nd_d—uth_di§ssoc
(
sd©a
, sd©a->
vif
.
cfg
.
­_addr
,

3161 
sd©a
->
vif
.
cfg
.
­_addr
, 
¡y³
,

3162 
»asÚ
, 
tx
, 
äame_buf
);

3166 ià(
tx
)

3167 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
çl£
);

3169 
	`drv_mgd_com¶‘e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

3172 
	`‘h_z”o_addr
(
sd©a
->
deæšk
.
u
.
mgd
.
bssid
);

3173 
	`‘h_z”o_addr
(
sd©a
->
vif
.
cfg
.
­_addr
);

3175 
sd©a
->
vif
.
cfg
.
ssid_Ën
 = 0;

3178 
	`¡a_šfo_æush
(
sd©a
, -1);

3181 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

3182 
chªged
 |ğ
	`›“80211_»£t_”p_šfo
(
sd©a
);

3184 
	`›“80211_Ëd_assoc
(
loÿl
, 0);

3185 
chªged
 |ğ
BSS_CHANGED_ASSOC
;

3186 
sd©a
->
vif
.
cfg
.
assoc
 = 
çl£
;

3188 
sd©a
->
deæšk
.
u
.
mgd
.
p2p_nß_šdex
 = -1;

3189 
	`mem£t
(&
sd©a
->
vif
.
bss_cÚf
.
p2p_nß_©Œ
, 0,

3190 (
sd©a
->
vif
.
bss_cÚf
.
p2p_nß_©Œ
));

3193 
	`mem£t
(&
ifmgd
->
ht_ÿ·
, 0, (ifmgd->ht_capa));

3194 
	`mem£t
(&
ifmgd
->
ht_ÿ·_mask
, 0, (ifmgd->ht_capa_mask));

3195 
	`mem£t
(&
ifmgd
->
vht_ÿ·
, 0, (ifmgd->vht_capa));

3196 
	`mem£t
(&
ifmgd
->
vht_ÿ·_mask
, 0, (ifmgd->vht_capa_mask));

3202 
	`mem£t
(
sd©a
->
vif
.
bss_cÚf
.
mu_group
.
memb”sh
, 0,

3203 (
sd©a
->
vif
.
bss_cÚf
.
mu_group
.
memb”sh
));

3204 
	`mem£t
(
sd©a
->
vif
.
bss_cÚf
.
mu_group
.
pos™iÚ
, 0,

3205 (
sd©a
->
vif
.
bss_cÚf
.
mu_group
.
pos™iÚ
));

3206 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

3207 
chªged
 |ğ
BSS_CHANGED_MU_GROUPS
;

3208 
sd©a
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
 = 
çl£
;

3210 
sd©a
->
deæšk
.
­_pow”_Ëv–
 = 
IEEE80211_UNSET_POWER_LEVEL
;

3212 
	`d–_tim”_sync
(&
loÿl
->
dyÇmic_ps_tim”
);

3213 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
dyÇmic_ps_’abË_wÜk
);

3216 ià(
sd©a
->
vif
.
cfg
.
¬p_addr_út
)

3217 
chªged
 |ğ
BSS_CHANGED_ARP_FILTER
;

3219 
sd©a
->
vif
.
bss_cÚf
.
qos
 = 
çl£
;

3220 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

3221 
chªged
 |ğ
BSS_CHANGED_QOS
;

3223 
chªged
 |ğ
BSS_CHANGED_BSSID
 | 
BSS_CHANGED_HT
;

3224 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

3226 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
chªged
);

3230 
	`›“80211_£t_wmm_deçuÉ
(&
sd©a
->
deæšk
, 
çl£
, false);

3232 
	`d–_tim”_sync
(&
sd©a
->
u
.
mgd
.
cÚn_mÚ_tim”
);

3233 
	`d–_tim”_sync
(&
sd©a
->
u
.
mgd
.
bú_mÚ_tim”
);

3234 
	`d–_tim”_sync
(&
sd©a
->
u
.
mgd
.
tim”
);

3236 
sd©a
->
vif
.
bss_cÚf
.
dtim_³riod
 = 0;

3237 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_¿‹
 = 
NULL
;

3239 
sd©a
->
deæšk
.
u
.
mgd
.
have_b—cÚ
 = 
çl£
;

3240 
sd©a
->
deæšk
.
u
.
mgd
.
Œackšg_sigÇl_avg
 = 
çl£
;

3241 
sd©a
->
deæšk
.
u
.
mgd
.
di§bË_wmm_Œackšg
 = 
çl£
;

3243 
ifmgd
->
æags
 = 0;

3245 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
(
sd©a
->
lšk
);†ink_id++) {

3246 
›“80211_lšk_d©a
 *
lšk
;

3248 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

3249 ià(!
lšk
)

3251 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

3254 
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 = 
çl£
;

3255 
sd©a
->
deæšk
.
u
.
mgd
.
c§_wa™šg_bú
 = 
çl£
;

3256 
sd©a
->
deæšk
.
u
.
mgd
.
c§_ignÜed_§me_chª
 = 
çl£
;

3257 ià(
sd©a
->
c§_blocked_tx
) {

3258 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

3259 
IEEE80211_QUEUE_STOP_REASON_CSA
);

3260 
sd©a
->
c§_blocked_tx
 = 
çl£
;

3264 
	`mem£t
(
ifmgd
->
tx_t¥ec
, 0, (ifmgd->tx_tspec));

3265 
	`why_d–ayed_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &
ifmgd
->
tx_t¥ec_wk
);

3267 
sd©a
->
vif
.
bss_cÚf
.
pow”_ty³
 = 
IEEE80211_REG_UNSET_AP
;

3268 
sd©a
->
vif
.
bss_cÚf
.
pwr_»duùiÚ
 = 0;

3269 
sd©a
->
vif
.
bss_cÚf
.
tx_pwr_’v_num
 = 0;

3270 
	`mem£t
(
sd©a
->
vif
.
bss_cÚf
.
tx_pwr_’v
, 0,

3271 (
sd©a
->
vif
.
bss_cÚf
.
tx_pwr_’v
));

3273 
sd©a
->
vif
.
cfg
.
eml_ÿp
 = 0;

3274 
sd©a
->
vif
.
cfg
.
eml_med_sync_d–ay
 = 0;

3275 
sd©a
->
vif
.
cfg
.
mld_ÿ·_İ
 = 0;

3277 
	`mem£t
(&
sd©a
->
u
.
mgd
.
‰lm_šfo
, 0,

3278 (
sd©a
->
u
.
mgd
.
‰lm_šfo
));

3279 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
, &
ifmgd
->
‰lm_wÜk
);

3281 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

3282 &
ifmgd
->
Ãg_‰lm_timeout_wÜk
);

3283 
	`›“80211_vif_£t_lšks
(
sd©a
, 0, 0);

3285 
ifmgd
->
mÿ¡_£q_Ï¡
 = 
IEEE80211_SN_MODULO
;

3286 
	}
}

3288 
	$›“80211_»£t_­_´obe
(
›“80211_sub_if_d©a
 *
sd©a
)

3290 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3291 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3293 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3295 ià(!(
ifmgd
->
æags
 & 
IEEE80211_STA_CONNECTION_POLL
))

3298 
	`__›“80211_¡İ_pŞl
(
sd©a
);

3300 
	`›“80211_»ÿlc_ps
(
loÿl
);

3302 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
CONNECTION_MONITOR
))

3310 
	`›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
sd©a
);

3312 
	`mod_tim”
(&
ifmgd
->
cÚn_mÚ_tim”
,

3313 
	`round_jiff›s_up
(
jiff›s
 +

3314 
IEEE80211_CONNECTION_IDLE_TIME
));

3315 
	}
}

3317 
	$›“80211_¡a_tx_wmm_ac_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

3318 
›“80211_hdr
 *
hdr
,

3319 
u16
 
tx_time
)

3321 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3322 
u16
 
tid
;

3323 
ac
;

3324 
›“80211_¡a_tx_t¥ec
 *
tx_t¥ec
;

3325 
now
 = 
jiff›s
;

3327 ià(!
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
))

3330 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

3331 
ac
 = 
	`›“80211_ac_äom_tid
(
tid
);

3332 
tx_t¥ec
 = &
ifmgd
->tx_t¥ec[
ac
];

3334 ià(
	`lik–y
(!
tx_t¥ec
->
adm™‹d_time
))

3337 ià(
	`time_aá”
(
now
, 
tx_t¥ec
->
time_¦iû_¡¬t
 + 
HZ
)) {

3338 
tx_t¥ec
->
cÚsumed_tx_time
 = 0;

3339 
tx_t¥ec
->
time_¦iû_¡¬t
 = 
now
;

3341 ià(
tx_t¥ec
->
downg¿ded
) {

3342 
tx_t¥ec
->
aùiÚ
 = 
TX_TSPEC_ACTION_STOP_DOWNGRADE
;

3343 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

3344 &
ifmgd
->
tx_t¥ec_wk
, 0);

3348 ià(
tx_t¥ec
->
downg¿ded
)

3351 
tx_t¥ec
->
cÚsumed_tx_time
 +ğ
tx_time
;

3353 ià(
tx_t¥ec
->
cÚsumed_tx_time
 >ğtx_t¥ec->
adm™‹d_time
) {

3354 
tx_t¥ec
->
downg¿ded
 = 
Œue
;

3355 
tx_t¥ec
->
aùiÚ
 = 
TX_TSPEC_ACTION_DOWNGRADE
;

3356 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

3357 &
ifmgd
->
tx_t¥ec_wk
, 0);

3359 
	}
}

3361 
	$›“80211_¡a_tx_nÙify
(
›“80211_sub_if_d©a
 *
sd©a
,

3362 
›“80211_hdr
 *
hdr
, 
boŞ
 
ack
, 
u16
 
tx_time
)

3364 
	`›“80211_¡a_tx_wmm_ac_nÙify
(
sd©a
, 
hdr
, 
tx_time
);

3366 ià(!
	`›“80211_is_ªy_nuÎfunc
(
hdr
->
äame_cÚŒŞ
) ||

3367 !
sd©a
->
u
.
mgd
.
´obe_£nd_couÁ
)

3370 ià(
ack
)

3371 
sd©a
->
u
.
mgd
.
´obe_£nd_couÁ
 = 0;

3373 
sd©a
->
u
.
mgd
.
nuÎfunc_çed
 = 
Œue
;

3374 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

3375 
	}
}

3377 
	$›“80211_mlme_£nd_´obe_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

3378 cÚ¡ 
u8
 *
¤c
, cÚ¡ u8 *
d¡
,

3379 cÚ¡ 
u8
 *
ssid
, 
size_t
 
ssid_Ën
,

3380 
›“80211_chªÃl
 *
chªÃl
)

3382 
sk_buff
 *
skb
;

3384 
skb
 = 
	`›“80211_bud_´obe_»q
(
sd©a
, 
¤c
, 
d¡
, (
u32
)-1, 
chªÃl
,

3385 
ssid
, 
ssid_Ën
, 
NULL
, 0,

3386 
IEEE80211_PROBE_FLAG_DIRECTED
);

3387 ià(
skb
)

3388 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

3389 
	}
}

3391 
	$›“80211_mgd_´obe_­_£nd
(
›“80211_sub_if_d©a
 *
sd©a
)

3393 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3394 
u8
 *
d¡
 = 
sd©a
->
vif
.
cfg
.
­_addr
;

3395 
u8
 
uniÿ¡_lim™
 = 
	`max
(1, 
max_´obe_Œ›s
 - 3);

3396 
¡a_šfo
 *
¡a
;

3398 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3400 ià(
	`WARN_ON
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)))

3408 ià(
ifmgd
->
´obe_£nd_couÁ
 >ğ
uniÿ¡_lim™
)

3409 
d¡
 = 
NULL
;

3418 
ifmgd
->
´obe_£nd_couÁ
++;

3420 ià(
d¡
) {

3421 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
d¡
);

3422 ià(!
	`WARN_ON
(!
¡a
))

3423 
	`›“80211_check_ç¡_rx
(
¡a
);

3426 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

3427 
ifmgd
->
nuÎfunc_çed
 = 
çl£
;

3428 
	`›“80211_£nd_nuÎfunc
(
sd©a
->
loÿl
, sd©a, 
çl£
);

3430 
	`›“80211_mlme_£nd_´obe_»q
(
sd©a
, sd©a->
vif
.
addr
, 
d¡
,

3431 
sd©a
->
vif
.
cfg
.
ssid
,

3432 
sd©a
->
vif
.
cfg
.
ssid_Ën
,

3433 
sd©a
->
deæšk
.
cÚf
->
bss
->
chªÃl
);

3436 
ifmgd
->
´obe_timeout
 = 
jiff›s
 + 
	`m£cs_to_jiff›s
(
´obe_wa™_ms
);

3437 
	`run_agaš
(
sd©a
, 
ifmgd
->
´obe_timeout
);

3438 
	}
}

3440 
	$›“80211_mgd_´obe_­
(
›“80211_sub_if_d©a
 *
sd©a
,

3441 
boŞ
 
b—cÚ
)

3443 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3444 
boŞ
 
®»ady
 = 
çl£
;

3446 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3448 ià(
	`WARN_ON_ONCE
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)))

3451 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

3454 ià(!
ifmgd
->
assocŸ‹d
)

3457 ià(
sd©a
->
loÿl
->
tmp_chªÃl
 || sd©a->loÿl->
sÿÂšg
)

3460 ià(
sd©a
->
loÿl
->
su¥’dšg
) {

3462 
	`›“80211_»£t_­_´obe
(
sd©a
);

3466 ià(
b—cÚ
) {

3467 
	`mlme_dbg_¿‹lim™ed
(
sd©a
,

3469 
b—cÚ_loss_couÁ
);

3471 
	`›“80211_cqm_b—cÚ_loss_nÙify
(&
sd©a
->
vif
, 
GFP_KERNEL
);

3485 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_CONNECTION_POLL
)

3486 
®»ady
 = 
Œue
;

3488 
ifmgd
->
æags
 |ğ
IEEE80211_STA_CONNECTION_POLL
;

3490 ià(
®»ady
)

3493 
	`›“80211_»ÿlc_ps
(
sd©a
->
loÿl
);

3495 
ifmgd
->
´obe_£nd_couÁ
 = 0;

3496 
	`›“80211_mgd_´obe_­_£nd
(
sd©a
);

3497 
	}
}

3499 
sk_buff
 *
	$›“80211_­_´ob”eq_g‘
(
›“80211_hw
 *
hw
,

3500 
›“80211_vif
 *
vif
)

3502 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3503 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3504 
cfg80211_bss
 *
cbss
;

3505 
sk_buff
 *
skb
;

3506 cÚ¡ 
–em’t
 *
ssid
;

3507 
ssid_Ën
;

3509 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3511 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 ||

3512 
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)))

3513  
NULL
;

3515 ià(
ifmgd
->
assocŸ‹d
)

3516 
cbss
 = 
sd©a
->
deæšk
.
cÚf
->
bss
;

3517 ià(
ifmgd
->
auth_d©a
)

3518 
cbss
 = 
ifmgd
->
auth_d©a
->
bss
;

3519 ià(
ifmgd
->
assoc_d©a
 && ifmgd->assoc_d©a->
lšk
[0].
bss
)

3520 
cbss
 = 
ifmgd
->
assoc_d©a
->
lšk
[0].
bss
;

3522  
NULL
;

3524 
	`rcu_»ad_lock
();

3525 
ssid
 = 
	`›“80211_bss_g‘_–em
(
cbss
, 
WLAN_EID_SSID
);

3526 ià(
	`WARN_ONCE
(!
ssid
 || ssid->
d©®’
 > 
IEEE80211_MAX_SSID_LEN
,

3528 
ssid
 ? ssid->
d©®’
 : -1))

3529 
ssid_Ën
 = 0;

3531 
ssid_Ën
 = 
ssid
->
d©®’
;

3533 
skb
 = 
	`›“80211_bud_´obe_»q
(
sd©a
, sd©a->
vif
.
addr
, 
cbss
->
bssid
,

3534 (
u32
è-1, 
cbss
->
chªÃl
,

3535 
ssid
->
d©a
, 
ssid_Ën
,

3536 
NULL
, 0, 
IEEE80211_PROBE_FLAG_DIRECTED
);

3537 
	`rcu_»ad_uÆock
();

3539  
skb
;

3540 
	}
}

3541 
EXPORT_SYMBOL
(
›“80211_­_´ob”eq_g‘
);

3543 
	$›“80211_»pÜt_discÚÃù
(
›“80211_sub_if_d©a
 *
sd©a
,

3544 cÚ¡ 
u8
 *
buf
, 
size_t
 
Ën
, 
boŞ
 
tx
,

3545 
u16
 
»asÚ
, 
boŞ
 
»cÚÃù
)

3547 
›“80211_ev’t
 
ev’t
 = {

3548 .
ty³
 = 
MLME_EVENT
,

3549 .
u
.
mlme
.
d©a
 = 
tx
 ? 
DEAUTH_TX_EVENT
 : 
DEAUTH_RX_EVENT
,

3550 .
u
.
mlme
.
»asÚ
 =„eason,

3553 ià(
tx
)

3554 
	`cfg80211_tx_mlme_mgmt
(
sd©a
->
dev
, 
buf
, 
Ën
, 
»cÚÃù
);

3556 
	`cfg80211_rx_mlme_mgmt
(
sd©a
->
dev
, 
buf
, 
Ën
);

3558 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

3559 
	}
}

3561 
	$__›“80211_discÚÃù
(
›“80211_sub_if_d©a
 *
sd©a
)

3563 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3564 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3565 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

3566 
boŞ
 
tx
;

3568 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3570 ià(!
ifmgd
->
assocŸ‹d
)

3578 
tx
 = !
sd©a
->
c§_blocked_tx
;

3580 ià(!
ifmgd
->
driv”_discÚÃù
) {

3581 
lšk_id
;

3590 
lšk_id
 = 0;

3591 
lšk_id
 < 
	`ARRAY_SIZE
(
sd©a
->
lšk
);

3592 
lšk_id
++) {

3593 
›“80211_lšk_d©a
 *
lšk
;

3595 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

3596 ià(!
lšk
)

3598 
	`cfg80211_uÆšk_bss
(
loÿl
->
hw
.
why
, 
lšk
->
cÚf
->
bss
);

3599 
lšk
->
cÚf
->
bss
 = 
NULL
;

3603 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DEAUTH
,

3604 
ifmgd
->
driv”_discÚÃù
 ?

3605 
WLAN_REASON_DEAUTH_LEAVING
 :

3606 
WLAN_REASON_DISASSOC_DUE_TO_INACTIVITY
,

3607 
tx
, 
äame_buf
);

3609 
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 = 
çl£
;

3610 
sd©a
->
deæšk
.
u
.
mgd
.
c§_wa™šg_bú
 = 
çl£
;

3611 ià(
sd©a
->
c§_blocked_tx
) {

3612 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

3613 
IEEE80211_QUEUE_STOP_REASON_CSA
);

3614 
sd©a
->
c§_blocked_tx
 = 
çl£
;

3617 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
, (äame_buf), 
tx
,

3618 
WLAN_REASON_DISASSOC_DUE_TO_INACTIVITY
,

3619 
ifmgd
->
»cÚÃù
);

3620 
ifmgd
->
»cÚÃù
 = 
çl£
;

3621 
	}
}

3623 
	$›“80211_b—cÚ_cÚÃùiÚ_loss_wÜk
(
why
 *wiphy,

3624 
why_wÜk
 *
wÜk
)

3626 
›“80211_sub_if_d©a
 *
sd©a
 =

3627 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

3628 
u
.
mgd
.
b—cÚ_cÚÃùiÚ_loss_wÜk
);

3629 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3631 ià(
ifmgd
->
cÚÃùiÚ_loss
) {

3632 
	`sd©a_šfo
(
sd©a
, "Connectiono AP %pM†ost\n",

3633 
sd©a
->
vif
.
cfg
.
­_addr
);

3634 
	`__›“80211_discÚÃù
(
sd©a
);

3635 
ifmgd
->
cÚÃùiÚ_loss
 = 
çl£
;

3636 } ià(
ifmgd
->
driv”_discÚÃù
) {

3637 
	`sd©a_šfo
(
sd©a
,

3639 
sd©a
->
vif
.
cfg
.
­_addr
);

3640 
	`__›“80211_discÚÃù
(
sd©a
);

3641 
ifmgd
->
driv”_discÚÃù
 = 
çl£
;

3643 ià(
ifmgd
->
assocŸ‹d
)

3644 
sd©a
->
deæšk
.
u
.
mgd
.
b—cÚ_loss_couÁ
++;

3645 
	`›“80211_mgd_´obe_­
(
sd©a
, 
Œue
);

3647 
	}
}

3649 
	$›“80211_c§_cÚÃùiÚ_drİ_wÜk
(
why
 *wiphy,

3650 
why_wÜk
 *
wÜk
)

3652 
›“80211_sub_if_d©a
 *
sd©a
 =

3653 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

3654 
u
.
mgd
.
c§_cÚÃùiÚ_drİ_wÜk
);

3656 
	`__›“80211_discÚÃù
(
sd©a
);

3657 
	}
}

3659 
	$›“80211_b—cÚ_loss
(
›“80211_vif
 *
vif
)

3661 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3662 
›“80211_hw
 *
hw
 = &
sd©a
->
loÿl
->hw;

3664 
	`Œaû_­i_b—cÚ_loss
(
sd©a
);

3666 
sd©a
->
u
.
mgd
.
cÚÃùiÚ_loss
 = 
çl£
;

3667 
	`why_wÜk_queue
(
hw
->
why
, &
sd©a
->
u
.
mgd
.
b—cÚ_cÚÃùiÚ_loss_wÜk
);

3668 
	}
}

3669 
EXPORT_SYMBOL
(
›“80211_b—cÚ_loss
);

3671 
	$›“80211_cÚÃùiÚ_loss
(
›“80211_vif
 *
vif
)

3673 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3674 
›“80211_hw
 *
hw
 = &
sd©a
->
loÿl
->hw;

3676 
	`Œaû_­i_cÚÃùiÚ_loss
(
sd©a
);

3678 
sd©a
->
u
.
mgd
.
cÚÃùiÚ_loss
 = 
Œue
;

3679 
	`why_wÜk_queue
(
hw
->
why
, &
sd©a
->
u
.
mgd
.
b—cÚ_cÚÃùiÚ_loss_wÜk
);

3680 
	}
}

3681 
EXPORT_SYMBOL
(
›“80211_cÚÃùiÚ_loss
);

3683 
	$›“80211_discÚÃù
(
›“80211_vif
 *
vif
, 
boŞ
 
»cÚÃù
)

3685 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3686 
›“80211_hw
 *
hw
 = &
sd©a
->
loÿl
->hw;

3688 
	`Œaû_­i_discÚÃù
(
sd©a
, 
»cÚÃù
);

3690 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
))

3693 
sd©a
->
u
.
mgd
.
driv”_discÚÃù
 = 
Œue
;

3694 
sd©a
->
u
.
mgd
.
»cÚÃù
 =„econnect;

3695 
	`why_wÜk_queue
(
hw
->
why
, &
sd©a
->
u
.
mgd
.
b—cÚ_cÚÃùiÚ_loss_wÜk
);

3696 
	}
}

3697 
EXPORT_SYMBOL
(
›“80211_discÚÃù
);

3699 
	$›“80211_de¡roy_auth_d©a
(
›“80211_sub_if_d©a
 *
sd©a
,

3700 
boŞ
 
assoc
)

3702 
›“80211_mgd_auth_d©a
 *
auth_d©a
 = 
sd©a
->
u
.
mgd
.auth_data;

3704 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3706 ià(!
assoc
) {

3712 
	`d–_tim”_sync
(&
sd©a
->
u
.
mgd
.
tim”
);

3713 
	`¡a_šfo_de¡roy_addr
(
sd©a
, 
auth_d©a
->
­_addr
);

3716 
	`‘h_z”o_addr
(
sd©a
->
deæšk
.
u
.
mgd
.
bssid
);

3717 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

3718 
BSS_CHANGED_BSSID
);

3719 
sd©a
->
u
.
mgd
.
æags
 = 0;

3721 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

3722 
	`›“80211_vif_£t_lšks
(
sd©a
, 0, 0);

3725 
	`cfg80211_put_bss
(
sd©a
->
loÿl
->
hw
.
why
, 
auth_d©a
->
bss
);

3726 
	`kä“
(
auth_d©a
);

3727 
sd©a
->
u
.
mgd
.
auth_d©a
 = 
NULL
;

3728 
	}
}

3730 
	eassoc_¡©us
 {

3731 
	mASSOC_SUCCESS
,

3732 
	mASSOC_REJECTED
,

3733 
	mASSOC_TIMEOUT
,

3734 
	mASSOC_ABANDON
,

3737 
	$›“80211_de¡roy_assoc_d©a
(
›“80211_sub_if_d©a
 *
sd©a
,

3738 
assoc_¡©us
 
¡©us
)

3740 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
sd©a
->
u
.
mgd
.assoc_data;

3742 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3744 ià(
¡©us
 !ğ
ASSOC_SUCCESS
) {

3750 
	`d–_tim”_sync
(&
sd©a
->
u
.
mgd
.
tim”
);

3751 
	`¡a_šfo_de¡roy_addr
(
sd©a
, 
assoc_d©a
->
­_addr
);

3753 
	`‘h_z”o_addr
(
sd©a
->
deæšk
.
u
.
mgd
.
bssid
);

3754 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

3755 
BSS_CHANGED_BSSID
);

3756 
sd©a
->
u
.
mgd
.
æags
 = 0;

3757 
sd©a
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
 = 
çl£
;

3759 ià(
¡©us
 !ğ
ASSOC_REJECTED
) {

3760 
cfg80211_assoc_çu»
 
d©a
 = {

3761 .
timeout
 = 
¡©us
 =ğ
ASSOC_TIMEOUT
,

3763 
i
;

3765 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
d©a
.
bss
) !=

3766 
	`ARRAY_SIZE
(
assoc_d©a
->
lšk
));

3768 
i
 = 0; i < 
	`ARRAY_SIZE
(
d©a
.
bss
); i++)

3769 
d©a
.
bss
[
i
] = 
assoc_d©a
->
lšk
[i].bss;

3771 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

3772 
d©a
.
­_mld_addr
 = 
assoc_d©a
->
­_addr
;

3774 
	`cfg80211_assoc_çu»
(
sd©a
->
dev
, &
d©a
);

3777 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

3778 
	`›“80211_vif_£t_lšks
(
sd©a
, 0, 0);

3781 
	`kä“
(
assoc_d©a
);

3782 
sd©a
->
u
.
mgd
.
assoc_d©a
 = 
NULL
;

3783 
	}
}

3785 
	$›“80211_auth_ch®Ënge
(
›“80211_sub_if_d©a
 *
sd©a
,

3786 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

3788 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3789 
›“80211_mgd_auth_d©a
 *
auth_d©a
 = 
sd©a
->
u
.
mgd
.auth_data;

3790 cÚ¡ 
–em’t
 *
ch®Ënge
;

3791 
u8
 *
pos
;

3792 
u32
 
tx_æags
 = 0;

3793 
›“80211_´•_tx_šfo
 
šfo
 = {

3794 .
subty³
 = 
IEEE80211_STYPE_AUTH
,

3795 .
lšk_id
 = 
auth_d©a
->link_id,

3798 
pos
 = 
mgmt
->
u
.
auth
.
v¬ŸbË
;

3799 
ch®Ënge
 = 
	`cfg80211_fšd_–em
(
WLAN_EID_CHALLENGE
, 
pos
,

3800 
Ën
 - (
pos
 - (
u8
 *)
mgmt
));

3801 ià(!
ch®Ënge
)

3803 
auth_d©a
->
ex³ùed_Œª§ùiÚ
 = 4;

3804 
	`drv_mgd_´•¬e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

3805 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
))

3806 
tx_æags
 = 
IEEE80211_TX_CTL_REQ_TX_STATUS
 |

3807 
IEEE80211_TX_INTFL_MLME_CONN_TX
;

3808 
	`›“80211_£nd_auth
(
sd©a
, 3, 
auth_d©a
->
®gÜ™hm
, 0,

3809 (*)
ch®Ënge
,

3810 
ch®Ënge
->
d©®’
 + (*challenge),

3811 
auth_d©a
->
­_addr
,‡uth_data->ap_addr,

3812 
auth_d©a
->
key
,‡uth_d©a->
key_Ën
,

3813 
auth_d©a
->
key_idx
, 
tx_æags
);

3814 
	}
}

3816 
boŞ
 
	$›“80211_m¬k_¡a_auth
(
›“80211_sub_if_d©a
 *
sd©a
)

3818 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3819 cÚ¡ 
u8
 *
­_addr
 = 
ifmgd
->
auth_d©a
->ap_addr;

3820 
¡a_šfo
 *
¡a
;

3822 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3824 
	`sd©a_šfo
(
sd©a
, "authenticated\n");

3825 
ifmgd
->
auth_d©a
->
dÚe
 = 
Œue
;

3826 
ifmgd
->
auth_d©a
->
timeout
 = 
jiff›s
 + 
IEEE80211_AUTH_WAIT_ASSOC
;

3827 
ifmgd
->
auth_d©a
->
timeout_¡¬‹d
 = 
Œue
;

3828 
	`run_agaš
(
sd©a
, 
ifmgd
->
auth_d©a
->
timeout
);

3831 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
­_addr
);

3832 ià(!
¡a
) {

3833 
	`WARN_ONCE
(1, "%s: STA %pM‚Ù found", 
sd©a
->
Çme
, 
­_addr
);

3834  
çl£
;

3836 ià(
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTH
)) {

3837 
	`sd©a_šfo
(
sd©a
, "çed movšg %pMØauth\n", 
­_addr
);

3838  
çl£
;

3841  
Œue
;

3842 
	}
}

3844 
	$›“80211_rx_mgmt_auth
(
›“80211_sub_if_d©a
 *
sd©a
,

3845 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

3847 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

3848 
u16
 
auth_®g
, 
auth_Œª§ùiÚ
, 
¡©us_code
;

3849 
›“80211_ev’t
 
ev’t
 = {

3850 .
ty³
 = 
MLME_EVENT
,

3851 .
u
.
mlme
.
d©a
 = 
AUTH_EVENT
,

3853 
›“80211_´•_tx_šfo
 
šfo
 = {

3854 .
subty³
 = 
IEEE80211_STYPE_AUTH
,

3857 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

3859 ià(
Ën
 < 24 + 6)

3862 ià(!
ifmgd
->
auth_d©a
 || ifmgd->auth_d©a->
dÚe
)

3865 ià(!
	`‘h”_addr_equ®
(
ifmgd
->
auth_d©a
->
­_addr
, 
mgmt
->
bssid
))

3868 
auth_®g
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
auth
.auth_alg);

3869 
auth_Œª§ùiÚ
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
auth
.auth_transaction);

3870 
¡©us_code
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
auth
.status_code);

3872 ià(
auth_®g
 !ğ
ifmgd
->
auth_d©a
->
®gÜ™hm
 ||

3873 (
auth_®g
 !ğ
WLAN_AUTH_SAE
 &&

3874 
auth_Œª§ùiÚ
 !ğ
ifmgd
->
auth_d©a
->
ex³ùed_Œª§ùiÚ
) ||

3875 (
auth_®g
 =ğ
WLAN_AUTH_SAE
 &&

3876 (
auth_Œª§ùiÚ
 < 
ifmgd
->
auth_d©a
->
ex³ùed_Œª§ùiÚ
 ||

3877 
auth_Œª§ùiÚ
 > 2))) {

3878 
	`sd©a_šfo
(
sd©a
, "%pM unexpected‡uthentication state:‡lg %d (expected %d)ransact %d (expected %d)\n",

3879 
mgmt
->
§
, 
auth_®g
, 
ifmgd
->
auth_d©a
->
®gÜ™hm
,

3880 
auth_Œª§ùiÚ
,

3881 
ifmgd
->
auth_d©a
->
ex³ùed_Œª§ùiÚ
);

3882 
nÙify_driv”
;

3885 ià(
¡©us_code
 !ğ
WLAN_STATUS_SUCCESS
) {

3886 
	`cfg80211_rx_mlme_mgmt
(
sd©a
->
dev
, (
u8
 *)
mgmt
, 
Ën
);

3888 ià(
auth_®g
 =ğ
WLAN_AUTH_SAE
 &&

3889 (
¡©us_code
 =ğ
WLAN_STATUS_ANTI_CLOG_REQUIRED
 ||

3890 (
auth_Œª§ùiÚ
 == 1 &&

3891 (
¡©us_code
 =ğ
WLAN_STATUS_SAE_HASH_TO_ELEMENT
 ||

3892 
¡©us_code
 =ğ
WLAN_STATUS_SAE_PK
)))) {

3894 
ifmgd
->
auth_d©a
->
wa™šg
 = 
Œue
;

3895 
ifmgd
->
auth_d©a
->
timeout
 =

3896 
jiff›s
 + 
IEEE80211_AUTH_WAIT_SAE_RETRY
;

3897 
ifmgd
->
auth_d©a
->
timeout_¡¬‹d
 = 
Œue
;

3898 
	`run_agaš
(
sd©a
, 
ifmgd
->
auth_d©a
->
timeout
);

3899 
nÙify_driv”
;

3902 
	`sd©a_šfo
(
sd©a
, "%pM denied‡uthentication (status %d)\n",

3903 
mgmt
->
§
, 
¡©us_code
);

3904 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

3905 
ev’t
.
u
.
mlme
.
¡©us
 = 
MLME_DENIED
;

3906 
ev’t
.
u
.
mlme
.
»asÚ
 = 
¡©us_code
;

3907 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

3908 
nÙify_driv”
;

3911 
ifmgd
->
auth_d©a
->
®gÜ™hm
) {

3912 
WLAN_AUTH_OPEN
:

3913 
WLAN_AUTH_LEAP
:

3914 
WLAN_AUTH_FT
:

3915 
WLAN_AUTH_SAE
:

3916 
WLAN_AUTH_FILS_SK
:

3917 
WLAN_AUTH_FILS_SK_PFS
:

3918 
WLAN_AUTH_FILS_PK
:

3920 
WLAN_AUTH_SHARED_KEY
:

3921 ià(
ifmgd
->
auth_d©a
->
ex³ùed_Œª§ùiÚ
 != 4) {

3922 
	`›“80211_auth_ch®Ënge
(
sd©a
, 
mgmt
, 
Ën
);

3928 
	`WARN_ONCE
(1, "invalid‡uth‡lg %d",

3929 
ifmgd
->
auth_d©a
->
®gÜ™hm
);

3930 
nÙify_driv”
;

3933 
ev’t
.
u
.
mlme
.
¡©us
 = 
MLME_SUCCESS
;

3934 
šfo
.
sucûss
 = 1;

3935 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

3936 ià(
ifmgd
->
auth_d©a
->
®gÜ™hm
 !ğ
WLAN_AUTH_SAE
 ||

3937 (
auth_Œª§ùiÚ
 == 2 &&

3938 
ifmgd
->
auth_d©a
->
ex³ùed_Œª§ùiÚ
 == 2)) {

3939 ià(!
	`›“80211_m¬k_¡a_auth
(
sd©a
))

3941 } ià(
ifmgd
->
auth_d©a
->
®gÜ™hm
 =ğ
WLAN_AUTH_SAE
 &&

3942 
auth_Œª§ùiÚ
 == 2) {

3943 
	`sd©a_šfo
(
sd©a
, "SAE…eer confirmed\n");

3944 
ifmgd
->
auth_d©a
->
³”_cÚfœmed
 = 
Œue
;

3947 
	`cfg80211_rx_mlme_mgmt
(
sd©a
->
dev
, (
u8
 *)
mgmt
, 
Ën
);

3948 
nÙify_driv”
:

3949 
	`drv_mgd_com¶‘e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

3950 
	}
}

3952 
	#ÿ£_WLAN
(
ty³
) \

3953 
WLAN_REASON_
##
ty³
:  #ty³

	)

3955 cÚ¡ *
	$›“80211_g‘_»asÚ_code_¡ršg
(
u16
 
»asÚ_code
)

3957 
»asÚ_code
) {

3958 
	`ÿ£_WLAN
(
UNSPECIFIED
);

3959 
	`ÿ£_WLAN
(
PREV_AUTH_NOT_VALID
);

3960 
	`ÿ£_WLAN
(
DEAUTH_LEAVING
);

3961 
	`ÿ£_WLAN
(
DISASSOC_DUE_TO_INACTIVITY
);

3962 
	`ÿ£_WLAN
(
DISASSOC_AP_BUSY
);

3963 
	`ÿ£_WLAN
(
CLASS2_FRAME_FROM_NONAUTH_STA
);

3964 
	`ÿ£_WLAN
(
CLASS3_FRAME_FROM_NONASSOC_STA
);

3965 
	`ÿ£_WLAN
(
DISASSOC_STA_HAS_LEFT
);

3966 
	`ÿ£_WLAN
(
STA_REQ_ASSOC_WITHOUT_AUTH
);

3967 
	`ÿ£_WLAN
(
DISASSOC_BAD_POWER
);

3968 
	`ÿ£_WLAN
(
DISASSOC_BAD_SUPP_CHAN
);

3969 
	`ÿ£_WLAN
(
INVALID_IE
);

3970 
	`ÿ£_WLAN
(
MIC_FAILURE
);

3971 
	`ÿ£_WLAN
(4
WAY_HANDSHAKE_TIMEOUT
);

3972 
	`ÿ£_WLAN
(
GROUP_KEY_HANDSHAKE_TIMEOUT
);

3973 
	`ÿ£_WLAN
(
IE_DIFFERENT
);

3974 
	`ÿ£_WLAN
(
INVALID_GROUP_CIPHER
);

3975 
	`ÿ£_WLAN
(
INVALID_PAIRWISE_CIPHER
);

3976 
	`ÿ£_WLAN
(
INVALID_AKMP
);

3977 
	`ÿ£_WLAN
(
UNSUPP_RSN_VERSION
);

3978 
	`ÿ£_WLAN
(
INVALID_RSN_IE_CAP
);

3979 
	`ÿ£_WLAN
(
IEEE8021X_FAILED
);

3980 
	`ÿ£_WLAN
(
CIPHER_SUITE_REJECTED
);

3981 
	`ÿ£_WLAN
(
DISASSOC_UNSPECIFIED_QOS
);

3982 
	`ÿ£_WLAN
(
DISASSOC_QAP_NO_BANDWIDTH
);

3983 
	`ÿ£_WLAN
(
DISASSOC_LOW_ACK
);

3984 
	`ÿ£_WLAN
(
DISASSOC_QAP_EXCEED_TXOP
);

3985 
	`ÿ£_WLAN
(
QSTA_LEAVE_QBSS
);

3986 
	`ÿ£_WLAN
(
QSTA_NOT_USE
);

3987 
	`ÿ£_WLAN
(
QSTA_REQUIRE_SETUP
);

3988 
	`ÿ£_WLAN
(
QSTA_TIMEOUT
);

3989 
	`ÿ£_WLAN
(
QSTA_CIPHER_NOT_SUPP
);

3990 
	`ÿ£_WLAN
(
MESH_PEER_CANCELED
);

3991 
	`ÿ£_WLAN
(
MESH_MAX_PEERS
);

3992 
	`ÿ£_WLAN
(
MESH_CONFIG
);

3993 
	`ÿ£_WLAN
(
MESH_CLOSE
);

3994 
	`ÿ£_WLAN
(
MESH_MAX_RETRIES
);

3995 
	`ÿ£_WLAN
(
MESH_CONFIRM_TIMEOUT
);

3996 
	`ÿ£_WLAN
(
MESH_INVALID_GTK
);

3997 
	`ÿ£_WLAN
(
MESH_INCONSISTENT_PARAM
);

3998 
	`ÿ£_WLAN
(
MESH_INVALID_SECURITY
);

3999 
	`ÿ£_WLAN
(
MESH_PATH_ERROR
);

4000 
	`ÿ£_WLAN
(
MESH_PATH_NOFORWARD
);

4001 
	`ÿ£_WLAN
(
MESH_PATH_DEST_UNREACHABLE
);

4002 
	`ÿ£_WLAN
(
MAC_EXISTS_IN_MBSS
);

4003 
	`ÿ£_WLAN
(
MESH_CHAN_REGULATORY
);

4004 
	`ÿ£_WLAN
(
MESH_CHAN
);

4007 
	}
}

4009 
	$›“80211_rx_mgmt_d—uth
(
›“80211_sub_if_d©a
 *
sd©a
,

4010 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

4012 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

4013 
u16
 
»asÚ_code
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
d—uth
.reason_code);

4015 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4017 ià(
Ën
 < 24 + 2)

4020 ià(!
	`‘h”_addr_equ®
(
mgmt
->
bssid
, mgmt->
§
)) {

4021 
	`›“80211_tdls_hªdË_discÚÃù
(
sd©a
, 
mgmt
->
§
, 
»asÚ_code
);

4025 ià(
ifmgd
->
assocŸ‹d
 &&

4026 
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
)) {

4027 
	`sd©a_šfo
(
sd©a
, "deauthenticated from %pM (Reason: %u=%s)\n",

4028 
sd©a
->
vif
.
cfg
.
­_addr
, 
»asÚ_code
,

4029 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»asÚ_code
));

4031 
	`›“80211_£t_di§ssoc
(
sd©a
, 0, 0, 
çl£
, 
NULL
);

4033 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, (
u8
 *)
mgmt
, 
Ën
, 
çl£
,

4034 
»asÚ_code
, 
çl£
);

4038 ià(
ifmgd
->
assoc_d©a
 &&

4039 
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
ifmgd
->
assoc_d©a
->
­_addr
)) {

4040 
	`sd©a_šfo
(
sd©a
,

4042 
ifmgd
->
assoc_d©a
->
­_addr
, 
»asÚ_code
,

4043 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»asÚ_code
));

4045 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_ABANDON
);

4047 
	`cfg80211_rx_mlme_mgmt
(
sd©a
->
dev
, (
u8
 *)
mgmt
, 
Ën
);

4050 
	}
}

4053 
	$›“80211_rx_mgmt_di§ssoc
(
›“80211_sub_if_d©a
 *
sd©a
,

4054 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

4056 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

4057 
u16
 
»asÚ_code
;

4059 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

4061 ià(
Ën
 < 24 + 2)

4064 ià(!
ifmgd
->
assocŸ‹d
 ||

4065 !
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
))

4068 
»asÚ_code
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
di§ssoc
.reason_code);

4070 ià(!
	`‘h”_addr_equ®
(
mgmt
->
bssid
, mgmt->
§
)) {

4071 
	`›“80211_tdls_hªdË_discÚÃù
(
sd©a
, 
mgmt
->
§
, 
»asÚ_code
);

4075 
	`sd©a_šfo
(
sd©a
, "disassociated from %pM (Reason: %u=%s)\n",

4076 
sd©a
->
vif
.
cfg
.
­_addr
, 
»asÚ_code
,

4077 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»asÚ_code
));

4079 
	`›“80211_£t_di§ssoc
(
sd©a
, 0, 0, 
çl£
, 
NULL
);

4081 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, (
u8
 *)
mgmt
, 
Ën
, 
çl£
, 
»asÚ_code
,

4082 
çl£
);

4083 
	}
}

4085 
	$›“80211_g‘_¿‹s
(
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4086 
u8
 *
suµ_¿‹s
, 
suµ_¿‹s_Ën
,

4087 
u32
 *
¿‹s
, u32 *
basic_¿‹s
,

4088 
boŞ
 *
have_high”_thª_11mb™
,

4089 *
mš_¿‹
, *
mš_¿‹_šdex
)

4091 
i
, 
j
;

4093 
i
 = 0; i < 
suµ_¿‹s_Ën
; i++) {

4094 
¿‹
 = 
suµ_¿‹s
[
i
] & 0x7f;

4095 
boŞ
 
is_basic
 = !!(
suµ_¿‹s
[
i
] & 0x80);

4097 ià((
¿‹
 * 5) > 110)

4098 *
have_high”_thª_11mb™
 = 
Œue
;

4108 ià(
suµ_¿‹s
[
i
] =ğ(0x80 | 
BSS_MEMBERSHIP_SELECTOR_HT_PHY
) ||

4109 
suµ_¿‹s
[
i
] =ğ(0x80 | 
BSS_MEMBERSHIP_SELECTOR_VHT_PHY
) ||

4110 
suµ_¿‹s
[
i
] =ğ(0x80 | 
BSS_MEMBERSHIP_SELECTOR_HE_PHY
) ||

4111 
suµ_¿‹s
[
i
] =ğ(0x80 | 
BSS_MEMBERSHIP_SELECTOR_EHT_PHY
) ||

4112 
suµ_¿‹s
[
i
] =ğ(0x80 | 
BSS_MEMBERSHIP_SELECTOR_SAE_H2E
))

4115 
j
 = 0; j < 
sbªd
->
n_b™¿‹s
; j++) {

4116 
›“80211_¿‹
 *
br
;

4117 
b¿‹
;

4119 
br
 = &
sbªd
->
b™¿‹s
[
j
];

4121 
b¿‹
 = 
	`DIV_ROUND_UP
(
br
->
b™¿‹
, 5);

4122 ià(
b¿‹
 =ğ
¿‹
) {

4123 *
¿‹s
 |ğ
	`BIT
(
j
);

4124 ià(
is_basic
)

4125 *
basic_¿‹s
 |ğ
	`BIT
(
j
);

4126 ià((
¿‹
 * 5è< *
mš_¿‹
) {

4127 *
mš_¿‹
 = 
¿‹
 * 5;

4128 *
mš_¿‹_šdex
 = 
j
;

4134 
	}
}

4136 
boŞ
 
	$›“80211_twt_»q_suµÜ‹d
(
›“80211_sub_if_d©a
 *
sd©a
,

4137 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4138 cÚ¡ 
lšk_¡a_šfo
 *
lšk_¡a
,

4139 cÚ¡ 
›“802_11_–ems
 *
–ems
)

4141 cÚ¡ 
›“80211_¡a_he_ÿp
 *
own_he_ÿp
 =

4142 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4144 ià(
–ems
->
ext_ÿ·b_Ën
 < 10)

4145  
çl£
;

4147 ià(!(
–ems
->
ext_ÿ·b
[9] & 
WLAN_EXT_CAPA10_TWT_RESPONDER_SUPPORT
))

4148  
çl£
;

4150  
lšk_¡a
->
pub
->
he_ÿp
.
he_ÿp_–em
.
mac_ÿp_šfo
[0] &

4151 
IEEE80211_HE_MAC_CAP0_TWT_RES
 &&

4152 
own_he_ÿp
 &&

4153 (
own_he_ÿp
->
he_ÿp_–em
.
mac_ÿp_šfo
[0] &

4154 
IEEE80211_HE_MAC_CAP0_TWT_REQ
);

4155 
	}
}

4157 
u64
 
	$›“80211_»ÿlc_twt_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

4158 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4159 
›“80211_lšk_d©a
 *
lšk
,

4160 
lšk_¡a_šfo
 *
lšk_¡a
,

4161 
›“802_11_–ems
 *
–ems
)

4163 
boŞ
 
twt
 = 
	`›“80211_twt_»q_suµÜ‹d
(
sd©a
, 
sbªd
, 
lšk_¡a
, 
–ems
);

4165 ià(
lšk
->
cÚf
->
twt_»que¡”
 !ğ
twt
) {

4166 
lšk
->
cÚf
->
twt_»que¡”
 = 
twt
;

4167  
BSS_CHANGED_TWT
;

4170 
	}
}

4172 
boŞ
 
	$›“80211_twt_bÿ¡_suµÜt
(
›“80211_sub_if_d©a
 *
sd©a
,

4173 
›“80211_bss_cÚf
 *
bss_cÚf
,

4174 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4175 
lšk_¡a_šfo
 *
lšk_¡a
)

4177 cÚ¡ 
›“80211_¡a_he_ÿp
 *
own_he_ÿp
 =

4178 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4180  
bss_cÚf
->
he_suµÜt
 &&

4181 (
lšk_¡a
->
pub
->
he_ÿp
.
he_ÿp_–em
.
mac_ÿp_šfo
[2] &

4182 
IEEE80211_HE_MAC_CAP2_BCAST_TWT
) &&

4183 
own_he_ÿp
 &&

4184 (
own_he_ÿp
->
he_ÿp_–em
.
mac_ÿp_šfo
[2] &

4185 
IEEE80211_HE_MAC_CAP2_BCAST_TWT
);

4186 
	}
}

4188 
boŞ
 
	$›“80211_assoc_cÚfig_lšk
(
›“80211_lšk_d©a
 *
lšk
,

4189 
lšk_¡a_šfo
 *
lšk_¡a
,

4190 
cfg80211_bss
 *
cbss
,

4191 
›“80211_mgmt
 *
mgmt
,

4192 cÚ¡ 
u8
 *
–em_¡¬t
,

4193 
–em_Ën
,

4194 
u64
 *
chªged
)

4196 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

4197 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
sd©a
->
u
.
mgd
.assoc_data;

4198 
›“80211_bss_cÚf
 *
bss_cÚf
 = 
lšk
->
cÚf
;

4199 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4200 
lšk_id
 = 
lšk
->link_id;

4201 
›“80211_–ems_·r£_·¿ms
 
·r£_·¿ms
 = {

4202 .
mode
 = 
lšk
->
u
.
mgd
.
cÚn
.mode,

4203 .
¡¬t
 = 
–em_¡¬t
,

4204 .
Ën
 = 
–em_Ën
,

4205 .
lšk_id
 =†šk_id =ğ
assoc_d©a
->
assoc_lšk_id
 ? -1 :†ink_id,

4206 .
äom_­
 = 
Œue
,

4208 
boŞ
 
is_5ghz
 = 
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_5GHZ
;

4209 
boŞ
 
is_6ghz
 = 
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_6GHZ
;

4210 
boŞ
 
is_s1g
 = 
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_S1GHZ
;

4211 cÚ¡ 
cfg80211_bss_›s
 *
bss_›s
 = 
NULL
;

4212 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

4213 
›“802_11_–ems
 *
–ems
;

4214 cÚ¡ 
__Ë16
 
´of_bss_·¿m_ch_´e£Á
 =

4215 
	`ıu_to_Ë16
(
IEEE80211_MLE_STA_CONTROL_BSS_PARAM_CHANGE_CNT_PRESENT
);

4216 
u16
 
ÿ·b_šfo
;

4217 
boŞ
 
»t
;

4219 
–ems
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

4220 ià(!
–ems
)

4221  
çl£
;

4223 ià(
lšk_id
 =ğ
assoc_d©a
->
assoc_lšk_id
) {

4224 
ÿ·b_šfo
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
assoc_»¥
.capab_info);

4230 
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
 = 
WLAN_STATUS_SUCCESS
;

4231 ià(
–ems
->
ml_basic
) {

4232 
bss_·¿m_ch_út
 =

4233 
	`›“80211_mË_g‘_bss_·¿m_ch_út
((cÚ¡ *)
–ems
->
ml_basic
);

4235 ià(
bss_·¿m_ch_út
 < 0) {

4236 
»t
 = 
çl£
;

4237 
out
;

4239 
lšk
->
u
.
mgd
.
bss_·¿m_ch_út
 = bss_param_ch_cnt;

4241 } ià(
–ems
->
·r£_”rÜ
 & 
IEEE80211_PARSE_ERR_DUP_NEST_ML_BASIC
 ||

4242 !
–ems
->
´of
 ||

4243 !(
–ems
->
´of
->
cÚŒŞ
 & 
´of_bss_·¿m_ch_´e£Á
)) {

4244 
»t
 = 
çl£
;

4245 
out
;

4247 cÚ¡ 
u8
 *
±r
 = 
–ems
->
´of
->
v¬ŸbË
 +

4248 
–ems
->
´of
->
¡a_šfo_Ën
 - 1;

4254 
ÿ·b_šfo
 = 
	`g‘_uÇligÃd_Ë16
(
±r
);

4255 
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
 = 
	`g‘_uÇligÃd_Ë16
(
±r
 + 2);

4256 
lšk
->
u
.
mgd
.
bss_·¿m_ch_út
 =

4257 
	`›“80211_mË_basic_¡a_´of_bss_·¿m_ch_út
(
–ems
->
´of
);

4259 ià(
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
 !ğ
WLAN_STATUS_SUCCESS
) {

4260 
	`lšk_šfo
(
lšk
, "association„esponse status code=%u\n",

4261 
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
);

4262 
»t
 = 
Œue
;

4263 
out
;

4267 ià(!
is_s1g
 && !
–ems
->
suµ_¿‹s
) {

4268 
	`sd©a_šfo
(
sd©a
, "no SuppRatesƒlement in AssocResp\n");

4269 
»t
 = 
çl£
;

4270 
out
;

4273 
lšk
->
u
.
mgd
.
tdls_chª_sw™ch_´ohib™ed
 =

4274 
–ems
->
ext_ÿ·b
 &&ƒËms->
ext_ÿ·b_Ën
 >= 5 &&

4275 (
–ems
->
ext_ÿ·b
[4] & 
WLAN_EXT_CAPA5_TDLS_CH_SW_PROHIBITED
);

4284 ià(!
is_6ghz
 &&

4285 ((
assoc_d©a
->
wmm
 && !
–ems
->
wmm_·¿m
) ||

4286 (
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
 &&

4287 (!
–ems
->
ht_ÿp_–em
 || !–ems->
ht_İ”©iÚ
)) ||

4288 (
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_VHT
 &&

4289 (!
–ems
->
vht_ÿp_–em
 || !–ems->
vht_İ”©iÚ
)))) {

4290 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

4291 
›“802_11_–ems
 *
bss_–ems
;

4293 
	`rcu_»ad_lock
();

4294 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

4295 ià(
›s
)

4296 
bss_›s
 = 
	`kmemdup
(
›s
, (*›sè+ ies->
Ën
,

4297 
GFP_ATOMIC
);

4298 
	`rcu_»ad_uÆock
();

4299 ià(!
bss_›s
) {

4300 
»t
 = 
çl£
;

4301 
out
;

4304 
·r£_·¿ms
.
¡¬t
 = 
bss_›s
->
d©a
;

4305 
·r£_·¿ms
.
Ën
 = 
bss_›s
->len;

4306 
·r£_·¿ms
.
bss
 = 
cbss
;

4307 
bss_–ems
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

4308 ià(!
bss_–ems
) {

4309 
»t
 = 
çl£
;

4310 
out
;

4313 ià(
assoc_d©a
->
wmm
 &&

4314 !
–ems
->
wmm_·¿m
 && 
bss_–ems
->wmm_param) {

4315 
–ems
->
wmm_·¿m
 = 
bss_–ems
->wmm_param;

4316 
	`sd©a_šfo
(
sd©a
,

4324 ià(!
–ems
->
ht_ÿp_–em
 && 
bss_–ems
->ht_cap_elem &&

4325 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
) {

4326 
–ems
->
ht_ÿp_–em
 = 
bss_–ems
->ht_cap_elem;

4327 
	`sd©a_šfo
(
sd©a
,

4330 ià(!
–ems
->
ht_İ”©iÚ
 && 
bss_–ems
->ht_operation &&

4331 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
) {

4332 
–ems
->
ht_İ”©iÚ
 = 
bss_–ems
->ht_operation;

4333 
	`sd©a_šfo
(
sd©a
,

4336 ià(!
–ems
->
vht_ÿp_–em
 && 
bss_–ems
->vht_cap_elem &&

4337 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_VHT
) {

4338 
–ems
->
vht_ÿp_–em
 = 
bss_–ems
->vht_cap_elem;

4339 
	`sd©a_šfo
(
sd©a
,

4342 ià(!
–ems
->
vht_İ”©iÚ
 && 
bss_–ems
->vht_operation &&

4343 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_VHT
) {

4344 
–ems
->
vht_İ”©iÚ
 = 
bss_–ems
->vht_operation;

4345 
	`sd©a_šfo
(
sd©a
,

4349 
	`kä“
(
bss_–ems
);

4358 ià(!
is_6ghz
 && 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
 &&

4359 (!
–ems
->
wmm_·¿m
 || !–ems->
ht_ÿp_–em
 || !–ems->
ht_İ”©iÚ
)) {

4360 
	`sd©a_šfo
(
sd©a
,

4362 
»t
 = 
çl£
;

4363 
out
;

4366 ià(
is_5ghz
 && 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_VHT
 &&

4367 (!
–ems
->
vht_ÿp_–em
 || !–ems->
vht_İ”©iÚ
)) {

4368 
	`sd©a_šfo
(
sd©a
,

4370 
»t
 = 
çl£
;

4371 
out
;

4375 ià(
	`›“80211_cÚfig_bw
(
lšk
, 
–ems
,

4376 
lšk_id
 =ğ
assoc_d©a
->
assoc_lšk_id
,

4377 
chªged
)) {

4378 
»t
 = 
çl£
;

4379 
out
;

4382 ià(
	`WARN_ON
(!
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
)) {

4383 
»t
 = 
çl£
;

4384 
out
;

4386 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
->
bªd
];

4389 ià(
–ems
->
ht_ÿp_–em
 && 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
)

4390 
	`›“80211_ht_ÿp_›_to_¡a_ht_ÿp
(
sd©a
, 
sbªd
,

4391 
–ems
->
ht_ÿp_–em
,

4392 
lšk_¡a
);

4394 ià(
–ems
->
vht_ÿp_–em
 &&

4395 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_VHT
) {

4396 cÚ¡ 
›“80211_vht_ÿp
 *
bss_vht_ÿp
 = 
NULL
;

4397 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

4405 
	`rcu_»ad_lock
();

4406 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

4407 ià(
›s
) {

4408 cÚ¡ 
–em’t
 *
–em
;

4410 
–em
 = 
	`cfg80211_fšd_–em
(
WLAN_EID_VHT_CAPABILITY
,

4411 
›s
->
d©a
, ies->
Ën
);

4412 ià(
–em
 &&ƒËm->
d©®’
 >ğ(*
bss_vht_ÿp
))

4413 
bss_vht_ÿp
 = (cÚ¡ *)
–em
->
d©a
;

4416 
	`›“80211_vht_ÿp_›_to_¡a_vht_ÿp
(
sd©a
, 
sbªd
,

4417 
–ems
->
vht_ÿp_–em
,

4418 
bss_vht_ÿp
, 
lšk_¡a
);

4419 
	`rcu_»ad_uÆock
();

4422 ià(
–ems
->
he_İ”©iÚ
 &&

4423 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HE
 &&

4424 
–ems
->
he_ÿp
) {

4425 cÚ¡ 
›“80211_he_6ghz_İ”
 *
he_6ghz_İ”
;

4427 
	`›“80211_he_ÿp_›_to_¡a_he_ÿp
(
sd©a
, 
sbªd
,

4428 
–ems
->
he_ÿp
,

4429 
–ems
->
he_ÿp_Ën
,

4430 
–ems
->
he_6ghz_ÿ·
,

4431 
lšk_¡a
);

4433 
he_6ghz_İ”
 = 
	`›“80211_he_6ghz_İ”
(
–ems
->
he_İ”©iÚ
);

4435 ià(
is_6ghz
 && 
he_6ghz_İ”
) {

4436 
	`u8_g‘_b™s
(
he_6ghz_İ”
->
cÚŒŞ
,

4437 
IEEE80211_HE_6GHZ_OPER_CTRL_REG_INFO
)) {

4438 
IEEE80211_6GHZ_CTRL_REG_LPI_AP
:

4439 
bss_cÚf
->
pow”_ty³
 = 
IEEE80211_REG_LPI_AP
;

4441 
IEEE80211_6GHZ_CTRL_REG_SP_AP
:

4442 
bss_cÚf
->
pow”_ty³
 = 
IEEE80211_REG_SP_AP
;

4444 
IEEE80211_6GHZ_CTRL_REG_VLP_AP
:

4445 
bss_cÚf
->
pow”_ty³
 = 
IEEE80211_REG_VLP_AP
;

4448 
bss_cÚf
->
pow”_ty³
 = 
IEEE80211_REG_UNSET_AP
;

4451 } ià(
is_6ghz
) {

4452 
	`lšk_šfo
(
lšk
,

4454 
bss_cÚf
->
chª»q
.
İ”
.
chª
->
ûÁ”_äeq
);

4457 
bss_cÚf
->
he_suµÜt
 = 
lšk_¡a
->
pub
->
he_ÿp
.
has_he
;

4458 ià(
–ems
->
r¢x
 &&ƒËms->
r¢x_Ën
 &&

4459 (
–ems
->
r¢x
[0] & 
WLAN_RSNX_CAPA_PROTECTED_TWT
) &&

4460 
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
,

4461 
NL80211_EXT_FEATURE_PROTECTED_TWT
))

4462 
bss_cÚf
->
twt_´Ùeùed
 = 
Œue
;

4464 
bss_cÚf
->
twt_´Ùeùed
 = 
çl£
;

4466 *
chªged
 |ğ
	`›“80211_»ÿlc_twt_»q
(
sd©a
, 
sbªd
, 
lšk
,

4467 
lšk_¡a
, 
–ems
);

4469 ià(
–ems
->
eht_İ”©iÚ
 &&ƒËms->
eht_ÿp
 &&

4470 
lšk
->
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_EHT
) {

4471 
	`›“80211_eht_ÿp_›_to_¡a_eht_ÿp
(
sd©a
, 
sbªd
,

4472 
–ems
->
he_ÿp
,

4473 
–ems
->
he_ÿp_Ën
,

4474 
–ems
->
eht_ÿp
,

4475 
–ems
->
eht_ÿp_Ën
,

4476 
lšk_¡a
);

4478 
bss_cÚf
->
eht_suµÜt
 = 
lšk_¡a
->
pub
->
eht_ÿp
.
has_eht
;

4480 
bss_cÚf
->
eht_suµÜt
 = 
çl£
;

4483 
bss_cÚf
->
he_suµÜt
 = 
çl£
;

4484 
bss_cÚf
->
twt_»que¡”
 = 
çl£
;

4485 
bss_cÚf
->
twt_´Ùeùed
 = 
çl£
;

4486 
bss_cÚf
->
eht_suµÜt
 = 
çl£
;

4489 
bss_cÚf
->
twt_brßdÿ¡
 =

4490 
	`›“80211_twt_bÿ¡_suµÜt
(
sd©a
, 
bss_cÚf
, 
sbªd
, 
lšk_¡a
);

4492 ià(
bss_cÚf
->
he_suµÜt
) {

4493 
bss_cÚf
->
he_bss_cŞÜ
.
cŞÜ
 =

4494 
	`Ë32_g‘_b™s
(
–ems
->
he_İ”©iÚ
->
he_İ”_·¿ms
,

4495 
IEEE80211_HE_OPERATION_BSS_COLOR_MASK
);

4496 
bss_cÚf
->
he_bss_cŞÜ
.
·¹Ÿl
 =

4497 
	`Ë32_g‘_b™s
(
–ems
->
he_İ”©iÚ
->
he_İ”_·¿ms
,

4498 
IEEE80211_HE_OPERATION_PARTIAL_BSS_COLOR
);

4499 
bss_cÚf
->
he_bss_cŞÜ
.
’abËd
 =

4500 !
	`Ë32_g‘_b™s
(
–ems
->
he_İ”©iÚ
->
he_İ”_·¿ms
,

4501 
IEEE80211_HE_OPERATION_BSS_COLOR_DISABLED
);

4503 ià(
bss_cÚf
->
he_bss_cŞÜ
.
’abËd
)

4504 *
chªged
 |ğ
BSS_CHANGED_HE_BSS_COLOR
;

4506 
bss_cÚf
->
htc_Œig_ba£d_pkt_ext
 =

4507 
	`Ë32_g‘_b™s
(
–ems
->
he_İ”©iÚ
->
he_İ”_·¿ms
,

4508 
IEEE80211_HE_OPERATION_DFLT_PE_DURATION_MASK
);

4509 
bss_cÚf
->
äame_time_¹s_th
 =

4510 
	`Ë32_g‘_b™s
(
–ems
->
he_İ”©iÚ
->
he_İ”_·¿ms
,

4511 
IEEE80211_HE_OPERATION_RTS_THRESHOLD_MASK
);

4513 
bss_cÚf
->
uÜa_exi¡s
 = !!
–ems
->
uÜa_–em’t
;

4514 ià(
–ems
->
uÜa_–em’t
)

4515 
bss_cÚf
->
uÜa_ocw_¿nge
 = 
–ems
->
uÜa_–em’t
[0];

4517 
	`›“80211_he_İ_›_to_bss_cÚf
(&
sd©a
->
vif
, 
–ems
->
he_İ”©iÚ
);

4518 
	`›“80211_he_¥r_›_to_bss_cÚf
(&
sd©a
->
vif
, 
–ems
->
he_¥r
);

4522 ià(
cbss
->
Œªsm™‹d_bss
) {

4523 
bss_cÚf
->
nÚŒªsm™‹d
 = 
Œue
;

4524 
	`‘h”_addr_cİy
(
bss_cÚf
->
Œªsm™‹r_bssid
,

4525 
cbss
->
Œªsm™‹d_bss
->
bssid
);

4526 
bss_cÚf
->
bssid_šdiÿtÜ
 = 
cbss
->
max_bssid_šdiÿtÜ
;

4527 
bss_cÚf
->
bssid_šdex
 = 
cbss
->bssid_index;

4542 ià(
–ems
->
İmode_nÙif
 &&

4543 !(*
–ems
->
İmode_nÙif
 & 
IEEE80211_OPMODE_NOTIF_RX_NSS_TYPE_BF
)) {

4544 
u8
 
nss
;

4546 
nss
 = *
–ems
->
İmode_nÙif
 & 
IEEE80211_OPMODE_NOTIF_RX_NSS_MASK
;

4547 
nss
 >>ğ
IEEE80211_OPMODE_NOTIF_RX_NSS_SHIFT
;

4548 
nss
 += 1;

4549 
lšk_¡a
->
pub
->
rx_nss
 = 
nss
;

4558 
lšk
->
u
.
mgd
.
wmm_Ï¡_·¿m_£t
 = -1;

4559 
lšk
->
u
.
mgd
.
mu_edÿ_Ï¡_·¿m_£t
 = -1;

4561 ià(
lšk
->
u
.
mgd
.
di§bË_wmm_Œackšg
) {

4562 
	`›“80211_£t_wmm_deçuÉ
(
lšk
, 
çl£
, false);

4563 } ià(!
	`›“80211_¡a_wmm_·¿ms
(
loÿl
, 
lšk
, 
–ems
->
wmm_·¿m
,

4564 
–ems
->
wmm_·¿m_Ën
,

4565 
–ems
->
mu_edÿ_·¿m_£t
)) {

4567 
	`›“80211_£t_wmm_deçuÉ
(
lšk
, 
çl£
, 
Œue
);

4575 
lšk
->
u
.
mgd
.
di§bË_wmm_Œackšg
 = 
Œue
;

4578 ià(
–ems
->
max_idË_³riod_›
) {

4579 
bss_cÚf
->
max_idË_³riod
 =

4580 
	`Ë16_to_ıu
(
–ems
->
max_idË_³riod_›
->
max_idË_³riod
);

4581 
bss_cÚf
->
´Ùeùed_k“p_®ive
 =

4582 !!(
–ems
->
max_idË_³riod_›
->
idË_İtiÚs
 &

4583 
WLAN_IDLE_OPTIONS_PROTECTED_KEEP_ALIVE
);

4584 *
chªged
 |ğ
BSS_CHANGED_KEEP_ALIVE
;

4586 
bss_cÚf
->
max_idË_³riod
 = 0;

4587 
bss_cÚf
->
´Ùeùed_k“p_®ive
 = 
çl£
;

4592 
bss_cÚf
->
assoc_ÿ·b™y
 = 
ÿ·b_šfo
;

4594 
»t
 = 
Œue
;

4595 
out
:

4596 
	`kä“
(
–ems
);

4597 
	`kä“
(
bss_›s
);

4598  
»t
;

4599 
	}
}

4601 
	$›“80211_mgd_£tup_lšk_¡a
(
›“80211_lšk_d©a
 *
lšk
,

4602 
¡a_šfo
 *
¡a
,

4603 
lšk_¡a_šfo
 *
lšk_¡a
,

4604 
cfg80211_bss
 *
cbss
)

4606 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

4607 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4608 
›“80211_bss
 *
bss
 = (*)
cbss
->
´iv
;

4609 
u32
 
¿‹s
 = 0, 
basic_¿‹s
 = 0;

4610 
boŞ
 
have_high”_thª_11mb™
 = 
çl£
;

4611 
mš_¿‹
 = 
INT_MAX
, 
mš_¿‹_šdex
 = -1;

4612 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

4614 
	`memıy
(
lšk_¡a
->
addr
, 
cbss
->
bssid
, 
ETH_ALEN
);

4615 
	`memıy
(
lšk_¡a
->
pub
->
addr
, 
cbss
->
bssid
, 
ETH_ALEN
);

4618 ià(
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

4619 
	`›“80211_s1g_¡a_¿‹_š™
(
¡a
);

4623 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
cbss
->
chªÃl
->
bªd
];

4625 
	`›“80211_g‘_¿‹s
(
sbªd
, 
bss
->
suµ_¿‹s
, bss->
suµ_¿‹s_Ën
,

4626 &
¿‹s
, &
basic_¿‹s
, &
have_high”_thª_11mb™
,

4627 &
mš_¿‹
, &
mš_¿‹_šdex
);

4639 ià(
mš_¿‹_šdex
 < 0) {

4640 
	`lšk_šfo
(
lšk
, "No†egacy„ates in‡ssociation„esponse\n");

4641  -
EINVAL
;

4642 } ià(!
basic_¿‹s
) {

4643 
	`lšk_šfo
(
lšk
, "No basic„ates, using min„ate instead\n");

4644 
basic_¿‹s
 = 
	`BIT
(
mš_¿‹_šdex
);

4647 ià(
¿‹s
)

4648 
lšk_¡a
->
pub
->
suµ_¿‹s
[
cbss
->
chªÃl
->
bªd
] = 
¿‹s
;

4650 
	`lšk_šfo
(
lšk
, "No„ates found, keeping mandatory only\n");

4652 
lšk
->
cÚf
->
basic_¿‹s
 = basic_rates;

4655 
lšk
->
İ”©šg_11g_mode
 = 
sbªd
->
bªd
 =ğ
NL80211_BAND_2GHZ
 &&

4656 
have_high”_thª_11mb™
;

4659 
	}
}

4661 
u8
 
	$›“80211_max_rx_chašs
(
›“80211_lšk_d©a
 *
lšk
,

4662 
cfg80211_bss
 *
cbss
)

4664 
›“80211_he_mcs_nss_suµ
 *
he_mcs_nss_suµ
;

4665 cÚ¡ 
–em’t
 *
ht_ÿp_–em
, *
vht_ÿp_–em
;

4666 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

4667 cÚ¡ 
›“80211_ht_ÿp
 *
ht_ÿp
;

4668 cÚ¡ 
›“80211_vht_ÿp
 *
vht_ÿp
;

4669 cÚ¡ 
›“80211_he_ÿp_–em
 *
he_ÿp
;

4670 cÚ¡ 
–em’t
 *
he_ÿp_–em
;

4671 
u16
 
mcs_80_m­
, 
mcs_160_m­
;

4672 
i
, 
mcs_nss_size
;

4673 
boŞ
 
suµÜt_160
;

4674 
u8
 
chašs
 = 1;

4676 ià(
lšk
->
u
.
mgd
.
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_HT
)

4677  
chašs
;

4679 
ht_ÿp_–em
 = 
	`›“80211_bss_g‘_–em
(
cbss
, 
WLAN_EID_HT_CAPABILITY
);

4680 ià(
ht_ÿp_–em
 && ht_ÿp_–em->
d©®’
 >ğ(*
ht_ÿp
)) {

4681 
ht_ÿp
 = (*)
ht_ÿp_–em
->
d©a
;

4682 
chašs
 = 
	`›“80211_mcs_to_chašs
(&
ht_ÿp
->
mcs
);

4689 ià(
lšk
->
u
.
mgd
.
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_VHT
)

4690  
chašs
;

4692 
vht_ÿp_–em
 = 
	`›“80211_bss_g‘_–em
(
cbss
, 
WLAN_EID_VHT_CAPABILITY
);

4693 ià(
vht_ÿp_–em
 && vht_ÿp_–em->
d©®’
 >ğ(*
vht_ÿp
)) {

4694 
u8
 
nss
;

4695 
u16
 
tx_mcs_m­
;

4697 
vht_ÿp
 = (*)
vht_ÿp_–em
->
d©a
;

4698 
tx_mcs_m­
 = 
	`Ë16_to_ıu
(
vht_ÿp
->
suµ_mcs
.tx_mcs_map);

4699 
nss
 = 8;‚ss > 0;‚ss--) {

4700 ià(((
tx_mcs_m­
 >> (2 * (
nss
 - 1))) & 3) !=

4701 
IEEE80211_VHT_MCS_NOT_SUPPORTED
)

4705 
chašs
 = 
	`max
(chašs, 
nss
);

4708 ià(
lšk
->
u
.
mgd
.
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_HE
)

4709  
chašs
;

4711 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

4712 
he_ÿp_–em
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_HE_CAPABILITY
,

4713 
›s
->
d©a
, ies->
Ën
);

4715 ià(!
he_ÿp_–em
 || he_ÿp_–em->
d©®’
 < (*
he_ÿp
))

4716  
chašs
;

4719 
he_ÿp
 = (*)(
he_ÿp_–em
->
d©a
 + 1);

4720 
mcs_nss_size
 = 
	`›“80211_he_mcs_nss_size
(
he_ÿp
);

4723 ià(
he_ÿp_–em
->
d©®’
 < 1 + 
mcs_nss_size
 + (*
he_ÿp
))

4724  
chašs
;

4727 
he_mcs_nss_suµ
 = (*)(
he_ÿp
 + 1);

4729 
mcs_80_m­
 = 
	`Ë16_to_ıu
(
he_mcs_nss_suµ
->
tx_mcs_80
);

4731 
i
 = 7; i >= 0; i--) {

4732 
u8
 
mcs_80
 = 
mcs_80_m­
 >> (2 * 
i
) & 3;

4734 ià(
mcs_80
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
) {

4735 
chašs
 = 
	`max_t
(
u8
, chašs, 
i
 + 1);

4740 
suµÜt_160
 = 
he_ÿp
->
phy_ÿp_šfo
[0] &

4741 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

4743 ià(!
suµÜt_160
)

4744  
chašs
;

4746 
mcs_160_m­
 = 
	`Ë16_to_ıu
(
he_mcs_nss_suµ
->
tx_mcs_160
);

4747 
i
 = 7; i >= 0; i--) {

4748 
u8
 
mcs_160
 = 
mcs_160_m­
 >> (2 * 
i
) & 3;

4750 ià(
mcs_160
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
) {

4751 
chašs
 = 
	`max_t
(
u8
, chašs, 
i
 + 1);

4756  
chašs
;

4757 
	}
}

4760 
	$›“80211_d‘”mše_our_¡a_mode
(
›“80211_sub_if_d©a
 *
sd©a
,

4761 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4762 
cfg80211_assoc_»que¡
 *
»q
,

4763 
boŞ
 
wmm_u£d
, 
lšk_id
,

4764 
›“80211_cÚn_£‰šgs
 *
cÚn
)

4766 
›“80211_¡a_ht_ÿp
 
¡a_ht_ÿp
 = 
sbªd
->
ht_ÿp
;

4767 
boŞ
 
is_5ghz
 = 
sbªd
->
bªd
 =ğ
NL80211_BAND_5GHZ
;

4768 
boŞ
 
is_6ghz
 = 
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
;

4769 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
;

4770 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
;

4771 
›“80211_¡a_vht_ÿp
 
vht_ÿp
;

4773 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

4774 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_S1G
;

4775 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

4776 
	`mlme_dbg
(
sd©a
, "operating‡s S1G STA\n");

4780 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_LEGACY
;

4781 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

4783 
	`›“80211_­¶y_htÿp_ov”rides
(
sd©a
, &
¡a_ht_ÿp
);

4785 ià(
»q
 &&„eq->
æags
 & 
ASSOC_REQ_DISABLE_HT
) {

4786 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4788 
out
;

4791 ià(!
wmm_u£d
) {

4792 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4794 
out
;

4797 ià(
»q
) {

4798 
i
;

4800 
i
 = 0; i < 
»q
->
üy±o
.
n_ch”s_·œwi£
; i++) {

4801 ià(
»q
->
üy±o
.
ch”s_·œwi£
[
i
] =ğ
WLAN_CIPHER_SUITE_WEP40
 ||

4802 
»q
->
üy±o
.
ch”s_·œwi£
[
i
] =ğ
WLAN_CIPHER_SUITE_TKIP
 ||

4803 
»q
->
üy±o
.
ch”s_·œwi£
[
i
] =ğ
WLAN_CIPHER_SUITE_WEP104
) {

4804 
	`Ãtdev_šfo
(
sd©a
->
dev
,

4806 
out
;

4811 ià(!
¡a_ht_ÿp
.
ht_suµÜ‹d
 && !
is_6ghz
) {

4812 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4814 
out
;

4818 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_HT
;

4819 
cÚn
->
bw_lim™
 = 
¡a_ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 ?

4820 
IEEE80211_CONN_BW_LIMIT_40
 :

4821 
IEEE80211_CONN_BW_LIMIT_20
;

4823 
	`memıy
(&
vht_ÿp
, &
sbªd
->vht_cap, (vht_cap));

4824 
	`›“80211_­¶y_vhtÿp_ov”rides
(
sd©a
, &
vht_ÿp
);

4826 ià(
»q
 &&„eq->
æags
 & 
ASSOC_REQ_DISABLE_VHT
) {

4827 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4829 
out
;

4832 ià(
vht_ÿp
.
vht_suµÜ‹d
 && 
is_5ghz
) {

4833 
boŞ
 
have_80mhz
 = 
çl£
;

4834 
i
;

4836 ià(
cÚn
->
bw_lim™
 =ğ
IEEE80211_CONN_BW_LIMIT_20
) {

4837 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4839 
out
;

4843 
i
 = 0; i < 
sbªd
->
n_chªÃls
; i++) {

4844 ià(
sbªd
->
chªÃls
[
i
].
æags
 & (
IEEE80211_CHAN_DISABLED
 |

4845 
IEEE80211_CHAN_NO_80MHZ
))

4848 
have_80mhz
 = 
Œue
;

4852 ià(!
have_80mhz
) {

4853 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4855 
out
;

4857 } ià(
is_5ghz
) {

4858 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4860 
out
;

4864 ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_2GHZ
) {

4865 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_VHT
;

4866 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_160
;

4869 ià(
is_5ghz
 &&

4870 !(
vht_ÿp
.
ÿp
 & (
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
 |

4871 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
))) {

4872 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_80
;

4873 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4877 ià(
»q
 &&„eq->
æags
 & 
ASSOC_REQ_DISABLE_HE
) {

4878 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4880 
out
;

4883 
he_ÿp
 = 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4884 ià(!
he_ÿp
) {

4885 
	`WARN_ON
(
is_6ghz
);

4886 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4888 
out
;

4892 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_HE
;

4895 
sbªd
->
bªd
) {

4897 
NL80211_BAND_2GHZ
:

4898 ià(
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

4899 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
)

4901 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

4902 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4905 
NL80211_BAND_5GHZ
:

4906 ià(!(
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

4907 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_80MHZ_IN_5G
)) {

4908 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

4909 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4913 ià(!(
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

4914 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
)) {

4915 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

4916 
cÚn
->
bw_lim™
,

4917 
IEEE80211_CONN_BW_LIMIT_80
);

4918 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4922 
NL80211_BAND_6GHZ
:

4923 ià(
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

4924 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
)

4926 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

4927 
cÚn
->
bw_lim™
,

4928 
IEEE80211_CONN_BW_LIMIT_80
);

4929 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4934 ià(
»q
 &&„eq->
æags
 & 
ASSOC_REQ_DISABLE_EHT
) {

4935 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4937 
out
;

4940 
eht_ÿp
 = 
	`›“80211_g‘_eht_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4941 ià(!
eht_ÿp
) {

4942 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4944 
out
;

4949 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_EHT
;

4952 ià(
is_6ghz
 &&

4953 
eht_ÿp
->
eht_ÿp_–em
.
phy_ÿp_šfo
[0] & 
IEEE80211_EHT_PHY_CAP0_320MHZ_IN_6GHZ
)

4954 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_320
;

4955 ià(
is_6ghz
)

4956 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4959 
out
:

4960 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
,

4962 
	`›“80211_cÚn_mode_¡r
(
cÚn
->
mode
),

4963 20 * (1 << 
cÚn
->
bw_lim™
));

4964 
	}
}

4967 
	$›“80211_d‘”mše_our_¡a_mode_auth
(
›“80211_sub_if_d©a
 *
sd©a
,

4968 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4969 
cfg80211_auth_»que¡
 *
»q
,

4970 
boŞ
 
wmm_u£d
,

4971 
›“80211_cÚn_£‰šgs
 *
cÚn
)

4973 
	`›“80211_d‘”mše_our_¡a_mode
(
sd©a
, 
sbªd
, 
NULL
, 
wmm_u£d
,

4974 
»q
->
lšk_id
 > 0 ?„eq->link_id : 0,

4975 
cÚn
);

4976 
	}
}

4979 
	$›“80211_d‘”mše_our_¡a_mode_assoc
(
›“80211_sub_if_d©a
 *
sd©a
,

4980 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4981 
cfg80211_assoc_»que¡
 *
»q
,

4982 
boŞ
 
wmm_u£d
, 
lšk_id
,

4983 
›“80211_cÚn_£‰šgs
 *
cÚn
)

4985 
›“80211_cÚn_£‰šgs
 
tmp
;

4987 
	`WARN_ON
(!
»q
);

4989 
	`›“80211_d‘”mše_our_¡a_mode
(
sd©a
, 
sbªd
, 
»q
, 
wmm_u£d
, 
lšk_id
,

4990 &
tmp
);

4992 
cÚn
->
mode
 = 
	`mš_t
(
›“80211_cÚn_mode
,

4993 
cÚn
->
mode
, 
tmp
.mode);

4994 
cÚn
->
bw_lim™
 = 
	`mš_t
(
›“80211_cÚn_bw_lim™
,

4995 
cÚn
->
bw_lim™
, 
tmp
.bw_limit);

4996 
	}
}

4998 
	$›“80211_´•_chªÃl
(
›“80211_sub_if_d©a
 *
sd©a
,

4999 
›“80211_lšk_d©a
 *
lšk
,

5000 
lšk_id
,

5001 
cfg80211_bss
 *
cbss
, 
boŞ
 
mlo
,

5002 
›“80211_cÚn_£‰šgs
 *
cÚn
)

5004 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

5005 
boŞ
 
is_6ghz
 = 
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_6GHZ
;

5006 
›“80211_chª_»q
 
chª»q
 = {};

5007 
›“802_11_–ems
 *
–ems
;

5008 
»t
;

5009 
u32
 
i
;

5011 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

5013 
	`rcu_»ad_lock
();

5014 
–ems
 = 
	`›“80211_d‘”mše_chª_mode
(
sd©a
, 
cÚn
, 
cbss
, 
lšk_id
,

5015 &
chª»q
);

5017 ià(
	`IS_ERR
(
–ems
)) {

5018 
	`rcu_»ad_uÆock
();

5019  
	`PTR_ERR
(
–ems
);

5022 ià(
mlo
 && !
–ems
->
ml_basic
) {

5023 
	`sd©a_šfo
(
sd©a
, "Rejecting MLO‡s it is‚ot supported by AP\n");

5024 
	`rcu_»ad_uÆock
();

5025 
	`kä“
(
–ems
);

5026  -
EINVAL
;

5029 ià(
lšk
 && 
is_6ghz
 && 
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_HE
) {

5030 
›“80211_bss_cÚf
 *
bss_cÚf
;

5031 
u8
 
j
 = 0;

5033 
bss_cÚf
 = 
lšk
->
cÚf
;

5035 ià(
–ems
->
pwr_cÚ¡r_–em
)

5036 
bss_cÚf
->
pwr_»duùiÚ
 = *
–ems
->
pwr_cÚ¡r_–em
;

5038 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
bss_cÚf
->
tx_pwr_’v
) !=

5039 
	`ARRAY_SIZE
(
–ems
->
tx_pwr_’v
));

5041 
i
 = 0; i < 
–ems
->
tx_pwr_’v_num
; i++) {

5042 ià(
–ems
->
tx_pwr_’v_Ën
[
i
] > (
bss_cÚf
->
tx_pwr_’v
[
j
]))

5045 
bss_cÚf
->
tx_pwr_’v_num
++;

5046 
	`memıy
(&
bss_cÚf
->
tx_pwr_’v
[
j
], 
–ems
->tx_pwr_’v[
i
],

5047 
–ems
->
tx_pwr_’v_Ën
[
i
]);

5048 
j
++;

5051 
	`rcu_»ad_uÆock
();

5053 
	`kä“
(
–ems
);

5054 
–ems
 = 
NULL
;

5056 ià(!
lšk
)

5059 
	`rcu_»ad_lock
();

5060 
lšk
->
Ãeded_rx_chašs
 = 
	`mš
(
	`›“80211_max_rx_chašs
Öšk, 
cbss
),

5061 
loÿl
->
rx_chašs
);

5062 
	`rcu_»ad_uÆock
();

5069 
»t
 = 
	`›“80211_lšk_u£_chªÃl
(
lšk
, &
chª»q
,

5070 
IEEE80211_CHANCTX_SHARED
);

5073 ià(
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

5074 
chª»q
.
İ”
.
width
 =ğ
NL80211_CHAN_WIDTH_10
)

5075  
»t
;

5077 
»t
 && 
chª»q
.
İ”
.
width
 !ğ
NL80211_CHAN_WIDTH_20_NOHT
) {

5078 
	`›“80211_chª»q_downg¿de
(&
chª»q
, 
cÚn
);

5080 
»t
 = 
	`›“80211_lšk_u£_chªÃl
(
lšk
, &
chª»q
,

5081 
IEEE80211_CHANCTX_SHARED
);

5084  
»t
;

5085 
	}
}

5087 
boŞ
 
	$›“80211_g‘_dtim
(cÚ¡ 
cfg80211_bss_›s
 *
›s
,

5088 
u8
 *
dtim_couÁ
, u8 *
dtim_³riod
)

5090 cÚ¡ 
u8
 *
tim_›
 = 
	`cfg80211_fšd_›
(
WLAN_EID_TIM
, 
›s
->
d©a
, ies->
Ën
);

5091 cÚ¡ 
u8
 *
idx_›
 = 
	`cfg80211_fšd_›
(
WLAN_EID_MULTI_BSSID_IDX
, 
›s
->
d©a
,

5092 
›s
->
Ën
);

5093 cÚ¡ 
›“80211_tim_›
 *
tim
 = 
NULL
;

5094 cÚ¡ 
›“80211_bssid_šdex
 *
idx
;

5095 
boŞ
 
v®id
 = 
tim_›
 &&im_ie[1] >= 2;

5097 ià(
v®id
)

5098 
tim
 = (*)(
tim_›
 + 2);

5100 ià(
dtim_couÁ
)

5101 *
dtim_couÁ
 = 
v®id
 ? 
tim
->dtim_count : 0;

5103 ià(
dtim_³riod
)

5104 *
dtim_³riod
 = 
v®id
 ? 
tim
->dtim_period : 0;

5107 ià(!
idx_›
 || idx_ie[1] < 3)

5108  
v®id
;

5110 
idx
 = (*)(
idx_›
 + 2);

5112 ià(
dtim_couÁ
)

5113 *
dtim_couÁ
 = 
idx
->dtim_count;

5115 ià(
dtim_³riod
)

5116 *
dtim_³riod
 = 
idx
->dtim_period;

5118  
Œue
;

5119 
	}
}

5121 
boŞ
 
	$›“80211_assoc_sucûss
(
›“80211_sub_if_d©a
 *
sd©a
,

5122 
›“80211_mgmt
 *
mgmt
,

5123 
›“802_11_–ems
 *
–ems
,

5124 cÚ¡ 
u8
 *
–em_¡¬t
, 
–em_Ën
)

5126 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

5127 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
ifmgd
->assoc_data;

5128 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

5129 
lšk_id
;

5130 
¡a_šfo
 *
¡a
;

5131 
u64
 
chªged
[
IEEE80211_MLD_MAX_NUM_LINKS
] = {};

5132 
u16
 
v®id_lšks
 = 0, 
dÜmªt_lšks
 = 0;

5133 
”r
;

5135 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

5140 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
assoc_d©a
->
­_addr
);

5141 ià(
	`WARN_ON
(!
¡a
))

5142 
out_”r
;

5144 
¡a
->¡a.
¥p_amsdu
 = 
assoc_d©a
->spp_amsdu;

5146 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

5147 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

5148 ià(!
assoc_d©a
->
lšk
[
lšk_id
].
bss
)

5151 
v®id_lšks
 |ğ
	`BIT
(
lšk_id
);

5152 ià(
assoc_d©a
->
lšk
[
lšk_id
].
di§bËd
)

5153 
dÜmªt_lšks
 |ğ
	`BIT
(
lšk_id
);

5155 ià(
lšk_id
 !ğ
assoc_d©a
->
assoc_lšk_id
) {

5156 
”r
 = 
	`›“80211_¡a_®loÿ‹_lšk
(
¡a
, 
lšk_id
);

5157 ià(
”r
)

5158 
out_”r
;

5162 
	`›“80211_vif_£t_lšks
(
sd©a
, 
v®id_lšks
, 
dÜmªt_lšks
);

5165 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

5166 
cfg80211_bss
 *
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

5167 
›“80211_lšk_d©a
 *
lšk
;

5168 
lšk_¡a_šfo
 *
lšk_¡a
;

5170 ià(!
cbss
)

5173 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

5174 ià(
	`WARN_ON
(!
lšk
))

5175 
out_”r
;

5177 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

5178 
	`lšk_šfo
(
lšk
,

5180 
lšk
->
cÚf
->
addr
,

5181 
assoc_d©a
->
lšk
[
lšk_id
].
bss
->
bssid
,

5182 
lšk_id
 =ğ
assoc_d©a
->
assoc_lšk_id
 ?

5185 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
lšk_id
],

5186 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

5187 ià(
	`WARN_ON
(!
lšk_¡a
))

5188 
out_”r
;

5190 ià(!
lšk
->
u
.
mgd
.
have_b—cÚ
) {

5191 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

5193 
	`rcu_»ad_lock
();

5194 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->
b—cÚ_›s
);

5195 ià(
›s
)

5196 
lšk
->
u
.
mgd
.
have_b—cÚ
 = 
Œue
;

5198 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->ies);

5199 
	`›“80211_g‘_dtim
(
›s
,

5200 &
lšk
->
cÚf
->
sync_dtim_couÁ
,

5201 &
lšk
->
u
.
mgd
.
dtim_³riod
);

5202 
lšk
->
cÚf
->
b—cÚ_št
 = 
cbss
->
b—cÚ_š‹rv®
;

5203 
	`rcu_»ad_uÆock
();

5206 
lšk
->
cÚf
->
dtim_³riod
 =†šk->
u
.
mgd
.dtim_period ?: 1;

5208 ià(
lšk_id
 !ğ
assoc_d©a
->
assoc_lšk_id
) {

5209 
lšk
->
u
.
mgd
.
cÚn
 = 
assoc_d©a
->lšk[
lšk_id
].conn;

5211 
”r
 = 
	`›“80211_´•_chªÃl
(
sd©a
, 
lšk
, 
lšk_id
, 
cbss
,

5212 
Œue
, &
lšk
->
u
.
mgd
.
cÚn
);

5213 ià(
”r
) {

5214 
	`lšk_šfo
(
lšk
, "prep_channel failed\n");

5215 
out_”r
;

5219 
”r
 = 
	`›“80211_mgd_£tup_lšk_¡a
(
lšk
, 
¡a
, 
lšk_¡a
,

5220 
assoc_d©a
->
lšk
[
lšk_id
].
bss
);

5221 ià(
”r
)

5222 
out_”r
;

5224 ià(!
	`›“80211_assoc_cÚfig_lšk
(
lšk
, 
lšk_¡a
,

5225 
assoc_d©a
->
lšk
[
lšk_id
].
bss
,

5226 
mgmt
, 
–em_¡¬t
, 
–em_Ën
,

5227 &
chªged
[
lšk_id
]))

5228 
out_”r
;

5230 ià(
assoc_d©a
->
lšk
[
lšk_id
].
¡©us
 !ğ
WLAN_STATUS_SUCCESS
) {

5231 
v®id_lšks
 &ğ~
	`BIT
(
lšk_id
);

5232 
	`›“80211_¡a_»move_lšk
(
¡a
, 
lšk_id
);

5236 ià(
lšk_id
 !ğ
assoc_d©a
->
assoc_lšk_id
) {

5237 
”r
 = 
	`›“80211_¡a_aùiv©e_lšk
(
¡a
, 
lšk_id
);

5238 ià(
”r
)

5239 
out_”r
;

5244 
	`›“80211_vif_£t_lšks
(
sd©a
, 
v®id_lšks
, 
dÜmªt_lšks
);

5246 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

5248 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_MFP_ENABLED
) {

5249 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_MFP
);

5250 
¡a
->¡a.
må
 = 
Œue
;

5252 
¡a
->¡a.
må
 = 
çl£
;

5255 
	`›“80211_¡a_£t_max_amsdu_subäames
(
¡a
, 
–ems
->
ext_ÿ·b
,

5256 
–ems
->
ext_ÿ·b_Ën
);

5258 
¡a
->¡a.
wme
 = (
–ems
->
wmm_·¿m
 ||ƒËms->
s1g_ÿ·b
) &&

5259 
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
;

5261 
”r
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
);

5262 ià(!
”r
 && !(
ifmgd
->
æags
 & 
IEEE80211_STA_CONTROL_PORT
))

5263 
”r
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTHORIZED
);

5264 ià(
”r
) {

5265 
	`sd©a_šfo
(
sd©a
,

5267 
¡a
->¡a.
addr
);

5268 
	`WARN_ON
(
	`__¡a_šfo_de¡roy
(
¡a
));

5269 
out_”r
;

5272 ià(
sd©a
->
wdev
.
u£_4addr
)

5273 
	`drv_¡a_£t_4addr
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
Œue
);

5275 
	`›“80211_£t_assocŸ‹d
(
sd©a
, 
assoc_d©a
, 
chªged
);

5281 ià(
ifmgd
->
u£_4addr
)

5282 
	`›“80211_£nd_4addr_nuÎfunc
(
loÿl
, 
sd©a
);

5288 
	`›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
sd©a
);

5289 
	`›“80211_¡a_»£t_cÚn_mÚ™Ü
(
sd©a
);

5291  
Œue
;

5292 
out_”r
:

5293 
	`‘h_z”o_addr
(
sd©a
->
vif
.
cfg
.
­_addr
);

5294  
çl£
;

5295 
	}
}

5297 
	$›“80211_rx_mgmt_assoc_»¥
(
›“80211_sub_if_d©a
 *
sd©a
,

5298 
›“80211_mgmt
 *
mgmt
,

5299 
size_t
 
Ën
)

5301 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

5302 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
ifmgd
->assoc_data;

5303 
u16
 
ÿ·b_šfo
, 
¡©us_code
, 
aid
;

5304 
›“80211_–ems_·r£_·¿ms
 
·r£_·¿ms
 = {

5305 .
bss
 = 
NULL
,

5306 .
lšk_id
 = -1,

5307 .
äom_­
 = 
Œue
,

5309 
›“802_11_–ems
 *
–ems
;

5310 
ac
;

5311 cÚ¡ 
u8
 *
–em_¡¬t
;

5312 
–em_Ën
;

5313 
boŞ
 
»assoc
;

5314 
›“80211_ev’t
 
ev’t
 = {

5315 .
ty³
 = 
MLME_EVENT
,

5316 .
u
.
mlme
.
d©a
 = 
ASSOC_EVENT
,

5318 
›“80211_´•_tx_šfo
 
šfo
 = {};

5319 
cfg80211_rx_assoc_»¥_d©a
 
»¥
 = {

5320 .
u­sd_queues
 = -1,

5322 
u8
 
­_mld_addr
[
ETH_ALEN
] 
	`__®igÃd
(2);

5323 
lšk_id
;

5325 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

5327 ià(!
assoc_d©a
)

5330 
·r£_·¿ms
.
mode
 =

5331 
assoc_d©a
->
lšk
[assoc_d©a->
assoc_lšk_id
].
cÚn
.
mode
;

5333 ià(!
	`‘h”_addr_equ®
(
assoc_d©a
->
­_addr
, 
mgmt
->
bssid
) ||

5334 !
	`‘h”_addr_equ®
(
assoc_d©a
->
­_addr
, 
mgmt
->
§
))

5342 ià(
Ën
 < 24 + 6)

5345 
»assoc
 = 
	`›“80211_is_»assoc_»¥
(
mgmt
->
äame_cÚŒŞ
);

5346 
ÿ·b_šfo
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
assoc_»¥
.capab_info);

5347 
¡©us_code
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
assoc_»¥
.status_code);

5348 ià(
assoc_d©a
->
s1g
)

5349 
–em_¡¬t
 = 
mgmt
->
u
.
s1g_assoc_»¥
.
v¬ŸbË
;

5351 
–em_¡¬t
 = 
mgmt
->
u
.
assoc_»¥
.
v¬ŸbË
;

5359 
šfo
.
subty³
 = 
»assoc
 ? 
IEEE80211_STYPE_REASSOC_REQ
 :

5360 
IEEE80211_STYPE_ASSOC_REQ
;

5362 ià(
assoc_d©a
->
fs_kek_Ën
 &&

5363 
	`fs_deüy±_assoc_»¥
(
sd©a
, (
u8
 *)
mgmt
, &
Ën
, 
assoc_d©a
) < 0)

5366 
–em_Ën
 = 
Ën
 - (
–em_¡¬t
 - (
u8
 *)
mgmt
);

5367 
·r£_·¿ms
.
¡¬t
 = 
–em_¡¬t
;

5368 
·r£_·¿ms
.
Ën
 = 
–em_Ën
;

5369 
–ems
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

5370 ià(!
–ems
)

5371 
nÙify_driv”
;

5373 ià(
–ems
->
aid_»¥
)

5374 
aid
 = 
	`Ë16_to_ıu
(
–ems
->
aid_»¥
->aid);

5375 ià(
assoc_d©a
->
s1g
)

5376 
aid
 = 0;

5378 
aid
 = 
	`Ë16_to_ıu
(
mgmt
->
u
.
assoc_»¥
.aid);

5384 
aid
 &= 0x7ff;

5386 
	`sd©a_šfo
(
sd©a
,

5388 
»assoc
 ? "R—" : "A", 
assoc_d©a
->
­_addr
,

5389 
ÿ·b_šfo
, 
¡©us_code
, (
u16
)(
aid
 & ~(
	`BIT
(15) | BIT(14))));

5391 
ifmgd
->
brok’_­
 = 
çl£
;

5393 ià(
¡©us_code
 =ğ
WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY
 &&

5394 
–ems
->
timeout_št
 &&

5395 
–ems
->
timeout_št
->
ty³
 =ğ
WLAN_TIMEOUT_ASSOC_COMEBACK
) {

5396 
u32
 
tu
, 
ms
;

5398 
	`cfg80211_assoc_comeback
(
sd©a
->
dev
, 
assoc_d©a
->
­_addr
,

5399 
	`Ë32_to_ıu
(
–ems
->
timeout_št
->
v®ue
));

5401 
tu
 = 
	`Ë32_to_ıu
(
–ems
->
timeout_št
->
v®ue
);

5402 
ms
 = 
tu
 * 1024 / 1000;

5403 
	`sd©a_šfo
(
sd©a
,

5405 
assoc_d©a
->
­_addr
, 
tu
, 
ms
);

5406 
assoc_d©a
->
timeout
 = 
jiff›s
 + 
	`m£cs_to_jiff›s
(
ms
);

5407 
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

5408 
assoc_d©a
->
comeback
 = 
Œue
;

5409 ià(
ms
 > 
IEEE80211_ASSOC_TIMEOUT
)

5410 
	`run_agaš
(
sd©a
, 
assoc_d©a
->
timeout
);

5411 
nÙify_driv”
;

5414 ià(
¡©us_code
 !ğ
WLAN_STATUS_SUCCESS
) {

5415 
	`sd©a_šfo
(
sd©a
, "%pM denied‡ssociation (code=%d)\n",

5416 
assoc_d©a
->
­_addr
, 
¡©us_code
);

5417 
ev’t
.
u
.
mlme
.
¡©us
 = 
MLME_DENIED
;

5418 
ev’t
.
u
.
mlme
.
»asÚ
 = 
¡©us_code
;

5419 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

5421 ià(
aid
 =ğ0 ||‡id > 
IEEE80211_MAX_AID
) {

5422 
	`sd©a_šfo
(
sd©a
,

5424 
aid
);

5425 
aid
 = 0;

5426 
ifmgd
->
brok’_­
 = 
Œue
;

5429 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

5430 
›“80211_mË_basic_commÚ_šfo
 *
commÚ
;

5432 ià(!
–ems
->
ml_basic
) {

5433 
	`sd©a_šfo
(
sd©a
,

5435 
assoc_d©a
->
­_addr
);

5436 
abªdÚ_assoc
;

5439 
commÚ
 = (*)
–ems
->
ml_basic
->
v¬ŸbË
;

5441 ià(
	`memcmp
(
assoc_d©a
->
­_addr
,

5442 
commÚ
->
mld_mac_addr
, 
ETH_ALEN
)) {

5443 
	`sd©a_šfo
(
sd©a
,

5445 
commÚ
->
mld_mac_addr
,

5446 
assoc_d©a
->
­_addr
);

5447 
abªdÚ_assoc
;

5450 
sd©a
->
vif
.
cfg
.
eml_ÿp
 =

5451 
	`›“80211_mË_g‘_eml_ÿp
((cÚ¡ *)
–ems
->
ml_basic
);

5452 
sd©a
->
vif
.
cfg
.
eml_med_sync_d–ay
 =

5453 
	`›“80211_mË_g‘_eml_med_sync_d–ay
((cÚ¡ *)
–ems
->
ml_basic
);

5454 
sd©a
->
vif
.
cfg
.
mld_ÿ·_İ
 =

5455 
	`›“80211_mË_g‘_mld_ÿ·_İ
((cÚ¡ *)
–ems
->
ml_basic
);

5458 
sd©a
->
vif
.
cfg
.
aid
 =‡id;

5460 ià(!
	`›“80211_assoc_sucûss
(
sd©a
, 
mgmt
, 
–ems
,

5461 
–em_¡¬t
, 
–em_Ën
)) {

5463 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_TIMEOUT
);

5464 
nÙify_driv”
;

5466 
ev’t
.
u
.
mlme
.
¡©us
 = 
MLME_SUCCESS
;

5467 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

5468 
	`sd©a_šfo
(
sd©a
, "associated\n");

5470 
šfo
.
sucûss
 = 1;

5473 
lšk_id
 = 0;†šk_id < 
IEEE80211_MLD_MAX_NUM_LINKS
;†ink_id++) {

5474 
›“80211_lšk_d©a
 *
lšk
;

5476 ià(!
assoc_d©a
->
lšk
[
lšk_id
].
bss
)

5479 
»¥
.
lšks
[
lšk_id
].
bss
 = 
assoc_d©a
->
lšk
[link_id].bss;

5480 
	`‘h”_addr_cİy
(
»¥
.
lšks
[
lšk_id
].
addr
,

5481 
assoc_d©a
->
lšk
[
lšk_id
].
addr
);

5482 
»¥
.
lšks
[
lšk_id
].
¡©us
 = 
assoc_d©a
->
lšk
[link_id].status;

5484 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

5485 ià(!
lšk
)

5489 
»¥
.
u­sd_queues
 = 0;

5490 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

5491 ià(
lšk
->
tx_cÚf
[
ac
].
u­sd
)

5492 
»¥
.
u­sd_queues
 |ğ
›“80211_ac_to_qos_mask
[
ac
];

5495 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

5496 
	`‘h”_addr_cİy
(
­_mld_addr
, 
sd©a
->
vif
.
cfg
.
­_addr
);

5497 
»¥
.
­_mld_addr
 =‡p_mld_addr;

5500 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
,

5501 
¡©us_code
 =ğ
WLAN_STATUS_SUCCESS
 ?

5502 
ASSOC_SUCCESS
 :

5503 
ASSOC_REJECTED
);

5505 
»¥
.
buf
 = (
u8
 *)
mgmt
;

5506 
»¥
.
Ën
 =†en;

5507 
»¥
.
»q_›s
 = 
ifmgd
->
assoc_»q_›s
;

5508 
»¥
.
»q_›s_Ën
 = 
ifmgd
->
assoc_»q_›s_Ën
;

5509 
	`cfg80211_rx_assoc_»¥
(
sd©a
->
dev
, &
»¥
);

5510 
nÙify_driv”
:

5511 
	`drv_mgd_com¶‘e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

5512 
	`kä“
(
–ems
);

5514 
abªdÚ_assoc
:

5515 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_ABANDON
);

5516 
nÙify_driv”
;

5517 
	}
}

5519 
	$›“80211_rx_bss_šfo
(
›“80211_lšk_d©a
 *
lšk
,

5520 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

5521 
›“80211_rx_¡©us
 *
rx_¡©us
)

5523 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

5524 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

5525 
›“80211_bss
 *
bss
;

5526 
›“80211_chªÃl
 *
chªÃl
;

5528 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

5530 
chªÃl
 = 
	`›“80211_g‘_chªÃl_khz
(
loÿl
->
hw
.
why
,

5531 
	`›“80211_rx_¡©us_to_khz
(
rx_¡©us
));

5532 ià(!
chªÃl
)

5535 
bss
 = 
	`›“80211_bss_šfo_upd©e
(
loÿl
, 
rx_¡©us
, 
mgmt
, 
Ën
, 
chªÃl
);

5536 ià(
bss
) {

5537 
lšk
->
cÚf
->
b—cÚ_¿‹
 = 
bss
->beacon_rate;

5538 
	`›“80211_rx_bss_put
(
loÿl
, 
bss
);

5540 
	}
}

5543 
	$›“80211_rx_mgmt_´obe_»¥
(
›“80211_lšk_d©a
 *
lšk
,

5544 
sk_buff
 *
skb
)

5546 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

5547 
›“80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

5548 
›“80211_if_mªaged
 *
ifmgd
;

5549 
›“80211_rx_¡©us
 *
rx_¡©us
 = (*è
skb
->
cb
;

5550 
›“80211_chªÃl
 *
chªÃl
;

5551 
size_t
 
ba£Ën
, 
Ën
 = 
skb
->len;

5553 
ifmgd
 = &
sd©a
->
u
.
mgd
;

5555 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

5564 
chªÃl
 = 
	`›“80211_g‘_chªÃl
(
sd©a
->
loÿl
->
hw
.
why
,

5565 
rx_¡©us
->
äeq
);

5566 ià(!
chªÃl
)

5569 ià(!
	`‘h”_addr_equ®
(
mgmt
->
da
, 
sd©a
->
vif
.
addr
) &&

5570 (
chªÃl
->
bªd
 !ğ
NL80211_BAND_6GHZ
 ||

5571 !
	`is_brßdÿ¡_‘h”_addr
(
mgmt
->
da
)))

5574 
ba£Ën
 = (
u8
 *è
mgmt
->
u
.
´obe_»¥
.
v¬ŸbË
 - (u8 *) mgmt;

5575 ià(
ba£Ën
 > 
Ën
)

5578 
	`›“80211_rx_bss_šfo
(
lšk
, 
mgmt
, 
Ën
, 
rx_¡©us
);

5580 ià(
ifmgd
->
assocŸ‹d
 &&

5581 
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
lšk
->
u
.
mgd
.bssid))

5582 
	`›“80211_»£t_­_´obe
(
sd©a
);

5583 
	}
}

5600 cÚ¡ 
u64
 
	gÿ»_about_›s
 =

5601 (1ULL << 
WLAN_EID_COUNTRY
) |

5602 (1ULL << 
WLAN_EID_ERP_INFO
) |

5603 (1ULL << 
WLAN_EID_CHANNEL_SWITCH
) |

5604 (1ULL << 
WLAN_EID_PWR_CONSTRAINT
) |

5605 (1ULL << 
WLAN_EID_HT_CAPABILITY
) |

5606 (1ULL << 
WLAN_EID_HT_OPERATION
) |

5607 (1ULL << 
WLAN_EID_EXT_CHANSWITCH_ANN
);

5609 
	$›“80211_hªdË_b—cÚ_sig
(
›“80211_lšk_d©a
 *
lšk
,

5610 
›“80211_if_mªaged
 *
ifmgd
,

5611 
›“80211_bss_cÚf
 *
bss_cÚf
,

5612 
›“80211_loÿl
 *
loÿl
,

5613 
›“80211_rx_¡©us
 *
rx_¡©us
)

5615 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

5619 ià(!
lšk
->
u
.
mgd
.
Œackšg_sigÇl_avg
) {

5620 
lšk
->
u
.
mgd
.
Œackšg_sigÇl_avg
 = 
Œue
;

5621 
	`ewma_b—cÚ_sigÇl_š™
(&
lšk
->
u
.
mgd
.
ave_b—cÚ_sigÇl
);

5622 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
 = 0;

5623 
lšk
->
u
.
mgd
.
couÁ_b—cÚ_sigÇl
 = 1;

5624 
lšk
->
u
.
mgd
.
Ï¡_ave_b—cÚ_sigÇl
 = 0;

5626 
lšk
->
u
.
mgd
.
couÁ_b—cÚ_sigÇl
++;

5629 
	`ewma_b—cÚ_sigÇl_add
(&
lšk
->
u
.
mgd
.
ave_b—cÚ_sigÇl
,

5630 -
rx_¡©us
->
sigÇl
);

5632 ià(
ifmgd
->
rssi_mš_thŞd
 !ğifmgd->
rssi_max_thŞd
 &&

5633 
lšk
->
u
.
mgd
.
couÁ_b—cÚ_sigÇl
 >ğ
IEEE80211_SIGNAL_AVE_MIN_COUNT
) {

5634 
sig
 = -
	`ewma_b—cÚ_sigÇl_»ad
(&
lšk
->
u
.
mgd
.
ave_b—cÚ_sigÇl
);

5635 
Ï¡_sig
 = 
lšk
->
u
.
mgd
.
Ï¡_ave_b—cÚ_sigÇl
;

5636 
›“80211_ev’t
 
ev’t
 = {

5637 .
ty³
 = 
RSSI_EVENT
,

5644 ià(
sig
 > 
ifmgd
->
rssi_max_thŞd
 &&

5645 (
Ï¡_sig
 <ğ
ifmgd
->
rssi_mš_thŞd
 ||†ast_sig == 0)) {

5646 
lšk
->
u
.
mgd
.
Ï¡_ave_b—cÚ_sigÇl
 = 
sig
;

5647 
ev’t
.
u
.
rssi
.
d©a
 = 
RSSI_EVENT_HIGH
;

5648 
	`drv_ev’t_ÿÎback
(
loÿl
, 
sd©a
, &
ev’t
);

5649 } ià(
sig
 < 
ifmgd
->
rssi_mš_thŞd
 &&

5650 (
Ï¡_sig
 >ğ
ifmgd
->
rssi_max_thŞd
 ||

5651 
Ï¡_sig
 == 0)) {

5652 
lšk
->
u
.
mgd
.
Ï¡_ave_b—cÚ_sigÇl
 = 
sig
;

5653 
ev’t
.
u
.
rssi
.
d©a
 = 
RSSI_EVENT_LOW
;

5654 
	`drv_ev’t_ÿÎback
(
loÿl
, 
sd©a
, &
ev’t
);

5658 ià(
bss_cÚf
->
cqm_rssi_thŞd
 &&

5659 
lšk
->
u
.
mgd
.
couÁ_b—cÚ_sigÇl
 >ğ
IEEE80211_SIGNAL_AVE_MIN_COUNT
 &&

5660 !(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_SUPPORTS_CQM_RSSI
)) {

5661 
sig
 = -
	`ewma_b—cÚ_sigÇl_»ad
(&
lšk
->
u
.
mgd
.
ave_b—cÚ_sigÇl
);

5662 
Ï¡_ev’t
 = 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
;

5663 
thŞd
 = 
bss_cÚf
->
cqm_rssi_thŞd
;

5664 
hy¡
 = 
bss_cÚf
->
cqm_rssi_hy¡
;

5666 ià(
sig
 < 
thŞd
 &&

5667 (
Ï¡_ev’t
 =ğ0 || 
sig
 <†a¡_ev’ˆ- 
hy¡
)) {

5668 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
 = 
sig
;

5669 
	`›“80211_cqm_rssi_nÙify
(

5670 &
sd©a
->
vif
,

5671 
NL80211_CQM_RSSI_THRESHOLD_EVENT_LOW
,

5672 
sig
, 
GFP_KERNEL
);

5673 } ià(
sig
 > 
thŞd
 &&

5674 (
Ï¡_ev’t
 =ğ0 || 
sig
 >†a¡_ev’ˆ+ 
hy¡
)) {

5675 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
 = 
sig
;

5676 
	`›“80211_cqm_rssi_nÙify
(

5677 &
sd©a
->
vif
,

5678 
NL80211_CQM_RSSI_THRESHOLD_EVENT_HIGH
,

5679 
sig
, 
GFP_KERNEL
);

5683 ià(
bss_cÚf
->
cqm_rssi_low
 &&

5684 
lšk
->
u
.
mgd
.
couÁ_b—cÚ_sigÇl
 >ğ
IEEE80211_SIGNAL_AVE_MIN_COUNT
) {

5685 
sig
 = -
	`ewma_b—cÚ_sigÇl_»ad
(&
lšk
->
u
.
mgd
.
ave_b—cÚ_sigÇl
);

5686 
Ï¡_ev’t
 = 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
;

5687 
low
 = 
bss_cÚf
->
cqm_rssi_low
;

5688 
high
 = 
bss_cÚf
->
cqm_rssi_high
;

5690 ià(
sig
 < 
low
 &&

5691 (
Ï¡_ev’t
 =ğ0 ||†a¡_ev’ˆ>ğ
low
)) {

5692 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
 = 
sig
;

5693 
	`›“80211_cqm_rssi_nÙify
(

5694 &
sd©a
->
vif
,

5695 
NL80211_CQM_RSSI_THRESHOLD_EVENT_LOW
,

5696 
sig
, 
GFP_KERNEL
);

5697 } ià(
sig
 > 
high
 &&

5698 (
Ï¡_ev’t
 =ğ0 ||†a¡_ev’ˆ<ğ
high
)) {

5699 
lšk
->
u
.
mgd
.
Ï¡_cqm_ev’t_sigÇl
 = 
sig
;

5700 
	`›“80211_cqm_rssi_nÙify
(

5701 &
sd©a
->
vif
,

5702 
NL80211_CQM_RSSI_THRESHOLD_EVENT_HIGH
,

5703 
sig
, 
GFP_KERNEL
);

5706 
	}
}

5708 
boŞ
 
	$›“80211_rx_our_b—cÚ
(cÚ¡ 
u8
 *
tx_bssid
,

5709 
cfg80211_bss
 *
bss
)

5711 ià(
	`‘h”_addr_equ®
(
tx_bssid
, 
bss
->
bssid
))

5712  
Œue
;

5713 ià(!
bss
->
Œªsm™‹d_bss
)

5714  
çl£
;

5715  
	`‘h”_addr_equ®
(
tx_bssid
, 
bss
->
Œªsm™‹d_bss
->
bssid
);

5716 
	}
}

5718 
	$›“80211_ml_»cÚf_wÜk
(
why
 *wiphy,

5719 
why_wÜk
 *
wÜk
)

5721 
›“80211_sub_if_d©a
 *
sd©a
 =

5722 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

5723 
u
.
mgd
.
ml_»cÚf_wÜk
.
wÜk
);

5724 
u16
 
Ãw_v®id_lšks
, 
Ãw_aùive_lšks
, 
Ãw_dÜmªt_lšks
;

5725 
»t
;

5727 ià(!
sd©a
->
u
.
mgd
.
»moved_lšks
)

5730 
	`sd©a_šfo
(
sd©a
,

5732 
sd©a
->
vif
.
v®id_lšks
, sd©a->
u
.
mgd
.
»moved_lšks
);

5734 
Ãw_v®id_lšks
 = 
sd©a
->
vif
.
v®id_lšks
 & ~sd©a->
u
.
mgd
.
»moved_lšks
;

5735 ià(
Ãw_v®id_lšks
 =ğ
sd©a
->
vif
.
v®id_lšks
)

5738 ià(!
Ãw_v®id_lšks
 ||

5739 !(
Ãw_v®id_lšks
 & ~
sd©a
->
vif
.
dÜmªt_lšks
)) {

5740 
	`sd©a_šfo
(
sd©a
, "No valid†inks‡fter„econfiguration\n");

5741 
»t
 = -
EINVAL
;

5742 
out
;

5745 
Ãw_aùive_lšks
 = 
sd©a
->
vif
.
aùive_lšks
 & ~sd©a->
u
.
mgd
.
»moved_lšks
;

5746 ià(
Ãw_aùive_lšks
 !ğ
sd©a
->
vif
.
aùive_lšks
) {

5747 ià(!
Ãw_aùive_lšks
)

5748 
Ãw_aùive_lšks
 =

5749 
	`BIT
(
	`ffs
(
Ãw_v®id_lšks
 &

5750 ~
sd©a
->
vif
.
dÜmªt_lšks
) - 1);

5752 
»t
 = 
	`›“80211_£t_aùive_lšks
(&
sd©a
->
vif
, 
Ãw_aùive_lšks
);

5753 ià(
»t
) {

5754 
	`sd©a_šfo
(
sd©a
,

5756 
out
;

5760 
Ãw_dÜmªt_lšks
 = 
sd©a
->
vif
.
dÜmªt_lšks
 & ~sd©a->
u
.
mgd
.
»moved_lšks
;

5762 
»t
 = 
	`›“80211_vif_£t_lšks
(
sd©a
, 
Ãw_v®id_lšks
,

5763 
Ãw_dÜmªt_lšks
);

5764 ià(
»t
)

5765 
	`sd©a_šfo
(
sd©a
, "Failed setting valid†inks\n");

5767 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_MLD_VALID_LINKS
);

5769 
out
:

5770 ià(!
»t
)

5771 
	`cfg80211_lšks_»moved
(
sd©a
->
dev
, sd©a->
u
.
mgd
.
»moved_lšks
);

5773 
	`__›“80211_discÚÃù
(
sd©a
);

5775 
sd©a
->
u
.
mgd
.
»moved_lšks
 = 0;

5776 
	}
}

5778 
	$›“80211_ml_»cÚfigu¿tiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

5779 
›“802_11_–ems
 *
–ems
)

5781 cÚ¡ 
–em’t
 *
sub
;

5782 
»moved_lšks
 = 0;

5783 
u16
 
lšk_»mov®_timeout
[
IEEE80211_MLD_MAX_NUM_LINKS
] = {};

5784 
u8
 
lšk_id
;

5785 
u32
 
d–ay
;

5787 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
è|| !
–ems
->
ml_»cÚf
)

5793 
	`fÜ_—ch_mË_sub–em’t
(
sub
, (cÚ¡ 
u8
 *)
–ems
->
ml_»cÚf
,

5794 
–ems
->
ml_»cÚf_Ën
) {

5795 
›“80211_mË_³r_¡a_´ofe
 *
´of
 = (*)
sub
->
d©a
;

5796 
u8
 *
pos
 = 
´of
->
v¬ŸbË
;

5797 
u16
 
cÚŒŞ
;

5799 ià(
sub
->
id
 !ğ
IEEE80211_MLE_SUBELEM_PER_STA_PROFILE
)

5802 ià(!
	`›“80211_mË_»cÚf_¡a_´of_size_ok
(
sub
->
d©a
,

5803 
sub
->
d©®’
))

5806 
cÚŒŞ
 = 
	`Ë16_to_ıu
(
´of
->control);

5807 
lšk_id
 = 
cÚŒŞ
 & 
IEEE80211_MLE_STA_RECONF_CONTROL_LINK_ID
;

5809 
»moved_lšks
 |ğ
	`BIT
(
lšk_id
);

5812 ià(
cÚŒŞ
 &

5813 
IEEE80211_MLE_STA_RECONF_CONTROL_STA_MAC_ADDR_PRESENT
)

5814 
pos
 += 6;

5820 ià(
cÚŒŞ
 &

5821 
IEEE80211_MLE_STA_RECONF_CONTROL_AP_REM_TIMER_PRESENT
)

5822 
lšk_»mov®_timeout
[
lšk_id
] = 
	`g‘_uÇligÃd_Ë16
(
pos
);

5825 
»moved_lšks
 &ğ
sd©a
->
vif
.
v®id_lšks
;

5826 ià(!
»moved_lšks
) {

5828 ià(
sd©a
->
u
.
mgd
.
»moved_lšks
) {

5829 
sd©a
->
u
.
mgd
.
»moved_lšks
 = 0;

5830 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

5831 &
sd©a
->
u
.
mgd
.
ml_»cÚf_wÜk
);

5836 
d–ay
 = 0;

5837 
	`fÜ_—ch_£t_b™
(
lšk_id
, &
»moved_lšks
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

5838 
›“80211_bss_cÚf
 *
lšk_cÚf
 =

5839 
	`sd©a_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[
lšk_id
], sdata);

5840 
u32
 
lšk_d–ay
;

5842 ià(!
lšk_cÚf
) {

5843 
»moved_lšks
 &ğ~
	`BIT
(
lšk_id
);

5847 ià(
lšk_»mov®_timeout
[
lšk_id
] < 1)

5848 
lšk_d–ay
 = 0;

5850 
lšk_d–ay
 = 
lšk_cÚf
->
b—cÚ_št
 *

5851 (
lšk_»mov®_timeout
[
lšk_id
] - 1);

5853 ià(!
d–ay
)

5854 
d–ay
 = 
lšk_d–ay
;

5856 
d–ay
 = 
	`mš
(d–ay, 
lšk_d–ay
);

5859 
sd©a
->
u
.
mgd
.
»moved_lšks
 =„emoved_links;

5860 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

5861 &
sd©a
->
u
.
mgd
.
ml_»cÚf_wÜk
,

5862 
	`TU_TO_JIFFIES
(
d–ay
));

5863 
	}
}

5865 
	$›“80211_‰lm_£t_lšks
(
›“80211_sub_if_d©a
 *
sd©a
,

5866 
u16
 
aùive_lšks
, u16 
dÜmªt_lšks
,

5867 
u16
 
su¥’ded_lšks
)

5869 
u64
 
chªged
 = 0;

5870 
»t
;

5872 ià(!
aùive_lšks
) {

5873 
»t
 = -
EINVAL
;

5874 
out
;

5880 ià(
sd©a
->
vif
.
Ãg_‰lm
.
v®id
) {

5881 
	`mem£t
(&
sd©a
->
vif
.
Ãg_‰lm
, 0, (sdata->vif.neg_ttlm));

5882 
sd©a
->
vif
.
su¥’ded_lšks
 = 0;

5883 
chªged
 = 
BSS_CHANGED_MLD_TTLM
;

5886 ià(
sd©a
->
vif
.
aùive_lšks
 !=‡ctive_links) {

5890 
chªged
 |ğ
BSS_CHANGED_MLD_VALID_LINKS
;

5891 
aùive_lšks
 &ğ
sd©a
->
vif
.active_links;

5892 ià(!
aùive_lšks
)

5893 
aùive_lšks
 =

5894 
	`BIT
(
	`__ffs
(
sd©a
->
vif
.
v®id_lšks
 &

5895 ~
dÜmªt_lšks
));

5896 
»t
 = 
	`›“80211_£t_aùive_lšks
(&
sd©a
->
vif
, 
aùive_lšks
);

5897 ià(
»t
) {

5898 
	`sd©a_šfo
(
sd©a
, "Failedo set TTLM‡ctive†inks\n");

5899 
out
;

5903 
»t
 = 
	`›“80211_vif_£t_lšks
(
sd©a
, sd©a->
vif
.
v®id_lšks
,

5904 
dÜmªt_lšks
);

5905 ià(
»t
) {

5906 
	`sd©a_šfo
(
sd©a
, "Failedo set TTLM dormant†inks\n");

5907 
out
;

5910 
sd©a
->
vif
.
su¥’ded_lšks
 = suspended_links;

5911 ià(
sd©a
->
vif
.
su¥’ded_lšks
)

5912 
chªged
 |ğ
BSS_CHANGED_MLD_TTLM
;

5914 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
chªged
);

5916 
out
:

5917 ià(
»t
)

5918 
	`›“80211_discÚÃù
(&
sd©a
->
vif
, 
çl£
);

5920  
»t
;

5921 
	}
}

5923 
	$›“80211_tid_to_lšk_m­_wÜk
(
why
 *wiphy,

5924 
why_wÜk
 *
wÜk
)

5926 
u16
 
Ãw_aùive_lšks
, 
Ãw_dÜmªt_lšks
;

5927 
›“80211_sub_if_d©a
 *
sd©a
 =

5928 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

5929 
u
.
mgd
.
‰lm_wÜk
.
wÜk
);

5931 
Ãw_aùive_lšks
 = 
sd©a
->
u
.
mgd
.
‰lm_šfo
.
m­
 &

5932 
sd©a
->
vif
.
v®id_lšks
;

5933 
Ãw_dÜmªt_lšks
 = ~
sd©a
->
u
.
mgd
.
‰lm_šfo
.
m­
 &

5934 
sd©a
->
vif
.
v®id_lšks
;

5936 
	`›“80211_vif_£t_lšks
(
sd©a
, sd©a->
vif
.
v®id_lšks
, 0);

5937 ià(
	`›“80211_‰lm_£t_lšks
(
sd©a
, 
Ãw_aùive_lšks
, 
Ãw_dÜmªt_lšks
,

5941 
sd©a
->
u
.
mgd
.
‰lm_šfo
.
aùive
 = 
Œue
;

5942 
sd©a
->
u
.
mgd
.
‰lm_šfo
.
sw™ch_time
 = 0;

5943 
	}
}

5945 
u16
 
	$›“80211_g‘_‰lm
(
u8
 
bm_size
, u8 *
d©a
)

5947 ià(
bm_size
 == 1)

5948  *
d©a
;

5950  
	`g‘_uÇligÃd_Ë16
(
d©a
);

5951 
	}
}

5954 
	$›“80211_·r£_adv_t2l
(
›“80211_sub_if_d©a
 *
sd©a
,

5955 cÚ¡ 
›“80211_‰lm_–em
 *
‰lm
,

5956 
›“80211_adv_‰lm_šfo
 *
‰lm_šfo
)

5961 
u8
 
cÚŒŞ
, 
lšk_m­_´e£nû
, 
m­_size
, 
tid
;

5962 
u8
 *
pos
;

5964 
	`mem£t
(
‰lm_šfo
, 0, (*ttlm_info));

5965 
pos
 = (*)
‰lm
->
İtiÚ®
;

5966 
cÚŒŞ
 = 
‰lm
->control;

5968 ià((
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_DEF_LINK_MAP
) ||

5969 !(
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_SWITCH_TIME_PRESENT
))

5972 ià((
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_DIRECTION
) !=

5973 
IEEE80211_TTLM_DIRECTION_BOTH
) {

5974 
	`sd©a_šfo
(
sd©a
, "Invalid‡dvertised T2L map direction\n");

5975  -
EINVAL
;

5978 
lšk_m­_´e£nû
 = *
pos
;

5979 
pos
++;

5981 
‰lm_šfo
->
sw™ch_time
 = 
	`g‘_uÇligÃd_Ë16
(
pos
);

5986 ià(!
‰lm_šfo
->
sw™ch_time
)

5987 
‰lm_šfo
->
sw™ch_time
 = 1;

5989 
pos
 += 2;

5991 ià(
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_EXPECTED_DUR_PRESENT
) {

5992 
‰lm_šfo
->
du¿tiÚ
 = 
pos
[0] |…os[1] << 8 |…os[2] << 16;

5993 
pos
 += 3;

5996 ià(
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_LINK_MAP_SIZE
)

5997 
m­_size
 = 1;

5999 
m­_size
 = 2;

6005 ià(
lšk_m­_´e£nû
 != 0xff) {

6006 
	`sd©a_šfo
(
sd©a
,

6008  -
EINVAL
;

6011 
‰lm_šfo
->
m­
 = 
	`›“80211_g‘_‰lm
(
m­_size
, 
pos
);

6012 ià(!
‰lm_šfo
->
m­
) {

6013 
	`sd©a_šfo
(
sd©a
,

6015  -
EINVAL
;

6018 
pos
 +ğ
m­_size
;

6020 
tid
 = 1;id < 8;id++) {

6021 
u16
 
m­
 = 
	`›“80211_g‘_‰lm
(
m­_size
, 
pos
);

6023 ià(
m­
 !ğ
‰lm_šfo
->map) {

6024 
	`sd©a_šfo
(
sd©a
, "Invalid‡dvertised T2L map forid %d\n",

6025 
tid
);

6026  -
EINVAL
;

6029 
pos
 +ğ
m­_size
;

6032 
	}
}

6034 
	$›“80211_´oûss_adv_‰lm
(
›“80211_sub_if_d©a
 *
sd©a
,

6035 
›“802_11_–ems
 *
–ems
,

6036 
u64
 
b—cÚ_ts
)

6038 
u8
 
i
;

6039 
»t
;

6041 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

6044 ià(!
–ems
->
‰lm_num
) {

6045 ià(
sd©a
->
u
.
mgd
.
‰lm_šfo
.
sw™ch_time
) {

6049 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

6050 &
sd©a
->
u
.
mgd
.
‰lm_wÜk
);

6051 } ià(
sd©a
->
u
.
mgd
.
‰lm_šfo
.
aùive
) {

6055 
»t
 = 
	`›“80211_vif_£t_lšks
(
sd©a
,

6056 
sd©a
->
vif
.
v®id_lšks
,

6058 ià(
»t
) {

6059 
	`sd©a_šfo
(
sd©a
, "Failed setting valid/dormant†inks\n");

6062 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
,

6063 
BSS_CHANGED_MLD_VALID_LINKS
);

6065 
	`mem£t
(&
sd©a
->
u
.
mgd
.
‰lm_šfo
, 0,

6066 (
sd©a
->
u
.
mgd
.
‰lm_šfo
));

6070 
i
 = 0; i < 
–ems
->
‰lm_num
; i++) {

6071 
›“80211_adv_‰lm_šfo
 
‰lm_šfo
;

6072 
u32
 
»s
;

6074 
»s
 = 
	`›“80211_·r£_adv_t2l
(
sd©a
, 
–ems
->
‰lm
[
i
],

6075 &
‰lm_šfo
);

6077 ià(
»s
) {

6078 
	`__›“80211_discÚÃù
(
sd©a
);

6082 ià(
‰lm_šfo
.
sw™ch_time
) {

6083 
u16
 
b—cÚ_ts_tu
, 
¡_tu
, 
d–ay
;

6084 
u32
 
d–ay_jiff›s
;

6085 
u64
 
mask
;

6091 
mask
 = 
	`GENMASK_ULL
(25, 10);

6092 
b—cÚ_ts_tu
 = (
b—cÚ_ts
 & 
mask
) >> 10;

6093 
¡_tu
 = 
‰lm_šfo
.
sw™ch_time
;

6094 
d–ay
 = 
¡_tu
 - 
b—cÚ_ts_tu
;

6103 ià(
d–ay
 > 
IEEE80211_ADV_TTLM_ST_UNDERFLOW
)

6106 
d–ay_jiff›s
 = 
	`TU_TO_JIFFIES
(
d–ay
);

6111 ià(
d–ay_jiff›s
 > 
IEEE80211_ADV_TTLM_SAFETY_BUFFER_MS
)

6112 
d–ay_jiff›s
 -=

6113 
IEEE80211_ADV_TTLM_SAFETY_BUFFER_MS
;

6115 
d–ay_jiff›s
 = 0;

6117 
sd©a
->
u
.
mgd
.
‰lm_šfo
 =tlm_info;

6118 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

6119 &
sd©a
->
u
.
mgd
.
‰lm_wÜk
);

6120 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

6121 &
sd©a
->
u
.
mgd
.
‰lm_wÜk
,

6122 
d–ay_jiff›s
);

6126 
	}
}

6128 
	$›“80211_rx_mgmt_b—cÚ
(
›“80211_lšk_d©a
 *
lšk
,

6129 
›“80211_hdr
 *
hdr
, 
size_t
 
Ën
,

6130 
›“80211_rx_¡©us
 *
rx_¡©us
)

6132 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

6133 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

6134 
›“80211_bss_cÚf
 *
bss_cÚf
 = &
sd©a
->
vif
.bss_conf;

6135 
›“80211_vif_cfg
 *
vif_cfg
 = &
sd©a
->
vif
.
cfg
;

6136 
›“80211_mgmt
 *
mgmt
 = (*è
hdr
;

6137 
size_t
 
ba£Ën
;

6138 
›“802_11_–ems
 *
–ems
;

6139 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

6140 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

6141 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

6142 
›“80211_chªÃl
 *
chª
;

6143 
lšk_¡a_šfo
 *
lšk_¡a
;

6144 
¡a_šfo
 *
¡a
;

6145 
u64
 
chªged
 = 0;

6146 
boŞ
 
”p_v®id
;

6147 
u8
 
”p_v®ue
 = 0;

6148 
u32
 
nüc
 = 0;

6149 
u8
 *
bssid
, *
v¬ŸbË
 = 
mgmt
->
u
.
b—cÚ
.variable;

6150 
u8
 
d—uth_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

6151 
›“80211_–ems_·r£_·¿ms
 
·r£_·¿ms
 = {

6152 .
mode
 = 
lšk
->
u
.
mgd
.
cÚn
.mode,

6153 .
lšk_id
 = -1,

6154 .
äom_­
 = 
Œue
,

6157 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

6160 
bssid
 = 
	`›“80211_g‘_bssid
(
hdr
, 
Ën
, 
sd©a
->
vif
.
ty³
);

6161 ià(
	`›“80211_is_s1g_b—cÚ
(
mgmt
->
äame_cÚŒŞ
)) {

6162 
›“80211_ext
 *
ext
 = (*è
mgmt
;

6164 ià(
	`›“80211_is_s1g_shÜt_b—cÚ
(
ext
->
äame_cÚŒŞ
))

6165 
v¬ŸbË
 = 
ext
->
u
.
s1g_shÜt_b—cÚ
.variable;

6167 
v¬ŸbË
 = 
ext
->
u
.
s1g_b—cÚ
.variable;

6170 
ba£Ën
 = (
u8
 *è
v¬ŸbË
 - (u8 *è
mgmt
;

6171 ià(
ba£Ën
 > 
Ën
)

6174 
·r£_·¿ms
.
¡¬t
 = 
v¬ŸbË
;

6175 
·r£_·¿ms
.
Ën
 =†’ - 
ba£Ën
;

6177 
	`rcu_»ad_lock
();

6178 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
lšk
->
cÚf
->chanctx_conf);

6179 ià(!
chªùx_cÚf
) {

6180 
	`rcu_»ad_uÆock
();

6184 ià(
	`›“80211_rx_¡©us_to_khz
(
rx_¡©us
) !=

6185 
	`›“80211_chªÃl_to_khz
(
chªùx_cÚf
->
def
.
chª
)) {

6186 
	`rcu_»ad_uÆock
();

6189 
chª
 = 
chªùx_cÚf
->
def
.chan;

6190 
	`rcu_»ad_uÆock
();

6192 ià(
ifmgd
->
assoc_d©a
 && ifmgd->assoc_d©a->
Ãed_b—cÚ
 &&

6193 !
	`WARN_ON
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) &&

6194 
	`›“80211_rx_our_b—cÚ
(
bssid
, 
ifmgd
->
assoc_d©a
->
lšk
[0].
bss
)) {

6195 
·r£_·¿ms
.
bss
 = 
ifmgd
->
assoc_d©a
->
lšk
[0].bss;

6196 
–ems
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

6197 ià(!
–ems
)

6200 
	`›“80211_rx_bss_šfo
(
lšk
, 
mgmt
, 
Ën
, 
rx_¡©us
);

6202 ià(
–ems
->
dtim_³riod
)

6203 
lšk
->
u
.
mgd
.
dtim_³riod
 = 
–ems
->dtim_period;

6204 
lšk
->
u
.
mgd
.
have_b—cÚ
 = 
Œue
;

6205 
ifmgd
->
assoc_d©a
->
Ãed_b—cÚ
 = 
çl£
;

6206 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TIMING_BEACON_ONLY
) &&

6207 !
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
)) {

6208 
lšk
->
cÚf
->
sync_tsf
 =

6209 
	`Ë64_to_ıu
(
mgmt
->
u
.
b—cÚ
.
time¡amp
);

6210 
lšk
->
cÚf
->
sync_deviû_ts
 =

6211 
rx_¡©us
->
deviû_time¡amp
;

6212 
lšk
->
cÚf
->
sync_dtim_couÁ
 = 
–ems
->
dtim_couÁ
;

6215 ià(
–ems
->
mbssid_cÚfig_›
)

6216 
bss_cÚf
->
´ofe_³riodic™y
 =

6217 
–ems
->
mbssid_cÚfig_›
->
´ofe_³riodic™y
;

6219 
bss_cÚf
->
´ofe_³riodic™y
 = 0;

6221 ià(
–ems
->
ext_ÿ·b_Ën
 >= 11 &&

6222 (
–ems
->
ext_ÿ·b
[10] & 
WLAN_EXT_CAPA11_EMA_SUPPORT
))

6223 
bss_cÚf
->
ema_­
 = 
Œue
;

6225 
bss_cÚf
->
ema_­
 = 
çl£
;

6228 
ifmgd
->
assoc_d©a
->
timeout
 = 
jiff›s
;

6229 
ifmgd
->
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

6230 
	`run_agaš
(
sd©a
, 
ifmgd
->
assoc_d©a
->
timeout
);

6231 
	`kä“
(
–ems
);

6235 ià(!
ifmgd
->
assocŸ‹d
 ||

6236 !
	`›“80211_rx_our_b—cÚ
(
bssid
, 
lšk
->
cÚf
->
bss
))

6238 
bssid
 = 
lšk
->
u
.
mgd
.bssid;

6240 ià(!(
rx_¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
))

6241 
	`›“80211_hªdË_b—cÚ_sig
(
lšk
, 
ifmgd
, 
bss_cÚf
,

6242 
loÿl
, 
rx_¡©us
);

6244 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_CONNECTION_POLL
) {

6245 
	`mlme_dbg_¿‹lim™ed
(
sd©a
,

6247 
	`›“80211_»£t_­_´obe
(
sd©a
);

6254 
	`›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
sd©a
);

6261 ià(!
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
))

6262 
nüc
 = 
	`üc32_be
(0, (*)&
mgmt
->
u
.
b—cÚ
.
b—cÚ_št
, 4);

6263 
·r£_·¿ms
.
bss
 = 
lšk
->
cÚf
->bss;

6264 
·r£_·¿ms
.
f‹r
 = 
ÿ»_about_›s
;

6265 
·r£_·¿ms
.
üc
 = 
nüc
;

6266 
–ems
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

6267 ià(!
–ems
)

6269 
nüc
 = 
–ems
->
üc
;

6271 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
) &&

6272 
	`›“80211_check_tim
(
–ems
->
tim
,ƒËms->
tim_Ën
, 
vif_cfg
->
aid
)) {

6273 ià(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
 > 0) {

6274 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
) {

6275 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_PS
;

6276 
	`›“80211_hw_cÚfig
(
loÿl
,

6277 
IEEE80211_CONF_CHANGE_PS
);

6279 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
çl£
);

6280 } ià(!
loÿl
->
p¥Şlšg
 && 
sd©a
->
u
.
mgd
.
pow”§ve
) {

6281 
loÿl
->
p¥Şlšg
 = 
Œue
;

6291 
	`›“80211_£nd_p¥Şl
(
loÿl
, 
sd©a
);

6295 ià(
sd©a
->
vif
.
p2p
 ||

6296 
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_GET_NOA_UPDATE
) {

6297 
›“80211_p2p_nß_©Œ
 
nß
 = {};

6298 
»t
;

6300 
»t
 = 
	`cfg80211_g‘_p2p_©Œ
(
v¬ŸbË
,

6301 
Ën
 - 
ba£Ën
,

6302 
IEEE80211_P2P_ATTR_ABSENCE_NOTICE
,

6303 (
u8
 *è&
nß
, (noa));

6304 ià(
»t
 >= 2) {

6305 ià(
lšk
->
u
.
mgd
.
p2p_nß_šdex
 !ğ
nß
.
šdex
) {

6307 
lšk
->
u
.
mgd
.
p2p_nß_šdex
 = 
nß
.
šdex
;

6308 
	`memıy
(&
bss_cÚf
->
p2p_nß_©Œ
, &
nß
, (noa));

6309 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

6314 
lšk
->
u
.
mgd
.
b—cÚ_üc_v®id
 = 
çl£
;

6316 } ià(
lšk
->
u
.
mgd
.
p2p_nß_šdex
 != -1) {

6318 
lšk
->
u
.
mgd
.
p2p_nß_šdex
 = -1;

6319 
	`mem£t
(&
bss_cÚf
->
p2p_nß_©Œ
, 0, (bss_conf->p2p_noa_attr));

6320 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

6321 
lšk
->
u
.
mgd
.
b—cÚ_üc_v®id
 = 
çl£
;

6333 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TIMING_BEACON_ONLY
) &&

6334 !
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
)) {

6335 
lšk
->
cÚf
->
sync_tsf
 =

6336 
	`Ë64_to_ıu
(
mgmt
->
u
.
b—cÚ
.
time¡amp
);

6337 
lšk
->
cÚf
->
sync_deviû_ts
 =

6338 
rx_¡©us
->
deviû_time¡amp
;

6339 
lšk
->
cÚf
->
sync_dtim_couÁ
 = 
–ems
->
dtim_couÁ
;

6342 ià((
nüc
 =ğ
lšk
->
u
.
mgd
.
b—cÚ_üc
 &&†šk->u.mgd.
b—cÚ_üc_v®id
) ||

6343 
	`›“80211_is_s1g_shÜt_b—cÚ
(
mgmt
->
äame_cÚŒŞ
))

6344 
ä“
;

6345 
lšk
->
u
.
mgd
.
b—cÚ_üc
 = 
nüc
;

6346 
lšk
->
u
.
mgd
.
b—cÚ_üc_v®id
 = 
Œue
;

6348 
	`›“80211_rx_bss_šfo
(
lšk
, 
mgmt
, 
Ën
, 
rx_¡©us
);

6350 
	`›“80211_¡a_´oûss_chªsw™ch
(
lšk
, 
rx_¡©us
->
maùime
,

6351 
rx_¡©us
->
deviû_time¡amp
,

6352 
–ems
, 
Œue
);

6354 ià(!
lšk
->
u
.
mgd
.
di§bË_wmm_Œackšg
 &&

6355 
	`›“80211_¡a_wmm_·¿ms
(
loÿl
, 
lšk
, 
–ems
->
wmm_·¿m
,

6356 
–ems
->
wmm_·¿m_Ën
,

6357 
–ems
->
mu_edÿ_·¿m_£t
))

6358 
chªged
 |ğ
BSS_CHANGED_QOS
;

6364 ià(!
lšk
->
u
.
mgd
.
have_b—cÚ
) {

6366 
bss_cÚf
->
dtim_³riod
 = 
–ems
->dtim_period ?: 1;

6368 
chªged
 |ğ
BSS_CHANGED_BEACON_INFO
;

6369 
lšk
->
u
.
mgd
.
have_b—cÚ
 = 
Œue
;

6371 
	`›“80211_»ÿlc_ps
(
loÿl
);

6373 
	`›“80211_»ÿlc_ps_vif
(
sd©a
);

6376 ià(
–ems
->
”p_šfo
) {

6377 
”p_v®id
 = 
Œue
;

6378 
”p_v®ue
 = 
–ems
->
”p_šfo
[0];

6380 
”p_v®id
 = 
çl£
;

6383 ià(!
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
))

6384 
chªged
 |ğ
	`›“80211_hªdË_bss_ÿ·b™y
(
lšk
,

6385 
	`Ë16_to_ıu
(
mgmt
->
u
.
b—cÚ
.
ÿ·b_šfo
),

6386 
”p_v®id
, 
”p_v®ue
);

6388 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
vif
.
cfg
.
­_addr
);

6389 ià(
	`WARN_ON
(!
¡a
)) {

6390 
ä“
;

6392 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[lšk->
lšk_id
],

6393 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

6394 ià(
	`WARN_ON
(!
lšk_¡a
)) {

6395 
ä“
;

6398 ià(
	`WARN_ON
(!
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
))

6399 
ä“
;

6401 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
->
bªd
];

6403 
chªged
 |ğ
	`›“80211_»ÿlc_twt_»q
(
sd©a
, 
sbªd
, 
lšk
, 
lšk_¡a
, 
–ems
);

6405 ià(
	`›“80211_cÚfig_bw
(
lšk
, 
–ems
, 
Œue
, &
chªged
)) {

6406 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DEAUTH
,

6407 
WLAN_REASON_DEAUTH_LEAVING
,

6408 
Œue
, 
d—uth_buf
);

6409 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
d—uth_buf
,

6410 (
d—uth_buf
), 
Œue
,

6411 
WLAN_REASON_DEAUTH_LEAVING
,

6412 
çl£
);

6413 
ä“
;

6416 ià(
–ems
->
İmode_nÙif
)

6417 
	`›“80211_vht_hªdË_İmode
(
sd©a
, 
lšk_¡a
,

6418 *
–ems
->
İmode_nÙif
,

6419 
rx_¡©us
->
bªd
);

6421 
chªged
 |ğ
	`›“80211_hªdË_pwr_cÚ¡r
(
lšk
, 
chª
, 
mgmt
,

6422 
–ems
->
couÁry_–em
,

6423 
–ems
->
couÁry_–em_Ën
,

6424 
–ems
->
pwr_cÚ¡r_–em
,

6425 
–ems
->
cisco_dc_–em
);

6427 
	`›“80211_ml_»cÚfigu¿tiÚ
(
sd©a
, 
–ems
);

6428 
	`›“80211_´oûss_adv_‰lm
(
sd©a
, 
–ems
,

6429 
	`Ë64_to_ıu
(
mgmt
->
u
.
b—cÚ
.
time¡amp
));

6431 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

6432 
ä“
:

6433 
	`kä“
(
–ems
);

6434 
	}
}

6436 
	$›“80211_­¶y_Ãg_‰lm
(
›“80211_sub_if_d©a
 *
sd©a
,

6437 
›“80211_Ãg_‰lm
 
Ãg_‰lm
)

6439 
u16
 
Ãw_aùive_lšks
, 
Ãw_dÜmªt_lšks
, 
Ãw_su¥’ded_lšks
, 
m­
 = 0;

6440 
u8
 
i
;

6442 
i
 = 0; i < 
IEEE80211_TTLM_NUM_TIDS
; i++)

6443 
m­
 |ğ
Ãg_‰lm
.
dowÆšk
[
i
] |‚eg_‰lm.
u¶šk
[i];

6446 ià(
sd©a
->
vif
.
Ãg_‰lm
.
v®id
)

6447 
sd©a
->
vif
.
dÜmªt_lšks
 &ğ~sd©a->vif.
su¥’ded_lšks
;

6450 
Ãw_aùive_lšks
 =

6451 
m­
 & 
sd©a
->
vif
.
v®id_lšks
 & ~sd©a->vif.
dÜmªt_lšks
;

6452 
Ãw_su¥’ded_lšks
 =

6453 (~
m­
 & 
sd©a
->
vif
.
v®id_lšks
è& ~sd©a->vif.
dÜmªt_lšks
;

6454 
Ãw_dÜmªt_lšks
 = 
sd©a
->
vif
.
dÜmªt_lšks
 | 
Ãw_su¥’ded_lšks
;

6455 ià(
	`›“80211_‰lm_£t_lšks
(
sd©a
, 
Ãw_aùive_lšks
,

6456 
Ãw_dÜmªt_lšks
, 
Ãw_su¥’ded_lšks
))

6459 
sd©a
->
vif
.
Ãg_‰lm
 =‚eg_ttlm;

6460 
sd©a
->
vif
.
Ãg_‰lm
.
v®id
 = 
Œue
;

6461 
	}
}

6463 
	$›“80211_Ãg_‰lm_timeout_wÜk
(
why
 *wiphy,

6464 
why_wÜk
 *
wÜk
)

6466 
›“80211_sub_if_d©a
 *
sd©a
 =

6467 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

6468 
u
.
mgd
.
Ãg_‰lm_timeout_wÜk
.
wÜk
);

6470 
	`sd©a_šfo
(
sd©a
,

6473 
	`__›“80211_discÚÃù
(
sd©a
);

6474 
	}
}

6477 
	$›“80211_Ãg_‰lm_add_sugge¡ed_m­
(
sk_buff
 *
skb
,

6478 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
)

6480 
u8
 
i
, 
dœeùiÚ
[
IEEE80211_TTLM_MAX_CNT
];

6482 ià(
	`memcmp
(
Ãg_‰lm
->
dowÆšk
,‚eg_‰lm->
u¶šk
,

6483 (
Ãg_‰lm
->
dowÆšk
))) {

6484 
dœeùiÚ
[0] = 
IEEE80211_TTLM_DIRECTION_DOWN
;

6485 
dœeùiÚ
[1] = 
IEEE80211_TTLM_DIRECTION_UP
;

6487 
dœeùiÚ
[0] = 
IEEE80211_TTLM_DIRECTION_BOTH
;

6490 
i
 = 0; i < 
	`ARRAY_SIZE
(
dœeùiÚ
); i++) {

6491 
u8
 
tid
, 
Ën
, 
m­_šd
 = 0, *
Ën_pos
, *
m­_šd_pos
, *
pos
;

6492 
__Ë16
 
m­
;

6494 
Ën
 = (
›“80211_‰lm_–em
) + 1 + 1;

6496 
pos
 = 
	`skb_put
(
skb
, 
Ën
 + 2);

6497 *
pos
++ = 
WLAN_EID_EXTENSION
;

6498 
Ën_pos
 = 
pos
++;

6499 *
pos
++ = 
WLAN_EID_EXT_TID_TO_LINK_MAPPING
;

6500 *
pos
++ = 
dœeùiÚ
[
i
];

6501 
m­_šd_pos
 = 
pos
++;

6502 
tid
 = 0;id < 
IEEE80211_TTLM_NUM_TIDS
;id++) {

6503 
m­
 = 
dœeùiÚ
[
i
] =ğ
IEEE80211_TTLM_DIRECTION_UP
 ?

6504 
	`ıu_to_Ë16
(
Ãg_‰lm
->
u¶šk
[
tid
]) :

6505 
	`ıu_to_Ë16
(
Ãg_‰lm
->
dowÆšk
[
tid
]);

6506 ià(!
m­
)

6509 
Ën
 += 2;

6510 
m­_šd
 |ğ
	`BIT
(
tid
);

6511 
	`skb_put_d©a
(
skb
, &
m­
, (map));

6514 *
m­_šd_pos
 = 
m­_šd
;

6515 *
Ën_pos
 = 
Ën
;

6517 ià(
dœeùiÚ
[
i
] =ğ
IEEE80211_TTLM_DIRECTION_BOTH
)

6520 
	}
}

6523 
	$›“80211_£nd_Ãg_‰lm_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

6524 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
,

6525 
u8
 
dŸlog_tok’
)

6527 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

6528 
›“80211_mgmt
 *
mgmt
;

6529 
sk_buff
 *
skb
;

6530 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
, 
u
.
aùiÚ
.u.
‰lm_»q
);

6531 
‰lm_max_Ën
 = 2 + 1 + (
›“80211_‰lm_–em
) + 1 +

6532 2 * 2 * 
IEEE80211_TTLM_NUM_TIDS
;

6534 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
hdr_Ën
 + 
‰lm_max_Ën
);

6535 ià(!
skb
)

6538 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

6539 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

6540 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

6541 
IEEE80211_STYPE_ACTION
);

6542 
	`memıy
(
mgmt
->
da
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

6543 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

6544 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

6546 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_EHT
;

6547 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.
aùiÚ_code
 =

6548 
WLAN_PROTECTED_EHT_ACTION_TTLM_REQ
;

6549 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.
dŸlog_tok’
 = dialog_token;

6550 
	`›“80211_Ãg_‰lm_add_sugge¡ed_m­
(
skb
, 
Ãg_‰lm
);

6551 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

6552 
	}
}

6554 
	$›“80211_»q_Ãg_‰lm
(
›“80211_sub_if_d©a
 *
sd©a
,

6555 
cfg80211_‰lm_·¿ms
 *
·¿ms
)

6557 
›“80211_Ãg_‰lm
 
Ãg_‰lm
 = {};

6558 
u8
 
i
;

6560 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
) ||

6561 !(
sd©a
->
vif
.
cfg
.
mld_ÿ·_İ
 &

6562 
IEEE80211_MLD_CAP_OP_TID_TO_LINK_MAP_NEG_SUPP
))

6563  -
EINVAL
;

6565 
i
 = 0; i < 
IEEE80211_TTLM_NUM_TIDS
; i++) {

6566 ià((
·¿ms
->
dlšk
[
i
] & ~
sd©a
->
vif
.
v®id_lšks
) ||

6567 (
·¿ms
->
ulšk
[
i
] & ~
sd©a
->
vif
.
v®id_lšks
))

6568  -
EINVAL
;

6570 
Ãg_‰lm
.
dowÆšk
[
i
] = 
·¿ms
->
dlšk
[i];

6571 
Ãg_‰lm
.
u¶šk
[
i
] = 
·¿ms
->
ulšk
[i];

6574 ià(
	`drv_ÿn_Ãg_‰lm
(
sd©a
->
loÿl
, sd©a, &
Ãg_‰lm
) !=

6575 
NEG_TTLM_RES_ACCEPT
)

6576  -
EINVAL
;

6578 
	`›“80211_­¶y_Ãg_‰lm
(
sd©a
, 
Ãg_‰lm
);

6579 
sd©a
->
u
.
mgd
.
dŸlog_tok’_®loc
++;

6580 
	`›“80211_£nd_Ãg_‰lm_»q
(
sd©a
, &sd©a->
vif
.
Ãg_‰lm
,

6581 
sd©a
->
u
.
mgd
.
dŸlog_tok’_®loc
);

6582 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

6583 &
sd©a
->
u
.
mgd
.
Ãg_‰lm_timeout_wÜk
);

6584 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

6585 &
sd©a
->
u
.
mgd
.
Ãg_‰lm_timeout_wÜk
,

6586 
IEEE80211_NEG_TTLM_REQ_TIMEOUT
);

6588 
	}
}

6591 
	$›“80211_£nd_Ãg_‰lm_»s
(
›“80211_sub_if_d©a
 *
sd©a
,

6592 
›“80211_Ãg_‰lm_»s
 
‰lm_»s
,

6593 
u8
 
dŸlog_tok’
,

6594 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
)

6596 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

6597 
›“80211_mgmt
 *
mgmt
;

6598 
sk_buff
 *
skb
;

6599 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
, 
u
.
aùiÚ
.u.
‰lm_»s
);

6600 
‰lm_max_Ën
 = 2 + 1 + (
›“80211_‰lm_–em
) + 1 +

6601 2 * 2 * 
IEEE80211_TTLM_NUM_TIDS
;

6603 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
hdr_Ën
 + 
‰lm_max_Ën
);

6604 ià(!
skb
)

6607 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

6608 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

6609 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

6610 
IEEE80211_STYPE_ACTION
);

6611 
	`memıy
(
mgmt
->
da
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

6612 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

6613 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

6615 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_EHT
;

6616 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»s
.
aùiÚ_code
 =

6617 
WLAN_PROTECTED_EHT_ACTION_TTLM_RES
;

6618 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»s
.
dŸlog_tok’
 = dialog_token;

6619 
‰lm_»s
) {

6621 
	`WARN_ON
(1);

6622 
çÎthrough
;

6623 
NEG_TTLM_RES_REJECT
:

6624 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»s
.
¡©us_code
 =

6625 
WLAN_STATUS_DENIED_TID_TO_LINK_MAPPING
;

6627 
NEG_TTLM_RES_ACCEPT
:

6628 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»s
.
¡©us_code
 = 
WLAN_STATUS_SUCCESS
;

6630 
NEG_TTLM_RES_SUGGEST_PREFERRED
:

6631 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»s
.
¡©us_code
 =

6632 
WLAN_STATUS_PREF_TID_TO_LINK_MAPPING_SUGGESTED
;

6633 
	`›“80211_Ãg_‰lm_add_sugge¡ed_m­
(
skb
, 
Ãg_‰lm
);

6637 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

6638 
	}
}

6641 
	$›“80211_·r£_Ãg_‰lm
(
›“80211_sub_if_d©a
 *
sd©a
,

6642 cÚ¡ 
›“80211_‰lm_–em
 *
‰lm
,

6643 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
,

6644 
u8
 *
dœeùiÚ
)

6646 
u8
 
cÚŒŞ
, 
lšk_m­_´e£nû
, 
m­_size
, 
tid
;

6647 
u8
 *
pos
;

6652 
pos
 = (*)
‰lm
->
İtiÚ®
;

6654 
cÚŒŞ
 = 
‰lm
->control;

6659 ià(
cÚŒŞ
 & (
IEEE80211_TTLM_CONTROL_SWITCH_TIME_PRESENT
 |

6660 
IEEE80211_TTLM_CONTROL_EXPECTED_DUR_PRESENT
)) {

6661 
	`mlme_dbg
(
sd©a
,

6663  -
EINVAL
;

6666 ià(
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_DEF_LINK_MAP
) {

6667 
tid
 = 0;id < 
IEEE80211_TTLM_NUM_TIDS
;id++) {

6668 
Ãg_‰lm
->
dowÆšk
[
tid
] = 
sd©a
->
vif
.
v®id_lšks
;

6669 
Ãg_‰lm
->
u¶šk
[
tid
] = 
sd©a
->
vif
.
v®id_lšks
;

6671 *
dœeùiÚ
 = 
IEEE80211_TTLM_DIRECTION_BOTH
;

6675 *
dœeùiÚ
 = 
	`u8_g‘_b™s
(
cÚŒŞ
, 
IEEE80211_TTLM_CONTROL_DIRECTION
);

6676 ià(*
dœeùiÚ
 !ğ
IEEE80211_TTLM_DIRECTION_DOWN
 &&

6677 *
dœeùiÚ
 !ğ
IEEE80211_TTLM_DIRECTION_UP
 &&

6678 *
dœeùiÚ
 !ğ
IEEE80211_TTLM_DIRECTION_BOTH
)

6679  -
EINVAL
;

6681 
lšk_m­_´e£nû
 = *
pos
;

6682 
pos
++;

6684 ià(
cÚŒŞ
 & 
IEEE80211_TTLM_CONTROL_LINK_MAP_SIZE
)

6685 
m­_size
 = 1;

6687 
m­_size
 = 2;

6689 
tid
 = 0;id < 
IEEE80211_TTLM_NUM_TIDS
;id++) {

6690 
u16
 
m­
;

6692 ià(
lšk_m­_´e£nû
 & 
	`BIT
(
tid
)) {

6693 
m­
 = 
	`›“80211_g‘_‰lm
(
m­_size
, 
pos
);

6694 ià(!
m­
) {

6695 
	`mlme_dbg
(
sd©a
,

6696 "NØaùivlšk fÜ TID %d", 
tid
);

6697  -
EINVAL
;

6700 
m­
 = 0;

6703 *
dœeùiÚ
) {

6704 
IEEE80211_TTLM_DIRECTION_BOTH
:

6705 
Ãg_‰lm
->
dowÆšk
[
tid
] = 
m­
;

6706 
Ãg_‰lm
->
u¶šk
[
tid
] = 
m­
;

6708 
IEEE80211_TTLM_DIRECTION_DOWN
:

6709 
Ãg_‰lm
->
dowÆšk
[
tid
] = 
m­
;

6711 
IEEE80211_TTLM_DIRECTION_UP
:

6712 
Ãg_‰lm
->
u¶šk
[
tid
] = 
m­
;

6715  -
EINVAL
;

6717 
pos
 +ğ
m­_size
;

6720 
	}
}

6722 
	$›“80211_´oûss_Ãg_‰lm_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

6723 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

6725 
u8
 
dŸlog_tok’
, 
dœeùiÚ
[
IEEE80211_TTLM_MAX_CNT
] = {}, 
i
;

6726 
size_t
 
›s_Ën
;

6727 
›“80211_Ãg_‰lm_»s
 
‰lm_»s
 = 
NEG_TTLM_RES_ACCEPT
;

6728 
›“802_11_–ems
 *
–ems
 = 
NULL
;

6729 
›“80211_Ãg_‰lm
 
Ãg_‰lm
 = {};

6731 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
dœeùiÚ
è!ğARRAY_SIZE(
–ems
->
‰lm
));

6733 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

6736 
dŸlog_tok’
 = 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.dialog_token;

6737 
›s_Ën
 = 
Ën
 - 
	`off£tof
(
›“80211_mgmt
,

6738 
u
.
aùiÚ
.u.
‰lm_»q
.
v¬ŸbË
);

6739 
–ems
 = 
	`›“802_11_·r£_–ems
(
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.
v¬ŸbË
,

6740 
›s_Ën
, 
Œue
, 
NULL
);

6741 ià(!
–ems
) {

6742 
‰lm_»s
 = 
NEG_TTLM_RES_REJECT
;

6743 
out
;

6746 
i
 = 0; i < 
–ems
->
‰lm_num
; i++) {

6747 ià(
	`›“80211_·r£_Ãg_‰lm
(
sd©a
, 
–ems
->
‰lm
[
i
],

6748 &
Ãg_‰lm
, &
dœeùiÚ
[
i
]) ||

6749 (
dœeùiÚ
[
i
] =ğ
IEEE80211_TTLM_DIRECTION_BOTH
 &&

6750 
–ems
->
‰lm_num
 != 1)) {

6751 
‰lm_»s
 = 
NEG_TTLM_RES_REJECT
;

6752 
out
;

6756 ià(!
–ems
->
‰lm_num
 ||

6757 (
–ems
->
‰lm_num
 =ğ2 && 
dœeùiÚ
[0] == direction[1])) {

6758 
‰lm_»s
 = 
NEG_TTLM_RES_REJECT
;

6759 
out
;

6762 
i
 = 0; i < 
IEEE80211_TTLM_NUM_TIDS
; i++) {

6763 ià((
Ãg_‰lm
.
dowÆšk
[
i
] &&

6764 (
Ãg_‰lm
.
dowÆšk
[
i
] & ~
sd©a
->
vif
.
v®id_lšks
)) ||

6765 (
Ãg_‰lm
.
u¶šk
[
i
] &&

6766 (
Ãg_‰lm
.
u¶šk
[
i
] & ~
sd©a
->
vif
.
v®id_lšks
))) {

6767 
‰lm_»s
 = 
NEG_TTLM_RES_REJECT
;

6768 
out
;

6772 
‰lm_»s
 = 
	`drv_ÿn_Ãg_‰lm
(
sd©a
->
loÿl
, sd©a, &
Ãg_‰lm
);

6774 ià(
‰lm_»s
 !ğ
NEG_TTLM_RES_ACCEPT
)

6775 
out
;

6777 
	`›“80211_­¶y_Ãg_‰lm
(
sd©a
, 
Ãg_‰lm
);

6778 
out
:

6779 
	`kä“
(
–ems
);

6780 
	`›“80211_£nd_Ãg_‰lm_»s
(
sd©a
, 
‰lm_»s
, 
dŸlog_tok’
, &
Ãg_‰lm
);

6781 
	}
}

6783 
	$›“80211_´oûss_Ãg_‰lm_»s
(
›“80211_sub_if_d©a
 *
sd©a
,

6784 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
)

6786 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
) ||

6787 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.
dŸlog_tok’
 !=

6788 
sd©a
->
u
.
mgd
.
dŸlog_tok’_®loc
)

6791 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

6792 &
sd©a
->
u
.
mgd
.
Ãg_‰lm_timeout_wÜk
);

6802 ià(
mgmt
->
u
.
aùiÚ
.u.
‰lm_»s
.
¡©us_code
 !ğ
WLAN_STATUS_SUCCESS
)

6803 
	`__›“80211_discÚÃù
(
sd©a
);

6804 
	}
}

6806 
	$›“80211_¡a_rx_queued_ext
(
›“80211_sub_if_d©a
 *
sd©a
,

6807 
sk_buff
 *
skb
)

6809 
›“80211_lšk_d©a
 *
lšk
 = &
sd©a
->
deæšk
;

6810 
›“80211_rx_¡©us
 *
rx_¡©us
;

6811 
›“80211_hdr
 *
hdr
;

6812 
u16
 
fc
;

6814 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

6816 
rx_¡©us
 = (
›“80211_rx_¡©us
 *è
skb
->
cb
;

6817 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

6818 
fc
 = 
	`Ë16_to_ıu
(
hdr
->
äame_cÚŒŞ
);

6820 
fc
 & 
IEEE80211_FCTL_STYPE
) {

6821 
IEEE80211_STYPE_S1G_BEACON
:

6822 
	`›“80211_rx_mgmt_b—cÚ
(
lšk
, 
hdr
, 
skb
->
Ën
, 
rx_¡©us
);

6825 
	}
}

6827 
	$›“80211_¡a_rx_queued_mgmt
(
›“80211_sub_if_d©a
 *
sd©a
,

6828 
sk_buff
 *
skb
)

6830 
›“80211_lšk_d©a
 *
lšk
 = &
sd©a
->
deæšk
;

6831 
›“80211_rx_¡©us
 *
rx_¡©us
;

6832 
›“80211_mgmt
 *
mgmt
;

6833 
u16
 
fc
;

6834 
›s_Ën
;

6836 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

6838 
rx_¡©us
 = (
›“80211_rx_¡©us
 *è
skb
->
cb
;

6839 
mgmt
 = (
›“80211_mgmt
 *è
skb
->
d©a
;

6840 
fc
 = 
	`Ë16_to_ıu
(
mgmt
->
äame_cÚŒŞ
);

6842 ià(
rx_¡©us
->
lšk_v®id
) {

6843 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
rx_¡©us
->
lšk_id
],

6844 
sd©a
);

6845 ià(!
lšk
)

6849 
fc
 & 
IEEE80211_FCTL_STYPE
) {

6850 
IEEE80211_STYPE_BEACON
:

6851 
	`›“80211_rx_mgmt_b—cÚ
(
lšk
, (*)
mgmt
,

6852 
skb
->
Ën
, 
rx_¡©us
);

6854 
IEEE80211_STYPE_PROBE_RESP
:

6855 
	`›“80211_rx_mgmt_´obe_»¥
(
lšk
, 
skb
);

6857 
IEEE80211_STYPE_AUTH
:

6858 
	`›“80211_rx_mgmt_auth
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

6860 
IEEE80211_STYPE_DEAUTH
:

6861 
	`›“80211_rx_mgmt_d—uth
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

6863 
IEEE80211_STYPE_DISASSOC
:

6864 
	`›“80211_rx_mgmt_di§ssoc
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

6866 
IEEE80211_STYPE_ASSOC_RESP
:

6867 
IEEE80211_STYPE_REASSOC_RESP
:

6868 
	`›“80211_rx_mgmt_assoc_»¥
(
sd©a
, 
mgmt
, 
skb
->
Ën
);

6870 
IEEE80211_STYPE_ACTION
:

6871 ià(!
sd©a
->
u
.
mgd
.
assocŸ‹d
 ||

6872 !
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
))

6875 ià(
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_SPECTRUM_MGMT
) {

6876 
›“802_11_–ems
 *
–ems
;

6878 
›s_Ën
 = 
skb
->
Ën
 -

6879 
	`off£tof
(
›“80211_mgmt
,

6880 
u
.
aùiÚ
.u.
chª_sw™ch
.
v¬ŸbË
);

6882 ià(
›s_Ën
 < 0)

6886 
–ems
 = 
	`›“802_11_·r£_–ems
(

6887 
mgmt
->
u
.
aùiÚ
.u.
chª_sw™ch
.
v¬ŸbË
,

6888 
›s_Ën
, 
Œue
, 
NULL
);

6890 ià(
–ems
 && !–ems->
·r£_”rÜ
)

6891 
	`›“80211_¡a_´oûss_chªsw™ch
(
lšk
,

6892 
rx_¡©us
->
maùime
,

6893 
rx_¡©us
->
deviû_time¡amp
,

6894 
–ems
, 
çl£
);

6895 
	`kä“
(
–ems
);

6896 } ià(
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_PUBLIC
) {

6897 
›“802_11_–ems
 *
–ems
;

6899 
›s_Ën
 = 
skb
->
Ën
 -

6900 
	`off£tof
(
›“80211_mgmt
,

6901 
u
.
aùiÚ
.u.
ext_chª_sw™ch
.
v¬ŸbË
);

6903 ià(
›s_Ën
 < 0)

6910 
–ems
 = 
	`›“802_11_·r£_–ems
(

6911 
mgmt
->
u
.
aùiÚ
.u.
ext_chª_sw™ch
.
v¬ŸbË
,

6912 
›s_Ën
, 
Œue
, 
NULL
);

6914 ià(
–ems
 && !–ems->
·r£_”rÜ
) {

6916 
–ems
->
ext_chªsw_›
 =

6917 &
mgmt
->
u
.
aùiÚ
.u.
ext_chª_sw™ch
.
d©a
;

6919 
	`›“80211_¡a_´oûss_chªsw™ch
(
lšk
,

6920 
rx_¡©us
->
maùime
,

6921 
rx_¡©us
->
deviû_time¡amp
,

6922 
–ems
, 
çl£
);

6925 
	`kä“
(
–ems
);

6929 
	}
}

6931 
	$›“80211_¡a_tim”
(
tim”_li¡
 *
t
)

6933 
›“80211_sub_if_d©a
 *
sd©a
 =

6934 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
mgd
.
tim”
);

6936 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

6937 
	}
}

6939 
	$›“80211_¡a_cÚÃùiÚ_lo¡
(
›“80211_sub_if_d©a
 *
sd©a
,

6940 
u8
 
»asÚ
, 
boŞ
 
tx
)

6942 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

6944 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DEAUTH
, 
»asÚ
,

6945 
tx
, 
äame_buf
);

6947 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
, (äame_buf), 
Œue
,

6948 
»asÚ
, 
çl£
);

6949 
	}
}

6951 
	$›“80211_auth
(
›“80211_sub_if_d©a
 *
sd©a
)

6953 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

6954 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

6955 
›“80211_mgd_auth_d©a
 *
auth_d©a
 = 
ifmgd
->auth_data;

6956 
u32
 
tx_æags
 = 0;

6957 
u16
 
Œªs
 = 1;

6958 
u16
 
¡©us
 = 0;

6959 
›“80211_´•_tx_šfo
 
šfo
 = {

6960 .
subty³
 = 
IEEE80211_STYPE_AUTH
,

6963 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

6965 ià(
	`WARN_ON_ONCE
(!
auth_d©a
))

6966  -
EINVAL
;

6968 
auth_d©a
->
Œ›s
++;

6970 ià(
auth_d©a
->
Œ›s
 > 
IEEE80211_AUTH_MAX_TRIES
) {

6971 
	`sd©a_šfo
(
sd©a
, "authentication with %pMimed out\n",

6972 
auth_d©a
->
­_addr
);

6978 
	`cfg80211_uÆšk_bss
(
loÿl
->
hw
.
why
, 
auth_d©a
->
bss
);

6980  -
ETIMEDOUT
;

6983 ià(
auth_d©a
->
®gÜ™hm
 =ğ
WLAN_AUTH_SAE
)

6984 
šfo
.
du¿tiÚ
 = 
	`jiff›s_to_m£cs
(
IEEE80211_AUTH_TIMEOUT_SAE
);

6986 
šfo
.
lšk_id
 = 
auth_d©a
->link_id;

6987 
	`drv_mgd_´•¬e_tx
(
loÿl
, 
sd©a
, &
šfo
);

6989 
	`sd©a_šfo
(
sd©a
, "send‡utho %pM (try %d/%d)\n",

6990 
auth_d©a
->
­_addr
,‡uth_d©a->
Œ›s
,

6991 
IEEE80211_AUTH_MAX_TRIES
);

6993 
auth_d©a
->
ex³ùed_Œª§ùiÚ
 = 2;

6995 ià(
auth_d©a
->
®gÜ™hm
 =ğ
WLAN_AUTH_SAE
) {

6996 
Œªs
 = 
auth_d©a
->
§e_Œªs
;

6997 
¡©us
 = 
auth_d©a
->
§e_¡©us
;

6998 
auth_d©a
->
ex³ùed_Œª§ùiÚ
 = 
Œªs
;

7001 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
))

7002 
tx_æags
 = 
IEEE80211_TX_CTL_REQ_TX_STATUS
 |

7003 
IEEE80211_TX_INTFL_MLME_CONN_TX
;

7005 
	`›“80211_£nd_auth
(
sd©a
, 
Œªs
, 
auth_d©a
->
®gÜ™hm
, 
¡©us
,

7006 
auth_d©a
->
d©a
,‡uth_d©a->
d©a_Ën
,

7007 
auth_d©a
->
­_addr
,‡uth_data->ap_addr,

7008 
NULL
, 0, 0, 
tx_æags
);

7010 ià(
tx_æags
 == 0) {

7011 ià(
auth_d©a
->
®gÜ™hm
 =ğ
WLAN_AUTH_SAE
)

7012 
auth_d©a
->
timeout
 = 
jiff›s
 +

7013 
IEEE80211_AUTH_TIMEOUT_SAE
;

7015 
auth_d©a
->
timeout
 = 
jiff›s
 + 
IEEE80211_AUTH_TIMEOUT
;

7017 
auth_d©a
->
timeout
 =

7018 
	`round_jiff›s_up
(
jiff›s
 + 
IEEE80211_AUTH_TIMEOUT_LONG
);

7021 
auth_d©a
->
timeout_¡¬‹d
 = 
Œue
;

7022 
	`run_agaš
(
sd©a
, 
auth_d©a
->
timeout
);

7025 
	}
}

7027 
	$›“80211_do_assoc
(
›“80211_sub_if_d©a
 *
sd©a
)

7029 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
 = 
sd©a
->
u
.
mgd
.assoc_data;

7030 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7031 
»t
;

7033 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

7035 
assoc_d©a
->
Œ›s
++;

7036 ià(
assoc_d©a
->
Œ›s
 > 
IEEE80211_ASSOC_MAX_TRIES
) {

7037 
	`sd©a_šfo
(
sd©a
, "association with %pMimed out\n",

7038 
assoc_d©a
->
­_addr
);

7044 
	`cfg80211_uÆšk_bss
(
loÿl
->
hw
.
why
,

7045 
assoc_d©a
->
lšk
[assoc_d©a->
assoc_lšk_id
].
bss
);

7047  -
ETIMEDOUT
;

7050 
	`sd©a_šfo
(
sd©a
, "associate with %pM (try %d/%d)\n",

7051 
assoc_d©a
->
­_addr
,‡ssoc_d©a->
Œ›s
,

7052 
IEEE80211_ASSOC_MAX_TRIES
);

7053 
»t
 = 
	`›“80211_£nd_assoc
(
sd©a
);

7054 ià(
»t
)

7055  
»t
;

7057 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

7058 
assoc_d©a
->
timeout
 = 
jiff›s
 + 
IEEE80211_ASSOC_TIMEOUT
;

7059 
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

7060 
	`run_agaš
(
sd©a
, 
assoc_d©a
->
timeout
);

7062 
assoc_d©a
->
timeout
 =

7063 
	`round_jiff›s_up
(
jiff›s
 +

7064 
IEEE80211_ASSOC_TIMEOUT_LONG
);

7065 
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

7066 
	`run_agaš
(
sd©a
, 
assoc_d©a
->
timeout
);

7070 
	}
}

7072 
	$›“80211_mgd_cÚn_tx_¡©us
(
›“80211_sub_if_d©a
 *
sd©a
,

7073 
__Ë16
 
fc
, 
boŞ
 
acked
)

7075 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7077 
sd©a
->
u
.
mgd
.
¡©us_fc
 = 
fc
;

7078 
sd©a
->
u
.
mgd
.
¡©us_acked
 = 
acked
;

7079 
sd©a
->
u
.
mgd
.
¡©us_»ûived
 = 
Œue
;

7081 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

7082 
	}
}

7084 
	$›“80211_¡a_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
)

7086 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7087 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7089 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

7091 ià(
ifmgd
->
¡©us_»ûived
) {

7092 
__Ë16
 
fc
 = 
ifmgd
->
¡©us_fc
;

7093 
boŞ
 
¡©us_acked
 = 
ifmgd
->status_acked;

7095 
ifmgd
->
¡©us_»ûived
 = 
çl£
;

7096 ià(
ifmgd
->
auth_d©a
 && 
	`›“80211_is_auth
(
fc
)) {

7097 ià(
¡©us_acked
) {

7098 ià(
ifmgd
->
auth_d©a
->
®gÜ™hm
 ==

7099 
WLAN_AUTH_SAE
)

7100 
ifmgd
->
auth_d©a
->
timeout
 =

7101 
jiff›s
 +

7102 
IEEE80211_AUTH_TIMEOUT_SAE
;

7104 
ifmgd
->
auth_d©a
->
timeout
 =

7105 
jiff›s
 +

7106 
IEEE80211_AUTH_TIMEOUT_SHORT
;

7107 
	`run_agaš
(
sd©a
, 
ifmgd
->
auth_d©a
->
timeout
);

7109 
ifmgd
->
auth_d©a
->
timeout
 = 
jiff›s
 - 1;

7111 
ifmgd
->
auth_d©a
->
timeout_¡¬‹d
 = 
Œue
;

7112 } ià(
ifmgd
->
assoc_d©a
 &&

7113 !
ifmgd
->
assoc_d©a
->
comeback
 &&

7114 (
	`›“80211_is_assoc_»q
(
fc
) ||

7115 
	`›“80211_is_»assoc_»q
(
fc
))) {

7125 ià(
¡©us_acked
) {

7126 
ifmgd
->
assoc_d©a
->
timeout
 =

7127 
jiff›s
 + 
IEEE80211_ASSOC_TIMEOUT_SHORT
;

7128 
	`run_agaš
(
sd©a
, 
ifmgd
->
assoc_d©a
->
timeout
);

7130 
ifmgd
->
assoc_d©a
->
timeout
 = 
jiff›s
 - 1;

7132 
ifmgd
->
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

7136 ià(
ifmgd
->
auth_d©a
 && ifmgd->auth_d©a->
timeout_¡¬‹d
 &&

7137 
	`time_aá”
(
jiff›s
, 
ifmgd
->
auth_d©a
->
timeout
)) {

7138 ià(
ifmgd
->
auth_d©a
->
dÚe
 || ifmgd->auth_d©a->
wa™šg
) {

7143 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

7144 } ià(
	`›“80211_auth
(
sd©a
)) {

7145 
u8
 
­_addr
[
ETH_ALEN
];

7146 
›“80211_ev’t
 
ev’t
 = {

7147 .
ty³
 = 
MLME_EVENT
,

7148 .
u
.
mlme
.
d©a
 = 
AUTH_EVENT
,

7149 .
u
.
mlme
.
¡©us
 = 
MLME_TIMEOUT
,

7152 
	`memıy
(
­_addr
, 
ifmgd
->
auth_d©a
->­_addr, 
ETH_ALEN
);

7154 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

7156 
	`cfg80211_auth_timeout
(
sd©a
->
dev
, 
­_addr
);

7157 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

7159 } ià(
ifmgd
->
auth_d©a
 && ifmgd->auth_d©a->
timeout_¡¬‹d
)

7160 
	`run_agaš
(
sd©a
, 
ifmgd
->
auth_d©a
->
timeout
);

7162 ià(
ifmgd
->
assoc_d©a
 && ifmgd->assoc_d©a->
timeout_¡¬‹d
 &&

7163 
	`time_aá”
(
jiff›s
, 
ifmgd
->
assoc_d©a
->
timeout
)) {

7164 ià((
ifmgd
->
assoc_d©a
->
Ãed_b—cÚ
 &&

7165 !
sd©a
->
deæšk
.
u
.
mgd
.
have_b—cÚ
) ||

7166 
	`›“80211_do_assoc
(
sd©a
)) {

7167 
›“80211_ev’t
 
ev’t
 = {

7168 .
ty³
 = 
MLME_EVENT
,

7169 .
u
.
mlme
.
d©a
 = 
ASSOC_EVENT
,

7170 .
u
.
mlme
.
¡©us
 = 
MLME_TIMEOUT
,

7173 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_TIMEOUT
);

7174 
	`drv_ev’t_ÿÎback
(
sd©a
->
loÿl
, sd©a, &
ev’t
);

7176 } ià(
ifmgd
->
assoc_d©a
 && ifmgd->assoc_d©a->
timeout_¡¬‹d
)

7177 
	`run_agaš
(
sd©a
, 
ifmgd
->
assoc_d©a
->
timeout
);

7179 ià(
ifmgd
->
æags
 & 
IEEE80211_STA_CONNECTION_POLL
 &&

7180 
ifmgd
->
assocŸ‹d
) {

7181 
u8
 *
bssid
 = 
sd©a
->
deæšk
.
u
.
mgd
.bssid;

7182 
max_Œ›s
;

7184 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
))

7185 
max_Œ›s
 = 
max_nuÎfunc_Œ›s
;

7187 
max_Œ›s
 = 
max_´obe_Œ›s
;

7190 ià(!
ifmgd
->
´obe_£nd_couÁ
)

7191 
	`›“80211_»£t_­_´obe
(
sd©a
);

7192 ià(
ifmgd
->
nuÎfunc_çed
) {

7193 ià(
ifmgd
->
´obe_£nd_couÁ
 < 
max_Œ›s
) {

7194 
	`mlme_dbg
(
sd©a
,

7196 
bssid
, 
ifmgd
->
´obe_£nd_couÁ
,

7197 
max_Œ›s
);

7198 
	`›“80211_mgd_´obe_­_£nd
(
sd©a
);

7200 
	`mlme_dbg
(
sd©a
,

7202 
bssid
);

7203 
	`›“80211_¡a_cÚÃùiÚ_lo¡
(
sd©a
,

7204 
WLAN_REASON_DISASSOC_DUE_TO_INACTIVITY
,

7205 
çl£
);

7207 } ià(
	`time_is_aá”_jiff›s
(
ifmgd
->
´obe_timeout
))

7208 
	`run_agaš
(
sd©a
, 
ifmgd
->
´obe_timeout
);

7209 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

7210 
	`mlme_dbg
(
sd©a
,

7212 
bssid
, 
´obe_wa™_ms
);

7213 
	`›“80211_¡a_cÚÃùiÚ_lo¡
(
sd©a
,

7214 
WLAN_REASON_DISASSOC_DUE_TO_INACTIVITY
, 
çl£
);

7215 } ià(
ifmgd
->
´obe_£nd_couÁ
 < 
max_Œ›s
) {

7216 
	`mlme_dbg
(
sd©a
,

7218 
bssid
, 
´obe_wa™_ms
,

7219 
ifmgd
->
´obe_£nd_couÁ
, 
max_Œ›s
);

7220 
	`›“80211_mgd_´obe_­_£nd
(
sd©a
);

7226 
	`mlme_dbg
(
sd©a
,

7228 
bssid
, 
´obe_wa™_ms
);

7230 
	`›“80211_¡a_cÚÃùiÚ_lo¡
(
sd©a
,

7231 
WLAN_REASON_DISASSOC_DUE_TO_INACTIVITY
, 
çl£
);

7234 
	}
}

7236 
	$›“80211_¡a_bú_mÚ_tim”
(
tim”_li¡
 *
t
)

7238 
›“80211_sub_if_d©a
 *
sd©a
 =

7239 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
mgd
.
bú_mÚ_tim”
);

7241 ià(
	`WARN_ON
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)))

7244 ià(
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 &&

7245 !
sd©a
->
deæšk
.
u
.
mgd
.
c§_wa™šg_bú
)

7248 ià(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_BEACON_FILTER
)

7251 
sd©a
->
u
.
mgd
.
cÚÃùiÚ_loss
 = 
çl£
;

7252 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

7253 &
sd©a
->
u
.
mgd
.
b—cÚ_cÚÃùiÚ_loss_wÜk
);

7254 
	}
}

7256 
	$›“80211_¡a_cÚn_mÚ_tim”
(
tim”_li¡
 *
t
)

7258 
›“80211_sub_if_d©a
 *
sd©a
 =

7259 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
mgd
.
cÚn_mÚ_tim”
);

7260 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7261 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7262 
¡a_šfo
 *
¡a
;

7263 
timeout
;

7265 ià(
	`WARN_ON
(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)))

7268 ià(
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 &&

7269 !
sd©a
->
deæšk
.
u
.
mgd
.
c§_wa™šg_bú
)

7272 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
vif
.
cfg
.
­_addr
);

7273 ià(!
¡a
)

7276 
timeout
 = 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack
;

7277 ià(
	`time_befÜe
(
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack
, s->deæšk.
rx_¡©s
.
Ï¡_rx
))

7278 
timeout
 = 
¡a
->
deæšk
.
rx_¡©s
.
Ï¡_rx
;

7279 
timeout
 +ğ
IEEE80211_CONNECTION_IDLE_TIME
;

7284 ià(
	`time_is_aá”_jiff›s
(
timeout
)) {

7285 
	`mod_tim”
(&
ifmgd
->
cÚn_mÚ_tim”
, 
	`round_jiff›s_up
(
timeout
));

7289 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
u
.
mgd
.
mÚ™Ü_wÜk
);

7290 
	}
}

7292 
	$›“80211_¡a_mÚ™Ü_wÜk
(
why
 *wiphy,

7293 
why_wÜk
 *
wÜk
)

7295 
›“80211_sub_if_d©a
 *
sd©a
 =

7296 
	`cÚš”_of
(
wÜk
, 
›“80211_sub_if_d©a
,

7297 
u
.
mgd
.
mÚ™Ü_wÜk
);

7299 
	`›“80211_mgd_´obe_­
(
sd©a
, 
çl£
);

7300 
	}
}

7302 
	$›“80211_»¡¬t_¡a_tim”
(
›“80211_sub_if_d©a
 *
sd©a
)

7304 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

7305 
	`__›“80211_¡İ_pŞl
(
sd©a
);

7308 ià(!
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
CONNECTION_MONITOR
))

7309 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

7310 &
sd©a
->
u
.
mgd
.
mÚ™Ü_wÜk
);

7312 
	}
}

7314 #ifdeà
CONFIG_PM


7315 
	$›“80211_mgd_qu›sû
(
›“80211_sub_if_d©a
 *
sd©a
)

7317 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7318 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

7320 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

7322 ià(
ifmgd
->
auth_d©a
 || ifmgd->
assoc_d©a
) {

7323 cÚ¡ 
u8
 *
­_addr
 = 
ifmgd
->
auth_d©a
 ?

7324 
ifmgd
->
auth_d©a
->
­_addr
 :

7325 
ifmgd
->
assoc_d©a
->
­_addr
;

7332 
	`›“80211_£nd_d—uth_di§ssoc
(
sd©a
, 
­_addr
,‡p_addr,

7333 
IEEE80211_STYPE_DEAUTH
,

7334 
WLAN_REASON_DEAUTH_LEAVING
,

7335 
çl£
, 
äame_buf
);

7336 ià(
ifmgd
->
assoc_d©a
)

7337 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_ABANDON
);

7338 ià(
ifmgd
->
auth_d©a
)

7339 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

7340 
	`cfg80211_tx_mlme_mgmt
(
sd©a
->
dev
, 
äame_buf
,

7341 
IEEE80211_DEAUTH_FRAME_LEN
,

7342 
çl£
);

7362 ià(
ifmgd
->
assocŸ‹d
 && !
sd©a
->
loÿl
->
wowÏn
) {

7363 
u8
 
bssid
[
ETH_ALEN
];

7364 
cfg80211_d—uth_»que¡
 
»q
 = {

7365 .
»asÚ_code
 = 
WLAN_REASON_DEAUTH_LEAVING
,

7366 .
bssid
 = bssid,

7369 
	`memıy
(
bssid
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

7370 
	`›“80211_mgd_d—uth
(
sd©a
, &
»q
);

7372 
	}
}

7375 
	$›“80211_¡a_»¡¬t
(
›“80211_sub_if_d©a
 *
sd©a
)

7377 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7379 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

7381 ià(!
ifmgd
->
assocŸ‹d
)

7384 ià(
sd©a
->
æags
 & 
IEEE80211_SDATA_DISCONNECT_RESUME
) {

7385 
sd©a
->
æags
 &ğ~
IEEE80211_SDATA_DISCONNECT_RESUME
;

7386 
	`mlme_dbg
(
sd©a
, "driver„equested disconnect‡fter„esume\n");

7387 
	`›“80211_¡a_cÚÃùiÚ_lo¡
(
sd©a
,

7388 
WLAN_REASON_UNSPECIFIED
,

7389 
Œue
);

7393 ià(
sd©a
->
æags
 & 
IEEE80211_SDATA_DISCONNECT_HW_RESTART
) {

7394 
sd©a
->
æags
 &ğ~
IEEE80211_SDATA_DISCONNECT_HW_RESTART
;

7395 
	`mlme_dbg
(
sd©a
, "driver„equested disconnect‡fter hardware„estart\n");

7396 
	`›“80211_¡a_cÚÃùiÚ_lo¡
(
sd©a
,

7397 
WLAN_REASON_UNSPECIFIED
,

7398 
Œue
);

7401 
	}
}

7403 
	$›“80211_»que¡_smps_mgd_wÜk
(
why
 *wiphy,

7404 
why_wÜk
 *
wÜk
)

7406 
›“80211_lšk_d©a
 *
lšk
 =

7407 
	`cÚš”_of
(
wÜk
, 
›“80211_lšk_d©a
,

7408 
u
.
mgd
.
»que¡_smps_wÜk
);

7410 
	`__›“80211_»que¡_smps_mgd
(
lšk
->
sd©a
,†ink,

7411 
lšk
->
u
.
mgd
.
driv”_smps_mode
);

7412 
	}
}

7415 
	$›“80211_¡a_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

7417 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7419 
	`why_wÜk_š™
(&
ifmgd
->
mÚ™Ü_wÜk
, 
›“80211_¡a_mÚ™Ü_wÜk
);

7420 
	`why_wÜk_š™
(&
ifmgd
->
b—cÚ_cÚÃùiÚ_loss_wÜk
,

7421 
›“80211_b—cÚ_cÚÃùiÚ_loss_wÜk
);

7422 
	`why_wÜk_š™
(&
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
,

7423 
›“80211_c§_cÚÃùiÚ_drİ_wÜk
);

7424 
	`why_d–ayed_wÜk_š™
(&
ifmgd
->
tdls_³”_d–_wÜk
,

7425 
›“80211_tdls_³”_d–_wÜk
);

7426 
	`why_d–ayed_wÜk_š™
(&
ifmgd
->
ml_»cÚf_wÜk
,

7427 
›“80211_ml_»cÚf_wÜk
);

7428 
	`tim”_£tup
(&
ifmgd
->
tim”
, 
›“80211_¡a_tim”
, 0);

7429 
	`tim”_£tup
(&
ifmgd
->
bú_mÚ_tim”
, 
›“80211_¡a_bú_mÚ_tim”
, 0);

7430 
	`tim”_£tup
(&
ifmgd
->
cÚn_mÚ_tim”
, 
›“80211_¡a_cÚn_mÚ_tim”
, 0);

7431 
	`why_d–ayed_wÜk_š™
(&
ifmgd
->
tx_t¥ec_wk
,

7432 
›“80211_¡a_hªdË_t¥ec_ac_·¿ms_wk
);

7433 
	`why_d–ayed_wÜk_š™
(&
ifmgd
->
‰lm_wÜk
,

7434 
›“80211_tid_to_lšk_m­_wÜk
);

7435 
	`why_d–ayed_wÜk_š™
(&
ifmgd
->
Ãg_‰lm_timeout_wÜk
,

7436 
›“80211_Ãg_‰lm_timeout_wÜk
);

7438 
ifmgd
->
æags
 = 0;

7439 
ifmgd
->
pow”§ve
 = 
sd©a
->
wdev
.
ps
;

7440 
ifmgd
->
u­sd_queues
 = 
sd©a
->
loÿl
->
hw
.uapsd_queues;

7441 
ifmgd
->
u­sd_max_¥_Ën
 = 
sd©a
->
loÿl
->
hw
.uapsd_max_sp_len;

7443 
	`¥š_lock_š™
(&
ifmgd
->
‹¬down_lock
);

7444 
ifmgd
->
‹¬down_skb
 = 
NULL
;

7445 
ifmgd
->
Üig_‹¬down_skb
 = 
NULL
;

7446 
ifmgd
->
mÿ¡_£q_Ï¡
 = 
IEEE80211_SN_MODULO
;

7447 
	}
}

7449 
	$›“80211_»ÿlc_smps_wÜk
(
why
 *wiphy,

7450 
why_wÜk
 *
wÜk
)

7452 
›“80211_lšk_d©a
 *
lšk
 =

7453 
	`cÚš”_of
(
wÜk
, 
›“80211_lšk_d©a
,

7454 
u
.
mgd
.
»ÿlc_smps
);

7456 
	`›“80211_»ÿlc_smps
(
lšk
->
sd©a
,†ink);

7457 
	}
}

7459 
	$›“80211_mgd_£tup_lšk
(
›“80211_lšk_d©a
 *
lšk
)

7461 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

7462 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7463 
lšk_id
 = 
lšk
->link_id;

7465 
lšk
->
u
.
mgd
.
p2p_nß_šdex
 = -1;

7466 
lšk
->
cÚf
->
bssid
 =†šk->
u
.
mgd
.bssid;

7467 
lšk
->
smps_mode
 = 
IEEE80211_SMPS_OFF
;

7469 
	`why_wÜk_š™
(&
lšk
->
u
.
mgd
.
»que¡_smps_wÜk
,

7470 
›“80211_»que¡_smps_mgd_wÜk
);

7471 
	`why_wÜk_š™
(&
lšk
->
u
.
mgd
.
»ÿlc_smps
,

7472 
›“80211_»ÿlc_smps_wÜk
);

7473 ià(
loÿl
->
hw
.
why
->
ã©u»s
 & 
NL80211_FEATURE_DYNAMIC_SMPS
)

7474 
lšk
->
u
.
mgd
.
»q_smps
 = 
IEEE80211_SMPS_AUTOMATIC
;

7476 
lšk
->
u
.
mgd
.
»q_smps
 = 
IEEE80211_SMPS_OFF
;

7478 
	`why_d–ayed_wÜk_š™
(&
lšk
->
u
.
mgd
.
chsw™ch_wÜk
,

7479 
›“80211_chsw™ch_wÜk
);

7481 ià(
sd©a
->
u
.
mgd
.
assoc_d©a
)

7482 
	`‘h”_addr_cİy
(
lšk
->
cÚf
->
addr
,

7483 
sd©a
->
u
.
mgd
.
assoc_d©a
->
lšk
[
lšk_id
].
addr
);

7484 ià(!
	`is_v®id_‘h”_addr
(
lšk
->
cÚf
->
addr
))

7485 
	`‘h_¿ndom_addr
(
lšk
->
cÚf
->
addr
);

7486 
	}
}

7489 
	$›“80211_mlme_nÙify_sÿn_com¶‘ed
(
›“80211_loÿl
 *
loÿl
)

7491 
›“80211_sub_if_d©a
 *
sd©a
;

7494 
	`rcu_»ad_lock
();

7495 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

7496 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
))

7497 
	`›“80211_»¡¬t_¡a_tim”
(
sd©a
);

7499 
	`rcu_»ad_uÆock
();

7500 
	}
}

7502 
	$›“80211_´•_cÚÃùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

7503 
cfg80211_bss
 *
cbss
, 
s8
 
lšk_id
,

7504 cÚ¡ 
u8
 *
­_mld_addr
, 
boŞ
 
assoc
,

7505 
›“80211_cÚn_£‰šgs
 *
cÚn
,

7506 
boŞ
 
ov”ride
)

7508 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7509 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7510 
›“80211_bss
 *
bss
 = (*)
cbss
->
´iv
;

7511 
¡a_šfo
 *
Ãw_¡a
 = 
NULL
;

7512 
›“80211_lšk_d©a
 *
lšk
;

7513 
boŞ
 
have_¡a
 = 
çl£
;

7514 
boŞ
 
mlo
;

7515 
”r
;

7517 ià(
lšk_id
 >= 0) {

7518 
mlo
 = 
Œue
;

7519 ià(
	`WARN_ON
(!
­_mld_addr
))

7520  -
EINVAL
;

7521 
”r
 = 
	`›“80211_vif_£t_lšks
(
sd©a
, 
	`BIT
(
lšk_id
), 0);

7523 ià(
	`WARN_ON
(
­_mld_addr
))

7524  -
EINVAL
;

7525 
­_mld_addr
 = 
cbss
->
bssid
;

7526 
”r
 = 
	`›“80211_vif_£t_lšks
(
sd©a
, 0, 0);

7527 
lšk_id
 = 0;

7528 
mlo
 = 
çl£
;

7531 ià(
”r
)

7532  
”r
;

7534 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

7535 ià(
	`WARN_ON
(!
lšk
)) {

7536 
”r
 = -
ENOLINK
;

7537 
out_”r
;

7540 ià(
	`WARN_ON
(!
ifmgd
->
auth_d©a
 && !ifmgd->
assoc_d©a
)) {

7541 
”r
 = -
EINVAL
;

7542 
out_”r
;

7546 ià(
loÿl
->
š_»cÚfig
) {

7547 
”r
 = -
EBUSY
;

7548 
out_”r
;

7551 ià(
assoc
) {

7552 
	`rcu_»ad_lock
();

7553 
have_¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
­_mld_addr
);

7554 
	`rcu_»ad_uÆock
();

7557 ià(!
have_¡a
) {

7558 ià(
mlo
)

7559 
Ãw_¡a
 = 
	`¡a_šfo_®loc_w™h_lšk
(
sd©a
, 
­_mld_addr
,

7560 
lšk_id
, 
cbss
->
bssid
,

7561 
GFP_KERNEL
);

7563 
Ãw_¡a
 = 
	`¡a_šfo_®loc
(
sd©a
, 
­_mld_addr
, 
GFP_KERNEL
);

7565 ià(!
Ãw_¡a
) {

7566 
”r
 = -
ENOMEM
;

7567 
out_”r
;

7570 
Ãw_¡a
->
¡a
.
mlo
 = mlo;

7586 ià(
Ãw_¡a
) {

7587 cÚ¡ 
cfg80211_bss_›s
 *
›s
;

7588 
lšk_¡a_šfo
 *
lšk_¡a
;

7590 
	`rcu_»ad_lock
();

7591 
lšk_¡a
 = 
	`rcu_d”eã»nû
(
Ãw_¡a
->
lšk
[
lšk_id
]);

7592 ià(
	`WARN_ON
(!
lšk_¡a
)) {

7593 
	`rcu_»ad_uÆock
();

7594 
	`¡a_šfo_ä“
(
loÿl
, 
Ãw_¡a
);

7595 
”r
 = -
EINVAL
;

7596 
out_”r
;

7599 
”r
 = 
	`›“80211_mgd_£tup_lšk_¡a
(
lšk
, 
Ãw_¡a
,

7600 
lšk_¡a
, 
cbss
);

7601 ià(
”r
) {

7602 
	`rcu_»ad_uÆock
();

7603 
	`¡a_šfo_ä“
(
loÿl
, 
Ãw_¡a
);

7604 
out_”r
;

7607 
	`memıy
(
lšk
->
u
.
mgd
.
bssid
, 
cbss
->bssid, 
ETH_ALEN
);

7610 
lšk
->
cÚf
->
b—cÚ_št
 = 
cbss
->
b—cÚ_š‹rv®
;

7611 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->
b—cÚ_›s
);

7612 ià(
›s
) {

7613 
lšk
->
cÚf
->
sync_tsf
 = 
›s
->
tsf
;

7614 
lšk
->
cÚf
->
sync_deviû_ts
 =

7615 
bss
->
deviû_ts_b—cÚ
;

7617 
	`›“80211_g‘_dtim
(
›s
,

7618 &
lšk
->
cÚf
->
sync_dtim_couÁ
,

7619 
NULL
);

7620 } ià(!
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
,

7621 
TIMING_BEACON_ONLY
)) {

7622 
›s
 = 
	`rcu_d”eã»nû
(
cbss
->
´ob”e¥_›s
);

7624 
lšk
->
cÚf
->
sync_tsf
 = 
›s
->
tsf
;

7625 
lšk
->
cÚf
->
sync_deviû_ts
 =

7626 
bss
->
deviû_ts_´e¥
;

7627 
lšk
->
cÚf
->
sync_dtim_couÁ
 = 0;

7629 
lšk
->
cÚf
->
sync_tsf
 = 0;

7630 
lšk
->
cÚf
->
sync_deviû_ts
 = 0;

7631 
lšk
->
cÚf
->
sync_dtim_couÁ
 = 0;

7633 
	`rcu_»ad_uÆock
();

7636 ià(
Ãw_¡a
 || 
ov”ride
) {

7643 
lšk
->
u
.
mgd
.
cÚn
 = *conn;

7644 
”r
 = 
	`›“80211_´•_chªÃl
(
sd©a
, 
lšk
,†šk->
lšk_id
, 
cbss
,

7645 
mlo
, &
lšk
->
u
.
mgd
.
cÚn
);

7646 ià(
”r
) {

7647 ià(
Ãw_¡a
)

7648 
	`¡a_šfo_ä“
(
loÿl
, 
Ãw_¡a
);

7649 
out_”r
;

7652 *
cÚn
 = 
lšk
->
u
.
mgd
.conn;

7655 ià(
Ãw_¡a
) {

7660 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

7661 
BSS_CHANGED_BSSID
 |

7662 
BSS_CHANGED_BASIC_RATES
 |

7663 
BSS_CHANGED_BEACON_INT
);

7665 ià(
assoc
)

7666 
	`¡a_šfo_´e_move_¡©e
(
Ãw_¡a
, 
IEEE80211_STA_AUTH
);

7668 
”r
 = 
	`¡a_šfo_š£¹
(
Ãw_¡a
);

7669 
Ãw_¡a
 = 
NULL
;

7670 ià(
”r
) {

7671 
	`sd©a_šfo
(
sd©a
,

7673 
”r
);

7674 
out_»Ëa£_chª
;

7677 
	`WARN_ON_ONCE
(!
	`‘h”_addr_equ®
(
lšk
->
u
.
mgd
.
bssid
, 
cbss
->bssid));

7680 ià(
loÿl
->
sÿÂšg
)

7681 
	`›“80211_sÿn_ÿnûl
(
loÿl
);

7685 
out_»Ëa£_chª
:

7686 
	`›“80211_lšk_»Ëa£_chªÃl
(
lšk
);

7687 
out_”r
:

7688 
	`›“80211_vif_£t_lšks
(
sd©a
, 0, 0);

7689  
”r
;

7690 
	}
}

7692 
boŞ
 
	$›“80211_mgd_c§_´e£Á
(
›“80211_sub_if_d©a
 *
sd©a
,

7693 cÚ¡ 
cfg80211_bss_›s
 *
›s
,

7694 
u8
 
cur_chªÃl
, 
boŞ
 
ignÜe_ec§
)

7696 cÚ¡ 
–em’t
 *
c§_–em
, *
ec§_–em
;

7697 
›“80211_chªÃl_sw_›
 *
c§
 = 
NULL
;

7698 
›“80211_ext_chªsw_›
 *
ec§
 = 
NULL
;

7700 ià(!
›s
)

7701  
çl£
;

7703 
c§_–em
 = 
	`cfg80211_fšd_–em
(
WLAN_EID_CHANNEL_SWITCH
,

7704 
›s
->
d©a
, ies->
Ën
);

7705 ià(
c§_–em
 && c§_–em->
d©®’
 =ğ(*
c§
))

7706 
c§
 = (*)
c§_–em
->
d©a
;

7708 
ec§_–em
 = 
	`cfg80211_fšd_–em
(
WLAN_EID_EXT_CHANSWITCH_ANN
,

7709 
›s
->
d©a
, ies->
Ën
);

7710 ià(
ec§_–em
 &&ƒc§_–em->
d©®’
 =ğ(*
ec§
))

7711 
ec§
 = (*)
ec§_–em
->
d©a
;

7713 ià(
c§
 && c§->
couÁ
 == 0)

7714 
c§
 = 
NULL
;

7715 ià(
c§
 && !c§->
mode
 && c§->
Ãw_ch_num
 =ğ
cur_chªÃl
)

7716 
c§
 = 
NULL
;

7718 ià(
ec§
 &&ƒc§->
couÁ
 == 0)

7719 
ec§
 = 
NULL
;

7720 ià(
ec§
 && !ec§->
mode
 &&ƒc§->
Ãw_ch_num
 =ğ
cur_chªÃl
)

7721 
ec§
 = 
NULL
;

7723 ià(
ignÜe_ec§
 && 
ec§
) {

7724 
	`sd©a_šfo
(
sd©a
,

7726  
c§
;

7729  
c§
 || 
ec§
;

7730 
	}
}

7732 
boŞ
 
	$›“80211_mgd_c§_š_´oûss
(
›“80211_sub_if_d©a
 *
sd©a
,

7733 
cfg80211_bss
 *
bss
)

7735 
u8
 
cur_chªÃl
;

7736 
boŞ
 
»t
;

7738 
cur_chªÃl
 = 
	`›“80211_äequ’cy_to_chªÃl
(
bss
->
chªÃl
->
ûÁ”_äeq
);

7740 
	`rcu_»ad_lock
();

7741 ià(
	`›“80211_mgd_c§_´e£Á
(
sd©a
,

7742 
	`rcu_d”eã»nû
(
bss
->
b—cÚ_›s
),

7743 
cur_chªÃl
, 
çl£
)) {

7744 
»t
 = 
Œue
;

7745 
out
;

7748 ià(
	`›“80211_mgd_c§_´e£Á
(
sd©a
,

7749 
	`rcu_d”eã»nû
(
bss
->
´ob”e¥_›s
),

7750 
cur_chªÃl
, 
bss
->
´ob”e¥_ec§_¡uck
)) {

7751 
»t
 = 
Œue
;

7752 
out
;

7755 
»t
 = 
çl£
;

7756 
out
:

7757 
	`rcu_»ad_uÆock
();

7758  
»t
;

7759 
	}
}

7762 
	$›“80211_mgd_auth
(
›“80211_sub_if_d©a
 *
sd©a
,

7763 
cfg80211_auth_»que¡
 *
»q
)

7765 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7766 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

7767 
›“80211_mgd_auth_d©a
 *
auth_d©a
;

7768 
›“80211_cÚn_£‰šgs
 
cÚn
;

7769 
›“80211_lšk_d©a
 *
lšk
;

7770 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

7771 
›“80211_bss
 *
bss
;

7772 
u16
 
auth_®g
;

7773 
”r
;

7774 
boŞ
 
cÚt_auth
, 
wmm_u£d
;

7776 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

7780 
»q
->
auth_ty³
) {

7781 
NL80211_AUTHTYPE_OPEN_SYSTEM
:

7782 
auth_®g
 = 
WLAN_AUTH_OPEN
;

7784 
NL80211_AUTHTYPE_SHARED_KEY
:

7785 ià(
fs_’abËd
)

7786  -
EOPNOTSUPP
;

7787 
auth_®g
 = 
WLAN_AUTH_SHARED_KEY
;

7789 
NL80211_AUTHTYPE_FT
:

7790 
auth_®g
 = 
WLAN_AUTH_FT
;

7792 
NL80211_AUTHTYPE_NETWORK_EAP
:

7793 
auth_®g
 = 
WLAN_AUTH_LEAP
;

7795 
NL80211_AUTHTYPE_SAE
:

7796 
auth_®g
 = 
WLAN_AUTH_SAE
;

7798 
NL80211_AUTHTYPE_FILS_SK
:

7799 
auth_®g
 = 
WLAN_AUTH_FILS_SK
;

7801 
NL80211_AUTHTYPE_FILS_SK_PFS
:

7802 
auth_®g
 = 
WLAN_AUTH_FILS_SK_PFS
;

7804 
NL80211_AUTHTYPE_FILS_PK
:

7805 
auth_®g
 = 
WLAN_AUTH_FILS_PK
;

7808  -
EOPNOTSUPP
;

7811 ià(
ifmgd
->
assoc_d©a
)

7812  -
EBUSY
;

7814 ià(
	`›“80211_mgd_c§_š_´oûss
(
sd©a
, 
»q
->
bss
)) {

7815 
	`sd©a_šfo
(
sd©a
, "AP is in CSA…rocess,„eject‡uth\n");

7816  -
EINVAL
;

7819 
auth_d©a
 = 
	`kz®loc
((*auth_d©aè+ 
»q
->
auth_d©a_Ën
 +

7820 
»q
->
›_Ën
, 
GFP_KERNEL
);

7821 ià(!
auth_d©a
)

7822  -
ENOMEM
;

7824 
	`memıy
(
auth_d©a
->
­_addr
,

7825 
»q
->
­_mld_addr
 ?:„eq->
bss
->
bssid
,

7826 
ETH_ALEN
);

7827 
auth_d©a
->
bss
 = 
»q
->bss;

7828 
auth_d©a
->
lšk_id
 = 
»q
->link_id;

7830 ià(
»q
->
auth_d©a_Ën
 >= 4) {

7831 ià(
»q
->
auth_ty³
 =ğ
NL80211_AUTHTYPE_SAE
) {

7832 
__Ë16
 *
pos
 = (__Ë16 *è
»q
->
auth_d©a
;

7834 
auth_d©a
->
§e_Œªs
 = 
	`Ë16_to_ıu
(
pos
[0]);

7835 
auth_d©a
->
§e_¡©us
 = 
	`Ë16_to_ıu
(
pos
[1]);

7837 
	`memıy
(
auth_d©a
->
d©a
, 
»q
->auth_data + 4,

7838 
»q
->
auth_d©a_Ën
 - 4);

7839 
auth_d©a
->
d©a_Ën
 +ğ
»q
->
auth_d©a_Ën
 - 4;

7847 
cÚt_auth
 = 
ifmgd
->
auth_d©a
 && 
»q
->
bss
 == ifmgd->auth_data->bss &&

7848 
ifmgd
->
auth_d©a
->
lšk_id
 =ğ
»q
->link_id;

7850 ià(
»q
->
›
 &&„eq->
›_Ën
) {

7851 
	`memıy
(&
auth_d©a
->
d©a
[auth_d©a->
d©a_Ën
],

7852 
»q
->
›
,„eq->
›_Ën
);

7853 
auth_d©a
->
d©a_Ën
 +ğ
»q
->
›_Ën
;

7856 ià(
»q
->
key
 &&„eq->
key_Ën
) {

7857 
auth_d©a
->
key_Ën
 = 
»q
->key_len;

7858 
auth_d©a
->
key_idx
 = 
»q
->key_idx;

7859 
	`memıy
(
auth_d©a
->
key
, 
»q
->key,„eq->
key_Ën
);

7862 
auth_d©a
->
®gÜ™hm
 = 
auth_®g
;

7866 ià(
ifmgd
->
auth_d©a
) {

7867 ià(
cÚt_auth
 && 
»q
->
auth_ty³
 =ğ
NL80211_AUTHTYPE_SAE
) {

7868 
auth_d©a
->
³”_cÚfœmed
 =

7869 
ifmgd
->
auth_d©a
->
³”_cÚfœmed
;

7871 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
cÚt_auth
);

7875 
ifmgd
->
auth_d©a
 =‡uth_data;

7882 ià(
cÚt_auth
 && 
»q
->
auth_ty³
 =ğ
NL80211_AUTHTYPE_SAE
 &&

7883 
auth_d©a
->
³”_cÚfœmed
 &&‡uth_d©a->
§e_Œªs
 == 2)

7884 
	`›“80211_m¬k_¡a_auth
(
sd©a
);

7886 ià(
ifmgd
->
assocŸ‹d
) {

7887 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

7889 
	`sd©a_šfo
(
sd©a
,

7891 
sd©a
->
vif
.
cfg
.
­_addr
, 
auth_d©a
->ap_addr);

7892 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DEAUTH
,

7893 
WLAN_REASON_UNSPECIFIED
,

7894 
çl£
, 
äame_buf
);

7896 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
,

7897 (
äame_buf
), 
Œue
,

7898 
WLAN_REASON_UNSPECIFIED
,

7899 
çl£
);

7903 
	`memıy
(
sd©a
->
vif
.
cfg
.
­_addr
, 
auth_d©a
->­_addr, 
ETH_ALEN
);

7905 
bss
 = (*)
»q
->bss->
´iv
;

7906 
wmm_u£d
 = 
bss
->wmm_u£d && (
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
);

7908 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
»q
->
bss
->
chªÃl
->
bªd
];

7910 
	`›“80211_d‘”mše_our_¡a_mode_auth
(
sd©a
, 
sbªd
, 
»q
, 
wmm_u£d
,

7911 &
cÚn
);

7913 
”r
 = 
	`›“80211_´•_cÚÃùiÚ
(
sd©a
, 
»q
->
bss
,„eq->
lšk_id
,

7914 
»q
->
­_mld_addr
, 
cÚt_auth
,

7915 &
cÚn
, 
çl£
);

7916 ià(
”r
)

7917 
”r_ş—r
;

7919 ià(
»q
->
lšk_id
 >= 0)

7920 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
»q
->
lšk_id
], sdata);

7922 
lšk
 = &
sd©a
->
deæšk
;

7924 ià(
	`WARN_ON
(!
lšk
)) {

7925 
”r
 = -
ENOLINK
;

7926 
”r_ş—r
;

7929 
	`sd©a_šfo
(
sd©a
, "authenticate with %pM (local‡ddress=%pM)\n",

7930 
auth_d©a
->
­_addr
, 
lšk
->
cÚf
->
addr
);

7932 
”r
 = 
	`›“80211_auth
(
sd©a
);

7933 ià(
”r
) {

7934 
	`¡a_šfo_de¡roy_addr
(
sd©a
, 
auth_d©a
->
­_addr
);

7935 
”r_ş—r
;

7939 
	`cfg80211_»f_bss
(
loÿl
->
hw
.
why
, 
auth_d©a
->
bss
);

7942 
”r_ş—r
:

7943 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

7944 
	`‘h_z”o_addr
(
sd©a
->
deæšk
.
u
.
mgd
.
bssid
);

7945 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

7946 
BSS_CHANGED_BSSID
);

7947 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

7949 
ifmgd
->
auth_d©a
 = 
NULL
;

7950 
	`kä“
(
auth_d©a
);

7951  
”r
;

7952 
	}
}

7955 
	$›“80211_£tup_assoc_lšk
(
›“80211_sub_if_d©a
 *
sd©a
,

7956 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
,

7957 
cfg80211_assoc_»que¡
 *
»q
,

7958 
›“80211_cÚn_£‰šgs
 *
cÚn
,

7959 
lšk_id
)

7961 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

7962 cÚ¡ 
cfg80211_bss_›s
 *
bss_›s
;

7963 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

7964 
›“80211_lšk_d©a
 *
lšk
;

7965 
cfg80211_bss
 *
cbss
;

7966 
›“80211_bss
 *
bss
;

7968 
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

7969 ià(
	`WARN_ON
(!
cbss
))

7972 
bss
 = (*)
cbss
->
´iv
;

7974 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
cbss
->
chªÃl
->
bªd
];

7975 ià(
	`WARN_ON
(!
sbªd
))

7978 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

7979 ià(
	`WARN_ON
(!
lšk
))

7983 ià(!
»q
->
­_mld_addr
) {

7984 
assoc_d©a
->
suµ_¿‹s
 = 
bss
->supp_rates;

7985 
assoc_d©a
->
suµ_¿‹s_Ën
 = 
bss
->supp_rates_len;

7989 ià(
»q
->
lšks
[
lšk_id
].
–ems_Ën
) {

7990 
	`memıy
(
assoc_d©a
->
›_pos
, 
»q
->
lšks
[
lšk_id
].
–ems
,

7991 
»q
->
lšks
[
lšk_id
].
–ems_Ën
);

7992 
assoc_d©a
->
lšk
[
lšk_id
].
–ems
 =‡ssoc_d©a->
›_pos
;

7993 
assoc_d©a
->
lšk
[
lšk_id
].
–ems_Ën
 = 
»q
->
lšks
[link_id].elems_len;

7994 
assoc_d©a
->
›_pos
 +ğ
»q
->
lšks
[
lšk_id
].
–ems_Ën
;

7997 
lšk
->
u
.
mgd
.
b—cÚ_üc_v®id
 = 
çl£
;

7998 
lšk
->
u
.
mgd
.
dtim_³riod
 = 0;

7999 
lšk
->
u
.
mgd
.
have_b—cÚ
 = 
çl£
;

8002 ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_HT
) {

8003 
›“80211_¡a_ht_ÿp
 
¡a_ht_ÿp
;

8005 
	`memıy
(&
¡a_ht_ÿp
, &
sbªd
->
ht_ÿp
, (sta_ht_cap));

8006 
	`›“80211_­¶y_htÿp_ov”rides
(
sd©a
, &
¡a_ht_ÿp
);

8009 
	`rcu_»ad_lock
();

8010 
bss_›s
 = 
	`rcu_d”eã»nû
(
cbss
->
b—cÚ_›s
);

8011 ià(
bss_›s
) {

8012 
u8
 
dtim_couÁ
 = 0;

8014 
	`›“80211_g‘_dtim
(
bss_›s
, &
dtim_couÁ
,

8015 &
lšk
->
u
.
mgd
.
dtim_³riod
);

8017 
sd©a
->
deæšk
.
u
.
mgd
.
have_b—cÚ
 = 
Œue
;

8019 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TIMING_BEACON_ONLY
)) {

8020 
lšk
->
cÚf
->
sync_tsf
 = 
bss_›s
->
tsf
;

8021 
lšk
->
cÚf
->
sync_deviû_ts
 = 
bss
->
deviû_ts_b—cÚ
;

8022 
lšk
->
cÚf
->
sync_dtim_couÁ
 = 
dtim_couÁ
;

8025 
bss_›s
 = 
	`rcu_d”eã»nû
(
cbss
->
›s
);

8028 ià(
bss_›s
) {

8029 cÚ¡ 
–em’t
 *
–em
;

8031 
–em
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_MULTIPLE_BSSID_CONFIGURATION
,

8032 
bss_›s
->
d©a
, bss_›s->
Ën
);

8033 ià(
–em
 &&ƒËm->
d©®’
 >= 3)

8034 
lšk
->
cÚf
->
´ofe_³riodic™y
 = 
–em
->
d©a
[2];

8036 
lšk
->
cÚf
->
´ofe_³riodic™y
 = 0;

8038 
–em
 = 
	`cfg80211_fšd_–em
(
WLAN_EID_EXT_CAPABILITY
,

8039 
bss_›s
->
d©a
, bss_›s->
Ën
);

8040 ià(
–em
 &&ƒËm->
d©®’
 >= 11 &&

8041 (
–em
->
d©a
[10] & 
WLAN_EXT_CAPA11_EMA_SUPPORT
))

8042 
lšk
->
cÚf
->
ema_­
 = 
Œue
;

8044 
lšk
->
cÚf
->
ema_­
 = 
çl£
;

8046 
	`rcu_»ad_uÆock
();

8048 ià(
bss
->
cÜru±_d©a
) {

8049 *
cÜru±_ty³
 = "data";

8051 ià(
bss
->
cÜru±_d©a
 & 
IEEE80211_BSS_CORRUPT_BEACON
) {

8052 ià(
bss
->
cÜru±_d©a
 & 
IEEE80211_BSS_CORRUPT_PROBE_RESP
)

8053 
cÜru±_ty³
 = "beacon‡nd…robe„esponse";

8055 
cÜru±_ty³
 = "beacon";

8056 } ià(
bss
->
cÜru±_d©a
 & 
IEEE80211_BSS_CORRUPT_PROBE_RESP
) {

8057 
cÜru±_ty³
 = "probe„esponse";

8059 
	`sd©a_šfo
(
sd©a
, "associatingo AP %pM with corrupt %s\n",

8060 
cbss
->
bssid
, 
cÜru±_ty³
);

8063 ià(
lšk
->
u
.
mgd
.
»q_smps
 =ğ
IEEE80211_SMPS_AUTOMATIC
) {

8064 ià(
sd©a
->
u
.
mgd
.
pow”§ve
)

8065 
lšk
->
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

8067 
lšk
->
smps_mode
 = 
IEEE80211_SMPS_OFF
;

8069 
lšk
->
smps_mode
 =†šk->
u
.
mgd
.
»q_smps
;

8071 
	}
}

8074 
	$›“80211_mgd_g‘_­_ht_vht_ÿ·
(
›“80211_sub_if_d©a
 *
sd©a
,

8075 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
,

8076 
lšk_id
)

8078 
cfg80211_bss
 *
cbss
 = 
assoc_d©a
->
lšk
[
lšk_id
].
bss
;

8079 
Æ80211_bªd
 
bªd
 = 
cbss
->
chªÃl
->band;

8080 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

8081 cÚ¡ 
–em’t
 *
–em
;

8082 
”r
;

8085 ià(
bªd
 =ğ
NL80211_BAND_6GHZ
)

8088 ià(
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_HT
)

8091 
	`rcu_»ad_lock
();

8092 
–em
 = 
	`›“80211_bss_g‘_–em
(
cbss
, 
WLAN_EID_HT_OPERATION
);

8093 ià(!
–em
 ||ƒËm->
d©®’
 < (
›“80211_ht_İ”©iÚ
)) {

8094 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
, "no HT operation on BSS %pM\n",

8095 
cbss
->
bssid
);

8096 
”r
 = -
EINVAL
;

8097 
out_rcu
;

8099 
assoc_d©a
->
lšk
[
lšk_id
].
­_ht_·¿m
 =

8100 ((
›“80211_ht_İ”©iÚ
 *)(
–em
->
d©a
))->
ht_·¿m
;

8101 
	`rcu_»ad_uÆock
();

8103 ià(
assoc_d©a
->
lšk
[
lšk_id
].
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_VHT
)

8107 
sbªd
 = 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
bªd
];

8108 ià(!
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
)

8111 
	`rcu_»ad_lock
();

8112 
–em
 = 
	`›“80211_bss_g‘_–em
(
cbss
, 
WLAN_EID_VHT_CAPABILITY
);

8114 ià(!
–em
 && 
bªd
 =ğ
NL80211_BAND_2GHZ
) {

8115 
”r
 = 0;

8116 
out_rcu
;

8118 ià(!
–em
 ||ƒËm->
d©®’
 < (
›“80211_vht_ÿp
)) {

8119 
	`mlme_lšk_id_dbg
(
sd©a
, 
lšk_id
, "no VHT capa on BSS %pM\n",

8120 
cbss
->
bssid
);

8121 
”r
 = -
EINVAL
;

8122 
out_rcu
;

8124 
	`memıy
(&
assoc_d©a
->
lšk
[
lšk_id
].
­_vht_ÿp
, 
–em
->
d©a
,

8125 (
›“80211_vht_ÿp
));

8126 
	`rcu_»ad_uÆock
();

8129 
out_rcu
:

8130 
	`rcu_»ad_uÆock
();

8131  
”r
;

8132 
	}
}

8134 
	$›“80211_mgd_assoc
(
›“80211_sub_if_d©a
 *
sd©a
,

8135 
cfg80211_assoc_»que¡
 *
»q
)

8137 
assoc_lšk_id
 = 
»q
->
lšk_id
 < 0 ? 0 :„eq->link_id;

8138 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

8139 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

8140 
›“80211_mgd_assoc_d©a
 *
assoc_d©a
;

8141 cÚ¡ 
–em’t
 *
ssid_–em
;

8142 
›“80211_vif_cfg
 *
vif_cfg
 = &
sd©a
->
vif
.
cfg
;

8143 
›“80211_lšk_d©a
 *
lšk
;

8144 
cfg80211_bss
 *
cbss
;

8145 
boŞ
 
ov”ride
, 
u­sd_suµÜ‹d
;

8146 
boŞ
 
m©ch_auth
;

8147 
i
, 
”r
;

8148 
size_t
 
size
 = (*
assoc_d©a
è+ 
»q
->
›_Ën
;

8150 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++)

8151 
size
 +ğ
»q
->
lšks
[
i
].
–ems_Ën
;

8154 ià(
sd©a
->
u
.
mgd
.
u£_4addr
 && 
»q
->
lšk_id
 >= 0)

8155  -
EOPNOTSUPP
;

8157 
assoc_d©a
 = 
	`kz®loc
(
size
, 
GFP_KERNEL
);

8158 ià(!
assoc_d©a
)

8159  -
ENOMEM
;

8161 
cbss
 = 
»q
->
lšk_id
 < 0 ?„eq->
bss
 :„eq->
lšks
[req->link_id].bss;

8163 ià(
	`›“80211_mgd_c§_š_´oûss
(
sd©a
, 
cbss
)) {

8164 
	`sd©a_šfo
(
sd©a
, "AP is in CSA…rocess,„eject‡ssoc\n");

8165 
”r
 = -
EINVAL
;

8166 
”r_ä“
;

8169 
	`rcu_»ad_lock
();

8170 
ssid_–em
 = 
	`›“80211_bss_g‘_–em
(
cbss
, 
WLAN_EID_SSID
);

8171 ià(!
ssid_–em
 || ssid_–em->
d©®’
 > (
assoc_d©a
->
ssid
)) {

8172 
	`rcu_»ad_uÆock
();

8173 
”r
 = -
EINVAL
;

8174 
”r_ä“
;

8177 
	`memıy
(
assoc_d©a
->
ssid
, 
ssid_–em
->
d©a
, ssid_–em->
d©®’
);

8178 
assoc_d©a
->
ssid_Ën
 = 
ssid_–em
->
d©®’
;

8179 
	`rcu_»ad_uÆock
();

8181 ià(
»q
->
­_mld_addr
)

8182 
	`memıy
(
assoc_d©a
->
­_addr
, 
»q
->
­_mld_addr
, 
ETH_ALEN
);

8184 
	`memıy
(
assoc_d©a
->
­_addr
, 
cbss
->
bssid
, 
ETH_ALEN
);

8186 ià(
ifmgd
->
assocŸ‹d
) {

8187 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

8189 
	`sd©a_šfo
(
sd©a
,

8191 
sd©a
->
vif
.
cfg
.
­_addr
, 
assoc_d©a
->ap_addr);

8192 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DEAUTH
,

8193 
WLAN_REASON_UNSPECIFIED
,

8194 
çl£
, 
äame_buf
);

8196 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
,

8197 (
äame_buf
), 
Œue
,

8198 
WLAN_REASON_UNSPECIFIED
,

8199 
çl£
);

8202 
	`memıy
(&
ifmgd
->
ht_ÿ·
, &
»q
->ht_capa, (ifmgd->ht_capa));

8203 
	`memıy
(&
ifmgd
->
ht_ÿ·_mask
, &
»q
->ht_capa_mask,

8204 (
ifmgd
->
ht_ÿ·_mask
));

8206 
	`memıy
(&
ifmgd
->
vht_ÿ·
, &
»q
->vht_capa, (ifmgd->vht_capa));

8207 
	`memıy
(&
ifmgd
->
vht_ÿ·_mask
, &
»q
->vht_capa_mask,

8208 (
ifmgd
->
vht_ÿ·_mask
));

8210 
	`memıy
(&
ifmgd
->
s1g_ÿ·
, &
»q
->s1g_capa, (ifmgd->s1g_capa));

8211 
	`memıy
(&
ifmgd
->
s1g_ÿ·_mask
, &
»q
->s1g_capa_mask,

8212 (
ifmgd
->
s1g_ÿ·_mask
));

8215 
m©ch_auth
 = 
ifmgd
->
auth_d©a
 &&

8216 
	`‘h”_addr_equ®
(
ifmgd
->
auth_d©a
->
­_addr
,

8217 
assoc_d©a
->
­_addr
) &&

8218 
ifmgd
->
auth_d©a
->
lšk_id
 =ğ
»q
->link_id;

8220 ià(
»q
->
­_mld_addr
) {

8221 
u­sd_suµÜ‹d
 = 
Œue
;

8223 
i
 = 0; i < 
IEEE80211_MLD_MAX_NUM_LINKS
; i++) {

8224 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

8225 
cfg80211_bss
 *
lšk_cbss
 = 
»q
->
lšks
[
i
].
bss
;

8226 
›“80211_bss
 *
bss
;

8228 ià(!
lšk_cbss
)

8231 
bss
 = (*)
lšk_cbss
->
´iv
;

8233 ià(!
bss
->
wmm_u£d
) {

8234 
”r
 = -
EINVAL
;

8235 
”r_ä“
;

8238 ià(
»q
->
æags
 & (
ASSOC_REQ_DISABLE_HT
 |

8239 
ASSOC_REQ_DISABLE_VHT
 |

8240 
ASSOC_REQ_DISABLE_HE
 |

8241 
ASSOC_REQ_DISABLE_EHT
)) {

8242 
”r
 = -
EINVAL
;

8243 
”r_ä“
;

8246 ià(
lšk_cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

8247 
”r
 = -
EINVAL
;

8248 
”r_ä“
;

8251 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
i
], sdata);

8252 ià(
lšk
)

8253 
	`‘h”_addr_cİy
(
assoc_d©a
->
lšk
[
i
].
addr
,

8254 
lšk
->
cÚf
->
addr
);

8256 
	`‘h_¿ndom_addr
(
assoc_d©a
->
lšk
[
i
].
addr
);

8257 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
lšk_cbss
->
chªÃl
->
bªd
];

8259 ià(
m©ch_auth
 && 
i
 =ğ
assoc_lšk_id
 && 
lšk
)

8260 
assoc_d©a
->
lšk
[
i
].
cÚn
 =†šk->
u
.
mgd
.conn;

8262 
assoc_d©a
->
lšk
[
i
].
cÚn
 =

8263 
›“80211_cÚn_£‰šgs_uÆim™ed
;

8264 
	`›“80211_d‘”mše_our_¡a_mode_assoc
(
sd©a
, 
sbªd
,

8265 
»q
, 
Œue
, 
i
,

8266 &
assoc_d©a
->
lšk
[
i
].
cÚn
);

8267 
assoc_d©a
->
lšk
[
i
].
bss
 = 
lšk_cbss
;

8268 
assoc_d©a
->
lšk
[
i
].
di§bËd
 = 
»q
->
lšks
[i].disabled;

8270 ià(!
bss
->
u­sd_suµÜ‹d
)

8271 
u­sd_suµÜ‹d
 = 
çl£
;

8273 ià(
assoc_d©a
->
lšk
[
i
].
cÚn
.
mode
 < 
IEEE80211_CONN_MODE_EHT
) {

8274 
”r
 = -
EINVAL
;

8275 
»q
->
lšks
[
i
].
”rÜ
 = 
”r
;

8276 
”r_ä“
;

8279 
”r
 = 
	`›“80211_mgd_g‘_­_ht_vht_ÿ·
(
sd©a
,

8280 
assoc_d©a
, 
i
);

8281 ià(
”r
) {

8282 
”r
 = -
EINVAL
;

8283 
»q
->
lšks
[
i
].
”rÜ
 = 
”r
;

8284 
”r_ä“
;

8288 
assoc_d©a
->
wmm
 = 
Œue
;

8290 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

8291 
›“80211_bss
 *
bss
 = (*)
cbss
->
´iv
;

8293 
	`memıy
(
assoc_d©a
->
lšk
[0].
addr
, 
sd©a
->
vif
.addr, 
ETH_ALEN
);

8294 
assoc_d©a
->
s1g
 = 
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_S1GHZ
;

8296 
assoc_d©a
->
wmm
 = 
bss
->
wmm_u£d
 &&

8297 (
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
);

8299 ià(
cbss
->
chªÃl
->
bªd
 =ğ
NL80211_BAND_6GHZ
 &&

8300 
»q
->
æags
 & (
ASSOC_REQ_DISABLE_HT
 |

8301 
ASSOC_REQ_DISABLE_VHT
 |

8302 
ASSOC_REQ_DISABLE_HE
)) {

8303 
”r
 = -
EINVAL
;

8304 
”r_ä“
;

8307 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
cbss
->
chªÃl
->
bªd
];

8309 
assoc_d©a
->
lšk
[0].
bss
 = 
cbss
;

8311 ià(
m©ch_auth
)

8312 
assoc_d©a
->
lšk
[0].
cÚn
 = 
sd©a
->
deæšk
.
u
.
mgd
.conn;

8314 
assoc_d©a
->
lšk
[0].
cÚn
 =

8315 
›“80211_cÚn_£‰šgs_uÆim™ed
;

8316 
	`›“80211_d‘”mše_our_¡a_mode_assoc
(
sd©a
, 
sbªd
, 
»q
,

8317 
assoc_d©a
->
wmm
, 0,

8318 &
assoc_d©a
->
lšk
[0].
cÚn
);

8320 
u­sd_suµÜ‹d
 = 
bss
->uapsd_supported;

8322 
”r
 = 
	`›“80211_mgd_g‘_­_ht_vht_ÿ·
(
sd©a
, 
assoc_d©a
, 0);

8323 ià(
”r
)

8324 
”r_ä“
;

8327 
assoc_d©a
->
¥p_amsdu
 = 
»q
->
æags
 & 
ASSOC_REQ_SPP_AMSDU
;

8329 ià(
ifmgd
->
auth_d©a
 && !ifmgd->auth_d©a->
dÚe
) {

8330 
”r
 = -
EBUSY
;

8331 
”r_ä“
;

8334 ià(
ifmgd
->
assoc_d©a
) {

8335 
”r
 = -
EBUSY
;

8336 
”r_ä“
;

8340 ià(
ifmgd
->
auth_d©a
 && !
m©ch_auth
)

8341 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

8343 ià(
»q
->
›
 &&„eq->
›_Ën
) {

8344 
	`memıy
(
assoc_d©a
->
›
, 
»q
->›,„eq->
›_Ën
);

8345 
assoc_d©a
->
›_Ën
 = 
»q
->ie_len;

8346 
assoc_d©a
->
›_pos
 =‡ssoc_d©a->
›
 +‡ssoc_d©a->
›_Ën
;

8348 
assoc_d©a
->
›_pos
 =‡ssoc_d©a->
›
;

8351 ià(
»q
->
fs_kek
) {

8353 ià(
	`WARN_ON
(
»q
->
fs_kek_Ën
 > 
FILS_MAX_KEK_LEN
)) {

8354 
”r
 = -
EINVAL
;

8355 
”r_ä“
;

8357 
	`memıy
(
assoc_d©a
->
fs_kek
, 
»q
->fils_kek,

8358 
»q
->
fs_kek_Ën
);

8359 
assoc_d©a
->
fs_kek_Ën
 = 
»q
->fils_kek_len;

8362 ià(
»q
->
fs_nÚûs
)

8363 
	`memıy
(
assoc_d©a
->
fs_nÚûs
, 
»q
->fils_nonces,

8364 2 * 
FILS_NONCE_LEN
);

8367 
assoc_d©a
->
timeout
 = 
jiff›s
;

8368 
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

8370 
assoc_d©a
->
assoc_lšk_id
 =‡ssoc_link_id;

8372 ià(
»q
->
­_mld_addr
) {

8374 
”r
 = 
	`›“80211_vif_£t_lšks
(
sd©a
, 
	`BIT
(
assoc_lšk_id
), 0);

8375 ià(
”r
)

8376 
”r_ş—r
;

8379 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
assoc_lšk_id
], sdata);

8380 ià(
	`WARN_ON
(!
lšk
)) {

8381 
”r
 = -
EINVAL
;

8382 
”r_ş—r
;

8385 
ov”ride
 = 
lšk
->
u
.
mgd
.
cÚn
.
mode
 !=

8386 
assoc_d©a
->
lšk
[
assoc_lšk_id
].
cÚn
.
mode
 ||

8387 
lšk
->
u
.
mgd
.
cÚn
.
bw_lim™
 !=

8388 
assoc_d©a
->
lšk
[
assoc_lšk_id
].
cÚn
.
bw_lim™
;

8389 
lšk
->
u
.
mgd
.
cÚn
 = 
assoc_d©a
->lšk[
assoc_lšk_id
].conn;

8391 
	`›“80211_£tup_assoc_lšk
(
sd©a
, 
assoc_d©a
, 
»q
, &
lšk
->
u
.
mgd
.
cÚn
,

8392 
assoc_lšk_id
);

8394 ià(
	`WARN
((
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_SUPPORTS_UAPSD
) &&

8395 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
),

8397 
sd©a
->
vif
.
driv”_æags
 &ğ~
IEEE80211_VIF_SUPPORTS_UAPSD
;

8399 ià(
assoc_d©a
->
wmm
 && 
u­sd_suµÜ‹d
 &&

8400 (
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_SUPPORTS_UAPSD
)) {

8401 
assoc_d©a
->
u­sd
 = 
Œue
;

8402 
ifmgd
->
æags
 |ğ
IEEE80211_STA_UAPSD_ENABLED
;

8404 
assoc_d©a
->
u­sd
 = 
çl£
;

8405 
ifmgd
->
æags
 &ğ~
IEEE80211_STA_UAPSD_ENABLED
;

8408 ià(
»q
->
´ev_bssid
)

8409 
	`memıy
(
assoc_d©a
->
´ev_­_addr
, 
»q
->
´ev_bssid
, 
ETH_ALEN
);

8411 ià(
»q
->
u£_må
) {

8412 
ifmgd
->
må
 = 
IEEE80211_MFP_REQUIRED
;

8413 
ifmgd
->
æags
 |ğ
IEEE80211_STA_MFP_ENABLED
;

8415 
ifmgd
->
må
 = 
IEEE80211_MFP_DISABLED
;

8416 
ifmgd
->
æags
 &ğ~
IEEE80211_STA_MFP_ENABLED
;

8419 ià(
»q
->
æags
 & 
ASSOC_REQ_USE_RRM
)

8420 
ifmgd
->
æags
 |ğ
IEEE80211_STA_ENABLE_RRM
;

8422 
ifmgd
->
æags
 &ğ~
IEEE80211_STA_ENABLE_RRM
;

8424 ià(
»q
->
üy±o
.
cÚŒŞ_pÜt
)

8425 
ifmgd
->
æags
 |ğ
IEEE80211_STA_CONTROL_PORT
;

8427 
ifmgd
->
æags
 &ğ~
IEEE80211_STA_CONTROL_PORT
;

8429 
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 = 
»q
->
üy±o
.
cÚŒŞ_pÜt_‘h”ty³
;

8430 
sd©a
->
cÚŒŞ_pÜt_no_’üy±
 = 
»q
->
üy±o
.control_port_no_encrypt;

8431 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
 =

8432 
»q
->
üy±o
.
cÚŒŞ_pÜt_ov”_Æ80211
;

8433 
sd©a
->
cÚŒŞ_pÜt_no_´—uth
 = 
»q
->
üy±o
.control_port_no_preauth;

8436 
ifmgd
->
assoc_d©a
 =‡ssoc_data;

8438 
i
 = 0; i < 
	`ARRAY_SIZE
(
assoc_d©a
->
lšk
); i++) {

8439 ià(!
assoc_d©a
->
lšk
[
i
].
bss
)

8441 ià(
i
 =ğ
assoc_d©a
->
assoc_lšk_id
)

8444 
”r
 = 
	`›“80211_´•_chªÃl
(
sd©a
, 
NULL
, 
i
,

8445 
assoc_d©a
->
lšk
[
i
].
bss
, 
Œue
,

8446 &
assoc_d©a
->
lšk
[
i
].
cÚn
);

8447 ià(
”r
) {

8448 
»q
->
lšks
[
i
].
”rÜ
 = 
”r
;

8449 
”r_ş—r
;

8453 
	`memıy
(
vif_cfg
->
ssid
, 
assoc_d©a
->ssid,‡ssoc_d©a->
ssid_Ën
);

8454 
vif_cfg
->
ssid_Ën
 = 
assoc_d©a
->ssid_len;

8457 
	`memıy
(
sd©a
->
vif
.
cfg
.
­_addr
, 
assoc_d©a
->­_addr, 
ETH_ALEN
);

8459 
”r
 = 
	`›“80211_´•_cÚÃùiÚ
(
sd©a
, 
cbss
, 
»q
->
lšk_id
,

8460 
»q
->
­_mld_addr
, 
Œue
,

8461 &
assoc_d©a
->
lšk
[
assoc_lšk_id
].
cÚn
,

8462 
ov”ride
);

8463 ià(
”r
)

8464 
”r_ş—r
;

8466 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
NEED_DTIM_BEFORE_ASSOC
)) {

8467 cÚ¡ 
cfg80211_bss_›s
 *
b—cÚ_›s
;

8469 
	`rcu_»ad_lock
();

8470 
b—cÚ_›s
 = 
	`rcu_d”eã»nû
(
»q
->
bss
->beacon_ies);

8471 ià(!
b—cÚ_›s
) {

8476 
	`sd©a_šfo
(
sd©a
, "waiting for beacon from %pM\n",

8477 
lšk
->
u
.
mgd
.
bssid
);

8478 
assoc_d©a
->
timeout
 = 
	`TU_TO_EXP_TIME
(
»q
->
bss
->
b—cÚ_š‹rv®
);

8479 
assoc_d©a
->
timeout_¡¬‹d
 = 
Œue
;

8480 
assoc_d©a
->
Ãed_b—cÚ
 = 
Œue
;

8482 
	`rcu_»ad_uÆock
();

8485 
	`run_agaš
(
sd©a
, 
assoc_d©a
->
timeout
);

8488 ià(
ifmgd
->
auth_d©a
)

8489 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
Œue
);

8492 
”r_ş—r
:

8493 ià(!
ifmgd
->
auth_d©a
) {

8494 
	`‘h_z”o_addr
(
sd©a
->
deæšk
.
u
.
mgd
.
bssid
);

8495 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

8496 
BSS_CHANGED_BSSID
);

8498 
ifmgd
->
assoc_d©a
 = 
NULL
;

8499 
”r_ä“
:

8500 
	`kä“
(
assoc_d©a
);

8501  
”r
;

8502 
	}
}

8504 
	$›“80211_mgd_d—uth
(
›“80211_sub_if_d©a
 *
sd©a
,

8505 
cfg80211_d—uth_»que¡
 *
»q
)

8507 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

8508 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

8509 
boŞ
 
tx
 = !
»q
->
loÿl_¡©e_chªge
;

8510 
›“80211_´•_tx_šfo
 
šfo
 = {

8511 .
subty³
 = 
IEEE80211_STYPE_DEAUTH
,

8514 ià(
ifmgd
->
auth_d©a
 &&

8515 
	`‘h”_addr_equ®
(
ifmgd
->
auth_d©a
->
­_addr
, 
»q
->
bssid
)) {

8516 
	`sd©a_šfo
(
sd©a
,

8518 
»q
->
bssid
,„eq->
»asÚ_code
,

8519 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»q
->
»asÚ_code
));

8521 
šfo
.
lšk_id
 = 
ifmgd
->
auth_d©a
->link_id;

8522 
	`drv_mgd_´•¬e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

8523 
	`›“80211_£nd_d—uth_di§ssoc
(
sd©a
, 
»q
->
bssid
,„eq->bssid,

8524 
IEEE80211_STYPE_DEAUTH
,

8525 
»q
->
»asÚ_code
, 
tx
,

8526 
äame_buf
);

8527 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

8528 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
,

8529 (
äame_buf
), 
Œue
,

8530 
»q
->
»asÚ_code
, 
çl£
);

8531 
	`drv_mgd_com¶‘e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

8535 ià(
ifmgd
->
assoc_d©a
 &&

8536 
	`‘h”_addr_equ®
(
ifmgd
->
assoc_d©a
->
­_addr
, 
»q
->
bssid
)) {

8537 
	`sd©a_šfo
(
sd©a
,

8539 
»q
->
bssid
,„eq->
»asÚ_code
,

8540 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»q
->
»asÚ_code
));

8542 
šfo
.
lšk_id
 = 
ifmgd
->
assoc_d©a
->
assoc_lšk_id
;

8543 
	`drv_mgd_´•¬e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

8544 
	`›“80211_£nd_d—uth_di§ssoc
(
sd©a
, 
»q
->
bssid
,„eq->bssid,

8545 
IEEE80211_STYPE_DEAUTH
,

8546 
»q
->
»asÚ_code
, 
tx
,

8547 
äame_buf
);

8548 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_ABANDON
);

8549 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
,

8550 (
äame_buf
), 
Œue
,

8551 
»q
->
»asÚ_code
, 
çl£
);

8552 
	`drv_mgd_com¶‘e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

8556 ià(
ifmgd
->
assocŸ‹d
 &&

8557 
	`‘h”_addr_equ®
(
sd©a
->
vif
.
cfg
.
­_addr
, 
»q
->
bssid
)) {

8558 
	`sd©a_šfo
(
sd©a
,

8560 
»q
->
bssid
,„eq->
»asÚ_code
,

8561 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»q
->
»asÚ_code
));

8563 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DEAUTH
,

8564 
»q
->
»asÚ_code
, 
tx
, 
äame_buf
);

8565 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
,

8566 (
äame_buf
), 
Œue
,

8567 
»q
->
»asÚ_code
, 
çl£
);

8568 
	`drv_mgd_com¶‘e_tx
(
sd©a
->
loÿl
, sd©a, &
šfo
);

8572  -
ENOTCONN
;

8573 
	}
}

8575 
	$›“80211_mgd_di§ssoc
(
›“80211_sub_if_d©a
 *
sd©a
,

8576 
cfg80211_di§ssoc_»que¡
 *
»q
)

8578 
u8
 
äame_buf
[
IEEE80211_DEAUTH_FRAME_LEN
];

8580 ià(!
sd©a
->
u
.
mgd
.
assocŸ‹d
 ||

8581 
	`memcmp
(
sd©a
->
vif
.
cfg
.
­_addr
, 
»q
->­_addr, 
ETH_ALEN
))

8582  -
ENOTCONN
;

8584 
	`sd©a_šfo
(
sd©a
,

8586 
»q
->
­_addr
,„eq->
»asÚ_code
,

8587 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»q
->
»asÚ_code
));

8589 
	`›“80211_£t_di§ssoc
(
sd©a
, 
IEEE80211_STYPE_DISASSOC
,

8590 
»q
->
»asÚ_code
, !»q->
loÿl_¡©e_chªge
,

8591 
äame_buf
);

8593 
	`›“80211_»pÜt_discÚÃù
(
sd©a
, 
äame_buf
, (äame_buf), 
Œue
,

8594 
»q
->
»asÚ_code
, 
çl£
);

8597 
	}
}

8599 
	$›“80211_mgd_¡İ_lšk
(
›“80211_lšk_d©a
 *
lšk
)

8601 
	`why_wÜk_ÿnûl
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
,

8602 &
lšk
->
u
.
mgd
.
»que¡_smps_wÜk
);

8603 
	`why_wÜk_ÿnûl
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
,

8604 &
lšk
->
u
.
mgd
.
»ÿlc_smps
);

8605 
	`why_d–ayed_wÜk_ÿnûl
(
lšk
->
sd©a
->
loÿl
->
hw
.
why
,

8606 &
lšk
->
u
.
mgd
.
chsw™ch_wÜk
);

8607 
	}
}

8609 
	$›“80211_mgd_¡İ
(
›“80211_sub_if_d©a
 *
sd©a
)

8611 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

8618 
	`why_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

8619 &
ifmgd
->
mÚ™Ü_wÜk
);

8620 
	`why_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

8621 &
ifmgd
->
b—cÚ_cÚÃùiÚ_loss_wÜk
);

8622 
	`why_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

8623 &
ifmgd
->
c§_cÚÃùiÚ_drİ_wÜk
);

8624 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

8625 &
ifmgd
->
tdls_³”_d–_wÜk
);

8626 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

8627 &
ifmgd
->
ml_»cÚf_wÜk
);

8628 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
, &
ifmgd
->
‰lm_wÜk
);

8629 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

8630 &
ifmgd
->
Ãg_‰lm_timeout_wÜk
);

8632 ià(
ifmgd
->
assoc_d©a
)

8633 
	`›“80211_de¡roy_assoc_d©a
(
sd©a
, 
ASSOC_TIMEOUT
);

8634 ià(
ifmgd
->
auth_d©a
)

8635 
	`›“80211_de¡roy_auth_d©a
(
sd©a
, 
çl£
);

8636 
	`¥š_lock_bh
(&
ifmgd
->
‹¬down_lock
);

8637 ià(
ifmgd
->
‹¬down_skb
) {

8638 
	`kä“_skb
(
ifmgd
->
‹¬down_skb
);

8639 
ifmgd
->
‹¬down_skb
 = 
NULL
;

8640 
ifmgd
->
Üig_‹¬down_skb
 = 
NULL
;

8642 
	`kä“
(
ifmgd
->
assoc_»q_›s
);

8643 
ifmgd
->
assoc_»q_›s
 = 
NULL
;

8644 
ifmgd
->
assoc_»q_›s_Ën
 = 0;

8645 
	`¥š_uÆock_bh
(&
ifmgd
->
‹¬down_lock
);

8646 
	`d–_tim”_sync
(&
ifmgd
->
tim”
);

8647 
	}
}

8649 
	$›“80211_cqm_rssi_nÙify
(
›“80211_vif
 *
vif
,

8650 
Æ80211_cqm_rssi_th»shŞd_ev’t
 
rssi_ev’t
,

8651 
s32
 
rssi_Ëv–
,

8652 
gå_t
 
gå
)

8654 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

8656 
	`Œaû_­i_cqm_rssi_nÙify
(
sd©a
, 
rssi_ev’t
, 
rssi_Ëv–
);

8658 
	`cfg80211_cqm_rssi_nÙify
(
sd©a
->
dev
, 
rssi_ev’t
, 
rssi_Ëv–
, 
gå
);

8659 
	}
}

8660 
EXPORT_SYMBOL
(
›“80211_cqm_rssi_nÙify
);

8662 
	$›“80211_cqm_b—cÚ_loss_nÙify
(
›“80211_vif
 *
vif
, 
gå_t
 
gå
)

8664 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

8666 
	`Œaû_­i_cqm_b—cÚ_loss_nÙify
(
sd©a
->
loÿl
, sdata);

8668 
	`cfg80211_cqm_b—cÚ_loss_nÙify
(
sd©a
->
dev
, 
gå
);

8669 
	}
}

8670 
EXPORT_SYMBOL
(
›“80211_cqm_b—cÚ_loss_nÙify
);

8672 
	$_›“80211_’abË_rssi_»pÜts
(
›“80211_sub_if_d©a
 *
sd©a
,

8673 
rssi_mš_thŞd
,

8674 
rssi_max_thŞd
)

8676 
	`Œaû_­i_’abË_rssi_»pÜts
(
sd©a
, 
rssi_mš_thŞd
, 
rssi_max_thŞd
);

8678 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
))

8686 
sd©a
->
u
.
mgd
.
rssi_mš_thŞd
 =„ssi_min_thold*16;

8687 
sd©a
->
u
.
mgd
.
rssi_max_thŞd
 =„ssi_max_thold*16;

8688 
	}
}

8690 
	$›“80211_’abË_rssi_»pÜts
(
›“80211_vif
 *
vif
,

8691 
rssi_mš_thŞd
,

8692 
rssi_max_thŞd
)

8694 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

8696 
	`WARN_ON
(
rssi_mš_thŞd
 =ğ
rssi_max_thŞd
 ||

8697 
rssi_mš_thŞd
 > 
rssi_max_thŞd
);

8699 
	`_›“80211_’abË_rssi_»pÜts
(
sd©a
, 
rssi_mš_thŞd
,

8700 
rssi_max_thŞd
);

8701 
	}
}

8702 
EXPORT_SYMBOL
(
›“80211_’abË_rssi_»pÜts
);

8704 
	$›“80211_di§bË_rssi_»pÜts
(
›“80211_vif
 *
vif
)

8706 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

8708 
	`_›“80211_’abË_rssi_»pÜts
(
sd©a
, 0, 0);

8709 
	}
}

8710 
EXPORT_SYMBOL
(
›“80211_di§bË_rssi_»pÜts
);

	@ocb.c

12 
	~<lšux/d–ay.h
>

13 
	~<lšux/if_‘h”.h
>

14 
	~<lšux/skbuff.h
>

15 
	~<lšux/if_¬p.h
>

16 
	~<lšux/‘h”deviû.h
>

17 
	~<lšux/¹Ãšk.h
>

18 
	~<Ãt/mac80211.h
>

19 
	~<asm/uÇligÃd.h
>

21 
	~"›“80211_i.h
"

22 
	~"driv”-İs.h
"

23 
	~"¿‹.h
"

25 
	#IEEE80211_OCB_HOUSEKEEPING_INTERVAL
 (60 * 
HZ
)

	)

26 
	#IEEE80211_OCB_PEER_INACTIVITY_LIMIT
 (240 * 
HZ
)

	)

27 
	#IEEE80211_OCB_MAX_STA_ENTRIES
 128

	)

35 
	eocb_deã¼ed_sk_æags
 {

36 
	mOCB_WORK_HOUSEKEEPING
,

39 
	$›“80211_ocb_rx_no_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

40 cÚ¡ 
u8
 *
bssid
, cÚ¡ u8 *
addr
,

41 
u32
 
suµ_¿‹s
)

43 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

44 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

45 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

46 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

47 
¡a_šfo
 *
¡a
;

48 
bªd
;

53 ià(
loÿl
->
num_¡a
 >ğ
IEEE80211_OCB_MAX_STA_ENTRIES
) {

54 
	`Ãt_šfo_¿‹lim™ed
("%s: No„oom for‡‚ew OCB STAƒntry %pM\n",

55 
sd©a
->
Çme
, 
addr
);

59 
	`ocb_dbg
(
sd©a
, "Addšg‚ew OCB stiÚ %pM\n", 
addr
);

61 
	`rcu_»ad_lock
();

62 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

63 ià(
	`WARN_ON_ONCE
(!
chªùx_cÚf
)) {

64 
	`rcu_»ad_uÆock
();

67 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

68 
	`rcu_»ad_uÆock
();

70 
¡a
 = 
	`¡a_šfo_®loc
(
sd©a
, 
addr
, 
GFP_ATOMIC
);

71 ià(!
¡a
)

75 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

76 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
bªd
] = 
	`›“80211_mªd©Üy_¿‹s
(
sbªd
);

78 
	`¥š_lock
(&
ifocb
->
šcom¶‘e_lock
);

79 
	`li¡_add
(&
¡a
->
li¡
, &
ifocb
->
šcom¶‘e_¡©iÚs
);

80 
	`¥š_uÆock
(&
ifocb
->
šcom¶‘e_lock
);

81 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

82 
	}
}

84 
¡a_šfo
 *
	$›“80211_ocb_fšish_¡a
(
¡a_šfo
 *
¡a
)

85 
	$__acquœes
(
RCU
)

87 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

88 
u8
 
addr
[
ETH_ALEN
];

90 
	`memıy
(
addr
, 
¡a
->¡a.addr, 
ETH_ALEN
);

92 
	`ocb_dbg
(
sd©a
, "Adding‚ew IBSS station %pM (dev=%s)\n",

93 
addr
, 
sd©a
->
Çme
);

95 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTH
);

96 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
);

97 
	`¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_AUTHORIZED
);

99 
	`¿‹_cÚŒŞ_¿‹_š™
(
¡a
);

102 ià(
	`¡a_šfo_š£¹_rcu
(
¡a
))

103  
	`¡a_šfo_g‘
(
sd©a
, 
addr
);

104  
¡a
;

105 
	}
}

107 
	$›“80211_ocb_hou£k“pšg
(
›“80211_sub_if_d©a
 *
sd©a
)

109 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

111 
	`ocb_dbg
(
sd©a
, "Running ocb housekeeping\n");

113 
	`›“80211_¡a_expœe
(
sd©a
, 
IEEE80211_OCB_PEER_INACTIVITY_LIMIT
);

115 
	`mod_tim”
(&
ifocb
->
hou£k“pšg_tim”
,

116 
	`round_jiff›s
(
jiff›s
 + 
IEEE80211_OCB_HOUSEKEEPING_INTERVAL
));

117 
	}
}

119 
	$›“80211_ocb_wÜk
(
›“80211_sub_if_d©a
 *
sd©a
)

121 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

122 
¡a_šfo
 *
¡a
;

124 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

126 ià(
ifocb
->
jošed
 !ğ
Œue
)

129 
	`¥š_lock_bh
(&
ifocb
->
šcom¶‘e_lock
);

130 !
	`li¡_em±y
(&
ifocb
->
šcom¶‘e_¡©iÚs
)) {

131 
¡a
 = 
	`li¡_fœ¡_’Œy
(&
ifocb
->
šcom¶‘e_¡©iÚs
,

132 
¡a_šfo
, 
li¡
);

133 
	`li¡_d–
(&
¡a
->
li¡
);

134 
	`¥š_uÆock_bh
(&
ifocb
->
šcom¶‘e_lock
);

136 
	`›“80211_ocb_fšish_¡a
(
¡a
);

137 
	`rcu_»ad_uÆock
();

138 
	`¥š_lock_bh
(&
ifocb
->
šcom¶‘e_lock
);

140 
	`¥š_uÆock_bh
(&
ifocb
->
šcom¶‘e_lock
);

142 ià(
	`‹¡_ªd_ş—r_b™
(
OCB_WORK_HOUSEKEEPING
, &
ifocb
->
wrkq_æags
))

143 
	`›“80211_ocb_hou£k“pšg
(
sd©a
);

144 
	}
}

146 
	$›“80211_ocb_hou£k“pšg_tim”
(
tim”_li¡
 *
t
)

148 
›“80211_sub_if_d©a
 *
sd©a
 =

149 
	`äom_tim”
(
sd©a
, 
t
, 
u
.
ocb
.
hou£k“pšg_tim”
);

150 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

151 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

153 
	`£t_b™
(
OCB_WORK_HOUSEKEEPING
, &
ifocb
->
wrkq_æags
);

155 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

156 
	}
}

158 
	$›“80211_ocb_£tup_sd©a
(
›“80211_sub_if_d©a
 *
sd©a
)

160 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

162 
	`tim”_£tup
(&
ifocb
->
hou£k“pšg_tim”
,

163 
›“80211_ocb_hou£k“pšg_tim”
, 0);

164 
	`INIT_LIST_HEAD
(&
ifocb
->
šcom¶‘e_¡©iÚs
);

165 
	`¥š_lock_š™
(&
ifocb
->
šcom¶‘e_lock
);

166 
	}
}

168 
	$›“80211_ocb_još
(
›“80211_sub_if_d©a
 *
sd©a
,

169 
ocb_£tup
 *
£tup
)

171 
›“80211_chª_»q
 
chª»q
 = { .
İ”
 = 
£tup
->
chªdef
 };

172 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

173 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

174 
u64
 
chªged
 = 
BSS_CHANGED_OCB
 | 
BSS_CHANGED_BSSID
;

175 
”r
;

177 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

179 ià(
ifocb
->
jošed
 =ğ
Œue
)

180  -
EINVAL
;

182 
sd©a
->
deæšk
.
İ”©šg_11g_mode
 = 
Œue
;

183 
sd©a
->
deæšk
.
smps_mode
 = 
IEEE80211_SMPS_OFF
;

184 
sd©a
->
deæšk
.
Ãeded_rx_chašs
 = sd©a->
loÿl
->
rx_chašs
;

186 
”r
 = 
	`›“80211_lšk_u£_chªÃl
(&
sd©a
->
deæšk
, &
chª»q
,

187 
IEEE80211_CHANCTX_SHARED
);

188 ià(
”r
)

189  
”r
;

191 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

193 
ifocb
->
jošed
 = 
Œue
;

195 
	`£t_b™
(
OCB_WORK_HOUSEKEEPING
, &
ifocb
->
wrkq_æags
);

196 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

198 
	`Ãtif_ÿ¼›r_Ú
(
sd©a
->
dev
);

200 
	}
}

202 
	$›“80211_ocb_Ëave
(
›“80211_sub_if_d©a
 *
sd©a
)

204 
›“80211_if_ocb
 *
ifocb
 = &
sd©a
->
u
.
ocb
;

205 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

206 
¡a_šfo
 *
¡a
;

208 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

210 
ifocb
->
jošed
 = 
çl£
;

211 
	`¡a_šfo_æush
(
sd©a
, -1);

213 
	`¥š_lock_bh
(&
ifocb
->
šcom¶‘e_lock
);

214 !
	`li¡_em±y
(&
ifocb
->
šcom¶‘e_¡©iÚs
)) {

215 
¡a
 = 
	`li¡_fœ¡_’Œy
(&
ifocb
->
šcom¶‘e_¡©iÚs
,

216 
¡a_šfo
, 
li¡
);

217 
	`li¡_d–
(&
¡a
->
li¡
);

218 
	`¥š_uÆock_bh
(&
ifocb
->
šcom¶‘e_lock
);

220 
	`¡a_šfo_ä“
(
loÿl
, 
¡a
);

221 
	`¥š_lock_bh
(&
ifocb
->
šcom¶‘e_lock
);

223 
	`¥š_uÆock_bh
(&
ifocb
->
šcom¶‘e_lock
);

225 
	`Ãtif_ÿ¼›r_off
(
sd©a
->
dev
);

226 
	`ş—r_b™
(
SDATA_STATE_OFFCHANNEL
, &
sd©a
->
¡©e
);

227 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
BSS_CHANGED_OCB
);

229 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

231 
	`skb_queue_purge
(&
sd©a
->
skb_queue
);

233 
	`d–_tim”_sync
(&
sd©a
->
u
.
ocb
.
hou£k“pšg_tim”
);

242 
	}
}

	@offchannel.c

13 
	~<lšux/expÜt.h
>

14 
	~<Ãt/mac80211.h
>

15 
	~"›“80211_i.h
"

16 
	~"driv”-İs.h
"

25 
	$›“80211_offchªÃl_ps_’abË
(
›“80211_sub_if_d©a
 *
sd©a
)

27 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

28 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

29 
boŞ
 
offchªÃl_ps_’abËd
 = 
çl£
;

33 
	`d–_tim”_sync
(&
loÿl
->
dyÇmic_ps_tim”
);

34 
	`d–_tim”_sync
(&
ifmgd
->
bú_mÚ_tim”
);

35 
	`d–_tim”_sync
(&
ifmgd
->
cÚn_mÚ_tim”
);

37 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
dyÇmic_ps_’abË_wÜk
);

39 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
) {

40 
offchªÃl_ps_’abËd
 = 
Œue
;

41 
loÿl
->
hw
.
cÚf
.
æags
 &ğ~
IEEE80211_CONF_PS
;

42 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_PS
);

45 ià(!
offchªÃl_ps_’abËd
 ||

46 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
))

57 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
Œue
);

58 
	}
}

61 
	$›“80211_offchªÃl_ps_di§bË
(
›“80211_sub_if_d©a
 *
sd©a
)

63 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

65 ià(!
loÿl
->
ps_sd©a
)

66 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
çl£
);

67 ià(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
 > 0) {

74 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
çl£
);

75 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

76 
	`m£cs_to_jiff›s
(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
));

79 
	`›“80211_¡a_»£t_b—cÚ_mÚ™Ü
(
sd©a
);

80 
	`›“80211_¡a_»£t_cÚn_mÚ™Ü
(
sd©a
);

81 
	}
}

83 
	$›“80211_offchªÃl_¡İ_vifs
(
›“80211_loÿl
 *
loÿl
)

85 
›“80211_sub_if_d©a
 *
sd©a
;

87 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

89 ià(
	`WARN_ON
(!
loÿl
->
emuÏ‹_chªùx
))

101 
	`›“80211_¡İ_queues_by_»asÚ
(&
loÿl
->
hw
, 
IEEE80211_MAX_QUEUE_MAP
,

102 
IEEE80211_QUEUE_STOP_REASON_OFFCHANNEL
,

103 
çl£
);

104 
	`›“80211_æush_queues
(
loÿl
, 
NULL
, 
çl£
);

106 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

107 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

110 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_P2P_DEVICE
 ||

111 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_NAN
)

114 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
)

115 
	`£t_b™
(
SDATA_STATE_OFFCHANNEL
, &
sd©a
->
¡©e
);

118 ià(
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
) {

119 
	`£t_b™
(
SDATA_STATE_OFFCHANNEL_BEACON_STOPPED
,

120 &
sd©a
->
¡©e
);

121 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
çl£
;

122 
	`›“80211_lšk_šfo_chªge_nÙify
(

123 
sd©a
, &sd©a->
deæšk
,

124 
BSS_CHANGED_BEACON_ENABLED
);

127 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

128 
sd©a
->
u
.
mgd
.
assocŸ‹d
)

129 
	`›“80211_offchªÃl_ps_’abË
(
sd©a
);

131 
	}
}

133 
	$›“80211_offchªÃl_»tuº
(
›“80211_loÿl
 *
loÿl
)

135 
›“80211_sub_if_d©a
 *
sd©a
;

137 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

139 ià(
	`WARN_ON
(!
loÿl
->
emuÏ‹_chªùx
))

142 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

143 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_P2P_DEVICE
)

146 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
)

147 
	`ş—r_b™
(
SDATA_STATE_OFFCHANNEL
, &
sd©a
->
¡©e
);

149 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

153 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

154 
sd©a
->
u
.
mgd
.
assocŸ‹d
)

155 
	`›“80211_offchªÃl_ps_di§bË
(
sd©a
);

157 ià(
	`‹¡_ªd_ş—r_b™
(
SDATA_STATE_OFFCHANNEL_BEACON_STOPPED
,

158 &
sd©a
->
¡©e
)) {

159 
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
 = 
Œue
;

160 
	`›“80211_lšk_šfo_chªge_nÙify
(

161 
sd©a
, &sd©a->
deæšk
,

162 
BSS_CHANGED_BEACON_ENABLED
);

166 
	`›“80211_wake_queues_by_»asÚ
(&
loÿl
->
hw
, 
IEEE80211_MAX_QUEUE_MAP
,

167 
IEEE80211_QUEUE_STOP_REASON_OFFCHANNEL
,

168 
çl£
);

169 
	}
}

171 
	$›“80211_roc_nÙify_de¡roy
(
›“80211_roc_wÜk
 *
roc
)

174 ià(
roc
->
äame
) {

175 
	`cfg80211_mgmt_tx_¡©us
(&
roc
->
sd©a
->
wdev
,„oc->
mgmt_tx_cook›
,

176 
roc
->
äame
->
d©a
,„oc->äame->
Ën
,

177 
çl£
, 
GFP_KERNEL
);

178 
	`›“80211_ä“_txskb
(&
roc
->
sd©a
->
loÿl
->
hw
,„oc->
äame
);

181 ià(!
roc
->
mgmt_tx_cook›
)

182 
	`cfg80211_»maš_Ú_chªÃl_expœed
(&
roc
->
sd©a
->
wdev
,

183 
roc
->
cook›
,„oc->
chª
,

184 
GFP_KERNEL
);

186 
	`cfg80211_tx_mgmt_expœed
(&
roc
->
sd©a
->
wdev
,

187 
roc
->
mgmt_tx_cook›
,

188 
roc
->
chª
, 
GFP_KERNEL
);

190 
	`li¡_d–
(&
roc
->
li¡
);

191 
	`kä“
(
roc
);

192 
	}
}

194 
	$›“80211_’d_fšished_rocs
(
›“80211_loÿl
 *
loÿl
,

195 
now
)

197 
›“80211_roc_wÜk
 *
roc
, *
tmp
;

198 
»maššg_dur_mš
 = 
LONG_MAX
;

200 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

202 
	`li¡_fÜ_—ch_’Œy_§ã
(
roc
, 
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

203 
»maššg
;

205 ià(!
roc
->
¡¬‹d
)

208 
»maššg
 = 
roc
->
¡¬t_time
 +

209 
	`m£cs_to_jiff›s
(
roc
->
du¿tiÚ
) -

210 
now
;

216 ià(
roc
->
abÜt
 ||„oc->
hw_begun
 || 
»maššg
 <= 0)

217 
	`›“80211_roc_nÙify_de¡roy
(
roc
);

219 
»maššg_dur_mš
 = 
	`mš
Ôemaššg_dur_mš, 
»maššg
);

222  
»maššg_dur_mš
;

223 
	}
}

225 
boŞ
 
	$›“80211_»ÿlc_sw_wÜk
(
›“80211_loÿl
 *
loÿl
,

226 
now
)

228 
dur
 = 
	`›“80211_’d_fšished_rocs
(
loÿl
, 
now
);

230 ià(
dur
 =ğ
LONG_MAX
)

231  
çl£
;

233 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
roc_wÜk
, 
dur
);

234  
Œue
;

235 
	}
}

237 
	$›“80211_hªdË_roc_¡¬‹d
(
›“80211_roc_wÜk
 *
roc
,

238 
¡¬t_time
)

240 ià(
	`WARN_ON
(
roc
->
nÙif›d
))

243 
roc
->
¡¬t_time
 = start_time;

244 
roc
->
¡¬‹d
 = 
Œue
;

246 ià(
roc
->
mgmt_tx_cook›
) {

247 ià(!
	`WARN_ON
(!
roc
->
äame
)) {

248 
	`›“80211_tx_skb_tid_bªd
(
roc
->
sd©a
,„oc->
äame
, 7,

249 
roc
->
chª
->
bªd
);

250 
roc
->
äame
 = 
NULL
;

253 
	`cfg80211_»ady_Ú_chªÃl
(&
roc
->
sd©a
->
wdev
,„oc->
cook›
,

254 
roc
->
chª
,„oc->
»q_du¿tiÚ
,

255 
GFP_KERNEL
);

258 
roc
->
nÙif›d
 = 
Œue
;

259 
	}
}

261 
	$›“80211_hw_roc_¡¬t
(
why
 *why, 
why_wÜk
 *
wÜk
)

263 
›“80211_loÿl
 *
loÿl
 =

264 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
hw_roc_¡¬t
);

265 
›“80211_roc_wÜk
 *
roc
;

267 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

269 
	`li¡_fÜ_—ch_’Œy
(
roc
, &
loÿl
->
roc_li¡
, 
li¡
) {

270 ià(!
roc
->
¡¬‹d
)

273 
roc
->
hw_begun
 = 
Œue
;

274 
	`›“80211_hªdË_roc_¡¬‹d
(
roc
, 
loÿl
->
hw_roc_¡¬t_time
);

276 
	}
}

278 
	$›“80211_»ady_Ú_chªÃl
(
›“80211_hw
 *
hw
)

280 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

282 
loÿl
->
hw_roc_¡¬t_time
 = 
jiff›s
;

284 
	`Œaû_­i_»ady_Ú_chªÃl
(
loÿl
);

286 
	`why_wÜk_queue
(
hw
->
why
, &
loÿl
->
hw_roc_¡¬t
);

287 
	}
}

288 
EXPORT_SYMBOL_GPL
(
›“80211_»ady_Ú_chªÃl
);

290 
	$_›“80211_¡¬t_Ãxt_roc
(
›“80211_loÿl
 *
loÿl
)

292 
›“80211_roc_wÜk
 *
roc
, *
tmp
;

293 
›“80211_roc_ty³
 
ty³
;

294 
u32
 
mš_dur
, 
max_dur
;

296 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

298 ià(
	`WARN_ON
(
	`li¡_em±y
(&
loÿl
->
roc_li¡
)))

301 
roc
 = 
	`li¡_fœ¡_’Œy
(&
loÿl
->
roc_li¡
, 
›“80211_roc_wÜk
,

302 
li¡
);

304 ià(
	`WARN_ON
(
roc
->
¡¬‹d
))

307 
mš_dur
 = 
roc
->
du¿tiÚ
;

308 
max_dur
 = 
roc
->
du¿tiÚ
;

309 
ty³
 = 
roc
->type;

311 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

312 ià(
tmp
 =ğ
roc
)

314 ià(
tmp
->
sd©a
 !ğ
roc
->sd©¨||mp->
chª
 !=„oc->chan)

316 
max_dur
 = 
	`max
(
tmp
->
du¿tiÚ
, max_dur);

317 
mš_dur
 = 
	`mš
(
tmp
->
du¿tiÚ
, min_dur);

318 
ty³
 = 
	`max
(
tmp
->type,ype);

321 ià(
loÿl
->
İs
->
»maš_Ú_chªÃl
) {

322 
»t
 = 
	`drv_»maš_Ú_chªÃl
(
loÿl
, 
roc
->
sd©a
,„oc->
chª
,

323 
max_dur
, 
ty³
);

325 ià(
»t
) {

326 
	`why_w¬n
(
loÿl
->
hw
.
why
,

327 "çedØ¡¬ˆÃxˆHW ROC (%d)\n", 
»t
);

332 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

333 ià(
tmp
->
sd©a
 !ğ
roc
->sdata ||

334 
tmp
->
chª
 !ğ
roc
->chan)

336 
tmp
->
¡¬‹d
 = 
Œue
;

337 
tmp
->
abÜt
 = 
Œue
;

339 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
hw_roc_dÚe
);

344 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

345 ià(
tmp
->
sd©a
 !ğ
roc
->sd©¨||mp->
chª
 !=„oc->chan)

347 
tmp
->
¡¬‹d
 = 
Œue
;

358 
roc
->
Ú_chªÃl
 =„oc->
chª
 =ğ
loÿl
->
hw
.
cÚf
.
chªdef
.chan &&

359 
loÿl
->
hw
.
cÚf
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_5
 &&

360 
loÿl
->
hw
.
cÚf
.
chªdef
.
width
 !ğ
NL80211_CHAN_WIDTH_10
;

363 
	`›“80211_»ÿlc_idË
(
loÿl
);

365 ià(!
roc
->
Ú_chªÃl
) {

366 
	`›“80211_offchªÃl_¡İ_vifs
(
loÿl
);

368 
loÿl
->
tmp_chªÃl
 = 
roc
->
chª
;

369 
	`›“80211_hw_cÚf_chª
(
loÿl
);

372 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
roc_wÜk
,

373 
	`m£cs_to_jiff›s
(
mš_dur
));

376 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

377 ià(
tmp
->
sd©a
 !ğ
roc
->sd©¨||mp->
chª
 !=„oc->chan)

380 
tmp
->
Ú_chªÃl
 = 
roc
->on_channel;

381 
	`›“80211_hªdË_roc_¡¬‹d
(
tmp
, 
jiff›s
);

384 
	}
}

386 
	$›“80211_¡¬t_Ãxt_roc
(
›“80211_loÿl
 *
loÿl
)

388 
›“80211_roc_wÜk
 *
roc
;

390 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

392 ià(
	`li¡_em±y
(&
loÿl
->
roc_li¡
)) {

393 
	`›“80211_run_deã¼ed_sÿn
(
loÿl
);

398 ià(
loÿl
->
š_»cÚfig
)

401 
roc
 = 
	`li¡_fœ¡_’Œy
(&
loÿl
->
roc_li¡
, 
›“80211_roc_wÜk
,

402 
li¡
);

404 ià(
	`WARN_ON_ONCE
(
roc
->
¡¬‹d
))

407 ià(
loÿl
->
İs
->
»maš_Ú_chªÃl
) {

408 
	`_›“80211_¡¬t_Ãxt_roc
(
loÿl
);

411 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
roc_wÜk
,

412 
	`round_jiff›s_»Ïtive
(
HZ
 / 2));

414 
	}
}

416 
	$__›“80211_roc_wÜk
(
›“80211_loÿl
 *
loÿl
)

418 
›“80211_roc_wÜk
 *
roc
;

419 
boŞ
 
Ú_chªÃl
;

421 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

423 ià(
	`WARN_ON
(
loÿl
->
İs
->
»maš_Ú_chªÃl
))

426 
roc
 = 
	`li¡_fœ¡_’Œy_Ü_nuÎ
(&
loÿl
->
roc_li¡
,

427 
›“80211_roc_wÜk
, 
li¡
);

428 ià(!
roc
)

431 ià(!
roc
->
¡¬‹d
) {

432 
	`WARN_ON
(!
loÿl
->
emuÏ‹_chªùx
);

433 
	`_›“80211_¡¬t_Ãxt_roc
(
loÿl
);

435 
Ú_chªÃl
 = 
roc
->on_channel;

436 ià(
	`›“80211_»ÿlc_sw_wÜk
(
loÿl
, 
jiff›s
))

441 ià(!
Ú_chªÃl
) {

442 
	`›“80211_æush_queues
(
loÿl
, 
NULL
, 
çl£
);

444 
loÿl
->
tmp_chªÃl
 = 
NULL
;

445 
	`›“80211_hw_cÚf_chª
(
loÿl
);

447 
	`›“80211_offchªÃl_»tuº
(
loÿl
);

450 
	`›“80211_»ÿlc_idË
(
loÿl
);

451 
	`›“80211_¡¬t_Ãxt_roc
(
loÿl
);

453 
	}
}

455 
	$›“80211_roc_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
)

457 
›“80211_loÿl
 *
loÿl
 =

458 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
roc_wÜk
.work);

460 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

462 
	`__›“80211_roc_wÜk
(
loÿl
);

463 
	}
}

465 
	$›“80211_hw_roc_dÚe
(
why
 *why, 
why_wÜk
 *
wÜk
)

467 
›“80211_loÿl
 *
loÿl
 =

468 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
hw_roc_dÚe
);

470 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

472 
	`›“80211_’d_fšished_rocs
(
loÿl
, 
jiff›s
);

475 
	`›“80211_¡¬t_Ãxt_roc
(
loÿl
);

476 
	}
}

478 
	$›“80211_»maš_Ú_chªÃl_expœed
(
›“80211_hw
 *
hw
)

480 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

482 
	`Œaû_­i_»maš_Ú_chªÃl_expœed
(
loÿl
);

484 
	`why_wÜk_queue
(
hw
->
why
, &
loÿl
->
hw_roc_dÚe
);

485 
	}
}

486 
EXPORT_SYMBOL_GPL
(
›“80211_»maš_Ú_chªÃl_expœed
);

488 
boŞ


489 
	$›“80211_cßËsû_hw_¡¬‹d_roc
(
›“80211_loÿl
 *
loÿl
,

490 
›“80211_roc_wÜk
 *
Ãw_roc
,

491 
›“80211_roc_wÜk
 *
cur_roc
)

493 
now
 = 
jiff›s
;

494 
»maššg
;

496 ià(
	`WARN_ON
(!
cur_roc
->
¡¬‹d
))

497  
çl£
;

502 ià(!
cur_roc
->
hw_begun
 && 
Ãw_roc
->
du¿tiÚ
 > cur_roc->duration)

503  
çl£
;

505 
»maššg
 = 
cur_roc
->
¡¬t_time
 +

506 
	`m£cs_to_jiff›s
(
cur_roc
->
du¿tiÚ
) -

507 
now
;

510 ià(
Ãw_roc
->
du¿tiÚ
 > 
	`jiff›s_to_m£cs
(
»maššg
))

511  
çl£
;

514 
	`li¡_add
(&
Ãw_roc
->
li¡
, &
cur_roc
->list);

520 ià(
cur_roc
->
hw_begun
) {

521 
Ãw_roc
->
hw_begun
 = 
Œue
;

522 
	`›“80211_hªdË_roc_¡¬‹d
(
Ãw_roc
, 
now
);

525  
Œue
;

526 
	}
}

528 
	$›“80211_¡¬t_roc_wÜk
(
›“80211_loÿl
 *
loÿl
,

529 
›“80211_sub_if_d©a
 *
sd©a
,

530 
›“80211_chªÃl
 *
chªÃl
,

531 
du¿tiÚ
, 
u64
 *
cook›
,

532 
sk_buff
 *
txskb
,

533 
›“80211_roc_ty³
 
ty³
)

535 
›“80211_roc_wÜk
 *
roc
, *
tmp
;

536 
boŞ
 
queued
 = 
çl£
, 
combše_¡¬‹d
 = 
Œue
;

537 
»t
;

539 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

541 ià(
chªÃl
->
äeq_off£t
)

543  -
EOPNOTSUPP
;

545 ià(!
loÿl
->
emuÏ‹_chªùx
 && !loÿl->
İs
->
»maš_Ú_chªÃl
)

546  -
EOPNOTSUPP
;

548 
roc
 = 
	`kz®loc
((*roc), 
GFP_KERNEL
);

549 ià(!
roc
)

550  -
ENOMEM
;

561 ià(!
du¿tiÚ
)

562 
du¿tiÚ
 = 10;

564 
roc
->
chª
 = 
chªÃl
;

565 
roc
->
du¿tiÚ
 = duration;

566 
roc
->
»q_du¿tiÚ
 = 
du¿tiÚ
;

567 
roc
->
äame
 = 
txskb
;

568 
roc
->
ty³
 =ype;

569 
roc
->
sd©a
 = sdata;

575 ià(!
txskb
) {

576 
roc
->
cook›
 = 
	`›“80211_mgmt_tx_cook›
(
loÿl
);

577 *
cook›
 = 
roc
->cookie;

579 
roc
->
mgmt_tx_cook›
 = *
cook›
;

583 ià(
	`li¡_em±y
(&
loÿl
->
roc_li¡
) &&

584 !
loÿl
->
sÿÂšg
 && !
	`›“80211_is_¿d¬_»quœed
(local)) {

586 ià(!
loÿl
->
İs
->
»maš_Ú_chªÃl
) {

587 
	`li¡_add_
(&
roc
->
li¡
, &
loÿl
->
roc_li¡
);

588 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
,

589 &
loÿl
->
roc_wÜk
, 0);

594 
»t
 = 
	`drv_»maš_Ú_chªÃl
(
loÿl
, 
sd©a
, 
chªÃl
,

595 
du¿tiÚ
, 
ty³
);

596 ià(
»t
) {

597 
	`kä“
(
roc
);

598  
»t
;

600 
roc
->
¡¬‹d
 = 
Œue
;

601 
	`li¡_add_
(&
roc
->
li¡
, &
loÿl
->
roc_li¡
);

609 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

610 ià(
tmp
->
chª
 !ğ
chªÃl
 ||mp->
sd©a
 != sdata)

617 ià(!
tmp
->
¡¬‹d
) {

618 
	`li¡_add
(&
roc
->
li¡
, &
tmp
->list);

619 
queued
 = 
Œue
;

623 ià(!
combše_¡¬‹d
)

626 ià(!
loÿl
->
İs
->
»maš_Ú_chªÃl
) {

636 
now
 = 
jiff›s
;

637 
u32
 
–­£d
 = 
	`jiff›s_to_m£cs
(
now
 - 
tmp
->
¡¬t_time
);

638 
why
 *why = 
loÿl
->
hw
.wiphy;

639 
u32
 
max_roc
 = 
why
->
max_»maš_Ú_chªÃl_du¿tiÚ
;

641 ià(
–­£d
 + 
roc
->
du¿tiÚ
 > 
max_roc
) {

642 
combše_¡¬‹d
 = 
çl£
;

646 
	`li¡_add
(&
roc
->
li¡
, &
tmp
->list);

647 
queued
 = 
Œue
;

648 
roc
->
Ú_chªÃl
 = 
tmp
->on_channel;

649 
	`›“80211_hªdË_roc_¡¬‹d
(
roc
, 
now
);

650 
	`›“80211_»ÿlc_sw_wÜk
(
loÿl
, 
now
);

654 
queued
 = 
	`›“80211_cßËsû_hw_¡¬‹d_roc
(
loÿl
, 
roc
, 
tmp
);

655 ià(
queued
)

662 
combše_¡¬‹d
 = 
çl£
;

665 ià(!
queued
)

666 
	`li¡_add_
(&
roc
->
li¡
, &
loÿl
->
roc_li¡
);

669 
	}
}

671 
	$›“80211_»maš_Ú_chªÃl
(
why
 *why, 
wœ–ess_dev
 *
wdev
,

672 
›“80211_chªÃl
 *
chª
,

673 
du¿tiÚ
, 
u64
 *
cook›
)

675 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

676 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

678 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

680  
	`›“80211_¡¬t_roc_wÜk
(
loÿl
, 
sd©a
, 
chª
,

681 
du¿tiÚ
, 
cook›
, 
NULL
,

682 
IEEE80211_ROC_TYPE_NORMAL
);

683 
	}
}

685 
	$›“80211_ÿnûl_roc
(
›“80211_loÿl
 *
loÿl
,

686 
u64
 
cook›
, 
boŞ
 
mgmt_tx
)

688 
›“80211_roc_wÜk
 *
roc
, *
tmp
, *
found
 = 
NULL
;

689 
»t
;

691 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

693 ià(!
cook›
)

694  -
ENOENT
;

696 
	`why_wÜk_æush
(
loÿl
->
hw
.
why
, &loÿl->
hw_roc_¡¬t
);

698 
	`li¡_fÜ_—ch_’Œy_§ã
(
roc
, 
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

699 ià(!
mgmt_tx
 && 
roc
->
cook›
 != cookie)

701 ià(
mgmt_tx
 && 
roc
->
mgmt_tx_cook›
 !ğ
cook›
)

704 
found
 = 
roc
;

708 ià(!
found
) {

709  -
ENOENT
;

712 ià(!
found
->
¡¬‹d
) {

713 
	`›“80211_roc_nÙify_de¡roy
(
found
);

714 
out_uÆock
;

717 ià(
loÿl
->
İs
->
»maš_Ú_chªÃl
) {

718 
»t
 = 
	`drv_ÿnûl_»maš_Ú_chªÃl
(
loÿl
, 
roc
->
sd©a
);

719 ià(
	`WARN_ON_ONCE
(
»t
)) {

720  
»t
;

738 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
hw_roc_dÚe
);

745 
	`li¡_fÜ_—ch_’Œy_§ã
(
roc
, 
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

746 ià(!
roc
->
¡¬‹d
)

748 ià(
roc
 =ğ
found
)

749 
found
 = 
NULL
;

750 
	`›“80211_roc_nÙify_de¡roy
(
roc
);

754 
	`WARN_ON
(
found
);

756 
	`›“80211_¡¬t_Ãxt_roc
(
loÿl
);

759 
found
->
abÜt
 = 
Œue
;

760 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
roc_wÜk
, 0);

763 
out_uÆock
:

766 
	}
}

768 
	$›“80211_ÿnûl_»maš_Ú_chªÃl
(
why
 *wiphy,

769 
wœ–ess_dev
 *
wdev
, 
u64
 
cook›
)

771 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

772 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

774  
	`›“80211_ÿnûl_roc
(
loÿl
, 
cook›
, 
çl£
);

775 
	}
}

777 
	$›“80211_mgmt_tx
(
why
 *why, 
wœ–ess_dev
 *
wdev
,

778 
cfg80211_mgmt_tx_·¿ms
 *
·¿ms
, 
u64
 *
cook›
)

780 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

781 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

782 
sk_buff
 *
skb
;

783 
¡a_šfo
 *
¡a
 = 
NULL
;

784 cÚ¡ 
›“80211_mgmt
 *
mgmt
 = (*)
·¿ms
->
buf
;

785 
boŞ
 
Ãed_offchª
 = 
çl£
;

786 
boŞ
 
mlo_¡a
 = 
çl£
;

787 
lšk_id
 = -1;

788 
u32
 
æags
;

789 
»t
;

790 
u8
 *
d©a
;

792 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

794 ià(
·¿ms
->
dÚt_wa™_fÜ_ack
)

795 
æags
 = 
IEEE80211_TX_CTL_NO_ACK
;

797 
æags
 = 
IEEE80211_TX_INTFL_NL80211_FRAME_TX
 |

798 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

800 ià(
·¿ms
->
no_cck
)

801 
æags
 |ğ
IEEE80211_TX_CTL_NO_CCK_RATE
;

803 
sd©a
->
vif
.
ty³
) {

804 
NL80211_IFTYPE_ADHOC
:

805 ià(!
sd©a
->
vif
.
cfg
.
ibss_jošed
)

806 
Ãed_offchª
 = 
Œue
;

807 #ifdeà
CONFIG_MAC80211_MESH


808 
çÎthrough
;

809 
NL80211_IFTYPE_MESH_POINT
:

810 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
) &&

811 !
sd©a
->
u
.
mesh
.
mesh_id_Ën
)

812 
Ãed_offchª
 = 
Œue
;

814 
çÎthrough
;

815 
NL80211_IFTYPE_AP
:

816 
NL80211_IFTYPE_AP_VLAN
:

817 
NL80211_IFTYPE_P2P_GO
:

818 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

819 !
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
) &&

820 !
sd©a
->
bss
->
aùive
)

821 
Ãed_offchª
 = 
Œue
;

823 
	`rcu_»ad_lock
();

824 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
da
);

825 
mlo_¡a
 = 
¡a
 && s->¡a.
mlo
;

827 ià(!
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) ||

828 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_PUBLIC
 ||

829 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_SELF_PROTECTED
 ||

830 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_SPECTRUM_MGMT
) {

831 
	`rcu_»ad_uÆock
();

835 ià(!
¡a
) {

836 
	`rcu_»ad_uÆock
();

837  -
ENOLINK
;

839 ià(
·¿ms
->
lšk_id
 >= 0 &&

840 !(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
·¿ms
->
lšk_id
))) {

841 
	`rcu_»ad_uÆock
();

842  -
ENOLINK
;

844 
lšk_id
 = 
·¿ms
->link_id;

845 
	`rcu_»ad_uÆock
();

847 
NL80211_IFTYPE_STATION
:

848 
NL80211_IFTYPE_P2P_CLIENT
:

849 ià(!
sd©a
->
u
.
mgd
.
assocŸ‹d
 ||

850 (
·¿ms
->
offchª
 &&…¬ams->
wa™
 &&

851 
loÿl
->
İs
->
»maš_Ú_chªÃl
 &&

852 
	`memcmp
(
sd©a
->
vif
.
cfg
.
­_addr
, 
mgmt
->
bssid
, 
ETH_ALEN
))) {

853 
Ãed_offchª
 = 
Œue
;

854 } ià(
sd©a
->
u
.
mgd
.
assocŸ‹d
 &&

855 
	`‘h”_addr_equ®
(
sd©a
->
vif
.
cfg
.
­_addr
, 
mgmt
->
da
)) {

856 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
da
);

857 
mlo_¡a
 = 
¡a
 && s->¡a.
mlo
;

860 
NL80211_IFTYPE_P2P_DEVICE
:

861 
Ãed_offchª
 = 
Œue
;

863 
NL80211_IFTYPE_NAN
:

865  -
EOPNOTSUPP
;

871 ià(
Ãed_offchª
 && !
·¿ms
->
chª
)

872  -
EINVAL
;

875 ià(!
·¿ms
->
chª
 && 
mlo_¡a
) {

876 
Ãed_offchª
 = 
çl£
;

877 } ià(!
Ãed_offchª
) {

878 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
 = 
NULL
;

879 
i
;

881 
	`rcu_»ad_lock
();

883 
i
 = 0; i < 
	`ARRAY_SIZE
(
sd©a
->
vif
.
lšk_cÚf
); i++) {

884 
›“80211_bss_cÚf
 *
cÚf
;

886 
cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[
i
]);

887 ià(!
cÚf
)

890 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
cÚf
->chanctx_conf);

891 ià(!
chªùx_cÚf
)

894 ià(
mlo_¡a
 && 
·¿ms
->
chª
 =ğ
chªùx_cÚf
->
def
.chan &&

895 
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
mgmt
->
§
)) {

896 
lšk_id
 = 
i
;

900 ià(
	`‘h”_addr_equ®
(
cÚf
->
addr
, 
mgmt
->
§
))

903 
chªùx_cÚf
 = 
NULL
;

906 ià(
chªùx_cÚf
) {

907 
Ãed_offchª
 = 
·¿ms
->
chª
 &&

908 (
·¿ms
->
chª
 !=

909 
chªùx_cÚf
->
def
.
chª
);

911 
Ãed_offchª
 = 
Œue
;

913 
	`rcu_»ad_uÆock
();

916 ià(
Ãed_offchª
 && !
·¿ms
->
offchª
) {

917 
»t
 = -
EBUSY
;

918 
out_uÆock
;

921 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
·¿ms
->
Ën
);

922 ià(!
skb
) {

923 
»t
 = -
ENOMEM
;

924 
out_uÆock
;

926 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

928 
d©a
 = 
	`skb_put_d©a
(
skb
, 
·¿ms
->
buf
,…¬ams->
Ën
);

931 ià(
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
 &&

932 (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

933 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
 ||

934 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) &&

935 
·¿ms
->
n_c§_off£ts
) {

936 
i
;

937 
b—cÚ_d©a
 *
b—cÚ
 = 
NULL
;

939 
	`rcu_»ad_lock
();

941 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

942 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
deæšk
.
u
.
­
.beacon);

943 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

944 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
ibss
.
´e¥
);

945 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

946 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
mesh
.beacon);

948 ià(
b—cÚ
)

949 
i
 = 0; i < 
·¿ms
->
n_c§_off£ts
; i++)

950 
d©a
[
·¿ms
->
c§_off£ts
[
i
]] =

951 
b—cÚ
->
útdwn_cu¼’t_couÁ”
;

953 
	`rcu_»ad_uÆock
();

956 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 = flags;

958 
skb
->
dev
 = 
sd©a
->dev;

960 ià(!
·¿ms
->
dÚt_wa™_fÜ_ack
) {

964 
»t
 = 
	`›“80211_©ch_ack_skb
(
loÿl
, 
skb
, 
cook›
, 
GFP_KERNEL
);

965 ià(
»t
) {

966 
	`kä“_skb
(
skb
);

967 
out_uÆock
;

975 *
cook›
 = 0xffffffff;

978 ià(!
Ãed_offchª
) {

979 
	`›“80211_tx_skb_tid
(
sd©a
, 
skb
, 7, 
lšk_id
);

980 
»t
 = 0;

981 
out_uÆock
;

984 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_CTL_TX_OFFCHAN
 |

985 
IEEE80211_TX_INTFL_OFFCHAN_TX_OK
;

986 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
))

987 
	`IEEE80211_SKB_CB
(
skb
)->
hw_queue
 =

988 
loÿl
->
hw
.
offchªÃl_tx_hw_queue
;

991 
»t
 = 
	`›“80211_¡¬t_roc_wÜk
(
loÿl
, 
sd©a
, 
·¿ms
->
chª
,

992 
·¿ms
->
wa™
, 
cook›
, 
skb
,

993 
IEEE80211_ROC_TYPE_MGMT_TX
);

994 ià(
»t
)

995 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

996 
out_uÆock
:

997  
»t
;

998 
	}
}

1000 
	$›“80211_mgmt_tx_ÿnûl_wa™
(
why
 *wiphy,

1001 
wœ–ess_dev
 *
wdev
, 
u64
 
cook›
)

1003 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

1005  
	`›“80211_ÿnûl_roc
(
loÿl
, 
cook›
, 
Œue
);

1006 
	}
}

1008 
	$›“80211_roc_£tup
(
›“80211_loÿl
 *
loÿl
)

1010 
	`why_wÜk_š™
(&
loÿl
->
hw_roc_¡¬t
, 
›“80211_hw_roc_¡¬t
);

1011 
	`why_wÜk_š™
(&
loÿl
->
hw_roc_dÚe
, 
›“80211_hw_roc_dÚe
);

1012 
	`why_d–ayed_wÜk_š™
(&
loÿl
->
roc_wÜk
, 
›“80211_roc_wÜk
);

1013 
	`INIT_LIST_HEAD
(&
loÿl
->
roc_li¡
);

1014 
	}
}

1016 
	$›“80211_roc_purge
(
›“80211_loÿl
 *
loÿl
,

1017 
›“80211_sub_if_d©a
 *
sd©a
)

1019 
›“80211_roc_wÜk
 *
roc
, *
tmp
;

1020 
boŞ
 
wÜk_to_do
 = 
çl£
;

1022 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1024 
	`li¡_fÜ_—ch_’Œy_§ã
(
roc
, 
tmp
, &
loÿl
->
roc_li¡
, 
li¡
) {

1025 ià(
sd©a
 && 
roc
->sdata != sdata)

1028 ià(
roc
->
¡¬‹d
) {

1029 ià(
loÿl
->
İs
->
»maš_Ú_chªÃl
) {

1031 
	`drv_ÿnûl_»maš_Ú_chªÃl
(
loÿl
, 
roc
->
sd©a
);

1032 
	`›“80211_roc_nÙify_de¡roy
(
roc
);

1034 
roc
->
abÜt
 = 
Œue
;

1035 
wÜk_to_do
 = 
Œue
;

1038 
	`›“80211_roc_nÙify_de¡roy
(
roc
);

1041 ià(
wÜk_to_do
)

1042 
	`__›“80211_roc_wÜk
(
loÿl
);

1043 
	}
}

	@parse.c

14 
	~<Ãt/mac80211.h
>

15 
	~<lšux/Ãtdeviû.h
>

16 
	~<lšux/expÜt.h
>

17 
	~<lšux/ty³s.h
>

18 
	~<lšux/¦ab.h
>

19 
	~<lšux/skbuff.h
>

20 
	~<lšux/‘h”deviû.h
>

21 
	~<lšux/if_¬p.h
>

22 
	~<lšux/b™m­.h
>

23 
	~<lšux/üc32.h
>

24 
	~<Ãt/Ãt_Çme¥aû.h
>

25 
	~<Ãt/cfg80211.h
>

26 
	~<Ãt/¹Ãšk.h
>

27 
	~<kun™/visib™y.h
>

29 
	~"›“80211_i.h
"

30 
	~"driv”-İs.h
"

31 
	~"¿‹.h
"

32 
	~"mesh.h
"

33 
	~"wme.h
"

34 
	~"Ëd.h
"

35 
	~"w•.h
"

37 
	s›“80211_–ems_·r£
 {

39 
›“802_11_–ems
 
	m–ems
;

42 cÚ¡ 
–em’t
 *
	mml_basic_–em
;

45 cÚ¡ 
–em’t
 *
	mml_»cÚf_–em
;

51 
size_t
 
	msü©ch_Ën
;

52 
u8
 *
	msü©ch_pos
;

53 
u8
 
	msü©ch
[] 
__couÁed_by
(
sü©ch_Ën
);

57 
	$›“80211_·r£_ex‹nsiÚ_–em’t
(
u32
 *
üc
,

58 cÚ¡ 
–em’t
 *
–em
,

59 
›“80211_–ems_·r£
 *
–ems_·r£
,

60 
›“80211_–ems_·r£_·¿ms
 *
·¿ms
)

62 
›“802_11_–ems
 *
–ems
 = &
–ems_·r£
->elems;

63 cÚ¡ *
d©a
 = 
–em
->data + 1;

64 
boŞ
 
ÿlc_üc
 = 
çl£
;

65 
u8
 
Ën
;

67 ià(!
–em
->
d©®’
)

70 
Ën
 = 
–em
->
d©®’
 - 1;

72 
–em
->
d©a
[0]) {

73 
WLAN_EID_EXT_HE_MU_EDCA
:

74 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

76 
ÿlc_üc
 = 
Œue
;

77 ià(
Ën
 >ğ(*
–ems
->
mu_edÿ_·¿m_£t
))

78 
–ems
->
mu_edÿ_·¿m_£t
 = 
d©a
;

80 
WLAN_EID_EXT_HE_CAPABILITY
:

81 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

83 ià(
	`›“80211_he_ÿ·_size_ok
(
d©a
, 
Ën
)) {

84 
–ems
->
he_ÿp
 = 
d©a
;

85 
–ems
->
he_ÿp_Ën
 = 
Ën
;

88 
WLAN_EID_EXT_HE_OPERATION
:

89 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

91 
ÿlc_üc
 = 
Œue
;

92 ià(
Ën
 >ğ(*
–ems
->
he_İ”©iÚ
) &&

93 
Ën
 >ğ
	`›“80211_he_İ”_size
(
d©a
) - 1)

94 
–ems
->
he_İ”©iÚ
 = 
d©a
;

96 
WLAN_EID_EXT_UORA
:

97 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

99 ià(
Ën
 >= 1)

100 
–ems
->
uÜa_–em’t
 = 
d©a
;

102 
WLAN_EID_EXT_MAX_CHANNEL_SWITCH_TIME
:

103 ià(
Ën
 == 3)

104 
–ems
->
max_chªÃl_sw™ch_time
 = 
d©a
;

106 
WLAN_EID_EXT_MULTIPLE_BSSID_CONFIGURATION
:

107 ià(
Ën
 >ğ(*
–ems
->
mbssid_cÚfig_›
))

108 
–ems
->
mbssid_cÚfig_›
 = 
d©a
;

110 
WLAN_EID_EXT_HE_SPR
:

111 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

113 ià(
Ën
 >ğ(*
–ems
->
he_¥r
) &&

114 
Ën
 >ğ
	`›“80211_he_¥r_size
(
d©a
))

115 
–ems
->
he_¥r
 = 
d©a
;

117 
WLAN_EID_EXT_HE_6GHZ_CAPA
:

118 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HE
)

120 ià(
Ën
 >ğ(*
–ems
->
he_6ghz_ÿ·
))

121 
–ems
->
he_6ghz_ÿ·
 = 
d©a
;

123 
WLAN_EID_EXT_EHT_CAPABILITY
:

124 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

126 ià(
	`›“80211_eht_ÿ·_size_ok
(
–ems
->
he_ÿp
,

127 
d©a
, 
Ën
,

128 
·¿ms
->
äom_­
)) {

129 
–ems
->
eht_ÿp
 = 
d©a
;

130 
–ems
->
eht_ÿp_Ën
 = 
Ën
;

133 
WLAN_EID_EXT_EHT_OPERATION
:

134 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

136 ià(
	`›“80211_eht_İ”_size_ok
(
d©a
, 
Ën
))

137 
–ems
->
eht_İ”©iÚ
 = 
d©a
;

138 
ÿlc_üc
 = 
Œue
;

140 
WLAN_EID_EXT_EHT_MULTI_LINK
:

141 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

143 
ÿlc_üc
 = 
Œue
;

145 ià(
	`›“80211_mË_size_ok
(
d©a
, 
Ën
)) {

146 cÚ¡ 
›“80211_muÉi_lšk_–em
 *
mË
 =

147 (*)
d©a
;

149 
	`Ë16_g‘_b™s
(
mË
->
cÚŒŞ
,

150 
IEEE80211_ML_CONTROL_TYPE
)) {

151 
IEEE80211_ML_CONTROL_TYPE_BASIC
:

152 ià(
–ems_·r£
->
ml_basic_–em
) {

153 
–ems
->
·r£_”rÜ
 |=

154 
IEEE80211_PARSE_ERR_DUP_NEST_ML_BASIC
;

157 
–ems_·r£
->
ml_basic_–em
 = 
–em
;

159 
IEEE80211_ML_CONTROL_TYPE_RECONF
:

160 
–ems_·r£
->
ml_»cÚf_–em
 = 
–em
;

167 
WLAN_EID_EXT_BANDWIDTH_INDICATION
:

168 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

170 ià(
	`›“80211_bªdwidth_šdiÿtiÚ_size_ok
(
d©a
, 
Ën
))

171 
–ems
->
bªdwidth_šdiÿtiÚ
 = 
d©a
;

172 
ÿlc_üc
 = 
Œue
;

174 
WLAN_EID_EXT_TID_TO_LINK_MAPPING
:

175 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

177 
ÿlc_üc
 = 
Œue
;

178 ià(
	`›“80211_tid_to_lšk_m­_size_ok
(
d©a
, 
Ën
) &&

179 
–ems
->
‰lm_num
 < 
	`ARRAY_SIZE
ÓËms->
‰lm
)) {

180 
–ems
->
‰lm
[–ems->
‰lm_num
] = (*)
d©a
;

181 
–ems
->
‰lm_num
++;

186 ià(
üc
 && 
ÿlc_üc
)

187 *
üc
 = 
	`üc32_be
(*üc, (*)
–em
,ƒËm->
d©®’
 + 2);

188 
	}
}

190 
u32


191 
	$_›“802_11_·r£_–ems_fuÎ
(
›“80211_–ems_·r£_·¿ms
 *
·¿ms
,

192 
›“80211_–ems_·r£
 *
–ems_·r£
,

193 cÚ¡ 
–em’t
 *
check_šh”™
)

195 
›“802_11_–ems
 *
–ems
 = &
–ems_·r£
->elems;

196 cÚ¡ 
–em’t
 *
–em
;

197 
boŞ
 
ÿlc_üc
 = 
·¿ms
->
f‹r
 != 0;

198 
	`DECLARE_BITMAP
(
£’_–ems
, 256);

199 
u32
 
üc
 = 
·¿ms
->crc;

201 
	`b™m­_z”o
(
£’_–ems
, 256);

203 
	`fÜ_—ch_–em’t
(
–em
, 
·¿ms
->
¡¬t
,…¬ams->
Ën
) {

204 cÚ¡ 
–em’t
 *
sub–em
;

205 
u8
 
–em_·r£_çed
;

206 
u8
 
id
 = 
–em
->id;

207 
u8
 
–’
 = 
–em
->
d©®’
;

208 cÚ¡ 
u8
 *
pos
 = 
–em
->
d©a
;

210 ià(
check_šh”™
 &&

211 !
	`cfg80211_is_–em’t_šh”™ed
(
–em
,

212 
check_šh”™
))

215 
id
) {

216 
WLAN_EID_SSID
:

217 
WLAN_EID_SUPP_RATES
:

218 
WLAN_EID_FH_PARAMS
:

219 
WLAN_EID_DS_PARAMS
:

220 
WLAN_EID_CF_PARAMS
:

221 
WLAN_EID_TIM
:

222 
WLAN_EID_IBSS_PARAMS
:

223 
WLAN_EID_CHALLENGE
:

224 
WLAN_EID_RSN
:

225 
WLAN_EID_ERP_INFO
:

226 
WLAN_EID_EXT_SUPP_RATES
:

227 
WLAN_EID_HT_CAPABILITY
:

228 
WLAN_EID_HT_OPERATION
:

229 
WLAN_EID_VHT_CAPABILITY
:

230 
WLAN_EID_VHT_OPERATION
:

231 
WLAN_EID_MESH_ID
:

232 
WLAN_EID_MESH_CONFIG
:

233 
WLAN_EID_PEER_MGMT
:

234 
WLAN_EID_PREQ
:

235 
WLAN_EID_PREP
:

236 
WLAN_EID_PERR
:

237 
WLAN_EID_RANN
:

238 
WLAN_EID_CHANNEL_SWITCH
:

239 
WLAN_EID_EXT_CHANSWITCH_ANN
:

240 
WLAN_EID_COUNTRY
:

241 
WLAN_EID_PWR_CONSTRAINT
:

242 
WLAN_EID_TIMEOUT_INTERVAL
:

243 
WLAN_EID_SECONDARY_CHANNEL_OFFSET
:

244 
WLAN_EID_WIDE_BW_CHANNEL_SWITCH
:

245 
WLAN_EID_CHAN_SWITCH_PARAM
:

246 
WLAN_EID_EXT_CAPABILITY
:

247 
WLAN_EID_CHAN_SWITCH_TIMING
:

248 
WLAN_EID_LINK_ID
:

249 
WLAN_EID_BSS_MAX_IDLE_PERIOD
:

250 
WLAN_EID_RSNX
:

251 
WLAN_EID_S1G_BCN_COMPAT
:

252 
WLAN_EID_S1G_CAPABILITIES
:

253 
WLAN_EID_S1G_OPERATION
:

254 
WLAN_EID_AID_RESPONSE
:

255 
WLAN_EID_S1G_SHORT_BCN_INTERVAL
:

260 ià(
	`‹¡_b™
(
id
, 
£’_–ems
)) {

261 
–ems
->
·r£_”rÜ
 |=

262 
IEEE80211_PARSE_ERR_DUP_ELEM
;

268 ià(
ÿlc_üc
 && 
id
 < 64 && (
·¿ms
->
f‹r
 & (1ULL << id)))

269 
üc
 = 
	`üc32_be
(üc, 
pos
 - 2, 
–’
 + 2);

271 
–em_·r£_çed
 = 0;

273 
id
) {

274 
WLAN_EID_LINK_ID
:

275 ià(
–’
 + 2 < (
›“80211_tdls_Êk›
)) {

276 
–em_·r£_çed
 =

277 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

280 
–ems
->
Êk_id
 = (*)(
pos
 - 2);

282 
WLAN_EID_CHAN_SWITCH_TIMING
:

283 ià(
–’
 < (
›“80211_ch_sw™ch_timšg
)) {

284 
–em_·r£_çed
 =

285 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

288 
–ems
->
ch_sw_timšg
 = (*)
pos
;

290 
WLAN_EID_EXT_CAPABILITY
:

291 
–ems
->
ext_ÿ·b
 = 
pos
;

292 
–ems
->
ext_ÿ·b_Ën
 = 
–’
;

294 
WLAN_EID_SSID
:

295 
–ems
->
ssid
 = 
pos
;

296 
–ems
->
ssid_Ën
 = 
–’
;

298 
WLAN_EID_SUPP_RATES
:

299 
–ems
->
suµ_¿‹s
 = 
pos
;

300 
–ems
->
suµ_¿‹s_Ën
 = 
–’
;

302 
WLAN_EID_DS_PARAMS
:

303 ià(
–’
 >= 1)

304 
–ems
->
ds_·¿ms
 = 
pos
;

306 
–em_·r£_çed
 =

307 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

309 
WLAN_EID_TIM
:

310 ià(
–’
 >ğ(
›“80211_tim_›
)) {

311 
–ems
->
tim
 = (*)
pos
;

312 
–ems
->
tim_Ën
 = 
–’
;

314 
–em_·r£_çed
 =

315 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

317 
WLAN_EID_VENDOR_SPECIFIC
:

318 ià(
–’
 >ğ4 && 
pos
[0] == 0x00 &&…os[1] == 0x50 &&

319 
pos
[2] == 0xf2) {

322 ià(
ÿlc_üc
)

323 
üc
 = 
	`üc32_be
(üc, 
pos
 - 2, 
–’
 + 2);

325 ià(
–’
 >ğ5 && 
pos
[3] == 2) {

327 ià(
pos
[4] == 0) {

328 
–ems
->
wmm_šfo
 = 
pos
;

329 
–ems
->
wmm_šfo_Ën
 = 
–’
;

330 } ià(
pos
[4] == 1) {

331 
–ems
->
wmm_·¿m
 = 
pos
;

332 
–ems
->
wmm_·¿m_Ën
 = 
–’
;

337 
WLAN_EID_RSN
:

338 
–ems
->
r¢
 = 
pos
;

339 
–ems
->
r¢_Ën
 = 
–’
;

341 
WLAN_EID_ERP_INFO
:

342 ià(
–’
 >= 1)

343 
–ems
->
”p_šfo
 = 
pos
;

345 
–em_·r£_çed
 =

346 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

348 
WLAN_EID_EXT_SUPP_RATES
:

349 
–ems
->
ext_suµ_¿‹s
 = 
pos
;

350 
–ems
->
ext_suµ_¿‹s_Ën
 = 
–’
;

352 
WLAN_EID_HT_CAPABILITY
:

353 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HT
)

355 ià(
–’
 >ğ(
›“80211_ht_ÿp
))

356 
–ems
->
ht_ÿp_–em
 = (*)
pos
;

358 
–em_·r£_çed
 =

359 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

361 
WLAN_EID_HT_OPERATION
:

362 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HT
)

364 ià(
–’
 >ğ(
›“80211_ht_İ”©iÚ
))

365 
–ems
->
ht_İ”©iÚ
 = (*)
pos
;

367 
–em_·r£_çed
 =

368 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

370 
WLAN_EID_VHT_CAPABILITY
:

371 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

373 ià(
–’
 >ğ(
›“80211_vht_ÿp
))

374 
–ems
->
vht_ÿp_–em
 = (*)
pos
;

376 
–em_·r£_çed
 =

377 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

379 
WLAN_EID_VHT_OPERATION
:

380 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

382 ià(
–’
 >ğ(
›“80211_vht_İ”©iÚ
)) {

383 
–ems
->
vht_İ”©iÚ
 = (*)
pos
;

384 ià(
ÿlc_üc
)

385 
üc
 = 
	`üc32_be
(üc, 
pos
 - 2, 
–’
 + 2);

388 
–em_·r£_çed
 =

389 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

391 
WLAN_EID_OPMODE_NOTIF
:

392 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

394 ià(
–’
 > 0) {

395 
–ems
->
İmode_nÙif
 = 
pos
;

396 ià(
ÿlc_üc
)

397 
üc
 = 
	`üc32_be
(üc, 
pos
 - 2, 
–’
 + 2);

400 
–em_·r£_çed
 =

401 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

403 
WLAN_EID_MESH_ID
:

404 
–ems
->
mesh_id
 = 
pos
;

405 
–ems
->
mesh_id_Ën
 = 
–’
;

407 
WLAN_EID_MESH_CONFIG
:

408 ià(
–’
 >ğ(
›“80211_meshcÚf_›
))

409 
–ems
->
mesh_cÚfig
 = (*)
pos
;

411 
–em_·r£_çed
 =

412 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

414 
WLAN_EID_PEER_MGMT
:

415 
–ems
->
³”šg
 = 
pos
;

416 
–ems
->
³”šg_Ën
 = 
–’
;

418 
WLAN_EID_MESH_AWAKE_WINDOW
:

419 ià(
–’
 >= 2)

420 
–ems
->
awake_wšdow
 = (*)
pos
;

422 
WLAN_EID_PREQ
:

423 
–ems
->
´eq
 = 
pos
;

424 
–ems
->
´eq_Ën
 = 
–’
;

426 
WLAN_EID_PREP
:

427 
–ems
->
´•
 = 
pos
;

428 
–ems
->
´•_Ën
 = 
–’
;

430 
WLAN_EID_PERR
:

431 
–ems
->
³¼
 = 
pos
;

432 
–ems
->
³¼_Ën
 = 
–’
;

434 
WLAN_EID_RANN
:

435 ià(
–’
 >ğ(
›“80211_¿Â_›
))

436 
–ems
->
¿Â
 = (*)
pos
;

438 
–em_·r£_çed
 =

439 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

441 
WLAN_EID_CHANNEL_SWITCH
:

442 ià(
–’
 !ğ(
›“80211_chªÃl_sw_›
)) {

443 
–em_·r£_çed
 =

444 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

447 
–ems
->
ch_sw™ch_›
 = (*)
pos
;

449 
WLAN_EID_EXT_CHANSWITCH_ANN
:

450 ià(
–’
 !ğ(
›“80211_ext_chªsw_›
)) {

451 
–em_·r£_çed
 =

452 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

455 
–ems
->
ext_chªsw_›
 = (*)
pos
;

457 
WLAN_EID_SECONDARY_CHANNEL_OFFSET
:

458 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_HT
)

460 ià(
–’
 !ğ(
›“80211_£c_chª_offs_›
)) {

461 
–em_·r£_çed
 =

462 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

465 
–ems
->
£c_chª_offs
 = (*)
pos
;

467 
WLAN_EID_CHAN_SWITCH_PARAM
:

468 ià(
–’
 <

469 (*
–ems
->
mesh_chªsw_·¿ms_›
)) {

470 
–em_·r£_çed
 =

471 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

474 
–ems
->
mesh_chªsw_·¿ms_›
 = (*)
pos
;

476 
WLAN_EID_WIDE_BW_CHANNEL_SWITCH
:

477 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

480 ià(!
·¿ms
->
aùiÚ
) {

481 
–em_·r£_çed
 =

482 
IEEE80211_PARSE_ERR_UNEXPECTED_ELEM
;

486 ià(
–’
 < (*
–ems
->
wide_bw_chªsw_›
)) {

487 
–em_·r£_çed
 =

488 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

491 
–ems
->
wide_bw_chªsw_›
 = (*)
pos
;

493 
WLAN_EID_CHANNEL_SWITCH_WRAPPER
:

494 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

496 ià(
·¿ms
->
aùiÚ
) {

497 
–em_·r£_çed
 =

498 
IEEE80211_PARSE_ERR_UNEXPECTED_ELEM
;

505 
sub–em
 = 
	`cfg80211_fšd_–em
(
WLAN_EID_WIDE_BW_CHANNEL_SWITCH
,

506 
pos
, 
–’
);

507 ià(
sub–em
) {

508 ià(
sub–em
->
d©®’
 >ğ(*
–ems
->
wide_bw_chªsw_›
))

509 
–ems
->
wide_bw_chªsw_›
 =

510 (*)
sub–em
->
d©a
;

512 
–em_·r£_çed
 =

513 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

516 ià(
·¿ms
->
mode
 < 
IEEE80211_CONN_MODE_EHT
)

519 
sub–em
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_BANDWIDTH_INDICATION
,

520 
pos
, 
–’
);

521 ià(
sub–em
) {

522 cÚ¡ *
ed©a
 = 
sub–em
->
d©a
 + 1;

523 
u8
 
ed©®’
 = 
sub–em
->
d©®’
 - 1;

525 ià(
	`›“80211_bªdwidth_šdiÿtiÚ_size_ok
(
ed©a
,

526 
ed©®’
))

527 
–ems
->
bªdwidth_šdiÿtiÚ
 = 
ed©a
;

529 
–em_·r£_çed
 =

530 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

533 
WLAN_EID_COUNTRY
:

534 
–ems
->
couÁry_–em
 = 
pos
;

535 
–ems
->
couÁry_–em_Ën
 = 
–’
;

537 
WLAN_EID_PWR_CONSTRAINT
:

538 ià(
–’
 != 1) {

539 
–em_·r£_çed
 =

540 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

543 
–ems
->
pwr_cÚ¡r_–em
 = 
pos
;

545 
WLAN_EID_CISCO_VENDOR_SPECIFIC
:

551 ià(
–’
 < 4) {

552 
–em_·r£_çed
 =

553 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

557 ià(
pos
[0] != 0x00 ||…os[1] != 0x40 ||

558 
pos
[2] != 0x96 ||…os[3] != 0x00)

561 ià(
–’
 != 6) {

562 
–em_·r£_çed
 =

563 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

567 ià(
ÿlc_üc
)

568 
üc
 = 
	`üc32_be
(üc, 
pos
 - 2, 
–’
 + 2);

570 
–ems
->
cisco_dc_–em
 = 
pos
;

572 
WLAN_EID_ADDBA_EXT
:

573 ià(
–’
 < (
›“80211_addba_ext_›
)) {

574 
–em_·r£_çed
 =

575 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

578 
–ems
->
addba_ext_›
 = (*)
pos
;

580 
WLAN_EID_TIMEOUT_INTERVAL
:

581 ià(
–’
 >ğ(
›“80211_timeout_š‹rv®_›
))

582 
–ems
->
timeout_št
 = (*)
pos
;

584 
–em_·r£_çed
 =

585 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

587 
WLAN_EID_BSS_MAX_IDLE_PERIOD
:

588 ià(
–’
 >ğ(*
–ems
->
max_idË_³riod_›
))

589 
–ems
->
max_idË_³riod_›
 = (*)
pos
;

591 
WLAN_EID_RSNX
:

592 
–ems
->
r¢x
 = 
pos
;

593 
–ems
->
r¢x_Ën
 = 
–’
;

595 
WLAN_EID_TX_POWER_ENVELOPE
:

596 ià(
–’
 < 1 ||

597 
–’
 > (
›“80211_tx_pwr_’v
))

600 ià(
–ems
->
tx_pwr_’v_num
 >ğ
	`ARRAY_SIZE
ÓËms->
tx_pwr_’v
))

603 
–ems
->
tx_pwr_’v
[–ems->
tx_pwr_’v_num
] = (*)
pos
;

604 
–ems
->
tx_pwr_’v_Ën
[–ems->
tx_pwr_’v_num
] = 
–’
;

605 
–ems
->
tx_pwr_’v_num
++;

607 
WLAN_EID_EXTENSION
:

608 
	`›“80211_·r£_ex‹nsiÚ_–em’t
(
ÿlc_üc
 ?

609 &
üc
 : 
NULL
,

610 
–em
, 
–ems_·r£
,

611 
·¿ms
);

613 
WLAN_EID_S1G_CAPABILITIES
:

614 ià(
·¿ms
->
mode
 !ğ
IEEE80211_CONN_MODE_S1G
)

616 ià(
–’
 >ğ(*
–ems
->
s1g_ÿ·b
))

617 
–ems
->
s1g_ÿ·b
 = (*)
pos
;

619 
–em_·r£_çed
 =

620 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

622 
WLAN_EID_S1G_OPERATION
:

623 ià(
·¿ms
->
mode
 !ğ
IEEE80211_CONN_MODE_S1G
)

625 ià(
–’
 =ğ(*
–ems
->
s1g_İ”
))

626 
–ems
->
s1g_İ”
 = (*)
pos
;

628 
–em_·r£_çed
 =

629 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

631 
WLAN_EID_S1G_BCN_COMPAT
:

632 ià(
·¿ms
->
mode
 !ğ
IEEE80211_CONN_MODE_S1G
)

634 ià(
–’
 =ğ(*
–ems
->
s1g_bú_com·t
))

635 
–ems
->
s1g_bú_com·t
 = (*)
pos
;

637 
–em_·r£_çed
 =

638 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

640 
WLAN_EID_AID_RESPONSE
:

641 ià(
·¿ms
->
mode
 !ğ
IEEE80211_CONN_MODE_S1G
)

643 ià(
–’
 =ğ(
›“80211_aid_»¥Ú£_›
))

644 
–ems
->
aid_»¥
 = (*)
pos
;

646 
–em_·r£_çed
 =

647 
IEEE80211_PARSE_ERR_BAD_ELEM_SIZE
;

653 ià(
–em_·r£_çed
)

654 
–ems
->
·r£_”rÜ
 |ğ
–em_·r£_çed
;

656 
	`__£t_b™
(
id
, 
£’_–ems
);

659 ià(!
	`fÜ_—ch_–em’t_com¶‘ed
(
–em
, 
·¿ms
->
¡¬t
,…¬ams->
Ën
))

660 
–ems
->
·r£_”rÜ
 |ğ
IEEE80211_PARSE_ERR_INVALID_END
;

662  
üc
;

663 
	}
}

665 
size_t
 
	$›“802_11_fšd_bssid_´ofe
(cÚ¡ 
u8
 *
¡¬t
, 
size_t
 
Ën
,

666 
›“802_11_–ems
 *
–ems
,

667 
cfg80211_bss
 *
bss
,

668 
u8
 *
nÚŒªsm™‹d_´ofe
)

670 cÚ¡ 
–em’t
 *
–em
, *
sub
;

671 
size_t
 
´ofe_Ën
 = 0;

672 
boŞ
 
found
 = 
çl£
;

674 ià(!
bss
 || !bss->
Œªsm™‹d_bss
)

675  
´ofe_Ën
;

677 
	`fÜ_—ch_–em’t_id
(
–em
, 
WLAN_EID_MULTIPLE_BSSID
, 
¡¬t
, 
Ën
) {

678 ià(
–em
->
d©®’
 < 2)

680 ià(
–em
->
d©a
[0] < 1 ||ƒlem->data[0] > 8)

683 
	`fÜ_—ch_–em’t
(
sub
, 
–em
->
d©a
 + 1,ƒËm->
d©®’
 - 1) {

684 
u8
 
Ãw_bssid
[
ETH_ALEN
];

685 cÚ¡ 
u8
 *
šdex
;

687 ià(
sub
->
id
 !ğ0 || sub->
d©®’
 < 4) {

692 ià(
sub
->
d©a
[0] !ğ
WLAN_EID_NON_TX_BSSID_CAP
 ||

693 
sub
->
d©a
[1] != 2) {

702 
	`mem£t
(
nÚŒªsm™‹d_´ofe
, 0, 
Ën
);

703 
´ofe_Ën
 = 
	`cfg80211_m”ge_´ofe
(
¡¬t
, 
Ën
,

704 
–em
,

705 
sub
,

706 
nÚŒªsm™‹d_´ofe
,

707 
Ën
);

710 
šdex
 = 
	`cfg80211_fšd_›
(
WLAN_EID_MULTI_BSSID_IDX
,

711 
nÚŒªsm™‹d_´ofe
,

712 
´ofe_Ën
);

713 ià(!
šdex
 || index[1] < 1 || index[2] == 0) {

718 
	`cfg80211_g’_Ãw_bssid
(
bss
->
Œªsm™‹d_bss
->
bssid
,

719 
–em
->
d©a
[0],

720 
šdex
[2],

721 
Ãw_bssid
);

722 ià(
	`‘h”_addr_equ®
(
Ãw_bssid
, 
bss
->
bssid
)) {

723 
found
 = 
Œue
;

724 
–ems
->
bssid_šdex_Ën
 = 
šdex
[1];

725 
–ems
->
bssid_šdex
 = (*)&
šdex
[2];

731  
found
 ? 
´ofe_Ën
 : 0;

732 
	}
}

735 
	$›“80211_mË_g‘_¡a_´of
(
›“80211_–ems_·r£
 *
–ems_·r£
,

736 
u8
 
lšk_id
)

738 
›“802_11_–ems
 *
–ems
 = &
–ems_·r£
->elems;

739 cÚ¡ 
›“80211_muÉi_lšk_–em
 *
ml
 = 
–ems
->
ml_basic
;

740 
ssize_t
 
ml_Ën
 = 
–ems
->
ml_basic_Ën
;

741 cÚ¡ 
–em’t
 *
sub
;

743 
	`fÜ_—ch_mË_sub–em’t
(
sub
, (
u8
 *)
ml
, 
ml_Ën
) {

744 
›“80211_mË_³r_¡a_´ofe
 *
´of
 = (*)
sub
->
d©a
;

745 
ssize_t
 
¡a_´of_Ën
;

746 
u16
 
cÚŒŞ
;

748 ià(
sub
->
id
 !ğ
IEEE80211_MLE_SUBELEM_PER_STA_PROFILE
)

751 ià(!
	`›“80211_mË_basic_¡a_´of_size_ok
(
sub
->
d©a
,

752 
sub
->
d©®’
))

755 
cÚŒŞ
 = 
	`Ë16_to_ıu
(
´of
->control);

757 ià(
lšk_id
 !ğ
	`u16_g‘_b™s
(
cÚŒŞ
,

758 
IEEE80211_MLE_STA_CONTROL_LINK_ID
))

761 ià(!(
cÚŒŞ
 & 
IEEE80211_MLE_STA_CONTROL_COMPLETE_PROFILE
))

765 
¡a_´of_Ën
 =

766 
	`cfg80211_deäagm’t_–em’t
(
sub
,

767 (
u8
 *)
ml
, 
ml_Ën
,

768 
–ems_·r£
->
sü©ch_pos
,

769 
–ems_·r£
->
sü©ch
 +

770 
–ems_·r£
->
sü©ch_Ën
 -

771 
–ems_·r£
->
sü©ch_pos
,

772 
IEEE80211_MLE_SUBELEM_FRAGMENT
);

774 ià(
¡a_´of_Ën
 < 0)

777 
–ems
->
´of
 = (*)
–ems_·r£
->
sü©ch_pos
;

778 
–ems
->
¡a_´of_Ën
 = sta_prof_len;

779 
–ems_·r£
->
sü©ch_pos
 +ğ
¡a_´of_Ën
;

783 
	}
}

785 
	$›“80211_mË_·r£_lšk
(
›“80211_–ems_·r£
 *
–ems_·r£
,

786 
›“80211_–ems_·r£_·¿ms
 *
·¿ms
)

788 
›“802_11_–ems
 *
–ems
 = &
–ems_·r£
->elems;

789 
›“80211_mË_³r_¡a_´ofe
 *
´of
;

790 
›“80211_–ems_·r£_·¿ms
 
sub
 = {

791 .
mode
 = 
·¿ms
->mode,

792 .
aùiÚ
 = 
·¿ms
->action,

793 .
äom_­
 = 
·¿ms
->from_ap,

794 .
lšk_id
 = -1,

796 
ssize_t
 
ml_Ën
 = 
–ems
->
ml_basic_Ën
;

797 cÚ¡ 
–em’t
 *
nÚ_šh”™
 = 
NULL
;

798 cÚ¡ 
u8
 *
’d
;

800 
ml_Ën
 = 
	`cfg80211_deäagm’t_–em’t
(
–ems_·r£
->
ml_basic_–em
,

801 
–ems
->
›_¡¬t
,

802 
–ems
->
tÙ®_Ën
,

803 
–ems_·r£
->
sü©ch_pos
,

804 
–ems_·r£
->
sü©ch
 +

805 
–ems_·r£
->
sü©ch_Ën
 -

806 
–ems_·r£
->
sü©ch_pos
,

807 
WLAN_EID_FRAGMENT
);

809 ià(
ml_Ën
 < 0)

812 
–ems
->
ml_basic
 = (cÚ¡ *)
–ems_·r£
->
sü©ch_pos
;

813 
–ems
->
ml_basic_Ën
 = 
ml_Ën
;

814 
–ems_·r£
->
sü©ch_pos
 +ğ
ml_Ën
;

816 ià(
·¿ms
->
lšk_id
 == -1)

819 
	`›“80211_mË_g‘_¡a_´of
(
–ems_·r£
, 
·¿ms
->
lšk_id
);

820 
´of
 = 
–ems
->prof;

822 ià(!
´of
)

826 ià(
–ems
->
¡a_´of_Ën
 < (*
´of
è+…rof->
¡a_šfo_Ën
 - 1 + 4) {

827 
–ems
->
´of
 = 
NULL
;

828 
–ems
->
¡a_´of_Ën
 = 0;

838 
sub
.
¡¬t
 = 
´of
->
v¬ŸbË
 +…rof->
¡a_šfo_Ën
 - 1 + 4;

839 
’d
 = (cÚ¡ 
u8
 *)
´of
 + 
–ems
->
¡a_´of_Ën
;

840 
sub
.
Ën
 = 
’d
 - sub.
¡¬t
;

842 
nÚ_šh”™
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_NON_INHERITANCE
,

843 
sub
.
¡¬t
, sub.
Ën
);

844 
	`_›“802_11_·r£_–ems_fuÎ
(&
sub
, 
–ems_·r£
, 
nÚ_šh”™
);

845 
	}
}

848 
	$›“80211_mË_deäag_»cÚf
(
›“80211_–ems_·r£
 *
–ems_·r£
)

850 
›“802_11_–ems
 *
–ems
 = &
–ems_·r£
->elems;

851 
ssize_t
 
ml_Ën
;

853 
ml_Ën
 = 
	`cfg80211_deäagm’t_–em’t
(
–ems_·r£
->
ml_»cÚf_–em
,

854 
–ems
->
›_¡¬t
,

855 
–ems
->
tÙ®_Ën
,

856 
–ems_·r£
->
sü©ch_pos
,

857 
–ems_·r£
->
sü©ch
 +

858 
–ems_·r£
->
sü©ch_Ën
 -

859 
–ems_·r£
->
sü©ch_pos
,

860 
WLAN_EID_FRAGMENT
);

861 ià(
ml_Ën
 < 0)

863 
–ems
->
ml_»cÚf
 = (*)
–ems_·r£
->
sü©ch_pos
;

864 
–ems
->
ml_»cÚf_Ën
 = 
ml_Ën
;

865 
–ems_·r£
->
sü©ch_pos
 +ğ
ml_Ën
;

866 
	}
}

868 
›“802_11_–ems
 *

869 
	$›“802_11_·r£_–ems_fuÎ
(
›“80211_–ems_·r£_·¿ms
 *
·¿ms
)

871 
›“80211_–ems_·r£
 *
–ems_·r£
;

872 
›“802_11_–ems
 *
–ems
;

873 cÚ¡ 
–em’t
 *
nÚ_šh”™
 = 
NULL
;

874 
u8
 *
nÚŒªsm™‹d_´ofe
;

875 
nÚŒªsm™‹d_´ofe_Ën
 = 0;

876 
size_t
 
sü©ch_Ën
 = 3 * 
·¿ms
->
Ën
;

878 
	`BUILD_BUG_ON
(
	`off£tof
(
	`ty³of
(*
–ems_·r£
), 
–ems
) != 0);

880 
–ems_·r£
 = 
	`kz®loc
(
	`¡ruù_size
ÓËms_·r£, 
sü©ch
, 
sü©ch_Ën
),

881 
GFP_ATOMIC
);

882 ià(!
–ems_·r£
)

883  
NULL
;

885 
–ems_·r£
->
sü©ch_Ën
 = scratch_len;

886 
–ems_·r£
->
sü©ch_pos
 =ƒËms_·r£->
sü©ch
;

888 
–ems
 = &
–ems_·r£
->elems;

889 
–ems
->
›_¡¬t
 = 
·¿ms
->
¡¬t
;

890 
–ems
->
tÙ®_Ën
 = 
·¿ms
->
Ën
;

892 
nÚŒªsm™‹d_´ofe
 = 
–ems_·r£
->
sü©ch_pos
;

893 
nÚŒªsm™‹d_´ofe_Ën
 =

894 
	`›“802_11_fšd_bssid_´ofe
(
·¿ms
->
¡¬t
,…¬ams->
Ën
,

895 
–ems
, 
·¿ms
->
bss
,

896 
nÚŒªsm™‹d_´ofe
);

897 
–ems_·r£
->
sü©ch_pos
 +ğ
nÚŒªsm™‹d_´ofe_Ën
;

898 
nÚ_šh”™
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_NON_INHERITANCE
,

899 
nÚŒªsm™‹d_´ofe
,

900 
nÚŒªsm™‹d_´ofe_Ën
);

902 
–ems
->
üc
 = 
	`_›“802_11_·r£_–ems_fuÎ
(
·¿ms
, 
–ems_·r£
,

903 
nÚ_šh”™
);

906 ià(
nÚŒªsm™‹d_´ofe_Ën
) {

907 
›“80211_–ems_·r£_·¿ms
 
sub
 = {

908 .
mode
 = 
·¿ms
->mode,

909 .
¡¬t
 = 
nÚŒªsm™‹d_´ofe
,

910 .
Ën
 = 
nÚŒªsm™‹d_´ofe_Ën
,

911 .
aùiÚ
 = 
·¿ms
->action,

912 .
lšk_id
 = 
·¿ms
->link_id,

915 
	`_›“802_11_·r£_–ems_fuÎ
(&
sub
, 
–ems_·r£
, 
NULL
);

918 
	`›“80211_mË_·r£_lšk
(
–ems_·r£
, 
·¿ms
);

920 
	`›“80211_mË_deäag_»cÚf
(
–ems_·r£
);

922 ià(
–ems
->
tim
 && !–ems->
·r£_”rÜ
) {

923 cÚ¡ 
›“80211_tim_›
 *
tim_›
 = 
–ems
->
tim
;

925 
–ems
->
dtim_³riod
 = 
tim_›
->dtim_period;

926 
–ems
->
dtim_couÁ
 = 
tim_›
->dtim_count;

930 ià(
–ems
->
bssid_šdex
 &&

931 
–ems
->
bssid_šdex_Ën
 >=

932 
	`off£toãnd
(
›“80211_bssid_šdex
, 
dtim_³riod
))

933 
–ems
->
dtim_³riod
 =ƒËms->
bssid_šdex
->dtim_period;

935 ià(
–ems
->
bssid_šdex
 &&

936 
–ems
->
bssid_šdex_Ën
 >=

937 
	`off£toãnd
(
›“80211_bssid_šdex
, 
dtim_couÁ
))

938 
–ems
->
dtim_couÁ
 =ƒËms->
bssid_šdex
->dtim_count;

940  
–ems
;

941 
	}
}

942 
EXPORT_SYMBOL_IF_KUNIT
(
›“802_11_·r£_–ems_fuÎ
);

944 
	$›“80211_·r£_b™¿‹s
(
Æ80211_chª_width
 
width
,

945 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

946 cÚ¡ 
u8
 *
¤©es
, 
¤©es_Ën
, 
u32
 *
¿‹s
)

948 
u32
 
¿‹_æags
 = 
	`›“80211_chªwidth_¿‹_æags
(
width
);

949 
›“80211_¿‹
 *
br
;

950 
b¿‹
, 
¿‹
, 
i
, 
j
, 
couÁ
 = 0;

952 *
¿‹s
 = 0;

954 
i
 = 0; i < 
¤©es_Ën
; i++) {

955 
¿‹
 = 
¤©es
[
i
] & 0x7f;

957 
j
 = 0; j < 
sbªd
->
n_b™¿‹s
; j++) {

958 
br
 = &
sbªd
->
b™¿‹s
[
j
];

959 ià((
¿‹_æags
 & 
br
->
æags
) !=„ate_flags)

962 
b¿‹
 = 
	`DIV_ROUND_UP
(
br
->
b™¿‹
, 5);

963 ià(
b¿‹
 =ğ
¿‹
) {

964 *
¿‹s
 |ğ
	`BIT
(
j
);

965 
couÁ
++;

970  
couÁ
;

971 
	}
}

	@pm.c

6 
	~<Ãt/mac80211.h
>

7 
	~<Ãt/¹Ãšk.h
>

9 
	~"›“80211_i.h
"

10 
	~"mesh.h
"

11 
	~"driv”-İs.h
"

12 
	~"Ëd.h
"

14 
	$›“80211_sched_sÿn_ÿnûl
(
›“80211_loÿl
 *
loÿl
)

16 ià(
	`›“80211_»que¡_sched_sÿn_¡İ
(
loÿl
))

18 
	`cfg80211_sched_sÿn_¡İ³d_locked
(
loÿl
->
hw
.
why
, 0);

19 
	}
}

21 
	$__›“80211_su¥’d
(
›“80211_hw
 *
hw
, 
cfg80211_wowÏn
 *
wowÏn
)

23 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

24 
›“80211_sub_if_d©a
 *
sd©a
;

25 
¡a_šfo
 *
¡a
;

27 ià(!
loÿl
->
İ’_couÁ
)

28 
su¥’d
;

30 
loÿl
->
su¥’dšg
 = 
Œue
;

31 
	`mb
();

33 
	`›“80211_sÿn_ÿnûl
(
loÿl
);

35 
	`›“80211_dfs_ÿc_ÿnûl
(
loÿl
);

37 
	`›“80211_roc_purge
(
loÿl
, 
NULL
);

39 
	`›“80211_d–_vœtu®_mÚ™Ü
(
loÿl
);

41 ià(
	`›“80211_hw_check
(
hw
, 
AMPDU_AGGREGATION
) &&

42 !(
wowÏn
 && wowÏn->
ªy
)) {

43 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

44 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

45 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

46 
	`›“80211_¡a_‹¬_down_BA_£ssiÚs
(

47 
¡a
, 
AGG_STOP_LOCAL_REQUEST
);

52 ià(!(
wowÏn
 && wowÏn->
ªy
))

53 
	`›“80211_sched_sÿn_ÿnûl
(
loÿl
);

55 
	`›“80211_¡İ_queues_by_»asÚ
(
hw
,

56 
IEEE80211_MAX_QUEUE_MAP
,

57 
IEEE80211_QUEUE_STOP_REASON_SUSPEND
,

58 
çl£
);

61 
	`synchrÚize_Ãt
();

63 
	`›“80211_æush_queues
(
loÿl
, 
NULL
, 
Œue
);

65 
loÿl
->
qu›scšg
 = 
Œue
;

67 
	`mb
();

69 
	`æush_wÜkqueue
(
loÿl
->
wÜkqueue
);

72 
	`d–_tim”_sync
(&
loÿl
->
¡a_ş—nup
);

78 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
dyÇmic_ps_’abË_wÜk
);

79 
	`d–_tim”_sync
(&
loÿl
->
dyÇmic_ps_tim”
);

81 
loÿl
->
wowÏn
 = wowlan;

82 ià(
loÿl
->
wowÏn
) {

83 
”r
;

92 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

93 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

95 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

97 
	`›“80211_mgd_qu›sû
(
sd©a
);

107 ià(
sd©a
->
u
.
mgd
.
assocŸ‹d
 &&

108 
sd©a
->
u
.
mgd
.
pow”§ve
 &&

109 !(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
)) {

110 
loÿl
->
hw
.
cÚf
.
æags
 |ğ
IEEE80211_CONF_PS
;

111 
	`›“80211_hw_cÚfig
(
loÿl
,

112 
IEEE80211_CONF_CHANGE_PS
);

116 
”r
 = 
	`drv_su¥’d
(
loÿl
, 
wowÏn
);

117 ià(
”r
 < 0) {

118 
loÿl
->
qu›scšg
 = 
çl£
;

119 
loÿl
->
wowÏn
 = 
çl£
;

120 ià(
	`›“80211_hw_check
(
hw
, 
AMPDU_AGGREGATION
)) {

121 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

122 
	`li¡_fÜ_—ch_’Œy
(
¡a
,

123 &
loÿl
->
¡a_li¡
, 
li¡
) {

124 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

127 
	`›“80211_wake_queues_by_»asÚ
(
hw
,

128 
IEEE80211_MAX_QUEUE_MAP
,

129 
IEEE80211_QUEUE_STOP_REASON_SUSPEND
,

130 
çl£
);

131  
”r
;

132 } ià(
”r
 > 0) {

133 
	`WARN_ON
(
”r
 != 1);

137 
	`›“80211_wake_queues_by_»asÚ
(
hw
,

138 
IEEE80211_MAX_QUEUE_MAP
,

139 
IEEE80211_QUEUE_STOP_REASON_SUSPEND
,

140 
çl£
);

141  
”r
;

143 
su¥’d
;

148 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

149 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

151 
sd©a
->
vif
.
ty³
) {

152 
NL80211_IFTYPE_AP_VLAN
:

153 
NL80211_IFTYPE_MONITOR
:

155 
NL80211_IFTYPE_STATION
:

156 
	`›“80211_mgd_qu›sû
(
sd©a
);

162 
	`why_d–ayed_wÜk_æush
(
loÿl
->
hw
.
why
,

163 &
sd©a
->
dec_room_Ãeded_wk
);

164 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

171 
	`WARN_ON
(!
	`li¡_em±y
(&
loÿl
->
chªùx_li¡
));

174 
	`›“80211_¡İ_deviû
(
loÿl
);

176 
su¥’d
:

177 
loÿl
->
su¥’ded
 = 
Œue
;

179 
	`b¬r›r
();

180 
loÿl
->
qu›scšg
 = 
çl£
;

181 
loÿl
->
su¥’dšg
 = 
çl£
;

184 
	}
}

192 
	$›“80211_»pÜt_wowÏn_wakeup
(
›“80211_vif
 *
vif
,

193 
cfg80211_wowÏn_wakeup
 *
wakeup
,

194 
gå_t
 
gå
)

196 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

198 
	`cfg80211_»pÜt_wowÏn_wakeup
(&
sd©a
->
wdev
, 
wakeup
, 
gå
);

199 
	}
}

200 
EXPORT_SYMBOL
(
›“80211_»pÜt_wowÏn_wakeup
);

	@rate.c

10 
	~<lšux/k”Ãl.h
>

11 
	~<lšux/¹Ãšk.h
>

12 
	~<lšux/moduË.h
>

13 
	~<lšux/¦ab.h
>

14 
	~"¿‹.h
"

15 
	~"›“80211_i.h
"

16 
	~"debugfs.h
"

18 
	s¿‹_cÚŒŞ_®g
 {

19 
li¡_h—d
 
	mli¡
;

20 cÚ¡ 
¿‹_cÚŒŞ_İs
 *
	mİs
;

23 
LIST_HEAD
(
¿‹_ù¾_®gs
);

24 
DEFINE_MUTEX
(
¿‹_ù¾_mu‹x
);

26 *
	g›“80211_deçuÉ_rc_®go
 = 
CONFIG_MAC80211_RC_DEFAULT
;

27 
moduË_·¿m
(
›“80211_deçuÉ_rc_®go
, 
ch¬p
, 0644);

28 
MODULE_PARM_DESC
(
›“80211_deçuÉ_rc_®go
,

31 
	$¿‹_cÚŒŞ_¿‹_š™
(
¡a_šfo
 *
¡a
)

33 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

34 
¿‹_cÚŒŞ_»f
 *
»f
 = 
¡a
->
¿‹_ù¾
;

35 
›“80211_¡a
 *
i¡a
 = &
¡a
->sta;

36 *
´iv_¡a
 = 
¡a
->
¿‹_ù¾_´iv
;

37 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

38 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

40 
	`›“80211_¡a_š™_nss
(&
¡a
->
deæšk
);

42 ià(!
»f
)

45 
	`rcu_»ad_lock
();

47 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
¡a
->
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

48 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

49 
	`rcu_»ad_uÆock
();

53 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
chªùx_cÚf
->
def
.
chª
->
bªd
];

56 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

57 
	`›“80211_s1g_¡a_¿‹_š™
(
¡a
);

58 
	`rcu_»ad_uÆock
();

62 
	`¥š_lock_bh
(&
¡a
->
¿‹_ù¾_lock
);

63 
»f
->
İs
->
	`¿‹_š™
Ôef->
´iv
, 
sbªd
, &
chªùx_cÚf
->
def
, 
i¡a
,

64 
´iv_¡a
);

65 
	`¥š_uÆock_bh
(&
¡a
->
¿‹_ù¾_lock
);

66 
	`rcu_»ad_uÆock
();

67 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_RATE_CONTROL
);

68 
	}
}

70 
	$¿‹_cÚŒŞ_tx_¡©us
(
›“80211_loÿl
 *
loÿl
,

71 
›“80211_tx_¡©us
 *
¡
)

73 
¿‹_cÚŒŞ_»f
 *
»f
 = 
loÿl
->
¿‹_ù¾
;

74 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
¡
->sta, sta_info, sta);

75 *
´iv_¡a
 = 
¡a
->
¿‹_ù¾_´iv
;

76 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

78 ià(!
»f
 || !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_RATE_CONTROL
))

81 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
¡
->
šfo
->
bªd
];

83 
	`¥š_lock_bh
(&
¡a
->
¿‹_ù¾_lock
);

84 ià(
»f
->
İs
->
tx_¡©us_ext
)

85 
»f
->
İs
->
	`tx_¡©us_ext
Ôef->
´iv
, 
sbªd
, 
´iv_¡a
, 
¡
);

86 ià(
¡
->
skb
)

87 
»f
->
İs
->
	`tx_¡©us
Ôef->
´iv
, 
sbªd
, 
¡
->
¡a
, 
´iv_¡a
, st->
skb
);

89 
	`WARN_ON_ONCE
(1);

91 
	`¥š_uÆock_bh
(&
¡a
->
¿‹_ù¾_lock
);

92 
	}
}

94 
	$¿‹_cÚŒŞ_¿‹_upd©e
(
›“80211_loÿl
 *
loÿl
,

95 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

96 
¡a_šfo
 *
¡a
, 
lšk_id
,

97 
u32
 
chªged
)

99 
¿‹_cÚŒŞ_»f
 *
»f
 = 
loÿl
->
¿‹_ù¾
;

100 
›“80211_¡a
 *
i¡a
 = &
¡a
->sta;

101 *
´iv_¡a
 = 
¡a
->
¿‹_ù¾_´iv
;

102 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

104 
	`WARN_ON
(
lšk_id
 != 0);

106 ià(
»f
 &&„ef->
İs
->
¿‹_upd©e
) {

107 
	`rcu_»ad_lock
();

109 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
¡a
->
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

110 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

111 
	`rcu_»ad_uÆock
();

115 
	`¥š_lock_bh
(&
¡a
->
¿‹_ù¾_lock
);

116 
»f
->
İs
->
	`¿‹_upd©e
Ôef->
´iv
, 
sbªd
, &
chªùx_cÚf
->
def
,

117 
i¡a
, 
´iv_¡a
, 
chªged
);

118 
	`¥š_uÆock_bh
(&
¡a
->
¿‹_ù¾_lock
);

119 
	`rcu_»ad_uÆock
();

122 ià(
¡a
->
u¶ßded
)

123 
	`drv_¡a_rc_upd©e
(
loÿl
, 
¡a
->
sd©a
, &¡a->¡a, 
chªged
);

124 
	}
}

126 
	$›“80211_¿‹_cÚŒŞ_»gi¡”
(cÚ¡ 
¿‹_cÚŒŞ_İs
 *
İs
)

128 
¿‹_cÚŒŞ_®g
 *
®g
;

130 ià(!
İs
->
Çme
)

131  -
EINVAL
;

133 
	`mu‹x_lock
(&
¿‹_ù¾_mu‹x
);

134 
	`li¡_fÜ_—ch_’Œy
(
®g
, &
¿‹_ù¾_®gs
, 
li¡
) {

135 ià(!
	`¡rcmp
(
®g
->
İs
->
Çme
, ops->name)) {

137 
	`WARN_ON
(1);

138 
	`mu‹x_uÆock
(&
¿‹_ù¾_mu‹x
);

139  -
EALREADY
;

143 
®g
 = 
	`kz®loc
((*®g), 
GFP_KERNEL
);

144 ià(
®g
 =ğ
NULL
) {

145 
	`mu‹x_uÆock
(&
¿‹_ù¾_mu‹x
);

146  -
ENOMEM
;

148 
®g
->
İs
 = ops;

150 
	`li¡_add_
(&
®g
->
li¡
, &
¿‹_ù¾_®gs
);

151 
	`mu‹x_uÆock
(&
¿‹_ù¾_mu‹x
);

154 
	}
}

155 
EXPORT_SYMBOL
(
›“80211_¿‹_cÚŒŞ_»gi¡”
);

157 
	$›“80211_¿‹_cÚŒŞ_uÄegi¡”
(cÚ¡ 
¿‹_cÚŒŞ_İs
 *
İs
)

159 
¿‹_cÚŒŞ_®g
 *
®g
;

161 
	`mu‹x_lock
(&
¿‹_ù¾_mu‹x
);

162 
	`li¡_fÜ_—ch_’Œy
(
®g
, &
¿‹_ù¾_®gs
, 
li¡
) {

163 ià(
®g
->
İs
 == ops) {

164 
	`li¡_d–
(&
®g
->
li¡
);

165 
	`kä“
(
®g
);

169 
	`mu‹x_uÆock
(&
¿‹_ù¾_mu‹x
);

170 
	}
}

171 
EXPORT_SYMBOL
(
›“80211_¿‹_cÚŒŞ_uÄegi¡”
);

173 cÚ¡ 
¿‹_cÚŒŞ_İs
 *

174 
	$›“80211_Œy_¿‹_cÚŒŞ_İs_g‘
(cÚ¡ *
Çme
)

176 
¿‹_cÚŒŞ_®g
 *
®g
;

177 cÚ¡ 
¿‹_cÚŒŞ_İs
 *
İs
 = 
NULL
;

179 ià(!
Çme
)

180  
NULL
;

182 
	`mu‹x_lock
(&
¿‹_ù¾_mu‹x
);

183 
	`li¡_fÜ_—ch_’Œy
(
®g
, &
¿‹_ù¾_®gs
, 
li¡
) {

184 ià(!
	`¡rcmp
(
®g
->
İs
->
Çme
,‚ame)) {

185 
İs
 = 
®g
->ops;

189 
	`mu‹x_uÆock
(&
¿‹_ù¾_mu‹x
);

190  
İs
;

191 
	}
}

194 cÚ¡ 
¿‹_cÚŒŞ_İs
 *

195 
	$›“80211_¿‹_cÚŒŞ_İs_g‘
(cÚ¡ *
Çme
)

197 cÚ¡ 
¿‹_cÚŒŞ_İs
 *
İs
;

198 cÚ¡ *
®g_Çme
;

200 
	`k”Ãl_·¿m_lock
(
THIS_MODULE
);

201 ià(!
Çme
)

202 
®g_Çme
 = 
›“80211_deçuÉ_rc_®go
;

204 
®g_Çme
 = 
Çme
;

206 
İs
 = 
	`›“80211_Œy_¿‹_cÚŒŞ_İs_g‘
(
®g_Çme
);

207 ià(!
İs
 && 
Çme
)

209 
İs
 = 
	`›“80211_Œy_¿‹_cÚŒŞ_İs_g‘
(
›“80211_deçuÉ_rc_®go
);

212 ià(!
İs
 && (
	`¡¾’
(
CONFIG_MAC80211_RC_DEFAULT
) > 0))

214 
İs
 = 
	`›“80211_Œy_¿‹_cÚŒŞ_İs_g‘
(
CONFIG_MAC80211_RC_DEFAULT
);

216 
	`k”Ãl_·¿m_uÆock
(
THIS_MODULE
);

218  
İs
;

219 
	}
}

221 #ifdeà
CONFIG_MAC80211_DEBUGFS


222 
ssize_t
 
	$rúame_»ad
(
fe
 *fe, 
__u£r
 *
u£rbuf
,

223 
size_t
 
couÁ
, 
loff_t
 *
µos
)

225 
¿‹_cÚŒŞ_»f
 *
»f
 = 
fe
->
´iv©e_d©a
;

226 
Ën
 = 
	`¡¾’
(
»f
->
İs
->
Çme
);

228  
	`sim¶e_»ad_äom_bufãr
(
u£rbuf
, 
couÁ
, 
µos
,

229 
»f
->
İs
->
Çme
, 
Ën
);

230 
	}
}

232 cÚ¡ 
fe_İ”©iÚs
 
	grúame_İs
 = {

233 .
»ad
 = 
rúame_»ad
,

234 .
	gİ’
 = 
sim¶e_İ’
,

235 .
	gÎ£ek
 = 
deçuÉ_Î£ek
,

239 
¿‹_cÚŒŞ_»f
 *

240 
	$¿‹_cÚŒŞ_®loc
(cÚ¡ *
Çme
, 
›“80211_loÿl
 *
loÿl
)

242 
¿‹_cÚŒŞ_»f
 *
»f
;

244 
»f
 = 
	`km®loc
((
¿‹_cÚŒŞ_»f
), 
GFP_KERNEL
);

245 ià(!
»f
)

246  
NULL
;

247 
»f
->
İs
 = 
	`›“80211_¿‹_cÚŒŞ_İs_g‘
(
Çme
);

248 ià(!
»f
->
İs
)

249 
ä“
;

251 
»f
->
´iv
 =„ef->
İs
->
	`®loc
(&
loÿl
->
hw
);

252 ià(!
»f
->
´iv
)

253 
ä“
;

254  
»f
;

256 
ä“
:

257 
	`kä“
(
»f
);

258  
NULL
;

259 
	}
}

261 
	$¿‹_cÚŒŞ_ä“
(
›“80211_loÿl
 *
loÿl
,

262 
¿‹_cÚŒŞ_»f
 *
ù¾_»f
)

264 
ù¾_»f
->
İs
->
	`ä“
(ù¾_»f->
´iv
);

266 #ifdeà
CONFIG_MAC80211_DEBUGFS


267 
	`debugfs_»move_»cursive
(
loÿl
->
debugfs
.
rcdœ
);

268 
loÿl
->
debugfs
.
rcdœ
 = 
NULL
;

271 
	`kä“
(
ù¾_»f
);

272 
	}
}

274 
	$›“80211_check_¿‹_mask
(
›“80211_lšk_d©a
 *
lšk
)

276 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

277 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

278 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

279 
u32
 
u£r_mask
, 
basic_¿‹s
 = 
lšk
->
cÚf
->basic_rates;

280 
Æ80211_bªd
 
bªd
;

282 ià(
	`WARN_ON
(!
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
))

285 
bªd
 = 
lšk
->
cÚf
->
chª»q
.
İ”
.
chª
->band;

286 ià(
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

291 ià(
	`WARN_ON_ONCE
(!
basic_¿‹s
))

294 
u£r_mask
 = 
sd©a
->
rc_¿‹idx_mask
[
bªd
];

295 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

297 ià(
u£r_mask
 & 
basic_¿‹s
)

300 
	`sd©a_dbg
(
sd©a
,

302 
basic_¿‹s
, 
u£r_mask
, 
bªd
);

303 
sd©a
->
rc_¿‹idx_mask
[
bªd
] = (1 << 
sbªd
->
n_b™¿‹s
) - 1;

304 
	}
}

306 
boŞ
 
	$rc_no_d©a_Ü_no_ack_u£_mš
(
›“80211_tx_¿‹_cÚŒŞ
 *
txrc
)

308 
sk_buff
 *
skb
 = 
txrc
->skb;

309 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

311  (
šfo
->
æags
 & (
IEEE80211_TX_CTL_NO_ACK
 |

312 
IEEE80211_TX_CTL_USE_MINRATE
)) ||

313 !
	`›“80211_is_tx_d©a
(
skb
);

314 
	}
}

316 
	$rc_£nd_low_basiü©e
(
›“80211_tx_¿‹
 *
¿‹
,

317 
u32
 
basic_¿‹s
,

318 
›“80211_suµÜ‹d_bªd
 *
sbªd
)

320 
u8
 
i
;

322 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

324 
¿‹
->
æags
 |ğ
IEEE80211_TX_RC_S1G_MCS
;

325 
¿‹
->
idx
 = 0;

329 ià(
basic_¿‹s
 == 0)

331 ià(
¿‹
->
idx
 < 0)

333 ià(
basic_¿‹s
 & (1 << 
¿‹
->
idx
))

336 
i
 = 
¿‹
->
idx
 + 1; i <ğ
sbªd
->
n_b™¿‹s
; i++) {

337 ià(
basic_¿‹s
 & (1 << 
i
)) {

338 
¿‹
->
idx
 = 
i
;

344 
	}
}

346 
	$__¿‹_cÚŒŞ_£nd_low
(
›“80211_hw
 *
hw
,

347 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

348 
›“80211_¡a
 *
¡a
,

349 
›“80211_tx_šfo
 *
šfo
,

350 
u32
 
¿‹_mask
)

352 
i
;

353 
u32
 
¿‹_æags
 =

354 
	`›“80211_chªdef_¿‹_æags
(&
hw
->
cÚf
.
chªdef
);

356 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

357 
šfo
->
cÚŒŞ
.
¿‹s
[0].
æags
 |ğ
IEEE80211_TX_RC_S1G_MCS
;

358 
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 = 0;

362 ià((
sbªd
->
bªd
 =ğ
NL80211_BAND_2GHZ
) &&

363 (
šfo
->
æags
 & 
IEEE80211_TX_CTL_NO_CCK_RATE
))

364 
¿‹_æags
 |ğ
IEEE80211_RATE_ERP_G
;

366 
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 = 0;

367 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

368 ià(!(
¿‹_mask
 & 
	`BIT
(
i
)))

371 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
i
].
æags
) !=„ate_flags)

374 ià(!
	`¿‹_suµÜ‹d
(
¡a
, 
sbªd
->
bªd
, 
i
))

377 
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 = 
i
;

380 
	`WARN_ONCE
(
i
 =ğ
sbªd
->
n_b™¿‹s
,

382 
¡a
 ? s->
addr
 : 
NULL
,

383 
¡a
 ? s->
deæšk
.
suµ_¿‹s
[
sbªd
->
bªd
] : -1,

384 
sbªd
->
bªd
,

385 
¿‹_mask
, 
¿‹_æags
);

387 
šfo
->
cÚŒŞ
.
¿‹s
[0].
couÁ
 =

388 (
šfo
->
æags
 & 
IEEE80211_TX_CTL_NO_ACK
) ?

389 1 : 
hw
->
max_¿‹_Œ›s
;

391 
šfo
->
cÚŒŞ
.
sk_bË
 = 1;

392 
	}
}

395 
boŞ
 
	$¿‹_cÚŒŞ_£nd_low
(
›“80211_¡a
 *
pub¡a
,

396 
›“80211_tx_¿‹_cÚŒŞ
 *
txrc
)

398 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
txrc
->
skb
);

399 
›“80211_suµÜ‹d_bªd
 *
sbªd
 = 
txrc
->sband;

400 
¡a_šfo
 *
¡a
;

401 
mÿ¡_¿‹
;

402 
boŞ
 
u£_basiü©e
 = 
çl£
;

404 ià(!
pub¡a
 || 
	`rc_no_d©a_Ü_no_ack_u£_mš
(
txrc
)) {

405 
	`__¿‹_cÚŒŞ_£nd_low
(
txrc
->
hw
, 
sbªd
, 
pub¡a
, 
šfo
,

406 
txrc
->
¿‹_idx_mask
);

408 ià(!
pub¡a
 && 
txrc
->
bss
) {

409 
mÿ¡_¿‹
 = 
txrc
->
bss_cÚf
->mÿ¡_¿‹[
sbªd
->
bªd
];

410 ià(
mÿ¡_¿‹
 > 0) {

411 
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 = 
mÿ¡_¿‹
 - 1;

412  
Œue
;

414 
u£_basiü©e
 = 
Œue
;

415 } ià(
pub¡a
) {

416 
¡a
 = 
	`cÚš”_of
(
pub¡a
, 
¡a_šfo
, sta);

417 ià(
	`›“80211_vif_is_mesh
(&
¡a
->
sd©a
->
vif
))

418 
u£_basiü©e
 = 
Œue
;

421 ià(
u£_basiü©e
)

422 
	`rc_£nd_low_basiü©e
(&
šfo
->
cÚŒŞ
.
¿‹s
[0],

423 
txrc
->
bss_cÚf
->
basic_¿‹s
,

424 
sbªd
);

426  
Œue
;

428  
çl£
;

429 
	}
}

431 
boŞ
 
	$¿‹_idx_m©ch_Ëgacy_mask
(
s8
 *
¿‹_idx
, 
n_b™¿‹s
, 
u32
 
mask
)

433 
j
;

436 
j
 = *
¿‹_idx
; j >= 0; j--) {

437 ià(
mask
 & (1 << 
j
)) {

439 *
¿‹_idx
 = 
j
;

440  
Œue
;

445 
j
 = *
¿‹_idx
 + 1; j < 
n_b™¿‹s
; j++) {

446 ià(
mask
 & (1 << 
j
)) {

448 *
¿‹_idx
 = 
j
;

449  
Œue
;

452  
çl£
;

453 
	}
}

455 
boŞ
 
	$¿‹_idx_m©ch_mcs_mask
(
s8
 *
¿‹_idx
, 
u8
 *
mcs_mask
)

457 
i
, 
j
;

458 
ridx
, 
rb™
;

460 
ridx
 = *
¿‹_idx
 / 8;

461 
rb™
 = *
¿‹_idx
 % 8;

464 ià(
ridx
 < 0 ||„idx >ğ
IEEE80211_HT_MCS_MASK_LEN
)

465  
çl£
;

468 
i
 = 
ridx
; i >= 0; i--) {

469 
j
 = 
rb™
; j >= 0; j--)

470 ià(
mcs_mask
[
i
] & 
	`BIT
(
j
)) {

471 *
¿‹_idx
 = 
i
 * 8 + 
j
;

472  
Œue
;

474 
rb™
 = 7;

478 
ridx
 = (*
¿‹_idx
 + 1) / 8;

479 
rb™
 = (*
¿‹_idx
 + 1) % 8;

481 
i
 = 
ridx
; i < 
IEEE80211_HT_MCS_MASK_LEN
; i++) {

482 
j
 = 
rb™
; j < 8; j++)

483 ià(
mcs_mask
[
i
] & 
	`BIT
(
j
)) {

484 *
¿‹_idx
 = 
i
 * 8 + 
j
;

485  
Œue
;

487 
rb™
 = 0;

489  
çl£
;

490 
	}
}

492 
boŞ
 
	$¿‹_idx_m©ch_vht_mcs_mask
(
s8
 *
¿‹_idx
, 
u16
 *
vht_mask
)

494 
i
, 
j
;

495 
ridx
, 
rb™
;

497 
ridx
 = *
¿‹_idx
 >> 4;

498 
rb™
 = *
¿‹_idx
 & 0xf;

500 ià(
ridx
 < 0 ||„idx >ğ
NL80211_VHT_NSS_MAX
)

501  
çl£
;

504 
i
 = 
ridx
; i >= 0; i--) {

505 
j
 = 
rb™
; j >= 0; j--) {

506 ià(
vht_mask
[
i
] & 
	`BIT
(
j
)) {

507 *
¿‹_idx
 = (
i
 << 4è| 
j
;

508  
Œue
;

511 
rb™
 = 15;

515 
ridx
 = (*
¿‹_idx
 + 1) >> 4;

516 
rb™
 = (*
¿‹_idx
 + 1) & 0xf;

518 
i
 = 
ridx
; i < 
NL80211_VHT_NSS_MAX
; i++) {

519 
j
 = 
rb™
; j < 16; j++) {

520 ià(
vht_mask
[
i
] & 
	`BIT
(
j
)) {

521 *
¿‹_idx
 = (
i
 << 4è| 
j
;

522  
Œue
;

525 
rb™
 = 0;

527  
çl£
;

528 
	}
}

530 
	$¿‹_idx_m©ch_mask
(
s8
 *
¿‹_idx
, 
u16
 *
¿‹_æags
,

531 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

532 
Æ80211_chª_width
 
chª_width
,

533 
u32
 
mask
,

534 
u8
 
mcs_mask
[
IEEE80211_HT_MCS_MASK_LEN
],

535 
u16
 
vht_mask
[
NL80211_VHT_NSS_MAX
])

537 ià(*
¿‹_æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

539 ià(
	`¿‹_idx_m©ch_vht_mcs_mask
(
¿‹_idx
, 
vht_mask
))

542 *
¿‹_idx
 = 0;

544 *
¿‹_æags
 &ğ(
IEEE80211_TX_RC_USE_RTS_CTS
 |

545 
IEEE80211_TX_RC_USE_CTS_PROTECT
 |

546 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
);

548 *
¿‹_æags
 |ğ
IEEE80211_TX_RC_MCS
;

549 ià(
chª_width
 =ğ
NL80211_CHAN_WIDTH_40
)

550 *
¿‹_æags
 |ğ
IEEE80211_TX_RC_40_MHZ_WIDTH
;

552 ià(
	`¿‹_idx_m©ch_mcs_mask
(
¿‹_idx
, 
mcs_mask
))

556 *
¿‹_æags
 &ğ~(
IEEE80211_TX_RC_MCS
 |

557 
IEEE80211_TX_RC_40_MHZ_WIDTH
);

558 ià(
	`¿‹_idx_m©ch_Ëgacy_mask
(
¿‹_idx
, 
sbªd
->
n_b™¿‹s
,

559 
mask
))

561 } ià(*
¿‹_æags
 & 
IEEE80211_TX_RC_MCS
) {

563 ià(
	`¿‹_idx_m©ch_mcs_mask
(
¿‹_idx
, 
mcs_mask
))

567 *
¿‹_idx
 = 0;

569 *
¿‹_æags
 &ğ(
IEEE80211_TX_RC_USE_RTS_CTS
 |

570 
IEEE80211_TX_RC_USE_CTS_PROTECT
 |

571 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
);

572 ià(
	`¿‹_idx_m©ch_Ëgacy_mask
(
¿‹_idx
, 
sbªd
->
n_b™¿‹s
,

573 
mask
))

577 ià(
	`¿‹_idx_m©ch_Ëgacy_mask
(
¿‹_idx
, 
sbªd
->
n_b™¿‹s
,

578 
mask
))

582 
chª_width
) {

583 
NL80211_CHAN_WIDTH_20_NOHT
:

584 
NL80211_CHAN_WIDTH_5
:

585 
NL80211_CHAN_WIDTH_10
:

591 *
¿‹_idx
 = 0;

593 *
¿‹_æags
 &ğ(
IEEE80211_TX_RC_USE_RTS_CTS
 |

594 
IEEE80211_TX_RC_USE_CTS_PROTECT
 |

595 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
);

597 *
¿‹_æags
 |ğ
IEEE80211_TX_RC_MCS
;

599 ià(
chª_width
 =ğ
NL80211_CHAN_WIDTH_40
)

600 *
¿‹_æags
 |ğ
IEEE80211_TX_RC_40_MHZ_WIDTH
;

602 ià(
	`¿‹_idx_m©ch_mcs_mask
(
¿‹_idx
, 
mcs_mask
))

613 
	}
}

615 
	$¿‹_fixup_¿‹li¡
(
›“80211_vif
 *
vif
,

616 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

617 
›“80211_tx_šfo
 *
šfo
,

618 
›“80211_tx_¿‹
 *
¿‹s
,

619 
max_¿‹s
)

621 
›“80211_¿‹
 *
¿‹
;

622 
boŞ
 
šv®
 = 
çl£
;

623 
i
;

633 ià(!(
¿‹s
[0].
æags
 &

634 (
IEEE80211_TX_RC_MCS
 | 
IEEE80211_TX_RC_VHT_MCS
))) {

635 
u32
 
basic_¿‹s
 = 
vif
->
bss_cÚf
.basic_rates;

636 
s8
 
ba£¿‹
 = 
basic_¿‹s
 ? 
	`ffs
(basic_rates) - 1 : 0;

638 
¿‹
 = &
sbªd
->
b™¿‹s
[
¿‹s
[0].
idx
];

640 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

642 ià(!(
basic_¿‹s
 & 
	`BIT
(
i
)))

645 ià(
sbªd
->
b™¿‹s
[
i
].
b™¿‹
 > 
¿‹
->bitrate)

648 ià(
sbªd
->
b™¿‹s
[
ba£¿‹
].
b™¿‹
 <

649 
sbªd
->
b™¿‹s
[
i
].
b™¿‹
)

650 
ba£¿‹
 = 
i
;

653 
šfo
->
cÚŒŞ
.
¹s_ùs_¿‹_idx
 = 
ba£¿‹
;

656 
i
 = 0; i < 
max_¿‹s
; i++) {

662 ià(
šv®
) {

663 
¿‹s
[
i
].
idx
 = -1;

666 ià(
¿‹s
[
i
].
idx
 < 0) {

667 
šv®
 = 
Œue
;

675 ià(
¿‹s
[
i
].
æags
 & 
IEEE80211_TX_RC_MCS
) {

676 
	`WARN_ON
(
¿‹s
[
i
].
idx
 > 76);

678 ià(!(
¿‹s
[
i
].
æags
 & 
IEEE80211_TX_RC_USE_RTS_CTS
) &&

679 
šfo
->
cÚŒŞ
.
u£_ùs_´Ù
)

680 
¿‹s
[
i
].
æags
 |=

681 
IEEE80211_TX_RC_USE_CTS_PROTECT
;

685 ià(
¿‹s
[
i
].
æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

686 
	`WARN_ON
(
	`›“80211_¿‹_g‘_vht_mcs
(&
¿‹s
[
i
]) > 9);

691 ià(
šfo
->
cÚŒŞ
.
u£_¹s
) {

692 
¿‹s
[
i
].
æags
 |ğ
IEEE80211_TX_RC_USE_RTS_CTS
;

693 
šfo
->
cÚŒŞ
.
u£_ùs_´Ù
 = 
çl£
;

697 ià(
	`WARN_ON_ONCE
(
¿‹s
[
i
].
idx
 >ğ
sbªd
->
n_b™¿‹s
)) {

698 
¿‹s
[
i
].
idx
 = -1;

702 
¿‹
 = &
sbªd
->
b™¿‹s
[
¿‹s
[
i
].
idx
];

705 ià(
šfo
->
cÚŒŞ
.
shÜt_´—mbË
 &&

706 
¿‹
->
æags
 & 
IEEE80211_RATE_SHORT_PREAMBLE
)

707 
¿‹s
[
i
].
æags
 |ğ
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
;

710 ià(!(
¿‹s
[
i
].
æags
 & 
IEEE80211_TX_RC_USE_RTS_CTS
) &&

711 
šfo
->
cÚŒŞ
.
u£_ùs_´Ù
 &&

712 
¿‹
->
æags
 & 
IEEE80211_RATE_ERP_G
)

713 
¿‹s
[
i
].
æags
 |ğ
IEEE80211_TX_RC_USE_CTS_PROTECT
;

715 
	}
}

718 
	$¿‹_cÚŒŞ_fl_¡a_bË
(
›“80211_¡a
 *
¡a
,

719 
›“80211_tx_šfo
 *
šfo
,

720 
›“80211_tx_¿‹
 *
¿‹s
,

721 
max_¿‹s
)

723 
›“80211_¡a_¿‹s
 *
¿‹tbl
 = 
NULL
;

724 
i
;

726 ià(
¡a
 && !
šfo
->
cÚŒŞ
.
sk_bË
)

727 
¿‹tbl
 = 
	`rcu_d”eã»nû
(
¡a
->
¿‹s
);

730 
max_¿‹s
 = 
	`mš_t
(, max_¿‹s, 
IEEE80211_TX_RATE_TABLE_SIZE
);

731 
i
 = 0; i < 
max_¿‹s
; i++) {

732 ià(
i
 < 
	`ARRAY_SIZE
(
šfo
->
cÚŒŞ
.
¿‹s
) &&

733 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
idx
 >= 0 &&

734 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
couÁ
) {

735 ià(
¿‹s
 !ğ
šfo
->
cÚŒŞ
.rates)

736 
¿‹s
[
i
] = 
šfo
->
cÚŒŞ
.rates[i];

737 } ià(
¿‹tbl
) {

738 
¿‹s
[
i
].
idx
 = 
¿‹tbl
->
¿‹
[i].idx;

739 
¿‹s
[
i
].
æags
 = 
¿‹tbl
->
¿‹
[i].flags;

740 ià(
šfo
->
cÚŒŞ
.
u£_¹s
)

741 
¿‹s
[
i
].
couÁ
 = 
¿‹tbl
->
¿‹
[i].
couÁ_¹s
;

742 ià(
šfo
->
cÚŒŞ
.
u£_ùs_´Ù
)

743 
¿‹s
[
i
].
couÁ
 = 
¿‹tbl
->
¿‹
[i].
couÁ_ùs
;

745 
¿‹s
[
i
].
couÁ
 = 
¿‹tbl
->
¿‹
[i].count;

747 
¿‹s
[
i
].
idx
 = -1;

748 
¿‹s
[
i
].
couÁ
 = 0;

751 ià(
¿‹s
[
i
].
idx
 < 0 || !¿‹s[i].
couÁ
)

754 
	}
}

756 
boŞ
 
	$¿‹_cÚŒŞ_ÿp_mask
(
›“80211_sub_if_d©a
 *
sd©a
,

757 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

758 
›“80211_¡a
 *
¡a
, 
u32
 *
mask
,

759 
u8
 
mcs_mask
[
IEEE80211_HT_MCS_MASK_LEN
],

760 
u16
 
vht_mask
[
NL80211_VHT_NSS_MAX
])

762 
u32
 
i
, 
æags
;

764 *
mask
 = 
sd©a
->
rc_¿‹idx_mask
[
sbªd
->
bªd
];

765 
æags
 = 
	`›“80211_chªdef_¿‹_æags
(&
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
);

766 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

767 ià((
æags
 & 
sbªd
->
b™¿‹s
[
i
].flags) != flags)

768 *
mask
 &ğ~
	`BIT
(
i
);

771 ià(*
mask
 =ğ(1 << 
sbªd
->
n_b™¿‹s
) - 1 &&

772 !
sd©a
->
rc_has_mcs_mask
[
sbªd
->
bªd
] &&

773 !
sd©a
->
rc_has_vht_mcs_mask
[
sbªd
->
bªd
])

774  
çl£
;

776 ià(
sd©a
->
rc_has_mcs_mask
[
sbªd
->
bªd
])

777 
	`memıy
(
mcs_mask
, 
sd©a
->
rc_¿‹idx_mcs_mask
[
sbªd
->
bªd
],

778 
IEEE80211_HT_MCS_MASK_LEN
);

780 
	`mem£t
(
mcs_mask
, 0xff, 
IEEE80211_HT_MCS_MASK_LEN
);

782 ià(
sd©a
->
rc_has_vht_mcs_mask
[
sbªd
->
bªd
])

783 
	`memıy
(
vht_mask
, 
sd©a
->
rc_¿‹idx_vht_mcs_mask
[
sbªd
->
bªd
],

784 (
u16
è* 
NL80211_VHT_NSS_MAX
);

786 
	`mem£t
(
vht_mask
, 0xff, (
u16
è* 
NL80211_VHT_NSS_MAX
);

788 ià(
¡a
) {

789 
__Ë16
 
¡a_vht_ÿp
;

790 
u16
 
¡a_vht_mask
[
NL80211_VHT_NSS_MAX
];

793 *
mask
 &ğ
¡a
->
deæšk
.
suµ_¿‹s
[
sbªd
->
bªd
];

794 
i
 = 0; i < 
IEEE80211_HT_MCS_MASK_LEN
; i++)

795 
mcs_mask
[
i
] &ğ
¡a
->
deæšk
.
ht_ÿp
.
mcs
.
rx_mask
[i];

797 
¡a_vht_ÿp
 = 
¡a
->
deæšk
.
vht_ÿp
.
vht_mcs
.
rx_mcs_m­
;

798 
	`›“80211_g‘_vht_mask_äom_ÿp
(
¡a_vht_ÿp
, 
¡a_vht_mask
);

799 
i
 = 0; i < 
NL80211_VHT_NSS_MAX
; i++)

800 
vht_mask
[
i
] &ğ
¡a_vht_mask
[i];

803  
Œue
;

804 
	}
}

807 
	$¿‹_cÚŒŞ_­¶y_mask_¿‹tbl
(
¡a_šfo
 *
¡a
,

808 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

809 
›“80211_¡a_¿‹s
 *
¿‹s
)

811 
i
;

812 
u32
 
mask
;

813 
u8
 
mcs_mask
[
IEEE80211_HT_MCS_MASK_LEN
];

814 
u16
 
vht_mask
[
NL80211_VHT_NSS_MAX
];

815 
Æ80211_chª_width
 
chª_width
;

817 ià(!
	`¿‹_cÚŒŞ_ÿp_mask
(
¡a
->
sd©a
, 
sbªd
, &¡a->¡a, &
mask
,

818 
mcs_mask
, 
vht_mask
))

821 
chª_width
 = 
¡a
->
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
;

822 
i
 = 0; i < 
IEEE80211_TX_RATE_TABLE_SIZE
; i++) {

823 ià(
¿‹s
->
¿‹
[
i
].
idx
 < 0)

826 
	`¿‹_idx_m©ch_mask
(&
¿‹s
->
¿‹
[
i
].
idx
, &¿‹s->¿‹[i].
æags
,

827 
sbªd
, 
chª_width
, 
mask
, 
mcs_mask
,

828 
vht_mask
);

830 
	}
}

832 
	$¿‹_cÚŒŞ_­¶y_mask
(
›“80211_sub_if_d©a
 *
sd©a
,

833 
›“80211_¡a
 *
¡a
,

834 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

835 
›“80211_tx_¿‹
 *
¿‹s
,

836 
max_¿‹s
)

838 
Æ80211_chª_width
 
chª_width
;

839 
u8
 
mcs_mask
[
IEEE80211_HT_MCS_MASK_LEN
];

840 
u32
 
mask
;

841 
u16
 
¿‹_æags
, 
vht_mask
[
NL80211_VHT_NSS_MAX
];

842 
i
;

849 ià(!
	`¿‹_cÚŒŞ_ÿp_mask
(
sd©a
, 
sbªd
, 
¡a
, &
mask
, 
mcs_mask
,

850 
vht_mask
))

858 
chª_width
 = 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
;

859 
i
 = 0; i < 
max_¿‹s
; i++) {

861 ià(
¿‹s
[
i
].
idx
 < 0)

864 
¿‹_æags
 = 
¿‹s
[
i
].
æags
;

865 
	`¿‹_idx_m©ch_mask
(&
¿‹s
[
i
].
idx
, &
¿‹_æags
, 
sbªd
,

866 
chª_width
, 
mask
, 
mcs_mask
, 
vht_mask
);

867 
¿‹s
[
i
].
æags
 = 
¿‹_æags
;

869 
	}
}

871 
	$›“80211_g‘_tx_¿‹s
(
›“80211_vif
 *
vif
,

872 
›“80211_¡a
 *
¡a
,

873 
sk_buff
 *
skb
,

874 
›“80211_tx_¿‹
 *
de¡
,

875 
max_¿‹s
)

877 
›“80211_sub_if_d©a
 *
sd©a
;

878 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

879 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

880 
u32
 
mask
 = ~0;

882 
	`¿‹_cÚŒŞ_fl_¡a_bË
(
¡a
, 
šfo
, 
de¡
, 
max_¿‹s
);

884 ià(!
vif
)

887 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

888 
sbªd
 = 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
šfo
->
bªd
];

890 ià(
	`›“80211_is_tx_d©a
(
skb
))

891 
	`¿‹_cÚŒŞ_­¶y_mask
(
sd©a
, 
¡a
, 
sbªd
, 
de¡
, 
max_¿‹s
);

893 ià(!(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_SCAN_TX
))

894 
mask
 = 
sd©a
->
rc_¿‹idx_mask
[
šfo
->
bªd
];

896 ià(
de¡
[0].
idx
 < 0)

897 
	`__¿‹_cÚŒŞ_£nd_low
(&
sd©a
->
loÿl
->
hw
, 
sbªd
, 
¡a
, 
šfo
,

898 
mask
);

900 ià(
¡a
)

901 
	`¿‹_fixup_¿‹li¡
(
vif
, 
sbªd
, 
šfo
, 
de¡
, 
max_¿‹s
);

902 
	}
}

903 
EXPORT_SYMBOL
(
›“80211_g‘_tx_¿‹s
);

905 
	$¿‹_cÚŒŞ_g‘_¿‹
(
›“80211_sub_if_d©a
 *
sd©a
,

906 
¡a_šfo
 *
¡a
,

907 
›“80211_tx_¿‹_cÚŒŞ
 *
txrc
)

909 
¿‹_cÚŒŞ_»f
 *
»f
 = 
sd©a
->
loÿl
->
¿‹_ù¾
;

910 *
´iv_¡a
 = 
NULL
;

911 
›“80211_¡a
 *
i¡a
 = 
NULL
;

912 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
txrc
->
skb
);

913 
i
;

915 
i
 = 0; i < 
IEEE80211_TX_MAX_RATES
; i++) {

916 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
idx
 = -1;

917 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
æags
 = 0;

918 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
couÁ
 = 0;

921 ià(
	`¿‹_cÚŒŞ_£nd_low
(
¡a
 ? &¡a->¡¨: 
NULL
, 
txrc
))

924 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
HAS_RATE_CONTROL
))

927 ià(
¡a
 && 
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_RATE_CONTROL
)) {

928 
i¡a
 = &
¡a
->sta;

929 
´iv_¡a
 = 
¡a
->
¿‹_ù¾_´iv
;

932 ià(
i¡a
) {

933 
	`¥š_lock_bh
(&
¡a
->
¿‹_ù¾_lock
);

934 
»f
->
İs
->
	`g‘_¿‹
Ôef->
´iv
, 
i¡a
, 
´iv_¡a
, 
txrc
);

935 
	`¥š_uÆock_bh
(&
¡a
->
¿‹_ù¾_lock
);

937 
	`¿‹_cÚŒŞ_£nd_low
(
NULL
, 
txrc
);

940 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
SUPPORTS_RC_TABLE
))

943 
	`›“80211_g‘_tx_¿‹s
(&
sd©a
->
vif
, 
i¡a
, 
txrc
->
skb
,

944 
šfo
->
cÚŒŞ
.
¿‹s
,

945 
	`ARRAY_SIZE
(
šfo
->
cÚŒŞ
.
¿‹s
));

946 
	}
}

948 
	$¿‹_cÚŒŞ_£t_¿‹s
(
›“80211_hw
 *
hw
,

949 
›“80211_¡a
 *
pub¡a
,

950 
›“80211_¡a_¿‹s
 *
¿‹s
)

952 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

953 
›“80211_¡a_¿‹s
 *
Şd
;

954 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

956 
sbªd
 = 
	`›“80211_g‘_sbªd
(
¡a
->
sd©a
);

957 ià(!
sbªd
)

958  -
EINVAL
;

959 
	`¿‹_cÚŒŞ_­¶y_mask_¿‹tbl
(
¡a
, 
sbªd
, 
¿‹s
);

966 
Şd
 = 
	`rcu_d”eã»nû_´Ùeùed
(
pub¡a
->
¿‹s
, 
Œue
);

967 
	`rcu_assign_poš‹r
(
pub¡a
->
¿‹s
,„ates);

968 ià(
Şd
)

969 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

971 ià(
¡a
->
u¶ßded
)

972 
	`drv_¡a_¿‹_tbl_upd©e
(
	`hw_to_loÿl
(
hw
), 
¡a
->
sd©a
, 
pub¡a
);

974 
	`›“80211_¡a_£t_ex³ùed_throughput
(
pub¡a
, 
	`¡a_g‘_ex³ùed_throughput
(
¡a
));

977 
	}
}

978 
EXPORT_SYMBOL
(
¿‹_cÚŒŞ_£t_¿‹s
);

980 
	$›“80211_š™_¿‹_ù¾_®g
(
›“80211_loÿl
 *
loÿl
,

981 cÚ¡ *
Çme
)

983 
¿‹_cÚŒŞ_»f
 *
»f
;

985 
	`ASSERT_RTNL
();

987 ià(
loÿl
->
İ’_couÁ
)

988  -
EBUSY
;

990 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
)) {

991 ià(
	`WARN_ON
(!
loÿl
->
İs
->
£t_¹s_th»shŞd
))

992  -
EINVAL
;

996 
»f
 = 
	`¿‹_cÚŒŞ_®loc
(
Çme
, 
loÿl
);

997 ià(!
»f
) {

998 
	`why_w¬n
(
loÿl
->
hw
.
why
,

1000  -
ENOENT
;

1003 
	`WARN_ON
(
loÿl
->
¿‹_ù¾
);

1004 
loÿl
->
¿‹_ù¾
 = 
»f
;

1006 
	`why_debug
(
loÿl
->
hw
.
why
, "Selected„ate control‡lgorithm '%s'\n",

1007 
»f
->
İs
->
Çme
);

1010 
	}
}

1012 
	$¿‹_cÚŒŞ_deš™Ÿlize
(
›“80211_loÿl
 *
loÿl
)

1014 
¿‹_cÚŒŞ_»f
 *
»f
;

1016 
»f
 = 
loÿl
->
¿‹_ù¾
;

1018 ià(!
»f
)

1021 
loÿl
->
¿‹_ù¾
 = 
NULL
;

1022 
	`¿‹_cÚŒŞ_ä“
(
loÿl
, 
»f
);

1023 
	}
}

	@rate.h

9 #iâdeà
IEEE80211_RATE_H


10 
	#IEEE80211_RATE_H


	)

12 
	~<lšux/Ãtdeviû.h
>

13 
	~<lšux/skbuff.h
>

14 
	~<lšux/ty³s.h
>

15 
	~<Ãt/mac80211.h
>

16 
	~"›“80211_i.h
"

17 
	~"¡a_šfo.h
"

18 
	~"driv”-İs.h
"

20 
	s¿‹_cÚŒŞ_»f
 {

21 cÚ¡ 
¿‹_cÚŒŞ_İs
 *
	mİs
;

22 *
	m´iv
;

25 
¿‹_cÚŒŞ_g‘_¿‹
(
›“80211_sub_if_d©a
 *
sd©a
,

26 
¡a_šfo
 *
¡a
,

27 
›“80211_tx_¿‹_cÚŒŞ
 *
txrc
);

29 
¿‹_cÚŒŞ_tx_¡©us
(
›“80211_loÿl
 *
loÿl
,

30 
›“80211_tx_¡©us
 *
¡
);

32 
¿‹_cÚŒŞ_¿‹_š™
(
¡a_šfo
 *
¡a
);

33 
¿‹_cÚŒŞ_¿‹_upd©e
(
›“80211_loÿl
 *
loÿl
,

34 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

35 
¡a_šfo
 *
¡a
,

36 
lšk_id
,

37 
u32
 
chªged
);

39 
šlše
 *
	$¿‹_cÚŒŞ_®loc_¡a
(
¿‹_cÚŒŞ_»f
 *
»f
,

40 
¡a_šfo
 *
¡a
, 
gå_t
 
gå
)

42 
	`¥š_lock_š™
(&
¡a
->
¿‹_ù¾_lock
);

43  
»f
->
İs
->
	`®loc_¡a
Ôef->
´iv
, &
¡a
->¡a, 
gå
);

44 
	}
}

46 
šlše
 
	$¿‹_cÚŒŞ_ä“_¡a
(
¡a_šfo
 *
¡a
)

48 
¿‹_cÚŒŞ_»f
 *
»f
 = 
¡a
->
¿‹_ù¾
;

49 
›“80211_¡a
 *
i¡a
 = &
¡a
->sta;

50 *
´iv_¡a
 = 
¡a
->
¿‹_ù¾_´iv
;

52 
»f
->
İs
->
	`ä“_¡a
Ôef->
´iv
, 
i¡a
, 
´iv_¡a
);

53 
	}
}

55 
šlše
 
	$¿‹_cÚŒŞ_add_¡a_debugfs
(
¡a_šfo
 *
¡a
)

57 #ifdeà
CONFIG_MAC80211_DEBUGFS


58 
¿‹_cÚŒŞ_»f
 *
»f
 = 
¡a
->
¿‹_ù¾
;

59 ià(
»f
 && 
¡a
->
debugfs_dœ
 &&„ef->
İs
->
add_¡a_debugfs
)

60 
»f
->
İs
->
	`add_¡a_debugfs
Ôef->
´iv
, 
¡a
->
¿‹_ù¾_´iv
,

61 
¡a
->
debugfs_dœ
);

63 
	}
}

65 cÚ¡ 
fe_İ”©iÚs
 
rúame_İs
;

67 
šlše
 
	$¿‹_cÚŒŞ_add_debugfs
(
›“80211_loÿl
 *
loÿl
)

69 #ifdeà
CONFIG_MAC80211_DEBUGFS


70 
d’Œy
 *
debugfsdœ
;

72 ià(!
loÿl
->
¿‹_ù¾
)

75 ià(!
loÿl
->
¿‹_ù¾
->
İs
->
add_debugfs
)

78 
debugfsdœ
 = 
	`debugfs_ü—‹_dœ
("rc", 
loÿl
->
hw
.
why
->debugfsdir);

79 
loÿl
->
debugfs
.
rcdœ
 = 
debugfsdœ
;

80 
	`debugfs_ü—‹_fe
("Çme", 0400, 
debugfsdœ
,

81 
loÿl
->
¿‹_ù¾
, &
rúame_İs
);

83 
loÿl
->
¿‹_ù¾
->
İs
->
	`add_debugfs
(&loÿl->
hw
,†oÿl->¿‹_ù¾->
´iv
,

84 
debugfsdœ
);

86 
	}
}

88 
›“80211_check_¿‹_mask
(
›“80211_lšk_d©a
 *
lšk
);

92 
›“80211_š™_¿‹_ù¾_®g
(
›“80211_loÿl
 *
loÿl
,

93 cÚ¡ *
Çme
);

94 
¿‹_cÚŒŞ_deš™Ÿlize
(
›“80211_loÿl
 *
loÿl
);

98 #ifdeà
CONFIG_MAC80211_RC_MINSTREL


99 
rc80211_mš¡»l_š™
();

100 
rc80211_mš¡»l_ex™
();

102 
šlše
 
	$rc80211_mš¡»l_š™
()

105 
	}
}

106 
šlše
 
	$rc80211_mš¡»l_ex™
()

108 
	}
}

	@rc80211_minstrel_ht.c

6 
	~<lšux/Ãtdeviû.h
>

7 
	~<lšux/ty³s.h
>

8 
	~<lšux/skbuff.h
>

9 
	~<lšux/debugfs.h
>

10 
	~<lšux/¿ndom.h
>

11 
	~<lšux/moduË·¿m.h
>

12 
	~<lšux/›“80211.h
>

13 
	~<lšux/mšmax.h
>

14 
	~<Ãt/mac80211.h
>

15 
	~"¿‹.h
"

16 
	~"¡a_šfo.h
"

17 
	~"rc80211_mš¡»l_ht.h
"

19 
	#AVG_AMPDU_SIZE
 16

	)

20 
	#AVG_PKT_SIZE
 1200

	)

23 
	#MCS_NBITS
 ((
AVG_PKT_SIZE
 * 
AVG_AMPDU_SIZE
è<< 3)

	)

26 
	#MCS_NSYMS
(
bps
è
	`DIV_ROUND_UP
(
MCS_NBITS
, (bps))

	)

29 
	#MCS_SYMBOL_TIME
(
sgi
, 
syms
) \

30 (
sgi
 ? \

31 ((
syms
) * 18000 + 4000) / 5 : \

32 ((
syms
) * 1000) << 2 \

33 )

	)

36 
	#MCS_DURATION
(
¡»ams
, 
sgi
, 
bps
) \

37 (
	`MCS_SYMBOL_TIME
(
sgi
, 
	`MCS_NSYMS
((
¡»ams
è* (
bps
))è/ 
AVG_AMPDU_SIZE
)

	)

39 
	#BW_20
 0

	)

40 
	#BW_40
 1

	)

41 
	#BW_80
 2

	)

46 
	#GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_ht40
) \

47 
MINSTREL_HT_GROUP_0
 + \

48 
MINSTREL_MAX_STREAMS
 * 2 * 
_ht40
 + \

49 
MINSTREL_MAX_STREAMS
 * 
_sgi
 + \

50 
_¡»ams
 - 1

	)

52 
	#_MAX
(
a
, 
b
è((×)>(b))?×):(b))

	)

54 
	#GROUP_SHIFT
(
du¿tiÚ
) \

55 
	`_MAX
(0, 16 - 
	`__butš_şz
(
du¿tiÚ
))

	)

58 
	#__MCS_GROUP
(
_¡»ams
, 
_sgi
, 
_ht40
, 
_s
) \

59 [
	`GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_ht40
)] = { \

60 .
¡»ams
 = 
_¡»ams
, \

61 .
shiá
 = 
_s
, \

62 .
bw
 = 
_ht40
, \

63 .
æags
 = \

64 
IEEE80211_TX_RC_MCS
 | \

65 (
_sgi
 ? 
IEEE80211_TX_RC_SHORT_GI
 : 0) | \

66 (
_ht40
 ? 
IEEE80211_TX_RC_40_MHZ_WIDTH
 : 0), \

67 .
du¿tiÚ
 = { \

68 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 54 : 26è>> 
_s
, \

69 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 108 : 52è>> 
_s
, \

70 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 162 : 78è>> 
_s
, \

71 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 216 : 104è>> 
_s
, \

72 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 324 : 156è>> 
_s
, \

73 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 432 : 208è>> 
_s
, \

74 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 486 : 234è>> 
_s
, \

75 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 540 : 260è>> 
_s
 \

77 }

	)

79 
	#MCS_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_ht40
) \

80 
	`GROUP_SHIFT
(
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, 
_ht40
 ? 54 : 26))

	)

82 
	#MCS_GROUP
(
_¡»ams
, 
_sgi
, 
_ht40
) \

83 
	`__MCS_GROUP
(
_¡»ams
, 
_sgi
, 
_ht40
, \

84 
	`MCS_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_ht40
))

	)

86 
	#VHT_GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_bw
) \

87 (
MINSTREL_VHT_GROUP_0
 + \

88 
MINSTREL_MAX_STREAMS
 * 2 * (
_bw
) + \

89 
MINSTREL_MAX_STREAMS
 * (
_sgi
) + \

90 (
_¡»ams
è- 1)

	)

92 
	#BW2VBPS
(
_bw
, 
r3
, 
r2
, 
r1
) \

93 (
_bw
 =ğ
BW_80
 ? 
r3
 : _bw =ğ
BW_40
 ? 
r2
 : 
r1
)

	)

95 
	#__VHT_GROUP
(
_¡»ams
, 
_sgi
, 
_bw
, 
_s
) \

96 [
	`VHT_GROUP_IDX
(
_¡»ams
, 
_sgi
, 
_bw
)] = { \

97 .
¡»ams
 = 
_¡»ams
, \

98 .
shiá
 = 
_s
, \

99 .
bw
 = 
_bw
, \

100 .
æags
 = \

101 
IEEE80211_TX_RC_VHT_MCS
 | \

102 (
_sgi
 ? 
IEEE80211_TX_RC_SHORT_GI
 : 0) | \

103 (
_bw
 =ğ
BW_80
 ? 
IEEE80211_TX_RC_80_MHZ_WIDTH
 : \

104 
_bw
 =ğ
BW_40
 ? 
IEEE80211_TX_RC_40_MHZ_WIDTH
 : 0), \

105 .
du¿tiÚ
 = { \

106 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

107 
	`BW2VBPS
(
_bw
, 117, 54, 26)è>> 
_s
, \

108 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

109 
	`BW2VBPS
(
_bw
, 234, 108, 52)è>> 
_s
, \

110 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

111 
	`BW2VBPS
(
_bw
, 351, 162, 78)è>> 
_s
, \

112 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

113 
	`BW2VBPS
(
_bw
, 468, 216, 104)è>> 
_s
, \

114 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

115 
	`BW2VBPS
(
_bw
, 702, 324, 156)è>> 
_s
, \

116 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

117 
	`BW2VBPS
(
_bw
, 936, 432, 208)è>> 
_s
, \

118 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

119 
	`BW2VBPS
(
_bw
, 1053, 486, 234)è>> 
_s
, \

120 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

121 
	`BW2VBPS
(
_bw
, 1170, 540, 260)è>> 
_s
, \

122 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

123 
	`BW2VBPS
(
_bw
, 1404, 648, 312)è>> 
_s
, \

124 
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

125 
	`BW2VBPS
(
_bw
, 1560, 720, 346)è>> 
_s
 \

127 }

	)

129 
	#VHT_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_bw
) \

130 
	`GROUP_SHIFT
(
	`MCS_DURATION
(
_¡»ams
, 
_sgi
, \

131 
	`BW2VBPS
(
_bw
, 117, 54, 26)))

	)

133 
	#VHT_GROUP
(
_¡»ams
, 
_sgi
, 
_bw
) \

134 
	`__VHT_GROUP
(
_¡»ams
, 
_sgi
, 
_bw
, \

135 
	`VHT_GROUP_SHIFT
(
_¡»ams
, 
_sgi
, 
_bw
))

	)

137 
	#CCK_DURATION
(
_b™¿‹
, 
_shÜt
) \

139 (
_shÜt
 ? 72 + 24 : 144 + 48) + \

140 (8 * (
AVG_PKT_SIZE
 + 4è* 10è/ (
_b™¿‹
)))

	)

142 
	#CCK_DURATION_LIST
(
_shÜt
, 
_s
) \

143 
	`CCK_DURATION
(10, 
_shÜt
è>> 
_s
, \

144 
	`CCK_DURATION
(20, 
_shÜt
è>> 
_s
, \

145 
	`CCK_DURATION
(55, 
_shÜt
è>> 
_s
, \

146 
	`CCK_DURATION
(110, 
_shÜt
è>> 
_s


	)

148 
	#__CCK_GROUP
(
_s
) \

149 [
MINSTREL_CCK_GROUP
] = { \

150 .
¡»ams
 = 1, \

151 .
æags
 = 0, \

152 .
shiá
 = 
_s
, \

153 .
du¿tiÚ
 = { \

154 
	`CCK_DURATION_LIST
(
çl£
, 
_s
), \

155 
	`CCK_DURATION_LIST
(
Œue
, 
_s
) \

157 }

	)

159 
	#CCK_GROUP_SHIFT
 \

160 
	`GROUP_SHIFT
(
	`CCK_DURATION
(10, 
çl£
))

	)

162 
	#CCK_GROUP
 
	`__CCK_GROUP
(
CCK_GROUP_SHIFT
)

	)

164 
	#OFDM_DURATION
(
_b™¿‹
) \

168 4 * (((16 + 80 * (
AVG_PKT_SIZE
 + 4) + 6) / \

169 ((
_b™¿‹
è* 4)))))

	)

171 
	#OFDM_DURATION_LIST
(
_s
) \

172 
	`OFDM_DURATION
(60è>> 
_s
, \

173 
	`OFDM_DURATION
(90è>> 
_s
, \

174 
	`OFDM_DURATION
(120è>> 
_s
, \

175 
	`OFDM_DURATION
(180è>> 
_s
, \

176 
	`OFDM_DURATION
(240è>> 
_s
, \

177 
	`OFDM_DURATION
(360è>> 
_s
, \

178 
	`OFDM_DURATION
(480è>> 
_s
, \

179 
	`OFDM_DURATION
(540è>> 
_s


	)

181 
	#__OFDM_GROUP
(
_s
) \

182 [
MINSTREL_OFDM_GROUP
] = { \

183 .
¡»ams
 = 1, \

184 .
æags
 = 0, \

185 .
shiá
 = 
_s
, \

186 .
du¿tiÚ
 = { \

187 
	`OFDM_DURATION_LIST
(
_s
), \

189 }

	)

191 
	#OFDM_GROUP_SHIFT
 \

192 
	`GROUP_SHIFT
(
	`OFDM_DURATION
(60))

	)

194 
	#OFDM_GROUP
 
	`__OFDM_GROUP
(
OFDM_GROUP_SHIFT
)

	)

197 
boŞ
 
	gmš¡»l_vht_Úly
 = 
Œue
;

198 
moduË_·¿m
(
mš¡»l_vht_Úly
, 
boŞ
, 0644);

199 
MODULE_PARM_DESC
(
mš¡»l_vht_Úly
,

210 cÚ¡ 
mcs_group
 
	gmš¡»l_mcs_groups
[] = {

211 
MCS_GROUP
(1, 0, 
BW_20
),

212 
MCS_GROUP
(2, 0, 
BW_20
),

213 
MCS_GROUP
(3, 0, 
BW_20
),

214 
MCS_GROUP
(4, 0, 
BW_20
),

216 
MCS_GROUP
(1, 1, 
BW_20
),

217 
MCS_GROUP
(2, 1, 
BW_20
),

218 
MCS_GROUP
(3, 1, 
BW_20
),

219 
MCS_GROUP
(4, 1, 
BW_20
),

221 
MCS_GROUP
(1, 0, 
BW_40
),

222 
MCS_GROUP
(2, 0, 
BW_40
),

223 
MCS_GROUP
(3, 0, 
BW_40
),

224 
MCS_GROUP
(4, 0, 
BW_40
),

226 
MCS_GROUP
(1, 1, 
BW_40
),

227 
MCS_GROUP
(2, 1, 
BW_40
),

228 
MCS_GROUP
(3, 1, 
BW_40
),

229 
MCS_GROUP
(4, 1, 
BW_40
),

231 
CCK_GROUP
,

232 
OFDM_GROUP
,

234 
VHT_GROUP
(1, 0, 
BW_20
),

235 
VHT_GROUP
(2, 0, 
BW_20
),

236 
VHT_GROUP
(3, 0, 
BW_20
),

237 
VHT_GROUP
(4, 0, 
BW_20
),

239 
VHT_GROUP
(1, 1, 
BW_20
),

240 
VHT_GROUP
(2, 1, 
BW_20
),

241 
VHT_GROUP
(3, 1, 
BW_20
),

242 
VHT_GROUP
(4, 1, 
BW_20
),

244 
VHT_GROUP
(1, 0, 
BW_40
),

245 
VHT_GROUP
(2, 0, 
BW_40
),

246 
VHT_GROUP
(3, 0, 
BW_40
),

247 
VHT_GROUP
(4, 0, 
BW_40
),

249 
VHT_GROUP
(1, 1, 
BW_40
),

250 
VHT_GROUP
(2, 1, 
BW_40
),

251 
VHT_GROUP
(3, 1, 
BW_40
),

252 
VHT_GROUP
(4, 1, 
BW_40
),

254 
VHT_GROUP
(1, 0, 
BW_80
),

255 
VHT_GROUP
(2, 0, 
BW_80
),

256 
VHT_GROUP
(3, 0, 
BW_80
),

257 
VHT_GROUP
(4, 0, 
BW_80
),

259 
VHT_GROUP
(1, 1, 
BW_80
),

260 
VHT_GROUP
(2, 1, 
BW_80
),

261 
VHT_GROUP
(3, 1, 
BW_80
),

262 
VHT_GROUP
(4, 1, 
BW_80
),

265 cÚ¡ 
s16
 
	gmš¡»l_cck_b™¿‹s
[4] = { 10, 20, 55, 110 };

266 cÚ¡ 
s16
 
	gmš¡»l_ofdm_b™¿‹s
[8] = { 60, 90, 120, 180, 240, 360, 480, 540 };

267 
u8
 
	g§m¶e_bË
[
SAMPLE_COLUMNS
][
MCS_GROUP_RATES
] 
	g__»ad_mo¡ly
;

268 cÚ¡ 
u8
 
	gmš¡»l_§m¶e_£q
[] = {

269 
MINSTREL_SAMPLE_TYPE_INC
,

270 
MINSTREL_SAMPLE_TYPE_JUMP
,

271 
MINSTREL_SAMPLE_TYPE_INC
,

272 
MINSTREL_SAMPLE_TYPE_JUMP
,

273 
MINSTREL_SAMPLE_TYPE_INC
,

274 
MINSTREL_SAMPLE_TYPE_SLOW
,

278 
mš¡»l_ht_upd©e_¿‹s
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
);

286 
u16


287 
	$mš¡»l_g‘_v®id_vht_¿‹s
(
bw
, 
nss
, 
__Ë16
 
mcs_m­
)

289 
u16
 
mask
 = 0;

291 ià(
bw
 =ğ
BW_20
) {

292 ià(
nss
 != 3 &&‚ss != 6)

293 
mask
 = 
	`BIT
(9);

294 } ià(
bw
 =ğ
BW_80
) {

295 ià(
nss
 == 3 ||‚ss == 7)

296 
mask
 = 
	`BIT
(6);

297 ià(
nss
 == 6)

298 
mask
 = 
	`BIT
(9);

300 
	`WARN_ON
(
bw
 !ğ
BW_40
);

303 (
	`Ë16_to_ıu
(
mcs_m­
è>> (2 * (
nss
 - 1))) & 3) {

304 
IEEE80211_VHT_MCS_SUPPORT_0_7
:

305 
mask
 |= 0x300;

307 
IEEE80211_VHT_MCS_SUPPORT_0_8
:

308 
mask
 |= 0x200;

310 
IEEE80211_VHT_MCS_SUPPORT_0_9
:

313 
mask
 = 0x3ff;

316  0x3fà& ~
mask
;

317 
	}
}

319 
boŞ


320 
	$mš¡»l_ht_is_Ëgacy_group
(
group
)

322  
group
 =ğ
MINSTREL_CCK_GROUP
 ||

323 
group
 =ğ
MINSTREL_OFDM_GROUP
;

324 
	}
}

330 
	$mš¡»l_ht_g‘_group_idx
(
›“80211_tx_¿‹
 *
¿‹
)

332  
	`GROUP_IDX
((
¿‹
->
idx
 / 8) + 1,

333 !!(
¿‹
->
æags
 & 
IEEE80211_TX_RC_SHORT_GI
),

334 !!(
¿‹
->
æags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
));

335 
	}
}

341 
	$mš¡»l_ht_ri_g‘_group_idx
(
¿‹_šfo
 *
¿‹
)

343  
	`GROUP_IDX
((
¿‹
->
mcs
 / 8) + 1,

344 !!(
¿‹
->
æags
 & 
RATE_INFO_FLAGS_SHORT_GI
),

345 !!(
¿‹
->
bw
 & 
RATE_INFO_BW_40
));

346 
	}
}

349 
	$mš¡»l_vht_g‘_group_idx
(
›“80211_tx_¿‹
 *
¿‹
)

351  
	`VHT_GROUP_IDX
(
	`›“80211_¿‹_g‘_vht_nss
(
¿‹
),

352 !!(
¿‹
->
æags
 & 
IEEE80211_TX_RC_SHORT_GI
),

353 !!(
¿‹
->
æags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
) +

354 2*!!(
¿‹
->
æags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
));

355 
	}
}

361 
	$mš¡»l_vht_ri_g‘_group_idx
(
¿‹_šfo
 *
¿‹
)

363  
	`VHT_GROUP_IDX
(
¿‹
->
nss
,

364 !!(
¿‹
->
æags
 & 
RATE_INFO_FLAGS_SHORT_GI
),

365 !!(
¿‹
->
bw
 & 
RATE_INFO_BW_40
) +

366 2*!!(
¿‹
->
bw
 & 
RATE_INFO_BW_80
));

367 
	}
}

369 
mš¡»l_¿‹_¡©s
 *

370 
	$mš¡»l_ht_g‘_¡©s
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

371 
›“80211_tx_¿‹
 *
¿‹
)

373 
group
, 
idx
;

375 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_MCS
) {

376 
group
 = 
	`mš¡»l_ht_g‘_group_idx
(
¿‹
);

377 
idx
 = 
¿‹
->idx % 8;

378 
out
;

381 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

382 
group
 = 
	`mš¡»l_vht_g‘_group_idx
(
¿‹
);

383 
idx
 = 
	`›“80211_¿‹_g‘_vht_mcs
(
¿‹
);

384 
out
;

387 
group
 = 
MINSTREL_CCK_GROUP
;

388 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
mp
->
cck_¿‹s
); idx++) {

389 ià(!(
mi
->
suµÜ‹d
[
group
] & 
	`BIT
(
idx
)))

392 ià(
¿‹
->
idx
 !ğ
mp
->
cck_¿‹s
[idx])

396 ià((
mi
->
suµÜ‹d
[
group
] & 
	`BIT
(
idx
 + 4)) &&

397 (
¿‹
->
æags
 & 
IEEE80211_TX_RC_USE_SHORT_PREAMBLE
))

398 
idx
 += 4;

399 
out
;

402 
group
 = 
MINSTREL_OFDM_GROUP
;

403 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[0]); idx++)

404 ià(
¿‹
->
idx
 =ğ
mp
->
ofdm_¿‹s
[
mi
->
bªd
][idx])

405 
out
;

407 
idx
 = 0;

408 
out
:

409  &
mi
->
groups
[
group
].
¿‹s
[
idx
];

410 
	}
}

415 
mš¡»l_¿‹_¡©s
 *

416 
	$mš¡»l_ht_ri_g‘_¡©s
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

417 
›“80211_¿‹_¡©us
 *
¿‹_¡©us
)

419 
group
, 
idx
;

420 
¿‹_šfo
 *
¿‹
 = &
¿‹_¡©us
->
¿‹_idx
;

422 ià(
¿‹
->
æags
 & 
RATE_INFO_FLAGS_MCS
) {

423 
group
 = 
	`mš¡»l_ht_ri_g‘_group_idx
(
¿‹
);

424 
idx
 = 
¿‹
->
mcs
 % 8;

425 
out
;

428 ià(
¿‹
->
æags
 & 
RATE_INFO_FLAGS_VHT_MCS
) {

429 
group
 = 
	`mš¡»l_vht_ri_g‘_group_idx
(
¿‹
);

430 
idx
 = 
¿‹
->
mcs
;

431 
out
;

434 
group
 = 
MINSTREL_CCK_GROUP
;

435 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
mp
->
cck_¿‹s
); idx++) {

436 ià(
¿‹
->
Ëgacy
 !ğ
mš¡»l_cck_b™¿‹s
[ 
mp
->
cck_¿‹s
[
idx
] ])

440 ià((
mi
->
suµÜ‹d
[
group
] & 
	`BIT
(
idx
 + 4)) &&

441 
mi
->
u£_shÜt_´—mbË
)

442 
idx
 += 4;

443 
out
;

446 
group
 = 
MINSTREL_OFDM_GROUP
;

447 
idx
 = 0; idx < 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[0]); idx++)

448 ià(
¿‹
->
Ëgacy
 =ğ
mš¡»l_ofdm_b™¿‹s
[ 
mp
->
ofdm_¿‹s
[
mi
->
bªd
][
idx
] ])

449 
out
;

451 
idx
 = 0;

452 
out
:

453  &
mi
->
groups
[
group
].
¿‹s
[
idx
];

454 
	}
}

456 
šlše
 
mš¡»l_¿‹_¡©s
 *

457 
	$mš¡»l_g‘_¿‹¡©s
(
mš¡»l_ht_¡a
 *
mi
, 
šdex
)

459  &
mi
->
groups
[
	`MI_RATE_GROUP
(
šdex
)].
¿‹s
[
	`MI_RATE_IDX
(index)];

460 
	}
}

462 
šlše
 
	$mš¡»l_g‘_du¿tiÚ
(
šdex
)

464 cÚ¡ 
mcs_group
 *
group
 = &
mš¡»l_mcs_groups
[
	`MI_RATE_GROUP
(
šdex
)];

465 
du¿tiÚ
 = 
group
->du¿tiÚ[
	`MI_RATE_IDX
(
šdex
)];

467  
du¿tiÚ
 << 
group
->
shiá
;

468 
	}
}

471 
	$mš¡»l_ht_avg_ampdu_Ën
(
mš¡»l_ht_¡a
 *
mi
)

473 
du¿tiÚ
;

475 ià(
mi
->
avg_ampdu_Ën
)

476  
	`MINSTREL_TRUNC
(
mi
->
avg_ampdu_Ën
);

478 ià(
	`mš¡»l_ht_is_Ëgacy_group
(
	`MI_RATE_GROUP
(
mi
->
max__¿‹
[0])))

481 
du¿tiÚ
 = 
	`mš¡»l_g‘_du¿tiÚ
(
mi
->
max__¿‹
[0]);

483 ià(
du¿tiÚ
 > 400 * 1000)

486 ià(
du¿tiÚ
 > 250 * 1000)

489 ià(
du¿tiÚ
 > 150 * 1000)

493 
	}
}

500 
	$mš¡»l_ht_g‘__avg
(
mš¡»l_ht_¡a
 *
mi
, 
group
, 
¿‹
,

501 
´ob_avg
)

503 
n£cs
 = 0, 
ov”h—d
 = 
mi
->overhead;

504 
ampdu_Ën
 = 1;

507 ià(
´ob_avg
 < 
	`MINSTREL_FRAC
(10, 100))

510 ià(
	`mš¡»l_ht_is_Ëgacy_group
(
group
))

511 
ov”h—d
 = 
mi
->
ov”h—d_Ëgacy
;

513 
ampdu_Ën
 = 
	`mš¡»l_ht_avg_ampdu_Ën
(
mi
);

515 
n£cs
 = 1000 * 
ov”h—d
 / 
ampdu_Ën
;

516 
n£cs
 +ğ
mš¡»l_mcs_groups
[
group
].
du¿tiÚ
[
¿‹
] <<

517 
mš¡»l_mcs_groups
[
group
].
shiá
;

524 ià(
´ob_avg
 > 
	`MINSTREL_FRAC
(90, 100))

525 
´ob_avg
 = 
	`MINSTREL_FRAC
(90, 100);

527  
	`MINSTREL_TRUNC
(100 * ((
´ob_avg
 * 1000000è/ 
n£cs
));

528 
	}
}

538 
	$mš¡»l_ht_sÜt_be¡__¿‹s
(
mš¡»l_ht_¡a
 *
mi
, 
u16
 
šdex
,

539 
u16
 *
_li¡
)

541 
cur_group
, 
cur_idx
, 
cur__avg
, 
cur_´ob
;

542 
tmp_group
, 
tmp_idx
, 
tmp__avg
, 
tmp_´ob
;

543 
j
 = 
MAX_THR_RATES
;

545 
cur_group
 = 
	`MI_RATE_GROUP
(
šdex
);

546 
cur_idx
 = 
	`MI_RATE_IDX
(
šdex
);

547 
cur_´ob
 = 
mi
->
groups
[
cur_group
].
¿‹s
[
cur_idx
].
´ob_avg
;

548 
cur__avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
cur_group
, 
cur_idx
, 
cur_´ob
);

551 
tmp_group
 = 
	`MI_RATE_GROUP
(
_li¡
[
j
 - 1]);

552 
tmp_idx
 = 
	`MI_RATE_IDX
(
_li¡
[
j
 - 1]);

553 
tmp_´ob
 = 
mi
->
groups
[
tmp_group
].
¿‹s
[
tmp_idx
].
´ob_avg
;

554 
tmp__avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
tmp_group
, 
tmp_idx
,

555 
tmp_´ob
);

556 ià(
cur__avg
 < 
tmp__avg
 ||

557 (
cur__avg
 =ğ
tmp__avg
 && 
cur_´ob
 <ğ
tmp_´ob
))

559 
j
--;

560 } 
j
 > 0);

562 ià(
j
 < 
MAX_THR_RATES
 - 1) {

563 
	`memmove
(&
_li¡
[
j
 + 1], &tp_list[j], ((*tp_list) *

564 (
MAX_THR_RATES
 - (
j
 + 1))));

566 ià(
j
 < 
MAX_THR_RATES
)

567 
_li¡
[
j
] = 
šdex
;

568 
	}
}

574 
	$mš¡»l_ht_£t_be¡_´ob_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
u16
 *
de¡
, u16 
šdex
)

576 
mš¡»l_mcs_group_d©a
 *
mg
;

577 
mš¡»l_¿‹_¡©s
 *
mrs
;

578 
tmp_group
, 
tmp_idx
, 
tmp__avg
, 
tmp_´ob
;

579 
max__group
, 
max__idx
, 
max__´ob
;

580 
cur__avg
, 
cur_group
, 
cur_idx
;

581 
max_g´_group
, 
max_g´_idx
;

582 
max_g´__avg
, 
max_g´_´ob
;

584 
cur_group
 = 
	`MI_RATE_GROUP
(
šdex
);

585 
cur_idx
 = 
	`MI_RATE_IDX
(
šdex
);

586 
mg
 = &
mi
->
groups
[
cur_group
];

587 
mrs
 = &
mg
->
¿‹s
[
cur_idx
];

589 
tmp_group
 = 
	`MI_RATE_GROUP
(*
de¡
);

590 
tmp_idx
 = 
	`MI_RATE_IDX
(*
de¡
);

591 
tmp_´ob
 = 
mi
->
groups
[
tmp_group
].
¿‹s
[
tmp_idx
].
´ob_avg
;

592 
tmp__avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
tmp_group
, 
tmp_idx
, 
tmp_´ob
);

596 
max__group
 = 
	`MI_RATE_GROUP
(
mi
->
max__¿‹
[0]);

597 
max__idx
 = 
	`MI_RATE_IDX
(
mi
->
max__¿‹
[0]);

598 
max__´ob
 = 
mi
->
groups
[
max__group
].
¿‹s
[
max__idx
].
´ob_avg
;

600 ià(
	`mš¡»l_ht_is_Ëgacy_group
(
	`MI_RATE_GROUP
(
šdex
)) &&

601 !
	`mš¡»l_ht_is_Ëgacy_group
(
max__group
))

605 ià(
	`mš¡»l_g‘_du¿tiÚ
(
mi
->
max__¿‹
[0]è> mš¡»l_g‘_du¿tiÚ(
šdex
) &&

606 
mrs
->
´ob_avg
 < 
max__´ob
)

609 
max_g´_group
 = 
	`MI_RATE_GROUP
(
mg
->
max_group_´ob_¿‹
);

610 
max_g´_idx
 = 
	`MI_RATE_IDX
(
mg
->
max_group_´ob_¿‹
);

611 
max_g´_´ob
 = 
mi
->
groups
[
max_g´_group
].
¿‹s
[
max_g´_idx
].
´ob_avg
;

613 ià(
mrs
->
´ob_avg
 > 
	`MINSTREL_FRAC
(75, 100)) {

614 
cur__avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
cur_group
, 
cur_idx
,

615 
mrs
->
´ob_avg
);

616 ià(
cur__avg
 > 
tmp__avg
)

617 *
de¡
 = 
šdex
;

619 
max_g´__avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
max_g´_group
,

620 
max_g´_idx
,

621 
max_g´_´ob
);

622 ià(
cur__avg
 > 
max_g´__avg
)

623 
mg
->
max_group_´ob_¿‹
 = 
šdex
;

625 ià(
mrs
->
´ob_avg
 > 
tmp_´ob
)

626 *
de¡
 = 
šdex
;

627 ià(
mrs
->
´ob_avg
 > 
max_g´_´ob
)

628 
mg
->
max_group_´ob_¿‹
 = 
šdex
;

630 
	}
}

640 
	$mš¡»l_ht_assign_be¡__¿‹s
(
mš¡»l_ht_¡a
 *
mi
,

641 
u16
 
tmp_mcs__¿‹
[
MAX_THR_RATES
],

642 
u16
 
tmp_Ëgacy__¿‹
[
MAX_THR_RATES
])

644 
tmp_group
, 
tmp_idx
, 
tmp_cck_
, 
tmp_mcs_
, 
tmp_´ob
;

645 
i
;

647 
tmp_group
 = 
	`MI_RATE_GROUP
(
tmp_Ëgacy__¿‹
[0]);

648 
tmp_idx
 = 
	`MI_RATE_IDX
(
tmp_Ëgacy__¿‹
[0]);

649 
tmp_´ob
 = 
mi
->
groups
[
tmp_group
].
¿‹s
[
tmp_idx
].
´ob_avg
;

650 
tmp_cck_
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
tmp_group
, 
tmp_idx
, 
tmp_´ob
);

652 
tmp_group
 = 
	`MI_RATE_GROUP
(
tmp_mcs__¿‹
[0]);

653 
tmp_idx
 = 
	`MI_RATE_IDX
(
tmp_mcs__¿‹
[0]);

654 
tmp_´ob
 = 
mi
->
groups
[
tmp_group
].
¿‹s
[
tmp_idx
].
´ob_avg
;

655 
tmp_mcs_
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
tmp_group
, 
tmp_idx
, 
tmp_´ob
);

657 ià(
tmp_cck_
 > 
tmp_mcs_
) {

658 
i
 = 0; i < 
MAX_THR_RATES
; i++) {

659 
	`mš¡»l_ht_sÜt_be¡__¿‹s
(
mi
, 
tmp_Ëgacy__¿‹
[
i
],

660 
tmp_mcs__¿‹
);

664 
	}
}

670 
šlše
 

671 
	$mš¡»l_ht_´ob_¿‹_»duû_¡»ams
(
mš¡»l_ht_¡a
 *
mi
)

673 
mš¡»l_mcs_group_d©a
 *
mg
;

674 
tmp_max_¡»ams
, 
group
, 
tmp_idx
, 
tmp_´ob
;

675 
tmp_
 = 0;

677 ià(!
mi
->
¡a
->
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
)

680 
group
 = 
	`MI_RATE_GROUP
(
mi
->
max__¿‹
[0]);

681 
tmp_max_¡»ams
 = 
mš¡»l_mcs_groups
[
group
].
¡»ams
;

682 
group
 = 0; grou°< 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
); group++) {

683 
mg
 = &
mi
->
groups
[
group
];

684 ià(!
mi
->
suµÜ‹d
[
group
] || grou°=ğ
MINSTREL_CCK_GROUP
)

687 
tmp_idx
 = 
	`MI_RATE_IDX
(
mg
->
max_group_´ob_¿‹
);

688 
tmp_´ob
 = 
mi
->
groups
[
group
].
¿‹s
[
tmp_idx
].
´ob_avg
;

690 ià(
tmp_
 < 
	`mš¡»l_ht_g‘__avg
(
mi
, 
group
, 
tmp_idx
, 
tmp_´ob
) &&

691 (
mš¡»l_mcs_groups
[
group
].
¡»ams
 < 
tmp_max_¡»ams
)) {

692 
mi
->
max_´ob_¿‹
 = 
mg
->
max_group_´ob_¿‹
;

693 
tmp_
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
group
,

694 
tmp_idx
,

695 
tmp_´ob
);

698 
	}
}

700 
u16


701 
	$__mš¡»l_ht_g‘_§m¶e_¿‹
(
mš¡»l_ht_¡a
 *
mi
,

702 
mš¡»l_§m¶e_ty³
 
ty³
)

704 
u16
 *
¿‹s
 = 
mi
->
§m¶e
[
ty³
].
§m¶e_¿‹s
;

705 
u16
 
cur
;

706 
i
;

708 
i
 = 0; i < 
MINSTREL_SAMPLE_RATES
; i++) {

709 ià(!
¿‹s
[
i
])

712 
cur
 = 
¿‹s
[
i
];

713 
¿‹s
[
i
] = 0;

714  
cur
;

718 
	}
}

720 
šlše
 

721 
	$mš¡»l_ewma
(
Şd
, 
Ãw
, 
weight
)

723 
diff
, 
šü
;

725 
diff
 = 
Ãw
 - 
Şd
;

726 
šü
 = (
EWMA_DIV
 - 
weight
è* 
diff
 / EWMA_DIV;

728  
Şd
 + 
šü
;

729 
	}
}

731 
šlše
 
	$mš¡»l_f‹r_avg_add
(
u16
 *
´ev_1
, u16 *
´ev_2
, 
s32
 
š
)

733 
s32
 
out_1
 = *
´ev_1
;

734 
s32
 
out_2
 = *
´ev_2
;

735 
s32
 
v®
;

737 ià(!
š
)

738 
š
 += 1;

740 ià(!
out_1
) {

741 
v®
 = 
out_1
 = 
š
;

742 
out
;

745 
v®
 = 
MINSTREL_AVG_COEFF1
 * 
š
;

746 
v®
 +ğ
MINSTREL_AVG_COEFF2
 * 
out_1
;

747 
v®
 +ğ
MINSTREL_AVG_COEFF3
 * 
out_2
;

748 
v®
 >>ğ
MINSTREL_SCALE
;

750 ià(
v®
 > 1 << 
MINSTREL_SCALE
)

751 
v®
 = 1 << 
MINSTREL_SCALE
;

752 ià(
v®
 < 0)

753 
v®
 = 1;

755 
out
:

756 *
´ev_2
 = 
out_1
;

757 *
´ev_1
 = 
v®
;

759  
v®
;

760 
	}
}

766 
	$mš¡»l_ht_ÿlc_¿‹_¡©s
(
mš¡»l_´iv
 *
mp
,

767 
mš¡»l_¿‹_¡©s
 *
mrs
)

769 
cur_´ob
;

771 ià(
	`uÆik–y
(
mrs
->
©‹m±s
 > 0)) {

772 
cur_´ob
 = 
	`MINSTREL_FRAC
(
mrs
->
sucûss
, mrs->
©‹m±s
);

773 
	`mš¡»l_f‹r_avg_add
(&
mrs
->
´ob_avg
,

774 &
mrs
->
´ob_avg_1
, 
cur_´ob
);

775 
mrs
->
©t_hi¡
 +ğmrs->
©‹m±s
;

776 
mrs
->
succ_hi¡
 +ğmrs->
sucûss
;

779 
mrs
->
Ï¡_sucûss
 = mrs->
sucûss
;

780 
mrs
->
Ï¡_©‹m±s
 = mrs->
©‹m±s
;

781 
mrs
->
sucûss
 = 0;

782 
mrs
->
©‹m±s
 = 0;

783 
	}
}

785 
boŞ


786 
	$mš¡»l_ht_fšd_§m¶e_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
ty³
, 
idx
)

788 
i
;

790 
i
 = 0; i < 
MINSTREL_SAMPLE_RATES
; i++) {

791 
u16
 
cur
 = 
mi
->
§m¶e
[
ty³
].
§m¶e_¿‹s
[
i
];

793 ià(
cur
 =ğ
idx
)

794  
Œue
;

796 ià(!
cur
)

800  
çl£
;

801 
	}
}

804 
	$mš¡»l_ht_move_§m¶e_¿‹s
(
mš¡»l_ht_¡a
 *
mi
, 
ty³
,

805 
u32
 
ç¡_¿‹_dur
, u32 
¦ow_¿‹_dur
)

807 
u16
 *
¿‹s
 = 
mi
->
§m¶e
[
ty³
].
§m¶e_¿‹s
;

808 
i
, 
j
;

810 
i
 = 0, 
j
 = 0; i < 
MINSTREL_SAMPLE_RATES
; i++) {

811 
u32
 
du¿tiÚ
;

812 
boŞ
 
v®id
 = 
çl£
;

813 
u16
 
cur
;

815 
cur
 = 
¿‹s
[
i
];

816 ià(!
cur
)

819 
du¿tiÚ
 = 
	`mš¡»l_g‘_du¿tiÚ
(
cur
);

820 
ty³
) {

821 
MINSTREL_SAMPLE_TYPE_SLOW
:

822 
v®id
 = 
du¿tiÚ
 > 
ç¡_¿‹_dur
 &&

823 
du¿tiÚ
 < 
¦ow_¿‹_dur
;

825 
MINSTREL_SAMPLE_TYPE_INC
:

826 
MINSTREL_SAMPLE_TYPE_JUMP
:

827 
v®id
 = 
du¿tiÚ
 < 
ç¡_¿‹_dur
;

830 
v®id
 = 
çl£
;

834 ià(!
v®id
) {

835 
¿‹s
[
i
] = 0;

839 ià(
i
 =ğ
j
)

842 
¿‹s
[
j
++] = 
cur
;

843 
¿‹s
[
i
] = 0;

846  
j
;

847 
	}
}

850 
	$mš¡»l_ht_group_mš_¿‹_off£t
(
mš¡»l_ht_¡a
 *
mi
, 
group
,

851 
u32
 
max_du¿tiÚ
)

853 
u16
 
suµÜ‹d
 = 
mi
->suµÜ‹d[
group
];

854 
i
;

856 
i
 = 0; i < 
MCS_GROUP_RATES
 && 
suµÜ‹d
; i++, supported >>= 1) {

857 ià(!(
suµÜ‹d
 & 
	`BIT
(0)))

860 ià(
	`mš¡»l_g‘_du¿tiÚ
(
	`MI_RATE
(
group
, 
i
)è>ğ
max_du¿tiÚ
)

863  
i
;

867 
	}
}

874 
u16


875 
	$mš¡»l_ht_Ãxt_šc_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
u32
 
ç¡_¿‹_dur
)

877 
u8
 
ty³
 = 
MINSTREL_SAMPLE_TYPE_INC
;

878 
i
, 
šdex
 = 0;

879 
u8
 
group
;

881 
group
 = 
mi
->
§m¶e
[
ty³
].
§m¶e_group
;

882 
i
 = 0; i < 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
); i++) {

883 
group
 = (grou°+ 1è% 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
);

885 
šdex
 = 
	`mš¡»l_ht_group_mš_¿‹_off£t
(
mi
, 
group
,

886 
ç¡_¿‹_dur
);

887 ià(
šdex
 < 0)

890 
šdex
 = 
	`MI_RATE
(
group
, index & 0xf);

891 ià(!
	`mš¡»l_ht_fšd_§m¶e_¿‹
(
mi
, 
ty³
, 
šdex
))

892 
out
;

894 
šdex
 = 0;

896 
out
:

897 
mi
->
§m¶e
[
ty³
].
§m¶e_group
 = 
group
;

899  
šdex
;

900 
	}
}

903 
	$mš¡»l_ht_Ãxt_group_§m¶e_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
group
,

904 
u16
 
suµÜ‹d
, 
off£t
)

906 
mš¡»l_mcs_group_d©a
 *
mg
 = &
mi
->
groups
[
group
];

907 
u16
 
idx
;

908 
i
;

910 
i
 = 0; i < 
MCS_GROUP_RATES
; i++) {

911 
idx
 = 
§m¶e_bË
[
mg
->
cŞumn
][mg->
šdex
];

912 ià(++
mg
->
šdex
 >ğ
MCS_GROUP_RATES
) {

913 
mg
->
šdex
 = 0;

914 ià(++
mg
->
cŞumn
 >ğ
	`ARRAY_SIZE
(
§m¶e_bË
))

915 
mg
->
cŞumn
 = 0;

918 ià(
idx
 < 
off£t
)

921 ià(!(
suµÜ‹d
 & 
	`BIT
(
idx
)))

924  
	`MI_RATE
(
group
, 
idx
);

928 
	}
}

936 
u16


937 
	$mš¡»l_ht_Ãxt_jump_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
u32
 
ç¡_¿‹_dur
,

938 
u32
 
¦ow_¿‹_dur
, *
¦ow_¿‹_ofs
)

940 
mš¡»l_¿‹_¡©s
 *
mrs
;

941 
u32
 
max_du¿tiÚ
 = 
¦ow_¿‹_dur
;

942 
i
, 
šdex
, 
off£t
;

943 
u16
 *
¦ow_¿‹s
;

944 
u16
 
suµÜ‹d
;

945 
u32
 
du¿tiÚ
;

946 
u8
 
group
;

948 ià(*
¦ow_¿‹_ofs
 >ğ
MINSTREL_SAMPLE_RATES
)

949 
max_du¿tiÚ
 = 
ç¡_¿‹_dur
;

951 
¦ow_¿‹s
 = 
mi
->
§m¶e
[
MINSTREL_SAMPLE_TYPE_SLOW
].
§m¶e_¿‹s
;

952 
group
 = 
mi
->
§m¶e
[
MINSTREL_SAMPLE_TYPE_JUMP
].
§m¶e_group
;

953 
i
 = 0; i < 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
); i++) {

954 
u8
 
ty³
;

956 
group
 = (grou°+ 1è% 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
);

958 
suµÜ‹d
 = 
mi
->suµÜ‹d[
group
];

959 ià(!
suµÜ‹d
)

962 
off£t
 = 
	`mš¡»l_ht_group_mš_¿‹_off£t
(
mi
, 
group
,

963 
max_du¿tiÚ
);

964 ià(
off£t
 < 0)

967 
šdex
 = 
	`mš¡»l_ht_Ãxt_group_§m¶e_¿‹
(
mi
, 
group
, 
suµÜ‹d
,

968 
off£t
);

969 ià(
šdex
 < 0)

972 
du¿tiÚ
 = 
	`mš¡»l_g‘_du¿tiÚ
(
šdex
);

973 ià(
du¿tiÚ
 < 
ç¡_¿‹_dur
)

974 
ty³
 = 
MINSTREL_SAMPLE_TYPE_JUMP
;

976 
ty³
 = 
MINSTREL_SAMPLE_TYPE_SLOW
;

978 ià(
	`mš¡»l_ht_fšd_§m¶e_¿‹
(
mi
, 
ty³
, 
šdex
))

981 ià(
ty³
 =ğ
MINSTREL_SAMPLE_TYPE_JUMP
)

982 
found
;

984 ià(*
¦ow_¿‹_ofs
 >ğ
MINSTREL_SAMPLE_RATES
)

987 ià(
du¿tiÚ
 >ğ
¦ow_¿‹_dur
)

991 
mrs
 = 
	`mš¡»l_g‘_¿‹¡©s
(
mi
, 
šdex
);

992 ià(
mrs
->
´ob_avg
 > 
	`MINSTREL_FRAC
(95, 100))

995 
¦ow_¿‹s
[(*
¦ow_¿‹_ofs
)++] = 
šdex
;

996 ià(*
¦ow_¿‹_ofs
 >ğ
MINSTREL_SAMPLE_RATES
)

997 
max_du¿tiÚ
 = 
ç¡_¿‹_dur
;

999 
šdex
 = 0;

1001 
found
:

1002 
mi
->
§m¶e
[
MINSTREL_SAMPLE_TYPE_JUMP
].
§m¶e_group
 = 
group
;

1004  
šdex
;

1005 
	}
}

1008 
	$mš¡»l_ht_»fl_§m¶e_¿‹s
(
mš¡»l_ht_¡a
 *
mi
)

1010 
u32
 
´ob_dur
 = 
	`mš¡»l_g‘_du¿tiÚ
(
mi
->
max_´ob_¿‹
);

1011 
u32
 
_dur
 = 
	`mš¡»l_g‘_du¿tiÚ
(
mi
->
max__¿‹
[0]);

1012 
u32
 
2_dur
 = 
	`mš¡»l_g‘_du¿tiÚ
(
mi
->
max__¿‹
[1]);

1013 
u32
 
ç¡_¿‹_dur
 = 
	`mš
(mš(
_dur
, 
2_dur
), 
´ob_dur
);

1014 
u32
 
¦ow_¿‹_dur
 = 
	`max
(max(
_dur
, 
2_dur
), 
´ob_dur
);

1015 
u16
 *
¿‹s
;

1016 
i
, 
j
;

1018 
¿‹s
 = 
mi
->
§m¶e
[
MINSTREL_SAMPLE_TYPE_INC
].
§m¶e_¿‹s
;

1019 
i
 = 
	`mš¡»l_ht_move_§m¶e_¿‹s
(
mi
, 
MINSTREL_SAMPLE_TYPE_INC
,

1020 
ç¡_¿‹_dur
, 
¦ow_¿‹_dur
);

1021 
i
 < 
MINSTREL_SAMPLE_RATES
) {

1022 
¿‹s
[
i
] = 
	`mš¡»l_ht_Ãxt_šc_¿‹
(
mi
, 
_dur
);

1023 ià(!
¿‹s
[
i
])

1026 
i
++;

1029 
¿‹s
 = 
mi
->
§m¶e
[
MINSTREL_SAMPLE_TYPE_JUMP
].
§m¶e_¿‹s
;

1030 
i
 = 
	`mš¡»l_ht_move_§m¶e_¿‹s
(
mi
, 
MINSTREL_SAMPLE_TYPE_JUMP
,

1031 
ç¡_¿‹_dur
, 
¦ow_¿‹_dur
);

1032 
j
 = 
	`mš¡»l_ht_move_§m¶e_¿‹s
(
mi
, 
MINSTREL_SAMPLE_TYPE_SLOW
,

1033 
ç¡_¿‹_dur
, 
¦ow_¿‹_dur
);

1034 
i
 < 
MINSTREL_SAMPLE_RATES
) {

1035 
¿‹s
[
i
] = 
	`mš¡»l_ht_Ãxt_jump_¿‹
(
mi
, 
ç¡_¿‹_dur
,

1036 
¦ow_¿‹_dur
, &
j
);

1037 ià(!
¿‹s
[
i
])

1040 
i
++;

1043 
i
 = 0; i < 
	`ARRAY_SIZE
(
mi
->
§m¶e
); i++)

1044 
	`memıy
(
mi
->
§m¶e
[
i
].
cur_§m¶e_¿‹s
, mi->§m¶e[i].
§m¶e_¿‹s
,

1045 (
mi
->
§m¶e
[
i
].
cur_§m¶e_¿‹s
));

1046 
	}
}

1059 
	$mš¡»l_ht_upd©e_¡©s
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
)

1061 
mš¡»l_mcs_group_d©a
 *
mg
;

1062 
mš¡»l_¿‹_¡©s
 *
mrs
;

1063 
group
, 
i
, 
j
, 
cur_´ob
;

1064 
u16
 
tmp_mcs__¿‹
[
MAX_THR_RATES
], 
tmp_group__¿‹
[MAX_THR_RATES];

1065 
u16
 
tmp_Ëgacy__¿‹
[
MAX_THR_RATES
], 
tmp_max_´ob_¿‹
;

1066 
u16
 
šdex
;

1067 
boŞ
 
ht_suµÜ‹d
 = 
mi
->
¡a
->
deæšk
.
ht_ÿp
.ht_supported;

1069 ià(
mi
->
ampdu_·ck‘s
 > 0) {

1070 ià(!
	`›“80211_hw_check
(
mp
->
hw
, 
TX_STATUS_NO_AMPDU_LEN
))

1071 
mi
->
avg_ampdu_Ën
 = 
	`mš¡»l_ewma
(mi->avg_ampdu_len,

1072 
	`MINSTREL_FRAC
(
mi
->
ampdu_Ën
, mi->
ampdu_·ck‘s
),

1073 
EWMA_LEVEL
);

1075 
mi
->
avg_ampdu_Ën
 = 0;

1076 
mi
->
ampdu_Ën
 = 0;

1077 
mi
->
ampdu_·ck‘s
 = 0;

1080 ià(
mi
->
suµÜ‹d
[
MINSTREL_CCK_GROUP
])

1081 
group
 = 
MINSTREL_CCK_GROUP
;

1082 ià(
mi
->
suµÜ‹d
[
MINSTREL_OFDM_GROUP
])

1083 
group
 = 
MINSTREL_OFDM_GROUP
;

1085 
group
 = 0;

1087 
šdex
 = 
	`MI_RATE
(
group
, 0);

1088 
j
 = 0; j < 
	`ARRAY_SIZE
(
tmp_Ëgacy__¿‹
); j++)

1089 
tmp_Ëgacy__¿‹
[
j
] = 
šdex
;

1091 ià(
mi
->
suµÜ‹d
[
MINSTREL_VHT_GROUP_0
])

1092 
group
 = 
MINSTREL_VHT_GROUP_0
;

1093 ià(
ht_suµÜ‹d
)

1094 
group
 = 
MINSTREL_HT_GROUP_0
;

1095 ià(
mi
->
suµÜ‹d
[
MINSTREL_CCK_GROUP
])

1096 
group
 = 
MINSTREL_CCK_GROUP
;

1098 
group
 = 
MINSTREL_OFDM_GROUP
;

1100 
šdex
 = 
	`MI_RATE
(
group
, 0);

1101 
tmp_max_´ob_¿‹
 = 
šdex
;

1102 
j
 = 0; j < 
	`ARRAY_SIZE
(
tmp_mcs__¿‹
); j++)

1103 
tmp_mcs__¿‹
[
j
] = 
šdex
;

1106 
group
 = 0; grou°< 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
); group++) {

1107 
u16
 *
_¿‹
 = 
tmp_mcs__¿‹
;

1108 
u16
 
Ï¡_´ob
 = 0;

1110 
mg
 = &
mi
->
groups
[
group
];

1111 ià(!
mi
->
suµÜ‹d
[
group
])

1115 
j
 = 0; j < 
MAX_THR_RATES
; j++)

1116 
tmp_group__¿‹
[
j
] = 
	`MI_RATE
(
group
, 0);

1118 ià(
group
 =ğ
MINSTREL_CCK_GROUP
 && 
ht_suµÜ‹d
)

1119 
_¿‹
 = 
tmp_Ëgacy__¿‹
;

1121 
i
 = 
MCS_GROUP_RATES
 - 1; i >= 0; i--) {

1122 ià(!(
mi
->
suµÜ‹d
[
group
] & 
	`BIT
(
i
)))

1125 
šdex
 = 
	`MI_RATE
(
group
, 
i
);

1127 
mrs
 = &
mg
->
¿‹s
[
i
];

1128 
mrs
->
»Œy_upd©ed
 = 
çl£
;

1129 
	`mš¡»l_ht_ÿlc_¿‹_¡©s
(
mp
, 
mrs
);

1131 ià(
mrs
->
©t_hi¡
)

1132 
Ï¡_´ob
 = 
	`max
Öa¡_´ob, 
mrs
->
´ob_avg
);

1134 
mrs
->
´ob_avg
 = 
	`max
(
Ï¡_´ob
, mrs->prob_avg);

1135 
cur_´ob
 = 
mrs
->
´ob_avg
;

1137 ià(
	`mš¡»l_ht_g‘__avg
(
mi
, 
group
, 
i
, 
cur_´ob
) == 0)

1141 
	`mš¡»l_ht_sÜt_be¡__¿‹s
(
mi
, 
šdex
, 
_¿‹
);

1144 
	`mš¡»l_ht_sÜt_be¡__¿‹s
(
mi
, 
šdex
,

1145 
tmp_group__¿‹
);

1148 
	`memıy
(
mg
->
max_group__¿‹
, 
tmp_group__¿‹
,

1149 (
mg
->
max_group__¿‹
));

1153 
	`mš¡»l_ht_assign_be¡__¿‹s
(
mi
, 
tmp_mcs__¿‹
,

1154 
tmp_Ëgacy__¿‹
);

1155 
	`memıy
(
mi
->
max__¿‹
, 
tmp_mcs__¿‹
, (mi->max_tp_rate));

1157 
group
 = 0; grou°< 
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
); group++) {

1158 ià(!
mi
->
suµÜ‹d
[
group
])

1161 
mg
 = &
mi
->
groups
[
group
];

1162 
mg
->
max_group_´ob_¿‹
 = 
	`MI_RATE
(
group
, 0);

1164 
i
 = 0; i < 
MCS_GROUP_RATES
; i++) {

1165 ià(!(
mi
->
suµÜ‹d
[
group
] & 
	`BIT
(
i
)))

1168 
šdex
 = 
	`MI_RATE
(
group
, 
i
);

1171 
	`mš¡»l_ht_£t_be¡_´ob_¿‹
(
mi
, &
tmp_max_´ob_¿‹
,

1172 
šdex
);

1176 
mi
->
max_´ob_¿‹
 = 
tmp_max_´ob_¿‹
;

1179 
	`mš¡»l_ht_´ob_¿‹_»duû_¡»ams
(
mi
);

1180 
	`mš¡»l_ht_»fl_§m¶e_¿‹s
(
mi
);

1182 #ifdeà
CONFIG_MAC80211_DEBUGFS


1184 ià(
mp
->
fixed_¿‹_idx
 != -1) {

1185 
i
 = 0; i < 4; i++)

1186 
mi
->
max__¿‹
[
i
] = 
mp
->
fixed_¿‹_idx
;

1187 
mi
->
max_´ob_¿‹
 = 
mp
->
fixed_¿‹_idx
;

1192 
mi
->
Ï¡_¡©s_upd©e
 = 
jiff›s
;

1193 
mi
->
§m¶e_time
 = 
jiff›s
;

1194 
	}
}

1196 
boŞ


1197 
	$mš¡»l_ht_tx¡©_v®id
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

1198 
›“80211_tx_¿‹
 *
¿‹
)

1200 
i
;

1202 ià(
¿‹
->
idx
 < 0)

1203  
çl£
;

1205 ià(!
¿‹
->
couÁ
)

1206  
çl£
;

1208 ià(
¿‹
->
æags
 & 
IEEE80211_TX_RC_MCS
 ||

1209 
¿‹
->
æags
 & 
IEEE80211_TX_RC_VHT_MCS
)

1210  
Œue
;

1212 
i
 = 0; i < 
	`ARRAY_SIZE
(
mp
->
cck_¿‹s
); i++)

1213 ià(
¿‹
->
idx
 =ğ
mp
->
cck_¿‹s
[
i
])

1214  
Œue
;

1216 
i
 = 0; i < 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[0]); i++)

1217 ià(
¿‹
->
idx
 =ğ
mp
->
ofdm_¿‹s
[
mi
->
bªd
][
i
])

1218  
Œue
;

1220  
çl£
;

1221 
	}
}

1226 
boŞ


1227 
	$mš¡»l_ht_ri_tx¡©_v®id
(
mš¡»l_´iv
 *
mp
,

1228 
mš¡»l_ht_¡a
 *
mi
,

1229 
›“80211_¿‹_¡©us
 *
¿‹_¡©us
)

1231 
i
;

1233 ià(!
¿‹_¡©us
)

1234  
çl£
;

1235 ià(!
¿‹_¡©us
->
Œy_couÁ
)

1236  
çl£
;

1238 ià(
¿‹_¡©us
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_MCS
 ||

1239 
¿‹_¡©us
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_VHT_MCS
)

1240  
Œue
;

1242 
i
 = 0; i < 
	`ARRAY_SIZE
(
mp
->
cck_¿‹s
); i++) {

1243 ià(
¿‹_¡©us
->
¿‹_idx
.
Ëgacy
 ==

1244 
mš¡»l_cck_b™¿‹s
[ 
mp
->
cck_¿‹s
[
i
] ])

1245  
Œue
;

1248 
i
 = 0; i < 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
); i++) {

1249 ià(
¿‹_¡©us
->
¿‹_idx
.
Ëgacy
 ==

1250 
mš¡»l_ofdm_b™¿‹s
[ 
mp
->
ofdm_¿‹s
[
mi
->
bªd
][
i
] ])

1251  
Œue
;

1254  
çl£
;

1255 
	}
}

1258 
	$mš¡»l_downg¿de_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
u16
 *
idx
, 
boŞ
 
´im¬y
)

1260 
group
, 
Üig_group
;

1262 
Üig_group
 = 
group
 = 
	`MI_RATE_GROUP
(*
idx
);

1263 
group
 > 0) {

1264 
group
--;

1266 ià(!
mi
->
suµÜ‹d
[
group
])

1269 ià(
mš¡»l_mcs_groups
[
group
].
¡»ams
 >

1270 
mš¡»l_mcs_groups
[
Üig_group
].
¡»ams
)

1273 ià(
´im¬y
)

1274 *
idx
 = 
mi
->
groups
[
group
].
max_group__¿‹
[0];

1276 *
idx
 = 
mi
->
groups
[
group
].
max_group__¿‹
[1];

1279 
	}
}

1282 
	$mš¡»l_ht_tx_¡©us
(*
´iv
, 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1283 *
´iv_¡a
, 
›“80211_tx_¡©us
 *
¡
)

1285 
›“80211_tx_šfo
 *
šfo
 = 
¡
->info;

1286 
mš¡»l_ht_¡a
 *
mi
 = 
´iv_¡a
;

1287 
›“80211_tx_¿‹
 *
¬
 = 
šfo
->
¡©us
.
¿‹s
;

1288 
mš¡»l_¿‹_¡©s
 *
¿‹
, *
¿‹2
;

1289 
mš¡»l_´iv
 *
mp
 = 
´iv
;

1290 
u32
 
upd©e_š‹rv®
 = 
mp
->update_interval;

1291 
boŞ
 
Ï¡
, 
upd©e
 = 
çl£
;

1292 
i
;

1295 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_NO_ACK
)

1299 ià((
šfo
->
æags
 & 
IEEE80211_TX_CTL_AMPDU
) &&

1300 !(
šfo
->
æags
 & 
IEEE80211_TX_STAT_AMPDU
))

1303 ià(!(
šfo
->
æags
 & 
IEEE80211_TX_STAT_AMPDU
)) {

1304 
šfo
->
¡©us
.
ampdu_ack_Ën
 =

1305 (
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
 ? 1 : 0);

1306 
šfo
->
¡©us
.
ampdu_Ën
 = 1;

1310 ià(
mi
->
tÙ®_·ck‘s
 >ğ~0 - 
šfo
->
¡©us
.
ampdu_Ën
) {

1311 
mi
->
tÙ®_·ck‘s
 = 0;

1312 
mi
->
§m¶e_·ck‘s
 = 0;

1315 
mi
->
tÙ®_·ck‘s
 +ğ
šfo
->
¡©us
.
ampdu_Ën
;

1316 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_RATE_CTRL_PROBE
)

1317 
mi
->
§m¶e_·ck‘s
 +ğ
šfo
->
¡©us
.
ampdu_Ën
;

1319 
mi
->
ampdu_·ck‘s
++;

1320 
mi
->
ampdu_Ën
 +ğ
šfo
->
¡©us
.ampdu_len;

1322 ià(
¡
->
¿‹s
 && st->
n_¿‹s
) {

1323 
Ï¡
 = !
	`mš¡»l_ht_ri_tx¡©_v®id
(
mp
, 
mi
, &(
¡
->
¿‹s
[0]));

1324 
i
 = 0; !
Ï¡
; i++) {

1325 
Ï¡
 = (
i
 =ğ
¡
->
n_¿‹s
 - 1) ||

1326 !
	`mš¡»l_ht_ri_tx¡©_v®id
(
mp
, 
mi
,

1327 &(
¡
->
¿‹s
[
i
 + 1]));

1329 
¿‹
 = 
	`mš¡»l_ht_ri_g‘_¡©s
(
mp
, 
mi
,

1330 &(
¡
->
¿‹s
[
i
]));

1332 ià(
Ï¡
)

1333 
¿‹
->
sucûss
 +ğ
šfo
->
¡©us
.
ampdu_ack_Ën
;

1335 
¿‹
->
©‹m±s
 +ğ
¡
->
¿‹s
[
i
].
Œy_couÁ
 *

1336 
šfo
->
¡©us
.
ampdu_Ën
;

1339 
Ï¡
 = !
	`mš¡»l_ht_tx¡©_v®id
(
mp
, 
mi
, &
¬
[0]);

1340 
i
 = 0; !
Ï¡
; i++) {

1341 
Ï¡
 = (
i
 =ğ
IEEE80211_TX_MAX_RATES
 - 1) ||

1342 !
	`mš¡»l_ht_tx¡©_v®id
(
mp
, 
mi
, &
¬
[
i
 + 1]);

1344 
¿‹
 = 
	`mš¡»l_ht_g‘_¡©s
(
mp
, 
mi
, &
¬
[
i
]);

1345 ià(
Ï¡
)

1346 
¿‹
->
sucûss
 +ğ
šfo
->
¡©us
.
ampdu_ack_Ën
;

1348 
¿‹
->
©‹m±s
 +ğ
¬
[
i
].
couÁ
 * 
šfo
->
¡©us
.
ampdu_Ën
;

1352 ià(
mp
->
hw
->
max_¿‹s
 > 1) {

1357 
¿‹
 = 
	`mš¡»l_g‘_¿‹¡©s
(
mi
, mi->
max__¿‹
[0]);

1358 ià(
¿‹
->
©‹m±s
 > 30 &&

1359 
¿‹
->
sucûss
 <„©e->
©‹m±s
 / 4) {

1360 
	`mš¡»l_downg¿de_¿‹
(
mi
, &mi->
max__¿‹
[0], 
Œue
);

1361 
upd©e
 = 
Œue
;

1364 
¿‹2
 = 
	`mš¡»l_g‘_¿‹¡©s
(
mi
, mi->
max__¿‹
[1]);

1365 ià(
¿‹2
->
©‹m±s
 > 30 &&

1366 
¿‹2
->
sucûss
 <„©e2->
©‹m±s
 / 4) {

1367 
	`mš¡»l_downg¿de_¿‹
(
mi
, &mi->
max__¿‹
[1], 
çl£
);

1368 
upd©e
 = 
Œue
;

1372 ià(
	`time_aá”
(
jiff›s
, 
mi
->
Ï¡_¡©s_upd©e
 + 
upd©e_š‹rv®
)) {

1373 
upd©e
 = 
Œue
;

1374 
	`mš¡»l_ht_upd©e_¡©s
(
mp
, 
mi
);

1377 ià(
upd©e
)

1378 
	`mš¡»l_ht_upd©e_¿‹s
(
mp
, 
mi
);

1379 
	}
}

1382 
	$mš¡»l_ÿlc_»Œªsm™
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

1383 
šdex
)

1385 
mš¡»l_¿‹_¡©s
 *
mrs
;

1386 
tx_time
, 
tx_time_¹sùs
, 
tx_time_d©a
;

1387 
cw
 = 
mp
->
cw_mš
;

1388 
ùime
 = 0;

1389 
t_¦Ù
 = 9;

1390 
ampdu_Ën
 = 
	`mš¡»l_ht_avg_ampdu_Ën
(
mi
);

1391 
ov”h—d
 = 0, 
ov”h—d_¹sùs
 = 0;

1393 
mrs
 = 
	`mš¡»l_g‘_¿‹¡©s
(
mi
, 
šdex
);

1394 ià(
mrs
->
´ob_avg
 < 
	`MINSTREL_FRAC
(1, 10)) {

1395 
mrs
->
»Œy_couÁ
 = 1;

1396 
mrs
->
»Œy_couÁ_¹sùs
 = 1;

1400 
mrs
->
»Œy_couÁ
 = 2;

1401 
mrs
->
»Œy_couÁ_¹sùs
 = 2;

1402 
mrs
->
»Œy_upd©ed
 = 
Œue
;

1404 
tx_time_d©a
 = 
	`mš¡»l_g‘_du¿tiÚ
(
šdex
è* 
ampdu_Ën
 / 1000;

1407 
ùime
 = (
t_¦Ù
 * 
cw
) >> 1;

1408 
cw
 = 
	`mš
((cw << 1è| 1, 
mp
->
cw_max
);

1409 
ùime
 +ğ(
t_¦Ù
 * 
cw
) >> 1;

1410 
cw
 = 
	`mš
((cw << 1è| 1, 
mp
->
cw_max
);

1412 ià(
	`mš¡»l_ht_is_Ëgacy_group
(
	`MI_RATE_GROUP
(
šdex
))) {

1413 
ov”h—d
 = 
mi
->
ov”h—d_Ëgacy
;

1414 
ov”h—d_¹sùs
 = 
mi
->
ov”h—d_Ëgacy_¹sùs
;

1416 
ov”h—d
 = 
mi
->overhead;

1417 
ov”h—d_¹sùs
 = 
mi
->overhead_rtscts;

1421 
tx_time
 = 
ùime
 + 2 * (
ov”h—d
 + 
tx_time_d©a
);

1422 
tx_time_¹sùs
 = 
ùime
 + 2 * (
ov”h—d_¹sùs
 + 
tx_time_d©a
);

1427 
ùime
 = (
t_¦Ù
 * 
cw
) >> 1;

1428 
cw
 = 
	`mš
((cw << 1è| 1, 
mp
->
cw_max
);

1431 
tx_time
 +ğ
ùime
 + 
ov”h—d
 + 
tx_time_d©a
;

1432 
tx_time_¹sùs
 +ğ
ùime
 + 
ov”h—d_¹sùs
 + 
tx_time_d©a
;

1434 ià(
tx_time_¹sùs
 < 
mp
->
£gm’t_size
)

1435 
mrs
->
»Œy_couÁ_¹sùs
++;

1436 } (
tx_time
 < 
mp
->
£gm’t_size
) &&

1437 (++
mrs
->
»Œy_couÁ
 < 
mp
->
max_»Œy
));

1438 
	}
}

1442 
	$mš¡»l_ht_£t_¿‹
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

1443 
›“80211_¡a_¿‹s
 *
¿‹tbl
, 
off£t
, 
šdex
)

1445 
group_idx
 = 
	`MI_RATE_GROUP
(
šdex
);

1446 cÚ¡ 
mcs_group
 *
group
 = &
mš¡»l_mcs_groups
[
group_idx
];

1447 
mš¡»l_¿‹_¡©s
 *
mrs
;

1448 
u8
 
idx
;

1449 
u16
 
æags
 = 
group
->flags;

1451 
mrs
 = 
	`mš¡»l_g‘_¿‹¡©s
(
mi
, 
šdex
);

1452 ià(!
mrs
->
»Œy_upd©ed
)

1453 
	`mš¡»l_ÿlc_»Œªsm™
(
mp
, 
mi
, 
šdex
);

1455 ià(
mrs
->
´ob_avg
 < 
	`MINSTREL_FRAC
(20, 100è|| !mrs->
»Œy_couÁ
) {

1456 
¿‹tbl
->
¿‹
[
off£t
].
couÁ
 = 2;

1457 
¿‹tbl
->
¿‹
[
off£t
].
couÁ_¹s
 = 2;

1458 
¿‹tbl
->
¿‹
[
off£t
].
couÁ_ùs
 = 2;

1460 
¿‹tbl
->
¿‹
[
off£t
].
couÁ
 = 
mrs
->
»Œy_couÁ
;

1461 
¿‹tbl
->
¿‹
[
off£t
].
couÁ_ùs
 = 
mrs
->
»Œy_couÁ
;

1462 
¿‹tbl
->
¿‹
[
off£t
].
couÁ_¹s
 = 
mrs
->
»Œy_couÁ_¹sùs
;

1465 
šdex
 = 
	`MI_RATE_IDX
(index);

1466 ià(
group_idx
 =ğ
MINSTREL_CCK_GROUP
)

1467 
idx
 = 
mp
->
cck_¿‹s
[
šdex
 % 
	`ARRAY_SIZE
(mp->cck_rates)];

1468 ià(
group_idx
 =ğ
MINSTREL_OFDM_GROUP
)

1469 
idx
 = 
mp
->
ofdm_¿‹s
[
mi
->
bªd
][
šdex
 %

1470 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[0])];

1471 ià(
æags
 & 
IEEE80211_TX_RC_VHT_MCS
)

1472 
idx
 = ((
group
->
¡»ams
 - 1) << 4) |

1473 (
šdex
 & 0xF);

1475 
idx
 = 
šdex
 + (
group
->
¡»ams
 - 1) * 8;

1481 ià(
off£t
 > 0 ||

1482 (
mi
->
¡a
->
deæšk
.
smps_mode
 =ğ
IEEE80211_SMPS_DYNAMIC
 &&

1483 
group
->
¡»ams
 > 1)) {

1484 
¿‹tbl
->
¿‹
[
off£t
].
couÁ
 =„©‘bl->¿‹[off£t].
couÁ_¹s
;

1485 
æags
 |ğ
IEEE80211_TX_RC_USE_RTS_CTS
;

1488 
¿‹tbl
->
¿‹
[
off£t
].
idx
 = idx;

1489 
¿‹tbl
->
¿‹
[
off£t
].
æags
 = flags;

1490 
	}
}

1492 
šlše
 

1493 
	$mš¡»l_ht_g‘_´ob_avg
(
mš¡»l_ht_¡a
 *
mi
, 
¿‹
)

1495 
group
 = 
	`MI_RATE_GROUP
(
¿‹
);

1496 
¿‹
 = 
	`MI_RATE_IDX
(rate);

1497  
mi
->
groups
[
group
].
¿‹s
[
¿‹
].
´ob_avg
;

1498 
	}
}

1501 
	$mš¡»l_ht_g‘_max_amsdu_Ën
(
mš¡»l_ht_¡a
 *
mi
)

1503 
group
 = 
	`MI_RATE_GROUP
(
mi
->
max_´ob_¿‹
);

1504 cÚ¡ 
mcs_group
 *
g
 = &
mš¡»l_mcs_groups
[
group
];

1505 
¿‹
 = 
	`MI_RATE_IDX
(
mi
->
max_´ob_¿‹
);

1506 
du¿tiÚ
;

1509 ià(
mi
->
groups
[
group
].
¿‹s
[
¿‹
].
´ob_avg
 < 
	`MINSTREL_FRAC
(50, 100))

1512 
du¿tiÚ
 = 
g
->du¿tiÚ[
¿‹
];

1513 
du¿tiÚ
 <<ğ
g
->
shiá
;

1516 ià(
du¿tiÚ
 > 
	`MCS_DURATION
(1, 0, 52))

1523 ià(
du¿tiÚ
 > 
	`MCS_DURATION
(1, 0, 104))

1531 ià(
du¿tiÚ
 > 
	`MCS_DURATION
(1, 0, 260) ||

1532 (
	`mš¡»l_ht_g‘_´ob_avg
(
mi
, mi->
max__¿‹
[0]) <

1533 
	`MINSTREL_FRAC
(75, 100)))

1542 ià(!
mi
->
¡a
->
deæšk
.
vht_ÿp
.
vht_suµÜ‹d
)

1543  
IEEE80211_MAX_MPDU_LEN_HT_BA
;

1547 
	}
}

1550 
	$mš¡»l_ht_upd©e_¿‹s
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
)

1552 
›“80211_¡a_¿‹s
 *
¿‹s
;

1553 
i
 = 0;

1554 
max_¿‹s
 = 
	`mš_t
(, 
mp
->
hw
->max_¿‹s, 
IEEE80211_TX_RATE_TABLE_SIZE
);

1556 
¿‹s
 = 
	`kz®loc
((*¿‹s), 
GFP_ATOMIC
);

1557 ià(!
¿‹s
)

1561 
	`mš¡»l_ht_£t_¿‹
(
mp
, 
mi
, 
¿‹s
, 
i
++, mi->
max__¿‹
[0]);

1564 ; 
i
 < (
max_¿‹s
 - 1); i++)

1565 
	`mš¡»l_ht_£t_¿‹
(
mp
, 
mi
, 
¿‹s
, 
i
, mi->
max__¿‹
[i]);

1567 ià(
i
 < 
max_¿‹s
)

1568 
	`mš¡»l_ht_£t_¿‹
(
mp
, 
mi
, 
¿‹s
, 
i
++, mi->
max_´ob_¿‹
);

1570 ià(
i
 < 
IEEE80211_TX_RATE_TABLE_SIZE
)

1571 
¿‹s
->
¿‹
[
i
].
idx
 = -1;

1573 
mi
->
¡a
->
deæšk
.
agg
.
max_rc_amsdu_Ën
 = 
	`mš¡»l_ht_g‘_max_amsdu_Ën
(mi);

1574 
	`›“80211_¡a_»ÿlc_agg»g©es
(
mi
->
¡a
);

1575 
	`¿‹_cÚŒŞ_£t_¿‹s
(
mp
->
hw
, 
mi
->
¡a
, 
¿‹s
);

1576 
	}
}

1578 
u16


1579 
	$mš¡»l_ht_g‘_§m¶e_¿‹
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
)

1581 
u8
 
£q
;

1583 ià(
mp
->
hw
->
max_¿‹s
 > 1) {

1584 
£q
 = 
mi
->
§m¶e_£q
;

1585 
mi
->
§m¶e_£q
 = (
£q
 + 1è% 
	`ARRAY_SIZE
(
mš¡»l_§m¶e_£q
);

1586 
£q
 = 
mš¡»l_§m¶e_£q
[seq];

1588 
£q
 = 
MINSTREL_SAMPLE_TYPE_INC
;

1591  
	`__mš¡»l_ht_g‘_§m¶e_¿‹
(
mi
, 
£q
);

1592 
	}
}

1595 
	$mš¡»l_ht_g‘_¿‹
(*
´iv
, 
›“80211_¡a
 *
¡a
, *
´iv_¡a
,

1596 
›“80211_tx_¿‹_cÚŒŞ
 *
txrc
)

1598 cÚ¡ 
mcs_group
 *
§m¶e_group
;

1599 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
txrc
->
skb
);

1600 
›“80211_tx_¿‹
 *
¿‹
 = &
šfo
->
¡©us
.
¿‹s
[0];

1601 
mš¡»l_ht_¡a
 *
mi
 = 
´iv_¡a
;

1602 
mš¡»l_´iv
 *
mp
 = 
´iv
;

1603 
u16
 
§m¶e_idx
;

1605 
šfo
->
æags
 |ğ
mi
->
tx_æags
;

1607 #ifdeà
CONFIG_MAC80211_DEBUGFS


1608 ià(
mp
->
fixed_¿‹_idx
 != -1)

1613 ià(
mp
->
hw
->
max_¿‹s
 == 1 &&

1614 (
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_PORT_CTRL_PROTO
))

1617 ià(
	`time_is_aá”_jiff›s
(
mi
->
§m¶e_time
))

1620 
mi
->
§m¶e_time
 = 
jiff›s
 + 
MINSTREL_SAMPLE_INTERVAL
;

1621 
§m¶e_idx
 = 
	`mš¡»l_ht_g‘_§m¶e_¿‹
(
mp
, 
mi
);

1622 ià(!
§m¶e_idx
)

1625 
§m¶e_group
 = &
mš¡»l_mcs_groups
[
	`MI_RATE_GROUP
(
§m¶e_idx
)];

1626 
§m¶e_idx
 = 
	`MI_RATE_IDX
(sample_idx);

1628 ià(
§m¶e_group
 =ğ&
mš¡»l_mcs_groups
[
MINSTREL_CCK_GROUP
] &&

1629 (
§m¶e_idx
 >ğ4è!ğ
txrc
->
shÜt_´—mbË
)

1632 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_RATE_CTRL_PROBE
;

1633 
¿‹
->
couÁ
 = 1;

1635 ià(
§m¶e_group
 =ğ&
mš¡»l_mcs_groups
[
MINSTREL_CCK_GROUP
]) {

1636 
idx
 = 
§m¶e_idx
 % 
	`ARRAY_SIZE
(
mp
->
cck_¿‹s
);

1637 
¿‹
->
idx
 = 
mp
->
cck_¿‹s
[idx];

1638 } ià(
§m¶e_group
 =ğ&
mš¡»l_mcs_groups
[
MINSTREL_OFDM_GROUP
]) {

1639 
idx
 = 
§m¶e_idx
 % 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[0]);

1640 
¿‹
->
idx
 = 
mp
->
ofdm_¿‹s
[
mi
->
bªd
][idx];

1641 } ià(
§m¶e_group
->
æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

1642 
	`›“80211_¿‹_£t_vht
(
¿‹
, 
	`MI_RATE_IDX
(
§m¶e_idx
),

1643 
§m¶e_group
->
¡»ams
);

1645 
¿‹
->
idx
 = 
§m¶e_idx
 + (
§m¶e_group
->
¡»ams
 - 1) * 8;

1648 
¿‹
->
æags
 = 
§m¶e_group
->flags;

1649 
	}
}

1652 
	$mš¡»l_ht_upd©e_cck
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

1653 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1654 
›“80211_¡a
 *
¡a
)

1656 
i
;

1658 ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_2GHZ
)

1661 ià(
¡a
->
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
 &&

1662 !
	`›“80211_hw_check
(
mp
->
hw
, 
SUPPORTS_HT_CCK_RATES
))

1665 
i
 = 0; i < 4; i++) {

1666 ià(
mp
->
cck_¿‹s
[
i
] == 0xff ||

1667 !
	`¿‹_suµÜ‹d
(
¡a
, 
sbªd
->
bªd
, 
mp
->
cck_¿‹s
[
i
]))

1670 
mi
->
suµÜ‹d
[
MINSTREL_CCK_GROUP
] |ğ
	`BIT
(
i
);

1671 ià(
sbªd
->
b™¿‹s
[
i
].
æags
 & 
IEEE80211_RATE_SHORT_PREAMBLE
)

1672 
mi
->
suµÜ‹d
[
MINSTREL_CCK_GROUP
] |ğ
	`BIT
(
i
 + 4);

1674 
	}
}

1677 
	$mš¡»l_ht_upd©e_ofdm
(
mš¡»l_´iv
 *
mp
, 
mš¡»l_ht_¡a
 *
mi
,

1678 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1679 
›“80211_¡a
 *
¡a
)

1681 cÚ¡ 
u8
 *
¿‹s
;

1682 
i
;

1684 ià(
¡a
->
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
)

1687 
¿‹s
 = 
mp
->
ofdm_¿‹s
[
sbªd
->
bªd
];

1688 
i
 = 0; i < 
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[0]); i++) {

1689 ià(
¿‹s
[
i
] == 0xff ||

1690 !
	`¿‹_suµÜ‹d
(
¡a
, 
sbªd
->
bªd
, 
¿‹s
[
i
]))

1693 
mi
->
suµÜ‹d
[
MINSTREL_OFDM_GROUP
] |ğ
	`BIT
(
i
);

1695 
	}
}

1698 
	$mš¡»l_ht_upd©e_ÿps
(*
´iv
, 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1699 
cfg80211_chª_def
 *
chªdef
,

1700 
›“80211_¡a
 *
¡a
, *
´iv_¡a
)

1702 
mš¡»l_´iv
 *
mp
 = 
´iv
;

1703 
mš¡»l_ht_¡a
 *
mi
 = 
´iv_¡a
;

1704 
›“80211_mcs_šfo
 *
mcs
 = &
¡a
->
deæšk
.
ht_ÿp
.mcs;

1705 
u16
 
ht_ÿp
 = 
¡a
->
deæšk
.ht_ÿp.
ÿp
;

1706 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
 = &
¡a
->
deæšk
.vht_cap;

1707 cÚ¡ 
›“80211_¿‹
 *
ùl_¿‹
;

1708 
¡a_šfo
 *sta_info;

1709 
boŞ
 
ldpc
, 
”p
;

1710 
u£_vht
;

1711 
ack_dur
;

1712 
¡bc
;

1713 
i
;

1715 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
mš¡»l_mcs_groups
è!ğ
MINSTREL_GROUPS_NB
);

1717 ià(
vht_ÿp
->
vht_suµÜ‹d
)

1718 
u£_vht
 = 
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
 !ğ
	`ıu_to_Ë16
(~0);

1720 
u£_vht
 = 0;

1722 
	`mem£t
(
mi
, 0, (*mi));

1724 
mi
->
¡a
 = sta;

1725 
mi
->
bªd
 = 
sbªd
->band;

1726 
mi
->
Ï¡_¡©s_upd©e
 = 
jiff›s
;

1728 
ack_dur
 = 
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 10, 60, 1, 1);

1729 
mi
->
ov”h—d
 = 
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 0, 60, 1, 1);

1730 
mi
->
ov”h—d
 +ğ
ack_dur
;

1731 
mi
->
ov”h—d_¹sùs
 = mi->
ov”h—d
 + 2 * 
ack_dur
;

1733 
ùl_¿‹
 = &
sbªd
->
b™¿‹s
[
	`¿‹_lowe¡_šdex
(sbªd, 
¡a
)];

1734 
”p
 = 
ùl_¿‹
->
æags
 & 
IEEE80211_RATE_ERP_G
;

1735 
ack_dur
 = 
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 10,

1736 
ùl_¿‹
->
b™¿‹
, 
”p
, 1);

1737 
mi
->
ov”h—d_Ëgacy
 = 
ack_dur
;

1738 
mi
->
ov”h—d_Ëgacy_¹sùs
 = mi->
ov”h—d_Ëgacy
 + 2 * 
ack_dur
;

1740 
mi
->
avg_ampdu_Ën
 = 
	`MINSTREL_FRAC
(1, 1);

1742 ià(!
u£_vht
) {

1743 
¡bc
 = (
ht_ÿp
 & 
IEEE80211_HT_CAP_RX_STBC
) >>

1744 
IEEE80211_HT_CAP_RX_STBC_SHIFT
;

1746 
ldpc
 = 
ht_ÿp
 & 
IEEE80211_HT_CAP_LDPC_CODING
;

1748 
¡bc
 = (
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_RXSTBC_MASK
) >>

1749 
IEEE80211_VHT_CAP_RXSTBC_SHIFT
;

1751 
ldpc
 = 
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_RXLDPC
;

1754 
mi
->
tx_æags
 |ğ
¡bc
 << 
IEEE80211_TX_CTL_STBC_SHIFT
;

1755 ià(
ldpc
)

1756 
mi
->
tx_æags
 |ğ
IEEE80211_TX_CTL_LDPC
;

1758 
i
 = 0; i < 
	`ARRAY_SIZE
(
mi
->
groups
); i++) {

1759 
u32
 
gæags
 = 
mš¡»l_mcs_groups
[
i
].
æags
;

1760 
bw
, 
nss
;

1762 
mi
->
suµÜ‹d
[
i
] = 0;

1763 ià(
	`mš¡»l_ht_is_Ëgacy_group
(
i
))

1766 ià(
gæags
 & 
IEEE80211_TX_RC_SHORT_GI
) {

1767 ià(
gæags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
) {

1768 ià(!(
ht_ÿp
 & 
IEEE80211_HT_CAP_SGI_40
))

1771 ià(!(
ht_ÿp
 & 
IEEE80211_HT_CAP_SGI_20
))

1776 ià(
gæags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
 &&

1777 
¡a
->
deæšk
.
bªdwidth
 < 
IEEE80211_STA_RX_BW_40
)

1780 
nss
 = 
mš¡»l_mcs_groups
[
i
].
¡»ams
;

1783 ià(
¡a
->
deæšk
.
smps_mode
 =ğ
IEEE80211_SMPS_STATIC
 && 
nss
 > 1)

1787 ià(
gæags
 & 
IEEE80211_TX_RC_MCS
) {

1788 ià(
u£_vht
 && 
mš¡»l_vht_Úly
)

1791 
mi
->
suµÜ‹d
[
i
] = 
mcs
->
rx_mask
[
nss
 - 1];

1796 ià(!
vht_ÿp
->
vht_suµÜ‹d
 ||

1797 
	`WARN_ON
(!(
gæags
 & 
IEEE80211_TX_RC_VHT_MCS
)) ||

1798 
	`WARN_ON
(
gæags
 & 
IEEE80211_TX_RC_160_MHZ_WIDTH
))

1801 ià(
gæags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
) {

1802 ià(
¡a
->
deæšk
.
bªdwidth
 < 
IEEE80211_STA_RX_BW_80
 ||

1803 ((
gæags
 & 
IEEE80211_TX_RC_SHORT_GI
) &&

1804 !(
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_SHORT_GI_80
))) {

1809 ià(
gæags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

1810 
bw
 = 
BW_40
;

1811 ià(
gæags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

1812 
bw
 = 
BW_80
;

1814 
bw
 = 
BW_20
;

1816 
mi
->
suµÜ‹d
[
i
] = 
	`mš¡»l_g‘_v®id_vht_¿‹s
(
bw
, 
nss
,

1817 
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
);

1820 
¡a_šfo
 = 
	`cÚš”_of
(
¡a
, sta_info, sta);

1821 
mi
->
u£_shÜt_´—mbË
 = 
	`‹¡_¡a_æag
(
¡a_šfo
, 
WLAN_STA_SHORT_PREAMBLE
) &&

1822 
¡a_šfo
->
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
;

1824 
	`mš¡»l_ht_upd©e_cck
(
mp
, 
mi
, 
sbªd
, 
¡a
);

1825 
	`mš¡»l_ht_upd©e_ofdm
(
mp
, 
mi
, 
sbªd
, 
¡a
);

1828 
	`mš¡»l_ht_upd©e_¡©s
(
mp
, 
mi
);

1829 
	`mš¡»l_ht_upd©e_¿‹s
(
mp
, 
mi
);

1830 
	}
}

1833 
	$mš¡»l_ht_¿‹_š™
(*
´iv
, 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1834 
cfg80211_chª_def
 *
chªdef
,

1835 
›“80211_¡a
 *
¡a
, *
´iv_¡a
)

1837 
	`mš¡»l_ht_upd©e_ÿps
(
´iv
, 
sbªd
, 
chªdef
, 
¡a
, 
´iv_¡a
);

1838 
	}
}

1841 
	$mš¡»l_ht_¿‹_upd©e
(*
´iv
, 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1842 
cfg80211_chª_def
 *
chªdef
,

1843 
›“80211_¡a
 *
¡a
, *
´iv_¡a
,

1844 
u32
 
chªged
)

1846 
	`mš¡»l_ht_upd©e_ÿps
(
´iv
, 
sbªd
, 
chªdef
, 
¡a
, 
´iv_¡a
);

1847 
	}
}

1850 
	$mš¡»l_ht_®loc_¡a
(*
´iv
, 
›“80211_¡a
 *
¡a
, 
gå_t
 
gå
)

1852 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1853 
mš¡»l_ht_¡a
 *
mi
;

1854 
mš¡»l_´iv
 *
mp
 = 
´iv
;

1855 
›“80211_hw
 *
hw
 = 
mp
->hw;

1856 
max_¿‹s
 = 0;

1857 
i
;

1859 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

1860 
sbªd
 = 
hw
->
why
->
bªds
[
i
];

1861 ià(
sbªd
 && sbªd->
n_b™¿‹s
 > 
max_¿‹s
)

1862 
max_¿‹s
 = 
sbªd
->
n_b™¿‹s
;

1865  
	`kz®loc
((*
mi
), 
gå
);

1866 
	}
}

1869 
	$mš¡»l_ht_ä“_¡a
(*
´iv
, 
›“80211_¡a
 *
¡a
, *
´iv_¡a
)

1871 
	`kä“
(
´iv_¡a
);

1872 
	}
}

1875 
	$mš¡»l_ht_fl_¿‹_¬¿y
(
u8
 *
de¡
, 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

1876 cÚ¡ 
s16
 *
b™¿‹s
, 
n_¿‹s
, 
u32
 
¿‹_æags
)

1878 
i
, 
j
;

1880 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

1881 
›“80211_¿‹
 *
¿‹
 = &
sbªd
->
b™¿‹s
[
i
];

1883 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
i
].
æags
) !=„ate_flags)

1886 
j
 = 0; j < 
n_¿‹s
; j++) {

1887 ià(
¿‹
->
b™¿‹
 !ğ
b™¿‹s
[
j
])

1890 
de¡
[
j
] = 
i
;

1894 
	}
}

1897 
	$mš¡»l_ht_š™_cck_¿‹s
(
mš¡»l_´iv
 *
mp
)

1899 cÚ¡ 
s16
 
b™¿‹s
[4] = { 10, 20, 55, 110 };

1900 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1901 
u32
 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(&
mp
->
hw
->
cÚf
.
chªdef
);

1903 
	`mem£t
(
mp
->
cck_¿‹s
, 0xff, (mp->cck_rates));

1904 
sbªd
 = 
mp
->
hw
->
why
->
bªds
[
NL80211_BAND_2GHZ
];

1905 ià(!
sbªd
)

1908 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
mp
->
cck_¿‹s
è!ğARRAY_SIZE(
b™¿‹s
));

1909 
	`mš¡»l_ht_fl_¿‹_¬¿y
(
mp
->
cck_¿‹s
, 
sbªd
,

1910 
mš¡»l_cck_b™¿‹s
,

1911 
	`ARRAY_SIZE
(
mš¡»l_cck_b™¿‹s
),

1912 
¿‹_æags
);

1913 
	}
}

1916 
	$mš¡»l_ht_š™_ofdm_¿‹s
(
mš¡»l_´iv
 *
mp
, 
Æ80211_bªd
 
bªd
)

1918 cÚ¡ 
s16
 
b™¿‹s
[8] = { 60, 90, 120, 180, 240, 360, 480, 540 };

1919 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1920 
u32
 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(&
mp
->
hw
->
cÚf
.
chªdef
);

1922 
	`mem£t
(
mp
->
ofdm_¿‹s
[
bªd
], 0xff, (mp->ofdm_rates[band]));

1923 
sbªd
 = 
mp
->
hw
->
why
->
bªds
[
bªd
];

1924 ià(!
sbªd
)

1927 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
mp
->
ofdm_¿‹s
[
bªd
]è!ğARRAY_SIZE(
b™¿‹s
));

1928 
	`mš¡»l_ht_fl_¿‹_¬¿y
(
mp
->
ofdm_¿‹s
[
bªd
], 
sbªd
,

1929 
mš¡»l_ofdm_b™¿‹s
,

1930 
	`ARRAY_SIZE
(
mš¡»l_ofdm_b™¿‹s
),

1931 
¿‹_æags
);

1932 
	}
}

1935 
	$mš¡»l_ht_®loc
(
›“80211_hw
 *
hw
)

1937 
mš¡»l_´iv
 *
mp
;

1938 
i
;

1940 
mp
 = 
	`kz®loc
((
mš¡»l_´iv
), 
GFP_ATOMIC
);

1941 ià(!
mp
)

1942  
NULL
;

1947 
mp
->
cw_mš
 = 15;

1948 
mp
->
cw_max
 = 1023;

1951 
mp
->
£gm’t_size
 = 6000;

1953 ià(
hw
->
max_¿‹_Œ›s
 > 0)

1954 
mp
->
max_»Œy
 = 
hw
->
max_¿‹_Œ›s
;

1957 
mp
->
max_»Œy
 = 7;

1959 
mp
->
hw
 = hw;

1960 
mp
->
upd©e_š‹rv®
 = 
HZ
 / 20;

1962 
	`mš¡»l_ht_š™_cck_¿‹s
(
mp
);

1963 
i
 = 0; i < 
	`ARRAY_SIZE
(
mp
->
hw
->
why
->
bªds
); i++)

1964 
	`mš¡»l_ht_š™_ofdm_¿‹s
(
mp
, 
i
);

1966  
mp
;

1967 
	}
}

1969 #ifdeà
CONFIG_MAC80211_DEBUGFS


1970 
	$mš¡»l_ht_add_debugfs
(
›“80211_hw
 *
hw
, *
´iv
,

1971 
d’Œy
 *
debugfsdœ
)

1973 
mš¡»l_´iv
 *
mp
 = 
´iv
;

1975 
mp
->
fixed_¿‹_idx
 = (
u32
) -1;

1976 
	`debugfs_ü—‹_u32
("fixed_¿‹_idx", 
S_IRUGO
 | 
S_IWUGO
, 
debugfsdœ
,

1977 &
mp
->
fixed_¿‹_idx
);

1978 
	}
}

1982 
	$mš¡»l_ht_ä“
(*
´iv
)

1984 
	`kä“
(
´iv
);

1985 
	}
}

1987 
u32
 
	$mš¡»l_ht_g‘_ex³ùed_throughput
(*
´iv_¡a
)

1989 
mš¡»l_ht_¡a
 *
mi
 = 
´iv_¡a
;

1990 
i
, 
j
, 
´ob
, 
_avg
;

1992 
i
 = 
	`MI_RATE_GROUP
(
mi
->
max__¿‹
[0]);

1993 
j
 = 
	`MI_RATE_IDX
(
mi
->
max__¿‹
[0]);

1994 
´ob
 = 
mi
->
groups
[
i
].
¿‹s
[
j
].
´ob_avg
;

1997 
_avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
i
, 
j
, 
´ob
) * 10;

1998 
_avg
 =p_avg * 
AVG_PKT_SIZE
 * 8 / 1024;

2000  
_avg
;

2001 
	}
}

2003 cÚ¡ 
¿‹_cÚŒŞ_İs
 
	gmac80211_mš¡»l_ht
 = {

2004 .
Çme
 = "minstrel_ht",

2005 .
	gÿ·
 = 
RATE_CTRL_CAPA_AMPDU_TRIGGER
,

2006 .
	gtx_¡©us_ext
 = 
mš¡»l_ht_tx_¡©us
,

2007 .
	gg‘_¿‹
 = 
mš¡»l_ht_g‘_¿‹
,

2008 .
	g¿‹_š™
 = 
mš¡»l_ht_¿‹_š™
,

2009 .
	g¿‹_upd©e
 = 
mš¡»l_ht_¿‹_upd©e
,

2010 .
	g®loc_¡a
 = 
mš¡»l_ht_®loc_¡a
,

2011 .
	gä“_¡a
 = 
mš¡»l_ht_ä“_¡a
,

2012 .
	g®loc
 = 
mš¡»l_ht_®loc
,

2013 .
	gä“
 = 
mš¡»l_ht_ä“
,

2014 #ifdeà
CONFIG_MAC80211_DEBUGFS


2015 .
	gadd_debugfs
 = 
mš¡»l_ht_add_debugfs
,

2016 .
	gadd_¡a_debugfs
 = 
mš¡»l_ht_add_¡a_debugfs
,

2018 .
	gg‘_ex³ùed_throughput
 = 
mš¡»l_ht_g‘_ex³ùed_throughput
,

2022 
__š™
 
	$š™_§m¶e_bË
()

2024 
cŞ
, 
i
, 
Ãw_idx
;

2025 
u8
 
ºd
[
MCS_GROUP_RATES
];

2027 
	`mem£t
(
§m¶e_bË
, 0xff, (sample_table));

2028 
cŞ
 = 0; cŞ < 
SAMPLE_COLUMNS
; col++) {

2029 
	`g‘_¿ndom_by‹s
(
ºd
, (rnd));

2030 
i
 = 0; i < 
MCS_GROUP_RATES
; i++) {

2031 
Ãw_idx
 = (
i
 + 
ºd
[i]è% 
MCS_GROUP_RATES
;

2032 
§m¶e_bË
[
cŞ
][
Ãw_idx
] != 0xff)

2033 
Ãw_idx
 = (Ãw_idx + 1è% 
MCS_GROUP_RATES
;

2035 
§m¶e_bË
[
cŞ
][
Ãw_idx
] = 
i
;

2038 
	}
}

2040 
__š™


2041 
	$rc80211_mš¡»l_š™
()

2043 
	`š™_§m¶e_bË
();

2044  
	`›“80211_¿‹_cÚŒŞ_»gi¡”
(&
mac80211_mš¡»l_ht
);

2045 
	}
}

2048 
	$rc80211_mš¡»l_ex™
()

2050 
	`›“80211_¿‹_cÚŒŞ_uÄegi¡”
(&
mac80211_mš¡»l_ht
);

2051 
	}
}

	@rc80211_minstrel_ht.h

6 #iâdeà
__RC_MINSTREL_HT_H


7 
	#__RC_MINSTREL_HT_H


	)

9 
	~<lšux/b™f›ld.h
>

12 
	#MAX_THR_RATES
 4

	)

13 
	#SAMPLE_COLUMNS
 10

	)

16 
	#MINSTREL_SCALE
 12

	)

17 
	#MINSTREL_FRAC
(
v®
, 
div
è(((v®è<< 
MINSTREL_SCALE
è/ div)

	)

18 
	#MINSTREL_TRUNC
(
v®
è((v®è>> 
MINSTREL_SCALE
)

	)

20 
	#EWMA_LEVEL
 96

	)

21 
	#EWMA_DIV
 128

	)

32 
	#MINSTREL_AVG_COEFF1
 (
	`MINSTREL_FRAC
(1, 1) - \

33 
MINSTREL_AVG_COEFF2
 - \

34 
MINSTREL_AVG_COEFF3
)

	)

35 
	#MINSTREL_AVG_COEFF2
 0x00001499

	)

36 
	#MINSTREL_AVG_COEFF3
 -0x0000092e

	)

42 
	#MINSTREL_MAX_STREAMS
 4

	)

43 
	#MINSTREL_HT_STREAM_GROUPS
 4

	)

44 
	#MINSTREL_VHT_STREAM_GROUPS
 6

	)

46 
	#MINSTREL_HT_GROUPS_NB
 (
MINSTREL_MAX_STREAMS
 * \

47 
MINSTREL_HT_STREAM_GROUPS
)

	)

48 
	#MINSTREL_VHT_GROUPS_NB
 (
MINSTREL_MAX_STREAMS
 * \

49 
MINSTREL_VHT_STREAM_GROUPS
)

	)

50 
	#MINSTREL_LEGACY_GROUPS_NB
 2

	)

51 
	#MINSTREL_GROUPS_NB
 (
MINSTREL_HT_GROUPS_NB
 + \

52 
MINSTREL_VHT_GROUPS_NB
 + \

53 
MINSTREL_LEGACY_GROUPS_NB
)

	)

55 
	#MINSTREL_HT_GROUP_0
 0

	)

56 
	#MINSTREL_CCK_GROUP
 (
MINSTREL_HT_GROUP_0
 + 
MINSTREL_HT_GROUPS_NB
)

	)

57 
	#MINSTREL_OFDM_GROUP
 (
MINSTREL_CCK_GROUP
 + 1)

	)

58 
	#MINSTREL_VHT_GROUP_0
 (
MINSTREL_OFDM_GROUP
 + 1)

	)

60 
	#MCS_GROUP_RATES
 10

	)

62 
	#MI_RATE_IDX_MASK
 
	`GENMASK
(3, 0)

	)

63 
	#MI_RATE_GROUP_MASK
 
	`GENMASK
(15, 4)

	)

65 
	#MI_RATE
(
_group
, 
_idx
) \

66 (
	`FIELD_PREP
(
MI_RATE_GROUP_MASK
, 
_group
) | \

67 
	`FIELD_PREP
(
MI_RATE_IDX_MASK
, 
_idx
))

	)

69 
	#MI_RATE_IDX
(
_¿‹
è
	`FIELD_GET
(
MI_RATE_IDX_MASK
, _¿‹)

	)

70 
	#MI_RATE_GROUP
(
_¿‹
è
	`FIELD_GET
(
MI_RATE_GROUP_MASK
, _¿‹)

	)

72 
	#MINSTREL_SAMPLE_RATES
 5

	)

73 
	#MINSTREL_SAMPLE_INTERVAL
 (
HZ
 / 50)

	)

75 
	smš¡»l_´iv
 {

76 
›“80211_hw
 *
	mhw
;

77 
	mcw_mš
;

78 
	mcw_max
;

79 
	mmax_»Œy
;

80 
	m£gm’t_size
;

81 
	mupd©e_š‹rv®
;

83 
u8
 
	mcck_¿‹s
[4];

84 
u8
 
	mofdm_¿‹s
[
NUM_NL80211_BANDS
][8];

86 #ifdeà
CONFIG_MAC80211_DEBUGFS


93 
u32
 
	mfixed_¿‹_idx
;

98 
	smcs_group
 {

99 
u16
 
	mæags
;

100 
u8
 
	m¡»ams
;

101 
u8
 
	mshiá
;

102 
u8
 
	mbw
;

103 
u16
 
	mdu¿tiÚ
[
MCS_GROUP_RATES
];

106 cÚ¡ 
s16
 
mš¡»l_cck_b™¿‹s
[4];

107 cÚ¡ 
s16
 
mš¡»l_ofdm_b™¿‹s
[8];

108 cÚ¡ 
mcs_group
 
mš¡»l_mcs_groups
[];

110 
	smš¡»l_¿‹_¡©s
 {

112 
u16
 
	m©‹m±s
, 
	mÏ¡_©‹m±s
;

113 
u16
 
	msucûss
, 
	mÏ¡_sucûss
;

116 
u32
 
	m©t_hi¡
, 
	msucc_hi¡
;

119 
u16
 
	m´ob_avg
;

120 
u16
 
	m´ob_avg_1
;

123 
u8
 
	m»Œy_couÁ
;

124 
u8
 
	m»Œy_couÁ_¹sùs
;

126 
boŞ
 
	m»Œy_upd©ed
;

129 
	emš¡»l_§m¶e_ty³
 {

130 
	mMINSTREL_SAMPLE_TYPE_INC
,

131 
	mMINSTREL_SAMPLE_TYPE_JUMP
,

132 
	mMINSTREL_SAMPLE_TYPE_SLOW
,

133 
	m__MINSTREL_SAMPLE_TYPE_MAX


136 
	smš¡»l_mcs_group_d©a
 {

137 
u8
 
	mšdex
;

138 
u8
 
	mcŞumn
;

141 
u16
 
	mmax_group__¿‹
[
MAX_THR_RATES
];

142 
u16
 
	mmax_group_´ob_¿‹
;

145 
mš¡»l_¿‹_¡©s
 
	m¿‹s
[
MCS_GROUP_RATES
];

148 
	smš¡»l_§m¶e_ÿ‹gÜy
 {

149 
u8
 
	m§m¶e_group
;

150 
u16
 
	m§m¶e_¿‹s
[
MINSTREL_SAMPLE_RATES
];

151 
u16
 
	mcur_§m¶e_¿‹s
[
MINSTREL_SAMPLE_RATES
];

154 
	smš¡»l_ht_¡a
 {

155 
›“80211_¡a
 *
	m¡a
;

158 
	mampdu_Ën
;

159 
	mampdu_·ck‘s
;

162 
	mavg_ampdu_Ën
;

165 
u16
 
	mmax__¿‹
[
MAX_THR_RATES
];

166 
u16
 
	mmax_´ob_¿‹
;

169 
	mÏ¡_¡©s_upd©e
;

172 
	mov”h—d
;

173 
	mov”h—d_¹sùs
;

174 
	mov”h—d_Ëgacy
;

175 
	mov”h—d_Ëgacy_¹sùs
;

177 
	mtÙ®_·ck‘s
;

178 
	m§m¶e_·ck‘s
;

181 
u32
 
	mtx_æags
;

182 
boŞ
 
	mu£_shÜt_´—mbË
;

183 
u8
 
	mbªd
;

185 
u8
 
	m§m¶e_£q
;

186 
u16
 
	m§m¶e_¿‹
;

188 
	m§m¶e_time
;

189 
mš¡»l_§m¶e_ÿ‹gÜy
 
	m§m¶e
[
__MINSTREL_SAMPLE_TYPE_MAX
];

192 
u16
 
	msuµÜ‹d
[
MINSTREL_GROUPS_NB
];

195 
mš¡»l_mcs_group_d©a
 
	mgroups
[
MINSTREL_GROUPS_NB
];

198 
mš¡»l_ht_add_¡a_debugfs
(*
´iv
, *
´iv_¡a
, 
d’Œy
 *
dœ
);

199 
mš¡»l_ht_g‘__avg
(
mš¡»l_ht_¡a
 *
mi
, 
group
, 
¿‹
,

200 
´ob_avg
);

	@rc80211_minstrel_ht_debugfs.c

5 
	~<lšux/Ãtdeviû.h
>

6 
	~<lšux/ty³s.h
>

7 
	~<lšux/skbuff.h
>

8 
	~<lšux/debugfs.h
>

9 
	~<lšux/›“80211.h
>

10 
	~<lšux/expÜt.h
>

11 
	~<Ãt/mac80211.h
>

12 
	~"rc80211_mš¡»l_ht.h
"

14 
	smš¡»l_debugfs_šfo
 {

15 
size_t
 
	mËn
;

16 
	mbuf
[];

19 
ssize_t


20 
	$mš¡»l_¡©s_»ad
(
fe
 *fe, 
__u£r
 *
buf
, 
size_t
 
Ën
, 
loff_t
 *
µos
)

22 
mš¡»l_debugfs_šfo
 *
ms
;

24 
ms
 = 
fe
->
´iv©e_d©a
;

25  
	`sim¶e_»ad_äom_bufãr
(
buf
, 
Ën
, 
µos
, 
ms
->buf, ms->len);

26 
	}
}

29 
	$mš¡»l_¡©s_»Ëa£
(
šode
 *šode, 
fe
 *file)

31 
	`kä“
(
fe
->
´iv©e_d©a
);

33 
	}
}

35 
boŞ


36 
	$mš¡»l_ht_is_§m¶e_¿‹
(
mš¡»l_ht_¡a
 *
mi
, 
idx
)

38 
ty³
, 
i
;

40 
ty³
 = 0;y³ < 
	`ARRAY_SIZE
(
mi
->
§m¶e
);ype++)

41 
i
 = 0; i < 
MINSTREL_SAMPLE_RATES
; i++)

42 ià(
mi
->
§m¶e
[
ty³
].
cur_§m¶e_¿‹s
[
i
] =ğ
idx
)

43  
Œue
;

44  
çl£
;

45 
	}
}

48 
	$mš¡»l_ht_¡©s_dump
(
mš¡»l_ht_¡a
 *
mi
, 
i
, *
p
)

50 cÚ¡ 
mcs_group
 *
mg
;

51 
j
, 
_max
, 
_avg
, 
•rob
, 
tx_time
;

52 
htmode
 = '2';

53 
gimode
 = 'L';

54 
u32
 
gæags
;

56 ià(!
mi
->
suµÜ‹d
[
i
])

57  
p
;

59 
mg
 = &
mš¡»l_mcs_groups
[
i
];

60 
gæags
 = 
mg
->
æags
;

62 ià(
gæags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

63 
htmode
 = '4';

64 ià(
gæags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

65 
htmode
 = '8';

66 ià(
gæags
 & 
IEEE80211_TX_RC_SHORT_GI
)

67 
gimode
 = 'S';

69 
j
 = 0; j < 
MCS_GROUP_RATES
; j++) {

70 
mš¡»l_¿‹_¡©s
 *
mrs
 = &
mi
->
groups
[
i
].
¿‹s
[
j
];

71 
idx
 = 
	`MI_RATE
(
i
, 
j
);

72 
du¿tiÚ
;

74 ià(!(
mi
->
suµÜ‹d
[
i
] & 
	`BIT
(
j
)))

77 ià(
gæags
 & 
IEEE80211_TX_RC_MCS
) {

78 
p
 +ğ
	`¥rštf
Õ, "HT%c0 ", 
htmode
);

79 
p
 +ğ
	`¥rštf
Õ, "%cGI ", 
gimode
);

80 
p
 +ğ
	`¥rštf
Õ, "%d ", 
mg
->
¡»ams
);

81 } ià(
gæags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

82 
p
 +ğ
	`¥rštf
Õ, "VHT%c0 ", 
htmode
);

83 
p
 +ğ
	`¥rštf
Õ, "%cGI ", 
gimode
);

84 
p
 +ğ
	`¥rštf
Õ, "%d ", 
mg
->
¡»ams
);

85 } ià(
i
 =ğ
MINSTREL_OFDM_GROUP
) {

86 
p
 +ğ
	`¥rštf
(p, "OFDM ");

87 
p
 +ğ
	`¥rštf
(p, "1 ");

89 
p
 +ğ
	`¥rštf
(p, "CCK ");

90 
p
 +ğ
	`¥rštf
Õ, "%cP ", 
j
 < 4 ? 'L' : 'S');

91 
p
 +ğ
	`¥rštf
(p, "1 ");

94 *(
p
++èğ(
idx
 =ğ
mi
->
max__¿‹
[0]) ? 'A' : ' ';

95 *(
p
++èğ(
idx
 =ğ
mi
->
max__¿‹
[1]) ? 'B' : ' ';

96 *(
p
++èğ(
idx
 =ğ
mi
->
max__¿‹
[2]) ? 'C' : ' ';

97 *(
p
++èğ(
idx
 =ğ
mi
->
max__¿‹
[3]) ? 'D' : ' ';

98 *(
p
++èğ(
idx
 =ğ
mi
->
max_´ob_¿‹
) ? 'P' : ' ';

99 *(
p
++èğ
	`mš¡»l_ht_is_§m¶e_¿‹
(
mi
, 
idx
) ? 'S' : ' ';

101 ià(
gæags
 & 
IEEE80211_TX_RC_MCS
) {

102 
p
 +ğ
	`¥rštf
Õ, " MCS%-2u", (
mg
->
¡»ams
 - 1è* 8 + 
j
);

103 } ià(
gæags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

104 
p
 +ğ
	`¥rštf
Õ, " MCS%-1u/%1u", 
j
, 
mg
->
¡»ams
);

106 
r
;

108 ià(
i
 =ğ
MINSTREL_OFDM_GROUP
)

109 
r
 = 
mš¡»l_ofdm_b™¿‹s
[
j
 % 8];

111 
r
 = 
mš¡»l_cck_b™¿‹s
[
j
 % 4];

113 
p
 +ğ
	`¥rštf
Õ, " %2u.%1uM", 
r
 / 10,„ % 10);

116 
p
 +ğ
	`¥rštf
Õ, " %3u ", 
idx
);

119 
du¿tiÚ
 = 
mg
->du¿tiÚ[
j
];

120 
du¿tiÚ
 <<ğ
mg
->
shiá
;

121 
tx_time
 = 
	`DIV_ROUND_CLOSEST
(
du¿tiÚ
, 1000);

122 
p
 +ğ
	`¥rštf
Õ, "%6u ", 
tx_time
);

124 
_max
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
i
, 
j
, 
	`MINSTREL_FRAC
(100, 100));

125 
_avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
i
, 
j
, 
mrs
->
´ob_avg
);

126 
•rob
 = 
	`MINSTREL_TRUNC
(
mrs
->
´ob_avg
 * 1000);

128 
p
 +ğ
	`¥rštf
(p, "%4u.%1u %4u.%1u %3u.%1u"

131 
_max
 / 10,p_max % 10,

132 
_avg
 / 10,p_avg % 10,

133 
•rob
 / 10,ƒprob % 10,

134 
mrs
->
»Œy_couÁ
,

135 
mrs
->
Ï¡_sucûss
,

136 
mrs
->
Ï¡_©‹m±s
,

137 ()
mrs
->
succ_hi¡
,

138 ()
mrs
->
©t_hi¡
);

141  
p
;

142 
	}
}

145 
	$mš¡»l_ht_¡©s_İ’
(
šode
 *šode, 
fe
 *file)

147 
mš¡»l_ht_¡a
 *
mi
 = 
šode
->
i_´iv©e
;

148 
mš¡»l_debugfs_šfo
 *
ms
;

149 
i
;

150 *
p
;

152 
ms
 = 
	`km®loc
(32768, 
GFP_KERNEL
);

153 ià(!
ms
)

154  -
ENOMEM
;

156 
fe
->
´iv©e_d©a
 = 
ms
;

157 
p
 = 
ms
->
buf
;

159 
p
 +ğ
	`¥rštf
(p, "\n");

160 
p
 +ğ
	`¥rštf
(p,

162 
p
 +ğ
	`¥rštf
(p,

165 
p
 = 
	`mš¡»l_ht_¡©s_dump
(
mi
, 
MINSTREL_CCK_GROUP
,…);

166 
i
 = 0; i < 
MINSTREL_CCK_GROUP
; i++)

167 
p
 = 
	`mš¡»l_ht_¡©s_dump
(
mi
, 
i
,…);

168 
i
++; i < 
	`ARRAY_SIZE
(
mi
->
groups
); i++)

169 
p
 = 
	`mš¡»l_ht_¡©s_dump
(
mi
, 
i
,…);

171 
p
 +ğ
	`¥rštf
(p, "\nTotal…acket count:: ideal %d "

173 
	`max
(0, (è
mi
->
tÙ®_·ck‘s
 - (èmi->
§m¶e_·ck‘s
),

174 
mi
->
§m¶e_·ck‘s
);

175 ià(
mi
->
avg_ampdu_Ën
)

176 
p
 +ğ
	`¥rštf
(p, "Average # of‡ggregated frames…er A-MPDU: %d.%d\n",

177 
	`MINSTREL_TRUNC
(
mi
->
avg_ampdu_Ën
),

178 
	`MINSTREL_TRUNC
(
mi
->
avg_ampdu_Ën
 * 10) % 10);

179 
ms
->
Ën
 = 
p
 - ms->
buf
;

180 
	`WARN_ON
(
ms
->
Ën
 + (*ms) > 32768);

182  
	`nÚ£ekabË_İ’
(
šode
, 
fe
);

183 
	}
}

185 cÚ¡ 
fe_İ”©iÚs
 
	gmš¡»l_ht_¡©_fİs
 = {

186 .
owÃr
 = 
THIS_MODULE
,

187 .
	gİ’
 = 
mš¡»l_ht_¡©s_İ’
,

188 .
	g»ad
 = 
mš¡»l_¡©s_»ad
,

189 .
	g»Ëa£
 = 
mš¡»l_¡©s_»Ëa£
,

190 .
	gÎ£ek
 = 
no_Î£ek
,

194 
	$mš¡»l_ht_¡©s_csv_dump
(
mš¡»l_ht_¡a
 *
mi
, 
i
, *
p
)

196 cÚ¡ 
mcs_group
 *
mg
;

197 
j
, 
_max
, 
_avg
, 
•rob
, 
tx_time
;

198 
htmode
 = '2';

199 
gimode
 = 'L';

200 
u32
 
gæags
;

202 ià(!
mi
->
suµÜ‹d
[
i
])

203  
p
;

205 
mg
 = &
mš¡»l_mcs_groups
[
i
];

206 
gæags
 = 
mg
->
æags
;

208 ià(
gæags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

209 
htmode
 = '4';

210 ià(
gæags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

211 
htmode
 = '8';

212 ià(
gæags
 & 
IEEE80211_TX_RC_SHORT_GI
)

213 
gimode
 = 'S';

215 
j
 = 0; j < 
MCS_GROUP_RATES
; j++) {

216 
mš¡»l_¿‹_¡©s
 *
mrs
 = &
mi
->
groups
[
i
].
¿‹s
[
j
];

217 
idx
 = 
	`MI_RATE
(
i
, 
j
);

218 
du¿tiÚ
;

220 ià(!(
mi
->
suµÜ‹d
[
i
] & 
	`BIT
(
j
)))

223 ià(
gæags
 & 
IEEE80211_TX_RC_MCS
) {

224 
p
 +ğ
	`¥rštf
Õ, "HT%c0,", 
htmode
);

225 
p
 +ğ
	`¥rštf
Õ, "%cGI,", 
gimode
);

226 
p
 +ğ
	`¥rštf
Õ, "%d,", 
mg
->
¡»ams
);

227 } ià(
gæags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

228 
p
 +ğ
	`¥rštf
Õ, "VHT%c0,", 
htmode
);

229 
p
 +ğ
	`¥rštf
Õ, "%cGI,", 
gimode
);

230 
p
 +ğ
	`¥rštf
Õ, "%d,", 
mg
->
¡»ams
);

231 } ià(
i
 =ğ
MINSTREL_OFDM_GROUP
) {

232 
p
 +ğ
	`¥rštf
(p, "OFDM,,1,");

234 
p
 +ğ
	`¥rštf
(p, "CCK,");

235 
p
 +ğ
	`¥rštf
Õ, "%cP,", 
j
 < 4 ? 'L' : 'S');

236 
p
 +ğ
	`¥rštf
(p, "1,");

239 
p
 +ğ
	`¥rštf
Õ, "%s" ,((
idx
 =ğ
mi
->
max__¿‹
[0]) ? "A" : ""));

240 
p
 +ğ
	`¥rštf
Õ, "%s" ,((
idx
 =ğ
mi
->
max__¿‹
[1]) ? "B" : ""));

241 
p
 +ğ
	`¥rštf
Õ, "%s" ,((
idx
 =ğ
mi
->
max__¿‹
[2]) ? "C" : ""));

242 
p
 +ğ
	`¥rštf
Õ, "%s" ,((
idx
 =ğ
mi
->
max__¿‹
[3]) ? "D" : ""));

243 
p
 +ğ
	`¥rštf
Õ, "%s" ,((
idx
 =ğ
mi
->
max_´ob_¿‹
) ? "P" : ""));

244 
p
 +ğ
	`¥rštf
Õ, "%s", (
	`mš¡»l_ht_is_§m¶e_¿‹
(
mi
, 
idx
) ? "S" : ""));

246 ià(
gæags
 & 
IEEE80211_TX_RC_MCS
) {

247 
p
 +ğ
	`¥rštf
Õ, ",MCS%-2u,", (
mg
->
¡»ams
 - 1è* 8 + 
j
);

248 } ià(
gæags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

249 
p
 +ğ
	`¥rštf
Õ, ",MCS%-1u/%1u,", 
j
, 
mg
->
¡»ams
);

251 
r
;

253 ià(
i
 =ğ
MINSTREL_OFDM_GROUP
)

254 
r
 = 
mš¡»l_ofdm_b™¿‹s
[
j
 % 8];

256 
r
 = 
mš¡»l_cck_b™¿‹s
[
j
 % 4];

258 
p
 +ğ
	`¥rštf
Õ, ",%2u.%1uM,", 
r
 / 10,„ % 10);

261 
p
 +ğ
	`¥rštf
Õ, "%u,", 
idx
);

263 
du¿tiÚ
 = 
mg
->du¿tiÚ[
j
];

264 
du¿tiÚ
 <<ğ
mg
->
shiá
;

265 
tx_time
 = 
	`DIV_ROUND_CLOSEST
(
du¿tiÚ
, 1000);

266 
p
 +ğ
	`¥rštf
Õ, "%u,", 
tx_time
);

268 
_max
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
i
, 
j
, 
	`MINSTREL_FRAC
(100, 100));

269 
_avg
 = 
	`mš¡»l_ht_g‘__avg
(
mi
, 
i
, 
j
, 
mrs
->
´ob_avg
);

270 
•rob
 = 
	`MINSTREL_TRUNC
(
mrs
->
´ob_avg
 * 1000);

272 
p
 +ğ
	`¥rštf
(p, "%u.%u,%u.%u,%u.%u,%u,%u,"

274 
_max
 / 10,p_max % 10,

275 
_avg
 / 10,p_avg % 10,

276 
•rob
 / 10,ƒprob % 10,

277 
mrs
->
»Œy_couÁ
,

278 
mrs
->
Ï¡_sucûss
,

279 
mrs
->
Ï¡_©‹m±s
,

280 ()
mrs
->
succ_hi¡
,

281 ()
mrs
->
©t_hi¡
);

282 
p
 +ğ
	`¥rštf
(p, "%d,%d,%d.%d\n",

283 
	`max
(0, (è
mi
->
tÙ®_·ck‘s
 -

284 (è
mi
->
§m¶e_·ck‘s
),

285 
mi
->
§m¶e_·ck‘s
,

286 
	`MINSTREL_TRUNC
(
mi
->
avg_ampdu_Ën
),

287 
	`MINSTREL_TRUNC
(
mi
->
avg_ampdu_Ën
 * 10) % 10);

290  
p
;

291 
	}
}

294 
	$mš¡»l_ht_¡©s_csv_İ’
(
šode
 *šode, 
fe
 *file)

296 
mš¡»l_ht_¡a
 *
mi
 = 
šode
->
i_´iv©e
;

297 
mš¡»l_debugfs_šfo
 *
ms
;

298 
i
;

299 *
p
;

301 
ms
 = 
	`km®loc
(32768, 
GFP_KERNEL
);

302 ià(!
ms
)

303  -
ENOMEM
;

305 
fe
->
´iv©e_d©a
 = 
ms
;

307 
p
 = 
ms
->
buf
;

309 
p
 = 
	`mš¡»l_ht_¡©s_csv_dump
(
mi
, 
MINSTREL_CCK_GROUP
,…);

310 
i
 = 0; i < 
MINSTREL_CCK_GROUP
; i++)

311 
p
 = 
	`mš¡»l_ht_¡©s_csv_dump
(
mi
, 
i
,…);

312 
i
++; i < 
	`ARRAY_SIZE
(
mi
->
groups
); i++)

313 
p
 = 
	`mš¡»l_ht_¡©s_csv_dump
(
mi
, 
i
,…);

315 
ms
->
Ën
 = 
p
 - ms->
buf
;

316 
	`WARN_ON
(
ms
->
Ën
 + (*ms) > 32768);

318  
	`nÚ£ekabË_İ’
(
šode
, 
fe
);

319 
	}
}

321 cÚ¡ 
fe_İ”©iÚs
 
	gmš¡»l_ht_¡©_csv_fİs
 = {

322 .
owÃr
 = 
THIS_MODULE
,

323 .
	gİ’
 = 
mš¡»l_ht_¡©s_csv_İ’
,

324 .
	g»ad
 = 
mš¡»l_¡©s_»ad
,

325 .
	g»Ëa£
 = 
mš¡»l_¡©s_»Ëa£
,

326 .
	gÎ£ek
 = 
no_Î£ek
,

330 
	$mš¡»l_ht_add_¡a_debugfs
(*
´iv
, *
´iv_¡a
, 
d’Œy
 *
dœ
)

332 
	`debugfs_ü—‹_fe
("rc_¡©s", 0444, 
dœ
, 
´iv_¡a
,

333 &
mš¡»l_ht_¡©_fİs
);

334 
	`debugfs_ü—‹_fe
("rc_¡©s_csv", 0444, 
dœ
, 
´iv_¡a
,

335 &
mš¡»l_ht_¡©_csv_fİs
);

336 
	}
}

	@rx.c

12 
	~<lšux/jiff›s.h
>

13 
	~<lšux/¦ab.h
>

14 
	~<lšux/k”Ãl.h
>

15 
	~<lšux/skbuff.h
>

16 
	~<lšux/Ãtdeviû.h
>

17 
	~<lšux/‘h”deviû.h
>

18 
	~<lšux/rcupd©e.h
>

19 
	~<lšux/expÜt.h
>

20 
	~<lšux/kcov.h
>

21 
	~<lšux/b™İs.h
>

22 
	~<kun™/visib™y.h
>

23 
	~<Ãt/mac80211.h
>

24 
	~<Ãt/›“80211_¿diÙ­.h
>

25 
	~<asm/uÇligÃd.h
>

27 
	~"›“80211_i.h
"

28 
	~"driv”-İs.h
"

29 
	~"Ëd.h
"

30 
	~"mesh.h
"

31 
	~"w•.h
"

32 
	~"w·.h
"

33 
	~"tk.h
"

34 
	~"wme.h
"

35 
	~"¿‹.h
"

43 
sk_buff
 *
	$›“80211_ş—n_skb
(
sk_buff
 *
skb
,

44 
´e£Á_fcs_Ën
,

45 
¹­_¥aû
)

47 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

48 
›“80211_hdr
 *
hdr
;

49 
hd¾’
;

50 
__Ë16
 
fc
;

52 ià(
´e£Á_fcs_Ën
)

53 
	`__pskb_Œim
(
skb
, skb->
Ën
 - 
´e£Á_fcs_Ën
);

54 
	`pskb_puÎ
(
skb
, 
¹­_¥aû
);

59 
¡©us
->
æag
 &ğ~(
RX_FLAG_RADIOTAP_TLV_AT_END
 |

60 
RX_FLAG_RADIOTAP_LSIG
 |

61 
RX_FLAG_RADIOTAP_HE_MU
 |

62 
RX_FLAG_RADIOTAP_HE
);

64 
hdr
 = (*)
skb
->
d©a
;

65 
fc
 = 
hdr
->
äame_cÚŒŞ
;

74 ià(
	`lik–y
(!
	`›“80211_is_mgmt
(
fc
è|| !
	`›“80211_has_Üd”
(fc)))

75  
skb
;

77 
hd¾’
 = 
	`›“80211_hd¾’
(
fc
);

78 
hdr
->
äame_cÚŒŞ
 &ğ~
	`ıu_to_Ë16
(
IEEE80211_FCTL_ORDER
);

80 ià(!
	`pskb_may_puÎ
(
skb
, 
hd¾’
)) {

81 
	`dev_kä“_skb
(
skb
);

82  
NULL
;

85 
	`memmove
(
skb
->
d©a
 + 
IEEE80211_HT_CTL_LEN
, skb->data,

86 
hd¾’
 - 
IEEE80211_HT_CTL_LEN
);

87 
	`pskb_puÎ
(
skb
, 
IEEE80211_HT_CTL_LEN
);

89  
skb
;

90 
	}
}

92 
šlše
 
boŞ
 
	$should_drİ_äame
(
sk_buff
 *
skb
, 
´e£Á_fcs_Ën
,

93 
¹­_¥aû
)

95 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

96 
›“80211_hdr
 *
hdr
;

98 
hdr
 = (*)(
skb
->
d©a
 + 
¹­_¥aû
);

100 ià(
¡©us
->
æag
 & (
RX_FLAG_FAILED_FCS_CRC
 |

101 
RX_FLAG_FAILED_PLCP_CRC
 |

102 
RX_FLAG_ONLY_MONITOR
 |

103 
RX_FLAG_NO_PSDU
))

104  
Œue
;

106 ià(
	`uÆik–y
(
skb
->
Ën
 < 16 + 
´e£Á_fcs_Ën
 + 
¹­_¥aû
))

107  
Œue
;

109 ià(
	`›“80211_is_ùl
(
hdr
->
äame_cÚŒŞ
) &&

110 !
	`›“80211_is_p¥Şl
(
hdr
->
äame_cÚŒŞ
) &&

111 !
	`›“80211_is_back_»q
(
hdr
->
äame_cÚŒŞ
))

112  
Œue
;

114  
çl£
;

115 
	}
}

118 
	$›“80211_rx_¿diÙ­_hd¾’
(
›“80211_loÿl
 *
loÿl
,

119 
›“80211_rx_¡©us
 *
¡©us
,

120 
sk_buff
 *
skb
)

122 
Ën
;

125 
Ën
 = (
›“80211_¿diÙ­_h—d”
) + 8;

128 ià(
¡©us
->
chašs
)

129 
Ën
 +ğ4 * 
	`hweight8
(
¡©us
->
chašs
);

131 ià(
	`›“80211_have_rx_time¡amp
(
¡©us
)) {

132 
Ën
 = 
	`ALIGN
(len, 8);

133 
Ën
 += 8;

135 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SIGNAL_DBM
))

136 
Ën
 += 1;

139 ià(!
¡©us
->
chašs
)

140 
Ën
 += 1;

143 
Ën
 = 
	`ALIGN
(len, 2);

145 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_HT
)

146 
Ën
 += 3;

148 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_DETAILS
) {

149 
Ën
 = 
	`ALIGN
(len, 4);

150 
Ën
 += 8;

153 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_VHT
) {

154 
Ën
 = 
	`ALIGN
(len, 2);

155 
Ën
 += 12;

158 ià(
loÿl
->
hw
.
¿diÙ­_time¡amp
.
un™s_pos
 >= 0) {

159 
Ën
 = 
	`ALIGN
(len, 8);

160 
Ën
 += 12;

163 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_HE
 &&

164 
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE
) {

165 
Ën
 = 
	`ALIGN
(len, 2);

166 
Ën
 += 12;

167 
	`BUILD_BUG_ON
((
›“80211_¿diÙ­_he
) != 12);

170 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_HE
 &&

171 
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE_MU
) {

172 
Ën
 = 
	`ALIGN
(len, 2);

173 
Ën
 += 12;

174 
	`BUILD_BUG_ON
((
›“80211_¿diÙ­_he_mu
) != 12);

177 ià(
¡©us
->
æag
 & 
RX_FLAG_NO_PSDU
)

178 
Ën
 += 1;

180 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_LSIG
) {

181 
Ën
 = 
	`ALIGN
(len, 2);

182 
Ën
 += 4;

183 
	`BUILD_BUG_ON
((
›“80211_¿diÙ­_lsig
) != 4);

186 ià(
¡©us
->
chašs
) {

188 
Ën
 +ğ2 * 
	`hweight8
(
¡©us
->
chašs
);

191 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_TLV_AT_END
) {

192 
v_off£t
 = 0;

198 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE
)

199 
v_off£t
 +=

200 (
›“80211_¿diÙ­_he
);

201 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE_MU
)

202 
v_off£t
 +=

203 (
›“80211_¿diÙ­_he_mu
);

204 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_LSIG
)

205 
v_off£t
 +=

206 (
›“80211_¿diÙ­_lsig
);

209 
Ën
 = 
	`ALIGN
(len, 4);

212 
Ën
 +ğ
	`skb_mac_h—d”
(
skb
è- &skb->
d©a
[
v_off£t
];

215  
Ën
;

216 
	}
}

218 
	$__›“80211_queue_skb_to_içû
(
›“80211_sub_if_d©a
 *
sd©a
,

219 
lšk_id
,

220 
¡a_šfo
 *
¡a
,

221 
sk_buff
 *
skb
)

223 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

225 ià(
lšk_id
 >= 0) {

226 
¡©us
->
lšk_v®id
 = 1;

227 
¡©us
->
lšk_id
 =†ink_id;

229 
¡©us
->
lšk_v®id
 = 0;

232 
	`skb_queue_
(&
sd©a
->
skb_queue
, 
skb
);

233 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

234 ià(
¡a
)

235 
¡a
->
deæšk
.
rx_¡©s
.
·ck‘s
++;

236 
	}
}

238 
	$›“80211_queue_skb_to_içû
(
›“80211_sub_if_d©a
 *
sd©a
,

239 
lšk_id
,

240 
¡a_šfo
 *
¡a
,

241 
sk_buff
 *
skb
)

243 
skb
->
´ÙocŞ
 = 0;

244 
	`__›“80211_queue_skb_to_içû
(
sd©a
, 
lšk_id
, 
¡a
, 
skb
);

245 
	}
}

247 
	$›“80211_hªdË_mu_mimo_mÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

248 
sk_buff
 *
skb
,

249 
¹­_¥aû
)

252 
›“80211_hdr_3addr
 
hdr
;

253 
u8
 
ÿ‹gÜy
;

254 
u8
 
aùiÚ_code
;

255 } 
__·cked
 
	`__®igÃd
(2è
aùiÚ
;

257 ià(!
sd©a
)

260 
	`BUILD_BUG_ON
((
aùiÚ
è!ğ
IEEE80211_MIN_ACTION_SIZE
 + 1);

262 ià(
skb
->
Ën
 < 
¹­_¥aû
 + (
aùiÚ
) +

263 
VHT_MUMIMO_GROUPS_DATA_LEN
)

266 ià(!
	`is_v®id_‘h”_addr
(
sd©a
->
u
.
mÁr
.
mu_fŞlow_addr
))

269 
	`skb_cİy_b™s
(
skb
, 
¹­_¥aû
, &
aùiÚ
, (action));

271 ià(!
	`›“80211_is_aùiÚ
(
aùiÚ
.
hdr
.
äame_cÚŒŞ
))

274 ià(
aùiÚ
.
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_VHT
)

277 ià(
aùiÚ
.
aùiÚ_code
 !ğ
WLAN_VHT_ACTION_GROUPID_MGMT
)

280 ià(!
	`‘h”_addr_equ®
(
aùiÚ
.
hdr
.
addr1
, 
sd©a
->
u
.
mÁr
.
mu_fŞlow_addr
))

283 
skb
 = 
	`skb_cİy
(skb, 
GFP_ATOMIC
);

284 ià(!
skb
)

287 
	`›“80211_queue_skb_to_içû
(
sd©a
, -1, 
NULL
, 
skb
);

288 
	}
}

296 
	$›“80211_add_rx_¿diÙ­_h—d”
(
›“80211_loÿl
 *
loÿl
,

297 
sk_buff
 *
skb
,

298 
›“80211_¿‹
 *
¿‹
,

299 
¹­_Ën
, 
boŞ
 
has_fcs
)

301 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

302 
›“80211_¿diÙ­_h—d”
 *
¹hdr
;

303 *
pos
;

304 
__Ë32
 *
™_´e£Á
;

305 
u32
 
™_´e£Á_v®
;

306 
u16
 
rx_æags
 = 0;

307 
u16
 
chªÃl_æags
 = 0;

308 
u32
 
vs_Ën
 = 0;

309 
mpduËn
, 
chaš
;

310 
chašs
 = 
¡©us
->chains;

311 
›“80211_¿diÙ­_he
 
he
 = {};

312 
›“80211_¿diÙ­_he_mu
 
he_mu
 = {};

313 
›“80211_¿diÙ­_lsig
 
lsig
 = {};

315 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE
) {

316 
he
 = *(
›“80211_¿diÙ­_he
 *)
skb
->
d©a
;

317 
	`skb_puÎ
(
skb
, (
he
));

318 
	`WARN_ON_ONCE
(
¡©us
->
’codšg
 !ğ
RX_ENC_HE
);

321 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE_MU
) {

322 
he_mu
 = *(
›“80211_¿diÙ­_he_mu
 *)
skb
->
d©a
;

323 
	`skb_puÎ
(
skb
, (
he_mu
));

326 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_LSIG
) {

327 
lsig
 = *(
›“80211_¿diÙ­_lsig
 *)
skb
->
d©a
;

328 
	`skb_puÎ
(
skb
, (
lsig
));

331 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_TLV_AT_END
) {

333 
vs_Ën
 = 
	`skb_mac_h—d”
(
skb
è- skb->
d©a
;

336 
mpduËn
 = 
skb
->
Ën
;

337 ià(!(
has_fcs
 && 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
RX_INCLUDES_FCS
)))

338 
mpduËn
 +ğ
FCS_LEN
;

340 
¹hdr
 = 
	`skb_push
(
skb
, 
¹­_Ën
 - 
vs_Ën
);

341 
	`mem£t
(
¹hdr
, 0, 
¹­_Ën
 - 
vs_Ën
);

342 
™_´e£Á
 = &
¹hdr
->it_present;

345 
¹hdr
->
™_Ën
 = 
	`ıu_to_Ë16
(
¹­_Ën
);

346 
™_´e£Á_v®
 = 
	`BIT
(
IEEE80211_RADIOTAP_FLAGS
) |

347 
	`BIT
(
IEEE80211_RADIOTAP_CHANNEL
) |

348 
	`BIT
(
IEEE80211_RADIOTAP_RX_FLAGS
);

350 ià(!
¡©us
->
chašs
)

351 
™_´e£Á_v®
 |ğ
	`BIT
(
IEEE80211_RADIOTAP_ANTENNA
);

353 
	`fÜ_—ch_£t_b™
(
chaš
, &
chašs
, 
IEEE80211_MAX_CHAINS
) {

354 
™_´e£Á_v®
 |=

355 
	`BIT
(
IEEE80211_RADIOTAP_EXT
) |

356 
	`BIT
(
IEEE80211_RADIOTAP_RADIOTAP_NAMESPACE
);

357 
	`put_uÇligÃd_Ë32
(
™_´e£Á_v®
, 
™_´e£Á
);

358 
™_´e£Á
++;

359 
™_´e£Á_v®
 = 
	`BIT
(
IEEE80211_RADIOTAP_ANTENNA
) |

360 
	`BIT
(
IEEE80211_RADIOTAP_DBM_ANTSIGNAL
);

363 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_TLV_AT_END
)

364 
™_´e£Á_v®
 |ğ
	`BIT
(
IEEE80211_RADIOTAP_TLV
);

366 
	`put_uÇligÃd_Ë32
(
™_´e£Á_v®
, 
™_´e£Á
);

373 
pos
 = (*)&
¹hdr
->
™_İtiÚ®
[
™_´e£Á
 + 1 -„thdr->it_optional];

378 ià(
	`›“80211_have_rx_time¡amp
(
¡©us
)) {

380 (
pos
 - (
u8
 *)
¹hdr
) & 7)

381 *
pos
++ = 0;

382 
	`put_uÇligÃd_Ë64
(

383 
	`›“80211_ÿlcuÏ‹_rx_time¡amp
(
loÿl
, 
¡©us
,

384 
mpduËn
, 0),

385 
pos
);

386 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_TSFT
));

387 
pos
 += 8;

391 ià(
has_fcs
 && 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
RX_INCLUDES_FCS
))

392 *
pos
 |ğ
IEEE80211_RADIOTAP_F_FCS
;

393 ià(
¡©us
->
æag
 & (
RX_FLAG_FAILED_FCS_CRC
 | 
RX_FLAG_FAILED_PLCP_CRC
))

394 *
pos
 |ğ
IEEE80211_RADIOTAP_F_BADFCS
;

395 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORTPRE
)

396 *
pos
 |ğ
IEEE80211_RADIOTAP_F_SHORTPRE
;

397 
pos
++;

400 ià(!
¿‹
 || 
¡©us
->
’codšg
 !ğ
RX_ENC_LEGACY
) {

407 *
pos
 = 0;

409 
shiá
 = 0;

410 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_RATE
));

411 ià(
¡©us
->
bw
 =ğ
RATE_INFO_BW_10
)

412 
shiá
 = 1;

413 ià(
¡©us
->
bw
 =ğ
RATE_INFO_BW_5
)

414 
shiá
 = 2;

415 *
pos
 = 
	`DIV_ROUND_UP
(
¿‹
->
b™¿‹
, 5 * (1 << 
shiá
));

417 
pos
++;

421 
	`put_uÇligÃd_Ë16
(
¡©us
->
äeq
, 
pos
);

422 
pos
 += 2;

423 ià(
¡©us
->
bw
 =ğ
RATE_INFO_BW_10
)

424 
chªÃl_æags
 |ğ
IEEE80211_CHAN_HALF
;

425 ià(
¡©us
->
bw
 =ğ
RATE_INFO_BW_5
)

426 
chªÃl_æags
 |ğ
IEEE80211_CHAN_QUARTER
;

428 ià(
¡©us
->
bªd
 =ğ
NL80211_BAND_5GHZ
 ||

429 
¡©us
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

430 
chªÃl_æags
 |ğ
IEEE80211_CHAN_OFDM
 | 
IEEE80211_CHAN_5GHZ
;

431 ià(
¡©us
->
’codšg
 !ğ
RX_ENC_LEGACY
)

432 
chªÃl_æags
 |ğ
IEEE80211_CHAN_DYN
 | 
IEEE80211_CHAN_2GHZ
;

433 ià(
¿‹
 &&„©e->
æags
 & 
IEEE80211_RATE_ERP_G
)

434 
chªÃl_æags
 |ğ
IEEE80211_CHAN_OFDM
 | 
IEEE80211_CHAN_2GHZ
;

435 ià(
¿‹
)

436 
chªÃl_æags
 |ğ
IEEE80211_CHAN_CCK
 | 
IEEE80211_CHAN_2GHZ
;

438 
chªÃl_æags
 |ğ
IEEE80211_CHAN_2GHZ
;

439 
	`put_uÇligÃd_Ë16
(
chªÃl_æags
, 
pos
);

440 
pos
 += 2;

443 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SIGNAL_DBM
) &&

444 !(
¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
)) {

445 *
pos
 = 
¡©us
->
sigÇl
;

446 
¹hdr
->
™_´e£Á
 |=

447 
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_DBM_ANTSIGNAL
));

448 
pos
++;

453 ià(!
¡©us
->
chašs
) {

455 *
pos
 = 
¡©us
->
ª‹Âa
;

456 
pos
++;

463 ià((
pos
 - (
u8
 *)
¹hdr
) & 1)

464 *
pos
++ = 0;

465 ià(
¡©us
->
æag
 & 
RX_FLAG_FAILED_PLCP_CRC
)

466 
rx_æags
 |ğ
IEEE80211_RADIOTAP_F_RX_BADPLCP
;

467 
	`put_uÇligÃd_Ë16
(
rx_æags
, 
pos
);

468 
pos
 += 2;

470 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_HT
) {

471 
¡bc
;

473 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_MCS
));

474 *
pos
 = 
loÿl
->
hw
.
¿diÙ­_mcs_d‘as
;

475 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_HT_GF
)

476 *
pos
 |ğ
IEEE80211_RADIOTAP_MCS_HAVE_FMT
;

477 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_LDPC
)

478 *
pos
 |ğ
IEEE80211_RADIOTAP_MCS_HAVE_FEC
;

479 
pos
++;

480 *
pos
 = 0;

481 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

482 *
pos
 |ğ
IEEE80211_RADIOTAP_MCS_SGI
;

483 ià(
¡©us
->
bw
 =ğ
RATE_INFO_BW_40
)

484 *
pos
 |ğ
IEEE80211_RADIOTAP_MCS_BW_40
;

485 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_HT_GF
)

486 *
pos
 |ğ
IEEE80211_RADIOTAP_MCS_FMT_GF
;

487 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_LDPC
)

488 *
pos
 |ğ
IEEE80211_RADIOTAP_MCS_FEC_LDPC
;

489 
¡bc
 = (
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_STBC_MASK
è>> 
RX_ENC_FLAG_STBC_SHIFT
;

490 *
pos
 |ğ
¡bc
 << 
IEEE80211_RADIOTAP_MCS_STBC_SHIFT
;

491 
pos
++;

492 *
pos
++ = 
¡©us
->
¿‹_idx
;

495 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_DETAILS
) {

496 
u16
 
æags
 = 0;

499 (
pos
 - (
u8
 *)
¹hdr
) & 3)

500 
pos
++;

501 
¹hdr
->
™_´e£Á
 |=

502 
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_AMPDU_STATUS
));

503 
	`put_uÇligÃd_Ë32
(
¡©us
->
ampdu_»ã»nû
, 
pos
);

504 
pos
 += 4;

505 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_LAST_KNOWN
)

506 
æags
 |ğ
IEEE80211_RADIOTAP_AMPDU_LAST_KNOWN
;

507 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_IS_LAST
)

508 
æags
 |ğ
IEEE80211_RADIOTAP_AMPDU_IS_LAST
;

509 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_DELIM_CRC_ERROR
)

510 
æags
 |ğ
IEEE80211_RADIOTAP_AMPDU_DELIM_CRC_ERR
;

511 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_DELIM_CRC_KNOWN
)

512 
æags
 |ğ
IEEE80211_RADIOTAP_AMPDU_DELIM_CRC_KNOWN
;

513 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_EOF_BIT_KNOWN
)

514 
æags
 |ğ
IEEE80211_RADIOTAP_AMPDU_EOF_KNOWN
;

515 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_EOF_BIT
)

516 
æags
 |ğ
IEEE80211_RADIOTAP_AMPDU_EOF
;

517 
	`put_uÇligÃd_Ë16
(
æags
, 
pos
);

518 
pos
 += 2;

519 ià(
¡©us
->
æag
 & 
RX_FLAG_AMPDU_DELIM_CRC_KNOWN
)

520 *
pos
++ = 
¡©us
->
ampdu_d–im™”_üc
;

522 *
pos
++ = 0;

523 *
pos
++ = 0;

526 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_VHT
) {

527 
u16
 
known
 = 
loÿl
->
hw
.
¿diÙ­_vht_d‘as
;

529 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_VHT
));

530 
	`put_uÇligÃd_Ë16
(
known
, 
pos
);

531 
pos
 += 2;

533 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

534 *
pos
 |ğ
IEEE80211_RADIOTAP_VHT_FLAG_SGI
;

536 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_STBC_MASK
)

537 *
pos
 |ğ
IEEE80211_RADIOTAP_VHT_FLAG_STBC
;

538 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_BF
)

539 *
pos
 |ğ
IEEE80211_RADIOTAP_VHT_FLAG_BEAMFORMED
;

540 
pos
++;

542 
¡©us
->
bw
) {

543 
RATE_INFO_BW_80
:

544 *
pos
++ = 4;

546 
RATE_INFO_BW_160
:

547 *
pos
++ = 11;

549 
RATE_INFO_BW_40
:

550 *
pos
++ = 1;

553 *
pos
++ = 0;

556 *
pos
 = (
¡©us
->
¿‹_idx
 << 4è| stus->
nss
;

557 
pos
 += 4;

559 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_LDPC
)

560 *
pos
 |ğ
IEEE80211_RADIOTAP_CODING_LDPC_USER0
;

561 
pos
++;

563 
pos
++;

565 
pos
 += 2;

568 ià(
loÿl
->
hw
.
¿diÙ­_time¡amp
.
un™s_pos
 >= 0) {

569 
u16
 
accu¿cy
 = 0;

570 
u8
 
æags
;

571 
u64
 
ts
;

573 
¹hdr
->
™_´e£Á
 |=

574 
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_TIMESTAMP
));

577 (
pos
 - (
u8
 *)
¹hdr
) & 7)

578 
pos
++;

580 ià(
¡©us
->
æag
 & 
RX_FLAG_MACTIME_IS_RTAP_TS64
) {

581 
æags
 = 
IEEE80211_RADIOTAP_TIMESTAMP_FLAG_64BIT
;

582 
ts
 = 
¡©us
->
maùime
;

584 
æags
 = 
IEEE80211_RADIOTAP_TIMESTAMP_FLAG_32BIT
;

585 
ts
 = 
¡©us
->
deviû_time¡amp
;

588 
	`put_uÇligÃd_Ë64
(
ts
, 
pos
);

589 
pos
 +ğ(
u64
);

591 ià(
loÿl
->
hw
.
¿diÙ­_time¡amp
.
accu¿cy
 >= 0) {

592 
accu¿cy
 = 
loÿl
->
hw
.
¿diÙ­_time¡amp
.accuracy;

593 
æags
 |ğ
IEEE80211_RADIOTAP_TIMESTAMP_FLAG_ACCURACY
;

595 
	`put_uÇligÃd_Ë16
(
accu¿cy
, 
pos
);

596 
pos
 +ğ(
u16
);

598 *
pos
++ = 
loÿl
->
hw
.
¿diÙ­_time¡amp
.
un™s_pos
;

599 *
pos
++ = 
æags
;

602 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_HE
 &&

603 
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE
) {

604 
	#HE_PREP
(
f
, 
v®
è
	`Ë16_’code_b™s
(v®, 
IEEE80211_RADIOTAP_HE_
##f)

	)

606 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_STBC_MASK
) {

607 
he
.
d©a6
 |ğ
	`HE_PREP
(
DATA6_NSTS
,

608 
	`FIELD_GET
(
RX_ENC_FLAG_STBC_MASK
,

609 
¡©us
->
’c_æags
));

610 
he
.
d©a3
 |ğ
	`HE_PREP
(
DATA3_STBC
, 1);

612 
he
.
d©a6
 |ğ
	`HE_PREP
(
DATA6_NSTS
, 
¡©us
->
nss
);

615 
	#CHECK_GI
(
s
) \

616 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA5_GI_
##
s
 != \

617 ()
NL80211_RATE_INFO_HE_GI_
##
s
)

	)

619 
	`CHECK_GI
(0
_8
);

620 
	`CHECK_GI
(1
_6
);

621 
	`CHECK_GI
(3
_2
);

623 
he
.
d©a3
 |ğ
	`HE_PREP
(
DATA3_DATA_MCS
, 
¡©us
->
¿‹_idx
);

624 
he
.
d©a3
 |ğ
	`HE_PREP
(
DATA3_DATA_DCM
, 
¡©us
->
he_dcm
);

625 
he
.
d©a3
 |ğ
	`HE_PREP
(
DATA3_CODING
,

626 !!(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_LDPC
));

628 
he
.
d©a5
 |ğ
	`HE_PREP
(
DATA5_GI
, 
¡©us
->
he_gi
);

630 
¡©us
->
bw
) {

631 
RATE_INFO_BW_20
:

632 
he
.
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

633 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_20MHZ
);

635 
RATE_INFO_BW_40
:

636 
he
.
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

637 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_40MHZ
);

639 
RATE_INFO_BW_80
:

640 
he
.
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

641 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_80MHZ
);

643 
RATE_INFO_BW_160
:

644 
he
.
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

645 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_160MHZ
);

647 
RATE_INFO_BW_HE_RU
:

648 
	#CHECK_RU_ALLOC
(
s
) \

649 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_
##
s
##
T
 != \

650 
NL80211_RATE_INFO_HE_RU_ALLOC_
##
s
 + 4)

	)

652 
	`CHECK_RU_ALLOC
(26);

653 
	`CHECK_RU_ALLOC
(52);

654 
	`CHECK_RU_ALLOC
(106);

655 
	`CHECK_RU_ALLOC
(242);

656 
	`CHECK_RU_ALLOC
(484);

657 
	`CHECK_RU_ALLOC
(996);

658 
	`CHECK_RU_ALLOC
(2x996);

660 
he
.
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

661 
¡©us
->
he_ru
 + 4);

664 
	`WARN_ONCE
(1, "Inv®id SU BW %d\n", 
¡©us
->
bw
);

668 (
pos
 - (
u8
 *)
¹hdr
) & 1)

669 
pos
++;

670 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_HE
));

671 
	`memıy
(
pos
, &
he
, (he));

672 
pos
 +ğ(
he
);

675 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_HE
 &&

676 
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE_MU
) {

678 (
pos
 - (
u8
 *)
¹hdr
) & 1)

679 
pos
++;

680 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_HE_MU
));

681 
	`memıy
(
pos
, &
he_mu
, (he_mu));

682 
pos
 +ğ(
he_mu
);

685 ià(
¡©us
->
æag
 & 
RX_FLAG_NO_PSDU
) {

686 
¹hdr
->
™_´e£Á
 |=

687 
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_ZERO_LEN_PSDU
));

688 *
pos
++ = 
¡©us
->
z”o_Ëngth_psdu_ty³
;

691 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_LSIG
) {

693 (
pos
 - (
u8
 *)
¹hdr
) & 1)

694 
pos
++;

695 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_LSIG
));

696 
	`memıy
(
pos
, &
lsig
, (lsig));

697 
pos
 +ğ(
lsig
);

700 
	`fÜ_—ch_£t_b™
(
chaš
, &
chašs
, 
IEEE80211_MAX_CHAINS
) {

701 *
pos
++ = 
¡©us
->
chaš_sigÇl
[
chaš
];

702 *
pos
++ = 
chaš
;

704 
	}
}

706 
sk_buff
 *

707 
	$›“80211_make_mÚ™Ü_skb
(
›“80211_loÿl
 *
loÿl
,

708 
sk_buff
 **
Üigskb
,

709 
›“80211_¿‹
 *
¿‹
,

710 
¹­_¥aû
, 
boŞ
 
u£_Üigskb
)

712 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(*
Üigskb
);

713 
¹_hd¾’
, 
Ãeded_h—droom
;

714 
sk_buff
 *
skb
;

717 
¹_hd¾’
 = 
	`›“80211_rx_¿diÙ­_hd¾’
(
loÿl
, 
¡©us
, *
Üigskb
);

718 
Ãeded_h—droom
 = 
¹_hd¾’
 - 
¹­_¥aû
;

720 ià(
u£_Üigskb
) {

722 
skb
 = *
Üigskb
;

723 *
Üigskb
 = 
NULL
;

732 ià(
	`skb_h—droom
(
skb
è< 
Ãeded_h—droom
 &&

733 
	`pskb_ex·nd_h—d
(
skb
, 
Ãeded_h—droom
, 0, 
GFP_ATOMIC
)) {

734 
	`dev_kä“_skb
(
skb
);

735  
NULL
;

742 
skb
 = 
	`skb_cİy_ex·nd
(*
Üigskb
, 
Ãeded_h—droom
 + 
NET_SKB_PAD
,

743 0, 
GFP_ATOMIC
);

745 ià(!
skb
)

746  
NULL
;

750 
	`›“80211_add_rx_¿diÙ­_h—d”
(
loÿl
, 
skb
, 
¿‹
, 
¹_hd¾’
, 
Œue
);

752 
	`skb_»£t_mac_h—d”
(
skb
);

753 
skb
->
_summed
 = 
CHECKSUM_UNNECESSARY
;

754 
skb
->
pkt_ty³
 = 
PACKET_OTHERHOST
;

755 
skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_2
);

757  
skb
;

758 
	}
}

765 
sk_buff
 *

766 
	$›“80211_rx_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
Üigskb
,

767 
›“80211_¿‹
 *
¿‹
)

769 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
Üigskb
);

770 
›“80211_sub_if_d©a
 *
sd©a
;

771 
sk_buff
 *
mÚskb
 = 
NULL
;

772 
´e£Á_fcs_Ën
 = 0;

773 
¹­_¥aû
 = 0;

774 
›“80211_sub_if_d©a
 *
mÚ™Ü_sd©a
 =

775 
	`rcu_d”eã»nû
(
loÿl
->
mÚ™Ü_sd©a
);

776 
boŞ
 
Úly_mÚ™Ü
 = 
çl£
;

777 
mš_h—d_Ën
;

779 ià(
	`WARN_ON_ONCE
(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_TLV_AT_END
 &&

780 !
	`skb_mac_h—d”_was_£t
(
Üigskb
))) {

782 
	`dev_kä“_skb
(
Üigskb
);

783  
NULL
;

786 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE
)

787 
¹­_¥aû
 +ğ(
›“80211_¿diÙ­_he
);

789 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_HE_MU
)

790 
¹­_¥aû
 +ğ(
›“80211_¿diÙ­_he_mu
);

792 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_LSIG
)

793 
¹­_¥aû
 +ğ(
›“80211_¿diÙ­_lsig
);

795 ià(
¡©us
->
æag
 & 
RX_FLAG_RADIOTAP_TLV_AT_END
)

796 
¹­_¥aû
 +ğ
	`skb_mac_h—d”
(
Üigskb
è- &Üigskb->
d©a
[rtap_space];

798 
mš_h—d_Ën
 = 
¹­_¥aû
;

809 ià(!(
¡©us
->
æag
 & 
RX_FLAG_NO_PSDU
)) {

810 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
RX_INCLUDES_FCS
)) {

811 ià(
	`uÆik–y
(
Üigskb
->
Ën
 <ğ
FCS_LEN
 + 
¹­_¥aû
)) {

813 
	`WARN_ON
(1);

814 
	`dev_kä“_skb
(
Üigskb
);

815  
NULL
;

817 
´e£Á_fcs_Ën
 = 
FCS_LEN
;

821 
mš_h—d_Ën
 += 2;

825 ià(!
	`pskb_may_puÎ
(
Üigskb
, 
mš_h—d_Ën
)) {

826 
	`dev_kä“_skb
(
Üigskb
);

827  
NULL
;

830 
Úly_mÚ™Ü
 = 
	`should_drİ_äame
(
Üigskb
, 
´e£Á_fcs_Ën
, 
¹­_¥aû
);

832 ià(!
loÿl
->
mÚ™Üs
 || (
¡©us
->
æag
 & 
RX_FLAG_SKIP_MONITOR
)) {

833 ià(
Úly_mÚ™Ü
) {

834 
	`dev_kä“_skb
(
Üigskb
);

835  
NULL
;

838  
	`›“80211_ş—n_skb
(
Üigskb
, 
´e£Á_fcs_Ën
,

839 
¹­_¥aû
);

842 
	`›“80211_hªdË_mu_mimo_mÚ
(
mÚ™Ü_sd©a
, 
Üigskb
, 
¹­_¥aû
);

844 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
mÚ_li¡
, 
u
.
mÁr
.
li¡
) {

845 
boŞ
 
Ï¡_mÚ™Ü
 = 
	`li¡_is_Ï¡
(&
sd©a
->
u
.
mÁr
.
li¡
,

846 &
loÿl
->
mÚ_li¡
);

848 ià(!
mÚskb
)

849 
mÚskb
 = 
	`›“80211_make_mÚ™Ü_skb
(
loÿl
, &
Üigskb
,

850 
¿‹
, 
¹­_¥aû
,

851 
Úly_mÚ™Ü
 &&

852 
Ï¡_mÚ™Ü
);

854 ià(
mÚskb
) {

855 
sk_buff
 *
skb
;

857 ià(
Ï¡_mÚ™Ü
) {

858 
skb
 = 
mÚskb
;

859 
mÚskb
 = 
NULL
;

861 
skb
 = 
	`skb_şÚe
(
mÚskb
, 
GFP_ATOMIC
);

864 ià(
skb
) {

865 
skb
->
dev
 = 
sd©a
->dev;

866 
	`dev_sw_Ãt¡©s_rx_add
(
skb
->
dev
, skb->
Ën
);

867 
	`Ãtif_»ûive_skb
(
skb
);

871 ià(
Ï¡_mÚ™Ü
)

876 
	`dev_kä“_skb
(
mÚskb
);

879 ià(!
Üigskb
)

880  
NULL
;

882  
	`›“80211_ş—n_skb
(
Üigskb
, 
´e£Á_fcs_Ën
, 
¹­_¥aû
);

883 
	}
}

885 
	$›“80211_·r£_qos
(
›“80211_rx_d©a
 *
rx
)

887 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

888 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

889 
tid
, 
£qno_idx
, 
£cur™y_idx
;

892 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
)) {

893 
u8
 *
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

895 
tid
 = *
qc
 & 
IEEE80211_QOS_CTL_TID_MASK
;

896 ià(*
qc
 & 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
)

897 
¡©us
->
rx_æags
 |ğ
IEEE80211_RX_AMSDU
;

899 
£qno_idx
 = 
tid
;

900 
£cur™y_idx
 = 
tid
;

913 
£qno_idx
 = 
IEEE80211_NUM_TIDS
;

914 
£cur™y_idx
 = 0;

915 ià(
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

916 
£cur™y_idx
 = 
IEEE80211_NUM_TIDS
;

917 
tid
 = 0;

920 
rx
->
£qno_idx
 = seqno_idx;

921 
rx
->
£cur™y_idx
 = security_idx;

924 
rx
->
skb
->
´iÜ™y
 = (
tid
 > 7) ? 0 :id;

925 
	}
}

952 
	$›“80211_v”ify_®ignm’t
(
›“80211_rx_d©a
 *
rx
)

954 #ifdeà
CONFIG_MAC80211_VERBOSE_DEBUG


955 
	`WARN_ON_ONCE
(()
rx
->
skb
->
d©a
 & 1);

957 
	}
}

962 
	$›“80211_is_uniÿ¡_robu¡_mgmt_äame
(
sk_buff
 *
skb
)

964 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

966 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

969  
	`›“80211_is_robu¡_mgmt_äame
(
skb
);

970 
	}
}

973 
	$›“80211_is_muÉiÿ¡_robu¡_mgmt_äame
(
sk_buff
 *
skb
)

975 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

977 ià(!
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

980  
	`›“80211_is_robu¡_mgmt_äame
(
skb
);

981 
	}
}

985 
	$›“80211_g‘_mm›_keyidx
(
sk_buff
 *
skb
)

987 
›“80211_mgmt
 *
hdr
 = (›“80211_mgmˆ*è
skb
->
d©a
;

988 
›“80211_mm›
 *
mm›
;

989 
›“80211_mm›_16
 *
mm›16
;

991 ià(
skb
->
Ën
 < 24 + (*
mm›
è|| !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
da
))

994 ià(!
	`›“80211_is_robu¡_mgmt_äame
(
skb
) &&

995 !
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
))

998 
mm›
 = (
›“80211_mm›
 *)

999 (
skb
->
d©a
 + skb->
Ën
 - (*
mm›
));

1000 ià(
mm›
->
–em’t_id
 =ğ
WLAN_EID_MMIE
 &&

1001 
mm›
->
Ëngth
 == (*mmie) - 2)

1002  
	`Ë16_to_ıu
(
mm›
->
key_id
);

1004 
mm›16
 = (
›“80211_mm›_16
 *)

1005 (
skb
->
d©a
 + skb->
Ën
 - (*
mm›16
));

1006 ià(
skb
->
Ën
 >ğ24 + (*
mm›16
) &&

1007 
mm›16
->
–em’t_id
 =ğ
WLAN_EID_MMIE
 &&

1008 
mm›16
->
Ëngth
 == (*mmie16) - 2)

1009  
	`Ë16_to_ıu
(
mm›16
->
key_id
);

1012 
	}
}

1014 
	$›“80211_g‘_keyid
(
sk_buff
 *
skb
)

1016 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

1017 
__Ë16
 
fc
 = 
hdr
->
äame_cÚŒŞ
;

1018 
hd¾’
 = 
	`›“80211_hd¾’
(
fc
);

1019 
u8
 
keyid
;

1022 ià(
	`uÆik–y
(
skb
->
Ën
 < 
hd¾’
 + 
IEEE80211_WEP_IV_LEN
))

1023  -
EINVAL
;

1025 
	`skb_cİy_b™s
(
skb
, 
hd¾’
 + 3, &
keyid
, 1);

1027 
keyid
 >>= 6;

1029  
keyid
;

1030 
	}
}

1032 
›“80211_rx_»suÉ
 
	$›“80211_rx_mesh_check
(
›“80211_rx_d©a
 *
rx
)

1034 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

1035 *
dev_addr
 = 
rx
->
sd©a
->
vif
.
addr
;

1037 ià(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
)) {

1038 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

1039 ià(
	`›“80211_has_tods
(
hdr
->
äame_cÚŒŞ
) ||

1040 !
	`›“80211_has_äomds
(
hdr
->
äame_cÚŒŞ
))

1041  
RX_DROP_MONITOR
;

1042 ià(
	`‘h”_addr_equ®
(
hdr
->
addr3
, 
dev_addr
))

1043  
RX_DROP_MONITOR
;

1045 ià(!
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
))

1046  
RX_DROP_MONITOR
;

1047 ià(
	`‘h”_addr_equ®
(
hdr
->
addr4
, 
dev_addr
))

1048  
RX_DROP_MONITOR
;

1056 ià(!
rx
->
¡a
 || 
	`¡a_¶šk_¡©e
Ôx->¡aè!ğ
NL80211_PLINK_ESTAB
) {

1057 
›“80211_mgmt
 *
mgmt
;

1059 ià(!
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

1060  
RX_DROP_MONITOR
;

1062 ià(
	`›“80211_is_aùiÚ
(
hdr
->
äame_cÚŒŞ
)) {

1063 
u8
 
ÿ‹gÜy
;

1066 ià(
rx
->
skb
->
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
)

1067  
RX_DROP_MONITOR
;

1069 
mgmt
 = (
›“80211_mgmt
 *)
hdr
;

1070 
ÿ‹gÜy
 = 
mgmt
->
u
.
aùiÚ
.category;

1071 ià(
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_MESH_ACTION
 &&

1072 
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_SELF_PROTECTED
)

1073  
RX_DROP_MONITOR
;

1074  
RX_CONTINUE
;

1077 ià(
	`›“80211_is_´obe_»q
(
hdr
->
äame_cÚŒŞ
) ||

1078 
	`›“80211_is_´obe_»¥
(
hdr
->
äame_cÚŒŞ
) ||

1079 
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
) ||

1080 
	`›“80211_is_auth
(
hdr
->
äame_cÚŒŞ
))

1081  
RX_CONTINUE
;

1083  
RX_DROP_MONITOR
;

1086  
RX_CONTINUE
;

1087 
	}
}

1089 
šlše
 
boŞ
 
	$›“80211_rx_»Üd”_»ady
(
tid_ampdu_rx
 *
tid_agg_rx
,

1090 
šdex
)

1092 
sk_buff_h—d
 *
äames
 = &
tid_agg_rx
->
»Üd”_buf
[
šdex
];

1093 
sk_buff
 *

 = 
	`skb_³ek_
(
äames
);

1094 
›“80211_rx_¡©us
 *
¡©us
;

1096 ià(
tid_agg_rx
->
»Üd”_buf_f‹»d
 &&

1097 
tid_agg_rx
->
»Üd”_buf_f‹»d
 & 
	`BIT_ULL
(
šdex
))

1098  
Œue
;

1100 ià(!

)

1101  
çl£
;

1103 
¡©us
 = 
	`IEEE80211_SKB_RXCB
(

);

1104 ià(
¡©us
->
æag
 & 
RX_FLAG_AMSDU_MORE
)

1105  
çl£
;

1107  
Œue
;

1108 
	}
}

1110 
	$›“80211_»Ëa£_»Üd”_äame
(
›“80211_sub_if_d©a
 *
sd©a
,

1111 
tid_ampdu_rx
 *
tid_agg_rx
,

1112 
šdex
,

1113 
sk_buff_h—d
 *
äames
)

1115 
sk_buff_h—d
 *
skb_li¡
 = &
tid_agg_rx
->
»Üd”_buf
[
šdex
];

1116 
sk_buff
 *
skb
;

1117 
›“80211_rx_¡©us
 *
¡©us
;

1119 
	`lockd•_as£¹_h–d
(&
tid_agg_rx
->
»Üd”_lock
);

1121 ià(
	`skb_queue_em±y
(
skb_li¡
))

1122 
no_äame
;

1124 ià(!
	`›“80211_rx_»Üd”_»ady
(
tid_agg_rx
, 
šdex
)) {

1125 
	`__skb_queue_purge
(
skb_li¡
);

1126 
no_äame
;

1130 
tid_agg_rx
->
¡Üed_mpdu_num
--;

1131 (
skb
 = 
	`__skb_dequeue
(
skb_li¡
))) {

1132 
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1133 
¡©us
->
rx_æags
 |ğ
IEEE80211_RX_DEFERRED_RELEASE
;

1134 
	`__skb_queue_
(
äames
, 
skb
);

1137 
no_äame
:

1138 ià(
tid_agg_rx
->
»Üd”_buf_f‹»d
)

1139 
tid_agg_rx
->
»Üd”_buf_f‹»d
 &ğ~
	`BIT_ULL
(
šdex
);

1140 
tid_agg_rx
->
h—d_£q_num
 = 
	`›“80211_¢_šc
(tid_agg_rx->head_seq_num);

1141 
	}
}

1143 
	$›“80211_»Ëa£_»Üd”_äames
(
›“80211_sub_if_d©a
 *
sd©a
,

1144 
tid_ampdu_rx
 *
tid_agg_rx
,

1145 
u16
 
h—d_£q_num
,

1146 
sk_buff_h—d
 *
äames
)

1148 
šdex
;

1150 
	`lockd•_as£¹_h–d
(&
tid_agg_rx
->
»Üd”_lock
);

1152 
	`›“80211_¢_Ëss
(
tid_agg_rx
->
h—d_£q_num
, head_seq_num)) {

1153 
šdex
 = 
tid_agg_rx
->
h—d_£q_num
 %id_agg_rx->
buf_size
;

1154 
	`›“80211_»Ëa£_»Üd”_äame
(
sd©a
, 
tid_agg_rx
, 
šdex
,

1155 
äames
);

1157 
	}
}

1168 
	#HT_RX_REORDER_BUF_TIMEOUT
 (
HZ
 / 10)

	)

1170 
	$›“80211_¡a_»Üd”_»Ëa£
(
›“80211_sub_if_d©a
 *
sd©a
,

1171 
tid_ampdu_rx
 *
tid_agg_rx
,

1172 
sk_buff_h—d
 *
äames
)

1174 
šdex
, 
i
, 
j
;

1176 
	`lockd•_as£¹_h–d
(&
tid_agg_rx
->
»Üd”_lock
);

1179 
šdex
 = 
tid_agg_rx
->
h—d_£q_num
 %id_agg_rx->
buf_size
;

1180 ià(!
	`›“80211_rx_»Üd”_»ady
(
tid_agg_rx
, 
šdex
) &&

1181 
tid_agg_rx
->
¡Üed_mpdu_num
) {

1186 
sk³d
 = 1;

1187 
j
 = (
šdex
 + 1è% 
tid_agg_rx
->
buf_size
; j != index;

1188 
j
 = (j + 1è% 
tid_agg_rx
->
buf_size
) {

1189 ià(!
	`›“80211_rx_»Üd”_»ady
(
tid_agg_rx
, 
j
)) {

1190 
sk³d
++;

1193 ià(
sk³d
 &&

1194 !
	`time_aá”
(
jiff›s
, 
tid_agg_rx
->
»Üd”_time
[
j
] +

1195 
HT_RX_REORDER_BUF_TIMEOUT
))

1196 
£t_»Ëa£_tim”
;

1199 
i
 = (
šdex
 + 1è% 
tid_agg_rx
->
buf_size
; i !ğ
j
;

1200 
i
 = (˜+ 1è% 
tid_agg_rx
->
buf_size
)

1201 
	`__skb_queue_purge
(&
tid_agg_rx
->
»Üd”_buf
[
i
]);

1203 
	`ht_dbg_¿‹lim™ed
(
sd©a
,

1205 
	`›“80211_»Ëa£_»Üd”_äame
(
sd©a
, 
tid_agg_rx
, 
j
,

1206 
äames
);

1211 
tid_agg_rx
->
h—d_£q_num
 =

1212 (
tid_agg_rx
->
h—d_£q_num
 +

1213 
sk³d
è& 
IEEE80211_SN_MASK
;

1214 
sk³d
 = 0;

1216 } 
	`›“80211_rx_»Üd”_»ady
(
tid_agg_rx
, 
šdex
)) {

1217 
	`›“80211_»Ëa£_»Üd”_äame
(
sd©a
, 
tid_agg_rx
, 
šdex
,

1218 
äames
);

1219 
šdex
 = 
tid_agg_rx
->
h—d_£q_num
 %id_agg_rx->
buf_size
;

1222 ià(
tid_agg_rx
->
¡Üed_mpdu_num
) {

1223 
j
 = 
šdex
 = 
tid_agg_rx
->
h—d_£q_num
 %id_agg_rx->
buf_size
;

1225 ; 
j
 !ğ(
šdex
 - 1è% 
tid_agg_rx
->
buf_size
;

1226 
j
 = (j + 1è% 
tid_agg_rx
->
buf_size
) {

1227 ià(
	`›“80211_rx_»Üd”_»ady
(
tid_agg_rx
, 
j
))

1231 
£t_»Ëa£_tim”
:

1233 ià(!
tid_agg_rx
->
»moved
)

1234 
	`mod_tim”
(&
tid_agg_rx
->
»Üd”_tim”
,

1235 
tid_agg_rx
->
»Üd”_time
[
j
] + 1 +

1236 
HT_RX_REORDER_BUF_TIMEOUT
);

1238 
	`d–_tim”
(&
tid_agg_rx
->
»Üd”_tim”
);

1240 
	}
}

1247 
boŞ
 
	$›“80211_¡a_mªage_»Üd”_buf
(
›“80211_sub_if_d©a
 *
sd©a
,

1248 
tid_ampdu_rx
 *
tid_agg_rx
,

1249 
sk_buff
 *
skb
,

1250 
sk_buff_h—d
 *
äames
)

1252 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

1253 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1254 
u16
 
mpdu_£q_num
 = 
	`›“80211_g‘_¢
(
hdr
);

1255 
u16
 
h—d_£q_num
, 
buf_size
;

1256 
šdex
;

1257 
boŞ
 
»t
 = 
Œue
;

1259 
	`¥š_lock
(&
tid_agg_rx
->
»Üd”_lock
);

1265 ià(
	`uÆik–y
(
tid_agg_rx
->
auto_£q
)) {

1266 
tid_agg_rx
->
auto_£q
 = 
çl£
;

1267 
tid_agg_rx
->
s¢
 = 
mpdu_£q_num
;

1268 
tid_agg_rx
->
h—d_£q_num
 = 
mpdu_£q_num
;

1271 
buf_size
 = 
tid_agg_rx
->buf_size;

1272 
h—d_£q_num
 = 
tid_agg_rx
->head_seq_num;

1278 ià(
	`uÆik–y
(!
tid_agg_rx
->
¡¬‹d
)) {

1279 ià(
	`›“80211_¢_Ëss
(
mpdu_£q_num
, 
h—d_£q_num
)) {

1280 
»t
 = 
çl£
;

1281 
out
;

1283 
tid_agg_rx
->
¡¬‹d
 = 
Œue
;

1287 ià(
	`›“80211_¢_Ëss
(
mpdu_£q_num
, 
h—d_£q_num
)) {

1288 
	`dev_kä“_skb
(
skb
);

1289 
out
;

1296 ià(!
	`›“80211_¢_Ëss
(
mpdu_£q_num
, 
h—d_£q_num
 + 
buf_size
)) {

1297 
h—d_£q_num
 = 
	`›“80211_¢_šc
(

1298 
	`›“80211_¢_sub
(
mpdu_£q_num
, 
buf_size
));

1300 
	`›“80211_»Ëa£_»Üd”_äames
(
sd©a
, 
tid_agg_rx
,

1301 
h—d_£q_num
, 
äames
);

1306 
šdex
 = 
mpdu_£q_num
 % 
tid_agg_rx
->
buf_size
;

1309 ià(
	`›“80211_rx_»Üd”_»ady
(
tid_agg_rx
, 
šdex
)) {

1310 
	`dev_kä“_skb
(
skb
);

1311 
out
;

1320 ià(
mpdu_£q_num
 =ğ
tid_agg_rx
->
h—d_£q_num
 &&

1321 
tid_agg_rx
->
¡Üed_mpdu_num
 == 0) {

1322 ià(!(
¡©us
->
æag
 & 
RX_FLAG_AMSDU_MORE
))

1323 
tid_agg_rx
->
h—d_£q_num
 =

1324 
	`›“80211_¢_šc
(
tid_agg_rx
->
h—d_£q_num
);

1325 
»t
 = 
çl£
;

1326 
out
;

1330 
	`__skb_queue_
(&
tid_agg_rx
->
»Üd”_buf
[
šdex
], 
skb
);

1331 ià(!(
¡©us
->
æag
 & 
RX_FLAG_AMSDU_MORE
)) {

1332 
tid_agg_rx
->
»Üd”_time
[
šdex
] = 
jiff›s
;

1333 
tid_agg_rx
->
¡Üed_mpdu_num
++;

1334 
	`›“80211_¡a_»Üd”_»Ëa£
(
sd©a
, 
tid_agg_rx
, 
äames
);

1337 
out
:

1338 
	`¥š_uÆock
(&
tid_agg_rx
->
»Üd”_lock
);

1339  
»t
;

1340 
	}
}

1346 
	$›“80211_rx_»Üd”_ampdu
(
›“80211_rx_d©a
 *
rx
,

1347 
sk_buff_h—d
 *
äames
)

1349 
sk_buff
 *
skb
 = 
rx
->skb;

1350 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

1351 
¡a_šfo
 *
¡a
 = 
rx
->sta;

1352 
tid_ampdu_rx
 *
tid_agg_rx
;

1353 
u16
 
sc
;

1354 
u8
 
tid
, 
ack_pŞicy
;

1356 ià(!
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) ||

1357 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

1358 
dÚt_»Üd”
;

1365 ià(!
¡a
)

1366 
dÚt_»Üd”
;

1368 
ack_pŞicy
 = *
	`›“80211_g‘_qos_ùl
(
hdr
) &

1369 
IEEE80211_QOS_CTL_ACK_POLICY_MASK
;

1370 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

1372 
tid_agg_rx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.
tid_rx
[
tid
]);

1373 ià(!
tid_agg_rx
) {

1374 ià(
ack_pŞicy
 =ğ
IEEE80211_QOS_CTL_ACK_POLICY_BLOCKACK
 &&

1375 !
	`‹¡_b™
(
tid
, 
rx
->
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
) &&

1376 !
	`‹¡_ªd_£t_b™
(
tid
, 
rx
->
¡a
->
ampdu_mlme
.
uÃx³ùed_agg
))

1377 
	`›“80211_£nd_d–ba
(
rx
->
sd©a
,„x->
¡a
->¡a.
addr
, 
tid
,

1378 
WLAN_BACK_RECIPIENT
,

1379 
WLAN_REASON_QSTA_REQUIRE_SETUP
);

1380 
dÚt_»Üd”
;

1384 ià(
	`uÆik–y
(
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_STYPE_NULLFUNC
)))

1385 
dÚt_»Üd”
;

1388 ià(
ack_pŞicy
 =ğ
IEEE80211_QOS_CTL_ACK_POLICY_NOACK
)

1389 
dÚt_»Üd”
;

1394 ià(
tid_agg_rx
->
timeout
)

1395 
tid_agg_rx
->
Ï¡_rx
 = 
jiff›s
;

1398 
sc
 = 
	`Ë16_to_ıu
(
hdr
->
£q_ù¾
);

1399 ià(
sc
 & 
IEEE80211_SCTL_FRAG
) {

1400 
	`›“80211_queue_skb_to_içû
(
rx
->
sd©a
,„x->
lšk_id
, 
NULL
, 
skb
);

1411 ià(
	`›“80211_¡a_mªage_»Üd”_buf
(
rx
->
sd©a
, 
tid_agg_rx
, 
skb
,

1412 
äames
))

1415 
dÚt_»Üd”
:

1416 
	`__skb_queue_
(
äames
, 
skb
);

1417 
	}
}

1419 
›“80211_rx_»suÉ
 
debug_nošlše


1420 
	$›“80211_rx_h_check_dup
(
›“80211_rx_d©a
 *
rx
)

1422 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

1423 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

1425 ià(
¡©us
->
æag
 & 
RX_FLAG_DUP_VALIDATED
)

1426  
RX_CONTINUE
;

1433 ià(
rx
->
skb
->
Ën
 < 24)

1434  
RX_CONTINUE
;

1436 ià(
	`›“80211_is_ùl
(
hdr
->
äame_cÚŒŞ
) ||

1437 
	`›“80211_is_ªy_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

1438  
RX_CONTINUE
;

1440 ià(!
rx
->
¡a
)

1441  
RX_CONTINUE
;

1443 ià(
	`uÆik–y
(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))) {

1444 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

1445 
u16
 
¢
 = 
	`›“80211_g‘_¢
(
hdr
);

1447 ià(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

1448  
RX_CONTINUE
;

1450 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
) ||

1451 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

1452  
RX_CONTINUE
;

1454 ià(
sd©a
->
u
.
mgd
.
mÿ¡_£q_Ï¡
 !ğ
IEEE80211_SN_MODULO
 &&

1455 
	`›“80211_¢_Ëss_eq
(
¢
, 
sd©a
->
u
.
mgd
.
mÿ¡_£q_Ï¡
))

1456  
RX_DROP_U_DUP
;

1458 
sd©a
->
u
.
mgd
.
mÿ¡_£q_Ï¡
 = 
¢
;

1459  
RX_CONTINUE
;

1462 ià(
	`uÆik–y
(
	`›“80211_has_»Œy
(
hdr
->
äame_cÚŒŞ
) &&

1463 
rx
->
¡a
->
Ï¡_£q_ù¾
[rx->
£qno_idx
] =ğ
hdr
->
£q_ù¾
)) {

1464 
	`I802_DEBUG_INC
(
rx
->
loÿl
->
dÙ11F¿meDu¶iÿ‹CouÁ
);

1465 
rx
->
lšk_¡a
->
rx_¡©s
.
num_du¶iÿ‹s
++;

1466  
RX_DROP_U_DUP
;

1467 } ià(!(
¡©us
->
æag
 & 
RX_FLAG_AMSDU_MORE
)) {

1468 
rx
->
¡a
->
Ï¡_£q_ù¾
[rx->
£qno_idx
] = 
hdr
->
£q_ù¾
;

1471  
RX_CONTINUE
;

1472 
	}
}

1474 
›“80211_rx_»suÉ
 
debug_nošlše


1475 
	$›“80211_rx_h_check
(
›“80211_rx_d©a
 *
rx
)

1477 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

1488 ià(
	`›“80211_vif_is_mesh
(&
rx
->
sd©a
->
vif
))

1489  
	`›“80211_rx_mesh_check
(
rx
);

1491 ià(
	`uÆik–y
((
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) ||

1492 
	`›“80211_is_p¥Şl
(
hdr
->
äame_cÚŒŞ
)) &&

1493 
rx
->
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

1494 
rx
->
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_OCB
 &&

1495 (!
rx
->
¡a
 || !
	`‹¡_¡a_æag
Ôx->¡a, 
WLAN_STA_ASSOC
)))) {

1501 ià(
rx
->
¡a
 &&„x->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

1502 
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
)) {

1503 
hd¾’
;

1504 
__be16
 
‘h”ty³
;

1506 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

1508 ià(
rx
->
skb
->
Ën
 < 
hd¾’
 + 8)

1509  
RX_DROP_MONITOR
;

1511 
	`skb_cİy_b™s
(
rx
->
skb
, 
hd¾’
 + 6, &
‘h”ty³
, 2);

1512 ià(
‘h”ty³
 =ğ
rx
->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

1513  
RX_CONTINUE
;

1516 ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 &&

1517 
	`cfg80211_rx_¥urious_äame
(
rx
->
sd©a
->
dev
,

1518 
hdr
->
addr2
,

1519 
GFP_ATOMIC
))

1520  
RX_DROP_U_SPURIOUS
;

1522  
RX_DROP_MONITOR
;

1525  
RX_CONTINUE
;

1526 
	}
}

1529 
›“80211_rx_»suÉ
 
debug_nošlše


1530 
	$›“80211_rx_h_check_mÜe_d©a
(
›“80211_rx_d©a
 *
rx
)

1532 
›“80211_loÿl
 *
loÿl
;

1533 
›“80211_hdr
 *
hdr
;

1534 
sk_buff
 *
skb
;

1536 
loÿl
 = 
rx
->local;

1537 
skb
 = 
rx
->skb;

1538 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

1540 ià(!
loÿl
->
p¥Şlšg
)

1541  
RX_CONTINUE
;

1543 ià(!
	`›“80211_has_äomds
(
hdr
->
äame_cÚŒŞ
))

1545  
RX_CONTINUE
;

1547 ià(!
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
))

1548  
RX_CONTINUE
;

1550 ià(!
	`›“80211_has_mÜed©a
(
hdr
->
äame_cÚŒŞ
)) {

1552 
loÿl
->
p¥Şlšg
 = 
çl£
;

1553  
RX_CONTINUE
;

1557 
	`›“80211_£nd_p¥Şl
(
loÿl
, 
rx
->
sd©a
);

1559  
RX_CONTINUE
;

1560 
	}
}

1562 
	$¡a_ps_¡¬t
(
¡a_šfo
 *
¡a
)

1564 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1565 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1566 
ps_d©a
 *
ps
;

1567 
tid
;

1569 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

1570 
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

1571 
ps
 = &
sd©a
->
bss
->ps;

1575 
	`©omic_šc
(&
ps
->
num_¡a_ps
);

1576 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
);

1577 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AP_LINK_PS
))

1578 
	`drv_¡a_nÙify
(
loÿl
, 
sd©a
, 
STA_NOTIFY_SLEEP
, &
¡a
->sta);

1579 
	`ps_dbg
(
sd©a
, "STA %pM‡id %dƒnters…ower save mode\n",

1580 
¡a
->¡a.
addr
, s->¡a.
aid
);

1582 
	`›“80211_ş—r_ç¡_xm™
(
¡a
);

1584 
tid
 = 0;id < 
IEEE80211_NUM_TIDS
;id++) {

1585 
›“80211_txq
 *
txq
 = 
¡a
->¡a.txq[
tid
];

1586 
txq_šfo
 *
txqi
 = 
	`to_txq_šfo
(
txq
);

1588 
	`¥š_lock
(&
loÿl
->
aùive_txq_lock
[
txq
->
ac
]);

1589 ià(!
	`li¡_em±y
(&
txqi
->
scheduË_Üd”
))

1590 
	`li¡_d–_š™
(&
txqi
->
scheduË_Üd”
);

1591 
	`¥š_uÆock
(&
loÿl
->
aùive_txq_lock
[
txq
->
ac
]);

1593 ià(
	`txq_has_queue
(
txq
))

1594 
	`£t_b™
(
tid
, &
¡a
->
txq_bufã»d_tids
);

1596 
	`ş—r_b™
(
tid
, &
¡a
->
txq_bufã»d_tids
);

1598 
	}
}

1600 
	$¡a_ps_’d
(
¡a_šfo
 *
¡a
)

1602 
	`ps_dbg
(
¡a
->
sd©a
, "STA %pM‡id %dƒxits…ower save mode\n",

1603 
¡a
->¡a.
addr
, s->¡a.
aid
);

1605 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
)) {

1612 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
);

1613 
	`ps_dbg
(
¡a
->
sd©a
, "STA %pM‡id %d driver-ps-blocked\n",

1614 
¡a
->¡a.
addr
, s->¡a.
aid
);

1618 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
);

1619 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
);

1620 
	`›“80211_¡a_ps_d–iv”_wakeup
(
¡a
);

1621 
	}
}

1623 
	$›“80211_¡a_ps_Œªs™iÚ
(
›“80211_¡a
 *
pub¡a
, 
boŞ
 
¡¬t
)

1625 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

1626 
boŞ
 
š_ps
;

1628 
	`WARN_ON
(!
	`›“80211_hw_check
(&
¡a
->
loÿl
->
hw
, 
AP_LINK_PS
));

1631 
š_ps
 = 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
);

1632 ià((
¡¬t
 && 
š_ps
) || (!start && !in_ps))

1633  -
EINVAL
;

1635 ià(
¡¬t
)

1636 
	`¡a_ps_¡¬t
(
¡a
);

1638 
	`¡a_ps_’d
(
¡a
);

1641 
	}
}

1642 
EXPORT_SYMBOL
(
›“80211_¡a_ps_Œªs™iÚ
);

1644 
	$›“80211_¡a_p¥Şl
(
›“80211_¡a
 *
pub¡a
)

1646 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

1648 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_SP
))

1651 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
))

1652 
	`›“80211_¡a_ps_d–iv”_pŞl_»¥Ú£
(
¡a
);

1654 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_PSPOLL
);

1655 
	}
}

1656 
EXPORT_SYMBOL
(
›“80211_¡a_p¥Şl
);

1658 
	$›“80211_¡a_u­sd_Œigg”
(
›“80211_¡a
 *
pub¡a
, 
u8
 
tid
)

1660 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

1661 
ac
 = 
	`›“80211_ac_äom_tid
(
tid
);

1671 ià(!(
¡a
->¡a.
u­sd_queues
 & 
›“80211_ac_to_qos_mask
[
ac
]) &&

1672 
tid
 !ğ
IEEE80211_NUM_TIDS
)

1676 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_SP
))

1679 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
))

1680 
	`›“80211_¡a_ps_d–iv”_u­sd
(
¡a
);

1682 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_UAPSD
);

1683 
	}
}

1684 
EXPORT_SYMBOL
(
›“80211_¡a_u­sd_Œigg”
);

1686 
›“80211_rx_»suÉ
 
debug_nošlše


1687 
	$›“80211_rx_h_u­sd_ªd_p¥Şl
(
›“80211_rx_d©a
 *
rx
)

1689 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

1690 
›“80211_hdr
 *
hdr
 = (*)
rx
->
skb
->
d©a
;

1691 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

1693 ià(!
rx
->
¡a
)

1694  
RX_CONTINUE
;

1696 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

1697 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
)

1698  
RX_CONTINUE
;

1705 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
AP_LINK_PS
))

1706  
RX_CONTINUE
;

1713 ià(!
	`‹¡_¡a_æag
(
rx
->
¡a
, 
WLAN_STA_PS_STA
))

1714  
RX_CONTINUE
;

1716 ià(
	`uÆik–y
(
	`›“80211_is_p¥Şl
(
hdr
->
äame_cÚŒŞ
))) {

1717 
	`›“80211_¡a_p¥Şl
(&
rx
->
¡a
->sta);

1721 
	`dev_kä“_skb
(
rx
->
skb
);

1723  
RX_QUEUED
;

1724 } ià(!
	`›“80211_has_mÜeäags
(
hdr
->
äame_cÚŒŞ
) &&

1725 !(
¡©us
->
rx_æags
 & 
IEEE80211_RX_DEFERRED_RELEASE
) &&

1726 
	`›“80211_has_pm
(
hdr
->
äame_cÚŒŞ
) &&

1727 (
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) ||

1728 
	`›“80211_is_qos_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))) {

1729 
u8
 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

1731 
	`›“80211_¡a_u­sd_Œigg”
(&
rx
->
¡a
->¡a, 
tid
);

1734  
RX_CONTINUE
;

1735 
	}
}

1737 
›“80211_rx_»suÉ
 
debug_nošlše


1738 
	$›“80211_rx_h_¡a_´oûss
(
›“80211_rx_d©a
 *
rx
)

1740 
¡a_šfo
 *
¡a
 = 
rx
->sta;

1741 
lšk_¡a_šfo
 *
lšk_¡a
 = 
rx
->link_sta;

1742 
sk_buff
 *
skb
 = 
rx
->skb;

1743 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1744 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

1745 
i
;

1747 ià(!
¡a
 || !
lšk_¡a
)

1748  
RX_CONTINUE
;

1758 ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) {

1759 
u8
 *
bssid
 = 
	`›“80211_g‘_bssid
(
hdr
, 
rx
->
skb
->
Ën
,

1760 
NL80211_IFTYPE_ADHOC
);

1761 ià(
	`‘h”_addr_equ®
(
bssid
, 
rx
->
sd©a
->
u
.
ibss
.bssid) &&

1762 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
)) {

1763 
lšk_¡a
->
rx_¡©s
.
Ï¡_rx
 = 
jiff›s
;

1764 ià(
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
) &&

1765 !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

1766 
lšk_¡a
->
rx_¡©s
.
Ï¡_¿‹
 =

1767 
	`¡a_¡©s_’code_¿‹
(
¡©us
);

1769 } ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
) {

1770 
lšk_¡a
->
rx_¡©s
.
Ï¡_rx
 = 
jiff›s
;

1771 } ià(!
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
) &&

1772 !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

1777 
lšk_¡a
->
rx_¡©s
.
Ï¡_rx
 = 
jiff›s
;

1778 ià(
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

1779 
lšk_¡a
->
rx_¡©s
.
Ï¡_¿‹
 = 
	`¡a_¡©s_’code_¿‹
(
¡©us
);

1782 
lšk_¡a
->
rx_¡©s
.
äagm’ts
++;

1784 
	`u64_¡©s_upd©e_begš
(&
lšk_¡a
->
rx_¡©s
.
synı
);

1785 
lšk_¡a
->
rx_¡©s
.
by‹s
 +ğ
rx
->
skb
->
Ën
;

1786 
	`u64_¡©s_upd©e_’d
(&
lšk_¡a
->
rx_¡©s
.
synı
);

1788 ià(!(
¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
)) {

1789 
lšk_¡a
->
rx_¡©s
.
Ï¡_sigÇl
 = 
¡©us
->
sigÇl
;

1790 
	`ewma_sigÇl_add
(&
lšk_¡a
->
rx_¡©s_avg
.
sigÇl
,

1791 -
¡©us
->
sigÇl
);

1794 ià(
¡©us
->
chašs
) {

1795 
lšk_¡a
->
rx_¡©s
.
chašs
 = 
¡©us
->chains;

1796 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡©us
->
chaš_sigÇl
); i++) {

1797 
sigÇl
 = 
¡©us
->
chaš_sigÇl
[
i
];

1799 ià(!(
¡©us
->
chašs
 & 
	`BIT
(
i
)))

1802 
lšk_¡a
->
rx_¡©s
.
chaš_sigÇl_Ï¡
[
i
] = 
sigÇl
;

1803 
	`ewma_sigÇl_add
(&
lšk_¡a
->
rx_¡©s_avg
.
chaš_sigÇl
[
i
],

1804 -
sigÇl
);

1808 ià(
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
))

1809  
RX_CONTINUE
;

1816 ià(!
	`›“80211_hw_check
(&
¡a
->
loÿl
->
hw
, 
AP_LINK_PS
) &&

1817 !
	`›“80211_has_mÜeäags
(
hdr
->
äame_cÚŒŞ
) &&

1818 !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

1819 (
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
) ||

1820 
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
)) &&

1821 !(
¡©us
->
rx_æags
 & 
IEEE80211_RX_DEFERRED_RELEASE
) &&

1822 (
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

1823 
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)) {

1824 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
)) {

1825 ià(!
	`›“80211_has_pm
(
hdr
->
äame_cÚŒŞ
))

1826 
	`¡a_ps_’d
(
¡a
);

1828 ià(
	`›“80211_has_pm
(
hdr
->
äame_cÚŒŞ
))

1829 
	`¡a_ps_¡¬t
(
¡a
);

1834 ià(
	`›“80211_vif_is_mesh
(&
rx
->
sd©a
->
vif
))

1835 
	`›“80211_mps_rx_h_¡a_´oûss
(
¡a
, 
hdr
);

1841 ià(
	`›“80211_is_ªy_nuÎfunc
(
hdr
->
äame_cÚŒŞ
)) {

1842 
	`I802_DEBUG_INC
(
rx
->
loÿl
->
rx_hªdËrs_drİ_nuÎfunc
);

1850 ià(
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
) &&

1851 (
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

1852 (
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

1853 !
rx
->
sd©a
->
u
.
vÏn
.
¡a
))) {

1854 ià(!
	`‹¡_ªd_£t_¡a_æag
(
¡a
, 
WLAN_STA_4ADDR_EVENT
))

1855 
	`cfg80211_rx_uÃx³ùed_4addr_äame
(

1856 
rx
->
sd©a
->
dev
, 
¡a
->¡a.
addr
,

1857 
GFP_ATOMIC
);

1858  
RX_DROP_M_UNEXPECTED_4ADDR_FRAME
;

1864 
lšk_¡a
->
rx_¡©s
.
·ck‘s
++;

1865 
	`dev_kä“_skb
(
rx
->
skb
);

1866  
RX_QUEUED
;

1869  
RX_CONTINUE
;

1870 
	}
}

1872 
›“80211_key
 *

1873 
	$›“80211_rx_g‘_bigtk
(
›“80211_rx_d©a
 *
rx
, 
idx
)

1875 
›“80211_key
 *
key
 = 
NULL
;

1876 
idx2
;

1884 ià(
idx
 < 0) {

1885 
idx
 = 
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
;

1886 
idx2
 = 
idx
 + 1;

1888 ià(
idx
 =ğ
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
)

1889 
idx2
 = 
idx
 + 1;

1891 
idx2
 = 
idx
 - 1;

1894 ià(
rx
->
lšk_¡a
)

1895 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk_¡a
->
gtk
[
idx
]);

1896 ià(!
key
)

1897 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk
->
gtk
[
idx
]);

1898 ià(!
key
 && 
rx
->
lšk_¡a
)

1899 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk_¡a
->
gtk
[
idx2
]);

1900 ià(!
key
)

1901 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk
->
gtk
[
idx2
]);

1903  
key
;

1904 
	}
}

1906 
›“80211_rx_»suÉ
 
debug_nošlše


1907 
	$›“80211_rx_h_deüy±
(
›“80211_rx_d©a
 *
rx
)

1909 
sk_buff
 *
skb
 = 
rx
->skb;

1910 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1911 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

1912 
keyidx
;

1913 
›“80211_rx_»suÉ
 
»suÉ
 = 
RX_DROP_U_DECRYPT_FAIL
;

1914 
›“80211_key
 *
¡a_±k
 = 
NULL
;

1915 
›“80211_key
 *
±k_idx
 = 
NULL
;

1916 
mm›_keyidx
 = -1;

1917 
__Ë16
 
fc
;

1919 ià(
	`›“80211_is_ext
(
hdr
->
äame_cÚŒŞ
))

1920  
RX_CONTINUE
;

1951 
rx
->
key
 = 
NULL
;

1952 
fc
 = 
hdr
->
äame_cÚŒŞ
;

1954 ià(
rx
->
¡a
) {

1955 
keyid
 = 
rx
->
¡a
->
±k_idx
;

1956 
¡a_±k
 = 
	`rcu_d”eã»nû
(
rx
->
¡a
->
±k
[
keyid
]);

1958 ià(
	`›“80211_has_´Ùeùed
(
fc
) &&

1959 !(
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
)) {

1960 
keyid
 = 
	`›“80211_g‘_keyid
(
rx
->
skb
);

1962 ià(
	`uÆik–y
(
keyid
 < 0))

1963  
RX_DROP_U_NO_KEY_ID
;

1965 
±k_idx
 = 
	`rcu_d”eã»nû
(
rx
->
¡a
->
±k
[
keyid
]);

1969 ià(!
	`›“80211_has_´Ùeùed
(
fc
))

1970 
mm›_keyidx
 = 
	`›“80211_g‘_mm›_keyidx
(
rx
->
skb
);

1972 ià(!
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
è&& 
¡a_±k
) {

1973 
rx
->
key
 = 
±k_idx
 ?…tk_idx : 
¡a_±k
;

1974 ià((
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
) &&

1975 (
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
))

1976  
RX_CONTINUE
;

1978 ià(!
	`›“80211_has_´Ùeùed
(
fc
))

1979  
RX_CONTINUE
;

1980 } ià(
mm›_keyidx
 >ğ0 && 
	`›“80211_is_b—cÚ
(
fc
)) {

1982 ià((
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
) &&

1983 (
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
))

1984  
RX_CONTINUE
;

1986 ià(
mm›_keyidx
 < 
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
 ||

1987 
mm›_keyidx
 >ğ
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
 +

1988 
NUM_DEFAULT_BEACON_KEYS
) {

1989 ià(
rx
->
sd©a
->
dev
)

1990 
	`cfg80211_rx_uÅrÙ_mlme_mgmt
(
rx
->
sd©a
->
dev
,

1991 
skb
->
d©a
,

1992 
skb
->
Ën
);

1993  
RX_DROP_M_BAD_BCN_KEYIDX
;

1996 
rx
->
key
 = 
	`›“80211_rx_g‘_bigtk
Ôx, 
mm›_keyidx
);

1997 ià(!
rx
->
key
)

1998  
RX_CONTINUE
;

1999 } ià(
mm›_keyidx
 >= 0) {

2001 ià((
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
) &&

2002 (
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
))

2003  
RX_CONTINUE
;

2005 ià(
mm›_keyidx
 < 
NUM_DEFAULT_KEYS
 ||

2006 
mm›_keyidx
 >ğ
NUM_DEFAULT_KEYS
 + 
NUM_DEFAULT_MGMT_KEYS
)

2007  
RX_DROP_M_BAD_MGMT_KEYIDX
;

2008 ià(
rx
->
lšk_¡a
) {

2009 ià(
	`›“80211_is_group_´ivacy_aùiÚ
(
skb
) &&

2010 
	`‹¡_¡a_æag
(
rx
->
¡a
, 
WLAN_STA_MFP
))

2011  
RX_DROP_MONITOR
;

2013 
rx
->
key
 = 
	`rcu_d”eã»nû
Ôx->
lšk_¡a
->
gtk
[
mm›_keyidx
]);

2015 ià(!
rx
->
key
)

2016 
rx
->
key
 = 
	`rcu_d”eã»nû
Ôx->
lšk
->
gtk
[
mm›_keyidx
]);

2017 } ià(!
	`›“80211_has_´Ùeùed
(
fc
)) {

2024 
›“80211_key
 *
key
 = 
NULL
;

2025 
i
;

2027 ià(
	`›“80211_is_b—cÚ
(
fc
)) {

2028 
key
 = 
	`›“80211_rx_g‘_bigtk
(
rx
, -1);

2029 } ià(
	`›“80211_is_mgmt
(
fc
) &&

2030 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

2031 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk
->
deçuÉ_mgmt_key
);

2033 ià(
rx
->
lšk_¡a
) {

2034 
i
 = 0; i < 
NUM_DEFAULT_KEYS
; i++) {

2035 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk_¡a
->
gtk
[
i
]);

2036 ià(
key
)

2040 ià(!
key
) {

2041 
i
 = 0; i < 
NUM_DEFAULT_KEYS
; i++) {

2042 
key
 = 
	`rcu_d”eã»nû
(
rx
->
lšk
->
gtk
[
i
]);

2043 ià(
key
)

2048 ià(
key
)

2049 
rx
->
key
 = key;

2050  
RX_CONTINUE
;

2061 ià((
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
) &&

2062 (
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
))

2063  
RX_CONTINUE
;

2065 
keyidx
 = 
	`›“80211_g‘_keyid
(
rx
->
skb
);

2067 ià(
	`uÆik–y
(
keyidx
 < 0))

2068  
RX_DROP_U_NO_KEY_ID
;

2071 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
è&& 
rx
->
lšk_¡a
)

2072 
rx
->
key
 = 
	`rcu_d”eã»nû
Ôx->
lšk_¡a
->
gtk
[
keyidx
]);

2075 ià(!
rx
->
key
) {

2076 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

2077 
rx
->
key
 = 
	`rcu_d”eã»nû
Ôx->
lšk
->
gtk
[
keyidx
]);

2078 ià(!
rx
->
key
)

2079 
rx
->
key
 = 
	`rcu_d”eã»nû
Ôx->
sd©a
->
keys
[
keyidx
]);

2086 ià(
rx
->
key
 &&

2087 
rx
->
key
->
cÚf
.
ch”
 !ğ
WLAN_CIPHER_SUITE_WEP40
 &&

2088 
rx
->
key
->
cÚf
.
ch”
 !ğ
WLAN_CIPHER_SUITE_WEP104
 &&

2089 !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

2090 
rx
->
key
 = 
NULL
;

2094 ià(
rx
->
key
) {

2095 ià(
	`uÆik–y
(
rx
->
key
->
æags
 & 
KEY_FLAG_TAINTED
))

2096  
RX_DROP_MONITOR
;

2100  
RX_DROP_MONITOR
;

2103 
rx
->
key
->
cÚf
.
ch”
) {

2104 
WLAN_CIPHER_SUITE_WEP40
:

2105 
WLAN_CIPHER_SUITE_WEP104
:

2106 
»suÉ
 = 
	`›“80211_üy±o_w•_deüy±
(
rx
);

2108 
WLAN_CIPHER_SUITE_TKIP
:

2109 
»suÉ
 = 
	`›“80211_üy±o_tk_deüy±
(
rx
);

2111 
WLAN_CIPHER_SUITE_CCMP
:

2112 
»suÉ
 = 
	`›“80211_üy±o_ccmp_deüy±
(

2113 
rx
, 
IEEE80211_CCMP_MIC_LEN
);

2115 
WLAN_CIPHER_SUITE_CCMP_256
:

2116 
»suÉ
 = 
	`›“80211_üy±o_ccmp_deüy±
(

2117 
rx
, 
IEEE80211_CCMP_256_MIC_LEN
);

2119 
WLAN_CIPHER_SUITE_AES_CMAC
:

2120 
»suÉ
 = 
	`›“80211_üy±o_«s_cmac_deüy±
(
rx
);

2122 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

2123 
»suÉ
 = 
	`›“80211_üy±o_«s_cmac_256_deüy±
(
rx
);

2125 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

2126 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

2127 
»suÉ
 = 
	`›“80211_üy±o_«s_gmac_deüy±
(
rx
);

2129 
WLAN_CIPHER_SUITE_GCMP
:

2130 
WLAN_CIPHER_SUITE_GCMP_256
:

2131 
»suÉ
 = 
	`›“80211_üy±o_gcmp_deüy±
(
rx
);

2134 
»suÉ
 = 
RX_DROP_U_BAD_CIPHER
;

2140 
¡©us
->
æag
 |ğ
RX_FLAG_DECRYPTED
;

2142 ià(
	`uÆik–y
(
	`›“80211_is_b—cÚ
(
fc
è&& 
	`RX_RES_IS_UNUSABLE
(
»suÉ
) &&

2143 
rx
->
sd©a
->
dev
))

2144 
	`cfg80211_rx_uÅrÙ_mlme_mgmt
(
rx
->
sd©a
->
dev
,

2145 
skb
->
d©a
, skb->
Ën
);

2147  
»suÉ
;

2148 
	}
}

2150 
	$›“80211_š™_äag_ÿche
(
›“80211_äagm’t_ÿche
 *
ÿche
)

2152 
i
;

2154 
i
 = 0; i < 
	`ARRAY_SIZE
(
ÿche
->
’Œ›s
); i++)

2155 
	`skb_queue_h—d_š™
(&
ÿche
->
’Œ›s
[
i
].
skb_li¡
);

2156 
	}
}

2158 
	$›“80211_de¡roy_äag_ÿche
(
›“80211_äagm’t_ÿche
 *
ÿche
)

2160 
i
;

2162 
i
 = 0; i < 
	`ARRAY_SIZE
(
ÿche
->
’Œ›s
); i++)

2163 
	`__skb_queue_purge
(&
ÿche
->
’Œ›s
[
i
].
skb_li¡
);

2164 
	}
}

2166 
šlše
 
›“80211_äagm’t_’Œy
 *

2167 
	$›“80211_»as£mbË_add
(
›“80211_äagm’t_ÿche
 *
ÿche
,

2168 
äag
, 
£q
, 
rx_queue
,

2169 
sk_buff
 **
skb
)

2171 
›“80211_äagm’t_’Œy
 *
’Œy
;

2173 
’Œy
 = &
ÿche
->
’Œ›s
[ÿche->
Ãxt
++];

2174 ià(
ÿche
->
Ãxt
 >ğ
IEEE80211_FRAGMENT_MAX
)

2175 
ÿche
->
Ãxt
 = 0;

2177 
	`__skb_queue_purge
(&
’Œy
->
skb_li¡
);

2179 
	`__skb_queue_
(&
’Œy
->
skb_li¡
, *
skb
);

2180 *
skb
 = 
NULL
;

2181 
’Œy
->
fœ¡_äag_time
 = 
jiff›s
;

2182 
’Œy
->
£q
 = seq;

2183 
’Œy
->
rx_queue
 =„x_queue;

2184 
’Œy
->
Ï¡_äag
 = 
äag
;

2185 
’Œy
->
check_£qu’tŸl_²
 = 
çl£
;

2186 
’Œy
->
exŒa_Ën
 = 0;

2188  
’Œy
;

2189 
	}
}

2191 
šlše
 
›“80211_äagm’t_’Œy
 *

2192 
	$›“80211_»as£mbË_fšd
(
›“80211_äagm’t_ÿche
 *
ÿche
,

2193 
äag
, 
£q
,

2194 
rx_queue
, 
›“80211_hdr
 *
hdr
)

2196 
›“80211_äagm’t_’Œy
 *
’Œy
;

2197 
i
, 
idx
;

2199 
idx
 = 
ÿche
->
Ãxt
;

2200 
i
 = 0; i < 
IEEE80211_FRAGMENT_MAX
; i++) {

2201 
›“80211_hdr
 *
f_hdr
;

2202 
sk_buff
 *
f_skb
;

2204 
idx
--;

2205 ià(
idx
 < 0)

2206 
idx
 = 
IEEE80211_FRAGMENT_MAX
 - 1;

2208 
’Œy
 = &
ÿche
->
’Œ›s
[
idx
];

2209 ià(
	`skb_queue_em±y
(&
’Œy
->
skb_li¡
è||ƒÁry->
£q
 != seq ||

2210 
’Œy
->
rx_queue
 !=„x_queue ||

2211 
’Œy
->
Ï¡_äag
 + 1 !ğ
äag
)

2214 
f_skb
 = 
	`__skb_³ek
(&
’Œy
->
skb_li¡
);

2215 
f_hdr
 = (
›“80211_hdr
 *è
f_skb
->
d©a
;

2220 ià(((
hdr
->
äame_cÚŒŞ
 ^ 
f_hdr
->frame_control) &

2221 
	`ıu_to_Ë16
(
IEEE80211_FCTL_FTYPE
)) ||

2222 !
	`‘h”_addr_equ®
(
hdr
->
addr1
, 
f_hdr
->addr1) ||

2223 !
	`‘h”_addr_equ®
(
hdr
->
addr2
, 
f_hdr
->addr2))

2226 ià(
	`time_aá”
(
jiff›s
, 
’Œy
->
fœ¡_äag_time
 + 2 * 
HZ
)) {

2227 
	`__skb_queue_purge
(&
’Œy
->
skb_li¡
);

2230  
’Œy
;

2233  
NULL
;

2234 
	}
}

2236 
boŞ
 
	$»quœes_£qu’tŸl_²
(
›“80211_rx_d©a
 *
rx
, 
__Ë16
 
fc
)

2238  
rx
->
key
 &&

2239 (
rx
->
key
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_CCMP
 ||

2240 
rx
->
key
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_CCMP_256
 ||

2241 
rx
->
key
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_GCMP
 ||

2242 
rx
->
key
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_GCMP_256
) &&

2243 
	`›“80211_has_´Ùeùed
(
fc
);

2244 
	}
}

2246 
›“80211_rx_»suÉ
 
debug_nošlše


2247 
	$›“80211_rx_h_deäagm’t
(
›“80211_rx_d©a
 *
rx
)

2249 
›“80211_äagm’t_ÿche
 *
ÿche
 = &
rx
->
sd©a
->
äags
;

2250 
›“80211_hdr
 *
hdr
;

2251 
u16
 
sc
;

2252 
__Ë16
 
fc
;

2253 
äag
, 
£q
;

2254 
›“80211_äagm’t_’Œy
 *
’Œy
;

2255 
sk_buff
 *
skb
;

2256 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

2258 
hdr
 = (
›“80211_hdr
 *)
rx
->
skb
->
d©a
;

2259 
fc
 = 
hdr
->
äame_cÚŒŞ
;

2261 ià(
	`›“80211_is_ùl
(
fc
è|| 
	`›“80211_is_ext
(fc))

2262  
RX_CONTINUE
;

2264 
sc
 = 
	`Ë16_to_ıu
(
hdr
->
£q_ù¾
);

2265 
äag
 = 
sc
 & 
IEEE80211_SCTL_FRAG
;

2267 ià(
rx
->
¡a
)

2268 
ÿche
 = &
rx
->
¡a
->
äags
;

2270 ià(
	`lik–y
(!
	`›“80211_has_mÜeäags
(
fc
è&& 
äag
 == 0))

2271 
out
;

2273 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

2274  
RX_DROP_MONITOR
;

2276 
	`I802_DEBUG_INC
(
rx
->
loÿl
->
rx_hªdËrs_äagm’ts
);

2278 ià(
	`skb_lš—rize
(
rx
->
skb
))

2279  
RX_DROP_U_OOM
;

2286 
hdr
 = (
›“80211_hdr
 *)
rx
->
skb
->
d©a
;

2287 
£q
 = (
sc
 & 
IEEE80211_SCTL_SEQ
) >> 4;

2289 ià(
äag
 == 0) {

2291 
’Œy
 = 
	`›“80211_»as£mbË_add
(
ÿche
, 
äag
, 
£q
,

2292 
rx
->
£qno_idx
, &Ôx->
skb
));

2293 ià(
	`»quœes_£qu’tŸl_²
(
rx
, 
fc
)) {

2294 
queue
 = 
rx
->
£cur™y_idx
;

2299 
’Œy
->
check_£qu’tŸl_²
 = 
Œue
;

2300 
’Œy
->
is_´Ùeùed
 = 
Œue
;

2301 
’Œy
->
key_cŞÜ
 = 
rx
->
key
->
cŞÜ
;

2302 
	`memıy
(
’Œy
->
Ï¡_²
,

2303 
rx
->
key
->
u
.
ccmp
.
rx_²
[
queue
],

2304 
IEEE80211_CCMP_PN_LEN
);

2305 
	`BUILD_BUG_ON
(
	`off£tof
(
›“80211_key
,

2306 
u
.
ccmp
.
rx_²
) !=

2307 
	`off£tof
(
›“80211_key
,

2308 
u
.
gcmp
.
rx_²
));

2309 
	`BUILD_BUG_ON
((
rx
->
key
->
u
.
ccmp
.
rx_²
[
queue
]) !=

2310 (
rx
->
key
->
u
.
gcmp
.
rx_²
[
queue
]));

2311 
	`BUILD_BUG_ON
(
IEEE80211_CCMP_PN_LEN
 !=

2312 
IEEE80211_GCMP_PN_LEN
);

2313 } ià(
rx
->
key
 &&

2314 (
	`›“80211_has_´Ùeùed
(
fc
) ||

2315 (
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
))) {

2316 
’Œy
->
is_´Ùeùed
 = 
Œue
;

2317 
’Œy
->
key_cŞÜ
 = 
rx
->
key
->
cŞÜ
;

2319  
RX_QUEUED
;

2325 
’Œy
 = 
	`›“80211_»as£mbË_fšd
(
ÿche
, 
äag
, 
£q
,

2326 
rx
->
£qno_idx
, 
hdr
);

2327 ià(!
’Œy
) {

2328 
	`I802_DEBUG_INC
(
rx
->
loÿl
->
rx_hªdËrs_drİ_deäag
);

2329  
RX_DROP_MONITOR
;

2337 ià(
’Œy
->
check_£qu’tŸl_²
) {

2338 
i
;

2339 
u8
 
²
[
IEEE80211_CCMP_PN_LEN
], *
½n
;

2341 ià(!
	`»quœes_£qu’tŸl_²
(
rx
, 
fc
))

2342  
RX_DROP_U_NONSEQ_PN
;

2345 ià(
’Œy
->
key_cŞÜ
 !ğ
rx
->
key
->
cŞÜ
)

2346  
RX_DROP_U_BAD_KEY_COLOR
;

2348 
	`memıy
(
²
, 
’Œy
->
Ï¡_²
, 
IEEE80211_CCMP_PN_LEN
);

2349 
i
 = 
IEEE80211_CCMP_PN_LEN
 - 1; i >= 0; i--) {

2350 
²
[
i
]++;

2351 ià(
²
[
i
])

2355 
½n
 = 
rx
->
ccm_gcm
.
²
;

2356 ià(
	`memcmp
(
²
, 
½n
, 
IEEE80211_CCMP_PN_LEN
))

2357  
RX_DROP_U_REPLAY
;

2358 
	`memıy
(
’Œy
->
Ï¡_²
, 
²
, 
IEEE80211_CCMP_PN_LEN
);

2359 } ià(
’Œy
->
is_´Ùeùed
 &&

2360 (!
rx
->
key
 ||

2361 (!
	`›“80211_has_´Ùeùed
(
fc
) &&

2362 !(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) ||

2363 
rx
->
key
->
cŞÜ
 !ğ
’Œy
->
key_cŞÜ
)) {

2368  
RX_DROP_U_EXPECT_DEFRAG_PROT
;

2369 } ià(
’Œy
->
is_´Ùeùed
 && 
rx
->
key
 &&

2370 
’Œy
->
key_cŞÜ
 !ğ
rx
->
key
->
cŞÜ
 &&

2371 (
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

2372  
RX_DROP_U_BAD_KEY_COLOR
;

2375 
	`skb_puÎ
(
rx
->
skb
, 
	`›“80211_hd¾’
(
fc
));

2376 
	`__skb_queue_
(&
’Œy
->
skb_li¡
, 
rx
->
skb
);

2377 
’Œy
->
Ï¡_äag
 = 
äag
;

2378 
’Œy
->
exŒa_Ën
 +ğ
rx
->
skb
->
Ën
;

2379 ià(
	`›“80211_has_mÜeäags
(
fc
)) {

2380 
rx
->
skb
 = 
NULL
;

2381  
RX_QUEUED
;

2384 
rx
->
skb
 = 
	`__skb_dequeue
(&
’Œy
->
skb_li¡
);

2385 ià(
	`skb_room
(
rx
->
skb
è< 
’Œy
->
exŒa_Ën
) {

2386 
	`I802_DEBUG_INC
(
rx
->
loÿl
->
rx_ex·nd_skb_h—d_deäag
);

2387 ià(
	`uÆik–y
(
	`pskb_ex·nd_h—d
(
rx
->
skb
, 0, 
’Œy
->
exŒa_Ën
,

2388 
GFP_ATOMIC
))) {

2389 
	`I802_DEBUG_INC
(
rx
->
loÿl
->
rx_hªdËrs_drİ_deäag
);

2390 
	`__skb_queue_purge
(&
’Œy
->
skb_li¡
);

2391  
RX_DROP_U_OOM
;

2394 (
skb
 = 
	`__skb_dequeue
(&
’Œy
->
skb_li¡
))) {

2395 
	`skb_put_d©a
(
rx
->
skb
, skb->
d©a
, skb->
Ën
);

2396 
	`dev_kä“_skb
(
skb
);

2399 
out
:

2400 
	`›“80211_Ëd_rx
(
rx
->
loÿl
);

2401 ià(
rx
->
¡a
)

2402 
rx
->
lšk_¡a
->
rx_¡©s
.
·ck‘s
++;

2403  
RX_CONTINUE
;

2404 
	}
}

2406 
	$›“80211_802_1x_pÜt_cÚŒŞ
(
›“80211_rx_d©a
 *
rx
)

2408 ià(
	`uÆik–y
(!
rx
->
¡a
 || !
	`‹¡_¡a_æag
Ôx->¡a, 
WLAN_STA_AUTHORIZED
)))

2409  -
EACCES
;

2412 
	}
}

2414 
	$›“80211_drİ_uÃnüy±ed
(
›“80211_rx_d©a
 *
rx
, 
__Ë16
 
fc
)

2416 
sk_buff
 *
skb
 = 
rx
->skb;

2417 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

2423 ià(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)

2427 ià(
	`uÆik–y
(!
	`›“80211_has_´Ùeùed
(
fc
) &&

2428 !
	`›“80211_is_ªy_nuÎfunc
(
fc
) &&

2429 
	`›“80211_is_d©a
(
fc
è&& 
rx
->
key
))

2430  -
EACCES
;

2433 
	}
}

2435 
VISIBLE_IF_MAC80211_KUNIT
 
›“80211_rx_»suÉ


2436 
	$›“80211_drİ_uÃnüy±ed_mgmt
(
›“80211_rx_d©a
 *
rx
)

2438 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

2439 
›“80211_mgmt
 *
mgmt
 = (*)
rx
->
skb
->
d©a
;

2440 
__Ë16
 
fc
 = 
mgmt
->
äame_cÚŒŞ
;

2446 ià(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)

2447  
RX_CONTINUE
;

2450 ià(
	`›“80211_is_aùiÚ
(
fc
) &&

2451 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
)

2452  
RX_DROP_U_UNPROT_DUAL
;

2454 ià(
rx
->
¡a
 && 
	`‹¡_¡a_æag
Ôx->¡a, 
WLAN_STA_MFP
)) {

2455 ià(
	`uÆik–y
(!
	`›“80211_has_´Ùeùed
(
fc
) &&

2456 
	`›“80211_is_uniÿ¡_robu¡_mgmt_äame
(
rx
->
skb
))) {

2457 ià(
	`›“80211_is_d—uth
(
fc
) ||

2458 
	`›“80211_is_di§ssoc
(
fc
)) {

2463 ià(!
rx
->
key
)

2464  
RX_CONTINUE
;

2466 
	`cfg80211_rx_uÅrÙ_mlme_mgmt
(
rx
->
sd©a
->
dev
,

2467 
rx
->
skb
->
d©a
,

2468 
rx
->
skb
->
Ën
);

2470  
RX_DROP_U_UNPROT_UCAST_MGMT
;

2473 ià(
	`uÆik–y
(
	`›“80211_is_muÉiÿ¡_robu¡_mgmt_äame
(
rx
->
skb
) &&

2474 
	`›“80211_g‘_mm›_keyidx
(
rx
->
skb
) < 0)) {

2475 ià(
	`›“80211_is_d—uth
(
fc
) ||

2476 
	`›“80211_is_di§ssoc
(
fc
))

2477 
	`cfg80211_rx_uÅrÙ_mlme_mgmt
(
rx
->
sd©a
->
dev
,

2478 
rx
->
skb
->
d©a
,

2479 
rx
->
skb
->
Ën
);

2480  
RX_DROP_U_UNPROT_MCAST_MGMT
;

2482 ià(
	`uÆik–y
(
	`›“80211_is_b—cÚ
(
fc
è&& 
rx
->
key
 &&

2483 
	`›“80211_g‘_mm›_keyidx
(
rx
->
skb
) < 0)) {

2484 
	`cfg80211_rx_uÅrÙ_mlme_mgmt
(
rx
->
sd©a
->
dev
,

2485 
rx
->
skb
->
d©a
,

2486 
rx
->
skb
->
Ën
);

2487  
RX_DROP_U_UNPROT_BEACON
;

2493 ià(
	`uÆik–y
(
	`›“80211_is_aùiÚ
(
fc
è&& !
rx
->
key
 &&

2494 
	`›“80211_is_robu¡_mgmt_äame
(
rx
->
skb
)))

2495  
RX_DROP_U_UNPROT_ACTION
;

2498 ià(
	`is_uniÿ¡_‘h”_addr
(
mgmt
->
da
) &&

2499 
	`›“80211_is_´Ùeùed_du®_of_public_aùiÚ
(
rx
->
skb
))

2500  
RX_DROP_U_UNPROT_UNICAST_PUB_ACTION
;

2507 ià(
	`›“80211_is_aùiÚ
(
fc
) &&

2508 
	`›“80211_is_robu¡_mgmt_äame
(
rx
->
skb
) &&

2509 (!
rx
->
¡a
 || !
	`‹¡_¡a_æag
Ôx->¡a, 
WLAN_STA_ASSOC
)))

2510  
RX_DROP_U_UNPROT_ROBUST_ACTION
;

2512  
RX_CONTINUE
;

2513 
	}
}

2514 
EXPORT_SYMBOL_IF_MAC80211_KUNIT
(
›“80211_drİ_uÃnüy±ed_mgmt
);

2516 
›“80211_rx_»suÉ


2517 
	$__›“80211_d©a_to_8023
(
›“80211_rx_d©a
 *
rx
, 
boŞ
 *
pÜt_cÚŒŞ
)

2519 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

2520 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

2521 
boŞ
 
check_pÜt_cÚŒŞ
 = 
çl£
;

2522 
‘hhdr
 *
ehdr
;

2523 
»t
;

2525 *
pÜt_cÚŒŞ
 = 
çl£
;

2526 ià(
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
) &&

2527 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 && !sd©a->
u
.
vÏn
.
¡a
)

2528  
RX_DROP_U_UNEXPECTED_VLAN_4ADDR
;

2530 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

2531 !!
sd©a
->
u
.
mgd
.
u£_4addr
 !ğ!!
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
)) {

2532 ià(!
sd©a
->
u
.
mgd
.
u£_4addr
)

2533  
RX_DROP_U_UNEXPECTED_STA_4ADDR
;

2534 ià(!
	`‘h”_addr_equ®
(
hdr
->
addr1
, 
sd©a
->
vif
.
addr
))

2535 
check_pÜt_cÚŒŞ
 = 
Œue
;

2538 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

2539 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 && sd©a->
u
.
vÏn
.
¡a
)

2540  
RX_DROP_U_UNEXPECTED_VLAN_MCAST
;

2542 
»t
 = 
	`›“80211_d©a_to_8023
(
rx
->
skb
, 
sd©a
->
vif
.
addr
, sd©a->vif.
ty³
);

2543 ià(
»t
 < 0)

2544  
RX_DROP_U_INVALID_8023
;

2546 
ehdr
 = (
‘hhdr
 *è
rx
->
skb
->
d©a
;

2547 ià(
ehdr
->
h_´Ùo
 =ğ
rx
->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

2548 *
pÜt_cÚŒŞ
 = 
Œue
;

2549 ià(
check_pÜt_cÚŒŞ
)

2550  
RX_DROP_U_NOT_PORT_CONTROL
;

2552  
RX_CONTINUE
;

2553 
	}
}

2555 
boŞ
 
	$›“80211_is_our_addr
(
›“80211_sub_if_d©a
 *
sd©a
,

2556 cÚ¡ 
u8
 *
addr
, *
out_lšk_id
)

2558 
lšk_id
;

2561 ià(
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
,‡ddr))

2562  
Œue
;

2564 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

2565  
çl£
;

2567 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
(
sd©a
->
vif
.
lšk_cÚf
);†ink_id++) {

2568 
›“80211_bss_cÚf
 *
cÚf
;

2570 
cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[
lšk_id
]);

2572 ià(!
cÚf
)

2574 ià(
	`‘h”_addr_equ®
(
cÚf
->
addr
,‡ddr)) {

2575 ià(
out_lšk_id
)

2576 *
out_lšk_id
 = 
lšk_id
;

2577  
Œue
;

2581  
çl£
;

2582 
	}
}

2587 
boŞ
 
	$›“80211_äame_®lowed
(
›“80211_rx_d©a
 *
rx
, 
__Ë16
 
fc
)

2589 cÚ¡ 
u8
 
·e_group_addr
[
ETH_ALEN
] 
	`__®igÃd
(2)

2591 
‘hhdr
 *
ehdr
 = (‘hhd¸*è
rx
->
skb
->
d©a
;

2598 ià(
	`uÆik–y
(
ehdr
->
h_´Ùo
 =ğ
rx
->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
))

2599  
	`›“80211_is_our_addr
(
rx
->
sd©a
, 
ehdr
->
h_de¡
, 
NULL
) ||

2600 
	`‘h”_addr_equ®
(
ehdr
->
h_de¡
, 
·e_group_addr
);

2602 ià(
	`›“80211_802_1x_pÜt_cÚŒŞ
(
rx
) ||

2603 
	`›“80211_drİ_uÃnüy±ed
(
rx
, 
fc
))

2604  
çl£
;

2606  
Œue
;

2607 
	}
}

2609 
	$›“80211_d–iv”_skb_to_loÿl_¡ack
(
sk_buff
 *
skb
,

2610 
›“80211_rx_d©a
 *
rx
)

2612 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

2613 
Ãt_deviû
 *
dev
 = 
sd©a
->dev;

2615 ià(
	`uÆik–y
((
skb
->
´ÙocŞ
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 ||

2616 (
skb
->
´ÙocŞ
 =ğ
	`ıu_to_be16
(
ETH_P_PREAUTH
) &&

2617 !
sd©a
->
cÚŒŞ_pÜt_no_´—uth
)) &&

2618 
sd©a
->
cÚŒŞ_pÜt_ov”_Æ80211
)) {

2619 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

2620 
boŞ
 
nÛnüy±
 = !(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
);

2622 
	`cfg80211_rx_cÚŒŞ_pÜt
(
dev
, 
skb
, 
nÛnüy±
, 
rx
->
lšk_id
);

2623 
	`dev_kä“_skb
(
skb
);

2625 
‘hhdr
 *
ehdr
 = (*)
	`skb_mac_h—d”
(
skb
);

2627 
	`mem£t
(
skb
->
cb
, 0, (skb->cb));

2644 ià(
	`uÆik–y
(
skb
->
´ÙocŞ
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 &&

2645 !
	`‘h”_addr_equ®
(
ehdr
->
h_de¡
, 
sd©a
->
vif
.
addr
)))

2646 
	`‘h”_addr_cİy
(
ehdr
->
h_de¡
, 
sd©a
->
vif
.
addr
);

2649 ià(
rx
->
li¡
)

2650 
	`li¡_add_
(&
skb
->
li¡
, 
rx
->list);

2652 
	`Ãtif_»ûive_skb
(
skb
);

2654 
	}
}

2660 
	$›“80211_d–iv”_skb
(
›“80211_rx_d©a
 *
rx
)

2662 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

2663 
Ãt_deviû
 *
dev
 = 
sd©a
->dev;

2664 
sk_buff
 *
skb
, *
xm™_skb
;

2665 
‘hhdr
 *
ehdr
 = (‘hhd¸*è
rx
->
skb
->
d©a
;

2666 
¡a_šfo
 *
d¡a
;

2668 
skb
 = 
rx
->skb;

2669 
xm™_skb
 = 
NULL
;

2671 
	`dev_sw_Ãt¡©s_rx_add
(
dev
, 
skb
->
Ën
);

2673 ià(
rx
->
¡a
) {

2679 
	`u64_¡©s_upd©e_begš
(&
rx
->
lšk_¡a
->
rx_¡©s
.
synı
);

2680 
rx
->
lšk_¡a
->
rx_¡©s
.
msdu
[rx->
£qno_idx
]++;

2681 
	`u64_¡©s_upd©e_’d
(&
rx
->
lšk_¡a
->
rx_¡©s
.
synı
);

2684 ià((
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

2685 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) &&

2686 !(
sd©a
->
æags
 & 
IEEE80211_SDATA_DONT_BRIDGE_PACKETS
) &&

2687 
ehdr
->
h_´Ùo
 !ğ
rx
->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 &&

2688 (
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 || !sd©a->
u
.
vÏn
.
¡a
)) {

2689 ià(
	`is_muÉiÿ¡_‘h”_addr
(
ehdr
->
h_de¡
) &&

2690 
	`›“80211_vif_g‘_num_mÿ¡_if
(
sd©a
) != 0) {

2695 
xm™_skb
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

2696 ià(!
xm™_skb
)

2697 
	`Ãt_šfo_¿‹lim™ed
("%s: failedo clone multicast frame\n",

2698 
dev
->
Çme
);

2699 } ià(!
	`is_muÉiÿ¡_‘h”_addr
(
ehdr
->
h_de¡
) &&

2700 !
	`‘h”_addr_equ®
(
ehdr
->
h_de¡
,ƒhdr->
h_sourû
)) {

2701 
d¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
ehdr
->
h_de¡
);

2702 ià(
d¡a
) {

2709 
xm™_skb
 = 
skb
;

2710 
skb
 = 
NULL
;

2715 #iâdeà
CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS


2716 ià(
skb
) {

2723 
®ign
;

2725 
®ign
 = ()(
skb
->
d©a
 + (
‘hhdr
)) & 3;

2726 ià(
®ign
) {

2727 ià(
	`WARN_ON
(
	`skb_h—droom
(
skb
) < 3)) {

2728 
	`dev_kä“_skb
(
skb
);

2729 
skb
 = 
NULL
;

2731 
u8
 *
d©a
 = 
skb
->data;

2732 
size_t
 
Ën
 = 
	`skb_h—dËn
(
skb
);

2733 
skb
->
d©a
 -ğ
®ign
;

2734 
	`memmove
(
skb
->
d©a
, d©a, 
Ën
);

2735 
	`skb_£t__poš‹r
(
skb
, 
Ën
);

2741 ià(
skb
) {

2742 
skb
->
´ÙocŞ
 = 
	`‘h_ty³_Œªs
(skb, 
dev
);

2743 
	`›“80211_d–iv”_skb_to_loÿl_¡ack
(
skb
, 
rx
);

2746 ià(
xm™_skb
) {

2752 
xm™_skb
->
´iÜ™y
 += 256;

2753 
xm™_skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_3
);

2754 
	`skb_»£t_ÃtwÜk_h—d”
(
xm™_skb
);

2755 
	`skb_»£t_mac_h—d”
(
xm™_skb
);

2756 
	`dev_queue_xm™
(
xm™_skb
);

2758 
	}
}

2760 #ifdeà
CONFIG_MAC80211_MESH


2761 
boŞ


2762 
	$›“80211_rx_mesh_ç¡_fÜw¬d
(
›“80211_sub_if_d©a
 *
sd©a
,

2763 
sk_buff
 *
skb
, 
hd¾’
)

2765 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

2766 
›“80211_mesh_ç¡_tx_key
 
key
 = {

2767 .
ty³
 = 
MESH_FAST_TX_TYPE_FORWARDED


2769 
›“80211_mesh_ç¡_tx
 *
’Œy
;

2770 
›“80211s_hdr
 *
mesh_hdr
;

2771 
tid_ampdu_tx
 *
tid_tx
;

2772 
¡a_šfo
 *
¡a
;

2773 
‘hhdr
 
‘h
;

2774 
u8
 
tid
;

2776 
mesh_hdr
 = (
›“80211s_hdr
 *)(
skb
->
d©a
 + (
‘h
));

2777 ià((
mesh_hdr
->
æags
 & 
MESH_FLAGS_AE
è=ğ
MESH_FLAGS_AE_A5_A6
)

2778 
	`‘h”_addr_cİy
(
key
.
addr
, 
mesh_hdr
->
—ddr1
);

2779 ià(!(
mesh_hdr
->
æags
 & 
MESH_FLAGS_AE
))

2780 
	`‘h”_addr_cİy
(
key
.
addr
, 
skb
->
d©a
);

2782  
çl£
;

2784 
’Œy
 = 
	`mesh_ç¡_tx_g‘
(
sd©a
, &
key
);

2785 ià(!
’Œy
)

2786  
çl£
;

2788 
¡a
 = 
	`rcu_d”eã»nû
(
’Œy
->
m·th
->
Ãxt_hİ
);

2789 ià(!
¡a
)

2790  
çl£
;

2792 ià(
	`skb_lš—rize
(
skb
))

2793  
çl£
;

2795 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

2796 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

2797 ià(
tid_tx
) {

2798 ià(!
	`‹¡_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
))

2799  
çl£
;

2801 ià(
tid_tx
->
timeout
)

2802 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

2805 
	`›“80211_aggr_check
(
sd©a
, 
¡a
, 
skb
);

2807 ià(
	`›“80211_g‘_8023_tuÂ–_´Ùo
(
skb
->
d©a
 + 
hd¾’
,

2808 &
skb
->
´ÙocŞ
))

2809 
hd¾’
 +ğ
ETH_ALEN
;

2811 
skb
->
´ÙocŞ
 = 
	`htÚs
(skb->
Ën
 - 
hd¾’
);

2812 
	`skb_£t_ÃtwÜk_h—d”
(
skb
, 
hd¾’
 + 2);

2814 
skb
->
dev
 = 
sd©a
->dev;

2815 
	`memıy
(&
‘h
, 
skb
->
d©a
, 
ETH_HLEN
 - 2);

2816 
	`skb_puÎ
(
skb
, 2);

2817 
	`__›“80211_xm™_ç¡
(
sd©a
, 
¡a
, &
’Œy
->
ç¡_tx
, 
skb
, 
tid_tx
,

2818 
‘h
.
h_de¡
,ƒth.
h_sourû
);

2819 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
fwded_uniÿ¡
);

2820 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
fwded_äames
);

2822  
Œue
;

2823 
	}
}

2826 
›“80211_rx_»suÉ


2827 
	$›“80211_rx_mesh_d©a
(
›“80211_sub_if_d©a
 *
sd©a
, 
¡a_šfo
 *
¡a
,

2828 
sk_buff
 *
skb
)

2830 #ifdeà
CONFIG_MAC80211_MESH


2831 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

2832 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2833 
ušt16_t
 
fc
 = 
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_QOS_DATA
;

2834 
›“80211_hdr
 
hdr
 = {

2835 .
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
fc
)

2837 
›“80211_hdr
 *
fwd_hdr
;

2838 
›“80211s_hdr
 *
mesh_hdr
;

2839 
›“80211_tx_šfo
 *
šfo
;

2840 
sk_buff
 *
fwd_skb
;

2841 
‘hhdr
 *
‘h
;

2842 
boŞ
 
muÉiÿ¡
;

2843 
room
 = 0;

2844 
hd¾’
, 
mesh_hd¾’
;

2845 
u8
 *
qos
;

2847 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

2848  
RX_CONTINUE
;

2850 ià(!
	`pskb_may_puÎ
(
skb
, (*
‘h
) + 6))

2851  
RX_DROP_MONITOR
;

2853 
mesh_hdr
 = (
›“80211s_hdr
 *)(
skb
->
d©a
 + (*
‘h
));

2854 
mesh_hd¾’
 = 
	`›“80211_g‘_mesh_hd¾’
(
mesh_hdr
);

2856 ià(!
	`pskb_may_puÎ
(
skb
, (*
‘h
è+ 
mesh_hd¾’
))

2857  
RX_DROP_MONITOR
;

2859 
‘h
 = (
‘hhdr
 *)
skb
->
d©a
;

2860 
muÉiÿ¡
 = 
	`is_muÉiÿ¡_‘h”_addr
(
‘h
->
h_de¡
);

2862 
mesh_hdr
 = (
›“80211s_hdr
 *)(
‘h
 + 1);

2863 ià(!
mesh_hdr
->
‰l
)

2864  
RX_DROP_MONITOR
;

2867 ià(
	`is_muÉiÿ¡_‘h”_addr
(
‘h
->
h_de¡
) &&

2868 
	`mesh_rmc_check
(
sd©a
, 
‘h
->
h_sourû
, 
mesh_hdr
))

2869  
RX_DROP_MONITOR
;

2872 ià(
sd©a
->
üy±o_tx_room_Ãeded_út
)

2873 
room
 = 
IEEE80211_ENCRYPT_TAILROOM
;

2875 ià(
mesh_hdr
->
æags
 & 
MESH_FLAGS_AE
) {

2876 
mesh_·th
 *
mµ©h
;

2877 *
´ox›d_addr
;

2878 
boŞ
 
upd©e
 = 
çl£
;

2880 ià(
muÉiÿ¡
)

2881 
´ox›d_addr
 = 
mesh_hdr
->
—ddr1
;

2882 ià((
mesh_hdr
->
æags
 & 
MESH_FLAGS_AE
è=ğ
MESH_FLAGS_AE_A5_A6
)

2884 
´ox›d_addr
 = 
mesh_hdr
->
—ddr2
;

2886  
RX_DROP_MONITOR
;

2888 
	`rcu_»ad_lock
();

2889 
mµ©h
 = 
	`mµ_·th_lookup
(
sd©a
, 
´ox›d_addr
);

2890 ià(!
mµ©h
) {

2891 
	`mµ_·th_add
(
sd©a
, 
´ox›d_addr
, 
‘h
->
h_sourû
);

2893 
	`¥š_lock_bh
(&
mµ©h
->
¡©e_lock
);

2894 ià(!
	`‘h”_addr_equ®
(
mµ©h
->
mµ
, 
‘h
->
h_sourû
)) {

2895 
	`memıy
(
mµ©h
->
mµ
, 
‘h
->
h_sourû
, 
ETH_ALEN
);

2896 
upd©e
 = 
Œue
;

2898 
mµ©h
->
exp_time
 = 
jiff›s
;

2899 
	`¥š_uÆock_bh
(&
mµ©h
->
¡©e_lock
);

2903 ià(
upd©e
)

2904 
	`mesh_ç¡_tx_æush_addr
(
sd©a
, 
´ox›d_addr
);

2906 
	`rcu_»ad_uÆock
();

2910 ià(
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
‘h
->
h_de¡
))

2911 
rx_acû±
;

2913 ià(!--
mesh_hdr
->
‰l
) {

2914 ià(
muÉiÿ¡
)

2915 
rx_acû±
;

2917 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
drİ³d_äames_‰l
);

2918  
RX_DROP_MONITOR
;

2921 ià(!
ifmsh
->
mshcfg
.
dÙ11MeshFÜw¬dšg
) {

2922 ià(
	`is_muÉiÿ¡_‘h”_addr
(
‘h
->
h_de¡
))

2923 
rx_acû±
;

2925  
RX_DROP_MONITOR
;

2928 
	`skb_£t_queue_m­pšg
(
skb
, 
›“802_1d_to_ac
[skb->
´iÜ™y
]);

2930 ià(!
muÉiÿ¡
 &&

2931 
	`›“80211_rx_mesh_ç¡_fÜw¬d
(
sd©a
, 
skb
, 
mesh_hd¾’
))

2932  
RX_QUEUED
;

2934 
	`›“80211_fl_mesh_add»s£s
(&
hdr
, &hdr.
äame_cÚŒŞ
,

2935 
‘h
->
h_de¡
,ƒth->
h_sourû
);

2936 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
.
äame_cÚŒŞ
);

2937 ià(
muÉiÿ¡
) {

2938 
exŒa_h—d
 = (
›“80211_hdr
è- (*
‘h
);

2940 
fwd_skb
 = 
	`skb_cİy_ex·nd
(
skb
, 
loÿl
->
tx_h—droom
 + 
exŒa_h—d
 +

2941 
IEEE80211_ENCRYPT_HEADROOM
,

2942 
room
, 
GFP_ATOMIC
);

2943 ià(!
fwd_skb
)

2944 
rx_acû±
;

2946 
fwd_skb
 = 
skb
;

2947 
skb
 = 
NULL
;

2949 ià(
	`skb_cow_h—d
(
fwd_skb
, 
hd¾’
 - (
‘hhdr
)))

2950  
RX_DROP_U_OOM
;

2952 ià(
	`skb_lš—rize
(
fwd_skb
))

2953  
RX_DROP_U_OOM
;

2956 
fwd_hdr
 = 
	`skb_push
(
fwd_skb
, 
hd¾’
 - (
‘hhdr
));

2957 
	`memıy
(
fwd_hdr
, &
hdr
, 
hd¾’
 - 2);

2958 
qos
 = 
	`›“80211_g‘_qos_ùl
(
fwd_hdr
);

2959 
qos
[0] = qos[1] = 0;

2961 
	`skb_»£t_mac_h—d”
(
fwd_skb
);

2962 
hd¾’
 +ğ
mesh_hd¾’
;

2963 ià(
	`›“80211_g‘_8023_tuÂ–_´Ùo
(
fwd_skb
->
d©a
 + 
hd¾’
,

2964 &
fwd_skb
->
´ÙocŞ
))

2965 
hd¾’
 +ğ
ETH_ALEN
;

2967 
fwd_skb
->
´ÙocŞ
 = 
	`htÚs
(fwd_skb->
Ën
 - 
hd¾’
);

2968 
	`skb_£t_ÃtwÜk_h—d”
(
fwd_skb
, 
hd¾’
 + 2);

2970 
šfo
 = 
	`IEEE80211_SKB_CB
(
fwd_skb
);

2971 
	`mem£t
(
šfo
, 0, (*info));

2972 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

2973 
šfo
->
cÚŒŞ
.
vif
 = &
sd©a
->vif;

2974 
šfo
->
cÚŒŞ
.
jiff›s
 = jiffies;

2975 
fwd_skb
->
dev
 = 
sd©a
->dev;

2976 ià(
muÉiÿ¡
) {

2977 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
fwded_mÿ¡
);

2978 
	`memıy
(
fwd_hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

2980 
	`›“80211_mps_£t_äame_æags
(
sd©a
, 
NULL
, 
fwd_hdr
);

2981 } ià(!
	`mesh_Ãxthİ_lookup
(
sd©a
, 
fwd_skb
)) {

2983 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
fwded_uniÿ¡
);

2986 ià(
¡a
)

2987 
	`mesh_·th_”rÜ_tx
(
sd©a
, 
ifmsh
->
mshcfg
.
–em’t_‰l
,

2988 
hdr
.
addr3
, 0,

2989 
WLAN_REASON_MESH_PATH_NOFORWARD
,

2990 
¡a
->¡a.
addr
);

2991 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
drİ³d_äames_no_rou‹
);

2992 
	`kä“_skb
(
fwd_skb
);

2993 
rx_acû±
;

2996 
	`IEEE80211_IFSTA_MESH_CTR_INC
(
ifmsh
, 
fwded_äames
);

2997 
	`›“80211_add_³ndšg_skb
(
loÿl
, 
fwd_skb
);

2999 
rx_acû±
:

3000 ià(!
skb
)

3001  
RX_QUEUED
;

3003 
	`›“80211_¡r_8023_mesh_hdr
(
skb
);

3006  
RX_CONTINUE
;

3007 
	}
}

3009 
›“80211_rx_»suÉ
 
debug_nošlše


3010 
	$__›“80211_rx_h_amsdu
(
›“80211_rx_d©a
 *
rx
, 
u8
 
d©a_off£t
)

3012 
Ãt_deviû
 *
dev
 = 
rx
->
sd©a
->dev;

3013 
sk_buff
 *
skb
 = 
rx
->skb;

3014 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

3015 
__Ë16
 
fc
 = 
hdr
->
äame_cÚŒŞ
;

3016 
sk_buff_h—d
 
äame_li¡
;

3017 
›“80211_rx_»suÉ
 
»s
;

3018 
‘hhdr
ƒthhdr;

3019 cÚ¡ 
u8
 *
check_da
 = 
‘hhdr
.
h_de¡
, *
check_§
 =ƒthhdr.
h_sourû
;

3021 ià(
	`uÆik–y
(
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
))) {

3022 
check_da
 = 
NULL
;

3023 
check_§
 = 
NULL
;

3024 } 
rx
->
sd©a
->
vif
.
ty³
) {

3025 
NL80211_IFTYPE_AP
:

3026 
NL80211_IFTYPE_AP_VLAN
:

3027 
check_da
 = 
NULL
;

3029 
NL80211_IFTYPE_STATION
:

3030 ià(!
rx
->
¡a
 ||

3031 !
	`‹¡_¡a_æag
(
rx
->
¡a
, 
WLAN_STA_TDLS_PEER
))

3032 
check_§
 = 
NULL
;

3034 
NL80211_IFTYPE_MESH_POINT
:

3035 
check_§
 = 
NULL
;

3036 
check_da
 = 
NULL
;

3042 
skb
->
dev
 = dev;

3043 
	`__skb_queue_h—d_š™
(&
äame_li¡
);

3045 ià(
	`›“80211_d©a_to_8023_exthdr
(
skb
, &
‘hhdr
,

3046 
rx
->
sd©a
->
vif
.
addr
,

3047 
rx
->
sd©a
->
vif
.
ty³
,

3048 
d©a_off£t
, 
Œue
))

3049  
RX_DROP_U_BAD_AMSDU
;

3051 ià(
rx
->
¡a
->
amsdu_mesh_cÚŒŞ
 < 0) {

3052 
s8
 
v®id
 = -1;

3053 
i
;

3055 
i
 = 0; i <= 2; i++) {

3056 ià(!
	`›“80211_is_v®id_amsdu
(
skb
, 
i
))

3059 ià(
v®id
 >= 0) {

3061 
v®id
 = -1;

3065 
v®id
 = 
i
;

3068 
rx
->
¡a
->
amsdu_mesh_cÚŒŞ
 = 
v®id
;

3071 
	`›“80211_amsdu_to_8023s
(
skb
, &
äame_li¡
, 
dev
->
dev_addr
,

3072 
rx
->
sd©a
->
vif
.
ty³
,

3073 
rx
->
loÿl
->
hw
.
exŒa_tx_h—droom
,

3074 
check_da
, 
check_§
,

3075 
rx
->
¡a
->
amsdu_mesh_cÚŒŞ
);

3077 !
	`skb_queue_em±y
(&
äame_li¡
)) {

3078 
rx
->
skb
 = 
	`__skb_dequeue
(&
äame_li¡
);

3080 
»s
 = 
	`›“80211_rx_mesh_d©a
(
rx
->
sd©a
,„x->
¡a
,„x->
skb
);

3081 
»s
) {

3082 
RX_QUEUED
:

3084 
RX_CONTINUE
:

3087 
ä“
;

3090 ià(!
	`›“80211_äame_®lowed
(
rx
, 
fc
))

3091 
ä“
;

3093 
	`›“80211_d–iv”_skb
(
rx
);

3096 
ä“
:

3097 
	`dev_kä“_skb
(
rx
->
skb
);

3100  
RX_QUEUED
;

3101 
	}
}

3103 
›“80211_rx_»suÉ
 
debug_nošlše


3104 
	$›“80211_rx_h_amsdu
(
›“80211_rx_d©a
 *
rx
)

3106 
sk_buff
 *
skb
 = 
rx
->skb;

3107 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

3108 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

3109 
__Ë16
 
fc
 = 
hdr
->
äame_cÚŒŞ
;

3111 ià(!(
¡©us
->
rx_æags
 & 
IEEE80211_RX_AMSDU
))

3112  
RX_CONTINUE
;

3114 ià(
	`uÆik–y
(!
	`›“80211_is_d©a
(
fc
)))

3115  
RX_CONTINUE
;

3117 ià(
	`uÆik–y
(!
	`›“80211_is_d©a_´e£Á
(
fc
)))

3118  
RX_DROP_MONITOR
;

3120 ià(
	`uÆik–y
(
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
))) {

3121 
rx
->
sd©a
->
vif
.
ty³
) {

3122 
NL80211_IFTYPE_AP_VLAN
:

3123 ià(!
rx
->
sd©a
->
u
.
vÏn
.
¡a
)

3124  
RX_DROP_U_BAD_4ADDR
;

3126 
NL80211_IFTYPE_STATION
:

3127 ià(!
rx
->
sd©a
->
u
.
mgd
.
u£_4addr
)

3128  
RX_DROP_U_BAD_4ADDR
;

3130 
NL80211_IFTYPE_MESH_POINT
:

3133  
RX_DROP_U_BAD_4ADDR
;

3137 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
è|| !
rx
->
¡a
)

3138  
RX_DROP_U_BAD_AMSDU
;

3140 ià(
rx
->
key
) {

3147 
rx
->
key
->
cÚf
.
ch”
) {

3148 
WLAN_CIPHER_SUITE_WEP40
:

3149 
WLAN_CIPHER_SUITE_WEP104
:

3150 
WLAN_CIPHER_SUITE_TKIP
:

3151  
RX_DROP_U_BAD_AMSDU_CIPHER
;

3157  
	`__›“80211_rx_h_amsdu
(
rx
, 0);

3158 
	}
}

3160 
›“80211_rx_»suÉ
 
debug_nošlše


3161 
	$›“80211_rx_h_d©a
(
›“80211_rx_d©a
 *
rx
)

3163 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3164 
›“80211_loÿl
 *
loÿl
 = 
rx
->local;

3165 
Ãt_deviû
 *
dev
 = 
sd©a
->dev;

3166 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

3167 
__Ë16
 
fc
 = 
hdr
->
äame_cÚŒŞ
;

3168 
›“80211_rx_»suÉ
 
»s
;

3169 
boŞ
 
pÜt_cÚŒŞ
;

3171 ià(
	`uÆik–y
(!
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
)))

3172  
RX_CONTINUE
;

3174 ià(
	`uÆik–y
(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
)))

3175  
RX_DROP_MONITOR
;

3181 ià(
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
) &&

3182 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

3183 ià(
rx
->
¡a
 &&

3184 !
	`‹¡_ªd_£t_¡a_æag
(
rx
->
¡a
, 
WLAN_STA_4ADDR_EVENT
))

3185 
	`cfg80211_rx_uÃx³ùed_4addr_äame
(

3186 
rx
->
sd©a
->
dev
,„x->
¡a
->¡a.
addr
, 
GFP_ATOMIC
);

3187  
RX_DROP_MONITOR
;

3190 
»s
 = 
	`__›“80211_d©a_to_8023
(
rx
, &
pÜt_cÚŒŞ
);

3191 ià(
	`uÆik–y
(
»s
 !ğ
RX_CONTINUE
))

3192  
»s
;

3194 
»s
 = 
	`›“80211_rx_mesh_d©a
(
rx
->
sd©a
,„x->
¡a
,„x->
skb
);

3195 ià(
»s
 !ğ
RX_CONTINUE
)

3196  
»s
;

3198 ià(!
	`›“80211_äame_®lowed
(
rx
, 
fc
))

3199  
RX_DROP_MONITOR
;

3202 ià(
	`uÆik–y
(((
‘hhdr
 *)
rx
->
skb
->
d©a
)->
h_´Ùo
 ==

3203 
	`ıu_to_be16
(
ETH_P_TDLS
))) {

3204 
›“80211_tdls_d©a
 *
tf
 = (*)
rx
->
skb
->
d©a
;

3206 ià(
	`pskb_may_puÎ
(
rx
->
skb
,

3207 
	`off£tof
(
›“80211_tdls_d©a
, 
u
)) &&

3208 
tf
->
·ylßd_ty³
 =ğ
WLAN_TDLS_SNAP_RFTYPE
 &&

3209 
tf
->
ÿ‹gÜy
 =ğ
WLAN_CATEGORY_TDLS
 &&

3210 (
tf
->
aùiÚ_code
 =ğ
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
 ||

3211 
tf
->
aùiÚ_code
 =ğ
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
)) {

3212 
rx
->
skb
->
´ÙocŞ
 = 
	`ıu_to_be16
(
ETH_P_TDLS
);

3213 
	`__›“80211_queue_skb_to_içû
(
sd©a
, 
rx
->
lšk_id
,

3214 
rx
->
¡a
,„x->
skb
);

3215  
RX_QUEUED
;

3219 ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

3220 
	`uÆik–y
(
pÜt_cÚŒŞ
è&& 
sd©a
->
bss
) {

3221 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
, 
›“80211_sub_if_d©a
,

3222 
u
.
­
);

3223 
dev
 = 
sd©a
->dev;

3224 
rx
->
sd©a
 = sdata;

3227 
rx
->
skb
->
dev
 = dev;

3229 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
) &&

3230 
loÿl
->
ps_sd©a
 &&†oÿl->
hw
.
cÚf
.
dyÇmic_ps_timeout
 > 0 &&

3231 !
	`is_muÉiÿ¡_‘h”_addr
(

3232 ((
‘hhdr
 *)
rx
->
skb
->
d©a
)->
h_de¡
) &&

3233 (!
loÿl
->
sÿÂšg
 &&

3234 !
	`‹¡_b™
(
SDATA_STATE_OFFCHANNEL
, &
sd©a
->
¡©e
)))

3235 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

3236 
	`m£cs_to_jiff›s
(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
));

3238 
	`›“80211_d–iv”_skb
(
rx
);

3240  
RX_QUEUED
;

3241 
	}
}

3243 
›“80211_rx_»suÉ
 
debug_nošlše


3244 
	$›“80211_rx_h_ù¾
(
›“80211_rx_d©a
 *
rx
, 
sk_buff_h—d
 *
äames
)

3246 
sk_buff
 *
skb
 = 
rx
->skb;

3247 
›“80211_b¬
 *
b¬
 = (›“80211_b¬ *)
skb
->
d©a
;

3248 
tid_ampdu_rx
 *
tid_agg_rx
;

3249 
u16
 
¡¬t_£q_num
;

3250 
u16
 
tid
;

3252 ià(
	`lik–y
(!
	`›“80211_is_ùl
(
b¬
->
äame_cÚŒŞ
)))

3253  
RX_CONTINUE
;

3255 ià(
	`›“80211_is_back_»q
(
b¬
->
äame_cÚŒŞ
)) {

3257 
__Ë16
 
cÚŒŞ
, 
¡¬t_£q_num
;

3258 } 
__·cked
 
b¬_d©a
;

3259 
›“80211_ev’t
 
ev’t
 = {

3260 .
ty³
 = 
BAR_RX_EVENT
,

3263 ià(!
rx
->
¡a
)

3264  
RX_DROP_MONITOR
;

3266 ià(
	`skb_cİy_b™s
(
skb
, 
	`off£tof
(
›“80211_b¬
, 
cÚŒŞ
),

3267 &
b¬_d©a
, (bar_data)))

3268  
RX_DROP_MONITOR
;

3270 
tid
 = 
	`Ë16_to_ıu
(
b¬_d©a
.
cÚŒŞ
) >> 12;

3272 ià(!
	`‹¡_b™
(
tid
, 
rx
->
¡a
->
ampdu_mlme
.
agg_£ssiÚ_v®id
) &&

3273 !
	`‹¡_ªd_£t_b™
(
tid
, 
rx
->
¡a
->
ampdu_mlme
.
uÃx³ùed_agg
))

3274 
	`›“80211_£nd_d–ba
(
rx
->
sd©a
,„x->
¡a
->¡a.
addr
, 
tid
,

3275 
WLAN_BACK_RECIPIENT
,

3276 
WLAN_REASON_QSTA_REQUIRE_SETUP
);

3278 
tid_agg_rx
 = 
	`rcu_d”eã»nû
(
rx
->
¡a
->
ampdu_mlme
.
tid_rx
[
tid
]);

3279 ià(!
tid_agg_rx
)

3280  
RX_DROP_MONITOR
;

3282 
¡¬t_£q_num
 = 
	`Ë16_to_ıu
(
b¬_d©a
.start_seq_num) >> 4;

3283 
ev’t
.
u
.
ba
.
tid
 =id;

3284 
ev’t
.
u
.
ba
.
s¢
 = 
¡¬t_£q_num
;

3285 
ev’t
.
u
.
ba
.
¡a
 = &
rx
->sta->sta;

3288 ià(
tid_agg_rx
->
timeout
)

3289 
	`mod_tim”
(&
tid_agg_rx
->
£ssiÚ_tim”
,

3290 
	`TU_TO_EXP_TIME
(
tid_agg_rx
->
timeout
));

3292 
	`¥š_lock
(&
tid_agg_rx
->
»Üd”_lock
);

3294 
	`›“80211_»Ëa£_»Üd”_äames
(
rx
->
sd©a
, 
tid_agg_rx
,

3295 
¡¬t_£q_num
, 
äames
);

3296 
	`¥š_uÆock
(&
tid_agg_rx
->
»Üd”_lock
);

3298 
	`drv_ev’t_ÿÎback
(
rx
->
loÿl
,„x->
sd©a
, &
ev’t
);

3300 
	`kä“_skb
(
skb
);

3301  
RX_QUEUED
;

3309  
RX_DROP_MONITOR
;

3310 
	}
}

3312 
	$›“80211_´oûss_§_qu”y_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

3313 
›“80211_mgmt
 *
mgmt
,

3314 
size_t
 
Ën
)

3316 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3317 
sk_buff
 *
skb
;

3318 
›“80211_mgmt
 *
»¥
;

3320 ià(!
	`‘h”_addr_equ®
(
mgmt
->
da
, 
sd©a
->
vif
.
addr
)) {

3325 ià(!
	`‘h”_addr_equ®
(
mgmt
->
§
, 
sd©a
->
deæšk
.
u
.
mgd
.
bssid
) ||

3326 !
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
sd©a
->
deæšk
.
u
.
mgd
.bssid)) {

3331 ià(
Ën
 < 24 + 1 + (
»¥
->
u
.
aùiÚ
.u.
§_qu”y
)) {

3336 
skb
 = 
	`dev_®loc_skb
((*
»¥
è+ 
loÿl
->
hw
.
exŒa_tx_h—droom
);

3337 ià(
skb
 =ğ
NULL
)

3340 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

3341 
»¥
 = 
	`skb_put_z”o
(
skb
, 24);

3342 
	`memıy
(
»¥
->
da
, 
mgmt
->
§
, 
ETH_ALEN
);

3343 
	`memıy
(
»¥
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3344 
	`memıy
(
»¥
->
bssid
, 
sd©a
->
deæšk
.
u
.
mgd
.bssid, 
ETH_ALEN
);

3345 
»¥
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

3346 
IEEE80211_STYPE_ACTION
);

3347 
	`skb_put
(
skb
, 1 + (
»¥
->
u
.
aùiÚ
.u.
§_qu”y
));

3348 
»¥
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_SA_QUERY
;

3349 
»¥
->
u
.
aùiÚ
.u.
§_qu”y
.aùiÚ = 
WLAN_ACTION_SA_QUERY_RESPONSE
;

3350 
	`memıy
(
»¥
->
u
.
aùiÚ
.u.
§_qu”y
.
Œªs_id
,

3351 
mgmt
->
u
.
aùiÚ
.u.
§_qu”y
.
Œªs_id
,

3352 
WLAN_SA_QUERY_TR_ID_LEN
);

3354 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

3355 
	}
}

3358 
	$›“80211_rx_check_bss_cŞÜ_cŞlisiÚ
(
›“80211_rx_d©a
 *
rx
)

3360 
›“80211_mgmt
 *
mgmt
 = (*)
rx
->
skb
->
d©a
;

3361 cÚ¡ 
–em’t
 *
›
;

3362 
size_t
 
ba£Ën
;

3364 ià(!
	`why_ext_ã©u»_is£t
(
rx
->
loÿl
->
hw
.
why
,

3365 
NL80211_EXT_FEATURE_BSS_COLOR
))

3368 ià(
	`›“80211_hw_check
(&
rx
->
loÿl
->
hw
, 
DETECTS_COLOR_COLLISION
))

3371 ià(
rx
->
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
)

3374 
ba£Ën
 = 
mgmt
->
u
.
b—cÚ
.
v¬ŸbË
 - 
rx
->
skb
->
d©a
;

3375 ià(
ba£Ën
 > 
rx
->
skb
->
Ën
)

3378 
›
 = 
	`cfg80211_fšd_ext_–em
(
WLAN_EID_EXT_HE_OPERATION
,

3379 
mgmt
->
u
.
b—cÚ
.
v¬ŸbË
,

3380 
rx
->
skb
->
Ën
 - 
ba£Ën
);

3381 ià(
›
 && ie->
d©®’
 >ğ(
›“80211_he_İ”©iÚ
) &&

3382 
›
->
d©®’
 >ğ
	`›“80211_he_İ”_size
(›->
d©a
 + 1)) {

3383 
›“80211_bss_cÚf
 *
bss_cÚf
 = &
rx
->
sd©a
->
vif
.bss_conf;

3384 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ”
;

3385 
u8
 
cŞÜ
;

3387 
he_İ”
 = (*)(
›
->
d©a
 + 1);

3388 ià(
	`Ë32_g‘_b™s
(
he_İ”
->
he_İ”_·¿ms
,

3389 
IEEE80211_HE_OPERATION_BSS_COLOR_DISABLED
))

3392 
cŞÜ
 = 
	`Ë32_g‘_b™s
(
he_İ”
->
he_İ”_·¿ms
,

3393 
IEEE80211_HE_OPERATION_BSS_COLOR_MASK
);

3394 ià(
cŞÜ
 =ğ
bss_cÚf
->
he_bss_cŞÜ
.color)

3395 
	`›“80211_obss_cŞÜ_cŞlisiÚ_nÙify
(&
rx
->
sd©a
->
vif
,

3396 
	`BIT_ULL
(
cŞÜ
));

3398 
	}
}

3400 
›“80211_rx_»suÉ
 
debug_nošlše


3401 
	$›“80211_rx_h_mgmt_check
(
›“80211_rx_d©a
 *
rx
)

3403 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*è
rx
->
skb
->
d©a
;

3404 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

3406 ià(
	`›“80211_is_s1g_b—cÚ
(
mgmt
->
äame_cÚŒŞ
))

3407  
RX_CONTINUE
;

3414 ià(
rx
->
skb
->
Ën
 < 24)

3415  
RX_DROP_MONITOR
;

3417 ià(!
	`›“80211_is_mgmt
(
mgmt
->
äame_cÚŒŞ
))

3418  
RX_DROP_MONITOR
;

3421 ià(
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
) &&

3422 
rx
->
skb
->
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
)

3423  
RX_DROP_U_RUNT_ACTION
;

3425 ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 &&

3426 
	`›“80211_is_b—cÚ
(
mgmt
->
äame_cÚŒŞ
) &&

3427 !(
rx
->
æags
 & 
IEEE80211_RX_BEACON_REPORTED
)) {

3428 
sig
 = 0;

3431 
	`›“80211_rx_check_bss_cŞÜ_cŞlisiÚ
(
rx
);

3433 ià(
	`›“80211_hw_check
(&
rx
->
loÿl
->
hw
, 
SIGNAL_DBM
) &&

3434 !(
¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
))

3435 
sig
 = 
¡©us
->
sigÇl
;

3437 
	`cfg80211_»pÜt_obss_b—cÚ_khz
(
rx
->
loÿl
->
hw
.
why
,

3438 
rx
->
skb
->
d©a
,„x->skb->
Ën
,

3439 
	`›“80211_rx_¡©us_to_khz
(
¡©us
),

3440 
sig
);

3441 
rx
->
æags
 |ğ
IEEE80211_RX_BEACON_REPORTED
;

3444  
	`›“80211_drİ_uÃnüy±ed_mgmt
(
rx
);

3445 
	}
}

3447 
boŞ


3448 
	$›“80211_´oûss_rx_twt_aùiÚ
(
›“80211_rx_d©a
 *
rx
)

3450 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*)
rx
->
skb
->
d©a
;

3451 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3454 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

3455  
çl£
;

3457 ià(!
rx
->
loÿl
->
İs
->
add_twt_£tup
)

3458  
çl£
;

3460 ià(!
sd©a
->
vif
.
bss_cÚf
.
twt_»¥Úd”
)

3461  
çl£
;

3463 ià(!
rx
->
¡a
)

3464  
çl£
;

3466 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
) {

3467 
WLAN_S1G_TWT_SETUP
: {

3468 
›“80211_twt_£tup
 *
twt
;

3470 ià(
rx
->
skb
->
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 +

3472 (
›“80211_twt_£tup
) +

3476 
twt
 = (*)
mgmt
->
u
.
aùiÚ
.u.
s1g
.
v¬ŸbË
;

3477 ià(
twt
->
–em’t_id
 !ğ
WLAN_EID_S1G_TWT
)

3480 ià(
rx
->
skb
->
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 +

3482 
twt
->
Ëngth
)

3485  
Œue
;

3487 
WLAN_S1G_TWT_TEARDOWN
:

3488 ià(
rx
->
skb
->
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 2)

3491  
Œue
;

3496  
çl£
;

3497 
	}
}

3499 
›“80211_rx_»suÉ
 
debug_nošlše


3500 
	$›“80211_rx_h_aùiÚ
(
›“80211_rx_d©a
 *
rx
)

3502 
›“80211_loÿl
 *
loÿl
 = 
rx
->local;

3503 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3504 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*è
rx
->
skb
->
d©a
;

3505 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

3506 
Ën
 = 
rx
->
skb
->len;

3508 ià(!
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
))

3509  
RX_CONTINUE
;

3511 ià(!
rx
->
¡a
 && 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_PUBLIC
 &&

3512 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_SELF_PROTECTED
 &&

3513 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_SPECTRUM_MGMT
)

3514  
RX_DROP_U_ACTION_UNKNOWN_SRC
;

3516 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
) {

3517 
WLAN_CATEGORY_HT
:

3519 ià(!
rx
->
lšk_¡a
->
pub
->
ht_ÿp
.
ht_suµÜ‹d
)

3520 
šv®id
;

3522 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 &&

3523 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
 &&

3524 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

3525 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

3526 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

3530 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 2)

3531 
šv®id
;

3533 
mgmt
->
u
.
aùiÚ
.u.
ht_smps
.action) {

3534 
WLAN_HT_ACTION_SMPS
: {

3535 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

3536 
›“80211_smps_mode
 
smps_mode
;

3537 
¡a_İmode_šfo
 
¡a_İmode
 = {};

3539 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

3540 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
)

3541 
hªdËd
;

3544 
mgmt
->
u
.
aùiÚ
.u.
ht_smps
.
smps_cÚŒŞ
) {

3545 
WLAN_HT_SMPS_CONTROL_DISABLED
:

3546 
smps_mode
 = 
IEEE80211_SMPS_OFF
;

3548 
WLAN_HT_SMPS_CONTROL_STATIC
:

3549 
smps_mode
 = 
IEEE80211_SMPS_STATIC
;

3551 
WLAN_HT_SMPS_CONTROL_DYNAMIC
:

3552 
smps_mode
 = 
IEEE80211_SMPS_DYNAMIC
;

3555 
šv®id
;

3559 ià(
rx
->
lšk_¡a
->
pub
->
smps_mode
 == smps_mode)

3560 
hªdËd
;

3561 
rx
->
lšk_¡a
->
pub
->
smps_mode
 = smps_mode;

3562 
¡a_İmode
.
smps_mode
 =

3563 
	`›“80211_smps_mode_to_smps_mode
(
smps_mode
);

3564 
¡a_İmode
.
chªged
 = 
STA_OPMODE_SMPS_MODE_CHANGED
;

3566 
sbªd
 = 
rx
->
loÿl
->
hw
.
why
->
bªds
[
¡©us
->
bªd
];

3568 
	`¿‹_cÚŒŞ_¿‹_upd©e
(
loÿl
, 
sbªd
, 
rx
->
¡a
, 0,

3569 
IEEE80211_RC_SMPS_CHANGED
);

3570 
	`cfg80211_¡a_İmode_chªge_nÙify
(
sd©a
->
dev
,

3571 
rx
->
¡a
->
addr
,

3572 &
¡a_İmode
,

3573 
GFP_ATOMIC
);

3574 
hªdËd
;

3576 
WLAN_HT_ACTION_NOTIFY_CHANWIDTH
: {

3577 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

3578 
u8
 
chªwidth
 = 
mgmt
->
u
.
aùiÚ
.u.
ht_nÙify_cw
.chanwidth;

3579 
›“80211_¡a_rx_bªdwidth
 
max_bw
, 
Ãw_bw
;

3580 
¡a_İmode_šfo
 
¡a_İmode
 = {};

3583 ià(!(
rx
->
lšk_¡a
->
pub
->
ht_ÿp
.
ÿp
 &

3584 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
))

3585 
hªdËd
;

3587 ià(
chªwidth
 =ğ
IEEE80211_HT_CHANWIDTH_20MHZ
)

3588 
max_bw
 = 
IEEE80211_STA_RX_BW_20
;

3590 
max_bw
 = 
	`›“80211_¡a_ÿp_rx_bw
(
rx
->
lšk_¡a
);

3593 
rx
->
lšk_¡a
->
cur_max_bªdwidth
 = 
max_bw
;

3594 
Ãw_bw
 = 
	`›“80211_¡a_cur_vht_bw
(
rx
->
lšk_¡a
);

3596 ià(
rx
->
lšk_¡a
->
pub
->
bªdwidth
 =ğ
Ãw_bw
)

3597 
hªdËd
;

3599 
rx
->
lšk_¡a
->
pub
->
bªdwidth
 = 
Ãw_bw
;

3600 
sbªd
 = 
rx
->
loÿl
->
hw
.
why
->
bªds
[
¡©us
->
bªd
];

3601 
¡a_İmode
.
bw
 =

3602 
	`›“80211_¡a_rx_bw_to_chª_width
(
rx
->
lšk_¡a
);

3603 
¡a_İmode
.
chªged
 = 
STA_OPMODE_MAX_BW_CHANGED
;

3605 
	`¿‹_cÚŒŞ_¿‹_upd©e
(
loÿl
, 
sbªd
, 
rx
->
¡a
, 0,

3606 
IEEE80211_RC_BW_CHANGED
);

3607 
	`cfg80211_¡a_İmode_chªge_nÙify
(
sd©a
->
dev
,

3608 
rx
->
¡a
->
addr
,

3609 &
¡a_İmode
,

3610 
GFP_ATOMIC
);

3611 
hªdËd
;

3614 
šv®id
;

3618 
WLAN_CATEGORY_PUBLIC
:

3619 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 1)

3620 
šv®id
;

3621 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3623 ià(!
rx
->
¡a
)

3625 ià(!
	`‘h”_addr_equ®
(
mgmt
->
bssid
, 
sd©a
->
deæšk
.
u
.
mgd
.bssid))

3627 ià(
mgmt
->
u
.
aùiÚ
.u.
ext_chª_sw™ch
.
aùiÚ_code
 !=

3628 
WLAN_PUB_ACTION_EXT_CHANSW_ANN
)

3630 ià(
Ën
 < 
	`off£tof
(
›“80211_mgmt
,

3631 
u
.
aùiÚ
.u.
ext_chª_sw™ch
.
v¬ŸbË
))

3632 
šv®id
;

3633 
queue
;

3634 
WLAN_CATEGORY_VHT
:

3635 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 &&

3636 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
 &&

3637 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

3638 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

3639 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

3643 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 1)

3644 
šv®id
;

3646 
mgmt
->
u
.
aùiÚ
.u.
vht_İmode_nÙif
.
aùiÚ_code
) {

3647 
WLAN_VHT_ACTION_OPMODE_NOTIF
: {

3649 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 2)

3650 
šv®id
;

3651 
queue
;

3653 
WLAN_VHT_ACTION_GROUPID_MGMT
: {

3654 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 25)

3655 
šv®id
;

3656 
queue
;

3662 
WLAN_CATEGORY_BACK
:

3663 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 &&

3664 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
 &&

3665 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

3666 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

3667 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

3671 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 1)

3674 
mgmt
->
u
.
aùiÚ
.u.
addba_»q
.
aùiÚ_code
) {

3675 
WLAN_ACTION_ADDBA_REQ
:

3676 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3677 (
mgmt
->
u
.
aùiÚ
.u.
addba_»q
)))

3678 
šv®id
;

3680 
WLAN_ACTION_ADDBA_RESP
:

3681 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3682 (
mgmt
->
u
.
aùiÚ
.u.
addba_»¥
)))

3683 
šv®id
;

3685 
WLAN_ACTION_DELBA
:

3686 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3687 (
mgmt
->
u
.
aùiÚ
.u.
d–ba
)))

3688 
šv®id
;

3691 
šv®id
;

3694 
queue
;

3695 
WLAN_CATEGORY_SPECTRUM_MGMT
:

3697 ià(
Ën
 < 
IEEE80211_MIN_ACTION_SIZE
 + 1)

3700 
mgmt
->
u
.
aùiÚ
.u.
m—su»m’t
.
aùiÚ_code
) {

3701 
WLAN_ACTION_SPCT_MSR_REQ
:

3702 ià(
¡©us
->
bªd
 !ğ
NL80211_BAND_5GHZ
)

3705 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3706 (
mgmt
->
u
.
aùiÚ
.u.
m—su»m’t
)))

3709 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3712 
	`›“80211_´oûss_m—su»m’t_»q
(
sd©a
, 
mgmt
, 
Ën
);

3713 
hªdËd
;

3714 
WLAN_ACTION_SPCT_CHL_SWITCH
: {

3715 
u8
 *
bssid
;

3716 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3717 (
mgmt
->
u
.
aùiÚ
.u.
chª_sw™ch
)))

3720 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 &&

3721 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

3722 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
)

3725 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

3726 
bssid
 = 
sd©a
->
deæšk
.
u
.
mgd
.bssid;

3727 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

3728 
bssid
 = 
sd©a
->
u
.
ibss
.bssid;

3729 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
)

3730 
bssid
 = 
mgmt
->
§
;

3734 ià(!
	`‘h”_addr_equ®
(
mgmt
->
bssid
, bssid))

3737 
queue
;

3741 
WLAN_CATEGORY_SELF_PROTECTED
:

3742 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3743 (
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
aùiÚ_code
)))

3746 
mgmt
->
u
.
aùiÚ
.u.
£lf_´Ù
.
aùiÚ_code
) {

3747 
WLAN_SP_MESH_PEERING_OPEN
:

3748 
WLAN_SP_MESH_PEERING_CLOSE
:

3749 
WLAN_SP_MESH_PEERING_CONFIRM
:

3750 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

3751 
šv®id
;

3752 ià(
sd©a
->
u
.
mesh
.
u£r_mpm
)

3755 
queue
;

3756 
WLAN_SP_MGK_INFORM
:

3757 
WLAN_SP_MGK_ACK
:

3758 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

3759 
šv®id
;

3763 
WLAN_CATEGORY_MESH_ACTION
:

3764 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3765 (
mgmt
->
u
.
aùiÚ
.u.
mesh_aùiÚ
.
aùiÚ_code
)))

3768 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

3770 ià(
	`mesh_aùiÚ_is_·th_£l
(
mgmt
) &&

3771 !
	`mesh_·th_£l_is_hwmp
(
sd©a
))

3773 
queue
;

3774 
WLAN_CATEGORY_S1G
:

3775 ià(
Ën
 < 
	`off£toãnd
(
	`ty³of
(*
mgmt
),

3776 
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
))

3779 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
) {

3780 
WLAN_S1G_TWT_SETUP
:

3781 
WLAN_S1G_TWT_TEARDOWN
:

3782 ià(
	`›“80211_´oûss_rx_twt_aùiÚ
(
rx
))

3783 
queue
;

3789 
WLAN_CATEGORY_PROTECTED_EHT
:

3790 ià(
Ën
 < 
	`off£toãnd
(
	`ty³of
(*
mgmt
),

3791 
u
.
aùiÚ
.u.
‰lm_»q
.
aùiÚ_code
))

3794 
mgmt
->
u
.
aùiÚ
.u.
‰lm_»q
.
aùiÚ_code
) {

3795 
WLAN_PROTECTED_EHT_ACTION_TTLM_REQ
:

3796 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3799 ià(
Ën
 < 
	`off£toãnd
(
	`ty³of
(*
mgmt
),

3800 
u
.
aùiÚ
.u.
‰lm_»q
))

3801 
šv®id
;

3802 
queue
;

3803 
WLAN_PROTECTED_EHT_ACTION_TTLM_RES
:

3804 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3807 ià(
Ën
 < 
	`off£toãnd
(
	`ty³of
(*
mgmt
),

3808 
u
.
aùiÚ
.u.
‰lm_»s
))

3809 
šv®id
;

3810 
queue
;

3817  
RX_CONTINUE
;

3819 
šv®id
:

3820 
¡©us
->
rx_æags
 |ğ
IEEE80211_RX_MALFORMED_ACTION_FRM
;

3822  
RX_CONTINUE
;

3824 
hªdËd
:

3825 ià(
rx
->
¡a
)

3826 
rx
->
lšk_¡a
->
rx_¡©s
.
·ck‘s
++;

3827 
	`dev_kä“_skb
(
rx
->
skb
);

3828  
RX_QUEUED
;

3830 
queue
:

3831 
	`›“80211_queue_skb_to_içû
(
sd©a
, 
rx
->
lšk_id
,„x->
¡a
,„x->
skb
);

3832  
RX_QUEUED
;

3833 
	}
}

3835 
›“80211_rx_»suÉ
 
debug_nošlše


3836 
	$›“80211_rx_h_u£r¥aû_mgmt
(
›“80211_rx_d©a
 *
rx
)

3838 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

3839 
cfg80211_rx_šfo
 
šfo
 = {

3840 .
äeq
 = 
	`›“80211_rx_¡©us_to_khz
(
¡©us
),

3841 .
buf
 = 
rx
->
skb
->
d©a
,

3842 .
Ën
 = 
rx
->
skb
->len,

3843 .
lšk_id
 = 
rx
->link_id,

3844 .
have_lšk_id
 = 
rx
->
lšk_id
 >= 0,

3848 ià(
¡©us
->
rx_æags
 & 
IEEE80211_RX_MALFORMED_ACTION_FRM
)

3849  
RX_CONTINUE
;

3858 ià(
	`›“80211_hw_check
(&
rx
->
loÿl
->
hw
, 
SIGNAL_DBM
) &&

3859 !(
¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
))

3860 
šfo
.
sig_dbm
 = 
¡©us
->
sigÇl
;

3862 ià(
	`›“80211_is_timšg_m—su»m’t
(
rx
->
skb
) ||

3863 
	`›“80211_is_ám
(
rx
->
skb
)) {

3864 
šfo
.
rx_t¡amp
 = 
	`ktime_to_ns
(
	`skb_hwt¡amps
(
rx
->
skb
)->
hwt¡amp
);

3865 
šfo
.
ack_t¡amp
 = 
	`ktime_to_ns
(
¡©us
->
ack_tx_hwt¡amp
);

3868 ià(
	`cfg80211_rx_mgmt_ext
(&
rx
->
sd©a
->
wdev
, &
šfo
)) {

3869 ià(
rx
->
¡a
)

3870 
rx
->
lšk_¡a
->
rx_¡©s
.
·ck‘s
++;

3871 
	`dev_kä“_skb
(
rx
->
skb
);

3872  
RX_QUEUED
;

3875  
RX_CONTINUE
;

3876 
	}
}

3878 
›“80211_rx_»suÉ
 
debug_nošlše


3879 
	$›“80211_rx_h_aùiÚ_po¡_u£r¥aû
(
›“80211_rx_d©a
 *
rx
)

3881 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3882 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*è
rx
->
skb
->
d©a
;

3883 
Ën
 = 
rx
->
skb
->len;

3885 ià(!
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
))

3886  
RX_CONTINUE
;

3888 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
) {

3889 
WLAN_CATEGORY_SA_QUERY
:

3890 ià(
Ën
 < (
IEEE80211_MIN_ACTION_SIZE
 +

3891 (
mgmt
->
u
.
aùiÚ
.u.
§_qu”y
)))

3894 
mgmt
->
u
.
aùiÚ
.u.
§_qu”y
.action) {

3895 
WLAN_ACTION_SA_QUERY_REQUEST
:

3896 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3898 
	`›“80211_´oûss_§_qu”y_»q
(
sd©a
, 
mgmt
, 
Ën
);

3899 
hªdËd
;

3904  
RX_CONTINUE
;

3906 
hªdËd
:

3907 ià(
rx
->
¡a
)

3908 
rx
->
lšk_¡a
->
rx_¡©s
.
·ck‘s
++;

3909 
	`dev_kä“_skb
(
rx
->
skb
);

3910  
RX_QUEUED
;

3911 
	}
}

3913 
›“80211_rx_»suÉ
 
debug_nošlše


3914 
	$›“80211_rx_h_aùiÚ_»tuº
(
›“80211_rx_d©a
 *
rx
)

3916 
›“80211_loÿl
 *
loÿl
 = 
rx
->local;

3917 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*è
rx
->
skb
->
d©a
;

3918 
sk_buff
 *
nskb
;

3919 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3920 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

3922 ià(!
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
))

3923  
RX_CONTINUE
;

3935 ià(!(
¡©us
->
rx_æags
 & 
IEEE80211_RX_MALFORMED_ACTION_FRM
) &&

3936 (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

3937 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
))

3938  
RX_DROP_MONITOR
;

3940 ià(
	`is_muÉiÿ¡_‘h”_addr
(
mgmt
->
da
))

3941  
RX_DROP_MONITOR
;

3944 ià(
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 & 0x80)

3945  
RX_DROP_U_REJECTED_ACTION_RESPONSE
;

3947 
nskb
 = 
	`skb_cİy_ex·nd
(
rx
->
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
, 0,

3948 
GFP_ATOMIC
);

3949 ià(
nskb
) {

3950 
›“80211_mgmt
 *
nmgmt
 = (*)
nskb
->
d©a
;

3952 
nmgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 |= 0x80;

3953 
	`memıy
(
nmgmt
->
da
,‚mgmt->
§
, 
ETH_ALEN
);

3954 
	`memıy
(
nmgmt
->
§
, 
rx
->
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3956 
	`mem£t
(
nskb
->
cb
, 0, (nskb->cb));

3958 ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_P2P_DEVICE
) {

3959 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
nskb
);

3961 
šfo
->
æags
 = 
IEEE80211_TX_CTL_TX_OFFCHAN
 |

3962 
IEEE80211_TX_INTFL_OFFCHAN_TX_OK
 |

3963 
IEEE80211_TX_CTL_NO_CCK_RATE
;

3964 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
))

3965 
šfo
->
hw_queue
 =

3966 
loÿl
->
hw
.
offchªÃl_tx_hw_queue
;

3969 
	`__›“80211_tx_skb_tid_bªd
(
rx
->
sd©a
, 
nskb
, 7, -1,

3970 
¡©us
->
bªd
);

3972 
	`dev_kä“_skb
(
rx
->
skb
);

3973  
RX_QUEUED
;

3974 
	}
}

3976 
›“80211_rx_»suÉ
 
debug_nošlše


3977 
	$›“80211_rx_h_ext
(
›“80211_rx_d©a
 *
rx
)

3979 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3980 
›“80211_hdr
 *
hdr
 = (*)
rx
->
skb
->
d©a
;

3982 ià(!
	`›“80211_is_ext
(
hdr
->
äame_cÚŒŞ
))

3983  
RX_CONTINUE
;

3985 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

3986  
RX_DROP_MONITOR
;

3989 
	`›“80211_queue_skb_to_içû
(
sd©a
, 
rx
->
lšk_id
,„x->
¡a
,„x->
skb
);

3991  
RX_QUEUED
;

3992 
	}
}

3994 
›“80211_rx_»suÉ
 
debug_nošlše


3995 
	$›“80211_rx_h_mgmt
(
›“80211_rx_d©a
 *
rx
)

3997 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

3998 
›“80211_mgmt
 *
mgmt
 = (*)
rx
->
skb
->
d©a
;

3999 
__Ë16
 
¡y³
;

4001 
¡y³
 = 
mgmt
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_FCTL_STYPE
);

4003 ià(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
) &&

4004 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

4005 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_OCB
 &&

4006 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

4007  
RX_DROP_MONITOR
;

4009 
¡y³
) {

4010 
	`ıu_to_Ë16
(
IEEE80211_STYPE_AUTH
):

4011 
	`ıu_to_Ë16
(
IEEE80211_STYPE_BEACON
):

4012 
	`ıu_to_Ë16
(
IEEE80211_STYPE_PROBE_RESP
):

4015 
	`ıu_to_Ë16
(
IEEE80211_STYPE_DEAUTH
):

4016 ià(
	`is_muÉiÿ¡_‘h”_addr
(
mgmt
->
da
) &&

4017 !
	`is_brßdÿ¡_‘h”_addr
(
mgmt
->
da
))

4018  
RX_DROP_MONITOR
;

4021 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 &&

4022 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
)

4023  
RX_DROP_MONITOR
;

4025 
	`ıu_to_Ë16
(
IEEE80211_STYPE_ASSOC_RESP
):

4026 
	`ıu_to_Ë16
(
IEEE80211_STYPE_REASSOC_RESP
):

4027 
	`ıu_to_Ë16
(
IEEE80211_STYPE_DISASSOC
):

4028 ià(
	`is_muÉiÿ¡_‘h”_addr
(
mgmt
->
da
) &&

4029 !
	`is_brßdÿ¡_‘h”_addr
(
mgmt
->
da
))

4030  
RX_DROP_MONITOR
;

4033 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

4034  
RX_DROP_MONITOR
;

4036 
	`ıu_to_Ë16
(
IEEE80211_STYPE_PROBE_REQ
):

4038 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

4039 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
)

4040  
RX_DROP_MONITOR
;

4043  
RX_DROP_MONITOR
;

4046 
	`›“80211_queue_skb_to_içû
(
sd©a
, 
rx
->
lšk_id
,„x->
¡a
,„x->
skb
);

4048  
RX_QUEUED
;

4049 
	}
}

4051 
	$›“80211_rx_cooked_mÚ™Ü
(
›“80211_rx_d©a
 *
rx
,

4052 
›“80211_¿‹
 *
¿‹
,

4053 
›“80211_rx_»suÉ
 
»asÚ
)

4055 
›“80211_sub_if_d©a
 *
sd©a
;

4056 
›“80211_loÿl
 *
loÿl
 = 
rx
->local;

4057 
sk_buff
 *
skb
 = 
rx
->skb, *
skb2
;

4058 
Ãt_deviû
 *
´ev_dev
 = 
NULL
;

4059 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

4060 
Ãeded_h—droom
;

4066 ià(
rx
->
æags
 & 
IEEE80211_RX_CMNTR
)

4067 
out_ä“_skb
;

4068 
rx
->
æags
 |ğ
IEEE80211_RX_CMNTR
;

4071 ià(!
loÿl
->
cooked_mÁrs
)

4072 
out_ä“_skb
;

4075 
Ãeded_h—droom
 = 
	`›“80211_rx_¿diÙ­_hd¾’
(
loÿl
, 
¡©us
, 
skb
);

4077 ià(
	`skb_h—droom
(
skb
è< 
Ãeded_h—droom
 &&

4078 
	`pskb_ex·nd_h—d
(
skb
, 
Ãeded_h—droom
, 0, 
GFP_ATOMIC
))

4079 
out_ä“_skb
;

4082 
	`›“80211_add_rx_¿diÙ­_h—d”
(
loÿl
, 
skb
, 
¿‹
, 
Ãeded_h—droom
,

4083 
çl£
);

4085 
	`skb_»£t_mac_h—d”
(
skb
);

4086 
skb
->
_summed
 = 
CHECKSUM_UNNECESSARY
;

4087 
skb
->
pkt_ty³
 = 
PACKET_OTHERHOST
;

4088 
skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_2
);

4090 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

4091 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

4094 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
 ||

4095 !(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_COOK_FRAMES
))

4098 ià(
´ev_dev
) {

4099 
skb2
 = 
	`skb_şÚe
(
skb
, 
GFP_ATOMIC
);

4100 ià(
skb2
) {

4101 
skb2
->
dev
 = 
´ev_dev
;

4102 
	`Ãtif_»ûive_skb
(
skb2
);

4106 
´ev_dev
 = 
sd©a
->
dev
;

4107 
	`dev_sw_Ãt¡©s_rx_add
(
sd©a
->
dev
, 
skb
->
Ën
);

4110 ià(
´ev_dev
) {

4111 
skb
->
dev
 = 
´ev_dev
;

4112 
	`Ãtif_»ûive_skb
(
skb
);

4116 
out_ä“_skb
:

4117 
	`kä“_skb_»asÚ
(
skb
, (
__fÜû
 
u32
)
»asÚ
);

4118 
	}
}

4120 
	$›“80211_rx_hªdËrs_»suÉ
(
›“80211_rx_d©a
 *
rx
,

4121 
›“80211_rx_»suÉ
 
»s
)

4123 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

4124 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

4125 
›“80211_¿‹
 *
¿‹
 = 
NULL
;

4127 ià(
»s
 =ğ
RX_QUEUED
) {

4128 
	`I802_DEBUG_INC
(
rx
->
sd©a
->
loÿl
->
rx_hªdËrs_queued
);

4132 ià(
»s
 !ğ
RX_CONTINUE
) {

4133 
	`I802_DEBUG_INC
(
rx
->
sd©a
->
loÿl
->
rx_hªdËrs_drİ
);

4134 ià(
rx
->
¡a
)

4135 
rx
->
lšk_¡a
->
rx_¡©s
.
drİ³d
++;

4138 ià(
	`u32_g‘_b™s
((
__fÜû
 
u32
)
»s
, 
SKB_DROP_REASON_SUBSYS_MASK
) ==

4139 
SKB_DROP_REASON_SUBSYS_MAC80211_UNUSABLE
) {

4140 
	`kä“_skb_»asÚ
(
rx
->
skb
, (
__fÜû
 
u32
)
»s
);

4144 
sbªd
 = 
rx
->
loÿl
->
hw
.
why
->
bªds
[
¡©us
->
bªd
];

4145 ià(
¡©us
->
’codšg
 =ğ
RX_ENC_LEGACY
)

4146 
¿‹
 = &
sbªd
->
b™¿‹s
[
¡©us
->
¿‹_idx
];

4148 
	`›“80211_rx_cooked_mÚ™Ü
(
rx
, 
¿‹
, 
»s
);

4149 
	}
}

4151 
	$›“80211_rx_hªdËrs
(
›“80211_rx_d©a
 *
rx
,

4152 
sk_buff_h—d
 *
äames
)

4154 
›“80211_rx_»suÉ
 
»s
 = 
RX_DROP_MONITOR
;

4155 
sk_buff
 *
skb
;

4157 
	#CALL_RXH
(
rxh
) \

4159 
»s
 = 
	`rxh
(
rx
); \

4160 ià(
»s
 !ğ
RX_CONTINUE
) \

4161 
rxh_Ãxt
; \

4162 } 0)

	)

4170 
	`¥š_lock_bh
(&
rx
->
loÿl
->
rx_·th_lock
);

4172 (
skb
 = 
	`__skb_dequeue
(
äames
))) {

4178 
rx
->
skb
 = skb;

4180 ià(
	`WARN_ON_ONCE
(!
rx
->
lšk
))

4181 
rxh_Ãxt
;

4183 
	`CALL_RXH
(
›“80211_rx_h_check_mÜe_d©a
);

4184 
	`CALL_RXH
(
›“80211_rx_h_u­sd_ªd_p¥Şl
);

4185 
	`CALL_RXH
(
›“80211_rx_h_¡a_´oûss
);

4186 
	`CALL_RXH
(
›“80211_rx_h_deüy±
);

4187 
	`CALL_RXH
(
›“80211_rx_h_deäagm’t
);

4188 
	`CALL_RXH
(
›“80211_rx_h_mich«l_mic_v”ify
);

4190 
	`CALL_RXH
(
›“80211_rx_h_amsdu
);

4191 
	`CALL_RXH
(
›“80211_rx_h_d©a
);

4194 
»s
 = 
	`›“80211_rx_h_ù¾
(
rx
, 
äames
);

4195 ià(
»s
 !ğ
RX_CONTINUE
)

4196 
rxh_Ãxt
;

4198 
	`CALL_RXH
(
›“80211_rx_h_mgmt_check
);

4199 
	`CALL_RXH
(
›“80211_rx_h_aùiÚ
);

4200 
	`CALL_RXH
(
›“80211_rx_h_u£r¥aû_mgmt
);

4201 
	`CALL_RXH
(
›“80211_rx_h_aùiÚ_po¡_u£r¥aû
);

4202 
	`CALL_RXH
(
›“80211_rx_h_aùiÚ_»tuº
);

4203 
	`CALL_RXH
(
›“80211_rx_h_ext
);

4204 
	`CALL_RXH
(
›“80211_rx_h_mgmt
);

4206 
rxh_Ãxt
:

4207 
	`›“80211_rx_hªdËrs_»suÉ
(
rx
, 
»s
);

4209 #undeà
CALL_RXH


4212 
	`¥š_uÆock_bh
(&
rx
->
loÿl
->
rx_·th_lock
);

4213 
	}
}

4215 
	$›“80211_švoke_rx_hªdËrs
(
›“80211_rx_d©a
 *
rx
)

4217 
sk_buff_h—d
 
»Üd”_»Ëa£
;

4218 
›“80211_rx_»suÉ
 
»s
 = 
RX_DROP_MONITOR
;

4220 
	`__skb_queue_h—d_š™
(&
»Üd”_»Ëa£
);

4222 
	#CALL_RXH
(
rxh
) \

4224 
»s
 = 
	`rxh
(
rx
); \

4225 ià(
»s
 !ğ
RX_CONTINUE
) \

4226 
rxh_Ãxt
; \

4227 } 0)

	)

4229 
	`CALL_RXH
(
›“80211_rx_h_check_dup
);

4230 
	`CALL_RXH
(
›“80211_rx_h_check
);

4232 
	`›“80211_rx_»Üd”_ampdu
(
rx
, &
»Üd”_»Ëa£
);

4234 
	`›“80211_rx_hªdËrs
(
rx
, &
»Üd”_»Ëa£
);

4237 
rxh_Ãxt
:

4238 
	`›“80211_rx_hªdËrs_»suÉ
(
rx
, 
»s
);

4240 #undeà
CALL_RXH


4241 
	}
}

4243 
boŞ


4244 
	$›“80211_rx_is_v®id_¡a_lšk_id
(
›“80211_¡a
 *
¡a
, 
u8
 
lšk_id
)

4246  !!(
¡a
->
v®id_lšks
 & 
	`BIT
(
lšk_id
));

4247 
	}
}

4249 
boŞ
 
	$›“80211_rx_d©a_£t_lšk
(
›“80211_rx_d©a
 *
rx
,

4250 
u8
 
lšk_id
)

4252 
rx
->
lšk_id
 =†ink_id;

4253 
rx
->
lšk
 = 
	`rcu_d”eã»nû
Ôx->
sd©a
->lšk[
lšk_id
]);

4255 ià(!
rx
->
¡a
)

4256  
rx
->
lšk
;

4258 ià(!
	`›“80211_rx_is_v®id_¡a_lšk_id
(&
rx
->
¡a
->¡a, 
lšk_id
))

4259  
çl£
;

4261 
rx
->
lšk_¡a
 = 
	`rcu_d”eã»nû
Ôx->
¡a
->
lšk
[
lšk_id
]);

4263  
rx
->
lšk
 &&„x->
lšk_¡a
;

4264 
	}
}

4266 
boŞ
 
	$›“80211_rx_d©a_£t_¡a
(
›“80211_rx_d©a
 *
rx
,

4267 
¡a_šfo
 *
¡a
, 
lšk_id
)

4269 
rx
->
lšk_id
 =†ink_id;

4270 
rx
->
¡a
 = sta;

4272 ià(
¡a
) {

4273 
rx
->
loÿl
 = 
¡a
->
sd©a
->local;

4274 ià(!
rx
->
sd©a
)

4275 
rx
->
sd©a
 = 
¡a
->sdata;

4276 
rx
->
lšk_¡a
 = &
¡a
->
deæšk
;

4278 
rx
->
lšk_¡a
 = 
NULL
;

4281 ià(
lšk_id
 < 0)

4282 
rx
->
lšk
 = &rx->
sd©a
->
deæšk
;

4283 ià(!
	`›“80211_rx_d©a_£t_lšk
(
rx
, 
lšk_id
))

4284  
çl£
;

4286  
Œue
;

4287 
	}
}

4293 
	$›“80211_»Ëa£_»Üd”_timeout
(
¡a_šfo
 *
¡a
, 
tid
)

4295 
sk_buff_h—d
 
äames
;

4296 
›“80211_rx_d©a
 
rx
 = {

4298 .
£cur™y_idx
 = 
tid
,

4299 .
£qno_idx
 = 
tid
,

4301 
tid_ampdu_rx
 *
tid_agg_rx
;

4302 
lšk_id
 = -1;

4305 ià(
¡a
->¡a.
v®id_lšks
)

4306 
lšk_id
 = 
	`ffs
(
¡a
->¡a.
v®id_lšks
) - 1;

4308 ià(!
	`›“80211_rx_d©a_£t_¡a
(&
rx
, 
¡a
, 
lšk_id
))

4311 
tid_agg_rx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.
tid_rx
[
tid
]);

4312 ià(!
tid_agg_rx
)

4315 
	`__skb_queue_h—d_š™
(&
äames
);

4317 
	`¥š_lock
(&
tid_agg_rx
->
»Üd”_lock
);

4318 
	`›“80211_¡a_»Üd”_»Ëa£
(
¡a
->
sd©a
, 
tid_agg_rx
, &
äames
);

4319 
	`¥š_uÆock
(&
tid_agg_rx
->
»Üd”_lock
);

4321 ià(!
	`skb_queue_em±y
(&
äames
)) {

4322 
›“80211_ev’t
 
ev’t
 = {

4323 .
ty³
 = 
BA_FRAME_TIMEOUT
,

4324 .
u
.
ba
.
tid
 =id,

4325 .
u
.
ba
.
¡a
 = &sta->sta,

4327 
	`drv_ev’t_ÿÎback
(
rx
.
loÿl
,„x.
sd©a
, &
ev’t
);

4330 
	`›“80211_rx_hªdËrs
(&
rx
, &
äames
);

4331 
	}
}

4333 
	$›“80211_m¬k_rx_ba_f‹»d_äames
(
›“80211_¡a
 *
pub¡a
, 
u8
 
tid
,

4334 
u16
 
s¢
, 
u64
 
f‹»d
,

4335 
u16
 
»ûived_mpdus
)

4337 
›“80211_loÿl
 *
loÿl
;

4338 
¡a_šfo
 *
¡a
;

4339 
tid_ampdu_rx
 *
tid_agg_rx
;

4340 
sk_buff_h—d
 
äames
;

4341 
›“80211_rx_d©a
 
rx
 = {

4343 .
£cur™y_idx
 = 
tid
,

4344 .
£qno_idx
 = 
tid
,

4346 
i
, 
diff
;

4348 ià(
	`WARN_ON
(!
pub¡a
 || 
tid
 >ğ
IEEE80211_NUM_TIDS
))

4351 
	`__skb_queue_h—d_š™
(&
äames
);

4353 
¡a
 = 
	`cÚš”_of
(
pub¡a
, 
¡a_šfo
, sta);

4355 
loÿl
 = 
¡a
->
sd©a
->local;

4356 
	`WARN_ONCE
(
loÿl
->
hw
.
max_rx_agg»g©iÚ_subäames
 > 64,

4358 
loÿl
->
hw
.
max_rx_agg»g©iÚ_subäames
);

4360 ià(!
	`›“80211_rx_d©a_£t_¡a
(&
rx
, 
¡a
, -1))

4363 
	`rcu_»ad_lock
();

4364 
tid_agg_rx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.
tid_rx
[
tid
]);

4365 ià(!
tid_agg_rx
)

4366 
out
;

4368 
	`¥š_lock_bh
(&
tid_agg_rx
->
»Üd”_lock
);

4370 ià(
»ûived_mpdus
 >ğ
IEEE80211_SN_MODULO
 >> 1) {

4371 
»Ëa£
;

4374 
»Ëa£
 = (
tid_agg_rx
->
h—d_£q_num
 +id_agg_rx->
buf_size
) %

4375 
IEEE80211_SN_MODULO
;

4376 
	`›“80211_»Ëa£_»Üd”_äames
(
¡a
->
sd©a
, 
tid_agg_rx
,

4377 
»Ëa£
, &
äames
);

4379 
tid_agg_rx
->
h—d_£q_num
 = 
s¢
;

4381 
	`›“80211_»Ëa£_»Üd”_äames
(
¡a
->
sd©a
, 
tid_agg_rx
, 
s¢
,

4382 &
äames
);

4387 
diff
 = (
tid_agg_rx
->
h—d_£q_num
 - 
s¢
è& 
IEEE80211_SN_MASK
;

4388 ià(
diff
 >ğ
tid_agg_rx
->
buf_size
) {

4389 
tid_agg_rx
->
»Üd”_buf_f‹»d
 = 0;

4390 
»Ëa£
;

4392 
f‹»d
 = f‹»d >> 
diff
;

4393 
s¢
 +ğ
diff
;

4396 
i
 = 0; i < 
tid_agg_rx
->
buf_size
; i++) {

4397 
šdex
 = (
s¢
 + 
i
è% 
tid_agg_rx
->
buf_size
;

4399 
tid_agg_rx
->
»Üd”_buf_f‹»d
 &ğ~
	`BIT_ULL
(
šdex
);

4400 ià(
f‹»d
 & 
	`BIT_ULL
(
i
))

4401 
tid_agg_rx
->
»Üd”_buf_f‹»d
 |ğ
	`BIT_ULL
(
šdex
);

4405 
	`›“80211_¡a_»Üd”_»Ëa£
(
¡a
->
sd©a
, 
tid_agg_rx
, &
äames
);

4407 
»Ëa£
:

4408 
	`¥š_uÆock_bh
(&
tid_agg_rx
->
»Üd”_lock
);

4410 
	`›“80211_rx_hªdËrs
(&
rx
, &
äames
);

4412 
out
:

4413 
	`rcu_»ad_uÆock
();

4414 
	}
}

4415 
EXPORT_SYMBOL
(
›“80211_m¬k_rx_ba_f‹»d_äames
);

4419 
šlše
 
	$›“80211_bssid_m©ch
(cÚ¡ 
u8
 *
¿ddr
, cÚ¡ u8 *
addr
)

4421  
	`‘h”_addr_equ®
(
¿ddr
, 
addr
) ||

4422 
	`is_brßdÿ¡_‘h”_addr
(
¿ddr
);

4423 
	}
}

4425 
boŞ
 
	$›“80211_acû±_äame
(
›“80211_rx_d©a
 *
rx
)

4427 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

4428 
sk_buff
 *
skb
 = 
rx
->skb;

4429 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

4430 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

4431 
u8
 *
bssid
 = 
	`›“80211_g‘_bssid
(
hdr
, 
skb
->
Ën
, 
sd©a
->
vif
.
ty³
);

4432 
boŞ
 
muÉiÿ¡
 = 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) ||

4433 
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
);

4435 
sd©a
->
vif
.
ty³
) {

4436 
NL80211_IFTYPE_STATION
:

4437 ià(!
bssid
 && !
sd©a
->
u
.
mgd
.
u£_4addr
)

4438  
çl£
;

4439 ià(
	`›“80211_is_fœ¡_äag
(
hdr
->
£q_ù¾
) &&

4440 
	`›“80211_is_robu¡_mgmt_äame
(
skb
è&& !
rx
->
¡a
)

4441  
çl£
;

4442 ià(
muÉiÿ¡
)

4443  
Œue
;

4444  
	`›“80211_is_our_addr
(
sd©a
, 
hdr
->
addr1
, &
rx
->
lšk_id
);

4445 
NL80211_IFTYPE_ADHOC
:

4446 ià(!
bssid
)

4447  
çl£
;

4448 ià(
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
hdr
->
addr2
) ||

4449 
	`‘h”_addr_equ®
(
sd©a
->
u
.
ibss
.
bssid
, 
hdr
->
addr2
) ||

4450 !
	`is_v®id_‘h”_addr
(
hdr
->
addr2
))

4451  
çl£
;

4452 ià(
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
))

4453  
Œue
;

4454 ià(!
	`›“80211_bssid_m©ch
(
bssid
, 
sd©a
->
u
.
ibss
.bssid))

4455  
çl£
;

4456 ià(!
muÉiÿ¡
 &&

4457 !
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
hdr
->
addr1
))

4458  
çl£
;

4459 ià(!
rx
->
¡a
) {

4460 
¿‹_idx
;

4461 ià(
¡©us
->
’codšg
 !ğ
RX_ENC_LEGACY
)

4462 
¿‹_idx
 = 0;

4464 
¿‹_idx
 = 
¡©us
->rate_idx;

4465 
	`›“80211_ibss_rx_no_¡a
(
sd©a
, 
bssid
, 
hdr
->
addr2
,

4466 
	`BIT
(
¿‹_idx
));

4468  
Œue
;

4469 
NL80211_IFTYPE_OCB
:

4470 ià(!
bssid
)

4471  
çl£
;

4472 ià(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

4473  
çl£
;

4474 ià(!
	`is_brßdÿ¡_‘h”_addr
(
bssid
))

4475  
çl£
;

4476 ià(!
muÉiÿ¡
 &&

4477 !
	`‘h”_addr_equ®
(
sd©a
->
dev
->
dev_addr
, 
hdr
->
addr1
))

4478  
çl£
;

4479 ià(!
rx
->
¡a
) {

4480 
¿‹_idx
;

4481 ià(
¡©us
->
’codšg
 !ğ
RX_ENC_LEGACY
)

4482 
¿‹_idx
 = 0;

4484 
¿‹_idx
 = 
¡©us
->rate_idx;

4485 
	`›“80211_ocb_rx_no_¡a
(
sd©a
, 
bssid
, 
hdr
->
addr2
,

4486 
	`BIT
(
¿‹_idx
));

4488  
Œue
;

4489 
NL80211_IFTYPE_MESH_POINT
:

4490 ià(
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
hdr
->
addr2
))

4491  
çl£
;

4492 ià(
muÉiÿ¡
)

4493  
Œue
;

4494  
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
hdr
->
addr1
);

4495 
NL80211_IFTYPE_AP_VLAN
:

4496 
NL80211_IFTYPE_AP
:

4497 ià(!
bssid
)

4498  
	`›“80211_is_our_addr
(
sd©a
, 
hdr
->
addr1
,

4499 &
rx
->
lšk_id
);

4501 ià(!
	`is_brßdÿ¡_‘h”_addr
(
bssid
) &&

4502 !
	`›“80211_is_our_addr
(
sd©a
, 
bssid
, 
NULL
)) {

4509 ià(!
muÉiÿ¡
 &&

4510 !
	`›“80211_is_our_addr
(
sd©a
, 
hdr
->
addr1
,

4511 &
rx
->
lšk_id
))

4512  
çl£
;

4513 ià(
	`›“80211_is_public_aùiÚ
(
hdr
, 
skb
->
Ën
))

4514  
Œue
;

4515  
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
);

4518 ià(!
	`›“80211_has_tods
(
hdr
->
äame_cÚŒŞ
)) {

4520 ià(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
))

4521  
çl£
;

4523 ià(
	`›“80211_is_aùiÚ
(
hdr
->
äame_cÚŒŞ
) &&

4524 !
	`is_brßdÿ¡_‘h”_addr
(
bssid
) &&

4525 !
	`‘h”_addr_equ®
(
bssid
, 
hdr
->
addr1
))

4526  
çl£
;

4546 ià(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
è&& 
muÉiÿ¡
)

4547  
çl£
;

4549  
Œue
;

4550 
NL80211_IFTYPE_P2P_DEVICE
:

4551  
	`›“80211_is_public_aùiÚ
(
hdr
, 
skb
->
Ën
) ||

4552 
	`›“80211_is_´obe_»q
(
hdr
->
äame_cÚŒŞ
) ||

4553 
	`›“80211_is_´obe_»¥
(
hdr
->
äame_cÚŒŞ
) ||

4554 
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
);

4555 
NL80211_IFTYPE_NAN
:

4557  
çl£
;

4562 
	`WARN_ON_ONCE
(1);

4563  
çl£
;

4564 
	}
}

4566 
	$›“80211_check_ç¡_rx
(
¡a_šfo
 *
¡a
)

4568 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

4569 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4570 
›“80211_key
 *
key
;

4571 
›“80211_ç¡_rx
 
ç¡rx
 = {

4572 .
dev
 = 
sd©a
->dev,

4573 .
vif_ty³
 = 
sd©a
->
vif
.
ty³
,

4574 .
cÚŒŞ_pÜt_´ÙocŞ
 = 
sd©a
->control_port_protocol,

4575 }, *
Şd
, *
Ãw
 = 
NULL
;

4576 
u32
 
ofæßd_æags
;

4577 
boŞ
 
£t_ofæßd
 = 
çl£
;

4578 
boŞ
 
assign
 = 
çl£
;

4579 
boŞ
 
ofæßd
;

4582 
	`__acquœe
(
check_ç¡_rx
);

4584 
	`BUILD_BUG_ON
((
ç¡rx
.
rfc1042_hdr
è!ğ(
rfc1042_h—d”
));

4585 
	`BUILD_BUG_ON
((
ç¡rx
.
rfc1042_hdr
è!ğ
ETH_ALEN
);

4586 
	`‘h”_addr_cİy
(
ç¡rx
.
rfc1042_hdr
, 
rfc1042_h—d”
);

4587 
	`‘h”_addr_cİy
(
ç¡rx
.
vif_addr
, 
sd©a
->
vif
.
addr
);

4589 
ç¡rx
.
u£s_rss
 = 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
USES_RSS
);

4592 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_AGGREGATION
) &&

4593 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_REORDERING_BUFFER
))

4594 
ş—r
;

4596 
sd©a
->
vif
.
ty³
) {

4597 
NL80211_IFTYPE_STATION
:

4598 ià(
¡a
->¡a.
tdls
) {

4599 
ç¡rx
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr1
);

4600 
ç¡rx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr2
);

4601 
ç¡rx
.
ex³ùed_ds_b™s
 = 0;

4603 
ç¡rx
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr1
);

4604 
ç¡rx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

4605 
ç¡rx
.
ex³ùed_ds_b™s
 =

4606 
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
);

4609 ià(
sd©a
->
u
.
mgd
.
u£_4addr
 && !
¡a
->¡a.
tdls
) {

4610 
ç¡rx
.
ex³ùed_ds_b™s
 |=

4611 
	`ıu_to_Ë16
(
IEEE80211_FCTL_TODS
);

4612 
ç¡rx
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

4613 
ç¡rx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr4
);

4616 ià(!
sd©a
->
u
.
mgd
.
pow”§ve
)

4620 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
PS_NULLFUNC_STACK
))

4621 
ş—r
;

4622 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_PS
) &&

4623 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
))

4624 
ş—r
;

4626 
NL80211_IFTYPE_AP_VLAN
:

4627 
NL80211_IFTYPE_AP
:

4631 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AP_LINK_PS
))

4632 
ş—r
;

4633 
ç¡rx
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

4634 
ç¡rx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr2
);

4635 
ç¡rx
.
ex³ùed_ds_b™s
 = 
	`ıu_to_Ë16
(
IEEE80211_FCTL_TODS
);

4637 
ç¡rx
.
š‹º®_fÜw¬d
 =

4638 !(
sd©a
->
æags
 & 
IEEE80211_SDATA_DONT_BRIDGE_PACKETS
) &&

4639 (
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 ||

4640 !
sd©a
->
u
.
vÏn
.
¡a
);

4642 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

4643 
sd©a
->
u
.
vÏn
.
¡a
) {

4644 
ç¡rx
.
ex³ùed_ds_b™s
 |=

4645 
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
);

4646 
ç¡rx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr4
);

4647 
ç¡rx
.
š‹º®_fÜw¬d
 = 0;

4651 
NL80211_IFTYPE_MESH_POINT
:

4652 
ç¡rx
.
ex³ùed_ds_b™s
 = 
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 |

4653 
IEEE80211_FCTL_TODS
);

4654 
ç¡rx
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

4655 
ç¡rx
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr4
);

4658 
ş—r
;

4661 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

4662 
ş—r
;

4664 
	`rcu_»ad_lock
();

4665 
key
 = 
	`rcu_d”eã»nû
(
¡a
->
±k
[¡a->
±k_idx
]);

4666 ià(!
key
)

4667 
key
 = 
	`rcu_d”eã»nû
(
sd©a
->
deçuÉ_uniÿ¡_key
);

4668 ià(
key
) {

4669 
key
->
cÚf
.
ch”
) {

4670 
WLAN_CIPHER_SUITE_TKIP
:

4672 
ş—r_rcu
;

4673 
WLAN_CIPHER_SUITE_CCMP
:

4674 
WLAN_CIPHER_SUITE_CCMP_256
:

4675 
WLAN_CIPHER_SUITE_GCMP
:

4676 
WLAN_CIPHER_SUITE_GCMP_256
:

4682 
ş—r_rcu
;

4685 
ç¡rx
.
key
 = 
Œue
;

4686 
ç¡rx
.
icv_Ën
 = 
key
->
cÚf
.icv_len;

4689 
assign
 = 
Œue
;

4690 
ş—r_rcu
:

4691 
	`rcu_»ad_uÆock
();

4692 
ş—r
:

4693 
	`__»Ëa£
(
check_ç¡_rx
);

4695 ià(
assign
)

4696 
Ãw
 = 
	`kmemdup
(&
ç¡rx
, (ç¡rx), 
GFP_KERNEL
);

4698 
ofæßd_æags
 = 
	`g‘_bss_sd©a
(
sd©a
)->
vif
.offload_flags;

4699 
ofæßd
 = 
ofæßd_æags
 & 
IEEE80211_OFFLOAD_DECAP_ENABLED
;

4701 ià(
assign
 && 
ofæßd
)

4702 
£t_ofæßd
 = !
	`‹¡_ªd_£t_¡a_æag
(
¡a
, 
WLAN_STA_DECAP_OFFLOAD
);

4704 
£t_ofæßd
 = 
	`‹¡_ªd_ş—r_¡a_æag
(
¡a
, 
WLAN_STA_DECAP_OFFLOAD
);

4706 ià(
£t_ofæßd
)

4707 
	`drv_¡a_£t_deÿp_ofæßd
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
assign
);

4709 
	`¥š_lock_bh
(&
¡a
->
lock
);

4710 
Şd
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
ç¡_rx
, 
Œue
);

4711 
	`rcu_assign_poš‹r
(
¡a
->
ç¡_rx
, 
Ãw
);

4712 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

4714 ià(
Şd
)

4715 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

4716 
	}
}

4718 
	$›“80211_ş—r_ç¡_rx
(
¡a_šfo
 *
¡a
)

4720 
›“80211_ç¡_rx
 *
Şd
;

4722 
	`¥š_lock_bh
(&
¡a
->
lock
);

4723 
Şd
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
ç¡_rx
, 
Œue
);

4724 
	`RCU_INIT_POINTER
(
¡a
->
ç¡_rx
, 
NULL
);

4725 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

4727 ià(
Şd
)

4728 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

4729 
	}
}

4731 
	$__›“80211_check_ç¡_rx_içû
(
›“80211_sub_if_d©a
 *
sd©a
)

4733 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4734 
¡a_šfo
 *
¡a
;

4736 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4738 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

4739 ià(
sd©a
 !ğ
¡a
->sdata &&

4740 (!
¡a
->
sd©a
->
bss
 || sta->sdata->bss != sdata->bss))

4742 
	`›“80211_check_ç¡_rx
(
¡a
);

4744 
	}
}

4746 
	$›“80211_check_ç¡_rx_içû
(
›“80211_sub_if_d©a
 *
sd©a
)

4748 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4750 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4752 
	`__›“80211_check_ç¡_rx_içû
(
sd©a
);

4753 
	}
}

4755 
	$›“80211_rx_8023
(
›“80211_rx_d©a
 *
rx
,

4756 
›“80211_ç¡_rx
 *
ç¡_rx
,

4757 
Üig_Ën
)

4759 
›“80211_¡a_rx_¡©s
 *
¡©s
;

4760 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
->
skb
);

4761 
¡a_šfo
 *
¡a
 = 
rx
->sta;

4762 
lšk_¡a_šfo
 *
lšk_¡a
;

4763 
sk_buff
 *
skb
 = 
rx
->skb;

4764 *
§
 = 
skb
->
d©a
 + 
ETH_ALEN
;

4765 *
da
 = 
skb
->
d©a
;

4767 ià(
rx
->
lšk_id
 >= 0) {

4768 
lšk_¡a
 = 
	`rcu_d”eã»nû
(
¡a
->
lšk
[
rx
->
lšk_id
]);

4769 ià(
	`WARN_ON_ONCE
(!
lšk_¡a
)) {

4770 
	`dev_kä“_skb
(
rx
->
skb
);

4774 
lšk_¡a
 = &
¡a
->
deæšk
;

4777 
¡©s
 = &
lšk_¡a
->
rx_¡©s
;

4778 ià(
ç¡_rx
->
u£s_rss
)

4779 
¡©s
 = 
	`this_ıu_±r
(
lšk_¡a
->
pıu_rx_¡©s
);

4782 ià(!(
¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
)) {

4783 
¡©s
->
Ï¡_sigÇl
 = 
¡©us
->
sigÇl
;

4784 ià(!
ç¡_rx
->
u£s_rss
)

4785 
	`ewma_sigÇl_add
(&
lšk_¡a
->
rx_¡©s_avg
.
sigÇl
,

4786 -
¡©us
->
sigÇl
);

4789 ià(
¡©us
->
chašs
) {

4790 
i
;

4792 
¡©s
->
chašs
 = 
¡©us
->chains;

4793 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡©us
->
chaš_sigÇl
); i++) {

4794 
sigÇl
 = 
¡©us
->
chaš_sigÇl
[
i
];

4796 ià(!(
¡©us
->
chašs
 & 
	`BIT
(
i
)))

4799 
¡©s
->
chaš_sigÇl_Ï¡
[
i
] = 
sigÇl
;

4800 ià(!
ç¡_rx
->
u£s_rss
)

4801 
	`ewma_sigÇl_add
(&
lšk_¡a
->
rx_¡©s_avg
.
chaš_sigÇl
[
i
],

4802 -
sigÇl
);

4807 
¡©s
->
Ï¡_rx
 = 
jiff›s
;

4808 
¡©s
->
Ï¡_¿‹
 = 
	`¡a_¡©s_’code_¿‹
(
¡©us
);

4810 
¡©s
->
äagm’ts
++;

4811 
¡©s
->
·ck‘s
++;

4813 
skb
->
dev
 = 
ç¡_rx
->dev;

4815 
	`dev_sw_Ãt¡©s_rx_add
(
ç¡_rx
->
dev
, 
skb
->
Ën
);

4822 
	`u64_¡©s_upd©e_begš
(&
¡©s
->
synı
);

4823 
¡©s
->
msdu
[
rx
->
£qno_idx
]++;

4824 
¡©s
->
by‹s
 +ğ
Üig_Ën
;

4825 
	`u64_¡©s_upd©e_’d
(&
¡©s
->
synı
);

4827 ià(
ç¡_rx
->
š‹º®_fÜw¬d
) {

4828 
sk_buff
 *
xm™_skb
 = 
NULL
;

4829 ià(
	`is_muÉiÿ¡_‘h”_addr
(
da
)) {

4830 
xm™_skb
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

4831 } ià(!
	`‘h”_addr_equ®
(
da
, 
§
) &&

4832 
	`¡a_šfo_g‘
(
rx
->
sd©a
, 
da
)) {

4833 
xm™_skb
 = 
skb
;

4834 
skb
 = 
NULL
;

4837 ià(
xm™_skb
) {

4843 
xm™_skb
->
´iÜ™y
 += 256;

4844 
xm™_skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_3
);

4845 
	`skb_»£t_ÃtwÜk_h—d”
(
xm™_skb
);

4846 
	`skb_»£t_mac_h—d”
(
xm™_skb
);

4847 
	`dev_queue_xm™
(
xm™_skb
);

4850 ià(!
skb
)

4855 
skb
->
´ÙocŞ
 = 
	`‘h_ty³_Œªs
(skb, 
ç¡_rx
->
dev
);

4856 
	`›“80211_d–iv”_skb_to_loÿl_¡ack
(
skb
, 
rx
);

4857 
	}
}

4859 
boŞ
 
	$›“80211_švoke_ç¡_rx
(
›“80211_rx_d©a
 *
rx
,

4860 
›“80211_ç¡_rx
 *
ç¡_rx
)

4862 
sk_buff
 *
skb
 = 
rx
->skb;

4863 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

4864 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

4865 
›“80211_rx_»suÉ
 
»s
;

4866 
Üig_Ën
 = 
skb
->
Ën
;

4867 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

4868 
¢­_offs
 = 
hd¾’
;

4870 
u8
 
¢­
[(
rfc1042_h—d”
)];

4871 
__be16
 
´Ùo
;

4872 } *
·ylßd
 
	`__®igÃd
(2);

4874 
u8
 
da
[
ETH_ALEN
];

4875 
u8
 
§
[
ETH_ALEN
];

4876 } 
addrs
 
	`__®igÃd
(2);

4877 
›“80211_¡a_rx_¡©s
 *
¡©s
;

4883 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DUP_VALIDATED
))

4884  
çl£
;

4886 
	#FAST_RX_CRYPT_FLAGS
 (
RX_FLAG_PN_VALIDATED
 | 
RX_FLAG_DECRYPTED
)

	)

4892 ià(
ç¡_rx
->
key
 &&

4893 (
¡©us
->
æag
 & 
FAST_RX_CRYPT_FLAGS
) != FAST_RX_CRYPT_FLAGS)

4894  
çl£
;

4896 ià(
	`uÆik–y
(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
)))

4897  
çl£
;

4899 ià(
	`uÆik–y
(
	`›“80211_is_äag
(
hdr
)))

4900  
çl£
;

4911 ià(!
	`‘h”_addr_equ®
(
ç¡_rx
->
vif_addr
, 
hdr
->
addr1
))

4912  
çl£
;

4914 ià((
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 |

4915 
IEEE80211_FCTL_TODS
)) !=

4916 
ç¡_rx
->
ex³ùed_ds_b™s
)

4917  
çl£
;

4922 ià(
ç¡_rx
->
key
 && !(
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
)) {

4924 
¢­_offs
 +ğ
IEEE80211_CCMP_HDR_LEN
;

4927 ià(!
	`›“80211_vif_is_mesh
(&
rx
->
sd©a
->
vif
) &&

4928 !(
¡©us
->
rx_æags
 & 
IEEE80211_RX_AMSDU
)) {

4929 ià(!
	`pskb_may_puÎ
(
skb
, 
¢­_offs
 + (*
·ylßd
)))

4930  
çl£
;

4932 
·ylßd
 = (*)(
skb
->
d©a
 + 
¢­_offs
);

4934 ià(!
	`‘h”_addr_equ®
(
·ylßd
->
¢­
, 
ç¡_rx
->
rfc1042_hdr
))

4935  
çl£
;

4942 ià(
	`uÆik–y
(
·ylßd
->
´Ùo
 =ğ
	`ıu_to_be16
(
ETH_P_TDLS
) ||

4943 
·ylßd
->
´Ùo
 =ğ
ç¡_rx
->
cÚŒŞ_pÜt_´ÙocŞ
))

4944  
çl£
;

4949 ià(
rx
->
key
 && !(
¡©us
->
æag
 & 
RX_FLAG_MIC_STRIPPED
) &&

4950 
	`pskb_Œim
(
skb
, skb->
Ën
 - 
ç¡_rx
->
icv_Ën
))

4951 
drİ
;

4953 ià(
rx
->
key
 && !
	`›“80211_has_´Ùeùed
(
hdr
->
äame_cÚŒŞ
))

4954 
drİ
;

4956 ià(
¡©us
->
rx_æags
 & 
IEEE80211_RX_AMSDU
) {

4957 ià(
	`__›“80211_rx_h_amsdu
(
rx
, 
¢­_offs
 - 
hd¾’
) !=

4958 
RX_QUEUED
)

4959 
drİ
;

4961  
Œue
;

4965 
	`‘h”_addr_cİy
(
addrs
.
da
, 
skb
->
d©a
 + 
ç¡_rx
->
da_offs
);

4966 
	`‘h”_addr_cİy
(
addrs
.
§
, 
skb
->
d©a
 + 
ç¡_rx
->
§_offs
);

4967 ià(
	`›“80211_vif_is_mesh
(&
rx
->
sd©a
->
vif
)) {

4968 
	`skb_puÎ
(
skb
, 
¢­_offs
 - 2);

4969 
	`put_uÇligÃd_be16
(
skb
->
Ën
 - 2, skb->
d©a
);

4971 
	`skb_po¡puÎ_rcsum
(
skb
, skb->
d©a
 + 
¢­_offs
,

4972 (
rfc1042_h—d”
) + 2);

4975 
	`skb_puÎ
(
skb
, 
¢­_offs
 + (
rfc1042_h—d”
));

4978 
	`memıy
(
	`skb_push
(
skb
, (
addrs
)), &addrs, (addrs));

4980 
»s
 = 
	`›“80211_rx_mesh_d©a
(
rx
->
sd©a
,„x->
¡a
,„x->
skb
);

4981 
»s
) {

4982 
RX_QUEUED
:

4983  
Œue
;

4984 
RX_CONTINUE
:

4987 
drİ
;

4990 
	`›“80211_rx_8023
(
rx
, 
ç¡_rx
, 
Üig_Ën
);

4992  
Œue
;

4993 
drİ
:

4994 
	`dev_kä“_skb
(
skb
);

4996 ià(
ç¡_rx
->
u£s_rss
)

4997 
¡©s
 = 
	`this_ıu_±r
(
rx
->
lšk_¡a
->
pıu_rx_¡©s
);

4999 
¡©s
 = &
rx
->
lšk_¡a
->
rx_¡©s
;

5001 
¡©s
->
drİ³d
++;

5002  
Œue
;

5003 
	}
}

5011 
boŞ
 
	$›“80211_´•¬e_ªd_rx_hªdË
(
›“80211_rx_d©a
 *
rx
,

5012 
sk_buff
 *
skb
, 
boŞ
 
cÚsume
)

5014 
›“80211_loÿl
 *
loÿl
 = 
rx
->local;

5015 
›“80211_sub_if_d©a
 *
sd©a
 = 
rx
->sdata;

5016 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

5017 
lšk_¡a_šfo
 *
lšk_¡a
 = 
rx
->link_sta;

5018 
›“80211_lšk_d©a
 *
lšk
 = 
rx
->link;

5020 
rx
->
skb
 = skb;

5029 ià(
cÚsume
 && 
rx
->
¡a
) {

5030 
›“80211_ç¡_rx
 *
ç¡_rx
;

5032 
ç¡_rx
 = 
	`rcu_d”eã»nû
(
rx
->
¡a
->fast_rx);

5033 ià(
ç¡_rx
 && 
	`›“80211_švoke_ç¡_rx
(
rx
, fast_rx))

5034  
Œue
;

5037 ià(!
	`›“80211_acû±_äame
(
rx
))

5038  
çl£
;

5040 ià(!
cÚsume
) {

5041 
skb_sh¬ed_hwt¡amps
 *
shwt
;

5043 
rx
->
skb
 = 
	`skb_cİy
(skb, 
GFP_ATOMIC
);

5044 ià(!
rx
->
skb
) {

5045 ià(
	`Ãt_¿‹lim™
())

5046 
	`why_debug
(
loÿl
->
hw
.
why
,

5048 
sd©a
->
Çme
);

5049  
Œue
;

5055 
shwt
 = 
	`skb_hwt¡amps
(
rx
->
skb
);

5056 
shwt
->
hwt¡amp
 = 
	`skb_hwt¡amps
(
skb
)->hwtstamp;

5059 
hdr
 = (
›“80211_hdr
 *)
rx
->
skb
->
d©a
;

5062 ià(
	`uÆik–y
(
rx
->
¡a
 &&„x->¡a->¡a.
mlo
) &&

5063 
	`is_uniÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

5064 !
	`›“80211_is_´obe_»¥
(
hdr
->
äame_cÚŒŞ
) &&

5065 !
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
)) {

5067 ià(
	`‘h”_addr_equ®
(
lšk
->
cÚf
->
addr
, 
hdr
->
addr1
))

5068 
	`‘h”_addr_cİy
(
hdr
->
addr1
, 
rx
->
sd©a
->
vif
.
addr
);

5069 ià(
	`‘h”_addr_equ®
(
lšk_¡a
->
addr
, 
hdr
->
addr2
))

5070 
	`‘h”_addr_cİy
(
hdr
->
addr2
, 
rx
->
¡a
->
addr
);

5072 ià(!
	`›“80211_has_tods
(
hdr
->
äame_cÚŒŞ
) &&

5073 !
	`›“80211_has_äomds
(
hdr
->
äame_cÚŒŞ
)) {

5074 ià(
	`‘h”_addr_equ®
(
lšk_¡a
->
addr
, 
hdr
->
addr3
))

5075 
	`‘h”_addr_cİy
(
hdr
->
addr3
, 
rx
->
¡a
->
addr
);

5076 ià(
	`‘h”_addr_equ®
(
lšk
->
cÚf
->
addr
, 
hdr
->
addr3
))

5077 
	`‘h”_addr_cİy
(
hdr
->
addr3
, 
rx
->
sd©a
->
vif
.
addr
);

5082 
	`›“80211_švoke_rx_hªdËrs
(
rx
);

5083  
Œue
;

5084 
	}
}

5086 
	$__›“80211_rx_hªdË_8023
(
›“80211_hw
 *
hw
,

5087 
›“80211_¡a
 *
pub¡a
,

5088 
sk_buff
 *
skb
,

5089 
li¡_h—d
 *
li¡
)

5091 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5092 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

5093 
›“80211_ç¡_rx
 *
ç¡_rx
;

5094 
›“80211_rx_d©a
 
rx
;

5095 
¡a_šfo
 *
¡a
;

5096 
lšk_id
 = -1;

5098 
	`mem£t
(&
rx
, 0, (rx));

5099 
rx
.
skb
 = skb;

5100 
rx
.
loÿl
 =†ocal;

5101 
rx
.
li¡
 =†ist;

5102 
rx
.
lšk_id
 = -1;

5104 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11ReûivedF¿gm’tCouÁ
);

5107 ià(
skb
->
Ën
 < (
‘hhdr
))

5108 
drİ
;

5110 ià(!
pub¡a
)

5111 
drİ
;

5113 ià(
¡©us
->
lšk_v®id
)

5114 
lšk_id
 = 
¡©us
->link_id;

5123 
¡a
 = 
	`cÚš”_of
(
pub¡a
, 
¡a_šfo
, sta);

5124 ià(!
	`›“80211_rx_d©a_£t_¡a
(&
rx
, 
¡a
, 
lšk_id
))

5125 
drİ
;

5127 
ç¡_rx
 = 
	`rcu_d”eã»nû
(
rx
.
¡a
->fast_rx);

5128 ià(!
ç¡_rx
)

5129 
drİ
;

5131 
	`›“80211_rx_8023
(&
rx
, 
ç¡_rx
, 
skb
->
Ën
);

5134 
drİ
:

5135 
	`dev_kä“_skb
(
skb
);

5136 
	}
}

5138 
boŞ
 
	$›“80211_rx_fÜ_š‹rçû
(
›“80211_rx_d©a
 *
rx
,

5139 
sk_buff
 *
skb
, 
boŞ
 
cÚsume
)

5141 
lšk_¡a_šfo
 *
lšk_¡a
;

5142 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

5143 
¡a_šfo
 *
¡a
;

5144 
lšk_id
 = -1;

5152 
lšk_¡a
 = 
	`lšk_¡a_šfo_g‘_bss
(
rx
->
sd©a
, 
hdr
->
addr2
);

5153 ià(
lšk_¡a
) {

5154 
¡a
 = 
lšk_¡a
->sta;

5155 
lšk_id
 = 
lšk_¡a
->link_id;

5157 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

5159 
¡a
 = 
	`¡a_šfo_g‘_bss
(
rx
->
sd©a
, 
hdr
->
addr2
);

5160 ià(
¡©us
->
lšk_v®id
)

5161 
lšk_id
 = 
¡©us
->link_id;

5164 ià(!
	`›“80211_rx_d©a_£t_¡a
(
rx
, 
¡a
, 
lšk_id
))

5165  
çl£
;

5167  
	`›“80211_´•¬e_ªd_rx_hªdË
(
rx
, 
skb
, 
cÚsume
);

5168 
	}
}

5174 
	$__›“80211_rx_hªdË_·ck‘
(
›“80211_hw
 *
hw
,

5175 
›“80211_¡a
 *
pub¡a
,

5176 
sk_buff
 *
skb
,

5177 
li¡_h—d
 *
li¡
)

5179 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5180 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

5181 
›“80211_sub_if_d©a
 *
sd©a
;

5182 
›“80211_hdr
 *
hdr
;

5183 
__Ë16
 
fc
;

5184 
›“80211_rx_d©a
 
rx
;

5185 
›“80211_sub_if_d©a
 *
´ev
;

5186 
rhli¡_h—d
 *
tmp
;

5187 
”r
 = 0;

5189 
fc
 = ((
›“80211_hdr
 *)
skb
->
d©a
)->
äame_cÚŒŞ
;

5190 
	`mem£t
(&
rx
, 0, (rx));

5191 
rx
.
skb
 = skb;

5192 
rx
.
loÿl
 =†ocal;

5193 
rx
.
li¡
 =†ist;

5194 
rx
.
lšk_id
 = -1;

5196 ià(
	`›“80211_is_d©a
(
fc
è|| 
	`›“80211_is_mgmt
(fc))

5197 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11ReûivedF¿gm’tCouÁ
);

5199 ià(
	`›“80211_is_mgmt
(
fc
)) {

5201 ià(
skb
->
Ën
 < 
	`›“80211_hd¾’
(
fc
))

5202 
”r
 = -
ENOBUFS
;

5204 
”r
 = 
	`skb_lš—rize
(
skb
);

5206 
”r
 = !
	`pskb_may_puÎ
(
skb
, 
	`›“80211_hd¾’
(
fc
));

5209 ià(
”r
) {

5210 
	`dev_kä“_skb
(
skb
);

5214 
hdr
 = (
›“80211_hdr
 *)
skb
->
d©a
;

5215 
	`›“80211_·r£_qos
(&
rx
);

5216 
	`›“80211_v”ify_®ignm’t
(&
rx
);

5218 ià(
	`uÆik–y
(
	`›“80211_is_´obe_»¥
(
hdr
->
äame_cÚŒŞ
) ||

5219 
	`›“80211_is_b—cÚ
(
hdr
->
äame_cÚŒŞ
) ||

5220 
	`›“80211_is_s1g_b—cÚ
(
hdr
->
äame_cÚŒŞ
)))

5221 
	`›“80211_sÿn_rx
(
loÿl
, 
skb
);

5223 ià(
	`›“80211_is_d©a
(
fc
)) {

5224 
¡a_šfo
 *
¡a
, *
´ev_¡a
;

5225 
lšk_id
 = -1;

5227 ià(
¡©us
->
lšk_v®id
)

5228 
lšk_id
 = 
¡©us
->link_id;

5230 ià(
pub¡a
) {

5231 
¡a
 = 
	`cÚš”_of
(
pub¡a
, 
¡a_šfo
, sta);

5232 ià(!
	`›“80211_rx_d©a_£t_¡a
(&
rx
, 
¡a
, 
lšk_id
))

5233 
out
;

5243 ià(!
¡©us
->
lšk_v®id
 && 
pub¡a
->
mlo
) {

5244 
lšk_¡a_šfo
 *
lšk_¡a
;

5246 
lšk_¡a
 = 
	`lšk_¡a_šfo_g‘_bss
(
rx
.
sd©a
,

5247 
hdr
->
addr2
);

5248 ià(!
lšk_¡a
)

5249 
out
;

5251 
	`›“80211_rx_d©a_£t_lšk
(&
rx
, 
lšk_¡a
->
lšk_id
);

5254 ià(
	`›“80211_´•¬e_ªd_rx_hªdË
(&
rx
, 
skb
, 
Œue
))

5256 
out
;

5259 
´ev_¡a
 = 
NULL
;

5261 
	`fÜ_—ch_¡a_šfo
(
loÿl
, 
hdr
->
addr2
, 
¡a
, 
tmp
) {

5262 ià(!
´ev_¡a
) {

5263 
´ev_¡a
 = 
¡a
;

5267 
rx
.
sd©a
 = 
´ev_¡a
->sdata;

5268 ià(!
	`›“80211_rx_d©a_£t_¡a
(&
rx
, 
´ev_¡a
, 
lšk_id
))

5269 
out
;

5271 ià(!
¡©us
->
lšk_v®id
 && 
´ev_¡a
->
¡a
.
mlo
)

5274 
	`›“80211_´•¬e_ªd_rx_hªdË
(&
rx
, 
skb
, 
çl£
);

5276 
´ev_¡a
 = 
¡a
;

5279 ià(
´ev_¡a
) {

5280 
rx
.
sd©a
 = 
´ev_¡a
->sdata;

5281 ià(!
	`›“80211_rx_d©a_£t_¡a
(&
rx
, 
´ev_¡a
, 
lšk_id
))

5282 
out
;

5284 ià(!
¡©us
->
lšk_v®id
 && 
´ev_¡a
->
¡a
.
mlo
)

5285 
out
;

5287 ià(
	`›“80211_´•¬e_ªd_rx_hªdË
(&
rx
, 
skb
, 
Œue
))

5289 
out
;

5293 
´ev
 = 
NULL
;

5295 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

5296 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

5299 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 ||

5300 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

5309 ià(!
´ev
) {

5310 
´ev
 = 
sd©a
;

5314 
rx
.
sd©a
 = 
´ev
;

5315 
	`›“80211_rx_fÜ_š‹rçû
(&
rx
, 
skb
, 
çl£
);

5317 
´ev
 = 
sd©a
;

5320 ià(
´ev
) {

5321 
rx
.
sd©a
 = 
´ev
;

5323 ià(
	`›“80211_rx_fÜ_š‹rçû
(&
rx
, 
skb
, 
Œue
))

5327 
out
:

5328 
	`dev_kä“_skb
(
skb
);

5329 
	}
}

5335 
	$›“80211_rx_li¡
(
›“80211_hw
 *
hw
, 
›“80211_¡a
 *
pub¡a
,

5336 
sk_buff
 *
skb
, 
li¡_h—d
 *
li¡
)

5338 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5339 
›“80211_¿‹
 *
¿‹
 = 
NULL
;

5340 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

5341 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

5342 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

5344 
	`WARN_ON_ONCE
(
	`soáœq_couÁ
() == 0);

5346 ià(
	`WARN_ON
(
¡©us
->
bªd
 >ğ
NUM_NL80211_BANDS
))

5347 
drİ
;

5349 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
¡©us
->
bªd
];

5350 ià(
	`WARN_ON
(!
sbªd
))

5351 
drİ
;

5360 ià(
	`uÆik–y
(
loÿl
->
qu›scšg
 ||†oÿl->
su¥’ded
))

5361 
drİ
;

5364 ià(
	`uÆik–y
(
loÿl
->
š_»cÚfig
))

5365 
drİ
;

5371 ià(
	`WARN_ON
(!
loÿl
->
¡¬‹d
))

5372 
drİ
;

5374 ià(
	`lik–y
(!(
¡©us
->
æag
 & 
RX_FLAG_FAILED_PLCP_CRC
))) {

5380 
¡©us
->
’codšg
) {

5381 
RX_ENC_HT
:

5392 ià(
	`WARN
(
¡©us
->
¿‹_idx
 > 76,

5396 
¡©us
->
¿‹_idx
,

5397 
¡©us
->
¿‹_idx
))

5398 
drİ
;

5400 
RX_ENC_VHT
:

5401 ià(
	`WARN_ONCE
(
¡©us
->
¿‹_idx
 > 11 ||

5402 !
¡©us
->
nss
 ||

5403 
¡©us
->
nss
 > 8,

5405 
¡©us
->
¿‹_idx
, stus->
nss
))

5406 
drİ
;

5408 
RX_ENC_HE
:

5409 ià(
	`WARN_ONCE
(
¡©us
->
¿‹_idx
 > 11 ||

5410 !
¡©us
->
nss
 ||

5411 
¡©us
->
nss
 > 8,

5413 
¡©us
->
¿‹_idx
, stus->
nss
))

5414 
drİ
;

5416 
RX_ENC_EHT
:

5417 ià(
	`WARN_ONCE
(
¡©us
->
¿‹_idx
 > 15 ||

5418 !
¡©us
->
nss
 ||

5419 
¡©us
->
nss
 > 8 ||

5420 
¡©us
->
eht
.
gi
 > 
NL80211_RATE_INFO_EHT_GI_3_2
,

5422 
¡©us
->
¿‹_idx
, stus->
nss
, stus->
eht
.
gi
))

5423 
drİ
;

5426 
	`WARN_ON_ONCE
(1);

5427 
çÎthrough
;

5428 
RX_ENC_LEGACY
:

5429 ià(
	`WARN_ON
(
¡©us
->
¿‹_idx
 >ğ
sbªd
->
n_b™¿‹s
))

5430 
drİ
;

5431 
¿‹
 = &
sbªd
->
b™¿‹s
[
¡©us
->
¿‹_idx
];

5435 ià(
	`WARN_ON_ONCE
(
¡©us
->
lšk_id
 >ğ
IEEE80211_LINK_UNSPECIFIED
))

5436 
drİ
;

5438 
¡©us
->
rx_æags
 = 0;

5440 
	`kcov_»mÙe_¡¬t_commÚ
(
	`skb_g‘_kcov_hªdË
(
skb
));

5448 ià(!(
¡©us
->
æag
 & 
RX_FLAG_8023
))

5449 
skb
 = 
	`›“80211_rx_mÚ™Ü
(
loÿl
, skb, 
¿‹
);

5450 ià(
skb
) {

5451 ià((
¡©us
->
æag
 & 
RX_FLAG_8023
) ||

5452 
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

5453 
	`›“80211_t_Ëd_Œig_rx
(
loÿl
, 
skb
->
Ën
);

5455 ià(
¡©us
->
æag
 & 
RX_FLAG_8023
)

5456 
	`__›“80211_rx_hªdË_8023
(
hw
, 
pub¡a
, 
skb
, 
li¡
);

5458 
	`__›“80211_rx_hªdË_·ck‘
(
hw
, 
pub¡a
, 
skb
, 
li¡
);

5461 
	`kcov_»mÙe_¡İ
();

5463 
drİ
:

5464 
	`kä“_skb
(
skb
);

5465 
	}
}

5466 
EXPORT_SYMBOL
(
›“80211_rx_li¡
);

5468 
	$›“80211_rx_Çpi
(
›“80211_hw
 *
hw
, 
›“80211_¡a
 *
pub¡a
,

5469 
sk_buff
 *
skb
, 
Çpi_¡ruù
 *
Çpi
)

5471 
sk_buff
 *
tmp
;

5472 
	`LIST_HEAD
(
li¡
);

5480 
	`rcu_»ad_lock
();

5481 
	`›“80211_rx_li¡
(
hw
, 
pub¡a
, 
skb
, &
li¡
);

5482 
	`rcu_»ad_uÆock
();

5484 ià(!
Çpi
) {

5485 
	`Ãtif_»ûive_skb_li¡
(&
li¡
);

5489 
	`li¡_fÜ_—ch_’Œy_§ã
(
skb
, 
tmp
, &
li¡
,†ist) {

5490 
	`skb_li¡_d–_š™
(
skb
);

5491 
	`Çpi_gro_»ûive
(
Çpi
, 
skb
);

5493 
	}
}

5494 
EXPORT_SYMBOL
(
›“80211_rx_Çpi
);

5498 
	$›“80211_rx_œq§ã
(
›“80211_hw
 *
hw
, 
sk_buff
 *
skb
)

5500 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5502 
	`BUILD_BUG_ON
((
›“80211_rx_¡©us
è> (
skb
->
cb
));

5504 
skb
->
pkt_ty³
 = 
IEEE80211_RX_MSG
;

5505 
	`skb_queue_
(&
loÿl
->
skb_queue
, 
skb
);

5506 
	`skËt_scheduË
(&
loÿl
->
skËt
);

5507 
	}
}

5508 
EXPORT_SYMBOL
(
›“80211_rx_œq§ã
);

	@s1g.c

7 
	~<lšux/›“80211.h
>

8 
	~<Ãt/mac80211.h
>

9 
	~"›“80211_i.h
"

10 
	~"driv”-İs.h
"

12 
	$›“80211_s1g_¡a_¿‹_š™
(
¡a_šfo
 *
¡a
)

15 
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
.
æags
 |ğ
IEEE80211_TX_RC_S1G_MCS
;

16 
¡a
->
deæšk
.
rx_¡©s
.
Ï¡_¿‹
 =

17 
	`STA_STATS_FIELD
(
TYPE
, 
STA_STATS_RATE_TYPE_S1G
);

18 
	}
}

20 
boŞ
 
	$›“80211_s1g_is_twt_£tup
(
sk_buff
 *
skb
)

22 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*)
skb
->
d©a
;

24 ià(
	`lik–y
(!
	`›“80211_is_aùiÚ
(
mgmt
->
äame_cÚŒŞ
)))

25  
çl£
;

27 ià(
	`lik–y
(
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 !ğ
WLAN_CATEGORY_S1G
))

28  
çl£
;

30  
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
 =ğ
WLAN_S1G_TWT_SETUP
;

31 
	}
}

34 
	$›“80211_s1g_£nd_twt_£tup
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
da
,

35 cÚ¡ 
u8
 *
bssid
, 
›“80211_twt_£tup
 *
twt
)

37 
Ën
 = 
IEEE80211_MIN_ACTION_SIZE
 + 4 + 
twt
->
Ëngth
;

38 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

39 
›“80211_mgmt
 *
mgmt
;

40 
sk_buff
 *
skb
;

42 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
Ën
);

43 ià(!
skb
)

46 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

47 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
Ën
);

48 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

49 
IEEE80211_STYPE_ACTION
);

50 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

51 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

52 
	`memıy
(
mgmt
->
bssid
, bssid, 
ETH_ALEN
);

54 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_S1G
;

55 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
 = 
WLAN_S1G_TWT_SETUP
;

56 
	`memıy
(
mgmt
->
u
.
aùiÚ
.u.
s1g
.
v¬ŸbË
, 
twt
, 3 +wt->
Ëngth
);

58 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
 |

59 
IEEE80211_TX_INTFL_MLME_CONN_TX
 |

60 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

61 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

62 
	}
}

65 
	$›“80211_s1g_£nd_twt_‹¬down
(
›“80211_sub_if_d©a
 *
sd©a
,

66 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
bssid
, u8 
æowid
)

68 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

69 
›“80211_mgmt
 *
mgmt
;

70 
sk_buff
 *
skb
;

71 
u8
 *
id
;

73 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 +

74 
IEEE80211_MIN_ACTION_SIZE
 + 2);

75 ià(!
skb
)

78 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

79 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
IEEE80211_MIN_ACTION_SIZE
 + 2);

80 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

81 
IEEE80211_STYPE_ACTION
);

82 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

83 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

84 
	`memıy
(
mgmt
->
bssid
, bssid, 
ETH_ALEN
);

86 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_S1G
;

87 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
 = 
WLAN_S1G_TWT_TEARDOWN
;

88 
id
 = (
u8
 *)
mgmt
->
u
.
aùiÚ
.u.
s1g
.
v¬ŸbË
;

89 *
id
 = 
æowid
;

91 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
 |

92 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

93 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

94 
	}
}

97 
	$›“80211_s1g_rx_twt_£tup
(
›“80211_sub_if_d©a
 *
sd©a
,

98 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

100 
›“80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

101 
›“80211_twt_£tup
 *
twt
 = (*)
mgmt
->
u
.
aùiÚ
.u.
s1g
.
v¬ŸbË
;

102 
›“80211_twt_·¿ms
 *
twt_ag¹
 = (*)
twt
->
·¿ms
;

104 
twt_ag¹
->
»q_ty³
 &ğ
	`ıu_to_Ë16
(~
IEEE80211_TWT_REQTYPE_REQUEST
);

107 ià(
twt
->
cÚŒŞ
 & 
IEEE80211_TWT_CONTROL_NEG_TYPE_BROADCAST
) {

108 
twt_ag¹
->
»q_ty³
 &=

109 ~
	`ıu_to_Ë16
(
IEEE80211_TWT_REQTYPE_SETUP_CMD
);

110 
twt_ag¹
->
»q_ty³
 |=

111 
	`Ë16_’code_b™s
(
TWT_SETUP_CMD_REJECT
,

112 
IEEE80211_TWT_REQTYPE_SETUP_CMD
);

113 
out
;

117 
twt
->
cÚŒŞ
 |ğ
IEEE80211_TWT_CONTROL_RX_DISABLED
;

119 
	`drv_add_twt_£tup
(
sd©a
->
loÿl
, sd©a, &
¡a
->¡a, 
twt
);

120 
out
:

121 
	`›“80211_s1g_£nd_twt_£tup
(
sd©a
, 
mgmt
->
§
, sd©a->
vif
.
addr
, 
twt
);

122 
	}
}

125 
	$›“80211_s1g_rx_twt_‹¬down
(
›“80211_sub_if_d©a
 *
sd©a
,

126 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

128 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*)
skb
->
d©a
;

130 
	`drv_twt_‹¬down_»que¡
(
sd©a
->
loÿl
, sd©a, &
¡a
->sta,

131 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
v¬ŸbË
[0]);

132 
	}
}

135 
	$›“80211_s1g_tx_twt_£tup_ç
(
›“80211_sub_if_d©a
 *
sd©a
,

136 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

138 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*)
skb
->
d©a
;

139 
›“80211_twt_£tup
 *
twt
 = (*)
mgmt
->
u
.
aùiÚ
.u.
s1g
.
v¬ŸbË
;

140 
›“80211_twt_·¿ms
 *
twt_ag¹
 = (*)
twt
->
·¿ms
;

141 
u8
 
æowid
 = 
	`Ë16_g‘_b™s
(
twt_ag¹
->
»q_ty³
,

142 
IEEE80211_TWT_REQTYPE_FLOWID
);

144 
	`drv_twt_‹¬down_»que¡
(
sd©a
->
loÿl
, sd©a, &
¡a
->¡a, 
æowid
);

146 
	`›“80211_s1g_£nd_twt_‹¬down
(
sd©a
, 
mgmt
->
§
, sd©a->
vif
.
addr
,

147 
æowid
);

148 
	}
}

150 
	$›“80211_s1g_rx_twt_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

151 
sk_buff
 *
skb
)

153 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*)
skb
->
d©a
;

154 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

155 
¡a_šfo
 *
¡a
;

157 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

159 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
§
);

160 ià(!
¡a
)

163 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
) {

164 
WLAN_S1G_TWT_SETUP
:

165 
	`›“80211_s1g_rx_twt_£tup
(
sd©a
, 
¡a
, 
skb
);

167 
WLAN_S1G_TWT_TEARDOWN
:

168 
	`›“80211_s1g_rx_twt_‹¬down
(
sd©a
, 
¡a
, 
skb
);

173 
	}
}

175 
	$›“80211_s1g_¡©us_twt_aùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

176 
sk_buff
 *
skb
)

178 
›“80211_mgmt
 *
mgmt
 = (›“80211_mgmˆ*)
skb
->
d©a
;

179 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

180 
¡a_šfo
 *
¡a
;

182 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

184 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
mgmt
->
da
);

185 ià(!
¡a
)

188 
mgmt
->
u
.
aùiÚ
.u.
s1g
.
aùiÚ_code
) {

189 
WLAN_S1G_TWT_SETUP
:

191 
	`›“80211_s1g_tx_twt_£tup_ç
(
sd©a
, 
¡a
, 
skb
);

196 
	}
}

	@scan.c

15 
	~<lšux/if_¬p.h
>

16 
	~<lšux/‘h”deviû.h
>

17 
	~<lšux/¹Ãšk.h
>

18 
	~<Ãt/sch_g’”ic.h
>

19 
	~<lšux/¦ab.h
>

20 
	~<lšux/expÜt.h
>

21 
	~<lšux/¿ndom.h
>

22 
	~<Ãt/mac80211.h
>

24 
	~"›“80211_i.h
"

25 
	~"driv”-İs.h
"

26 
	~"mesh.h
"

28 
	#IEEE80211_PROBE_DELAY
 (
HZ
 / 33)

	)

29 
	#IEEE80211_CHANNEL_TIME
 (
HZ
 / 33)

	)

30 
	#IEEE80211_PASSIVE_CHANNEL_TIME
 (
HZ
 / 9)

	)

32 
	$›“80211_rx_bss_put
(
›“80211_loÿl
 *
loÿl
,

33 
›“80211_bss
 *
bss
)

35 ià(!
bss
)

37 
	`cfg80211_put_bss
(
loÿl
->
hw
.
why
,

38 
	`cÚš”_of
((*)
bss
, 
cfg80211_bss
, 
´iv
));

39 
	}
}

41 
boŞ
 
	$is_u­sd_suµÜ‹d
(
›“802_11_–ems
 *
–ems
)

43 
u8
 
qos_šfo
;

45 ià(
–ems
->
wmm_šfo
 &&ƒËms->
wmm_šfo_Ën
 == 7

46 && 
–ems
->
wmm_šfo
[5] == 1)

47 
qos_šfo
 = 
–ems
->
wmm_šfo
[6];

48 ià(
–ems
->
wmm_·¿m
 &&ƒËms->
wmm_·¿m_Ën
 == 24

49 && 
–ems
->
wmm_·¿m
[5] == 1)

50 
qos_šfo
 = 
–ems
->
wmm_·¿m
[6];

53  
çl£
;

55  
qos_šfo
 & 
IEEE80211_WMM_IE_AP_QOSINFO_UAPSD
;

56 
	}
}

58 
	sšfÜm_bss_upd©e_d©a
 {

59 
›“80211_rx_¡©us
 *
	mrx_¡©us
;

60 
boŞ
 
	mb—cÚ
;

63 
	$›“80211_šfÜm_bss
(
why
 *wiphy,

64 
cfg80211_bss
 *
cbss
,

65 cÚ¡ 
cfg80211_bss_›s
 *
›s
,

66 *
d©a
)

68 
›“80211_loÿl
 *
loÿl
 = 
	`why_´iv
(
why
);

69 
šfÜm_bss_upd©e_d©a
 *
upd©e_d©a
 = 
d©a
;

70 
›“80211_bss
 *
bss
 = (*)
cbss
->
´iv
;

71 
›“80211_rx_¡©us
 *
rx_¡©us
;

72 
›“802_11_–ems
 *
–ems
;

73 
ş’
, 
¤Ën
;

76 ià(!
upd©e_d©a
)

79 
–ems
 = 
	`›“802_11_·r£_–ems
(
›s
->
d©a
, ies->
Ën
, 
çl£
, 
NULL
);

80 ià(!
–ems
)

83 
rx_¡©us
 = 
upd©e_d©a
->rx_status;

85 ià(
upd©e_d©a
->
b—cÚ
)

86 
bss
->
deviû_ts_b—cÚ
 = 
rx_¡©us
->
deviû_time¡amp
;

88 
bss
->
deviû_ts_´e¥
 = 
rx_¡©us
->
deviû_time¡amp
;

90 ià(
–ems
->
·r£_”rÜ
) {

91 ià(
upd©e_d©a
->
b—cÚ
)

92 
bss
->
cÜru±_d©a
 |ğ
IEEE80211_BSS_CORRUPT_BEACON
;

94 
bss
->
cÜru±_d©a
 |ğ
IEEE80211_BSS_CORRUPT_PROBE_RESP
;

96 ià(
upd©e_d©a
->
b—cÚ
)

97 
bss
->
cÜru±_d©a
 &ğ~
IEEE80211_BSS_CORRUPT_BEACON
;

99 
bss
->
cÜru±_d©a
 &ğ~
IEEE80211_BSS_CORRUPT_PROBE_RESP
;

103 ià(
–ems
->
”p_šfo
 && (!–ems->
·r£_”rÜ
 ||

104 !(
bss
->
v®id_d©a
 & 
IEEE80211_BSS_VALID_ERP
))) {

105 
bss
->
”p_v®ue
 = 
–ems
->
”p_šfo
[0];

106 
bss
->
has_”p_v®ue
 = 
Œue
;

107 ià(!
–ems
->
·r£_”rÜ
)

108 
bss
->
v®id_d©a
 |ğ
IEEE80211_BSS_VALID_ERP
;

112 ià(!
–ems
->
·r£_”rÜ
 ||

113 !(
bss
->
v®id_d©a
 & 
IEEE80211_BSS_VALID_RATES
)) {

114 
¤Ën
 = 0;

115 ià(
–ems
->
suµ_¿‹s
) {

116 
ş’
 = 
IEEE80211_MAX_SUPP_RATES
;

117 ià(
ş’
 > 
–ems
->
suµ_¿‹s_Ën
)

118 
ş’
 = 
–ems
->
suµ_¿‹s_Ën
;

119 
	`memıy
(
bss
->
suµ_¿‹s
, 
–ems
->suµ_¿‹s, 
ş’
);

120 
¤Ën
 +ğ
ş’
;

122 ià(
–ems
->
ext_suµ_¿‹s
) {

123 
ş’
 = 
IEEE80211_MAX_SUPP_RATES
 - 
¤Ën
;

124 ià(
ş’
 > 
–ems
->
ext_suµ_¿‹s_Ën
)

125 
ş’
 = 
–ems
->
ext_suµ_¿‹s_Ën
;

126 
	`memıy
(
bss
->
suµ_¿‹s
 + 
¤Ën
, 
–ems
->
ext_suµ_¿‹s
,

127 
ş’
);

128 
¤Ën
 +ğ
ş’
;

130 ià(
¤Ën
) {

131 
bss
->
suµ_¿‹s_Ën
 = 
¤Ën
;

132 ià(!
–ems
->
·r£_”rÜ
)

133 
bss
->
v®id_d©a
 |ğ
IEEE80211_BSS_VALID_RATES
;

137 ià(!
–ems
->
·r£_”rÜ
 ||

138 !(
bss
->
v®id_d©a
 & 
IEEE80211_BSS_VALID_WMM
)) {

139 
bss
->
wmm_u£d
 = 
–ems
->
wmm_·¿m
 ||ƒËms->
wmm_šfo
;

140 
bss
->
u­sd_suµÜ‹d
 = 
	`is_u­sd_suµÜ‹d
(
–ems
);

141 ià(!
–ems
->
·r£_”rÜ
)

142 
bss
->
v®id_d©a
 |ğ
IEEE80211_BSS_VALID_WMM
;

145 ià(
upd©e_d©a
->
b—cÚ
) {

146 
›“80211_suµÜ‹d_bªd
 *
sbªd
 =

147 
loÿl
->
hw
.
why
->
bªds
[
rx_¡©us
->
bªd
];

148 ià(!(
rx_¡©us
->
’codšg
 =ğ
RX_ENC_HT
) &&

149 !(
rx_¡©us
->
’codšg
 =ğ
RX_ENC_VHT
))

150 
bss
->
b—cÚ_¿‹
 =

151 &
sbªd
->
b™¿‹s
[
rx_¡©us
->
¿‹_idx
];

154 ià(
–ems
->
vht_ÿp_–em
)

155 
bss
->
vht_ÿp_šfo
 =

156 
	`Ë32_to_ıu
(
–ems
->
vht_ÿp_–em
->
vht_ÿp_šfo
);

158 
bss
->
vht_ÿp_šfo
 = 0;

160 
	`kä“
(
–ems
);

161 
	}
}

163 
›“80211_bss
 *

164 
	$›“80211_bss_šfo_upd©e
(
›“80211_loÿl
 *
loÿl
,

165 
›“80211_rx_¡©us
 *
rx_¡©us
,

166 
›“80211_mgmt
 *
mgmt
, 
size_t
 
Ën
,

167 
›“80211_chªÃl
 *
chªÃl
)

169 
boŞ
 
b—cÚ
 = 
	`›“80211_is_b—cÚ
(
mgmt
->
äame_cÚŒŞ
) ||

170 
	`›“80211_is_s1g_b—cÚ
(
mgmt
->
äame_cÚŒŞ
);

171 
cfg80211_bss
 *
cbss
;

172 
šfÜm_bss_upd©e_d©a
 
upd©e_d©a
 = {

173 .
rx_¡©us
 =„x_status,

174 .
b—cÚ
 = beacon,

176 
cfg80211_šfÜm_bss
 
bss_m‘a
 = {

177 .
boÙtime_ns
 = 
rx_¡©us
->boottime_ns,

178 .
drv_d©a
 = (*)&
upd©e_d©a
,

180 
boŞ
 
sigÇl_v®id
;

181 
›“80211_sub_if_d©a
 *
sÿn_sd©a
;

183 ià(
rx_¡©us
->
æag
 & 
RX_FLAG_NO_SIGNAL_VAL
)

184 
bss_m‘a
.
sigÇl
 = 0;

185 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SIGNAL_DBM
))

186 
bss_m‘a
.
sigÇl
 = 
rx_¡©us
->signal * 100;

187 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SIGNAL_UNSPEC
))

188 
bss_m‘a
.
sigÇl
 = (
rx_¡©us
->sigÇÈ* 100è/ 
loÿl
->
hw
.
max_sigÇl
;

190 
bss_m‘a
.
chª
 = 
chªÃl
;

192 
	`rcu_»ad_lock
();

193 
sÿn_sd©a
 = 
	`rcu_d”eã»nû
(
loÿl
->scan_sdata);

194 ià(
sÿn_sd©a
 && sÿn_sd©a->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

195 
sÿn_sd©a
->
vif
.
cfg
.
assoc
 &&

196 
	`›“80211_have_rx_time¡amp
(
rx_¡©us
)) {

197 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
NULL
;

202 ià(
	`›“80211_vif_is_mld
(&
sÿn_sd©a
->
vif
)) {

203 ià(
rx_¡©us
->
lšk_v®id
) {

204 
s8
 
lšk_id
 = 
rx_¡©us
->link_id;

206 
lšk_cÚf
 =

207 
	`rcu_d”eã»nû
(
sÿn_sd©a
->
vif
.
lšk_cÚf
[
lšk_id
]);

210 
lšk_cÚf
 = &
sÿn_sd©a
->
vif
.
bss_cÚf
;

213 ià(
lšk_cÚf
) {

214 
bss_m‘a
.
·»Á_tsf
 =

215 
	`›“80211_ÿlcuÏ‹_rx_time¡amp
(
loÿl
,

216 
rx_¡©us
,

217 
Ën
 + 
FCS_LEN
,

220 
	`‘h”_addr_cİy
(
bss_m‘a
.
·»Á_bssid
,

221 
lšk_cÚf
->
bssid
);

224 
	`rcu_»ad_uÆock
();

226 
cbss
 = 
	`cfg80211_šfÜm_bss_äame_d©a
(
loÿl
->
hw
.
why
, &
bss_m‘a
,

227 
mgmt
, 
Ën
, 
GFP_ATOMIC
);

228 ià(!
cbss
)

229  
NULL
;

232 
sigÇl_v®id
 = 
chªÃl
 =ğ
cbss
->channel;

233 ià(!
sigÇl_v®id
)

234 
rx_¡©us
->
æag
 |ğ
RX_FLAG_NO_SIGNAL_VAL
;

236  (*)
cbss
->
´iv
;

237 
	}
}

239 
boŞ
 
	$›“80211_sÿn_acû±_´e¥
(
›“80211_sub_if_d©a
 *
sd©a
,

240 
›“80211_chªÃl
 *
chªÃl
,

241 
u32
 
sÿn_æags
, cÚ¡ 
u8
 *
da
)

243 ià(!
sd©a
)

244  
çl£
;

247 ià(
	`is_brßdÿ¡_‘h”_addr
(
da
) &&

248 (
chªÃl
->
bªd
 =ğ
NL80211_BAND_6GHZ
 ||

249 
sÿn_æags
 & 
NL80211_SCAN_FLAG_ACCEPT_BCAST_PROBE_RESP
))

250  
Œue
;

252 ià(
sÿn_æags
 & 
NL80211_SCAN_FLAG_RANDOM_ADDR
)

253  
Œue
;

254  
	`‘h”_addr_equ®
(
da
, 
sd©a
->
vif
.
addr
);

255 
	}
}

257 
	$›“80211_sÿn_rx
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
)

259 
›“80211_rx_¡©us
 *
rx_¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

260 
›“80211_mgmt
 *
mgmt
 = (*)
skb
->
d©a
;

261 
›“80211_bss
 *
bss
;

262 
›“80211_chªÃl
 *
chªÃl
;

263 
size_t
 
mš_hdr_Ën
 = 
	`off£tof
(
›“80211_mgmt
,

264 
u
.
´obe_»¥
.
v¬ŸbË
);

266 ià(!
	`›“80211_is_´obe_»¥
(
mgmt
->
äame_cÚŒŞ
) &&

267 !
	`›“80211_is_b—cÚ
(
mgmt
->
äame_cÚŒŞ
) &&

268 !
	`›“80211_is_s1g_b—cÚ
(
mgmt
->
äame_cÚŒŞ
))

271 ià(
	`›“80211_is_s1g_b—cÚ
(
mgmt
->
äame_cÚŒŞ
)) {

272 ià(
	`›“80211_is_s1g_shÜt_b—cÚ
(
mgmt
->
äame_cÚŒŞ
))

273 
mš_hdr_Ën
 = 
	`off£tof
(
›“80211_ext
,

274 
u
.
s1g_shÜt_b—cÚ
.
v¬ŸbË
);

276 
mš_hdr_Ën
 = 
	`off£tof
(
›“80211_ext
,

277 
u
.
s1g_b—cÚ
);

280 ià(
skb
->
Ën
 < 
mš_hdr_Ën
)

283 ià(
	`‹¡_ªd_ş—r_b™
(
SCAN_BEACON_WAIT
, &
loÿl
->
sÿÂšg
)) {

289 
	`£t_b™
(
SCAN_BEACON_DONE
, &
loÿl
->
sÿÂšg
);

290 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
, 0);

293 
chªÃl
 = 
	`›“80211_g‘_chªÃl_khz
(
loÿl
->
hw
.
why
,

294 
	`›“80211_rx_¡©us_to_khz
(
rx_¡©us
));

296 ià(!
chªÃl
 || chªÃl->
æags
 & 
IEEE80211_CHAN_DISABLED
)

299 ià(
	`›“80211_is_´obe_»¥
(
mgmt
->
äame_cÚŒŞ
)) {

300 
›“80211_sub_if_d©a
 *
sd©a1
, *
sd©a2
;

301 
cfg80211_sÿn_»que¡
 *
sÿn_»q
;

302 
cfg80211_sched_sÿn_»que¡
 *
sched_sÿn_»q
;

303 
u32
 
sÿn_»q_æags
 = 0, 
sched_sÿn_»q_æags
 = 0;

305 
sd©a1
 = 
	`rcu_d”eã»nû
(
loÿl
->
sÿn_sd©a
);

306 
sd©a2
 = 
	`rcu_d”eã»nû
(
loÿl
->
sched_sÿn_sd©a
);

308 ià(
	`lik–y
(!
sd©a1
 && !
sd©a2
))

311 
sÿn_»q
 = 
	`rcu_d”eã»nû
(
loÿl
->scan_req);

312 
sched_sÿn_»q
 = 
	`rcu_d”eã»nû
(
loÿl
->sched_scan_req);

314 ià(
sÿn_»q
)

315 
sÿn_»q_æags
 = 
sÿn_»q
->
æags
;

317 ià(
sched_sÿn_»q
)

318 
sched_sÿn_»q_æags
 = 
sched_sÿn_»q
->
æags
;

323 ià(!
	`›“80211_sÿn_acû±_´e¥
(
sd©a1
, 
chªÃl
,

324 
sÿn_»q_æags
,

325 
mgmt
->
da
) &&

326 !
	`›“80211_sÿn_acû±_´e¥
(
sd©a2
, 
chªÃl
,

327 
sched_sÿn_»q_æags
,

328 
mgmt
->
da
))

332 ià(!
	`is_brßdÿ¡_‘h”_addr
(
mgmt
->
da
))

337 ià(
loÿl
->
İ’_couÁ
 =ğloÿl->
mÚ™Üs
)

340 
bss
 = 
	`›“80211_bss_šfo_upd©e
(
loÿl
, 
rx_¡©us
,

341 
mgmt
, 
skb
->
Ën
,

342 
chªÃl
);

343 ià(
bss
)

344 
	`›“80211_rx_bss_put
(
loÿl
, 
bss
);

345 
	}
}

347 
	$›“80211_´•¬e_sÿn_chªdef
(
cfg80211_chª_def
 *
chªdef
)

349 
	`mem£t
(
chªdef
, 0, (*chandef));

351 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

352 
	}
}

355 
boŞ
 
	$›“80211_´•_hw_sÿn
(
›“80211_sub_if_d©a
 *
sd©a
)

357 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

358 
cfg80211_sÿn_»que¡
 *
»q
;

359 
cfg80211_chª_def
 
chªdef
;

360 
u8
 
bªds_u£d
 = 0;

361 
i
, 
›Ën
, 
n_chªs
;

362 
u32
 
æags
 = 0;

364 
»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->
sÿn_»q
,

365 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

367 ià(
	`‹¡_b™
(
SCAN_HW_CANCELLED
, &
loÿl
->
sÿÂšg
))

368  
çl£
;

370 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SINGLE_SCAN_ON_ALL_BANDS
)) {

371 
i
 = 0; i < 
»q
->
n_chªÃls
; i++) {

372 
loÿl
->
hw_sÿn_»q
->
»q
.
chªÃls
[
i
] =„eq->channels[i];

373 
bªds_u£d
 |ğ
	`BIT
(
»q
->
chªÃls
[
i
]->
bªd
);

376 
n_chªs
 = 
»q
->
n_chªÃls
;

379 ià(
loÿl
->
hw_sÿn_bªd
 =ğ
NUM_NL80211_BANDS
)

380  
çl£
;

382 
n_chªs
 = 0;

384 
i
 = 0; i < 
»q
->
n_chªÃls
; i++) {

385 ià(
»q
->
chªÃls
[
i
]->
bªd
 !=

386 
loÿl
->
hw_sÿn_bªd
)

388 
loÿl
->
hw_sÿn_»q
->
»q
.
chªÃls
[
n_chªs
] =

389 
»q
->
chªÃls
[
i
];

390 
n_chªs
++;

391 
bªds_u£d
 |ğ
	`BIT
(
»q
->
chªÃls
[
i
]->
bªd
);

394 
loÿl
->
hw_sÿn_bªd
++;

395 } !
n_chªs
);

398 
loÿl
->
hw_sÿn_»q
->
»q
.
n_chªÃls
 = 
n_chªs
;

399 
	`›“80211_´•¬e_sÿn_chªdef
(&
chªdef
);

401 ià(
»q
->
æags
 & 
NL80211_SCAN_FLAG_MIN_PREQ_CONTENT
)

402 
æags
 |ğ
IEEE80211_PROBE_FLAG_MIN_CONTENT
;

404 
›Ën
 = 
	`›“80211_bud_´eq_›s
(
sd©a
,

405 (
u8
 *)
loÿl
->
hw_sÿn_»q
->
»q
.
›
,

406 
loÿl
->
hw_sÿn_›s_bufsize
,

407 &
loÿl
->
hw_sÿn_»q
->
›s
,

408 
»q
->
›
,„eq->
›_Ën
,

409 
bªds_u£d
, 
»q
->
¿‹s
, &
chªdef
,

410 
æags
);

411 ià(
›Ën
 < 0)

412  
çl£
;

413 
loÿl
->
hw_sÿn_»q
->
»q
.
›_Ën
 = 
›Ën
;

414 
loÿl
->
hw_sÿn_»q
->
»q
.
no_cck
 =„eq->no_cck;

415 
	`‘h”_addr_cİy
(
loÿl
->
hw_sÿn_»q
->
»q
.
mac_addr
,„eq->mac_addr);

416 
	`‘h”_addr_cİy
(
loÿl
->
hw_sÿn_»q
->
»q
.
mac_addr_mask
,

417 
»q
->
mac_addr_mask
);

418 
	`‘h”_addr_cİy
(
loÿl
->
hw_sÿn_»q
->
»q
.
bssid
,„eq->bssid);

420  
Œue
;

421 
	}
}

423 
	$__›“80211_sÿn_com¶‘ed
(
›“80211_hw
 *
hw
, 
boŞ
 
abÜ‹d
)

425 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

426 
boŞ
 
hw_sÿn
 = 
	`‹¡_b™
(
SCAN_HW_SCANNING
, &
loÿl
->
sÿÂšg
);

427 
boŞ
 
was_sÿÂšg
 = 
loÿl
->
sÿÂšg
;

428 
cfg80211_sÿn_»que¡
 *
sÿn_»q
;

429 
›“80211_sub_if_d©a
 *
sÿn_sd©a
;

430 
›“80211_sub_if_d©a
 *
sd©a
;

432 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

440 ià(
	`WARN_ON
(!
loÿl
->
sÿÂšg
 && !
abÜ‹d
))

441 
abÜ‹d
 = 
Œue
;

443 ià(
	`WARN_ON
(!
loÿl
->
sÿn_»q
))

446 
sÿn_sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_sdata,

447 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

449 ià(
hw_sÿn
 && !
abÜ‹d
 &&

450 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SINGLE_SCAN_ON_ALL_BANDS
) &&

451 
	`›“80211_´•_hw_sÿn
(
sÿn_sd©a
)) {

452 
rc
;

454 
rc
 = 
	`drv_hw_sÿn
(
loÿl
,

455 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->
sÿn_sd©a
,

456 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
)),

457 
loÿl
->
hw_sÿn_»q
);

459 ià(
rc
 == 0)

465 
	`mem£t
(&
loÿl
->
sÿn_šfo
, 0, (local->scan_info));

466 
abÜ‹d
 = 
Œue
;

469 
	`kä“
(
loÿl
->
hw_sÿn_»q
);

470 
loÿl
->
hw_sÿn_»q
 = 
NULL
;

472 
sÿn_»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_req,

473 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

475 
	`RCU_INIT_POINTER
(
loÿl
->
sÿn_»q
, 
NULL
);

476 
	`RCU_INIT_POINTER
(
loÿl
->
sÿn_sd©a
, 
NULL
);

478 
loÿl
->
sÿÂšg
 = 0;

479 
loÿl
->
sÿn_chªdef
.
chª
 = 
NULL
;

481 
	`synchrÚize_rcu
();

483 ià(
sÿn_»q
 !ğ
loÿl
->
št_sÿn_»q
) {

484 
loÿl
->
sÿn_šfo
.
abÜ‹d
 =‡borted;

485 
	`cfg80211_sÿn_dÚe
(
sÿn_»q
, &
loÿl
->
sÿn_šfo
);

489 
	`›“80211_hw_cÚf_chª
(
loÿl
);

491 ià(!
hw_sÿn
 && 
was_sÿÂšg
) {

492 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

493 
	`drv_sw_sÿn_com¶‘e
(
loÿl
, 
sÿn_sd©a
);

494 
	`›“80211_offchªÃl_»tuº
(
loÿl
);

497 
	`›“80211_»ÿlc_idË
(
loÿl
);

499 
	`›“80211_mlme_nÙify_sÿn_com¶‘ed
(
loÿl
);

500 
	`›“80211_ibss_nÙify_sÿn_com¶‘ed
(
loÿl
);

506 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

507 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
))

508 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &sd©a->
wÜk
);

511 ià(
was_sÿÂšg
)

512 
	`›“80211_¡¬t_Ãxt_roc
(
loÿl
);

513 
	}
}

515 
	$›“80211_sÿn_com¶‘ed
(
›“80211_hw
 *
hw
,

516 
cfg80211_sÿn_šfo
 *
šfo
)

518 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

520 
	`Œaû_­i_sÿn_com¶‘ed
(
loÿl
, 
šfo
->
abÜ‹d
);

522 
	`£t_b™
(
SCAN_COMPLETED
, &
loÿl
->
sÿÂšg
);

523 ià(
šfo
->
abÜ‹d
)

524 
	`£t_b™
(
SCAN_ABORTED
, &
loÿl
->
sÿÂšg
);

526 
	`memıy
(&
loÿl
->
sÿn_šfo
, 
šfo
, (*info));

528 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
, 0);

529 
	}
}

530 
EXPORT_SYMBOL
(
›“80211_sÿn_com¶‘ed
);

532 
	$›“80211_¡¬t_sw_sÿn
(
›“80211_loÿl
 *
loÿl
,

533 
›“80211_sub_if_d©a
 *
sd©a
)

536 ià(!
loÿl
->
emuÏ‹_chªùx
)

537  -
EOPNOTSUPP
;

552 
	`drv_sw_sÿn_¡¬t
(
loÿl
, 
sd©a
,†oÿl->
sÿn_addr
);

554 
loÿl
->
Ëave_İ”_chªÃl_time
 = 
jiff›s
;

555 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_DECISION
;

556 
loÿl
->
sÿn_chªÃl_idx
 = 0;

558 
	`›“80211_offchªÃl_¡İ_vifs
(
loÿl
);

561 
	`›“80211_æush_queues
(
loÿl
, 
NULL
, 
çl£
);

563 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

566 
	`›“80211_hw_cÚf_chª
(
loÿl
);

568 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
, 0);

571 
	}
}

573 
boŞ
 
	$__›“80211_ÿn_Ëave_ch
(
›“80211_sub_if_d©a
 *
sd©a
)

575 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

576 
›“80211_sub_if_d©a
 *
sd©a_™”
;

578 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

580 ià(!
	`›“80211_is_¿d¬_»quœed
(
loÿl
))

581  
Œue
;

583 ià(!
	`»guÏtÜy_´e_ÿc_®lowed
(
loÿl
->
hw
.
why
))

584  
çl£
;

586 
	`li¡_fÜ_—ch_’Œy
(
sd©a_™”
, &
loÿl
->
š‹rçûs
, 
li¡
) {

587 ià(
sd©a_™”
->
wdev
.
ÿc_¡¬‹d
)

588  
çl£
;

591  
Œue
;

592 
	}
}

594 
boŞ
 
	$›“80211_ÿn_sÿn
(
›“80211_loÿl
 *
loÿl
,

595 
›“80211_sub_if_d©a
 *
sd©a
)

597 ià(!
	`__›“80211_ÿn_Ëave_ch
(
sd©a
))

598  
çl£
;

600 ià(!
	`li¡_em±y
(&
loÿl
->
roc_li¡
))

601  
çl£
;

603 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

604 
sd©a
->
u
.
mgd
.
æags
 & 
IEEE80211_STA_CONNECTION_POLL
)

605  
çl£
;

607  
Œue
;

608 
	}
}

610 
	$›“80211_run_deã¼ed_sÿn
(
›“80211_loÿl
 *
loÿl
)

612 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

614 ià(!
loÿl
->
sÿn_»q
 ||†oÿl->
sÿÂšg
)

617 ià(!
	`›“80211_ÿn_sÿn
(
loÿl
,

618 
	`rcu_d”eã»nû_´Ùeùed
(

619 
loÿl
->
sÿn_sd©a
,

620 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
))))

623 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
,

624 
	`round_jiff›s_»Ïtive
(0));

625 
	}
}

627 
	$›“80211_£nd_sÿn_´obe_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

628 cÚ¡ 
u8
 *
¤c
, cÚ¡ u8 *
d¡
,

629 cÚ¡ 
u8
 *
ssid
, 
size_t
 
ssid_Ën
,

630 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

631 
u32
 
¿‹mask
, u32 
æags
, u32 
tx_æags
,

632 
›“80211_chªÃl
 *
chªÃl
)

634 
sk_buff
 *
skb
;

636 
skb
 = 
	`›“80211_bud_´obe_»q
(
sd©a
, 
¤c
, 
d¡
, 
¿‹mask
, 
chªÃl
,

637 
ssid
, 
ssid_Ën
,

638 
›
, 
›_Ën
, 
æags
);

640 ià(
skb
) {

641 ià(
æags
 & 
IEEE80211_PROBE_FLAG_RANDOM_SN
) {

642 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

643 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

644 
u16
 
¢
 = 
	`g‘_¿ndom_u16
();

646 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_NO_SEQNO
;

647 
hdr
->
£q_ù¾
 =

648 
	`ıu_to_Ë16
(
	`IEEE80211_SN_TO_SEQ
(
¢
));

650 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
tx_æags
;

651 
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_SCAN_TX
;

652 
	`›“80211_tx_skb_tid_bªd
(
sd©a
, 
skb
, 7, 
chªÃl
->
bªd
);

654 
	}
}

656 
	$›“80211_sÿn_¡©e_£nd_´obe
(
›“80211_loÿl
 *
loÿl
,

657 *
Ãxt_d–ay
)

659 
i
;

660 
›“80211_sub_if_d©a
 *
sd©a
;

661 
cfg80211_sÿn_»que¡
 *
sÿn_»q
;

662 
Æ80211_bªd
 
bªd
 = 
loÿl
->
hw
.
cÚf
.
chªdef
.
chª
->band;

663 
u32
 
æags
 = 0, 
tx_æags
;

665 
sÿn_»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_req,

666 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

668 
tx_æags
 = 
IEEE80211_TX_INTFL_OFFCHAN_TX_OK
;

669 ià(
sÿn_»q
->
no_cck
)

670 
tx_æags
 |ğ
IEEE80211_TX_CTL_NO_CCK_RATE
;

671 ià(
sÿn_»q
->
æags
 & 
NL80211_SCAN_FLAG_MIN_PREQ_CONTENT
)

672 
æags
 |ğ
IEEE80211_PROBE_FLAG_MIN_CONTENT
;

673 ià(
sÿn_»q
->
æags
 & 
NL80211_SCAN_FLAG_RANDOM_SN
)

674 
æags
 |ğ
IEEE80211_PROBE_FLAG_RANDOM_SN
;

676 
sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->
sÿn_sd©a
,

677 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

679 
i
 = 0; i < 
sÿn_»q
->
n_ssids
; i++)

680 
	`›“80211_£nd_sÿn_´obe_»q
(

681 
sd©a
, 
loÿl
->
sÿn_addr
, 
sÿn_»q
->
bssid
,

682 
sÿn_»q
->
ssids
[
i
].
ssid
, sÿn_»q->ssids[i].
ssid_Ën
,

683 
sÿn_»q
->
›
, sÿn_»q->
›_Ën
,

684 
sÿn_»q
->
¿‹s
[
bªd
], 
æags
,

685 
tx_æags
, 
loÿl
->
hw
.
cÚf
.
chªdef
.
chª
);

691 *
Ãxt_d–ay
 = 
	`m£cs_to_jiff›s
(
sÿn_»q
->
du¿tiÚ
) >

692 
IEEE80211_PROBE_DELAY
 + 
IEEE80211_CHANNEL_TIME
 ?

693 
	`m£cs_to_jiff›s
(
sÿn_»q
->
du¿tiÚ
è- 
IEEE80211_PROBE_DELAY
 :

694 
IEEE80211_CHANNEL_TIME
;

695 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_DECISION
;

696 
	}
}

698 
	$__›“80211_¡¬t_sÿn
(
›“80211_sub_if_d©a
 *
sd©a
,

699 
cfg80211_sÿn_»que¡
 *
»q
)

701 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

702 
boŞ
 
hw_sÿn
 = 
loÿl
->
İs
->hw_scan;

703 
rc
;

705 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

707 ià(
loÿl
->
sÿn_»q
)

708  -
EBUSY
;

714 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

715 ià(
»q
->
tsf_»pÜt_lšk_id
 >= 0) {

716 ià(!(
sd©a
->
vif
.
aùive_lšks
 &

717 
	`BIT
(
»q
->
tsf_»pÜt_lšk_id
)))

718  -
EINVAL
;

720 
»q
->
tsf_»pÜt_lšk_id
 =

721 
	`__ffs
(
sd©a
->
vif
.
aùive_lšks
);

725 ià(!
	`__›“80211_ÿn_Ëave_ch
(
sd©a
))

726  -
EBUSY
;

728 ià(!
	`›“80211_ÿn_sÿn
(
loÿl
, 
sd©a
)) {

730 
	`rcu_assign_poš‹r
(
loÿl
->
sÿn_»q
, 
»q
);

731 
	`rcu_assign_poš‹r
(
loÿl
->
sÿn_sd©a
, 
sd©a
);

735 
agaš
:

736 ià(
hw_sÿn
) {

737 
u8
 *
›s
;

739 
loÿl
->
hw_sÿn_›s_bufsize
 =†oÿl->
sÿn_›s_Ën
 + 
»q
->
›_Ën
;

741 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SINGLE_SCAN_ON_ALL_BANDS
)) {

742 
i
, 
n_bªds
 = 0;

743 
u8
 
bªds_couÁed
 = 0;

745 
i
 = 0; i < 
»q
->
n_chªÃls
; i++) {

746 ià(
bªds_couÁed
 & 
	`BIT
(
»q
->
chªÃls
[
i
]->
bªd
))

748 
bªds_couÁed
 |ğ
	`BIT
(
»q
->
chªÃls
[
i
]->
bªd
);

749 
n_bªds
++;

752 
loÿl
->
hw_sÿn_›s_bufsize
 *ğ
n_bªds
;

755 
loÿl
->
hw_sÿn_»q
 = 
	`km®loc
(

756 (*
loÿl
->
hw_sÿn_»q
) +

757 
»q
->
n_chªÃls
 * Ôeq->
chªÃls
[0]) +

758 
loÿl
->
hw_sÿn_›s_bufsize
, 
GFP_KERNEL
);

759 ià(!
loÿl
->
hw_sÿn_»q
)

760  -
ENOMEM
;

762 
loÿl
->
hw_sÿn_»q
->
»q
.
ssids
 =„eq->ssids;

763 
loÿl
->
hw_sÿn_»q
->
»q
.
n_ssids
 =„eq->n_ssids;

764 
›s
 = (
u8
 *)
loÿl
->
hw_sÿn_»q
 +

765 (*
loÿl
->
hw_sÿn_»q
) +

766 
»q
->
n_chªÃls
 * Ôeq->
chªÃls
[0]);

767 
loÿl
->
hw_sÿn_»q
->
»q
.
›
 = 
›s
;

768 
loÿl
->
hw_sÿn_»q
->
»q
.
æags
 =„eq->flags;

769 
	`‘h_brßdÿ¡_addr
(
loÿl
->
hw_sÿn_»q
->
»q
.
bssid
);

770 
loÿl
->
hw_sÿn_»q
->
»q
.
du¿tiÚ
 =„eq->duration;

771 
loÿl
->
hw_sÿn_»q
->
»q
.
du¿tiÚ_mªd©Üy
 =

772 
»q
->
du¿tiÚ_mªd©Üy
;

773 
loÿl
->
hw_sÿn_»q
->
»q
.
tsf_»pÜt_lšk_id
 =

774 
»q
->
tsf_»pÜt_lšk_id
;

776 
loÿl
->
hw_sÿn_bªd
 = 0;

777 
loÿl
->
hw_sÿn_»q
->
»q
.
n_6ghz_·¿ms
 =„eq->n_6ghz_params;

778 
loÿl
->
hw_sÿn_»q
->
»q
.
sÿn_6ghz_·¿ms
 =

779 
»q
->
sÿn_6ghz_·¿ms
;

780 
loÿl
->
hw_sÿn_»q
->
»q
.
sÿn_6ghz
 =„eq->scan_6ghz;

791 
	`rcu_assign_poš‹r
(
loÿl
->
sÿn_»q
, 
»q
);

792 
	`rcu_assign_poš‹r
(
loÿl
->
sÿn_sd©a
, 
sd©a
);

794 ià(
»q
->
æags
 & 
NL80211_SCAN_FLAG_RANDOM_ADDR
)

795 
	`g‘_¿ndom_mask_addr
(
loÿl
->
sÿn_addr
,

796 
»q
->
mac_addr
,

797 
»q
->
mac_addr_mask
);

799 
	`memıy
(
loÿl
->
sÿn_addr
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

801 ià(
hw_sÿn
) {

802 
	`__£t_b™
(
SCAN_HW_SCANNING
, &
loÿl
->
sÿÂšg
);

803 } ià((
»q
->
n_chªÃls
 == 1) &&

804 (
»q
->
chªÃls
[0] =ğ
loÿl
->
hw
.
cÚf
.
chªdef
.
chª
)) {

809 
Ãxt_d–ay
;

811 
	`__£t_b™
(
SCAN_ONCHANNEL_SCANNING
, &
loÿl
->
sÿÂšg
);

813 
	`›“80211_»ÿlc_idË
(
loÿl
);

817 
	`drv_sw_sÿn_¡¬t
(
loÿl
, 
sd©a
,†oÿl->
sÿn_addr
);

819 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

822 
	`›“80211_hw_cÚf_chª
(
loÿl
);

824 ià((
»q
->
chªÃls
[0]->
æags
 & (
IEEE80211_CHAN_NO_IR
 |

825 
IEEE80211_CHAN_RADAR
)) ||

826 !
»q
->
n_ssids
) {

827 
Ãxt_d–ay
 = 
IEEE80211_PASSIVE_CHANNEL_TIME
;

828 ià(
»q
->
n_ssids
)

829 
	`£t_b™
(
SCAN_BEACON_WAIT
, &
loÿl
->
sÿÂšg
);

831 
	`›“80211_sÿn_¡©e_£nd_´obe
(
loÿl
, &
Ãxt_d–ay
);

832 
Ãxt_d–ay
 = 
IEEE80211_CHANNEL_TIME
;

836 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
,

837 
Ãxt_d–ay
);

841 
	`__£t_b™
(
SCAN_SW_SCANNING
, &
loÿl
->
sÿÂšg
);

844 
	`›“80211_»ÿlc_idË
(
loÿl
);

846 ià(
hw_sÿn
) {

847 
	`WARN_ON
(!
	`›“80211_´•_hw_sÿn
(
sd©a
));

848 
rc
 = 
	`drv_hw_sÿn
(
loÿl
, 
sd©a
,†oÿl->
hw_sÿn_»q
);

850 
rc
 = 
	`›“80211_¡¬t_sw_sÿn
(
loÿl
, 
sd©a
);

853 ià(
rc
) {

854 
	`kä“
(
loÿl
->
hw_sÿn_»q
);

855 
loÿl
->
hw_sÿn_»q
 = 
NULL
;

856 
loÿl
->
sÿÂšg
 = 0;

858 
	`›“80211_»ÿlc_idË
(
loÿl
);

860 
loÿl
->
sÿn_»q
 = 
NULL
;

861 
	`RCU_INIT_POINTER
(
loÿl
->
sÿn_sd©a
, 
NULL
);

864 ià(
hw_sÿn
 && 
rc
 == 1) {

869 ià(
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
) ==

870 
NL80211_IFTYPE_P2P_GO
)

871  -
EOPNOTSUPP
;

872 
hw_sÿn
 = 
çl£
;

873 
agaš
;

876  
rc
;

877 
	}
}

880 
	$›“80211_sÿn_g‘_chªÃl_time
(
›“80211_chªÃl
 *
chª
)

886 ià(
chª
->
æags
 & (
IEEE80211_CHAN_NO_IR
 | 
IEEE80211_CHAN_RADAR
))

887  
IEEE80211_PASSIVE_CHANNEL_TIME
;

888  
IEEE80211_PROBE_DELAY
 + 
IEEE80211_CHANNEL_TIME
;

889 
	}
}

891 
	$›“80211_sÿn_¡©e_decisiÚ
(
›“80211_loÿl
 *
loÿl
,

892 *
Ãxt_d–ay
)

894 
boŞ
 
assocŸ‹d
 = 
çl£
;

895 
boŞ
 
tx_em±y
 = 
Œue
;

896 
boŞ
 
bad_Ï‹ncy
;

897 
›“80211_sub_if_d©a
 *
sd©a
;

898 
›“80211_chªÃl
 *
Ãxt_chª
;

899 
mac80211_sÿn_¡©e
 
Ãxt_sÿn_¡©e
;

900 
cfg80211_sÿn_»que¡
 *
sÿn_»q
;

902 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

909 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

910 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

913 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

914 ià(
sd©a
->
u
.
mgd
.
assocŸ‹d
) {

915 
assocŸ‹d
 = 
Œue
;

917 ià(!
	`qdisc_®l_tx_em±y
(
sd©a
->
dev
)) {

918 
tx_em±y
 = 
çl£
;

925 
sÿn_»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_req,

926 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

928 
Ãxt_chª
 = 
sÿn_»q
->
chªÃls
[
loÿl
->
sÿn_chªÃl_idx
];

938 
bad_Ï‹ncy
 = 
	`time_aá”
(
jiff›s
 +

939 
	`›“80211_sÿn_g‘_chªÃl_time
(
Ãxt_chª
),

940 
loÿl
->
Ëave_İ”_chªÃl_time
 + 
HZ
 / 8);

942 ià(
assocŸ‹d
 && !
tx_em±y
) {

943 ià(
sÿn_»q
->
æags
 & 
NL80211_SCAN_FLAG_LOW_PRIORITY
)

944 
Ãxt_sÿn_¡©e
 = 
SCAN_ABORT
;

946 
Ãxt_sÿn_¡©e
 = 
SCAN_SUSPEND
;

947 } ià(
assocŸ‹d
 && 
bad_Ï‹ncy
) {

948 
Ãxt_sÿn_¡©e
 = 
SCAN_SUSPEND
;

950 
Ãxt_sÿn_¡©e
 = 
SCAN_SET_CHANNEL
;

953 
loÿl
->
Ãxt_sÿn_¡©e
 =‚ext_scan_state;

955 *
Ãxt_d–ay
 = 0;

956 
	}
}

958 
	$›“80211_sÿn_¡©e_£t_chªÃl
(
›“80211_loÿl
 *
loÿl
,

959 *
Ãxt_d–ay
)

961 
sk
;

962 
›“80211_chªÃl
 *
chª
;

963 
cfg80211_sÿn_»que¡
 *
sÿn_»q
;

965 
sÿn_»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_req,

966 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

968 
sk
 = 0;

969 
chª
 = 
sÿn_»q
->
chªÃls
[
loÿl
->
sÿn_chªÃl_idx
];

971 
loÿl
->
sÿn_chªdef
.
chª
 = chan;

972 
loÿl
->
sÿn_chªdef
.
ûÁ”_äeq1
 = 
chª
->
ûÁ”_äeq
;

973 
loÿl
->
sÿn_chªdef
.
äeq1_off£t
 = 
chª
->
äeq_off£t
;

974 
loÿl
->
sÿn_chªdef
.
ûÁ”_äeq2
 = 0;

979 ià(
chª
->
bªd
 =ğ
NL80211_BAND_S1GHZ
) {

980 
loÿl
->
sÿn_chªdef
.
width
 = 
	`›“80211_s1g_chªÃl_width
(
chª
);

981 
£t_chªÃl
;

987 ià(
chª
 =ğ
loÿl
->
hw
.
cÚf
.
chªdef
.chan)

988 
loÿl
->
sÿn_chªdef
 =†oÿl->
hw
.
cÚf
.
chªdef
;

990 
loÿl
->
sÿn_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

992 
£t_chªÃl
:

993 ià(
	`›“80211_hw_cÚf_chª
(
loÿl
))

994 
sk
 = 1;

997 
loÿl
->
sÿn_chªÃl_idx
++;

999 ià(
sk
) {

1001 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_DECISION
;

1015 ià((
chª
->
æags
 & (
IEEE80211_CHAN_NO_IR
 | 
IEEE80211_CHAN_RADAR
)) ||

1016 !
sÿn_»q
->
n_ssids
) {

1017 *
Ãxt_d–ay
 = 
	`m£cs_to_jiff›s
(
sÿn_»q
->
du¿tiÚ
) >

1018 
IEEE80211_PASSIVE_CHANNEL_TIME
 ?

1019 
	`m£cs_to_jiff›s
(
sÿn_»q
->
du¿tiÚ
) :

1020 
IEEE80211_PASSIVE_CHANNEL_TIME
;

1021 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_DECISION
;

1022 ià(
sÿn_»q
->
n_ssids
)

1023 
	`£t_b™
(
SCAN_BEACON_WAIT
, &
loÿl
->
sÿÂšg
);

1028 *
Ãxt_d–ay
 = 
IEEE80211_PROBE_DELAY
;

1029 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_SEND_PROBE
;

1030 
	}
}

1032 
	$›“80211_sÿn_¡©e_su¥’d
(
›“80211_loÿl
 *
loÿl
,

1033 *
Ãxt_d–ay
)

1036 
loÿl
->
sÿn_chªdef
.
chª
 = 
NULL
;

1037 
	`›“80211_hw_cÚf_chª
(
loÿl
);

1040 
	`›“80211_offchªÃl_»tuº
(
loÿl
);

1042 *
Ãxt_d–ay
 = 
HZ
 / 5;

1044 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_RESUME
;

1045 
	}
}

1047 
	$›“80211_sÿn_¡©e_»sume
(
›“80211_loÿl
 *
loÿl
,

1048 *
Ãxt_d–ay
)

1050 
	`›“80211_offchªÃl_¡İ_vifs
(
loÿl
);

1052 ià(
loÿl
->
İs
->
æush
) {

1053 
	`›“80211_æush_queues
(
loÿl
, 
NULL
, 
çl£
);

1054 *
Ãxt_d–ay
 = 0;

1056 *
Ãxt_d–ay
 = 
HZ
 / 10;

1059 
loÿl
->
Ëave_İ”_chªÃl_time
 = 
jiff›s
;

1062 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_SET_CHANNEL
;

1063 
	}
}

1065 
	$›“80211_sÿn_wÜk
(
why
 *why, 
why_wÜk
 *
wÜk
)

1067 
›“80211_loÿl
 *
loÿl
 =

1068 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
sÿn_wÜk
.work);

1069 
›“80211_sub_if_d©a
 *
sd©a
;

1070 
cfg80211_sÿn_»que¡
 *
sÿn_»q
;

1071 
Ãxt_d–ay
 = 0;

1072 
boŞ
 
abÜ‹d
;

1074 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1076 ià(!
	`›“80211_ÿn_run_wÜk”
(
loÿl
)) {

1077 
abÜ‹d
 = 
Œue
;

1078 
out_com¶‘e
;

1081 
sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->
sÿn_sd©a
,

1082 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1083 
sÿn_»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->scan_req,

1084 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1087 ià(
	`‹¡_b™
(
SCAN_ONCHANNEL_SCANNING
, &
loÿl
->
sÿÂšg
)) {

1088 
abÜ‹d
 = 
	`‹¡_ªd_ş—r_b™
(
SCAN_ABORTED
, &
loÿl
->
sÿÂšg
);

1089 
out_com¶‘e
;

1092 ià(
	`‹¡_ªd_ş—r_b™
(
SCAN_COMPLETED
, &
loÿl
->
sÿÂšg
)) {

1093 
abÜ‹d
 = 
	`‹¡_ªd_ş—r_b™
(
SCAN_ABORTED
, &
loÿl
->
sÿÂšg
);

1094 
out_com¶‘e
;

1097 ià(!
sd©a
 || !
sÿn_»q
)

1100 ià(!
loÿl
->
sÿÂšg
) {

1101 
rc
;

1103 
	`RCU_INIT_POINTER
(
loÿl
->
sÿn_»q
, 
NULL
);

1104 
	`RCU_INIT_POINTER
(
loÿl
->
sÿn_sd©a
, 
NULL
);

1106 
rc
 = 
	`__›“80211_¡¬t_sÿn
(
sd©a
, 
sÿn_»q
);

1107 ià(!
rc
)

1110 
	`rcu_assign_poš‹r
(
loÿl
->
sÿn_»q
, scan_req);

1111 
abÜ‹d
 = 
Œue
;

1112 
out_com¶‘e
;

1115 
	`ş—r_b™
(
SCAN_BEACON_WAIT
, &
loÿl
->
sÿÂšg
);

1122 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

1123 
abÜ‹d
 = 
Œue
;

1124 
out_com¶‘e
;

1127 ià(
	`‹¡_ªd_ş—r_b™
(
SCAN_BEACON_DONE
, &
loÿl
->
sÿÂšg
) &&

1128 
loÿl
->
Ãxt_sÿn_¡©e
 =ğ
SCAN_DECISION
)

1129 
loÿl
->
Ãxt_sÿn_¡©e
 = 
SCAN_SEND_PROBE
;

1131 
loÿl
->
Ãxt_sÿn_¡©e
) {

1132 
SCAN_DECISION
:

1134 ià(
loÿl
->
sÿn_chªÃl_idx
 >ğ
sÿn_»q
->
n_chªÃls
) {

1135 
abÜ‹d
 = 
çl£
;

1136 
out_com¶‘e
;

1138 
	`›“80211_sÿn_¡©e_decisiÚ
(
loÿl
, &
Ãxt_d–ay
);

1140 
SCAN_SET_CHANNEL
:

1141 
	`›“80211_sÿn_¡©e_£t_chªÃl
(
loÿl
, &
Ãxt_d–ay
);

1143 
SCAN_SEND_PROBE
:

1144 
	`›“80211_sÿn_¡©e_£nd_´obe
(
loÿl
, &
Ãxt_d–ay
);

1146 
SCAN_SUSPEND
:

1147 
	`›“80211_sÿn_¡©e_su¥’d
(
loÿl
, &
Ãxt_d–ay
);

1149 
SCAN_RESUME
:

1150 
	`›“80211_sÿn_¡©e_»sume
(
loÿl
, &
Ãxt_d–ay
);

1152 
SCAN_ABORT
:

1153 
abÜ‹d
 = 
Œue
;

1154 
out_com¶‘e
;

1156 } 
Ãxt_d–ay
 == 0);

1158 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
,

1159 
Ãxt_d–ay
);

1162 
out_com¶‘e
:

1163 
	`__›“80211_sÿn_com¶‘ed
(&
loÿl
->
hw
, 
abÜ‹d
);

1164 
	}
}

1166 
	$›“80211_»que¡_sÿn
(
›“80211_sub_if_d©a
 *
sd©a
,

1167 
cfg80211_sÿn_»que¡
 *
»q
)

1169 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1171  
	`__›“80211_¡¬t_sÿn
(
sd©a
, 
»q
);

1172 
	}
}

1174 
	$›“80211_»que¡_ibss_sÿn
(
›“80211_sub_if_d©a
 *
sd©a
,

1175 cÚ¡ 
u8
 *
ssid
, u8 
ssid_Ën
,

1176 
›“80211_chªÃl
 **
chªÃls
,

1177 
n_chªÃls
)

1179 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1180 
»t
 = -
EBUSY
, 
i
, 
n_ch
 = 0;

1181 
Æ80211_bªd
 
bªd
;

1183 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1186 ià(
loÿl
->
sÿn_»q
)

1187 
uÆock
;

1190 ià(!
chªÃls
) {

1191 
max_n
;

1193 
bªd
 = 0; bªd < 
NUM_NL80211_BANDS
; band++) {

1194 ià(!
loÿl
->
hw
.
why
->
bªds
[
bªd
] ||

1195 
bªd
 =ğ
NL80211_BAND_6GHZ
)

1198 
max_n
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
]->
n_chªÃls
;

1199 
i
 = 0; i < 
max_n
; i++) {

1200 
›“80211_chªÃl
 *
tmp_ch
 =

1201 &
loÿl
->
hw
.
why
->
bªds
[
bªd
]->
chªÃls
[
i
];

1203 ià(
tmp_ch
->
æags
 & (
IEEE80211_CHAN_NO_IR
 |

1204 
IEEE80211_CHAN_DISABLED
))

1207 
loÿl
->
št_sÿn_»q
->
chªÃls
[
n_ch
] = 
tmp_ch
;

1208 
n_ch
++;

1212 ià(
	`WARN_ON_ONCE
(
n_ch
 == 0))

1213 
uÆock
;

1215 
loÿl
->
št_sÿn_»q
->
n_chªÃls
 = 
n_ch
;

1217 
i
 = 0; i < 
n_chªÃls
; i++) {

1218 ià(
chªÃls
[
i
]->
æags
 & (
IEEE80211_CHAN_NO_IR
 |

1219 
IEEE80211_CHAN_DISABLED
))

1222 
loÿl
->
št_sÿn_»q
->
chªÃls
[
n_ch
] = chªÃls[
i
];

1223 
n_ch
++;

1226 ià(
	`WARN_ON_ONCE
(
n_ch
 == 0))

1227 
uÆock
;

1229 
loÿl
->
št_sÿn_»q
->
n_chªÃls
 = 
n_ch
;

1232 
loÿl
->
št_sÿn_»q
->
ssids
 = &loÿl->
sÿn_ssid
;

1233 
loÿl
->
št_sÿn_»q
->
n_ssids
 = 1;

1234 
	`memıy
(
loÿl
->
št_sÿn_»q
->
ssids
[0].
ssid
, ssid, 
IEEE80211_MAX_SSID_LEN
);

1235 
loÿl
->
št_sÿn_»q
->
ssids
[0].
ssid_Ën
 = ssid_len;

1237 
»t
 = 
	`__›“80211_¡¬t_sÿn
(
sd©a
, sd©a->
loÿl
->
št_sÿn_»q
);

1238 
uÆock
:

1239  
»t
;

1240 
	}
}

1242 
	$›“80211_sÿn_ÿnûl
(
›“80211_loÿl
 *
loÿl
)

1245 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1265 ià(!
loÿl
->
sÿn_»q
)

1273 ià(
	`‹¡_b™
(
SCAN_HW_SCANNING
, &
loÿl
->
sÿÂšg
) &&

1274 
	`‹¡_b™
(
SCAN_COMPLETED
, &
loÿl
->
sÿÂšg
)) {

1275 
	`£t_b™
(
SCAN_HW_CANCELLED
, &
loÿl
->
sÿÂšg
);

1279 ià(
	`‹¡_b™
(
SCAN_HW_SCANNING
, &
loÿl
->
sÿÂšg
)) {

1284 
	`£t_b™
(
SCAN_HW_CANCELLED
, &
loÿl
->
sÿÂšg
);

1285 ià(
loÿl
->
İs
->
ÿnûl_hw_sÿn
)

1286 
	`drv_ÿnûl_hw_sÿn
(
loÿl
,

1287 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->
sÿn_sd©a
,

1288 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
)));

1292 
	`why_d–ayed_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
);

1294 
	`mem£t
(&
loÿl
->
sÿn_šfo
, 0, (local->scan_info));

1295 
	`__›“80211_sÿn_com¶‘ed
(&
loÿl
->
hw
, 
Œue
);

1296 
	}
}

1298 
	$__›“80211_»que¡_sched_sÿn_¡¬t
(
›“80211_sub_if_d©a
 *
sd©a
,

1299 
cfg80211_sched_sÿn_»que¡
 *
»q
)

1301 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1302 
›“80211_sÿn_›s
 
sched_sÿn_›s
 = {};

1303 
cfg80211_chª_def
 
chªdef
;

1304 
»t
, 
i
, 
›bufsz
, 
num_bªds
 = 0;

1305 
u32
 
¿‹_masks
[
NUM_NL80211_BANDS
] = {};

1306 
u8
 
bªds_u£d
 = 0;

1307 
u8
 *
›
;

1308 
u32
 
æags
 = 0;

1310 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1312 
›bufsz
 = 
loÿl
->
sÿn_›s_Ën
 + 
»q
->
›_Ën
;

1314 ià(!
loÿl
->
İs
->
sched_sÿn_¡¬t
)

1315  -
EOPNOTSUPP
;

1317 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

1318 ià(
loÿl
->
hw
.
why
->
bªds
[
i
]) {

1319 
bªds_u£d
 |ğ
	`BIT
(
i
);

1320 
¿‹_masks
[
i
] = (
u32
) -1;

1321 
num_bªds
++;

1325 ià(
»q
->
æags
 & 
NL80211_SCAN_FLAG_MIN_PREQ_CONTENT
)

1326 
æags
 |ğ
IEEE80211_PROBE_FLAG_MIN_CONTENT
;

1328 
›
 = 
	`kÿÎoc
(
›bufsz
, 
num_bªds
, 
GFP_KERNEL
);

1329 ià(!
›
) {

1330 
»t
 = -
ENOMEM
;

1331 
out
;

1334 
	`›“80211_´•¬e_sÿn_chªdef
(&
chªdef
);

1336 
»t
 = 
	`›“80211_bud_´eq_›s
(
sd©a
, 
›
, 
num_bªds
 * 
›bufsz
,

1337 &
sched_sÿn_›s
, 
»q
->
›
,

1338 
»q
->
›_Ën
, 
bªds_u£d
, 
¿‹_masks
,

1339 &
chªdef
, 
æags
);

1340 ià(
»t
 < 0)

1341 
”rÜ
;

1343 
»t
 = 
	`drv_sched_sÿn_¡¬t
(
loÿl
, 
sd©a
, 
»q
, &
sched_sÿn_›s
);

1344 ià(
»t
 == 0) {

1345 
	`rcu_assign_poš‹r
(
loÿl
->
sched_sÿn_sd©a
, 
sd©a
);

1346 
	`rcu_assign_poš‹r
(
loÿl
->
sched_sÿn_»q
, 
»q
);

1349 
”rÜ
:

1350 
	`kä“
(
›
);

1351 
out
:

1352 ià(
»t
) {

1354 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_sd©a
, 
NULL
);

1355 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_»q
, 
NULL
);

1358  
»t
;

1359 
	}
}

1361 
	$›“80211_»que¡_sched_sÿn_¡¬t
(
›“80211_sub_if_d©a
 *
sd©a
,

1362 
cfg80211_sched_sÿn_»que¡
 *
»q
)

1364 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1366 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1368 ià(
	`rcu_acûss_poš‹r
(
loÿl
->
sched_sÿn_sd©a
))

1369  -
EBUSY
;

1371  
	`__›“80211_»que¡_sched_sÿn_¡¬t
(
sd©a
, 
»q
);

1372 
	}
}

1374 
	$›“80211_»que¡_sched_sÿn_¡İ
(
›“80211_loÿl
 *
loÿl
)

1376 
›“80211_sub_if_d©a
 *
sched_sÿn_sd©a
;

1377 
»t
 = -
ENOENT
;

1379 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1381 ià(!
loÿl
->
İs
->
sched_sÿn_¡İ
)

1382  -
EOPNOTSUPP
;

1385 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_»q
, 
NULL
);

1387 
sched_sÿn_sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->sched_scan_sdata,

1388 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1389 ià(
sched_sÿn_sd©a
) {

1390 
»t
 = 
	`drv_sched_sÿn_¡İ
(
loÿl
, 
sched_sÿn_sd©a
);

1391 ià(!
»t
)

1392 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_sd©a
, 
NULL
);

1395  
»t
;

1396 
	}
}

1398 
	$›“80211_sched_sÿn_»suÉs
(
›“80211_hw
 *
hw
)

1400 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1402 
	`Œaû_­i_sched_sÿn_»suÉs
(
loÿl
);

1404 
	`cfg80211_sched_sÿn_»suÉs
(
hw
->
why
, 0);

1405 
	}
}

1406 
EXPORT_SYMBOL
(
›“80211_sched_sÿn_»suÉs
);

1408 
	$›“80211_sched_sÿn_’d
(
›“80211_loÿl
 *
loÿl
)

1410 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1412 ià(!
	`rcu_acûss_poš‹r
(
loÿl
->
sched_sÿn_sd©a
))

1415 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_sd©a
, 
NULL
);

1418 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_»q
, 
NULL
);

1420 
	`cfg80211_sched_sÿn_¡İ³d_locked
(
loÿl
->
hw
.
why
, 0);

1421 
	}
}

1423 
	$›“80211_sched_sÿn_¡İ³d_wÜk
(
why
 *wiphy,

1424 
why_wÜk
 *
wÜk
)

1426 
›“80211_loÿl
 *
loÿl
 =

1427 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
,

1428 
sched_sÿn_¡İ³d_wÜk
);

1430 
	`›“80211_sched_sÿn_’d
(
loÿl
);

1431 
	}
}

1433 
	$›“80211_sched_sÿn_¡İ³d
(
›“80211_hw
 *
hw
)

1435 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1437 
	`Œaû_­i_sched_sÿn_¡İ³d
(
loÿl
);

1444 ià(
loÿl
->
š_»cÚfig
)

1447 
	`why_wÜk_queue
(
hw
->
why
, &
loÿl
->
sched_sÿn_¡İ³d_wÜk
);

1448 
	}
}

1449 
EXPORT_SYMBOL
(
›“80211_sched_sÿn_¡İ³d
);

	@spectmgmt.c

15 
	~<lšux/›“80211.h
>

16 
	~<Ãt/cfg80211.h
>

17 
	~<Ãt/mac80211.h
>

18 
	~"›“80211_i.h
"

19 
	~"¡a_šfo.h
"

20 
	~"wme.h
"

22 
boŞ


23 
	$wbcs_–em_to_chªdef
(cÚ¡ 
›“80211_wide_bw_chªsw_›
 *
wbcs_–em
,

24 
cfg80211_chª_def
 *
chªdef
)

26 
u8
 
ccfs0
 = 
wbcs_–em
->
Ãw_ûÁ”_äeq_£g0
;

27 
u8
 
ccfs1
 = 
wbcs_–em
->
Ãw_ûÁ”_äeq_£g1
;

28 
u32
 
cf0
 = 
	`›“80211_chªÃl_to_äequ’cy
(
ccfs0
, 
chªdef
->
chª
->
bªd
);

29 
u32
 
cf1
 = 
	`›“80211_chªÃl_to_äequ’cy
(
ccfs1
, 
chªdef
->
chª
->
bªd
);

31 
wbcs_–em
->
Ãw_chªÃl_width
) {

32 
IEEE80211_VHT_CHANWIDTH_160MHZ
:

34 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_160
;

35 
chªdef
->
ûÁ”_äeq1
 = 
cf0
;

37 
IEEE80211_VHT_CHANWIDTH_80P80MHZ
:

39 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_80P80
;

40 
chªdef
->
ûÁ”_äeq1
 = 
cf0
;

41 
chªdef
->
ûÁ”_äeq2
 = 
cf1
;

43 
IEEE80211_VHT_CHANWIDTH_80MHZ
:

44 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_80
;

45 
chªdef
->
ûÁ”_äeq1
 = 
cf0
;

47 ià(
ccfs1
) {

48 
u8
 
diff
 = 
	`abs
(
ccfs0
 - 
ccfs1
);

50 ià(
diff
 == 8) {

51 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_160
;

52 
chªdef
->
ûÁ”_äeq1
 = 
cf1
;

53 } ià(
diff
 > 8) {

54 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_80P80
;

55 
chªdef
->
ûÁ”_äeq2
 = 
cf1
;

59 
IEEE80211_VHT_CHANWIDTH_USE_HT
:

64 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_40
;

65 
chªdef
->
ûÁ”_äeq1
 = 
cf0
;

69  
	`cfg80211_chªdef_v®id
(
chªdef
);

70 
	}
}

73 
	$v®id©e_chªdef_by_ht_vht_İ”
(
›“80211_sub_if_d©a
 *
sd©a
,

74 
›“80211_cÚn_£‰šgs
 *
cÚn
,

75 
u32
 
vht_ÿp_šfo
,

76 
cfg80211_chª_def
 *
chªdef
)

78 
u32
 
cÚŒŞ_äeq
, 
ûÁ”_äeq1
, 
ûÁ”_äeq2
;

79 
Æ80211_chª_width
 
chª_width
;

80 
›“80211_ht_İ”©iÚ
 
ht_İ”
;

81 
›“80211_vht_İ”©iÚ
 
vht_İ”
;

83 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_HT
 ||

84 
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_40
) {

85 
chªdef
->
chª
 = 
NULL
;

89 
cÚŒŞ_äeq
 = 
chªdef
->
chª
->
ûÁ”_äeq
;

90 
ûÁ”_äeq1
 = 
chªdef
->center_freq1;

91 
ûÁ”_äeq2
 = 
chªdef
->center_freq2;

92 
chª_width
 = 
chªdef
->
width
;

94 
ht_İ”
.
´im¬y_chª
 = 
	`›“80211_äequ’cy_to_chªÃl
(
cÚŒŞ_äeq
);

95 ià(
cÚŒŞ_äeq
 !ğ
ûÁ”_äeq1
)

96 
ht_İ”
.
ht_·¿m
 = 
cÚŒŞ_äeq
 > 
ûÁ”_äeq1
 ?

97 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
 :

98 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
;

100 
ht_İ”
.
ht_·¿m
 = 
IEEE80211_HT_PARAM_CHA_SEC_NONE
;

102 
	`›“80211_chªdef_ht_İ”
(&
ht_İ”
, 
chªdef
);

104 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

107 
vht_İ”
.
ûÁ”_äeq_£g0_idx
 =

108 
	`›“80211_äequ’cy_to_chªÃl
(
ûÁ”_äeq1
);

109 
vht_İ”
.
ûÁ”_äeq_£g1_idx
 = 
ûÁ”_äeq2
 ?

110 
	`›“80211_äequ’cy_to_chªÃl
(
ûÁ”_äeq2
) : 0;

112 
chª_width
) {

113 
NL80211_CHAN_WIDTH_320
:

114 
	`WARN_ON
(1);

116 
NL80211_CHAN_WIDTH_160
:

117 
vht_İ”
.
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

118 
vht_İ”
.
ûÁ”_äeq_£g1_idx
 = vht_İ”.
ûÁ”_äeq_£g0_idx
;

119 
vht_İ”
.
ûÁ”_äeq_£g0_idx
 +=

120 
cÚŒŞ_äeq
 < 
ûÁ”_äeq1
 ? -8 : 8;

122 
NL80211_CHAN_WIDTH_80P80
:

123 
vht_İ”
.
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

125 
NL80211_CHAN_WIDTH_80
:

126 
vht_İ”
.
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

129 
vht_İ”
.
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_USE_HT
;

133 
ht_İ”
.
İ”©iÚ_mode
 =

134 
	`Ë16_’code_b™s
(
vht_İ”
.
ûÁ”_äeq_£g1_idx
,

135 
IEEE80211_HT_OP_MODE_CCFS2_MASK
);

137 ià(!
	`›“80211_chªdef_vht_İ”
(&
sd©a
->
loÿl
->
hw
, 
vht_ÿp_šfo
,

138 &
vht_İ”
, &
ht_İ”
, 
chªdef
))

139 
chªdef
->
chª
 = 
NULL
;

140 
	}
}

143 
	$v®id©e_chªdef_by_6ghz_he_eht_İ”
(
›“80211_sub_if_d©a
 *
sd©a
,

144 
›“80211_cÚn_£‰šgs
 *
cÚn
,

145 
cfg80211_chª_def
 *
chªdef
)

147 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

148 
u32
 
cÚŒŞ_äeq
, 
ûÁ”_äeq1
, 
ûÁ”_äeq2
;

149 
Æ80211_chª_width
 
chª_width
;

151 
›“80211_he_İ”©iÚ
 
_İ”
;

152 
›“80211_he_6ghz_İ”
 
_6ghz_İ”
;

153 } 
__·cked
 
he
;

155 
›“80211_eht_İ”©iÚ
 
_İ”
;

156 
›“80211_eht_İ”©iÚ_šfo
 
_İ”_šfo
;

157 } 
__·cked
 
eht
;

159 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_HE
) {

160 
chªdef
->
chª
 = 
NULL
;

164 
cÚŒŞ_äeq
 = 
chªdef
->
chª
->
ûÁ”_äeq
;

165 
ûÁ”_äeq1
 = 
chªdef
->center_freq1;

166 
ûÁ”_äeq2
 = 
chªdef
->center_freq2;

167 
chª_width
 = 
chªdef
->
width
;

169 
he
.
_İ”
.
he_İ”_·¿ms
 =

170 
	`Ë32_’code_b™s
(1, 
IEEE80211_HE_OPERATION_6GHZ_OP_INFO
);

171 
he
.
_6ghz_İ”
.
´im¬y
 =

172 
	`›“80211_äequ’cy_to_chªÃl
(
cÚŒŞ_äeq
);

173 
he
.
_6ghz_İ”
.
ccfs0
 = 
	`›“80211_äequ’cy_to_chªÃl
(
ûÁ”_äeq1
);

174 
he
.
_6ghz_İ”
.
ccfs1
 = 
ûÁ”_äeq2
 ?

175 
	`›“80211_äequ’cy_to_chªÃl
(
ûÁ”_äeq2
) : 0;

177 
chª_width
) {

178 
NL80211_CHAN_WIDTH_320
:

179 
he
.
_6ghz_İ”
.
ccfs1
 = he._6ghz_İ”.
ccfs0
;

180 
he
.
_6ghz_İ”
.
ccfs0
 +ğ
cÚŒŞ_äeq
 < 
ûÁ”_äeq1
 ? -16 : 16;

181 
he
.
_6ghz_İ”
.
cÚŒŞ
 = 
IEEE80211_EHT_OPER_CHAN_WIDTH_320MHZ
;

183 
NL80211_CHAN_WIDTH_160
:

184 
he
.
_6ghz_İ”
.
ccfs1
 = he._6ghz_İ”.
ccfs0
;

185 
he
.
_6ghz_İ”
.
ccfs0
 +ğ
cÚŒŞ_äeq
 < 
ûÁ”_äeq1
 ? -8 : 8;

186 
çÎthrough
;

187 
NL80211_CHAN_WIDTH_80P80
:

188 
he
.
_6ghz_İ”
.
cÚŒŞ
 =

189 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_160MHZ
;

191 
NL80211_CHAN_WIDTH_80
:

192 
he
.
_6ghz_İ”
.
cÚŒŞ
 =

193 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_80MHZ
;

195 
NL80211_CHAN_WIDTH_40
:

196 
he
.
_6ghz_İ”
.
cÚŒŞ
 =

197 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_40MHZ
;

200 
he
.
_6ghz_İ”
.
cÚŒŞ
 =

201 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_20MHZ
;

205 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_EHT
) {

206 ià(!
	`›“80211_chªdef_he_6ghz_İ”
(
loÿl
, &
he
.
_İ”
,

207 
NULL
, 
chªdef
))

208 
chªdef
->
chª
 = 
NULL
;

210 
eht
.
_İ”
.
·¿ms
 = 
IEEE80211_EHT_OPER_INFO_PRESENT
;

211 
eht
.
_İ”_šfo
.
cÚŒŞ
 = 
he
.
_6ghz_İ”
.control;

212 
eht
.
_İ”_šfo
.
ccfs0
 = 
he
.
_6ghz_İ”
.ccfs0;

213 
eht
.
_İ”_šfo
.
ccfs1
 = 
he
.
_6ghz_İ”
.ccfs1;

215 ià(!
	`›“80211_chªdef_he_6ghz_İ”
(
loÿl
, &
he
.
_İ”
,

216 &
eht
.
_İ”
, 
chªdef
))

217 
chªdef
->
chª
 = 
NULL
;

219 
	}
}

221 
	$›“80211_·r£_ch_sw™ch_›
(
›“80211_sub_if_d©a
 *
sd©a
,

222 
›“802_11_–ems
 *
–ems
,

223 
Æ80211_bªd
 
cu¼’t_bªd
,

224 
u32
 
vht_ÿp_šfo
,

225 
›“80211_cÚn_£‰šgs
 *
cÚn
,

226 
u8
 *
bssid
,

227 
›“80211_c§_›
 *
c§_›
)

229 
Æ80211_bªd
 
Ãw_bªd
 = 
cu¼’t_bªd
;

230 
Ãw_äeq
;

231 
u8
 
Ãw_chª_no
 = 0, 
Ãw_İ_şass
 = 0;

232 
›“80211_chªÃl
 *
Ãw_chª
;

233 
cfg80211_chª_def
 
Ãw_chªdef
 = {};

234 cÚ¡ 
›“80211_£c_chª_offs_›
 *
£c_chª_offs
;

235 cÚ¡ 
›“80211_wide_bw_chªsw_›
 *
wide_bw_chªsw_›
;

236 cÚ¡ 
›“80211_bªdwidth_šdiÿtiÚ
 *
bwi
;

237 cÚ¡ 
›“80211_ext_chªsw_›
 *
ext_chªsw_–em
;

238 
£cÚd¬y_chªÃl_off£t
 = -1;

240 
	`mem£t
(
c§_›
, 0, (*csa_ie));

242 
£c_chª_offs
 = 
–ems
->sec_chan_offs;

243 
wide_bw_chªsw_›
 = 
–ems
->wide_bw_chansw_ie;

244 
bwi
 = 
–ems
->
bªdwidth_šdiÿtiÚ
;

245 
ext_chªsw_–em
 = 
–ems
->
ext_chªsw_›
;

247 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_HT
 ||

248 
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_40
) {

249 
£c_chª_offs
 = 
NULL
;

250 
wide_bw_chªsw_›
 = 
NULL
;

253 ià(
cÚn
->
mode
 < 
IEEE80211_CONN_MODE_VHT
)

254 
wide_bw_chªsw_›
 = 
NULL
;

256 ià(
ext_chªsw_–em
) {

257 
Ãw_İ_şass
 = 
ext_chªsw_–em
->
Ãw_İ”©šg_şass
;

259 ià(!
	`›“80211_İ”©šg_şass_to_bªd
(
Ãw_İ_şass
, &
Ãw_bªd
)) {

260 
Ãw_İ_şass
 = 0;

261 
	`sd©a_šfo
(
sd©a
, "cannot understand ECSA IE operating class, %d, ignoring\n",

262 
ext_chªsw_–em
->
Ãw_İ”©šg_şass
);

264 
Ãw_chª_no
 = 
ext_chªsw_–em
->
Ãw_ch_num
;

265 
c§_›
->
couÁ
 = 
ext_chªsw_–em
->count;

266 
c§_›
->
mode
 = 
ext_chªsw_–em
->mode;

270 ià(!
Ãw_İ_şass
 && 
–ems
->
ch_sw™ch_›
) {

271 
Ãw_chª_no
 = 
–ems
->
ch_sw™ch_›
->
Ãw_ch_num
;

272 
c§_›
->
couÁ
 = 
–ems
->
ch_sw™ch_›
->count;

273 
c§_›
->
mode
 = 
–ems
->
ch_sw™ch_›
->mode;

277 ià(!
Ãw_chª_no
)

281 ià(
–ems
->
mesh_chªsw_·¿ms_›
) {

282 
c§_›
->
‰l
 = 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_‰l
;

283 
c§_›
->
mode
 = 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_æags
;

284 
c§_›
->
´e_v®ue
 = 
	`Ë16_to_ıu
(

285 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_´e_v®ue
);

287 ià(
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_æags
 &

288 
WLAN_EID_CHAN_SWITCH_PARAM_REASON
)

289 
c§_›
->
»asÚ_code
 = 
	`Ë16_to_ıu
(

290 
–ems
->
mesh_chªsw_·¿ms_›
->
mesh_»asÚ
);

293 
Ãw_äeq
 = 
	`›“80211_chªÃl_to_äequ’cy
(
Ãw_chª_no
, 
Ãw_bªd
);

294 
Ãw_chª
 = 
	`›“80211_g‘_chªÃl
(
sd©a
->
loÿl
->
hw
.
why
, 
Ãw_äeq
);

295 ià(!
Ãw_chª
 ||‚ew_chª->
æags
 & 
IEEE80211_CHAN_DISABLED
) {

296 
	`sd©a_šfo
(
sd©a
,

298 
bssid
, 
Ãw_äeq
);

299  -
EINVAL
;

302 ià(
£c_chª_offs
) {

303 
£cÚd¬y_chªÃl_off£t
 = 
£c_chª_offs
->sec_chan_offs;

304 } ià(
cÚn
->
mode
 >ğ
IEEE80211_CONN_MODE_HT
) {

309 
£cÚd¬y_chªÃl_off£t
 = 
IEEE80211_HT_PARAM_CHA_SEC_NONE
;

312 
£cÚd¬y_chªÃl_off£t
) {

315 
IEEE80211_HT_PARAM_CHA_SEC_NONE
:

316 
	`cfg80211_chªdef_ü—‹
(&
c§_›
->
chª»q
.
İ”
, 
Ãw_chª
,

317 
NL80211_CHAN_HT20
);

319 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
:

320 
	`cfg80211_chªdef_ü—‹
(&
c§_›
->
chª»q
.
İ”
, 
Ãw_chª
,

321 
NL80211_CHAN_HT40PLUS
);

323 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
:

324 
	`cfg80211_chªdef_ü—‹
(&
c§_›
->
chª»q
.
İ”
, 
Ãw_chª
,

325 
NL80211_CHAN_HT40MINUS
);

328 
	`cfg80211_chªdef_ü—‹
(&
c§_›
->
chª»q
.
İ”
, 
Ãw_chª
,

329 
NL80211_CHAN_NO_HT
);

331 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
) {

332 
NL80211_CHAN_WIDTH_5
:

333 
NL80211_CHAN_WIDTH_10
:

334 
c§_›
->
chª»q
.
İ”
.
width
 =

335 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.
width
;

344 
	`mem£t
(&
Ãw_chªdef
, 0, (new_chandef));

345 
Ãw_chªdef
.
chª
 = 
Ãw_chª
;

346 ià(
bwi
) {

348 
Ãw_chªdef
 = 
c§_›
->
chª»q
.
İ”
;

350 
	`›“80211_chªdef_eht_İ”
(&
bwi
->
šfo
, &
Ãw_chªdef
);

351 } ià(!
wide_bw_chªsw_›
 || !
	`wbcs_–em_to_chªdef
(wide_bw_chansw_ie,

352 &
Ãw_chªdef
)) {

353 ià(!
	`›“80211_İ”©šg_şass_to_chªdef
(
Ãw_İ_şass
, 
Ãw_chª
,

354 &
Ãw_chªdef
))

355 
Ãw_chªdef
 = 
c§_›
->
chª»q
.
İ”
;

359 ià(
Ãw_bªd
 =ğ
NL80211_BAND_6GHZ
)

360 
	`v®id©e_chªdef_by_6ghz_he_eht_İ”
(
sd©a
, 
cÚn
, &
Ãw_chªdef
);

362 
	`v®id©e_chªdef_by_ht_vht_İ”
(
sd©a
, 
cÚn
, 
vht_ÿp_šfo
,

363 &
Ãw_chªdef
);

366 ià(
Ãw_chªdef
.
chª
) {

367 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_320
 &&

368 
Ãw_chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_320
)

369 
	`›“80211_chªdef_downg¿de
(&
Ãw_chªdef
, 
NULL
);

371 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_160
 &&

372 (
Ãw_chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_80P80
 ||

373 
Ãw_chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_160
))

374 
	`›“80211_chªdef_downg¿de
(&
Ãw_chªdef
, 
NULL
);

376 ià(!
	`cfg80211_chªdef_com·tibË
(&
Ãw_chªdef
,

377 &
c§_›
->
chª»q
.
İ”
)) {

378 
	`sd©a_šfo
(
sd©a
,

380 
bssid
);

381  -
EINVAL
;

384 
c§_›
->
chª»q
.
İ”
 = 
Ãw_chªdef
;

387 ià(
–ems
->
max_chªÃl_sw™ch_time
)

388 
c§_›
->
max_sw™ch_time
 =

389 (
–ems
->
max_chªÃl_sw™ch_time
[0] << 0) |

390 (
–ems
->
max_chªÃl_sw™ch_time
[1] << 8) |

391 (
–ems
->
max_chªÃl_sw™ch_time
[2] << 16);

394 
	}
}

396 
	$›“80211_£nd_»fu£_m—su»m’t_»que¡
(
›“80211_sub_if_d©a
 *
sd©a
,

397 
›“80211_m¤m’t_›
 *
»que¡_›
,

398 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
bssid
,

399 
u8
 
dŸlog_tok’
)

401 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

402 
sk_buff
 *
skb
;

403 
›“80211_mgmt
 *
m¤_»pÜt
;

405 
skb
 = 
	`dev_®loc_skb
((*
m¤_»pÜt
è+ 
loÿl
->
hw
.
exŒa_tx_h—droom
 +

406 (
›“80211_m¤m’t_›
));

407 ià(!
skb
)

410 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

411 
m¤_»pÜt
 = 
	`skb_put_z”o
(
skb
, 24);

412 
	`memıy
(
m¤_»pÜt
->
da
, da, 
ETH_ALEN
);

413 
	`memıy
(
m¤_»pÜt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

414 
	`memıy
(
m¤_»pÜt
->
bssid
, bssid, 
ETH_ALEN
);

415 
m¤_»pÜt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

416 
IEEE80211_STYPE_ACTION
);

418 
	`skb_put
(
skb
, 1 + (
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
));

419 
m¤_»pÜt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_SPECTRUM_MGMT
;

420 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
aùiÚ_code
 =

421 
WLAN_ACTION_SPCT_MSR_RPRT
;

422 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
dŸlog_tok’
 = dialog_token;

424 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
–em’t_id
 = 
WLAN_EID_MEASURE_REPORT
;

425 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
Ëngth
 =

426 (
›“80211_m¤m’t_›
);

428 
	`mem£t
(&
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
m¤_–em
, 0,

429 (
›“80211_m¤m’t_›
));

430 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
m¤_–em
.
tok’
 = 
»que¡_›
->token;

431 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
m¤_–em
.
mode
 |=

432 
IEEE80211_SPCT_MSR_RPRT_MODE_REFUSED
;

433 
m¤_»pÜt
->
u
.
aùiÚ
.u.
m—su»m’t
.
m¤_–em
.
ty³
 = 
»que¡_›
->type;

435 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

436 
	}
}

438 
	$›“80211_´oûss_m—su»m’t_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

439 
›“80211_mgmt
 *
mgmt
,

440 
size_t
 
Ën
)

449 
	`›“80211_£nd_»fu£_m—su»m’t_»que¡
(
sd©a
,

450 &
mgmt
->
u
.
aùiÚ
.u.
m—su»m’t
.
m¤_–em
,

451 
mgmt
->
§
, mgmt->
bssid
,

452 
mgmt
->
u
.
aùiÚ
.u.
m—su»m’t
.
dŸlog_tok’
);

453 
	}
}

	@sta_info.c

10 
	~<lšux/moduË.h
>

11 
	~<lšux/š™.h
>

12 
	~<lšux/‘h”deviû.h
>

13 
	~<lšux/Ãtdeviû.h
>

14 
	~<lšux/ty³s.h
>

15 
	~<lšux/¦ab.h
>

16 
	~<lšux/skbuff.h
>

17 
	~<lšux/if_¬p.h
>

18 
	~<lšux/tim”.h
>

19 
	~<lšux/¹Ãšk.h
>

21 
	~<Ãt/cod–.h
>

22 
	~<Ãt/mac80211.h
>

23 
	~"›“80211_i.h
"

24 
	~"driv”-İs.h
"

25 
	~"¿‹.h
"

26 
	~"¡a_šfo.h
"

27 
	~"debugfs_¡a.h
"

28 
	~"mesh.h
"

29 
	~"wme.h
"

67 
	s¡a_lšk_®loc
 {

68 
lšk_¡a_šfo
 
	mšfo
;

69 
›“80211_lšk_¡a
 
	m¡a
;

70 
rcu_h—d
 
	mrcu_h—d
;

73 cÚ¡ 
rhashbË_·¿ms
 
	g¡a_rht_·¿ms
 = {

74 .
ÃËm_hšt
 = 3,

75 .
	gautom©ic_shrškšg
 = 
Œue
,

76 .
	gh—d_off£t
 = 
off£tof
(
¡a_šfo
, 
hash_node
),

77 .
	gkey_off£t
 = 
off£tof
(
¡a_šfo
, 
addr
),

78 .
	gkey_Ën
 = 
ETH_ALEN
,

79 .
	gmax_size
 = 
CONFIG_MAC80211_STA_HASH_MAX_SIZE
,

82 cÚ¡ 
rhashbË_·¿ms
 
	glšk_¡a_rht_·¿ms
 = {

83 .
ÃËm_hšt
 = 3,

84 .
	gautom©ic_shrškšg
 = 
Œue
,

85 .
	gh—d_off£t
 = 
off£tof
(
lšk_¡a_šfo
, 
lšk_hash_node
),

86 .
	gkey_off£t
 = 
off£tof
(
lšk_¡a_šfo
, 
addr
),

87 .
	gkey_Ën
 = 
ETH_ALEN
,

88 .
	gmax_size
 = 
CONFIG_MAC80211_STA_HASH_MAX_SIZE
,

91 
	$¡a_šfo_hash_d–
(
›“80211_loÿl
 *
loÿl
,

92 
¡a_šfo
 *
¡a
)

94  
	`rhÉabË_»move
(&
loÿl
->
¡a_hash
, &
¡a
->
hash_node
,

95 
¡a_rht_·¿ms
);

96 
	}
}

98 
	$lšk_¡a_šfo_hash_add
(
›“80211_loÿl
 *
loÿl
,

99 
lšk_¡a_šfo
 *
lšk_¡a
)

101 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

103  
	`rhÉabË_š£¹
(&
loÿl
->
lšk_¡a_hash
,

104 &
lšk_¡a
->
lšk_hash_node
, 
lšk_¡a_rht_·¿ms
);

105 
	}
}

107 
	$lšk_¡a_šfo_hash_d–
(
›“80211_loÿl
 *
loÿl
,

108 
lšk_¡a_šfo
 *
lšk_¡a
)

110 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

112  
	`rhÉabË_»move
(&
loÿl
->
lšk_¡a_hash
,

113 &
lšk_¡a
->
lšk_hash_node
, 
lšk_¡a_rht_·¿ms
);

114 
	}
}

116 
	$›“80211_purge_¡a_txqs
(
¡a_šfo
 *
¡a
)

118 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

119 
i
;

121 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->¡a.
txq
); i++) {

122 
txq_šfo
 *
txqi
;

124 ià(!
¡a
->¡a.
txq
[
i
])

127 
txqi
 = 
	`to_txq_šfo
(
¡a
->¡a.
txq
[
i
]);

129 
	`›“80211_txq_purge
(
loÿl
, 
txqi
);

131 
	}
}

133 
	$__ş—nup_sšgË_¡a
(
¡a_šfo
 *
¡a
)

135 
ac
, 
i
;

136 
tid_ampdu_tx
 *
tid_tx
;

137 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

138 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

139 
ps_d©a
 *
ps
;

141 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) ||

142 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
) ||

143 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
)) {

144 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

145 
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

146 
ps
 = &
sd©a
->
bss
->ps;

147 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

148 
ps
 = &
sd©a
->
u
.
mesh
.ps;

152 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
);

153 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
);

154 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
);

156 
	`©omic_dec
(&
ps
->
num_¡a_ps
);

159 
	`›“80211_purge_¡a_txqs
(
¡a
);

161 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

162 
loÿl
->
tÙ®_ps_bufã»d
 -ğ
	`skb_queue_Ën
(&
¡a
->
ps_tx_buf
[
ac
]);

163 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
, &
¡a
->
ps_tx_buf
[
ac
]);

164 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
, &
¡a
->
tx_f‹»d
[
ac
]);

167 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

168 
	`mesh_¡a_ş—nup
(
¡a
);

170 
	`ÿnûl_wÜk_sync
(&
¡a
->
drv_d–iv”_wk
);

178 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++) {

179 
	`kä“
(
¡a
->
ampdu_mlme
.
tid_¡¬t_tx
[
i
]);

180 
tid_tx
 = 
	`rcu_d”eã»nû_¿w
(
¡a
->
ampdu_mlme
.tid_tx[
i
]);

181 ià(!
tid_tx
)

183 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
, &
tid_tx
->
³ndšg
);

184 
	`kä“
(
tid_tx
);

186 
	}
}

188 
	$ş—nup_sšgË_¡a
(
¡a_šfo
 *
¡a
)

190 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

191 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

193 
	`__ş—nup_sšgË_¡a
(
¡a
);

194 
	`¡a_šfo_ä“
(
loÿl
, 
¡a
);

195 
	}
}

197 
rhli¡_h—d
 *
	$¡a_šfo_hash_lookup
(
›“80211_loÿl
 *
loÿl
,

198 cÚ¡ 
u8
 *
addr
)

200  
	`rhÉabË_lookup
(&
loÿl
->
¡a_hash
, 
addr
, 
¡a_rht_·¿ms
);

201 
	}
}

204 
¡a_šfo
 *
	$¡a_šfo_g‘
(
›“80211_sub_if_d©a
 *
sd©a
,

205 cÚ¡ 
u8
 *
addr
)

207 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

208 
rhli¡_h—d
 *
tmp
;

209 
¡a_šfo
 *
¡a
;

211 
	`rcu_»ad_lock
();

212 
	`fÜ_—ch_¡a_šfo
(
loÿl
, 
addr
, 
¡a
, 
tmp
) {

213 ià(
¡a
->
sd©a
 == sdata) {

214 
	`rcu_»ad_uÆock
();

218  
¡a
;

221 
	`rcu_»ad_uÆock
();

222  
NULL
;

223 
	}
}

229 
¡a_šfo
 *
	$¡a_šfo_g‘_bss
(
›“80211_sub_if_d©a
 *
sd©a
,

230 cÚ¡ 
u8
 *
addr
)

232 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

233 
rhli¡_h—d
 *
tmp
;

234 
¡a_šfo
 *
¡a
;

236 
	`rcu_»ad_lock
();

237 
	`fÜ_—ch_¡a_šfo
(
loÿl
, 
addr
, 
¡a
, 
tmp
) {

238 ià(
¡a
->
sd©a
 == sdata ||

239 (
¡a
->
sd©a
->
bss
 && sta->sdata->bss == sdata->bss)) {

240 
	`rcu_»ad_uÆock
();

244  
¡a
;

247 
	`rcu_»ad_uÆock
();

248  
NULL
;

249 
	}
}

251 
rhli¡_h—d
 *
	$lšk_¡a_šfo_hash_lookup
(
›“80211_loÿl
 *
loÿl
,

252 cÚ¡ 
u8
 *
addr
)

254  
	`rhÉabË_lookup
(&
loÿl
->
lšk_¡a_hash
, 
addr
,

255 
lšk_¡a_rht_·¿ms
);

256 
	}
}

258 
lšk_¡a_šfo
 *

259 
	$lšk_¡a_šfo_g‘_bss
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
addr
)

261 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

262 
rhli¡_h—d
 *
tmp
;

263 
lšk_¡a_šfo
 *
lšk_¡a
;

265 
	`rcu_»ad_lock
();

266 
	`fÜ_—ch_lšk_¡a_šfo
(
loÿl
, 
addr
, 
lšk_¡a
, 
tmp
) {

267 
¡a_šfo
 *
¡a
 = 
lšk_¡a
->sta;

269 ià(
¡a
->
sd©a
 == sdata ||

270 (
¡a
->
sd©a
->
bss
 && sta->sdata->bss == sdata->bss)) {

271 
	`rcu_»ad_uÆock
();

275  
lšk_¡a
;

278 
	`rcu_»ad_uÆock
();

279  
NULL
;

280 
	}
}

282 
›“80211_¡a
 *

283 
	$›“80211_fšd_¡a_by_lšk_addrs
(
›“80211_hw
 *
hw
,

284 cÚ¡ 
u8
 *
addr
,

285 cÚ¡ 
u8
 *
loÿÏddr
,

286 *
lšk_id
)

288 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

289 
lšk_¡a_šfo
 *
lšk_¡a
;

290 
rhli¡_h—d
 *
tmp
;

292 
	`fÜ_—ch_lšk_¡a_šfo
(
loÿl
, 
addr
, 
lšk_¡a
, 
tmp
) {

293 
¡a_šfo
 *
¡a
 = 
lšk_¡a
->sta;

294 
›“80211_lšk_d©a
 *
lšk
;

295 
u8
 
_lšk_id
 = 
lšk_¡a
->
lšk_id
;

297 ià(!
loÿÏddr
) {

298 ià(
lšk_id
)

299 *
lšk_id
 = 
_lšk_id
;

300  &
¡a
->sta;

303 
lšk
 = 
	`rcu_d”eã»nû
(
¡a
->
sd©a
->lšk[
_lšk_id
]);

304 ià(!
lšk
)

307 ià(
	`memcmp
(
lšk
->
cÚf
->
addr
, 
loÿÏddr
, 
ETH_ALEN
))

310 ià(
lšk_id
)

311 *
lšk_id
 = 
_lšk_id
;

312  &
¡a
->sta;

315  
NULL
;

316 
	}
}

317 
EXPORT_SYMBOL_GPL
(
›“80211_fšd_¡a_by_lšk_addrs
);

319 
¡a_šfo
 *
	$¡a_šfo_g‘_by_addrs
(
›“80211_loÿl
 *
loÿl
,

320 cÚ¡ 
u8
 *
¡a_addr
, cÚ¡ u8 *
vif_addr
)

322 
rhli¡_h—d
 *
tmp
;

323 
¡a_šfo
 *
¡a
;

325 
	`fÜ_—ch_¡a_šfo
(
loÿl
, 
¡a_addr
, 
¡a
, 
tmp
) {

326 ià(
	`‘h”_addr_equ®
(
vif_addr
, 
¡a
->
sd©a
->
vif
.
addr
))

327  
¡a
;

330  
NULL
;

331 
	}
}

333 
¡a_šfo
 *
	$¡a_šfo_g‘_by_idx
(
›“80211_sub_if_d©a
 *
sd©a
,

334 
idx
)

336 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

337 
¡a_šfo
 *
¡a
;

338 
i
 = 0;

340 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
,

341 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
)) {

342 ià(
sd©a
 !ğ
¡a
->sdata)

344 ià(
i
 < 
idx
) {

345 ++
i
;

348  
¡a
;

351  
NULL
;

352 
	}
}

354 
	$¡a_šfo_ä“_lšk
(
lšk_¡a_šfo
 *
lšk_¡a
)

356 
	`ä“_³rıu
(
lšk_¡a
->
pıu_rx_¡©s
);

357 
	}
}

359 
	$¡a_»move_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
,

360 
boŞ
 
unhash
)

362 
¡a_lšk_®loc
 *
®loc
 = 
NULL
;

363 
lšk_¡a_šfo
 *
lšk_¡a
;

365 
	`lockd•_as£¹_why
(
¡a
->
loÿl
->
hw
.
why
);

367 
lšk_¡a
 = 
	`rcu_acûss_poš‹r
(
¡a
->
lšk
[
lšk_id
]);

368 ià(
	`WARN_ON
(!
lšk_¡a
))

371 ià(
unhash
)

372 
	`lšk_¡a_šfo_hash_d–
(
¡a
->
loÿl
, 
lšk_¡a
);

374 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
))

375 
	`›“80211_lšk_¡a_debugfs_»move
(
lšk_¡a
);

377 ià(
lšk_¡a
 !ğ&
¡a
->
deæšk
)

378 
®loc
 = 
	`cÚš”_of
(
lšk_¡a
, 
	`ty³of
(*®loc), 
šfo
);

380 
¡a
->¡a.
v®id_lšks
 &ğ~
	`BIT
(
lšk_id
);

381 
	`RCU_INIT_POINTER
(
¡a
->
lšk
[
lšk_id
], 
NULL
);

382 
	`RCU_INIT_POINTER
(
¡a
->¡a.
lšk
[
lšk_id
], 
NULL
);

383 ià(
®loc
) {

384 
	`¡a_šfo_ä“_lšk
(&
®loc
->
šfo
);

385 
	`kä“_rcu
(
®loc
, 
rcu_h—d
);

388 
	`›“80211_¡a_»ÿlc_agg»g©es
(&
¡a
->sta);

389 
	}
}

402 
	$¡a_šfo_ä“
(
›“80211_loÿl
 *
loÿl
, 
¡a_šfo
 *
¡a
)

404 
i
;

406 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->
lšk
); i++) {

407 
lšk_¡a_šfo
 *
lšk_¡a
;

409 
lšk_¡a
 = 
	`rcu_acûss_poš‹r
(
¡a
->
lšk
[
i
]);

410 ià(!
lšk_¡a
)

413 
	`¡a_»move_lšk
(
¡a
, 
i
, 
çl£
);

424 
¡a
->
¡a_¡©e
 > 
IEEE80211_STA_NONE
) {

425 
»t
;

427 
	`WARN_ON_ONCE
(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
));

429 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, s->
¡a_¡©e
 - 1);

430 ià(
	`WARN_ONCE
(
»t
, "sta_info_move_state()„eturned %d\n",„et))

434 ià(
¡a
->
¿‹_ù¾
)

435 
	`¿‹_cÚŒŞ_ä“_¡a
(
¡a
);

437 
	`¡a_dbg
(
¡a
->
sd©a
, "De¡royed STA %pM\n", s->¡a.
addr
);

439 
	`kä“
(
	`to_txq_šfo
(
¡a
->¡a.
txq
[0]));

440 
	`kä“
(
	`rcu_d”eã»nû_¿w
(
¡a
->¡a.
¿‹s
));

441 #ifdeà
CONFIG_MAC80211_MESH


442 
	`kä“
(
¡a
->
mesh
);

445 
	`¡a_šfo_ä“_lšk
(&
¡a
->
deæšk
);

446 
	`kä“
(
¡a
);

447 
	}
}

449 
	$¡a_šfo_hash_add
(
›“80211_loÿl
 *
loÿl
,

450 
¡a_šfo
 *
¡a
)

452  
	`rhÉabË_š£¹
(&
loÿl
->
¡a_hash
, &
¡a
->
hash_node
,

453 
¡a_rht_·¿ms
);

454 
	}
}

456 
	$¡a_d–iv”_ps_äames
(
wÜk_¡ruù
 *
wk
)

458 
¡a_šfo
 *
¡a
;

460 
¡a
 = 
	`cÚš”_of
(
wk
, 
¡a_šfo
, 
drv_d–iv”_wk
);

462 ià(
¡a
->
d—d
)

465 
	`loÿl_bh_di§bË
();

466 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
))

467 
	`›“80211_¡a_ps_d–iv”_wakeup
(
¡a
);

468 ià(
	`‹¡_ªd_ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PSPOLL
))

469 
	`›“80211_¡a_ps_d–iv”_pŞl_»¥Ú£
(
¡a
);

470 ià(
	`‹¡_ªd_ş—r_¡a_æag
(
¡a
, 
WLAN_STA_UAPSD
))

471 
	`›“80211_¡a_ps_d–iv”_u­sd
(
¡a
);

472 
	`loÿl_bh_’abË
();

473 
	}
}

475 
	$¡a_´•¬e_¿‹_cÚŒŞ
(
›“80211_loÿl
 *
loÿl
,

476 
¡a_šfo
 *
¡a
, 
gå_t
 
gå
)

478 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
))

481 
¡a
->
¿‹_ù¾
 = 
loÿl
->rate_ctrl;

482 
¡a
->
¿‹_ù¾_´iv
 = 
	`¿‹_cÚŒŞ_®loc_¡a
(¡a->
¿‹_ù¾
,

483 
¡a
, 
gå
);

484 ià(!
¡a
->
¿‹_ù¾_´iv
)

485  -
ENOMEM
;

488 
	}
}

490 
	$¡a_šfo_®loc_lšk
(
›“80211_loÿl
 *
loÿl
,

491 
lšk_¡a_šfo
 *
lšk_šfo
,

492 
gå_t
 
gå
)

494 
›“80211_hw
 *
hw
 = &
loÿl
->hw;

495 
i
;

497 ià(
	`›“80211_hw_check
(
hw
, 
USES_RSS
)) {

498 
lšk_šfo
->
pıu_rx_¡©s
 =

499 
	`®loc_³rıu_gå
(
›“80211_¡a_rx_¡©s
, 
gå
);

500 ià(!
lšk_šfo
->
pıu_rx_¡©s
)

501  -
ENOMEM
;

504 
lšk_šfo
->
rx_¡©s
.
Ï¡_rx
 = 
jiff›s
;

505 
	`u64_¡©s_š™
(&
lšk_šfo
->
rx_¡©s
.
synı
);

507 
	`ewma_sigÇl_š™
(&
lšk_šfo
->
rx_¡©s_avg
.
sigÇl
);

508 
	`ewma_avg_sigÇl_š™
(&
lšk_šfo
->
¡©us_¡©s
.
avg_ack_sigÇl
);

509 
i
 = 0; i < 
	`ARRAY_SIZE
(
lšk_šfo
->
rx_¡©s_avg
.
chaš_sigÇl
); i++)

510 
	`ewma_sigÇl_š™
(&
lšk_šfo
->
rx_¡©s_avg
.
chaš_sigÇl
[
i
]);

513 
	}
}

515 
	$¡a_šfo_add_lšk
(
¡a_šfo
 *
¡a
,

516 
lšk_id
,

517 
lšk_¡a_šfo
 *
lšk_šfo
,

518 
›“80211_lšk_¡a
 *
lšk_¡a
)

520 
lšk_šfo
->
¡a
 = sta;

521 
lšk_šfo
->
lšk_id
 =†ink_id;

522 
lšk_šfo
->
pub
 = 
lšk_¡a
;

523 
lšk_šfo
->
pub
->
¡a
 = &sta->sta;

524 
lšk_¡a
->
lšk_id
 =†ink_id;

525 
	`rcu_assign_poš‹r
(
¡a
->
lšk
[
lšk_id
], 
lšk_šfo
);

526 
	`rcu_assign_poš‹r
(
¡a
->¡a.
lšk
[
lšk_id
], 
lšk_¡a
);

528 
lšk_¡a
->
smps_mode
 = 
IEEE80211_SMPS_OFF
;

529 
lšk_¡a
->
agg
.
max_rc_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_HT_BA
;

530 
	}
}

532 
¡a_šfo
 *

533 
	$__¡a_šfo_®loc
(
›“80211_sub_if_d©a
 *
sd©a
,

534 cÚ¡ 
u8
 *
addr
, 
lšk_id
, cÚ¡ u8 *
lšk_addr
,

535 
gå_t
 
gå
)

537 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

538 
›“80211_hw
 *
hw
 = &
loÿl
->hw;

539 
¡a_šfo
 *
¡a
;

540 *
txq_d©a
;

541 
size
;

542 
i
;

544 
¡a
 = 
	`kz®loc
((*¡aè+ 
hw
->
¡a_d©a_size
, 
gå
);

545 ià(!
¡a
)

546  
NULL
;

548 
¡a
->
loÿl
 =†ocal;

549 
¡a
->
sd©a
 = sdata;

551 ià(
	`¡a_šfo_®loc_lšk
(
loÿl
, &
¡a
->
deæšk
, 
gå
))

552 
ä“
;

554 ià(
lšk_id
 >= 0) {

555 
	`¡a_šfo_add_lšk
(
¡a
, 
lšk_id
, &¡a->
deæšk
,

556 &
¡a
->¡a.
deæšk
);

557 
¡a
->¡a.
v®id_lšks
 = 
	`BIT
(
lšk_id
);

559 
	`¡a_šfo_add_lšk
(
¡a
, 0, &¡a->
deæšk
, &sta->sta.deflink);

562 
¡a
->¡a.
cur
 = &¡a->¡a.
deæšk
.
agg
;

564 
	`¥š_lock_š™
(&
¡a
->
lock
);

565 
	`¥š_lock_š™
(&
¡a
->
ps_lock
);

566 
	`INIT_WORK
(&
¡a
->
drv_d–iv”_wk
, 
¡a_d–iv”_ps_äames
);

567 
	`why_wÜk_š™
(&
¡a
->
ampdu_mlme
.
wÜk
, 
›“80211_ba_£ssiÚ_wÜk
);

568 #ifdeà
CONFIG_MAC80211_MESH


569 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

570 
¡a
->
mesh
 = 
	`kz®loc
((*¡a->mesh), 
gå
);

571 ià(!
¡a
->
mesh
)

572 
ä“
;

573 
¡a
->
mesh
->
¶šk_¡a
 = sta;

574 
	`¥š_lock_š™
(&
¡a
->
mesh
->
¶šk_lock
);

575 ià(!
sd©a
->
u
.
mesh
.
u£r_mpm
)

576 
	`tim”_£tup
(&
¡a
->
mesh
->
¶šk_tim”
, 
mesh_¶šk_tim”
,

578 
¡a
->
mesh
->
nÚ³”_pm
 = 
NL80211_MESH_POWER_ACTIVE
;

582 
	`memıy
(
¡a
->
addr
,‡ddr, 
ETH_ALEN
);

583 
	`memıy
(
¡a
->¡a.
addr
,‡ddr, 
ETH_ALEN
);

584 
	`memıy
(
¡a
->
deæšk
.
addr
, 
lšk_addr
, 
ETH_ALEN
);

585 
	`memıy
(
¡a
->¡a.
deæšk
.
addr
, 
lšk_addr
, 
ETH_ALEN
);

586 
¡a
->¡a.
max_rx_agg»g©iÚ_subäames
 =

587 
loÿl
->
hw
.
max_rx_agg»g©iÚ_subäames
;

597 
	`BUILD_BUG_ON
(
	`ARRAY_SIZE
(
¡a
->
±k
è<ğ
INVALID_PTK_KEYIDX
);

598 
¡a
->
±k_idx
 = 
INVALID_PTK_KEYIDX
;

601 
	`›“80211_š™_äag_ÿche
(&
¡a
->
äags
);

603 
¡a
->
¡a_¡©e
 = 
IEEE80211_STA_NONE
;

605 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
)

606 
¡a
->
amsdu_mesh_cÚŒŞ
 = -1;

609 
¡a
->
»£rved_tid
 = 
IEEE80211_TID_UNRESERVED
;

611 
¡a
->
Ï¡_cÚÃùed
 = 
	`ktime_g‘_£cÚds
();

613 
size
 = (
txq_šfo
) +

614 
	`ALIGN
(
hw
->
txq_d©a_size
, (*));

616 
txq_d©a
 = 
	`kÿÎoc
(
	`ARRAY_SIZE
(
¡a
->¡a.
txq
), 
size
, 
gå
);

617 ià(!
txq_d©a
)

618 
ä“
;

620 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->¡a.
txq
); i++) {

621 
txq_šfo
 *
txq
 = 
txq_d©a
 + 
i
 * 
size
;

624 
	`›“80211_txq_š™
(
sd©a
, 
¡a
, 
txq
, 
i
);

627 ià(
	`¡a_´•¬e_¿‹_cÚŒŞ
(
loÿl
, 
¡a
, 
gå
))

628 
ä“_txq
;

630 
¡a
->
aœtime_weight
 = 
IEEE80211_DEFAULT_AIRTIME_WEIGHT
;

632 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

633 
	`skb_queue_h—d_š™
(&
¡a
->
ps_tx_buf
[
i
]);

634 
	`skb_queue_h—d_š™
(&
¡a
->
tx_f‹»d
[
i
]);

635 
¡a
->
aœtime
[
i
].
defic™
 = s->
aœtime_weight
;

636 
	`©omic_£t
(&
¡a
->
aœtime
[
i
].
aql_tx_³ndšg
, 0);

637 
¡a
->
aœtime
[
i
].
aql_lim™_low
 = 
loÿl
->
aql_txq_lim™_low
[i];

638 
¡a
->
aœtime
[
i
].
aql_lim™_high
 = 
loÿl
->
aql_txq_lim™_high
[i];

641 
i
 = 0; i < 
IEEE80211_NUM_TIDS
; i++)

642 
¡a
->
Ï¡_£q_ù¾
[
i
] = 
	`ıu_to_Ë16
(
USHRT_MAX
);

644 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

645 
u32
 
mªd©Üy
 = 0;

646 
r
;

648 ià(!
hw
->
why
->
bªds
[
i
])

651 
i
) {

652 
NL80211_BAND_2GHZ
:

653 
NL80211_BAND_LC
:

663 
mªd©Üy
 = 
IEEE80211_RATE_MANDATORY_B
 |

664 
IEEE80211_RATE_MANDATORY_G
;

666 
NL80211_BAND_5GHZ
:

667 
mªd©Üy
 = 
IEEE80211_RATE_MANDATORY_A
;

669 
NL80211_BAND_60GHZ
:

670 
	`WARN_ON
(1);

671 
mªd©Üy
 = 0;

675 
r
 = 0;„ < 
hw
->
why
->
bªds
[
i
]->
n_b™¿‹s
;„++) {

676 
›“80211_¿‹
 *
¿‹
;

678 
¿‹
 = &
hw
->
why
->
bªds
[
i
]->
b™¿‹s
[
r
];

680 ià(!(
¿‹
->
æags
 & 
mªd©Üy
))

682 
¡a
->¡a.
deæšk
.
suµ_¿‹s
[
i
] |ğ
	`BIT
(
r
);

686 
¡a
->
ı¬ams
.
û_th»shŞd
 = 
CODEL_DISABLED_THRESHOLD
;

687 
¡a
->
ı¬ams
.
rg‘
 = 
	`MS2TIME
(20);

688 
¡a
->
ı¬ams
.
š‹rv®
 = 
	`MS2TIME
(100);

689 
¡a
->
ı¬ams
.
eú
 = 
Œue
;

690 
¡a
->
ı¬ams
.
û_th»shŞd_£ËùÜ
 = 0;

691 
¡a
->
ı¬ams
.
û_th»shŞd_mask
 = 0;

693 
	`¡a_dbg
(
sd©a
, "AÎoÿ‹d STA %pM\n", 
¡a
->¡a.
addr
);

695  
¡a
;

697 
ä“_txq
:

698 
	`kä“
(
	`to_txq_šfo
(
¡a
->¡a.
txq
[0]));

699 
ä“
:

700 
	`¡a_šfo_ä“_lšk
(&
¡a
->
deæšk
);

701 #ifdeà
CONFIG_MAC80211_MESH


702 
	`kä“
(
¡a
->
mesh
);

704 
	`kä“
(
¡a
);

705  
NULL
;

706 
	}
}

708 
¡a_šfo
 *
	$¡a_šfo_®loc
(
›“80211_sub_if_d©a
 *
sd©a
,

709 cÚ¡ 
u8
 *
addr
, 
gå_t
 
gå
)

711  
	`__¡a_šfo_®loc
(
sd©a
, 
addr
, -1,‡ddr, 
gå
);

712 
	}
}

714 
¡a_šfo
 *
	$¡a_šfo_®loc_w™h_lšk
(
›“80211_sub_if_d©a
 *
sd©a
,

715 cÚ¡ 
u8
 *
mld_addr
,

716 
lšk_id
,

717 cÚ¡ 
u8
 *
lšk_addr
,

718 
gå_t
 
gå
)

720  
	`__¡a_šfo_®loc
(
sd©a
, 
mld_addr
, 
lšk_id
, 
lšk_addr
, 
gå
);

721 
	}
}

723 
	$¡a_šfo_š£¹_check
(
¡a_šfo
 *
¡a
)

725 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

727 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

734 ià(
	`uÆik–y
(!
	`›“80211_sd©a_ruÂšg
(
sd©a
)))

735  -
ENETDOWN
;

737 ià(
	`WARN_ON
(
	`‘h”_addr_equ®
(
¡a
->¡a.
addr
, 
sd©a
->
vif
.addr) ||

738 !
	`is_v®id_‘h”_addr
(
¡a
->¡a.
addr
)))

739  -
EINVAL
;

745 
	`rcu_»ad_lock
();

746 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
NEEDS_UNIQUE_STA_ADDR
) &&

747 
	`›“80211_fšd_¡a_by_içddr
(&
sd©a
->
loÿl
->
hw
, 
¡a
->
addr
, 
NULL
)) {

748 
	`rcu_»ad_uÆock
();

749  -
ENOTUNIQ
;

751 
	`rcu_»ad_uÆock
();

754 
	}
}

756 
	$¡a_šfo_š£¹_drv_¡©e
(
›“80211_loÿl
 *
loÿl
,

757 
›“80211_sub_if_d©a
 *
sd©a
,

758 
¡a_šfo
 *
¡a
)

760 
›“80211_¡a_¡©e
 
¡©e
;

761 
”r
 = 0;

763 
¡©e
 = 
IEEE80211_STA_NOTEXIST
; s‹ < 
¡a
->
¡a_¡©e
; state++) {

764 
”r
 = 
	`drv_¡a_¡©e
(
loÿl
, 
sd©a
, 
¡a
, 
¡©e
, state + 1);

765 ià(
”r
)

769 ià(!
”r
) {

774 ià(!
loÿl
->
İs
->
¡a_add
)

775 
¡a
->
u¶ßded
 = 
Œue
;

779 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) {

780 
	`sd©a_šfo
(
sd©a
,

782 
¡a
->¡a.
addr
, 
¡©e
 + 1, 
”r
);

783 
”r
 = 0;

787 ; 
¡©e
 > 
IEEE80211_STA_NOTEXIST
; state--)

788 
	`WARN_ON
(
	`drv_¡a_¡©e
(
loÿl
, 
sd©a
, 
¡a
, 
¡©e
, state - 1));

790  
”r
;

791 
	}
}

794 
	$›“80211_»ÿlc_p2p_go_ps_®lowed
(
›“80211_sub_if_d©a
 *
sd©a
)

796 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

797 
boŞ
 
®low_p2p_go_ps
 = 
sd©a
->
vif
.
p2p
;

798 
¡a_šfo
 *
¡a
;

800 
	`rcu_»ad_lock
();

801 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

802 ià(
sd©a
 !ğ
¡a
->sdata ||

803 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_ASSOC
))

805 ià(!
¡a
->¡a.
suµÜt_p2p_ps
) {

806 
®low_p2p_go_ps
 = 
çl£
;

810 
	`rcu_»ad_uÆock
();

812 ià(
®low_p2p_go_ps
 !ğ
sd©a
->
vif
.
bss_cÚf
.allow_p2p_go_ps) {

813 
sd©a
->
vif
.
bss_cÚf
.
®low_p2p_go_ps
 =‡llow_p2p_go_ps;

814 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

815 
BSS_CHANGED_P2P_PS
);

817 
	}
}

819 
	$¡a_šfo_š£¹_fšish
(
¡a_šfo
 *
¡a
è
	$__acquœes
(
RCU
)

821 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

822 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

823 
¡©iÚ_šfo
 *
sšfo
 = 
NULL
;

824 
”r
 = 0;

826 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

829 ià(
	`¡a_šfo_g‘_bss
(
sd©a
, 
¡a
->¡a.
addr
)) {

830 
”r
 = -
EEXIST
;

831 
out_ş—nup
;

834 
sšfo
 = 
	`kz®loc
((
¡©iÚ_šfo
), 
GFP_KERNEL
);

835 ià(!
sšfo
) {

836 
”r
 = -
ENOMEM
;

837 
out_ş—nup
;

840 
loÿl
->
num_¡a
++;

841 
loÿl
->
¡a_g’”©iÚ
++;

842 
	`smp_mb
();

845 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

848 
”r
 = 
	`¡a_šfo_hash_add
(
loÿl
, 
¡a
);

849 ià(
”r
)

850 
out_drİ_¡a
;

852 ià(
¡a
->¡a.
v®id_lšks
) {

853 
”r
 = 
	`lšk_¡a_šfo_hash_add
(
loÿl
, &
¡a
->
deæšk
);

854 ià(
”r
) {

855 
	`¡a_šfo_hash_d–
(
loÿl
, 
¡a
);

856 
out_drİ_¡a
;

860 
	`li¡_add__rcu
(&
¡a
->
li¡
, &
loÿl
->
¡a_li¡
);

865 ià(
¡a
->
¡a_¡©e
 >ğ
IEEE80211_STA_ASSOC
) {

866 
	`›“80211_»ÿlc_mš_chªdef
(
¡a
->
sd©a
, -1);

867 ià(!
¡a
->¡a.
suµÜt_p2p_ps
)

868 
	`›“80211_»ÿlc_p2p_go_ps_®lowed
(
¡a
->
sd©a
);

872 
”r
 = 
	`¡a_šfo_š£¹_drv_¡©e
(
loÿl
, 
sd©a
, 
¡a
);

873 ià(
”r
)

874 
out_»move
;

876 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
);

879 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

881 
	`›“80211_¡a_debugfs_add
(
¡a
);

882 
	`¿‹_cÚŒŞ_add_¡a_debugfs
(
¡a
);

883 ià(
¡a
->¡a.
v®id_lšks
) {

884 
i
;

886 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->
lšk
); i++) {

887 
lšk_¡a_šfo
 *
lšk_¡a
;

889 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
i
],

890 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

892 ià(!
lšk_¡a
)

895 
	`›“80211_lšk_¡a_debugfs_add
(
lšk_¡a
);

896 ià(
sd©a
->
vif
.
aùive_lšks
 & 
	`BIT
(
i
))

897 
	`›“80211_lšk_¡a_debugfs_drv_add
(
lšk_¡a
);

900 
	`›“80211_lšk_¡a_debugfs_add
(&
¡a
->
deæšk
);

901 
	`›“80211_lšk_¡a_debugfs_drv_add
(&
¡a
->
deæšk
);

904 
sšfo
->
g’”©iÚ
 = 
loÿl
->
¡a_g’”©iÚ
;

905 
	`cfg80211_Ãw_¡a
(
sd©a
->
dev
, 
¡a
->¡a.
addr
, 
sšfo
, 
GFP_KERNEL
);

906 
	`kä“
(
sšfo
);

908 
	`¡a_dbg
(
sd©a
, "In£¹ed STA %pM\n", 
¡a
->¡a.
addr
);

911 
	`rcu_»ad_lock
();

913 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

914 
	`mesh_acû±_¶šks_upd©e
(
sd©a
);

916 
	`›“80211_check_ç¡_xm™
(
¡a
);

919 
out_»move
:

920 ià(
¡a
->¡a.
v®id_lšks
)

921 
	`lšk_¡a_šfo_hash_d–
(
loÿl
, &
¡a
->
deæšk
);

922 
	`¡a_šfo_hash_d–
(
loÿl
, 
¡a
);

923 
	`li¡_d–_rcu
(&
¡a
->
li¡
);

924 
out_drİ_¡a
:

925 
loÿl
->
num_¡a
--;

926 
	`synchrÚize_Ãt
();

927 
out_ş—nup
:

928 
	`ş—nup_sšgË_¡a
(
¡a
);

929 
	`kä“
(
sšfo
);

930 
	`rcu_»ad_lock
();

931  
”r
;

932 
	}
}

934 
	$¡a_šfo_š£¹_rcu
(
¡a_šfo
 *
¡a
è
	$__acquœes
(
RCU
)

936 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

937 
”r
;

939 
	`might_¦“p
();

940 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

942 
”r
 = 
	`¡a_šfo_š£¹_check
(
¡a
);

943 ià(
”r
) {

944 
	`¡a_šfo_ä“
(
loÿl
, 
¡a
);

945 
	`rcu_»ad_lock
();

946  
”r
;

949  
	`¡a_šfo_š£¹_fšish
(
¡a
);

950 
	}
}

952 
	$¡a_šfo_š£¹
(
¡a_šfo
 *
¡a
)

954 
”r
 = 
	`¡a_šfo_š£¹_rcu
(
¡a
);

956 
	`rcu_»ad_uÆock
();

958  
”r
;

959 
	}
}

961 
šlše
 
	$__bss_tim_£t
(
u8
 *
tim
, 
u16
 
id
)

967 
tim
[
id
 / 8] |= (1 << (id % 8));

968 
	}
}

970 
šlše
 
	$__bss_tim_ş—r
(
u8
 *
tim
, 
u16
 
id
)

976 
tim
[
id
 / 8] &= ~(1 << (id % 8));

977 
	}
}

979 
šlše
 
boŞ
 
	$__bss_tim_g‘
(
u8
 *
tim
, 
u16
 
id
)

985  
tim
[
id
 / 8] & (1 << (id % 8));

986 
	}
}

988 
	$›“80211_tids_fÜ_ac
(
ac
)

991 
ac
) {

992 
IEEE80211_AC_VO
:

993  
	`BIT
(6) | BIT(7);

994 
IEEE80211_AC_VI
:

995  
	`BIT
(4) | BIT(5);

996 
IEEE80211_AC_BE
:

997  
	`BIT
(0) | BIT(3);

998 
IEEE80211_AC_BK
:

999  
	`BIT
(1) | BIT(2);

1001 
	`WARN_ON
(1);

1004 
	}
}

1006 
	$__¡a_šfo_»ÿlc_tim
(
¡a_šfo
 *
¡a
, 
boŞ
 
ignÜe_³ndšg
)

1008 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

1009 
ps_d©a
 *
ps
;

1010 
boŞ
 
šdiÿ‹_tim
 = 
çl£
;

1011 
u8
 
ignÜe_fÜ_tim
 = 
¡a
->¡a.
u­sd_queues
;

1012 
ac
;

1013 
u16
 
id
 = 
¡a
->¡a.
aid
;

1015 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

1016 
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

1017 ià(
	`WARN_ON_ONCE
(!
¡a
->
sd©a
->
bss
))

1020 
ps
 = &
¡a
->
sd©a
->
bss
->ps;

1021 #ifdeà
CONFIG_MAC80211_MESH


1022 } ià(
	`›“80211_vif_is_mesh
(&
¡a
->
sd©a
->
vif
)) {

1023 
ps
 = &
¡a
->
sd©a
->
u
.
mesh
.ps;

1030 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AP_LINK_PS
è&& !loÿl->
İs
->
£t_tim
)

1033 ià(
¡a
->
d—d
)

1034 
dÚe
;

1042 ià(
ignÜe_fÜ_tim
 =ğ
	`BIT
(
IEEE80211_NUM_ACS
) - 1)

1043 
ignÜe_fÜ_tim
 = 0;

1045 ià(
ignÜe_³ndšg
)

1046 
ignÜe_fÜ_tim
 = 
	`BIT
(
IEEE80211_NUM_ACS
) - 1;

1048 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

1049 
tids
;

1051 ià(
ignÜe_fÜ_tim
 & 
›“80211_ac_to_qos_mask
[
ac
])

1054 
šdiÿ‹_tim
 |ğ!
	`skb_queue_em±y
(&
¡a
->
tx_f‹»d
[
ac
]) ||

1055 !
	`skb_queue_em±y
(&
¡a
->
ps_tx_buf
[
ac
]);

1056 ià(
šdiÿ‹_tim
)

1059 
tids
 = 
	`›“80211_tids_fÜ_ac
(
ac
);

1061 
šdiÿ‹_tim
 |=

1062 
¡a
->
driv”_bufã»d_tids
 & 
tids
;

1063 
šdiÿ‹_tim
 |=

1064 
¡a
->
txq_bufã»d_tids
 & 
tids
;

1067 
dÚe
:

1068 
	`¥š_lock_bh
(&
loÿl
->
tim_lock
);

1070 ià(
šdiÿ‹_tim
 =ğ
	`__bss_tim_g‘
(
ps
->
tim
, 
id
))

1071 
out_uÆock
;

1073 ià(
šdiÿ‹_tim
)

1074 
	`__bss_tim_£t
(
ps
->
tim
, 
id
);

1076 
	`__bss_tim_ş—r
(
ps
->
tim
, 
id
);

1078 ià(
loÿl
->
İs
->
£t_tim
 && !
	`WARN_ON
(
¡a
->
d—d
)) {

1079 
loÿl
->
tim_š_locked_£ùiÚ
 = 
Œue
;

1080 
	`drv_£t_tim
(
loÿl
, &
¡a
->¡a, 
šdiÿ‹_tim
);

1081 
loÿl
->
tim_š_locked_£ùiÚ
 = 
çl£
;

1084 
out_uÆock
:

1085 
	`¥š_uÆock_bh
(&
loÿl
->
tim_lock
);

1086 
	}
}

1088 
	$¡a_šfo_»ÿlc_tim
(
¡a_šfo
 *
¡a
)

1090 
	`__¡a_šfo_»ÿlc_tim
(
¡a
, 
çl£
);

1091 
	}
}

1093 
boŞ
 
	$¡a_šfo_bufãr_expœed
(
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

1095 
›“80211_tx_šfo
 *
šfo
;

1096 
timeout
;

1098 ià(!
skb
)

1099  
çl£
;

1101 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1104 
timeout
 = (
¡a
->
li¡’_š‹rv®
 *

1105 
¡a
->
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
 *

1106 32 / 15625è* 
HZ
;

1107 ià(
timeout
 < 
STA_TX_BUFFER_EXPIRE
)

1108 
timeout
 = 
STA_TX_BUFFER_EXPIRE
;

1109  
	`time_aá”
(
jiff›s
, 
šfo
->
cÚŒŞ
.jiff› + 
timeout
);

1110 
	}
}

1113 
boŞ
 
	$¡a_šfo_ş—nup_expœe_bufã»d_ac
(
›“80211_loÿl
 *
loÿl
,

1114 
¡a_šfo
 *
¡a
, 
ac
)

1116 
æags
;

1117 
sk_buff
 *
skb
;

1127 
	`¥š_lock_œq§ve
(&
¡a
->
tx_f‹»d
[
ac
].
lock
, 
æags
);

1128 
skb
 = 
	`skb_³ek
(&
¡a
->
tx_f‹»d
[
ac
]);

1129 ià(
	`¡a_šfo_bufãr_expœed
(
¡a
, 
skb
))

1130 
skb
 = 
	`__skb_dequeue
(&
¡a
->
tx_f‹»d
[
ac
]);

1132 
skb
 = 
NULL
;

1133 
	`¥š_uÆock_œq»¡Üe
(&
¡a
->
tx_f‹»d
[
ac
].
lock
, 
æags
);

1141 ià(!
skb
)

1143 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

1153 
	`¥š_lock_œq§ve
(&
¡a
->
ps_tx_buf
[
ac
].
lock
, 
æags
);

1154 
skb
 = 
	`skb_³ek
(&
¡a
->
ps_tx_buf
[
ac
]);

1155 ià(
	`¡a_šfo_bufãr_expœed
(
¡a
, 
skb
))

1156 
skb
 = 
	`__skb_dequeue
(&
¡a
->
ps_tx_buf
[
ac
]);

1158 
skb
 = 
NULL
;

1159 
	`¥š_uÆock_œq»¡Üe
(&
¡a
->
ps_tx_buf
[
ac
].
lock
, 
æags
);

1166 ià(!
skb
)

1169 
loÿl
->
tÙ®_ps_bufã»d
--;

1170 
	`ps_dbg
(
¡a
->
sd©a
, "Buffered frameƒxpired (STA %pM)\n",

1171 
¡a
->¡a.
addr
);

1172 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

1180 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

1187  !(
	`skb_queue_em±y
(&
¡a
->
ps_tx_buf
[
ac
]) &&

1188 
	`skb_queue_em±y
(&
¡a
->
tx_f‹»d
[
ac
]));

1189 
	}
}

1191 
boŞ
 
	$¡a_šfo_ş—nup_expœe_bufã»d
(
›“80211_loÿl
 *
loÿl
,

1192 
¡a_šfo
 *
¡a
)

1194 
boŞ
 
have_bufã»d
 = 
çl£
;

1195 
ac
;

1198 ià(!
¡a
->
sd©a
->
bss
 &&

1199 !
	`›“80211_vif_is_mesh
(&
¡a
->
sd©a
->
vif
))

1200  
çl£
;

1202 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

1203 
have_bufã»d
 |=

1204 
	`¡a_šfo_ş—nup_expœe_bufã»d_ac
(
loÿl
, 
¡a
, 
ac
);

1206  
have_bufã»d
;

1207 
	}
}

1209 
__mu¡_check
 
	$__¡a_šfo_de¡roy_·¹1
(
¡a_šfo
 *
¡a
)

1211 
›“80211_loÿl
 *
loÿl
;

1212 
›“80211_sub_if_d©a
 *
sd©a
;

1213 
»t
, 
i
;

1215 
	`might_¦“p
();

1217 ià(!
¡a
)

1218  -
ENOENT
;

1220 
loÿl
 = 
¡a
->local;

1221 
sd©a
 = 
¡a
->sdata;

1223 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1231 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

1232 
	`›“80211_¡a_‹¬_down_BA_£ssiÚs
(
¡a
, 
AGG_STOP_DESTROY_STA
);

1239 
	`drv_sync_rx_queues
(
loÿl
, 
¡a
);

1241 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->
lšk
); i++) {

1242 
lšk_¡a_šfo
 *
lšk_¡a
;

1244 ià(!(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
i
)))

1247 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
i
],

1248 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1250 
	`lšk_¡a_šfo_hash_d–
(
loÿl
, 
lšk_¡a
);

1253 
»t
 = 
	`¡a_šfo_hash_d–
(
loÿl
, 
¡a
);

1254 ià(
	`WARN_ON
(
»t
))

1255  
»t
;

1261 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_OFF_CHANNEL
)) {

1262 
	`drv_tdls_ÿnûl_chªÃl_sw™ch
(
loÿl
, 
sd©a
, &
¡a
->sta);

1263 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_OFF_CHANNEL
);

1266 
	`li¡_d–_rcu
(&
¡a
->
li¡
);

1267 
¡a
->
»moved
 = 
Œue
;

1269 ià(
¡a
->
u¶ßded
)

1270 
	`drv_¡a_´e_rcu_»move
(
loÿl
, 
¡a
->
sd©a
, sta);

1272 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 &&

1273 
	`rcu_acûss_poš‹r
(
sd©a
->
u
.
vÏn
.
¡a
) == sta)

1274 
	`RCU_INIT_POINTER
(
sd©a
->
u
.
vÏn
.
¡a
, 
NULL
);

1277 
	}
}

1279 
	$_¡a_šfo_move_¡©e
(
¡a_šfo
 *
¡a
,

1280 
›“80211_¡a_¡©e
 
Ãw_¡©e
,

1281 
boŞ
 
»ÿlc
)

1283 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

1285 
	`might_¦“p
();

1287 ià(
¡a
->
¡a_¡©e
 =ğ
Ãw_¡©e
)

1292 
Ãw_¡©e
) {

1293 
IEEE80211_STA_NONE
:

1294 ià(
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_AUTH
)

1295  -
EINVAL
;

1297 
IEEE80211_STA_AUTH
:

1298 ià(
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_NONE
 &&

1299 
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_ASSOC
)

1300  -
EINVAL
;

1302 
IEEE80211_STA_ASSOC
:

1303 ià(
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_AUTH
 &&

1304 
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_AUTHORIZED
)

1305  -
EINVAL
;

1307 
IEEE80211_STA_AUTHORIZED
:

1308 ià(
¡a
->
¡a_¡©e
 !ğ
IEEE80211_STA_ASSOC
)

1309  -
EINVAL
;

1312 
	`WARN
(1, "šv®id s‹ %d", 
Ãw_¡©e
);

1313  -
EINVAL
;

1316 
	`¡a_dbg
(
¡a
->
sd©a
, "moving STA %pMo state %d\n",

1317 
¡a
->¡a.
addr
, 
Ãw_¡©e
);

1322 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
)) {

1323 
”r
 = 
	`drv_¡a_¡©e
(
¡a
->
loÿl
, s->
sd©a
, sta,

1324 
¡a
->
¡a_¡©e
, 
Ãw_¡©e
);

1325 ià(
”r
)

1326  
”r
;

1331 
Ãw_¡©e
) {

1332 
IEEE80211_STA_NONE
:

1333 ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_AUTH
)

1334 
	`ş—r_b™
(
WLAN_STA_AUTH
, &
¡a
->
_æags
);

1336 
IEEE80211_STA_AUTH
:

1337 ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_NONE
) {

1338 
	`£t_b™
(
WLAN_STA_AUTH
, &
¡a
->
_æags
);

1339 } ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_ASSOC
) {

1340 
	`ş—r_b™
(
WLAN_STA_ASSOC
, &
¡a
->
_æags
);

1341 ià(
»ÿlc
) {

1342 
	`›“80211_»ÿlc_mš_chªdef
(
¡a
->
sd©a
, -1);

1343 ià(!
¡a
->¡a.
suµÜt_p2p_ps
)

1344 
	`›“80211_»ÿlc_p2p_go_ps_®lowed
(
¡a
->
sd©a
);

1348 
IEEE80211_STA_ASSOC
:

1349 ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_AUTH
) {

1350 
	`£t_b™
(
WLAN_STA_ASSOC
, &
¡a
->
_æags
);

1351 
¡a
->
assoc_©
 = 
	`ktime_g‘_boÙtime_ns
();

1352 ià(
»ÿlc
) {

1353 
	`›“80211_»ÿlc_mš_chªdef
(
¡a
->
sd©a
, -1);

1354 ià(!
¡a
->¡a.
suµÜt_p2p_ps
)

1355 
	`›“80211_»ÿlc_p2p_go_ps_®lowed
(
¡a
->
sd©a
);

1357 } ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_AUTHORIZED
) {

1358 
	`›“80211_vif_dec_num_mÿ¡
(
¡a
->
sd©a
);

1359 
	`ş—r_b™
(
WLAN_STA_AUTHORIZED
, &
¡a
->
_æags
);

1368 ià(
loÿl
->
İs
->
£t_key
) {

1369 
	`synchrÚize_Ãt
();

1370 ià(
loÿl
->
İs
->
æush_¡a
)

1371 
	`drv_æush_¡a
(
loÿl
, 
¡a
->
sd©a
, sta);

1373 
	`›“80211_æush_queues
(
loÿl
,

1374 
¡a
->
sd©a
,

1375 
çl£
);

1378 
	`›“80211_ş—r_ç¡_xm™
(
¡a
);

1379 
	`›“80211_ş—r_ç¡_rx
(
¡a
);

1382 
IEEE80211_STA_AUTHORIZED
:

1383 ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_ASSOC
) {

1384 
	`›“80211_vif_šc_num_mÿ¡
(
¡a
->
sd©a
);

1385 
	`£t_b™
(
WLAN_STA_AUTHORIZED
, &
¡a
->
_æags
);

1386 
	`›“80211_check_ç¡_xm™
(
¡a
);

1387 
	`›“80211_check_ç¡_rx
(
¡a
);

1389 ià(
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
 ||

1390 
¡a
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

1391 
	`cfg80211_£nd_Ïy”2_upd©e
(
¡a
->
sd©a
->
dev
,

1392 
¡a
->¡a.
addr
);

1398 
¡a
->
¡a_¡©e
 = 
Ãw_¡©e
;

1401 
	}
}

1403 
	$¡a_šfo_move_¡©e
(
¡a_šfo
 *
¡a
,

1404 
›“80211_¡a_¡©e
 
Ãw_¡©e
)

1406  
	`_¡a_šfo_move_¡©e
(
¡a
, 
Ãw_¡©e
, 
Œue
);

1407 
	}
}

1409 
	$__¡a_šfo_de¡roy_·¹2
(
¡a_šfo
 *
¡a
, 
boŞ
 
»ÿlc
)

1411 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

1412 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1413 
¡©iÚ_šfo
 *
sšfo
;

1414 
»t
;

1433 
	`›“80211_¡a_‹¬_down_BA_£ssiÚs
(
¡a
, 
AGG_STOP_DESTROY_STA
);

1435 
	`might_¦“p
();

1436 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1438 ià(
¡a
->
¡a_¡©e
 =ğ
IEEE80211_STA_AUTHORIZED
) {

1439 
»t
 = 
	`_¡a_šfo_move_¡©e
(
¡a
, 
IEEE80211_STA_ASSOC
, 
»ÿlc
);

1440 
	`WARN_ON_ONCE
(
»t
);

1444 
	`›“80211_ä“_¡a_keys
(
loÿl
, 
¡a
);

1447 
	`__¡a_šfo_»ÿlc_tim
(
¡a
, 
Œue
);

1449 
¡a
->
d—d
 = 
Œue
;

1451 
loÿl
->
num_¡a
--;

1452 
loÿl
->
¡a_g’”©iÚ
++;

1454 
¡a
->
¡a_¡©e
 > 
IEEE80211_STA_NONE
) {

1455 
»t
 = 
	`_¡a_šfo_move_¡©e
(
¡a
, s->
¡a_¡©e
 - 1, 
»ÿlc
);

1456 ià(
»t
) {

1457 
	`WARN_ON_ONCE
(1);

1462 ià(
¡a
->
u¶ßded
) {

1463 
»t
 = 
	`drv_¡a_¡©e
(
loÿl
, 
sd©a
, 
¡a
, 
IEEE80211_STA_NONE
,

1464 
IEEE80211_STA_NOTEXIST
);

1465 
	`WARN_ON_ONCE
(
»t
 != 0);

1468 
	`¡a_dbg
(
sd©a
, "Removed STA %pM\n", 
¡a
->¡a.
addr
);

1470 
sšfo
 = 
	`kz®loc
((*sšfo), 
GFP_KERNEL
);

1471 ià(
sšfo
)

1472 
	`¡a_£t_sšfo
(
¡a
, 
sšfo
, 
Œue
);

1473 
	`cfg80211_d–_¡a_sšfo
(
sd©a
->
dev
, 
¡a
->¡a.
addr
, 
sšfo
, 
GFP_KERNEL
);

1474 
	`kä“
(
sšfo
);

1476 
	`›“80211_¡a_debugfs_»move
(
¡a
);

1478 
	`›“80211_de¡roy_äag_ÿche
(&
¡a
->
äags
);

1480 
	`ş—nup_sšgË_¡a
(
¡a
);

1481 
	}
}

1483 
__mu¡_check
 
	$__¡a_šfo_de¡roy
(
¡a_šfo
 *
¡a
)

1485 
”r
 = 
	`__¡a_šfo_de¡roy_·¹1
(
¡a
);

1487 ià(
”r
)

1488  
”r
;

1490 
	`synchrÚize_Ãt
();

1492 
	`__¡a_šfo_de¡roy_·¹2
(
¡a
, 
Œue
);

1495 
	}
}

1497 
	$¡a_šfo_de¡roy_addr
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
addr
)

1499 
¡a_šfo
 *
¡a
;

1501 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1503 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
addr
);

1504  
	`__¡a_šfo_de¡roy
(
¡a
);

1505 
	}
}

1507 
	$¡a_šfo_de¡roy_addr_bss
(
›“80211_sub_if_d©a
 *
sd©a
,

1508 cÚ¡ 
u8
 *
addr
)

1510 
¡a_šfo
 *
¡a
;

1512 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

1514 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
addr
);

1515  
	`__¡a_šfo_de¡roy
(
¡a
);

1516 
	}
}

1518 
	$¡a_šfo_ş—nup
(
tim”_li¡
 *
t
)

1520 
›“80211_loÿl
 *
loÿl
 = 
	`äom_tim”
Öoÿl, 
t
, 
¡a_ş—nup
);

1521 
¡a_šfo
 *
¡a
;

1522 
boŞ
 
tim”_Ãeded
 = 
çl£
;

1524 
	`rcu_»ad_lock
();

1525 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
)

1526 ià(
	`¡a_šfo_ş—nup_expœe_bufã»d
(
loÿl
, 
¡a
))

1527 
tim”_Ãeded
 = 
Œue
;

1528 
	`rcu_»ad_uÆock
();

1530 ià(
loÿl
->
qu›scšg
)

1533 ià(!
tim”_Ãeded
)

1536 
	`mod_tim”
(&
loÿl
->
¡a_ş—nup
,

1537 
	`round_jiff›s
(
jiff›s
 + 
STA_INFO_CLEANUP_INTERVAL
));

1538 
	}
}

1540 
	$¡a_šfo_š™
(
›“80211_loÿl
 *
loÿl
)

1542 
”r
;

1544 
”r
 = 
	`rhÉabË_š™
(&
loÿl
->
¡a_hash
, &
¡a_rht_·¿ms
);

1545 ià(
”r
)

1546  
”r
;

1548 
”r
 = 
	`rhÉabË_š™
(&
loÿl
->
lšk_¡a_hash
, &
lšk_¡a_rht_·¿ms
);

1549 ià(
”r
) {

1550 
	`rhÉabË_de¡roy
(&
loÿl
->
¡a_hash
);

1551  
”r
;

1554 
	`¥š_lock_š™
(&
loÿl
->
tim_lock
);

1555 
	`INIT_LIST_HEAD
(&
loÿl
->
¡a_li¡
);

1557 
	`tim”_£tup
(&
loÿl
->
¡a_ş—nup
, 
¡a_šfo_ş—nup
, 0);

1559 
	}
}

1561 
	$¡a_šfo_¡İ
(
›“80211_loÿl
 *
loÿl
)

1563 
	`d–_tim”_sync
(&
loÿl
->
¡a_ş—nup
);

1564 
	`rhÉabË_de¡roy
(&
loÿl
->
¡a_hash
);

1565 
	`rhÉabË_de¡roy
(&
loÿl
->
lšk_¡a_hash
);

1566 
	}
}

1569 
	$__¡a_šfo_æush
(
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
vÏns
,

1570 
lšk_id
)

1572 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1573 
¡a_šfo
 *
¡a
, *
tmp
;

1574 
	`LIST_HEAD
(
ä“_li¡
);

1575 
»t
 = 0;

1577 
	`might_¦“p
();

1578 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1580 
	`WARN_ON
(
vÏns
 && 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
);

1581 
	`WARN_ON
(
vÏns
 && !
sd©a
->
bss
);

1583 
	`li¡_fÜ_—ch_’Œy_§ã
(
¡a
, 
tmp
, &
loÿl
->
¡a_li¡
, 
li¡
) {

1584 ià(
sd©a
 !ğ
¡a
->sdata &&

1585 (!
vÏns
 || 
sd©a
->
bss
 !ğ
¡a
->sdata->bss))

1588 ià(
lšk_id
 >ğ0 && 
¡a
->¡a.
v®id_lšks
 &&

1589 !(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
lšk_id
)))

1592 ià(!
	`WARN_ON
(
	`__¡a_šfo_de¡roy_·¹1
(
¡a
)))

1593 
	`li¡_add
(&
¡a
->
ä“_li¡
, &free_list);

1595 
»t
++;

1598 ià(!
	`li¡_em±y
(&
ä“_li¡
)) {

1599 
boŞ
 
suµÜt_p2p_ps
 = 
Œue
;

1601 
	`synchrÚize_Ãt
();

1602 
	`li¡_fÜ_—ch_’Œy_§ã
(
¡a
, 
tmp
, &
ä“_li¡
, free_list) {

1603 ià(!
¡a
->¡a.
suµÜt_p2p_ps
)

1604 
suµÜt_p2p_ps
 = 
çl£
;

1605 
	`__¡a_šfo_de¡roy_·¹2
(
¡a
, 
çl£
);

1608 
	`›“80211_»ÿlc_mš_chªdef
(
sd©a
, -1);

1609 ià(!
suµÜt_p2p_ps
)

1610 
	`›“80211_»ÿlc_p2p_go_ps_®lowed
(
sd©a
);

1613  
»t
;

1614 
	}
}

1616 
	$›“80211_¡a_expœe
(
›“80211_sub_if_d©a
 *
sd©a
,

1617 
exp_time
)

1619 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1620 
¡a_šfo
 *
¡a
, *
tmp
;

1622 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1624 
	`li¡_fÜ_—ch_’Œy_§ã
(
¡a
, 
tmp
, &
loÿl
->
¡a_li¡
, 
li¡
) {

1625 
Ï¡_aùive
 = 
	`›“80211_¡a_Ï¡_aùive
(
¡a
);

1627 ià(
sd©a
 !ğ
¡a
->sdata)

1630 ià(
	`time_is_befÜe_jiff›s
(
Ï¡_aùive
 + 
exp_time
)) {

1631 
	`¡a_dbg
(
¡a
->
sd©a
, "expiring inactive STA %pM\n",

1632 
¡a
->¡a.
addr
);

1634 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
) &&

1635 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
))

1636 
	`©omic_dec
(&
sd©a
->
u
.
mesh
.
ps
.
num_¡a_ps
);

1638 
	`WARN_ON
(
	`__¡a_šfo_de¡roy
(
¡a
));

1641 
	}
}

1643 
›“80211_¡a
 *
	$›“80211_fšd_¡a_by_içddr
(
›“80211_hw
 *
hw
,

1644 cÚ¡ 
u8
 *
addr
,

1645 cÚ¡ 
u8
 *
loÿÏddr
)

1647 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1648 
rhli¡_h—d
 *
tmp
;

1649 
¡a_šfo
 *
¡a
;

1655 
	`fÜ_—ch_¡a_šfo
(
loÿl
, 
addr
, 
¡a
, 
tmp
) {

1656 ià(
loÿÏddr
 &&

1657 !
	`‘h”_addr_equ®
(
¡a
->
sd©a
->
vif
.
addr
, 
loÿÏddr
))

1659 ià(!
¡a
->
u¶ßded
)

1660  
NULL
;

1661  &
¡a
->sta;

1664  
NULL
;

1665 
	}
}

1666 
EXPORT_SYMBOL_GPL
(
›“80211_fšd_¡a_by_içddr
);

1668 
›“80211_¡a
 *
	$›“80211_fšd_¡a
(
›“80211_vif
 *
vif
,

1669 cÚ¡ 
u8
 *
addr
)

1671 
¡a_šfo
 *
¡a
;

1673 ià(!
vif
)

1674  
NULL
;

1676 
¡a
 = 
	`¡a_šfo_g‘_bss
(
	`vif_to_sd©a
(
vif
), 
addr
);

1677 ià(!
¡a
)

1678  
NULL
;

1680 ià(!
¡a
->
u¶ßded
)

1681  
NULL
;

1683  &
¡a
->sta;

1684 
	}
}

1685 
EXPORT_SYMBOL
(
›“80211_fšd_¡a
);

1688 
	$›“80211_¡a_ps_d–iv”_wakeup
(
¡a_šfo
 *
¡a
)

1690 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1691 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1692 
sk_buff_h—d
 
³ndšg
;

1693 
f‹»d
 = 0, 
bufã»d
 = 0, 
ac
, 
i
;

1694 
æags
;

1695 
ps_d©a
 *
ps
;

1697 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

1698 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
, 
›“80211_sub_if_d©a
,

1699 
u
.
­
);

1701 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

1702 
ps
 = &
sd©a
->
bss
->ps;

1703 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

1704 
ps
 = &
sd©a
->
u
.
mesh
.ps;

1708 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_SP
);

1710 
	`BUILD_BUG_ON
(
	`BITS_TO_LONGS
(
IEEE80211_NUM_TIDS
) > 1);

1711 
¡a
->
driv”_bufã»d_tids
 = 0;

1712 
¡a
->
txq_bufã»d_tids
 = 0;

1714 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AP_LINK_PS
))

1715 
	`drv_¡a_nÙify
(
loÿl
, 
sd©a
, 
STA_NOTIFY_AWAKE
, &
¡a
->sta);

1717 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->¡a.
txq
); i++) {

1718 ià(!
¡a
->¡a.
txq
[
i
] || !
	`txq_has_queue
(sta->sta.txq[i]))

1721 
	`scheduË_ªd_wake_txq
(
loÿl
, 
	`to_txq_šfo
(
¡a
->¡a.
txq
[
i
]));

1724 
	`skb_queue_h—d_š™
(&
³ndšg
);

1727 
	`¥š_lock
(&
¡a
->
ps_lock
);

1729 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

1730 
couÁ
 = 
	`skb_queue_Ën
(&
³ndšg
), 
tmp
;

1732 
	`¥š_lock_œq§ve
(&
¡a
->
tx_f‹»d
[
ac
].
lock
, 
æags
);

1733 
	`skb_queue_¥liû__š™
(&
¡a
->
tx_f‹»d
[
ac
], &
³ndšg
);

1734 
	`¥š_uÆock_œq»¡Üe
(&
¡a
->
tx_f‹»d
[
ac
].
lock
, 
æags
);

1735 
tmp
 = 
	`skb_queue_Ën
(&
³ndšg
);

1736 
f‹»d
 +ğ
tmp
 - 
couÁ
;

1737 
couÁ
 = 
tmp
;

1739 
	`¥š_lock_œq§ve
(&
¡a
->
ps_tx_buf
[
ac
].
lock
, 
æags
);

1740 
	`skb_queue_¥liû__š™
(&
¡a
->
ps_tx_buf
[
ac
], &
³ndšg
);

1741 
	`¥š_uÆock_œq»¡Üe
(&
¡a
->
ps_tx_buf
[
ac
].
lock
, 
æags
);

1742 
tmp
 = 
	`skb_queue_Ën
(&
³ndšg
);

1743 
bufã»d
 +ğ
tmp
 - 
couÁ
;

1746 
	`›“80211_add_³ndšg_skbs
(
loÿl
, &
³ndšg
);

1749 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
);

1754 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PSPOLL
);

1755 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_UAPSD
);

1756 
	`¥š_uÆock
(&
¡a
->
ps_lock
);

1758 
	`©omic_dec
(&
ps
->
num_¡a_ps
);

1760 
loÿl
->
tÙ®_ps_bufã»d
 -ğ
bufã»d
;

1762 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

1764 
	`ps_dbg
(
sd©a
,

1766 
¡a
->¡a.
addr
, s->¡a.
aid
, 
f‹»d
, 
bufã»d
);

1768 
	`›“80211_check_ç¡_xm™
(
¡a
);

1769 
	}
}

1771 
	$›“80211_£nd_nuÎ_»¥Ú£
(
¡a_šfo
 *
¡a
, 
tid
,

1772 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

1773 
boŞ
 
ÿÎ_driv”
, boŞ 
mÜe_d©a
)

1775 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1776 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1777 
›“80211_qos_hdr
 *
nuÎfunc
;

1778 
sk_buff
 *
skb
;

1779 
size
 = (*
nuÎfunc
);

1780 
__Ë16
 
fc
;

1781 
boŞ
 
qos
 = 
¡a
->¡a.
wme
;

1782 
›“80211_tx_šfo
 *
šfo
;

1783 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

1785 ià(
qos
) {

1786 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 |

1787 
IEEE80211_STYPE_QOS_NULLFUNC
 |

1788 
IEEE80211_FCTL_FROMDS
);

1790 
size
 -= 2;

1791 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 |

1792 
IEEE80211_STYPE_NULLFUNC
 |

1793 
IEEE80211_FCTL_FROMDS
);

1796 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
size
);

1797 ià(!
skb
)

1800 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

1802 
nuÎfunc
 = 
	`skb_put
(
skb
, 
size
);

1803 
nuÎfunc
->
äame_cÚŒŞ
 = 
fc
;

1804 
nuÎfunc
->
du¿tiÚ_id
 = 0;

1805 
	`memıy
(
nuÎfunc
->
addr1
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

1806 
	`memıy
(
nuÎfunc
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1807 
	`memıy
(
nuÎfunc
->
addr3
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1808 
nuÎfunc
->
£q_ù¾
 = 0;

1810 
skb
->
´iÜ™y
 = 
tid
;

1811 
	`skb_£t_queue_m­pšg
(
skb
, 
›“802_1d_to_ac
[
tid
]);

1812 ià(
qos
) {

1813 
nuÎfunc
->
qos_ù¾
 = 
	`ıu_to_Ë16
(
tid
);

1815 ià(
»asÚ
 =ğ
IEEE80211_FRAME_RELEASE_UAPSD
) {

1816 
nuÎfunc
->
qos_ù¾
 |=

1817 
	`ıu_to_Ë16
(
IEEE80211_QOS_CTL_EOSP
);

1818 ià(
mÜe_d©a
)

1819 
nuÎfunc
->
äame_cÚŒŞ
 |=

1820 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

1824 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1832 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_PS_BUFFER
 |

1833 
IEEE80211_TX_STATUS_EOSP
 |

1834 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

1836 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_PS_RESPONSE
;

1838 ià(
ÿÎ_driv”
)

1839 
	`drv_®low_bufã»d_äames
(
loÿl
, 
¡a
, 
	`BIT
(
tid
), 1,

1840 
»asÚ
, 
çl£
);

1842 
skb
->
dev
 = 
sd©a
->dev;

1844 
	`rcu_»ad_lock
();

1845 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

1846 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

1847 
	`rcu_»ad_uÆock
();

1848 
	`kä“_skb
(
skb
);

1852 
šfo
->
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

1853 
	`›“80211_xm™
(
sd©a
, 
¡a
, 
skb
);

1854 
	`rcu_»ad_uÆock
();

1855 
	}
}

1857 
	$fšd_highe¡_´io_tid
(
tids
)

1860 ià(
tids
 & 0xF8)

1861  
	`æs
(
tids
) - 1;

1863 ià(
tids
 & 
	`BIT
(0))

1865  
	`æs
(
tids
) - 1;

1866 
	}
}

1873 
boŞ


1874 
	$›“80211_¡a_ps_mÜe_d©a
(
¡a_šfo
 *
¡a
, 
u8
 
ignÜed_acs
,

1875 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

1876 
driv”_»Ëa£_tids
)

1878 
ac
;

1885 ià(
»asÚ
 =ğ
IEEE80211_FRAME_RELEASE_PSPOLL
 &&

1886 
	`hweight16
(
driv”_»Ëa£_tids
) > 1)

1887  
Œue
;

1889 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

1890 ià(
ignÜed_acs
 & 
›“80211_ac_to_qos_mask
[
ac
])

1893 ià(!
	`skb_queue_em±y
(&
¡a
->
tx_f‹»d
[
ac
]) ||

1894 !
	`skb_queue_em±y
(&
¡a
->
ps_tx_buf
[
ac
]))

1895  
Œue
;

1898  
çl£
;

1899 
	}
}

1902 
	$›“80211_¡a_ps_g‘_äames
(
¡a_šfo
 *
¡a
, 
n_äames
, 
u8
 
ignÜed_acs
,

1903 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

1904 
sk_buff_h—d
 *
äames
,

1905 *
driv”_»Ëa£_tids
)

1907 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1908 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1909 
ac
;

1912 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

1913 
tids
;

1915 ià(
ignÜed_acs
 & 
›“80211_ac_to_qos_mask
[
ac
])

1918 
tids
 = 
	`›“80211_tids_fÜ_ac
(
ac
);

1923 ià(
	`skb_queue_em±y
(
äames
)) {

1924 *
driv”_»Ëa£_tids
 |=

1925 
¡a
->
driv”_bufã»d_tids
 & 
tids
;

1926 *
driv”_»Ëa£_tids
 |ğ
¡a
->
txq_bufã»d_tids
 & 
tids
;

1929 ià(!*
driv”_»Ëa£_tids
) {

1930 
sk_buff
 *
skb
;

1932 
n_äames
 > 0) {

1933 
skb
 = 
	`skb_dequeue
(&
¡a
->
tx_f‹»d
[
ac
]);

1934 ià(!
skb
) {

1935 
skb
 = 
	`skb_dequeue
(

1936 &
¡a
->
ps_tx_buf
[
ac
]);

1937 ià(
skb
)

1938 
loÿl
->
tÙ®_ps_bufã»d
--;

1940 ià(!
skb
)

1942 
n_äames
--;

1943 
	`__skb_queue_
(
äames
, 
skb
);

1951 ià(!
	`skb_queue_em±y
(&
¡a
->
tx_f‹»d
[
ac
]) ||

1952 !
	`skb_queue_em±y
(&
¡a
->
ps_tx_buf
[
ac
]))

1955 
	}
}

1958 
	$›“80211_¡a_ps_d–iv”_»¥Ú£
(
¡a_šfo
 *
¡a
,

1959 
n_äames
, 
u8
 
ignÜed_acs
,

1960 
›“80211_äame_»Ëa£_ty³
 
»asÚ
)

1962 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1963 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1964 
driv”_»Ëa£_tids
 = 0;

1965 
sk_buff_h—d
 
äames
;

1966 
boŞ
 
mÜe_d©a
;

1969 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_SP
);

1971 
	`__skb_queue_h—d_š™
(&
äames
);

1973 
	`›“80211_¡a_ps_g‘_äames
(
¡a
, 
n_äames
, 
ignÜed_acs
, 
»asÚ
,

1974 &
äames
, &
driv”_»Ëa£_tids
);

1976 
mÜe_d©a
 = 
	`›“80211_¡a_ps_mÜe_d©a
(
¡a
, 
ignÜed_acs
, 
»asÚ
, 
driv”_»Ëa£_tids
);

1978 ià(
driv”_»Ëa£_tids
 && 
»asÚ
 =ğ
IEEE80211_FRAME_RELEASE_PSPOLL
)

1979 
driv”_»Ëa£_tids
 =

1980 
	`BIT
(
	`fšd_highe¡_´io_tid
(
driv”_»Ëa£_tids
));

1982 ià(
	`skb_queue_em±y
(&
äames
è&& !
driv”_»Ëa£_tids
) {

1983 
tid
, 
ac
;

2001 
ac
 = 
IEEE80211_AC_VO
;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

2002 ià(!(
ignÜed_acs
 & 
›“80211_ac_to_qos_mask
[
ac
]))

2004 
tid
 = 7 - 2 * 
ac
;

2006 
	`›“80211_£nd_nuÎ_»¥Ú£
(
¡a
, 
tid
, 
»asÚ
, 
Œue
, 
çl£
);

2007 } ià(!
driv”_»Ëa£_tids
) {

2008 
sk_buff_h—d
 
³ndšg
;

2009 
sk_buff
 *
skb
;

2010 
num
 = 0;

2011 
u16
 
tids
 = 0;

2012 
boŞ
 
Ãed_nuÎ
 = 
çl£
;

2014 
	`skb_queue_h—d_š™
(&
³ndšg
);

2016 (
skb
 = 
	`__skb_dequeue
(&
äames
))) {

2017 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2018 
›“80211_hdr
 *
hdr
 = (*è
skb
->
d©a
;

2019 
u8
 *
qoshdr
 = 
NULL
;

2021 
num
++;

2028 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_PS_BUFFER
;

2029 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_PS_RESPONSE
;

2035 ià(
mÜe_d©a
 || !
	`skb_queue_em±y
(&
äames
))

2036 
hdr
->
äame_cÚŒŞ
 |=

2037 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

2039 
hdr
->
äame_cÚŒŞ
 &=

2040 
	`ıu_to_Ë16
(~
IEEE80211_FCTL_MOREDATA
);

2042 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) ||

2043 
	`›“80211_is_qos_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

2044 
qoshdr
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

2046 
tids
 |ğ
	`BIT
(
skb
->
´iÜ™y
);

2048 
	`__skb_queue_
(&
³ndšg
, 
skb
);

2051 ià(!
	`skb_queue_em±y
(&
äames
))

2054 ià(
»asÚ
 !ğ
IEEE80211_FRAME_RELEASE_UAPSD
) {

2056 
šfo
->
æags
 |ğ
IEEE80211_TX_STATUS_EOSP
 |

2057 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

2077 ià(
qoshdr
) {

2078 *
qoshdr
 |ğ
IEEE80211_QOS_CTL_EOSP
;

2080 
šfo
->
æags
 |ğ
IEEE80211_TX_STATUS_EOSP
 |

2081 
IEEE80211_TX_CTL_REQ_TX_STATUS
;

2091 
hdr
->
äame_cÚŒŞ
 |=

2092 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

2093 
Ãed_nuÎ
 = 
Œue
;

2094 
num
++;

2099 
	`drv_®low_bufã»d_äames
(
loÿl
, 
¡a
, 
tids
, 
num
,

2100 
»asÚ
, 
mÜe_d©a
);

2102 
	`›“80211_add_³ndšg_skbs
(
loÿl
, &
³ndšg
);

2104 ià(
Ãed_nuÎ
)

2105 
	`›“80211_£nd_nuÎ_»¥Ú£
(

2106 
¡a
, 
	`fšd_highe¡_´io_tid
(
tids
),

2107 
»asÚ
, 
çl£
, false);

2109 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

2111 
tid
;

2123 
	`drv_»Ëa£_bufã»d_äames
(
loÿl
, 
¡a
, 
driv”_»Ëa£_tids
,

2124 
n_äames
, 
»asÚ
, 
mÜe_d©a
);

2136 
tid
 = 0;id < 
	`ARRAY_SIZE
(
¡a
->¡a.
txq
);id++) {

2137 ià(!
¡a
->¡a.
txq
[
tid
] ||

2138 !(
driv”_»Ëa£_tids
 & 
	`BIT
(
tid
)) ||

2139 
	`txq_has_queue
(
¡a
->¡a.
txq
[
tid
]))

2142 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

2146 
	}
}

2148 
	$›“80211_¡a_ps_d–iv”_pŞl_»¥Ú£
(
¡a_šfo
 *
¡a
)

2150 
u8
 
ignÜe_fÜ_»¥Ú£
 = 
¡a
->¡a.
u­sd_queues
;

2157 ià(
ignÜe_fÜ_»¥Ú£
 =ğ
	`BIT
(
IEEE80211_NUM_ACS
) - 1)

2158 
ignÜe_fÜ_»¥Ú£
 = 0;

2160 
	`›“80211_¡a_ps_d–iv”_»¥Ú£
(
¡a
, 1, 
ignÜe_fÜ_»¥Ú£
,

2161 
IEEE80211_FRAME_RELEASE_PSPOLL
);

2162 
	}
}

2164 
	$›“80211_¡a_ps_d–iv”_u­sd
(
¡a_šfo
 *
¡a
)

2166 
n_äames
 = 
¡a
->¡a.
max_¥
;

2167 
u8
 
d–iv”y_’abËd
 = 
¡a
->¡a.
u­sd_queues
;

2175 ià(!
d–iv”y_’abËd
)

2178 
¡a
->¡a.
max_¥
) {

2180 
n_äames
 = 2;

2183 
n_äames
 = 4;

2186 
n_äames
 = 6;

2190 
n_äames
 = 128;

2194 
	`›“80211_¡a_ps_d–iv”_»¥Ú£
(
¡a
, 
n_äames
, ~
d–iv”y_’abËd
,

2195 
IEEE80211_FRAME_RELEASE_UAPSD
);

2196 
	}
}

2198 
	$›“80211_¡a_block_awake
(
›“80211_hw
 *
hw
,

2199 
›“80211_¡a
 *
pub¡a
, 
boŞ
 
block
)

2201 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2203 
	`Œaû_­i_¡a_block_awake
(
¡a
->
loÿl
, 
pub¡a
, 
block
);

2205 ià(
block
) {

2206 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
);

2207 
	`›“80211_ş—r_ç¡_xm™
(
¡a
);

2211 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
))

2214 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
)) {

2215 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
);

2216 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
);

2217 
	`›“80211_queue_wÜk
(
hw
, &
¡a
->
drv_d–iv”_wk
);

2218 } ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PSPOLL
) ||

2219 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_UAPSD
)) {

2221 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
);

2222 
	`›“80211_queue_wÜk
(
hw
, &
¡a
->
drv_d–iv”_wk
);

2224 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
);

2225 
	`›“80211_check_ç¡_xm™
(
¡a
);

2227 
	}
}

2228 
EXPORT_SYMBOL
(
›“80211_¡a_block_awake
);

2230 
	$›“80211_¡a_eo¥
(
›“80211_¡a
 *
pub¡a
)

2232 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2233 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

2235 
	`Œaû_­i_eo¥
(
loÿl
, 
pub¡a
);

2237 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_SP
);

2238 
	}
}

2239 
EXPORT_SYMBOL
(
›“80211_¡a_eo¥
);

2241 
	$›“80211_£nd_eo¥_nuÎfunc
(
›“80211_¡a
 *
pub¡a
, 
tid
)

2243 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2244 
›“80211_äame_»Ëa£_ty³
 
»asÚ
;

2245 
boŞ
 
mÜe_d©a
;

2247 
	`Œaû_­i_£nd_eo¥_nuÎfunc
(
¡a
->
loÿl
, 
pub¡a
, 
tid
);

2249 
»asÚ
 = 
IEEE80211_FRAME_RELEASE_UAPSD
;

2250 
mÜe_d©a
 = 
	`›“80211_¡a_ps_mÜe_d©a
(
¡a
, ~¡a->¡a.
u­sd_queues
,

2251 
»asÚ
, 0);

2253 
	`›“80211_£nd_nuÎ_»¥Ú£
(
¡a
, 
tid
, 
»asÚ
, 
çl£
, 
mÜe_d©a
);

2254 
	}
}

2255 
EXPORT_SYMBOL
(
›“80211_£nd_eo¥_nuÎfunc
);

2257 
	$›“80211_¡a_£t_bufã»d
(
›“80211_¡a
 *
pub¡a
,

2258 
u8
 
tid
, 
boŞ
 
bufã»d
)

2260 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2262 ià(
	`WARN_ON
(
tid
 >ğ
IEEE80211_NUM_TIDS
))

2265 
	`Œaû_­i_¡a_£t_bufã»d
(
¡a
->
loÿl
, 
pub¡a
, 
tid
, 
bufã»d
);

2267 ià(
bufã»d
)

2268 
	`£t_b™
(
tid
, &
¡a
->
driv”_bufã»d_tids
);

2270 
	`ş—r_b™
(
tid
, &
¡a
->
driv”_bufã»d_tids
);

2272 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

2273 
	}
}

2274 
EXPORT_SYMBOL
(
›“80211_¡a_£t_bufã»d
);

2276 
	$›“80211_¡a_»gi¡”_aœtime
(
›“80211_¡a
 *
pub¡a
, 
u8
 
tid
,

2277 
u32
 
tx_aœtime
, u32 
rx_aœtime
)

2279 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2280 
›“80211_loÿl
 *
loÿl
 = 
¡a
->
sd©a
->local;

2281 
u8
 
ac
 = 
	`›“80211_ac_äom_tid
(
tid
);

2282 
u32
 
aœtime
 = 0;

2284 ià(
¡a
->
loÿl
->
aœtime_æags
 & 
AIRTIME_USE_TX
)

2285 
aœtime
 +ğ
tx_aœtime
;

2286 ià(
¡a
->
loÿl
->
aœtime_æags
 & 
AIRTIME_USE_RX
)

2287 
aœtime
 +ğ
rx_aœtime
;

2289 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

2290 
¡a
->
aœtime
[
ac
].
tx_aœtime
 +=x_airtime;

2291 
¡a
->
aœtime
[
ac
].
rx_aœtime
 +=„x_airtime;

2293 ià(
	`›“80211_¡a_k“p_aùive
(
¡a
, 
ac
))

2294 
¡a
->
aœtime
[
ac
].
defic™
 -=‡irtime;

2296 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

2297 
	}
}

2298 
EXPORT_SYMBOL
(
›“80211_¡a_»gi¡”_aœtime
);

2300 
	$__›“80211_¡a_»ÿlc_agg»g©es
(
¡a_šfo
 *
¡a
, 
u16
 
aùive_lšks
)

2302 
boŞ
 
fœ¡
 = 
Œue
;

2303 
lšk_id
;

2305 ià(!
¡a
->¡a.
v®id_lšks
 || !¡a->¡a.
mlo
) {

2306 
¡a
->¡a.
cur
 = &¡a->¡a.
deæšk
.
agg
;

2310 
	`rcu_»ad_lock
();

2311 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
((
¡a
)->
lšk
);†ink_id++) {

2312 
›“80211_lšk_¡a
 *
lšk_¡a
;

2313 
i
;

2315 ià(!(
aùive_lšks
 & 
	`BIT
(
lšk_id
)))

2318 
lšk_¡a
 = 
	`rcu_d”eã»nû
(
¡a
->¡a.
lšk
[
lšk_id
]);

2319 ià(!
lšk_¡a
)

2322 ià(
fœ¡
) {

2323 
¡a
->
cur
 = s->¡a.
deæšk
.
agg
;

2324 
fœ¡
 = 
çl£
;

2328 
¡a
->
cur
.
max_amsdu_Ën
 =

2329 
	`mš
(
¡a
->
cur
.
max_amsdu_Ën
,

2330 
lšk_¡a
->
agg
.
max_amsdu_Ën
);

2331 
¡a
->
cur
.
max_rc_amsdu_Ën
 =

2332 
	`mš
(
¡a
->
cur
.
max_rc_amsdu_Ën
,

2333 
lšk_¡a
->
agg
.
max_rc_amsdu_Ën
);

2335 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->
cur
.
max_tid_amsdu_Ën
); i++)

2336 
¡a
->
cur
.
max_tid_amsdu_Ën
[
i
] =

2337 
	`mš
(
¡a
->
cur
.
max_tid_amsdu_Ën
[
i
],

2338 
lšk_¡a
->
agg
.
max_tid_amsdu_Ën
[
i
]);

2340 
	`rcu_»ad_uÆock
();

2342 
¡a
->¡a.
cur
 = &sta->cur;

2343 
	}
}

2345 
	$›“80211_¡a_»ÿlc_agg»g©es
(
›“80211_¡a
 *
pub¡a
)

2347 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2349 
	`__›“80211_¡a_»ÿlc_agg»g©es
(
¡a
, s->
sd©a
->
vif
.
aùive_lšks
);

2350 
	}
}

2351 
EXPORT_SYMBOL
(
›“80211_¡a_»ÿlc_agg»g©es
);

2353 
	$›“80211_¡a_upd©e_³ndšg_aœtime
(
›“80211_loÿl
 *
loÿl
,

2354 
¡a_šfo
 *
¡a
, 
u8
 
ac
,

2355 
u16
 
tx_aœtime
, 
boŞ
 
tx_com¶‘ed
)

2357 
tx_³ndšg
;

2359 ià(!
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
, 
NL80211_EXT_FEATURE_AQL
))

2362 ià(!
tx_com¶‘ed
) {

2363 ià(
¡a
)

2364 
	`©omic_add
(
tx_aœtime
,

2365 &
¡a
->
aœtime
[
ac
].
aql_tx_³ndšg
);

2367 
	`©omic_add
(
tx_aœtime
, &
loÿl
->
aql_tÙ®_³ndšg_aœtime
);

2368 
	`©omic_add
(
tx_aœtime
, &
loÿl
->
aql_ac_³ndšg_aœtime
[
ac
]);

2372 ià(
¡a
) {

2373 
tx_³ndšg
 = 
	`©omic_sub_»tuº
(
tx_aœtime
,

2374 &
¡a
->
aœtime
[
ac
].
aql_tx_³ndšg
);

2375 ià(
tx_³ndšg
 < 0)

2376 
	`©omic_cmpxchg
(&
¡a
->
aœtime
[
ac
].
aql_tx_³ndšg
,

2377 
tx_³ndšg
, 0);

2380 
	`©omic_sub
(
tx_aœtime
, &
loÿl
->
aql_tÙ®_³ndšg_aœtime
);

2381 
tx_³ndšg
 = 
	`©omic_sub_»tuº
(
tx_aœtime
,

2382 &
loÿl
->
aql_ac_³ndšg_aœtime
[
ac
]);

2383 ià(
	`WARN_ONCE
(
tx_³ndšg
 < 0,

2385 
	`why_Çme
(
loÿl
->
hw
.
why
), 
ac
, 
tx_³ndšg
,

2386 
tx_aœtime
)) {

2387 
	`©omic_cmpxchg
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
ac
],

2388 
tx_³ndšg
, 0);

2389 
	`©omic_sub
(
tx_³ndšg
, &
loÿl
->
aql_tÙ®_³ndšg_aœtime
);

2391 
	}
}

2393 
›“80211_¡a_rx_¡©s
 *

2394 
	$¡a_g‘_Ï¡_rx_¡©s
(
¡a_šfo
 *
¡a
)

2396 
›“80211_¡a_rx_¡©s
 *
¡©s
 = &
¡a
->
deæšk
.
rx_¡©s
;

2397 
ıu
;

2399 ià(!
¡a
->
deæšk
.
pıu_rx_¡©s
)

2400  
¡©s
;

2402 
	`fÜ_—ch_possibË_ıu
(
ıu
) {

2403 
›“80211_¡a_rx_¡©s
 *
ıu¡©s
;

2405 
ıu¡©s
 = 
	`³r_ıu_±r
(
¡a
->
deæšk
.
pıu_rx_¡©s
, 
ıu
);

2407 ià(
	`time_aá”
(
ıu¡©s
->
Ï¡_rx
, 
¡©s
->last_rx))

2408 
¡©s
 = 
ıu¡©s
;

2411  
¡©s
;

2412 
	}
}

2414 
	$¡a_¡©s_decode_¿‹
(
›“80211_loÿl
 *
loÿl
, 
u32
 
¿‹
,

2415 
¿‹_šfo
 *
ršfo
)

2417 
ršfo
->
bw
 = 
	`STA_STATS_GET
(
BW
, 
¿‹
);

2419 
	`STA_STATS_GET
(
TYPE
, 
¿‹
)) {

2420 
STA_STATS_RATE_TYPE_VHT
:

2421 
ršfo
->
æags
 = 
RATE_INFO_FLAGS_VHT_MCS
;

2422 
ršfo
->
mcs
 = 
	`STA_STATS_GET
(
VHT_MCS
, 
¿‹
);

2423 
ršfo
->
nss
 = 
	`STA_STATS_GET
(
VHT_NSS
, 
¿‹
);

2424 ià(
	`STA_STATS_GET
(
SGI
, 
¿‹
))

2425 
ršfo
->
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

2427 
STA_STATS_RATE_TYPE_HT
:

2428 
ršfo
->
æags
 = 
RATE_INFO_FLAGS_MCS
;

2429 
ršfo
->
mcs
 = 
	`STA_STATS_GET
(
HT_MCS
, 
¿‹
);

2430 ià(
	`STA_STATS_GET
(
SGI
, 
¿‹
))

2431 
ršfo
->
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

2433 
STA_STATS_RATE_TYPE_LEGACY
: {

2434 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

2435 
u16
 
b¿‹
;

2436 
shiá
;

2437 
bªd
 = 
	`STA_STATS_GET
(
LEGACY_BAND
, 
¿‹
);

2438 
¿‹_idx
 = 
	`STA_STATS_GET
(
LEGACY_IDX
, 
¿‹
);

2440 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

2442 ià(
	`WARN_ON_ONCE
(!
sbªd
->
b™¿‹s
))

2445 
b¿‹
 = 
sbªd
->
b™¿‹s
[
¿‹_idx
].
b™¿‹
;

2446 ià(
ršfo
->
bw
 =ğ
RATE_INFO_BW_5
)

2447 
shiá
 = 2;

2448 ià(
ršfo
->
bw
 =ğ
RATE_INFO_BW_10
)

2449 
shiá
 = 1;

2451 
shiá
 = 0;

2452 
ršfo
->
Ëgacy
 = 
	`DIV_ROUND_UP
(
b¿‹
, 1 << 
shiá
);

2455 
STA_STATS_RATE_TYPE_HE
:

2456 
ršfo
->
æags
 = 
RATE_INFO_FLAGS_HE_MCS
;

2457 
ršfo
->
mcs
 = 
	`STA_STATS_GET
(
HE_MCS
, 
¿‹
);

2458 
ršfo
->
nss
 = 
	`STA_STATS_GET
(
HE_NSS
, 
¿‹
);

2459 
ršfo
->
he_gi
 = 
	`STA_STATS_GET
(
HE_GI
, 
¿‹
);

2460 
ršfo
->
he_ru_®loc
 = 
	`STA_STATS_GET
(
HE_RU
, 
¿‹
);

2461 
ršfo
->
he_dcm
 = 
	`STA_STATS_GET
(
HE_DCM
, 
¿‹
);

2463 
STA_STATS_RATE_TYPE_EHT
:

2464 
ršfo
->
æags
 = 
RATE_INFO_FLAGS_EHT_MCS
;

2465 
ršfo
->
mcs
 = 
	`STA_STATS_GET
(
EHT_MCS
, 
¿‹
);

2466 
ršfo
->
nss
 = 
	`STA_STATS_GET
(
EHT_NSS
, 
¿‹
);

2467 
ršfo
->
eht_gi
 = 
	`STA_STATS_GET
(
EHT_GI
, 
¿‹
);

2468 
ršfo
->
eht_ru_®loc
 = 
	`STA_STATS_GET
(
EHT_RU
, 
¿‹
);

2471 
	}
}

2473 
	$¡a_£t_¿‹_šfo_rx
(
¡a_šfo
 *
¡a
, 
¿‹_šfo
 *
ršfo
)

2475 
u32
 
¿‹
 = 
	`READ_ONCE
(
	`¡a_g‘_Ï¡_rx_¡©s
(
¡a
)->
Ï¡_¿‹
);

2477 ià(
¿‹
 =ğ
STA_STATS_RATE_INVALID
)

2478  -
EINVAL
;

2480 
	`¡a_¡©s_decode_¿‹
(
¡a
->
loÿl
, 
¿‹
, 
ršfo
);

2482 
	}
}

2484 
šlše
 
u64
 
	$¡a_g‘_tid¡©s_msdu
(
›“80211_¡a_rx_¡©s
 *
rx¡©s
,

2485 
tid
)

2487 
¡¬t
;

2488 
u64
 
v®ue
;

2491 
¡¬t
 = 
	`u64_¡©s_ãtch_begš
(&
rx¡©s
->
synı
);

2492 
v®ue
 = 
rx¡©s
->
msdu
[
tid
];

2493 } 
	`u64_¡©s_ãtch_»Œy
(&
rx¡©s
->
synı
, 
¡¬t
));

2495  
v®ue
;

2496 
	}
}

2498 
	$¡a_£t_tid¡©s
(
¡a_šfo
 *
¡a
,

2499 
cfg80211_tid_¡©s
 *
tid¡©s
,

2500 
tid
)

2502 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

2503 
ıu
;

2505 ià(!(
tid¡©s
->
fËd
 & 
	`BIT
(
NL80211_TID_STATS_RX_MSDU
))) {

2506 
tid¡©s
->
rx_msdu
 +ğ
	`¡a_g‘_tid¡©s_msdu
(&
¡a
->
deæšk
.
rx_¡©s
,

2507 
tid
);

2509 ià(
¡a
->
deæšk
.
pıu_rx_¡©s
) {

2510 
	`fÜ_—ch_possibË_ıu
(
ıu
) {

2511 
›“80211_¡a_rx_¡©s
 *
ıurxs
;

2513 
ıurxs
 = 
	`³r_ıu_±r
(
¡a
->
deæšk
.
pıu_rx_¡©s
,

2514 
ıu
);

2515 
tid¡©s
->
rx_msdu
 +=

2516 
	`¡a_g‘_tid¡©s_msdu
(
ıurxs
, 
tid
);

2520 
tid¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TID_STATS_RX_MSDU
);

2523 ià(!(
tid¡©s
->
fËd
 & 
	`BIT
(
NL80211_TID_STATS_TX_MSDU
))) {

2524 
tid¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TID_STATS_TX_MSDU
);

2525 
tid¡©s
->
tx_msdu
 = 
¡a
->
deæšk
.
tx_¡©s
.
msdu
[
tid
];

2528 ià(!(
tid¡©s
->
fËd
 & 
	`BIT
(
NL80211_TID_STATS_TX_MSDU_RETRIES
)) &&

2529 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

2530 
tid¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TID_STATS_TX_MSDU_RETRIES
);

2531 
tid¡©s
->
tx_msdu_»Œ›s
 = 
¡a
->
deæšk
.
¡©us_¡©s
.
msdu_»Œ›s
[
tid
];

2534 ià(!(
tid¡©s
->
fËd
 & 
	`BIT
(
NL80211_TID_STATS_TX_MSDU_FAILED
)) &&

2535 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

2536 
tid¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TID_STATS_TX_MSDU_FAILED
);

2537 
tid¡©s
->
tx_msdu_çed
 = 
¡a
->
deæšk
.
¡©us_¡©s
.
msdu_çed
[
tid
];

2540 ià(
tid
 < 
IEEE80211_NUM_TIDS
) {

2541 
	`¥š_lock_bh
(&
loÿl
->
fq
.
lock
);

2542 
	`rcu_»ad_lock
();

2544 
tid¡©s
->
fËd
 |ğ
	`BIT
(
NL80211_TID_STATS_TXQ_STATS
);

2545 
	`›“80211_fl_txq_¡©s
(&
tid¡©s
->
txq_¡©s
,

2546 
	`to_txq_šfo
(
¡a
->¡a.
txq
[
tid
]));

2548 
	`rcu_»ad_uÆock
();

2549 
	`¥š_uÆock_bh
(&
loÿl
->
fq
.
lock
);

2551 
	}
}

2553 
šlše
 
u64
 
	$¡a_g‘_¡©s_by‹s
(
›“80211_¡a_rx_¡©s
 *
rx¡©s
)

2555 
¡¬t
;

2556 
u64
 
v®ue
;

2559 
¡¬t
 = 
	`u64_¡©s_ãtch_begš
(&
rx¡©s
->
synı
);

2560 
v®ue
 = 
rx¡©s
->
by‹s
;

2561 } 
	`u64_¡©s_ãtch_»Œy
(&
rx¡©s
->
synı
, 
¡¬t
));

2563  
v®ue
;

2564 
	}
}

2566 
	$¡a_£t_sšfo
(
¡a_šfo
 *
¡a
, 
¡©iÚ_šfo
 *
sšfo
,

2567 
boŞ
 
tid¡©s
)

2569 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

2570 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2571 
u32
 
thr
 = 0;

2572 
i
, 
ac
, 
ıu
;

2573 
›“80211_¡a_rx_¡©s
 *
Ï¡_rx¡©s
;

2575 
Ï¡_rx¡©s
 = 
	`¡a_g‘_Ï¡_rx_¡©s
(
¡a
);

2577 
sšfo
->
g’”©iÚ
 = 
sd©a
->
loÿl
->
¡a_g’”©iÚ
;

2583 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

2584 
sšfo
->
rx_b—cÚ
 = 
sd©a
->
deæšk
.
u
.
mgd
.
couÁ_b—cÚ_sigÇl
;

2586 
	`drv_¡a_¡©i¡ics
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
sšfo
);

2587 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_INACTIVE_TIME
) |

2588 
	`BIT_ULL
(
NL80211_STA_INFO_STA_FLAGS
) |

2589 
	`BIT_ULL
(
NL80211_STA_INFO_BSS_PARAM
) |

2590 
	`BIT_ULL
(
NL80211_STA_INFO_CONNECTED_TIME
) |

2591 
	`BIT_ULL
(
NL80211_STA_INFO_ASSOC_AT_BOOTTIME
) |

2592 
	`BIT_ULL
(
NL80211_STA_INFO_RX_DROP_MISC
);

2594 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

2595 
sšfo
->
b—cÚ_loss_couÁ
 =

2596 
sd©a
->
deæšk
.
u
.
mgd
.
b—cÚ_loss_couÁ
;

2597 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_BEACON_LOSS
);

2600 
sšfo
->
cÚÃùed_time
 = 
	`ktime_g‘_£cÚds
(è- 
¡a
->
Ï¡_cÚÃùed
;

2601 
sšfo
->
assoc_©
 = 
¡a
->assoc_at;

2602 
sšfo
->
šaùive_time
 =

2603 
	`jiff›s_to_m£cs
(
jiff›s
 - 
	`›“80211_¡a_Ï¡_aùive
(
¡a
));

2605 ià(!(
sšfo
->
fËd
 & (
	`BIT_ULL
(
NL80211_STA_INFO_TX_BYTES64
) |

2606 
	`BIT_ULL
(
NL80211_STA_INFO_TX_BYTES
)))) {

2607 
sšfo
->
tx_by‹s
 = 0;

2608 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

2609 
sšfo
->
tx_by‹s
 +ğ
¡a
->
deæšk
.
tx_¡©s
.
by‹s
[
ac
];

2610 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_TX_BYTES64
);

2613 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_TX_PACKETS
))) {

2614 
sšfo
->
tx_·ck‘s
 = 0;

2615 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

2616 
sšfo
->
tx_·ck‘s
 +ğ
¡a
->
deæšk
.
tx_¡©s
.
·ck‘s
[
ac
];

2617 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_TX_PACKETS
);

2620 ià(!(
sšfo
->
fËd
 & (
	`BIT_ULL
(
NL80211_STA_INFO_RX_BYTES64
) |

2621 
	`BIT_ULL
(
NL80211_STA_INFO_RX_BYTES
)))) {

2622 
sšfo
->
rx_by‹s
 +ğ
	`¡a_g‘_¡©s_by‹s
(&
¡a
->
deæšk
.
rx_¡©s
);

2624 ià(
¡a
->
deæšk
.
pıu_rx_¡©s
) {

2625 
	`fÜ_—ch_possibË_ıu
(
ıu
) {

2626 
›“80211_¡a_rx_¡©s
 *
ıurxs
;

2628 
ıurxs
 = 
	`³r_ıu_±r
(
¡a
->
deæšk
.
pıu_rx_¡©s
,

2629 
ıu
);

2630 
sšfo
->
rx_by‹s
 +ğ
	`¡a_g‘_¡©s_by‹s
(
ıurxs
);

2634 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_RX_BYTES64
);

2637 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_RX_PACKETS
))) {

2638 
sšfo
->
rx_·ck‘s
 = 
¡a
->
deæšk
.
rx_¡©s
.
·ck‘s
;

2639 ià(
¡a
->
deæšk
.
pıu_rx_¡©s
) {

2640 
	`fÜ_—ch_possibË_ıu
(
ıu
) {

2641 
›“80211_¡a_rx_¡©s
 *
ıurxs
;

2643 
ıurxs
 = 
	`³r_ıu_±r
(
¡a
->
deæšk
.
pıu_rx_¡©s
,

2644 
ıu
);

2645 
sšfo
->
rx_·ck‘s
 +ğ
ıurxs
->
·ck‘s
;

2648 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_RX_PACKETS
);

2651 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_TX_RETRIES
))) {

2652 
sšfo
->
tx_»Œ›s
 = 
¡a
->
deæšk
.
¡©us_¡©s
.
»Œy_couÁ
;

2653 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_TX_RETRIES
);

2656 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_TX_FAILED
))) {

2657 
sšfo
->
tx_çed
 = 
¡a
->
deæšk
.
¡©us_¡©s
.
»Œy_çed
;

2658 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_TX_FAILED
);

2661 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_RX_DURATION
))) {

2662 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

2663 
sšfo
->
rx_du¿tiÚ
 +ğ
¡a
->
aœtime
[
ac
].
rx_aœtime
;

2664 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_RX_DURATION
);

2667 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_TX_DURATION
))) {

2668 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

2669 
sšfo
->
tx_du¿tiÚ
 +ğ
¡a
->
aœtime
[
ac
].
tx_aœtime
;

2670 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_TX_DURATION
);

2673 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_AIRTIME_WEIGHT
))) {

2674 
sšfo
->
aœtime_weight
 = 
¡a
->airtime_weight;

2675 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_AIRTIME_WEIGHT
);

2678 
sšfo
->
rx_drİ³d_misc
 = 
¡a
->
deæšk
.
rx_¡©s
.
drİ³d
;

2679 ià(
¡a
->
deæšk
.
pıu_rx_¡©s
) {

2680 
	`fÜ_—ch_possibË_ıu
(
ıu
) {

2681 
›“80211_¡a_rx_¡©s
 *
ıurxs
;

2683 
ıurxs
 = 
	`³r_ıu_±r
(
¡a
->
deæšk
.
pıu_rx_¡©s
, 
ıu
);

2684 
sšfo
->
rx_drİ³d_misc
 +ğ
ıurxs
->
drİ³d
;

2688 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

2689 !(
sd©a
->
vif
.
driv”_æags
 & 
IEEE80211_VIF_BEACON_FILTER
)) {

2690 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_BEACON_RX
) |

2691 
	`BIT_ULL
(
NL80211_STA_INFO_BEACON_SIGNAL_AVG
);

2692 
sšfo
->
rx_b—cÚ_sigÇl_avg
 = 
	`›“80211_ave_rssi
(&
sd©a
->
vif
);

2695 ià(
	`›“80211_hw_check
(&
¡a
->
loÿl
->
hw
, 
SIGNAL_DBM
) ||

2696 
	`›“80211_hw_check
(&
¡a
->
loÿl
->
hw
, 
SIGNAL_UNSPEC
)) {

2697 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_SIGNAL
))) {

2698 
sšfo
->
sigÇl
 = (
s8
)
Ï¡_rx¡©s
->
Ï¡_sigÇl
;

2699 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_SIGNAL
);

2702 ià(!
¡a
->
deæšk
.
pıu_rx_¡©s
 &&

2703 !(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_SIGNAL_AVG
))) {

2704 
sšfo
->
sigÇl_avg
 =

2705 -
	`ewma_sigÇl_»ad
(&
¡a
->
deæšk
.
rx_¡©s_avg
.
sigÇl
);

2706 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_SIGNAL_AVG
);

2714 ià(
Ï¡_rx¡©s
->
chašs
 &&

2715 !(
sšfo
->
fËd
 & (
	`BIT_ULL
(
NL80211_STA_INFO_CHAIN_SIGNAL
) |

2716 
	`BIT_ULL
(
NL80211_STA_INFO_CHAIN_SIGNAL_AVG
)))) {

2717 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_CHAIN_SIGNAL
);

2718 ià(!
¡a
->
deæšk
.
pıu_rx_¡©s
)

2719 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_CHAIN_SIGNAL_AVG
);

2721 
sšfo
->
chašs
 = 
Ï¡_rx¡©s
->chains;

2723 
i
 = 0; i < 
	`ARRAY_SIZE
(
sšfo
->
chaš_sigÇl
); i++) {

2724 
sšfo
->
chaš_sigÇl
[
i
] =

2725 
Ï¡_rx¡©s
->
chaš_sigÇl_Ï¡
[
i
];

2726 
sšfo
->
chaš_sigÇl_avg
[
i
] =

2727 -
	`ewma_sigÇl_»ad
(&
¡a
->
deæšk
.
rx_¡©s_avg
.
chaš_sigÇl
[
i
]);

2731 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_TX_BITRATE
)) &&

2732 !
¡a
->¡a.
v®id_lšks
 &&

2733 
	`›“80211_¿‹_v®id
(&
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
)) {

2734 
	`¡a_£t_¿‹_šfo_tx
(
¡a
, &¡a->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
,

2735 &
sšfo
->
tx¿‹
);

2736 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_TX_BITRATE
);

2739 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_RX_BITRATE
)) &&

2740 !
¡a
->¡a.
v®id_lšks
) {

2741 ià(
	`¡a_£t_¿‹_šfo_rx
(
¡a
, &
sšfo
->
rx¿‹
) == 0)

2742 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_RX_BITRATE
);

2745 ià(
tid¡©s
 && !
	`cfg80211_sšfo_®loc_tid_¡©s
(
sšfo
, 
GFP_KERNEL
)) {

2746 
i
 = 0; i < 
IEEE80211_NUM_TIDS
 + 1; i++)

2747 
	`¡a_£t_tid¡©s
(
¡a
, &
sšfo
->
³¹id
[
i
], i);

2750 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

2751 #ifdeà
CONFIG_MAC80211_MESH


2752 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_LLID
) |

2753 
	`BIT_ULL
(
NL80211_STA_INFO_PLID
) |

2754 
	`BIT_ULL
(
NL80211_STA_INFO_PLINK_STATE
) |

2755 
	`BIT_ULL
(
NL80211_STA_INFO_LOCAL_PM
) |

2756 
	`BIT_ULL
(
NL80211_STA_INFO_PEER_PM
) |

2757 
	`BIT_ULL
(
NL80211_STA_INFO_NONPEER_PM
) |

2758 
	`BIT_ULL
(
NL80211_STA_INFO_CONNECTED_TO_GATE
) |

2759 
	`BIT_ULL
(
NL80211_STA_INFO_CONNECTED_TO_AS
);

2761 
sšfo
->
Îid
 = 
¡a
->
mesh
->llid;

2762 
sšfo
->
¶id
 = 
¡a
->
mesh
->plid;

2763 
sšfo
->
¶šk_¡©e
 = 
¡a
->
mesh
->plink_state;

2764 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TOFFSET_KNOWN
)) {

2765 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_T_OFFSET
);

2766 
sšfo
->
t_off£t
 = 
¡a
->
mesh
->t_offset;

2768 
sšfo
->
loÿl_pm
 = 
¡a
->
mesh
->local_pm;

2769 
sšfo
->
³”_pm
 = 
¡a
->
mesh
->peer_pm;

2770 
sšfo
->
nÚ³”_pm
 = 
¡a
->
mesh
->nonpeer_pm;

2771 
sšfo
->
cÚÃùed_to_g©e
 = 
¡a
->
mesh
->connected_to_gate;

2772 
sšfo
->
cÚÃùed_to_as
 = 
¡a
->
mesh
->connected_to_as;

2776 
sšfo
->
bss_·¿m
.
æags
 = 0;

2777 ià(
sd©a
->
vif
.
bss_cÚf
.
u£_ùs_´Ù
)

2778 
sšfo
->
bss_·¿m
.
æags
 |ğ
BSS_PARAM_FLAGS_CTS_PROT
;

2779 ià(
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
)

2780 
sšfo
->
bss_·¿m
.
æags
 |ğ
BSS_PARAM_FLAGS_SHORT_PREAMBLE
;

2781 ià(
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_¦Ù
)

2782 
sšfo
->
bss_·¿m
.
æags
 |ğ
BSS_PARAM_FLAGS_SHORT_SLOT_TIME
;

2783 
sšfo
->
bss_·¿m
.
dtim_³riod
 = 
sd©a
->
vif
.
bss_cÚf
.dtim_period;

2784 
sšfo
->
bss_·¿m
.
b—cÚ_š‹rv®
 = 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
;

2786 
sšfo
->
¡a_æags
.
£t
 = 0;

2787 
sšfo
->
¡a_æags
.
mask
 = 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
) |

2788 
	`BIT
(
NL80211_STA_FLAG_SHORT_PREAMBLE
) |

2789 
	`BIT
(
NL80211_STA_FLAG_WME
) |

2790 
	`BIT
(
NL80211_STA_FLAG_MFP
) |

2791 
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
) |

2792 
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
) |

2793 
	`BIT
(
NL80211_STA_FLAG_TDLS_PEER
);

2794 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

2795 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
);

2796 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_SHORT_PREAMBLE
))

2797 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_SHORT_PREAMBLE
);

2798 ià(
¡a
->¡a.
wme
)

2799 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_WME
);

2800 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_MFP
))

2801 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_MFP
);

2802 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTH
))

2803 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_AUTHENTICATED
);

2804 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_ASSOC
))

2805 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_ASSOCIATED
);

2806 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
))

2807 
sšfo
->
¡a_æags
.
£t
 |ğ
	`BIT
(
NL80211_STA_FLAG_TDLS_PEER
);

2809 
thr
 = 
	`¡a_g‘_ex³ùed_throughput
(
¡a
);

2811 ià(
thr
 != 0) {

2812 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_EXPECTED_THROUGHPUT
);

2813 
sšfo
->
ex³ùed_throughput
 = 
thr
;

2816 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_ACK_SIGNAL
)) &&

2817 
¡a
->
deæšk
.
¡©us_¡©s
.
ack_sigÇl_fËd
) {

2818 
sšfo
->
ack_sigÇl
 = 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack_sigÇl
;

2819 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_ACK_SIGNAL
);

2822 ià(!(
sšfo
->
fËd
 & 
	`BIT_ULL
(
NL80211_STA_INFO_ACK_SIGNAL_AVG
)) &&

2823 
¡a
->
deæšk
.
¡©us_¡©s
.
ack_sigÇl_fËd
) {

2824 
sšfo
->
avg_ack_sigÇl
 =

2825 -(
s8
)
	`ewma_avg_sigÇl_»ad
(

2826 &
¡a
->
deæšk
.
¡©us_¡©s
.
avg_ack_sigÇl
);

2827 
sšfo
->
fËd
 |=

2828 
	`BIT_ULL
(
NL80211_STA_INFO_ACK_SIGNAL_AVG
);

2831 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

2832 
sšfo
->
fËd
 |ğ
	`BIT_ULL
(
NL80211_STA_INFO_AIRTIME_LINK_METRIC
);

2833 
sšfo
->
aœtime_lšk_m‘ric
 =

2834 
	`aœtime_lšk_m‘ric_g‘
(
loÿl
, 
¡a
);

2836 
	}
}

2838 
u32
 
	$¡a_g‘_ex³ùed_throughput
(
¡a_šfo
 *
¡a
)

2840 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

2841 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2842 
¿‹_cÚŒŞ_»f
 *
»f
 = 
NULL
;

2843 
u32
 
thr
 = 0;

2845 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_RATE_CONTROL
))

2846 
»f
 = 
loÿl
->
¿‹_ù¾
;

2849 ià(
»f
 &&„ef->
İs
->
g‘_ex³ùed_throughput
)

2850 
thr
 = 
»f
->
İs
->
	`g‘_ex³ùed_throughput
(
¡a
->
¿‹_ù¾_´iv
);

2852 
thr
 = 
	`drv_g‘_ex³ùed_throughput
(
loÿl
, 
¡a
);

2854  
thr
;

2855 
	}
}

2857 
	$›“80211_¡a_Ï¡_aùive
(
¡a_šfo
 *
¡a
)

2859 
›“80211_¡a_rx_¡©s
 *
¡©s
 = 
	`¡a_g‘_Ï¡_rx_¡©s
(
¡a
);

2861 ià(!
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack
 ||

2862 
	`time_aá”
(
¡©s
->
Ï¡_rx
, 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack
))

2863  
¡©s
->
Ï¡_rx
;

2864  
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack
;

2865 
	}
}

2867 
	$¡a_upd©e_cod–_·¿ms
(
¡a_šfo
 *
¡a
, 
u32
 
thr
)

2869 ià(
thr
 &&h¸< 
STA_SLOW_THRESHOLD
 * 
¡a
->
loÿl
->
num_¡a
) {

2870 
¡a
->
ı¬ams
.
rg‘
 = 
	`MS2TIME
(50);

2871 
¡a
->
ı¬ams
.
š‹rv®
 = 
	`MS2TIME
(300);

2872 
¡a
->
ı¬ams
.
eú
 = 
çl£
;

2874 
¡a
->
ı¬ams
.
rg‘
 = 
	`MS2TIME
(20);

2875 
¡a
->
ı¬ams
.
š‹rv®
 = 
	`MS2TIME
(100);

2876 
¡a
->
ı¬ams
.
eú
 = 
Œue
;

2878 
	}
}

2880 
	$›“80211_¡a_£t_ex³ùed_throughput
(
›“80211_¡a
 *
pub¡a
,

2881 
u32
 
thr
)

2883 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

2885 
	`¡a_upd©e_cod–_·¿ms
(
¡a
, 
thr
);

2886 
	}
}

2888 
	$›“80211_¡a_®loÿ‹_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
)

2890 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

2891 
¡a_lšk_®loc
 *
®loc
;

2892 
»t
;

2894 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2896 
	`WARN_ON
(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
));

2899 ià(
	`WARN_ON
(!
¡a
->¡a.
v®id_lšks
))

2900  -
EINVAL
;

2902 ià(
	`WARN_ON
(
¡a
->¡a.
v®id_lšks
 & 
	`BIT
(
lšk_id
) ||

2903 
¡a
->
lšk
[
lšk_id
]))

2904  -
EBUSY
;

2906 
®loc
 = 
	`kz®loc
((*®loc), 
GFP_KERNEL
);

2907 ià(!
®loc
)

2908  -
ENOMEM
;

2910 
»t
 = 
	`¡a_šfo_®loc_lšk
(
sd©a
->
loÿl
, &
®loc
->
šfo
, 
GFP_KERNEL
);

2911 ià(
»t
) {

2912 
	`kä“
(
®loc
);

2913  
»t
;

2916 
	`¡a_šfo_add_lšk
(
¡a
, 
lšk_id
, &
®loc
->
šfo
, &alloc->sta);

2918 
	`›“80211_lšk_¡a_debugfs_add
(&
®loc
->
šfo
);

2921 
	}
}

2923 
	$›“80211_¡a_ä“_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
)

2925 
	`lockd•_as£¹_why
(
¡a
->
sd©a
->
loÿl
->
hw
.
why
);

2927 
	`WARN_ON
(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
));

2929 
	`¡a_»move_lšk
(
¡a
, 
lšk_id
, 
çl£
);

2930 
	}
}

2932 
	$›“80211_¡a_aùiv©e_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
)

2934 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

2935 
lšk_¡a_šfo
 *
lšk_¡a
;

2936 
u16
 
Şd_lšks
 = 
¡a
->¡a.
v®id_lšks
;

2937 
u16
 
Ãw_lšks
 = 
Şd_lšks
 | 
	`BIT
(
lšk_id
);

2938 
»t
;

2940 
lšk_¡a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
lšk
[
lšk_id
],

2941 
	`lockd•_is_h–d
(&
sd©a
->
loÿl
->
hw
.
why
->
mtx
));

2943 ià(
	`WARN_ON
(
Şd_lšks
 =ğ
Ãw_lšks
 || !
lšk_¡a
))

2944  -
EINVAL
;

2946 
	`rcu_»ad_lock
();

2947 ià(
	`lšk_¡a_šfo_hash_lookup
(
sd©a
->
loÿl
, 
lšk_¡a
->
addr
)) {

2948 
	`rcu_»ad_uÆock
();

2949  -
EALREADY
;

2952 
	`rcu_»ad_uÆock
();

2954 
¡a
->¡a.
v®id_lšks
 = 
Ãw_lšks
;

2956 ià(
	`WARN_ON
(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
)))

2957 
hash
;

2959 
	`›“80211_»ÿlc_mš_chªdef
(
sd©a
, 
lšk_id
);

2964 
	`›“80211_¡a_»ÿlc_agg»g©es
(&
¡a
->sta);

2966 
»t
 = 
	`drv_chªge_¡a_lšks
(
sd©a
->
loÿl
, sd©a, &
¡a
->sta,

2967 
Şd_lšks
, 
Ãw_lšks
);

2968 ià(
»t
) {

2969 
¡a
->¡a.
v®id_lšks
 = 
Şd_lšks
;

2970 
	`¡a_»move_lšk
(
¡a
, 
lšk_id
, 
çl£
);

2971  
»t
;

2974 
hash
:

2975 
»t
 = 
	`lšk_¡a_šfo_hash_add
(
sd©a
->
loÿl
, 
lšk_¡a
);

2976 
	`WARN_ON
(
»t
);

2978 
	}
}

2980 
	$›“80211_¡a_»move_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
)

2982 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

2983 
u16
 
Şd_lšks
 = 
¡a
->¡a.
v®id_lšks
;

2985 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

2987 
¡a
->¡a.
v®id_lšks
 &ğ~
	`BIT
(
lšk_id
);

2989 ià(!
	`WARN_ON
(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
)))

2990 
	`drv_chªge_¡a_lšks
(
sd©a
->
loÿl
, sd©a, &
¡a
->sta,

2991 
Şd_lšks
, 
¡a
->¡a.
v®id_lšks
);

2993 
	`¡a_»move_lšk
(
¡a
, 
lšk_id
, 
Œue
);

2994 
	}
}

2996 
	$›“80211_¡a_£t_max_amsdu_subäames
(
¡a_šfo
 *
¡a
,

2997 cÚ¡ 
u8
 *
ext_ÿ·b
,

2998 
ext_ÿ·b_Ën
)

3000 
u8
 
v®
;

3002 
¡a
->¡a.
max_amsdu_subäames
 = 0;

3004 ià(
ext_ÿ·b_Ën
 < 8)

3008 
v®
 = 
	`u8_g‘_b™s
(
ext_ÿ·b
[7], 
WLAN_EXT_CAPA8_MAX_MSDU_IN_AMSDU_LSB
);

3011 ià(
ext_ÿ·b_Ën
 >= 9)

3012 
v®
 |ğ
	`u8_g‘_b™s
(
ext_ÿ·b
[8],

3013 
WLAN_EXT_CAPA9_MAX_MSDU_IN_AMSDU_MSB
) << 1;

3015 ià(
v®
)

3016 
¡a
->¡a.
max_amsdu_subäames
 = 4 << (4 - 
v®
);

3017 
	}
}

3019 #ifdeà
CONFIG_LOCKDEP


3020 
boŞ
 
	$lockd•_¡a_mu‹x_h–d
(
›“80211_¡a
 *
pub¡a
)

3022 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

3024  
	`lockd•_is_h–d
(&
¡a
->
loÿl
->
hw
.
why
->
mtx
);

3025 
	}
}

3026 
EXPORT_SYMBOL
(
lockd•_¡a_mu‹x_h–d
);

	@sta_info.h

9 #iâdeà
STA_INFO_H


10 
	#STA_INFO_H


	)

12 
	~<lšux/li¡.h
>

13 
	~<lšux/ty³s.h
>

14 
	~<lšux/if_‘h”.h
>

15 
	~<lšux/wÜkqueue.h
>

16 
	~<lšux/av”age.h
>

17 
	~<lšux/b™f›ld.h
>

18 
	~<lšux/‘h”deviû.h
>

19 
	~<lšux/rhashbË.h
>

20 
	~<lšux/u64_¡©s_sync.h
>

21 
	~"key.h
"

78 
	e›“80211_¡a_šfo_æags
 {

79 
	mWLAN_STA_AUTH
,

80 
	mWLAN_STA_ASSOC
,

81 
	mWLAN_STA_PS_STA
,

82 
	mWLAN_STA_AUTHORIZED
,

83 
	mWLAN_STA_SHORT_PREAMBLE
,

84 
	mWLAN_STA_WDS
,

85 
	mWLAN_STA_CLEAR_PS_FILT
,

86 
	mWLAN_STA_MFP
,

87 
	mWLAN_STA_BLOCK_BA
,

88 
	mWLAN_STA_PS_DRIVER
,

89 
	mWLAN_STA_PSPOLL
,

90 
	mWLAN_STA_TDLS_PEER
,

91 
	mWLAN_STA_TDLS_PEER_AUTH
,

92 
	mWLAN_STA_TDLS_INITIATOR
,

93 
	mWLAN_STA_TDLS_CHAN_SWITCH
,

94 
	mWLAN_STA_TDLS_OFF_CHANNEL
,

95 
	mWLAN_STA_TDLS_WIDER_BW
,

96 
	mWLAN_STA_UAPSD
,

97 
	mWLAN_STA_SP
,

98 
	mWLAN_STA_4ADDR_EVENT
,

99 
	mWLAN_STA_INSERTED
,

100 
	mWLAN_STA_RATE_CONTROL
,

101 
	mWLAN_STA_TOFFSET_KNOWN
,

102 
	mWLAN_STA_MPSP_OWNER
,

103 
	mWLAN_STA_MPSP_RECIPIENT
,

104 
	mWLAN_STA_PS_DELIVER
,

105 
	mWLAN_STA_USES_ENCRYPTION
,

106 
	mWLAN_STA_DECAP_OFFLOAD
,

108 
	mNUM_WLAN_STA_FLAGS
,

111 
	#ADDBA_RESP_INTERVAL
 
HZ


	)

112 
	#HT_AGG_MAX_RETRIES
 15

	)

113 
	#HT_AGG_BURST_RETRIES
 3

	)

114 
	#HT_AGG_RETRIES_PERIOD
 (15 * 
HZ
)

	)

116 
	#HT_AGG_STATE_DRV_READY
 0

	)

117 
	#HT_AGG_STATE_RESPONSE_RECEIVED
 1

	)

118 
	#HT_AGG_STATE_OPERATIONAL
 2

	)

119 
	#HT_AGG_STATE_STOPPING
 3

	)

120 
	#HT_AGG_STATE_WANT_START
 4

	)

121 
	#HT_AGG_STATE_WANT_STOP
 5

	)

122 
	#HT_AGG_STATE_START_CB
 6

	)

123 
	#HT_AGG_STATE_STOP_CB
 7

	)

124 
	#HT_AGG_STATE_SENT_ADDBA
 8

	)

126 
	$DECLARE_EWMA
(
avg_sigÇl
, 10, 8)

127 
	e›“80211_agg_¡İ_»asÚ
 {

128 
AGG_STOP_DECLINED
,

129 
AGG_STOP_LOCAL_REQUEST
,

130 
AGG_STOP_PEER_REQUEST
,

131 
AGG_STOP_DESTROY_STA
,

135 
	#AIRTIME_USE_TX
 
	`BIT
(0)

	)

136 
	#AIRTIME_USE_RX
 
	`BIT
(1)

	)

138 
	saœtime_šfo
 {

139 
u64
 
rx_aœtime
;

140 
u64
 
tx_aœtime
;

141 
Ï¡_aùive
;

142 
s32
 
defic™
;

143 
©omic_t
 
aql_tx_³ndšg
;

144 
u32
 
aql_lim™_low
;

145 
u32
 
aql_lim™_high
;

148 
	`›“80211_¡a_upd©e_³ndšg_aœtime
(
›“80211_loÿl
 *
loÿl
,

149 
¡a_šfo
 *
¡a
, 
u8
 
ac
,

150 
u16
 
tx_aœtime
, 
boŞ
 
tx_com¶‘ed
);

152 
¡a_šfo
;

184 
	stid_ampdu_tx
 {

185 
rcu_h—d
„cu_head;

186 
tim”_li¡
 
£ssiÚ_tim”
;

187 
tim”_li¡
 
addba_»¥_tim”
;

188 
sk_buff_h—d
 
³ndšg
;

189 
¡a_šfo
 *
¡a
;

190 
¡©e
;

191 
Ï¡_tx
;

192 
u16
 
timeout
;

193 
u8
 
dŸlog_tok’
;

194 
u8
 
¡İ_š™ŸtÜ
;

195 
boŞ
 
tx_¡İ
;

196 
u16
 
buf_size
;

197 
u16
 
s¢
;

199 
u16
 
çed_b¬_s¢
;

200 
boŞ
 
b¬_³ndšg
;

201 
boŞ
 
amsdu
;

202 
u8
 
tid
;

238 
	stid_ampdu_rx
 {

239 
rcu_h—d
„cu_head;

240 
¥šlock_t
 
»Üd”_lock
;

241 
u64
 
»Üd”_buf_f‹»d
;

242 
sk_buff_h—d
 *
»Üd”_buf
;

243 *
»Üd”_time
;

244 
¡a_šfo
 *
¡a
;

245 
tim”_li¡
 
£ssiÚ_tim”
;

246 
tim”_li¡
 
»Üd”_tim”
;

247 
Ï¡_rx
;

248 
u16
 
h—d_£q_num
;

249 
u16
 
¡Üed_mpdu_num
;

250 
u16
 
s¢
;

251 
u16
 
buf_size
;

252 
u16
 
timeout
;

253 
u8
 
tid
;

254 
u8
 
auto_£q
:1,

255 
»moved
:1,

256 
¡¬‹d
:1;

281 
	s¡a_ampdu_mlme
 {

283 
tid_ampdu_rx
 
__rcu
 *
tid_rx
[
IEEE80211_NUM_TIDS
];

284 
u8
 
tid_rx_tok’
[
IEEE80211_NUM_TIDS
];

285 
tid_rx_tim”_expœed
[
	`BITS_TO_LONGS
(
IEEE80211_NUM_TIDS
)];

286 
tid_rx_¡İ_»que¡ed
[
	`BITS_TO_LONGS
(
IEEE80211_NUM_TIDS
)];

287 
tid_rx_mªage_ofæ
[
	`BITS_TO_LONGS
(2 * 
IEEE80211_NUM_TIDS
)];

288 
agg_£ssiÚ_v®id
[
	`BITS_TO_LONGS
(
IEEE80211_NUM_TIDS
)];

289 
uÃx³ùed_agg
[
	`BITS_TO_LONGS
(
IEEE80211_NUM_TIDS
)];

291 
why_wÜk
 
wÜk
;

292 
tid_ampdu_tx
 
__rcu
 *
tid_tx
[
IEEE80211_NUM_TIDS
];

293 
tid_ampdu_tx
 *
tid_¡¬t_tx
[
IEEE80211_NUM_TIDS
];

294 
Ï¡_addba_»q_time
[
IEEE80211_NUM_TIDS
];

295 
u8
 
addba_»q_num
[
IEEE80211_NUM_TIDS
];

296 
u8
 
dŸlog_tok’_®loÿtÜ
;

301 
	#IEEE80211_TID_UNRESERVED
 0xff

	)

303 
	#IEEE80211_FAST_XMIT_MAX_IV
 18

	)

320 
	s›“80211_ç¡_tx
 {

321 
›“80211_key
 *
key
;

322 
u8
 
hdr_Ën
;

323 
u8
 
§_offs
, 
da_offs
, 
²_offs
;

324 
u8
 
bªd
;

325 
u8
 
hdr
[30 + 2 + 
IEEE80211_FAST_XMIT_MAX_IV
 +

326 (
rfc1042_h—d”
)] 
	`__®igÃd
(2);

328 
rcu_h—d
„cu_head;

347 
	s›“80211_ç¡_rx
 {

348 
Ãt_deviû
 *
dev
;

349 
Æ80211_iáy³
 
vif_ty³
;

350 
u8
 
vif_addr
[
ETH_ALEN
] 
	`__®igÃd
(2);

351 
u8
 
rfc1042_hdr
[6] 
	`__®igÃd
(2);

352 
__be16
 
cÚŒŞ_pÜt_´ÙocŞ
;

353 
__Ë16
 
ex³ùed_ds_b™s
;

354 
u8
 
icv_Ën
;

355 
u8
 
key
:1,

356 
š‹º®_fÜw¬d
:1,

357 
u£s_rss
:1;

358 
u8
 
da_offs
, 
§_offs
;

360 
rcu_h—d
„cu_head;

364 
	$DECLARE_EWMA
(
mesh_ç_avg
, 20, 8)

365 
	$DECLARE_EWMA
(
mesh_tx_¿‹_avg
, 8, 16)

392 
	smesh_¡a
 {

393 
tim”_li¡
 
¶šk_tim”
;

394 
¡a_šfo
 *
¶šk_¡a
;

396 
s64
 
t_off£t
;

397 
s64
 
t_off£t_£ošt
;

399 
¥šlock_t
 
¶šk_lock
;

400 
u16
 
Îid
;

401 
u16
 
¶id
;

402 
u16
 
aid
;

403 
u16
 
»asÚ
;

404 
u8
 
¶šk_»Œ›s
;

406 
boŞ
 
´oûs£d_b—cÚ
;

407 
boŞ
 
cÚÃùed_to_g©e
;

408 
boŞ
 
cÚÃùed_to_as
;

410 
Æ80211_¶šk_¡©e
 
¶šk_¡©e
;

411 
u32
 
¶šk_timeout
;

414 
Æ80211_mesh_pow”_mode
 
loÿl_pm
;

415 
Æ80211_mesh_pow”_mode
 
³”_pm
;

416 
Æ80211_mesh_pow”_mode
 
nÚ³”_pm
;

419 
ewma_mesh_ç_avg
 
ç_avg
;

421 
ewma_mesh_tx_¿‹_avg
 
tx_¿‹_avg
;

424 
	$DECLARE_EWMA
(
sigÇl
, 10, 8)

426 
	s›“80211_¡a_rx_¡©s
 {

427 
·ck‘s
;

428 
Ï¡_rx
;

429 
num_du¶iÿ‹s
;

430 
äagm’ts
;

431 
drİ³d
;

432 
Ï¡_sigÇl
;

433 
u8
 
chašs
;

434 
s8
 
chaš_sigÇl_Ï¡
[
IEEE80211_MAX_CHAINS
];

435 
u32
 
Ï¡_¿‹
;

436 
u64_¡©s_sync
 
synı
;

437 
u64
 
by‹s
;

438 
u64
 
msdu
[
IEEE80211_NUM_TIDS
 + 1];

449 
	#IEEE80211_FRAGMENT_MAX
 4

	)

451 
	s›“80211_äagm’t_’Œy
 {

452 
sk_buff_h—d
 
skb_li¡
;

453 
fœ¡_äag_time
;

454 
u16
 
£q
;

455 
u16
 
exŒa_Ën
;

456 
u16
 
Ï¡_äag
;

457 
u8
 
rx_queue
;

458 
u8
 
check_£qu’tŸl_²
:1,

459 
is_´Ùeùed
:1;

460 
u8
 
Ï¡_²
[6];

461 
key_cŞÜ
;

464 
	s›“80211_äagm’t_ÿche
 {

465 
›“80211_äagm’t_’Œy
 
’Œ›s
[
IEEE80211_FRAGMENT_MAX
];

466 
Ãxt
;

475 
	#STA_SLOW_THRESHOLD
 6000

	)

519 
	slšk_¡a_šfo
 {

520 
u8
 
addr
[
ETH_ALEN
];

521 
u8
 
lšk_id
;

523 
u8
 
İ_mode_nss
, 
ÿ·_nss
;

525 
rhli¡_h—d
 
lšk_hash_node
;

527 
¡a_šfo
 *
¡a
;

528 
›“80211_key
 
__rcu
 *
gtk
[
NUM_DEFAULT_KEYS
 +

529 
NUM_DEFAULT_MGMT_KEYS
 +

530 
NUM_DEFAULT_BEACON_KEYS
];

531 
›“80211_¡a_rx_¡©s
 
__³rıu
 *
pıu_rx_¡©s
;

534 
›“80211_¡a_rx_¡©s
 
rx_¡©s
;

536 
ewma_sigÇl
 
sigÇl
;

537 
ewma_sigÇl
 
chaš_sigÇl
[
IEEE80211_MAX_CHAINS
];

538 } 
rx_¡©s_avg
;

542 
f‹»d
;

543 
»Œy_çed
, 
»Œy_couÁ
;

544 
lo¡_·ck‘s
;

545 
Ï¡_pkt_time
;

546 
u64
 
msdu_»Œ›s
[
IEEE80211_NUM_TIDS
 + 1];

547 
u64
 
msdu_çed
[
IEEE80211_NUM_TIDS
 + 1];

548 
Ï¡_ack
;

549 
s8
 
Ï¡_ack_sigÇl
;

550 
boŞ
 
ack_sigÇl_fËd
;

551 
ewma_avg_sigÇl
 
avg_ack_sigÇl
;

552 } 
¡©us_¡©s
;

556 
u64
 
·ck‘s
[
IEEE80211_NUM_ACS
];

557 
u64
 
by‹s
[
IEEE80211_NUM_ACS
];

558 
›“80211_tx_¿‹
 
Ï¡_¿‹
;

559 
¿‹_šfo
 
Ï¡_¿‹_šfo
;

560 
u64
 
msdu
[
IEEE80211_NUM_TIDS
 + 1];

561 } 
tx_¡©s
;

563 
›“80211_¡a_rx_bªdwidth
 
cur_max_bªdwidth
;

565 #ifdeà
CONFIG_MAC80211_DEBUGFS


566 
d’Œy
 *
debugfs_dœ
;

569 
›“80211_lšk_¡a
 *
pub
;

650 
	s¡a_šfo
 {

652 
li¡_h—d
 
li¡
, 
ä“_li¡
;

653 
rcu_h—d
„cu_head;

654 
rhli¡_h—d
 
hash_node
;

655 
u8
 
addr
[
ETH_ALEN
];

656 
›“80211_loÿl
 *
loÿl
;

657 
›“80211_sub_if_d©a
 *
sd©a
;

658 
›“80211_key
 
__rcu
 *
±k
[
NUM_DEFAULT_KEYS
];

659 
u8
 
±k_idx
;

660 
¿‹_cÚŒŞ_»f
 *
¿‹_ù¾
;

661 *
¿‹_ù¾_´iv
;

662 
¥šlock_t
 
¿‹_ù¾_lock
;

663 
¥šlock_t
 
lock
;

665 
›“80211_ç¡_tx
 
__rcu
 *
ç¡_tx
;

666 
›“80211_ç¡_rx
 
__rcu
 *
ç¡_rx
;

668 #ifdeà
CONFIG_MAC80211_MESH


669 
mesh_¡a
 *
mesh
;

672 
wÜk_¡ruù
 
drv_d–iv”_wk
;

674 
u16
 
li¡’_š‹rv®
;

676 
boŞ
 
d—d
;

677 
boŞ
 
»moved
;

679 
boŞ
 
u¶ßded
;

681 
›“80211_¡a_¡©e
 
¡a_¡©e
;

684 
_æags
;

687 
¥šlock_t
 
ps_lock
;

688 
sk_buff_h—d
 
ps_tx_buf
[
IEEE80211_NUM_ACS
];

689 
sk_buff_h—d
 
tx_f‹»d
[
IEEE80211_NUM_ACS
];

690 
driv”_bufã»d_tids
;

691 
txq_bufã»d_tids
;

693 
u64
 
assoc_©
;

694 
Ï¡_cÚÃùed
;

697 
__Ë16
 
Ï¡_£q_ù¾
[
IEEE80211_NUM_TIDS
 + 1];

699 
u16
 
tid_£q
[
IEEE80211_QOS_CTL_TID_MASK
 + 1];

701 
aœtime_šfo
 
aœtime
[
IEEE80211_NUM_ACS
];

702 
u16
 
aœtime_weight
;

707 
¡a_ampdu_mlme
 
ampdu_mlme
;

709 #ifdeà
CONFIG_MAC80211_DEBUGFS


710 
d’Œy
 *
debugfs_dœ
;

713 
cod–_·¿ms
 
ı¬ams
;

715 
u8
 
»£rved_tid
;

716 
s8
 
amsdu_mesh_cÚŒŞ
;

718 
cfg80211_chª_def
 
tdls_chªdef
;

720 
›“80211_äagm’t_ÿche
 
äags
;

722 
›“80211_¡a_agg»g©es
 
cur
;

723 
lšk_¡a_šfo
 
deæšk
;

724 
lšk_¡a_šfo
 
__rcu
 *
lšk
[
IEEE80211_MLD_MAX_NUM_LINKS
];

727 
›“80211_¡a
 
¡a
;

730 
šlše
 
Æ80211_¶šk_¡©e
 
	$¡a_¶šk_¡©e
(
¡a_šfo
 *
¡a
)

732 #ifdeà
CONFIG_MAC80211_MESH


733  
¡a
->
mesh
->
¶šk_¡©e
;

735  
NL80211_PLINK_LISTEN
;

736 
	}
}

738 
šlše
 
	$£t_¡a_æag
(
¡a_šfo
 *
¡a
,

739 
›“80211_¡a_šfo_æags
 
æag
)

741 
	`WARN_ON
(
æag
 =ğ
WLAN_STA_AUTH
 ||

742 
æag
 =ğ
WLAN_STA_ASSOC
 ||

743 
æag
 =ğ
WLAN_STA_AUTHORIZED
);

744 
	`£t_b™
(
æag
, &
¡a
->
_æags
);

745 
	}
}

747 
šlše
 
	$ş—r_¡a_æag
(
¡a_šfo
 *
¡a
,

748 
›“80211_¡a_šfo_æags
 
æag
)

750 
	`WARN_ON
(
æag
 =ğ
WLAN_STA_AUTH
 ||

751 
æag
 =ğ
WLAN_STA_ASSOC
 ||

752 
æag
 =ğ
WLAN_STA_AUTHORIZED
);

753 
	`ş—r_b™
(
æag
, &
¡a
->
_æags
);

754 
	}
}

756 
šlše
 
	$‹¡_¡a_æag
(
¡a_šfo
 *
¡a
,

757 
›“80211_¡a_šfo_æags
 
æag
)

759  
	`‹¡_b™
(
æag
, &
¡a
->
_æags
);

760 
	}
}

762 
šlše
 
	$‹¡_ªd_ş—r_¡a_æag
(
¡a_šfo
 *
¡a
,

763 
›“80211_¡a_šfo_æags
 
æag
)

765 
	`WARN_ON
(
æag
 =ğ
WLAN_STA_AUTH
 ||

766 
æag
 =ğ
WLAN_STA_ASSOC
 ||

767 
æag
 =ğ
WLAN_STA_AUTHORIZED
);

768  
	`‹¡_ªd_ş—r_b™
(
æag
, &
¡a
->
_æags
);

769 
	}
}

771 
šlše
 
	$‹¡_ªd_£t_¡a_æag
(
¡a_šfo
 *
¡a
,

772 
›“80211_¡a_šfo_æags
 
æag
)

774 
	`WARN_ON
(
æag
 =ğ
WLAN_STA_AUTH
 ||

775 
æag
 =ğ
WLAN_STA_ASSOC
 ||

776 
æag
 =ğ
WLAN_STA_AUTHORIZED
);

777  
	`‹¡_ªd_£t_b™
(
æag
, &
¡a
->
_æags
);

778 
	}
}

780 
¡a_šfo_move_¡©e
(
¡a_šfo
 *
¡a
,

781 
›“80211_¡a_¡©e
 
Ãw_¡©e
);

783 
šlše
 
	$¡a_šfo_´e_move_¡©e
(
¡a_šfo
 *
¡a
,

784 
›“80211_¡a_¡©e
 
Ãw_¡©e
)

786 
»t
;

788 
	`WARN_ON_ONCE
(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_INSERTED
));

790 
»t
 = 
	`¡a_šfo_move_¡©e
(
¡a
, 
Ãw_¡©e
);

791 
	`WARN_ON_ONCE
(
»t
);

792 
	}
}

795 
›“80211_assign_tid_tx
(
¡a_šfo
 *
¡a
, 
tid
,

796 
tid_ampdu_tx
 *
tid_tx
);

798 
	#rcu_d”eã»nû_´Ùeùed_tid_tx
(
¡a
, 
tid
) \

799 
	`rcu_d”eã»nû_´Ùeùed
((
¡a
)->
ampdu_mlme
.
tid_tx
[
tid
], \

800 
	`lockd•_is_h–d
(&(
¡a
)->
lock
) || \

801 
	`lockd•_is_h–d
(&(
¡a
)->
loÿl
->
hw
.
why
->
mtx
));

	)

804 
	#STA_MAX_TX_BUFFER
 64

	)

808 
	#STA_TX_BUFFER_EXPIRE
 (10 * 
HZ
)

	)

812 
	#STA_INFO_CLEANUP_INTERVAL
 (10 * 
HZ
)

	)

814 
rhli¡_h—d
 *
¡a_šfo_hash_lookup
(
›“80211_loÿl
 *
loÿl
,

815 cÚ¡ 
u8
 *
addr
);

820 
¡a_šfo
 *
¡a_šfo_g‘
(
›“80211_sub_if_d©a
 *
sd©a
,

821 cÚ¡ 
u8
 *
addr
);

823 
¡a_šfo
 *
¡a_šfo_g‘_bss
(
›“80211_sub_if_d©a
 *
sd©a
,

824 cÚ¡ 
u8
 *
addr
);

827 
¡a_šfo
 *
¡a_šfo_g‘_by_addrs
(
›“80211_loÿl
 *
loÿl
,

828 cÚ¡ 
u8
 *
¡a_addr
, cÚ¡ u8 *
vif_addr
);

830 
	#fÜ_—ch_¡a_šfo
(
loÿl
, 
_addr
, 
_¡a
, 
_tmp
) \

831 
	`rhl_fÜ_—ch_’Œy_rcu
(
_¡a
, 
_tmp
, \

832 
	`¡a_šfo_hash_lookup
(
loÿl
, 
_addr
), 
hash_node
)

	)

834 
rhli¡_h—d
 *
lšk_¡a_šfo_hash_lookup
(
›“80211_loÿl
 *
loÿl
,

835 cÚ¡ 
u8
 *
addr
);

837 
	#fÜ_—ch_lšk_¡a_šfo
(
loÿl
, 
_addr
, 
_¡a
, 
_tmp
) \

838 
	`rhl_fÜ_—ch_’Œy_rcu
(
_¡a
, 
_tmp
, \

839 
	`lšk_¡a_šfo_hash_lookup
(
loÿl
, 
_addr
), \

840 
lšk_hash_node
)

	)

842 
lšk_¡a_šfo
 *

843 
lšk_¡a_šfo_g‘_bss
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
addr
);

848 
¡a_šfo
 *
¡a_šfo_g‘_by_idx
(
›“80211_sub_if_d©a
 *
sd©a
,

849 
idx
);

854 
¡a_šfo
 *
¡a_šfo_®loc
(
›“80211_sub_if_d©a
 *
sd©a
,

855 cÚ¡ 
u8
 *
addr
, 
gå_t
 
gå
);

856 
¡a_šfo
 *
¡a_šfo_®loc_w™h_lšk
(
›“80211_sub_if_d©a
 *
sd©a
,

857 cÚ¡ 
u8
 *
mld_addr
,

858 
lšk_id
,

859 cÚ¡ 
u8
 *
lšk_addr
,

860 
gå_t
 
gå
);

862 
¡a_šfo_ä“
(
›“80211_loÿl
 *
loÿl
, 
¡a_šfo
 *
¡a
);

872 
¡a_šfo_š£¹
(
¡a_šfo
 *
¡a
);

873 
	$¡a_šfo_š£¹_rcu
(
¡a_šfo
 *
¡a
è
	`__acquœes
(
RCU
);

875 
__mu¡_check
 
	`__¡a_šfo_de¡roy
(
¡a_šfo
 *
¡a
);

876 
	`¡a_šfo_de¡roy_addr
(
›“80211_sub_if_d©a
 *
sd©a
,

877 cÚ¡ 
u8
 *
addr
);

878 
	`¡a_šfo_de¡roy_addr_bss
(
›“80211_sub_if_d©a
 *
sd©a
,

879 cÚ¡ 
u8
 *
addr
);

881 
	`¡a_šfo_»ÿlc_tim
(
¡a_šfo
 *
¡a
);

883 
	`¡a_šfo_š™
(
›“80211_loÿl
 *
loÿl
);

884 
	`¡a_šfo_¡İ
(
›“80211_loÿl
 *
loÿl
);

897 
	`__¡a_šfo_æush
(
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
vÏns
,

898 
lšk_id
);

910 
šlše
 
	$¡a_šfo_æush
(
›“80211_sub_if_d©a
 *
sd©a
,

911 
lšk_id
)

913  
	`__¡a_šfo_æush
(
sd©a
, 
çl£
, 
lšk_id
);

914 
	}
}

916 
¡a_£t_¿‹_šfo_tx
(
¡a_šfo
 *
¡a
,

917 cÚ¡ 
›“80211_tx_¿‹
 *
¿‹
,

918 
¿‹_šfo
 *
ršfo
);

919 
¡a_£t_sšfo
(
¡a_šfo
 *
¡a
, 
¡©iÚ_šfo
 *
sšfo
,

920 
boŞ
 
tid¡©s
);

922 
u32
 
¡a_g‘_ex³ùed_throughput
(
¡a_šfo
 *
¡a
);

924 
›“80211_¡a_expœe
(
›“80211_sub_if_d©a
 *
sd©a
,

925 
exp_time
);

927 
›“80211_¡a_®loÿ‹_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
);

928 
›“80211_¡a_ä“_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
);

929 
›“80211_¡a_aùiv©e_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
);

930 
›“80211_¡a_»move_lšk
(
¡a_šfo
 *
¡a
, 
lšk_id
);

932 
›“80211_¡a_ps_d–iv”_wakeup
(
¡a_šfo
 *
¡a
);

933 
›“80211_¡a_ps_d–iv”_pŞl_»¥Ú£
(
¡a_šfo
 *
¡a
);

934 
›“80211_¡a_ps_d–iv”_u­sd
(
¡a_šfo
 *
¡a
);

936 
›“80211_¡a_Ï¡_aùive
(
¡a_šfo
 *
¡a
);

938 
›“80211_¡a_£t_max_amsdu_subäames
(
¡a_šfo
 *
¡a
,

939 cÚ¡ 
u8
 *
ext_ÿ·b
,

940 
ext_ÿ·b_Ën
);

942 
__›“80211_¡a_»ÿlc_agg»g©es
(
¡a_šfo
 *
¡a
, 
u16
 
aùive_lšks
);

944 
	e¡a_¡©s_ty³
 {

945 
	mSTA_STATS_RATE_TYPE_INVALID
 = 0,

946 
	mSTA_STATS_RATE_TYPE_LEGACY
,

947 
	mSTA_STATS_RATE_TYPE_HT
,

948 
	mSTA_STATS_RATE_TYPE_VHT
,

949 
	mSTA_STATS_RATE_TYPE_HE
,

950 
	mSTA_STATS_RATE_TYPE_S1G
,

951 
	mSTA_STATS_RATE_TYPE_EHT
,

954 
	#STA_STATS_FIELD_HT_MCS
 
	`GENMASK
Ğ7, 0)

	)

955 
	#STA_STATS_FIELD_LEGACY_IDX
 
	`GENMASK
Ğ3, 0)

	)

956 
	#STA_STATS_FIELD_LEGACY_BAND
 
	`GENMASK
Ğ7, 4)

	)

957 
	#STA_STATS_FIELD_VHT_MCS
 
	`GENMASK
Ğ3, 0)

	)

958 
	#STA_STATS_FIELD_VHT_NSS
 
	`GENMASK
Ğ7, 4)

	)

959 
	#STA_STATS_FIELD_HE_MCS
 
	`GENMASK
Ğ3, 0)

	)

960 
	#STA_STATS_FIELD_HE_NSS
 
	`GENMASK
Ğ7, 4)

	)

961 
	#STA_STATS_FIELD_EHT_MCS
 
	`GENMASK
Ğ3, 0)

	)

962 
	#STA_STATS_FIELD_EHT_NSS
 
	`GENMASK
Ğ7, 4)

	)

963 
	#STA_STATS_FIELD_BW
 
	`GENMASK
(12, 8)

	)

964 
	#STA_STATS_FIELD_SGI
 
	`GENMASK
(13, 13)

	)

965 
	#STA_STATS_FIELD_TYPE
 
	`GENMASK
(16, 14)

	)

966 
	#STA_STATS_FIELD_HE_RU
 
	`GENMASK
(19, 17)

	)

967 
	#STA_STATS_FIELD_HE_GI
 
	`GENMASK
(21, 20)

	)

968 
	#STA_STATS_FIELD_HE_DCM
 
	`GENMASK
(22, 22)

	)

969 
	#STA_STATS_FIELD_EHT_RU
 
	`GENMASK
(20, 17)

	)

970 
	#STA_STATS_FIELD_EHT_GI
 
	`GENMASK
(22, 21)

	)

972 
	#STA_STATS_FIELD
(
_n
, 
_v
è
	`FIELD_PREP
(
STA_STATS_FIELD_
 ## _n, _v)

	)

973 
	#STA_STATS_GET
(
_n
, 
_v
è
	`FIELD_GET
(
STA_STATS_FIELD_
 ## _n, _v)

	)

975 
	#STA_STATS_RATE_INVALID
 0

	)

977 
šlše
 
u32
 
	$¡a_¡©s_’code_¿‹
(
›“80211_rx_¡©us
 *
s
)

979 
u32
 
r
;

981 
r
 = 
	`STA_STATS_FIELD
(
BW
, 
s
->
bw
);

983 ià(
s
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

984 
r
 |ğ
	`STA_STATS_FIELD
(
SGI
, 1);

986 
s
->
’codšg
) {

987 
RX_ENC_VHT
:

988 
r
 |ğ
	`STA_STATS_FIELD
(
TYPE
, 
STA_STATS_RATE_TYPE_VHT
);

989 
r
 |ğ
	`STA_STATS_FIELD
(
VHT_NSS
, 
s
->
nss
);

990 
r
 |ğ
	`STA_STATS_FIELD
(
VHT_MCS
, 
s
->
¿‹_idx
);

992 
RX_ENC_HT
:

993 
r
 |ğ
	`STA_STATS_FIELD
(
TYPE
, 
STA_STATS_RATE_TYPE_HT
);

994 
r
 |ğ
	`STA_STATS_FIELD
(
HT_MCS
, 
s
->
¿‹_idx
);

996 
RX_ENC_LEGACY
:

997 
r
 |ğ
	`STA_STATS_FIELD
(
TYPE
, 
STA_STATS_RATE_TYPE_LEGACY
);

998 
r
 |ğ
	`STA_STATS_FIELD
(
LEGACY_BAND
, 
s
->
bªd
);

999 
r
 |ğ
	`STA_STATS_FIELD
(
LEGACY_IDX
, 
s
->
¿‹_idx
);

1001 
RX_ENC_HE
:

1002 
r
 |ğ
	`STA_STATS_FIELD
(
TYPE
, 
STA_STATS_RATE_TYPE_HE
);

1003 
r
 |ğ
	`STA_STATS_FIELD
(
HE_NSS
, 
s
->
nss
);

1004 
r
 |ğ
	`STA_STATS_FIELD
(
HE_MCS
, 
s
->
¿‹_idx
);

1005 
r
 |ğ
	`STA_STATS_FIELD
(
HE_GI
, 
s
->
he_gi
);

1006 
r
 |ğ
	`STA_STATS_FIELD
(
HE_RU
, 
s
->
he_ru
);

1007 
r
 |ğ
	`STA_STATS_FIELD
(
HE_DCM
, 
s
->
he_dcm
);

1009 
RX_ENC_EHT
:

1010 
r
 |ğ
	`STA_STATS_FIELD
(
TYPE
, 
STA_STATS_RATE_TYPE_EHT
);

1011 
r
 |ğ
	`STA_STATS_FIELD
(
EHT_NSS
, 
s
->
nss
);

1012 
r
 |ğ
	`STA_STATS_FIELD
(
EHT_MCS
, 
s
->
¿‹_idx
);

1013 
r
 |ğ
	`STA_STATS_FIELD
(
EHT_GI
, 
s
->
eht
.
gi
);

1014 
r
 |ğ
	`STA_STATS_FIELD
(
EHT_RU
, 
s
->
eht
.
ru
);

1017 
	`WARN_ON
(1);

1018  
STA_STATS_RATE_INVALID
;

1021  
r
;

1022 
	}
}

	@status.c

11 
	~<lšux/expÜt.h
>

12 
	~<lšux/‘h”deviû.h
>

13 
	~<Ãt/mac80211.h
>

14 
	~<asm/uÇligÃd.h
>

15 
	~"›“80211_i.h
"

16 
	~"¿‹.h
"

17 
	~"mesh.h
"

18 
	~"Ëd.h
"

19 
	~"wme.h
"

22 
	$›“80211_tx_¡©us_œq§ã
(
›“80211_hw
 *
hw
,

23 
sk_buff
 *
skb
)

25 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

26 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

27 
tmp
;

29 
skb
->
pkt_ty³
 = 
IEEE80211_TX_STATUS_MSG
;

30 
	`skb_queue_
(
šfo
->
æags
 & 
IEEE80211_TX_CTL_REQ_TX_STATUS
 ?

31 &
loÿl
->
skb_queue
 : &loÿl->
skb_queue_uÄ–ŸbË
, 
skb
);

32 
tmp
 = 
	`skb_queue_Ën
(&
loÿl
->
skb_queue
) +

33 
	`skb_queue_Ën
(&
loÿl
->
skb_queue_uÄ–ŸbË
);

34 
tmp
 > 
IEEE80211_IRQSAFE_QUEUE_LIMIT
 &&

35 (
skb
 = 
	`skb_dequeue
(&
loÿl
->
skb_queue_uÄ–ŸbË
))) {

36 
	`›“80211_ä“_txskb
(
hw
, 
skb
);

37 
tmp
--;

38 
	`I802_DEBUG_INC
(
loÿl
->
tx_¡©us_drİ
);

40 
	`skËt_scheduË
(&
loÿl
->
skËt
);

41 
	}
}

42 
EXPORT_SYMBOL
(
›“80211_tx_¡©us_œq§ã
);

44 
	$›“80211_hªdË_f‹»d_äame
(
›“80211_loÿl
 *
loÿl
,

45 
¡a_šfo
 *
¡a
,

46 
sk_buff
 *
skb
)

48 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

49 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

50 
ac
;

52 ià(
šfo
->
æags
 & (
IEEE80211_TX_CTL_NO_PS_BUFFER
 |

53 
IEEE80211_TX_CTL_AMPDU
 |

54 
IEEE80211_TX_CTL_HW_80211_ENCAP
)) {

55 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

67 
	`mem£t
(&
šfo
->
cÚŒŞ
, 0, (info->control));

69 
šfo
->
cÚŒŞ
.
jiff›s
 = jiffies;

70 
šfo
->
cÚŒŞ
.
vif
 = &
¡a
->
sd©a
->vif;

71 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

72 
šfo
->
æags
 |ğ
IEEE80211_TX_INTFL_RETRANSMISSION
;

73 
šfo
->
æags
 &ğ~
IEEE80211_TX_TEMPORARY_FLAGS
;

75 
¡a
->
deæšk
.
¡©us_¡©s
.
f‹»d
++;

84 ià(
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
))

85 
hdr
->
äame_cÚŒŞ
 &ğ~
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

87 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
)) {

88 
u8
 *
p
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

89 
tid
 = *
p
 & 
IEEE80211_QOS_CTL_TID_MASK
;

96 ià(*
p
 & 
IEEE80211_QOS_CTL_EOSP
)

97 *
p
 &ğ~
IEEE80211_QOS_CTL_EOSP
;

98 
ac
 = 
	`›“80211_ac_äom_tid
(
tid
);

100 
ac
 = 
IEEE80211_AC_BE
;

108 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_CLEAR_PS_FILT
);

109 
	`›“80211_ş—r_ç¡_xm™
(
¡a
);

145 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) &&

146 
	`skb_queue_Ën
(&
¡a
->
tx_f‹»d
[
ac
]è< 
STA_MAX_TX_BUFFER
) {

147 
	`skb_queue_
(&
¡a
->
tx_f‹»d
[
ac
], 
skb
);

148 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

150 ià(!
	`tim”_³ndšg
(&
loÿl
->
¡a_ş—nup
))

151 
	`mod_tim”
(&
loÿl
->
¡a_ş—nup
,

152 
	`round_jiff›s
(
jiff›s
 +

153 
STA_INFO_CLEANUP_INTERVAL
));

157 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) &&

158 !(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_RETRIED
)) {

160 
šfo
->
æags
 |ğ
IEEE80211_TX_INTFL_RETRIED
;

161 
	`›“80211_add_³ndšg_skb
(
loÿl
, 
skb
);

165 
	`ps_dbg_¿‹lim™ed
(
¡a
->
sd©a
,

167 
	`skb_queue_Ën
(&
¡a
->
tx_f‹»d
[
ac
]),

168 !!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
), 
jiff›s
);

169 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

170 
	}
}

172 
	$›“80211_check_³ndšg_b¬
(
¡a_šfo
 *
¡a
, 
u8
 *
addr
, u8 
tid
)

174 
tid_ampdu_tx
 *
tid_tx
;

176 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

177 ià(!
tid_tx
 || !tid_tx->
b¬_³ndšg
)

180 
tid_tx
->
b¬_³ndšg
 = 
çl£
;

181 
	`›“80211_£nd_b¬
(&
¡a
->
sd©a
->
vif
, 
addr
, 
tid
, 
tid_tx
->
çed_b¬_s¢
);

182 
	}
}

184 
	$›“80211_äame_acked
(
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

186 
›“80211_mgmt
 *
mgmt
 = (*è
skb
->
d©a
;

188 ià(
	`›“80211_is_d©a_qos
(
mgmt
->
äame_cÚŒŞ
)) {

189 
›“80211_hdr
 *
hdr
 = (*è
skb
->
d©a
;

190 
u8
 *
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

191 
u16
 
tid
 = 
qc
[0] & 0xf;

193 
	`›“80211_check_³ndšg_b¬
(
¡a
, 
hdr
->
addr1
, 
tid
);

195 
	}
}

197 
	$›“80211_£t_b¬_³ndšg
(
¡a_šfo
 *
¡a
, 
u8
 
tid
, 
u16
 
s¢
)

199 
tid_ampdu_tx
 *
tid_tx
;

201 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

202 ià(!
tid_tx
)

205 
tid_tx
->
çed_b¬_s¢
 = 
s¢
;

206 
tid_tx
->
b¬_³ndšg
 = 
Œue
;

207 
	}
}

209 
	$›“80211_tx_¿diÙ­_Ën
(
›“80211_tx_šfo
 *
šfo
,

210 
›“80211_tx_¡©us
 *
¡©us
)

212 
›“80211_¿‹_¡©us
 *
¡©us_¿‹
 = 
NULL
;

213 
Ën
 = (
›“80211_¿diÙ­_h—d”
);

215 ià(
¡©us
 && stus->
n_¿‹s
)

216 
¡©us_¿‹
 = &
¡©us
->
¿‹s
[¡©us->
n_¿‹s
 - 1];

219 ià(
¡©us_¿‹
 && !(¡©us_¿‹->
¿‹_idx
.
æags
 &

220 (
RATE_INFO_FLAGS_MCS
 |

221 
RATE_INFO_FLAGS_DMG
 |

222 
RATE_INFO_FLAGS_EDMG
 |

223 
RATE_INFO_FLAGS_VHT_MCS
 |

224 
RATE_INFO_FLAGS_HE_MCS
)))

225 
Ën
 += 2;

226 ià(
šfo
->
¡©us
.
¿‹s
[0].
idx
 >= 0 &&

227 !(
šfo
->
¡©us
.
¿‹s
[0].
æags
 &

228 (
IEEE80211_TX_RC_MCS
 | 
IEEE80211_TX_RC_VHT_MCS
)))

229 
Ën
 += 2;

232 
Ën
 += 2;

235 
Ën
 += 1;

239 ià(
¡©us_¿‹
) {

240 ià(
¡©us_¿‹
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_MCS
)

241 
Ën
 += 3;

242 ià(
¡©us_¿‹
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_VHT_MCS
)

243 
Ën
 = 
	`ALIGN
(len, 2) + 12;

244 ià(
¡©us_¿‹
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_HE_MCS
)

245 
Ën
 = 
	`ALIGN
(len, 2) + 12;

246 } ià(
šfo
->
¡©us
.
¿‹s
[0].
idx
 >= 0) {

247 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_MCS
)

248 
Ën
 += 3;

249 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_VHT_MCS
)

250 
Ën
 = 
	`ALIGN
(len, 2) + 12;

253  
Ën
;

254 
	}
}

257 
	$›“80211_add_tx_¿diÙ­_h—d”
(
›“80211_loÿl
 *
loÿl
,

258 
sk_buff
 *
skb
, 
»Œy_couÁ
,

259 
¹­_Ën
,

260 
›“80211_tx_¡©us
 *
¡©us
)

262 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

263 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

264 
›“80211_¿diÙ­_h—d”
 *
¹hdr
;

265 
›“80211_¿‹_¡©us
 *
¡©us_¿‹
 = 
NULL
;

266 *
pos
;

267 
u16
 
Ëgacy_¿‹
 = 0;

268 
u16
 
txæags
;

270 ià(
¡©us
 && stus->
n_¿‹s
)

271 
¡©us_¿‹
 = &
¡©us
->
¿‹s
[¡©us->
n_¿‹s
 - 1];

273 
¹hdr
 = 
	`skb_push
(
skb
, 
¹­_Ën
);

275 
	`mem£t
(
¹hdr
, 0, 
¹­_Ën
);

276 
¹hdr
->
™_Ën
 = 
	`ıu_to_Ë16
(
¹­_Ën
);

277 
¹hdr
->
™_´e£Á
 =

278 
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_TX_FLAGS
) |

279 
	`BIT
(
IEEE80211_RADIOTAP_DATA_RETRIES
));

280 
pos
 = (*)(
¹hdr
 + 1);

290 ià(
¡©us_¿‹
) {

291 ià(!(
¡©us_¿‹
->
¿‹_idx
.
æags
 &

292 (
RATE_INFO_FLAGS_MCS
 |

293 
RATE_INFO_FLAGS_DMG
 |

294 
RATE_INFO_FLAGS_EDMG
 |

295 
RATE_INFO_FLAGS_VHT_MCS
 |

296 
RATE_INFO_FLAGS_HE_MCS
)))

297 
Ëgacy_¿‹
 = 
¡©us_¿‹
->
¿‹_idx
.
Ëgacy
;

298 } ià(
šfo
->
¡©us
.
¿‹s
[0].
idx
 >= 0 &&

299 !(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & (
IEEE80211_TX_RC_MCS
 |

300 
IEEE80211_TX_RC_VHT_MCS
))) {

301 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

303 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
šfo
->
bªd
];

304 
Ëgacy_¿‹
 =

305 
sbªd
->
b™¿‹s
[
šfo
->
¡©us
.
¿‹s
[0].
idx
].
b™¿‹
;

308 ià(
Ëgacy_¿‹
) {

309 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_RATE
));

310 *
pos
 = 
	`DIV_ROUND_UP
(
Ëgacy_¿‹
, 5);

312 
pos
 += 2;

316 
txæags
 = 0;

317 ià(!(
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
) &&

318 !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

319 
txæags
 |ğ
IEEE80211_RADIOTAP_F_TX_FAIL
;

321 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_USE_CTS_PROTECT
)

322 
txæags
 |ğ
IEEE80211_RADIOTAP_F_TX_CTS
;

323 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_USE_RTS_CTS
)

324 
txæags
 |ğ
IEEE80211_RADIOTAP_F_TX_RTS
;

326 
	`put_uÇligÃd_Ë16
(
txæags
, 
pos
);

327 
pos
 += 2;

331 *
pos
 = 
»Œy_couÁ
;

332 
pos
++;

334 ià(
¡©us_¿‹
 && (¡©us_¿‹->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_MCS
))

336 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_MCS
));

337 
pos
[0] = 
IEEE80211_RADIOTAP_MCS_HAVE_MCS
 |

338 
IEEE80211_RADIOTAP_MCS_HAVE_GI
 |

339 
IEEE80211_RADIOTAP_MCS_HAVE_BW
;

340 ià(
¡©us_¿‹
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_SHORT_GI
)

341 
pos
[1] |ğ
IEEE80211_RADIOTAP_MCS_SGI
;

342 ià(
¡©us_¿‹
->
¿‹_idx
.
bw
 =ğ
RATE_INFO_BW_40
)

343 
pos
[1] |ğ
IEEE80211_RADIOTAP_MCS_BW_40
;

344 
pos
[2] = 
¡©us_¿‹
->
¿‹_idx
.
mcs
;

345 
pos
 += 3;

346 } ià(
¡©us_¿‹
 && (¡©us_¿‹->
¿‹_idx
.
æags
 &

347 
RATE_INFO_FLAGS_VHT_MCS
))

349 
u16
 
known
 = 
loÿl
->
hw
.
¿diÙ­_vht_d‘as
 &

350 (
IEEE80211_RADIOTAP_VHT_KNOWN_GI
 |

351 
IEEE80211_RADIOTAP_VHT_KNOWN_BANDWIDTH
);

353 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_VHT
));

356 
pos
 = (
u8
 *)
¹hdr
 + 
	`ALIGN
(pos - (u8 *)rthdr, 2);

359 
	`put_uÇligÃd_Ë16
(
known
, 
pos
);

360 
pos
 += 2;

363 ià(
¡©us_¿‹
->
¿‹_idx
.
æags
 & 
RATE_INFO_FLAGS_SHORT_GI
)

364 *
pos
 |ğ
IEEE80211_RADIOTAP_VHT_FLAG_SGI
;

365 
pos
++;

368 
¡©us_¿‹
->
¿‹_idx
.
bw
) {

369 
RATE_INFO_BW_160
:

370 *
pos
 = 11;

372 
RATE_INFO_BW_80
:

373 *
pos
 = 4;

375 
RATE_INFO_BW_40
:

376 *
pos
 = 1;

379 *
pos
 = 0;

382 
pos
++;

385 *
pos
 = (
¡©us_¿‹
->
¿‹_idx
.
mcs
 << 4) |

386 
¡©us_¿‹
->
¿‹_idx
.
nss
;

387 
pos
 += 4;

390 
pos
++;

392 
pos
++;

394 
pos
 += 2;

395 } ià(
¡©us_¿‹
 && (¡©us_¿‹->
¿‹_idx
.
æags
 &

396 
RATE_INFO_FLAGS_HE_MCS
))

398 
›“80211_¿diÙ­_he
 *
he
;

400 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_HE
));

403 
pos
 = (
u8
 *)
¹hdr
 + 
	`ALIGN
(pos - (u8 *)rthdr, 2);

404 
he
 = (
›“80211_¿diÙ­_he
 *)
pos
;

406 
he
->
d©a1
 = 
	`ıu_to_Ë16
(
IEEE80211_RADIOTAP_HE_DATA1_FORMAT_SU
 |

407 
IEEE80211_RADIOTAP_HE_DATA1_DATA_MCS_KNOWN
 |

408 
IEEE80211_RADIOTAP_HE_DATA1_DATA_DCM_KNOWN
 |

409 
IEEE80211_RADIOTAP_HE_DATA1_BW_RU_ALLOC_KNOWN
);

411 
he
->
d©a2
 = 
	`ıu_to_Ë16
(
IEEE80211_RADIOTAP_HE_DATA2_GI_KNOWN
);

413 
	#HE_PREP
(
f
, 
v®
è
	`Ë16_’code_b™s
(v®, 
IEEE80211_RADIOTAP_HE_
##f)

	)

415 
he
->
d©a6
 |ğ
	`HE_PREP
(
DATA6_NSTS
, 
¡©us_¿‹
->
¿‹_idx
.
nss
);

417 
	#CHECK_GI
(
s
) \

418 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA5_GI_
##
s
 != \

419 ()
NL80211_RATE_INFO_HE_GI_
##
s
)

	)

421 
	`CHECK_GI
(0
_8
);

422 
	`CHECK_GI
(1
_6
);

423 
	`CHECK_GI
(3
_2
);

425 
he
->
d©a3
 |ğ
	`HE_PREP
(
DATA3_DATA_MCS
, 
¡©us_¿‹
->
¿‹_idx
.
mcs
);

426 
he
->
d©a3
 |ğ
	`HE_PREP
(
DATA3_DATA_DCM
, 
¡©us_¿‹
->
¿‹_idx
.
he_dcm
);

428 
he
->
d©a5
 |ğ
	`HE_PREP
(
DATA5_GI
, 
¡©us_¿‹
->
¿‹_idx
.
he_gi
);

430 
¡©us_¿‹
->
¿‹_idx
.
bw
) {

431 
RATE_INFO_BW_20
:

432 
he
->
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

433 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_20MHZ
);

435 
RATE_INFO_BW_40
:

436 
he
->
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

437 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_40MHZ
);

439 
RATE_INFO_BW_80
:

440 
he
->
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

441 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_80MHZ
);

443 
RATE_INFO_BW_160
:

444 
he
->
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

445 
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_160MHZ
);

447 
RATE_INFO_BW_HE_RU
:

448 
	#CHECK_RU_ALLOC
(
s
) \

449 
	`BUILD_BUG_ON
(
IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC_
##
s
##
T
 != \

450 
NL80211_RATE_INFO_HE_RU_ALLOC_
##
s
 + 4)

	)

452 
	`CHECK_RU_ALLOC
(26);

453 
	`CHECK_RU_ALLOC
(52);

454 
	`CHECK_RU_ALLOC
(106);

455 
	`CHECK_RU_ALLOC
(242);

456 
	`CHECK_RU_ALLOC
(484);

457 
	`CHECK_RU_ALLOC
(996);

458 
	`CHECK_RU_ALLOC
(2x996);

460 
he
->
d©a5
 |ğ
	`HE_PREP
(
DATA5_DATA_BW_RU_ALLOC
,

461 
¡©us_¿‹
->
¿‹_idx
.
he_ru_®loc
 + 4);

464 
	`WARN_ONCE
(1, "Inv®id SU BW %d\n", 
¡©us_¿‹
->
¿‹_idx
.
bw
);

467 
pos
 +ğ(
›“80211_¿diÙ­_he
);

470 ià(
¡©us_¿‹
 || 
šfo
->
¡©us
.
¿‹s
[0].
idx
 < 0)

475 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_MCS
) {

476 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_MCS
));

477 
pos
[0] = 
IEEE80211_RADIOTAP_MCS_HAVE_MCS
 |

478 
IEEE80211_RADIOTAP_MCS_HAVE_GI
 |

479 
IEEE80211_RADIOTAP_MCS_HAVE_BW
;

480 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_SHORT_GI
)

481 
pos
[1] |ğ
IEEE80211_RADIOTAP_MCS_SGI
;

482 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

483 
pos
[1] |ğ
IEEE80211_RADIOTAP_MCS_BW_40
;

484 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_GREEN_FIELD
)

485 
pos
[1] |ğ
IEEE80211_RADIOTAP_MCS_FMT_GF
;

486 
pos
[2] = 
šfo
->
¡©us
.
¿‹s
[0].
idx
;

487 
pos
 += 3;

488 } ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

489 
u16
 
known
 = 
loÿl
->
hw
.
¿diÙ­_vht_d‘as
 &

490 (
IEEE80211_RADIOTAP_VHT_KNOWN_GI
 |

491 
IEEE80211_RADIOTAP_VHT_KNOWN_BANDWIDTH
);

493 
¹hdr
->
™_´e£Á
 |ğ
	`ıu_to_Ë32
(
	`BIT
(
IEEE80211_RADIOTAP_VHT
));

496 
pos
 = (
u8
 *)
¹hdr
 + 
	`ALIGN
(pos - (u8 *)rthdr, 2);

499 
	`put_uÇligÃd_Ë16
(
known
, 
pos
);

500 
pos
 += 2;

503 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_SHORT_GI
)

504 *
pos
 |ğ
IEEE80211_RADIOTAP_VHT_FLAG_SGI
;

505 
pos
++;

508 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_40_MHZ_WIDTH
)

509 *
pos
 = 1;

510 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_80_MHZ_WIDTH
)

511 *
pos
 = 4;

512 ià(
šfo
->
¡©us
.
¿‹s
[0].
æags
 & 
IEEE80211_TX_RC_160_MHZ_WIDTH
)

513 *
pos
 = 11;

515 *
pos
 = 0;

516 
pos
++;

519 *
pos
 = (
	`›“80211_¿‹_g‘_vht_mcs
(&
šfo
->
¡©us
.
¿‹s
[0]) << 4) |

520 
	`›“80211_¿‹_g‘_vht_nss
(&
šfo
->
¡©us
.
¿‹s
[0]);

521 
pos
 += 4;

524 
pos
++;

526 
pos
++;

528 
pos
 += 2;

530 
	}
}

536 
	$›“80211_tdls_td_tx_hªdË
(
›“80211_loÿl
 *
loÿl
,

537 
›“80211_sub_if_d©a
 *
sd©a
,

538 
sk_buff
 *
skb
, 
u32
 
æags
)

540 
sk_buff
 *
‹¬down_skb
;

541 
sk_buff
 *
Üig_‹¬down_skb
;

542 
boŞ
 
is_‹¬down
 = 
çl£
;

545 
	`¥š_lock
(&
sd©a
->
u
.
mgd
.
‹¬down_lock
);

546 
‹¬down_skb
 = 
sd©a
->
u
.
mgd
.teardown_skb;

547 
Üig_‹¬down_skb
 = 
sd©a
->
u
.
mgd
.orig_teardown_skb;

548 ià((
skb
 =ğ
Üig_‹¬down_skb
è&& 
‹¬down_skb
) {

549 
sd©a
->
u
.
mgd
.
‹¬down_skb
 = 
NULL
;

550 
sd©a
->
u
.
mgd
.
Üig_‹¬down_skb
 = 
NULL
;

551 
is_‹¬down
 = 
Œue
;

553 
	`¥š_uÆock
(&
sd©a
->
u
.
mgd
.
‹¬down_lock
);

555 ià(
is_‹¬down
) {

557 
	`WARN_ON
(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
));

560 ià(
æags
 & 
IEEE80211_TX_STAT_ACK
) {

561 
	`dev_kä“_skb_ªy
(
‹¬down_skb
);

563 
	`tdls_dbg
(
sd©a
,

566 
	`›“80211_subif_¡¬t_xm™
(
‹¬down_skb
, 
skb
->
dev
);

569 
	}
}

571 
›“80211_sub_if_d©a
 *

572 
	$›“80211_sd©a_äom_skb
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
)

574 
›“80211_sub_if_d©a
 *
sd©a
;

576 ià(
skb
->
dev
) {

577 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

578 ià(!
sd©a
->
dev
)

581 ià(
skb
->
dev
 =ğ
sd©a
->dev)

582  
sd©a
;

585  
NULL
;

588  
	`rcu_d”eã»nû
(
loÿl
->
p2p_sd©a
);

589 
	}
}

591 
	$›“80211_»pÜt_ack_skb
(
›“80211_loÿl
 *
loÿl
,

592 
sk_buff
 *
Üig_skb
,

593 
boŞ
 
acked
, boŞ 
drİ³d
,

594 
ktime_t
 
ack_hwt¡amp
)

596 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
Üig_skb
);

597 
sk_buff
 *
skb
;

598 
æags
;

600 
	`¥š_lock_œq§ve
(&
loÿl
->
ack_¡©us_lock
, 
æags
);

601 
skb
 = 
	`idr_»move
(&
loÿl
->
ack_¡©us_äames
, 
šfo
->
¡©us_d©a
);

602 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
ack_¡©us_lock
, 
æags
);

604 ià(!
skb
)

607 ià(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_NL80211_FRAME_TX
) {

608 
u64
 
cook›
 = 
	`IEEE80211_SKB_CB
(
skb
)->
ack
.cookie;

609 
›“80211_sub_if_d©a
 *
sd©a
;

610 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

611 
boŞ
 
is_v®id_ack_sigÇl
 =

612 !!(
šfo
->
¡©us
.
æags
 & 
IEEE80211_TX_STATUS_ACK_SIGNAL_VALID
);

613 
cfg80211_tx_¡©us
 
¡©us
 = {

614 .
cook›
 = cookie,

615 .
buf
 = 
skb
->
d©a
,

616 .
Ën
 = 
skb
->len,

617 .
ack
 = 
acked
,

620 ià(
	`›“80211_is_timšg_m—su»m’t
(
Üig_skb
) ||

621 
	`›“80211_is_ám
(
Üig_skb
)) {

622 
¡©us
.
tx_t¡amp
 =

623 
	`ktime_to_ns
(
	`skb_hwt¡amps
(
Üig_skb
)->
hwt¡amp
);

624 
¡©us
.
ack_t¡amp
 = 
	`ktime_to_ns
(
ack_hwt¡amp
);

627 
	`rcu_»ad_lock
();

628 
sd©a
 = 
	`›“80211_sd©a_äom_skb
(
loÿl
, 
skb
);

629 ià(
sd©a
) {

630 ià(
skb
->
´ÙocŞ
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 ||

631 
skb
->
´ÙocŞ
 =ğ
	`ıu_to_be16
(
ETH_P_PREAUTH
))

632 
	`cfg80211_cÚŒŞ_pÜt_tx_¡©us
(&
sd©a
->
wdev
,

633 
cook›
,

634 
skb
->
d©a
,

635 
skb
->
Ën
,

636 
acked
,

637 
GFP_ATOMIC
);

638 ià(
	`›“80211_is_ªy_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

639 
	`cfg80211_´obe_¡©us
(
sd©a
->
dev
, 
hdr
->
addr1
,

640 
cook›
, 
acked
,

641 
šfo
->
¡©us
.
ack_sigÇl
,

642 
is_v®id_ack_sigÇl
,

643 
GFP_ATOMIC
);

644 ià(
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

645 
	`cfg80211_mgmt_tx_¡©us_ext
(&
sd©a
->
wdev
,

646 &
¡©us
,

647 
GFP_ATOMIC
);

649 
	`´_w¬n
("Unknown status„eport in‡ck skb\n");

652 
	`rcu_»ad_uÆock
();

654 
	`dev_kä“_skb_ªy
(
skb
);

655 } ià(
drİ³d
) {

656 
	`dev_kä“_skb_ªy
(
skb
);

659 
	`skb_com¶‘e_wifi_ack
(
skb
, 
acked
);

661 
	}
}

663 
	$›“80211_hªdË_smps_¡©us
(
›“80211_sub_if_d©a
 *
sd©a
,

664 
boŞ
 
acked
, 
u16
 
¡©us_d©a
)

666 
u16
 
sub_d©a
 = 
	`u16_g‘_b™s
(
¡©us_d©a
, 
IEEE80211_STATUS_SUBDATA_MASK
);

667 
›“80211_smps_mode
 
smps_mode
 = 
sub_d©a
 & 3;

668 
lšk_id
 = (
sub_d©a
 >> 2);

669 
›“80211_lšk_d©a
 *
lšk
;

671 ià(!
sd©a
 || !
	`›“80211_sd©a_ruÂšg
(sdata))

674 ià(!
acked
)

677 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

680 ià(
	`WARN
(
lšk_id
 >ğ
	`ARRAY_SIZE
(
sd©a
->
lšk
),

681 "bad SMPS stu lšk: %d\n", 
lšk_id
))

684 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

685 ià(!
lšk
)

695 
lšk
->
smps_mode
 = smps_mode;

696 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
, &
lšk
->
u
.
mgd
.
»ÿlc_smps
);

697 
	}
}

699 
	$›“80211_»pÜt_u£d_skb
(
›“80211_loÿl
 *
loÿl
,

700 
sk_buff
 *
skb
, 
boŞ
 
drİ³d
,

701 
ktime_t
 
ack_hwt¡amp
)

703 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

704 
u16
 
tx_time_e¡
 = 
	`›“80211_šfo_g‘_tx_time_e¡
(
šfo
);

705 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

706 
boŞ
 
acked
 = 
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
;

708 ià(
drİ³d
)

709 
acked
 = 
çl£
;

711 ià(
tx_time_e¡
) {

712 
¡a_šfo
 *
¡a
;

714 
	`rcu_»ad_lock
();

716 
¡a
 = 
	`¡a_šfo_g‘_by_addrs
(
loÿl
, 
hdr
->
addr1
, hdr->
addr2
);

717 
	`›“80211_¡a_upd©e_³ndšg_aœtime
(
loÿl
, 
¡a
,

718 
	`skb_g‘_queue_m­pšg
(
skb
),

719 
tx_time_e¡
,

720 
Œue
);

721 
	`rcu_»ad_uÆock
();

724 ià(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_MLME_CONN_TX
) {

725 
›“80211_sub_if_d©a
 *
sd©a
;

727 
	`rcu_»ad_lock
();

729 
sd©a
 = 
	`›“80211_sd©a_äom_skb
(
loÿl
, 
skb
);

731 ià(!
sd©a
) {

732 
skb
->
dev
 = 
NULL
;

733 } ià(!
drİ³d
) {

735 ià(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

736 (
	`›“80211_g‘_tdls_aùiÚ
(
skb
) ==

737 
WLAN_TDLS_TEARDOWN
)) {

738 
	`›“80211_tdls_td_tx_hªdË
(
loÿl
, 
sd©a
, 
skb
,

739 
šfo
->
æags
);

740 } ià(
	`›“80211_s1g_is_twt_£tup
(
skb
)) {

741 ià(!
acked
) {

742 
sk_buff
 *
qskb
;

744 
qskb
 = 
	`skb_şÚe
(
skb
, 
GFP_ATOMIC
);

745 ià(
qskb
) {

746 
	`skb_queue_
(&
sd©a
->
¡©us_queue
,

747 
qskb
);

748 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
,

749 &
sd©a
->
wÜk
);

753 
	`›“80211_mgd_cÚn_tx_¡©us
(
sd©a
,

754 
hdr
->
äame_cÚŒŞ
,

755 
acked
);

759 
	`rcu_»ad_uÆock
();

760 } ià(
šfo
->
¡©us_d©a_idr
) {

761 
	`›“80211_»pÜt_ack_skb
(
loÿl
, 
skb
, 
acked
, 
drİ³d
,

762 
ack_hwt¡amp
);

763 } ià(
šfo
->
¡©us_d©a
) {

764 
›“80211_sub_if_d©a
 *
sd©a
;

766 
	`rcu_»ad_lock
();

768 
sd©a
 = 
	`›“80211_sd©a_äom_skb
(
loÿl
, 
skb
);

770 
	`u16_g‘_b™s
(
šfo
->
¡©us_d©a
,

771 
IEEE80211_STATUS_TYPE_MASK
)) {

772 
IEEE80211_STATUS_TYPE_SMPS
:

773 
	`›“80211_hªdË_smps_¡©us
(
sd©a
, 
acked
,

774 
šfo
->
¡©us_d©a
);

777 
	`rcu_»ad_uÆock
();

780 ià(!
drİ³d
 && 
skb
->
de¡ruùÜ
) {

781 
skb
->
wifi_acked_v®id
 = 1;

782 
skb
->
wifi_acked
 = 
acked
;

785 
	`›“80211_Ëd_tx
(
loÿl
);

787 ià(
	`skb_has_äag_li¡
(
skb
)) {

788 
	`kä“_skb_li¡
(
	`skb_shšfo
(
skb
)->
äag_li¡
);

789 
	`skb_shšfo
(
skb
)->
äag_li¡
 = 
NULL
;

791 
	}
}

800 
	#STA_LOST_PKT_THRESHOLD
 50

	)

801 
	#STA_LOST_PKT_TIME
 
HZ


	)

802 
	#STA_LOST_TDLS_PKT_TIME
 (10*
HZ
è

	)

804 
	$›“80211_lo¡_·ck‘
(
¡a_šfo
 *
¡a
,

805 
›“80211_tx_šfo
 *
šfo
)

807 
pkt_time
 = 
STA_LOST_PKT_TIME
;

808 
pkt_thr
 = 
STA_LOST_PKT_THRESHOLD
;

813 ià(
	`›“80211_hw_check
(&
¡a
->
loÿl
->
hw
, 
REPORTS_LOW_ACK
))

817 ià((
šfo
->
æags
 & 
IEEE80211_TX_CTL_AMPDU
) &&

818 !(
šfo
->
æags
 & 
IEEE80211_TX_STAT_AMPDU
))

821 
¡a
->
deæšk
.
¡©us_¡©s
.
lo¡_·ck‘s
++;

822 ià(
¡a
->¡a.
tdls
) {

823 
pkt_time
 = 
STA_LOST_TDLS_PKT_TIME
;

824 
pkt_thr
 = 
STA_LOST_PKT_THRESHOLD
;

834 ià(
¡a
->
deæšk
.
¡©us_¡©s
.
lo¡_·ck‘s
 < 
pkt_thr
 ||

835 !
	`time_aá”
(
jiff›s
, 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_pkt_time
 + 
pkt_time
))

838 
	`cfg80211_cqm_pkoss_nÙify
(
¡a
->
sd©a
->
dev
, s->¡a.
addr
,

839 
¡a
->
deæšk
.
¡©us_¡©s
.
lo¡_·ck‘s
,

840 
GFP_ATOMIC
);

841 
¡a
->
deæšk
.
¡©us_¡©s
.
lo¡_·ck‘s
 = 0;

842 
	}
}

844 
	$›“80211_tx_g‘_¿‹s
(
›“80211_hw
 *
hw
,

845 
›“80211_tx_šfo
 *
šfo
,

846 *
»Œy_couÁ
)

848 
couÁ
 = -1;

849 
i
;

851 
i
 = 0; i < 
IEEE80211_TX_MAX_RATES
; i++) {

852 ià((
šfo
->
æags
 & 
IEEE80211_TX_CTL_AMPDU
) &&

853 !(
šfo
->
æags
 & 
IEEE80211_TX_STAT_AMPDU
)) {

855 
šfo
->
¡©us
.
¿‹s
[
i
].
idx
 = -1;

856 
šfo
->
¡©us
.
¿‹s
[
i
].
couÁ
 = 0;

858 } ià(
šfo
->
¡©us
.
¿‹s
[
i
].
idx
 < 0) {

860 } ià(
i
 >ğ
hw
->
max_»pÜt_¿‹s
) {

862 
šfo
->
¡©us
.
¿‹s
[
i
].
idx
 = -1;

863 
šfo
->
¡©us
.
¿‹s
[
i
].
couÁ
 = 0;

867 
couÁ
 +ğ
šfo
->
¡©us
.
¿‹s
[
i
].count;

870 ià(
couÁ
 < 0)

871 
couÁ
 = 0;

873 *
»Œy_couÁ
 = 
couÁ
;

874  
i
 - 1;

875 
	}
}

877 
	$›“80211_tx_mÚ™Ü
(
›“80211_loÿl
 *
loÿl
, 
sk_buff
 *
skb
,

878 
»Œy_couÁ
, 
boŞ
 
£nd_to_cooked
,

879 
›“80211_tx_¡©us
 *
¡©us
)

881 
sk_buff
 *
skb2
;

882 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

883 
›“80211_sub_if_d©a
 *
sd©a
;

884 
Ãt_deviû
 *
´ev_dev
 = 
NULL
;

885 
¹­_Ën
;

888 
¹­_Ën
 = 
	`›“80211_tx_¿diÙ­_Ën
(
šfo
, 
¡©us
);

889 ià(
	`WARN_ON_ONCE
(
	`skb_h—droom
(
skb
è< 
¹­_Ën
)) {

890 
	`´_”r
("ieee80211_tx_status: headroomoo small\n");

891 
	`dev_kä“_skb
(
skb
);

894 
	`›“80211_add_tx_¿diÙ­_h—d”
(
loÿl
, 
skb
, 
»Œy_couÁ
,

895 
¹­_Ën
, 
¡©us
);

898 
	`skb_»£t_mac_h—d”
(
skb
);

899 
skb
->
_summed
 = 
CHECKSUM_UNNECESSARY
;

900 
skb
->
pkt_ty³
 = 
PACKET_OTHERHOST
;

901 
skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_2
);

902 
	`mem£t
(
skb
->
cb
, 0, (skb->cb));

904 
	`rcu_»ad_lock
();

905 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

906 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
) {

907 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

910 ià((
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_COOK_FRAMES
) &&

911 !
£nd_to_cooked
)

914 ià(
´ev_dev
) {

915 
skb2
 = 
	`skb_şÚe
(
skb
, 
GFP_ATOMIC
);

916 ià(
skb2
) {

917 
skb2
->
dev
 = 
´ev_dev
;

918 
	`Ãtif_rx
(
skb2
);

922 
´ev_dev
 = 
sd©a
->
dev
;

925 ià(
´ev_dev
) {

926 
skb
->
dev
 = 
´ev_dev
;

927 
	`Ãtif_rx
(
skb
);

928 
skb
 = 
NULL
;

930 
	`rcu_»ad_uÆock
();

931 
	`dev_kä“_skb
(
skb
);

932 
	}
}

934 
	$__›“80211_tx_¡©us
(
›“80211_hw
 *
hw
,

935 
›“80211_tx_¡©us
 *
¡©us
,

936 
¿‹s_idx
, 
»Œy_couÁ
)

938 
sk_buff
 *
skb
 = 
¡©us
->skb;

939 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

940 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

941 
›“80211_tx_šfo
 *
šfo
 = 
¡©us
->info;

942 
¡a_šfo
 *
¡a
;

943 
__Ë16
 
fc
;

944 
boŞ
 
£nd_to_cooked
;

945 
boŞ
 
acked
;

946 
boŞ
 
nßck_sucûss
;

947 
›“80211_b¬
 *
b¬
;

948 
tid
 = 
IEEE80211_NUM_TIDS
;

950 
fc
 = 
hdr
->
äame_cÚŒŞ
;

952 ià(
¡©us
->
¡a
) {

953 
¡a
 = 
	`cÚš”_of
(
¡©us
->¡a, 
¡a_šfo
, sta);

955 ià(
šfo
->
æags
 & 
IEEE80211_TX_STATUS_EOSP
)

956 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_SP
);

958 
acked
 = !!(
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
);

959 
nßck_sucûss
 = !!(
šfo
->
æags
 &

960 
IEEE80211_TX_STAT_NOACK_TRANSMITTED
);

963 ià(
	`›“80211_vif_is_mesh
(&
¡a
->
sd©a
->
vif
) &&

964 
	`›“80211_is_d©a_qos
(
fc
))

965 
	`›“80211_mp¥_Œigg”_´oûss
(

966 
	`›“80211_g‘_qos_ùl
(
hdr
), 
¡a
, 
Œue
, 
acked
);

968 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
) &&

969 (
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
)) &&

970 (
¿‹s_idx
 != -1))

971 
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
 =

972 
šfo
->
¡©us
.
¿‹s
[
¿‹s_idx
];

974 ià((
šfo
->
æags
 & 
IEEE80211_TX_STAT_AMPDU_NO_BACK
) &&

975 (
	`›“80211_is_d©a_qos
(
fc
))) {

976 
u16
 
s¢
;

977 
u8
 *
qc
;

979 
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

980 
tid
 = 
qc
[0] & 0xf;

981 
s¢
 = ((
	`Ë16_to_ıu
(
hdr
->
£q_ù¾
) + 0x10)

982 & 
IEEE80211_SCTL_SEQ
);

983 
	`›“80211_£nd_b¬
(&
¡a
->
sd©a
->
vif
, 
hdr
->
addr1
,

984 
tid
, 
s¢
);

985 } ià(
	`›“80211_is_d©a_qos
(
fc
)) {

986 
u8
 *
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

988 
tid
 = 
qc
[0] & 0xf;

991 ià(!
acked
 && 
	`›“80211_is_back_»q
(
fc
)) {

992 
u16
 
cÚŒŞ
;

999 
b¬
 = (
›“80211_b¬
 *è
skb
->
d©a
;

1000 
cÚŒŞ
 = 
	`Ë16_to_ıu
(
b¬
->control);

1001 ià(!(
cÚŒŞ
 & 
IEEE80211_BAR_CTRL_MULTI_TID
)) {

1002 
u16
 
s¢
 = 
	`Ë16_to_ıu
(
b¬
->
¡¬t_£q_num
);

1004 
tid
 = (
cÚŒŞ
 &

1005 
IEEE80211_BAR_CTRL_TID_INFO_MASK
) >>

1006 
IEEE80211_BAR_CTRL_TID_INFO_SHIFT
;

1008 
	`›“80211_£t_b¬_³ndšg
(
¡a
, 
tid
, 
s¢
);

1012 ià(
šfo
->
æags
 & 
IEEE80211_TX_STAT_TX_FILTERED
) {

1013 
	`›“80211_hªdË_f‹»d_äame
(
loÿl
, 
¡a
, 
skb
);

1015 } ià(
	`›“80211_is_d©a_´e£Á
(
fc
)) {

1016 ià(!
acked
 && !
nßck_sucûss
)

1017 
¡a
->
deæšk
.
¡©us_¡©s
.
msdu_çed
[
tid
]++;

1019 
¡a
->
deæšk
.
¡©us_¡©s
.
msdu_»Œ›s
[
tid
] +=

1020 
»Œy_couÁ
;

1023 ià(!(
šfo
->
æags
 & 
IEEE80211_TX_CTL_INJECTED
è&& 
acked
)

1024 
	`›“80211_äame_acked
(
¡a
, 
skb
);

1032 ià((
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
) ||

1033 (
šfo
->
æags
 & 
IEEE80211_TX_STAT_NOACK_TRANSMITTED
)) {

1034 ià(
	`›“80211_is_fœ¡_äag
(
hdr
->
£q_ù¾
)) {

1035 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11T¿nsm™‹dF¿meCouÁ
);

1036 ià(
	`is_muÉiÿ¡_‘h”_addr
(
	`›“80211_g‘_DA
(
hdr
)))

1037 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11MuÉiÿ¡T¿nsm™‹dF¿meCouÁ
);

1038 ià(
»Œy_couÁ
 > 0)

1039 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11R‘ryCouÁ
);

1040 ià(
»Œy_couÁ
 > 1)

1041 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11MuÉËR‘ryCouÁ
);

1048 ià(!
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) ||

1049 
	`›“80211_is_d©a
(
fc
) ||

1050 
	`›“80211_is_mgmt
(
fc
))

1051 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11T¿nsm™‹dF¿gm’tCouÁ
);

1053 ià(
	`›“80211_is_fœ¡_äag
(
hdr
->
£q_ù¾
))

1054 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11FaedCouÁ
);

1057 ià(
	`›“80211_is_ªy_nuÎfunc
(
fc
) &&

1058 
	`›“80211_has_pm
(
fc
) &&

1059 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
) &&

1060 !(
šfo
->
æags
 & 
IEEE80211_TX_CTL_INJECTED
) &&

1061 
loÿl
->
ps_sd©a
 && !Öoÿl->
sÿÂšg
)) {

1062 ià(
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
)

1063 
loÿl
->
ps_sd©a
->
u
.
mgd
.
æags
 |=

1064 
IEEE80211_STA_NULLFUNC_ACKED
;

1065 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
,

1066 
jiff›s
 + 
	`m£cs_to_jiff›s
(10));

1069 
	`›“80211_»pÜt_u£d_skb
(
loÿl
, 
skb
, 
çl£
, 
¡©us
->
ack_hwt¡amp
);

1072 
	`skb_Üphª
(
skb
);

1075 
£nd_to_cooked
 = !!(
šfo
->
æags
 & 
IEEE80211_TX_CTL_INJECTED
) ||

1076 !(
	`›“80211_is_d©a
(
fc
));

1082 ià(!
loÿl
->
mÚ™Üs
 && (!
£nd_to_cooked
 || !loÿl->
cooked_mÁrs
)) {

1083 ià(
¡©us
->
ä“_li¡
)

1084 
	`li¡_add_
(&
skb
->
li¡
, 
¡©us
->
ä“_li¡
);

1086 
	`dev_kä“_skb
(
skb
);

1091 
	`›“80211_tx_mÚ™Ü
(
loÿl
, 
skb
, 
»Œy_couÁ
,

1092 
£nd_to_cooked
, 
¡©us
);

1093 
	}
}

1095 
	$›“80211_tx_¡©us_skb
(
›“80211_hw
 *
hw
, 
sk_buff
 *
skb
)

1097 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

1098 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1099 
›“80211_tx_¡©us
 
¡©us
 = {

1100 .
skb
 = skb,

1101 .
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
),

1103 
¡a_šfo
 *
¡a
;

1105 
	`rcu_»ad_lock
();

1107 
¡a
 = 
	`¡a_šfo_g‘_by_addrs
(
loÿl
, 
hdr
->
addr1
, hdr->
addr2
);

1108 ià(
¡a
)

1109 
¡©us
.
¡a
 = &sta->sta;

1111 
	`›“80211_tx_¡©us_ext
(
hw
, &
¡©us
);

1112 
	`rcu_»ad_uÆock
();

1113 
	}
}

1114 
EXPORT_SYMBOL
(
›“80211_tx_¡©us_skb
);

1116 
	$›“80211_tx_¡©us_ext
(
›“80211_hw
 *
hw
,

1117 
›“80211_tx_¡©us
 *
¡©us
)

1119 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1120 
›“80211_tx_šfo
 *
šfo
 = 
¡©us
->info;

1121 
›“80211_¡a
 *
pub¡a
 = 
¡©us
->
¡a
;

1122 
sk_buff
 *
skb
 = 
¡©us
->skb;

1123 
¡a_šfo
 *
¡a
 = 
NULL
;

1124 
¿‹s_idx
, 
»Œy_couÁ
;

1125 
boŞ
 
acked
, 
nßck_sucûss
, 
ack_sigÇl_v®id
;

1126 
u16
 
tx_time_e¡
;

1128 ià(
pub¡a
) {

1129 
¡a
 = 
	`cÚš”_of
(
pub¡a
, 
¡a_šfo
, sta);

1131 ià(
¡©us
->
n_¿‹s
)

1132 
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹_šfo
 =

1133 
¡©us
->
¿‹s
[¡©us->
n_¿‹s
 - 1].
¿‹_idx
;

1136 ià(
skb
 && (
tx_time_e¡
 =

1137 
	`›“80211_šfo_g‘_tx_time_e¡
(
	`IEEE80211_SKB_CB
(
skb
))) > 0) {

1141 
	`›“80211_¡a_upd©e_³ndšg_aœtime
(
loÿl
, 
¡a
,

1142 
	`skb_g‘_queue_m­pšg
(
skb
),

1143 
tx_time_e¡
,

1144 
Œue
);

1145 
	`›“80211_šfo_£t_tx_time_e¡
(
	`IEEE80211_SKB_CB
(
skb
), 0);

1148 ià(!
¡©us
->
šfo
)

1149 
ä“
;

1151 
¿‹s_idx
 = 
	`›“80211_tx_g‘_¿‹s
(
hw
, 
šfo
, &
»Œy_couÁ
);

1153 
acked
 = !!(
šfo
->
æags
 & 
IEEE80211_TX_STAT_ACK
);

1154 
nßck_sucûss
 = !!(
šfo
->
æags
 & 
IEEE80211_TX_STAT_NOACK_TRANSMITTED
);

1155 
ack_sigÇl_v®id
 =

1156 !!(
šfo
->
¡©us
.
æags
 & 
IEEE80211_TX_STATUS_ACK_SIGNAL_VALID
);

1158 ià(
pub¡a
) {

1159 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1161 ià(!
acked
 && !
nßck_sucûss
)

1162 
¡a
->
deæšk
.
¡©us_¡©s
.
»Œy_çed
++;

1163 
¡a
->
deæšk
.
¡©us_¡©s
.
»Œy_couÁ
 +=„etry_count;

1165 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

1166 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

1167 
skb
 && !(
šfo
->
æags
 & 
IEEE80211_TX_CTL_HW_80211_ENCAP
))

1168 
	`›“80211_¡a_tx_nÙify
(
sd©a
, (*è
skb
->
d©a
,

1169 
acked
, 
šfo
->
¡©us
.
tx_time
);

1171 ià(
acked
) {

1172 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack
 = 
jiff›s
;

1174 ià(
¡a
->
deæšk
.
¡©us_¡©s
.
lo¡_·ck‘s
)

1175 
¡a
->
deæšk
.
¡©us_¡©s
.
lo¡_·ck‘s
 = 0;

1178 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_pkt_time
 = 
jiff›s
;

1181 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

1182 
	`uÆik–y
(
sd©a
->
u
.
mgd
.
´obe_£nd_couÁ
 > 0))

1183 
sd©a
->
u
.
mgd
.
´obe_£nd_couÁ
 = 0;

1185 ià(
ack_sigÇl_v®id
) {

1186 
¡a
->
deæšk
.
¡©us_¡©s
.
Ï¡_ack_sigÇl
 =

1187 (
s8
)
šfo
->
¡©us
.
ack_sigÇl
;

1188 
¡a
->
deæšk
.
¡©us_¡©s
.
ack_sigÇl_fËd
 = 
Œue
;

1189 
	`ewma_avg_sigÇl_add
(&
¡a
->
deæšk
.
¡©us_¡©s
.
avg_ack_sigÇl
,

1190 -
šfo
->
¡©us
.
ack_sigÇl
);

1192 } ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
)) {

1197 ià(
skb
)

1198 
	`›“80211_hªdË_f‹»d_äame
(
loÿl
, 
¡a
, 
skb
);

1200 } ià(
nßck_sucûss
) {

1203 
	`›“80211_lo¡_·ck‘
(
¡a
, 
šfo
);

1207 
	`¿‹_cÚŒŞ_tx_¡©us
(
loÿl
, 
¡©us
);

1208 ià(
	`›“80211_vif_is_mesh
(&
¡a
->
sd©a
->
vif
))

1209 
	`›“80211s_upd©e_m‘ric
(
loÿl
, 
¡a
, 
¡©us
);

1212 ià(
skb
 && !(
šfo
->
æags
 & 
IEEE80211_TX_CTL_HW_80211_ENCAP
))

1213  
	`__›“80211_tx_¡©us
(
hw
, 
¡©us
, 
¿‹s_idx
,

1214 
»Œy_couÁ
);

1216 ià(
acked
 || 
nßck_sucûss
) {

1217 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11T¿nsm™‹dF¿meCouÁ
);

1218 ià(!
pub¡a
)

1219 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11MuÉiÿ¡T¿nsm™‹dF¿meCouÁ
);

1220 ià(
»Œy_couÁ
 > 0)

1221 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11R‘ryCouÁ
);

1222 ià(
»Œy_couÁ
 > 1)

1223 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11MuÉËR‘ryCouÁ
);

1225 
	`I802_DEBUG_INC
(
loÿl
->
dÙ11FaedCouÁ
);

1228 
ä“
:

1229 ià(!
skb
)

1232 
	`›“80211_»pÜt_u£d_skb
(
loÿl
, 
skb
, 
çl£
, 
¡©us
->
ack_hwt¡amp
);

1233 ià(
¡©us
->
ä“_li¡
)

1234 
	`li¡_add_
(&
skb
->
li¡
, 
¡©us
->
ä“_li¡
);

1236 
	`dev_kä“_skb
(
skb
);

1237 
	}
}

1238 
EXPORT_SYMBOL
(
›“80211_tx_¡©us_ext
);

1240 
	$›“80211_tx_¿‹_upd©e
(
›“80211_hw
 *
hw
,

1241 
›“80211_¡a
 *
pub¡a
,

1242 
›“80211_tx_šfo
 *
šfo
)

1244 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1245 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

1246 
›“80211_tx_¡©us
 
¡©us
 = {

1247 .
šfo
 = info,

1248 .
¡a
 = 
pub¡a
,

1251 
	`¿‹_cÚŒŞ_tx_¡©us
(
loÿl
, &
¡©us
);

1253 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
))

1254 
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
 = 
šfo
->
¡©us
.
¿‹s
[0];

1255 
	}
}

1256 
EXPORT_SYMBOL
(
›“80211_tx_¿‹_upd©e
);

1258 
	$›“80211_»pÜt_low_ack
(
›“80211_¡a
 *
pub¡a
, 
u32
 
num_·ck‘s
)

1260 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

1261 
	`cfg80211_cqm_pkoss_nÙify
(
¡a
->
sd©a
->
dev
, s->¡a.
addr
,

1262 
num_·ck‘s
, 
GFP_ATOMIC
);

1263 
	}
}

1264 
EXPORT_SYMBOL
(
›“80211_»pÜt_low_ack
);

1266 
	$›“80211_ä“_txskb
(
›“80211_hw
 *
hw
, 
sk_buff
 *
skb
)

1268 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

1269 
ktime_t
 
kt
 = 
	`ktime_£t
(0, 0);

1271 
	`›“80211_»pÜt_u£d_skb
(
loÿl
, 
skb
, 
Œue
, 
kt
);

1272 
	`dev_kä“_skb_ªy
(
skb
);

1273 
	}
}

1274 
EXPORT_SYMBOL
(
›“80211_ä“_txskb
);

1276 
	$›“80211_purge_tx_queue
(
›“80211_hw
 *
hw
,

1277 
sk_buff_h—d
 *
skbs
)

1279 
sk_buff
 *
skb
;

1281 (
skb
 = 
	`__skb_dequeue
(
skbs
)))

1282 
	`›“80211_ä“_txskb
(
hw
, 
skb
);

1283 
	}
}

	@tdls.c

12 
	~<lšux/›“80211.h
>

13 
	~<lšux/log2.h
>

14 
	~<Ãt/cfg80211.h
>

15 
	~<lšux/¹Ãšk.h
>

16 
	~"›“80211_i.h
"

17 
	~"driv”-İs.h
"

18 
	~"¿‹.h
"

19 
	~"wme.h
"

22 
	#TDLS_PEER_SETUP_TIMEOUT
 (15 * 
HZ
)

	)

24 
	$›“80211_tdls_³”_d–_wÜk
(
why
 *why, 
why_wÜk
 *
wk
)

26 
›“80211_sub_if_d©a
 *
sd©a
;

27 
›“80211_loÿl
 *
loÿl
;

29 
sd©a
 = 
	`cÚš”_of
(
wk
, 
›“80211_sub_if_d©a
,

30 
u
.
mgd
.
tdls_³”_d–_wÜk
.
wÜk
);

31 
loÿl
 = 
sd©a
->local;

33 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

35 ià(!
	`is_z”o_‘h”_addr
(
sd©a
->
u
.
mgd
.
tdls_³”
)) {

36 
	`tdls_dbg
(
sd©a
, "TDLS d–…“¸%pM\n", sd©a->
u
.
mgd
.
tdls_³”
);

37 
	`¡a_šfo_de¡roy_addr
(
sd©a
, sd©a->
u
.
mgd
.
tdls_³”
);

38 
	`‘h_z”o_addr
(
sd©a
->
u
.
mgd
.
tdls_³”
);

40 
	}
}

42 
	$›“80211_tdls_add_ext_ÿ·b
(
›“80211_lšk_d©a
 *
lšk
,

43 
sk_buff
 *
skb
)

45 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

46 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

47 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

48 
boŞ
 
chª_sw™ch
 = 
loÿl
->
hw
.
why
->
ã©u»s
 &

49 
NL80211_FEATURE_TDLS_CHANNEL_SWITCH
;

50 
boŞ
 
wid”_bªd
 = 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TDLS_WIDER_BW
) &&

51 !
ifmgd
->
tdls_wid”_bw_´ohib™ed
;

52 
boŞ
 
bufãr_¡a
 = 
	`›“80211_hw_check
(&
loÿl
->
hw
,

53 
SUPPORTS_TDLS_BUFFER_STA
);

54 
›“80211_suµÜ‹d_bªd
 *
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

55 
boŞ
 
vht
 = 
sbªd
 && sbªd->
vht_ÿp
.
vht_suµÜ‹d
;

56 
u8
 *
pos
 = 
	`skb_put
(
skb
, 10);

58 *
pos
++ = 
WLAN_EID_EXT_CAPABILITY
;

59 *
pos
++ = 8;

60 *
pos
++ = 0x0;

61 *
pos
++ = 0x0;

62 *
pos
++ = 0x0;

63 *
pos
++ = (
chª_sw™ch
 ? 
WLAN_EXT_CAPA4_TDLS_CHAN_SWITCH
 : 0) |

64 (
bufãr_¡a
 ? 
WLAN_EXT_CAPA4_TDLS_BUFFER_STA
 : 0);

65 *
pos
++ = 
WLAN_EXT_CAPA5_TDLS_ENABLED
;

66 *
pos
++ = 0;

67 *
pos
++ = 0;

68 *
pos
++ = (
vht
 && 
wid”_bªd
è? 
WLAN_EXT_CAPA8_TDLS_WIDE_BW_ENABLED
 : 0;

69 
	}
}

71 
u8


72 
	$›“80211_tdls_add_subbªd
(
›“80211_sub_if_d©a
 *
sd©a
,

73 
sk_buff
 *
skb
, 
u16
 
¡¬t
, u16 
’d
,

74 
u16
 
¥acšg
)

76 
u8
 
subbªd_út
 = 0, 
ch_út
 = 0;

77 
›“80211_chªÃl
 *
ch
;

78 
cfg80211_chª_def
 
chªdef
;

79 
i
, 
subbªd_¡¬t
;

80 
why
 *why = 
sd©a
->
loÿl
->
hw
.wiphy;

82 
i
 = 
¡¬t
; i <ğ
’d
; i +ğ
¥acšg
) {

83 ià(!
ch_út
)

84 
subbªd_¡¬t
 = 
i
;

86 
ch
 = 
	`›“80211_g‘_chªÃl
(
sd©a
->
loÿl
->
hw
.
why
, 
i
);

87 ià(
ch
) {

89 
	`cfg80211_chªdef_ü—‹
(&
chªdef
, 
ch
,

90 
NL80211_CHAN_NO_HT
);

91 ià(
	`cfg80211_»g_ÿn_b—cÚ_»Ïx
(
why
, &
chªdef
,

92 
sd©a
->
wdev
.
iáy³
)) {

93 
ch_út
++;

106 ià(
ch_út
) {

107 
u8
 *
pos
 = 
	`skb_put
(
skb
, 2);

108 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
subbªd_¡¬t
);

109 *
pos
++ = 
ch_út
;

111 
subbªd_út
++;

112 
ch_út
 = 0;

117 ià(
ch_út
) {

118 
u8
 *
pos
 = 
	`skb_put
(
skb
, 2);

119 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
subbªd_¡¬t
);

120 *
pos
++ = 
ch_út
;

122 
subbªd_út
++;

125  
subbªd_út
;

126 
	}
}

129 
	$›“80211_tdls_add_suµ_chªÃls
(
›“80211_sub_if_d©a
 *
sd©a
,

130 
sk_buff
 *
skb
)

136 
u8
 
subbªd_út
;

137 
u8
 *
pos
 = 
	`skb_put
(
skb
, 2);

139 *
pos
++ = 
WLAN_EID_SUPPORTED_CHANNELS
;

147 
subbªd_út
 = 
	`›“80211_tdls_add_subbªd
(
sd©a
, 
skb
, 2412, 2472, 5);

150 
subbªd_út
 +ğ
	`›“80211_tdls_add_subbªd
(
sd©a
, 
skb
, 5000, 5825, 20);

153 *
pos
 = 2 * 
subbªd_út
;

154 
	}
}

156 
	$›“80211_tdls_add_İ”_şas£s
(
›“80211_lšk_d©a
 *
lšk
,

157 
sk_buff
 *
skb
)

159 
u8
 *
pos
;

160 
u8
 
İ_şass
;

162 ià(!
	`›“80211_chªdef_to_İ”©šg_şass
(&
lšk
->
cÚf
->
chª»q
.
İ”
,

163 &
İ_şass
))

166 
pos
 = 
	`skb_put
(
skb
, 4);

167 *
pos
++ = 
WLAN_EID_SUPPORTED_REGULATORY_CLASSES
;

168 *
pos
++ = 2;

170 *
pos
++ = 
İ_şass
;

171 *
pos
++ = 
İ_şass
;

172 
	}
}

174 
	$›“80211_tdls_add_bss_cÛx_›
(
sk_buff
 *
skb
)

176 
u8
 *
pos
 = 
	`skb_put
(
skb
, 3);

178 *
pos
++ = 
WLAN_EID_BSS_COEX_2040
;

179 *
pos
++ = 1;

181 *
pos
++ = 
WLAN_BSS_COEX_INFORMATION_REQUEST
;

182 
	}
}

184 
u16
 
	$›“80211_g‘_tdls_¡a_ÿ·b
(
›“80211_lšk_d©a
 *
lšk
,

185 
u16
 
¡©us_code
)

187 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

190 ià(
¡©us_code
 != 0)

193 
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

195 ià(
sbªd
 && sbªd->
bªd
 =ğ
NL80211_BAND_2GHZ
) {

196  
WLAN_CAPABILITY_SHORT_SLOT_TIME
 |

197 
WLAN_CAPABILITY_SHORT_PREAMBLE
;

201 
	}
}

203 
	$›“80211_tdls_add_lšk_›
(
›“80211_lšk_d©a
 *
lšk
,

204 
sk_buff
 *
skb
, cÚ¡ 
u8
 *
³”
,

205 
boŞ
 
š™ŸtÜ
)

207 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

208 
›“80211_tdls_Êk›
 *
Êkid
;

209 cÚ¡ 
u8
 *
š™_addr
, *
r¥_addr
;

211 ià(
š™ŸtÜ
) {

212 
š™_addr
 = 
sd©a
->
vif
.
addr
;

213 
r¥_addr
 = 
³”
;

215 
š™_addr
 = 
³”
;

216 
r¥_addr
 = 
sd©a
->
vif
.
addr
;

219 
Êkid
 = 
	`skb_put
(
skb
, (
›“80211_tdls_Êk›
));

221 
Êkid
->
›_ty³
 = 
WLAN_EID_LINK_ID
;

222 
Êkid
->
›_Ën
 = (
›“80211_tdls_Êk›
) - 2;

224 
	`memıy
(
Êkid
->
bssid
, 
lšk
->
u
.
mgd
.bssid, 
ETH_ALEN
);

225 
	`memıy
(
Êkid
->
š™_¡a
, 
š™_addr
, 
ETH_ALEN
);

226 
	`memıy
(
Êkid
->
»¥_¡a
, 
r¥_addr
, 
ETH_ALEN
);

227 
	}
}

230 
	$›“80211_tdls_add_aid
(
›“80211_sub_if_d©a
 *
sd©a
, 
sk_buff
 *
skb
)

232 
u8
 *
pos
 = 
	`skb_put
(
skb
, 4);

234 *
pos
++ = 
WLAN_EID_AID
;

235 *
pos
++ = 2;

236 
	`put_uÇligÃd_Ë16
(
sd©a
->
vif
.
cfg
.
aid
, 
pos
);

237 
	}
}

240 
›“80211_ac_numb”s
 
	$›“80211_ac_äom_wmm
(
ac
)

242 
ac
) {

244 
	`WARN_ON_ONCE
(1);

245 
çÎthrough
;

247  
IEEE80211_AC_BE
;

249  
IEEE80211_AC_BK
;

251  
IEEE80211_AC_VI
;

253  
IEEE80211_AC_VO
;

255 
	}
}

257 
u8
 
	$›“80211_wmm_aci_aif¢
(
aif¢
, 
boŞ
 
acm
, 
aci
)

259 
u8
 
»t
;

261 
»t
 = 
aif¢
 & 0x0f;

262 ià(
acm
)

263 
»t
 |= 0x10;

264 
»t
 |ğ(
aci
 << 5) & 0x60;

265  
»t
;

266 
	}
}

268 
u8
 
	$›“80211_wmm_ecw
(
u16
 
cw_mš
, u16 
cw_max
)

270  ((
	`og2
(
cw_mš
 + 1) << 0x0) & 0x0f) |

271 ((
	`og2
(
cw_max
 + 1) << 0x4) & 0xf0);

272 
	}
}

274 
	$›“80211_tdls_add_wmm_·¿m_›
(
›“80211_sub_if_d©a
 *
sd©a
,

275 
sk_buff
 *
skb
)

277 
›“80211_wmm_·¿m_›
 *
wmm
;

278 
›“80211_tx_queue_·¿ms
 *
txq
;

279 
i
;

281 
wmm
 = 
	`skb_put_z”o
(
skb
, (*wmm));

283 
wmm
->
–em’t_id
 = 
WLAN_EID_VENDOR_SPECIFIC
;

284 
wmm
->
Ën
 = (*wmm) - 2;

286 
wmm
->
oui
[0] = 0x00;

287 
wmm
->
oui
[1] = 0x50;

288 
wmm
->
oui
[2] = 0xf2;

289 
wmm
->
oui_ty³
 = 2;

290 
wmm
->
oui_subty³
 = 1;

291 
wmm
->
v”siÚ
 = 1;

292 
wmm
->
qos_šfo
 = 0;

298 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++) {

299 
txq
 = &
sd©a
->
deæšk
.
tx_cÚf
[
	`›“80211_ac_äom_wmm
(
i
)];

300 
wmm
->
ac
[
i
].
aci_aif¢
 = 
	`›“80211_wmm_aci_aif¢
(
txq
->
aifs
,

301 
txq
->
acm
, 
i
);

302 
wmm
->
ac
[
i
].
cw
 = 
	`›“80211_wmm_ecw
(
txq
->
cw_mš
,xq->
cw_max
);

303 
wmm
->
ac
[
i
].
txİ_lim™
 = 
	`ıu_to_Ë16
(
txq
->
txİ
);

305 
	}
}

308 
	$›“80211_tdls_chªdef_vht_upg¿de
(
›“80211_sub_if_d©a
 *
sd©a
,

309 
¡a_šfo
 *
¡a
)

312 cÚ¡ 
u16
 
ûÁ”s_80mhz
[] = { 5210, 5290, 5530, 5610, 5690, 5775 };

313 
cfg80211_chª_def
 
uc
 = 
¡a
->
tdls_chªdef
;

314 
Æ80211_chª_width
 
max_width
 =

315 
	`›“80211_¡a_ÿp_chª_bw
(&
¡a
->
deæšk
);

316 
i
;

319 ià(
max_width
 =ğ
NL80211_CHAN_WIDTH_5
 ||

320 
max_width
 =ğ
NL80211_CHAN_WIDTH_10
)

323 ià(
max_width
 > 
NL80211_CHAN_WIDTH_80
)

324 
max_width
 = 
NL80211_CHAN_WIDTH_80
;

326 ià(
uc
.
width
 >ğ
max_width
)

334 
i
 = 0; i < 
	`ARRAY_SIZE
(
ûÁ”s_80mhz
); i++)

335 ià(
	`abs
(
uc
.
chª
->
ûÁ”_äeq
 - 
ûÁ”s_80mhz
[
i
]) <= 30) {

336 
uc
.
ûÁ”_äeq1
 = 
ûÁ”s_80mhz
[
i
];

337 
uc
.
ûÁ”_äeq2
 = 0;

338 
uc
.
width
 = 
NL80211_CHAN_WIDTH_80
;

342 ià(!
uc
.
ûÁ”_äeq1
)

346 
uc
.
width
 > 
max_width
 ||

347 (
uc
.
width
 > 
¡a
->
tdls_chªdef
.width &&

348 !
	`cfg80211_»g_ÿn_b—cÚ_»Ïx
(
sd©a
->
loÿl
->
hw
.
why
, &
uc
,

349 
sd©a
->
wdev
.
iáy³
)))

350 
	`›“80211_chªdef_downg¿de
(&
uc
, 
NULL
);

352 ià(!
	`cfg80211_chªdef_id’tiÿl
(&
uc
, &
¡a
->
tdls_chªdef
)) {

353 
	`tdls_dbg
(
sd©a
, "TDLS ch width upgraded %d -> %d\n",

354 
¡a
->
tdls_chªdef
.
width
, 
uc
.width);

360 
¡a
->
tdls_chªdef
 = 
uc
;

362 
	}
}

365 
	$›“80211_tdls_add_£tup_¡¬t_›s
(
›“80211_lšk_d©a
 *
lšk
,

366 
sk_buff
 *
skb
, cÚ¡ 
u8
 *
³”
,

367 
u8
 
aùiÚ_code
, 
boŞ
 
š™ŸtÜ
,

368 cÚ¡ 
u8
 *
exŒa_›s
, 
size_t
 
exŒa_›s_Ën
)

370 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

371 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

372 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

373 
›“80211_¡a_ht_ÿp
 
ht_ÿp
;

374 
›“80211_¡a_vht_ÿp
 
vht_ÿp
;

375 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
;

376 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
;

377 
¡a_šfo
 *
¡a
 = 
NULL
;

378 
size_t
 
off£t
 = 0, 
noff£t
;

379 
u8
 *
pos
;

381 
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

382 ià(
	`WARN_ON_ONCE
(!
sbªd
))

385 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 0, 0, 0, 
WLAN_EID_SUPP_RATES
);

386 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 0, 0, 0, 
WLAN_EID_EXT_SUPP_RATES
);

387 
	`›“80211_tdls_add_suµ_chªÃls
(
sd©a
, 
skb
);

390 ià(
exŒa_›s_Ën
) {

391 cÚ¡ 
u8
 
befÜe_ext_ÿp
[] = {

392 
WLAN_EID_SUPP_RATES
,

393 
WLAN_EID_COUNTRY
,

394 
WLAN_EID_EXT_SUPP_RATES
,

395 
WLAN_EID_SUPPORTED_CHANNELS
,

396 
WLAN_EID_RSN
,

398 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

399 
befÜe_ext_ÿp
,

400 
	`ARRAY_SIZE
(
befÜe_ext_ÿp
),

401 
off£t
);

402 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

403 
off£t
 = 
noff£t
;

406 
	`›“80211_tdls_add_ext_ÿ·b
(
lšk
, 
skb
);

409 ià(
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
 &&

410 
aùiÚ_code
 !ğ
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
)

411 
	`›“80211_add_wmm_šfo_›
(
	`skb_put
(
skb
, 9), 0);

414 ià(
exŒa_›s_Ën
) {

415 cÚ¡ 
u8
 
befÜe_ht_ÿp
[] = {

416 
WLAN_EID_SUPP_RATES
,

417 
WLAN_EID_COUNTRY
,

418 
WLAN_EID_EXT_SUPP_RATES
,

419 
WLAN_EID_SUPPORTED_CHANNELS
,

420 
WLAN_EID_RSN
,

421 
WLAN_EID_EXT_CAPABILITY
,

422 
WLAN_EID_QOS_CAPA
,

423 
WLAN_EID_FAST_BSS_TRANSITION
,

424 
WLAN_EID_TIMEOUT_INTERVAL
,

425 
WLAN_EID_SUPPORTED_REGULATORY_CLASSES
,

427 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

428 
befÜe_ht_ÿp
,

429 
	`ARRAY_SIZE
(
befÜe_ht_ÿp
),

430 
off£t
);

431 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

432 
off£t
 = 
noff£t
;

436 ià(
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_RESPONSE
) {

437 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
³”
);

438 ià(
	`WARN_ON_ONCE
(!
¡a
))

441 
¡a
->
tdls_chªdef
 = 
lšk
->
cÚf
->
chª»q
.
İ”
;

444 
	`›“80211_tdls_add_İ”_şas£s
(
lšk
, 
skb
);

451 
	`memıy
(&
ht_ÿp
, &
sbªd
->ht_cap, (ht_cap));

453 ià((
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_REQUEST
 ||

454 
aùiÚ_code
 =ğ
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
) &&

455 
ht_ÿp
.
ht_suµÜ‹d
) {

456 
	`›“80211_­¶y_htÿp_ov”rides
(
sd©a
, &
ht_ÿp
);

459 
ht_ÿp
.
ÿp
 |ğ
WLAN_HT_CAP_SM_PS_DISABLED


460 << 
IEEE80211_HT_CAP_SM_PS_SHIFT
;

462 
pos
 = 
	`skb_put
(
skb
, (
›“80211_ht_ÿp
) + 2);

463 
	`›“80211_›_bud_ht_ÿp
(
pos
, &
ht_ÿp
, ht_ÿp.
ÿp
);

464 } ià(
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_RESPONSE
 &&

465 
ht_ÿp
.
ht_suµÜ‹d
 && 
¡a
->¡a.
deæšk
.ht_cap.ht_supported) {

467 
	`memıy
(&
ht_ÿp
, &
¡a
->¡a.
deæšk
.ht_cap, (ht_cap));

469 
pos
 = 
	`skb_put
(
skb
, (
›“80211_ht_ÿp
) + 2);

470 
	`›“80211_›_bud_ht_ÿp
(
pos
, &
ht_ÿp
, ht_ÿp.
ÿp
);

473 ià(
ht_ÿp
.
ht_suµÜ‹d
 &&

474 (
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
))

475 
	`›“80211_tdls_add_bss_cÛx_›
(
skb
);

477 
	`›“80211_tdls_add_lšk_›
(
lšk
, 
skb
, 
³”
, 
š™ŸtÜ
);

480 ià(
exŒa_›s_Ën
) {

481 cÚ¡ 
u8
 
befÜe_vht_ÿp
[] = {

482 
WLAN_EID_SUPP_RATES
,

483 
WLAN_EID_COUNTRY
,

484 
WLAN_EID_EXT_SUPP_RATES
,

485 
WLAN_EID_SUPPORTED_CHANNELS
,

486 
WLAN_EID_RSN
,

487 
WLAN_EID_EXT_CAPABILITY
,

488 
WLAN_EID_QOS_CAPA
,

489 
WLAN_EID_FAST_BSS_TRANSITION
,

490 
WLAN_EID_TIMEOUT_INTERVAL
,

491 
WLAN_EID_SUPPORTED_REGULATORY_CLASSES
,

492 
WLAN_EID_MULTI_BAND
,

494 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

495 
befÜe_vht_ÿp
,

496 
	`ARRAY_SIZE
(
befÜe_vht_ÿp
),

497 
off£t
);

498 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

499 
off£t
 = 
noff£t
;

503 
	`memıy
(&
vht_ÿp
, &
sbªd
->vht_cap, (vht_cap));

504 
he_ÿp
 = 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

505 
eht_ÿp
 = 
	`›“80211_g‘_eht_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

506 ià((
vht_ÿp
.
vht_suµÜ‹d
 || 
he_ÿp
 || 
eht_ÿp
) &&

507 (
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_REQUEST
 ||

508 
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_RESPONSE
))

509 
	`›“80211_tdls_add_aid
(
sd©a
, 
skb
);

512 ià((
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_REQUEST
 ||

513 
aùiÚ_code
 =ğ
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
) &&

514 
vht_ÿp
.
vht_suµÜ‹d
) {

515 
	`›“80211_­¶y_vhtÿp_ov”rides
(
sd©a
, &
vht_ÿp
);

517 
pos
 = 
	`skb_put
(
skb
, (
›“80211_vht_ÿp
) + 2);

518 
	`›“80211_›_bud_vht_ÿp
(
pos
, &
vht_ÿp
, vht_ÿp.
ÿp
);

519 } ià(
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_RESPONSE
 &&

520 
vht_ÿp
.
vht_suµÜ‹d
 && 
¡a
->¡a.
deæšk
.vht_cap.vht_supported) {

522 
	`memıy
(&
vht_ÿp
, &
¡a
->¡a.
deæšk
.vht_cap, (vht_cap));

524 
pos
 = 
	`skb_put
(
skb
, (
›“80211_vht_ÿp
) + 2);

525 
	`›“80211_›_bud_vht_ÿp
(
pos
, &
vht_ÿp
, vht_ÿp.
ÿp
);

531 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_WIDER_BW
))

532 
	`›“80211_tdls_chªdef_vht_upg¿de
(
sd©a
, 
¡a
);

536 ià(
exŒa_›s_Ën
) {

537 cÚ¡ 
u8
 
befÜe_he_ÿp
[] = {

538 
WLAN_EID_EXTENSION
,

539 
WLAN_EID_EXT_FILS_REQ_PARAMS
,

540 
WLAN_EID_AP_CSN
,

542 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

543 
befÜe_he_ÿp
,

544 
	`ARRAY_SIZE
(
befÜe_he_ÿp
),

545 
off£t
);

546 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

547 
off£t
 = 
noff£t
;

551 ià(
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_REQUEST
 ||

552 
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_RESPONSE
 ||

553 
aùiÚ_code
 =ğ
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
) {

554 
	`›“80211_put_he_ÿp
(
skb
, 
sd©a
, 
sbªd
, 
NULL
);

557 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

558 
	`›“80211_put_he_6ghz_ÿp
(
skb
, 
sd©a
, 
lšk
->
smps_mode
);

562 ià(
exŒa_›s_Ën
) {

563 cÚ¡ 
u8
 
befÜe_he_ÿp
[] = {

564 
WLAN_EID_EXTENSION
,

565 
WLAN_EID_EXT_FILS_REQ_PARAMS
,

566 
WLAN_EID_AP_CSN
,

569 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

570 
befÜe_he_ÿp
,

571 
	`ARRAY_SIZE
(
befÜe_he_ÿp
),

572 
off£t
);

573 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

574 
off£t
 = 
noff£t
;

578 ià(
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_REQUEST
 ||

579 
aùiÚ_code
 =ğ
WLAN_TDLS_SETUP_RESPONSE
 ||

580 
aùiÚ_code
 =ğ
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
)

581 
	`›“80211_put_eht_ÿp
(
skb
, 
sd©a
, 
sbªd
, 
NULL
);

584 ià(
exŒa_›s_Ën
) {

585 
noff£t
 = 
exŒa_›s_Ën
;

586 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

589 
	}
}

592 
	$›“80211_tdls_add_£tup_cfm_›s
(
›“80211_lšk_d©a
 *
lšk
,

593 
sk_buff
 *
skb
, cÚ¡ 
u8
 *
³”
,

594 
boŞ
 
š™ŸtÜ
, cÚ¡ 
u8
 *
exŒa_›s
,

595 
size_t
 
exŒa_›s_Ën
)

597 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

598 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

599 
size_t
 
off£t
 = 0, 
noff£t
;

600 
¡a_šfo
 *
¡a
, *
­_¡a
;

601 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

602 
u8
 *
pos
;

604 
sbªd
 = 
	`›“80211_g‘_lšk_sbªd
(
lšk
);

605 ià(
	`WARN_ON_ONCE
(!
sbªd
))

608 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
³”
);

609 
­_¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
vif
.
cfg
.
­_addr
);

611 ià(
	`WARN_ON_ONCE
(!
¡a
 || !
­_¡a
))

614 
¡a
->
tdls_chªdef
 = 
lšk
->
cÚf
->
chª»q
.
İ”
;

617 ià(
exŒa_›s_Ën
) {

618 cÚ¡ 
u8
 
befÜe_qos
[] = {

619 
WLAN_EID_RSN
,

621 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

622 
befÜe_qos
,

623 
	`ARRAY_SIZE
(
befÜe_qos
),

624 
off£t
);

625 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

626 
off£t
 = 
noff£t
;

630 ià(
loÿl
->
hw
.
queues
 >ğ
IEEE80211_NUM_ACS
 && 
¡a
->¡a.
wme
)

631 
	`›“80211_tdls_add_wmm_·¿m_›
(
sd©a
, 
skb
);

634 ià(
exŒa_›s_Ën
) {

635 cÚ¡ 
u8
 
befÜe_ht_İ
[] = {

636 
WLAN_EID_RSN
,

637 
WLAN_EID_QOS_CAPA
,

638 
WLAN_EID_FAST_BSS_TRANSITION
,

639 
WLAN_EID_TIMEOUT_INTERVAL
,

641 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

642 
befÜe_ht_İ
,

643 
	`ARRAY_SIZE
(
befÜe_ht_İ
),

644 
off£t
);

645 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

646 
off£t
 = 
noff£t
;

653 ià(!
­_¡a
->
¡a
.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
 && sta->sta.deflink.ht_cap.ht_supported) {

654 
u16
 
´Ù
 = 
IEEE80211_HT_OP_MODE_PROTECTION_NONHT_MIXED
 |

655 
IEEE80211_HT_OP_MODE_NON_GF_STA_PRSNT
 |

656 
IEEE80211_HT_OP_MODE_NON_HT_STA_PRSNT
;

658 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_ht_İ”©iÚ
));

659 
	`›“80211_›_bud_ht_İ”
(
pos
, &
¡a
->¡a.
deæšk
.
ht_ÿp
,

660 &
lšk
->
cÚf
->
chª»q
.
İ”
, 
´Ù
,

661 
Œue
);

664 
	`›“80211_tdls_add_lšk_›
(
lšk
, 
skb
, 
³”
, 
š™ŸtÜ
);

667 ià(
sbªd
->
bªd
 !ğ
NL80211_BAND_2GHZ
 &&

668 
¡a
->¡a.
deæšk
.
vht_ÿp
.
vht_suµÜ‹d
) {

673 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_WIDER_BW
))

674 
	`›“80211_tdls_chªdef_vht_upg¿de
(
sd©a
, 
¡a
);

676 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_vht_İ”©iÚ
));

677 
	`›“80211_›_bud_vht_İ”
(
pos
, &
¡a
->¡a.
deæšk
.
vht_ÿp
,

678 &
¡a
->
tdls_chªdef
);

682 ià(
exŒa_›s_Ën
) {

683 
noff£t
 = 
exŒa_›s_Ën
;

684 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

686 
	}
}

689 
	$›“80211_tdls_add_chª_sw™ch_»q_›s
(
›“80211_lšk_d©a
 *
lšk
,

690 
sk_buff
 *
skb
, cÚ¡ 
u8
 *
³”
,

691 
boŞ
 
š™ŸtÜ
, cÚ¡ 
u8
 *
exŒa_›s
,

692 
size_t
 
exŒa_›s_Ën
, 
u8
 
İ”_şass
,

693 
cfg80211_chª_def
 *
chªdef
)

695 
›“80211_tdls_d©a
 *
tf
;

696 
size_t
 
off£t
 = 0, 
noff£t
;

698 ià(
	`WARN_ON_ONCE
(!
chªdef
))

701 
tf
 = (*)
skb
->
d©a
;

702 
tf
->
u
.
chª_sw™ch_»q
.
rg‘_chªÃl
 =

703 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
chª
->
ûÁ”_äeq
);

704 
tf
->
u
.
chª_sw™ch_»q
.
İ”_şass
 = oper_class;

706 ià(
exŒa_›s_Ën
) {

707 cÚ¡ 
u8
 
befÜe_Êk›
[] = {

708 
WLAN_EID_SECONDARY_CHANNEL_OFFSET
,

710 
noff£t
 = 
	`›“80211_›_¥l™
(
exŒa_›s
, 
exŒa_›s_Ën
,

711 
befÜe_Êk›
,

712 
	`ARRAY_SIZE
(
befÜe_Êk›
),

713 
off£t
);

714 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

715 
off£t
 = 
noff£t
;

718 
	`›“80211_tdls_add_lšk_›
(
lšk
, 
skb
, 
³”
, 
š™ŸtÜ
);

721 ià(
exŒa_›s_Ën
) {

722 
noff£t
 = 
exŒa_›s_Ën
;

723 
	`skb_put_d©a
(
skb
, 
exŒa_›s
 + 
off£t
, 
noff£t
 - offset);

725 
	}
}

728 
	$›“80211_tdls_add_chª_sw™ch_»¥_›s
(
›“80211_lšk_d©a
 *
lšk
,

729 
sk_buff
 *
skb
, cÚ¡ 
u8
 *
³”
,

730 
u16
 
¡©us_code
, 
boŞ
 
š™ŸtÜ
,

731 cÚ¡ 
u8
 *
exŒa_›s
,

732 
size_t
 
exŒa_›s_Ën
)

734 ià(
¡©us_code
 == 0)

735 
	`›“80211_tdls_add_lšk_›
(
lšk
, 
skb
, 
³”
, 
š™ŸtÜ
);

737 ià(
exŒa_›s_Ën
)

738 
	`skb_put_d©a
(
skb
, 
exŒa_›s
, 
exŒa_›s_Ën
);

739 
	}
}

741 
	$›“80211_tdls_add_›s
(
›“80211_lšk_d©a
 *
lšk
,

742 
sk_buff
 *
skb
, cÚ¡ 
u8
 *
³”
,

743 
u8
 
aùiÚ_code
, 
u16
 
¡©us_code
,

744 
boŞ
 
š™ŸtÜ
, cÚ¡ 
u8
 *
exŒa_›s
,

745 
size_t
 
exŒa_›s_Ën
, 
u8
 
İ”_şass
,

746 
cfg80211_chª_def
 *
chªdef
)

748 
aùiÚ_code
) {

749 
WLAN_TDLS_SETUP_REQUEST
:

750 
WLAN_TDLS_SETUP_RESPONSE
:

751 
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
:

752 ià(
¡©us_code
 == 0)

753 
	`›“80211_tdls_add_£tup_¡¬t_›s
(
lšk
,

754 
skb
, 
³”
,

755 
aùiÚ_code
,

756 
š™ŸtÜ
,

757 
exŒa_›s
,

758 
exŒa_›s_Ën
);

760 
WLAN_TDLS_SETUP_CONFIRM
:

761 ià(
¡©us_code
 == 0)

762 
	`›“80211_tdls_add_£tup_cfm_›s
(
lšk
, 
skb
, 
³”
,

763 
š™ŸtÜ
, 
exŒa_›s
,

764 
exŒa_›s_Ën
);

766 
WLAN_TDLS_TEARDOWN
:

767 
WLAN_TDLS_DISCOVERY_REQUEST
:

768 ià(
exŒa_›s_Ën
)

769 
	`skb_put_d©a
(
skb
, 
exŒa_›s
, 
exŒa_›s_Ën
);

770 ià(
¡©us_code
 =ğ0 || 
aùiÚ_code
 =ğ
WLAN_TDLS_TEARDOWN
)

771 
	`›“80211_tdls_add_lšk_›
(
lšk
, 
skb
,

772 
³”
, 
š™ŸtÜ
);

774 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
:

775 
	`›“80211_tdls_add_chª_sw™ch_»q_›s
(
lšk
, 
skb
, 
³”
,

776 
š™ŸtÜ
, 
exŒa_›s
,

777 
exŒa_›s_Ën
,

778 
İ”_şass
, 
chªdef
);

780 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
:

781 
	`›“80211_tdls_add_chª_sw™ch_»¥_›s
(
lšk
, 
skb
, 
³”
,

782 
¡©us_code
,

783 
š™ŸtÜ
, 
exŒa_›s
,

784 
exŒa_›s_Ën
);

788 
	}
}

791 
	$›“80211_´•_tdls_’ÿp_d©a
(
why
 *why, 
Ãt_deviû
 *
dev
,

792 
›“80211_lšk_d©a
 *
lšk
,

793 cÚ¡ 
u8
 *
³”
, u8 
aùiÚ_code
, u8 
dŸlog_tok’
,

794 
u16
 
¡©us_code
, 
sk_buff
 *
skb
)

796 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

797 
›“80211_tdls_d©a
 *
tf
;

799 
tf
 = 
	`skb_put
(
skb
, 
	`off£tof
(
›“80211_tdls_d©a
, 
u
));

801 
	`memıy
(
tf
->
da
, 
³”
, 
ETH_ALEN
);

802 
	`memıy
(
tf
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

803 
tf
->
‘h”_ty³
 = 
	`ıu_to_be16
(
ETH_P_TDLS
);

804 
tf
->
·ylßd_ty³
 = 
WLAN_TDLS_SNAP_RFTYPE
;

807 
	`skb_£t_ÃtwÜk_h—d”
(
skb
, 
ETH_HLEN
);

809 
aùiÚ_code
) {

810 
WLAN_TDLS_SETUP_REQUEST
:

811 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

812 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_SETUP_REQUEST
;

814 
	`skb_put
(
skb
, (
tf
->
u
.
£tup_»q
));

815 
tf
->
u
.
£tup_»q
.
dŸlog_tok’
 = dialog_token;

816 
tf
->
u
.
£tup_»q
.
ÿ·b™y
 =

817 
	`ıu_to_Ë16
(
	`›“80211_g‘_tdls_¡a_ÿ·b
(
lšk
,

818 
¡©us_code
));

820 
WLAN_TDLS_SETUP_RESPONSE
:

821 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

822 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_SETUP_RESPONSE
;

824 
	`skb_put
(
skb
, (
tf
->
u
.
£tup_»¥
));

825 
tf
->
u
.
£tup_»¥
.
¡©us_code
 = 
	`ıu_to_Ë16
(status_code);

826 
tf
->
u
.
£tup_»¥
.
dŸlog_tok’
 = dialog_token;

827 
tf
->
u
.
£tup_»¥
.
ÿ·b™y
 =

828 
	`ıu_to_Ë16
(
	`›“80211_g‘_tdls_¡a_ÿ·b
(
lšk
,

829 
¡©us_code
));

831 
WLAN_TDLS_SETUP_CONFIRM
:

832 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

833 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_SETUP_CONFIRM
;

835 
	`skb_put
(
skb
, (
tf
->
u
.
£tup_cfm
));

836 
tf
->
u
.
£tup_cfm
.
¡©us_code
 = 
	`ıu_to_Ë16
(status_code);

837 
tf
->
u
.
£tup_cfm
.
dŸlog_tok’
 = dialog_token;

839 
WLAN_TDLS_TEARDOWN
:

840 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

841 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_TEARDOWN
;

843 
	`skb_put
(
skb
, (
tf
->
u
.
‹¬down
));

844 
tf
->
u
.
‹¬down
.
»asÚ_code
 = 
	`ıu_to_Ë16
(
¡©us_code
);

846 
WLAN_TDLS_DISCOVERY_REQUEST
:

847 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

848 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_DISCOVERY_REQUEST
;

850 
	`skb_put
(
skb
, (
tf
->
u
.
discov”_»q
));

851 
tf
->
u
.
discov”_»q
.
dŸlog_tok’
 = dialog_token;

853 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
:

854 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

855 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
;

857 
	`skb_put
(
skb
, (
tf
->
u
.
chª_sw™ch_»q
));

859 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
:

860 
tf
->
ÿ‹gÜy
 = 
WLAN_CATEGORY_TDLS
;

861 
tf
->
aùiÚ_code
 = 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
;

863 
	`skb_put
(
skb
, (
tf
->
u
.
chª_sw™ch_»¥
));

864 
tf
->
u
.
chª_sw™ch_»¥
.
¡©us_code
 = 
	`ıu_to_Ë16
(status_code);

867  -
EINVAL
;

871 
	}
}

874 
	$›“80211_´•_tdls_dœeù
(
why
 *why, 
Ãt_deviû
 *
dev
,

875 cÚ¡ 
u8
 *
³”
, 
›“80211_lšk_d©a
 *
lšk
,

876 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
,

877 
u16
 
¡©us_code
, 
sk_buff
 *
skb
)

879 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

880 
›“80211_mgmt
 *
mgmt
;

882 
mgmt
 = 
	`skb_put_z”o
(
skb
, 24);

883 
	`memıy
(
mgmt
->
da
, 
³”
, 
ETH_ALEN
);

884 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

885 
	`memıy
(
mgmt
->
bssid
, 
lšk
->
u
.
mgd
.bssid, 
ETH_ALEN
);

886 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

887 
IEEE80211_STYPE_ACTION
);

889 
aùiÚ_code
) {

890 
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
:

891 
	`skb_put
(
skb
, 1 + (
mgmt
->
u
.
aùiÚ
.u.
tdls_discov”_»¥
));

892 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
;

893 
mgmt
->
u
.
aùiÚ
.u.
tdls_discov”_»¥
.
aùiÚ_code
 =

894 
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
;

895 
mgmt
->
u
.
aùiÚ
.u.
tdls_discov”_»¥
.
dŸlog_tok’
 =

896 
dŸlog_tok’
;

897 
mgmt
->
u
.
aùiÚ
.u.
tdls_discov”_»¥
.
ÿ·b™y
 =

898 
	`ıu_to_Ë16
(
	`›“80211_g‘_tdls_¡a_ÿ·b
(
lšk
,

899 
¡©us_code
));

902  -
EINVAL
;

906 
	}
}

908 
sk_buff
 *

909 
	$›“80211_tdls_bud_mgmt_·ck‘_d©a
(
›“80211_sub_if_d©a
 *
sd©a
,

910 cÚ¡ 
u8
 *
³”
, 
lšk_id
,

911 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
,

912 
u16
 
¡©us_code
, 
boŞ
 
š™ŸtÜ
,

913 cÚ¡ 
u8
 *
exŒa_›s
, 
size_t
 
exŒa_›s_Ën
,

914 
u8
 
İ”_şass
,

915 
cfg80211_chª_def
 *
chªdef
)

917 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

918 
sk_buff
 *
skb
;

919 
»t
;

920 
›“80211_lšk_d©a
 *
lšk
;

922 
lšk_id
 =†ink_id >= 0 ?†ink_id : 0;

923 
	`rcu_»ad_lock
();

924 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

925 ià(
	`WARN_ON
(!
lšk
))

926 
uÆock
;

928 
skb
 = 
	`Ãtdev_®loc_skb
(
sd©a
->
dev
,

929 
loÿl
->
hw
.
exŒa_tx_h—droom
 +

930 
	`max
((
›“80211_mgmt
),

931 (
›“80211_tdls_d©a
)) +

935 2 + 
	`max
((
›“80211_ht_ÿp
),

936 (
›“80211_ht_İ”©iÚ
)) +

937 2 + 
	`max
((
›“80211_vht_ÿp
),

938 (
›“80211_vht_İ”©iÚ
)) +

939 2 + 1 + (
›“80211_he_ÿp_–em
) +

940 (
›“80211_he_mcs_nss_suµ
) +

941 
IEEE80211_HE_PPE_THRES_MAX_LEN
 +

942 2 + 1 + (
›“80211_he_6ghz_ÿ·
) +

943 2 + 1 + (
›“80211_eht_ÿp_–em
) +

944 (
›“80211_eht_mcs_nss_suµ
) +

945 
IEEE80211_EHT_PPE_THRES_MAX_LEN
 +

950 
exŒa_›s_Ën
 +

951 (
›“80211_tdls_Êk›
));

952 ià(!
skb
)

953 
uÆock
;

955 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

957 
aùiÚ_code
) {

958 
WLAN_TDLS_SETUP_REQUEST
:

959 
WLAN_TDLS_SETUP_RESPONSE
:

960 
WLAN_TDLS_SETUP_CONFIRM
:

961 
WLAN_TDLS_TEARDOWN
:

962 
WLAN_TDLS_DISCOVERY_REQUEST
:

963 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
:

964 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
:

965 
»t
 = 
	`›“80211_´•_tdls_’ÿp_d©a
(
loÿl
->
hw
.
why
,

966 
sd©a
->
dev
, 
lšk
, 
³”
,

967 
aùiÚ_code
, 
dŸlog_tok’
,

968 
¡©us_code
, 
skb
);

970 
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
:

971 
»t
 = 
	`›“80211_´•_tdls_dœeù
(
loÿl
->
hw
.
why
, 
sd©a
->
dev
,

972 
³”
, 
lšk
, 
aùiÚ_code
,

973 
dŸlog_tok’
, 
¡©us_code
,

974 
skb
);

977 
»t
 = -
EOPNOTSUPP
;

981 ià(
»t
 < 0)

982 
ç
;

984 
	`›“80211_tdls_add_›s
(
lšk
, 
skb
, 
³”
, 
aùiÚ_code
, 
¡©us_code
,

985 
š™ŸtÜ
, 
exŒa_›s
, 
exŒa_›s_Ën
, 
İ”_şass
,

986 
chªdef
);

987 
	`rcu_»ad_uÆock
();

988  
skb
;

990 
ç
:

991 
	`dev_kä“_skb
(
skb
);

992 
uÆock
:

993 
	`rcu_»ad_uÆock
();

994  
NULL
;

995 
	}
}

998 
	$›“80211_tdls_´•_mgmt_·ck‘
(
why
 *why, 
Ãt_deviû
 *
dev
,

999 cÚ¡ 
u8
 *
³”
, 
lšk_id
,

1000 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
,

1001 
u16
 
¡©us_code
, 
u32
 
³”_ÿ·b™y
,

1002 
boŞ
 
š™ŸtÜ
, cÚ¡ 
u8
 *
exŒa_›s
,

1003 
size_t
 
exŒa_›s_Ën
, 
u8
 
İ”_şass
,

1004 
cfg80211_chª_def
 *
chªdef
)

1006 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1007 
sk_buff
 *
skb
 = 
NULL
;

1008 
¡a_šfo
 *
¡a
;

1009 
u32
 
æags
 = 0;

1010 
»t
 = 0;

1012 
	`rcu_»ad_lock
();

1013 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
³”
);

1016 
aùiÚ_code
) {

1017 
WLAN_TDLS_SETUP_REQUEST
:

1018 ià(
¡a
) {

1019 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_INITIATOR
);

1020 
¡a
->¡a.
tdls_š™ŸtÜ
 = 
çl£
;

1022 
çÎthrough
;

1023 
WLAN_TDLS_SETUP_CONFIRM
:

1024 
WLAN_TDLS_DISCOVERY_REQUEST
:

1025 
š™ŸtÜ
 = 
Œue
;

1027 
WLAN_TDLS_SETUP_RESPONSE
:

1033 ià(
¡a
) {

1034 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_INITIATOR
);

1035 
¡a
->¡a.
tdls_š™ŸtÜ
 = 
Œue
;

1037 
çÎthrough
;

1038 
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
:

1039 
š™ŸtÜ
 = 
çl£
;

1041 
WLAN_TDLS_TEARDOWN
:

1042 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
:

1043 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
:

1047 
»t
 = -
EOPNOTSUPP
;

1051 ià(
¡a
 && 
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_TDLS_INITIATOR
))

1052 
š™ŸtÜ
 = 
Œue
;

1054 
	`rcu_»ad_uÆock
();

1055 ià(
»t
 < 0)

1056 
ç
;

1058 
skb
 = 
	`›“80211_tdls_bud_mgmt_·ck‘_d©a
(
sd©a
, 
³”
,

1059 
lšk_id
, 
aùiÚ_code
,

1060 
dŸlog_tok’
, 
¡©us_code
,

1061 
š™ŸtÜ
, 
exŒa_›s
,

1062 
exŒa_›s_Ën
, 
İ”_şass
,

1063 
chªdef
);

1064 ià(!
skb
) {

1065 
»t
 = -
EINVAL
;

1066 
ç
;

1069 ià(
aùiÚ_code
 =ğ
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
) {

1070 
	`›“80211_tx_skb_tid
(
sd©a
, 
skb
, 7, 
lšk_id
);

1078 
aùiÚ_code
) {

1079 
WLAN_TDLS_SETUP_REQUEST
:

1080 
WLAN_TDLS_SETUP_RESPONSE
:

1081 
skb
->
´iÜ™y
 = 256 + 2;

1084 
skb
->
´iÜ™y
 = 256 + 5;

1093 ià((
aùiÚ_code
 =ğ
WLAN_TDLS_TEARDOWN
) &&

1094 
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
REPORTS_TX_ACK_STATUS
)) {

1095 
boŞ
 
Œy_»£nd
;

1098 
	`rcu_»ad_lock
();

1099 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
³”
);

1100 
Œy_»£nd
 = 
¡a
 && 
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_TDLS_PEER_AUTH
);

1101 
	`rcu_»ad_uÆock
();

1103 
	`¥š_lock_bh
(&
sd©a
->
u
.
mgd
.
‹¬down_lock
);

1104 ià(
Œy_»£nd
 && !
sd©a
->
u
.
mgd
.
‹¬down_skb
) {

1106 
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
 |

1107 
IEEE80211_TX_INTFL_MLME_CONN_TX
;

1116 
sd©a
->
u
.
mgd
.
‹¬down_skb
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

1117 
sd©a
->
u
.
mgd
.
Üig_‹¬down_skb
 = 
skb
;

1119 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
mgd
.
‹¬down_lock
);

1123 
	`loÿl_bh_di§bË
();

1124 
	`__›“80211_subif_¡¬t_xm™
(
skb
, 
dev
, 
æags
,

1125 
IEEE80211_TX_CTRL_MLO_LINK_UNSPEC
, 
NULL
);

1126 
	`loÿl_bh_’abË
();

1128  
»t
;

1130 
ç
:

1131 
	`dev_kä“_skb
(
skb
);

1132  
»t
;

1133 
	}
}

1136 
	$›“80211_tdls_mgmt_£tup
(
why
 *why, 
Ãt_deviû
 *
dev
,

1137 cÚ¡ 
u8
 *
³”
, 
lšk_id
,

1138 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
,

1139 
u16
 
¡©us_code
, 
u32
 
³”_ÿ·b™y
, 
boŞ
 
š™ŸtÜ
,

1140 cÚ¡ 
u8
 *
exŒa_›s
, 
size_t
 
exŒa_›s_Ën
)

1142 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1143 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1144 
›“80211_smps_mode
 
smps_mode
 =

1145 
sd©a
->
deæšk
.
u
.
mgd
.
driv”_smps_mode
;

1146 
»t
;

1149 ià(
smps_mode
 !ğ
IEEE80211_SMPS_AUTOMATIC
 &&

1150 
smps_mode
 !ğ
IEEE80211_SMPS_OFF
) {

1151 
	`tdls_dbg
(
sd©a
, "Aborting TDLS setup dueo SMPS mode %d\n",

1152 
smps_mode
);

1153  -
EOPNOTSUPP
;

1156 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1159 ià(!
	`is_z”o_‘h”_addr
(
sd©a
->
u
.
mgd
.
tdls_³”
) &&

1160 !
	`‘h”_addr_equ®
(
sd©a
->
u
.
mgd
.
tdls_³”
, 
³”
)) {

1161 
»t
 = -
EBUSY
;

1162 
out_uÆock
;

1172 ià(
¡©us_code
 == 0) {

1173 
	`rcu_»ad_lock
();

1174 ià(!
	`¡a_šfo_g‘
(
sd©a
, 
³”
)) {

1175 
	`rcu_»ad_uÆock
();

1176 
»t
 = -
ENOLINK
;

1177 
out_uÆock
;

1179 
	`rcu_»ad_uÆock
();

1182 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
çl£
);

1183 
	`memıy
(
sd©a
->
u
.
mgd
.
tdls_³”
, 
³”
, 
ETH_ALEN
);

1186 
»t
 = 
	`›“80211_tdls_´•_mgmt_·ck‘
(
why
, 
dev
, 
³”
,

1187 
lšk_id
, 
aùiÚ_code
,

1188 
dŸlog_tok’
, 
¡©us_code
,

1189 
³”_ÿ·b™y
, 
š™ŸtÜ
,

1190 
exŒa_›s
, 
exŒa_›s_Ën
, 0,

1191 
NULL
);

1192 ià(
»t
 < 0) {

1193 
	`‘h_z”o_addr
(
sd©a
->
u
.
mgd
.
tdls_³”
);

1194  
»t
;

1197 
	`why_d–ayed_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1198 &
sd©a
->
u
.
mgd
.
tdls_³”_d–_wÜk
,

1199 
TDLS_PEER_SETUP_TIMEOUT
);

1202 
out_uÆock
:

1203  
»t
;

1204 
	}
}

1207 
	$›“80211_tdls_mgmt_‹¬down
(
why
 *why, 
Ãt_deviû
 *
dev
,

1208 cÚ¡ 
u8
 *
³”
, 
lšk_id
,

1209 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
,

1210 
u16
 
¡©us_code
, 
u32
 
³”_ÿ·b™y
,

1211 
boŞ
 
š™ŸtÜ
, cÚ¡ 
u8
 *
exŒa_›s
,

1212 
size_t
 
exŒa_›s_Ën
)

1214 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1215 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1216 
¡a_šfo
 *
¡a
;

1217 
»t
;

1225 
	`›“80211_¡İ_vif_queues
(
loÿl
, 
sd©a
,

1226 
IEEE80211_QUEUE_STOP_REASON_TDLS_TEARDOWN
);

1227 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
çl£
);

1229 
»t
 = 
	`›“80211_tdls_´•_mgmt_·ck‘
(
why
, 
dev
, 
³”
,

1230 
lšk_id
, 
aùiÚ_code
,

1231 
dŸlog_tok’
, 
¡©us_code
,

1232 
³”_ÿ·b™y
, 
š™ŸtÜ
,

1233 
exŒa_›s
, 
exŒa_›s_Ën
, 0,

1234 
NULL
);

1235 ià(
»t
 < 0)

1236 
	`sd©a_”r
(
sd©a
, "Failed sending TDLSeardown…acket %d\n",

1237 
»t
);

1243 
	`rcu_»ad_lock
();

1244 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
³”
);

1245 ià(
¡a
)

1246 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER_AUTH
);

1247 
	`rcu_»ad_uÆock
();

1249 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

1250 
IEEE80211_QUEUE_STOP_REASON_TDLS_TEARDOWN
);

1253 
	}
}

1255 
	$›“80211_tdls_mgmt
(
why
 *why, 
Ãt_deviû
 *
dev
,

1256 cÚ¡ 
u8
 *
³”
, 
lšk_id
,

1257 
u8
 
aùiÚ_code
, u8 
dŸlog_tok’
, 
u16
 
¡©us_code
,

1258 
u32
 
³”_ÿ·b™y
, 
boŞ
 
š™ŸtÜ
,

1259 cÚ¡ 
u8
 *
exŒa_›s
, 
size_t
 
exŒa_›s_Ën
)

1261 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1262 
»t
;

1264 ià(!(
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_TDLS
))

1265  -
EOPNOTSUPP
;

1268 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 ||

1269 !
sd©a
->
u
.
mgd
.
assocŸ‹d
)

1270  -
EINVAL
;

1272 
aùiÚ_code
) {

1273 
WLAN_TDLS_SETUP_REQUEST
:

1274 
WLAN_TDLS_SETUP_RESPONSE
:

1275 
»t
 = 
	`›“80211_tdls_mgmt_£tup
(
why
, 
dev
, 
³”
,

1276 
lšk_id
, 
aùiÚ_code
,

1277 
dŸlog_tok’
, 
¡©us_code
,

1278 
³”_ÿ·b™y
, 
š™ŸtÜ
,

1279 
exŒa_›s
, 
exŒa_›s_Ën
);

1281 
WLAN_TDLS_TEARDOWN
:

1282 
»t
 = 
	`›“80211_tdls_mgmt_‹¬down
(
why
, 
dev
, 
³”
, 
lšk_id
,

1283 
aùiÚ_code
, 
dŸlog_tok’
,

1284 
¡©us_code
,

1285 
³”_ÿ·b™y
, 
š™ŸtÜ
,

1286 
exŒa_›s
, 
exŒa_›s_Ën
);

1288 
WLAN_TDLS_DISCOVERY_REQUEST
:

1294 
	`drv_mgd_´Ùeù_tdls_discov”
(
sd©a
->
loÿl
, sd©a, 
lšk_id
);

1295 
çÎthrough
;

1296 
WLAN_TDLS_SETUP_CONFIRM
:

1297 
WLAN_PUB_ACTION_TDLS_DISCOVER_RES
:

1299 
»t
 = 
	`›“80211_tdls_´•_mgmt_·ck‘
(
why
, 
dev
, 
³”
,

1300 
lšk_id
, 
aùiÚ_code
,

1301 
dŸlog_tok’
,

1302 
¡©us_code
,

1303 
³”_ÿ·b™y
,

1304 
š™ŸtÜ
, 
exŒa_›s
,

1305 
exŒa_›s_Ën
, 0, 
NULL
);

1308 
»t
 = -
EOPNOTSUPP
;

1312 
	`tdls_dbg
(
sd©a
, "TDLS mgmt‡ction %d…eer %pM†ink_id %d status %d\n",

1313 
aùiÚ_code
, 
³”
, 
lšk_id
, 
»t
);

1314  
»t
;

1315 
	}
}

1317 
	$›e80211_tdls_»ÿlc_chªùx
(
›“80211_sub_if_d©a
 *
sd©a
,

1318 
¡a_šfo
 *
¡a
)

1320 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1321 
›“80211_chªùx_cÚf
 *
cÚf
;

1322 
›“80211_chªùx
 *
ùx
;

1323 
Æ80211_chª_width
 
width
;

1324 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1326 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1328 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
,

1329 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1330 ià(
cÚf
) {

1331 
width
 = 
cÚf
->
def
.width;

1332 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
cÚf
->
def
.
chª
->
bªd
];

1333 
ùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

1334 
	`›“80211_»ÿlc_chªùx_chªty³
(
loÿl
, 
ùx
);

1337 ià(
width
 !ğ
cÚf
->
def
.width && 
¡a
 &&

1338 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_WIDER_BW
)) {

1339 
›“80211_¡a_rx_bªdwidth
 
bw
;

1341 
bw
 = 
	`›“80211_chª_width_to_rx_bw
(
cÚf
->
def
.
width
);

1342 
bw
 = 
	`mš
(bw, 
	`›“80211_¡a_ÿp_rx_bw
(&
¡a
->
deæšk
));

1343 ià(
bw
 !ğ
¡a
->¡a.
deæšk
.
bªdwidth
) {

1344 
¡a
->¡a.
deæšk
.
bªdwidth
 = 
bw
;

1345 
	`¿‹_cÚŒŞ_¿‹_upd©e
(
loÿl
, 
sbªd
, 
¡a
, 0,

1346 
IEEE80211_RC_BW_CHANGED
);

1352 
	`›“80211_»ÿlc_chªùx_chªty³
(
loÿl
, 
ùx
);

1357 
	}
}

1359 
	$›e80211_tdls_have_ht_³”s
(
›“80211_sub_if_d©a
 *
sd©a
)

1361 
¡a_šfo
 *
¡a
;

1362 
boŞ
 
»suÉ
 = 
çl£
;

1364 
	`rcu_»ad_lock
();

1365 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
sd©a
->
loÿl
->
¡a_li¡
, 
li¡
) {

1366 ià(!
¡a
->¡a.
tdls
 || s->
sd©a
 !ğsd©¨|| !¡a->
u¶ßded
 ||

1367 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
) ||

1368 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER_AUTH
) ||

1369 !
¡a
->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
)

1371 
»suÉ
 = 
Œue
;

1374 
	`rcu_»ad_uÆock
();

1376  
»suÉ
;

1377 
	}
}

1380 
	$›e80211_tdls_»ÿlc_ht_´ÙeùiÚ
(
›“80211_sub_if_d©a
 *
sd©a
,

1381 
¡a_šfo
 *
¡a
)

1383 
boŞ
 
tdls_ht
;

1384 
u16
 
´ÙeùiÚ
 = 
IEEE80211_HT_OP_MODE_PROTECTION_NONHT_MIXED
 |

1385 
IEEE80211_HT_OP_MODE_NON_GF_STA_PRSNT
 |

1386 
IEEE80211_HT_OP_MODE_NON_HT_STA_PRSNT
;

1387 
u16
 
İmode
;

1390 ià(
sd©a
->
deæšk
.
u
.
mgd
.
cÚn
.
mode
 >ğ
IEEE80211_CONN_MODE_HT
)

1393 
tdls_ht
 = (
¡a
 && s->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
) ||

1394 
	`›e80211_tdls_have_ht_³”s
(
sd©a
);

1396 
İmode
 = 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
;

1398 ià(
tdls_ht
)

1399 
İmode
 |ğ
´ÙeùiÚ
;

1401 
İmode
 &ğ~
´ÙeùiÚ
;

1403 ià(
İmode
 =ğ
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
)

1406 
sd©a
->
vif
.
bss_cÚf
.
ht_İ”©iÚ_mode
 = 
İmode
;

1407 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, &sd©a->
deæšk
,

1408 
BSS_CHANGED_HT
);

1409 
	}
}

1411 
	$›“80211_tdls_İ”
(
why
 *why, 
Ãt_deviû
 *
dev
,

1412 cÚ¡ 
u8
 *
³”
, 
Æ80211_tdls_İ”©iÚ
 
İ”
)

1414 
¡a_šfo
 *
¡a
;

1415 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1416 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1417 
»t
;

1419 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1421 ià(!(
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_TDLS
))

1422  -
EOPNOTSUPP
;

1424 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

1425  -
EINVAL
;

1427 
İ”
) {

1428 
NL80211_TDLS_ENABLE_LINK
:

1429 
NL80211_TDLS_DISABLE_LINK
:

1431 
NL80211_TDLS_TEARDOWN
:

1432 
NL80211_TDLS_SETUP
:

1433 
NL80211_TDLS_DISCOVERY_REQ
:

1435  -
EOPNOTSUPP
;

1441 
	`tdls_dbg
(
sd©a
, "TDLS o³¸%d…“¸%pM\n", 
İ”
, 
³”
);

1443 
İ”
) {

1444 
NL80211_TDLS_ENABLE_LINK
:

1445 ià(
sd©a
->
vif
.
bss_cÚf
.
c§_aùive
) {

1446 
	`tdls_dbg
(
sd©a
, "TDLS: disallow†ink during CSA\n");

1447  -
EBUSY
;

1450 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
³”
);

1451 ià(!
¡a
)

1452  -
ENOLINK
;

1454 
	`›e80211_tdls_»ÿlc_chªùx
(
sd©a
, 
¡a
);

1455 
	`›e80211_tdls_»ÿlc_ht_´ÙeùiÚ
(
sd©a
, 
¡a
);

1457 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER_AUTH
);

1459 
	`WARN_ON_ONCE
(
	`is_z”o_‘h”_addr
(
sd©a
->
u
.
mgd
.
tdls_³”
) ||

1460 !
	`‘h”_addr_equ®
(
sd©a
->
u
.
mgd
.
tdls_³”
, 
³”
));

1462 
NL80211_TDLS_DISABLE_LINK
:

1473 
	`skËt_kl
(&
loÿl
->
tx_³ndšg_skËt
);

1475 
	`›“80211_æush_queues
(
loÿl
, 
sd©a
, 
çl£
);

1477 
»t
 = 
	`¡a_šfo_de¡roy_addr
(
sd©a
, 
³”
);

1479 
	`›e80211_tdls_»ÿlc_ht_´ÙeùiÚ
(
sd©a
, 
NULL
);

1481 
	`›e80211_tdls_»ÿlc_chªùx
(
sd©a
, 
NULL
);

1482 ià(
»t
)

1483  
»t
;

1486  -
EOPNOTSUPP
;

1489 ià(
	`‘h”_addr_equ®
(
sd©a
->
u
.
mgd
.
tdls_³”
, 
³”
)) {

1490 
	`why_d–ayed_wÜk_ÿnûl
(
sd©a
->
loÿl
->
hw
.
why
,

1491 &
sd©a
->
u
.
mgd
.
tdls_³”_d–_wÜk
);

1492 
	`‘h_z”o_addr
(
sd©a
->
u
.
mgd
.
tdls_³”
);

1495 
	`why_wÜk_queue
(
sd©a
->
loÿl
->
hw
.
why
,

1496 &
sd©a
->
deæšk
.
u
.
mgd
.
»que¡_smps_wÜk
);

1499 
	}
}

1501 
	$›“80211_tdls_İ”_»que¡
(
›“80211_vif
 *
vif
, cÚ¡ 
u8
 *
³”
,

1502 
Æ80211_tdls_İ”©iÚ
 
İ”
,

1503 
u16
 
»asÚ_code
, 
gå_t
 
gå
)

1505 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1507 ià(
vif
->
ty³
 !ğ
NL80211_IFTYPE_STATION
 || !vif->
cfg
.
assoc
) {

1508 
	`sd©a_”r
(
sd©a
, "Discarding TDLS oper %d -‚ot STA or disconnected\n",

1509 
İ”
);

1513 
	`cfg80211_tdls_İ”_»que¡
(
sd©a
->
dev
, 
³”
, 
İ”
, 
»asÚ_code
, 
gå
);

1514 
	}
}

1515 
EXPORT_SYMBOL
(
›“80211_tdls_İ”_»que¡
);

1518 
	$›e80211_tdls_add_ch_sw™ch_timšg
(
u8
 *
buf
, 
u16
 
sw™ch_time
, u16 
sw™ch_timeout
)

1520 
›“80211_ch_sw™ch_timšg
 *
ch_sw
;

1522 *
buf
++ = 
WLAN_EID_CHAN_SWITCH_TIMING
;

1523 *
buf
++ = (
›“80211_ch_sw™ch_timšg
);

1525 
ch_sw
 = (*)
buf
;

1526 
ch_sw
->
sw™ch_time
 = 
	`ıu_to_Ë16
(switch_time);

1527 
ch_sw
->
sw™ch_timeout
 = 
	`ıu_to_Ë16
(switch_timeout);

1528 
	}
}

1531 cÚ¡ 
u8
 *
	$›“80211_tdls_fšd_sw_timšg_›
(
sk_buff
 *
skb
)

1533 
›“80211_tdls_d©a
 *
tf
;

1534 cÚ¡ 
u8
 *
›_¡¬t
;

1541 
tf
 = 
	`cÚš”_of
(
skb
->
d©a
 + 
	`skb_ÃtwÜk_off£t
(skb),

1542 
›“80211_tdls_d©a
, 
·ylßd_ty³
);

1543 
›_¡¬t
 = 
tf
->
u
.
chª_sw™ch_»q
.
v¬ŸbË
;

1544  
	`cfg80211_fšd_›
(
WLAN_EID_CHAN_SWITCH_TIMING
, 
›_¡¬t
,

1545 
skb
->
Ën
 - (
›_¡¬t
 - skb->
d©a
));

1546 
	}
}

1548 
sk_buff
 *

1549 
	$›“80211_tdls_ch_sw_tm¶_g‘
(
¡a_šfo
 *
¡a
, 
u8
 
İ”_şass
,

1550 
cfg80211_chª_def
 *
chªdef
,

1551 
u32
 *
ch_sw_tm_›_off£t
)

1553 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1554 
u8
 
exŒa_›s
[2 + (
›“80211_£c_chª_offs_›
) +

1555 2 + (
›“80211_ch_sw™ch_timšg
)];

1556 
exŒa_›s_Ën
 = 2 + (
›“80211_ch_sw™ch_timšg
);

1557 
u8
 *
pos
 = 
exŒa_›s
;

1558 
sk_buff
 *
skb
;

1559 
lšk_id
 = 
¡a
->¡a.
v®id_lšks
 ? 
	`ffs
(sta->sta.valid_links) - 1 : 0;

1565 ià(
chªdef
->
width
 =ğ
NL80211_CHAN_WIDTH_40
) {

1566 
›“80211_£c_chª_offs_›
 *
£c_chª_›
;

1567 
boŞ
 
ht40¶us
;

1569 *
pos
++ = 
WLAN_EID_SECONDARY_CHANNEL_OFFSET
;

1570 *
pos
++ = (*
£c_chª_›
);

1571 
£c_chª_›
 = (*)
pos
;

1573 
ht40¶us
 = 
	`cfg80211_g‘_chªdef_ty³
(
chªdef
) ==

1574 
NL80211_CHAN_HT40PLUS
;

1575 
£c_chª_›
->
£c_chª_offs
 = 
ht40¶us
 ?

1576 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
 :

1577 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
;

1578 
pos
 +ğ(*
£c_chª_›
);

1580 
exŒa_›s_Ën
 +ğ2 + (
›“80211_£c_chª_offs_›
);

1584 
	`›e80211_tdls_add_ch_sw™ch_timšg
(
pos
, 0, 0);

1586 
skb
 = 
	`›“80211_tdls_bud_mgmt_·ck‘_d©a
(
sd©a
, 
¡a
->¡a.
addr
,

1587 
lšk_id
,

1588 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
,

1589 0, 0, !
¡a
->¡a.
tdls_š™ŸtÜ
,

1590 
exŒa_›s
, 
exŒa_›s_Ën
,

1591 
İ”_şass
, 
chªdef
);

1592 ià(!
skb
)

1593  
NULL
;

1595 
skb
 = 
	`›“80211_bud_d©a_‹m¶©e
(
sd©a
, skb, 0);

1596 ià(
	`IS_ERR
(
skb
)) {

1597 
	`tdls_dbg
(
sd©a
, "Failed building TDLS channel switch frame\n");

1598  
NULL
;

1601 ià(
ch_sw_tm_›_off£t
) {

1602 cÚ¡ 
u8
 *
tm_›
 = 
	`›“80211_tdls_fšd_sw_timšg_›
(
skb
);

1604 ià(!
tm_›
) {

1605 
	`tdls_dbg
(
sd©a
, "No switchiming IE in TDLS switch\n");

1606 
	`dev_kä“_skb_ªy
(
skb
);

1607  
NULL
;

1610 *
ch_sw_tm_›_off£t
 = 
tm_›
 - 
skb
->
d©a
;

1613 
	`tdls_dbg
(
sd©a
,

1615 
¡a
->¡a.
addr
, 
chªdef
->
chª
->
ûÁ”_äeq
, chªdef->
width
);

1616  
skb
;

1617 
	}
}

1620 
	$›“80211_tdls_chªÃl_sw™ch
(
why
 *why, 
Ãt_deviû
 *
dev
,

1621 cÚ¡ 
u8
 *
addr
, u8 
İ”_şass
,

1622 
cfg80211_chª_def
 *
chªdef
)

1624 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1625 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1626 
¡a_šfo
 *
¡a
;

1627 
sk_buff
 *
skb
 = 
NULL
;

1628 
u32
 
ch_sw_tm_›
;

1629 
»t
;

1631 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1633 ià(
chªdef
->
chª
->
äeq_off£t
)

1635  -
EOPNOTSUPP
;

1637 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
addr
);

1638 ià(!
¡a
) {

1639 
	`tdls_dbg
(
sd©a
,

1641 
addr
);

1642 
»t
 = -
ENOENT
;

1643 
out
;

1646 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_CHAN_SWITCH
)) {

1647 
	`tdls_dbg
(
sd©a
, "TDLS channel switch unsupported by %pM\n",

1648 
addr
);

1649 
»t
 = -
EOPNOTSUPP
;

1650 
out
;

1653 
skb
 = 
	`›“80211_tdls_ch_sw_tm¶_g‘
(
¡a
, 
İ”_şass
, 
chªdef
,

1654 &
ch_sw_tm_›
);

1655 ià(!
skb
) {

1656 
»t
 = -
ENOENT
;

1657 
out
;

1660 
»t
 = 
	`drv_tdls_chªÃl_sw™ch
(
loÿl
, 
sd©a
, &
¡a
->¡a, 
İ”_şass
,

1661 
chªdef
, 
skb
, 
ch_sw_tm_›
);

1662 ià(!
»t
)

1663 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_OFF_CHANNEL
);

1665 
out
:

1666 
	`dev_kä“_skb_ªy
(
skb
);

1667  
»t
;

1668 
	}
}

1671 
	$›“80211_tdls_ÿnûl_chªÃl_sw™ch
(
why
 *wiphy,

1672 
Ãt_deviû
 *
dev
,

1673 cÚ¡ 
u8
 *
addr
)

1675 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

1676 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1677 
¡a_šfo
 *
¡a
;

1679 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1681 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
addr
);

1682 ià(!
¡a
) {

1683 
	`tdls_dbg
(
sd©a
,

1685 
addr
);

1689 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_OFF_CHANNEL
)) {

1690 
	`tdls_dbg
(
sd©a
, "TDLS channel switch‚ot initiated by %pM\n",

1691 
addr
);

1695 
	`drv_tdls_ÿnûl_chªÃl_sw™ch
(
loÿl
, 
sd©a
, &
¡a
->sta);

1696 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_OFF_CHANNEL
);

1697 
	}
}

1699 
sk_buff
 *

1700 
	$›“80211_tdls_ch_sw_»¥_tm¶_g‘
(
¡a_šfo
 *
¡a
,

1701 
u32
 *
ch_sw_tm_›_off£t
)

1703 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

1704 
sk_buff
 *
skb
;

1705 
u8
 
exŒa_›s
[2 + (
›“80211_ch_sw™ch_timšg
)];

1706 
lšk_id
 = 
¡a
->¡a.
v®id_lšks
 ? 
	`ffs
(sta->sta.valid_links) - 1 : 0;

1709 
	`›e80211_tdls_add_ch_sw™ch_timšg
(
exŒa_›s
, 0, 0);

1711 
skb
 = 
	`›“80211_tdls_bud_mgmt_·ck‘_d©a
(
sd©a
, 
¡a
->¡a.
addr
,

1712 
lšk_id
,

1713 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
,

1714 0, 0, !
¡a
->¡a.
tdls_š™ŸtÜ
,

1715 
exŒa_›s
, ÓxŒa_›s), 0, 
NULL
);

1716 ià(!
skb
)

1717  
NULL
;

1719 
skb
 = 
	`›“80211_bud_d©a_‹m¶©e
(
sd©a
, skb, 0);

1720 ià(
	`IS_ERR
(
skb
)) {

1721 
	`tdls_dbg
(
sd©a
,

1723  
NULL
;

1726 ià(
ch_sw_tm_›_off£t
) {

1727 cÚ¡ 
u8
 *
tm_›
 = 
	`›“80211_tdls_fšd_sw_timšg_›
(
skb
);

1729 ià(!
tm_›
) {

1730 
	`tdls_dbg
(
sd©a
,

1732 
	`dev_kä“_skb_ªy
(
skb
);

1733  
NULL
;

1736 *
ch_sw_tm_›_off£t
 = 
tm_›
 - 
skb
->
d©a
;

1739 
	`tdls_dbg
(
sd©a
, "TDLS get channel switch„esponseemplate for %pM\n",

1740 
¡a
->¡a.
addr
);

1741  
skb
;

1742 
	}
}

1745 
	$›“80211_´oûss_tdls_chªÃl_sw™ch_»¥
(
›“80211_sub_if_d©a
 *
sd©a
,

1746 
sk_buff
 *
skb
)

1748 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1749 
›“802_11_–ems
 *
–ems
 = 
NULL
;

1750 
¡a_šfo
 *
¡a
;

1751 
›“80211_tdls_d©a
 *
tf
 = (*)
skb
->
d©a
;

1752 
boŞ
 
loÿl_š™ŸtÜ
;

1753 
›“80211_rx_¡©us
 *
rx_¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1754 
ba£Ën
 = 
	`off£tof
(
	`ty³of
(*
tf
), 
u
.
chª_sw™ch_»¥
.
v¬ŸbË
);

1755 
›“80211_tdls_ch_sw_·¿ms
 
·¿ms
 = {};

1756 
»t
;

1758 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1760 
·¿ms
.
aùiÚ_code
 = 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
;

1761 
·¿ms
.
time¡amp
 = 
rx_¡©us
->
deviû_time¡amp
;

1763 ià(
skb
->
Ën
 < 
ba£Ën
) {

1764 
	`tdls_dbg
(
sd©a
, "TDLS channel switch„espoo short: %d\n",

1765 
skb
->
Ën
);

1766  -
EINVAL
;

1769 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
tf
->
§
);

1770 ià(!
¡a
 || !
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_TDLS_PEER_AUTH
)) {

1771 
	`tdls_dbg
(
sd©a
, "TDLS chan switch from‚on-peer sta %pM\n",

1772 
tf
->
§
);

1773 
»t
 = -
EINVAL
;

1774 
out
;

1777 
·¿ms
.
¡a
 = &sta->sta;

1778 
·¿ms
.
¡©us
 = 
	`Ë16_to_ıu
(
tf
->
u
.
chª_sw™ch_»¥
.
¡©us_code
);

1779 ià(
·¿ms
.
¡©us
 != 0) {

1780 
»t
 = 0;

1781 
ÿÎ_drv
;

1784 
–ems
 = 
	`›“802_11_·r£_–ems
(
tf
->
u
.
chª_sw™ch_»¥
.
v¬ŸbË
,

1785 
skb
->
Ën
 - 
ba£Ën
, 
çl£
, 
NULL
);

1786 ià(!
–ems
) {

1787 
»t
 = -
ENOMEM
;

1788 
out
;

1791 ià(
–ems
->
·r£_”rÜ
) {

1792 
	`tdls_dbg
(
sd©a
, "Invalid IEs in TDLS channel switch„esp\n");

1793 
»t
 = -
EINVAL
;

1794 
out
;

1797 ià(!
–ems
->
ch_sw_timšg
 || !–ems->
Êk_id
) {

1798 
	`tdls_dbg
(
sd©a
, "TDLS channel switch„esp - missing IEs\n");

1799 
»t
 = -
EINVAL
;

1800 
out
;

1804 
loÿl_š™ŸtÜ
 =

1805 !
	`memcmp
(
–ems
->
Êk_id
->
š™_¡a
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1806 ià(
loÿl_š™ŸtÜ
 =ğ
¡a
->¡a.
tdls_š™ŸtÜ
) {

1807 
	`tdls_dbg
(
sd©a
, "TDLS chan switch invalid†nk-id initiator\n");

1808 
»t
 = -
EINVAL
;

1809 
out
;

1812 
·¿ms
.
sw™ch_time
 = 
	`Ë16_to_ıu
(
–ems
->
ch_sw_timšg
->switch_time);

1813 
·¿ms
.
sw™ch_timeout
 = 
	`Ë16_to_ıu
(
–ems
->
ch_sw_timšg
->switch_timeout);

1815 
·¿ms
.
tm¶_skb
 =

1816 
	`›“80211_tdls_ch_sw_»¥_tm¶_g‘
(
¡a
, &
·¿ms
.
ch_sw_tm_›
);

1817 ià(!
·¿ms
.
tm¶_skb
) {

1818 
»t
 = -
ENOENT
;

1819 
out
;

1822 
»t
 = 0;

1823 
ÿÎ_drv
:

1824 
	`drv_tdls_»cv_chªÃl_sw™ch
(
sd©a
->
loÿl
, sd©a, &
·¿ms
);

1826 
	`tdls_dbg
(
sd©a
,

1828 
tf
->
§
, 
·¿ms
.
¡©us
);

1830 
out
:

1831 
	`dev_kä“_skb_ªy
(
·¿ms
.
tm¶_skb
);

1832 
	`kä“
(
–ems
);

1833  
»t
;

1834 
	}
}

1837 
	$›“80211_´oûss_tdls_chªÃl_sw™ch_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

1838 
sk_buff
 *
skb
)

1840 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1841 
›“802_11_–ems
 *
–ems
;

1842 
cfg80211_chª_def
 
chªdef
;

1843 
›“80211_chªÃl
 *
chª
;

1844 
Æ80211_chªÃl_ty³
 
chª_ty³
;

1845 
äeq
;

1846 
u8
 
rg‘_chªÃl
, 
İ”_şass
;

1847 
boŞ
 
loÿl_š™ŸtÜ
;

1848 
¡a_šfo
 *
¡a
;

1849 
Æ80211_bªd
 
bªd
;

1850 
›“80211_tdls_d©a
 *
tf
 = (*)
skb
->
d©a
;

1851 
›“80211_rx_¡©us
 *
rx_¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1852 
ba£Ën
 = 
	`off£tof
(
	`ty³of
(*
tf
), 
u
.
chª_sw™ch_»q
.
v¬ŸbË
);

1853 
›“80211_tdls_ch_sw_·¿ms
 
·¿ms
 = {};

1854 
»t
 = 0;

1856 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1858 
·¿ms
.
aùiÚ_code
 = 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
;

1859 
·¿ms
.
time¡amp
 = 
rx_¡©us
->
deviû_time¡amp
;

1861 ià(
skb
->
Ën
 < 
ba£Ën
) {

1862 
	`tdls_dbg
(
sd©a
, "TDLS channel switch„eqoo short: %d\n",

1863 
skb
->
Ën
);

1864  -
EINVAL
;

1867 
rg‘_chªÃl
 = 
tf
->
u
.
chª_sw™ch_»q
.target_channel;

1868 
İ”_şass
 = 
tf
->
u
.
chª_sw™ch_»q
.oper_class;

1880 ià((
İ”_şass
 == 112 || oper_class == 2 || oper_class == 3 ||

1881 
İ”_şass
 == 4 || oper_class == 5 || oper_class == 6) &&

1882 
rg‘_chªÃl
 < 14)

1883 
bªd
 = 
NL80211_BAND_5GHZ
;

1885 
bªd
 = 
rg‘_chªÃl
 < 14 ? 
NL80211_BAND_2GHZ
 :

1886 
NL80211_BAND_5GHZ
;

1888 
äeq
 = 
	`›“80211_chªÃl_to_äequ’cy
(
rg‘_chªÃl
, 
bªd
);

1889 ià(
äeq
 == 0) {

1890 
	`tdls_dbg
(
sd©a
, "Invalid channel in TDLS chan switch: %d\n",

1891 
rg‘_chªÃl
);

1892  -
EINVAL
;

1895 
chª
 = 
	`›“80211_g‘_chªÃl
(
sd©a
->
loÿl
->
hw
.
why
, 
äeq
);

1896 ià(!
chª
) {

1897 
	`tdls_dbg
(
sd©a
,

1899 
rg‘_chªÃl
);

1900  -
EINVAL
;

1903 
–ems
 = 
	`›“802_11_·r£_–ems
(
tf
->
u
.
chª_sw™ch_»q
.
v¬ŸbË
,

1904 
skb
->
Ën
 - 
ba£Ën
, 
çl£
, 
NULL
);

1905 ià(!
–ems
)

1906  -
ENOMEM
;

1908 ià(
–ems
->
·r£_”rÜ
) {

1909 
	`tdls_dbg
(
sd©a
, "Invalid IEs in TDLS channel switch„eq\n");

1910 
»t
 = -
EINVAL
;

1911 
ä“
;

1914 ià(!
–ems
->
ch_sw_timšg
 || !–ems->
Êk_id
) {

1915 
	`tdls_dbg
(
sd©a
, "TDLS channel switch„eq - missing IEs\n");

1916 
»t
 = -
EINVAL
;

1917 
ä“
;

1920 ià(!
–ems
->
£c_chª_offs
) {

1921 
chª_ty³
 = 
NL80211_CHAN_HT20
;

1923 
–ems
->
£c_chª_offs
->sec_chan_offs) {

1924 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
:

1925 
chª_ty³
 = 
NL80211_CHAN_HT40PLUS
;

1927 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
:

1928 
chª_ty³
 = 
NL80211_CHAN_HT40MINUS
;

1931 
chª_ty³
 = 
NL80211_CHAN_HT20
;

1936 
	`cfg80211_chªdef_ü—‹
(&
chªdef
, 
chª
, 
chª_ty³
);

1939 ià(!
	`cfg80211_»g_ÿn_b—cÚ_»Ïx
(
sd©a
->
loÿl
->
hw
.
why
, &
chªdef
,

1940 
sd©a
->
wdev
.
iáy³
)) {

1941 
	`tdls_dbg
(
sd©a
, "TDLS chan switcho forbidden channel\n");

1942 
»t
 = -
EINVAL
;

1943 
ä“
;

1946 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
tf
->
§
);

1947 ià(!
¡a
 || !
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_TDLS_PEER_AUTH
)) {

1948 
	`tdls_dbg
(
sd©a
, "TDLS chan switch from‚on-peer sta %pM\n",

1949 
tf
->
§
);

1950 
»t
 = -
EINVAL
;

1951 
out
;

1954 
·¿ms
.
¡a
 = &sta->sta;

1957 
loÿl_š™ŸtÜ
 =

1958 !
	`memcmp
(
–ems
->
Êk_id
->
š™_¡a
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1959 ià(
loÿl_š™ŸtÜ
 =ğ
¡a
->¡a.
tdls_š™ŸtÜ
) {

1960 
	`tdls_dbg
(
sd©a
, "TDLS chan switch invalid†nk-id initiator\n");

1961 
»t
 = -
EINVAL
;

1962 
out
;

1966 ià(!
¡a
->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
 && 
–ems
->
£c_chª_offs
 &&

1967 
–ems
->
£c_chª_offs
->sec_chan_offs) {

1968 
	`tdls_dbg
(
sd©a
, "TDLS chan switch - wide chan unsupported\n");

1969 
»t
 = -
EOPNOTSUPP
;

1970 
out
;

1973 
·¿ms
.
chªdef
 = &chandef;

1974 
·¿ms
.
sw™ch_time
 = 
	`Ë16_to_ıu
(
–ems
->
ch_sw_timšg
->switch_time);

1975 
·¿ms
.
sw™ch_timeout
 = 
	`Ë16_to_ıu
(
–ems
->
ch_sw_timšg
->switch_timeout);

1977 
·¿ms
.
tm¶_skb
 =

1978 
	`›“80211_tdls_ch_sw_»¥_tm¶_g‘
(
¡a
,

1979 &
·¿ms
.
ch_sw_tm_›
);

1980 ià(!
·¿ms
.
tm¶_skb
) {

1981 
»t
 = -
ENOENT
;

1982 
out
;

1985 
	`drv_tdls_»cv_chªÃl_sw™ch
(
sd©a
->
loÿl
, sd©a, &
·¿ms
);

1987 
	`tdls_dbg
(
sd©a
,

1989 
tf
->
§
, 
·¿ms
.
chªdef
->
chª
->
ûÁ”_äeq
,

1990 
·¿ms
.
chªdef
->
width
);

1991 
out
:

1992 
	`dev_kä“_skb_ªy
(
·¿ms
.
tm¶_skb
);

1993 
ä“
:

1994 
	`kä“
(
–ems
);

1995  
»t
;

1996 
	}
}

1999 
	$›“80211_´oûss_tdls_chªÃl_sw™ch
(
›“80211_sub_if_d©a
 *
sd©a
,

2000 
sk_buff
 *
skb
)

2002 
›“80211_tdls_d©a
 *
tf
 = (*)
skb
->
d©a
;

2003 
why
 *why = 
sd©a
->
loÿl
->
hw
.wiphy;

2005 
	`lockd•_as£¹_why
(
why
);

2008 ià(!(
why
->
ã©u»s
 & 
NL80211_FEATURE_TDLS_CHANNEL_SWITCH
))

2012 ià(
	`skb_lš—rize
(
skb
))

2018 
tf
->
aùiÚ_code
) {

2019 
WLAN_TDLS_CHANNEL_SWITCH_REQUEST
:

2020 
	`›“80211_´oûss_tdls_chªÃl_sw™ch_»q
(
sd©a
, 
skb
);

2022 
WLAN_TDLS_CHANNEL_SWITCH_RESPONSE
:

2023 
	`›“80211_´oûss_tdls_chªÃl_sw™ch_»¥
(
sd©a
, 
skb
);

2026 
	`WARN_ON_ONCE
(1);

2029 
	}
}

2031 
	$›“80211_‹¬down_tdls_³”s
(
›“80211_lšk_d©a
 *
lšk
)

2033 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

2034 
¡a_šfo
 *
¡a
;

2035 
u16
 
»asÚ
 = 
WLAN_REASON_TDLS_TEARDOWN_UNSPECIFIED
;

2037 
	`rcu_»ad_lock
();

2038 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
sd©a
->
loÿl
->
¡a_li¡
, 
li¡
) {

2039 ià(!
¡a
->¡a.
tdls
 || s->
sd©a
 !ğsd©¨|| !¡a->
u¶ßded
 ||

2040 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
))

2043 ià(
¡a
->
deæšk
.
lšk_id
 !ğ
lšk
->link_id)

2046 
	`›“80211_tdls_İ”_»que¡
(&
sd©a
->
vif
, 
¡a
->¡a.
addr
,

2047 
NL80211_TDLS_TEARDOWN
, 
»asÚ
,

2048 
GFP_ATOMIC
);

2050 
	`rcu_»ad_uÆock
();

2051 
	}
}

2053 
	$›“80211_tdls_hªdË_discÚÃù
(
›“80211_sub_if_d©a
 *
sd©a
,

2054 cÚ¡ 
u8
 *
³”
, 
u16
 
»asÚ
)

2056 
›“80211_¡a
 *
¡a
;

2058 
	`rcu_»ad_lock
();

2059 
¡a
 = 
	`›“80211_fšd_¡a
(&
sd©a
->
vif
, 
³”
);

2060 ià(!
¡a
 || !¡a->
tdls
) {

2061 
	`rcu_»ad_uÆock
();

2064 
	`rcu_»ad_uÆock
();

2066 
	`tdls_dbg
(
sd©a
, "disconnected from TDLS…eer %pM (Reason: %u=%s)\n",

2067 
³”
, 
»asÚ
,

2068 
	`›“80211_g‘_»asÚ_code_¡ršg
(
»asÚ
));

2070 
	`›“80211_tdls_İ”_»que¡
(&
sd©a
->
vif
, 
³”
,

2071 
NL80211_TDLS_TEARDOWN
,

2072 
WLAN_REASON_TDLS_TEARDOWN_UNREACHABLE
,

2073 
GFP_ATOMIC
);

2074 
	}
}

	@tests/elems.c

7 
	~<kun™/‹¡.h
>

8 
	~"../›“80211_i.h
"

10 
MODULE_IMPORT_NS
(
EXPORTED_FOR_KUNIT_TESTING
);

12 
	$mË_deäag
(
kun™
 *
‹¡
)

14 
›“80211_–ems_·r£_·¿ms
 
·r£_·¿ms
 = {

15 .
lšk_id
 = 12,

16 .
äom_­
 = 
Œue
,

17 .
mode
 = 
IEEE80211_CONN_MODE_EHT
,

19 
›“802_11_–ems
 *
·r£d
;

20 
sk_buff
 *
skb
;

21 
u8
 *
Ën_mË
, *
Ën_´of
;

22 
i
;

24 
skb
 = 
	`®loc_skb
(1024, 
GFP_KERNEL
);

25 
	`KUNIT_ASSERT_NOT_NULL
(
‹¡
, 
skb
);

27 ià(
	`skb_·d
(
skb
, 
	`skb_room
(skb))) {

28 
	`KUNIT_FAIL
(
‹¡
, "failedo…ad skb");

33 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXTENSION
);

34 
Ën_mË
 = 
	`skb_put
(
skb
, 1);

35 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXT_EHT_MULTI_LINK
);

37 
	`put_uÇligÃd_Ë16
(
IEEE80211_ML_CONTROL_TYPE_BASIC
,

38 
	`skb_put
(
skb
, 2));

40 
	`skb_put_u8
(
skb
, 7);

41 
	`skb_put_d©a
(
skb
, "\x00\x00\x00\x00\x00\x00", 
ETH_ALEN
);

44 
	`skb_put_u8
(
skb
, 
IEEE80211_MLE_SUBELEM_PER_STA_PROFILE
);

45 
Ën_´of
 = 
	`skb_put
(
skb
, 1);

46 
	`put_uÇligÃd_Ë16
(
IEEE80211_MLE_STA_CONTROL_COMPLETE_PROFILE
 |

47 
·r£_·¿ms
.
lšk_id
,

48 
	`skb_put
(
skb
, 2));

49 
	`skb_put_u8
(
skb
, 1);

51 
i
 = 0; i < 20; i++) {

52 
	`skb_put_u8
(
skb
, 
WLAN_EID_SSID
);

53 
	`skb_put_u8
(
skb
, 20);

54 
	`skb_put
(
skb
, 20);

58 
	`›“80211_äagm’t_–em’t
(
skb
, 
Ën_´of
,

59 
IEEE80211_MLE_SUBELEM_FRAGMENT
);

61 
	`›“80211_äagm’t_–em’t
(
skb
, 
Ën_mË
, 
WLAN_EID_FRAGMENT
);

63 
·r£_·¿ms
.
¡¬t
 = 
skb
->
d©a
;

64 
·r£_·¿ms
.
Ën
 = 
skb
->len;

65 
·r£d
 = 
	`›“802_11_·r£_–ems_fuÎ
(&
·r£_·¿ms
);

67 
	`KUNIT_EXPECT_NOT_NULL
(
‹¡
, 
·r£d
);

69 ià(
	`IS_ERR_OR_NULL
(
·r£d
))

70 
ä“_skb
;

72 
	`KUNIT_EXPECT_NOT_NULL
(
‹¡
, 
·r£d
->
ml_basic
);

73 
	`KUNIT_EXPECT_EQ
(
‹¡
,

74 
·r£d
->
ml_basic_Ën
,

81 
	`KUNIT_EXPECT_NOT_NULL
(
‹¡
, 
·r£d
->
´of
);

82 
	`KUNIT_EXPECT_EQ
(
‹¡
,

83 
·r£d
->
¡a_´of_Ën
,

87 
	`kä“
(
·r£d
);

88 
ä“_skb
:

89 
	`kä“_skb
(
skb
);

90 
	}
}

92 
kun™_ÿ£
 
	g–em’t_·rsšg_‹¡_ÿ£s
[] = {

93 
KUNIT_CASE
(
mË_deäag
),

97 
kun™_su™e
 
	g–em’t_·rsšg
 = {

98 .
Çme
 = "mac80211-element-parsing",

99 .
	g‹¡_ÿ£s
 = 
–em’t_·rsšg_‹¡_ÿ£s
,

102 
kun™_‹¡_su™e
(
–em’t_·rsšg
);

	@tests/mfp.c

7 
	~<kun™/‹¡.h
>

8 
	~<kun™/skbuff.h
>

9 
	~"../›“80211_i.h
"

10 
	~"../¡a_šfo.h
"

12 
MODULE_IMPORT_NS
(
EXPORTED_FOR_KUNIT_TESTING
);

14 cÚ¡ 
	små_‹¡_ÿ£
 {

15 cÚ¡ *
	mdesc
;

16 
boŞ
 
	m¡a
, 
	mmå
, 
	mdeüy±ed
, 
	muniÿ¡
, 
	massoc
;

17 
u8
 
	mÿ‹gÜy
;

18 
u8
 
	m¡y³
;

19 
u8
 
	maùiÚ
;

20 
›“80211_rx_»suÉ
 
	m»suÉ
;

21 } 
	gacû±_må_ÿ£s
[] = {

24 .
desc
 = "public‡ction:‡ccept unicast from unknown…eer",

25 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

26 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
,

27 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

28 .
	guniÿ¡
 = 
Œue
,

29 .
	g»suÉ
 = 
RX_CONTINUE
,

32 .
	gdesc
 = "public‡ction:‡ccept multicast from unknown…eer",

33 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

34 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
,

35 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

36 .
	guniÿ¡
 = 
çl£
,

37 .
	g»suÉ
 = 
RX_CONTINUE
,

40 .
	gdesc
 = "public‡ction:‡ccept unicast without MFP",

41 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

42 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
,

43 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

44 .
	guniÿ¡
 = 
Œue
,

45 .
	g¡a
 = 
Œue
,

46 .
	g»suÉ
 = 
RX_CONTINUE
,

49 .
	gdesc
 = "public‡ction:‡ccept multicast without MFP",

50 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

51 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
,

52 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

53 .
	guniÿ¡
 = 
çl£
,

54 .
	g¡a
 = 
Œue
,

55 .
	g»suÉ
 = 
RX_CONTINUE
,

58 .
	gdesc
 = "public‡ction: drop unicast with MFP",

59 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

60 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
,

61 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

62 .
	guniÿ¡
 = 
Œue
,

63 .
	g¡a
 = 
Œue
,

64 .
	gmå
 = 
Œue
,

65 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_UNICAST_PUB_ACTION
,

68 .
	gdesc
 = "public‡ction:‡ccept multicast with MFP",

69 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

70 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PUBLIC
,

71 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

72 .
	guniÿ¡
 = 
çl£
,

73 .
	g¡a
 = 
Œue
,

74 .
	gmå
 = 
Œue
,

75 .
	g»suÉ
 = 
RX_CONTINUE
,

79 .
	gdesc
 = "protected dual: drop unicast from unknown…eer",

80 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

81 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

82 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

83 .
	guniÿ¡
 = 
Œue
,

84 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_DUAL
,

87 .
	gdesc
 = "protected dual: drop multicast from unknown…eer",

88 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

89 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

90 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

91 .
	guniÿ¡
 = 
çl£
,

92 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_DUAL
,

95 .
	gdesc
 = "protected dual: drop unicast without MFP",

96 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

97 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

98 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

99 .
	guniÿ¡
 = 
Œue
,

100 .
	g¡a
 = 
Œue
,

101 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_DUAL
,

104 .
	gdesc
 = "protected dual: drop multicast without MFP",

105 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

106 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

107 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

108 .
	guniÿ¡
 = 
çl£
,

109 .
	g¡a
 = 
Œue
,

110 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_DUAL
,

113 .
	gdesc
 = "protected dual: drop undecrypted unicast with MFP",

114 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

115 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

116 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

117 .
	guniÿ¡
 = 
Œue
,

118 .
	g¡a
 = 
Œue
,

119 .
	gmå
 = 
Œue
,

120 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_DUAL
,

123 .
	gdesc
 = "protected dual: drop undecrypted multicast with MFP",

124 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

125 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

126 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

127 .
	guniÿ¡
 = 
çl£
,

128 .
	g¡a
 = 
Œue
,

129 .
	gmå
 = 
Œue
,

130 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_DUAL
,

133 .
	gdesc
 = "protected dual:‡ccept unicast with MFP",

134 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

135 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

136 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

137 .
	gdeüy±ed
 = 
Œue
,

138 .
	guniÿ¡
 = 
Œue
,

139 .
	g¡a
 = 
Œue
,

140 .
	gmå
 = 
Œue
,

141 .
	g»suÉ
 = 
RX_CONTINUE
,

144 .
	gdesc
 = "protected dual:‡ccept multicast with MFP",

145 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

146 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_PROTECTED_DUAL_OF_ACTION
,

147 .
	gaùiÚ
 = 
WLAN_PUB_ACTION_DSE_ENABLEMENT
,

148 .
	gdeüy±ed
 = 
Œue
,

149 .
	guniÿ¡
 = 
çl£
,

150 .
	g¡a
 = 
Œue
,

151 .
	gmå
 = 
Œue
,

152 .
	g»suÉ
 = 
RX_CONTINUE
,

156 .
	gdesc
 = "deauth:‡ccept unicast with MFP but w/o key",

157 .
	g¡y³
 = 
IEEE80211_STYPE_DEAUTH
,

158 .
	g¡a
 = 
Œue
,

159 .
	gmå
 = 
Œue
,

160 .
	guniÿ¡
 = 
Œue
,

161 .
	g»suÉ
 = 
RX_CONTINUE
,

164 .
	gdesc
 = "disassoc:‡ccept unicast with MFP but w/o key",

165 .
	g¡y³
 = 
IEEE80211_STYPE_DEAUTH
,

166 .
	g¡a
 = 
Œue
,

167 .
	gmå
 = 
Œue
,

168 .
	guniÿ¡
 = 
Œue
,

169 .
	g»suÉ
 = 
RX_CONTINUE
,

173 .
	gdesc
 = "BA‡ction: drop unicast before‡ssoc",

174 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

175 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
,

176 .
	guniÿ¡
 = 
Œue
,

177 .
	g¡a
 = 
Œue
,

178 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_ROBUST_ACTION
,

181 .
	gdesc
 = "BA‡ction: drop unprotected‡fter‡ssoc",

182 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

183 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
,

184 .
	guniÿ¡
 = 
Œue
,

185 .
	g¡a
 = 
Œue
,

186 .
	gmå
 = 
Œue
,

187 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_UCAST_MGMT
,

190 .
	gdesc
 = "BA‡ction:‡ccept unprotected without MFP",

191 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

192 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
,

193 .
	guniÿ¡
 = 
Œue
,

194 .
	g¡a
 = 
Œue
,

195 .
	gassoc
 = 
Œue
,

196 .
	gmå
 = 
çl£
,

197 .
	g»suÉ
 = 
RX_CONTINUE
,

200 .
	gdesc
 = "BA‡ction: drop unprotected with MFP",

201 .
	g¡y³
 = 
IEEE80211_STYPE_ACTION
,

202 .
	gÿ‹gÜy
 = 
WLAN_CATEGORY_BACK
,

203 .
	guniÿ¡
 = 
Œue
,

204 .
	g¡a
 = 
Œue
,

205 .
	gmå
 = 
Œue
,

206 .
	g»suÉ
 = 
RX_DROP_U_UNPROT_UCAST_MGMT
,

210 
KUNIT_ARRAY_PARAM_DESC
(
acû±_må
, 
acû±_må_ÿ£s
, 
desc
);

212 
	$acû±_må
(
kun™
 *
‹¡
)

214 
¡a_šfo
 
¡a
;

215 cÚ¡ 
må_‹¡_ÿ£
 *
·¿ms
 = 
‹¡
->
·¿m_v®ue
;

216 
›“80211_rx_d©a
 
rx
 = {

217 .
¡a
 = 
·¿ms
->¡¨? &¡¨: 
NULL
,

219 
›“80211_rx_¡©us
 *
¡©us
;

220 
›“80211_hdr_3addr
 
hdr
 = {

221 .
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

222 
·¿ms
->
¡y³
),

223 .
addr1
 = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },

224 .
addr2
 = { 0x12, 0x22, 0x33, 0x44, 0x55, 0x66 },

228 
	`mem£t
(&
¡a
, 0, (sta));

230 ià(!
·¿ms
->
¡a
) {

231 
	`KUNIT_ASSERT_FALSE
(
‹¡
, 
·¿ms
->
må
);

232 
	`KUNIT_ASSERT_FALSE
(
‹¡
, 
·¿ms
->
deüy±ed
);

235 ià(
·¿ms
->
må
)

236 
	`£t_¡a_æag
(&
¡a
, 
WLAN_STA_MFP
);

238 ià(
·¿ms
->
assoc
)

239 
	`£t_b™
(
WLAN_STA_ASSOC
, &
¡a
.
_æags
);

241 
rx
.
skb
 = 
	`kun™_z®loc_skb
(
‹¡
, 128, 
GFP_KERNEL
);

242 
	`KUNIT_ASSERT_NOT_NULL
(
‹¡
, 
rx
.
skb
);

243 
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
rx
.
skb
);

245 ià(
·¿ms
->
deüy±ed
) {

246 
¡©us
->
æag
 |ğ
RX_FLAG_DECRYPTED
;

247 ià(
·¿ms
->
uniÿ¡
)

248 
hdr
.
äame_cÚŒŞ
 |=

249 
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

252 ià(
·¿ms
->
uniÿ¡
)

253 
hdr
.
addr1
[0] = 0x02;

255 
	`skb_put_d©a
(
rx
.
skb
, &
hdr
, (hdr));

257 
·¿ms
->
¡y³
) {

258 
IEEE80211_STYPE_ACTION
:

259 
	`skb_put_u8
(
rx
.
skb
, 
·¿ms
->
ÿ‹gÜy
);

260 
	`skb_put_u8
(
rx
.
skb
, 
·¿ms
->
aùiÚ
);

262 
IEEE80211_STYPE_DEAUTH
:

263 
IEEE80211_STYPE_DISASSOC
: {

264 
__Ë16
 
»asÚ
 = 
	`ıu_to_Ë16
(
WLAN_REASON_UNSPECIFIED
);

266 
	`skb_put_d©a
(
rx
.
skb
, &
»asÚ
, (reason));

271 
	`KUNIT_EXPECT_EQ
(
‹¡
,

272 (
__fÜû
 
u32
)
	`›“80211_drİ_uÃnüy±ed_mgmt
(&
rx
),

273 (
__fÜû
 
u32
)
·¿ms
->
»suÉ
);

274 
	}
}

276 
kun™_ÿ£
 
	gmå_‹¡_ÿ£s
[] = {

277 
KUNIT_CASE_PARAM
(
acû±_må
, 
acû±_må_g’_·¿ms
),

281 
kun™_su™e
 
	gmå
 = {

282 .
Çme
 = "mac80211-mfp",

283 .
	g‹¡_ÿ£s
 = 
må_‹¡_ÿ£s
,

286 
kun™_‹¡_su™e
(
må
);

	@tests/module.c

7 
	~<lšux/moduË.h
>

9 
MODULE_LICENSE
("GPL");

10 
MODULE_DESCRIPTION
("tests for mac80211");

	@tkip.c

7 
	~<lšux/k”Ãl.h
>

8 
	~<lšux/b™İs.h
>

9 
	~<lšux/ty³s.h
>

10 
	~<lšux/Ãtdeviû.h
>

11 
	~<lšux/expÜt.h
>

12 
	~<asm/uÇligÃd.h
>

14 
	~<Ãt/mac80211.h
>

15 
	~"driv”-İs.h
"

16 
	~"key.h
"

17 
	~"tk.h
"

18 
	~"w•.h
"

20 
	#PHASE1_LOOP_COUNT
 8

	)

26 cÚ¡ 
u16
 
	gtk_sbox
[256] =

62 
u16
 
	$tkS
(
u16
 
v®
)

64  
tk_sbox
[
v®
 & 0xff] ^ 
	`swab16
(tkip_sbox[val >> 8]);

65 
	}
}

67 
u8
 *
	$wr™e_tk_iv
(
u8
 *
pos
, 
u16
 
iv16
)

69 *
pos
++ = 
iv16
 >> 8;

70 *
pos
++ = ((
iv16
 >> 8) | 0x20) & 0x7f;

71 *
pos
++ = 
iv16
 & 0xFF;

72  
pos
;

73 
	}
}

82 
	$tk_mixšg_pha£1
(cÚ¡ 
u8
 *
tk
, 
tk_ùx
 *
ùx
,

83 cÚ¡ 
u8
 *

, 
u32
 
tsc_IV32
)

85 
i
, 
j
;

86 
u16
 *
p1k
 = 
ùx
->p1k;

88 
p1k
[0] = 
tsc_IV32
 & 0xFFFF;

89 
p1k
[1] = 
tsc_IV32
 >> 16;

90 
p1k
[2] = 
	`g‘_uÇligÃd_Ë16
(

 + 0);

91 
p1k
[3] = 
	`g‘_uÇligÃd_Ë16
(

 + 2);

92 
p1k
[4] = 
	`g‘_uÇligÃd_Ë16
(

 + 4);

94 
i
 = 0; i < 
PHASE1_LOOP_COUNT
; i++) {

95 
j
 = 2 * (
i
 & 1);

96 
p1k
[0] +ğ
	`tkS
Õ1k[4] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 0 + 
j
));

97 
p1k
[1] +ğ
	`tkS
Õ1k[0] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 4 + 
j
));

98 
p1k
[2] +ğ
	`tkS
Õ1k[1] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 8 + 
j
));

99 
p1k
[3] +ğ
	`tkS
Õ1k[2] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 12 + 
j
));

100 
p1k
[4] +ğ
	`tkS
Õ1k[3] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 0 + 
j
)è+ 
i
;

102 
ùx
->
¡©e
 = 
TKIP_STATE_PHASE1_DONE
;

103 
ùx
->
p1k_iv32
 = 
tsc_IV32
;

104 
	}
}

106 
	$tk_mixšg_pha£2
(cÚ¡ 
u8
 *
tk
, 
tk_ùx
 *
ùx
,

107 
u16
 
tsc_IV16
, 
u8
 *
rc4key
)

109 
u16
 
µk
[6];

110 cÚ¡ 
u16
 *
p1k
 = 
ùx
->p1k;

111 
i
;

113 
µk
[0] = 
p1k
[0];

114 
µk
[1] = 
p1k
[1];

115 
µk
[2] = 
p1k
[2];

116 
µk
[3] = 
p1k
[3];

117 
µk
[4] = 
p1k
[4];

118 
µk
[5] = 
p1k
[4] + 
tsc_IV16
;

120 
µk
[0] +ğ
	`tkS
Õpk[5] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 0));

121 
µk
[1] +ğ
	`tkS
Õpk[0] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 2));

122 
µk
[2] +ğ
	`tkS
Õpk[1] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 4));

123 
µk
[3] +ğ
	`tkS
Õpk[2] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 6));

124 
µk
[4] +ğ
	`tkS
Õpk[3] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 8));

125 
µk
[5] +ğ
	`tkS
Õpk[4] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 10));

126 
µk
[0] +ğ
	`rÜ16
Õpk[5] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 12), 1);

127 
µk
[1] +ğ
	`rÜ16
Õpk[0] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
 + 14), 1);

128 
µk
[2] +ğ
	`rÜ16
(ppk[1], 1);

129 
µk
[3] +ğ
	`rÜ16
(ppk[2], 1);

130 
µk
[4] +ğ
	`rÜ16
(ppk[3], 1);

131 
µk
[5] +ğ
	`rÜ16
(ppk[4], 1);

133 
rc4key
 = 
	`wr™e_tk_iv
Ôc4key, 
tsc_IV16
);

134 *
rc4key
++ = ((
µk
[5] ^ 
	`g‘_uÇligÃd_Ë16
(
tk
)) >> 1) & 0xFF;

136 
i
 = 0; i < 6; i++)

137 
	`put_uÇligÃd_Ë16
(
µk
[
i
], 
rc4key
 + 2 * i);

138 
	}
}

143 
u8
 *
	$›“80211_tk_add_iv
(
u8
 *
pos
, 
›“80211_key_cÚf
 *
keycÚf
, 
u64
 
²
)

145 
pos
 = 
	`wr™e_tk_iv
Õos, 
	`TKIP_PN_TO_IV16
(
²
));

146 *
pos
++ = (
keycÚf
->
keyidx
 << 6) | (1 << 5) ;

147 
	`put_uÇligÃd_Ë32
(
	`TKIP_PN_TO_IV32
(
²
), 
pos
);

148  
pos
 + 4;

149 
	}
}

150 
EXPORT_SYMBOL_GPL
(
›“80211_tk_add_iv
);

152 
	$›“80211_compu‹_tk_p1k
(
›“80211_key
 *
key
, 
u32
 
iv32
)

154 
›“80211_sub_if_d©a
 *
sd©a
 = 
key
->sdata;

155 
tk_ùx
 *
ùx
 = &
key
->
u
.
tk
.
tx
;

156 cÚ¡ 
u8
 *
tk
 = &
key
->
cÚf
.key[
NL80211_TKIP_DATA_OFFSET_ENCR_KEY
];

158 
	`lockd•_as£¹_h–d
(&
key
->
u
.
tk
.
txlock
);

167 ià(
ùx
->
p1k_iv32
 !ğ
iv32
 || ctx->
¡©e
 =ğ
TKIP_STATE_NOT_INIT
)

168 
	`tk_mixšg_pha£1
(
tk
, 
ùx
, 
sd©a
->
vif
.
addr
, 
iv32
);

169 
	}
}

171 
	$›“80211_g‘_tk_p1k_iv
(
›“80211_key_cÚf
 *
keycÚf
,

172 
u32
 
iv32
, 
u16
 *
p1k
)

174 
›“80211_key
 *
key
 = (ieee80211_key *)

175 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

176 
tk_ùx
 *
ùx
 = &
key
->
u
.
tk
.
tx
;

178 
	`¥š_lock_bh
(&
key
->
u
.
tk
.
txlock
);

179 
	`›“80211_compu‹_tk_p1k
(
key
, 
iv32
);

180 
	`memıy
(
p1k
, 
ùx
->p1k, (ctx->p1k));

181 
	`¥š_uÆock_bh
(&
key
->
u
.
tk
.
txlock
);

182 
	}
}

183 
EXPORT_SYMBOL
(
›“80211_g‘_tk_p1k_iv
);

185 
	$›“80211_g‘_tk_rx_p1k
(
›“80211_key_cÚf
 *
keycÚf
,

186 cÚ¡ 
u8
 *

, 
u32
 
iv32
, 
u16
 *
p1k
)

188 cÚ¡ 
u8
 *
tk
 = &
keycÚf
->
key
[
NL80211_TKIP_DATA_OFFSET_ENCR_KEY
];

189 
tk_ùx
 
ùx
;

191 
	`tk_mixšg_pha£1
(
tk
, &
ùx
, 

, 
iv32
);

192 
	`memıy
(
p1k
, 
ùx
.p1k, (ctx.p1k));

193 
	}
}

194 
EXPORT_SYMBOL
(
›“80211_g‘_tk_rx_p1k
);

196 
	$›“80211_g‘_tk_p2k
(
›“80211_key_cÚf
 *
keycÚf
,

197 
sk_buff
 *
skb
, 
u8
 *
p2k
)

199 
›“80211_key
 *
key
 = (ieee80211_key *)

200 
	`cÚš”_of
(
keycÚf
, 
›“80211_key
, 
cÚf
);

201 cÚ¡ 
u8
 *
tk
 = &
key
->
cÚf
.key[
NL80211_TKIP_DATA_OFFSET_ENCR_KEY
];

202 
tk_ùx
 *
ùx
 = &
key
->
u
.
tk
.
tx
;

203 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

204 cÚ¡ 
u8
 *
d©a
 = (u8 *)
hdr
 + 
	`›“80211_hd¾’
(hdr->
äame_cÚŒŞ
);

205 
u32
 
iv32
 = 
	`g‘_uÇligÃd_Ë32
(&
d©a
[4]);

206 
u16
 
iv16
 = 
d©a
[2] | (data[0] << 8);

208 
	`¥š_lock
(&
key
->
u
.
tk
.
txlock
);

209 
	`›“80211_compu‹_tk_p1k
(
key
, 
iv32
);

210 
	`tk_mixšg_pha£2
(
tk
, 
ùx
, 
iv16
, 
p2k
);

211 
	`¥š_uÆock
(&
key
->
u
.
tk
.
txlock
);

212 
	}
}

213 
EXPORT_SYMBOL
(
›“80211_g‘_tk_p2k
);

222 
	$›“80211_tk_’üy±_d©a
(
¬c4_ùx
 *
ùx
,

223 
›“80211_key
 *
key
,

224 
sk_buff
 *
skb
,

225 
u8
 *
·ylßd
, 
size_t
 
·ylßd_Ën
)

227 
u8
 
rc4key
[16];

229 
	`›“80211_g‘_tk_p2k
(&
key
->
cÚf
, 
skb
, 
rc4key
);

231  
	`›“80211_w•_’üy±_d©a
(
ùx
, 
rc4key
, 16,

232 
·ylßd
, 
·ylßd_Ën
);

233 
	}
}

239 
	$›“80211_tk_deüy±_d©a
(
¬c4_ùx
 *
ùx
,

240 
›“80211_key
 *
key
,

241 
u8
 *
·ylßd
, 
size_t
 
·ylßd_Ën
, u8 *

,

242 
u8
 *
¿
, 
Úly_iv
, 
queue
,

243 
u32
 *
out_iv32
, 
u16
 *
out_iv16
)

245 
u32
 
iv32
;

246 
u32
 
iv16
;

247 
u8
 
rc4key
[16], 
keyid
, *
pos
 = 
·ylßd
;

248 
»s
;

249 cÚ¡ 
u8
 *
tk
 = &
key
->
cÚf
.key[
NL80211_TKIP_DATA_OFFSET_ENCR_KEY
];

250 
tk_ùx_rx
 *
rx_ùx
 = &
key
->
u
.
tk
.
rx
[
queue
];

252 ià(
·ylßd_Ën
 < 12)

255 
iv16
 = (
pos
[0] << 8) |…os[2];

256 
keyid
 = 
pos
[3];

257 
iv32
 = 
	`g‘_uÇligÃd_Ë32
(
pos
 + 4);

258 
pos
 += 8;

260 ià(!(
keyid
 & (1 << 5)))

261  
TKIP_DECRYPT_NO_EXT_IV
;

263 ià((
keyid
 >> 6è!ğ
key
->
cÚf
.
keyidx
)

264  
TKIP_DECRYPT_INVALID_KEYIDX
;

275 ià(
iv32
 < 
rx_ùx
->iv32 ||

276 (
iv32
 =ğ
rx_ùx
->iv32 &&

277 (
iv16
 < 
rx_ùx
->iv16 ||

278 (
iv16
 =ğ
rx_ùx
->iv16 &&

279 (
rx_ùx
->
iv32
 ||„x_ùx->
iv16
 ||

280 
rx_ùx
->
ùx
.
¡©e
 !ğ
TKIP_STATE_NOT_INIT
)))))

281  
TKIP_DECRYPT_REPLAY
;

283 ià(
Úly_iv
) {

284 
»s
 = 
TKIP_DECRYPT_OK
;

285 
rx_ùx
->
ùx
.
¡©e
 = 
TKIP_STATE_PHASE1_HW_UPLOADED
;

286 
dÚe
;

289 ià(
rx_ùx
->
ùx
.
¡©e
 =ğ
TKIP_STATE_NOT_INIT
 ||

290 
rx_ùx
->
iv32
 != iv32) {

292 
	`tk_mixšg_pha£1
(
tk
, &
rx_ùx
->
ùx
, 

, 
iv32
);

294 ià(
key
->
loÿl
->
İs
->
upd©e_tk_key
 &&

295 
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
 &&

296 
rx_ùx
->
ùx
.
¡©e
 !ğ
TKIP_STATE_PHASE1_HW_UPLOADED
) {

297 
›“80211_sub_if_d©a
 *
sd©a
 = 
key
->sdata;

299 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

300 
sd©a
 = 
	`cÚš”_of
(
key
->sd©a->
bss
,

301 
›“80211_sub_if_d©a
, 
u
.
­
);

302 
	`drv_upd©e_tk_key
(
key
->
loÿl
, 
sd©a
, &key->
cÚf
, key->
¡a
,

303 
iv32
, 
rx_ùx
->
ùx
.
p1k
);

304 
rx_ùx
->
ùx
.
¡©e
 = 
TKIP_STATE_PHASE1_HW_UPLOADED
;

307 
	`tk_mixšg_pha£2
(
tk
, &
rx_ùx
->
ùx
, 
iv16
, 
rc4key
);

309 
»s
 = 
	`›“80211_w•_deüy±_d©a
(
ùx
, 
rc4key
, 16, 
pos
, 
·ylßd_Ën
 - 12);

310 
dÚe
:

311 ià(
»s
 =ğ
TKIP_DECRYPT_OK
) {

318 *
out_iv32
 = 
iv32
;

319 *
out_iv16
 = 
iv16
;

322  
»s
;

323 
	}
}

	@tkip.h

6 #iâdeà
TKIP_H


7 
	#TKIP_H


	)

9 
	~<lšux/ty³s.h
>

10 
	~<lšux/üy±o.h
>

11 
	~"key.h
"

13 
›“80211_tk_’üy±_d©a
(
¬c4_ùx
 *
ùx
,

14 
›“80211_key
 *
key
,

15 
sk_buff
 *
skb
,

16 
u8
 *
·ylßd
, 
size_t
 
·ylßd_Ën
);

19 
	mTKIP_DECRYPT_OK
 = 0,

20 
	mTKIP_DECRYPT_NO_EXT_IV
 = -1,

21 
	mTKIP_DECRYPT_INVALID_KEYIDX
 = -2,

22 
	mTKIP_DECRYPT_REPLAY
 = -3,

24 
›“80211_tk_deüy±_d©a
(
¬c4_ùx
 *
ùx
,

25 
›“80211_key
 *
key
,

26 
u8
 *
·ylßd
, 
size_t
 
·ylßd_Ën
, u8 *

,

27 
u8
 *
¿
, 
Úly_iv
, 
queue
,

28 
u32
 *
out_iv32
, 
u16
 *
out_iv16
);

	@trace.c

3 
	~<lšux/moduË.h
>

6 #iâdeà
__CHECKER__


7 
	~<Ãt/cfg80211.h
>

8 
	~"driv”-İs.h
"

9 
	~"debug.h
"

10 
	#CREATE_TRACE_POINTS


	)

11 
	~"Œaû.h
"

12 
	~"Œaû_msg.h
"

14 #ifdeà
CONFIG_MAC80211_MESSAGE_TRACING


15 
	$__sd©a_šfo
(cÚ¡ *
fmt
, ...)

17 
va_fÜm©
 
vaf
 = {

18 .
fmt
 = fmt,

20 
va_li¡
 
¬gs
;

22 
	`va_¡¬t
(
¬gs
, 
fmt
);

23 
vaf
.
va
 = &
¬gs
;

25 
	`´_šfo
("%pV", &
vaf
);

26 
	`Œaû_mac80211_šfo
(&
vaf
);

27 
	`va_’d
(
¬gs
);

28 
	}
}

30 
	$__sd©a_dbg
(
boŞ
 
´št
, cÚ¡ *
fmt
, ...)

32 
va_fÜm©
 
vaf
 = {

33 .
fmt
 = fmt,

35 
va_li¡
 
¬gs
;

37 
	`va_¡¬t
(
¬gs
, 
fmt
);

38 
vaf
.
va
 = &
¬gs
;

40 ià(
´št
)

41 
	`´_debug
("%pV", &
vaf
);

42 
	`Œaû_mac80211_dbg
(&
vaf
);

43 
	`va_’d
(
¬gs
);

44 
	}
}

46 
	$__sd©a_”r
(cÚ¡ *
fmt
, ...)

48 
va_fÜm©
 
vaf
 = {

49 .
fmt
 = fmt,

51 
va_li¡
 
¬gs
;

53 
	`va_¡¬t
(
¬gs
, 
fmt
);

54 
vaf
.
va
 = &
¬gs
;

56 
	`´_”r
("%pV", &
vaf
);

57 
	`Œaû_mac80211_”r
(&
vaf
);

58 
	`va_’d
(
¬gs
);

59 
	}
}

61 
	$__why_dbg
(
why
 *why, 
boŞ
 
´št
, cÚ¡ *
fmt
, ...)

63 
va_fÜm©
 
vaf
 = {

64 .
fmt
 = fmt,

66 
va_li¡
 
¬gs
;

68 
	`va_¡¬t
(
¬gs
, 
fmt
);

69 
vaf
.
va
 = &
¬gs
;

71 ià(
´št
)

72 
	`why_dbg
(
why
, "%pV", &
vaf
);

73 
	`Œaû_mac80211_dbg
(&
vaf
);

74 
	`va_’d
(
¬gs
);

75 
	}
}

	@trace.h

8 #ià!
defšed
(
__MAC80211_DRIVER_TRACE
è|| defšed(
TRACE_HEADER_MULTI_READ
)

9 
	#__MAC80211_DRIVER_TRACE


	)

11 
	~<lšux/Œaûpošt.h
>

12 
	~<Ãt/mac80211.h
>

13 
	~"›“80211_i.h
"

15 #undeà
TRACE_SYSTEM


16 
	#TRACE_SYSTEM
 
mac80211


	)

18 
	#MAXNAME
 32

	)

19 
	#LOCAL_ENTRY
 
	`__¬¿y
(, 
why_Çme
, 32)

	)

20 
	#LOCAL_ASSIGN
 
	`¡rsıy
(
__’Œy
->
why_Çme
, 
	`why_Çme
(
loÿl
->
hw
.
why
), 
MAXNAME
)

	)

21 
	#LOCAL_PR_FMT
 "%s"

	)

22 
	#LOCAL_PR_ARG
 
__’Œy
->
why_Çme


	)

24 
	#STA_ENTRY
 
	`__¬¿y
(, 
¡a_addr
, 
ETH_ALEN
)

	)

25 
	#STA_ASSIGN
 (
¡a
 ? 
	`memıy
(
__’Œy
->
¡a_addr
, s->
addr
, 
ETH_ALEN
) : \

26 
	`‘h_z”o_addr
(
__’Œy
->
¡a_addr
))

	)

27 
	#STA_NAMED_ASSIGN
(
s
è
	`memıy
(
__’Œy
->
¡a_addr
, (s)->
addr
, 
ETH_ALEN
)

	)

28 
	#STA_PR_FMT
 " s:%pM"

	)

29 
	#STA_PR_ARG
 
__’Œy
->
¡a_addr


	)

31 
	#VIF_ENTRY
 
	`__f›ld
(
Æ80211_iáy³
, 
vif_ty³
è__f›ld(*, 
sd©a
) \

32 
	`__f›ld
(
boŞ
, 
p2p
) \

33 
	`__¡ršg
(
vif_Çme
, 
sd©a
->
Çme
)

	)

34 
	#VIF_ASSIGN
 
__’Œy
->
vif_ty³
 = 
sd©a
->
vif
.
ty³
; __entry->sdata = sdata; \

35 
__’Œy
->
p2p
 = 
sd©a
->
vif
.p2p; \

36 
	`__assign_¡r
(
vif_Çme
, 
sd©a
->
Çme
)

	)

37 
	#VIF_PR_FMT
 " vif:%s(%d%s)"

	)

38 
	#VIF_PR_ARG
 
	`__g‘_¡r
(
vif_Çme
), 
__’Œy
->
vif_ty³
, __’Œy->
p2p
 ? "/p2p" : ""

	)

40 
	#CHANDEF_ENTRY
 
	`__f›ld
(
u32
, 
cÚŒŞ_äeq
) \

41 
	`__f›ld
(
u32
, 
äeq_off£t
) \

42 
	`__f›ld
(
u32
, 
chª_width
) \

43 
	`__f›ld
(
u32
, 
ûÁ”_äeq1
) \

44 
	`__f›ld
(
u32
, 
äeq1_off£t
) \

45 
	`__f›ld
(
u32
, 
ûÁ”_äeq2
)

	)

46 
	#CHANDEF_ASSIGN
(
c
) \

47 
__’Œy
->
cÚŒŞ_äeq
 = (
c
è? ((c)->
chª
 ? (c)->chª->
ûÁ”_äeq
 : 0) : 0; \

48 
__’Œy
->
äeq_off£t
 = (
c
è? ((c)->
chª
 ? (c)->chan->freq_offset : 0) : 0; \

49 
__’Œy
->
chª_width
 = (
c
è? (c)->
width
 : 0; \

50 
__’Œy
->
ûÁ”_äeq1
 = (
c
) ? (c)->center_freq1 : 0; \

51 
__’Œy
->
äeq1_off£t
 = (
c
) ? (c)->freq1_offset : 0; \

52 
__’Œy
->
ûÁ”_äeq2
 = (
c
è? (c)->ûÁ”_äeq2 : 0;

	)

53 
	#CHANDEF_PR_FMT
 " chªdef(%d.%03d MHz,width:%d,ûÁ”: %d.%03d/%d MHz)"

	)

54 
	#CHANDEF_PR_ARG
 
__’Œy
->
cÚŒŞ_äeq
, __’Œy->
äeq_off£t
, __’Œy->
chª_width
, \

55 
__’Œy
->
ûÁ”_äeq1
, __’Œy->
äeq1_off£t
, __’Œy->
ûÁ”_äeq2


	)

57 
	#MIN_CHANDEF_ENTRY
 \

58 
	`__f›ld
(
u32
, 
mš_cÚŒŞ_äeq
) \

59 
	`__f›ld
(
u32
, 
mš_äeq_off£t
) \

60 
	`__f›ld
(
u32
, 
mš_chª_width
) \

61 
	`__f›ld
(
u32
, 
mš_ûÁ”_äeq1
) \

62 
	`__f›ld
(
u32
, 
mš_äeq1_off£t
) \

63 
	`__f›ld
(
u32
, 
mš_ûÁ”_äeq2
)

	)

65 
	#MIN_CHANDEF_ASSIGN
(
c
) \

66 
__’Œy
->
mš_cÚŒŞ_äeq
 = (
c
)->
chª
 ? (c)->chª->
ûÁ”_äeq
 : 0; \

67 
__’Œy
->
mš_äeq_off£t
 = (
c
)->
chª
 ? (c)->chª->
äeq_off£t
 : 0; \

68 
__’Œy
->
mš_chª_width
 = (
c
)->
width
; \

69 
__’Œy
->
mš_ûÁ”_äeq1
 = (
c
)->
ûÁ”_äeq1
; \

70 
__’Œy
->
mš_äeq1_off£t
 = (
c
)->
äeq1_off£t
; \

71 
__’Œy
->
mš_ûÁ”_äeq2
 = (
c
)->
ûÁ”_äeq2
;

	)

72 
	#MIN_CHANDEF_PR_FMT
 " mšdef(%d.%03d MHz,width:%d,ûÁ”: %d.%03d/%d MHz)"

	)

73 
	#MIN_CHANDEF_PR_ARG
 
__’Œy
->
mš_cÚŒŞ_äeq
, __’Œy->
mš_äeq_off£t
, \

74 
__’Œy
->
mš_chª_width
, \

75 
__’Œy
->
mš_ûÁ”_äeq1
, __’Œy->
mš_äeq1_off£t
, \

76 
__’Œy
->
mš_ûÁ”_äeq2


	)

78 
	#AP_CHANDEF_ENTRY
 \

79 
	`__f›ld
(
u32
, 
­_cÚŒŞ_äeq
) \

80 
	`__f›ld
(
u32
, 
­_äeq_off£t
) \

81 
	`__f›ld
(
u32
, 
­_chª_width
) \

82 
	`__f›ld
(
u32
, 
­_ûÁ”_äeq1
) \

83 
	`__f›ld
(
u32
, 
­_äeq1_off£t
) \

84 
	`__f›ld
(
u32
, 
­_ûÁ”_äeq2
)

	)

86 
	#AP_CHANDEF_ASSIGN
(
c
) \

87 
__’Œy
->
­_cÚŒŞ_äeq
 = (
c
)->
chª
 ? (c)->chª->
ûÁ”_äeq
 : 0;\

88 
__’Œy
->
­_äeq_off£t
 = (
c
)->
chª
 ? (c)->chª->
äeq_off£t
 : 0;\

89 
__’Œy
->
­_chª_width
 = (
c
)->
chª
 ? (c)->
width
 : 0; \

90 
__’Œy
->
­_ûÁ”_äeq1
 = (
c
)->
chª
 ? (c)->
ûÁ”_äeq1
 : 0; \

91 
__’Œy
->
­_äeq1_off£t
 = (
c
)->
chª
 ? (c)->
äeq1_off£t
 : 0; \

92 
__’Œy
->
­_ûÁ”_äeq2
 = (
c
)->
chª
 ? (c)->
ûÁ”_äeq2
 : 0;

	)

93 
	#AP_CHANDEF_PR_FMT
 "‡p(%d.%03d MHz,width:%d,ûÁ”: %d.%03d/%d MHz)"

	)

94 
	#AP_CHANDEF_PR_ARG
 
__’Œy
->
­_cÚŒŞ_äeq
, __’Œy->
­_äeq_off£t
, \

95 
__’Œy
->
­_chª_width
, \

96 
__’Œy
->
­_ûÁ”_äeq1
, __’Œy->
­_äeq1_off£t
, \

97 
__’Œy
->
­_ûÁ”_äeq2


	)

99 
	#CHANCTX_ENTRY
 
CHANDEF_ENTRY
 \

100 
MIN_CHANDEF_ENTRY
 \

101 
AP_CHANDEF_ENTRY
 \

102 
	`__f›ld
(
u8
, 
rx_chašs_¡©ic
) \

103 
	`__f›ld
(
u8
, 
rx_chašs_dyÇmic
)

	)

104 
	#CHANCTX_ASSIGN
 
	`CHANDEF_ASSIGN
(&
ùx
->
cÚf
.
def
) \

105 
	`MIN_CHANDEF_ASSIGN
(&
ùx
->
cÚf
.
mš_def
) \

106 
	`AP_CHANDEF_ASSIGN
(&
ùx
->
cÚf
.
­
) \

107 
__’Œy
->
rx_chašs_¡©ic
 = 
ùx
->
cÚf
.rx_chains_static; \

108 
__’Œy
->
rx_chašs_dyÇmic
 = 
ùx
->
cÚf
.
	)
rx_chains_dynamic

109 
	#CHANCTX_PR_FMT
 
CHANDEF_PR_FMT
 
MIN_CHANDEF_PR_FMT
 
AP_CHANDEF_PR_FMT
 " chašs:%d/%d"

	)

110 
	#CHANCTX_PR_ARG
 
CHANDEF_PR_ARG
, 
MIN_CHANDEF_PR_ARG
, 
AP_CHANDEF_PR_ARG
, \

111 
__’Œy
->
rx_chašs_¡©ic
, __’Œy->
rx_chašs_dyÇmic


	)

113 
	#KEY_ENTRY
 
	`__f›ld
(
u32
, 
ch”
) \

114 
	`__f›ld
(
u8
, 
hw_key_idx
) \

115 
	`__f›ld
(
u8
, 
æags
) \

116 
	`__f›ld
(
s8
, 
keyidx
)

	)

117 
	#KEY_ASSIGN
(
k
è
__’Œy
->
ch”
 = (k)->cipher; \

118 
__’Œy
->
æags
 = (
k
)->flags; \

119 
__’Œy
->
keyidx
 = (
k
)->keyidx; \

120 
__’Œy
->
hw_key_idx
 = (
k
)->hw_key_idx;

	)

121 
	#KEY_PR_FMT
 " ch”:0x%x, fÏgs=%#x, keyidx=%d, hw_key_idx=%d"

	)

122 
	#KEY_PR_ARG
 
__’Œy
->
ch”
, __’Œy->
æags
, __’Œy->
keyidx
, __’Œy->
hw_key_idx


	)

124 
	#AMPDU_ACTION_ENTRY
 
	`__f›ld
(
›“80211_ampdu_mlme_aùiÚ
, \

125 
›“80211_ampdu_mlme_aùiÚ
) \

126 
STA_ENTRY
 \

127 
	`__f›ld
(
u16
, 
tid
) \

128 
	`__f›ld
(
u16
, 
s¢
) \

129 
	`__f›ld
(
u16
, 
buf_size
) \

130 
	`__f›ld
(
boŞ
, 
amsdu
) \

131 
	`__f›ld
(
u16
, 
timeout
) \

132 
	`__f›ld
(
u16
, 
aùiÚ
)

	)

133 
	#AMPDU_ACTION_ASSIGN
 
	`STA_NAMED_ASSIGN
(
·¿ms
->
¡a
); \

134 
__’Œy
->
tid
 = 
·¿ms
->tid; \

135 
__’Œy
->
s¢
 = 
·¿ms
->ssn; \

136 
__’Œy
->
buf_size
 = 
·¿ms
->buf_size; \

137 
__’Œy
->
amsdu
 = 
·¿ms
->amsdu; \

138 
__’Œy
->
timeout
 = 
·¿ms
->timeout; \

139 
__’Œy
->
aùiÚ
 = 
·¿ms
->aùiÚ;

	)

140 
	#AMPDU_ACTION_PR_FMT
 
STA_PR_FMT
 "id %d, s¢ %d, buf_siz%u,‡msdu %d,imeouˆ%d‡ùiÚ %d"

	)

141 
	#AMPDU_ACTION_PR_ARG
 
STA_PR_ARG
, 
__’Œy
->
tid
, __’Œy->
s¢
, \

142 
__’Œy
->
buf_size
, __’Œy->
amsdu
, __’Œy->
timeout
, \

143 
__’Œy
->
aùiÚ


	)

149 
DECLARE_EVENT_CLASS
(
loÿl_Úly_evt
,

150 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

151 
TP_ARGS
(
loÿl
),

152 
TP_STRUCT__’Œy
(

153 
LOCAL_ENTRY


155 
TP_ç¡_assign
(

156 
LOCAL_ASSIGN
;

158 
TP_´štk
(
LOCAL_PR_FMT
, 
LOCAL_PR_ARG
)

161 
DECLARE_EVENT_CLASS
(
loÿl_sd©a_addr_evt
,

162 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

163 
›“80211_sub_if_d©a
 *
sd©a
),

164 
TP_ARGS
(
loÿl
, 
sd©a
),

166 
TP_STRUCT__’Œy
(

167 
LOCAL_ENTRY


168 
VIF_ENTRY


169 
__¬¿y
(, 
addr
, 
ETH_ALEN
)

172 
TP_ç¡_assign
(

173 
LOCAL_ASSIGN
;

174 
VIF_ASSIGN
;

175 
memıy
(
__’Œy
->
addr
, 
sd©a
->
vif
.addr, 
ETH_ALEN
);

178 
TP_´štk
(

179 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "‡ddr:%pM",

180 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
addr


184 
DECLARE_EVENT_CLASS
(
loÿl_u32_evt
,

185 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
v®ue
),

186 
TP_ARGS
(
loÿl
, 
v®ue
),

188 
TP_STRUCT__’Œy
(

189 
LOCAL_ENTRY


190 
__f›ld
(
u32
, 
v®ue
)

193 
TP_ç¡_assign
(

194 
LOCAL_ASSIGN
;

195 
__’Œy
->
v®ue
 = value;

198 
TP_´štk
(

199 
LOCAL_PR_FMT
 " value:%d",

200 
LOCAL_PR_ARG
, 
__’Œy
->
v®ue


204 
DECLARE_EVENT_CLASS
(
loÿl_sd©a_evt
,

205 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

206 
›“80211_sub_if_d©a
 *
sd©a
),

207 
TP_ARGS
(
loÿl
, 
sd©a
),

209 
TP_STRUCT__’Œy
(

210 
LOCAL_ENTRY


211 
VIF_ENTRY


214 
TP_ç¡_assign
(

215 
LOCAL_ASSIGN
;

216 
VIF_ASSIGN
;

219 
TP_´štk
(

220 
LOCAL_PR_FMT
 
VIF_PR_FMT
,

221 
LOCAL_PR_ARG
, 
VIF_PR_ARG


225 
DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_»tuº_void
,

226 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

227 
TP_ARGS
(
loÿl
)

230 
TRACE_EVENT
(
drv_»tuº_št
,

231 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
»t
),

232 
TP_ARGS
(
loÿl
, 
»t
),

233 
TP_STRUCT__’Œy
(

234 
LOCAL_ENTRY


235 
__f›ld
(, 
»t
)

237 
TP_ç¡_assign
(

238 
LOCAL_ASSIGN
;

239 
__’Œy
->
»t
 =„et;

241 
TP_´štk
(
LOCAL_PR_FMT
 " - %d", 
LOCAL_PR_ARG
, 
__’Œy
->
»t
)

244 
TRACE_EVENT
(
drv_»tuº_boŞ
,

245 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
boŞ
 
»t
),

246 
TP_ARGS
(
loÿl
, 
»t
),

247 
TP_STRUCT__’Œy
(

248 
LOCAL_ENTRY


249 
__f›ld
(
boŞ
, 
»t
)

251 
TP_ç¡_assign
(

252 
LOCAL_ASSIGN
;

253 
__’Œy
->
»t
 =„et;

255 
TP_´štk
(
LOCAL_PR_FMT
 " - %s", 
LOCAL_PR_ARG
, (
__’Œy
->
»t
) ?

259 
TRACE_EVENT
(
drv_»tuº_u32
,

260 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
»t
),

261 
TP_ARGS
(
loÿl
, 
»t
),

262 
TP_STRUCT__’Œy
(

263 
LOCAL_ENTRY


264 
__f›ld
(
u32
, 
»t
)

266 
TP_ç¡_assign
(

267 
LOCAL_ASSIGN
;

268 
__’Œy
->
»t
 =„et;

270 
TP_´štk
(
LOCAL_PR_FMT
 " - %u", 
LOCAL_PR_ARG
, 
__’Œy
->
»t
)

273 
TRACE_EVENT
(
drv_»tuº_u64
,

274 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u64
 
»t
),

275 
TP_ARGS
(
loÿl
, 
»t
),

276 
TP_STRUCT__’Œy
(

277 
LOCAL_ENTRY


278 
__f›ld
(
u64
, 
»t
)

280 
TP_ç¡_assign
(

281 
LOCAL_ASSIGN
;

282 
__’Œy
->
»t
 =„et;

284 
TP_´štk
(
LOCAL_PR_FMT
 " - %Îu", 
LOCAL_PR_ARG
, 
__’Œy
->
»t
)

287 
DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_¡¬t
,

288 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

289 
TP_ARGS
(
loÿl
)

292 
DEFINE_EVENT
(
loÿl_u32_evt
, 
drv_g‘_‘_¡ršgs
,

293 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
s£t
),

294 
TP_ARGS
(
loÿl
, 
s£t
)

297 
DEFINE_EVENT
(
loÿl_u32_evt
, 
drv_g‘_‘_s£t_couÁ
,

298 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
s£t
),

299 
TP_ARGS
(
loÿl
, 
s£t
)

302 
DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_g‘_‘_¡©s
,

303 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

304 
TP_ARGS
(
loÿl
)

307 
DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_su¥’d
,

308 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

309 
TP_ARGS
(
loÿl
)

312 
DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_»sume
,

313 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

314 
TP_ARGS
(
loÿl
)

317 
TRACE_EVENT
(
drv_£t_wakeup
,

318 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
boŞ
 
’abËd
),

319 
TP_ARGS
(
loÿl
, 
’abËd
),

320 
TP_STRUCT__’Œy
(

321 
LOCAL_ENTRY


322 
__f›ld
(
boŞ
, 
’abËd
)

324 
TP_ç¡_assign
(

325 
LOCAL_ASSIGN
;

326 
__’Œy
->
’abËd
 =ƒnabled;

328 
TP_´štk
(
LOCAL_PR_FMT
 "ƒÇbËd:%d", 
LOCAL_PR_ARG
, 
__’Œy
->
’abËd
)

331 
DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_¡İ
,

332 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

333 
TP_ARGS
(
loÿl
)

336 
DEFINE_EVENT
(
loÿl_sd©a_addr_evt
, 
drv_add_š‹rçû
,

337 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

338 
›“80211_sub_if_d©a
 *
sd©a
),

339 
TP_ARGS
(
loÿl
, 
sd©a
)

342 
TRACE_EVENT
(
drv_chªge_š‹rçû
,

343 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

344 
›“80211_sub_if_d©a
 *
sd©a
,

345 
Æ80211_iáy³
 
ty³
, 
boŞ
 
p2p
),

347 
TP_ARGS
(
loÿl
, 
sd©a
, 
ty³
, 
p2p
),

349 
TP_STRUCT__’Œy
(

350 
LOCAL_ENTRY


351 
VIF_ENTRY


352 
	$__f›ld
(
u32
, 
Ãw_ty³
)

353 
	`__f›ld
(
boŞ
, 
Ãw_p2p
)

356 
	`TP_ç¡_assign
(

357 
LOCAL_ASSIGN
;

358 
VIF_ASSIGN
;

359 
__’Œy
->
Ãw_ty³
 = 
ty³
;

360 
__’Œy
->
Ãw_p2p
 = 
p2p
;

363 
	`TP_´štk
(

364 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "‚ewype:%d%s",

365 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
Ãw_ty³
,

366 
__’Œy
->
Ãw_p2p
 ? "/p2p" : ""

370 
	`DEFINE_EVENT
(
loÿl_sd©a_addr_evt
, 
drv_»move_š‹rçû
,

371 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

372 
›“80211_sub_if_d©a
 *
sd©a
),

373 
	`TP_ARGS
(
loÿl
, 
sd©a
)

376 
	`TRACE_EVENT
(
drv_cÚfig
,

377 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

378 
u32
 
chªged
),

380 
	`TP_ARGS
(
loÿl
, 
chªged
),

382 
	`TP_STRUCT__’Œy
(

383 
LOCAL_ENTRY


384 
	$__f›ld
(
u32
, 
chªged
)

385 
	$__f›ld
(
u32
, 
æags
)

386 
	$__f›ld
(, 
pow”_Ëv–
)

387 
	$__f›ld
(, 
dyÇmic_ps_timeout
)

388 
	$__f›ld
(
u16
, 
li¡’_š‹rv®
)

389 
	$__f›ld
(
u8
, 
lÚg_äame_max_tx_couÁ
)

390 
	$__f›ld
(
u8
, 
shÜt_äame_max_tx_couÁ
)

391 
CHANDEF_ENTRY


392 
	`__f›ld
(, 
smps
)

395 
	`TP_ç¡_assign
(

396 
LOCAL_ASSIGN
;

397 
__’Œy
->
chªged
 = changed;

398 
__’Œy
->
æags
 = 
loÿl
->
hw
.
cÚf
.flags;

399 
__’Œy
->
pow”_Ëv–
 = 
loÿl
->
hw
.
cÚf
.power_level;

400 
__’Œy
->
dyÇmic_ps_timeout
 = 
loÿl
->
hw
.
cÚf
.dynamic_ps_timeout;

401 
__’Œy
->
li¡’_š‹rv®
 = 
loÿl
->
hw
.
cÚf
.listen_interval;

402 
__’Œy
->
lÚg_äame_max_tx_couÁ
 =

403 
loÿl
->
hw
.
cÚf
.
lÚg_äame_max_tx_couÁ
;

404 
__’Œy
->
shÜt_äame_max_tx_couÁ
 =

405 
loÿl
->
hw
.
cÚf
.
shÜt_äame_max_tx_couÁ
;

406 
	`CHANDEF_ASSIGN
(&
loÿl
->
hw
.
cÚf
.
chªdef
)

407 
__’Œy
->
smps
 = 
loÿl
->
hw
.
cÚf
.
smps_mode
;

410 
	`TP_´štk
(

411 
LOCAL_PR_FMT
 " ch:%#x" 
CHANDEF_PR_FMT
,

412 
LOCAL_PR_ARG
, 
__’Œy
->
chªged
, 
CHANDEF_PR_ARG


416 
	`TRACE_EVENT
(
drv_vif_cfg_chªged
,

417 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

418 
›“80211_sub_if_d©a
 *
sd©a
,

419 
u64
 
chªged
),

421 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
chªged
),

423 
	`TP_STRUCT__’Œy
(

424 
LOCAL_ENTRY


425 
VIF_ENTRY


426 
	$__f›ld
(
u64
, 
chªged
)

427 
	$__f›ld
(
boŞ
, 
assoc
)

428 
	$__f›ld
(
boŞ
, 
ibss_jošed
)

429 
	$__f›ld
(
boŞ
, 
ibss_ü—tÜ
)

430 
	$__f›ld
(
u16
, 
aid
)

431 
	`__dyÇmic_¬¿y
(
u32
, 
¬p_addr_li¡
,

432 
sd©a
->
vif
.
cfg
.
¬p_addr_út
 > 
IEEE80211_BSS_ARP_ADDR_LIST_LEN
 ?

433 
IEEE80211_BSS_ARP_ADDR_LIST_LEN
 :

434 
sd©a
->
vif
.
cfg
.
¬p_addr_út
)

435 
	$__f›ld
(, 
¬p_addr_út
)

436 
	`__dyÇmic_¬¿y
(
u8
, 
ssid
, 
sd©a
->
vif
.
cfg
.
ssid_Ën
)

437 
	$__f›ld
(, 
s1g
)

438 
	$__f›ld
(
boŞ
, 
idË
)

439 
	`__f›ld
(
boŞ
, 
ps
)

442 
	`TP_ç¡_assign
(

443 
LOCAL_ASSIGN
;

444 
VIF_ASSIGN
;

445 
__’Œy
->
chªged
 = changed;

446 
__’Œy
->
aid
 = 
sd©a
->
vif
.
cfg
.aid;

447 
__’Œy
->
assoc
 = 
sd©a
->
vif
.
cfg
.assoc;

448 
__’Œy
->
ibss_jošed
 = 
sd©a
->
vif
.
cfg
.ibss_joined;

449 
__’Œy
->
ibss_ü—tÜ
 = 
sd©a
->
vif
.
cfg
.ibss_creator;

450 
__’Œy
->
ps
 = 
sd©a
->
vif
.
cfg
.ps;

452 
__’Œy
->
¬p_addr_út
 = 
sd©a
->
vif
.
cfg
.arp_addr_cnt;

453 
	`memıy
(
	`__g‘_dyÇmic_¬¿y
(
¬p_addr_li¡
),

454 
sd©a
->
vif
.
cfg
.
¬p_addr_li¡
,

455 (
u32
è* (
sd©a
->
vif
.
cfg
.
¬p_addr_út
 > 
IEEE80211_BSS_ARP_ADDR_LIST_LEN
 ?

456 
IEEE80211_BSS_ARP_ADDR_LIST_LEN
 :

457 
sd©a
->
vif
.
cfg
.
¬p_addr_út
));

458 
	`memıy
(
	`__g‘_dyÇmic_¬¿y
(
ssid
),

459 
sd©a
->
vif
.
cfg
.
ssid
,

460 
sd©a
->
vif
.
cfg
.
ssid_Ën
);

461 
__’Œy
->
s1g
 = 
sd©a
->
vif
.
cfg
.s1g;

462 
__’Œy
->
idË
 = 
sd©a
->
vif
.
cfg
.idle;

465 
	`TP_´štk
(

466 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " changed:%#llx",

467 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
chªged


471 
	`TRACE_EVENT
(
drv_lšk_šfo_chªged
,

472 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

473 
›“80211_sub_if_d©a
 *
sd©a
,

474 
›“80211_bss_cÚf
 *
lšk_cÚf
,

475 
u64
 
chªged
),

477 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_cÚf
, 
chªged
),

479 
	`TP_STRUCT__’Œy
(

480 
LOCAL_ENTRY


481 
VIF_ENTRY


482 
	$__f›ld
(
u64
, 
chªged
)

483 
	$__f›ld
(, 
lšk_id
)

484 
	$__f›ld
(
boŞ
, 
ùs
)

485 
	$__f›ld
(
boŞ
, 
shÜ»
)

486 
	$__f›ld
(
boŞ
, 
shÜt¦Ù
)

487 
	$__f›ld
(
boŞ
, 
’abË_b—cÚ
)

488 
	$__f›ld
(
u8
, 
dtim³r
)

489 
	$__f›ld
(
u16
, 
búšt
)

490 
	$__f›ld
(
u16
, 
assoc_ÿp
)

491 
	$__f›ld
(
u64
, 
sync_tsf
)

492 
	$__f›ld
(
u32
, 
sync_deviû_ts
)

493 
	$__f›ld
(
u8
, 
sync_dtim_couÁ
)

494 
	$__f›ld
(
u32
, 
basic_¿‹s
)

495 
	$__¬¿y
(, 
mÿ¡_¿‹
, 
NUM_NL80211_BANDS
)

496 
	$__f›ld
(
u16
, 
ht_İ”©iÚ_mode
)

497 
	$__f›ld
(
s32
, 
cqm_rssi_thŞd
)

498 
	$__f›ld
(
s32
, 
cqm_rssi_hy¡
)

499 
	$__f›ld
(
u32
, 
chªÃl_width
)

500 
	$__f›ld
(
u32
, 
chªÃl_cäeq1
)

501 
	$__f›ld
(
u32
, 
chªÃl_cäeq1_off£t
)

502 
	$__f›ld
(
boŞ
, 
qos
)

503 
	$__f›ld
(
boŞ
, 
hidd’_ssid
)

504 
	$__f›ld
(, 
txpow”
)

505 
	`__f›ld
(
u8
, 
p2p_İµs_ùwšdow
)

508 
	`TP_ç¡_assign
(

509 
LOCAL_ASSIGN
;

510 
VIF_ASSIGN
;

511 
__’Œy
->
chªged
 = changed;

512 
__’Œy
->
lšk_id
 = 
lšk_cÚf
->link_id;

513 
__’Œy
->
shÜ»
 = 
lšk_cÚf
->
u£_shÜt_´—mbË
;

514 
__’Œy
->
ùs
 = 
lšk_cÚf
->
u£_ùs_´Ù
;

515 
__’Œy
->
shÜt¦Ù
 = 
lšk_cÚf
->
u£_shÜt_¦Ù
;

516 
__’Œy
->
’abË_b—cÚ
 = 
lšk_cÚf
->enable_beacon;

517 
__’Œy
->
dtim³r
 = 
lšk_cÚf
->
dtim_³riod
;

518 
__’Œy
->
búšt
 = 
lšk_cÚf
->
b—cÚ_št
;

519 
__’Œy
->
assoc_ÿp
 = 
lšk_cÚf
->
assoc_ÿ·b™y
;

520 
__’Œy
->
sync_tsf
 = 
lšk_cÚf
->sync_tsf;

521 
__’Œy
->
sync_deviû_ts
 = 
lšk_cÚf
->sync_device_ts;

522 
__’Œy
->
sync_dtim_couÁ
 = 
lšk_cÚf
->sync_dtim_count;

523 
__’Œy
->
basic_¿‹s
 = 
lšk_cÚf
->basic_rates;

524 
	`memıy
(
__’Œy
->
mÿ¡_¿‹
, 
lšk_cÚf
->mcast_rate,

525 (
__’Œy
->
mÿ¡_¿‹
));

526 
__’Œy
->
ht_İ”©iÚ_mode
 = 
lšk_cÚf
->ht_operation_mode;

527 
__’Œy
->
cqm_rssi_thŞd
 = 
lšk_cÚf
->cqm_rssi_thold;

528 
__’Œy
->
cqm_rssi_hy¡
 = 
lšk_cÚf
->cqm_rssi_hyst;

529 
__’Œy
->
chªÃl_width
 = 
lšk_cÚf
->
chª»q
.
İ”
.
width
;

530 
__’Œy
->
chªÃl_cäeq1
 = 
lšk_cÚf
->
chª»q
.
İ”
.
ûÁ”_äeq1
;

531 
__’Œy
->
chªÃl_cäeq1_off£t
 = 
lšk_cÚf
->
chª»q
.
İ”
.
äeq1_off£t
;

532 
__’Œy
->
qos
 = 
lšk_cÚf
->qos;

533 
__’Œy
->
hidd’_ssid
 = 
lšk_cÚf
->hidden_ssid;

534 
__’Œy
->
txpow”
 = 
lšk_cÚf
->txpower;

535 
__’Œy
->
p2p_İµs_ùwšdow
 = 
lšk_cÚf
->
p2p_nß_©Œ
.
İµs_ùwšdow
;

538 
	`TP_´štk
(

539 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "†ink_id:%d, changed:%#llx",

540 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
lšk_id
,

541 
__’Œy
->
chªged


545 
	`TRACE_EVENT
(
drv_´•¬e_muÉiÿ¡
,

546 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
mc_couÁ
),

548 
	`TP_ARGS
(
loÿl
, 
mc_couÁ
),

550 
	`TP_STRUCT__’Œy
(

551 
LOCAL_ENTRY


552 
	`__f›ld
(, 
mc_couÁ
)

555 
	`TP_ç¡_assign
(

556 
LOCAL_ASSIGN
;

557 
__’Œy
->
mc_couÁ
 = mc_count;

560 
	`TP_´štk
(

561 
LOCAL_PR_FMT
 "…repare mc (%d)",

562 
LOCAL_PR_ARG
, 
__’Œy
->
mc_couÁ


566 
	`TRACE_EVENT
(
drv_cÚfigu»_f‹r
,

567 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

568 
chªged_æags
,

569 *
tÙ®_æags
,

570 
u64
 
muÉiÿ¡
),

572 
	`TP_ARGS
(
loÿl
, 
chªged_æags
, 
tÙ®_æags
, 
muÉiÿ¡
),

574 
	`TP_STRUCT__’Œy
(

575 
LOCAL_ENTRY


576 
	$__f›ld
(, 
chªged
)

577 
	$__f›ld
(, 
tÙ®
)

578 
	`__f›ld
(
u64
, 
muÉiÿ¡
)

581 
	`TP_ç¡_assign
(

582 
LOCAL_ASSIGN
;

583 
__’Œy
->
chªged
 = 
chªged_æags
;

584 
__’Œy
->
tÙ®
 = *
tÙ®_æags
;

585 
__’Œy
->
muÉiÿ¡
 = multicast;

588 
	`TP_´štk
(

589 
LOCAL_PR_FMT
 " changed:%#xotal:%#x",

590 
LOCAL_PR_ARG
, 
__’Œy
->
chªged
, __’Œy->
tÙ®


594 
	`TRACE_EVENT
(
drv_cÚfig_içû_f‹r
,

595 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

596 
›“80211_sub_if_d©a
 *
sd©a
,

597 
f‹r_æags
,

598 
chªged_æags
),

600 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
f‹r_æags
, 
chªged_æags
),

602 
	`TP_STRUCT__’Œy
(

603 
LOCAL_ENTRY


604 
VIF_ENTRY


605 
	$__f›ld
(, 
f‹r_æags
)

606 
	`__f›ld
(, 
chªged_æags
)

609 
	`TP_ç¡_assign
(

610 
LOCAL_ASSIGN
;

611 
VIF_ASSIGN
;

612 
__’Œy
->
f‹r_æags
 = filter_flags;

613 
__’Œy
->
chªged_æags
 = changed_flags;

616 
	`TP_´štk
(

617 
LOCAL_PR_FMT
 
VIF_PR_FMT


619 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
f‹r_æags
,

620 
__’Œy
->
chªged_æags


624 
	`TRACE_EVENT
(
drv_£t_tim
,

625 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

626 
›“80211_¡a
 *
¡a
, 
boŞ
 
£t
),

628 
	`TP_ARGS
(
loÿl
, 
¡a
, 
£t
),

630 
	`TP_STRUCT__’Œy
(

631 
LOCAL_ENTRY


632 
STA_ENTRY


633 
	`__f›ld
(
boŞ
, 
£t
)

636 
	`TP_ç¡_assign
(

637 
LOCAL_ASSIGN
;

638 
STA_ASSIGN
;

639 
__’Œy
->
£t
 = set;

642 
	`TP_´štk
(

643 
LOCAL_PR_FMT
 
STA_PR_FMT
 " set:%d",

644 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
£t


648 
	`TRACE_EVENT
(
drv_£t_key
,

649 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

650 
£t_key_cmd
 
cmd
, 
›“80211_sub_if_d©a
 *
sd©a
,

651 
›“80211_¡a
 *
¡a
,

652 
›“80211_key_cÚf
 *
key
),

654 
	`TP_ARGS
(
loÿl
, 
cmd
, 
sd©a
, 
¡a
, 
key
),

656 
	`TP_STRUCT__’Œy
(

657 
LOCAL_ENTRY


658 
VIF_ENTRY


659 
STA_ENTRY


660 
	$__f›ld
(
u32
, 
cmd
)

661 
KEY_ENTRY


664 
	`TP_ç¡_assign
(

665 
LOCAL_ASSIGN
;

666 
VIF_ASSIGN
;

667 
STA_ASSIGN
;

668 
__’Œy
->
cmd
 = cmd;

669 
	`KEY_ASSIGN
(
key
);

672 
	`TP_´štk
(

673 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 " cmd: %d" 
KEY_PR_FMT
,

674 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
cmd
, 
KEY_PR_ARG


678 
	`TRACE_EVENT
(
drv_upd©e_tk_key
,

679 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

680 
›“80211_sub_if_d©a
 *
sd©a
,

681 
›“80211_key_cÚf
 *
cÚf
,

682 
›“80211_¡a
 *
¡a
, 
u32
 
iv32
),

684 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
cÚf
, 
¡a
, 
iv32
),

686 
	`TP_STRUCT__’Œy
(

687 
LOCAL_ENTRY


688 
VIF_ENTRY


689 
STA_ENTRY


690 
	`__f›ld
(
u32
, 
iv32
)

693 
	`TP_ç¡_assign
(

694 
LOCAL_ASSIGN
;

695 
VIF_ASSIGN
;

696 
STA_ASSIGN
;

697 
__’Œy
->
iv32
 = iv32;

700 
	`TP_´štk
(

701 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 " iv32:%#x",

702 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
iv32


706 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_hw_sÿn
,

707 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

708 
›“80211_sub_if_d©a
 *
sd©a
),

709 
	`TP_ARGS
(
loÿl
, 
sd©a
)

712 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_ÿnûl_hw_sÿn
,

713 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

714 
›“80211_sub_if_d©a
 *
sd©a
),

715 
	`TP_ARGS
(
loÿl
, 
sd©a
)

718 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_sched_sÿn_¡¬t
,

719 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

720 
›“80211_sub_if_d©a
 *
sd©a
),

721 
	`TP_ARGS
(
loÿl
, 
sd©a
)

724 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_sched_sÿn_¡İ
,

725 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

726 
›“80211_sub_if_d©a
 *
sd©a
),

727 
	`TP_ARGS
(
loÿl
, 
sd©a
)

730 
	`TRACE_EVENT
(
drv_sw_sÿn_¡¬t
,

731 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

732 
›“80211_sub_if_d©a
 *
sd©a
,

733 cÚ¡ 
u8
 *
mac_addr
),

735 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
mac_addr
),

737 
	`TP_STRUCT__’Œy
(

738 
LOCAL_ENTRY


739 
VIF_ENTRY


740 
	`__¬¿y
(, 
mac_addr
, 
ETH_ALEN
)

743 
	`TP_ç¡_assign
(

744 
LOCAL_ASSIGN
;

745 
VIF_ASSIGN
;

746 
	`memıy
(
__’Œy
->
mac_addr
, mac_addr, 
ETH_ALEN
);

749 
	`TP_´štk
(
LOCAL_PR_FMT
 ", " 
VIF_PR_FMT
 ",‡ddr:%pM",

750 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
mac_addr
)

753 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_sw_sÿn_com¶‘e
,

754 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

755 
›“80211_sub_if_d©a
 *
sd©a
),

756 
	`TP_ARGS
(
loÿl
, 
sd©a
)

759 
	`TRACE_EVENT
(
drv_g‘_¡©s
,

760 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

761 
›“80211_low_Ëv–_¡©s
 *
¡©s
,

762 
»t
),

764 
	`TP_ARGS
(
loÿl
, 
¡©s
, 
»t
),

766 
	`TP_STRUCT__’Œy
(

767 
LOCAL_ENTRY


768 
	$__f›ld
(, 
»t
)

769 
	$__f›ld
(, 
ackç
)

770 
	$__f›ld
(, 
¹sç
)

771 
	$__f›ld
(, 
fc£¼
)

772 
	`__f›ld
(, 
¹ssucc
)

775 
	`TP_ç¡_assign
(

776 
LOCAL_ASSIGN
;

777 
__’Œy
->
»t
 =„et;

778 
__’Œy
->
ackç
 = 
¡©s
->
dÙ11ACKFau»CouÁ
;

779 
__’Œy
->
¹sç
 = 
¡©s
->
dÙ11RTSFau»CouÁ
;

780 
__’Œy
->
fc£¼
 = 
¡©s
->
dÙ11FCSE¼ÜCouÁ
;

781 
__’Œy
->
¹ssucc
 = 
¡©s
->
dÙ11RTSSucûssCouÁ
;

784 
	`TP_´štk
(

785 
LOCAL_PR_FMT
 "„et:%d",

786 
LOCAL_PR_ARG
, 
__’Œy
->
»t


790 
	`TRACE_EVENT
(
drv_g‘_key_£q
,

791 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

792 
›“80211_key_cÚf
 *
key
),

794 
	`TP_ARGS
(
loÿl
, 
key
),

796 
	`TP_STRUCT__’Œy
(

797 
LOCAL_ENTRY


798 
KEY_ENTRY


801 
	`TP_ç¡_assign
(

802 
LOCAL_ASSIGN
;

803 
	`KEY_ASSIGN
(
key
);

806 
	`TP_´štk
(

807 
LOCAL_PR_FMT
 
KEY_PR_FMT
,

808 
LOCAL_PR_ARG
, 
KEY_PR_ARG


812 
	`DEFINE_EVENT
(
loÿl_u32_evt
, 
drv_£t_äag_th»shŞd
,

813 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
v®ue
),

814 
	`TP_ARGS
(
loÿl
, 
v®ue
)

817 
	`DEFINE_EVENT
(
loÿl_u32_evt
, 
drv_£t_¹s_th»shŞd
,

818 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
v®ue
),

819 
	`TP_ARGS
(
loÿl
, 
v®ue
)

822 
	`TRACE_EVENT
(
drv_£t_cov”age_şass
,

823 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
s16
 
v®ue
),

825 
	`TP_ARGS
(
loÿl
, 
v®ue
),

827 
	`TP_STRUCT__’Œy
(

828 
LOCAL_ENTRY


829 
	`__f›ld
(
s16
, 
v®ue
)

832 
	`TP_ç¡_assign
(

833 
LOCAL_ASSIGN
;

834 
__’Œy
->
v®ue
 = value;

837 
	`TP_´štk
(

838 
LOCAL_PR_FMT
 " value:%d",

839 
LOCAL_PR_ARG
, 
__’Œy
->
v®ue


843 
	`TRACE_EVENT
(
drv_¡a_nÙify
,

844 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

845 
›“80211_sub_if_d©a
 *
sd©a
,

846 
¡a_nÙify_cmd
 
cmd
,

847 
›“80211_¡a
 *
¡a
),

849 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
cmd
, 
¡a
),

851 
	`TP_STRUCT__’Œy
(

852 
LOCAL_ENTRY


853 
VIF_ENTRY


854 
STA_ENTRY


855 
	`__f›ld
(
u32
, 
cmd
)

858 
	`TP_ç¡_assign
(

859 
LOCAL_ASSIGN
;

860 
VIF_ASSIGN
;

861 
STA_ASSIGN
;

862 
__’Œy
->
cmd
 = cmd;

865 
	`TP_´štk
(

866 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 " cmd:%d",

867 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
cmd


871 
	`TRACE_EVENT
(
drv_¡a_¡©e
,

872 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

873 
›“80211_sub_if_d©a
 *
sd©a
,

874 
›“80211_¡a
 *
¡a
,

875 
›“80211_¡a_¡©e
 
Şd_¡©e
,

876 
›“80211_¡a_¡©e
 
Ãw_¡©e
),

878 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
Şd_¡©e
, 
Ãw_¡©e
),

880 
	`TP_STRUCT__’Œy
(

881 
LOCAL_ENTRY


882 
VIF_ENTRY


883 
STA_ENTRY


884 
	$__f›ld
(
u32
, 
Şd_¡©e
)

885 
	`__f›ld
(
u32
, 
Ãw_¡©e
)

888 
	`TP_ç¡_assign
(

889 
LOCAL_ASSIGN
;

890 
VIF_ASSIGN
;

891 
STA_ASSIGN
;

892 
__’Œy
->
Şd_¡©e
 = old_state;

893 
__’Œy
->
Ãw_¡©e
 =‚ew_state;

896 
	`TP_´štk
(

897 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 " state: %d->%d",

898 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
,

899 
__’Œy
->
Şd_¡©e
, __’Œy->
Ãw_¡©e


903 
	`TRACE_EVENT
(
drv_¡a_£t_txpwr
,

904 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

905 
›“80211_sub_if_d©a
 *
sd©a
,

906 
›“80211_¡a
 *
¡a
),

908 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
),

910 
	`TP_STRUCT__’Œy
(

911 
LOCAL_ENTRY


912 
VIF_ENTRY


913 
STA_ENTRY


914 
	$__f›ld
(
s16
, 
txpwr
)

915 
	`__f›ld
(
u8
, 
ty³
)

918 
	`TP_ç¡_assign
(

919 
LOCAL_ASSIGN
;

920 
VIF_ASSIGN
;

921 
STA_ASSIGN
;

922 
__’Œy
->
txpwr
 = 
¡a
->
deæšk
.txpwr.
pow”
;

923 
__’Œy
->
ty³
 = 
¡a
->
deæšk
.
txpwr
.type;

926 
	`TP_´štk
(

927 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 "xpwr: %dype %d",

928 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
,

929 
__’Œy
->
txpwr
, __’Œy->
ty³


933 
	`TRACE_EVENT
(
drv_¡a_rc_upd©e
,

934 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

935 
›“80211_sub_if_d©a
 *
sd©a
,

936 
›“80211_¡a
 *
¡a
,

937 
u32
 
chªged
),

939 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
chªged
),

941 
	`TP_STRUCT__’Œy
(

942 
LOCAL_ENTRY


943 
VIF_ENTRY


944 
STA_ENTRY


945 
	`__f›ld
(
u32
, 
chªged
)

948 
	`TP_ç¡_assign
(

949 
LOCAL_ASSIGN
;

950 
VIF_ASSIGN
;

951 
STA_ASSIGN
;

952 
__’Œy
->
chªged
 = changed;

955 
	`TP_´štk
(

956 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 " changed: 0x%x",

957 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
chªged


961 
	`DECLARE_EVENT_CLASS
(
¡a_ev’t
,

962 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

963 
›“80211_sub_if_d©a
 *
sd©a
,

964 
›“80211_¡a
 *
¡a
),

966 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
),

968 
	`TP_STRUCT__’Œy
(

969 
LOCAL_ENTRY


970 
VIF_ENTRY


971 
STA_ENTRY


974 
	`TP_ç¡_assign
(

975 
LOCAL_ASSIGN
;

976 
VIF_ASSIGN
;

977 
STA_ASSIGN
;

980 
	`TP_´štk
(

981 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
,

982 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG


986 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_¡a_¡©i¡ics
,

987 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

988 
›“80211_sub_if_d©a
 *
sd©a
,

989 
›“80211_¡a
 *
¡a
),

990 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

993 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_¡a_add
,

994 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

995 
›“80211_sub_if_d©a
 *
sd©a
,

996 
›“80211_¡a
 *
¡a
),

997 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

1000 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_¡a_»move
,

1001 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1002 
›“80211_sub_if_d©a
 *
sd©a
,

1003 
›“80211_¡a
 *
¡a
),

1004 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

1007 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_¡a_´e_rcu_»move
,

1008 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1009 
›“80211_sub_if_d©a
 *
sd©a
,

1010 
›“80211_¡a
 *
¡a
),

1011 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

1014 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_sync_rx_queues
,

1015 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1016 
›“80211_sub_if_d©a
 *
sd©a
,

1017 
›“80211_¡a
 *
¡a
),

1018 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

1021 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_¡a_¿‹_tbl_upd©e
,

1022 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1023 
›“80211_sub_if_d©a
 *
sd©a
,

1024 
›“80211_¡a
 *
¡a
),

1025 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

1028 
	`TRACE_EVENT
(
drv_cÚf_tx
,

1029 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1030 
›“80211_sub_if_d©a
 *
sd©a
,

1031 
lšk_id
,

1032 
u16
 
ac
, cÚ¡ 
›“80211_tx_queue_·¿ms
 *
·¿ms
),

1034 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_id
, 
ac
, 
·¿ms
),

1036 
	`TP_STRUCT__’Œy
(

1037 
LOCAL_ENTRY


1038 
VIF_ENTRY


1039 
	$__f›ld
(, 
lšk_id
)

1040 
	$__f›ld
(
u16
, 
ac
)

1041 
	$__f›ld
(
u16
, 
txİ
)

1042 
	$__f›ld
(
u16
, 
cw_mš
)

1043 
	$__f›ld
(
u16
, 
cw_max
)

1044 
	$__f›ld
(
u8
, 
aifs
)

1045 
	`__f›ld
(
boŞ
, 
u­sd
)

1048 
	`TP_ç¡_assign
(

1049 
LOCAL_ASSIGN
;

1050 
VIF_ASSIGN
;

1051 
__’Œy
->
lšk_id
 =†ink_id;

1052 
__’Œy
->
ac
 =‡c;

1053 
__’Œy
->
txİ
 = 
·¿ms
->txop;

1054 
__’Œy
->
cw_max
 = 
·¿ms
->cw_max;

1055 
__’Œy
->
cw_mš
 = 
·¿ms
->cw_min;

1056 
__’Œy
->
aifs
 = 
·¿ms
->aifs;

1057 
__’Œy
->
u­sd
 = 
·¿ms
->uapsd;

1060 
	`TP_´štk
(

1061 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "†ink_id: %d, AC:%d",

1062 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
lšk_id
, __’Œy->
ac


1066 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_g‘_tsf
,

1067 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1068 
›“80211_sub_if_d©a
 *
sd©a
),

1069 
	`TP_ARGS
(
loÿl
, 
sd©a
)

1072 
	`TRACE_EVENT
(
drv_£t_tsf
,

1073 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1074 
›“80211_sub_if_d©a
 *
sd©a
,

1075 
u64
 
tsf
),

1077 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
tsf
),

1079 
	`TP_STRUCT__’Œy
(

1080 
LOCAL_ENTRY


1081 
VIF_ENTRY


1082 
	`__f›ld
(
u64
, 
tsf
)

1085 
	`TP_ç¡_assign
(

1086 
LOCAL_ASSIGN
;

1087 
VIF_ASSIGN
;

1088 
__’Œy
->
tsf
 =sf;

1091 
	`TP_´štk
(

1092 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "sf:%llu",

1093 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, ()
__’Œy
->
tsf


1097 
	`TRACE_EVENT
(
drv_off£t_tsf
,

1098 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1099 
›“80211_sub_if_d©a
 *
sd©a
,

1100 
s64
 
off£t
),

1102 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
off£t
),

1104 
	`TP_STRUCT__’Œy
(

1105 
LOCAL_ENTRY


1106 
VIF_ENTRY


1107 
	`__f›ld
(
s64
, 
tsf_off£t
)

1110 
	`TP_ç¡_assign
(

1111 
LOCAL_ASSIGN
;

1112 
VIF_ASSIGN
;

1113 
__’Œy
->
tsf_off£t
 = 
off£t
;

1116 
	`TP_´štk
(

1117 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "sf offset:%lld",

1118 
LOCAL_PR_ARG
, 
VIF_PR_ARG
,

1119 ()
__’Œy
->
tsf_off£t


1123 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_»£t_tsf
,

1124 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1125 
›“80211_sub_if_d©a
 *
sd©a
),

1126 
	`TP_ARGS
(
loÿl
, 
sd©a
)

1129 
	`DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_tx_Ï¡_b—cÚ
,

1130 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

1131 
	`TP_ARGS
(
loÿl
)

1134 
	`TRACE_EVENT
(
drv_ampdu_aùiÚ
,

1135 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1136 
›“80211_sub_if_d©a
 *
sd©a
,

1137 
›“80211_ampdu_·¿ms
 *
·¿ms
),

1139 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
·¿ms
),

1141 
	`TP_STRUCT__’Œy
(

1142 
LOCAL_ENTRY


1143 
VIF_ENTRY


1144 
AMPDU_ACTION_ENTRY


1147 
	`TP_ç¡_assign
(

1148 
LOCAL_ASSIGN
;

1149 
VIF_ASSIGN
;

1150 
AMPDU_ACTION_ASSIGN
;

1153 
	`TP_´štk
(

1154 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
AMPDU_ACTION_PR_FMT
,

1155 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
AMPDU_ACTION_PR_ARG


1159 
	`TRACE_EVENT
(
drv_g‘_survey
,

1160 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
_idx
,

1161 
survey_šfo
 *
survey
),

1163 
	`TP_ARGS
(
loÿl
, 
_idx
, 
survey
),

1165 
	`TP_STRUCT__’Œy
(

1166 
LOCAL_ENTRY


1167 
	`__f›ld
(, 
idx
)

1170 
	`TP_ç¡_assign
(

1171 
LOCAL_ASSIGN
;

1172 
__’Œy
->
idx
 = 
_idx
;

1175 
	`TP_´štk
(

1176 
LOCAL_PR_FMT
 " idx:%d",

1177 
LOCAL_PR_ARG
, 
__’Œy
->
idx


1181 
	`TRACE_EVENT
(
drv_æush
,

1182 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1183 
u32
 
queues
, 
boŞ
 
drİ
),

1185 
	`TP_ARGS
(
loÿl
, 
queues
, 
drİ
),

1187 
	`TP_STRUCT__’Œy
(

1188 
LOCAL_ENTRY


1189 
	$__f›ld
(
boŞ
, 
drİ
)

1190 
	`__f›ld
(
u32
, 
queues
)

1193 
	`TP_ç¡_assign
(

1194 
LOCAL_ASSIGN
;

1195 
__’Œy
->
drİ
 = drop;

1196 
__’Œy
->
queues
 = queues;

1199 
	`TP_´štk
(

1200 
LOCAL_PR_FMT
 " queues:0x%x drop:%d",

1201 
LOCAL_PR_ARG
, 
__’Œy
->
queues
, __’Œy->
drİ


1205 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_æush_¡a
,

1206 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1207 
›“80211_sub_if_d©a
 *
sd©a
,

1208 
›“80211_¡a
 *
¡a
),

1209 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

1212 
	`DECLARE_EVENT_CLASS
(
chªsw™ch_evt
,

1213 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1214 
›“80211_sub_if_d©a
 *
sd©a
,

1215 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
),

1217 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
ch_sw™ch
),

1219 
	`TP_STRUCT__’Œy
(

1220 
LOCAL_ENTRY


1221 
VIF_ENTRY


1222 
CHANDEF_ENTRY


1223 
	$__f›ld
(
u64
, 
time¡amp
)

1224 
	$__f›ld
(
u32
, 
deviû_time¡amp
)

1225 
	$__f›ld
(
boŞ
, 
block_tx
)

1226 
	$__f›ld
(
u8
, 
couÁ
)

1227 
	`__f›ld
(
u8
, 
lšk_id
)

1230 
	`TP_ç¡_assign
(

1231 
LOCAL_ASSIGN
;

1232 
VIF_ASSIGN
;

1233 
	`CHANDEF_ASSIGN
(&
ch_sw™ch
->
chªdef
)

1234 
__’Œy
->
time¡amp
 = 
ch_sw™ch
->timestamp;

1235 
__’Œy
->
deviû_time¡amp
 = 
ch_sw™ch
->device_timestamp;

1236 
__’Œy
->
block_tx
 = 
ch_sw™ch
->block_tx;

1237 
__’Œy
->
couÁ
 = 
ch_sw™ch
->count;

1238 
__’Œy
->
lšk_id
 = 
ch_sw™ch
->link_id;

1241 
	`TP_´štk
(

1242 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
CHANDEF_PR_FMT
 " count:%d block_tx:%dimestamp:%llu device_ts:%u†ink_id:%d",

1243 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
CHANDEF_PR_ARG
, 
__’Œy
->
couÁ
,

1244 
__’Œy
->
block_tx
, __’Œy->
time¡amp
,

1245 
__’Œy
->
deviû_time¡amp
, __’Œy->
lšk_id


1249 
	`DEFINE_EVENT
(
chªsw™ch_evt
, 
drv_chªÃl_sw™ch
,

1250 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1251 
›“80211_sub_if_d©a
 *
sd©a
,

1252 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
),

1253 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
ch_sw™ch
)

1256 
	`TRACE_EVENT
(
drv_£t_ª‹Âa
,

1257 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
tx_ªt
, u32 
rx_ªt
, 
»t
),

1259 
	`TP_ARGS
(
loÿl
, 
tx_ªt
, 
rx_ªt
, 
»t
),

1261 
	`TP_STRUCT__’Œy
(

1262 
LOCAL_ENTRY


1263 
	$__f›ld
(
u32
, 
tx_ªt
)

1264 
	$__f›ld
(
u32
, 
rx_ªt
)

1265 
	`__f›ld
(, 
»t
)

1268 
	`TP_ç¡_assign
(

1269 
LOCAL_ASSIGN
;

1270 
__’Œy
->
tx_ªt
 =x_ant;

1271 
__’Œy
->
rx_ªt
 =„x_ant;

1272 
__’Œy
->
»t
 =„et;

1275 
	`TP_´štk
(

1276 
LOCAL_PR_FMT
 "x_ant:%d„x_ant:%d„et:%d",

1277 
LOCAL_PR_ARG
, 
__’Œy
->
tx_ªt
, __’Œy->
rx_ªt
, __’Œy->
»t


1281 
	`TRACE_EVENT
(
drv_g‘_ª‹Âa
,

1282 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
tx_ªt
, u32 
rx_ªt
, 
»t
),

1284 
	`TP_ARGS
(
loÿl
, 
tx_ªt
, 
rx_ªt
, 
»t
),

1286 
	`TP_STRUCT__’Œy
(

1287 
LOCAL_ENTRY


1288 
	$__f›ld
(
u32
, 
tx_ªt
)

1289 
	$__f›ld
(
u32
, 
rx_ªt
)

1290 
	`__f›ld
(, 
»t
)

1293 
	`TP_ç¡_assign
(

1294 
LOCAL_ASSIGN
;

1295 
__’Œy
->
tx_ªt
 =x_ant;

1296 
__’Œy
->
rx_ªt
 =„x_ant;

1297 
__’Œy
->
»t
 =„et;

1300 
	`TP_´štk
(

1301 
LOCAL_PR_FMT
 "x_ant:%d„x_ant:%d„et:%d",

1302 
LOCAL_PR_ARG
, 
__’Œy
->
tx_ªt
, __’Œy->
rx_ªt
, __’Œy->
»t


1306 
	`TRACE_EVENT
(
drv_»maš_Ú_chªÃl
,

1307 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1308 
›“80211_sub_if_d©a
 *
sd©a
,

1309 
›“80211_chªÃl
 *
chª
,

1310 
du¿tiÚ
,

1311 
›“80211_roc_ty³
 
ty³
),

1313 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
chª
, 
du¿tiÚ
, 
ty³
),

1315 
	`TP_STRUCT__’Œy
(

1316 
LOCAL_ENTRY


1317 
VIF_ENTRY


1318 
	$__f›ld
(, 
ûÁ”_äeq
)

1319 
	$__f›ld
(, 
äeq_off£t
)

1320 
	$__f›ld
(, 
du¿tiÚ
)

1321 
	`__f›ld
(
u32
, 
ty³
)

1324 
	`TP_ç¡_assign
(

1325 
LOCAL_ASSIGN
;

1326 
VIF_ASSIGN
;

1327 
__’Œy
->
ûÁ”_äeq
 = 
chª
->center_freq;

1328 
__’Œy
->
äeq_off£t
 = 
chª
->freq_offset;

1329 
__’Œy
->
du¿tiÚ
 = duration;

1330 
__’Œy
->
ty³
 =ype;

1333 
	`TP_´štk
(

1334 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " freq:%d.%03dMHz duration:%dmsype=%d",

1335 
LOCAL_PR_ARG
, 
VIF_PR_ARG
,

1336 
__’Œy
->
ûÁ”_äeq
, __’Œy->
äeq_off£t
,

1337 
__’Œy
->
du¿tiÚ
, __’Œy->
ty³


1341 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_ÿnûl_»maš_Ú_chªÃl
,

1342 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1343 
›“80211_sub_if_d©a
 *
sd©a
),

1344 
	`TP_ARGS
(
loÿl
, 
sd©a
)

1347 
	`TRACE_EVENT
(
drv_£t_ršg·¿m
,

1348 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 
tx
, u32 
rx
),

1350 
	`TP_ARGS
(
loÿl
, 
tx
, 
rx
),

1352 
	`TP_STRUCT__’Œy
(

1353 
LOCAL_ENTRY


1354 
	$__f›ld
(
u32
, 
tx
)

1355 
	`__f›ld
(
u32
, 
rx
)

1358 
	`TP_ç¡_assign
(

1359 
LOCAL_ASSIGN
;

1360 
__’Œy
->
tx
 =x;

1361 
__’Œy
->
rx
 =„x;

1364 
	`TP_´štk
(

1365 
LOCAL_PR_FMT
 "x:%d„x %d",

1366 
LOCAL_PR_ARG
, 
__’Œy
->
tx
, __’Œy->
rx


1370 
	`TRACE_EVENT
(
drv_g‘_ršg·¿m
,

1371 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u32
 *
tx
, u32 *
tx_max
,

1372 
u32
 *
rx
, u32 *
rx_max
),

1374 
	`TP_ARGS
(
loÿl
, 
tx
, 
tx_max
, 
rx
, 
rx_max
),

1376 
	`TP_STRUCT__’Œy
(

1377 
LOCAL_ENTRY


1378 
	$__f›ld
(
u32
, 
tx
)

1379 
	$__f›ld
(
u32
, 
tx_max
)

1380 
	$__f›ld
(
u32
, 
rx
)

1381 
	`__f›ld
(
u32
, 
rx_max
)

1384 
	`TP_ç¡_assign
(

1385 
LOCAL_ASSIGN
;

1386 
__’Œy
->
tx
 = *tx;

1387 
__’Œy
->
tx_max
 = *tx_max;

1388 
__’Œy
->
rx
 = *rx;

1389 
__’Œy
->
rx_max
 = *rx_max;

1392 
	`TP_´štk
(

1393 
LOCAL_PR_FMT
 "x:%dx_max %d„x %d„x_max %d",

1394 
LOCAL_PR_ARG
,

1395 
__’Œy
->
tx
, __’Œy->
tx_max
, __’Œy->
rx
, __’Œy->
rx_max


1399 
	`DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_tx_äames_³ndšg
,

1400 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

1401 
	`TP_ARGS
(
loÿl
)

1404 
	`DEFINE_EVENT
(
loÿl_Úly_evt
, 
drv_offchªÃl_tx_ÿnûl_wa™
,

1405 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

1406 
	`TP_ARGS
(
loÿl
)

1409 
	`TRACE_EVENT
(
drv_£t_b™¿‹_mask
,

1410 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1411 
›“80211_sub_if_d©a
 *
sd©a
,

1412 cÚ¡ 
cfg80211_b™¿‹_mask
 *
mask
),

1414 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
mask
),

1416 
	`TP_STRUCT__’Œy
(

1417 
LOCAL_ENTRY


1418 
VIF_ENTRY


1419 
	$__f›ld
(
u32
, 
Ëgacy_2g
)

1420 
	`__f›ld
(
u32
, 
Ëgacy_5g
)

1423 
	`TP_ç¡_assign
(

1424 
LOCAL_ASSIGN
;

1425 
VIF_ASSIGN
;

1426 
__’Œy
->
Ëgacy_2g
 = 
mask
->
cÚŒŞ
[
NL80211_BAND_2GHZ
].
Ëgacy
;

1427 
__’Œy
->
Ëgacy_5g
 = 
mask
->
cÚŒŞ
[
NL80211_BAND_5GHZ
].
Ëgacy
;

1430 
	`TP_´štk
(

1431 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " 2G Mask:0x%x 5G Mask:0x%x",

1432 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
Ëgacy_2g
, __’Œy->
Ëgacy_5g


1436 
	`TRACE_EVENT
(
drv_£t_»key_d©a
,

1437 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1438 
›“80211_sub_if_d©a
 *
sd©a
,

1439 
cfg80211_gtk_»key_d©a
 *
d©a
),

1441 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
d©a
),

1443 
	`TP_STRUCT__’Œy
(

1444 
LOCAL_ENTRY


1445 
VIF_ENTRY


1446 
	$__¬¿y
(
u8
, 
kek
, 
NL80211_KEK_LEN
)

1447 
	$__¬¿y
(
u8
, 
kck
, 
NL80211_KCK_LEN
)

1448 
	`__¬¿y
(
u8
, 
»¶ay_ùr
, 
NL80211_REPLAY_CTR_LEN
)

1451 
	`TP_ç¡_assign
(

1452 
LOCAL_ASSIGN
;

1453 
VIF_ASSIGN
;

1454 
	`memıy
(
__’Œy
->
kek
, 
d©a
->kek, 
NL80211_KEK_LEN
);

1455 
	`memıy
(
__’Œy
->
kck
, 
d©a
->kck, 
NL80211_KCK_LEN
);

1456 
	`memıy
(
__’Œy
->
»¶ay_ùr
, 
d©a
->replay_ctr,

1457 
NL80211_REPLAY_CTR_LEN
);

1460 
	`TP_´štk
(
LOCAL_PR_FMT
 
VIF_PR_FMT
,

1461 
LOCAL_PR_ARG
, 
VIF_PR_ARG
)

1464 
	`TRACE_EVENT
(
drv_ev’t_ÿÎback
,

1465 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1466 
›“80211_sub_if_d©a
 *
sd©a
,

1467 cÚ¡ 
›“80211_ev’t
 *
_ev’t
),

1469 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
_ev’t
),

1471 
	`TP_STRUCT__’Œy
(

1472 
LOCAL_ENTRY


1473 
VIF_ENTRY


1474 
	`__f›ld
(
u32
, 
ty³
)

1477 
	`TP_ç¡_assign
(

1478 
LOCAL_ASSIGN
;

1479 
VIF_ASSIGN
;

1480 
__’Œy
->
ty³
 = 
_ev’t
->type;

1483 
	`TP_´štk
(

1484 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "ƒvent:%d",

1485 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
ty³


1489 
	`DECLARE_EVENT_CLASS
(
»Ëa£_evt
,

1490 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1491 
›“80211_¡a
 *
¡a
,

1492 
u16
 
tids
, 
num_äames
,

1493 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

1494 
boŞ
 
mÜe_d©a
),

1496 
	`TP_ARGS
(
loÿl
, 
¡a
, 
tids
, 
num_äames
, 
»asÚ
, 
mÜe_d©a
),

1498 
	`TP_STRUCT__’Œy
(

1499 
LOCAL_ENTRY


1500 
STA_ENTRY


1501 
	$__f›ld
(
u16
, 
tids
)

1502 
	$__f›ld
(, 
num_äames
)

1503 
	$__f›ld
(, 
»asÚ
)

1504 
	`__f›ld
(
boŞ
, 
mÜe_d©a
)

1507 
	`TP_ç¡_assign
(

1508 
LOCAL_ASSIGN
;

1509 
STA_ASSIGN
;

1510 
__’Œy
->
tids
 =ids;

1511 
__’Œy
->
num_äames
 =‚um_frames;

1512 
__’Œy
->
»asÚ
 =„eason;

1513 
__’Œy
->
mÜe_d©a
 = more_data;

1516 
	`TP_´štk
(

1517 
LOCAL_PR_FMT
 
STA_PR_FMT


1519 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
tids
, __’Œy->
num_äames
,

1520 
__’Œy
->
»asÚ
, __’Œy->
mÜe_d©a


1524 
	`DEFINE_EVENT
(
»Ëa£_evt
, 
drv_»Ëa£_bufã»d_äames
,

1525 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1526 
›“80211_¡a
 *
¡a
,

1527 
u16
 
tids
, 
num_äames
,

1528 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

1529 
boŞ
 
mÜe_d©a
),

1531 
	`TP_ARGS
(
loÿl
, 
¡a
, 
tids
, 
num_äames
, 
»asÚ
, 
mÜe_d©a
)

1534 
	`DEFINE_EVENT
(
»Ëa£_evt
, 
drv_®low_bufã»d_äames
,

1535 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1536 
›“80211_¡a
 *
¡a
,

1537 
u16
 
tids
, 
num_äames
,

1538 
›“80211_äame_»Ëa£_ty³
 
»asÚ
,

1539 
boŞ
 
mÜe_d©a
),

1541 
	`TP_ARGS
(
loÿl
, 
¡a
, 
tids
, 
num_äames
, 
»asÚ
, 
mÜe_d©a
)

1544 
	`DECLARE_EVENT_CLASS
(
mgd_´•¬e_com¶‘e_tx_evt
,

1545 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1546 
›“80211_sub_if_d©a
 *
sd©a
,

1547 
u16
 
du¿tiÚ
, u16 
subty³
, 
boŞ
 
sucûss
),

1549 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
du¿tiÚ
, 
subty³
, 
sucûss
),

1551 
	`TP_STRUCT__’Œy
(

1552 
LOCAL_ENTRY


1553 
VIF_ENTRY


1554 
	$__f›ld
(
u32
, 
du¿tiÚ
)

1555 
	$__f›ld
(
u16
, 
subty³
)

1556 
	`__f›ld
(
u8
, 
sucûss
)

1559 
	`TP_ç¡_assign
(

1560 
LOCAL_ASSIGN
;

1561 
VIF_ASSIGN
;

1562 
__’Œy
->
du¿tiÚ
 = duration;

1563 
__’Œy
->
subty³
 = subtype;

1564 
__’Œy
->
sucûss
 = success;

1567 
	`TP_´štk
(

1568 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " duration: %u, subtype:0x%x, success:%d",

1569 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
du¿tiÚ
,

1570 
__’Œy
->
subty³
, __’Œy->
sucûss


1574 
	`DEFINE_EVENT
(
mgd_´•¬e_com¶‘e_tx_evt
, 
drv_mgd_´•¬e_tx
,

1575 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1576 
›“80211_sub_if_d©a
 *
sd©a
,

1577 
u16
 
du¿tiÚ
, u16 
subty³
, 
boŞ
 
sucûss
),

1579 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
du¿tiÚ
, 
subty³
, 
sucûss
)

1582 
	`DEFINE_EVENT
(
mgd_´•¬e_com¶‘e_tx_evt
, 
drv_mgd_com¶‘e_tx
,

1583 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1584 
›“80211_sub_if_d©a
 *
sd©a
,

1585 
u16
 
du¿tiÚ
, u16 
subty³
, 
boŞ
 
sucûss
),

1587 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
du¿tiÚ
, 
subty³
, 
sucûss
)

1590 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_mgd_´Ùeù_tdls_discov”
,

1591 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1592 
›“80211_sub_if_d©a
 *
sd©a
),

1594 
	`TP_ARGS
(
loÿl
, 
sd©a
)

1597 
	`DECLARE_EVENT_CLASS
(
loÿl_chªùx
,

1598 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1599 
›“80211_chªùx
 *
ùx
),

1601 
	`TP_ARGS
(
loÿl
, 
ùx
),

1603 
	`TP_STRUCT__’Œy
(

1604 
LOCAL_ENTRY


1605 
CHANCTX_ENTRY


1608 
	`TP_ç¡_assign
(

1609 
LOCAL_ASSIGN
;

1610 
CHANCTX_ASSIGN
;

1613 
	`TP_´štk
(

1614 
LOCAL_PR_FMT
 
CHANCTX_PR_FMT
,

1615 
LOCAL_PR_ARG
, 
CHANCTX_PR_ARG


1619 
	`DEFINE_EVENT
(
loÿl_chªùx
, 
drv_add_chªùx
,

1620 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1621 
›“80211_chªùx
 *
ùx
),

1622 
	`TP_ARGS
(
loÿl
, 
ùx
)

1625 
	`DEFINE_EVENT
(
loÿl_chªùx
, 
drv_»move_chªùx
,

1626 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1627 
›“80211_chªùx
 *
ùx
),

1628 
	`TP_ARGS
(
loÿl
, 
ùx
)

1631 
	`TRACE_EVENT
(
drv_chªge_chªùx
,

1632 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1633 
›“80211_chªùx
 *
ùx
,

1634 
u32
 
chªged
),

1636 
	`TP_ARGS
(
loÿl
, 
ùx
, 
chªged
),

1638 
	`TP_STRUCT__’Œy
(

1639 
LOCAL_ENTRY


1640 
CHANCTX_ENTRY


1641 
	`__f›ld
(
u32
, 
chªged
)

1644 
	`TP_ç¡_assign
(

1645 
LOCAL_ASSIGN
;

1646 
CHANCTX_ASSIGN
;

1647 
__’Œy
->
chªged
 = changed;

1650 
	`TP_´štk
(

1651 
LOCAL_PR_FMT
 
CHANCTX_PR_FMT
 " changed:%#x",

1652 
LOCAL_PR_ARG
, 
CHANCTX_PR_ARG
, 
__’Œy
->
chªged


1656 #ià!
	`defšed
(
__TRACE_VIF_ENTRY
)

1657 
	#__TRACE_VIF_ENTRY


	)

1658 
	sŒaû_vif_’Œy
 {

1659 
Æ80211_iáy³
 
vif_ty³
;

1660 
boŞ
 
p2p
;

1661 
vif_Çme
[
IFNAMSIZ
];

1662 } 
__·cked
;

1664 
	sŒaû_chªdef_’Œy
 {

1665 
u32
 
cÚŒŞ_äeq
;

1666 
u32
 
äeq_off£t
;

1667 
u32
 
chª_width
;

1668 
u32
 
ûÁ”_äeq1
;

1669 
u32
 
äeq1_off£t
;

1670 
u32
 
ûÁ”_äeq2
;

1671 } 
__·cked
;

1673 
	sŒaû_sw™ch_’Œy
 {

1674 
Œaû_vif_’Œy
 
vif
;

1675 
lšk_id
;

1676 
Œaû_chªdef_’Œy
 
Şd_chªdef
;

1677 
Œaû_chªdef_’Œy
 
Ãw_chªdef
;

1678 } 
__·cked
;

1680 
	#SWITCH_ENTRY_ASSIGN
(
to
, 
äom
è
loÿl_vifs
[
i
].tØğ
vifs
[i].
	)
from

1683 
	`TRACE_EVENT
(
drv_sw™ch_vif_chªùx
,

1684 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1685 
›“80211_vif_chªùx_sw™ch
 *
vifs
,

1686 
n_vifs
, 
›“80211_chªùx_sw™ch_mode
 
mode
),

1687 
	`TP_ARGS
(
loÿl
, 
vifs
, 
n_vifs
, 
mode
),

1689 
	`TP_STRUCT__’Œy
(

1690 
LOCAL_ENTRY


1691 
	$__f›ld
(, 
n_vifs
)

1692 
	$__f›ld
(
u32
, 
mode
)

1693 
	`__dyÇmic_¬¿y
(
u8
, 
vifs
,

1694 (
Œaû_sw™ch_’Œy
è* 
n_vifs
)

1697 
	`TP_ç¡_assign
(

1698 
LOCAL_ASSIGN
;

1699 
__’Œy
->
n_vifs
 =‚_vifs;

1700 
__’Œy
->
mode
 = mode;

1702 
Œaû_sw™ch_’Œy
 *
loÿl_vifs
 =

1703 
	`__g‘_dyÇmic_¬¿y
(
vifs
);

1704 
i
;

1706 
i
 = 0; i < 
n_vifs
; i++) {

1707 
›“80211_sub_if_d©a
 *
sd©a
;

1709 
sd©a
 = 
	`cÚš”_of
(
vifs
[
i
].
vif
,

1710 
›“80211_sub_if_d©a
,

1711 
vif
);

1713 
	`SWITCH_ENTRY_ASSIGN
(
vif
.
vif_ty³
, vif->
ty³
);

1714 
	`SWITCH_ENTRY_ASSIGN
(
vif
.
p2p
, vif->p2p);

1715 
	`SWITCH_ENTRY_ASSIGN
(
lšk_id
, 
lšk_cÚf
->link_id);

1716 
	`¡ºıy
(
loÿl_vifs
[
i
].
vif
.
vif_Çme
,

1717 
sd©a
->
Çme
,

1718 (
loÿl_vifs
[
i
].
vif
.
vif_Çme
));

1719 
	`SWITCH_ENTRY_ASSIGN
(
Şd_chªdef
.
cÚŒŞ_äeq
,

1720 
Şd_ùx
->
def
.
chª
->
ûÁ”_äeq
);

1721 
	`SWITCH_ENTRY_ASSIGN
(
Şd_chªdef
.
äeq_off£t
,

1722 
Şd_ùx
->
def
.
chª
->
äeq_off£t
);

1723 
	`SWITCH_ENTRY_ASSIGN
(
Şd_chªdef
.
chª_width
,

1724 
Şd_ùx
->
def
.
width
);

1725 
	`SWITCH_ENTRY_ASSIGN
(
Şd_chªdef
.
ûÁ”_äeq1
,

1726 
Şd_ùx
->
def
.
ûÁ”_äeq1
);

1727 
	`SWITCH_ENTRY_ASSIGN
(
Şd_chªdef
.
äeq1_off£t
,

1728 
Şd_ùx
->
def
.
äeq1_off£t
);

1729 
	`SWITCH_ENTRY_ASSIGN
(
Şd_chªdef
.
ûÁ”_äeq2
,

1730 
Şd_ùx
->
def
.
ûÁ”_äeq2
);

1731 
	`SWITCH_ENTRY_ASSIGN
(
Ãw_chªdef
.
cÚŒŞ_äeq
,

1732 
Ãw_ùx
->
def
.
chª
->
ûÁ”_äeq
);

1733 
	`SWITCH_ENTRY_ASSIGN
(
Ãw_chªdef
.
äeq_off£t
,

1734 
Ãw_ùx
->
def
.
chª
->
äeq_off£t
);

1735 
	`SWITCH_ENTRY_ASSIGN
(
Ãw_chªdef
.
chª_width
,

1736 
Ãw_ùx
->
def
.
width
);

1737 
	`SWITCH_ENTRY_ASSIGN
(
Ãw_chªdef
.
ûÁ”_äeq1
,

1738 
Ãw_ùx
->
def
.
ûÁ”_äeq1
);

1739 
	`SWITCH_ENTRY_ASSIGN
(
Ãw_chªdef
.
äeq1_off£t
,

1740 
Ãw_ùx
->
def
.
äeq1_off£t
);

1741 
	`SWITCH_ENTRY_ASSIGN
(
Ãw_chªdef
.
ûÁ”_äeq2
,

1742 
Ãw_ùx
->
def
.
ûÁ”_äeq2
);

1744 
	}
}

1747 
TP_´štk
(

1748 
LOCAL_PR_FMT
 "‚_vifs:%d mode:%d",

1749 
LOCAL_PR_ARG
, 
__’Œy
->
n_vifs
, __’Œy->
mode


1753 
DECLARE_EVENT_CLASS
(
loÿl_sd©a_chªùx
,

1754 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1755 
›“80211_sub_if_d©a
 *
sd©a
,

1756 
›“80211_bss_cÚf
 *
lšk_cÚf
,

1757 
›“80211_chªùx
 *
ùx
),

1759 
TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_cÚf
, 
ùx
),

1761 
TP_STRUCT__’Œy
(

1762 
LOCAL_ENTRY


1763 
VIF_ENTRY


1764 
CHANCTX_ENTRY


1765 
__f›ld
(, 
lšk_id
)

1768 
TP_ç¡_assign
(

1769 
LOCAL_ASSIGN
;

1770 
VIF_ASSIGN
;

1771 
CHANCTX_ASSIGN
;

1772 
__’Œy
->
lšk_id
 = 
lšk_cÚf
->link_id;

1775 
TP_´štk
(

1776 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "†šk_id:%d" 
CHANCTX_PR_FMT
,

1777 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
lšk_id
, 
CHANCTX_PR_ARG


1781 
DEFINE_EVENT
(
loÿl_sd©a_chªùx
, 
drv_assign_vif_chªùx
,

1782 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1783 
›“80211_sub_if_d©a
 *
sd©a
,

1784 
›“80211_bss_cÚf
 *
lšk_cÚf
,

1785 
›“80211_chªùx
 *
ùx
),

1786 
TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_cÚf
, 
ùx
)

1789 
DEFINE_EVENT
(
loÿl_sd©a_chªùx
, 
drv_uÇssign_vif_chªùx
,

1790 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1791 
›“80211_sub_if_d©a
 *
sd©a
,

1792 
›“80211_bss_cÚf
 *
lšk_cÚf
,

1793 
›“80211_chªùx
 *
ùx
),

1794 
TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_cÚf
, 
ùx
)

1797 
TRACE_EVENT
(
drv_¡¬t_­
,

1798 
TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1799 
›“80211_sub_if_d©a
 *
sd©a
,

1800 
›“80211_bss_cÚf
 *
lšk_cÚf
),

1802 
TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_cÚf
),

1804 
TP_STRUCT__’Œy
(

1805 
LOCAL_ENTRY


1806 
VIF_ENTRY


1807 
	$__f›ld
(
u32
, 
lšk_id
)

1808 
	$__f›ld
(
u8
, 
dtim³r
)

1809 
	$__f›ld
(
u16
, 
búšt
)

1810 
	`__dyÇmic_¬¿y
(
u8
, 
ssid
, 
sd©a
->
vif
.
cfg
.
ssid_Ën
)

1811 
	`__f›ld
(
boŞ
, 
hidd’_ssid
)

1814 
	`TP_ç¡_assign
(

1815 
LOCAL_ASSIGN
;

1816 
VIF_ASSIGN
;

1817 
__’Œy
->
lšk_id
 = 
lšk_cÚf
->link_id;

1818 
__’Œy
->
dtim³r
 = 
lšk_cÚf
->
dtim_³riod
;

1819 
__’Œy
->
búšt
 = 
lšk_cÚf
->
b—cÚ_št
;

1820 
__’Œy
->
hidd’_ssid
 = 
lšk_cÚf
->hidden_ssid;

1821 
	`memıy
(
	`__g‘_dyÇmic_¬¿y
(
ssid
),

1822 
sd©a
->
vif
.
cfg
.
ssid
,

1823 
sd©a
->
vif
.
cfg
.
ssid_Ën
);

1826 
	`TP_´štk
(

1827 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "†ink id %u",

1828 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
lšk_id


1832 
	`TRACE_EVENT
(
drv_¡İ_­
,

1833 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1834 
›“80211_sub_if_d©a
 *
sd©a
,

1835 
›“80211_bss_cÚf
 *
lšk_cÚf
),

1837 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
lšk_cÚf
),

1839 
	`TP_STRUCT__’Œy
(

1840 
LOCAL_ENTRY


1841 
VIF_ENTRY


1842 
	`__f›ld
(
u32
, 
lšk_id
)

1845 
	`TP_ç¡_assign
(

1846 
LOCAL_ASSIGN
;

1847 
VIF_ASSIGN
;

1848 
__’Œy
->
lšk_id
 = 
lšk_cÚf
->link_id;

1851 
	`TP_´štk
(

1852 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "†ink id %u",

1853 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
lšk_id


1857 
	`TRACE_EVENT
(
drv_»cÚfig_com¶‘e
,

1858 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1859 
›“80211_»cÚfig_ty³
 
»cÚfig_ty³
),

1860 
	`TP_ARGS
(
loÿl
, 
»cÚfig_ty³
),

1862 
	`TP_STRUCT__’Œy
(

1863 
LOCAL_ENTRY


1864 
	`__f›ld
(
u8
, 
»cÚfig_ty³
)

1867 
	`TP_ç¡_assign
(

1868 
LOCAL_ASSIGN
;

1869 
__’Œy
->
»cÚfig_ty³
 =„econfig_type;

1872 
	`TP_´štk
(

1873 
LOCAL_PR_FMT
 "„econfig_type:%d",

1874 
LOCAL_PR_ARG
, 
__’Œy
->
»cÚfig_ty³


1879 #ià
	`IS_ENABLED
(
CONFIG_IPV6
)

1880 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_v6_addr_chªge
,

1881 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1882 
›“80211_sub_if_d©a
 *
sd©a
),

1883 
	`TP_ARGS
(
loÿl
, 
sd©a
)

1887 
	`TRACE_EVENT
(
drv_još_ibss
,

1888 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1889 
›“80211_sub_if_d©a
 *
sd©a
,

1890 
›“80211_bss_cÚf
 *
šfo
),

1892 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
šfo
),

1894 
	`TP_STRUCT__’Œy
(

1895 
LOCAL_ENTRY


1896 
VIF_ENTRY


1897 
	$__f›ld
(
u8
, 
dtim³r
)

1898 
	$__f›ld
(
u16
, 
búšt
)

1899 
	`__dyÇmic_¬¿y
(
u8
, 
ssid
, 
sd©a
->
vif
.
cfg
.
ssid_Ën
)

1902 
	`TP_ç¡_assign
(

1903 
LOCAL_ASSIGN
;

1904 
VIF_ASSIGN
;

1905 
__’Œy
->
dtim³r
 = 
šfo
->
dtim_³riod
;

1906 
__’Œy
->
búšt
 = 
šfo
->
b—cÚ_št
;

1907 
	`memıy
(
	`__g‘_dyÇmic_¬¿y
(
ssid
),

1908 
sd©a
->
vif
.
cfg
.
ssid
,

1909 
sd©a
->
vif
.
cfg
.
ssid_Ën
);

1912 
	`TP_´štk
(

1913 
LOCAL_PR_FMT
 
VIF_PR_FMT
,

1914 
LOCAL_PR_ARG
, 
VIF_PR_ARG


1918 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_Ëave_ibss
,

1919 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1920 
›“80211_sub_if_d©a
 *
sd©a
),

1921 
	`TP_ARGS
(
loÿl
, 
sd©a
)

1924 
	`TRACE_EVENT
(
drv_g‘_ex³ùed_throughput
,

1925 
	`TP_PROTO
(
›“80211_¡a
 *
¡a
),

1927 
	`TP_ARGS
(
¡a
),

1929 
	`TP_STRUCT__’Œy
(

1930 
STA_ENTRY


1933 
	`TP_ç¡_assign
(

1934 
STA_ASSIGN
;

1937 
	`TP_´štk
(

1938 
STA_PR_FMT
, 
STA_PR_ARG


1942 
	`TRACE_EVENT
(
drv_¡¬t_Çn
,

1943 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1944 
›“80211_sub_if_d©a
 *
sd©a
,

1945 
cfg80211_Çn_cÚf
 *
cÚf
),

1947 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
cÚf
),

1948 
	`TP_STRUCT__’Œy
(

1949 
LOCAL_ENTRY


1950 
VIF_ENTRY


1951 
	$__f›ld
(
u8
, 
ma¡”_´ef
)

1952 
	`__f›ld
(
u8
, 
bªds
)

1955 
	`TP_ç¡_assign
(

1956 
LOCAL_ASSIGN
;

1957 
VIF_ASSIGN
;

1958 
__’Œy
->
ma¡”_´ef
 = 
cÚf
->master_pref;

1959 
__’Œy
->
bªds
 = 
cÚf
->bands;

1962 
	`TP_´štk
(

1963 
LOCAL_PR_FMT
 
VIF_PR_FMT


1965 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
ma¡”_´ef
,

1966 
__’Œy
->
bªds


1970 
	`TRACE_EVENT
(
drv_¡İ_Çn
,

1971 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1972 
›“80211_sub_if_d©a
 *
sd©a
),

1974 
	`TP_ARGS
(
loÿl
, 
sd©a
),

1976 
	`TP_STRUCT__’Œy
(

1977 
LOCAL_ENTRY


1978 
VIF_ENTRY


1981 
	`TP_ç¡_assign
(

1982 
LOCAL_ASSIGN
;

1983 
VIF_ASSIGN
;

1986 
	`TP_´štk
(

1987 
LOCAL_PR_FMT
 
VIF_PR_FMT
,

1988 
LOCAL_PR_ARG
, 
VIF_PR_ARG


1992 
	`TRACE_EVENT
(
drv_Çn_chªge_cÚf
,

1993 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

1994 
›“80211_sub_if_d©a
 *
sd©a
,

1995 
cfg80211_Çn_cÚf
 *
cÚf
,

1996 
u32
 
chªges
),

1998 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
cÚf
, 
chªges
),

1999 
	`TP_STRUCT__’Œy
(

2000 
LOCAL_ENTRY


2001 
VIF_ENTRY


2002 
	$__f›ld
(
u8
, 
ma¡”_´ef
)

2003 
	$__f›ld
(
u8
, 
bªds
)

2004 
	`__f›ld
(
u32
, 
chªges
)

2007 
	`TP_ç¡_assign
(

2008 
LOCAL_ASSIGN
;

2009 
VIF_ASSIGN
;

2010 
__’Œy
->
ma¡”_´ef
 = 
cÚf
->master_pref;

2011 
__’Œy
->
bªds
 = 
cÚf
->bands;

2012 
__’Œy
->
chªges
 = changes;

2015 
	`TP_´štk
(

2016 
LOCAL_PR_FMT
 
VIF_PR_FMT


2018 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
ma¡”_´ef
,

2019 
__’Œy
->
bªds
, __’Œy->
chªges


2023 
	`TRACE_EVENT
(
drv_add_Çn_func
,

2024 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2025 
›“80211_sub_if_d©a
 *
sd©a
,

2026 cÚ¡ 
cfg80211_Çn_func
 *
func
),

2028 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
func
),

2029 
	`TP_STRUCT__’Œy
(

2030 
LOCAL_ENTRY


2031 
VIF_ENTRY


2032 
	$__f›ld
(
u8
, 
ty³
)

2033 
	`__f›ld
(
u8
, 
š¡_id
)

2036 
	`TP_ç¡_assign
(

2037 
LOCAL_ASSIGN
;

2038 
VIF_ASSIGN
;

2039 
__’Œy
->
ty³
 = 
func
->type;

2040 
__’Œy
->
š¡_id
 = 
func
->
š¡ªû_id
;

2043 
	`TP_´štk
(

2044 
LOCAL_PR_FMT
 
VIF_PR_FMT


2046 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
ty³
, __’Œy->
š¡_id


2050 
	`TRACE_EVENT
(
drv_d–_Çn_func
,

2051 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2052 
›“80211_sub_if_d©a
 *
sd©a
,

2053 
u8
 
š¡ªû_id
),

2055 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
š¡ªû_id
),

2056 
	`TP_STRUCT__’Œy
(

2057 
LOCAL_ENTRY


2058 
VIF_ENTRY


2059 
	`__f›ld
(
u8
, 
š¡ªû_id
)

2062 
	`TP_ç¡_assign
(

2063 
LOCAL_ASSIGN
;

2064 
VIF_ASSIGN
;

2065 
__’Œy
->
š¡ªû_id
 = instance_id;

2068 
	`TP_´štk
(

2069 
LOCAL_PR_FMT
 
VIF_PR_FMT


2071 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
š¡ªû_id


2075 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_¡¬t_pm¤
,

2076 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2077 
›“80211_sub_if_d©a
 *
sd©a
),

2078 
	`TP_ARGS
(
loÿl
, 
sd©a
)

2081 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_abÜt_pm¤
,

2082 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2083 
›“80211_sub_if_d©a
 *
sd©a
),

2084 
	`TP_ARGS
(
loÿl
, 
sd©a
)

2087 
	`TRACE_EVENT
(
drv_£t_deçuÉ_uniÿ¡_key
,

2088 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2089 
›“80211_sub_if_d©a
 *
sd©a
,

2090 
key_idx
),

2092 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
key_idx
),

2094 
	`TP_STRUCT__’Œy
(

2095 
LOCAL_ENTRY


2096 
VIF_ENTRY


2097 
	`__f›ld
(, 
key_idx
)

2100 
	`TP_ç¡_assign
(

2101 
LOCAL_ASSIGN
;

2102 
VIF_ASSIGN
;

2103 
__’Œy
->
key_idx
 = key_idx;

2106 
	`TP_´štk
(
LOCAL_PR_FMT
 
VIF_PR_FMT
 " key_idx:%d",

2107 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
key_idx
)

2110 
	`TRACE_EVENT
(
drv_chªÃl_sw™ch_b—cÚ
,

2111 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2112 
›“80211_sub_if_d©a
 *
sd©a
,

2113 
cfg80211_chª_def
 *
chªdef
),

2115 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
chªdef
),

2117 
	`TP_STRUCT__’Œy
(

2118 
LOCAL_ENTRY


2119 
VIF_ENTRY


2120 
CHANDEF_ENTRY


2123 
	`TP_ç¡_assign
(

2124 
LOCAL_ASSIGN
;

2125 
VIF_ASSIGN
;

2126 
	`CHANDEF_ASSIGN
(
chªdef
);

2129 
	`TP_´štk
(

2130 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " chªÃÈsw™chØ" 
CHANDEF_PR_FMT
,

2131 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
CHANDEF_PR_ARG


2135 
	`DEFINE_EVENT
(
chªsw™ch_evt
, 
drv_´e_chªÃl_sw™ch
,

2136 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2137 
›“80211_sub_if_d©a
 *
sd©a
,

2138 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
),

2139 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
ch_sw™ch
)

2142 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_po¡_chªÃl_sw™ch
,

2143 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2144 
›“80211_sub_if_d©a
 *
sd©a
),

2145 
	`TP_ARGS
(
loÿl
, 
sd©a
)

2148 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
drv_abÜt_chªÃl_sw™ch
,

2149 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2150 
›“80211_sub_if_d©a
 *
sd©a
),

2151 
	`TP_ARGS
(
loÿl
, 
sd©a
)

2154 
	`DEFINE_EVENT
(
chªsw™ch_evt
, 
drv_chªÃl_sw™ch_rx_b—cÚ
,

2155 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2156 
›“80211_sub_if_d©a
 *
sd©a
,

2157 
›“80211_chªÃl_sw™ch
 *
ch_sw™ch
),

2158 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
ch_sw™ch
)

2161 
	`TRACE_EVENT
(
drv_g‘_txpow”
,

2162 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2163 
›“80211_sub_if_d©a
 *
sd©a
,

2164 
dbm
, 
»t
),

2166 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
dbm
, 
»t
),

2168 
	`TP_STRUCT__’Œy
(

2169 
LOCAL_ENTRY


2170 
VIF_ENTRY


2171 
	$__f›ld
(, 
dbm
)

2172 
	`__f›ld
(, 
»t
)

2175 
	`TP_ç¡_assign
(

2176 
LOCAL_ASSIGN
;

2177 
VIF_ASSIGN
;

2178 
__’Œy
->
dbm
 = dbm;

2179 
__’Œy
->
»t
 =„et;

2182 
	`TP_´štk
(

2183 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " dbm:%d„et:%d",

2184 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
dbm
, __’Œy->
»t


2188 
	`TRACE_EVENT
(
drv_tdls_chªÃl_sw™ch
,

2189 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2190 
›“80211_sub_if_d©a
 *
sd©a
,

2191 
›“80211_¡a
 *
¡a
, 
u8
 
İ”_şass
,

2192 
cfg80211_chª_def
 *
chªdef
),

2194 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
İ”_şass
, 
chªdef
),

2196 
	`TP_STRUCT__’Œy
(

2197 
LOCAL_ENTRY


2198 
VIF_ENTRY


2199 
STA_ENTRY


2200 
	$__f›ld
(
u8
, 
İ”_şass
)

2201 
CHANDEF_ENTRY


2204 
	`TP_ç¡_assign
(

2205 
LOCAL_ASSIGN
;

2206 
VIF_ASSIGN
;

2207 
STA_ASSIGN
;

2208 
__’Œy
->
İ”_şass
 = oper_class;

2209 
	`CHANDEF_ASSIGN
(
chªdef
)

2212 
	`TP_´štk
(

2213 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "dls channel switcho"

2214 
CHANDEF_PR_FMT
 " o³r_şass:%d " 
STA_PR_FMT
,

2215 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
CHANDEF_PR_ARG
, 
__’Œy
->
İ”_şass
,

2216 
STA_PR_ARG


2220 
	`TRACE_EVENT
(
drv_tdls_ÿnûl_chªÃl_sw™ch
,

2221 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2222 
›“80211_sub_if_d©a
 *
sd©a
,

2223 
›“80211_¡a
 *
¡a
),

2225 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
),

2227 
	`TP_STRUCT__’Œy
(

2228 
LOCAL_ENTRY


2229 
VIF_ENTRY


2230 
STA_ENTRY


2233 
	`TP_ç¡_assign
(

2234 
LOCAL_ASSIGN
;

2235 
VIF_ASSIGN
;

2236 
STA_ASSIGN
;

2239 
	`TP_´štk
(

2240 
LOCAL_PR_FMT
 
VIF_PR_FMT


2241 "dl ÿnûÈchªÃÈsw™ch w™h " 
STA_PR_FMT
,

2242 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG


2246 
	`TRACE_EVENT
(
drv_tdls_»cv_chªÃl_sw™ch
,

2247 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2248 
›“80211_sub_if_d©a
 *
sd©a
,

2249 
›“80211_tdls_ch_sw_·¿ms
 *
·¿ms
),

2251 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
·¿ms
),

2253 
	`TP_STRUCT__’Œy
(

2254 
LOCAL_ENTRY


2255 
VIF_ENTRY


2256 
	$__f›ld
(
u8
, 
aùiÚ_code
)

2257 
STA_ENTRY


2258 
CHANDEF_ENTRY


2259 
	$__f›ld
(
u32
, 
¡©us
)

2260 
	$__f›ld
(
boŞ
, 
³”_š™ŸtÜ
)

2261 
	$__f›ld
(
u32
, 
time¡amp
)

2262 
	$__f›ld
(
u16
, 
sw™ch_time
)

2263 
	`__f›ld
(
u16
, 
sw™ch_timeout
)

2266 
	`TP_ç¡_assign
(

2267 
LOCAL_ASSIGN
;

2268 
VIF_ASSIGN
;

2269 
	`STA_NAMED_ASSIGN
(
·¿ms
->
¡a
);

2270 
	`CHANDEF_ASSIGN
(
·¿ms
->
chªdef
)

2271 
__’Œy
->
³”_š™ŸtÜ
 = 
·¿ms
->
¡a
->
tdls_š™ŸtÜ
;

2272 
__’Œy
->
aùiÚ_code
 = 
·¿ms
->action_code;

2273 
__’Œy
->
¡©us
 = 
·¿ms
->status;

2274 
__’Œy
->
time¡amp
 = 
·¿ms
->timestamp;

2275 
__’Œy
->
sw™ch_time
 = 
·¿ms
->switch_time;

2276 
__’Œy
->
sw™ch_timeout
 = 
·¿ms
->switch_timeout;

2279 
	`TP_´štk
(

2280 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "„eceiveddls channel switch…acket"

2282 "imeout:%d in™ŸtÜ: %d chª:" 
CHANDEF_PR_FMT
 
STA_PR_FMT
,

2283 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
aùiÚ_code
, __’Œy->
¡©us
,

2284 
__’Œy
->
time¡amp
, __’Œy->
sw™ch_time
,

2285 
__’Œy
->
sw™ch_timeout
, __’Œy->
³”_š™ŸtÜ
,

2286 
CHANDEF_PR_ARG
, 
STA_PR_ARG


2290 
	`TRACE_EVENT
(
drv_wake_tx_queue
,

2291 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2292 
›“80211_sub_if_d©a
 *
sd©a
,

2293 
txq_šfo
 *
txq
),

2295 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
txq
),

2297 
	`TP_STRUCT__’Œy
(

2298 
LOCAL_ENTRY


2299 
VIF_ENTRY


2300 
STA_ENTRY


2301 
	$__f›ld
(
u8
, 
ac
)

2302 
	`__f›ld
(
u8
, 
tid
)

2305 
	`TP_ç¡_assign
(

2306 
›“80211_¡a
 *
¡a
 = 
txq
->txq.sta;

2308 
LOCAL_ASSIGN
;

2309 
VIF_ASSIGN
;

2310 
STA_ASSIGN
;

2311 
__’Œy
->
ac
 = 
txq
->txq.ac;

2312 
__’Œy
->
tid
 = 
txq
->txq.tid;

2315 
	`TP_´štk
(

2316 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 "‡c:%did:%d",

2317 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
ac
, __’Œy->
tid


2321 
	`TRACE_EVENT
(
drv_g‘_ám_»¥Úd”_¡©s
,

2322 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2323 
›“80211_sub_if_d©a
 *
sd©a
,

2324 
cfg80211_ám_»¥Úd”_¡©s
 *
ám_¡©s
),

2326 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
ám_¡©s
),

2328 
	`TP_STRUCT__’Œy
(

2329 
LOCAL_ENTRY


2330 
VIF_ENTRY


2333 
	`TP_ç¡_assign
(

2334 
LOCAL_ASSIGN
;

2335 
VIF_ASSIGN
;

2338 
	`TP_´štk
(

2339 
LOCAL_PR_FMT
 
VIF_PR_FMT
,

2340 
LOCAL_PR_ARG
, 
VIF_PR_ARG


2344 
	`DEFINE_EVENT
(
loÿl_sd©a_addr_evt
, 
drv_upd©e_vif_ofæßd
,

2345 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2346 
›“80211_sub_if_d©a
 *
sd©a
),

2347 
	`TP_ARGS
(
loÿl
, 
sd©a
)

2350 
	`DECLARE_EVENT_CLASS
(
¡a_æag_evt
,

2351 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2352 
›“80211_sub_if_d©a
 *
sd©a
,

2353 
›“80211_¡a
 *
¡a
, 
boŞ
 
’abËd
),

2355 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
’abËd
),

2357 
	`TP_STRUCT__’Œy
(

2358 
LOCAL_ENTRY


2359 
VIF_ENTRY


2360 
STA_ENTRY


2361 
	`__f›ld
(
boŞ
, 
’abËd
)

2364 
	`TP_ç¡_assign
(

2365 
LOCAL_ASSIGN
;

2366 
VIF_ASSIGN
;

2367 
STA_ASSIGN
;

2368 
__’Œy
->
’abËd
 =ƒnabled;

2371 
	`TP_´štk
(

2372 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 "ƒnabled:%d",

2373 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
’abËd


2377 
	`DEFINE_EVENT
(
¡a_æag_evt
, 
drv_¡a_£t_4addr
,

2378 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2379 
›“80211_sub_if_d©a
 *
sd©a
,

2380 
›“80211_¡a
 *
¡a
, 
boŞ
 
’abËd
),

2382 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
’abËd
)

2385 
	`DEFINE_EVENT
(
¡a_æag_evt
, 
drv_¡a_£t_deÿp_ofæßd
,

2386 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2387 
›“80211_sub_if_d©a
 *
sd©a
,

2388 
›“80211_¡a
 *
¡a
, 
boŞ
 
’abËd
),

2390 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
’abËd
)

2393 
	`TRACE_EVENT
(
drv_add_twt_£tup
,

2394 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2395 
›“80211_¡a
 *
¡a
,

2396 
›“80211_twt_£tup
 *
twt
,

2397 
›“80211_twt_·¿ms
 *
twt_ag¹
),

2399 
	`TP_ARGS
(
loÿl
, 
¡a
, 
twt
, 
twt_ag¹
),

2401 
	`TP_STRUCT__’Œy
(

2402 
LOCAL_ENTRY


2403 
STA_ENTRY


2404 
	$__f›ld
(
u8
, 
dŸlog_tok’
)

2405 
	$__f›ld
(
u8
, 
cÚŒŞ
)

2406 
	$__f›ld
(
__Ë16
, 
»q_ty³
)

2407 
	$__f›ld
(
__Ë64
, 
twt
)

2408 
	$__f›ld
(
u8
, 
du¿tiÚ
)

2409 
	$__f›ld
(
__Ë16
, 
mªtis§
)

2410 
	`__f›ld
(
u8
, 
chªÃl
)

2413 
	`TP_ç¡_assign
(

2414 
LOCAL_ASSIGN
;

2415 
STA_ASSIGN
;

2416 
__’Œy
->
dŸlog_tok’
 = 
twt
->dialog_token;

2417 
__’Œy
->
cÚŒŞ
 = 
twt
->control;

2418 
__’Œy
->
»q_ty³
 = 
twt_ag¹
->req_type;

2419 
__’Œy
->
twt
 = 
twt_ag¹
->twt;

2420 
__’Œy
->
du¿tiÚ
 = 
twt_ag¹
->
mš_twt_dur
;

2421 
__’Œy
->
mªtis§
 = 
twt_ag¹
->mantissa;

2422 
__’Œy
->
chªÃl
 = 
twt_ag¹
->channel;

2425 
	`TP_´štk
(

2426 
LOCAL_PR_FMT
 
STA_PR_FMT


2429 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
dŸlog_tok’
,

2430 
__’Œy
->
cÚŒŞ
, 
	`Ë16_to_ıu
(__’Œy->
»q_ty³
),

2431 
	`Ë64_to_ıu
(
__’Œy
->
twt
), __’Œy->
du¿tiÚ
,

2432 
	`Ë16_to_ıu
(
__’Œy
->
mªtis§
), __’Œy->
chªÃl


2436 
	`TRACE_EVENT
(
drv_twt_‹¬down_»que¡
,

2437 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2438 
›“80211_¡a
 *
¡a
, 
u8
 
æowid
),

2440 
	`TP_ARGS
(
loÿl
, 
¡a
, 
æowid
),

2442 
	`TP_STRUCT__’Œy
(

2443 
LOCAL_ENTRY


2444 
STA_ENTRY


2445 
	`__f›ld
(
u8
, 
æowid
)

2448 
	`TP_ç¡_assign
(

2449 
LOCAL_ASSIGN
;

2450 
STA_ASSIGN
;

2451 
__’Œy
->
æowid
 = flowid;

2454 
	`TP_´štk
(

2455 
LOCAL_PR_FMT
 
STA_PR_FMT
 " flowid:%d",

2456 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
æowid


2460 
	`DEFINE_EVENT
(
¡a_ev’t
, 
drv_Ãt_fl_fÜw¬d_·th
,

2461 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2462 
›“80211_sub_if_d©a
 *
sd©a
,

2463 
›“80211_¡a
 *
¡a
),

2464 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
)

2467 
	`TRACE_EVENT
(
drv_Ãt_£tup_tc
,

2468 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2469 
›“80211_sub_if_d©a
 *
sd©a
,

2470 
u8
 
ty³
),

2472 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
ty³
),

2474 
	`TP_STRUCT__’Œy
(

2475 
LOCAL_ENTRY


2476 
VIF_ENTRY


2477 
	`__f›ld
(
u8
, 
ty³
)

2480 
	`TP_ç¡_assign
(

2481 
LOCAL_ASSIGN
;

2482 
VIF_ASSIGN
;

2483 
__’Œy
->
ty³
 =ype;

2486 
	`TP_´štk
(

2487 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "ype:%d\n",

2488 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
ty³


2492 
	`TRACE_EVENT
(
drv_ÿn_aùiv©e_lšks
,

2493 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2494 
›“80211_sub_if_d©a
 *
sd©a
,

2495 
u16
 
aùive_lšks
),

2497 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
aùive_lšks
),

2499 
	`TP_STRUCT__’Œy
(

2500 
LOCAL_ENTRY


2501 
VIF_ENTRY


2502 
	`__f›ld
(
u16
, 
aùive_lšks
)

2505 
	`TP_ç¡_assign
(

2506 
LOCAL_ASSIGN
;

2507 
VIF_ASSIGN
;

2508 
__’Œy
->
aùive_lšks
 =‡ctive_links;

2511 
	`TP_´štk
(

2512 
LOCAL_PR_FMT
 
VIF_PR_FMT
 "„equested‡ctive_links:0x%04x\n",

2513 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
aùive_lšks


2517 
	`TRACE_EVENT
(
drv_chªge_vif_lšks
,

2518 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2519 
›“80211_sub_if_d©a
 *
sd©a
,

2520 
u16
 
Şd_lšks
, u16 
Ãw_lšks
),

2522 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
Şd_lšks
, 
Ãw_lšks
),

2524 
	`TP_STRUCT__’Œy
(

2525 
LOCAL_ENTRY


2526 
VIF_ENTRY


2527 
	$__f›ld
(
u16
, 
Şd_lšks
)

2528 
	`__f›ld
(
u16
, 
Ãw_lšks
)

2531 
	`TP_ç¡_assign
(

2532 
LOCAL_ASSIGN
;

2533 
VIF_ASSIGN
;

2534 
__’Œy
->
Şd_lšks
 = old_links;

2535 
__’Œy
->
Ãw_lšks
 =‚ew_links;

2538 
	`TP_´štk
(

2539 
LOCAL_PR_FMT
 
VIF_PR_FMT
 " old_links:0x%04x,‚ew_links:0x%04x\n",

2540 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
Şd_lšks
, __’Œy->
Ãw_lšks


2544 
	`TRACE_EVENT
(
drv_chªge_¡a_lšks
,

2545 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2546 
›“80211_sub_if_d©a
 *
sd©a
,

2547 
›“80211_¡a
 *
¡a
,

2548 
u16
 
Şd_lšks
, u16 
Ãw_lšks
),

2550 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
¡a
, 
Şd_lšks
, 
Ãw_lšks
),

2552 
	`TP_STRUCT__’Œy
(

2553 
LOCAL_ENTRY


2554 
VIF_ENTRY


2555 
STA_ENTRY


2556 
	$__f›ld
(
u16
, 
Şd_lšks
)

2557 
	`__f›ld
(
u16
, 
Ãw_lšks
)

2560 
	`TP_ç¡_assign
(

2561 
LOCAL_ASSIGN
;

2562 
VIF_ASSIGN
;

2563 
STA_ASSIGN
;

2564 
__’Œy
->
Şd_lšks
 = old_links;

2565 
__’Œy
->
Ãw_lšks
 =‚ew_links;

2568 
	`TP_´štk
(

2569 
LOCAL_PR_FMT
 
VIF_PR_FMT
 
STA_PR_FMT
 " old_links:0x%04x,‚ew_links:0x%04x\n",

2570 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
STA_PR_ARG
,

2571 
__’Œy
->
Şd_lšks
, __’Œy->
Ãw_lšks


2579 
	`TRACE_EVENT
(
­i_¡¬t_tx_ba_£ssiÚ
,

2580 
	`TP_PROTO
(
›“80211_¡a
 *
¡a
, 
u16
 
tid
),

2582 
	`TP_ARGS
(
¡a
, 
tid
),

2584 
	`TP_STRUCT__’Œy
(

2585 
STA_ENTRY


2586 
	`__f›ld
(
u16
, 
tid
)

2589 
	`TP_ç¡_assign
(

2590 
STA_ASSIGN
;

2591 
__’Œy
->
tid
 =id;

2594 
	`TP_´štk
(

2595 
STA_PR_FMT
 "id:%d",

2596 
STA_PR_ARG
, 
__’Œy
->
tid


2600 
	`TRACE_EVENT
(
­i_¡¬t_tx_ba_cb
,

2601 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
¿
, 
u16
 
tid
),

2603 
	`TP_ARGS
(
sd©a
, 
¿
, 
tid
),

2605 
	`TP_STRUCT__’Œy
(

2606 
VIF_ENTRY


2607 
	$__¬¿y
(
u8
, 
¿
, 
ETH_ALEN
)

2608 
	`__f›ld
(
u16
, 
tid
)

2611 
	`TP_ç¡_assign
(

2612 
VIF_ASSIGN
;

2613 
	`memıy
(
__’Œy
->
¿
,„a, 
ETH_ALEN
);

2614 
__’Œy
->
tid
 =id;

2617 
	`TP_´štk
(

2618 
VIF_PR_FMT
 "„a:%pMid:%d",

2619 
VIF_PR_ARG
, 
__’Œy
->
¿
, __’Œy->
tid


2623 
	`TRACE_EVENT
(
­i_¡İ_tx_ba_£ssiÚ
,

2624 
	`TP_PROTO
(
›“80211_¡a
 *
¡a
, 
u16
 
tid
),

2626 
	`TP_ARGS
(
¡a
, 
tid
),

2628 
	`TP_STRUCT__’Œy
(

2629 
STA_ENTRY


2630 
	`__f›ld
(
u16
, 
tid
)

2633 
	`TP_ç¡_assign
(

2634 
STA_ASSIGN
;

2635 
__’Œy
->
tid
 =id;

2638 
	`TP_´štk
(

2639 
STA_PR_FMT
 "id:%d",

2640 
STA_PR_ARG
, 
__’Œy
->
tid


2644 
	`TRACE_EVENT
(
­i_¡İ_tx_ba_cb
,

2645 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
, cÚ¡ 
u8
 *
¿
, 
u16
 
tid
),

2647 
	`TP_ARGS
(
sd©a
, 
¿
, 
tid
),

2649 
	`TP_STRUCT__’Œy
(

2650 
VIF_ENTRY


2651 
	$__¬¿y
(
u8
, 
¿
, 
ETH_ALEN
)

2652 
	`__f›ld
(
u16
, 
tid
)

2655 
	`TP_ç¡_assign
(

2656 
VIF_ASSIGN
;

2657 
	`memıy
(
__’Œy
->
¿
,„a, 
ETH_ALEN
);

2658 
__’Œy
->
tid
 =id;

2661 
	`TP_´štk
(

2662 
VIF_PR_FMT
 "„a:%pMid:%d",

2663 
VIF_PR_ARG
, 
__’Œy
->
¿
, __’Œy->
tid


2667 
	`DEFINE_EVENT
(
loÿl_Úly_evt
, 
­i_»¡¬t_hw
,

2668 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

2669 
	`TP_ARGS
(
loÿl
)

2672 
	`TRACE_EVENT
(
­i_b—cÚ_loss
,

2673 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
),

2675 
	`TP_ARGS
(
sd©a
),

2677 
	`TP_STRUCT__’Œy
(

2678 
VIF_ENTRY


2681 
	`TP_ç¡_assign
(

2682 
VIF_ASSIGN
;

2685 
	`TP_´štk
(

2686 
VIF_PR_FMT
,

2687 
VIF_PR_ARG


2691 
	`TRACE_EVENT
(
­i_cÚÃùiÚ_loss
,

2692 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
),

2694 
	`TP_ARGS
(
sd©a
),

2696 
	`TP_STRUCT__’Œy
(

2697 
VIF_ENTRY


2700 
	`TP_ç¡_assign
(

2701 
VIF_ASSIGN
;

2704 
	`TP_´štk
(

2705 
VIF_PR_FMT
,

2706 
VIF_PR_ARG


2710 
	`TRACE_EVENT
(
­i_discÚÃù
,

2711 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
»cÚÃù
),

2713 
	`TP_ARGS
(
sd©a
, 
»cÚÃù
),

2715 
	`TP_STRUCT__’Œy
(

2716 
VIF_ENTRY


2717 
	`__f›ld
(, 
»cÚÃù
)

2720 
	`TP_ç¡_assign
(

2721 
VIF_ASSIGN
;

2722 
__’Œy
->
»cÚÃù
 =„econnect;

2725 
	`TP_´štk
(

2726 
VIF_PR_FMT
 "„econnect:%d",

2727 
VIF_PR_ARG
, 
__’Œy
->
»cÚÃù


2731 
	`TRACE_EVENT
(
­i_cqm_rssi_nÙify
,

2732 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
,

2733 
Æ80211_cqm_rssi_th»shŞd_ev’t
 
rssi_ev’t
,

2734 
s32
 
rssi_Ëv–
),

2736 
	`TP_ARGS
(
sd©a
, 
rssi_ev’t
, 
rssi_Ëv–
),

2738 
	`TP_STRUCT__’Œy
(

2739 
VIF_ENTRY


2740 
	$__f›ld
(
u32
, 
rssi_ev’t
)

2741 
	`__f›ld
(
s32
, 
rssi_Ëv–
)

2744 
	`TP_ç¡_assign
(

2745 
VIF_ASSIGN
;

2746 
__’Œy
->
rssi_ev’t
 =„ssi_event;

2747 
__’Œy
->
rssi_Ëv–
 =„ssi_level;

2750 
	`TP_´štk
(

2751 
VIF_PR_FMT
 "ƒvent:%d„ssi:%d",

2752 
VIF_PR_ARG
, 
__’Œy
->
rssi_ev’t
, __’Œy->
rssi_Ëv–


2756 
	`DEFINE_EVENT
(
loÿl_sd©a_evt
, 
­i_cqm_b—cÚ_loss_nÙify
,

2757 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2758 
›“80211_sub_if_d©a
 *
sd©a
),

2759 
	`TP_ARGS
(
loÿl
, 
sd©a
)

2762 
	`TRACE_EVENT
(
­i_sÿn_com¶‘ed
,

2763 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
boŞ
 
abÜ‹d
),

2765 
	`TP_ARGS
(
loÿl
, 
abÜ‹d
),

2767 
	`TP_STRUCT__’Œy
(

2768 
LOCAL_ENTRY


2769 
	`__f›ld
(
boŞ
, 
abÜ‹d
)

2772 
	`TP_ç¡_assign
(

2773 
LOCAL_ASSIGN
;

2774 
__’Œy
->
abÜ‹d
 =‡borted;

2777 
	`TP_´štk
(

2778 
LOCAL_PR_FMT
 "‡borted:%d",

2779 
LOCAL_PR_ARG
, 
__’Œy
->
abÜ‹d


2783 
	`TRACE_EVENT
(
­i_sched_sÿn_»suÉs
,

2784 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

2786 
	`TP_ARGS
(
loÿl
),

2788 
	`TP_STRUCT__’Œy
(

2789 
LOCAL_ENTRY


2792 
	`TP_ç¡_assign
(

2793 
LOCAL_ASSIGN
;

2796 
	`TP_´štk
(

2797 
LOCAL_PR_FMT
, 
LOCAL_PR_ARG


2801 
	`TRACE_EVENT
(
­i_sched_sÿn_¡İ³d
,

2802 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

2804 
	`TP_ARGS
(
loÿl
),

2806 
	`TP_STRUCT__’Œy
(

2807 
LOCAL_ENTRY


2810 
	`TP_ç¡_assign
(

2811 
LOCAL_ASSIGN
;

2814 
	`TP_´štk
(

2815 
LOCAL_PR_FMT
, 
LOCAL_PR_ARG


2819 
	`TRACE_EVENT
(
­i_¡a_block_awake
,

2820 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2821 
›“80211_¡a
 *
¡a
, 
boŞ
 
block
),

2823 
	`TP_ARGS
(
loÿl
, 
¡a
, 
block
),

2825 
	`TP_STRUCT__’Œy
(

2826 
LOCAL_ENTRY


2827 
STA_ENTRY


2828 
	`__f›ld
(
boŞ
, 
block
)

2831 
	`TP_ç¡_assign
(

2832 
LOCAL_ASSIGN
;

2833 
STA_ASSIGN
;

2834 
__’Œy
->
block
 = block;

2837 
	`TP_´štk
(

2838 
LOCAL_PR_FMT
 
STA_PR_FMT
 " block:%d",

2839 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
block


2843 
	`TRACE_EVENT
(
­i_chsw™ch_dÚe
,

2844 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
sucûss
,

2845 
lšk_id
),

2847 
	`TP_ARGS
(
sd©a
, 
sucûss
, 
lšk_id
),

2849 
	`TP_STRUCT__’Œy
(

2850 
VIF_ENTRY


2851 
	$__f›ld
(
boŞ
, 
sucûss
)

2852 
	`__f›ld
(, 
lšk_id
)

2855 
	`TP_ç¡_assign
(

2856 
VIF_ASSIGN
;

2857 
__’Œy
->
sucûss
 = success;

2858 
__’Œy
->
lšk_id
 =†ink_id;

2861 
	`TP_´štk
(

2862 
VIF_PR_FMT
 " success=%d†ink_id=%d",

2863 
VIF_PR_ARG
, 
__’Œy
->
sucûss
, __’Œy->
lšk_id


2867 
	`DEFINE_EVENT
(
loÿl_Úly_evt
, 
­i_»ady_Ú_chªÃl
,

2868 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

2869 
	`TP_ARGS
(
loÿl
)

2872 
	`DEFINE_EVENT
(
loÿl_Úly_evt
, 
­i_»maš_Ú_chªÃl_expœed
,

2873 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

2874 
	`TP_ARGS
(
loÿl
)

2877 
	`TRACE_EVENT
(
­i_gtk_»key_nÙify
,

2878 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
,

2879 cÚ¡ 
u8
 *
bssid
, cÚ¡ u8 *
»¶ay_ùr
),

2881 
	`TP_ARGS
(
sd©a
, 
bssid
, 
»¶ay_ùr
),

2883 
	`TP_STRUCT__’Œy
(

2884 
VIF_ENTRY


2885 
	$__¬¿y
(
u8
, 
bssid
, 
ETH_ALEN
)

2886 
	`__¬¿y
(
u8
, 
»¶ay_ùr
, 
NL80211_REPLAY_CTR_LEN
)

2889 
	`TP_ç¡_assign
(

2890 
VIF_ASSIGN
;

2891 
	`memıy
(
__’Œy
->
bssid
, bssid, 
ETH_ALEN
);

2892 
	`memıy
(
__’Œy
->
»¶ay_ùr
,„•Ïy_ùr, 
NL80211_REPLAY_CTR_LEN
);

2895 
	`TP_´štk
(
VIF_PR_FMT
, 
VIF_PR_ARG
)

2898 
	`TRACE_EVENT
(
­i_’abË_rssi_»pÜts
,

2899 
	`TP_PROTO
(
›“80211_sub_if_d©a
 *
sd©a
,

2900 
rssi_mš_thŞd
, 
rssi_max_thŞd
),

2902 
	`TP_ARGS
(
sd©a
, 
rssi_mš_thŞd
, 
rssi_max_thŞd
),

2904 
	`TP_STRUCT__’Œy
(

2905 
VIF_ENTRY


2906 
	$__f›ld
(, 
rssi_mš_thŞd
)

2907 
	`__f›ld
(, 
rssi_max_thŞd
)

2910 
	`TP_ç¡_assign
(

2911 
VIF_ASSIGN
;

2912 
__’Œy
->
rssi_mš_thŞd
 =„ssi_min_thold;

2913 
__’Œy
->
rssi_max_thŞd
 =„ssi_max_thold;

2916 
	`TP_´štk
(

2917 
VIF_PR_FMT
 "„ssi_min_thold =%d,„ssi_max_thold = %d",

2918 
VIF_PR_ARG
, 
__’Œy
->
rssi_mš_thŞd
, __’Œy->
rssi_max_thŞd


2922 
	`TRACE_EVENT
(
­i_eo¥
,

2923 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2924 
›“80211_¡a
 *
¡a
),

2926 
	`TP_ARGS
(
loÿl
, 
¡a
),

2928 
	`TP_STRUCT__’Œy
(

2929 
LOCAL_ENTRY


2930 
STA_ENTRY


2933 
	`TP_ç¡_assign
(

2934 
LOCAL_ASSIGN
;

2935 
STA_ASSIGN
;

2938 
	`TP_´štk
(

2939 
LOCAL_PR_FMT
 
STA_PR_FMT
,

2940 
LOCAL_PR_ARG
, 
STA_PR_ARG


2944 
	`TRACE_EVENT
(
­i_£nd_eo¥_nuÎfunc
,

2945 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2946 
›“80211_¡a
 *
¡a
,

2947 
u8
 
tid
),

2949 
	`TP_ARGS
(
loÿl
, 
¡a
, 
tid
),

2951 
	`TP_STRUCT__’Œy
(

2952 
LOCAL_ENTRY


2953 
STA_ENTRY


2954 
	`__f›ld
(
u8
, 
tid
)

2957 
	`TP_ç¡_assign
(

2958 
LOCAL_ASSIGN
;

2959 
STA_ASSIGN
;

2960 
__’Œy
->
tid
 =id;

2963 
	`TP_´štk
(

2964 
LOCAL_PR_FMT
 
STA_PR_FMT
 "id:%d",

2965 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
tid


2969 
	`TRACE_EVENT
(
­i_¡a_£t_bufã»d
,

2970 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

2971 
›“80211_¡a
 *
¡a
,

2972 
u8
 
tid
, 
boŞ
 
bufã»d
),

2974 
	`TP_ARGS
(
loÿl
, 
¡a
, 
tid
, 
bufã»d
),

2976 
	`TP_STRUCT__’Œy
(

2977 
LOCAL_ENTRY


2978 
STA_ENTRY


2979 
	$__f›ld
(
u8
, 
tid
)

2980 
	`__f›ld
(
boŞ
, 
bufã»d
)

2983 
	`TP_ç¡_assign
(

2984 
LOCAL_ASSIGN
;

2985 
STA_ASSIGN
;

2986 
__’Œy
->
tid
 =id;

2987 
__’Œy
->
bufã»d
 = buffered;

2990 
	`TP_´štk
(

2991 
LOCAL_PR_FMT
 
STA_PR_FMT
 "id:%d buffered:%d",

2992 
LOCAL_PR_ARG
, 
STA_PR_ARG
, 
__’Œy
->
tid
, __’Œy->
bufã»d


2996 
	`TRACE_EVENT
(
­i_¿d¬_d‘eùed
,

2997 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
),

2999 
	`TP_ARGS
(
loÿl
),

3001 
	`TP_STRUCT__’Œy
(

3002 
LOCAL_ENTRY


3005 
	`TP_ç¡_assign
(

3006 
LOCAL_ASSIGN
;

3009 
	`TP_´štk
(

3010 
LOCAL_PR_FMT
 "„adar detected",

3011 
LOCAL_PR_ARG


3015 
	`TRACE_EVENT
(
­i_»que¡_smps
,

3016 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

3017 
›“80211_sub_if_d©a
 *
sd©a
,

3018 
›“80211_lšk_d©a
 *
lšk
,

3019 
›“80211_smps_mode
 
smps_mode
),

3021 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
lšk
, 
smps_mode
),

3023 
	`TP_STRUCT__’Œy
(

3024 
LOCAL_ENTRY


3025 
VIF_ENTRY


3026 
	$__f›ld
(, 
lšk_id
)

3027 
	`__f›ld
(
u32
, 
smps_mode
)

3030 
	`TP_ç¡_assign
(

3031 
LOCAL_ASSIGN
;

3032 
VIF_ASSIGN
;

3033 
__’Œy
->
lšk_id
 = 
lšk
->link_id,

3034 
__’Œy
->
smps_mode
 = smps_mode;

3037 
	`TP_´štk
(

3038 
LOCAL_PR_FMT
 " " 
VIF_PR_FMT
 "†ink:%d, smps_mode:%d",

3039 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
lšk_id
, __’Œy->
smps_mode


3048 
	`TRACE_EVENT
(
wake_queue
,

3049 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u16
 
queue
,

3050 
queue_¡İ_»asÚ
 
»asÚ
),

3052 
	`TP_ARGS
(
loÿl
, 
queue
, 
»asÚ
),

3054 
	`TP_STRUCT__’Œy
(

3055 
LOCAL_ENTRY


3056 
	$__f›ld
(
u16
, 
queue
)

3057 
	`__f›ld
(
u32
, 
»asÚ
)

3060 
	`TP_ç¡_assign
(

3061 
LOCAL_ASSIGN
;

3062 
__’Œy
->
queue
 = queue;

3063 
__’Œy
->
»asÚ
 =„eason;

3066 
	`TP_´štk
(

3067 
LOCAL_PR_FMT
 " queue:%d,„eason:%d",

3068 
LOCAL_PR_ARG
, 
__’Œy
->
queue
, __’Œy->
»asÚ


3072 
	`TRACE_EVENT
(
¡İ_queue
,

3073 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
, 
u16
 
queue
,

3074 
queue_¡İ_»asÚ
 
»asÚ
),

3076 
	`TP_ARGS
(
loÿl
, 
queue
, 
»asÚ
),

3078 
	`TP_STRUCT__’Œy
(

3079 
LOCAL_ENTRY


3080 
	$__f›ld
(
u16
, 
queue
)

3081 
	`__f›ld
(
u32
, 
»asÚ
)

3084 
	`TP_ç¡_assign
(

3085 
LOCAL_ASSIGN
;

3086 
__’Œy
->
queue
 = queue;

3087 
__’Œy
->
»asÚ
 =„eason;

3090 
	`TP_´štk
(

3091 
LOCAL_PR_FMT
 " queue:%d,„eason:%d",

3092 
LOCAL_PR_ARG
, 
__’Œy
->
queue
, __’Œy->
»asÚ


3096 
	`TRACE_EVENT
(
drv_ÿn_Ãg_‰lm
,

3097 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

3098 
›“80211_sub_if_d©a
 *
sd©a
,

3099 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
),

3101 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
Ãg_‰lm
),

3103 
	`TP_STRUCT__’Œy
(
LOCAL_ENTRY


3104 
VIF_ENTRY


3105 
	`__¬¿y
(
u16
, 
dowÆšk
, (u16) * 8)

3106 
	`__¬¿y
(
u16
, 
u¶šk
, (u16) * 8)

3109 
	`TP_ç¡_assign
(
LOCAL_ASSIGN
;

3110 
VIF_ASSIGN
;

3111 
	`memıy
(
__’Œy
->
dowÆšk
, 
Ãg_‰lm
->downlink,

3112 (
Ãg_‰lm
->
dowÆšk
));

3113 
	`memıy
(
__’Œy
->
u¶šk
, 
Ãg_‰lm
->uplink,

3114 (
Ãg_‰lm
->
u¶šk
));

3117 
	`TP_´štk
(
LOCAL_PR_FMT
 ", " 
VIF_PR_FMT
, 
LOCAL_PR_ARG
, 
VIF_PR_ARG
)

3120 
	`TRACE_EVENT
(
drv_Ãg_‰lm_»s
,

3121 
	`TP_PROTO
(
›“80211_loÿl
 *
loÿl
,

3122 
›“80211_sub_if_d©a
 *
sd©a
,

3123 
›“80211_Ãg_‰lm_»s
 
»s
,

3124 
›“80211_Ãg_‰lm
 *
Ãg_‰lm
),

3126 
	`TP_ARGS
(
loÿl
, 
sd©a
, 
»s
, 
Ãg_‰lm
),

3128 
	`TP_STRUCT__’Œy
(
LOCAL_ENTRY


3129 
VIF_ENTRY


3130 
	$__f›ld
(
u32
, 
»s
)

3131 
	`__¬¿y
(
u16
, 
dowÆšk
, (u16) * 8)

3132 
	`__¬¿y
(
u16
, 
u¶šk
, (u16) * 8)

3135 
	`TP_ç¡_assign
(
LOCAL_ASSIGN
;

3136 
VIF_ASSIGN
;

3137 
__’Œy
->
»s
 =„es;

3138 
	`memıy
(
__’Œy
->
dowÆšk
, 
Ãg_‰lm
->downlink,

3139 (
Ãg_‰lm
->
dowÆšk
));

3140 
	`memıy
(
__’Œy
->
u¶šk
, 
Ãg_‰lm
->uplink,

3141 (
Ãg_‰lm
->
u¶šk
));

3144 
	`TP_´štk
(
LOCAL_PR_FMT
 
VIF_PR_FMT
 "„esponse: %d\n ",

3145 
LOCAL_PR_ARG
, 
VIF_PR_ARG
, 
__’Œy
->
»s


3150 #undeà
TRACE_INCLUDE_PATH


3151 
	#TRACE_INCLUDE_PATH
 .

	)

3152 #undeà
TRACE_INCLUDE_FILE


3153 
	#TRACE_INCLUDE_FILE
 
Œaû


	)

3154 
	~<Œaû/defše_Œaû.h
>

	@trace_msg.h

7 #ifdeà
CONFIG_MAC80211_MESSAGE_TRACING


9 #ià!
defšed
(
__MAC80211_MSG_DRIVER_TRACE
è|| defšed(
TRACE_HEADER_MULTI_READ
)

10 
	#__MAC80211_MSG_DRIVER_TRACE


	)

12 
	~<lšux/Œaûpošt.h
>

13 
	~<Ãt/mac80211.h
>

14 
	~"›“80211_i.h
"

16 #undeà
TRACE_SYSTEM


17 
	#TRACE_SYSTEM
 
mac80211_msg


	)

19 
DECLARE_EVENT_CLASS
(
mac80211_msg_ev’t
,

20 
TP_PROTO
(
va_fÜm©
 *
vaf
),

22 
TP_ARGS
(
vaf
),

24 
TP_STRUCT__’Œy
(

25 
__v¡ršg
(
msg
, 
vaf
->
fmt
, vaf->
va
)

28 
TP_ç¡_assign
(

29 
__assign_v¡r
(
msg
, 
vaf
->
fmt
, vaf->
va
);

32 
TP_´štk
("%s", 
__g‘_¡r
(
msg
))

35 
DEFINE_EVENT
(
mac80211_msg_ev’t
, 
mac80211_šfo
,

36 
TP_PROTO
(
va_fÜm©
 *
vaf
),

37 
TP_ARGS
(
vaf
)

39 
DEFINE_EVENT
(
mac80211_msg_ev’t
, 
mac80211_dbg
,

40 
TP_PROTO
(
va_fÜm©
 *
vaf
),

41 
TP_ARGS
(
vaf
)

43 
DEFINE_EVENT
(
mac80211_msg_ev’t
, 
mac80211_”r
,

44 
TP_PROTO
(
va_fÜm©
 *
vaf
),

45 
TP_ARGS
(
vaf
)

49 #undeà
TRACE_INCLUDE_PATH


50 
	#TRACE_INCLUDE_PATH
 .

	)

51 #undeà
TRACE_INCLUDE_FILE


52 
	#TRACE_INCLUDE_FILE
 
Œaû_msg


	)

53 
	~<Œaû/defše_Œaû.h
>

	@tx.c

13 
	~<lšux/k”Ãl.h
>

14 
	~<lšux/¦ab.h
>

15 
	~<lšux/skbuff.h
>

16 
	~<lšux/if_vÏn.h
>

17 
	~<lšux/‘h”deviû.h
>

18 
	~<lšux/b™m­.h
>

19 
	~<lšux/rcupd©e.h
>

20 
	~<lšux/expÜt.h
>

21 
	~<Ãt/Ãt_Çme¥aû.h
>

22 
	~<Ãt/›“80211_¿diÙ­.h
>

23 
	~<Ãt/cfg80211.h
>

24 
	~<Ãt/mac80211.h
>

25 
	~<Ãt/cod–.h
>

26 
	~<Ãt/cod–_im¶.h
>

27 
	~<asm/uÇligÃd.h
>

28 
	~<Ãt/fq_im¶.h
>

29 
	~<Ãt/gso.h
>

31 
	~"›“80211_i.h
"

32 
	~"driv”-İs.h
"

33 
	~"Ëd.h
"

34 
	~"mesh.h
"

35 
	~"w•.h
"

36 
	~"w·.h
"

37 
	~"wme.h
"

38 
	~"¿‹.h
"

42 
__Ë16
 
	$›“80211_du¿tiÚ
(
›“80211_tx_d©a
 *
tx
,

43 
sk_buff
 *
skb
, 
group_addr
,

44 
Ãxt_äag_Ën
)

46 
¿‹
, 
m¿‹
, 
”p
, 
dur
, 
i
;

47 
›“80211_¿‹
 *
tx¿‹
;

48 
›“80211_loÿl
 *
loÿl
 = 
tx
->local;

49 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

50 
›“80211_hdr
 *
hdr
;

51 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

52 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

53 
u32
 
¿‹_æags
 = 0;

56 ià(
tx
->
¿‹
.
æags
 & (
IEEE80211_TX_RC_MCS
 | 
IEEE80211_TX_RC_VHT_MCS
))

59 
	`rcu_»ad_lock
();

60 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
tx
->
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

61 ià(
chªùx_cÚf
)

62 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(&
chªùx_cÚf
->
def
);

63 
	`rcu_»ad_uÆock
();

66 ià(
	`WARN_ON_ONCE
(
tx
->
¿‹
.
idx
 < 0))

69 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
šfo
->
bªd
];

70 
tx¿‹
 = &
sbªd
->
b™¿‹s
[
tx
->
¿‹
.
idx
];

72 
”p
 = 
tx¿‹
->
æags
 & 
IEEE80211_RATE_ERP_G
;

75 ià(
sbªd
->
bªd
 =ğ
NL80211_BAND_S1GHZ
)

95 
hdr
 = (
›“80211_hdr
 *)
skb
->
d©a
;

96 ià(
	`›“80211_is_ùl
(
hdr
->
äame_cÚŒŞ
)) {

116  
	`ıu_to_Ë16
(32768);

118 ià(
group_addr
)

131 
¿‹
 = -1;

133 
m¿‹
 = 
sbªd
->
b™¿‹s
[0].
b™¿‹
;

134 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

135 
›“80211_¿‹
 *
r
 = &
sbªd
->
b™¿‹s
[
i
];

136 
u32
 
æag
;

138 ià(
r
->
b™¿‹
 > 
tx¿‹
->bitrate)

141 ià((
¿‹_æags
 & 
r
->
æags
) !=„ate_flags)

144 ià(
tx
->
sd©a
->
vif
.
bss_cÚf
.
basic_¿‹s
 & 
	`BIT
(
i
))

145 
¿‹
 = 
r
->
b™¿‹
;

147 
sbªd
->
bªd
) {

148 
NL80211_BAND_2GHZ
:

149 
NL80211_BAND_LC
:

150 ià(
tx
->
sd©a
->
deæšk
.
İ”©šg_11g_mode
)

151 
æag
 = 
IEEE80211_RATE_MANDATORY_G
;

153 
æag
 = 
IEEE80211_RATE_MANDATORY_B
;

155 
NL80211_BAND_5GHZ
:

156 
NL80211_BAND_6GHZ
:

157 
æag
 = 
IEEE80211_RATE_MANDATORY_A
;

160 
æag
 = 0;

161 
	`WARN_ON
(1);

165 ià(
r
->
æags
 & 
æag
)

166 
m¿‹
 = 
r
->
b™¿‹
;

168 ià(
¿‹
 == -1) {

171 
¿‹
 = 
m¿‹
;

175 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) &&

176 *(
	`›“80211_g‘_qos_ùl
(
hdr
)è& 
IEEE80211_QOS_CTL_ACK_POLICY_NOACK
)

177 
dur
 = 0;

182 
dur
 = 
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 10, 
¿‹
, 
”p
,

183 
tx
->
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
);

185 ià(
Ãxt_äag_Ën
) {

188 
dur
 *= 2;

190 
dur
 +ğ
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 
Ãxt_äag_Ën
,

191 
tx¿‹
->
b™¿‹
, 
”p
,

192 
tx
->
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
);

195  
	`ıu_to_Ë16
(
dur
);

196 
	}
}

199 
›“80211_tx_»suÉ
 
debug_nošlše


200 
	$›“80211_tx_h_dyÇmic_ps
(
›“80211_tx_d©a
 *
tx
)

202 
›“80211_loÿl
 *
loÿl
 = 
tx
->local;

203 
›“80211_if_mªaged
 *
ifmgd
;

204 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

207 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_PS
))

208  
TX_CONTINUE
;

211 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
))

212  
TX_CONTINUE
;

215 ià(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
 <= 0)

216  
TX_CONTINUE
;

219 ià(
loÿl
->
sÿÂšg
)

220  
TX_CONTINUE
;

222 ià(!
loÿl
->
ps_sd©a
)

223  
TX_CONTINUE
;

226 ià(
loÿl
->
qu›scšg
)

227  
TX_CONTINUE
;

230 ià(
tx
->
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

231  
TX_CONTINUE
;

233 ià(
	`uÆik–y
(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_OFFCHAN_TX_OK
))

234  
TX_CONTINUE
;

236 
ifmgd
 = &
tx
->
sd©a
->
u
.
mgd
;

251 ià((
ifmgd
->
æags
 & 
IEEE80211_STA_UAPSD_ENABLED
) &&

252 (
ifmgd
->
u­sd_queues
 & 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VO
) &&

253 
	`skb_g‘_queue_m­pšg
(
tx
->
skb
è=ğ
IEEE80211_AC_VO
)

254  
TX_CONTINUE
;

256 ià(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
) {

257 
	`›“80211_¡İ_queues_by_»asÚ
(&
loÿl
->
hw
,

258 
IEEE80211_MAX_QUEUE_MAP
,

259 
IEEE80211_QUEUE_STOP_REASON_PS
,

260 
çl£
);

261 
ifmgd
->
æags
 &ğ~
IEEE80211_STA_NULLFUNC_ACKED
;

262 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
,

263 &
loÿl
->
dyÇmic_ps_di§bË_wÜk
);

267 ià(!
ifmgd
->
assocŸ‹d
)

268  
TX_CONTINUE
;

270 
	`mod_tim”
(&
loÿl
->
dyÇmic_ps_tim”
, 
jiff›s
 +

271 
	`m£cs_to_jiff›s
(
loÿl
->
hw
.
cÚf
.
dyÇmic_ps_timeout
));

273  
TX_CONTINUE
;

274 
	}
}

276 
›“80211_tx_»suÉ
 
debug_nošlše


277 
	$›“80211_tx_h_check_assoc
(
›“80211_tx_d©a
 *
tx
)

280 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
tx
->
skb
->
d©a
;

281 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

282 
boŞ
 
assoc
 = 
çl£
;

284 ià(
	`uÆik–y
(
šfo
->
æags
 & 
IEEE80211_TX_CTL_INJECTED
))

285  
TX_CONTINUE
;

287 ià(
	`uÆik–y
(
	`‹¡_b™
(
SCAN_SW_SCANNING
, &
tx
->
loÿl
->
sÿÂšg
)) &&

288 
	`‹¡_b™
(
SDATA_STATE_OFFCHANNEL
, &
tx
->
sd©a
->
¡©e
) &&

289 !
	`›“80211_is_´obe_»q
(
hdr
->
äame_cÚŒŞ
) &&

290 !
	`›“80211_is_ªy_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

302  
TX_DROP
;

304 ià(
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
)

305  
TX_CONTINUE
;

307 ià(
tx
->
æags
 & 
IEEE80211_TX_PS_BUFFERED
)

308  
TX_CONTINUE
;

310 ià(
tx
->
¡a
)

311 
assoc
 = 
	`‹¡_¡a_æag
(
tx
->
¡a
, 
WLAN_STA_ASSOC
);

313 ià(
	`lik–y
(
tx
->
æags
 & 
IEEE80211_TX_UNICAST
)) {

314 ià(
	`uÆik–y
(!
assoc
 &&

315 
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
))) {

316 #ifdeà
CONFIG_MAC80211_VERBOSE_DEBUG


317 
	`sd©a_šfo
(
tx
->
sd©a
,

319 
hdr
->
addr1
);

321 
	`I802_DEBUG_INC
(
tx
->
loÿl
->
tx_hªdËrs_drİ_nÙ_assoc
);

322  
TX_DROP
;

324 } ià(
	`uÆik–y
(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

325 
	`›“80211_vif_g‘_num_mÿ¡_if
(
tx
->
sd©a
) == 0)) {

330  
TX_DROP
;

333  
TX_CONTINUE
;

334 
	}
}

340 
	$purge_Şd_ps_bufãrs
(
›“80211_loÿl
 *
loÿl
)

342 
tÙ®
 = 0, 
purged
 = 0;

343 
sk_buff
 *
skb
;

344 
›“80211_sub_if_d©a
 *
sd©a
;

345 
¡a_šfo
 *
¡a
;

347 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

348 
ps_d©a
 *
ps
;

350 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

351 
ps
 = &
sd©a
->
u
.
­
.ps;

352 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

353 
ps
 = &
sd©a
->
u
.
mesh
.ps;

357 
skb
 = 
	`skb_dequeue
(&
ps
->
bc_buf
);

358 ià(
skb
) {

359 
purged
++;

360 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

362 
tÙ®
 +ğ
	`skb_queue_Ën
(&
ps
->
bc_buf
);

369 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

370 
ac
;

372 
ac
 = 
IEEE80211_AC_BK
;‡ø>ğ
IEEE80211_AC_VO
;‡c--) {

373 
skb
 = 
	`skb_dequeue
(&
¡a
->
ps_tx_buf
[
ac
]);

374 
tÙ®
 +ğ
	`skb_queue_Ën
(&
¡a
->
ps_tx_buf
[
ac
]);

375 ià(
skb
) {

376 
purged
++;

377 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

383 
loÿl
->
tÙ®_ps_bufã»d
 = 
tÙ®
;

384 
	`ps_dbg_hw
(&
loÿl
->
hw
, "PS bufãr fuÎ -…urged %d f¿mes\n", 
purged
);

385 
	}
}

387 
›“80211_tx_»suÉ


388 
	$›“80211_tx_h_muÉiÿ¡_ps_buf
(
›“80211_tx_d©a
 *
tx
)

390 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

391 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
tx
->
skb
->
d©a
;

392 
ps_d©a
 *
ps
;

403 ià(
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

404 
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

405 ià(!
tx
->
sd©a
->
bss
)

406  
TX_CONTINUE
;

408 
ps
 = &
tx
->
sd©a
->
bss
->ps;

409 } ià(
	`›“80211_vif_is_mesh
(&
tx
->
sd©a
->
vif
)) {

410 
ps
 = &
tx
->
sd©a
->
u
.
mesh
.ps;

412  
TX_CONTINUE
;

417 ià(
	`›“80211_has_Üd”
(
hdr
->
äame_cÚŒŞ
))

418  
TX_CONTINUE
;

420 ià(
	`›“80211_is_´obe_»q
(
hdr
->
äame_cÚŒŞ
))

421  
TX_CONTINUE
;

423 ià(
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
QUEUE_CONTROL
))

424 
šfo
->
hw_queue
 = 
tx
->
sd©a
->
vif
.
ÿb_queue
;

427 ià(!
	`©omic_»ad
(&
ps
->
num_¡a_ps
è&& 
	`skb_queue_em±y
(&ps->
bc_buf
))

428  
TX_CONTINUE
;

430 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_SEND_AFTER_DTIM
;

433 ià(!
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
HOST_BROADCAST_PS_BUFFERING
))

434  
TX_CONTINUE
;

437 ià(
tx
->
loÿl
->
tÙ®_ps_bufã»d
 >ğ
TOTAL_MAX_TX_BUFFER
)

438 
	`purge_Şd_ps_bufãrs
(
tx
->
loÿl
);

440 ià(
	`skb_queue_Ën
(&
ps
->
bc_buf
è>ğ
AP_MAX_BC_BUFFER
) {

441 
	`ps_dbg
(
tx
->
sd©a
,

443 
	`›“80211_ä“_txskb
(&
tx
->
loÿl
->
hw
, 
	`skb_dequeue
(&
ps
->
bc_buf
));

445 
tx
->
loÿl
->
tÙ®_ps_bufã»d
++;

447 
	`skb_queue_
(&
ps
->
bc_buf
, 
tx
->
skb
);

449  
TX_QUEUED
;

450 
	}
}

452 
	$›“80211_u£_må
(
__Ë16
 
fc
, 
¡a_šfo
 *
¡a
,

453 
sk_buff
 *
skb
)

455 ià(!
	`›“80211_is_mgmt
(
fc
))

458 ià(
¡a
 =ğ
NULL
 || !
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_MFP
))

461 ià(!
	`›“80211_is_robu¡_mgmt_äame
(
skb
))

465 
	}
}

467 
›“80211_tx_»suÉ


468 
	$›“80211_tx_h_uniÿ¡_ps_buf
(
›“80211_tx_d©a
 *
tx
)

470 
¡a_šfo
 *
¡a
 = 
tx
->sta;

471 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

472 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
tx
->
skb
->
d©a
;

473 
›“80211_loÿl
 *
loÿl
 = 
tx
->local;

475 ià(
	`uÆik–y
(!
¡a
))

476  
TX_CONTINUE
;

478 ià(
	`uÆik–y
((
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) ||

479 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
) ||

480 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
)) &&

481 !(
šfo
->
æags
 & 
IEEE80211_TX_CTL_NO_PS_BUFFER
))) {

482 
ac
 = 
	`skb_g‘_queue_m­pšg
(
tx
->
skb
);

484 ià(
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
) &&

485 !
	`›“80211_is_bufã¿bË_mmpdu
(
tx
->
skb
)) {

486 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_PS_BUFFER
;

487  
TX_CONTINUE
;

490 
	`ps_dbg
(
¡a
->
sd©a
, "STA %pM‡id %d: PS buffer for AC %d\n",

491 
¡a
->¡a.
addr
, s->¡a.
aid
, 
ac
);

492 ià(
tx
->
loÿl
->
tÙ®_ps_bufã»d
 >ğ
TOTAL_MAX_TX_BUFFER
)

493 
	`purge_Şd_ps_bufãrs
(
tx
->
loÿl
);

496 
	`¥š_lock
(&
¡a
->
ps_lock
);

502 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) &&

503 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
) &&

504 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
)) {

505 
	`¥š_uÆock
(&
¡a
->
ps_lock
);

506  
TX_CONTINUE
;

509 ià(
	`skb_queue_Ën
(&
¡a
->
ps_tx_buf
[
ac
]è>ğ
STA_MAX_TX_BUFFER
) {

510 
sk_buff
 *
Şd
 = 
	`skb_dequeue
(&
¡a
->
ps_tx_buf
[
ac
]);

511 
	`ps_dbg
(
tx
->
sd©a
,

513 
¡a
->¡a.
addr
, 
ac
);

514 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
Şd
);

516 
tx
->
loÿl
->
tÙ®_ps_bufã»d
++;

518 
šfo
->
cÚŒŞ
.
jiff›s
 = jiffies;

519 
šfo
->
cÚŒŞ
.
vif
 = &
tx
->
sd©a
->vif;

520 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

521 
šfo
->
æags
 &ğ~
IEEE80211_TX_TEMPORARY_FLAGS
;

522 
	`skb_queue_
(&
¡a
->
ps_tx_buf
[
ac
], 
tx
->
skb
);

523 
	`¥š_uÆock
(&
¡a
->
ps_lock
);

525 ià(!
	`tim”_³ndšg
(&
loÿl
->
¡a_ş—nup
))

526 
	`mod_tim”
(&
loÿl
->
¡a_ş—nup
,

527 
	`round_jiff›s
(
jiff›s
 +

528 
STA_INFO_CLEANUP_INTERVAL
));

534 
	`¡a_šfo_»ÿlc_tim
(
¡a
);

536  
TX_QUEUED
;

537 } ià(
	`uÆik–y
(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
))) {

538 
	`ps_dbg
(
tx
->
sd©a
,

540 
¡a
->¡a.
addr
);

543  
TX_CONTINUE
;

544 
	}
}

546 
›“80211_tx_»suÉ
 
debug_nošlše


547 
	$›“80211_tx_h_ps_buf
(
›“80211_tx_d©a
 *
tx
)

549 ià(
	`uÆik–y
(
tx
->
æags
 & 
IEEE80211_TX_PS_BUFFERED
))

550  
TX_CONTINUE
;

552 ià(
tx
->
æags
 & 
IEEE80211_TX_UNICAST
)

553  
	`›“80211_tx_h_uniÿ¡_ps_buf
(
tx
);

555  
	`›“80211_tx_h_muÉiÿ¡_ps_buf
(
tx
);

556 
	}
}

558 
›“80211_tx_»suÉ
 
debug_nošlše


559 
	$›“80211_tx_h_check_cÚŒŞ_pÜt_´ÙocŞ
(
›“80211_tx_d©a
 *
tx
)

561 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

563 ià(
	`uÆik–y
(
tx
->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 =ğtx->
skb
->
´ÙocŞ
)) {

564 ià(
tx
->
sd©a
->
cÚŒŞ_pÜt_no_’üy±
)

565 
šfo
->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

566 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_PORT_CTRL_PROTO
;

567 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_USE_MINRATE
;

570  
TX_CONTINUE
;

571 
	}
}

573 
›“80211_key
 *

574 
	$›“80211_£Ëù_lšk_key
(
›“80211_tx_d©a
 *
tx
)

576 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
tx
->
skb
->
d©a
;

577 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

578 
›“80211_lšk_d©a
 *
lšk
;

579 
lšk_id
;

581 
lšk_id
 = 
	`u32_g‘_b™s
(
šfo
->
cÚŒŞ
.
æags
, 
IEEE80211_TX_CTRL_MLO_LINK
);

582 ià(
lšk_id
 =ğ
IEEE80211_LINK_UNSPECIFIED
) {

583 
lšk
 = &
tx
->
sd©a
->
deæšk
;

585 
lšk
 = 
	`rcu_d”eã»nû
(
tx
->
sd©a
->lšk[
lšk_id
]);

586 ià(!
lšk
)

587  
NULL
;

590 ià(
	`›“80211_is_group_´ivacy_aùiÚ
(
tx
->
skb
))

591  
	`rcu_d”eã»nû
(
lšk
->
deçuÉ_muÉiÿ¡_key
);

592 ià(
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
) &&

593 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

594 
	`›“80211_is_robu¡_mgmt_äame
(
tx
->
skb
))

595  
	`rcu_d”eã»nû
(
lšk
->
deçuÉ_mgmt_key
);

596 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
))

597  
	`rcu_d”eã»nû
(
lšk
->
deçuÉ_muÉiÿ¡_key
);

599  
NULL
;

600 
	}
}

602 
›“80211_tx_»suÉ
 
debug_nošlše


603 
	$›“80211_tx_h_£Ëù_key
(
›“80211_tx_d©a
 *
tx
)

605 
›“80211_key
 *
key
;

606 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

607 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
tx
->
skb
->
d©a
;

609 ià(
	`uÆik–y
(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_DONT_ENCRYPT
)) {

610 
tx
->
key
 = 
NULL
;

611  
TX_CONTINUE
;

614 ià(
tx
->
¡a
 &&

615 (
key
 = 
	`rcu_d”eã»nû
(
tx
->
¡a
->
±k
[tx->¡a->
±k_idx
])))

616 
tx
->
key
 = key;

617 ià((
key
 = 
	`›“80211_£Ëù_lšk_key
(
tx
)))

618 
tx
->
key
 = key;

619 ià(!
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

620 (
key
 = 
	`rcu_d”eã»nû
(
tx
->
sd©a
->
deçuÉ_uniÿ¡_key
)))

621 
tx
->
key
 = key;

623 
tx
->
key
 = 
NULL
;

625 ià(
tx
->
key
) {

626 
boŞ
 
sk_hw
 = 
çl£
;

630 
tx
->
key
->
cÚf
.
ch”
) {

631 
WLAN_CIPHER_SUITE_WEP40
:

632 
WLAN_CIPHER_SUITE_WEP104
:

633 
WLAN_CIPHER_SUITE_TKIP
:

634 ià(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

635 
tx
->
key
 = 
NULL
;

637 
WLAN_CIPHER_SUITE_CCMP
:

638 
WLAN_CIPHER_SUITE_CCMP_256
:

639 
WLAN_CIPHER_SUITE_GCMP
:

640 
WLAN_CIPHER_SUITE_GCMP_256
:

641 ià(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
) &&

642 !
	`›“80211_u£_må
(
hdr
->
äame_cÚŒŞ
, 
tx
->
¡a
,

643 
tx
->
skb
) &&

644 !
	`›“80211_is_group_´ivacy_aùiÚ
(
tx
->
skb
))

645 
tx
->
key
 = 
NULL
;

647 
sk_hw
 = (
tx
->
key
->
cÚf
.
æags
 &

648 
IEEE80211_KEY_FLAG_SW_MGMT_TX
) &&

649 
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
);

651 
WLAN_CIPHER_SUITE_AES_CMAC
:

652 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

653 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

654 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

655 ià(!
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

656 
tx
->
key
 = 
NULL
;

660 ià(
	`uÆik–y
(
tx
->
key
 &&x->key->
æags
 & 
KEY_FLAG_TAINTED
 &&

661 !
	`›“80211_is_d—uth
(
hdr
->
äame_cÚŒŞ
)) &&

662 
tx
->
skb
->
´ÙocŞ
 !ğtx->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

663  
TX_DROP
;

665 ià(!
sk_hw
 && 
tx
->
key
 &&

666 
tx
->
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
)

667 
šfo
->
cÚŒŞ
.
hw_key
 = &
tx
->
key
->
cÚf
;

668 } ià(
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
è&& 
tx
->
¡a
 &&

669 
	`‹¡_¡a_æag
(
tx
->
¡a
, 
WLAN_STA_USES_ENCRYPTION
)) {

670  
TX_DROP
;

673  
TX_CONTINUE
;

674 
	}
}

676 
›“80211_tx_»suÉ
 
debug_nošlše


677 
	$›“80211_tx_h_¿‹_ù¾
(
›“80211_tx_d©a
 *
tx
)

679 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

680 
›“80211_hdr
 *
hdr
 = (*)
tx
->
skb
->
d©a
;

681 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

682 
u32
 
Ën
;

683 
›“80211_tx_¿‹_cÚŒŞ
 
txrc
;

684 
›“80211_¡a_¿‹s
 *
¿‹tbl
 = 
NULL
;

685 
boŞ
 
’ÿp
 = 
šfo
->
æags
 & 
IEEE80211_TX_CTL_HW_80211_ENCAP
;

686 
boŞ
 
assoc
 = 
çl£
;

688 
	`mem£t
(&
txrc
, 0, (txrc));

690 
sbªd
 = 
tx
->
loÿl
->
hw
.
why
->
bªds
[
šfo
->
bªd
];

692 
Ën
 = 
	`mš_t
(
u32
, 
tx
->
skb
->ËÀ+ 
FCS_LEN
,

693 
tx
->
loÿl
->
hw
.
why
->
äag_th»shŞd
);

696 
txrc
.
hw
 = &
tx
->
loÿl
->hw;

697 
txrc
.
sbªd
 = sband;

698 
txrc
.
bss_cÚf
 = &
tx
->
sd©a
->
vif
.bss_conf;

699 
txrc
.
skb
 = 
tx
->skb;

700 
txrc
.
»pÜ‹d_¿‹
.
idx
 = -1;

702 ià(
	`uÆik–y
(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_SCAN_TX
)) {

703 
txrc
.
¿‹_idx_mask
 = ~0;

705 
txrc
.
¿‹_idx_mask
 = 
tx
->
sd©a
->
rc_¿‹idx_mask
[
šfo
->
bªd
];

707 ià(
tx
->
sd©a
->
rc_has_mcs_mask
[
šfo
->
bªd
])

708 
txrc
.
¿‹_idx_mcs_mask
 =

709 
tx
->
sd©a
->
rc_¿‹idx_mcs_mask
[
šfo
->
bªd
];

712 
txrc
.
bss
 = (
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

713 
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
 ||

714 
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
 ||

715 
tx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
);

718 ià(
Ën
 > 
tx
->
loÿl
->
hw
.
why
->
¹s_th»shŞd
) {

719 
txrc
.
¹s
 = 
Œue
;

722 
šfo
->
cÚŒŞ
.
u£_¹s
 = 
txrc
.
¹s
;

723 
šfo
->
cÚŒŞ
.
u£_ùs_´Ù
 = 
tx
->
sd©a
->
vif
.
bss_cÚf
.use_cts_prot;

731 ià(
tx
->
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
 &&

732 (
	`›“80211_is_tx_d©a
(
tx
->
skb
) ||

733 (
tx
->
¡a
 && 
	`‹¡_¡a_æag
Ñx->¡a, 
WLAN_STA_SHORT_PREAMBLE
))))

734 
txrc
.
shÜt_´—mbË
 = 
Œue
;

736 
šfo
->
cÚŒŞ
.
shÜt_´—mbË
 = 
txrc
.short_preamble;

739 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_RATE_INJECT
)

740  
TX_CONTINUE
;

742 ià(
tx
->
¡a
)

743 
assoc
 = 
	`‹¡_¡a_æag
(
tx
->
¡a
, 
WLAN_STA_ASSOC
);

749 ià(
	`WARN
(
	`‹¡_b™
(
SCAN_SW_SCANNING
, &
tx
->
loÿl
->
sÿÂšg
è&& 
assoc
 &&

750 !
	`¿‹_u§bË_šdex_exi¡s
(
sbªd
, &
tx
->
¡a
->sta),

754 
tx
->
sd©a
->
Çme
,

755 
’ÿp
 ? ((
‘hhdr
 *)
hdr
)->
h_de¡
 : hdr->
addr1
,

756 
šfo
->
bªd
 ? 5 : 2))

757  
TX_DROP
;

763 
	`¿‹_cÚŒŞ_g‘_¿‹
(
tx
->
sd©a
,x->
¡a
, &
txrc
);

765 ià(
tx
->
¡a
 && !
šfo
->
cÚŒŞ
.
sk_bË
)

766 
¿‹tbl
 = 
	`rcu_d”eã»nû
(
tx
->
¡a
->¡a.
¿‹s
);

768 ià(
	`uÆik–y
(
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 < 0)) {

769 ià(
¿‹tbl
) {

770 
›“80211_tx_¿‹
 
¿‹
 = {

771 .
idx
 = 
¿‹tbl
->
¿‹
[0].idx,

772 .
æags
 = 
¿‹tbl
->
¿‹
[0].flags,

773 .
couÁ
 = 
¿‹tbl
->
¿‹
[0].count

776 ià(
¿‹tbl
->
¿‹
[0].
idx
 < 0)

777  
TX_DROP
;

779 
tx
->
¿‹
 =„ate;

781  
TX_DROP
;

784 
tx
->
¿‹
 = 
šfo
->
cÚŒŞ
.
¿‹s
[0];

787 ià(
txrc
.
»pÜ‹d_¿‹
.
idx
 < 0) {

788 
txrc
.
»pÜ‹d_¿‹
 = 
tx
->
¿‹
;

789 ià(
tx
->
¡a
 && 
	`›“80211_is_tx_d©a
Ñx->
skb
))

790 
tx
->
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
 = 
txrc
.
»pÜ‹d_¿‹
;

791 } ià(
tx
->
¡a
)

792 
tx
->
¡a
->
deæšk
.
tx_¡©s
.
Ï¡_¿‹
 = 
txrc
.
»pÜ‹d_¿‹
;

794 ià(
¿‹tbl
)

795  
TX_CONTINUE
;

797 ià(
	`uÆik–y
(!
šfo
->
cÚŒŞ
.
¿‹s
[0].
couÁ
))

798 
šfo
->
cÚŒŞ
.
¿‹s
[0].
couÁ
 = 1;

800 ià(
	`WARN_ON_ONCE
((
šfo
->
cÚŒŞ
.
¿‹s
[0].
couÁ
 > 1) &&

801 (
šfo
->
æags
 & 
IEEE80211_TX_CTL_NO_ACK
)))

802 
šfo
->
cÚŒŞ
.
¿‹s
[0].
couÁ
 = 1;

804  
TX_CONTINUE
;

805 
	}
}

807 
__Ë16
 
	$›“80211_tx_Ãxt_£q
(
¡a_šfo
 *
¡a
, 
tid
)

809 
u16
 *
£q
 = &
¡a
->
tid_£q
[
tid
];

810 
__Ë16
 
»t
 = 
	`ıu_to_Ë16
(*
£q
);

813 *
£q
 = (*£q + 0x10è& 
IEEE80211_SCTL_SEQ
;

815  
»t
;

816 
	}
}

818 
›“80211_tx_»suÉ
 
debug_nošlše


819 
	$›“80211_tx_h_£qu’û
(
›“80211_tx_d©a
 *
tx
)

821 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

822 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
tx
->
skb
->
d©a
;

823 
tid
;

830 ià(
	`uÆik–y
(
šfo
->
cÚŒŞ
.
vif
->
ty³
 =ğ
NL80211_IFTYPE_MONITOR
))

831  
TX_CONTINUE
;

833 ià(
	`uÆik–y
(
	`›“80211_is_ùl
(
hdr
->
äame_cÚŒŞ
)))

834  
TX_CONTINUE
;

836 ià(
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
) < 24)

837  
TX_CONTINUE
;

839 ià(
	`›“80211_is_qos_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

840  
TX_CONTINUE
;

842 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_NO_SEQNO
)

843  
TX_CONTINUE
;

846 ià(
	`uÆik–y
(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

847 
	`›“80211_vif_is_mld
(
šfo
->
cÚŒŞ
.
vif
) &&

848 
šfo
->
cÚŒŞ
.
vif
->
ty³
 =ğ
NL80211_IFTYPE_AP
)) {

849 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_MCAST_MLO_FIRST_TX
)

850 
tx
->
sd©a
->
mld_mÿ¡_£q
 += 0x10;

851 
hdr
->
£q_ù¾
 = 
	`ıu_to_Ë16
(
tx
->
sd©a
->
mld_mÿ¡_£q
);

852  
TX_CONTINUE
;

861 ià(!
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) ||

862 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

864 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_ASSIGN_SEQ
;

866 
hdr
->
£q_ù¾
 = 
	`ıu_to_Ë16
(
tx
->
sd©a
->
£qu’û_numb”
);

867 
tx
->
sd©a
->
£qu’û_numb”
 += 0x10;

868 ià(
tx
->
¡a
)

869 
tx
->
¡a
->
deæšk
.
tx_¡©s
.
msdu
[
IEEE80211_NUM_TIDS
]++;

870  
TX_CONTINUE
;

878 ià(!
tx
->
¡a
)

879  
TX_CONTINUE
;

882 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

883 
tx
->
¡a
->
deæšk
.
tx_¡©s
.
msdu
[
tid
]++;

885 
hdr
->
£q_ù¾
 = 
	`›“80211_tx_Ãxt_£q
(
tx
->
¡a
, 
tid
);

887  
TX_CONTINUE
;

888 
	}
}

890 
	$›“80211_äagm’t
(
›“80211_tx_d©a
 *
tx
,

891 
sk_buff
 *
skb
, 
hd¾’
,

892 
äag_th»shŞd
)

894 
›“80211_loÿl
 *
loÿl
 = 
tx
->local;

895 
›“80211_tx_šfo
 *
šfo
;

896 
sk_buff
 *
tmp
;

897 
³r_äagm
 = 
äag_th»shŞd
 - 
hd¾’
 - 
FCS_LEN
;

898 
pos
 = 
hd¾’
 + 
³r_äagm
;

899 
»m
 = 
skb
->
Ën
 - 
hd¾’
 - 
³r_äagm
;

901 ià(
	`WARN_ON
(
»m
 < 0))

902  -
EINVAL
;

906 
»m
) {

907 
äagËn
 = 
³r_äagm
;

909 ià(
äagËn
 > 
»m
)

910 
äagËn
 = 
»m
;

911 
»m
 -ğ
äagËn
;

912 
tmp
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 +

913 
äag_th»shŞd
 +

914 
IEEE80211_ENCRYPT_HEADROOM
 +

915 
IEEE80211_ENCRYPT_TAILROOM
);

916 ià(!
tmp
)

917  -
ENOMEM
;

919 
	`__skb_queue_
(&
tx
->
skbs
, 
tmp
);

921 
	`skb_»£rve
(
tmp
,

922 
loÿl
->
tx_h—droom
 + 
IEEE80211_ENCRYPT_HEADROOM
);

925 
	`memıy
(
tmp
->
cb
, 
skb
->cb, (tmp->cb));

927 
šfo
 = 
	`IEEE80211_SKB_CB
(
tmp
);

928 
šfo
->
æags
 &ğ~(
IEEE80211_TX_CTL_CLEAR_PS_FILT
 |

929 
IEEE80211_TX_CTL_FIRST_FRAGMENT
);

931 ià(
»m
)

932 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_MORE_FRAMES
;

934 
	`skb_cİy_queue_m­pšg
(
tmp
, 
skb
);

935 
tmp
->
´iÜ™y
 = 
skb
->priority;

936 
tmp
->
dev
 = 
skb
->dev;

939 
	`skb_put_d©a
(
tmp
, 
skb
->
d©a
, 
hd¾’
);

940 
	`skb_put_d©a
(
tmp
, 
skb
->
d©a
 + 
pos
, 
äagËn
);

942 
pos
 +ğ
äagËn
;

946 
	`skb_Œim
(
skb
, 
hd¾’
 + 
³r_äagm
);

948 
	}
}

950 
›“80211_tx_»suÉ
 
debug_nošlše


951 
	$›“80211_tx_h_äagm’t
(
›“80211_tx_d©a
 *
tx
)

953 
sk_buff
 *
skb
 = 
tx
->skb;

954 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

955 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

956 
äag_th»shŞd
 = 
tx
->
loÿl
->
hw
.
why
->frag_threshold;

957 
hd¾’
;

958 
äagnum
;

961 
	`__skb_queue_
(&
tx
->
skbs
, 
skb
);

962 
tx
->
skb
 = 
NULL
;

964 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_DONTFRAG
)

965  
TX_CONTINUE
;

967 ià(
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
SUPPORTS_TX_FRAG
))

968  
TX_CONTINUE
;

975 ià(
	`WARN_ON
(
šfo
->
æags
 & 
IEEE80211_TX_CTL_AMPDU
))

976  
TX_DROP
;

978 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

981 ià(
	`WARN_ON
(
skb
->
Ën
 + 
FCS_LEN
 <ğ
äag_th»shŞd
))

982  
TX_DROP
;

992 ià(
	`›“80211_äagm’t
(
tx
, 
skb
, 
hd¾’
, 
äag_th»shŞd
))

993  
TX_DROP
;

996 
äagnum
 = 0;

998 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

999 cÚ¡ 
__Ë16
 
mÜeäags
 = 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREFRAGS
);

1001 
hdr
 = (*)
skb
->
d©a
;

1002 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1004 ià(!
	`skb_queue_is_Ï¡
(&
tx
->
skbs
, 
skb
)) {

1005 
hdr
->
äame_cÚŒŞ
 |ğ
mÜeäags
;

1010 
šfo
->
cÚŒŞ
.
¿‹s
[1].
idx
 = -1;

1011 
šfo
->
cÚŒŞ
.
¿‹s
[2].
idx
 = -1;

1012 
šfo
->
cÚŒŞ
.
¿‹s
[3].
idx
 = -1;

1013 
	`BUILD_BUG_ON
(
IEEE80211_TX_MAX_RATES
 != 4);

1014 
šfo
->
æags
 &ğ~
IEEE80211_TX_CTL_RATE_CTRL_PROBE
;

1016 
hdr
->
äame_cÚŒŞ
 &ğ~
mÜeäags
;

1018 
hdr
->
£q_ù¾
 |ğ
	`ıu_to_Ë16
(
äagnum
 & 
IEEE80211_SCTL_FRAG
);

1019 
äagnum
++;

1022  
TX_CONTINUE
;

1023 
	}
}

1025 
›“80211_tx_»suÉ
 
debug_nošlše


1026 
	$›“80211_tx_h_¡©s
(
›“80211_tx_d©a
 *
tx
)

1028 
sk_buff
 *
skb
;

1029 
ac
 = -1;

1031 ià(!
tx
->
¡a
)

1032  
TX_CONTINUE
;

1034 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

1035 
ac
 = 
	`skb_g‘_queue_m­pšg
(
skb
);

1036 
tx
->
¡a
->
deæšk
.
tx_¡©s
.
by‹s
[
ac
] +ğ
skb
->
Ën
;

1038 ià(
ac
 >= 0)

1039 
tx
->
¡a
->
deæšk
.
tx_¡©s
.
·ck‘s
[
ac
]++;

1041  
TX_CONTINUE
;

1042 
	}
}

1044 
›“80211_tx_»suÉ
 
debug_nošlše


1045 
	$›“80211_tx_h_’üy±
(
›“80211_tx_d©a
 *
tx
)

1047 ià(!
tx
->
key
)

1048  
TX_CONTINUE
;

1050 
tx
->
key
->
cÚf
.
ch”
) {

1051 
WLAN_CIPHER_SUITE_WEP40
:

1052 
WLAN_CIPHER_SUITE_WEP104
:

1053  
	`›“80211_üy±o_w•_’üy±
(
tx
);

1054 
WLAN_CIPHER_SUITE_TKIP
:

1055  
	`›“80211_üy±o_tk_’üy±
(
tx
);

1056 
WLAN_CIPHER_SUITE_CCMP
:

1057  
	`›“80211_üy±o_ccmp_’üy±
(

1058 
tx
, 
IEEE80211_CCMP_MIC_LEN
);

1059 
WLAN_CIPHER_SUITE_CCMP_256
:

1060  
	`›“80211_üy±o_ccmp_’üy±
(

1061 
tx
, 
IEEE80211_CCMP_256_MIC_LEN
);

1062 
WLAN_CIPHER_SUITE_AES_CMAC
:

1063  
	`›“80211_üy±o_«s_cmac_’üy±
(
tx
);

1064 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

1065  
	`›“80211_üy±o_«s_cmac_256_’üy±
(
tx
);

1066 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

1067 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

1068  
	`›“80211_üy±o_«s_gmac_’üy±
(
tx
);

1069 
WLAN_CIPHER_SUITE_GCMP
:

1070 
WLAN_CIPHER_SUITE_GCMP_256
:

1071  
	`›“80211_üy±o_gcmp_’üy±
(
tx
);

1074  
TX_DROP
;

1075 
	}
}

1077 
›“80211_tx_»suÉ
 
debug_nošlše


1078 
	$›“80211_tx_h_ÿlcuÏ‹_du¿tiÚ
(
›“80211_tx_d©a
 *
tx
)

1080 
sk_buff
 *
skb
;

1081 
›“80211_hdr
 *
hdr
;

1082 
Ãxt_Ën
;

1083 
boŞ
 
group_addr
;

1085 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

1086 
hdr
 = (*è
skb
->
d©a
;

1087 ià(
	`uÆik–y
(
	`›“80211_is_p¥Şl
(
hdr
->
äame_cÚŒŞ
)))

1089 ià(!
	`skb_queue_is_Ï¡
(&
tx
->
skbs
, 
skb
)) {

1090 
sk_buff
 *
Ãxt
 = 
	`skb_queue_Ãxt
(&
tx
->
skbs
, 
skb
);

1091 
Ãxt_Ën
 = 
Ãxt
->
Ën
;

1093 
Ãxt_Ën
 = 0;

1094 
group_addr
 = 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
);

1096 
hdr
->
du¿tiÚ_id
 =

1097 
	`›“80211_du¿tiÚ
(
tx
, 
skb
, 
group_addr
, 
Ãxt_Ën
);

1100  
TX_CONTINUE
;

1101 
	}
}

1105 
boŞ
 
	$›“80211_tx_´•_agg
(
›“80211_tx_d©a
 *
tx
,

1106 
sk_buff
 *
skb
,

1107 
›“80211_tx_šfo
 *
šfo
,

1108 
tid_ampdu_tx
 *
tid_tx
,

1109 
tid
)

1111 
boŞ
 
queued
 = 
çl£
;

1112 
boŞ
 
»£t_agg_tim”
 = 
çl£
;

1113 
sk_buff
 *
purge_skb
 = 
NULL
;

1115 ià(
	`‹¡_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
)) {

1116 
»£t_agg_tim”
 = 
Œue
;

1117 } ià(
	`‹¡_b™
(
HT_AGG_STATE_WANT_START
, &
tid_tx
->
¡©e
)) {

1122 } ià(!
tx
->
¡a
->¡a.
txq
[
tid
]) {

1123 
	`¥š_lock
(&
tx
->
¡a
->
lock
);

1142 
tid_tx
 = 
	`rcu_d”eã»nû_´Ùeùed_tid_tx
(
tx
->
¡a
, 
tid
);

1144 ià(!
tid_tx
) {

1146 } ià(
	`‹¡_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
)) {

1147 
»£t_agg_tim”
 = 
Œue
;

1149 
queued
 = 
Œue
;

1150 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_NO_PS_BUFFER
) {

1151 
	`ş—r_¡a_æag
(
tx
->
¡a
, 
WLAN_STA_SP
);

1152 
	`ps_dbg
(
tx
->
¡a
->
sd©a
,

1154 
tx
->
¡a
->¡a.
addr
,x->¡a->¡a.
aid
);

1156 
šfo
->
cÚŒŞ
.
vif
 = &
tx
->
sd©a
->vif;

1157 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

1158 
šfo
->
æags
 &ğ~
IEEE80211_TX_TEMPORARY_FLAGS
;

1159 
	`__skb_queue_
(&
tid_tx
->
³ndšg
, 
skb
);

1160 ià(
	`skb_queue_Ën
(&
tid_tx
->
³ndšg
è> 
STA_MAX_TX_BUFFER
)

1161 
purge_skb
 = 
	`__skb_dequeue
(&
tid_tx
->
³ndšg
);

1163 
	`¥š_uÆock
(&
tx
->
¡a
->
lock
);

1165 ià(
purge_skb
)

1166 
	`›“80211_ä“_txskb
(&
tx
->
loÿl
->
hw
, 
purge_skb
);

1170 ià(
»£t_agg_tim”
)

1171 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

1173  
queued
;

1174 
	}
}

1176 
	$›“80211_aggr_check
(
›“80211_sub_if_d©a
 *
sd©a
,

1177 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

1179 
¿‹_cÚŒŞ_»f
 *
»f
 = 
sd©a
->
loÿl
->
¿‹_ù¾
;

1180 
u16
 
tid
;

1182 ià(!
»f
 || !Ôef->
İs
->
ÿ·
 & 
RATE_CTRL_CAPA_AMPDU_TRIGGER
))

1185 ià(!
¡a
 || !¡a->¡a.
deæšk
.
ht_ÿp
.
ht_suµÜ‹d
 ||

1186 !
¡a
->¡a.
wme
 || 
	`skb_g‘_queue_m­pšg
(
skb
è=ğ
IEEE80211_AC_VO
 ||

1187 
skb
->
´ÙocŞ
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

1190 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TID_MASK
;

1191 ià(
	`lik–y
(
¡a
->
ampdu_mlme
.
tid_tx
[
tid
]))

1194 
	`›“80211_¡¬t_tx_ba_£ssiÚ
(&
¡a
->¡a, 
tid
, 0);

1195 
	}
}

1202 
›“80211_tx_»suÉ


1203 
	$›“80211_tx_´•¬e
(
›“80211_sub_if_d©a
 *
sd©a
,

1204 
›“80211_tx_d©a
 *
tx
,

1205 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

1207 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1208 
›“80211_hdr
 *
hdr
;

1209 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1210 
boŞ
 
aggr_check
 = 
çl£
;

1211 
tid
;

1213 
	`mem£t
(
tx
, 0, (*tx));

1214 
tx
->
skb
 = skb;

1215 
tx
->
loÿl
 =†ocal;

1216 
tx
->
sd©a
 = sdata;

1217 
	`__skb_queue_h—d_š™
(&
tx
->
skbs
);

1224 
šfo
->
cÚŒŞ
.
æags
 &ğ~
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

1226 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

1228 ià(
	`lik–y
(
¡a
)) {

1229 ià(!
	`IS_ERR
(
¡a
))

1230 
tx
->
¡a
 = sta;

1232 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

1233 
tx
->
¡a
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
vÏn
.sta);

1234 ià(!
tx
->
¡a
 && 
sd©a
->
wdev
.
u£_4addr
)

1235  
TX_DROP
;

1236 } ià(
tx
->
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 =ğtx->
skb
->
´ÙocŞ
) {

1237 
tx
->
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
hdr
->
addr1
);

1239 ià(!
tx
->
¡a
 && !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

1240 
tx
->
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
hdr
->
addr1
);

1241 
aggr_check
 = 
Œue
;

1245 ià(
tx
->
¡a
 && 
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
) &&

1246 !
	`›“80211_is_qos_nuÎfunc
(
hdr
->
äame_cÚŒŞ
) &&

1247 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_AGGREGATION
) &&

1248 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TX_AMPDU_SETUP_IN_HW
)) {

1249 
tid_ampdu_tx
 *
tid_tx
;

1251 
tid
 = 
	`›“80211_g‘_tid
(
hdr
);

1252 
tid_tx
 = 
	`rcu_d”eã»nû
(
tx
->
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

1253 ià(!
tid_tx
 && 
aggr_check
) {

1254 
	`›“80211_aggr_check
(
sd©a
, 
tx
->
¡a
, 
skb
);

1255 
tid_tx
 = 
	`rcu_d”eã»nû
(
tx
->
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

1258 ià(
tid_tx
) {

1259 
boŞ
 
queued
;

1261 
queued
 = 
	`›“80211_tx_´•_agg
(
tx
, 
skb
, 
šfo
,

1262 
tid_tx
, 
tid
);

1264 ià(
	`uÆik–y
(
queued
))

1265  
TX_QUEUED
;

1269 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

1270 
tx
->
æags
 &ğ~
IEEE80211_TX_UNICAST
;

1271 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

1273 
tx
->
æags
 |ğ
IEEE80211_TX_UNICAST
;

1275 ià(!(
šfo
->
æags
 & 
IEEE80211_TX_CTL_DONTFRAG
)) {

1276 ià(!(
tx
->
æags
 & 
IEEE80211_TX_UNICAST
) ||

1277 
skb
->
Ën
 + 
FCS_LEN
 <ğ
loÿl
->
hw
.
why
->
äag_th»shŞd
 ||

1278 
šfo
->
æags
 & 
IEEE80211_TX_CTL_AMPDU
)

1279 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_DONTFRAG
;

1282 ià(!
tx
->
¡a
)

1283 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_CLEAR_PS_FILT
;

1284 ià(
	`‹¡_ªd_ş—r_¡a_æag
(
tx
->
¡a
, 
WLAN_STA_CLEAR_PS_FILT
)) {

1285 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_CLEAR_PS_FILT
;

1286 
	`›“80211_check_ç¡_xm™
(
tx
->
¡a
);

1289 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_FIRST_FRAGMENT
;

1291  
TX_CONTINUE
;

1292 
	}
}

1294 
txq_šfo
 *
	$›“80211_g‘_txq
(
›“80211_loÿl
 *
loÿl
,

1295 
›“80211_vif
 *
vif
,

1296 
¡a_šfo
 *
¡a
,

1297 
sk_buff
 *
skb
)

1299 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

1300 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1301 
›“80211_txq
 *
txq
 = 
NULL
;

1303 ià((
šfo
->
æags
 & 
IEEE80211_TX_CTL_SEND_AFTER_DTIM
) ||

1304 (
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_PS_RESPONSE
))

1305  
NULL
;

1307 ià(!(
šfo
->
æags
 & 
IEEE80211_TX_CTL_HW_80211_ENCAP
) &&

1308 
	`uÆik–y
(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))) {

1309 ià((!
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
) ||

1310 
	`›“80211_is_bufã¿bË_mmpdu
(
skb
) ||

1311 
vif
->
ty³
 =ğ
NL80211_IFTYPE_STATION
) &&

1312 
¡a
 && s->
u¶ßded
) {

1317 
txq
 = 
¡a
->¡a.txq[
IEEE80211_NUM_TIDS
];

1319 } ià(
¡a
) {

1320 
u8
 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TID_MASK
;

1322 ià(!
¡a
->
u¶ßded
)

1323  
NULL
;

1325 
txq
 = 
¡a
->¡a.txq[
tid
];

1327 
txq
 = 
vif
->txq;

1330 ià(!
txq
)

1331  
NULL
;

1333  
	`to_txq_šfo
(
txq
);

1334 
	}
}

1336 
	$›“80211_£t_skb_’queue_time
(
sk_buff
 *
skb
)

1338 
sk_buff
 *
Ãxt
;

1339 
cod–_time_t
 
now
 = 
	`cod–_g‘_time
();

1341 
	`skb_li¡_w®k_§ã
(
skb
, skb, 
Ãxt
)

1342 
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
’queue_time
 = 
now
;

1343 
	}
}

1345 
u32
 
	$cod–_skb_Ën_func
(cÚ¡ 
sk_buff
 *
skb
)

1347  
skb
->
Ën
;

1348 
	}
}

1350 
cod–_time_t
 
	$cod–_skb_time_func
(cÚ¡ 
sk_buff
 *
skb
)

1352 cÚ¡ 
›“80211_tx_šfo
 *
šfo
;

1354 
šfo
 = (cÚ¡ 
›“80211_tx_šfo
 *)
skb
->
cb
;

1355  
šfo
->
cÚŒŞ
.
’queue_time
;

1356 
	}
}

1358 
sk_buff
 *
	$cod–_dequeue_func
(
cod–_v¬s
 *
cv¬s
,

1359 *
ùx
)

1361 
›“80211_loÿl
 *
loÿl
;

1362 
txq_šfo
 *
txqi
;

1363 
fq
 *fq;

1364 
fq_æow
 *
æow
;

1366 
txqi
 = 
ùx
;

1367 
loÿl
 = 
	`vif_to_sd©a
(
txqi
->
txq
.
vif
)->local;

1368 
fq
 = &
loÿl
->fq;

1370 ià(
cv¬s
 =ğ&
txqi
->
def_cv¬s
)

1371 
æow
 = &
txqi
->
tš
.
deçuÉ_æow
;

1373 
æow
 = &
fq
->
æows
[
cv¬s
 - 
loÿl
->cvars];

1375  
	`fq_æow_dequeue
(
fq
, 
æow
);

1376 
	}
}

1378 
	$cod–_drİ_func
(
sk_buff
 *
skb
,

1379 *
ùx
)

1381 
›“80211_loÿl
 *
loÿl
;

1382 
›“80211_hw
 *
hw
;

1383 
txq_šfo
 *
txqi
;

1385 
txqi
 = 
ùx
;

1386 
loÿl
 = 
	`vif_to_sd©a
(
txqi
->
txq
.
vif
)->local;

1387 
hw
 = &
loÿl
->hw;

1389 
	`›“80211_ä“_txskb
(
hw
, 
skb
);

1390 
	}
}

1392 
sk_buff
 *
	$fq_tš_dequeue_func
(
fq
 *fq,

1393 
fq_tš
 *
tš
,

1394 
fq_æow
 *
æow
)

1396 
›“80211_loÿl
 *
loÿl
;

1397 
txq_šfo
 *
txqi
;

1398 
cod–_v¬s
 *
cv¬s
;

1399 
cod–_·¿ms
 *
ı¬ams
;

1400 
cod–_¡©s
 *
c¡©s
;

1402 
loÿl
 = 
	`cÚš”_of
(
fq
, 
›“80211_loÿl
, fq);

1403 
txqi
 = 
	`cÚš”_of
(
tš
, 
txq_šfo
,in);

1404 
c¡©s
 = &
txqi
->cstats;

1406 ià(
txqi
->
txq
.
¡a
) {

1407 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
txqi
->
txq
.sta,

1408 
¡a_šfo
, 
¡a
);

1409 
ı¬ams
 = &
¡a
->cparams;

1411 
ı¬ams
 = &
loÿl
->cparams;

1414 ià(
æow
 =ğ&
tš
->
deçuÉ_æow
)

1415 
cv¬s
 = &
txqi
->
def_cv¬s
;

1417 
cv¬s
 = &
loÿl
->cv¬s[
æow
 - 
fq
->
æows
];

1419  
	`cod–_dequeue
(
txqi
,

1420 &
æow
->
backlog
,

1421 
ı¬ams
,

1422 
cv¬s
,

1423 
c¡©s
,

1424 
cod–_skb_Ën_func
,

1425 
cod–_skb_time_func
,

1426 
cod–_drİ_func
,

1427 
cod–_dequeue_func
);

1428 
	}
}

1430 
	$fq_skb_ä“_func
(
fq
 *fq,

1431 
fq_tš
 *
tš
,

1432 
fq_æow
 *
æow
,

1433 
sk_buff
 *
skb
)

1435 
›“80211_loÿl
 *
loÿl
;

1437 
loÿl
 = 
	`cÚš”_of
(
fq
, 
›“80211_loÿl
, fq);

1438 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

1439 
	}
}

1441 
	$›“80211_txq_’queue
(
›“80211_loÿl
 *
loÿl
,

1442 
txq_šfo
 *
txqi
,

1443 
sk_buff
 *
skb
)

1445 
fq
 *fq = &
loÿl
->fq;

1446 
fq_tš
 *
tš
 = &
txqi
->tin;

1447 
u32
 
æow_idx
 = 
	`fq_æow_idx
(
fq
, 
skb
);

1449 
	`›“80211_£t_skb_’queue_time
(
skb
);

1451 
	`¥š_lock_bh
(&
fq
->
lock
);

1458 ià(
	`uÆik–y
(
txqi
->
txq
.
tid
 =ğ
IEEE80211_NUM_TIDS
)) {

1459 
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
æags
 |=

1460 
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

1461 
	`__skb_queue_
(&
txqi
->
äags
, 
skb
);

1463 
	`fq_tš_’queue
(
fq
, 
tš
, 
æow_idx
, 
skb
,

1464 
fq_skb_ä“_func
);

1466 
	`¥š_uÆock_bh
(&
fq
->
lock
);

1467 
	}
}

1469 
boŞ
 
	$fq_vÏn_f‹r_func
(
fq
 *fq, 
fq_tš
 *
tš
,

1470 
fq_æow
 *
æow
, 
sk_buff
 *
skb
,

1471 *
d©a
)

1473 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1475  
šfo
->
cÚŒŞ
.
vif
 =ğ
d©a
;

1476 
	}
}

1478 
	$›“80211_txq_»move_vÏn
(
›“80211_loÿl
 *
loÿl
,

1479 
›“80211_sub_if_d©a
 *
sd©a
)

1481 
fq
 *fq = &
loÿl
->fq;

1482 
txq_šfo
 *
txqi
;

1483 
fq_tš
 *
tš
;

1484 
›“80211_sub_if_d©a
 *
­
;

1486 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
))

1489 
­
 = 
	`cÚš”_of
(
sd©a
->
bss
, 
›“80211_sub_if_d©a
, 
u
.ap);

1491 ià(!
­
->
vif
.
txq
)

1494 
txqi
 = 
	`to_txq_šfo
(
­
->
vif
.
txq
);

1495 
tš
 = &
txqi
->tin;

1497 
	`¥š_lock_bh
(&
fq
->
lock
);

1498 
	`fq_tš_f‹r
(
fq
, 
tš
, 
fq_vÏn_f‹r_func
, &
sd©a
->
vif
,

1499 
fq_skb_ä“_func
);

1500 
	`¥š_uÆock_bh
(&
fq
->
lock
);

1501 
	}
}

1503 
	$›“80211_txq_š™
(
›“80211_sub_if_d©a
 *
sd©a
,

1504 
¡a_šfo
 *
¡a
,

1505 
txq_šfo
 *
txqi
, 
tid
)

1507 
	`fq_tš_š™
(&
txqi
->
tš
);

1508 
	`cod–_v¬s_š™
(&
txqi
->
def_cv¬s
);

1509 
	`cod–_¡©s_š™
(&
txqi
->
c¡©s
);

1510 
	`__skb_queue_h—d_š™
(&
txqi
->
äags
);

1511 
	`INIT_LIST_HEAD
(&
txqi
->
scheduË_Üd”
);

1513 
txqi
->
txq
.
vif
 = &
sd©a
->vif;

1515 ià(!
¡a
) {

1516 
sd©a
->
vif
.
txq
 = &
txqi
->txq;

1517 
txqi
->
txq
.
tid
 = 0;

1518 
txqi
->
txq
.
ac
 = 
IEEE80211_AC_BE
;

1523 ià(
tid
 =ğ
IEEE80211_NUM_TIDS
) {

1524 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

1526 ià(!
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
,

1527 
STA_MMPDU_TXQ
))

1529 } ià(!
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
,

1530 
BUFF_MMPDU_TXQ
)) {

1534 
txqi
->
txq
.
ac
 = 
IEEE80211_AC_VO
;

1536 
txqi
->
txq
.
ac
 = 
	`›“80211_ac_äom_tid
(
tid
);

1539 
txqi
->
txq
.
¡a
 = &sta->sta;

1540 
txqi
->
txq
.
tid
 =id;

1541 
¡a
->¡a.
txq
[
tid
] = &
txqi
->txq;

1542 
	}
}

1544 
	$›“80211_txq_purge
(
›“80211_loÿl
 *
loÿl
,

1545 
txq_šfo
 *
txqi
)

1547 
fq
 *fq = &
loÿl
->fq;

1548 
fq_tš
 *
tš
 = &
txqi
->tin;

1550 
	`¥š_lock_bh
(&
fq
->
lock
);

1551 
	`fq_tš_»£t
(
fq
, 
tš
, 
fq_skb_ä“_func
);

1552 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
, &
txqi
->
äags
);

1553 
	`¥š_uÆock_bh
(&
fq
->
lock
);

1555 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
txqi
->
txq
.
ac
]);

1556 
	`li¡_d–_š™
(&
txqi
->
scheduË_Üd”
);

1557 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
txqi
->
txq
.
ac
]);

1558 
	}
}

1560 
	$›“80211_txq_£t_·¿ms
(
›“80211_loÿl
 *
loÿl
)

1562 ià(
loÿl
->
hw
.
why
->
txq_lim™
)

1563 
loÿl
->
fq
.
lim™
 =†oÿl->
hw
.
why
->
txq_lim™
;

1565 
loÿl
->
hw
.
why
->
txq_lim™
 =†oÿl->
fq
.
lim™
;

1567 ià(
loÿl
->
hw
.
why
->
txq_memÜy_lim™
)

1568 
loÿl
->
fq
.
memÜy_lim™
 =†oÿl->
hw
.
why
->
txq_memÜy_lim™
;

1570 
loÿl
->
hw
.
why
->
txq_memÜy_lim™
 =†oÿl->
fq
.
memÜy_lim™
;

1572 ià(
loÿl
->
hw
.
why
->
txq_quªtum
)

1573 
loÿl
->
fq
.
quªtum
 =†oÿl->
hw
.
why
->
txq_quªtum
;

1575 
loÿl
->
hw
.
why
->
txq_quªtum
 =†oÿl->
fq
.
quªtum
;

1576 
	}
}

1578 
	$›“80211_txq_£tup_æows
(
›“80211_loÿl
 *
loÿl
)

1580 
fq
 *fq = &
loÿl
->fq;

1581 
»t
;

1582 
i
;

1583 
boŞ
 
suµ_vht
 = 
çl£
;

1584 
Æ80211_bªd
 
bªd
;

1586 
»t
 = 
	`fq_š™
(
fq
, 4096);

1587 ià(
»t
)

1588  
»t
;

1594 
bªd
 = 0; bªd < 
NUM_NL80211_BANDS
; band++) {

1595 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1597 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1598 ià(!
sbªd
)

1601 
suµ_vht
 = suµ_vhˆ|| 
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
;

1604 ià(!
suµ_vht
)

1605 
fq
->
memÜy_lim™
 = 4 << 20;

1607 
	`cod–_·¿ms_š™
(&
loÿl
->
ı¬ams
);

1608 
loÿl
->
ı¬ams
.
š‹rv®
 = 
	`MS2TIME
(100);

1609 
loÿl
->
ı¬ams
.
rg‘
 = 
	`MS2TIME
(20);

1610 
loÿl
->
ı¬ams
.
eú
 = 
Œue
;

1612 
loÿl
->
cv¬s
 = 
	`kÿÎoc
(
fq
->
æows_út
, (local->cvars[0]),

1613 
GFP_KERNEL
);

1614 ià(!
loÿl
->
cv¬s
) {

1615 
	`¥š_lock_bh
(&
fq
->
lock
);

1616 
	`fq_»£t
(
fq
, 
fq_skb_ä“_func
);

1617 
	`¥š_uÆock_bh
(&
fq
->
lock
);

1618  -
ENOMEM
;

1621 
i
 = 0; i < 
fq
->
æows_út
; i++)

1622 
	`cod–_v¬s_š™
(&
loÿl
->
cv¬s
[
i
]);

1624 
	`›“80211_txq_£t_·¿ms
(
loÿl
);

1627 
	}
}

1629 
	$›“80211_txq_‹¬down_æows
(
›“80211_loÿl
 *
loÿl
)

1631 
fq
 *fq = &
loÿl
->fq;

1633 
	`kä“
(
loÿl
->
cv¬s
);

1634 
loÿl
->
cv¬s
 = 
NULL
;

1636 
	`¥š_lock_bh
(&
fq
->
lock
);

1637 
	`fq_»£t
(
fq
, 
fq_skb_ä“_func
);

1638 
	`¥š_uÆock_bh
(&
fq
->
lock
);

1639 
	}
}

1641 
boŞ
 
	$›“80211_queue_skb
(
›“80211_loÿl
 *
loÿl
,

1642 
›“80211_sub_if_d©a
 *
sd©a
,

1643 
¡a_šfo
 *
¡a
,

1644 
sk_buff
 *
skb
)

1646 
›“80211_vif
 *
vif
;

1647 
txq_šfo
 *
txqi
;

1649 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
)

1650  
çl£
;

1652 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

1653 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
,

1654 
›“80211_sub_if_d©a
, 
u
.
­
);

1656 
vif
 = &
sd©a
->vif;

1657 
txqi
 = 
	`›“80211_g‘_txq
(
loÿl
, 
vif
, 
¡a
, 
skb
);

1659 ià(!
txqi
)

1660  
çl£
;

1662 
	`›“80211_txq_’queue
(
loÿl
, 
txqi
, 
skb
);

1664 
	`scheduË_ªd_wake_txq
(
loÿl
, 
txqi
);

1666  
Œue
;

1667 
	}
}

1669 
boŞ
 
	$›“80211_tx_äags
(
›“80211_loÿl
 *
loÿl
,

1670 
›“80211_vif
 *
vif
,

1671 
¡a_šfo
 *
¡a
,

1672 
sk_buff_h—d
 *
skbs
,

1673 
boŞ
 
tx³ndšg
)

1675 
›“80211_tx_cÚŒŞ
 
cÚŒŞ
 = {};

1676 
sk_buff
 *
skb
, *
tmp
;

1677 
æags
;

1679 
	`skb_queue_w®k_§ã
(
skbs
, 
skb
, 
tmp
) {

1680 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1681 
q
 = 
šfo
->
hw_queue
;

1683 #ifdeà
CONFIG_MAC80211_VERBOSE_DEBUG


1684 ià(
	`WARN_ON_ONCE
(
q
 >ğ
loÿl
->
hw
.
queues
)) {

1685 
	`__skb_uÆšk
(
skb
, 
skbs
);

1686 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

1691 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

1692 ià(
loÿl
->
queue_¡İ_»asÚs
[
q
] ||

1693 (!
tx³ndšg
 && !
	`skb_queue_em±y
(&
loÿl
->
³ndšg
[
q
]))) {

1694 ià(
	`uÆik–y
(
šfo
->
æags
 &

1695 
IEEE80211_TX_INTFL_OFFCHAN_TX_OK
)) {

1696 ià(
loÿl
->
queue_¡İ_»asÚs
[
q
] &

1697 ~
	`BIT
(
IEEE80211_QUEUE_STOP_REASON_OFFCHANNEL
)) {

1704 
	`¥š_uÆock_œq»¡Üe
(

1705 &
loÿl
->
queue_¡İ_»asÚ_lock
,

1706 
æags
);

1707 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
,

1708 
skbs
);

1709  
Œue
;

1718 ià(
tx³ndšg
)

1719 
	`skb_queue_¥liû_š™
(
skbs
,

1720 &
loÿl
->
³ndšg
[
q
]);

1722 
	`skb_queue_¥liû__š™
(
skbs
,

1723 &
loÿl
->
³ndšg
[
q
]);

1725 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
,

1726 
æags
);

1727  
çl£
;

1730 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

1732 
šfo
->
cÚŒŞ
.
vif
 = vif;

1733 
cÚŒŞ
.
¡a
 = s ? &¡a->¡¨: 
NULL
;

1735 
	`__skb_uÆšk
(
skb
, 
skbs
);

1736 
	`drv_tx
(
loÿl
, &
cÚŒŞ
, 
skb
);

1739  
Œue
;

1740 
	}
}

1745 
boŞ
 
	$__›“80211_tx
(
›“80211_loÿl
 *
loÿl
,

1746 
sk_buff_h—d
 *
skbs
, 
¡a_šfo
 *
¡a
,

1747 
boŞ
 
tx³ndšg
)

1749 
›“80211_tx_šfo
 *
šfo
;

1750 
›“80211_sub_if_d©a
 *
sd©a
;

1751 
›“80211_vif
 *
vif
;

1752 
sk_buff
 *
skb
;

1753 
boŞ
 
»suÉ
;

1755 ià(
	`WARN_ON
(
	`skb_queue_em±y
(
skbs
)))

1756  
Œue
;

1758 
skb
 = 
	`skb_³ek
(
skbs
);

1759 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1760 
sd©a
 = 
	`vif_to_sd©a
(
šfo
->
cÚŒŞ
.
vif
);

1761 ià(
¡a
 && !¡a->
u¶ßded
)

1762 
¡a
 = 
NULL
;

1764 
sd©a
->
vif
.
ty³
) {

1765 
NL80211_IFTYPE_MONITOR
:

1766 ià(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
) {

1767 
vif
 = &
sd©a
->vif;

1770 
sd©a
 = 
	`rcu_d”eã»nû
(
loÿl
->
mÚ™Ü_sd©a
);

1771 ià(
sd©a
) {

1772 
vif
 = &
sd©a
->vif;

1773 
šfo
->
hw_queue
 =

1774 
vif
->
hw_queue
[
	`skb_g‘_queue_m­pšg
(
skb
)];

1775 } ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
)) {

1776 
	`›“80211_purge_tx_queue
(&
loÿl
->
hw
, 
skbs
);

1777  
Œue
;

1779 
vif
 = 
NULL
;

1781 
NL80211_IFTYPE_AP_VLAN
:

1782 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
,

1783 
›“80211_sub_if_d©a
, 
u
.
­
);

1784 
çÎthrough
;

1786 
vif
 = &
sd©a
->vif;

1790 
»suÉ
 = 
	`›“80211_tx_äags
(
loÿl
, 
vif
, 
¡a
, 
skbs
, 
tx³ndšg
);

1792 
	`WARN_ON_ONCE
(!
	`skb_queue_em±y
(
skbs
));

1794  
»suÉ
;

1795 
	}
}

1805 
	$švoke_tx_hªdËrs_—¾y
(
›“80211_tx_d©a
 *
tx
)

1807 
›“80211_tx_»suÉ
 
»s
 = 
TX_DROP
;

1809 
	#CALL_TXH
(
txh
) \

1811 
»s
 = 
	`txh
(
tx
); \

1812 ià(
»s
 !ğ
TX_CONTINUE
) \

1813 
txh_dÚe
; \

1814 } 0)

	)

1816 
	`CALL_TXH
(
›“80211_tx_h_dyÇmic_ps
);

1817 
	`CALL_TXH
(
›“80211_tx_h_check_assoc
);

1818 
	`CALL_TXH
(
›“80211_tx_h_ps_buf
);

1819 
	`CALL_TXH
(
›“80211_tx_h_check_cÚŒŞ_pÜt_´ÙocŞ
);

1820 
	`CALL_TXH
(
›“80211_tx_h_£Ëù_key
);

1822 
txh_dÚe
:

1823 ià(
	`uÆik–y
(
»s
 =ğ
TX_DROP
)) {

1824 
	`I802_DEBUG_INC
(
tx
->
loÿl
->
tx_hªdËrs_drİ
);

1825 ià(
tx
->
skb
)

1826 
	`›“80211_ä“_txskb
(&
tx
->
loÿl
->
hw
,x->
skb
);

1828 
	`›“80211_purge_tx_queue
(&
tx
->
loÿl
->
hw
, &tx->
skbs
);

1830 } ià(
	`uÆik–y
(
»s
 =ğ
TX_QUEUED
)) {

1831 
	`I802_DEBUG_INC
(
tx
->
loÿl
->
tx_hªdËrs_queued
);

1836 
	}
}

1842 
	$švoke_tx_hªdËrs_Ï‹
(
›“80211_tx_d©a
 *
tx
)

1844 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
tx
->
skb
);

1845 
›“80211_tx_»suÉ
 
»s
 = 
TX_CONTINUE
;

1847 ià(!
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
HAS_RATE_CONTROL
))

1848 
	`CALL_TXH
(
›“80211_tx_h_¿‹_ù¾
);

1850 ià(
	`uÆik–y
(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_RETRANSMISSION
)) {

1851 
	`__skb_queue_
(&
tx
->
skbs
,x->
skb
);

1852 
tx
->
skb
 = 
NULL
;

1853 
txh_dÚe
;

1856 
	`CALL_TXH
(
›“80211_tx_h_mich«l_mic_add
);

1857 
	`CALL_TXH
(
›“80211_tx_h_£qu’û
);

1858 
	`CALL_TXH
(
›“80211_tx_h_äagm’t
);

1860 
	`CALL_TXH
(
›“80211_tx_h_¡©s
);

1861 
	`CALL_TXH
(
›“80211_tx_h_’üy±
);

1862 ià(!
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
HAS_RATE_CONTROL
))

1863 
	`CALL_TXH
(
›“80211_tx_h_ÿlcuÏ‹_du¿tiÚ
);

1864 #undeà
CALL_TXH


1866 
txh_dÚe
:

1867 ià(
	`uÆik–y
(
»s
 =ğ
TX_DROP
)) {

1868 
	`I802_DEBUG_INC
(
tx
->
loÿl
->
tx_hªdËrs_drİ
);

1869 ià(
tx
->
skb
)

1870 
	`›“80211_ä“_txskb
(&
tx
->
loÿl
->
hw
,x->
skb
);

1872 
	`›“80211_purge_tx_queue
(&
tx
->
loÿl
->
hw
, &tx->
skbs
);

1874 } ià(
	`uÆik–y
(
»s
 =ğ
TX_QUEUED
)) {

1875 
	`I802_DEBUG_INC
(
tx
->
loÿl
->
tx_hªdËrs_queued
);

1880 
	}
}

1882 
	$švoke_tx_hªdËrs
(
›“80211_tx_d©a
 *
tx
)

1884 
r
 = 
	`švoke_tx_hªdËrs_—¾y
(
tx
);

1886 ià(
r
)

1887  
r
;

1888  
	`švoke_tx_hªdËrs_Ï‹
(
tx
);

1889 
	}
}

1891 
boŞ
 
	$›“80211_tx_´•¬e_skb
(
›“80211_hw
 *
hw
,

1892 
›“80211_vif
 *
vif
, 
sk_buff
 *
skb
,

1893 
bªd
, 
›“80211_¡a
 **
¡a
)

1895 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

1896 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1897 
›“80211_tx_d©a
 
tx
;

1898 
sk_buff
 *
skb2
;

1900 ià(
	`›“80211_tx_´•¬e
(
sd©a
, &
tx
, 
NULL
, 
skb
è=ğ
TX_DROP
)

1901  
çl£
;

1903 
šfo
->
bªd
 = band;

1904 
šfo
->
cÚŒŞ
.
vif
 = vif;

1905 
šfo
->
hw_queue
 = 
vif
->hw_queue[
	`skb_g‘_queue_m­pšg
(
skb
)];

1907 ià(
	`švoke_tx_hªdËrs
(&
tx
))

1908  
çl£
;

1910 ià(
¡a
) {

1911 ià(
tx
.
¡a
)

1912 *
¡a
 = &
tx
.sta->sta;

1914 *
¡a
 = 
NULL
;

1918 
skb2
 = 
	`__skb_dequeue
(&
tx
.
skbs
);

1919 ià(
	`WARN_ON
(
skb2
 !ğ
skb
 || !
	`skb_queue_em±y
(&
tx
.
skbs
))) {

1920 
	`›“80211_ä“_txskb
(
hw
, 
skb2
);

1921 
	`›“80211_purge_tx_queue
(
hw
, &
tx
.
skbs
);

1922  
çl£
;

1925  
Œue
;

1926 
	}
}

1927 
EXPORT_SYMBOL
(
›“80211_tx_´•¬e_skb
);

1932 
boŞ
 
	$›“80211_tx
(
›“80211_sub_if_d©a
 *
sd©a
,

1933 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
,

1934 
boŞ
 
tx³ndšg
)

1936 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1937 
›“80211_tx_d©a
 
tx
;

1938 
›“80211_tx_»suÉ
 
»s_´•¬e
;

1939 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1940 
boŞ
 
»suÉ
 = 
Œue
;

1942 ià(
	`uÆik–y
(
skb
->
Ën
 < 10)) {

1943 
	`dev_kä“_skb
(
skb
);

1944  
Œue
;

1948 
»s_´•¬e
 = 
	`›“80211_tx_´•¬e
(
sd©a
, &
tx
, 
¡a
, 
skb
);

1950 ià(
	`uÆik–y
(
»s_´•¬e
 =ğ
TX_DROP
)) {

1951 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

1952  
Œue
;

1953 } ià(
	`uÆik–y
(
»s_´•¬e
 =ğ
TX_QUEUED
)) {

1954  
Œue
;

1958 ià(!(
šfo
->
æags
 & 
IEEE80211_TX_CTL_TX_OFFCHAN
) ||

1959 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
))

1960 
šfo
->
hw_queue
 =

1961 
sd©a
->
vif
.
hw_queue
[
	`skb_g‘_queue_m­pšg
(
skb
)];

1963 ià(
	`švoke_tx_hªdËrs_—¾y
(&
tx
))

1964  
Œue
;

1966 ià(
	`›“80211_queue_skb
(
loÿl
, 
sd©a
, 
tx
.
¡a
,x.
skb
))

1967  
Œue
;

1969 ià(!
	`švoke_tx_hªdËrs_Ï‹
(&
tx
))

1970 
»suÉ
 = 
	`__›“80211_tx
(
loÿl
, &
tx
.
skbs
,x.
¡a
, 
tx³ndšg
);

1972  
»suÉ
;

1973 
	}
}

1977 
	e›“80211_’üy±
 {

1978 
	mENCRYPT_NO
,

1979 
	mENCRYPT_MGMT
,

1980 
	mENCRYPT_DATA
,

1983 
	$›“80211_skb_»size
(
›“80211_sub_if_d©a
 *
sd©a
,

1984 
sk_buff
 *
skb
,

1985 
h—d_Ãed
,

1986 
›“80211_’üy±
 
’üy±
)

1988 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1989 
boŞ
 
’c_room
;

1990 
_Ãed
 = 0;

1992 
’c_room
 = 
’üy±
 =ğ
ENCRYPT_MGMT
 ||

1993 (
’üy±
 =ğ
ENCRYPT_DATA
 &&

1994 
sd©a
->
üy±o_tx_room_Ãeded_út
);

1996 ià(
’c_room
) {

1997 
_Ãed
 = 
IEEE80211_ENCRYPT_TAILROOM
;

1998 
_Ãed
 -ğ
	`skb_room
(
skb
);

1999 
_Ãed
 = 
	`max_t
(,ail_need, 0);

2002 ià(
	`skb_şÚed
(
skb
) &&

2003 (!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_CLONED_SKBS
) ||

2004 !
	`skb_şÚe_wr™abË
(
skb
, 
ETH_HLEN
è|| 
’c_room
))

2005 
	`I802_DEBUG_INC
(
loÿl
->
tx_ex·nd_skb_h—d_şÚed
);

2006 ià(
h—d_Ãed
 || 
_Ãed
)

2007 
	`I802_DEBUG_INC
(
loÿl
->
tx_ex·nd_skb_h—d
);

2011 ià(
	`pskb_ex·nd_h—d
(
skb
, 
h—d_Ãed
, 
_Ãed
, 
GFP_ATOMIC
)) {

2012 
	`why_debug
(
loÿl
->
hw
.
why
,

2014  -
ENOMEM
;

2018 
	}
}

2020 
	$›“80211_xm™
(
›“80211_sub_if_d©a
 *
sd©a
,

2021 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

2023 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2024 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2025 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

2026 
h—droom
;

2027 
›“80211_’üy±
 
’üy±
;

2029 ià(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_DONT_ENCRYPT
)

2030 
’üy±
 = 
ENCRYPT_NO
;

2031 ià(
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

2032 
’üy±
 = 
ENCRYPT_MGMT
;

2034 
’üy±
 = 
ENCRYPT_DATA
;

2036 
h—droom
 = 
loÿl
->
tx_h—droom
;

2037 ià(
’üy±
 !ğ
ENCRYPT_NO
)

2038 
h—droom
 +ğ
IEEE80211_ENCRYPT_HEADROOM
;

2039 
h—droom
 -ğ
	`skb_h—droom
(
skb
);

2040 
h—droom
 = 
	`max_t
(, 0, headroom);

2042 ià(
	`›“80211_skb_»size
(
sd©a
, 
skb
, 
h—droom
, 
’üy±
)) {

2043 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

2048 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

2049 
šfo
->
cÚŒŞ
.
vif
 = &
sd©a
->vif;

2051 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

2052 ià(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

2053 
	`is_uniÿ¡_‘h”_addr
(
hdr
->
addr1
)) {

2054 ià(
	`mesh_Ãxthİ_»sŞve
(
sd©a
, 
skb
))

2057 
	`›“80211_mps_£t_äame_æags
(
sd©a
, 
NULL
, 
hdr
);

2061 
	`›“80211_£t_qos_hdr
(
sd©a
, 
skb
);

2062 
	`›“80211_tx
(
sd©a
, 
¡a
, 
skb
, 
çl£
);

2063 
	}
}

2065 
boŞ
 
	$›“80211_v®id©e_¿diÙ­_Ën
(
sk_buff
 *
skb
)

2067 
›“80211_¿diÙ­_h—d”
 *
¹hdr
 =

2068 (
›“80211_¿diÙ­_h—d”
 *)
skb
->
d©a
;

2071 ià(
	`uÆik–y
(
skb
->
Ën
 < (
›“80211_¿diÙ­_h—d”
)))

2072  
çl£
;

2075 ià(
	`uÆik–y
(
¹hdr
->
™_v”siÚ
))

2076  
çl£
;

2079 ià(
	`uÆik–y
(
skb
->
Ën
 < 
	`›“80211_g‘_¿diÙ­_Ën
(skb->
d©a
)))

2080  
çl£
;

2082  
Œue
;

2083 
	}
}

2085 
boŞ
 
	$›“80211_·r£_tx_¿diÙ­
(
sk_buff
 *
skb
,

2086 
Ãt_deviû
 *
dev
)

2088 
›“80211_loÿl
 *
loÿl
 = 
	`wdev_´iv
(
dev
->
›“80211_±r
);

2089 
›“80211_¿diÙ­_™”©Ü
 
™”©Ü
;

2090 
›“80211_¿diÙ­_h—d”
 *
¹hdr
 =

2091 (
›“80211_¿diÙ­_h—d”
 *è
skb
->
d©a
;

2092 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2093 
»t
 = 
	`›“80211_¿diÙ­_™”©Ü_š™
(&
™”©Ü
, 
¹hdr
, 
skb
->
Ën
,

2094 
NULL
);

2095 
u16
 
txæags
;

2096 
u16
 
¿‹
 = 0;

2097 
boŞ
 
¿‹_found
 = 
çl£
;

2098 
u8
 
¿‹_»Œ›s
 = 0;

2099 
u16
 
¿‹_æags
 = 0;

2100 
u8
 
mcs_known
, 
mcs_æags
, 
mcs_bw
;

2101 
u16
 
vht_known
;

2102 
u8
 
vht_mcs
 = 0, 
vht_nss
 = 0;

2103 
i
;

2105 ià(!
	`›“80211_v®id©e_¿diÙ­_Ën
(
skb
))

2106  
çl£
;

2108 
šfo
->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
 |

2109 
IEEE80211_TX_CTL_DONTFRAG
;

2117 !
»t
) {

2118 
»t
 = 
	`›“80211_¿diÙ­_™”©Ü_Ãxt
(&
™”©Ü
);

2120 ià(
»t
)

2124 
™”©Ü
.
this_¬g_šdex
) {

2131 
IEEE80211_RADIOTAP_FLAGS
:

2132 ià(*
™”©Ü
.
this_¬g
 & 
IEEE80211_RADIOTAP_F_FCS
) {

2140 ià(
skb
->
Ën
 < (
™”©Ü
.
_max_Ëngth
 + 
FCS_LEN
))

2141  
çl£
;

2143 
	`skb_Œim
(
skb
, skb->
Ën
 - 
FCS_LEN
);

2145 ià(*
™”©Ü
.
this_¬g
 & 
IEEE80211_RADIOTAP_F_WEP
)

2146 
šfo
->
æags
 &ğ~
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

2147 ià(*
™”©Ü
.
this_¬g
 & 
IEEE80211_RADIOTAP_F_FRAG
)

2148 
šfo
->
æags
 &ğ~
IEEE80211_TX_CTL_DONTFRAG
;

2151 
IEEE80211_RADIOTAP_TX_FLAGS
:

2152 
txæags
 = 
	`g‘_uÇligÃd_Ë16
(
™”©Ü
.
this_¬g
);

2153 ià(
txæags
 & 
IEEE80211_RADIOTAP_F_TX_NOACK
)

2154 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

2155 ià(
txæags
 & 
IEEE80211_RADIOTAP_F_TX_NOSEQNO
)

2156 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_NO_SEQNO
;

2157 ià(
txæags
 & 
IEEE80211_RADIOTAP_F_TX_ORDER
)

2158 
šfo
->
cÚŒŞ
.
æags
 |=

2159 
IEEE80211_TX_CTRL_DONT_REORDER
;

2162 
IEEE80211_RADIOTAP_RATE
:

2163 
¿‹
 = *
™”©Ü
.
this_¬g
;

2164 
¿‹_æags
 = 0;

2165 
¿‹_found
 = 
Œue
;

2168 
IEEE80211_RADIOTAP_ANTENNA
:

2170 
šfo
->
cÚŒŞ
.
ª‹Âas
 |ğ
	`BIT
(*
™”©Ü
.
this_¬g
);

2173 
IEEE80211_RADIOTAP_DATA_RETRIES
:

2174 
¿‹_»Œ›s
 = *
™”©Ü
.
this_¬g
;

2177 
IEEE80211_RADIOTAP_MCS
:

2178 
mcs_known
 = 
™”©Ü
.
this_¬g
[0];

2179 
mcs_æags
 = 
™”©Ü
.
this_¬g
[1];

2180 ià(!(
mcs_known
 & 
IEEE80211_RADIOTAP_MCS_HAVE_MCS
))

2183 
¿‹_found
 = 
Œue
;

2184 
¿‹
 = 
™”©Ü
.
this_¬g
[2];

2185 
¿‹_æags
 = 
IEEE80211_TX_RC_MCS
;

2187 ià(
mcs_known
 & 
IEEE80211_RADIOTAP_MCS_HAVE_GI
 &&

2188 
mcs_æags
 & 
IEEE80211_RADIOTAP_MCS_SGI
)

2189 
¿‹_æags
 |ğ
IEEE80211_TX_RC_SHORT_GI
;

2191 
mcs_bw
 = 
mcs_æags
 & 
IEEE80211_RADIOTAP_MCS_BW_MASK
;

2192 ià(
mcs_known
 & 
IEEE80211_RADIOTAP_MCS_HAVE_BW
 &&

2193 
mcs_bw
 =ğ
IEEE80211_RADIOTAP_MCS_BW_40
)

2194 
¿‹_æags
 |ğ
IEEE80211_TX_RC_40_MHZ_WIDTH
;

2196 ià(
mcs_known
 & 
IEEE80211_RADIOTAP_MCS_HAVE_FEC
 &&

2197 
mcs_æags
 & 
IEEE80211_RADIOTAP_MCS_FEC_LDPC
)

2198 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_LDPC
;

2200 ià(
mcs_known
 & 
IEEE80211_RADIOTAP_MCS_HAVE_STBC
) {

2201 
u8
 
¡bc
 = 
	`u8_g‘_b™s
(
mcs_æags
,

2202 
IEEE80211_RADIOTAP_MCS_STBC_MASK
);

2204 
šfo
->
æags
 |=

2205 
	`u32_’code_b™s
(
¡bc
,

2206 
IEEE80211_TX_CTL_STBC
);

2210 
IEEE80211_RADIOTAP_VHT
:

2211 
vht_known
 = 
	`g‘_uÇligÃd_Ë16
(
™”©Ü
.
this_¬g
);

2212 
¿‹_found
 = 
Œue
;

2214 
¿‹_æags
 = 
IEEE80211_TX_RC_VHT_MCS
;

2215 ià((
vht_known
 & 
IEEE80211_RADIOTAP_VHT_KNOWN_GI
) &&

2216 (
™”©Ü
.
this_¬g
[2] &

2217 
IEEE80211_RADIOTAP_VHT_FLAG_SGI
))

2218 
¿‹_æags
 |ğ
IEEE80211_TX_RC_SHORT_GI
;

2219 ià(
vht_known
 &

2220 
IEEE80211_RADIOTAP_VHT_KNOWN_BANDWIDTH
) {

2221 ià(
™”©Ü
.
this_¬g
[3] == 1)

2222 
¿‹_æags
 |=

2223 
IEEE80211_TX_RC_40_MHZ_WIDTH
;

2224 ià(
™”©Ü
.
this_¬g
[3] == 4)

2225 
¿‹_æags
 |=

2226 
IEEE80211_TX_RC_80_MHZ_WIDTH
;

2227 ià(
™”©Ü
.
this_¬g
[3] == 11)

2228 
¿‹_æags
 |=

2229 
IEEE80211_TX_RC_160_MHZ_WIDTH
;

2232 
vht_mcs
 = 
™”©Ü
.
this_¬g
[4] >> 4;

2233 ià(
vht_mcs
 > 11)

2234 
vht_mcs
 = 0;

2235 
vht_nss
 = 
™”©Ü
.
this_¬g
[4] & 0xF;

2236 ià(!
vht_nss
 || vht_nss > 8)

2237 
vht_nss
 = 1;

2251 ià(
»t
 !ğ-
ENOENT
)

2252  
çl£
;

2254 ià(
¿‹_found
) {

2255 
›“80211_suµÜ‹d_bªd
 *
sbªd
 =

2256 
loÿl
->
hw
.
why
->
bªds
[
šfo
->
bªd
];

2258 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_RATE_INJECT
;

2260 
i
 = 0; i < 
IEEE80211_TX_MAX_RATES
; i++) {

2261 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
idx
 = -1;

2262 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
æags
 = 0;

2263 
šfo
->
cÚŒŞ
.
¿‹s
[
i
].
couÁ
 = 0;

2266 ià(
¿‹_æags
 & 
IEEE80211_TX_RC_MCS
) {

2268 ià(
	`IEEE80211_HT_MCS_CHAINS
(
¿‹
) >

2269 
	`hweight8
(
šfo
->
cÚŒŞ
.
ª‹Âas
))

2270 
šfo
->
cÚŒŞ
.
ª‹Âas
 = 0;

2272 
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 = 
¿‹
;

2273 } ià(
¿‹_æags
 & 
IEEE80211_TX_RC_VHT_MCS
) {

2275 ià(
vht_nss
 > 
	`hweight8
(
šfo
->
cÚŒŞ
.
ª‹Âas
))

2276 
šfo
->
cÚŒŞ
.
ª‹Âas
 = 0;

2278 
	`›“80211_¿‹_£t_vht
(
šfo
->
cÚŒŞ
.
¿‹s
, 
vht_mcs
,

2279 
vht_nss
);

2280 } ià(
sbªd
) {

2281 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

2282 ià(
¿‹
 * 5 !ğ
sbªd
->
b™¿‹s
[
i
].
b™¿‹
)

2285 
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 = 
i
;

2290 ià(
šfo
->
cÚŒŞ
.
¿‹s
[0].
idx
 < 0)

2291 
šfo
->
cÚŒŞ
.
æags
 &ğ~
IEEE80211_TX_CTRL_RATE_INJECT
;

2293 
šfo
->
cÚŒŞ
.
¿‹s
[0].
æags
 = 
¿‹_æags
;

2294 
šfo
->
cÚŒŞ
.
¿‹s
[0].
couÁ
 = 
	`mš_t
(
u8
, 
¿‹_»Œ›s
 + 1,

2295 
loÿl
->
hw
.
max_¿‹_Œ›s
);

2298  
Œue
;

2299 
	}
}

2301 
Ãtdev_tx_t
 
	$›“80211_mÚ™Ü_¡¬t_xm™
(
sk_buff
 *
skb
,

2302 
Ãt_deviû
 *
dev
)

2304 
›“80211_loÿl
 *
loÿl
 = 
	`wdev_´iv
(
dev
->
›“80211_±r
);

2305 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

2306 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2307 
›“80211_hdr
 *
hdr
;

2308 
›“80211_sub_if_d©a
 *
tmp_sd©a
, *
sd©a
;

2309 
cfg80211_chª_def
 *
chªdef
;

2310 
u16
 
Ën_¹hdr
;

2311 
hd¾’
;

2313 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

2314 ià(
	`uÆik–y
(!
	`›“80211_sd©a_ruÂšg
(
sd©a
)))

2315 
ç
;

2317 
	`mem£t
(
šfo
, 0, (*info));

2318 
šfo
->
æags
 = 
IEEE80211_TX_CTL_REQ_TX_STATUS
 |

2319 
IEEE80211_TX_CTL_INJECTED
;

2322 ià(!
	`›“80211_v®id©e_¿diÙ­_Ën
(
skb
))

2323 
ç
;

2326 
Ën_¹hdr
 = 
	`›“80211_g‘_¿diÙ­_Ën
(
skb
->
d©a
);

2334 
	`skb_£t_mac_h—d”
(
skb
, 
Ën_¹hdr
);

2339 
	`skb_£t_ÃtwÜk_h—d”
(
skb
, 
Ën_¹hdr
);

2340 
	`skb_£t_Œª¥Üt_h—d”
(
skb
, 
Ën_¹hdr
);

2342 ià(
skb
->
Ën
 < 
Ën_¹hdr
 + 2)

2343 
ç
;

2345 
hdr
 = (
›“80211_hdr
 *)(
skb
->
d©a
 + 
Ën_¹hdr
);

2346 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

2348 ià(
skb
->
Ën
 < 
Ën_¹hdr
 + 
hd¾’
)

2349 
ç
;

2355 ià(
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

2356 
skb
->
Ën
 >ğ
Ën_¹hdr
 + 
hd¾’
 + (
rfc1042_h—d”
) + 2) {

2357 
u8
 *
·ylßd
 = (u8 *)
hdr
 + 
hd¾’
;

2359 ià(
	`‘h”_addr_equ®
(
·ylßd
, 
rfc1042_h—d”
))

2360 
skb
->
´ÙocŞ
 = 
	`ıu_to_be16
((
·ylßd
[6] << 8) |

2361 
·ylßd
[7]);

2364 
	`rcu_»ad_lock
();

2376 
	`li¡_fÜ_—ch_’Œy_rcu
(
tmp_sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2377 ià(!
	`›“80211_sd©a_ruÂšg
(
tmp_sd©a
))

2379 ià(
tmp_sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MONITOR
 ||

2380 
tmp_sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

2382 ià(
	`‘h”_addr_equ®
(
tmp_sd©a
->
vif
.
addr
, 
hdr
->
addr2
)) {

2383 
sd©a
 = 
tmp_sd©a
;

2388 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

2389 ià(!
chªùx_cÚf
) {

2390 
tmp_sd©a
 = 
	`rcu_d”eã»nû
(
loÿl
->
mÚ™Ü_sd©a
);

2391 ià(
tmp_sd©a
)

2392 
chªùx_cÚf
 =

2393 
	`rcu_d”eã»nû
(
tmp_sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
);

2396 ià(
chªùx_cÚf
)

2397 
chªdef
 = &
chªùx_cÚf
->
def
;

2399 
ç_rcu
;

2405 ià(!
	`cfg80211_chªdef_u§bË
(
loÿl
->
hw
.
why
, 
chªdef
,

2406 
IEEE80211_CHAN_DISABLED
))

2407 
ç_rcu
;

2425 ià(!
	`cfg80211_»g_ÿn_b—cÚ
(
loÿl
->
hw
.
why
, 
chªdef
,

2426 
sd©a
->
vif
.
ty³
))

2427 
ç_rcu
;

2429 
šfo
->
bªd
 = 
chªdef
->
chª
->band;

2437 
	`›“80211_£Ëù_queue_80211
(
sd©a
, 
skb
, 
hdr
);

2438 
	`skb_£t_queue_m­pšg
(
skb
, 
	`›“80211_ac_äom_tid
(skb->
´iÜ™y
));

2445 ià(!
	`›“80211_·r£_tx_¿diÙ­
(
skb
, 
dev
))

2446 
ç_rcu
;

2449 
	`skb_puÎ
(
skb
, 
Ën_¹hdr
);

2451 
	`›“80211_xm™
(
sd©a
, 
NULL
, 
skb
);

2452 
	`rcu_»ad_uÆock
();

2454  
NETDEV_TX_OK
;

2456 
ç_rcu
:

2457 
	`rcu_»ad_uÆock
();

2458 
ç
:

2459 
	`dev_kä“_skb
(
skb
);

2460  
NETDEV_TX_OK
;

2461 
	}
}

2463 
šlše
 
boŞ
 
	$›“80211_is_tdls_£tup
(
sk_buff
 *
skb
)

2465 
u16
 
‘h”ty³
 = (
skb
->
d©a
[12] << 8) | skb->data[13];

2467  
‘h”ty³
 =ğ
ETH_P_TDLS
 &&

2468 
skb
->
Ën
 > 14 &&

2469 
skb
->
d©a
[14] =ğ
WLAN_TDLS_SNAP_RFTYPE
;

2470 
	}
}

2472 
	$›“80211_lookup_¿_¡a
(
›“80211_sub_if_d©a
 *
sd©a
,

2473 
sk_buff
 *
skb
,

2474 
¡a_šfo
 **
¡a_out
)

2476 
¡a_šfo
 *
¡a
;

2478 
sd©a
->
vif
.
ty³
) {

2479 
NL80211_IFTYPE_AP_VLAN
:

2480 
¡a
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
vÏn
.sta);

2481 ià(
¡a
) {

2482 *
¡a_out
 = 
¡a
;

2484 } ià(
sd©a
->
wdev
.
u£_4addr
) {

2485  -
ENOLINK
;

2487 
çÎthrough
;

2488 
NL80211_IFTYPE_AP
:

2489 
NL80211_IFTYPE_OCB
:

2490 
NL80211_IFTYPE_ADHOC
:

2491 ià(
	`is_muÉiÿ¡_‘h”_addr
(
skb
->
d©a
)) {

2492 *
¡a_out
 = 
	`ERR_PTR
(-
ENOENT
);

2495 
¡a
 = 
	`¡a_šfo_g‘_bss
(
sd©a
, 
skb
->
d©a
);

2497 #ifdeà
CONFIG_MAC80211_MESH


2498 
NL80211_IFTYPE_MESH_POINT
:

2500 *
¡a_out
 = 
NULL
;

2503 
NL80211_IFTYPE_STATION
:

2504 ià(
sd©a
->
wdev
.
why
->
æags
 & 
WIPHY_FLAG_SUPPORTS_TDLS
) {

2505 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
skb
->
d©a
);

2506 ià(
¡a
 && 
	`‹¡_¡a_æag
(¡a, 
WLAN_STA_TDLS_PEER
)) {

2507 ià(
	`‹¡_¡a_æag
(
¡a
,

2508 
WLAN_STA_TDLS_PEER_AUTH
)) {

2509 *
¡a_out
 = 
¡a
;

2520 ià(!
	`›“80211_is_tdls_£tup
(
skb
))

2521  -
EINVAL
;

2526 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, sd©a->
vif
.
cfg
.
­_addr
);

2527 ià(!
¡a
)

2528  -
ENOLINK
;

2531  -
EINVAL
;

2534 *
¡a_out
 = 
¡a
 ?: 
	`ERR_PTR
(-
ENOENT
);

2536 
	}
}

2538 
u16
 
	$›“80211_¡Üe_ack_skb
(
›“80211_loÿl
 *
loÿl
,

2539 
sk_buff
 *
skb
,

2540 
u32
 *
šfo_æags
,

2541 
u64
 *
cook›
)

2543 
sk_buff
 *
ack_skb
;

2544 
u16
 
šfo_id
 = 0;

2546 ià(
skb
->
sk
)

2547 
ack_skb
 = 
	`skb_şÚe_sk
(
skb
);

2549 
ack_skb
 = 
	`skb_şÚe
(
skb
, 
GFP_ATOMIC
);

2551 ià(
ack_skb
) {

2552 
æags
;

2553 
id
;

2555 
	`¥š_lock_œq§ve
(&
loÿl
->
ack_¡©us_lock
, 
æags
);

2556 
id
 = 
	`idr_®loc
(&
loÿl
->
ack_¡©us_äames
, 
ack_skb
,

2557 1, 0x2000, 
GFP_ATOMIC
);

2558 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
ack_¡©us_lock
, 
æags
);

2560 ià(
id
 >= 0) {

2561 
šfo_id
 = 
id
;

2562 *
šfo_æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

2563 ià(
cook›
) {

2564 *
cook›
 = 
	`›“80211_mgmt_tx_cook›
(
loÿl
);

2565 
	`IEEE80211_SKB_CB
(
ack_skb
)->
ack
.
cook›
 = *cookie;

2568 
	`kä“_skb
(
ack_skb
);

2572  
šfo_id
;

2573 
	}
}

2596 
sk_buff
 *
	$›“80211_bud_hdr
(
›“80211_sub_if_d©a
 *
sd©a
,

2597 
sk_buff
 *
skb
, 
u32
 
šfo_æags
,

2598 
¡a_šfo
 *
¡a
, 
u32
 
ù¾_æags
,

2599 
u64
 *
cook›
)

2601 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2602 
›“80211_tx_šfo
 *
šfo
;

2603 
h—d_Ãed
;

2604 
u16
 
‘h”ty³
, 
hd¾’
, 
meshhd¾’
 = 0;

2605 
__Ë16
 
fc
;

2606 
›“80211_hdr
 
hdr
;

2607 
›“80211s_hdr
 
mesh_hdr
 
__maybe_unu£d
;

2608 
mesh_·th
 
__maybe_unu£d
 *
mµ©h
 = 
NULL
, *
m·th
 = NULL;

2609 cÚ¡ 
u8
 *
’ÿps_d©a
;

2610 
’ÿps_Ën
, 
sk_h—d”_by‹s
;

2611 
boŞ
 
wme_¡a
 = 
çl£
, 
authÜized
 = false;

2612 
boŞ
 
tdls_³”
;

2613 
boŞ
 
muÉiÿ¡
;

2614 
u16
 
šfo_id
 = 0;

2615 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
 = 
NULL
;

2616 
Æ80211_bªd
 
bªd
;

2617 
»t
;

2618 
u8
 
lšk_id
 = 
	`u32_g‘_b™s
(
ù¾_æags
, 
IEEE80211_TX_CTRL_MLO_LINK
);

2620 ià(
	`IS_ERR
(
¡a
))

2621 
¡a
 = 
NULL
;

2623 #ifdeà
CONFIG_MAC80211_DEBUGFS


2624 ià(
loÿl
->
fÜû_tx_¡©us
)

2625 
šfo_æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

2630 
‘h”ty³
 = (
skb
->
d©a
[12] << 8) | skb->data[13];

2631 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_DATA
);

2633 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

2634 
chªùx_cÚf
 =

2635 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
);

2637 
sd©a
->
vif
.
ty³
) {

2638 
NL80211_IFTYPE_AP_VLAN
:

2639 ià(
sd©a
->
wdev
.
u£_4addr
) {

2640 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 | 
IEEE80211_FCTL_TODS
);

2642 
	`memıy
(
hdr
.
addr1
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

2643 
	`memıy
(
hdr
.
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

2644 
	`memıy
(
hdr
.
addr3
, 
skb
->
d©a
, 
ETH_ALEN
);

2645 
	`memıy
(
hdr
.
addr4
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2646 
hd¾’
 = 30;

2647 
authÜized
 = 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
);

2648 
wme_¡a
 = 
¡a
->¡a.
wme
;

2650 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

2651 
›“80211_sub_if_d©a
 *
­_sd©a
;

2654 
­_sd©a
 = 
	`cÚš”_of
(
sd©a
->
bss
,

2655 
›“80211_sub_if_d©a
,

2656 
u
.
­
);

2657 
chªùx_cÚf
 =

2658 
	`rcu_d”eã»nû
(
­_sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
);

2660 ià(
sd©a
->
wdev
.
u£_4addr
)

2662 
çÎthrough
;

2663 
NL80211_IFTYPE_AP
:

2664 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
);

2666 
	`memıy
(
hdr
.
addr1
, 
skb
->
d©a
, 
ETH_ALEN
);

2668 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
è&& 
¡a
 && !¡a->¡a.
mlo
) {

2669 
›“80211_lšk_d©a
 *
lšk
;

2671 
lšk_id
 = 
¡a
->
deæšk
.link_id;

2672 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

2673 ià(
	`WARN_ON
(!
lšk
)) {

2674 
»t
 = -
ENOLINK
;

2675 
ä“
;

2677 
	`memıy
(
hdr
.
addr2
, 
lšk
->
cÚf
->
addr
, 
ETH_ALEN
);

2678 } ià(
lšk_id
 =ğ
IEEE80211_LINK_UNSPECIFIED
 ||

2679 (
¡a
 && s->¡a.
mlo
)) {

2680 
	`memıy
(
hdr
.
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

2682 
›“80211_bss_cÚf
 *
cÚf
;

2684 
cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[
lšk_id
]);

2685 ià(
	`uÆik–y
(!
cÚf
)) {

2686 
»t
 = -
ENOLINK
;

2687 
ä“
;

2690 
	`memıy
(
hdr
.
addr2
, 
cÚf
->
addr
, 
ETH_ALEN
);

2693 
	`memıy
(
hdr
.
addr3
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2694 
hd¾’
 = 24;

2696 #ifdeà
CONFIG_MAC80211_MESH


2697 
NL80211_IFTYPE_MESH_POINT
:

2698 ià(!
	`is_muÉiÿ¡_‘h”_addr
(
skb
->
d©a
)) {

2699 
¡a_šfo
 *
Ãxt_hİ
;

2700 
boŞ
 
mµ_lookup
 = 
Œue
;

2702 
m·th
 = 
	`mesh_·th_lookup
(
sd©a
, 
skb
->
d©a
);

2703 ià(
m·th
) {

2704 
mµ_lookup
 = 
çl£
;

2705 
Ãxt_hİ
 = 
	`rcu_d”eã»nû
(
m·th
->next_hop);

2706 ià(!
Ãxt_hİ
 ||

2707 !(
m·th
->
æags
 & (
MESH_PATH_ACTIVE
 |

2708 
MESH_PATH_RESOLVING
)))

2709 
mµ_lookup
 = 
Œue
;

2712 ià(
mµ_lookup
) {

2713 
mµ©h
 = 
	`mµ_·th_lookup
(
sd©a
, 
skb
->
d©a
);

2714 ià(
mµ©h
)

2715 
mµ©h
->
exp_time
 = 
jiff›s
;

2718 ià(
mµ©h
 && 
m·th
)

2719 
	`mesh_·th_d–
(
sd©a
, 
m·th
->
d¡
);

2728 ià(
	`‘h”_addr_equ®
(
sd©a
->
vif
.
addr
, 
skb
->
d©a
 + 
ETH_ALEN
) &&

2729 !(
mµ©h
 && !
	`‘h”_addr_equ®
(mµ©h->
mµ
, 
skb
->
d©a
))) {

2730 
hd¾’
 = 
	`›“80211_fl_mesh_add»s£s
(&
hdr
, &
fc
,

2731 
skb
->
d©a
, skb->d©¨+ 
ETH_ALEN
);

2732 
meshhd¾’
 = 
	`›“80211_Ãw_mesh_h—d”
(
sd©a
, &
mesh_hdr
,

2733 
NULL
, NULL);

2741 cÚ¡ 
u8
 *
mesh_da
 = 
skb
->
d©a
;

2743 ià(
mµ©h
)

2744 
mesh_da
 = 
mµ©h
->
mµ
;

2745 ià(
m·th
)

2746 
mesh_da
 = 
m·th
->
d¡
;

2748 
hd¾’
 = 
	`›“80211_fl_mesh_add»s£s
(&
hdr
, &
fc
,

2749 
mesh_da
, 
sd©a
->
vif
.
addr
);

2750 ià(
	`is_muÉiÿ¡_‘h”_addr
(
mesh_da
))

2752 
meshhd¾’
 = 
	`›“80211_Ãw_mesh_h—d”
(

2753 
sd©a
, &
mesh_hdr
,

2754 
skb
->
d©a
 + 
ETH_ALEN
, 
NULL
);

2757 
meshhd¾’
 = 
	`›“80211_Ãw_mesh_h—d”
(

2758 
sd©a
, &
mesh_hdr
, 
skb
->
d©a
,

2759 
skb
->
d©a
 + 
ETH_ALEN
);

2766 ià((
ù¾_æags
 & 
IEEE80211_TX_CTRL_SKIP_MPATH_LOOKUP
) &&

2767 
	`is_z”o_‘h”_addr
(
hdr
.
addr1
))

2768 
	`memıy
(
hdr
.
addr1
, 
skb
->
d©a
, 
ETH_ALEN
);

2771 
NL80211_IFTYPE_STATION
:

2773 
tdls_³”
 = 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
);

2775 ià(
tdls_³”
) {

2777 
tdls_lšk_id
 = 
¡a
->¡a.
v®id_lšks
 ?

2778 
	`__ffs
(
¡a
->¡a.
v®id_lšks
) : 0;

2779 
›“80211_lšk_d©a
 *
lšk
;

2782 
	`memıy
(
hdr
.
addr1
, 
skb
->
d©a
, 
ETH_ALEN
);

2783 
	`memıy
(
hdr
.
addr2
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2784 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
tdls_lšk_id
]);

2785 ià(
	`WARN_ON_ONCE
(!
lšk
)) {

2786 
»t
 = -
EINVAL
;

2787 
ä“
;

2789 
	`memıy
(
hdr
.
addr3
, 
lšk
->
u
.
mgd
.
bssid
, 
ETH_ALEN
);

2790 
hd¾’
 = 24;

2791 } ià(
sd©a
->
u
.
mgd
.
u£_4addr
 &&

2792 
	`ıu_to_be16
(
‘h”ty³
è!ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
) {

2793 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 |

2794 
IEEE80211_FCTL_TODS
);

2796 
	`memıy
(
hdr
.
addr1
, 
sd©a
->
deæšk
.
u
.
mgd
.
bssid
, 
ETH_ALEN
);

2797 
	`memıy
(
hdr
.
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

2798 
	`memıy
(
hdr
.
addr3
, 
skb
->
d©a
, 
ETH_ALEN
);

2799 
	`memıy
(
hdr
.
addr4
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2800 
hd¾’
 = 30;

2802 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_TODS
);

2804 
	`memıy
(
hdr
.
addr1
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

2805 
	`memıy
(
hdr
.
addr2
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2806 
	`memıy
(
hdr
.
addr3
, 
skb
->
d©a
, 
ETH_ALEN
);

2807 
hd¾’
 = 24;

2810 
NL80211_IFTYPE_OCB
:

2812 
	`memıy
(
hdr
.
addr1
, 
skb
->
d©a
, 
ETH_ALEN
);

2813 
	`memıy
(
hdr
.
addr2
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2814 
	`‘h_brßdÿ¡_addr
(
hdr
.
addr3
);

2815 
hd¾’
 = 24;

2817 
NL80211_IFTYPE_ADHOC
:

2819 
	`memıy
(
hdr
.
addr1
, 
skb
->
d©a
, 
ETH_ALEN
);

2820 
	`memıy
(
hdr
.
addr2
, 
skb
->
d©a
 + 
ETH_ALEN
, ETH_ALEN);

2821 
	`memıy
(
hdr
.
addr3
, 
sd©a
->
u
.
ibss
.
bssid
, 
ETH_ALEN
);

2822 
hd¾’
 = 24;

2825 
»t
 = -
EINVAL
;

2826 
ä“
;

2829 ià(!
chªùx_cÚf
) {

2830 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

2831 
»t
 = -
ENOTCONN
;

2832 
ä“
;

2835 
bªd
 = 0;

2837 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

2840 
muÉiÿ¡
 = 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
.
addr1
);

2843 ià(
¡a
) {

2844 
authÜized
 = 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
);

2845 
wme_¡a
 = 
¡a
->¡a.
wme
;

2846 } ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

2848 
wme_¡a
 = 
Œue
;

2852 ià(
wme_¡a
) {

2853 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_DATA
);

2854 
hd¾’
 += 2;

2861 ià(
	`uÆik–y
(!
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
) &&

2862 (
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_OCB
) &&

2863 !
muÉiÿ¡
 && !
authÜized
 &&

2864 (
	`ıu_to_be16
(
‘h”ty³
è!ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 ||

2865 !
	`›“80211_is_our_addr
(
sd©a
, 
skb
->
d©a
 + 
ETH_ALEN
, 
NULL
)))) {

2866 #ifdeà
CONFIG_MAC80211_VERBOSE_DEBUG


2867 
	`Ãt_šfo_¿‹lim™ed
("%s: dropped frameo %pM (unauthorized…ort)\n",

2868 
sd©a
->
Çme
, 
hdr
.
addr1
);

2871 
	`I802_DEBUG_INC
(
loÿl
->
tx_hªdËrs_drİ_uÇuth_pÜt
);

2873 
»t
 = -
EPERM
;

2874 
ä“
;

2877 ià(
	`uÆik–y
(!
muÉiÿ¡
 &&

2878 ((
skb
->
sk
 &&

2879 
	`skb_shšfo
(
skb
)->
tx_æags
 & 
SKBTX_WIFI_STATUS
) ||

2880 
ù¾_æags
 & 
IEEE80211_TX_CTL_REQ_TX_STATUS
)))

2881 
šfo_id
 = 
	`›“80211_¡Üe_ack_skb
(
loÿl
, 
skb
, &
šfo_æags
,

2882 
cook›
);

2887 
skb
 = 
	`skb_sh¬e_check
(skb, 
GFP_ATOMIC
);

2888 ià(
	`uÆik–y
(!
skb
)) {

2889 
»t
 = -
ENOMEM
;

2890 
ä“
;

2893 
hdr
.
äame_cÚŒŞ
 = 
fc
;

2894 
hdr
.
du¿tiÚ_id
 = 0;

2895 
hdr
.
£q_ù¾
 = 0;

2897 
sk_h—d”_by‹s
 = 
ETH_HLEN
;

2898 ià(
‘h”ty³
 =ğ
ETH_P_AARP
 ||ƒth”ty³ =ğ
ETH_P_IPX
) {

2899 
’ÿps_d©a
 = 
bridge_tuÂ–_h—d”
;

2900 
’ÿps_Ën
 = (
bridge_tuÂ–_h—d”
);

2901 
sk_h—d”_by‹s
 -= 2;

2902 } ià(
‘h”ty³
 >ğ
ETH_P_802_3_MIN
) {

2903 
’ÿps_d©a
 = 
rfc1042_h—d”
;

2904 
’ÿps_Ën
 = (
rfc1042_h—d”
);

2905 
sk_h—d”_by‹s
 -= 2;

2907 
’ÿps_d©a
 = 
NULL
;

2908 
’ÿps_Ën
 = 0;

2911 
	`skb_puÎ
(
skb
, 
sk_h—d”_by‹s
);

2912 
h—d_Ãed
 = 
hd¾’
 + 
’ÿps_Ën
 + 
meshhd¾’
 - 
	`skb_h—droom
(
skb
);

2926 ià(
h—d_Ãed
 > 0 || 
	`skb_şÚed
(
skb
)) {

2927 
h—d_Ãed
 +ğ
IEEE80211_ENCRYPT_HEADROOM
;

2928 
h—d_Ãed
 +ğ
loÿl
->
tx_h—droom
;

2929 
h—d_Ãed
 = 
	`max_t
(, 0, head_need);

2930 ià(
	`›“80211_skb_»size
(
sd©a
, 
skb
, 
h—d_Ãed
, 
ENCRYPT_DATA
)) {

2931 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

2932 
skb
 = 
NULL
;

2933  
	`ERR_PTR
(-
ENOMEM
);

2937 ià(
’ÿps_d©a
)

2938 
	`memıy
(
	`skb_push
(
skb
, 
’ÿps_Ën
), 
’ÿps_d©a
,ƒncaps_len);

2940 #ifdeà
CONFIG_MAC80211_MESH


2941 ià(
meshhd¾’
 > 0)

2942 
	`memıy
(
	`skb_push
(
skb
, 
meshhd¾’
), &
mesh_hdr
, meshhdrlen);

2945 ià(
	`›“80211_is_d©a_qos
(
fc
)) {

2946 
__Ë16
 *
qos_cÚŒŞ
;

2948 
qos_cÚŒŞ
 = 
	`skb_push
(
skb
, 2);

2949 
	`memıy
(
	`skb_push
(
skb
, 
hd¾’
 - 2), &
hdr
, hdrlen - 2);

2954 *
qos_cÚŒŞ
 = 0;

2956 
	`memıy
(
	`skb_push
(
skb
, 
hd¾’
), &
hdr
, hdrlen);

2958 
	`skb_»£t_mac_h—d”
(
skb
);

2960 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

2961 
	`mem£t
(
šfo
, 0, (*info));

2963 
šfo
->
æags
 = 
šfo_æags
;

2964 ià(
šfo_id
) {

2965 
šfo
->
¡©us_d©a
 = 
šfo_id
;

2966 
šfo
->
¡©us_d©a_idr
 = 1;

2968 
šfo
->
bªd
 = band;

2970 ià(
	`lik–y
(!
cook›
)) {

2971 
ù¾_æags
 |ğ
	`u32_’code_b™s
(
lšk_id
,

2972 
IEEE80211_TX_CTRL_MLO_LINK
);

2974 
´e_cÚf_lšk_id
;

2982 
´e_cÚf_lšk_id
 = 
	`u32_g‘_b™s
(
ù¾_æags
,

2983 
IEEE80211_TX_CTRL_MLO_LINK
);

2985 ià(
´e_cÚf_lšk_id
 !ğ
lšk_id
 &&

2986 
lšk_id
 !ğ
IEEE80211_LINK_UNSPECIFIED
) {

2987 #ifdeà
CONFIG_MAC80211_VERBOSE_DEBUG


2988 
	`Ãt_šfo_¿‹lim™ed
("%s: dropped frameo %pM with bad†ink ID„equest (%d vs. %d)\n",

2989 
sd©a
->
Çme
, 
hdr
.
addr1
,

2990 
´e_cÚf_lšk_id
, 
lšk_id
);

2992 
»t
 = -
EINVAL
;

2993 
ä“
;

2997 
šfo
->
cÚŒŞ
.
æags
 = 
ù¾_æags
;

2999  
skb
;

3000 
ä“
:

3001 
	`kä“_skb
(
skb
);

3002  
	`ERR_PTR
(
»t
);

3003 
	}
}

3026 
	$›“80211_check_ç¡_xm™
(
¡a_šfo
 *
¡a
)

3028 
›“80211_ç¡_tx
 
bud
 = {}, *
ç¡_tx
 = 
NULL
, *
Şd
;

3029 
›“80211_loÿl
 *
loÿl
 = 
¡a
->local;

3030 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

3031 
›“80211_hdr
 *
hdr
 = (*)
bud
.hdr;

3032 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

3033 
__Ë16
 
fc
;

3035 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORT_FAST_XMIT
))

3038 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

3039 
	`mesh_ç¡_tx_æush_¡a
(
sd©a
, 
¡a
);

3053 
	`¥š_lock_bh
(&
¡a
->
lock
);

3054 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_PS
) &&

3055 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_DYNAMIC_PS
) &&

3056 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

3057 
out
;

3059 ià(!
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
è|| !¡a->
u¶ßded
)

3060 
out
;

3062 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_STA
) ||

3063 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DRIVER
) ||

3064 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_PS_DELIVER
) ||

3065 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_CLEAR_PS_FILT
))

3066 
out
;

3068 ià(
sd©a
->
nßck_m­
)

3069 
out
;

3072 ià(
loÿl
->
hw
.
why
->
äag_th»shŞd
 !ğ(
u32
)-1 &&

3073 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORTS_TX_FRAG
))

3074 
out
;

3076 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

3077 
	`rcu_»ad_lock
();

3078 
chªùx_cÚf
 =

3079 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
);

3080 ià(!
chªùx_cÚf
) {

3081 
	`rcu_»ad_uÆock
();

3082 
out
;

3084 
bud
.
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

3085 
	`rcu_»ad_uÆock
();

3088 
bud
.
bªd
 = 0;

3091 
fc
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 | 
IEEE80211_STYPE_DATA
);

3093 
sd©a
->
vif
.
ty³
) {

3094 
NL80211_IFTYPE_ADHOC
:

3096 
bud
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr1
);

3097 
bud
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr2
);

3098 
	`memıy
(
hdr
->
addr3
, 
sd©a
->
u
.
ibss
.
bssid
, 
ETH_ALEN
);

3099 
bud
.
hdr_Ën
 = 24;

3101 
NL80211_IFTYPE_STATION
:

3102 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
)) {

3104 
tdls_lšk_id
 = 
¡a
->¡a.
v®id_lšks
 ?

3105 
	`__ffs
(
¡a
->¡a.
v®id_lšks
) : 0;

3106 
›“80211_lšk_d©a
 *
lšk
;

3109 
bud
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr1
);

3110 
bud
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr2
);

3111 
	`rcu_»ad_lock
();

3112 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
tdls_lšk_id
]);

3113 ià(!
	`WARN_ON_ONCE
(!
lšk
))

3114 
	`memıy
(
hdr
->
addr3
, 
lšk
->
u
.
mgd
.
bssid
, 
ETH_ALEN
);

3115 
	`rcu_»ad_uÆock
();

3116 
bud
.
hdr_Ën
 = 24;

3120 ià(
sd©a
->
u
.
mgd
.
u£_4addr
) {

3122 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 |

3123 
IEEE80211_FCTL_TODS
);

3125 
	`memıy
(
hdr
->
addr1
, 
sd©a
->
deæšk
.
u
.
mgd
.
bssid
, 
ETH_ALEN
);

3126 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3127 
bud
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

3128 
bud
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr4
);

3129 
bud
.
hdr_Ën
 = 30;

3132 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_TODS
);

3134 
	`memıy
(
hdr
->
addr1
, 
sd©a
->
vif
.
cfg
.
­_addr
, 
ETH_ALEN
);

3135 
bud
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

3136 
bud
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr2
);

3137 
bud
.
hdr_Ën
 = 24;

3139 
NL80211_IFTYPE_AP_VLAN
:

3140 ià(
sd©a
->
wdev
.
u£_4addr
) {

3141 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
 |

3142 
IEEE80211_FCTL_TODS
);

3144 
	`memıy
(
hdr
->
addr1
, 
¡a
->¡a.
addr
, 
ETH_ALEN
);

3145 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3146 
bud
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

3147 
bud
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr4
);

3148 
bud
.
hdr_Ën
 = 30;

3151 
çÎthrough
;

3152 
NL80211_IFTYPE_AP
:

3153 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_FROMDS
);

3155 
bud
.
da_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr1
);

3156 ià(
¡a
->¡a.
mlo
 || !
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

3157 
	`memıy
(
hdr
->
addr2
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3159 
lšk_id
 = 
¡a
->
deæšk
.link_id;

3160 
›“80211_lšk_d©a
 *
lšk
;

3162 
	`rcu_»ad_lock
();

3163 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

3164 ià(
	`WARN_ON
(!
lšk
)) {

3165 
	`rcu_»ad_uÆock
();

3166 
out
;

3168 
	`memıy
(
hdr
->
addr2
, 
lšk
->
cÚf
->
addr
, 
ETH_ALEN
);

3169 
	`rcu_»ad_uÆock
();

3171 
bud
.
§_offs
 = 
	`off£tof
(
›“80211_hdr
, 
addr3
);

3172 
bud
.
hdr_Ën
 = 24;

3176 
out
;

3179 ià(
¡a
->¡a.
wme
) {

3180 
bud
.
hdr_Ën
 += 2;

3181 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_DATA
);

3189 
bud
.
key
 = 
	`rcu_acûss_poš‹r
(
¡a
->
±k
[¡a->
±k_idx
]);

3190 ià(!
bud
.
key
)

3191 
bud
.
key
 = 
	`rcu_acûss_poš‹r
(
sd©a
->
deçuÉ_uniÿ¡_key
);

3192 ià(
bud
.
key
) {

3193 
boŞ
 
g’_iv
, 
iv_¥c
, 
mmic
;

3195 
g’_iv
 = 
bud
.
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
;

3196 
iv_¥c
 = 
bud
.
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
;

3197 
mmic
 = 
bud
.
key
->
cÚf
.
æags
 &

3198 (
IEEE80211_KEY_FLAG_GENERATE_MMIC
 |

3199 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
);

3202 ià(!(
bud
.
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
))

3203 
out
;

3206 ià(
bud
.
key
->
æags
 & 
KEY_FLAG_TAINTED
)

3207 
out
;

3209 
bud
.
key
->
cÚf
.
ch”
) {

3210 
WLAN_CIPHER_SUITE_CCMP
:

3211 
WLAN_CIPHER_SUITE_CCMP_256
:

3212 ià(
g’_iv
)

3213 
bud
.
²_offs
 = bud.
hdr_Ën
;

3214 ià(
g’_iv
 || 
iv_¥c
)

3215 
bud
.
hdr_Ën
 +ğ
IEEE80211_CCMP_HDR_LEN
;

3217 
WLAN_CIPHER_SUITE_GCMP
:

3218 
WLAN_CIPHER_SUITE_GCMP_256
:

3219 ià(
g’_iv
)

3220 
bud
.
²_offs
 = bud.
hdr_Ën
;

3221 ià(
g’_iv
 || 
iv_¥c
)

3222 
bud
.
hdr_Ën
 +ğ
IEEE80211_GCMP_HDR_LEN
;

3224 
WLAN_CIPHER_SUITE_TKIP
:

3226 ià(
mmic
 || 
g’_iv
)

3227 
out
;

3228 ià(
iv_¥c
)

3229 
bud
.
hdr_Ën
 +ğ
IEEE80211_TKIP_IV_LEN
;

3231 
WLAN_CIPHER_SUITE_WEP40
:

3232 
WLAN_CIPHER_SUITE_WEP104
:

3234 ià(
g’_iv
)

3235 
out
;

3236 ià(
iv_¥c
)

3237 
bud
.
hdr_Ën
 +ğ
IEEE80211_WEP_IV_LEN
;

3239 
WLAN_CIPHER_SUITE_AES_CMAC
:

3240 
WLAN_CIPHER_SUITE_BIP_CMAC_256
:

3241 
WLAN_CIPHER_SUITE_BIP_GMAC_128
:

3242 
WLAN_CIPHER_SUITE_BIP_GMAC_256
:

3243 
	`WARN
(1,

3245 
bud
.
key
->
cÚf
.
ch”
);

3246 
out
;

3249 ià(
	`WARN_ON
(
g’_iv
))

3250 
out
;

3253 
fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

3256 
hdr
->
äame_cÚŒŞ
 = 
fc
;

3258 
	`memıy
(
bud
.
hdr
 + bud.
hdr_Ën
,

3259 
rfc1042_h—d”
, (rfc1042_header));

3260 
bud
.
hdr_Ën
 +ğ(
rfc1042_h—d”
);

3262 
ç¡_tx
 = 
	`kmemdup
(&
bud
, (bud), 
GFP_ATOMIC
);

3265 
out
:

3267 
Şd
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->
ç¡_tx
,

3268 
	`lockd•_is_h–d
(&
¡a
->
lock
));

3269 
	`rcu_assign_poš‹r
(
¡a
->
ç¡_tx
, fast_tx);

3270 ià(
Şd
)

3271 
	`kä“_rcu
(
Şd
, 
rcu_h—d
);

3272 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

3273 
	}
}

3275 
	$›“80211_check_ç¡_xm™_®l
(
›“80211_loÿl
 *
loÿl
)

3277 
¡a_šfo
 *
¡a
;

3279 
	`rcu_»ad_lock
();

3280 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
)

3281 
	`›“80211_check_ç¡_xm™
(
¡a
);

3282 
	`rcu_»ad_uÆock
();

3283 
	}
}

3285 
	$›“80211_check_ç¡_xm™_içû
(
›“80211_sub_if_d©a
 *
sd©a
)

3287 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3288 
¡a_šfo
 *
¡a
;

3290 
	`rcu_»ad_lock
();

3292 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

3293 ià(
sd©a
 !ğ
¡a
->sdata &&

3294 (!
¡a
->
sd©a
->
bss
 || sta->sdata->bss != sdata->bss))

3296 
	`›“80211_check_ç¡_xm™
(
¡a
);

3299 
	`rcu_»ad_uÆock
();

3300 
	}
}

3302 
	$›“80211_ş—r_ç¡_xm™
(
¡a_šfo
 *
¡a
)

3304 
›“80211_ç¡_tx
 *
ç¡_tx
;

3306 
	`¥š_lock_bh
(&
¡a
->
lock
);

3307 
ç¡_tx
 = 
	`rcu_d”eã»nû_´Ùeùed
(
¡a
->fast_tx,

3308 
	`lockd•_is_h–d
(&
¡a
->
lock
));

3309 
	`RCU_INIT_POINTER
(
¡a
->
ç¡_tx
, 
NULL
);

3310 
	`¥š_uÆock_bh
(&
¡a
->
lock
);

3312 ià(
ç¡_tx
)

3313 
	`kä“_rcu
(
ç¡_tx
, 
rcu_h—d
);

3314 
	}
}

3316 
boŞ
 
	$›“80211_amsdu_»®loc_·d
(
›“80211_loÿl
 *
loÿl
,

3317 
sk_buff
 *
skb
, 
h—droom
)

3319 ià(
	`skb_h—droom
(
skb
è< 
h—droom
) {

3320 
	`I802_DEBUG_INC
(
loÿl
->
tx_ex·nd_skb_h—d
);

3322 ià(
	`pskb_ex·nd_h—d
(
skb
, 
h—droom
, 0, 
GFP_ATOMIC
)) {

3323 
	`why_debug
(
loÿl
->
hw
.
why
,

3325  
çl£
;

3329  
Œue
;

3330 
	}
}

3332 
boŞ
 
	$›“80211_amsdu_´•¬e_h—d
(
›“80211_sub_if_d©a
 *
sd©a
,

3333 
›“80211_ç¡_tx
 *
ç¡_tx
,

3334 
sk_buff
 *
skb
)

3336 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3337 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

3338 
›“80211_hdr
 *
hdr
;

3339 
‘hhdr
 *
amsdu_hdr
;

3340 
hdr_Ën
 = 
ç¡_tx
->hdr_ËÀ- (
rfc1042_h—d”
);

3341 
subäame_Ën
 = 
skb
->
Ën
 - 
hdr_Ën
;

3342 *
d©a
;

3343 
u8
 *
qc
, *
h_80211_¤c
, *
h_80211_d¡
;

3344 cÚ¡ 
u8
 *
bssid
;

3346 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_RATE_CTRL_PROBE
)

3347  
çl£
;

3349 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_AMSDU
)

3350  
Œue
;

3352 ià(!
	`›“80211_amsdu_»®loc_·d
(
loÿl
, 
skb
,

3353 (*
amsdu_hdr
) +

3354 
loÿl
->
hw
.
exŒa_tx_h—droom
))

3355  
çl£
;

3357 
d©a
 = 
	`skb_push
(
skb
, (*
amsdu_hdr
));

3358 
	`memmove
(
d©a
, d©¨+ (*
amsdu_hdr
), 
hdr_Ën
);

3359 
hdr
 = 
d©a
;

3360 
amsdu_hdr
 = 
d©a
 + 
hdr_Ën
;

3362 
h_80211_¤c
 = 
d©a
 + 
ç¡_tx
->
§_offs
;

3363 
h_80211_d¡
 = 
d©a
 + 
ç¡_tx
->
da_offs
;

3365 
amsdu_hdr
->
h_´Ùo
 = 
	`ıu_to_be16
(
subäame_Ën
);

3366 
	`‘h”_addr_cİy
(
amsdu_hdr
->
h_sourû
, 
h_80211_¤c
);

3367 
	`‘h”_addr_cİy
(
amsdu_hdr
->
h_de¡
, 
h_80211_d¡
);

3373 
sd©a
->
vif
.
ty³
) {

3374 
NL80211_IFTYPE_STATION
:

3375 
bssid
 = 
sd©a
->
vif
.
cfg
.
­_addr
;

3377 
NL80211_IFTYPE_AP
:

3378 
NL80211_IFTYPE_AP_VLAN
:

3379 
bssid
 = 
sd©a
->
vif
.
addr
;

3382 
bssid
 = 
NULL
;

3385 ià(
bssid
 && 
	`›“80211_has_äomds
(
hdr
->
äame_cÚŒŞ
))

3386 
	`‘h”_addr_cİy
(
h_80211_¤c
, 
bssid
);

3388 ià(
bssid
 && 
	`›“80211_has_tods
(
hdr
->
äame_cÚŒŞ
))

3389 
	`‘h”_addr_cİy
(
h_80211_d¡
, 
bssid
);

3391 
qc
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

3392 *
qc
 |ğ
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

3394 
šfo
->
cÚŒŞ
.
æags
 |ğ
IEEE80211_TX_CTRL_AMSDU
;

3396  
Œue
;

3397 
	}
}

3399 
boŞ
 
	$›“80211_amsdu_agg»g©e
(
›“80211_sub_if_d©a
 *
sd©a
,

3400 
¡a_šfo
 *
¡a
,

3401 
›“80211_ç¡_tx
 *
ç¡_tx
,

3402 
sk_buff
 *
skb
,

3403 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
§
)

3405 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3406 
fq
 *fq = &
loÿl
->fq;

3407 
fq_tš
 *
tš
;

3408 
fq_æow
 *
æow
;

3409 
u8
 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

3410 
›“80211_txq
 *
txq
 = 
¡a
->¡a.txq[
tid
];

3411 
txq_šfo
 *
txqi
;

3412 
sk_buff
 **
äag_
, *
h—d
;

3413 
subäame_Ën
 = 
skb
->
Ën
 - 
ETH_ALEN
;

3414 
u8
 
max_subäames
 = 
¡a
->¡a.
max_amsdu_subäames
;

3415 
max_äags
 = 
loÿl
->
hw
.
max_tx_äagm’ts
;

3416 
max_amsdu_Ën
 = 
¡a
->¡a.
cur
->max_amsdu_len;

3417 
Üig_Œuesize
;

3418 
u32
 
æow_idx
;

3419 
__be16
 
Ën
;

3420 *
d©a
;

3421 
boŞ
 
»t
 = 
çl£
;

3422 
Üig_Ën
;

3423 
n
 = 2, 
näags
, 
·d
 = 0;

3424 
u16
 
hd¾’
;

3426 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TX_AMSDU
))

3427  
çl£
;

3429 ià(
sd©a
->
vif
.
ofæßd_æags
 & 
IEEE80211_OFFLOAD_ENCAP_ENABLED
)

3430  
çl£
;

3432 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

3433  
çl£
;

3435 ià(
	`skb_is_gso
(
skb
))

3436  
çl£
;

3438 ià(!
txq
)

3439  
çl£
;

3441 
txqi
 = 
	`to_txq_šfo
(
txq
);

3442 ià(
	`‹¡_b™
(
IEEE80211_TXQ_NO_AMSDU
, &
txqi
->
æags
))

3443  
çl£
;

3445 ià(
¡a
->¡a.
cur
->
max_rc_amsdu_Ën
)

3446 
max_amsdu_Ën
 = 
	`mš_t
(, max_amsdu_len,

3447 
¡a
->¡a.
cur
->
max_rc_amsdu_Ën
);

3449 ià(
¡a
->¡a.
cur
->
max_tid_amsdu_Ën
[
tid
])

3450 
max_amsdu_Ën
 = 
	`mš_t
(, max_amsdu_len,

3451 
¡a
->¡a.
cur
->
max_tid_amsdu_Ën
[
tid
]);

3453 
æow_idx
 = 
	`fq_æow_idx
(
fq
, 
skb
);

3455 
	`¥š_lock_bh
(&
fq
->
lock
);

3461 
tš
 = &
txqi
->tin;

3462 
æow
 = 
	`fq_æow_şassify
(
fq
, 
tš
, 
æow_idx
, 
skb
);

3463 
h—d
 = 
	`skb_³ek_
(&
æow
->
queue
);

3464 ià(!
h—d
 || 
	`skb_is_gso
(head))

3465 
out
;

3467 
Üig_Œuesize
 = 
h—d
->
Œuesize
;

3468 
Üig_Ën
 = 
h—d
->
Ën
;

3470 ià(
skb
->
Ën
 + 
h—d
->ËÀ> 
max_amsdu_Ën
)

3471 
out
;

3473 
näags
 = 1 + 
	`skb_shšfo
(
skb
)->
Ä_äags
;

3474 
näags
 +ğ1 + 
	`skb_shšfo
(
h—d
)->
Ä_äags
;

3475 
äag_
 = &
	`skb_shšfo
(
h—d
)->
äag_li¡
;

3476 *
äag_
) {

3477 
näags
 +ğ1 + 
	`skb_shšfo
(*
äag_
)->
Ä_äags
;

3478 
äag_
 = &(*äag_)->
Ãxt
;

3479 
n
++;

3482 ià(
max_subäames
 && 
n
 > max_subframes)

3483 
out
;

3485 ià(
max_äags
 && 
näags
 > max_frags)

3486 
out
;

3488 ià(!
	`drv_ÿn_agg»g©e_š_amsdu
(
loÿl
, 
h—d
, 
skb
))

3489 
out
;

3491 ià(!
	`›“80211_amsdu_´•¬e_h—d
(
sd©a
, 
ç¡_tx
, 
h—d
))

3492 
out
;

3499 ià(
n
 == 2)

3500 
äag_
 = &
	`skb_shšfo
(
h—d
)->
äag_li¡
;

3509 
hd¾’
 = 
ç¡_tx
->
hdr_Ën
 - (
rfc1042_h—d”
);

3510 ià((
h—d
->
Ën
 - 
hd¾’
) & 3)

3511 
·d
 = 4 - ((
h—d
->
Ën
 - 
hd¾’
) & 3);

3513 ià(!
	`›“80211_amsdu_»®loc_·d
(
loÿl
, 
skb
, (
rfc1042_h—d”
) +

3514 2 + 
·d
))

3515 
out_»ÿlc
;

3517 
»t
 = 
Œue
;

3518 
d©a
 = 
	`skb_push
(
skb
, 
ETH_ALEN
 + 2);

3519 
	`‘h”_addr_cİy
(
d©a
, 
da
);

3520 
	`‘h”_addr_cİy
(
d©a
 + 
ETH_ALEN
, 
§
);

3522 
d©a
 +ğ2 * 
ETH_ALEN
;

3523 
Ën
 = 
	`ıu_to_be16
(
subäame_Ën
);

3524 
	`memıy
(
d©a
, &
Ën
, 2);

3525 
	`memıy
(
d©a
 + 2, 
rfc1042_h—d”
, (rfc1042_header));

3527 
	`mem£t
(
	`skb_push
(
skb
, 
·d
), 0,…ad);

3529 
h—d
->
Ën
 +ğ
skb
->len;

3530 
h—d
->
d©a_Ën
 +ğ
skb
->
Ën
;

3531 *
äag_
 = 
skb
;

3533 
out_»ÿlc
:

3534 
fq
->
memÜy_u§ge
 +ğ
h—d
->
Œuesize
 - 
Üig_Œuesize
;

3535 ià(
h—d
->
Ën
 !ğ
Üig_Ën
) {

3536 
æow
->
backlog
 +ğ
h—d
->
Ën
 - 
Üig_Ën
;

3537 
tš
->
backlog_by‹s
 +ğ
h—d
->
Ën
 - 
Üig_Ën
;

3539 
out
:

3540 
	`¥š_uÆock_bh
(&
fq
->
lock
);

3542  
»t
;

3543 
	}
}

3549 
›“80211_tx_»suÉ


3550 
	$›“80211_xm™_ç¡_fšish
(
›“80211_sub_if_d©a
 *
sd©a
,

3551 
¡a_šfo
 *
¡a
, 
u8
 
²_offs
,

3552 
›“80211_key
 *
key
,

3553 
›“80211_tx_d©a
 *
tx
)

3555 
sk_buff
 *
skb
 = 
tx
->skb;

3556 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

3557 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

3558 
u8
 
tid
 = 
IEEE80211_NUM_TIDS
;

3560 ià(!
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
HAS_RATE_CONTROL
) &&

3561 
	`›“80211_tx_h_¿‹_ù¾
(
tx
è!ğ
TX_CONTINUE
)

3562  
TX_DROP
;

3564 ià(
key
)

3565 
šfo
->
cÚŒŞ
.
hw_key
 = &
key
->
cÚf
;

3567 
	`dev_sw_Ãt¡©s_tx_add
(
skb
->
dev
, 1, skb->
Ën
);

3569 ià(
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_DATA
)) {

3570 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

3571 
hdr
->
£q_ù¾
 = 
	`›“80211_tx_Ãxt_£q
(
¡a
, 
tid
);

3573 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_ASSIGN_SEQ
;

3574 
hdr
->
£q_ù¾
 = 
	`ıu_to_Ë16
(
sd©a
->
£qu’û_numb”
);

3575 
sd©a
->
£qu’û_numb”
 += 0x10;

3578 ià(
	`skb_shšfo
(
skb
)->
gso_size
)

3579 
¡a
->
deæšk
.
tx_¡©s
.
msdu
[
tid
] +=

3580 
	`DIV_ROUND_UP
(
skb
->
Ën
, 
	`skb_shšfo
(skb)->
gso_size
);

3582 
¡a
->
deæšk
.
tx_¡©s
.
msdu
[
tid
]++;

3584 
šfo
->
hw_queue
 = 
sd©a
->
vif
.hw_queue[
	`skb_g‘_queue_m­pšg
(
skb
)];

3589 
¡a
->
deæšk
.
tx_¡©s
.
by‹s
[
	`skb_g‘_queue_m­pšg
(
skb
)] +ğskb->
Ën
;

3590 
¡a
->
deæšk
.
tx_¡©s
.
·ck‘s
[
	`skb_g‘_queue_m­pšg
(
skb
)]++;

3592 ià(
²_offs
) {

3593 
u64
 
²
;

3594 
u8
 *
üy±o_hdr
 = 
skb
->
d©a
 + 
²_offs
;

3596 
key
->
cÚf
.
ch”
) {

3597 
WLAN_CIPHER_SUITE_CCMP
:

3598 
WLAN_CIPHER_SUITE_CCMP_256
:

3599 
WLAN_CIPHER_SUITE_GCMP
:

3600 
WLAN_CIPHER_SUITE_GCMP_256
:

3601 
²
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

3602 
üy±o_hdr
[0] = 
²
;

3603 
üy±o_hdr
[1] = 
²
 >> 8;

3604 
üy±o_hdr
[3] = 0x20 | (
key
->
cÚf
.
keyidx
 << 6);

3605 
üy±o_hdr
[4] = 
²
 >> 16;

3606 
üy±o_hdr
[5] = 
²
 >> 24;

3607 
üy±o_hdr
[6] = 
²
 >> 32;

3608 
üy±o_hdr
[7] = 
²
 >> 40;

3613  
TX_CONTINUE
;

3614 
	}
}

3616 
Ãtdev_ã©u»s_t


3617 
	$›“80211_sd©a_Ãtdev_ã©u»s
(
›“80211_sub_if_d©a
 *
sd©a
)

3619 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
)

3620  
sd©a
->
vif
.
Ãtdev_ã©u»s
;

3622 ià(!
sd©a
->
bss
)

3625 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
, 
›“80211_sub_if_d©a
, 
u
.
­
);

3626  
sd©a
->
vif
.
Ãtdev_ã©u»s
;

3627 
	}
}

3629 
sk_buff
 *

3630 
	$›“80211_tx_skb_fixup
(
sk_buff
 *
skb
, 
Ãtdev_ã©u»s_t
 
ã©u»s
)

3632 ià(
	`skb_is_gso
(
skb
)) {

3633 
sk_buff
 *
£gs
;

3635 
£gs
 = 
	`skb_gso_£gm’t
(
skb
, 
ã©u»s
);

3636 ià(!
£gs
)

3637  
skb
;

3638 ià(
	`IS_ERR
(
£gs
))

3639 
ä“
;

3641 
	`cÚsume_skb
(
skb
);

3642  
£gs
;

3645 ià(
	`skb_Ãeds_lš—rize
(
skb
, 
ã©u»s
è&& 
	`__skb_lš—rize
(skb))

3646 
ä“
;

3648 ià(
skb
->
_summed
 =ğ
CHECKSUM_PARTIAL
) {

3649 
ofs
 = 
	`skb_checksum_¡¬t_off£t
(
skb
);

3651 ià(
skb
->
’ÿpsuÏtiÚ
)

3652 
	`skb_£t_šÃr_Œª¥Üt_h—d”
(
skb
, 
ofs
);

3654 
	`skb_£t_Œª¥Üt_h—d”
(
skb
, 
ofs
);

3656 ià(
	`skb_csum_hwofæßd_h–p
(
skb
, 
ã©u»s
))

3657 
ä“
;

3660 
	`skb_m¬k_nÙ_Ú_li¡
(
skb
);

3661  
skb
;

3663 
ä“
:

3664 
	`kä“_skb
(
skb
);

3665  
NULL
;

3666 
	}
}

3668 
	$__›“80211_xm™_ç¡
(
›“80211_sub_if_d©a
 *
sd©a
,

3669 
¡a_šfo
 *
¡a
,

3670 
›“80211_ç¡_tx
 *
ç¡_tx
,

3671 
sk_buff
 *
skb
, 
boŞ
 
ampdu
,

3672 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
§
)

3674 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3675 
›“80211_hdr
 *
hdr
 = (*)
ç¡_tx
->hdr;

3676 
›“80211_tx_šfo
 *
šfo
;

3677 
›“80211_tx_d©a
 
tx
;

3678 
›“80211_tx_»suÉ
 
r
;

3679 
hw_h—droom
 = 
sd©a
->
loÿl
->
hw
.
exŒa_tx_h—droom
;

3680 
exŒa_h—d
 = 
ç¡_tx
->
hdr_Ën
 - (
ETH_HLEN
 - 2);

3682 
skb
 = 
	`skb_sh¬e_check
(skb, 
GFP_ATOMIC
);

3683 ià(
	`uÆik–y
(!
skb
))

3686 ià((
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_DATA
)) &&

3687 
	`›“80211_amsdu_agg»g©e
(
sd©a
, 
¡a
, 
ç¡_tx
, 
skb
, 
da
, 
§
))

3694 ià(
	`uÆik–y
(
	`›“80211_skb_»size
(
sd©a
, 
skb
,

3695 
	`max_t
(, 
exŒa_h—d
 + 
hw_h—droom
 -

3696 
	`skb_h—droom
(
skb
), 0),

3697 
ENCRYPT_NO
)))

3698 
ä“
;

3700 
hdr
 = 
	`skb_push
(
skb
, 
exŒa_h—d
);

3701 
	`memıy
(
skb
->
d©a
, 
ç¡_tx
->
hdr
, fa¡_tx->
hdr_Ën
);

3702 
	`memıy
(
skb
->
d©a
 + 
ç¡_tx
->
da_offs
, 
da
, 
ETH_ALEN
);

3703 
	`memıy
(
skb
->
d©a
 + 
ç¡_tx
->
§_offs
, 
§
, 
ETH_ALEN
);

3705 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

3706 
	`mem£t
(
šfo
, 0, (*info));

3707 
šfo
->
bªd
 = 
ç¡_tx
->band;

3708 
šfo
->
cÚŒŞ
.
vif
 = &
sd©a
->vif;

3709 
šfo
->
æags
 = 
IEEE80211_TX_CTL_FIRST_FRAGMENT
 |

3710 
IEEE80211_TX_CTL_DONTFRAG
;

3711 
šfo
->
cÚŒŞ
.
æags
 = 
IEEE80211_TX_CTRL_FAST_XMIT
 |

3712 
	`u32_’code_b™s
(
IEEE80211_LINK_UNSPECIFIED
,

3713 
IEEE80211_TX_CTRL_MLO_LINK
);

3715 #ifdeà
CONFIG_MAC80211_DEBUGFS


3716 ià(
loÿl
->
fÜû_tx_¡©us
)

3717 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

3720 ià(
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_DATA
)) {

3721 
u8
 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

3723 *
	`›“80211_g‘_qos_ùl
(
hdr
èğ
tid
;

3726 
	`__skb_queue_h—d_š™
(&
tx
.
skbs
);

3728 
tx
.
æags
 = 
IEEE80211_TX_UNICAST
;

3729 
tx
.
loÿl
 =†ocal;

3730 
tx
.
sd©a
 = sdata;

3731 
tx
.
¡a
 = sta;

3732 
tx
.
key
 = 
ç¡_tx
->key;

3734 ià(
	`›“80211_queue_skb
(
loÿl
, 
sd©a
, 
¡a
, 
skb
))

3737 
tx
.
skb
 = skb;

3738 
r
 = 
	`›“80211_xm™_ç¡_fšish
(
sd©a
, 
¡a
, 
ç¡_tx
->
²_offs
,

3739 
ç¡_tx
->
key
, &
tx
);

3740 
tx
.
skb
 = 
NULL
;

3741 ià(
r
 =ğ
TX_DROP
)

3742 
ä“
;

3744 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

3745 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
,

3746 
›“80211_sub_if_d©a
, 
u
.
­
);

3748 
	`__skb_queue_
(&
tx
.
skbs
, 
skb
);

3749 
	`›“80211_tx_äags
(
loÿl
, &
sd©a
->
vif
, 
¡a
, &
tx
.
skbs
, 
çl£
);

3752 
ä“
:

3753 
	`kä“_skb
(
skb
);

3754 
	}
}

3756 
boŞ
 
	$›“80211_xm™_ç¡
(
›“80211_sub_if_d©a
 *
sd©a
,

3757 
¡a_šfo
 *
¡a
,

3758 
›“80211_ç¡_tx
 *
ç¡_tx
,

3759 
sk_buff
 *
skb
)

3761 
u16
 
‘h”ty³
 = (
skb
->
d©a
[12] << 8) | skb->data[13];

3762 
›“80211_hdr
 *
hdr
 = (*)
ç¡_tx
->hdr;

3763 
tid_ampdu_tx
 *
tid_tx
 = 
NULL
;

3764 
sk_buff
 *
Ãxt
;

3765 
‘hhdr
 
‘h
;

3766 
u8
 
tid
 = 
IEEE80211_NUM_TIDS
;

3769 ià(
	`ıu_to_be16
(
‘h”ty³
è=ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

3770  
çl£
;

3773 ià(
‘h”ty³
 < 
ETH_P_802_3_MIN
)

3774  
çl£
;

3777 ià(
skb
->
sk
 && 
	`skb_shšfo
(skb)->
tx_æags
 & 
SKBTX_WIFI_STATUS
)

3778  
çl£
;

3780 ià(
hdr
->
äame_cÚŒŞ
 & 
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_DATA
)) {

3781 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

3782 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

3783 ià(
tid_tx
) {

3784 ià(!
	`‹¡_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
))

3785  
çl£
;

3786 ià(
tid_tx
->
timeout
)

3787 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

3791 
	`memıy
(&
‘h
, 
skb
->
d©a
, 
ETH_HLEN
 - 2);

3794 
skb
 = 
	`›“80211_tx_skb_fixup
(skb, 
	`›“80211_sd©a_Ãtdev_ã©u»s
(
sd©a
));

3795 ià(!
skb
)

3796  
Œue
;

3798 
	`skb_li¡_w®k_§ã
(
skb
, skb, 
Ãxt
) {

3799 
	`skb_m¬k_nÙ_Ú_li¡
(
skb
);

3800 
	`__›“80211_xm™_ç¡
(
sd©a
, 
¡a
, 
ç¡_tx
, 
skb
, 
tid_tx
,

3801 
‘h
.
h_de¡
,ƒth.
h_sourû
);

3804  
Œue
;

3805 
	}
}

3807 
sk_buff
 *
	$›“80211_tx_dequeue
(
›“80211_hw
 *
hw
,

3808 
›“80211_txq
 *
txq
)

3810 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

3811 
txq_šfo
 *
txqi
 = 
	`cÚš”_of
(
txq
, txq_info,xq);

3812 
›“80211_hdr
 *
hdr
;

3813 
sk_buff
 *
skb
 = 
NULL
;

3814 
fq
 *fq = &
loÿl
->fq;

3815 
fq_tš
 *
tš
 = &
txqi
->tin;

3816 
›“80211_tx_šfo
 *
šfo
;

3817 
›“80211_tx_d©a
 
tx
;

3818 
›“80211_tx_»suÉ
 
r
;

3819 
›“80211_vif
 *
vif
 = 
txq
->vif;

3820 
q
 = 
vif
->
hw_queue
[
txq
->
ac
];

3821 
æags
;

3822 
boŞ
 
q_¡İ³d
;

3824 
	`WARN_ON_ONCE
(
	`soáœq_couÁ
() == 0);

3826 ià(!
	`›“80211_txq_aœtime_check
(
hw
, 
txq
))

3827  
NULL
;

3829 
begš
:

3830 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

3831 
q_¡İ³d
 = 
loÿl
->
queue_¡İ_»asÚs
[
q
];

3832 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

3834 ià(
	`uÆik–y
(
q_¡İ³d
)) {

3836 
	`£t_b™
(
IEEE80211_TXQ_DIRTY
, &
txqi
->
æags
);

3837  
NULL
;

3840 
	`¥š_lock_bh
(&
fq
->
lock
);

3843 
skb
 = 
	`__skb_dequeue
(&
txqi
->
äags
);

3844 ià(
	`uÆik–y
(
skb
)) {

3845 ià(!(
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
æags
 &

3846 
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
))

3847 
out
;

3848 
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
æags
 &=

3849 ~
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
;

3851 ià(
	`uÆik–y
(
	`‹¡_b™
(
IEEE80211_TXQ_STOP
, &
txqi
->
æags
)))

3852 
out
;

3854 
skb
 = 
	`fq_tš_dequeue
(
fq
, 
tš
, 
fq_tš_dequeue_func
);

3857 ià(!
skb
)

3858 
out
;

3860 
	`¥š_uÆock_bh
(&
fq
->
lock
);

3862 
hdr
 = (
›“80211_hdr
 *)
skb
->
d©a
;

3863 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

3865 
	`mem£t
(&
tx
, 0, (tx));

3866 
	`__skb_queue_h—d_š™
(&
tx
.
skbs
);

3867 
tx
.
loÿl
 =†ocal;

3868 
tx
.
skb
 = skb;

3869 
tx
.
sd©a
 = 
	`vif_to_sd©a
(
šfo
->
cÚŒŞ
.
vif
);

3871 ià(
txq
->
¡a
) {

3872 
tx
.
¡a
 = 
	`cÚš”_of
(
txq
->¡a, 
¡a_šfo
, sta);

3877 ià(
	`uÆik–y
(!(
šfo
->
æags
 & 
IEEE80211_TX_CTL_INJECTED
) &&

3878 
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

3879 !
	`›“80211_vif_is_mesh
(&
tx
.
sd©a
->
vif
) &&

3880 
tx
.
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_OCB
 &&

3881 !
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) &&

3882 !
	`‹¡_¡a_æag
(
tx
.
¡a
, 
WLAN_STA_AUTHORIZED
) &&

3883 (!(
šfo
->
cÚŒŞ
.
æags
 &

3884 
IEEE80211_TX_CTRL_PORT_CTRL_PROTO
) ||

3885 !
	`›“80211_is_our_addr
(
tx
.
sd©a
, 
hdr
->
addr2
,

3886 
NULL
)))) {

3887 
	`I802_DEBUG_INC
(
loÿl
->
tx_hªdËrs_drİ_uÇuth_pÜt
);

3888 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

3889 
begš
;

3897 
r
 = 
	`›“80211_tx_h_£Ëù_key
(&
tx
);

3898 ià(
r
 !ğ
TX_CONTINUE
) {

3899 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

3900 
begš
;

3903 ià(
	`‹¡_b™
(
IEEE80211_TXQ_AMPDU
, &
txqi
->
æags
))

3904 
šfo
->
æags
 |ğ(
IEEE80211_TX_CTL_AMPDU
 |

3905 
IEEE80211_TX_CTL_DONTFRAG
);

3907 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_HW_80211_ENCAP
) {

3908 ià(!
	`›“80211_hw_check
(&
loÿl
->
hw
, 
HAS_RATE_CONTROL
)) {

3909 
r
 = 
	`›“80211_tx_h_¿‹_ù¾
(&
tx
);

3910 ià(
r
 !ğ
TX_CONTINUE
) {

3911 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

3912 
begš
;

3915 
’ÿp_out
;

3918 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_FAST_XMIT
) {

3919 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
txq
->sta, sta_info,

3920 
¡a
);

3921 
u8
 
²_offs
 = 0;

3923 ià(
tx
.
key
 &&

3924 (
tx
.
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
))

3925 
²_offs
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

3927 
r
 = 
	`›“80211_xm™_ç¡_fšish
(
¡a
->
sd©a
, s, 
²_offs
,

3928 
tx
.
key
, &tx);

3929 ià(
r
 !ğ
TX_CONTINUE
) {

3930 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

3931 
begš
;

3934 ià(
	`švoke_tx_hªdËrs_Ï‹
(&
tx
))

3935 
begš
;

3937 
skb
 = 
	`__skb_dequeue
(&
tx
.
skbs
);

3938 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

3940 ià(!
	`skb_queue_em±y
(&
tx
.
skbs
)) {

3941 
	`¥š_lock_bh
(&
fq
->
lock
);

3942 
	`skb_queue_¥liû_
(&
tx
.
skbs
, &
txqi
->
äags
);

3943 
	`¥š_uÆock_bh
(&
fq
->
lock
);

3947 ià(
	`skb_has_äag_li¡
(
skb
) &&

3948 !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
TX_FRAG_LIST
)) {

3949 ià(
	`skb_lš—rize
(
skb
)) {

3950 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

3951 
begš
;

3955 
tx
.
sd©a
->
vif
.
ty³
) {

3956 
NL80211_IFTYPE_MONITOR
:

3957 ià(
tx
.
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
) {

3958 
vif
 = &
tx
.
sd©a
->vif;

3961 
tx
.
sd©a
 = 
	`rcu_d”eã»nû
(
loÿl
->
mÚ™Ü_sd©a
);

3962 ià(
tx
.
sd©a
) {

3963 
vif
 = &
tx
.
sd©a
->vif;

3964 
šfo
->
hw_queue
 =

3965 
vif
->
hw_queue
[
	`skb_g‘_queue_m­pšg
(
skb
)];

3966 } ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
)) {

3967 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

3968 
begš
;

3970 
šfo
->
cÚŒŞ
.
vif
 = 
NULL
;

3971  
skb
;

3974 
NL80211_IFTYPE_AP_VLAN
:

3975 
tx
.
sd©a
 = 
	`cÚš”_of
Ñx.sd©a->
bss
,

3976 
›“80211_sub_if_d©a
, 
u
.
­
);

3977 
çÎthrough
;

3979 
vif
 = &
tx
.
sd©a
->vif;

3983 
’ÿp_out
:

3984 
šfo
->
cÚŒŞ
.
vif
 = vif;

3986 ià(
tx
.
¡a
 &&

3987 
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
, 
NL80211_EXT_FEATURE_AQL
)) {

3988 
boŞ
 
ampdu
 = 
txq
->
ac
 !ğ
IEEE80211_AC_VO
;

3989 
u32
 
aœtime
;

3991 
aœtime
 = 
	`›“80211_ÿlc_ex³ùed_tx_aœtime
(
hw
, 
vif
, 
txq
->
¡a
,

3992 
skb
->
Ën
, 
ampdu
);

3993 ià(
aœtime
) {

3994 
aœtime
 = 
	`›“80211_šfo_£t_tx_time_e¡
(
šfo
,‡irtime);

3995 
	`›“80211_¡a_upd©e_³ndšg_aœtime
(
loÿl
, 
tx
.
¡a
,

3996 
txq
->
ac
,

3997 
aœtime
,

3998 
çl£
);

4002  
skb
;

4004 
out
:

4005 
	`¥š_uÆock_bh
(&
fq
->
lock
);

4007  
skb
;

4008 
	}
}

4009 
EXPORT_SYMBOL
(
›“80211_tx_dequeue
);

4011 
šlše
 
s32
 
	$›“80211_¡a_defic™
(
¡a_šfo
 *
¡a
, 
u8
 
ac
)

4013 
aœtime_šfo
 *
aœ_šfo
 = &
¡a
->
aœtime
[
ac
];

4015  
aœ_šfo
->
defic™
 - 
	`©omic_»ad
(&aœ_šfo->
aql_tx_³ndšg
);

4016 
	}
}

4019 
	$›“80211_txq_£t_aùive
(
txq_šfo
 *
txqi
)

4021 
¡a_šfo
 *
¡a
;

4023 ià(!
txqi
->
txq
.
¡a
)

4026 
¡a
 = 
	`cÚš”_of
(
txqi
->
txq
.¡a, 
¡a_šfo
, sta);

4027 
¡a
->
aœtime
[
txqi
->
txq
.
ac
].
Ï¡_aùive
 = 
jiff›s
;

4028 
	}
}

4030 
boŞ


4031 
	$›“80211_txq_k“p_aùive
(
txq_šfo
 *
txqi
)

4033 
¡a_šfo
 *
¡a
;

4035 ià(!
txqi
->
txq
.
¡a
)

4036  
çl£
;

4038 
¡a
 = 
	`cÚš”_of
(
txqi
->
txq
.¡a, 
¡a_šfo
, sta);

4039 ià(
	`›“80211_¡a_defic™
(
¡a
, 
txqi
->
txq
.
ac
) >= 0)

4040  
çl£
;

4042  
	`›“80211_¡a_k“p_aùive
(
¡a
, 
txqi
->
txq
.
ac
);

4043 
	}
}

4045 
›“80211_txq
 *
	$›“80211_Ãxt_txq
(
›“80211_hw
 *
hw
, 
u8
 
ac
)

4047 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

4048 
›“80211_txq
 *
»t
 = 
NULL
;

4049 
txq_šfo
 *
txqi
 = 
NULL
, *
h—d
 = NULL;

4050 
boŞ
 
found_–igibË_txq
 = 
çl£
;

4052 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4054 ià(!
loÿl
->
scheduË_round
[
ac
])

4055 
out
;

4057 
begš
:

4058 
txqi
 = 
	`li¡_fœ¡_’Œy_Ü_nuÎ
(&
loÿl
->
aùive_txqs
[
ac
],

4059 
txq_šfo
,

4060 
scheduË_Üd”
);

4061 ià(!
txqi
)

4062 
out
;

4064 ià(
txqi
 =ğ
h—d
) {

4065 ià(!
found_–igibË_txq
)

4066 
out
;

4068 
found_–igibË_txq
 = 
çl£
;

4071 ià(!
h—d
)

4072 
h—d
 = 
txqi
;

4074 ià(
txqi
->
txq
.
¡a
) {

4075 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
txqi
->
txq
.sta,

4076 
¡a_šfo
, 
¡a
);

4077 
boŞ
 
aql_check
 = 
	`›“80211_txq_aœtime_check
(
hw
, &
txqi
->
txq
);

4078 
s32
 
defic™
 = 
	`›“80211_¡a_defic™
(
¡a
, 
txqi
->
txq
.
ac
);

4080 ià(
aql_check
)

4081 
found_–igibË_txq
 = 
Œue
;

4083 ià(
defic™
 < 0)

4084 
¡a
->
aœtime
[
txqi
->
txq
.
ac
].
defic™
 +=

4085 
¡a
->
aœtime_weight
;

4087 ià(
defic™
 < 0 || !
aql_check
) {

4088 
	`li¡_move_
(&
txqi
->
scheduË_Üd”
,

4089 &
loÿl
->
aùive_txqs
[
txqi
->
txq
.
ac
]);

4090 
begš
;

4094 ià(
txqi
->
scheduË_round
 =ğ
loÿl
->scheduË_round[
ac
])

4095 
out
;

4097 
	`li¡_d–_š™
(&
txqi
->
scheduË_Üd”
);

4098 
txqi
->
scheduË_round
 = 
loÿl
->scheduË_round[
ac
];

4099 
»t
 = &
txqi
->
txq
;

4101 
out
:

4102 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4103  
»t
;

4104 
	}
}

4105 
EXPORT_SYMBOL
(
›“80211_Ãxt_txq
);

4107 
	$__›“80211_scheduË_txq
(
›“80211_hw
 *
hw
,

4108 
›“80211_txq
 *
txq
,

4109 
boŞ
 
fÜû
)

4111 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

4112 
txq_šfo
 *
txqi
 = 
	`to_txq_šfo
(
txq
);

4113 
boŞ
 
has_queue
;

4115 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
txq
->
ac
]);

4117 
has_queue
 = 
fÜû
 || 
	`txq_has_queue
(
txq
);

4118 ià(
	`li¡_em±y
(&
txqi
->
scheduË_Üd”
) &&

4119 (
has_queue
 || 
	`›“80211_txq_k“p_aùive
(
txqi
))) {

4127 ià(
txqi
->
txq
.
¡a
 && 
loÿl
->
aœtime_æags
 && 
has_queue
 &&

4128 
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
,

4129 
NL80211_EXT_FEATURE_AIRTIME_FAIRNESS
))

4130 
	`li¡_add
(&
txqi
->
scheduË_Üd”
,

4131 &
loÿl
->
aùive_txqs
[
txq
->
ac
]);

4133 
	`li¡_add_
(&
txqi
->
scheduË_Üd”
,

4134 &
loÿl
->
aùive_txqs
[
txq
->
ac
]);

4135 ià(
has_queue
)

4136 
	`›“80211_txq_£t_aùive
(
txqi
);

4139 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
txq
->
ac
]);

4140 
	}
}

4141 
EXPORT_SYMBOL
(
__›“80211_scheduË_txq
);

4143 
DEFINE_STATIC_KEY_FALSE
(
aql_di§bË
);

4145 
boŞ
 
	$›“80211_txq_aœtime_check
(
›“80211_hw
 *
hw
,

4146 
›“80211_txq
 *
txq
)

4148 
¡a_šfo
 *
¡a
;

4149 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

4151 ià(!
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
, 
NL80211_EXT_FEATURE_AQL
))

4152  
Œue
;

4154 ià(
	`¡©ic_b¿nch_uÆik–y
(&
aql_di§bË
))

4155  
Œue
;

4157 ià(!
txq
->
¡a
)

4158  
Œue
;

4160 ià(
	`uÆik–y
(
txq
->
tid
 =ğ
IEEE80211_NUM_TIDS
))

4161  
Œue
;

4163 
¡a
 = 
	`cÚš”_of
(
txq
->¡a, 
¡a_šfo
, sta);

4164 ià(
	`©omic_»ad
(&
¡a
->
aœtime
[
txq
->
ac
].
aql_tx_³ndšg
) <

4165 
¡a
->
aœtime
[
txq
->
ac
].
aql_lim™_low
)

4166  
Œue
;

4168 ià(
	`©omic_»ad
(&
loÿl
->
aql_tÙ®_³ndšg_aœtime
) <

4169 
loÿl
->
aql_th»shŞd
 &&

4170 
	`©omic_»ad
(&
¡a
->
aœtime
[
txq
->
ac
].
aql_tx_³ndšg
) <

4171 
¡a
->
aœtime
[
txq
->
ac
].
aql_lim™_high
)

4172  
Œue
;

4174  
çl£
;

4175 
	}
}

4176 
EXPORT_SYMBOL
(
›“80211_txq_aœtime_check
);

4178 
boŞ


4179 
	$›“80211_txq_scheduË_aœtime_check
(
›“80211_loÿl
 *
loÿl
, 
u8
 
ac
)

4181 
num_txq
 = 0;

4182 
txq_šfo
 *
txq
;

4183 
u32
 
aql_lim™
;

4185 ià(!
	`why_ext_ã©u»_is£t
(
loÿl
->
hw
.
why
, 
NL80211_EXT_FEATURE_AQL
))

4186  
Œue
;

4188 
	`li¡_fÜ_—ch_’Œy
(
txq
, &
loÿl
->
aùive_txqs
[
ac
], 
scheduË_Üd”
)

4189 
num_txq
++;

4191 
aql_lim™
 = (
num_txq
 - 1è* 
loÿl
->
aql_txq_lim™_low
[
ac
] / 2 +

4192 
loÿl
->
aql_txq_lim™_high
[
ac
];

4194  
	`©omic_»ad
(&
loÿl
->
aql_ac_³ndšg_aœtime
[
ac
]è< 
aql_lim™
;

4195 
	}
}

4197 
boŞ
 
	$›“80211_txq_may_Œªsm™
(
›“80211_hw
 *
hw
,

4198 
›“80211_txq
 *
txq
)

4200 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

4201 
txq_šfo
 *
™”
, *
tmp
, *
txqi
 = 
	`to_txq_šfo
(
txq
);

4202 
¡a_šfo
 *
¡a
;

4203 
u8
 
ac
 = 
txq
->ac;

4205 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4207 ià(!
txqi
->
txq
.
¡a
)

4208 
out
;

4210 ià(
	`li¡_em±y
(&
txqi
->
scheduË_Üd”
))

4211 
out
;

4213 ià(!
	`›“80211_txq_scheduË_aœtime_check
(
loÿl
, 
ac
))

4214 
out
;

4216 
	`li¡_fÜ_—ch_’Œy_§ã
(
™”
, 
tmp
, &
loÿl
->
aùive_txqs
[
ac
],

4217 
scheduË_Üd”
) {

4218 ià(
™”
 =ğ
txqi
)

4221 ià(!
™”
->
txq
.
¡a
) {

4222 
	`li¡_move_
(&
™”
->
scheduË_Üd”
,

4223 &
loÿl
->
aùive_txqs
[
ac
]);

4226 
¡a
 = 
	`cÚš”_of
(
™”
->
txq
.¡a, 
¡a_šfo
, sta);

4227 ià(
	`›“80211_¡a_defic™
(
¡a
, 
ac
) < 0)

4228 
¡a
->
aœtime
[
ac
].
defic™
 +ğ¡a->
aœtime_weight
;

4229 
	`li¡_move_
(&
™”
->
scheduË_Üd”
, &
loÿl
->
aùive_txqs
[
ac
]);

4232 
¡a
 = 
	`cÚš”_of
(
txqi
->
txq
.¡a, 
¡a_šfo
, sta);

4233 ià(
¡a
->
aœtime
[
ac
].
defic™
 >= 0)

4234 
out
;

4236 
¡a
->
aœtime
[
ac
].
defic™
 +ğ¡a->
aœtime_weight
;

4237 
	`li¡_move_
(&
txqi
->
scheduË_Üd”
, &
loÿl
->
aùive_txqs
[
ac
]);

4238 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4240  
çl£
;

4241 
out
:

4242 ià(!
	`li¡_em±y
(&
txqi
->
scheduË_Üd”
))

4243 
	`li¡_d–_š™
(&
txqi
->
scheduË_Üd”
);

4244 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4246  
Œue
;

4247 
	}
}

4248 
EXPORT_SYMBOL
(
›“80211_txq_may_Œªsm™
);

4250 
	$›“80211_txq_scheduË_¡¬t
(
›“80211_hw
 *
hw
, 
u8
 
ac
)

4252 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

4254 
	`¥š_lock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4256 ià(
	`›“80211_txq_scheduË_aœtime_check
(
loÿl
, 
ac
)) {

4257 
loÿl
->
scheduË_round
[
ac
]++;

4258 ià(!
loÿl
->
scheduË_round
[
ac
])

4259 
loÿl
->
scheduË_round
[
ac
]++;

4261 
loÿl
->
scheduË_round
[
ac
] = 0;

4264 
	`¥š_uÆock_bh
(&
loÿl
->
aùive_txq_lock
[
ac
]);

4265 
	}
}

4266 
EXPORT_SYMBOL
(
›“80211_txq_scheduË_¡¬t
);

4268 
	$__›“80211_subif_¡¬t_xm™
(
sk_buff
 *
skb
,

4269 
Ãt_deviû
 *
dev
,

4270 
u32
 
šfo_æags
,

4271 
u32
 
ù¾_æags
,

4272 
u64
 *
cook›
)

4274 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4275 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4276 
¡a_šfo
 *
¡a
;

4277 
sk_buff
 *
Ãxt
;

4278 
Ën
 = 
skb
->len;

4280 ià(
	`uÆik–y
(!
	`›“80211_sd©a_ruÂšg
(
sd©a
è|| 
skb
->
Ën
 < 
ETH_HLEN
)) {

4281 
	`kä“_skb
(
skb
);

4285 
	`sk_·cšg_shiá_upd©e
(
skb
->
sk
, 
sd©a
->
loÿl
->
hw
.
tx_sk_·cšg_shiá
);

4287 
	`rcu_»ad_lock
();

4289 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
) &&

4290 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
SUPPORT_FAST_XMIT
) &&

4291 
	`›“80211_mesh_xm™_ç¡
(
sd©a
, 
skb
, 
ù¾_æags
))

4292 
out
;

4294 ià(
	`›“80211_lookup_¿_¡a
(
sd©a
, 
skb
, &
¡a
))

4295 
out_ä“
;

4297 ià(
	`IS_ERR
(
¡a
))

4298 
¡a
 = 
NULL
;

4300 
	`skb_£t_queue_m­pšg
(
skb
, 
	`›“80211_£Ëù_queue
(
sd©a
, 
¡a
, skb));

4301 
	`›“80211_aggr_check
(
sd©a
, 
¡a
, 
skb
);

4303 ià(
¡a
) {

4304 
›“80211_ç¡_tx
 *
ç¡_tx
;

4306 
ç¡_tx
 = 
	`rcu_d”eã»nû
(
¡a
->fast_tx);

4308 ià(
ç¡_tx
 &&

4309 
	`›“80211_xm™_ç¡
(
sd©a
, 
¡a
, 
ç¡_tx
, 
skb
))

4310 
out
;

4317 
skb
 = 
	`›“80211_tx_skb_fixup
(skb, 0);

4318 ià(!
skb
) {

4319 
Ën
 = 0;

4320 
out
;

4323 
	`skb_li¡_w®k_§ã
(
skb
, skb, 
Ãxt
) {

4324 
	`skb_m¬k_nÙ_Ú_li¡
(
skb
);

4326 ià(
skb
->
´ÙocŞ
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

4327 
ù¾_æags
 |ğ
IEEE80211_TX_CTRL_SKIP_MPATH_LOOKUP
;

4329 
skb
 = 
	`›“80211_bud_hdr
(
sd©a
, skb, 
šfo_æags
,

4330 
¡a
, 
ù¾_æags
, 
cook›
);

4331 ià(
	`IS_ERR
(
skb
)) {

4332 
	`kä“_skb_li¡
(
Ãxt
);

4333 
out
;

4336 
	`dev_sw_Ãt¡©s_tx_add
(
dev
, 1, 
skb
->
Ën
);

4338 
	`›“80211_xm™
(
sd©a
, 
¡a
, 
skb
);

4340 
out
;

4341 
out_ä“
:

4342 
	`kä“_skb
(
skb
);

4343 
Ën
 = 0;

4344 
out
:

4345 ià(
Ën
)

4346 
	`›“80211_t_Ëd_Œig_tx
(
loÿl
, 
Ën
);

4347 
	`rcu_»ad_uÆock
();

4348 
	}
}

4350 
	$›“80211_chªge_da
(
sk_buff
 *
skb
, 
¡a_šfo
 *
¡a
)

4352 
‘hhdr
 *
‘h
;

4353 
”r
;

4355 
”r
 = 
	`skb_’su»_wr™abË
(
skb
, 
ETH_HLEN
);

4356 ià(
	`uÆik–y
(
”r
))

4357  
”r
;

4359 
‘h
 = (*)
skb
->
d©a
;

4360 
	`‘h”_addr_cİy
(
‘h
->
h_de¡
, 
¡a
->¡a.
addr
);

4363 
	}
}

4365 
boŞ
 
	$›“80211_muÉiÿ¡_to_uniÿ¡
(
sk_buff
 *
skb
,

4366 
Ãt_deviû
 *
dev
)

4368 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4369 cÚ¡ 
‘hhdr
 *
‘h
 = (*)
skb
->
d©a
;

4370 cÚ¡ 
vÏn_‘hhdr
 *
‘hvÏn
 = (*)
skb
->
d©a
;

4371 
__be16
 
‘h”ty³
;

4373 
sd©a
->
vif
.
ty³
) {

4374 
NL80211_IFTYPE_AP_VLAN
:

4375 ià(
sd©a
->
u
.
vÏn
.
¡a
)

4376  
çl£
;

4377 ià(
sd©a
->
wdev
.
u£_4addr
)

4378  
çl£
;

4379 
çÎthrough
;

4380 
NL80211_IFTYPE_AP
:

4382 ià(!
sd©a
->
bss
->
muÉiÿ¡_to_uniÿ¡
)

4383  
çl£
;

4386  
çl£
;

4390 
‘h”ty³
 = 
‘h
->
h_´Ùo
;

4391 ià(
‘h”ty³
 =ğ
	`htÚs
(
ETH_P_8021Q
è&& 
skb
->
Ën
 >ğ
VLAN_ETH_HLEN
)

4392 
‘h”ty³
 = 
‘hvÏn
->
h_vÏn_’ÿpsuÏ‹d_´Ùo
;

4393 
‘h”ty³
) {

4394 
	`htÚs
(
ETH_P_ARP
):

4395 
	`htÚs
(
ETH_P_IP
):

4396 
	`htÚs
(
ETH_P_IPV6
):

4399  
çl£
;

4402  
Œue
;

4403 
	}
}

4406 
	$›“80211_cÚv”t_to_uniÿ¡
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
dev
,

4407 
sk_buff_h—d
 *
queue
)

4409 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4410 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4411 cÚ¡ 
‘hhdr
 *
‘h
 = (‘hhd¸*)
skb
->
d©a
;

4412 
¡a_šfo
 *
¡a
, *
fœ¡
 = 
NULL
;

4413 
sk_buff
 *
şÚed_skb
;

4415 
	`rcu_»ad_lock
();

4417 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

4418 ià(
sd©a
 !ğ
¡a
->sdata)

4421 ià(
	`uÆik–y
(
	`‘h”_addr_equ®
(
‘h
->
h_sourû
, 
¡a
->¡a.
addr
)))

4424 ià(!
fœ¡
) {

4425 
fœ¡
 = 
¡a
;

4428 
şÚed_skb
 = 
	`skb_şÚe
(
skb
, 
GFP_ATOMIC
);

4429 ià(!
şÚed_skb
)

4430 
muÉiÿ¡
;

4431 ià(
	`uÆik–y
(
	`›“80211_chªge_da
(
şÚed_skb
, 
¡a
))) {

4432 
	`dev_kä“_skb
(
şÚed_skb
);

4433 
muÉiÿ¡
;

4435 
	`__skb_queue_
(
queue
, 
şÚed_skb
);

4438 ià(
	`lik–y
(
fœ¡
)) {

4439 ià(
	`uÆik–y
(
	`›“80211_chªge_da
(
skb
, 
fœ¡
)))

4440 
muÉiÿ¡
;

4441 
	`__skb_queue_
(
queue
, 
skb
);

4444 
	`kä“_skb
(
skb
);

4445 
skb
 = 
NULL
;

4448 
out
;

4449 
muÉiÿ¡
:

4450 
	`__skb_queue_purge
(
queue
);

4451 
	`__skb_queue_
(
queue
, 
skb
);

4452 
out
:

4453 
	`rcu_»ad_uÆock
();

4454 
	}
}

4456 
	$›“80211_mlo_muÉiÿ¡_tx_Úe
(
›“80211_sub_if_d©a
 *
sd©a
,

4457 
sk_buff
 *
skb
, 
u32
 
ù¾_æags
,

4458 
lšk_id
)

4460 
sk_buff
 *
out
;

4462 
out
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

4463 ià(!
out
)

4466 
ù¾_æags
 |ğ
	`u32_’code_b™s
(
lšk_id
, 
IEEE80211_TX_CTRL_MLO_LINK
);

4467 
	`__›“80211_subif_¡¬t_xm™
(
out
, 
sd©a
->
dev
, 0, 
ù¾_æags
, 
NULL
);

4468 
	}
}

4470 
	$›“80211_mlo_muÉiÿ¡_tx
(
Ãt_deviû
 *
dev
,

4471 
sk_buff
 *
skb
)

4473 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4474 
lšks
 = 
sd©a
->
vif
.
aùive_lšks
;

4475 
lšk
;

4476 
u32
 
ù¾_æags
 = 
IEEE80211_TX_CTRL_MCAST_MLO_FIRST_TX
;

4478 ià(
	`hweight16
(
lšks
) == 1) {

4479 
ù¾_æags
 |ğ
	`u32_’code_b™s
(
	`__ffs
(
lšks
),

4480 
IEEE80211_TX_CTRL_MLO_LINK
);

4482 
	`__›“80211_subif_¡¬t_xm™
(
skb
, 
sd©a
->
dev
, 0, 
ù¾_æags
,

4483 
NULL
);

4487 
	`fÜ_—ch_£t_b™
(
lšk
, &
lšks
, 
IEEE80211_MLD_MAX_NUM_LINKS
) {

4488 
	`›“80211_mlo_muÉiÿ¡_tx_Úe
(
sd©a
, 
skb
, 
ù¾_æags
, 
lšk
);

4489 
ù¾_æags
 = 0;

4491 
	`kä“_skb
(
skb
);

4492 
	}
}

4503 
Ãtdev_tx_t
 
	$›“80211_subif_¡¬t_xm™
(
sk_buff
 *
skb
,

4504 
Ãt_deviû
 *
dev
)

4506 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4507 cÚ¡ 
‘hhdr
 *
‘h
 = (*)
skb
->
d©a
;

4509 ià(
	`lik–y
(!
	`is_muÉiÿ¡_‘h”_addr
(
‘h
->
h_de¡
)))

4510 
nÜm®
;

4512 ià(
	`uÆik–y
(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))) {

4513 
	`kä“_skb
(
skb
);

4514  
NETDEV_TX_OK
;

4517 ià(
	`uÆik–y
(
	`›“80211_muÉiÿ¡_to_uniÿ¡
(
skb
, 
dev
))) {

4518 
sk_buff_h—d
 
queue
;

4520 
	`__skb_queue_h—d_š™
(&
queue
);

4521 
	`›“80211_cÚv”t_to_uniÿ¡
(
skb
, 
dev
, &
queue
);

4522 (
skb
 = 
	`__skb_dequeue
(&
queue
)))

4523 
	`__›“80211_subif_¡¬t_xm™
(
skb
, 
dev
, 0,

4524 
IEEE80211_TX_CTRL_MLO_LINK_UNSPEC
,

4525 
NULL
);

4526 } ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
) &&

4527 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 &&

4528 !
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
MLO_MCAST_MULTI_LINK_TX
)) {

4529 
	`›“80211_mlo_muÉiÿ¡_tx
(
dev
, 
skb
);

4531 
nÜm®
:

4532 
	`__›“80211_subif_¡¬t_xm™
(
skb
, 
dev
, 0,

4533 
IEEE80211_TX_CTRL_MLO_LINK_UNSPEC
,

4534 
NULL
);

4537  
NETDEV_TX_OK
;

4538 
	}
}

4542 
boŞ
 
	$__›“80211_tx_8023
(
›“80211_sub_if_d©a
 *
sd©a
,

4543 
sk_buff
 *
skb
, 
¡a_šfo
 *
¡a
,

4544 
boŞ
 
tx³ndšg
)

4546 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4547 
›“80211_tx_cÚŒŞ
 
cÚŒŞ
 = {};

4548 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

4549 
›“80211_¡a
 *
pub¡a
 = 
NULL
;

4550 
æags
;

4551 
q
 = 
šfo
->
hw_queue
;

4553 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

4555 ià(
loÿl
->
queue_¡İ_»asÚs
[
q
] ||

4556 (!
tx³ndšg
 && !
	`skb_queue_em±y
(&
loÿl
->
³ndšg
[
q
]))) {

4557 ià(
tx³ndšg
)

4558 
	`skb_queue_h—d
(&
loÿl
->
³ndšg
[
q
], 
skb
);

4560 
	`skb_queue_
(&
loÿl
->
³ndšg
[
q
], 
skb
);

4562 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

4564  
çl£
;

4567 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

4569 ià(
¡a
 && s->
u¶ßded
)

4570 
pub¡a
 = &
¡a
->sta;

4572 
cÚŒŞ
.
¡a
 = 
pub¡a
;

4574 
	`drv_tx
(
loÿl
, &
cÚŒŞ
, 
skb
);

4576  
Œue
;

4577 
	}
}

4579 
boŞ
 
	$›“80211_tx_8023
(
›“80211_sub_if_d©a
 *
sd©a
,

4580 
sk_buff
 *
skb
, 
¡a_šfo
 *
¡a
,

4581 
boŞ
 
tx³ndšg
)

4583 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4584 
sk_buff
 *
Ãxt
;

4585 
boŞ
 
»t
 = 
Œue
;

4587 ià(
	`›“80211_queue_skb
(
loÿl
, 
sd©a
, 
¡a
, 
skb
))

4588  
Œue
;

4590 
	`skb_li¡_w®k_§ã
(
skb
, skb, 
Ãxt
) {

4591 
	`skb_m¬k_nÙ_Ú_li¡
(
skb
);

4592 ià(!
	`__›“80211_tx_8023
(
sd©a
, 
skb
, 
¡a
, 
tx³ndšg
))

4593 
»t
 = 
çl£
;

4596  
»t
;

4597 
	}
}

4599 
	$›“80211_8023_xm™
(
›“80211_sub_if_d©a
 *
sd©a
,

4600 
Ãt_deviû
 *
dev
, 
¡a_šfo
 *
¡a
,

4601 
›“80211_key
 *
key
, 
sk_buff
 *
skb
)

4603 
›“80211_tx_šfo
 *
šfo
;

4604 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4605 
tid_ampdu_tx
 *
tid_tx
;

4606 
sk_buff
 *
£g
, *
Ãxt
;

4607 
skbs
 = 0, 
Ën
 = 0;

4608 
u16
 
queue
;

4609 
u8
 
tid
;

4611 
queue
 = 
	`›“80211_£Ëù_queue
(
sd©a
, 
¡a
, 
skb
);

4612 
	`skb_£t_queue_m­pšg
(
skb
, 
queue
);

4614 ià(
	`uÆik–y
(
	`‹¡_b™
(
SCAN_SW_SCANNING
, &
loÿl
->
sÿÂšg
)) &&

4615 
	`‹¡_b™
(
SDATA_STATE_OFFCHANNEL
, &
sd©a
->
¡©e
))

4616 
out_ä“
;

4618 
skb
 = 
	`skb_sh¬e_check
(skb, 
GFP_ATOMIC
);

4619 ià(
	`uÆik–y
(!
skb
))

4622 
	`›“80211_aggr_check
(
sd©a
, 
¡a
, 
skb
);

4624 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

4625 
tid_tx
 = 
	`rcu_d”eã»nû
(
¡a
->
ampdu_mlme
.tid_tx[
tid
]);

4626 ià(
tid_tx
) {

4627 ià(!
	`‹¡_b™
(
HT_AGG_STATE_OPERATIONAL
, &
tid_tx
->
¡©e
)) {

4629 
	`__›“80211_subif_¡¬t_xm™
(
skb
, 
dev
, 0,

4630 
IEEE80211_TX_CTRL_MLO_LINK_UNSPEC
,

4631 
NULL
);

4635 ià(
tid_tx
->
timeout
)

4636 
tid_tx
->
Ï¡_tx
 = 
jiff›s
;

4639 
skb
 = 
	`›“80211_tx_skb_fixup
(skb, 
	`›“80211_sd©a_Ãtdev_ã©u»s
(
sd©a
));

4640 ià(!
skb
)

4643 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

4644 
	`mem£t
(
šfo
, 0, (*info));

4646 
šfo
->
hw_queue
 = 
sd©a
->
vif
.hw_queue[
queue
];

4648 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
)

4649 
sd©a
 = 
	`cÚš”_of
(sd©a->
bss
,

4650 
›“80211_sub_if_d©a
, 
u
.
­
);

4652 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_HW_80211_ENCAP
;

4653 
šfo
->
cÚŒŞ
.
vif
 = &
sd©a
->vif;

4655 ià(
key
)

4656 
šfo
->
cÚŒŞ
.
hw_key
 = &
key
->
cÚf
;

4658 
	`skb_li¡_w®k_§ã
(
skb
, 
£g
, 
Ãxt
) {

4659 
skbs
++;

4660 
Ën
 +ğ
£g
->len;

4661 ià(
£g
 !ğ
skb
)

4662 
	`memıy
(
	`IEEE80211_SKB_CB
(
£g
), 
šfo
, (*info));

4665 ià(
	`uÆik–y
(
skb
->
sk
 &&

4666 
	`skb_shšfo
(
skb
)->
tx_æags
 & 
SKBTX_WIFI_STATUS
)) {

4667 
šfo
->
¡©us_d©a
 = 
	`›“80211_¡Üe_ack_skb
(
loÿl
, 
skb
,

4668 &
šfo
->
æags
, 
NULL
);

4669 ià(
šfo
->
¡©us_d©a
)

4670 
šfo
->
¡©us_d©a_idr
 = 1;

4673 
	`dev_sw_Ãt¡©s_tx_add
(
dev
, 
skbs
, 
Ën
);

4674 
¡a
->
deæšk
.
tx_¡©s
.
·ck‘s
[
queue
] +ğ
skbs
;

4675 
¡a
->
deæšk
.
tx_¡©s
.
by‹s
[
queue
] +ğ
Ën
;

4677 
	`›“80211_t_Ëd_Œig_tx
(
loÿl
, 
Ën
);

4679 
	`›“80211_tx_8023
(
sd©a
, 
skb
, 
¡a
, 
çl£
);

4683 
out_ä“
:

4684 
	`kä“_skb
(
skb
);

4685 
	}
}

4687 
Ãtdev_tx_t
 
	$›“80211_subif_¡¬t_xm™_8023
(
sk_buff
 *
skb
,

4688 
Ãt_deviû
 *
dev
)

4690 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

4691 
‘hhdr
 *
ehdr
 = (‘hhd¸*)
skb
->
d©a
;

4692 
›“80211_key
 *
key
;

4693 
¡a_šfo
 *
¡a
;

4695 ià(
	`uÆik–y
(!
	`›“80211_sd©a_ruÂšg
(
sd©a
è|| 
skb
->
Ën
 < 
ETH_HLEN
)) {

4696 
	`kä“_skb
(
skb
);

4697  
NETDEV_TX_OK
;

4700 
	`rcu_»ad_lock
();

4702 ià(
	`›“80211_lookup_¿_¡a
(
sd©a
, 
skb
, &
¡a
)) {

4703 
	`kä“_skb
(
skb
);

4704 
out
;

4707 ià(
	`uÆik–y
(
	`IS_ERR_OR_NULL
(
¡a
è|| !¡a->
u¶ßded
 ||

4708 !
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
) ||

4709 
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 =ğ
ehdr
->
h_´Ùo
))

4710 
sk_ofæßd
;

4712 
key
 = 
	`rcu_d”eã»nû
(
¡a
->
±k
[¡a->
±k_idx
]);

4713 ià(!
key
)

4714 
key
 = 
	`rcu_d”eã»nû
(
sd©a
->
deçuÉ_uniÿ¡_key
);

4716 ià(
key
 && (!(key->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
) ||

4717 
key
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_TKIP
))

4718 
sk_ofæßd
;

4720 
	`sk_·cšg_shiá_upd©e
(
skb
->
sk
, 
sd©a
->
loÿl
->
hw
.
tx_sk_·cšg_shiá
);

4721 
	`›“80211_8023_xm™
(
sd©a
, 
dev
, 
¡a
, 
key
, 
skb
);

4722 
out
;

4724 
sk_ofæßd
:

4725 
	`›“80211_subif_¡¬t_xm™
(
skb
, 
dev
);

4726 
out
:

4727 
	`rcu_»ad_uÆock
();

4729  
NETDEV_TX_OK
;

4730 
	}
}

4732 
sk_buff
 *

4733 
	$›“80211_bud_d©a_‹m¶©e
(
›“80211_sub_if_d©a
 *
sd©a
,

4734 
sk_buff
 *
skb
, 
u32
 
šfo_æags
)

4736 
›“80211_hdr
 *
hdr
;

4737 
›“80211_tx_d©a
 
tx
 = {

4738 .
loÿl
 = 
sd©a
->local,

4739 .
sd©a
 = sdata,

4741 
¡a_šfo
 *
¡a
;

4743 
	`rcu_»ad_lock
();

4745 ià(
	`›“80211_lookup_¿_¡a
(
sd©a
, 
skb
, &
¡a
)) {

4746 
	`kä“_skb
(
skb
);

4747 
skb
 = 
	`ERR_PTR
(-
EINVAL
);

4748 
out
;

4751 
skb
 = 
	`›“80211_bud_hdr
(
sd©a
, skb, 
šfo_æags
, 
¡a
,

4752 
IEEE80211_TX_CTRL_MLO_LINK_UNSPEC
, 
NULL
);

4753 ià(
	`IS_ERR
(
skb
))

4754 
out
;

4756 
hdr
 = (*)
skb
->
d©a
;

4757 
tx
.
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
hdr
->
addr1
);

4758 
tx
.
skb
 = skb;

4760 ià(
	`›“80211_tx_h_£Ëù_key
(&
tx
è!ğ
TX_CONTINUE
) {

4761 
	`rcu_»ad_uÆock
();

4762 
	`kä“_skb
(
skb
);

4763  
	`ERR_PTR
(-
EINVAL
);

4766 
out
:

4767 
	`rcu_»ad_uÆock
();

4768  
skb
;

4769 
	}
}

4775 
	$›“80211_ş—r_tx_³ndšg
(
›“80211_loÿl
 *
loÿl
)

4777 
sk_buff
 *
skb
;

4778 
i
;

4780 
i
 = 0; i < 
loÿl
->
hw
.
queues
; i++) {

4781 (
skb
 = 
	`skb_dequeue
(&
loÿl
->
³ndšg
[
i
])è!ğ
NULL
)

4782 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

4784 
	}
}

4791 
boŞ
 
	$›“80211_tx_³ndšg_skb
(
›“80211_loÿl
 *
loÿl
,

4792 
sk_buff
 *
skb
)

4794 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

4795 
›“80211_sub_if_d©a
 *
sd©a
;

4796 
¡a_šfo
 *
¡a
;

4797 
›“80211_hdr
 *
hdr
;

4798 
boŞ
 
»suÉ
;

4799 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

4801 
sd©a
 = 
	`vif_to_sd©a
(
šfo
->
cÚŒŞ
.
vif
);

4803 ià(
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_INTCFL_NEED_TXPROCESSING
) {

4805 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

4806 
chªùx_cÚf
 =

4807 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
);

4808 ià(
	`uÆik–y
(!
chªùx_cÚf
)) {

4809 
	`dev_kä“_skb
(
skb
);

4810  
Œue
;

4812 
šfo
->
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

4814 
»suÉ
 = 
	`›“80211_tx
(
sd©a
, 
NULL
, 
skb
, 
Œue
);

4815 } ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_HW_80211_ENCAP
) {

4816 ià(
	`›“80211_lookup_¿_¡a
(
sd©a
, 
skb
, &
¡a
)) {

4817 
	`dev_kä“_skb
(
skb
);

4818  
Œue
;

4821 ià(
	`IS_ERR
(
¡a
è|| (¡¨&& !¡a->
u¶ßded
))

4822 
¡a
 = 
NULL
;

4824 
»suÉ
 = 
	`›“80211_tx_8023
(
sd©a
, 
skb
, 
¡a
, 
Œue
);

4826 
sk_buff_h—d
 
skbs
;

4828 
	`__skb_queue_h—d_š™
(&
skbs
);

4829 
	`__skb_queue_
(&
skbs
, 
skb
);

4831 
hdr
 = (
›“80211_hdr
 *)
skb
->
d©a
;

4832 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
hdr
->
addr1
);

4834 
»suÉ
 = 
	`__›“80211_tx
(
loÿl
, &
skbs
, 
¡a
, 
Œue
);

4837  
»suÉ
;

4838 
	}
}

4843 
	$›“80211_tx_³ndšg
(
skËt_¡ruù
 *
t
)

4845 
›“80211_loÿl
 *
loÿl
 = 
	`äom_skËt
Öoÿl, 
t
,

4846 
tx_³ndšg_skËt
);

4847 
æags
;

4848 
i
;

4849 
boŞ
 
txok
;

4851 
	`rcu_»ad_lock
();

4853 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

4854 
i
 = 0; i < 
loÿl
->
hw
.
queues
; i++) {

4859 ià(
loÿl
->
queue_¡İ_»asÚs
[
i
] ||

4860 
	`skb_queue_em±y
(&
loÿl
->
³ndšg
[
i
]))

4863 !
	`skb_queue_em±y
(&
loÿl
->
³ndšg
[
i
])) {

4864 
sk_buff
 *
skb
 = 
	`__skb_dequeue
(&
loÿl
->
³ndšg
[
i
]);

4865 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

4867 ià(
	`WARN_ON
(!
šfo
->
cÚŒŞ
.
vif
)) {

4868 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

4872 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
,

4873 
æags
);

4875 
txok
 = 
	`›“80211_tx_³ndšg_skb
(
loÿl
, 
skb
);

4876 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
,

4877 
æags
);

4878 ià(!
txok
)

4882 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

4884 
	`rcu_»ad_uÆock
();

4885 
	}
}

4889 
	$__›“80211_b—cÚ_add_tim
(
›“80211_sub_if_d©a
 *
sd©a
,

4890 
›“80211_lšk_d©a
 *
lšk
,

4891 
ps_d©a
 *
ps
, 
sk_buff
 *
skb
,

4892 
boŞ
 
is_‹m¶©e
)

4894 
u8
 *
pos
, *
tim
;

4895 
aid0
 = 0;

4896 
i
, 
have_b™s
 = 0, 
n1
, 
n2
;

4897 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

4901 ià(
	`©omic_»ad
(&
ps
->
num_¡a_ps
) > 0)

4904 
have_b™s
 = !
	`b™m­_em±y
((*)
ps
->
tim
,

4905 
IEEE80211_MAX_AID
+1);

4906 ià(!
is_‹m¶©e
) {

4907 ià(
ps
->
dtim_couÁ
 == 0)

4908 
ps
->
dtim_couÁ
 = 
lšk_cÚf
->
dtim_³riod
 - 1;

4910 
ps
->
dtim_couÁ
--;

4913 
tim
 = 
pos
 = 
	`skb_put
(
skb
, 5);

4914 *
pos
++ = 
WLAN_EID_TIM
;

4915 *
pos
++ = 3;

4916 *
pos
++ = 
ps
->
dtim_couÁ
;

4917 *
pos
++ = 
lšk_cÚf
->
dtim_³riod
;

4919 ià(
ps
->
dtim_couÁ
 =ğ0 && !
	`skb_queue_em±y
(&ps->
bc_buf
))

4920 
aid0
 = 1;

4922 
ps
->
dtim_bc_mc
 = 
aid0
 == 1;

4924 ià(
have_b™s
) {

4928 
n1
 = 0;

4929 
i
 = 0; i < 
IEEE80211_MAX_TIM_LEN
; i++) {

4930 ià(
ps
->
tim
[
i
]) {

4931 
n1
 = 
i
 & 0xfe;

4935 
n2
 = 
n1
;

4936 
i
 = 
IEEE80211_MAX_TIM_LEN
 - 1; i >ğ
n1
; i--) {

4937 ià(
ps
->
tim
[
i
]) {

4938 
n2
 = 
i
;

4944 *
pos
++ = 
n1
 | 
aid0
;

4946 
	`skb_put_d©a
(
skb
, 
ps
->
tim
 + 
n1
, 
n2
 -‚1 + 1);

4948 
tim
[1] = 
n2
 - 
n1
 + 4;

4950 *
pos
++ = 
aid0
;

4952 ià(
	`›“80211_g‘_lšk_sbªd
(
lšk
)->
bªd
 !ğ
NL80211_BAND_S1GHZ
) {

4953 
tim
[1] = 4;

4955 
	`skb_put_u8
(
skb
, 0);

4958 
	}
}

4960 
	$›“80211_b—cÚ_add_tim
(
›“80211_sub_if_d©a
 *
sd©a
,

4961 
›“80211_lšk_d©a
 *
lšk
,

4962 
ps_d©a
 *
ps
, 
sk_buff
 *
skb
,

4963 
boŞ
 
is_‹m¶©e
)

4965 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

4974 ià(
loÿl
->
tim_š_locked_£ùiÚ
) {

4975 
	`__›“80211_b—cÚ_add_tim
(
sd©a
, 
lšk
, 
ps
, 
skb
, 
is_‹m¶©e
);

4977 
	`¥š_lock_bh
(&
loÿl
->
tim_lock
);

4978 
	`__›“80211_b—cÚ_add_tim
(
sd©a
, 
lšk
, 
ps
, 
skb
, 
is_‹m¶©e
);

4979 
	`¥š_uÆock_bh
(&
loÿl
->
tim_lock
);

4983 
	}
}

4985 
	$›“80211_£t_b—cÚ_útdwn
(
›“80211_sub_if_d©a
 *
sd©a
,

4986 
b—cÚ_d©a
 *
b—cÚ
,

4987 
›“80211_lšk_d©a
 *
lšk
)

4989 
u8
 *
b—cÚ_d©a
, 
couÁ
, 
max_couÁ
 = 1;

4990 
´obe_»¥
 *
»¥
;

4991 
size_t
 
b—cÚ_d©a_Ën
;

4992 
u16
 *
bú_off£ts
;

4993 
i
;

4995 
sd©a
->
vif
.
ty³
) {

4996 
NL80211_IFTYPE_AP
:

4997 
b—cÚ_d©a
 = 
b—cÚ
->

;

4998 
b—cÚ_d©a_Ën
 = 
b—cÚ
->
_Ën
;

5000 
NL80211_IFTYPE_ADHOC
:

5001 
b—cÚ_d©a
 = 
b—cÚ
->
h—d
;

5002 
b—cÚ_d©a_Ën
 = 
b—cÚ
->
h—d_Ën
;

5004 
NL80211_IFTYPE_MESH_POINT
:

5005 
b—cÚ_d©a
 = 
b—cÚ
->
h—d
;

5006 
b—cÚ_d©a_Ën
 = 
b—cÚ
->
h—d_Ën
;

5012 
»¥
 = 
	`rcu_d”eã»nû
(
lšk
->
u
.
­
.
´obe_»¥
);

5014 
bú_off£ts
 = 
b—cÚ
->
útdwn_couÁ”_off£ts
;

5015 
couÁ
 = 
b—cÚ
->
útdwn_cu¼’t_couÁ”
;

5016 ià(
lšk
->
cÚf
->
c§_aùive
)

5017 
max_couÁ
 = 
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
;

5019 
i
 = 0; i < 
max_couÁ
; ++i) {

5020 ià(
bú_off£ts
[
i
]) {

5021 ià(
	`WARN_ON_ONCE
(
bú_off£ts
[
i
] >ğ
b—cÚ_d©a_Ën
))

5023 
b—cÚ_d©a
[
bú_off£ts
[
i
]] = 
couÁ
;

5026 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 && 
»¥
) {

5027 
u16
 *
»¥_off£ts
 = 
»¥
->
útdwn_couÁ”_off£ts
;

5029 
»¥
->
d©a
[
»¥_off£ts
[
i
]] = 
couÁ
;

5032 
	}
}

5034 
u8
 
	$__›“80211_b—cÚ_upd©e_útdwn
(
b—cÚ_d©a
 *
b—cÚ
)

5036 
b—cÚ
->
útdwn_cu¼’t_couÁ”
--;

5039 
	`WARN_ON_ONCE
(!
b—cÚ
->
útdwn_cu¼’t_couÁ”
);

5041  
b—cÚ
->
útdwn_cu¼’t_couÁ”
;

5042 
	}
}

5044 
u8
 
	$›“80211_b—cÚ_upd©e_útdwn
(
›“80211_vif
 *
vif
, 
lšk_id
)

5046 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5047 
›“80211_lšk_d©a
 *
lšk
;

5048 
b—cÚ_d©a
 *
b—cÚ
 = 
NULL
;

5049 
u8
 
couÁ
 = 0;

5051 ià(
	`WARN_ON
(
lšk_id
 >ğ
IEEE80211_MLD_MAX_NUM_LINKS
))

5054 
	`rcu_»ad_lock
();

5056 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

5057 ià(!
lšk
)

5058 
uÆock
;

5060 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

5061 
b—cÚ
 = 
	`rcu_d”eã»nû
(
lšk
->
u
.
­
.beacon);

5062 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

5063 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
ibss
.
´e¥
);

5064 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

5065 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
mesh
.beacon);

5067 ià(!
b—cÚ
)

5068 
uÆock
;

5070 
couÁ
 = 
	`__›“80211_b—cÚ_upd©e_útdwn
(
b—cÚ
);

5072 
uÆock
:

5073 
	`rcu_»ad_uÆock
();

5074  
couÁ
;

5075 
	}
}

5076 
EXPORT_SYMBOL
(
›“80211_b—cÚ_upd©e_útdwn
);

5078 
	$›“80211_b—cÚ_£t_útdwn
(
›“80211_vif
 *
vif
, 
u8
 
couÁ”
)

5080 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5081 
b—cÚ_d©a
 *
b—cÚ
 = 
NULL
;

5083 
	`rcu_»ad_lock
();

5085 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

5086 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
deæšk
.
u
.
­
.beacon);

5087 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
)

5088 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
ibss
.
´e¥
);

5089 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
))

5090 
b—cÚ
 = 
	`rcu_d”eã»nû
(
sd©a
->
u
.
mesh
.beacon);

5092 ià(!
b—cÚ
)

5093 
uÆock
;

5095 ià(
couÁ”
 < 
b—cÚ
->
útdwn_cu¼’t_couÁ”
)

5096 
b—cÚ
->
útdwn_cu¼’t_couÁ”
 = 
couÁ”
;

5098 
uÆock
:

5099 
	`rcu_»ad_uÆock
();

5100 
	}
}

5101 
EXPORT_SYMBOL
(
›“80211_b—cÚ_£t_útdwn
);

5103 
boŞ
 
	$›“80211_b—cÚ_útdwn_is_com¶‘e
(
›“80211_vif
 *
vif
,

5104 
lšk_id
)

5106 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5107 
›“80211_lšk_d©a
 *
lšk
;

5108 
b—cÚ_d©a
 *
b—cÚ
 = 
NULL
;

5109 
u8
 *
b—cÚ_d©a
;

5110 
size_t
 
b—cÚ_d©a_Ën
;

5111 
»t
 = 
çl£
;

5113 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

5114  
çl£
;

5116 ià(
	`WARN_ON
(
lšk_id
 >ğ
IEEE80211_MLD_MAX_NUM_LINKS
))

5119 
	`rcu_»ad_lock
();

5121 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

5122 ià(!
lšk
)

5123 
out
;

5125 ià(
vif
->
ty³
 =ğ
NL80211_IFTYPE_AP
) {

5126 
b—cÚ
 = 
	`rcu_d”eã»nû
(
lšk
->
u
.
­
.beacon);

5127 ià(
	`WARN_ON
(!
b—cÚ
 || !b—cÚ->

))

5128 
out
;

5129 
b—cÚ_d©a
 = 
b—cÚ
->

;

5130 
b—cÚ_d©a_Ën
 = 
b—cÚ
->
_Ën
;

5131 } ià(
vif
->
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) {

5132 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

5134 
b—cÚ
 = 
	`rcu_d”eã»nû
(
ifibss
->
´e¥
);

5135 ià(!
b—cÚ
)

5136 
out
;

5138 
b—cÚ_d©a
 = 
b—cÚ
->
h—d
;

5139 
b—cÚ_d©a_Ën
 = 
b—cÚ
->
h—d_Ën
;

5140 } ià(
vif
->
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
) {

5141 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

5143 
b—cÚ
 = 
	`rcu_d”eã»nû
(
ifmsh
->beacon);

5144 ià(!
b—cÚ
)

5145 
out
;

5147 
b—cÚ_d©a
 = 
b—cÚ
->
h—d
;

5148 
b—cÚ_d©a_Ën
 = 
b—cÚ
->
h—d_Ën
;

5150 
	`WARN_ON
(1);

5151 
out
;

5154 ià(!
b—cÚ
->
útdwn_couÁ”_off£ts
[0])

5155 
out
;

5157 ià(
	`WARN_ON_ONCE
(
b—cÚ
->
útdwn_couÁ”_off£ts
[0] > 
b—cÚ_d©a_Ën
))

5158 
out
;

5160 ià(
b—cÚ_d©a
[
b—cÚ
->
útdwn_couÁ”_off£ts
[0]] == 1)

5161 
»t
 = 
Œue
;

5163 
out
:

5164 
	`rcu_»ad_uÆock
();

5166  
»t
;

5167 
	}
}

5168 
EXPORT_SYMBOL
(
›“80211_b—cÚ_útdwn_is_com¶‘e
);

5170 
	$›“80211_b—cÚ_´Ùeù
(
sk_buff
 *
skb
,

5171 
›“80211_loÿl
 *
loÿl
,

5172 
›“80211_sub_if_d©a
 *
sd©a
,

5173 
›“80211_lšk_d©a
 *
lšk
)

5175 
›“80211_tx_»suÉ
 
»s
;

5176 
›“80211_tx_d©a
 
tx
;

5177 
sk_buff
 *
check_skb
;

5179 
	`mem£t
(&
tx
, 0, (tx));

5180 
tx
.
key
 = 
	`rcu_d”eã»nû
(
lšk
->
deçuÉ_b—cÚ_key
);

5181 ià(!
tx
.
key
)

5184 ià(
	`uÆik–y
(
tx
.
key
->
æags
 & 
KEY_FLAG_TAINTED
)) {

5185 
tx
.
key
 = 
NULL
;

5186  -
EINVAL
;

5189 ià(!(
tx
.
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_SW_MGMT_TX
) &&

5190 
tx
.
key
->
æags
 & 
KEY_FLAG_UPLOADED_TO_HARDWARE
)

5191 
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
hw_key
 = &
tx
.
key
->
cÚf
;

5193 
tx
.
loÿl
 =†ocal;

5194 
tx
.
sd©a
 = sdata;

5195 
	`__skb_queue_h—d_š™
(&
tx
.
skbs
);

5196 
	`__skb_queue_
(&
tx
.
skbs
, 
skb
);

5197 
»s
 = 
	`›“80211_tx_h_’üy±
(&
tx
);

5198 
check_skb
 = 
	`__skb_dequeue
(&
tx
.
skbs
);

5200 
	`WARN_ON
(
check_skb
 !ğ
skb
);

5201 ià(
	`WARN_ON_ONCE
(
»s
 !ğ
TX_CONTINUE
))

5202  -
EINVAL
;

5205 
	}
}

5208 
	$›“80211_b—cÚ_g‘_fšish
(
›“80211_hw
 *
hw
,

5209 
›“80211_vif
 *
vif
,

5210 
›“80211_lšk_d©a
 *
lšk
,

5211 
›“80211_mubË_off£ts
 *
offs
,

5212 
b—cÚ_d©a
 *
b—cÚ
,

5213 
sk_buff
 *
skb
,

5214 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
,

5215 
u16
 
c§_off_ba£
)

5217 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5218 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5219 
›“80211_tx_šfo
 *
šfo
;

5220 
Æ80211_bªd
 
bªd
;

5221 
›“80211_tx_¿‹_cÚŒŞ
 
txrc
;

5224 ià(
offs
 && 
b—cÚ
) {

5225 
u16
 
i
;

5227 
i
 = 0; i < 
IEEE80211_MAX_CNTDWN_COUNTERS_NUM
; i++) {

5228 
u16
 
c§_off
 = 
b—cÚ
->
útdwn_couÁ”_off£ts
[
i
];

5230 ià(!
c§_off
)

5233 
offs
->
útdwn_couÁ”_offs
[
i
] = 
c§_off_ba£
 + 
c§_off
;

5237 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

5238 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

5239 
šfo
->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

5240 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

5241 
šfo
->
bªd
 = band;

5243 
	`mem£t
(&
txrc
, 0, (txrc));

5244 
txrc
.
hw
 = hw;

5245 
txrc
.
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

5246 
txrc
.
bss_cÚf
 = 
lšk
->
cÚf
;

5247 
txrc
.
skb
 = skb;

5248 
txrc
.
»pÜ‹d_¿‹
.
idx
 = -1;

5249 ià(
sd©a
->
b—cÚ_¿‹_£t
 && sd©a->
b—cÚ_¿‹idx_mask
[
bªd
])

5250 
txrc
.
¿‹_idx_mask
 = 
sd©a
->
b—cÚ_¿‹idx_mask
[
bªd
];

5252 
txrc
.
¿‹_idx_mask
 = 
sd©a
->
rc_¿‹idx_mask
[
bªd
];

5253 
txrc
.
bss
 = 
Œue
;

5254 
	`¿‹_cÚŒŞ_g‘_¿‹
(
sd©a
, 
NULL
, &
txrc
);

5256 
šfo
->
cÚŒŞ
.
vif
 = vif;

5257 
šfo
->
cÚŒŞ
.
æags
 |ğ
	`u32_’code_b™s
(
lšk
->
lšk_id
,

5258 
IEEE80211_TX_CTRL_MLO_LINK
);

5259 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_CLEAR_PS_FILT
 |

5260 
IEEE80211_TX_CTL_ASSIGN_SEQ
 |

5261 
IEEE80211_TX_CTL_FIRST_FRAGMENT
;

5262 
	}
}

5265 
	$›“80211_b—cÚ_add_mbssid
(
sk_buff
 *
skb
, 
b—cÚ_d©a
 *
b—cÚ
,

5266 
u8
 
i
)

5268 ià(!
b—cÚ
->
mbssid_›s
 || !b—cÚ->mbssid_›s->
út
 ||

5269 
i
 > 
b—cÚ
->
mbssid_›s
->
út
)

5272 ià(
i
 < 
b—cÚ
->
mbssid_›s
->
út
) {

5273 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
mbssid_›s
->
–em
[
i
].
d©a
,

5274 
b—cÚ
->
mbssid_›s
->
–em
[
i
].
Ën
);

5276 ià(
b—cÚ
->
ºr_›s
 && b—cÚ->ºr_›s->
út
) {

5277 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
ºr_›s
->
–em
[
i
].
d©a
,

5278 
b—cÚ
->
ºr_›s
->
–em
[
i
].
Ën
);

5280 
i
 = 
b—cÚ
->
mbssid_›s
->
út
; i < b—cÚ->
ºr_›s
->cnt; i++)

5281 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
ºr_›s
->
–em
[
i
].
d©a
,

5282 
b—cÚ
->
ºr_›s
->
–em
[
i
].
Ën
);

5288 
i
 = 0; i < 
b—cÚ
->
mbssid_›s
->
út
; i++)

5289 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
mbssid_›s
->
–em
[
i
].
d©a
,

5290 
b—cÚ
->
mbssid_›s
->
–em
[
i
].
Ën
);

5291 
	}
}

5293 
sk_buff
 *

5294 
	$›“80211_b—cÚ_g‘_­
(
›“80211_hw
 *
hw
,

5295 
›“80211_vif
 *
vif
,

5296 
›“80211_lšk_d©a
 *
lšk
,

5297 
›“80211_mubË_off£ts
 *
offs
,

5298 
boŞ
 
is_‹m¶©e
,

5299 
b—cÚ_d©a
 *
b—cÚ
,

5300 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
,

5301 
u8
 
ema_šdex
)

5303 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5304 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5305 
›“80211_if_­
 *
­
 = &
sd©a
->
u
.ap;

5306 
sk_buff
 *
skb
 = 
NULL
;

5307 
u16
 
c§_off_ba£
 = 0;

5308 
mbssid_Ën
;

5310 ià(
b—cÚ
->
útdwn_couÁ”_off£ts
[0]) {

5311 ià(!
is_‹m¶©e
)

5312 
	`›“80211_b—cÚ_upd©e_útdwn
(
vif
, 
lšk
->
lšk_id
);

5314 
	`›“80211_£t_b—cÚ_útdwn
(
sd©a
, 
b—cÚ
, 
lšk
);

5320 
mbssid_Ën
 = 
	`›“80211_g‘_mbssid_b—cÚ_Ën
(
b—cÚ
->
mbssid_›s
,

5321 
b—cÚ
->
ºr_›s
,

5322 
ema_šdex
);

5324 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
b—cÚ
->
h—d_Ën
 +

5325 
b—cÚ
->
_Ën
 + 256 +

5326 
loÿl
->
hw
.
exŒa_b—cÚ_room
 + 
mbssid_Ën
);

5327 ià(!
skb
)

5328  
NULL
;

5330 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

5331 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
h—d
, b—cÚ->
h—d_Ën
);

5333 
	`›“80211_b—cÚ_add_tim
(
sd©a
, 
lšk
, &
­
->
ps
, 
skb
, 
is_‹m¶©e
);

5335 ià(
offs
) {

5336 
offs
->
tim_off£t
 = 
b—cÚ
->
h—d_Ën
;

5337 
offs
->
tim_Ëngth
 = 
skb
->
Ën
 - 
b—cÚ
->
h—d_Ën
;

5338 
offs
->
útdwn_couÁ”_offs
[0] = 
b—cÚ
->
útdwn_couÁ”_off£ts
[0];

5340 ià(
mbssid_Ën
) {

5341 
	`›“80211_b—cÚ_add_mbssid
(
skb
, 
b—cÚ
, 
ema_šdex
);

5342 
offs
->
mbssid_off
 = 
skb
->
Ën
 - 
mbssid_Ën
;

5346 
c§_off_ba£
 = 
skb
->
Ën
;

5349 ià(
b—cÚ
->

)

5350 
	`skb_put_d©a
(
skb
, 
b—cÚ
->

, b—cÚ->
_Ën
);

5352 ià(
	`›“80211_b—cÚ_´Ùeù
(
skb
, 
loÿl
, 
sd©a
, 
lšk
) < 0)

5353  
NULL
;

5355 
	`›“80211_b—cÚ_g‘_fšish
(
hw
, 
vif
, 
lšk
, 
offs
, 
b—cÚ
, 
skb
,

5356 
chªùx_cÚf
, 
c§_off_ba£
);

5357  
skb
;

5358 
	}
}

5360 
›“80211_ema_b—cÚs
 *

5361 
	$›“80211_b—cÚ_g‘_­_ema_li¡
(
›“80211_hw
 *
hw
,

5362 
›“80211_vif
 *
vif
,

5363 
›“80211_lšk_d©a
 *
lšk
,

5364 
›“80211_mubË_off£ts
 *
offs
,

5365 
boŞ
 
is_‹m¶©e
, 
b—cÚ_d©a
 *
b—cÚ
,

5366 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
)

5368 
›“80211_ema_b—cÚs
 *
ema
 = 
NULL
;

5370 ià(!
b—cÚ
->
mbssid_›s
 || !b—cÚ->mbssid_›s->
út
)

5371  
NULL
;

5373 
ema
 = 
	`kz®loc
(
	`¡ruù_size
Óma, 
bú
, 
b—cÚ
->
mbssid_›s
->
út
),

5374 
GFP_ATOMIC
);

5375 ià(!
ema
)

5376  
NULL
;

5378 
ema
->
út
 = 0;ƒma->úˆ< 
b—cÚ
->
mbssid_›s
->cnt;ƒma->cnt++) {

5379 
ema
->
bú
[ema->
út
].
skb
 =

5380 
	`›“80211_b—cÚ_g‘_­
(
hw
, 
vif
, 
lšk
,

5381 &
ema
->
bú
[ema->
út
].
offs
,

5382 
is_‹m¶©e
, 
b—cÚ
,

5383 
chªùx_cÚf
, 
ema
->
út
);

5384 ià(!
ema
->
bú
[ema->
út
].
skb
)

5388 ià(
ema
->
út
 =ğ
b—cÚ
->
mbssid_›s
->cnt)

5389  
ema
;

5391 
	`›“80211_b—cÚ_ä“_ema_li¡
(
ema
);

5392  
NULL
;

5393 
	}
}

5395 
	#IEEE80211_INCLUDE_ALL_MBSSID_ELEMS
 -1

	)

5397 
sk_buff
 *

5398 
	$__›“80211_b—cÚ_g‘
(
›“80211_hw
 *
hw
,

5399 
›“80211_vif
 *
vif
,

5400 
›“80211_mubË_off£ts
 *
offs
,

5401 
boŞ
 
is_‹m¶©e
,

5402 
lšk_id
,

5403 
ema_šdex
,

5404 
›“80211_ema_b—cÚs
 **
ema_b—cÚs
)

5406 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5407 
b—cÚ_d©a
 *
b—cÚ
 = 
NULL
;

5408 
sk_buff
 *
skb
 = 
NULL
;

5409 
›“80211_sub_if_d©a
 *
sd©a
 = 
NULL
;

5410 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

5411 
›“80211_lšk_d©a
 *
lšk
;

5413 
	`rcu_»ad_lock
();

5415 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5416 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

5417 ià(!
lšk
)

5418 
out
;

5419 
chªùx_cÚf
 =

5420 
	`rcu_d”eã»nû
(
lšk
->
cÚf
->
chªùx_cÚf
);

5422 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
è|| !
chªùx_cÚf
)

5423 
out
;

5425 ià(
offs
)

5426 
	`mem£t
(
offs
, 0, (*offs));

5428 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

5429 
b—cÚ
 = 
	`rcu_d”eã»nû
(
lšk
->
u
.
­
.beacon);

5430 ià(!
b—cÚ
)

5431 
out
;

5433 ià(
ema_b—cÚs
) {

5434 *
ema_b—cÚs
 =

5435 
	`›“80211_b—cÚ_g‘_­_ema_li¡
(
hw
, 
vif
, 
lšk
,

5436 
offs
,

5437 
is_‹m¶©e
,

5438 
b—cÚ
,

5439 
chªùx_cÚf
);

5441 ià(
b—cÚ
->
mbssid_›s
 && b—cÚ->mbssid_›s->
út
) {

5442 ià(
ema_šdex
 >ğ
b—cÚ
->
mbssid_›s
->
út
)

5443 
out
;

5445 ià(
ema_šdex
 <ğ
IEEE80211_INCLUDE_ALL_MBSSID_ELEMS
)

5446 
ema_šdex
 = 
b—cÚ
->
mbssid_›s
->
út
;

5448 
ema_šdex
 = 0;

5451 
skb
 = 
	`›“80211_b—cÚ_g‘_­
(
hw
, 
vif
, 
lšk
, 
offs
,

5452 
is_‹m¶©e
, 
b—cÚ
,

5453 
chªùx_cÚf
,

5454 
ema_šdex
);

5456 } ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_ADHOC
) {

5457 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

5458 
›“80211_hdr
 *
hdr
;

5460 
b—cÚ
 = 
	`rcu_d”eã»nû
(
ifibss
->
´e¥
);

5461 ià(!
b—cÚ
)

5462 
out
;

5464 ià(
b—cÚ
->
útdwn_couÁ”_off£ts
[0]) {

5465 ià(!
is_‹m¶©e
)

5466 
	`__›“80211_b—cÚ_upd©e_útdwn
(
b—cÚ
);

5468 
	`›“80211_£t_b—cÚ_útdwn
(
sd©a
, 
b—cÚ
, 
lšk
);

5471 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
b—cÚ
->
h—d_Ën
 +

5472 
loÿl
->
hw
.
exŒa_b—cÚ_room
);

5473 ià(!
skb
)

5474 
out
;

5475 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

5476 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
h—d
, b—cÚ->
h—d_Ën
);

5478 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

5479 
hdr
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

5480 
IEEE80211_STYPE_BEACON
);

5482 
	`›“80211_b—cÚ_g‘_fšish
(
hw
, 
vif
, 
lšk
, 
offs
, 
b—cÚ
, 
skb
,

5483 
chªùx_cÚf
, 0);

5484 } ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

5485 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

5487 
b—cÚ
 = 
	`rcu_d”eã»nû
(
ifmsh
->beacon);

5488 ià(!
b—cÚ
)

5489 
out
;

5491 ià(
b—cÚ
->
útdwn_couÁ”_off£ts
[0]) {

5492 ià(!
is_‹m¶©e
)

5498 
	`__›“80211_b—cÚ_upd©e_útdwn
(
b—cÚ
);

5500 
	`›“80211_£t_b—cÚ_útdwn
(
sd©a
, 
b—cÚ
, 
lšk
);

5503 ià(
ifmsh
->
sync_İs
)

5504 
ifmsh
->
sync_İs
->
	`adju¡_tsf
(
sd©a
, 
b—cÚ
);

5506 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 +

5507 
b—cÚ
->
h—d_Ën
 +

5509 
b—cÚ
->
_Ën
 +

5510 
loÿl
->
hw
.
exŒa_b—cÚ_room
);

5511 ià(!
skb
)

5512 
out
;

5513 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

5514 
	`skb_put_d©a
(
skb
, 
b—cÚ
->
h—d
, b—cÚ->
h—d_Ën
);

5515 
	`›“80211_b—cÚ_add_tim
(
sd©a
, 
lšk
, &
ifmsh
->
ps
, 
skb
,

5516 
is_‹m¶©e
);

5518 ià(
offs
) {

5519 
offs
->
tim_off£t
 = 
b—cÚ
->
h—d_Ën
;

5520 
offs
->
tim_Ëngth
 = 
skb
->
Ën
 - 
b—cÚ
->
h—d_Ën
;

5523 
	`skb_put_d©a
(
skb
, 
b—cÚ
->

, b—cÚ->
_Ën
);

5524 
	`›“80211_b—cÚ_g‘_fšish
(
hw
, 
vif
, 
lšk
, 
offs
, 
b—cÚ
, 
skb
,

5525 
chªùx_cÚf
, 0);

5527 
	`WARN_ON
(1);

5528 
out
;

5531 
out
:

5532 
	`rcu_»ad_uÆock
();

5533  
skb
;

5535 
	}
}

5537 
sk_buff
 *

5538 
	$›“80211_b—cÚ_g‘_‹m¶©e
(
›“80211_hw
 *
hw
,

5539 
›“80211_vif
 *
vif
,

5540 
›“80211_mubË_off£ts
 *
offs
,

5541 
lšk_id
)

5543  
	`__›“80211_b—cÚ_g‘
(
hw
, 
vif
, 
offs
, 
Œue
, 
lšk_id
,

5544 
IEEE80211_INCLUDE_ALL_MBSSID_ELEMS
, 
NULL
);

5545 
	}
}

5546 
EXPORT_SYMBOL
(
›“80211_b—cÚ_g‘_‹m¶©e
);

5548 
sk_buff
 *

5549 
	$›“80211_b—cÚ_g‘_‹m¶©e_ema_šdex
(
›“80211_hw
 *
hw
,

5550 
›“80211_vif
 *
vif
,

5551 
›“80211_mubË_off£ts
 *
offs
,

5552 
lšk_id
, 
u8
 
ema_šdex
)

5554  
	`__›“80211_b—cÚ_g‘
(
hw
, 
vif
, 
offs
, 
Œue
, 
lšk_id
, 
ema_šdex
,

5555 
NULL
);

5556 
	}
}

5557 
EXPORT_SYMBOL
(
›“80211_b—cÚ_g‘_‹m¶©e_ema_šdex
);

5559 
	$›“80211_b—cÚ_ä“_ema_li¡
(
›“80211_ema_b—cÚs
 *
ema_b—cÚs
)

5561 
u8
 
i
;

5563 ià(!
ema_b—cÚs
)

5566 
i
 = 0; i < 
ema_b—cÚs
->
út
; i++)

5567 
	`kä“_skb
(
ema_b—cÚs
->
bú
[
i
].
skb
);

5569 
	`kä“
(
ema_b—cÚs
);

5570 
	}
}

5571 
EXPORT_SYMBOL
(
›“80211_b—cÚ_ä“_ema_li¡
);

5573 
›“80211_ema_b—cÚs
 *

5574 
	$›“80211_b—cÚ_g‘_‹m¶©e_ema_li¡
(
›“80211_hw
 *
hw
,

5575 
›“80211_vif
 *
vif
,

5576 
lšk_id
)

5578 
›“80211_ema_b—cÚs
 *
ema_b—cÚs
 = 
NULL
;

5580 
	`WARN_ON
(
	`__›“80211_b—cÚ_g‘
(
hw
, 
vif
, 
NULL
, 
Œue
, 
lšk_id
, 0,

5581 &
ema_b—cÚs
));

5583  
ema_b—cÚs
;

5584 
	}
}

5585 
EXPORT_SYMBOL
(
›“80211_b—cÚ_g‘_‹m¶©e_ema_li¡
);

5587 
sk_buff
 *
	$›“80211_b—cÚ_g‘_tim
(
›“80211_hw
 *
hw
,

5588 
›“80211_vif
 *
vif
,

5589 
u16
 *
tim_off£t
, u16 *
tim_Ëngth
,

5590 
lšk_id
)

5592 
›“80211_mubË_off£ts
 
offs
 = {};

5593 
sk_buff
 *
bú
 = 
	`__›“80211_b—cÚ_g‘
(
hw
, 
vif
, &
offs
, 
çl£
,

5594 
lšk_id
,

5595 
IEEE80211_INCLUDE_ALL_MBSSID_ELEMS
,

5596 
NULL
);

5597 
sk_buff
 *
cİy
;

5599 ià(!
bú
)

5600  
bú
;

5602 ià(
tim_off£t
)

5603 *
tim_off£t
 = 
offs
.tim_offset;

5605 ià(
tim_Ëngth
)

5606 *
tim_Ëngth
 = 
offs
.tim_length;

5608 ià(
	`›“80211_hw_check
(
hw
, 
BEACON_TX_STATUS
) ||

5609 !
	`hw_to_loÿl
(
hw
)->
mÚ™Üs
)

5610  
bú
;

5613 
cİy
 = 
	`skb_cİy
(
bú
, 
GFP_ATOMIC
);

5614 ià(!
cİy
)

5615  
bú
;

5617 
	`›“80211_tx_mÚ™Ü
(
	`hw_to_loÿl
(
hw
), 
cİy
, 1, 
çl£
, 
NULL
);

5619  
bú
;

5620 
	}
}

5621 
EXPORT_SYMBOL
(
›“80211_b—cÚ_g‘_tim
);

5623 
sk_buff
 *
	$›“80211_´ob”e¥_g‘
(
›“80211_hw
 *
hw
,

5624 
›“80211_vif
 *
vif
)

5626 
sk_buff
 *
skb
 = 
NULL
;

5627 
´obe_»¥
 *
´e¥
 = 
NULL
;

5628 
›“80211_hdr
 *
hdr
;

5629 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5631 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

5632  
NULL
;

5634 
	`rcu_»ad_lock
();

5635 
´e¥
 = 
	`rcu_d”eã»nû
(
sd©a
->
deæšk
.
u
.
­
.
´obe_»¥
);

5636 ià(!
´e¥
)

5637 
out
;

5639 
skb
 = 
	`dev_®loc_skb
(
´e¥
->
Ën
);

5640 ià(!
skb
)

5641 
out
;

5643 
	`skb_put_d©a
(
skb
, 
´e¥
->
d©a
,…»¥->
Ën
);

5645 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

5646 
	`mem£t
(
hdr
->
addr1
, 0, (hdr->addr1));

5648 
out
:

5649 
	`rcu_»ad_uÆock
();

5650  
skb
;

5651 
	}
}

5652 
EXPORT_SYMBOL
(
›“80211_´ob”e¥_g‘
);

5654 
sk_buff
 *
	$›“80211_g‘_fs_discov”y_tm¶
(
›“80211_hw
 *
hw
,

5655 
›“80211_vif
 *
vif
)

5657 
sk_buff
 *
skb
 = 
NULL
;

5658 
fs_discov”y_d©a
 *
tm¶
 = 
NULL
;

5659 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5661 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

5662  
NULL
;

5664 
	`rcu_»ad_lock
();

5665 
tm¶
 = 
	`rcu_d”eã»nû
(
sd©a
->
deæšk
.
u
.
­
.
fs_discov”y
);

5666 ià(!
tm¶
) {

5667 
	`rcu_»ad_uÆock
();

5668  
NULL
;

5671 
skb
 = 
	`dev_®loc_skb
(
sd©a
->
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
tm¶
->
Ën
);

5672 ià(
skb
) {

5673 
	`skb_»£rve
(
skb
, 
sd©a
->
loÿl
->
hw
.
exŒa_tx_h—droom
);

5674 
	`skb_put_d©a
(
skb
, 
tm¶
->
d©a
,m¶->
Ën
);

5677 
	`rcu_»ad_uÆock
();

5678  
skb
;

5679 
	}
}

5680 
EXPORT_SYMBOL
(
›“80211_g‘_fs_discov”y_tm¶
);

5682 
sk_buff
 *

5683 
	$›“80211_g‘_unsŞ_bÿ¡_´obe_»¥_tm¶
(
›“80211_hw
 *
hw
,

5684 
›“80211_vif
 *
vif
)

5686 
sk_buff
 *
skb
 = 
NULL
;

5687 
unsŞ_bÿ¡_´obe_»¥_d©a
 *
tm¶
 = 
NULL
;

5688 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5690 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
)

5691  
NULL
;

5693 
	`rcu_»ad_lock
();

5694 
tm¶
 = 
	`rcu_d”eã»nû
(
sd©a
->
deæšk
.
u
.
­
.
unsŞ_bÿ¡_´obe_»¥
);

5695 ià(!
tm¶
) {

5696 
	`rcu_»ad_uÆock
();

5697  
NULL
;

5700 
skb
 = 
	`dev_®loc_skb
(
sd©a
->
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
tm¶
->
Ën
);

5701 ià(
skb
) {

5702 
	`skb_»£rve
(
skb
, 
sd©a
->
loÿl
->
hw
.
exŒa_tx_h—droom
);

5703 
	`skb_put_d©a
(
skb
, 
tm¶
->
d©a
,m¶->
Ën
);

5706 
	`rcu_»ad_uÆock
();

5707  
skb
;

5708 
	}
}

5709 
EXPORT_SYMBOL
(
›“80211_g‘_unsŞ_bÿ¡_´obe_»¥_tm¶
);

5711 
sk_buff
 *
	$›“80211_p¥Şl_g‘
(
›“80211_hw
 *
hw
,

5712 
›“80211_vif
 *
vif
)

5714 
›“80211_sub_if_d©a
 *
sd©a
;

5715 
›“80211_p¥Şl
 *
p¥Şl
;

5716 
›“80211_loÿl
 *
loÿl
;

5717 
sk_buff
 *
skb
;

5719 ià(
	`WARN_ON
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_STATION
))

5720  
NULL
;

5722 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5723 
loÿl
 = 
sd©a
->local;

5725 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + (*
p¥Şl
));

5726 ià(!
skb
)

5727  
NULL
;

5729 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

5731 
p¥Şl
 = 
	`skb_put_z”o
(
skb
, (*pspoll));

5732 
p¥Şl
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_CTL
 |

5733 
IEEE80211_STYPE_PSPOLL
);

5734 
p¥Şl
->
aid
 = 
	`ıu_to_Ë16
(
sd©a
->
vif
.
cfg
.aid);

5737 
p¥Şl
->
aid
 |ğ
	`ıu_to_Ë16
(1 << 15 | 1 << 14);

5739 
	`memıy
(
p¥Şl
->
bssid
, 
sd©a
->
deæšk
.
u
.
mgd
.bssid, 
ETH_ALEN
);

5740 
	`memıy
(
p¥Şl
->

, 
vif
->
addr
, 
ETH_ALEN
);

5742  
skb
;

5743 
	}
}

5744 
EXPORT_SYMBOL
(
›“80211_p¥Şl_g‘
);

5746 
sk_buff
 *
	$›“80211_nuÎfunc_g‘
(
›“80211_hw
 *
hw
,

5747 
›“80211_vif
 *
vif
,

5748 
lšk_id
, 
boŞ
 
qos_ok
)

5750 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5751 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

5752 
›“80211_lšk_d©a
 *
lšk
 = 
NULL
;

5753 
›“80211_hdr_3addr
 *
nuÎfunc
;

5754 
sk_buff
 *
skb
;

5755 
boŞ
 
qos
 = 
çl£
;

5757 ià(
	`WARN_ON
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_STATION
))

5758  
NULL
;

5760 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 +

5761 (*
nuÎfunc
) + 2);

5762 ià(!
skb
)

5763  
NULL
;

5765 
	`rcu_»ad_lock
();

5766 ià(
qos_ok
) {

5767 
¡a_šfo
 *
¡a
;

5769 
¡a
 = 
	`¡a_šfo_g‘
(
sd©a
, 
vif
->
cfg
.
­_addr
);

5770 
qos
 = 
¡a
 && s->¡a.
wme
;

5773 ià(
lšk_id
 >= 0) {

5774 
lšk
 = 
	`rcu_d”eã»nû
(
sd©a
->lšk[
lšk_id
]);

5775 ià(
	`WARN_ON_ONCE
(!
lšk
)) {

5776 
	`rcu_»ad_uÆock
();

5777 
	`kä“_skb
(
skb
);

5778  
NULL
;

5782 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

5784 
nuÎfunc
 = 
	`skb_put_z”o
(
skb
, (*nullfunc));

5785 
nuÎfunc
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_DATA
 |

5786 
IEEE80211_STYPE_NULLFUNC
 |

5787 
IEEE80211_FCTL_TODS
);

5788 ià(
qos
) {

5789 
__Ë16
 
qoshdr
 = 
	`ıu_to_Ë16
(7);

5791 
	`BUILD_BUG_ON
((
IEEE80211_STYPE_QOS_NULLFUNC
 |

5792 
IEEE80211_STYPE_NULLFUNC
) !=

5793 
IEEE80211_STYPE_QOS_NULLFUNC
);

5794 
nuÎfunc
->
äame_cÚŒŞ
 |=

5795 
	`ıu_to_Ë16
(
IEEE80211_STYPE_QOS_NULLFUNC
);

5796 
skb
->
´iÜ™y
 = 7;

5797 
	`skb_£t_queue_m­pšg
(
skb
, 
IEEE80211_AC_VO
);

5798 
	`skb_put_d©a
(
skb
, &
qoshdr
, (qoshdr));

5801 ià(
lšk
) {

5802 
	`memıy
(
nuÎfunc
->
addr1
, 
lšk
->
cÚf
->
bssid
, 
ETH_ALEN
);

5803 
	`memıy
(
nuÎfunc
->
addr2
, 
lšk
->
cÚf
->
addr
, 
ETH_ALEN
);

5804 
	`memıy
(
nuÎfunc
->
addr3
, 
lšk
->
cÚf
->
bssid
, 
ETH_ALEN
);

5806 
	`memıy
(
nuÎfunc
->
addr1
, 
vif
->
cfg
.
­_addr
, 
ETH_ALEN
);

5807 
	`memıy
(
nuÎfunc
->
addr2
, 
vif
->
addr
, 
ETH_ALEN
);

5808 
	`memıy
(
nuÎfunc
->
addr3
, 
vif
->
cfg
.
­_addr
, 
ETH_ALEN
);

5810 
	`rcu_»ad_uÆock
();

5812  
skb
;

5813 
	}
}

5814 
EXPORT_SYMBOL
(
›“80211_nuÎfunc_g‘
);

5816 
sk_buff
 *
	$›“80211_´ob”eq_g‘
(
›“80211_hw
 *
hw
,

5817 cÚ¡ 
u8
 *
¤c_addr
,

5818 cÚ¡ 
u8
 *
ssid
, 
size_t
 
ssid_Ën
,

5819 
size_t
 
room
)

5821 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5822 
›“80211_hdr_3addr
 *
hdr
;

5823 
sk_buff
 *
skb
;

5824 
size_t
 
›_ssid_Ën
;

5825 
u8
 *
pos
;

5827 
›_ssid_Ën
 = 2 + 
ssid_Ën
;

5829 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + (*
hdr
) +

5830 
›_ssid_Ën
 + 
room
);

5831 ià(!
skb
)

5832  
NULL
;

5834 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

5836 
hdr
 = 
	`skb_put_z”o
(
skb
, (*hdr));

5837 
hdr
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

5838 
IEEE80211_STYPE_PROBE_REQ
);

5839 
	`‘h_brßdÿ¡_addr
(
hdr
->
addr1
);

5840 
	`memıy
(
hdr
->
addr2
, 
¤c_addr
, 
ETH_ALEN
);

5841 
	`‘h_brßdÿ¡_addr
(
hdr
->
addr3
);

5843 
pos
 = 
	`skb_put
(
skb
, 
›_ssid_Ën
);

5844 *
pos
++ = 
WLAN_EID_SSID
;

5845 *
pos
++ = 
ssid_Ën
;

5846 ià(
ssid_Ën
)

5847 
	`memıy
(
pos
, 
ssid
, 
ssid_Ën
);

5848 
pos
 +ğ
ssid_Ën
;

5850  
skb
;

5851 
	}
}

5852 
EXPORT_SYMBOL
(
›“80211_´ob”eq_g‘
);

5854 
	$›“80211_¹s_g‘
(
›“80211_hw
 *
hw
, 
›“80211_vif
 *
vif
,

5855 cÚ¡ *
äame
, 
size_t
 
äame_Ën
,

5856 cÚ¡ 
›“80211_tx_šfo
 *
äame_txùl
,

5857 
›“80211_¹s
 *
¹s
)

5859 cÚ¡ 
›“80211_hdr
 *
hdr
 = 
äame
;

5861 
¹s
->
äame_cÚŒŞ
 =

5862 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_CTL
 | 
IEEE80211_STYPE_RTS
);

5863 
¹s
->
du¿tiÚ
 = 
	`›“80211_¹s_du¿tiÚ
(
hw
, 
vif
, 
äame_Ën
,

5864 
äame_txùl
);

5865 
	`memıy
(
¹s
->
¿
, 
hdr
->
addr1
, (rts->ra));

5866 
	`memıy
(
¹s
->

, 
hdr
->
addr2
, (rts->ta));

5867 
	}
}

5868 
EXPORT_SYMBOL
(
›“80211_¹s_g‘
);

5870 
	$›“80211_ù¡o£lf_g‘
(
›“80211_hw
 *
hw
, 
›“80211_vif
 *
vif
,

5871 cÚ¡ *
äame
, 
size_t
 
äame_Ën
,

5872 cÚ¡ 
›“80211_tx_šfo
 *
äame_txùl
,

5873 
›“80211_ùs
 *
ùs
)

5875 cÚ¡ 
›“80211_hdr
 *
hdr
 = 
äame
;

5877 
ùs
->
äame_cÚŒŞ
 =

5878 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_CTL
 | 
IEEE80211_STYPE_CTS
);

5879 
ùs
->
du¿tiÚ
 = 
	`›“80211_ù¡o£lf_du¿tiÚ
(
hw
, 
vif
,

5880 
äame_Ën
, 
äame_txùl
);

5881 
	`memıy
(
ùs
->
¿
, 
hdr
->
addr1
, (cts->ra));

5882 
	}
}

5883 
EXPORT_SYMBOL
(
›“80211_ù¡o£lf_g‘
);

5885 
sk_buff
 *

5886 
	$›“80211_g‘_bufã»d_bc
(
›“80211_hw
 *
hw
,

5887 
›“80211_vif
 *
vif
)

5889 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

5890 
sk_buff
 *
skb
 = 
NULL
;

5891 
›“80211_tx_d©a
 
tx
;

5892 
›“80211_sub_if_d©a
 *
sd©a
;

5893 
ps_d©a
 *
ps
;

5894 
›“80211_tx_šfo
 *
šfo
;

5895 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

5897 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

5899 
	`rcu_»ad_lock
();

5900 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

5902 ià(!
chªùx_cÚf
)

5903 
out
;

5905 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

5906 
b—cÚ_d©a
 *
b—cÚ
 =

5907 
	`rcu_d”eã»nû
(
sd©a
->
deæšk
.
u
.
­
.
b—cÚ
);

5909 ià(!
b—cÚ
 || !b—cÚ->
h—d
)

5910 
out
;

5912 
ps
 = &
sd©a
->
u
.
­
.ps;

5913 } ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

5914 
ps
 = &
sd©a
->
u
.
mesh
.ps;

5916 
out
;

5919 ià(
ps
->
dtim_couÁ
 !ğ0 || !ps->
dtim_bc_mc
)

5920 
out
;

5923 
skb
 = 
	`skb_dequeue
(&
ps
->
bc_buf
);

5924 ià(!
skb
)

5925 
out
;

5926 
loÿl
->
tÙ®_ps_bufã»d
--;

5928 ià(!
	`skb_queue_em±y
(&
ps
->
bc_buf
è&& 
skb
->
Ën
 >= 2) {

5929 
›“80211_hdr
 *
hdr
 =

5930 (
›“80211_hdr
 *è
skb
->
d©a
;

5934 
hdr
->
äame_cÚŒŞ
 |=

5935 
	`ıu_to_Ë16
(
IEEE80211_FCTL_MOREDATA
);

5938 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

5939 
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
skb
->
dev
);

5940 ià(!
	`›“80211_tx_´•¬e
(
sd©a
, &
tx
, 
NULL
, 
skb
))

5942 
	`›“80211_ä“_txskb
(
hw
, 
skb
);

5945 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

5947 
tx
.
æags
 |ğ
IEEE80211_TX_PS_BUFFERED
;

5948 
šfo
->
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

5950 ià(
	`švoke_tx_hªdËrs
(&
tx
))

5951 
skb
 = 
NULL
;

5952 
out
:

5953 
	`rcu_»ad_uÆock
();

5955  
skb
;

5956 
	}
}

5957 
EXPORT_SYMBOL
(
›“80211_g‘_bufã»d_bc
);

5959 
	$›“80211_»£rve_tid
(
›“80211_¡a
 *
pub¡a
, 
u8
 
tid
)

5961 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

5962 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

5963 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

5964 
»t
;

5965 
u32
 
queues
;

5967 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

5970 
sd©a
->
vif
.
ty³
) {

5971 
NL80211_IFTYPE_STATION
:

5972 
NL80211_IFTYPE_AP
:

5973 
NL80211_IFTYPE_AP_VLAN
:

5976 
	`WARN_ON
(1);

5977  -
EINVAL
;

5980 ià(
	`WARN_ON
(
tid
 >ğ
IEEE80211_NUM_UPS
))

5981  -
EINVAL
;

5983 ià(
¡a
->
»£rved_tid
 =ğ
tid
) {

5984 
»t
 = 0;

5985 
out
;

5988 ià(
¡a
->
»£rved_tid
 !ğ
IEEE80211_TID_UNRESERVED
) {

5989 
	`sd©a_”r
(
sd©a
, "TID„eservation‡lready‡ctive\n");

5990 
»t
 = -
EALREADY
;

5991 
out
;

5994 
	`›“80211_¡İ_vif_queues
(
sd©a
->
loÿl
, sdata,

5995 
IEEE80211_QUEUE_STOP_REASON_RESERVE_TID
);

5997 
	`synchrÚize_Ãt
();

6000 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_AGGREGATION
)) {

6001 
	`£t_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

6002 
	`__›“80211_¡İ_tx_ba_£ssiÚ
(
¡a
, 
tid
,

6003 
AGG_STOP_LOCAL_REQUEST
);

6006 
queues
 = 
	`BIT
(
sd©a
->
vif
.
hw_queue
[
›“802_1d_to_ac
[
tid
]]);

6007 
	`__›“80211_æush_queues
(
loÿl
, 
sd©a
, 
queues
, 
çl£
);

6009 
¡a
->
»£rved_tid
 = 
tid
;

6011 
	`›“80211_wake_vif_queues
(
loÿl
, 
sd©a
,

6012 
IEEE80211_QUEUE_STOP_REASON_RESERVE_TID
);

6014 ià(
	`›“80211_hw_check
(&
loÿl
->
hw
, 
AMPDU_AGGREGATION
))

6015 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

6017 
»t
 = 0;

6018 
out
:

6019  
»t
;

6020 
	}
}

6021 
EXPORT_SYMBOL
(
›“80211_»£rve_tid
);

6023 
	$›“80211_uÄe£rve_tid
(
›“80211_¡a
 *
pub¡a
, 
u8
 
tid
)

6025 
¡a_šfo
 *
¡a
 = 
	`cÚš”_of
(
pub¡a
, sta_info, sta);

6026 
›“80211_sub_if_d©a
 *
sd©a
 = 
¡a
->sdata;

6028 
	`lockd•_as£¹_why
(
sd©a
->
loÿl
->
hw
.
why
);

6031 
sd©a
->
vif
.
ty³
) {

6032 
NL80211_IFTYPE_STATION
:

6033 
NL80211_IFTYPE_AP
:

6034 
NL80211_IFTYPE_AP_VLAN
:

6037 
	`WARN_ON
(1);

6041 ià(
tid
 !ğ
¡a
->
»£rved_tid
) {

6042 
	`sd©a_”r
(
sd©a
, "TIDØuÄe£rv(%dèi¢'ˆ»£rved\n", 
tid
);

6046 
¡a
->
»£rved_tid
 = 
IEEE80211_TID_UNRESERVED
;

6047 
	}
}

6048 
EXPORT_SYMBOL
(
›“80211_uÄe£rve_tid
);

6050 
	$__›“80211_tx_skb_tid_bªd
(
›“80211_sub_if_d©a
 *
sd©a
,

6051 
sk_buff
 *
skb
, 
tid
, 
lšk_id
,

6052 
Æ80211_bªd
 
bªd
)

6054 cÚ¡ 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

6055 
ac
 = 
	`›“80211_ac_äom_tid
(
tid
);

6056 
lšk
;

6058 
	`skb_»£t_mac_h—d”
(
skb
);

6059 
	`skb_£t_queue_m­pšg
(
skb
, 
ac
);

6060 
skb
->
´iÜ™y
 = 
tid
;

6062 
skb
->
dev
 = 
sd©a
->dev;

6064 
	`BUILD_BUG_ON
(
IEEE80211_LINK_UNSPECIFIED
 < 
IEEE80211_MLD_MAX_NUM_LINKS
);

6065 
	`BUILD_BUG_ON
(!
	`FIELD_FIT
(
IEEE80211_TX_CTRL_MLO_LINK
,

6066 
IEEE80211_LINK_UNSPECIFIED
));

6068 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

6069 
lšk
 = 0;

6070 } ià(
lšk_id
 >= 0) {

6071 
lšk
 = 
lšk_id
;

6072 } ià(
	`memcmp
(
sd©a
->
vif
.
addr
, 
hdr
->
addr2
, 
ETH_ALEN
) == 0) {

6074 
lšk
 = 
IEEE80211_LINK_UNSPECIFIED
;

6077 
	`rcu_»ad_lock
();

6078 
lšk
 = 0;†šk < 
	`ARRAY_SIZE
(
sd©a
->
vif
.
lšk_cÚf
);†ink++) {

6079 
›“80211_bss_cÚf
 *
lšk_cÚf
;

6081 
lšk_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.lšk_cÚf[
lšk
]);

6082 ià(!
lšk_cÚf
)

6084 ià(
	`memcmp
(
lšk_cÚf
->
addr
, 
hdr
->
addr2
, 
ETH_ALEN
) == 0)

6087 
	`rcu_»ad_uÆock
();

6089 ià(
	`WARN_ON_ONCE
(
lšk
 =ğ
	`ARRAY_SIZE
(
sd©a
->
vif
.
lšk_cÚf
)))

6090 
lšk
 = 
	`ffs
(
sd©a
->
vif
.
aùive_lšks
) - 1;

6093 
	`IEEE80211_SKB_CB
(
skb
)->
cÚŒŞ
.
æags
 |=

6094 
	`u32_’code_b™s
(
lšk
, 
IEEE80211_TX_CTRL_MLO_LINK
);

6101 
	`loÿl_bh_di§bË
();

6102 
	`IEEE80211_SKB_CB
(
skb
)->
bªd
 = band;

6103 
	`›“80211_xm™
(
sd©a
, 
NULL
, 
skb
);

6104 
	`loÿl_bh_’abË
();

6105 
	}
}

6107 
	$›“80211_tx_skb_tid
(
›“80211_sub_if_d©a
 *
sd©a
,

6108 
sk_buff
 *
skb
, 
tid
, 
lšk_id
)

6110 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

6111 
Æ80211_bªd
 
bªd
;

6113 
	`rcu_»ad_lock
();

6114 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

6115 
	`WARN_ON
(
lšk_id
 >= 0);

6116 
chªùx_cÚf
 =

6117 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.
chªùx_cÚf
);

6118 ià(
	`WARN_ON
(!
chªùx_cÚf
)) {

6119 
	`rcu_»ad_uÆock
();

6120 
	`kä“_skb
(
skb
);

6123 
bªd
 = 
chªùx_cÚf
->
def
.
chª
->band;

6125 
	`WARN_ON
(
lšk_id
 >= 0 &&

6126 !(
sd©a
->
vif
.
aùive_lšks
 & 
	`BIT
(
lšk_id
)));

6128 
bªd
 = 0;

6131 
	`__›“80211_tx_skb_tid_bªd
(
sd©a
, 
skb
, 
tid
, 
lšk_id
, 
bªd
);

6132 
	`rcu_»ad_uÆock
();

6133 
	}
}

6135 
	$›“80211_tx_cÚŒŞ_pÜt
(
why
 *why, 
Ãt_deviû
 *
dev
,

6136 cÚ¡ 
u8
 *
buf
, 
size_t
 
Ën
,

6137 cÚ¡ 
u8
 *
de¡
, 
__be16
 
´Ùo
, 
boŞ
 
uÃnüy±ed
,

6138 
lšk_id
, 
u64
 *
cook›
)

6140 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

6141 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

6142 
¡a_šfo
 *
¡a
;

6143 
sk_buff
 *
skb
;

6144 
‘hhdr
 *
ehdr
;

6145 
u32
 
ù¾_æags
 = 0;

6146 
u32
 
æags
 = 0;

6147 
”r
;

6150 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

6155 ià(
´Ùo
 !ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
 &&

6156 
´Ùo
 !ğ
	`ıu_to_be16
(
ETH_P_PREAUTH
))

6157  -
EINVAL
;

6159 ià(
´Ùo
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
)

6160 
ù¾_æags
 |ğ
IEEE80211_TX_CTRL_PORT_CTRL_PROTO
 |

6161 
IEEE80211_TX_CTRL_SKIP_MPATH_LOOKUP
;

6163 ià(
uÃnüy±ed
)

6164 
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

6166 ià(
cook›
)

6167 
ù¾_æags
 |ğ
IEEE80211_TX_CTL_REQ_TX_STATUS
;

6169 
æags
 |ğ
IEEE80211_TX_INTFL_NL80211_FRAME_TX
;

6171 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 +

6172 (
‘hhdr
è+ 
Ën
);

6173 ià(!
skb
)

6174  -
ENOMEM
;

6176 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
 + (
‘hhdr
));

6178 
	`skb_put_d©a
(
skb
, 
buf
, 
Ën
);

6180 
ehdr
 = 
	`skb_push
(
skb
, (
‘hhdr
));

6181 
	`memıy
(
ehdr
->
h_de¡
, 
de¡
, 
ETH_ALEN
);

6184 ià(
lšk_id
 < 0) {

6185 
ù¾_æags
 |ğ
	`u32_’code_b™s
(
IEEE80211_LINK_UNSPECIFIED
,

6186 
IEEE80211_TX_CTRL_MLO_LINK
);

6187 
	`memıy
(
ehdr
->
h_sourû
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

6189 
›“80211_bss_cÚf
 *
lšk_cÚf
;

6191 
ù¾_æags
 |ğ
	`u32_’code_b™s
(
lšk_id
,

6192 
IEEE80211_TX_CTRL_MLO_LINK
);

6194 
	`rcu_»ad_lock
();

6195 
lšk_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.lšk_cÚf[
lšk_id
]);

6196 ià(!
lšk_cÚf
) {

6197 
	`dev_kä“_skb
(
skb
);

6198 
	`rcu_»ad_uÆock
();

6199  -
ENOLINK
;

6201 
	`memıy
(
ehdr
->
h_sourû
, 
lšk_cÚf
->
addr
, 
ETH_ALEN
);

6202 
	`rcu_»ad_uÆock
();

6205 
ehdr
->
h_´Ùo
 = 
´Ùo
;

6207 
skb
->
dev
 = dev;

6208 
skb
->
´ÙocŞ
 = 
´Ùo
;

6209 
	`skb_»£t_ÃtwÜk_h—d”
(
skb
);

6210 
	`skb_»£t_mac_h—d”
(
skb
);

6212 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

6213 
¡¬t_xm™
;

6219 
	`rcu_»ad_lock
();

6220 
”r
 = 
	`›“80211_lookup_¿_¡a
(
sd©a
, 
skb
, &
¡a
);

6221 ià(
”r
) {

6222 
	`dev_kä“_skb
(
skb
);

6223 
	`rcu_»ad_uÆock
();

6224  
”r
;

6227 ià(!
	`IS_ERR
(
¡a
)) {

6228 
u16
 
queue
 = 
	`›“80211_£Ëù_queue
(
sd©a
, 
¡a
, 
skb
);

6230 
	`skb_£t_queue_m­pšg
(
skb
, 
queue
);

6236 ià(
¡a
 && s->¡a.
mlo
)

6237 
	`memıy
(
ehdr
->
h_sourû
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

6239 
	`rcu_»ad_uÆock
();

6241 
¡¬t_xm™
:

6242 
	`loÿl_bh_di§bË
();

6243 
	`__›“80211_subif_¡¬t_xm™
(
skb
, skb->
dev
, 
æags
, 
ù¾_æags
, 
cook›
);

6244 
	`loÿl_bh_’abË
();

6247 
	}
}

6249 
	$›“80211_´obe_mesh_lšk
(
why
 *why, 
Ãt_deviû
 *
dev
,

6250 cÚ¡ 
u8
 *
buf
, 
size_t
 
Ën
)

6252 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_DEV_TO_SUB_IF
(
dev
);

6253 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

6254 
sk_buff
 *
skb
;

6256 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
Ën
 +

6259 ià(!
skb
)

6260  -
ENOMEM
;

6262 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

6263 
	`skb_put_d©a
(
skb
, 
buf
, 
Ën
);

6265 
skb
->
dev
 = dev;

6266 
skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_3
);

6267 
	`skb_»£t_ÃtwÜk_h—d”
(
skb
);

6268 
	`skb_»£t_mac_h—d”
(
skb
);

6270 
	`loÿl_bh_di§bË
();

6271 
	`__›“80211_subif_¡¬t_xm™
(
skb
, skb->
dev
, 0,

6272 
IEEE80211_TX_CTRL_SKIP_MPATH_LOOKUP
,

6273 
NULL
);

6274 
	`loÿl_bh_’abË
();

6277 
	}
}

	@util.c

14 
	~<Ãt/mac80211.h
>

15 
	~<lšux/Ãtdeviû.h
>

16 
	~<lšux/expÜt.h
>

17 
	~<lšux/ty³s.h
>

18 
	~<lšux/¦ab.h
>

19 
	~<lšux/skbuff.h
>

20 
	~<lšux/‘h”deviû.h
>

21 
	~<lšux/if_¬p.h
>

22 
	~<lšux/b™m­.h
>

23 
	~<lšux/üc32.h
>

24 
	~<Ãt/Ãt_Çme¥aû.h
>

25 
	~<Ãt/cfg80211.h
>

26 
	~<Ãt/¹Ãšk.h
>

27 
	~<kun™/visib™y.h
>

29 
	~"›“80211_i.h
"

30 
	~"driv”-İs.h
"

31 
	~"¿‹.h
"

32 
	~"mesh.h
"

33 
	~"wme.h
"

34 
	~"Ëd.h
"

35 
	~"w•.h
"

38 cÚ¡ *cÚ¡ 
	gmac80211_why_´ivid
 = &
mac80211_why_´ivid
;

40 
›“80211_hw
 *
	$why_to_›“80211_hw
(
why
 *wiphy)

42 
›“80211_loÿl
 *
loÿl
;

44 
loÿl
 = 
	`why_´iv
(
why
);

45  &
loÿl
->
hw
;

46 
	}
}

47 
EXPORT_SYMBOL
(
why_to_›“80211_hw
);

49 cÚ¡ 
›“80211_cÚn_£‰šgs
 
	g›“80211_cÚn_£‰šgs_uÆim™ed
 = {

50 .
mode
 = 
IEEE80211_CONN_MODE_EHT
,

51 .
	gbw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_320
,

54 
u8
 *
	$›“80211_g‘_bssid
(
›“80211_hdr
 *
hdr
, 
size_t
 
Ën
,

55 
Æ80211_iáy³
 
ty³
)

57 
__Ë16
 
fc
 = 
hdr
->
äame_cÚŒŞ
;

59 ià(
	`›“80211_is_d©a
(
fc
)) {

60 ià(
Ën
 < 24)

61  
NULL
;

63 ià(
	`›“80211_has_a4
(
fc
))

64  
NULL
;

65 ià(
	`›“80211_has_tods
(
fc
))

66  
hdr
->
addr1
;

67 ià(
	`›“80211_has_äomds
(
fc
))

68  
hdr
->
addr2
;

70  
hdr
->
addr3
;

73 ià(
	`›“80211_is_s1g_b—cÚ
(
fc
)) {

74 
›“80211_ext
 *
ext
 = (*è
hdr
;

76  
ext
->
u
.
s1g_b—cÚ
.
§
;

79 ià(
	`›“80211_is_mgmt
(
fc
)) {

80 ià(
Ën
 < 24)

81  
NULL
;

82  
hdr
->
addr3
;

85 ià(
	`›“80211_is_ùl
(
fc
)) {

86 ià(
	`›“80211_is_p¥Şl
(
fc
))

87  
hdr
->
addr1
;

89 ià(
	`›“80211_is_back_»q
(
fc
)) {

90 
ty³
) {

91 
NL80211_IFTYPE_STATION
:

92  
hdr
->
addr2
;

93 
NL80211_IFTYPE_AP
:

94 
NL80211_IFTYPE_AP_VLAN
:

95  
hdr
->
addr1
;

102  
NULL
;

103 
	}
}

104 
EXPORT_SYMBOL
(
›“80211_g‘_bssid
);

106 
	$›“80211_tx_£t_´Ùeùed
(
›“80211_tx_d©a
 *
tx
)

108 
sk_buff
 *
skb
;

109 
›“80211_hdr
 *
hdr
;

111 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

112 
hdr
 = (
›“80211_hdr
 *è
skb
->
d©a
;

113 
hdr
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

115 
	}
}

117 
	$›“80211_äame_du¿tiÚ
(
Æ80211_bªd
 
bªd
, 
size_t
 
Ën
,

118 
¿‹
, 
”p
, 
shÜt_´—mbË
)

120 
dur
;

131 ià(
bªd
 =ğ
NL80211_BAND_5GHZ
 || 
”p
) {

145 
dur
 = 16;

146 
dur
 += 16;

147 
dur
 += 4;

152 
dur
 +ğ4 * 
	`DIV_ROUND_UP
((16 + 8 * (
Ën
 + 4) + 6) * 10,

153 4 * 
¿‹
);

165 
dur
 = 10;

166 
dur
 +ğ
shÜt_´—mbË
 ? (72 + 24) : (144 + 48);

168 
dur
 +ğ
	`DIV_ROUND_UP
(8 * (
Ën
 + 4è* 10, 
¿‹
);

171  
dur
;

172 
	}
}

175 
__Ë16
 
	$›“80211_g’”ic_äame_du¿tiÚ
(
›“80211_hw
 *
hw
,

176 
›“80211_vif
 *
vif
,

177 
Æ80211_bªd
 
bªd
,

178 
size_t
 
äame_Ën
,

179 
›“80211_¿‹
 *
¿‹
)

181 
›“80211_sub_if_d©a
 *
sd©a
;

182 
u16
 
dur
;

183 
”p
;

184 
boŞ
 
shÜt_´—mbË
 = 
çl£
;

186 
”p
 = 0;

187 ià(
vif
) {

188 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

189 
shÜt_´—mbË
 = 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
;

190 ià(
sd©a
->
deæšk
.
İ”©šg_11g_mode
)

191 
”p
 = 
¿‹
->
æags
 & 
IEEE80211_RATE_ERP_G
;

194 
dur
 = 
	`›“80211_äame_du¿tiÚ
(
bªd
, 
äame_Ën
, 
¿‹
->
b™¿‹
, 
”p
,

195 
shÜt_´—mbË
);

197  
	`ıu_to_Ë16
(
dur
);

198 
	}
}

199 
EXPORT_SYMBOL
(
›“80211_g’”ic_äame_du¿tiÚ
);

201 
__Ë16
 
	$›“80211_¹s_du¿tiÚ
(
›“80211_hw
 *
hw
,

202 
›“80211_vif
 *
vif
, 
size_t
 
äame_Ën
,

203 cÚ¡ 
›“80211_tx_šfo
 *
äame_txùl
)

205 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

206 
›“80211_¿‹
 *
¿‹
;

207 
›“80211_sub_if_d©a
 *
sd©a
;

208 
boŞ
 
shÜt_´—mbË
;

209 
”p
, 
b™¿‹
;

210 
u16
 
dur
;

211 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

213 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
äame_txùl
->
bªd
];

215 
shÜt_´—mbË
 = 
çl£
;

217 
¿‹
 = &
sbªd
->
b™¿‹s
[
äame_txùl
->
cÚŒŞ
.
¹s_ùs_¿‹_idx
];

219 
”p
 = 0;

220 ià(
vif
) {

221 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

222 
shÜt_´—mbË
 = 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
;

223 ià(
sd©a
->
deæšk
.
İ”©šg_11g_mode
)

224 
”p
 = 
¿‹
->
æags
 & 
IEEE80211_RATE_ERP_G
;

227 
b™¿‹
 = 
¿‹
->bitrate;

230 
dur
 = 
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 10, 
b™¿‹
,

231 
”p
, 
shÜt_´—mbË
);

233 
dur
 +ğ
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 
äame_Ën
, 
b™¿‹
,

234 
”p
, 
shÜt_´—mbË
);

236 
dur
 +ğ
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 10, 
b™¿‹
,

237 
”p
, 
shÜt_´—mbË
);

239  
	`ıu_to_Ë16
(
dur
);

240 
	}
}

241 
EXPORT_SYMBOL
(
›“80211_¹s_du¿tiÚ
);

243 
__Ë16
 
	$›“80211_ù¡o£lf_du¿tiÚ
(
›“80211_hw
 *
hw
,

244 
›“80211_vif
 *
vif
,

245 
size_t
 
äame_Ën
,

246 cÚ¡ 
›“80211_tx_šfo
 *
äame_txùl
)

248 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

249 
›“80211_¿‹
 *
¿‹
;

250 
›“80211_sub_if_d©a
 *
sd©a
;

251 
boŞ
 
shÜt_´—mbË
;

252 
”p
, 
b™¿‹
;

253 
u16
 
dur
;

254 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

256 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
äame_txùl
->
bªd
];

258 
shÜt_´—mbË
 = 
çl£
;

260 
¿‹
 = &
sbªd
->
b™¿‹s
[
äame_txùl
->
cÚŒŞ
.
¹s_ùs_¿‹_idx
];

261 
”p
 = 0;

262 ià(
vif
) {

263 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

264 
shÜt_´—mbË
 = 
sd©a
->
vif
.
bss_cÚf
.
u£_shÜt_´—mbË
;

265 ià(
sd©a
->
deæšk
.
İ”©šg_11g_mode
)

266 
”p
 = 
¿‹
->
æags
 & 
IEEE80211_RATE_ERP_G
;

269 
b™¿‹
 = 
¿‹
->bitrate;

272 
dur
 = 
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 
äame_Ën
, 
b™¿‹
,

273 
”p
, 
shÜt_´—mbË
);

274 ià(!(
äame_txùl
->
æags
 & 
IEEE80211_TX_CTL_NO_ACK
)) {

276 
dur
 +ğ
	`›“80211_äame_du¿tiÚ
(
sbªd
->
bªd
, 10, 
b™¿‹
,

277 
”p
, 
shÜt_´—mbË
);

280  
	`ıu_to_Ë16
(
dur
);

281 
	}
}

282 
EXPORT_SYMBOL
(
›“80211_ù¡o£lf_du¿tiÚ
);

284 
	$wake_tx_push_queue
(
›“80211_loÿl
 *
loÿl
,

285 
›“80211_sub_if_d©a
 *
sd©a
,

286 
›“80211_txq
 *
queue
)

288 
›“80211_tx_cÚŒŞ
 
cÚŒŞ
 = {

289 .
¡a
 = 
queue
->sta,

291 
sk_buff
 *
skb
;

294 
skb
 = 
	`›“80211_tx_dequeue
(&
loÿl
->
hw
, 
queue
);

295 ià(!
skb
)

298 
	`drv_tx
(
loÿl
, &
cÚŒŞ
, 
skb
);

300 
	}
}

303 
	$›“80211_hªdË_wake_tx_queue
(
›“80211_hw
 *
hw
,

304 
›“80211_txq
 *
txq
)

306 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

307 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
txq
->
vif
);

308 
›“80211_txq
 *
queue
;

310 
	`¥š_lock
(&
loÿl
->
hªdË_wake_tx_queue_lock
);

313 
	`›“80211_txq_scheduË_¡¬t
(
hw
, 
txq
->
ac
);

314 (
queue
 = 
	`›“80211_Ãxt_txq
(
hw
, 
txq
->
ac
))) {

315 
	`wake_tx_push_queue
(
loÿl
, 
sd©a
, 
queue
);

316 
	`›“80211_»tuº_txq
(
hw
, 
queue
, 
çl£
);

318 
	`›“80211_txq_scheduË_’d
(
hw
, 
txq
->
ac
);

319 
	`¥š_uÆock
(&
loÿl
->
hªdË_wake_tx_queue_lock
);

320 
	}
}

321 
EXPORT_SYMBOL
(
›“80211_hªdË_wake_tx_queue
);

323 
	$__›“80211_wake_txqs
(
›“80211_sub_if_d©a
 *
sd©a
, 
ac
)

325 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

326 
›“80211_vif
 *
vif
 = &
sd©a
->vif;

327 
fq
 *fq = &
loÿl
->fq;

328 
ps_d©a
 *
ps
 = 
NULL
;

329 
txq_šfo
 *
txqi
;

330 
¡a_šfo
 *
¡a
;

331 
i
;

333 
	`loÿl_bh_di§bË
();

334 
	`¥š_lock
(&
fq
->
lock
);

336 ià(!
	`‹¡_b™
(
SDATA_STATE_RUNNING
, &
sd©a
->
¡©e
))

337 
out
;

339 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

340 
ps
 = &
sd©a
->
bss
->ps;

342 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

343 ià(
sd©a
 !ğ
¡a
->sdata)

346 
i
 = 0; i < 
	`ARRAY_SIZE
(
¡a
->¡a.
txq
); i++) {

347 
›“80211_txq
 *
txq
 = 
¡a
->¡a.txq[
i
];

349 ià(!
txq
)

352 
txqi
 = 
	`to_txq_šfo
(
txq
);

354 ià(
ac
 !ğ
txq
->ac)

357 ià(!
	`‹¡_ªd_ş—r_b™
(
IEEE80211_TXQ_DIRTY
,

358 &
txqi
->
æags
))

361 
	`¥š_uÆock
(&
fq
->
lock
);

362 
	`drv_wake_tx_queue
(
loÿl
, 
txqi
);

363 
	`¥š_lock
(&
fq
->
lock
);

367 ià(!
vif
->
txq
)

368 
out
;

370 
txqi
 = 
	`to_txq_šfo
(
vif
->
txq
);

372 ià(!
	`‹¡_ªd_ş—r_b™
(
IEEE80211_TXQ_DIRTY
, &
txqi
->
æags
) ||

373 (
ps
 && 
	`©omic_»ad
(&ps->
num_¡a_ps
)è|| 
ac
 !ğ
vif
->
txq
->ac)

374 
out
;

376 
	`¥š_uÆock
(&
fq
->
lock
);

378 
	`drv_wake_tx_queue
(
loÿl
, 
txqi
);

379 
	`loÿl_bh_’abË
();

381 
out
:

382 
	`¥š_uÆock
(&
fq
->
lock
);

383 
	`loÿl_bh_’abË
();

384 
	}
}

387 
__»Ëa£s
(&
loÿl
->
queue_¡İ_»asÚ_lock
)

388 
__acquœes
(&
loÿl
->
queue_¡İ_»asÚ_lock
)

389 
	$_›“80211_wake_txqs
(
›“80211_loÿl
 *
loÿl
, *
æags
)

391 
›“80211_sub_if_d©a
 *
sd©a
;

392 
n_acs
 = 
IEEE80211_NUM_ACS
;

393 
i
;

395 
	`rcu_»ad_lock
();

397 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

398 
n_acs
 = 1;

400 
i
 = 0; i < 
loÿl
->
hw
.
queues
; i++) {

401 ià(
loÿl
->
queue_¡İ_»asÚs
[
i
])

404 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, *
æags
);

405 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

406 
ac
;

408 
ac
 = 0;‡ø< 
n_acs
;‡c++) {

409 
ac_queue
 = 
sd©a
->
vif
.
hw_queue
[
ac
];

411 ià(
ac_queue
 =ğ
i
 ||

412 
sd©a
->
vif
.
ÿb_queue
 =ğ
i
)

413 
	`__›“80211_wake_txqs
(
sd©a
, 
ac
);

416 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, *
æags
);

419 
	`rcu_»ad_uÆock
();

420 
	}
}

422 
	$›“80211_wake_txqs
(
skËt_¡ruù
 *
t
)

424 
›“80211_loÿl
 *
loÿl
 = 
	`äom_skËt
Öoÿl, 
t
,

425 
wake_txqs_skËt
);

426 
æags
;

428 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

429 
	`_›“80211_wake_txqs
(
loÿl
, &
æags
);

430 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

431 
	}
}

433 
	$__›“80211_wake_queue
(
›“80211_hw
 *
hw
, 
queue
,

434 
queue_¡İ_»asÚ
 
»asÚ
,

435 
boŞ
 
»fcouÁed
,

436 *
æags
)

438 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

440 
	`Œaû_wake_queue
(
loÿl
, 
queue
, 
»asÚ
);

442 ià(
	`WARN_ON
(
queue
 >ğ
hw
->
queues
))

445 ià(!
	`‹¡_b™
(
»asÚ
, &
loÿl
->
queue_¡İ_»asÚs
[
queue
]))

448 ià(!
»fcouÁed
) {

449 
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
] = 0;

451 
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
]--;

452 ià(
	`WARN_ON
(
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
] < 0))

453 
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
] = 0;

456 ià(
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
] == 0)

457 
	`__ş—r_b™
(
»asÚ
, &
loÿl
->
queue_¡İ_»asÚs
[
queue
]);

459 ià(
loÿl
->
queue_¡İ_»asÚs
[
queue
] != 0)

463 ià(!
	`skb_queue_em±y
(&
loÿl
->
³ndšg
[
queue
]))

464 
	`skËt_scheduË
(&
loÿl
->
tx_³ndšg_skËt
);

473 ià(
»asÚ
 =ğ
IEEE80211_QUEUE_STOP_REASON_DRIVER
)

474 
	`skËt_scheduË
(&
loÿl
->
wake_txqs_skËt
);

476 
	`_›“80211_wake_txqs
(
loÿl
, 
æags
);

477 
	}
}

479 
	$›“80211_wake_queue_by_»asÚ
(
›“80211_hw
 *
hw
, 
queue
,

480 
queue_¡İ_»asÚ
 
»asÚ
,

481 
boŞ
 
»fcouÁed
)

483 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

484 
æags
;

486 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

487 
	`__›“80211_wake_queue
(
hw
, 
queue
, 
»asÚ
, 
»fcouÁed
, &
æags
);

488 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

489 
	}
}

491 
	$›“80211_wake_queue
(
›“80211_hw
 *
hw
, 
queue
)

493 
	`›“80211_wake_queue_by_»asÚ
(
hw
, 
queue
,

494 
IEEE80211_QUEUE_STOP_REASON_DRIVER
,

495 
çl£
);

496 
	}
}

497 
EXPORT_SYMBOL
(
›“80211_wake_queue
);

499 
	$__›“80211_¡İ_queue
(
›“80211_hw
 *
hw
, 
queue
,

500 
queue_¡İ_»asÚ
 
»asÚ
,

501 
boŞ
 
»fcouÁed
)

503 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

505 
	`Œaû_¡İ_queue
(
loÿl
, 
queue
, 
»asÚ
);

507 ià(
	`WARN_ON
(
queue
 >ğ
hw
->
queues
))

510 ià(!
»fcouÁed
)

511 
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
] = 1;

513 
loÿl
->
q_¡İ_»asÚs
[
queue
][
»asÚ
]++;

515 
	`£t_b™
(
»asÚ
, &
loÿl
->
queue_¡İ_»asÚs
[
queue
]);

516 
	}
}

518 
	$›“80211_¡İ_queue_by_»asÚ
(
›“80211_hw
 *
hw
, 
queue
,

519 
queue_¡İ_»asÚ
 
»asÚ
,

520 
boŞ
 
»fcouÁed
)

522 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

523 
æags
;

525 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

526 
	`__›“80211_¡İ_queue
(
hw
, 
queue
, 
»asÚ
, 
»fcouÁed
);

527 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

528 
	}
}

530 
	$›“80211_¡İ_queue
(
›“80211_hw
 *
hw
, 
queue
)

532 
	`›“80211_¡İ_queue_by_»asÚ
(
hw
, 
queue
,

533 
IEEE80211_QUEUE_STOP_REASON_DRIVER
,

534 
çl£
);

535 
	}
}

536 
EXPORT_SYMBOL
(
›“80211_¡İ_queue
);

538 
	$›“80211_add_³ndšg_skb
(
›“80211_loÿl
 *
loÿl
,

539 
sk_buff
 *
skb
)

541 
›“80211_hw
 *
hw
 = &
loÿl
->hw;

542 
æags
;

543 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

544 
queue
 = 
šfo
->
hw_queue
;

546 ià(
	`WARN_ON
(!
šfo
->
cÚŒŞ
.
vif
)) {

547 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

551 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

552 
	`__›“80211_¡İ_queue
(
hw
, 
queue
, 
IEEE80211_QUEUE_STOP_REASON_SKB_ADD
,

553 
çl£
);

554 
	`__skb_queue_
(&
loÿl
->
³ndšg
[
queue
], 
skb
);

555 
	`__›“80211_wake_queue
(
hw
, 
queue
, 
IEEE80211_QUEUE_STOP_REASON_SKB_ADD
,

556 
çl£
, &
æags
);

557 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

558 
	}
}

560 
	$›“80211_add_³ndšg_skbs
(
›“80211_loÿl
 *
loÿl
,

561 
sk_buff_h—d
 *
skbs
)

563 
›“80211_hw
 *
hw
 = &
loÿl
->hw;

564 
sk_buff
 *
skb
;

565 
æags
;

566 
queue
, 
i
;

568 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

569 (
skb
 = 
	`skb_dequeue
(
skbs
))) {

570 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

572 ià(
	`WARN_ON
(!
šfo
->
cÚŒŞ
.
vif
)) {

573 
	`›“80211_ä“_txskb
(&
loÿl
->
hw
, 
skb
);

577 
queue
 = 
šfo
->
hw_queue
;

579 
	`__›“80211_¡İ_queue
(
hw
, 
queue
,

580 
IEEE80211_QUEUE_STOP_REASON_SKB_ADD
,

581 
çl£
);

583 
	`__skb_queue_
(&
loÿl
->
³ndšg
[
queue
], 
skb
);

586 
i
 = 0; i < 
hw
->
queues
; i++)

587 
	`__›“80211_wake_queue
(
hw
, 
i
,

588 
IEEE80211_QUEUE_STOP_REASON_SKB_ADD
,

589 
çl£
, &
æags
);

590 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

591 
	}
}

593 
	$›“80211_¡İ_queues_by_»asÚ
(
›“80211_hw
 *
hw
,

594 
queues
,

595 
queue_¡İ_»asÚ
 
»asÚ
,

596 
boŞ
 
»fcouÁed
)

598 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

599 
æags
;

600 
i
;

602 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

604 
	`fÜ_—ch_£t_b™
(
i
, &
queues
, 
hw
->queues)

605 
	`__›“80211_¡İ_queue
(
hw
, 
i
, 
»asÚ
, 
»fcouÁed
);

607 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

608 
	}
}

610 
	$›“80211_¡İ_queues
(
›“80211_hw
 *
hw
)

612 
	`›“80211_¡İ_queues_by_»asÚ
(
hw
, 
IEEE80211_MAX_QUEUE_MAP
,

613 
IEEE80211_QUEUE_STOP_REASON_DRIVER
,

614 
çl£
);

615 
	}
}

616 
EXPORT_SYMBOL
(
›“80211_¡İ_queues
);

618 
	$›“80211_queue_¡İ³d
(
›“80211_hw
 *
hw
, 
queue
)

620 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

621 
æags
;

622 
»t
;

624 ià(
	`WARN_ON
(
queue
 >ğ
hw
->
queues
))

625  
Œue
;

627 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

628 
»t
 = 
	`‹¡_b™
(
IEEE80211_QUEUE_STOP_REASON_DRIVER
,

629 &
loÿl
->
queue_¡İ_»asÚs
[
queue
]);

630 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

631  
»t
;

632 
	}
}

633 
EXPORT_SYMBOL
(
›“80211_queue_¡İ³d
);

635 
	$›“80211_wake_queues_by_»asÚ
(
›“80211_hw
 *
hw
,

636 
queues
,

637 
queue_¡İ_»asÚ
 
»asÚ
,

638 
boŞ
 
»fcouÁed
)

640 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

641 
æags
;

642 
i
;

644 
	`¥š_lock_œq§ve
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

646 
	`fÜ_—ch_£t_b™
(
i
, &
queues
, 
hw
->queues)

647 
	`__›“80211_wake_queue
(
hw
, 
i
, 
»asÚ
, 
»fcouÁed
, &
æags
);

649 
	`¥š_uÆock_œq»¡Üe
(&
loÿl
->
queue_¡İ_»asÚ_lock
, 
æags
);

650 
	}
}

652 
	$›“80211_wake_queues
(
›“80211_hw
 *
hw
)

654 
	`›“80211_wake_queues_by_»asÚ
(
hw
, 
IEEE80211_MAX_QUEUE_MAP
,

655 
IEEE80211_QUEUE_STOP_REASON_DRIVER
,

656 
çl£
);

657 
	}
}

658 
EXPORT_SYMBOL
(
›“80211_wake_queues
);

661 
	$›“80211_g‘_vif_queues
(
›“80211_loÿl
 *
loÿl
,

662 
›“80211_sub_if_d©a
 *
sd©a
)

664 
queues
;

666 ià(
sd©a
 && 
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
)) {

667 
ac
;

669 
queues
 = 0;

671 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++)

672 
queues
 |ğ
	`BIT
(
sd©a
->
vif
.
hw_queue
[
ac
]);

673 ià(
sd©a
->
vif
.
ÿb_queue
 !ğ
IEEE80211_INVAL_HW_QUEUE
)

674 
queues
 |ğ
	`BIT
(
sd©a
->
vif
.
ÿb_queue
);

677 
queues
 = 
	`BIT
(
loÿl
->
hw
.queues) - 1;

680  
queues
;

681 
	}
}

683 
	$__›“80211_æush_queues
(
›“80211_loÿl
 *
loÿl
,

684 
›“80211_sub_if_d©a
 *
sd©a
,

685 
queues
, 
boŞ
 
drİ
)

687 ià(!
loÿl
->
İs
->
æush
)

694 ià(!
queues
 || !
	`›“80211_hw_check
(&
loÿl
->
hw
, 
QUEUE_CONTROL
))

695 
queues
 = 
	`›“80211_g‘_vif_queues
(
loÿl
, 
sd©a
);

697 
	`›“80211_¡İ_queues_by_»asÚ
(&
loÿl
->
hw
, 
queues
,

698 
IEEE80211_QUEUE_STOP_REASON_FLUSH
,

699 
çl£
);

701 ià(
drİ
) {

702 
¡a_šfo
 *
¡a
;

707 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

708 ià(
sd©a
 !ğ
¡a
->sdata)

710 
	`›“80211_purge_¡a_txqs
(
¡a
);

714 
	`drv_æush
(
loÿl
, 
sd©a
, 
queues
, 
drİ
);

716 
	`›“80211_wake_queues_by_»asÚ
(&
loÿl
->
hw
, 
queues
,

717 
IEEE80211_QUEUE_STOP_REASON_FLUSH
,

718 
çl£
);

719 
	}
}

721 
	$›“80211_æush_queues
(
›“80211_loÿl
 *
loÿl
,

722 
›“80211_sub_if_d©a
 *
sd©a
, 
boŞ
 
drİ
)

724 
	`__›“80211_æush_queues
(
loÿl
, 
sd©a
, 0, 
drİ
);

725 
	}
}

727 
	$›“80211_¡İ_vif_queues
(
›“80211_loÿl
 *
loÿl
,

728 
›“80211_sub_if_d©a
 *
sd©a
,

729 
queue_¡İ_»asÚ
 
»asÚ
)

731 
	`›“80211_¡İ_queues_by_»asÚ
(&
loÿl
->
hw
,

732 
	`›“80211_g‘_vif_queues
(
loÿl
, 
sd©a
),

733 
»asÚ
, 
Œue
);

734 
	}
}

736 
	$›“80211_wake_vif_queues
(
›“80211_loÿl
 *
loÿl
,

737 
›“80211_sub_if_d©a
 *
sd©a
,

738 
queue_¡İ_»asÚ
 
»asÚ
)

740 
	`›“80211_wake_queues_by_»asÚ
(&
loÿl
->
hw
,

741 
	`›“80211_g‘_vif_queues
(
loÿl
, 
sd©a
),

742 
»asÚ
, 
Œue
);

743 
	}
}

745 
	$__™”©e_š‹rçûs
(
›“80211_loÿl
 *
loÿl
,

746 
u32
 
™”_æags
,

747 (*
™”©Ü
)(*
d©a
, 
u8
 *
mac
,

748 
›“80211_vif
 *
vif
),

749 *
d©a
)

751 
›“80211_sub_if_d©a
 *
sd©a
;

752 
boŞ
 
aùive_Úly
 = 
™”_æags
 & 
IEEE80211_IFACE_ITER_ACTIVE
;

754 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

755 
sd©a
->
vif
.
ty³
) {

756 
NL80211_IFTYPE_MONITOR
:

757 ià(!(
sd©a
->
u
.
mÁr
.
æags
 & 
MONITOR_FLAG_ACTIVE
))

760 
NL80211_IFTYPE_AP_VLAN
:

765 ià(!(
™”_æags
 & 
IEEE80211_IFACE_ITER_RESUME_ALL
) &&

766 
aùive_Úly
 && !(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
))

768 ià((
™”_æags
 & 
IEEE80211_IFACE_SKIP_SDATA_NOT_IN_DRIVER
) &&

769 !(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
))

771 ià(
	`›“80211_sd©a_ruÂšg
(
sd©a
è|| !
aùive_Úly
)

772 
	`™”©Ü
(
d©a
, 
sd©a
->
vif
.
addr
,

773 &
sd©a
->
vif
);

776 
sd©a
 = 
	`rcu_d”eã»nû_check
(
loÿl
->
mÚ™Ü_sd©a
,

777 
	`lockd•_is_h–d
(&
loÿl
->
iæi¡_mtx
) ||

778 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

779 ià(
sd©a
 &&

780 (
™”_æags
 & 
IEEE80211_IFACE_ITER_RESUME_ALL
 || !
aùive_Úly
 ||

781 
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
))

782 
	`™”©Ü
(
d©a
, 
sd©a
->
vif
.
addr
, &sdata->vif);

783 
	}
}

785 
	$›“80211_™”©e_š‹rçûs
(

786 
›“80211_hw
 *
hw
, 
u32
 
™”_æags
,

787 (*
™”©Ü
)(*
d©a
, 
u8
 *
mac
,

788 
›“80211_vif
 *
vif
),

789 *
d©a
)

791 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

793 
	`mu‹x_lock
(&
loÿl
->
iæi¡_mtx
);

794 
	`__™”©e_š‹rçûs
(
loÿl
, 
™”_æags
, 
™”©Ü
, 
d©a
);

795 
	`mu‹x_uÆock
(&
loÿl
->
iæi¡_mtx
);

796 
	}
}

797 
EXPORT_SYMBOL_GPL
(
›“80211_™”©e_š‹rçûs
);

799 
	$›“80211_™”©e_aùive_š‹rçûs_©omic
(

800 
›“80211_hw
 *
hw
, 
u32
 
™”_æags
,

801 (*
™”©Ü
)(*
d©a
, 
u8
 *
mac
,

802 
›“80211_vif
 *
vif
),

803 *
d©a
)

805 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

807 
	`rcu_»ad_lock
();

808 
	`__™”©e_š‹rçûs
(
loÿl
, 
™”_æags
 | 
IEEE80211_IFACE_ITER_ACTIVE
,

809 
™”©Ü
, 
d©a
);

810 
	`rcu_»ad_uÆock
();

811 
	}
}

812 
EXPORT_SYMBOL_GPL
(
›“80211_™”©e_aùive_š‹rçûs_©omic
);

814 
	$›“80211_™”©e_aùive_š‹rçûs_mtx
(

815 
›“80211_hw
 *
hw
, 
u32
 
™”_æags
,

816 (*
™”©Ü
)(*
d©a
, 
u8
 *
mac
,

817 
›“80211_vif
 *
vif
),

818 *
d©a
)

820 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

822 
	`lockd•_as£¹_why
(
hw
->
why
);

824 
	`__™”©e_š‹rçûs
(
loÿl
, 
™”_æags
 | 
IEEE80211_IFACE_ITER_ACTIVE
,

825 
™”©Ü
, 
d©a
);

826 
	}
}

827 
EXPORT_SYMBOL_GPL
(
›“80211_™”©e_aùive_š‹rçûs_mtx
);

829 
	$__™”©e_¡©iÚs
(
›“80211_loÿl
 *
loÿl
,

830 (*
™”©Ü
)(*
d©a
,

831 
›“80211_¡a
 *
¡a
),

832 *
d©a
)

834 
¡a_šfo
 *
¡a
;

836 
	`li¡_fÜ_—ch_’Œy_rcu
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

837 ià(!
¡a
->
u¶ßded
)

840 
	`™”©Ü
(
d©a
, &
¡a
->sta);

842 
	}
}

844 
	$›“80211_™”©e_¡©iÚs_©omic
(
›“80211_hw
 *
hw
,

845 (*
™”©Ü
)(*
d©a
,

846 
›“80211_¡a
 *
¡a
),

847 *
d©a
)

849 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

851 
	`rcu_»ad_lock
();

852 
	`__™”©e_¡©iÚs
(
loÿl
, 
™”©Ü
, 
d©a
);

853 
	`rcu_»ad_uÆock
();

854 
	}
}

855 
EXPORT_SYMBOL_GPL
(
›“80211_™”©e_¡©iÚs_©omic
);

857 
›“80211_vif
 *
	$wdev_to_›“80211_vif
(
wœ–ess_dev
 *
wdev
)

859 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`IEEE80211_WDEV_TO_SUB_IF
(
wdev
);

861 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
) ||

862 !(
sd©a
->
æags
 & 
IEEE80211_SDATA_IN_DRIVER
))

863  
NULL
;

864  &
sd©a
->
vif
;

865 
	}
}

866 
EXPORT_SYMBOL_GPL
(
wdev_to_›“80211_vif
);

868 
wœ–ess_dev
 *
	$›“80211_vif_to_wdev
(
›“80211_vif
 *
vif
)

870 ià(!
vif
)

871  
NULL
;

873  &
	`vif_to_sd©a
(
vif
)->
wdev
;

874 
	}
}

875 
EXPORT_SYMBOL_GPL
(
›“80211_vif_to_wdev
);

886 
boŞ
 
	$›“80211_ÿn_queue_wÜk
(
›“80211_loÿl
 *
loÿl
)

888 ià(
loÿl
->
qu›scšg
 || (loÿl->
su¥’ded
 && !loÿl->
»sumšg
)) {

889 
	`´_w¬n
("queueing ieee80211 work while goingo suspend\n");

890  
çl£
;

893  
Œue
;

894 
	}
}

896 
	$›“80211_queue_wÜk
(
›“80211_hw
 *
hw
, 
wÜk_¡ruù
 *
wÜk
)

898 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

900 ià(!
	`›“80211_ÿn_queue_wÜk
(
loÿl
))

903 
	`queue_wÜk
(
loÿl
->
wÜkqueue
, 
wÜk
);

904 
	}
}

905 
EXPORT_SYMBOL
(
›“80211_queue_wÜk
);

907 
	$›“80211_queue_d–ayed_wÜk
(
›“80211_hw
 *
hw
,

908 
d–ayed_wÜk
 *
dwÜk
,

909 
d–ay
)

911 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

913 ià(!
	`›“80211_ÿn_queue_wÜk
(
loÿl
))

916 
	`queue_d–ayed_wÜk
(
loÿl
->
wÜkqueue
, 
dwÜk
, 
d–ay
);

917 
	}
}

918 
EXPORT_SYMBOL
(
›“80211_queue_d–ayed_wÜk
);

920 
	$›“80211_»guÏtÜy_lim™_wmm_·¿ms
(
›“80211_sub_if_d©a
 *
sd©a
,

921 
›“80211_tx_queue_·¿ms


922 *
q·¿m
, 
ac
)

924 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

925 cÚ¡ 
›“80211_»g_ruË
 *
¼uË
;

926 cÚ¡ 
›“80211_wmm_ac
 *
wmm_ac
;

927 
u16
 
ûÁ”_äeq
 = 0;

929 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP
 &&

930 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

933 
	`rcu_»ad_lock
();

934 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
bss_cÚf
.chanctx_conf);

935 ià(
chªùx_cÚf
)

936 
ûÁ”_äeq
 = 
chªùx_cÚf
->
def
.
chª
->center_freq;

938 ià(!
ûÁ”_äeq
) {

939 
	`rcu_»ad_uÆock
();

943 
¼uË
 = 
	`äeq_»g_šfo
(
sd©a
->
wdev
.
why
, 
	`MHZ_TO_KHZ
(
ûÁ”_äeq
));

945 ià(
	`IS_ERR_OR_NULL
(
¼uË
è|| !¼uË->
has_wmm
) {

946 
	`rcu_»ad_uÆock
();

950 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
)

951 
wmm_ac
 = &
¼uË
->
wmm_ruË
.
­
[
ac
];

953 
wmm_ac
 = &
¼uË
->
wmm_ruË
.
ş›Á
[
ac
];

954 
q·¿m
->
cw_mš
 = 
	`max_t
(
u16
, q·¿m->cw_mš, 
wmm_ac
->cw_min);

955 
q·¿m
->
cw_max
 = 
	`max_t
(
u16
, q·¿m->cw_max, 
wmm_ac
->cw_max);

956 
q·¿m
->
aifs
 = 
	`max_t
(
u8
, q·¿m->aifs, 
wmm_ac
->
aif¢
);

957 
q·¿m
->
txİ
 = 
	`mš_t
(
u16
, q·¿m->txİ, 
wmm_ac
->
cÙ
 / 32);

958 
	`rcu_»ad_uÆock
();

959 
	}
}

961 
	$›“80211_£t_wmm_deçuÉ
(
›“80211_lšk_d©a
 *
lšk
,

962 
boŞ
 
bss_nÙify
, boŞ 
’abË_qos
)

964 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk
->sdata;

965 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

966 
›“80211_tx_queue_·¿ms
 
q·¿m
;

967 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

968 
ac
;

969 
boŞ
 
u£_11b
;

970 
boŞ
 
is_ocb
;

971 
aCWmš
, 
aCWmax
;

973 ià(!
loÿl
->
İs
->
cÚf_tx
)

976 ià(
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

979 
	`mem£t
(&
q·¿m
, 0, (qparam));

981 
	`rcu_»ad_lock
();

982 
chªùx_cÚf
 = 
	`rcu_d”eã»nû
(
lšk
->
cÚf
->chanctx_conf);

983 
u£_11b
 = (
chªùx_cÚf
 &&

984 
chªùx_cÚf
->
def
.
chª
->
bªd
 =ğ
NL80211_BAND_2GHZ
) &&

985 !
lšk
->
İ”©šg_11g_mode
;

986 
	`rcu_»ad_uÆock
();

988 
is_ocb
 = (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
);

991 
aCWmax
 = 1023;

992 ià(
u£_11b
)

993 
aCWmš
 = 31;

995 
aCWmš
 = 15;

998 
q·¿m
.
cw_max
 = 
aCWmax
;

999 
q·¿m
.
cw_mš
 = 
aCWmš
;

1000 
q·¿m
.
txİ
 = 0;

1001 
q·¿m
.
aifs
 = 2;

1003 
ac
 = 0;‡ø< 
IEEE80211_NUM_ACS
;‡c++) {

1005 ià(
’abË_qos
) {

1006 
ac
) {

1007 
IEEE80211_AC_BK
:

1008 
q·¿m
.
cw_max
 = 
aCWmax
;

1009 
q·¿m
.
cw_mš
 = 
aCWmš
;

1010 
q·¿m
.
txİ
 = 0;

1011 ià(
is_ocb
)

1012 
q·¿m
.
aifs
 = 9;

1014 
q·¿m
.
aifs
 = 7;

1018 
IEEE80211_AC_BE
:

1019 
q·¿m
.
cw_max
 = 
aCWmax
;

1020 
q·¿m
.
cw_mš
 = 
aCWmš
;

1021 
q·¿m
.
txİ
 = 0;

1022 ià(
is_ocb
)

1023 
q·¿m
.
aifs
 = 6;

1025 
q·¿m
.
aifs
 = 3;

1027 
IEEE80211_AC_VI
:

1028 
q·¿m
.
cw_max
 = 
aCWmš
;

1029 
q·¿m
.
cw_mš
 = (
aCWmš
 + 1) / 2 - 1;

1030 ià(
is_ocb
)

1031 
q·¿m
.
txİ
 = 0;

1032 ià(
u£_11b
)

1033 
q·¿m
.
txİ
 = 6016/32;

1035 
q·¿m
.
txİ
 = 3008/32;

1037 ià(
is_ocb
)

1038 
q·¿m
.
aifs
 = 3;

1040 
q·¿m
.
aifs
 = 2;

1042 
IEEE80211_AC_VO
:

1043 
q·¿m
.
cw_max
 = (
aCWmš
 + 1) / 2 - 1;

1044 
q·¿m
.
cw_mš
 = (
aCWmš
 + 1) / 4 - 1;

1045 ià(
is_ocb
)

1046 
q·¿m
.
txİ
 = 0;

1047 ià(
u£_11b
)

1048 
q·¿m
.
txİ
 = 3264/32;

1050 
q·¿m
.
txİ
 = 1504/32;

1051 
q·¿m
.
aifs
 = 2;

1055 
	`›“80211_»guÏtÜy_lim™_wmm_·¿ms
(
sd©a
, &
q·¿m
, 
ac
);

1057 
q·¿m
.
u­sd
 = 
çl£
;

1059 
lšk
->
tx_cÚf
[
ac
] = 
q·¿m
;

1060 
	`drv_cÚf_tx
(
loÿl
, 
lšk
, 
ac
, &
q·¿m
);

1063 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
 &&

1064 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_P2P_DEVICE
 &&

1065 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_NAN
) {

1066 
lšk
->
cÚf
->
qos
 = 
’abË_qos
;

1067 ià(
bss_nÙify
)

1068 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

1069 
BSS_CHANGED_QOS
);

1071 
	}
}

1073 
	$›“80211_£nd_auth
(
›“80211_sub_if_d©a
 *
sd©a
,

1074 
u16
 
Œª§ùiÚ
, u16 
auth_®g
, u16 
¡©us
,

1075 cÚ¡ 
u8
 *
exŒa
, 
size_t
 
exŒa_Ën
, cÚ¡ u8 *
da
,

1076 cÚ¡ 
u8
 *
bssid
, cÚ¡ u8 *
key
, u8 
key_Ën
, u8 
key_idx
,

1077 
u32
 
tx_æags
)

1079 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1080 
sk_buff
 *
skb
;

1081 
›“80211_mgmt
 *
mgmt
;

1082 
boŞ
 
muÉi_lšk
 = 
	`›“80211_vif_is_mld
(&
sd©a
->
vif
);

1084 
u8
 
id
;

1085 
u8
 
Ën
;

1086 
u8
 
ext_id
;

1087 
›“80211_muÉi_lšk_–em
 
ml
;

1088 
›“80211_mË_basic_commÚ_šfo
 
basic
;

1089 } 
__·cked
 
mË
 = {

1090 .
id
 = 
WLAN_EID_EXTENSION
,

1091 .
Ën
 = (
mË
) - 2,

1092 .
ext_id
 = 
WLAN_EID_EXT_EHT_MULTI_LINK
,

1093 .
ml
.
cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_ML_CONTROL_TYPE_BASIC
),

1094 .
basic
.
Ën
 = (
mË
.basic),

1096 
”r
;

1098 
	`memıy
(
mË
.
basic
.
mld_mac_addr
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1101 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
IEEE80211_WEP_IV_LEN
 +

1102 24 + 6 + 
exŒa_Ën
 + 
IEEE80211_WEP_ICV_LEN
 +

1103 
muÉi_lšk
 * (
mË
));

1104 ià(!
skb
)

1107 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
 + 
IEEE80211_WEP_IV_LEN
);

1109 
mgmt
 = 
	`skb_put_z”o
(
skb
, 24 + 6);

1110 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

1111 
IEEE80211_STYPE_AUTH
);

1112 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

1113 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1114 
	`memıy
(
mgmt
->
bssid
, bssid, 
ETH_ALEN
);

1115 
mgmt
->
u
.
auth
.
auth_®g
 = 
	`ıu_to_Ë16
(auth_alg);

1116 
mgmt
->
u
.
auth
.
auth_Œª§ùiÚ
 = 
	`ıu_to_Ë16
(
Œª§ùiÚ
);

1117 
mgmt
->
u
.
auth
.
¡©us_code
 = 
	`ıu_to_Ë16
(
¡©us
);

1118 ià(
exŒa
)

1119 
	`skb_put_d©a
(
skb
, 
exŒa
, 
exŒa_Ën
);

1120 ià(
muÉi_lšk
)

1121 
	`skb_put_d©a
(
skb
, &
mË
, (mle));

1123 ià(
auth_®g
 =ğ
WLAN_AUTH_SHARED_KEY
 && 
Œª§ùiÚ
 == 3) {

1124 
mgmt
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

1125 
”r
 = 
	`›“80211_w•_’üy±
(
loÿl
, 
skb
, 
key
, 
key_Ën
, 
key_idx
);

1126 ià(
	`WARN_ON
(
”r
)) {

1127 
	`kä“_skb
(
skb
);

1132 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
 |

1133 
tx_æags
;

1134 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1135 
	}
}

1137 
	$›“80211_£nd_d—uth_di§ssoc
(
›“80211_sub_if_d©a
 *
sd©a
,

1138 cÚ¡ 
u8
 *
da
, cÚ¡ u8 *
bssid
,

1139 
u16
 
¡y³
, u16 
»asÚ
,

1140 
boŞ
 
£nd_äame
, 
u8
 *
äame_buf
)

1142 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1143 
sk_buff
 *
skb
;

1144 
›“80211_mgmt
 *
mgmt
 = (*)
äame_buf
;

1147 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 | 
¡y³
);

1148 
mgmt
->
du¿tiÚ
 = 0;

1149 
mgmt
->
£q_ù¾
 = 0;

1150 
	`memıy
(
mgmt
->
da
, da, 
ETH_ALEN
);

1151 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

1152 
	`memıy
(
mgmt
->
bssid
, bssid, 
ETH_ALEN
);

1154 
mgmt
->
u
.
d—uth
.
»asÚ_code
 = 
	`ıu_to_Ë16
(
»asÚ
);

1156 ià(
£nd_äame
) {

1157 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
hw
.
exŒa_tx_h—droom
 +

1158 
IEEE80211_DEAUTH_FRAME_LEN
);

1159 ià(!
skb
)

1162 
	`skb_»£rve
(
skb
, 
loÿl
->
hw
.
exŒa_tx_h—droom
);

1165 
	`skb_put_d©a
(
skb
, 
mgmt
, 
IEEE80211_DEAUTH_FRAME_LEN
);

1167 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
 ||

1168 !(
sd©a
->
u
.
mgd
.
æags
 & 
IEEE80211_STA_MFP_ENABLED
))

1169 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |=

1170 
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1172 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

1174 
	}
}

1176 
	$›“80211_put_s1g_ÿp
(
sk_buff
 *
skb
,

1177 
›“80211_¡a_s1g_ÿp
 *
s1g_ÿp
)

1179 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_s1g_ÿp
))

1180  -
ENOBUFS
;

1182 
	`skb_put_u8
(
skb
, 
WLAN_EID_S1G_CAPABILITIES
);

1183 
	`skb_put_u8
(
skb
, (
›“80211_s1g_ÿp
));

1185 
	`skb_put_d©a
(
skb
, &
s1g_ÿp
->
ÿp
, (s1g_cap->cap));

1186 
	`skb_put_d©a
(
skb
, &
s1g_ÿp
->
nss_mcs
, (s1g_cap->nss_mcs));

1189 
	}
}

1191 
	$›“80211_put_´eq_›s_bªd
(
sk_buff
 *
skb
,

1192 
›“80211_sub_if_d©a
 *
sd©a
,

1193 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

1194 
size_t
 *
off£t
,

1195 
Æ80211_bªd
 
bªd
,

1196 
u32
 
¿‹_mask
,

1197 
cfg80211_chª_def
 *
chªdef
,

1198 
u32
 
æags
)

1200 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1201 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1202 
i
, 
”r
;

1203 
size_t
 
noff£t
;

1204 
u32
 
¿‹_æags
;

1205 
boŞ
 
have_80mhz
 = 
çl£
;

1207 *
off£t
 = 0;

1209 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1210 ià(
	`WARN_ON_ONCE
(!
sbªd
))

1213 
¿‹_æags
 = 
	`›“80211_chªdef_¿‹_æags
(
chªdef
);

1216 ià(
bªd
 =ğ
NL80211_BAND_S1GHZ
)

1217  
	`›“80211_put_s1g_ÿp
(
skb
, &
sbªd
->
s1g_ÿp
);

1219 
”r
 = 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 0, 
¿‹_æags
,

1220 ~
¿‹_mask
, 
WLAN_EID_SUPP_RATES
);

1221 ià(
”r
)

1222  
”r
;

1225 ià(
›
 && 
›_Ën
) {

1226 cÚ¡ 
u8
 
befÜe_exŒ©es
[] = {

1227 
WLAN_EID_SSID
,

1228 
WLAN_EID_SUPP_RATES
,

1229 
WLAN_EID_REQUEST
,

1231 
noff£t
 = 
	`›“80211_›_¥l™
(
›
, 
›_Ën
,

1232 
befÜe_exŒ©es
,

1233 
	`ARRAY_SIZE
(
befÜe_exŒ©es
),

1234 *
off£t
);

1235 ià(
	`skb_room
(
skb
è< 
noff£t
 - *
off£t
)

1236  -
ENOBUFS
;

1237 
	`skb_put_d©a
(
skb
, 
›
 + *
off£t
, 
noff£t
 - *offset);

1238 *
off£t
 = 
noff£t
;

1241 
”r
 = 
	`›“80211_put_¤©es_–em
(
skb
, 
sbªd
, 0, 
¿‹_æags
,

1242 ~
¿‹_mask
, 
WLAN_EID_EXT_SUPP_RATES
);

1243 ià(
”r
)

1244  
”r
;

1246 ià(
chªdef
->
chª
 && 
sbªd
->
bªd
 =ğ
NL80211_BAND_2GHZ
) {

1247 ià(
	`skb_room
(
skb
) < 3)

1248  -
ENOBUFS
;

1249 
	`skb_put_u8
(
skb
, 
WLAN_EID_DS_PARAMS
);

1250 
	`skb_put_u8
(
skb
, 1);

1251 
	`skb_put_u8
(
skb
,

1252 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
chª
->
ûÁ”_äeq
));

1255 ià(
æags
 & 
IEEE80211_PROBE_FLAG_MIN_CONTENT
)

1259 ià(
›
 && 
›_Ën
) {

1260 cÚ¡ 
u8
 
befÜe_ht
[] = {

1265 
WLAN_EID_DS_PARAMS
,

1266 
WLAN_EID_SUPPORTED_REGULATORY_CLASSES
,

1268 
noff£t
 = 
	`›“80211_›_¥l™
(
›
, 
›_Ën
,

1269 
befÜe_ht
, 
	`ARRAY_SIZE
(before_ht),

1270 *
off£t
);

1271 ià(
	`skb_room
(
skb
è< 
noff£t
 - *
off£t
)

1272  -
ENOBUFS
;

1273 
	`skb_put_d©a
(
skb
, 
›
 + *
off£t
, 
noff£t
 - *offset);

1274 *
off£t
 = 
noff£t
;

1277 ià(
sbªd
->
ht_ÿp
.
ht_suµÜ‹d
) {

1278 
u8
 *
pos
;

1280 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_ht_ÿp
))

1281  -
ENOBUFS
;

1283 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_ht_ÿp
));

1284 
	`›“80211_›_bud_ht_ÿp
(
pos
, &
sbªd
->
ht_ÿp
,

1285 
sbªd
->
ht_ÿp
.
ÿp
);

1289 ià(
›
 && 
›_Ën
) {

1290 cÚ¡ 
u8
 
befÜe_vht
[] = {

1295 
WLAN_EID_BSS_COEX_2040
,

1296 
WLAN_EID_EXT_CAPABILITY
,

1297 
WLAN_EID_SSID_LIST
,

1298 
WLAN_EID_CHANNEL_USAGE
,

1299 
WLAN_EID_INTERWORKING
,

1300 
WLAN_EID_MESH_ID
,

1303 
noff£t
 = 
	`›“80211_›_¥l™
(
›
, 
›_Ën
,

1304 
befÜe_vht
, 
	`ARRAY_SIZE
(before_vht),

1305 *
off£t
);

1306 ià(
	`skb_room
(
skb
è< 
noff£t
 - *
off£t
)

1307  -
ENOBUFS
;

1308 
	`skb_put_d©a
(
skb
, 
›
 + *
off£t
, 
noff£t
 - *offset);

1309 *
off£t
 = 
noff£t
;

1313 
i
 = 0; i < 
sbªd
->
n_chªÃls
; i++) {

1314 ià(
sbªd
->
chªÃls
[
i
].
æags
 & (
IEEE80211_CHAN_DISABLED
 |

1315 
IEEE80211_CHAN_NO_80MHZ
))

1318 
have_80mhz
 = 
Œue
;

1322 ià(
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
 && 
have_80mhz
) {

1323 
u8
 *
pos
;

1325 ià(
	`skb_room
(
skb
è< 2 + (
›“80211_vht_ÿp
))

1326  -
ENOBUFS
;

1328 
pos
 = 
	`skb_put
(
skb
, 2 + (
›“80211_vht_ÿp
));

1329 
	`›“80211_›_bud_vht_ÿp
(
pos
, &
sbªd
->
vht_ÿp
,

1330 
sbªd
->
vht_ÿp
.
ÿp
);

1334 ià(
›
 && 
›_Ën
) {

1335 cÚ¡ 
u8
 
befÜe_he
[] = {

1340 
WLAN_EID_EXTENSION
, 
WLAN_EID_EXT_FILS_REQ_PARAMS
,

1341 
WLAN_EID_AP_CSN
,

1344 
noff£t
 = 
	`›“80211_›_¥l™
(
›
, 
›_Ën
,

1345 
befÜe_he
, 
	`ARRAY_SIZE
(before_he),

1346 *
off£t
);

1347 ià(
	`skb_room
(
skb
è< 
noff£t
 - *
off£t
)

1348  -
ENOBUFS
;

1349 
	`skb_put_d©a
(
skb
, 
›
 + *
off£t
, 
noff£t
 - *offset);

1350 *
off£t
 = 
noff£t
;

1353 ià(
	`cfg80211_ªy_u§bË_chªÃls
(
loÿl
->
hw
.
why
, 
	`BIT
(
sbªd
->
bªd
),

1354 
IEEE80211_CHAN_NO_HE
)) {

1355 
”r
 = 
	`›“80211_put_he_ÿp
(
skb
, 
sd©a
, 
sbªd
, 
NULL
);

1356 ià(
”r
)

1357  
”r
;

1360 ià(
	`cfg80211_ªy_u§bË_chªÃls
(
loÿl
->
hw
.
why
, 
	`BIT
(
sbªd
->
bªd
),

1361 
IEEE80211_CHAN_NO_HE
 |

1362 
IEEE80211_CHAN_NO_EHT
)) {

1363 
”r
 = 
	`›“80211_put_eht_ÿp
(
skb
, 
sd©a
, 
sbªd
, 
NULL
);

1364 ià(
”r
)

1365  
”r
;

1368 
”r
 = 
	`›“80211_put_he_6ghz_ÿp
(
skb
, 
sd©a
, 
IEEE80211_SMPS_OFF
);

1369 ià(
”r
)

1370  
”r
;

1378 
	}
}

1380 
	$›“80211_put_´eq_›s
(
sk_buff
 *
skb
,

1381 
›“80211_sub_if_d©a
 *
sd©a
,

1382 
›“80211_sÿn_›s
 *
›_desc
,

1383 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

1384 
u8
 
bªds_u£d
, 
u32
 *
¿‹_masks
,

1385 
cfg80211_chª_def
 *
chªdef
,

1386 
u32
 
æags
)

1388 
size_t
 
cu¡om_›_off£t
 = 0;

1389 
i
, 
”r
;

1391 
	`mem£t
(
›_desc
, 0, (*ie_desc));

1393 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

1394 ià(
bªds_u£d
 & 
	`BIT
(
i
)) {

1395 
›_desc
->
›s
[
i
] = 
	`skb__poš‹r
(
skb
);

1396 
”r
 = 
	`›“80211_put_´eq_›s_bªd
(
skb
, 
sd©a
,

1397 
›
, 
›_Ën
,

1398 &
cu¡om_›_off£t
,

1399 
i
, 
¿‹_masks
[i],

1400 
chªdef
, 
æags
);

1401 ià(
”r
)

1402  
”r
;

1403 
›_desc
->
Ën
[
i
] = 
	`skb__poš‹r
(
skb
) -

1404 
›_desc
->
›s
[
i
];

1409 ià(
›
 && 
›_Ën
) {

1410 ià(
	`WARN_ONCE
(
	`skb_room
(
skb
è< 
›_Ën
 - 
cu¡om_›_off£t
,

1412  -
ENOBUFS
;

1413 
›_desc
->
commÚ_›s
 = 
	`skb__poš‹r
(
skb
);

1414 
	`skb_put_d©a
(
skb
, 
›
 + 
cu¡om_›_off£t
,

1415 
›_Ën
 - 
cu¡om_›_off£t
);

1416 
›_desc
->
commÚ_›_Ën
 = 
	`skb__poš‹r
(
skb
) -

1417 
›_desc
->
commÚ_›s
;

1421 
	}
};

1423 
	$›“80211_bud_´eq_›s
(
›“80211_sub_if_d©a
 *
sd©a
, 
u8
 *
bufãr
,

1424 
size_t
 
bufãr_Ën
,

1425 
›“80211_sÿn_›s
 *
›_desc
,

1426 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

1427 
u8
 
bªds_u£d
, 
u32
 *
¿‹_masks
,

1428 
cfg80211_chª_def
 *
chªdef
,

1429 
u32
 
æags
)

1431 
sk_buff
 *
skb
 = 
	`®loc_skb
(
bufãr_Ën
, 
GFP_KERNEL
);

1432 
ušŒ_t
 
offs
;

1433 
»t
, 
i
;

1434 
u8
 *
¡¬t
;

1436 ià(!
skb
)

1437  -
ENOMEM
;

1439 
¡¬t
 = 
	`skb__poš‹r
(
skb
);

1440 
	`mem£t
(
¡¬t
, 0, 
	`skb_room
(
skb
));

1441 
»t
 = 
	`›“80211_put_´eq_›s
(
skb
, 
sd©a
, 
›_desc
, 
›
, 
›_Ën
,

1442 
bªds_u£d
, 
¿‹_masks
, 
chªdef
,

1443 
æags
);

1444 ià(
»t
 < 0) {

1445 
out
;

1448 ià(
skb
->
Ën
 > 
bufãr_Ën
) {

1449 
»t
 = -
ENOBUFS
;

1450 
out
;

1453 
	`memıy
(
bufãr
, 
¡¬t
, 
skb
->
Ën
);

1456 
i
 = 0; i < 
NUM_NL80211_BANDS
; i++) {

1457 
offs
 = 
›_desc
->
›s
[
i
] - 
¡¬t
;

1458 
›_desc
->
›s
[
i
] = 
bufãr
 + 
offs
;

1460 
offs
 = 
›_desc
->
commÚ_›s
 - 
¡¬t
;

1461 
›_desc
->
commÚ_›s
 = 
bufãr
 + 
offs
;

1463 
»t
 = 
skb
->
Ën
;

1464 
out
:

1465 
	`cÚsume_skb
(
skb
);

1466  
»t
;

1467 
	}
}

1469 
sk_buff
 *
	$›“80211_bud_´obe_»q
(
›“80211_sub_if_d©a
 *
sd©a
,

1470 cÚ¡ 
u8
 *
¤c
, cÚ¡ u8 *
d¡
,

1471 
u32
 
¿‹mask
,

1472 
›“80211_chªÃl
 *
chª
,

1473 cÚ¡ 
u8
 *
ssid
, 
size_t
 
ssid_Ën
,

1474 cÚ¡ 
u8
 *
›
, 
size_t
 
›_Ën
,

1475 
u32
 
æags
)

1477 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1478 
cfg80211_chª_def
 
chªdef
;

1479 
sk_buff
 *
skb
;

1480 
›“80211_mgmt
 *
mgmt
;

1481 
u32
 
¿‹_masks
[
NUM_NL80211_BANDS
] = {};

1482 
›“80211_sÿn_›s
 
dummy_›_desc
;

1489 
chªdef
.
width
 = 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
.width;

1490 ià(
æags
 & 
IEEE80211_PROBE_FLAG_DIRECTED
)

1491 
chªdef
.
chª
 = 
NULL
;

1493 
chªdef
.
chª
 = chan;

1495 
skb
 = 
	`›“80211_´ob”eq_g‘
(&
loÿl
->
hw
, 
¤c
, 
ssid
, 
ssid_Ën
,

1496 
loÿl
->
sÿn_›s_Ën
 + 
›_Ën
);

1497 ià(!
skb
)

1498  
NULL
;

1500 
¿‹_masks
[
chª
->
bªd
] = 
¿‹mask
;

1501 
	`›“80211_put_´eq_›s
(
skb
, 
sd©a
, &
dummy_›_desc
,

1502 
›
, 
›_Ën
, 
	`BIT
(
chª
->
bªd
),

1503 
¿‹_masks
, &
chªdef
, 
æags
);

1505 ià(
d¡
) {

1506 
mgmt
 = (
›“80211_mgmt
 *è
skb
->
d©a
;

1507 
	`memıy
(
mgmt
->
da
, 
d¡
, 
ETH_ALEN
);

1508 
	`memıy
(
mgmt
->
bssid
, 
d¡
, 
ETH_ALEN
);

1511 
	`IEEE80211_SKB_CB
(
skb
)->
æags
 |ğ
IEEE80211_TX_INTFL_DONT_ENCRYPT
;

1513  
skb
;

1514 
	}
}

1516 
u32
 
	$›“80211_¡a_g‘_¿‹s
(
›“80211_sub_if_d©a
 *
sd©a
,

1517 
›“802_11_–ems
 *
–ems
,

1518 
Æ80211_bªd
 
bªd
, 
u32
 *
basic_¿‹s
)

1520 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

1521 
size_t
 
num_¿‹s
;

1522 
u32
 
suµ_¿‹s
, 
¿‹_æags
;

1523 
i
, 
j
;

1525 
sbªd
 = 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
bªd
];

1526 ià(
	`WARN_ON
(!
sbªd
))

1529 
¿‹_æags
 =

1530 
	`›“80211_chªdef_¿‹_æags
(&
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
);

1532 
num_¿‹s
 = 
sbªd
->
n_b™¿‹s
;

1533 
suµ_¿‹s
 = 0;

1534 
i
 = 0; i < 
–ems
->
suµ_¿‹s_Ën
 +

1535 
–ems
->
ext_suµ_¿‹s_Ën
; 
i
++) {

1536 
u8
 
¿‹
 = 0;

1537 
own_¿‹
;

1538 
boŞ
 
is_basic
;

1539 ià(
i
 < 
–ems
->
suµ_¿‹s_Ën
)

1540 
¿‹
 = 
–ems
->
suµ_¿‹s
[
i
];

1541 ià(
–ems
->
ext_suµ_¿‹s
)

1542 
¿‹
 = 
–ems
->
ext_suµ_¿‹s


1543 [
i
 - 
–ems
->
suµ_¿‹s_Ën
];

1544 
own_¿‹
 = 5 * (
¿‹
 & 0x7f);

1545 
is_basic
 = !!(
¿‹
 & 0x80);

1547 ià(
is_basic
 && (
¿‹
 & 0x7fè=ğ
BSS_MEMBERSHIP_SELECTOR_HT_PHY
)

1550 
j
 = 0; j < 
num_¿‹s
; j++) {

1551 
b¿‹
;

1552 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
j
].
æags
)

1553 !ğ
¿‹_æags
)

1556 
b¿‹
 = 
sbªd
->
b™¿‹s
[
j
].
b™¿‹
;

1558 ià(
b¿‹
 =ğ
own_¿‹
) {

1559 
suµ_¿‹s
 |ğ
	`BIT
(
j
);

1560 ià(
basic_¿‹s
 && 
is_basic
)

1561 *
basic_¿‹s
 |ğ
	`BIT
(
j
);

1565  
suµ_¿‹s
;

1566 
	}
}

1568 
	$›“80211_¡İ_deviû
(
›“80211_loÿl
 *
loÿl
)

1570 
	`›“80211_Ëd_¿dio
(
loÿl
, 
çl£
);

1571 
	`›“80211_mod_t_Ëd_Œig
(
loÿl
, 0, 
IEEE80211_TPT_LEDTRIG_FL_RADIO
);

1573 
	`why_wÜk_ÿnûl
(
loÿl
->
hw
.
why
, &loÿl->
»cÚfig_f‹r
);

1575 
	`æush_wÜkqueue
(
loÿl
->
wÜkqueue
);

1576 
	`why_wÜk_æush
(
loÿl
->
hw
.
why
, 
NULL
);

1577 
	`drv_¡İ
(
loÿl
);

1578 
	}
}

1580 
	$›“80211_æush_com¶‘ed_sÿn
(
›“80211_loÿl
 *
loÿl
,

1581 
boŞ
 
abÜ‹d
)

1590 ià(
	`‹¡_b™
(
SCAN_COMPLETED
, &
loÿl
->
sÿÂšg
)) {

1596 ià(
abÜ‹d
)

1597 
	`£t_b™
(
SCAN_ABORTED
, &
loÿl
->
sÿÂšg
);

1598 
	`why_d–ayed_wÜk_queue
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
, 0);

1599 
	`why_d–ayed_wÜk_æush
(
loÿl
->
hw
.
why
, &loÿl->
sÿn_wÜk
);

1601 
	}
}

1603 
	$›“80211_hªdË_»cÚfig_çu»
(
›“80211_loÿl
 *
loÿl
)

1605 
›“80211_sub_if_d©a
 *
sd©a
;

1606 
›“80211_chªùx
 *
ùx
;

1608 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1620 
loÿl
->
»sumšg
 = 
çl£
;

1621 
loÿl
->
su¥’ded
 = 
çl£
;

1622 
loÿl
->
š_»cÚfig
 = 
çl£
;

1623 
loÿl
->
»cÚfig_çu»
 = 
Œue
;

1625 
	`›“80211_æush_com¶‘ed_sÿn
(
loÿl
, 
Œue
);

1630 
	`›“80211_sched_sÿn_’d
(
loÿl
);

1632 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
)

1633 
sd©a
->
æags
 &ğ~
IEEE80211_SDATA_IN_DRIVER
;

1638 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
)

1639 
ùx
->
driv”_´e£Á
 = 
çl£
;

1640 
	}
}

1642 
	$›“80211_assign_chªùx
(
›“80211_loÿl
 *
loÿl
,

1643 
›“80211_sub_if_d©a
 *
sd©a
,

1644 
›“80211_lšk_d©a
 *
lšk
)

1646 
›“80211_chªùx_cÚf
 *
cÚf
;

1647 
›“80211_chªùx
 *
ùx
;

1649 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1651 
cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk
->cÚf->
chªùx_cÚf
,

1652 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

1653 ià(
cÚf
) {

1654 
ùx
 = 
	`cÚš”_of
(
cÚf
, 
›“80211_chªùx
, conf);

1655 
	`drv_assign_vif_chªùx
(
loÿl
, 
sd©a
, 
lšk
->
cÚf
, 
ùx
);

1657 
	}
}

1659 
	$›“80211_»cÚfig_¡©iÚs
(
›“80211_sub_if_d©a
 *
sd©a
)

1661 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

1662 
¡a_šfo
 *
¡a
;

1664 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1667 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

1668 
›“80211_¡a_¡©e
 
¡©e
;

1670 ià(!
¡a
->
u¶ßded
 || s->
sd©a
 != sdata)

1673 
¡©e
 = 
IEEE80211_STA_NOTEXIST
;

1674 
¡©e
 < 
¡a
->
¡a_¡©e
; state++)

1675 
	`WARN_ON
(
	`drv_¡a_¡©e
(
loÿl
, 
¡a
->
sd©a
, s, 
¡©e
,

1676 
¡©e
 + 1));

1678 
	}
}

1680 
	$›“80211_»cÚfig_Çn
(
›“80211_sub_if_d©a
 *
sd©a
)

1682 
cfg80211_Çn_func
 *
func
, **
funcs
;

1683 
»s
, 
id
, 
i
 = 0;

1685 
»s
 = 
	`drv_¡¬t_Çn
(
sd©a
->
loÿl
, sdata,

1686 &
sd©a
->
u
.
Çn
.
cÚf
);

1687 ià(
	`WARN_ON
(
»s
))

1688  
»s
;

1690 
funcs
 = 
	`kÿÎoc
(
sd©a
->
loÿl
->
hw
.
max_Çn_de_’Œ›s
 + 1,

1691 (*
funcs
),

1692 
GFP_KERNEL
);

1693 ià(!
funcs
)

1694  -
ENOMEM
;

1700 
	`¥š_lock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

1702 
	`idr_fÜ_—ch_’Œy
(&
sd©a
->
u
.
Çn
.
funùiÚ_š¡_ids
, 
func
, 
id
)

1703 
funcs
[
i
++] = 
func
;

1705 
	`¥š_uÆock_bh
(&
sd©a
->
u
.
Çn
.
func_lock
);

1707 
i
 = 0; 
funcs
[i]; i++) {

1708 
»s
 = 
	`drv_add_Çn_func
(
sd©a
->
loÿl
, sd©a, 
funcs
[
i
]);

1709 ià(
	`WARN_ON
(
»s
))

1710 
	`›“80211_Çn_func_‹rmš©ed
(&
sd©a
->
vif
,

1711 
funcs
[
i
]->
š¡ªû_id
,

1712 
NL80211_NAN_FUNC_TERM_REASON_ERROR
,

1713 
GFP_KERNEL
);

1716 
	`kä“
(
funcs
);

1719 
	}
}

1721 
	$›“80211_»cÚfig_­_lšks
(
›“80211_loÿl
 *
loÿl
,

1722 
›“80211_sub_if_d©a
 *
sd©a
,

1723 
u64
 
chªged
)

1725 
lšk_id
;

1727 
lšk_id
 = 0;†šk_id < 
	`ARRAY_SIZE
(
sd©a
->
lšk
);†ink_id++) {

1728 
›“80211_lšk_d©a
 *
lšk
;

1730 ià(!(
sd©a
->
vif
.
aùive_lšks
 & 
	`BIT
(
lšk_id
)))

1733 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

1734 ià(!
lšk
)

1737 ià(
	`rcu_acûss_poš‹r
(
lšk
->
u
.
­
.
b—cÚ
))

1738 
	`drv_¡¬t_­
(
loÿl
, 
sd©a
, 
lšk
->
cÚf
);

1740 ià(!
lšk
->
cÚf
->
’abË_b—cÚ
)

1743 
chªged
 |ğ
BSS_CHANGED_BEACON
 |

1744 
BSS_CHANGED_BEACON_ENABLED
;

1746 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
, 
chªged
);

1748 
	}
}

1750 
	$›“80211_»cÚfig
(
›“80211_loÿl
 *
loÿl
)

1752 
›“80211_hw
 *
hw
 = &
loÿl
->hw;

1753 
›“80211_sub_if_d©a
 *
sd©a
;

1754 
›“80211_chªùx
 *
ùx
;

1755 
¡a_šfo
 *
¡a
;

1756 
»s
, 
i
;

1757 
boŞ
 
»cÚfig_due_to_wowÏn
 = 
çl£
;

1758 
›“80211_sub_if_d©a
 *
sched_sÿn_sd©a
;

1759 
cfg80211_sched_sÿn_»que¡
 *
sched_sÿn_»q
;

1760 
boŞ
 
sched_sÿn_¡İ³d
 = 
çl£
;

1761 
boŞ
 
su¥’ded
 = 
loÿl
->suspended;

1762 
boŞ
 
š_»cÚfig
 = 
çl£
;

1764 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

1767 ià(!
loÿl
->
İ’_couÁ
)

1768 
wake_up
;

1770 #ifdeà
CONFIG_PM


1771 ià(
su¥’ded
)

1772 
loÿl
->
»sumšg
 = 
Œue
;

1774 ià(
loÿl
->
wowÏn
) {

1781 
loÿl
->
su¥’ded
 = 
çl£
;

1782 
»s
 = 
	`drv_»sume
(
loÿl
);

1783 
loÿl
->
wowÏn
 = 
çl£
;

1784 ià(
»s
 < 0) {

1785 
loÿl
->
»sumšg
 = 
çl£
;

1786  
»s
;

1788 ià(
»s
 == 0)

1789 
wake_up
;

1790 
	`WARN_ON
(
»s
 > 1);

1796 
»cÚfig_due_to_wowÏn
 = 
Œue
;

1797 
loÿl
->
su¥’ded
 = 
Œue
;

1808 ià(
su¥’ded
 && 
loÿl
->
š_»cÚfig
 && !
»cÚfig_due_to_wowÏn
)

1809 
	`ÿnûl_wÜk_sync
(&
loÿl
->
»¡¬t_wÜk
);

1811 
loÿl
->
¡¬‹d
 = 
çl£
;

1819 
»s
 = 
	`drv_¡¬t
(
loÿl
);

1820 ià(
»s
) {

1821 ià(
su¥’ded
)

1822 
	`WARN
(1, "Hardware became unavailable upon„esume. This could be‡ software issue…rioro suspend or‡ hardware issue.\n");

1824 
	`WARN
(1, "Hardware became unavailable during„estart.\n");

1825 
	`›“80211_hªdË_»cÚfig_çu»
(
loÿl
);

1826  
»s
;

1830 
	`drv_£t_äag_th»shŞd
(
loÿl
, 
hw
->
why
->
äag_th»shŞd
);

1833 
	`drv_£t_¹s_th»shŞd
(
loÿl
, 
hw
->
why
->
¹s_th»shŞd
);

1836 
	`drv_£t_cov”age_şass
(
loÿl
, 
hw
->
why
->
cov”age_şass
);

1838 
	`›“80211_Ëd_¿dio
(
loÿl
, 
Œue
);

1839 
	`›“80211_mod_t_Ëd_Œig
(
loÿl
,

1840 
IEEE80211_TPT_LEDTRIG_FL_RADIO
, 0);

1843 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,†oÿl->
mÚ™Ü_sd©a
);

1844 ià(
sd©a
) {

1846 
	`WARN_ON
(
loÿl
->
»sumšg
);

1847 
»s
 = 
	`drv_add_š‹rçû
(
loÿl
, 
sd©a
);

1848 ià(
	`WARN_ON
(
»s
)) {

1849 
	`RCU_INIT_POINTER
(
loÿl
->
mÚ™Ü_sd©a
, 
NULL
);

1850 
	`synchrÚize_Ãt
();

1851 
	`kä“
(
sd©a
);

1855 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1856 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

1857 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
 &&

1858 
	`›“80211_sd©a_ruÂšg
(
sd©a
)) {

1859 
»s
 = 
	`drv_add_š‹rçû
(
loÿl
, 
sd©a
);

1860 ià(
	`WARN_ON
(
»s
))

1868 ià(
»s
) {

1869 
	`li¡_fÜ_—ch_’Œy_cÚtšue_»v”£
(
sd©a
, &
loÿl
->
š‹rçûs
,

1870 
li¡
)

1871 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_AP_VLAN
 &&

1872 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MONITOR
 &&

1873 
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1874 
	`drv_»move_š‹rçû
(
loÿl
, 
sd©a
);

1875 
	`›“80211_hªdË_»cÚfig_çu»
(
loÿl
);

1876  
»s
;

1880 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
)

1881 ià(
ùx
->
»¶aû_¡©e
 !ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

1882 
	`WARN_ON
(
	`drv_add_chªùx
(
loÿl
, 
ùx
));

1884 
sd©a
 = 
	`why_d”eã»nû
(
loÿl
->
hw
.
why
,†oÿl->
mÚ™Ü_sd©a
);

1885 ià(
sd©a
 && 
	`›“80211_sd©a_ruÂšg
(sdata))

1886 
	`›“80211_assign_chªùx
(
loÿl
, 
sd©a
, &sd©a->
deæšk
);

1889 
	`›“80211_hw_cÚfig
(
loÿl
, 
IEEE80211_CONF_CHANGE_LISTEN_INTERVAL
 |

1890 
IEEE80211_CONF_CHANGE_MONITOR
 |

1891 
IEEE80211_CONF_CHANGE_PS
 |

1892 
IEEE80211_CONF_CHANGE_RETRY_LIMITS
 |

1893 
IEEE80211_CONF_CHANGE_IDLE
);

1895 
	`›“80211_cÚfigu»_f‹r
(
loÿl
);

1898 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

1900 
u64
 
chªged
 = 
BSS_CHANGED_ERP_CTS_PROT
 |

1901 
BSS_CHANGED_ERP_PREAMBLE
 |

1902 
BSS_CHANGED_ERP_SLOT
 |

1903 
BSS_CHANGED_HT
 |

1904 
BSS_CHANGED_BASIC_RATES
 |

1905 
BSS_CHANGED_BEACON_INT
 |

1906 
BSS_CHANGED_BSSID
 |

1907 
BSS_CHANGED_CQM
 |

1908 
BSS_CHANGED_QOS
 |

1909 
BSS_CHANGED_TXPOWER
 |

1910 
BSS_CHANGED_MCAST_RATE
;

1911 
›“80211_lšk_d©a
 *
lšk
 = 
NULL
;

1912 
lšk_id
;

1913 
u32
 
aùive_lšks
 = 0;

1915 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

1918 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

1919 
›“80211_bss_cÚf
 *
Şd
[
IEEE80211_MLD_MAX_NUM_LINKS
] = {

1920 [0] = &
sd©a
->
vif
.
bss_cÚf
,

1923 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
) {

1925 
aùive_lšks
 = 
sd©a
->
vif
.active_links;

1926 
lšk_id
 = 
	`ffs
(
aùive_lšks
) - 1;

1927 
sd©a
->
vif
.
aùive_lšks
 = 
	`BIT
(
lšk_id
);

1930 
	`drv_chªge_vif_lšks
(
loÿl
, 
sd©a
, 0,

1931 
sd©a
->
vif
.
aùive_lšks
,

1932 
Şd
);

1935 
lšk_id
 = 0;

1936 
lšk_id
 < 
	`ARRAY_SIZE
(
sd©a
->
vif
.
lšk_cÚf
);

1937 
lšk_id
++) {

1938 ià(!
	`›“80211_vif_lšk_aùive
(&
sd©a
->
vif
, 
lšk_id
))

1941 
lšk
 = 
	`sd©a_d”eã»nû
(
sd©a
->lšk[
lšk_id
], sdata);

1942 ià(!
lšk
)

1945 
	`›“80211_assign_chªùx
(
loÿl
, 
sd©a
, 
lšk
);

1948 
sd©a
->
vif
.
ty³
) {

1949 
NL80211_IFTYPE_AP_VLAN
:

1950 
NL80211_IFTYPE_MONITOR
:

1952 
NL80211_IFTYPE_ADHOC
:

1953 ià(
sd©a
->
vif
.
cfg
.
ibss_jošed
)

1954 
	`WARN_ON
(
	`drv_još_ibss
(
loÿl
, 
sd©a
));

1955 
çÎthrough
;

1957 
	`›“80211_»cÚfig_¡©iÚs
(
sd©a
);

1958 
çÎthrough
;

1959 
NL80211_IFTYPE_AP
:

1960 
i
 = 0; i < 
IEEE80211_NUM_ACS
; i++)

1961 
	`drv_cÚf_tx
(
loÿl
, &
sd©a
->
deæšk
, 
i
,

1962 &
sd©a
->
deæšk
.
tx_cÚf
[
i
]);

1966 ià(
sd©a
->
vif
.
bss_cÚf
.
mu_mimo_owÃr
)

1967 
chªged
 |ğ
BSS_CHANGED_MU_GROUPS
;

1969 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

1970 
chªged
 |ğ
BSS_CHANGED_IDLE
;

1972 
sd©a
->
vif
.
ty³
) {

1973 
NL80211_IFTYPE_STATION
:

1974 ià(!
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

1975 
chªged
 |ğ
BSS_CHANGED_ASSOC
 |

1976 
BSS_CHANGED_ARP_FILTER
 |

1977 
BSS_CHANGED_PS
;

1980 ià(
sd©a
->
deæšk
.
u
.
mgd
.
have_b—cÚ
)

1981 
chªged
 |ğ
BSS_CHANGED_BEACON_INFO
;

1983 ià(
sd©a
->
vif
.
bss_cÚf
.
max_idË_³riod
 ||

1984 
sd©a
->
vif
.
bss_cÚf
.
´Ùeùed_k“p_®ive
)

1985 
chªged
 |ğ
BSS_CHANGED_KEEP_ALIVE
;

1987 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
,

1988 
chªged
);

1989 } ià(!
	`WARN_ON
(!
lšk
)) {

1990 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

1991 
chªged
);

1992 
chªged
 = 
BSS_CHANGED_ASSOC
 |

1993 
BSS_CHANGED_IDLE
 |

1994 
BSS_CHANGED_PS
 |

1995 
BSS_CHANGED_ARP_FILTER
;

1996 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
, 
chªged
);

1999 
NL80211_IFTYPE_OCB
:

2000 
chªged
 |ğ
BSS_CHANGED_OCB
;

2001 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

2003 
NL80211_IFTYPE_ADHOC
:

2004 
chªged
 |ğ
BSS_CHANGED_IBSS
;

2005 
çÎthrough
;

2006 
NL80211_IFTYPE_AP
:

2007 
chªged
 |ğ
BSS_CHANGED_P2P_PS
;

2009 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
))

2010 
	`›“80211_vif_cfg_chªge_nÙify
(
sd©a
,

2011 
BSS_CHANGED_SSID
);

2013 
chªged
 |ğ
BSS_CHANGED_SSID
;

2015 ià(
sd©a
->
vif
.
bss_cÚf
.
ám_»¥Úd”
 == 1 &&

2016 
	`why_ext_ã©u»_is£t
(
sd©a
->
loÿl
->
hw
.
why
,

2017 
NL80211_EXT_FEATURE_ENABLE_FTM_RESPONDER
))

2018 
chªged
 |ğ
BSS_CHANGED_FTM_RESPONDER
;

2020 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
) {

2021 
chªged
 |ğ
BSS_CHANGED_AP_PROBE_RESP
;

2023 ià(
	`›“80211_vif_is_mld
(&
sd©a
->
vif
)) {

2024 
	`›“80211_»cÚfig_­_lšks
(
loÿl
,

2025 
sd©a
,

2026 
chªged
);

2030 ià(
	`rcu_acûss_poš‹r
(
sd©a
->
deæšk
.
u
.
­
.
b—cÚ
))

2031 
	`drv_¡¬t_­
(
loÿl
, 
sd©a
,

2032 
sd©a
->
deæšk
.
cÚf
);

2034 
çÎthrough
;

2035 
NL80211_IFTYPE_MESH_POINT
:

2036 ià(
sd©a
->
vif
.
bss_cÚf
.
’abË_b—cÚ
) {

2037 
chªged
 |ğ
BSS_CHANGED_BEACON
 |

2038 
BSS_CHANGED_BEACON_ENABLED
;

2039 
	`›“80211_bss_šfo_chªge_nÙify
(
sd©a
, 
chªged
);

2042 
NL80211_IFTYPE_NAN
:

2043 
»s
 = 
	`›“80211_»cÚfig_Çn
(
sd©a
);

2044 ià(
»s
 < 0) {

2045 
	`›“80211_hªdË_»cÚfig_çu»
(
loÿl
);

2046  
»s
;

2049 
NL80211_IFTYPE_AP_VLAN
:

2050 
NL80211_IFTYPE_MONITOR
:

2051 
NL80211_IFTYPE_P2P_DEVICE
:

2054 
NL80211_IFTYPE_UNSPECIFIED
:

2055 
NUM_NL80211_IFTYPES
:

2056 
NL80211_IFTYPE_P2P_CLIENT
:

2057 
NL80211_IFTYPE_P2P_GO
:

2058 
NL80211_IFTYPE_WDS
:

2059 
	`WARN_ON
(1);

2063 ià(
aùive_lšks
)

2064 
	`›“80211_£t_aùive_lšks
(&
sd©a
->
vif
, 
aùive_lšks
);

2067 
	`›“80211_»ÿlc_ps
(
loÿl
);

2075 ià(!(
loÿl
->
hw
.
cÚf
.
æags
 & 
IEEE80211_CONF_PS
)) {

2076 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2077 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

2079 ià(!
sd©a
->
u
.
mgd
.
assocŸ‹d
)

2082 
	`›“80211_£nd_nuÎfunc
(
loÿl
, 
sd©a
, 
çl£
);

2087 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2088 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

2091 
sd©a
->
vif
.
ty³
) {

2092 
NL80211_IFTYPE_AP_VLAN
:

2093 
NL80211_IFTYPE_AP
:

2094 
	`›“80211_»cÚfig_¡©iÚs
(
sd©a
);

2102 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
)

2103 
	`›“80211_»’abË_keys
(
sd©a
);

2106 
sched_sÿn_sd©a
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->sched_scan_sdata,

2107 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

2108 
sched_sÿn_»q
 = 
	`rcu_d”eã»nû_´Ùeùed
(
loÿl
->sched_scan_req,

2109 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

2110 ià(
sched_sÿn_sd©a
 && 
sched_sÿn_»q
)

2118 ià(
sched_sÿn_»q
->
n_sÿn_¶ªs
 > 1 ||

2119 
	`__›“80211_»que¡_sched_sÿn_¡¬t
(
sched_sÿn_sd©a
,

2120 
sched_sÿn_»q
)) {

2121 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_sd©a
, 
NULL
);

2122 
	`RCU_INIT_POINTER
(
loÿl
->
sched_sÿn_»q
, 
NULL
);

2123 
sched_sÿn_¡İ³d
 = 
Œue
;

2126 ià(
sched_sÿn_¡İ³d
)

2127 
	`cfg80211_sched_sÿn_¡İ³d_locked
(
loÿl
->
hw
.
why
, 0);

2129 
wake_up
:

2131 ià(
loÿl
->
mÚ™Üs
 =ğloÿl->
İ’_couÁ
 &&†ocal->monitors > 0)

2132 
	`›“80211_add_vœtu®_mÚ™Ü
(
loÿl
);

2144 ià(
	`›“80211_hw_check
(
hw
, 
AMPDU_AGGREGATION
)) {

2145 
	`li¡_fÜ_—ch_’Œy
(
¡a
, &
loÿl
->
¡a_li¡
, 
li¡
) {

2146 ià(!
loÿl
->
»sumšg
)

2147 
	`›“80211_¡a_‹¬_down_BA_£ssiÚs
(

2148 
¡a
, 
AGG_STOP_LOCAL_REQUEST
);

2149 
	`ş—r_¡a_æag
(
¡a
, 
WLAN_STA_BLOCK_BA
);

2157 ià(
loÿl
->
İ’_couÁ
 && (!
su¥’ded
 || 
»cÚfig_due_to_wowÏn
))

2158 
	`drv_»cÚfig_com¶‘e
(
loÿl
, 
IEEE80211_RECONFIG_TYPE_RESTART
);

2160 ià(
loÿl
->
š_»cÚfig
) {

2161 
š_»cÚfig
 = 
loÿl
->in_reconfig;

2162 
loÿl
->
š_»cÚfig
 = 
çl£
;

2163 
	`b¬r›r
();

2166 
	`›“80211_¡¬t_Ãxt_roc
(
loÿl
);

2169 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
)

2170 
	`why_wÜk_queue
(
loÿl
->
hw
.
why
, &
sd©a
->
wÜk
);

2173 
	`›“80211_wake_queues_by_»asÚ
(
hw
, 
IEEE80211_MAX_QUEUE_MAP
,

2174 
IEEE80211_QUEUE_STOP_REASON_SUSPEND
,

2175 
çl£
);

2177 ià(
š_»cÚfig
) {

2178 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2179 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

2181 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

2182 
	`›“80211_¡a_»¡¬t
(
sd©a
);

2186 ià(!
su¥’ded
)

2189 #ifdeà
CONFIG_PM


2191 
loÿl
->
su¥’ded
 = 
çl£
;

2192 
	`mb
();

2193 
loÿl
->
»sumšg
 = 
çl£
;

2195 
	`›“80211_æush_com¶‘ed_sÿn
(
loÿl
, 
çl£
);

2197 ià(
loÿl
->
İ’_couÁ
 && !
»cÚfig_due_to_wowÏn
)

2198 
	`drv_»cÚfig_com¶‘e
(
loÿl
, 
IEEE80211_RECONFIG_TYPE_SUSPEND
);

2200 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

2201 ià(!
	`›“80211_sd©a_ruÂšg
(
sd©a
))

2203 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
)

2204 
	`›“80211_¡a_»¡¬t
(
sd©a
);

2207 
	`mod_tim”
(&
loÿl
->
¡a_ş—nup
, 
jiff›s
 + 1);

2209 
	`WARN_ON
(1);

2213 
	}
}

2215 
	$›“80211_»cÚfig_discÚÃù
(
›“80211_vif
 *
vif
, 
u8
 
æag
)

2217 
›“80211_sub_if_d©a
 *
sd©a
;

2218 
›“80211_loÿl
 *
loÿl
;

2219 
›“80211_key
 *
key
;

2221 ià(
	`WARN_ON
(!
vif
))

2224 
sd©a
 = 
	`vif_to_sd©a
(
vif
);

2225 
loÿl
 = 
sd©a
->local;

2227 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2229 ià(
	`WARN_ON
(
æag
 & 
IEEE80211_SDATA_DISCONNECT_RESUME
 &&

2230 !
loÿl
->
»sumšg
))

2233 ià(
	`WARN_ON
(
æag
 & 
IEEE80211_SDATA_DISCONNECT_HW_RESTART
 &&

2234 !
loÿl
->
š_»cÚfig
))

2237 ià(
	`WARN_ON
(
vif
->
ty³
 !ğ
NL80211_IFTYPE_STATION
))

2240 
sd©a
->
æags
 |ğ
æag
;

2242 
	`li¡_fÜ_—ch_’Œy
(
key
, &
sd©a
->
key_li¡
, 
li¡
)

2243 
key
->
æags
 |ğ
KEY_FLAG_TAINTED
;

2244 
	}
}

2246 
	$›“80211_hw_»¡¬t_discÚÃù
(
›“80211_vif
 *
vif
)

2248 
	`›“80211_»cÚfig_discÚÃù
(
vif
, 
IEEE80211_SDATA_DISCONNECT_HW_RESTART
);

2249 
	}
}

2250 
EXPORT_SYMBOL_GPL
(
›“80211_hw_»¡¬t_discÚÃù
);

2252 
	$›“80211_»sume_discÚÃù
(
›“80211_vif
 *
vif
)

2254 
	`›“80211_»cÚfig_discÚÃù
(
vif
, 
IEEE80211_SDATA_DISCONNECT_RESUME
);

2255 
	}
}

2256 
EXPORT_SYMBOL_GPL
(
›“80211_»sume_discÚÃù
);

2258 
	$›“80211_»ÿlc_smps
(
›“80211_sub_if_d©a
 *
sd©a
,

2259 
›“80211_lšk_d©a
 *
lšk
)

2261 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2262 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

2263 
›“80211_chªùx
 *
chªùx
;

2265 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2267 
chªùx_cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
lšk
->
cÚf
->chanctx_conf,

2268 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

2276 ià(!
chªùx_cÚf
)

2279 
chªùx
 = 
	`cÚš”_of
(
chªùx_cÚf
, 
›“80211_chªùx
, 
cÚf
);

2280 
	`›“80211_»ÿlc_smps_chªùx
(
loÿl
, 
chªùx
);

2281 
	}
}

2283 
	$›“80211_»ÿlc_mš_chªdef
(
›“80211_sub_if_d©a
 *
sd©a
,

2284 
lšk_id
)

2286 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

2287 
›“80211_chªùx_cÚf
 *
chªùx_cÚf
;

2288 
›“80211_chªùx
 *
chªùx
;

2289 
i
;

2291 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

2293 
i
 = 0; i < 
	`ARRAY_SIZE
(
sd©a
->
vif
.
lšk_cÚf
); i++) {

2294 
›“80211_bss_cÚf
 *
bss_cÚf
;

2296 ià(
lšk_id
 >ğ0 &&†šk_id !ğ
i
)

2299 
	`rcu_»ad_lock
();

2300 
bss_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.
lšk_cÚf
[
i
]);

2301 ià(!
bss_cÚf
) {

2302 
	`rcu_»ad_uÆock
();

2306 
chªùx_cÚf
 = 
	`rcu_d”eã»nû_´Ùeùed
(
bss_cÚf
->chanctx_conf,

2307 
	`lockd•_is_h–d
(&
loÿl
->
hw
.
why
->
mtx
));

2316 
	`rcu_»ad_uÆock
();

2318 ià(!
chªùx_cÚf
)

2321 
chªùx
 = 
	`cÚš”_of
(
chªùx_cÚf
, 
›“80211_chªùx
,

2322 
cÚf
);

2323 
	`›“80211_»ÿlc_chªùx_mš_def
(
loÿl
, 
chªùx
, 
NULL
);

2325 
	}
}

2327 
size_t
 
	$›“80211_›_¥l™_v’dÜ
(cÚ¡ 
u8
 *
›s
, 
size_t
 
›Ën
, size_ˆ
off£t
)

2329 
size_t
 
pos
 = 
off£t
;

2331 
pos
 < 
›Ën
 && 
›s
[pos] !ğ
WLAN_EID_VENDOR_SPECIFIC
)

2332 
pos
 +ğ2 + 
›s
[pos + 1];

2334  
pos
;

2335 
	}
}

2337 
u8
 *
	$›“80211_›_bud_ht_ÿp
(
u8
 *
pos
, 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
,

2338 
u16
 
ÿp
)

2340 
__Ë16
 
tmp
;

2342 *
pos
++ = 
WLAN_EID_HT_CAPABILITY
;

2343 *
pos
++ = (
›“80211_ht_ÿp
);

2344 
	`mem£t
(
pos
, 0, (
›“80211_ht_ÿp
));

2347 
tmp
 = 
	`ıu_to_Ë16
(
ÿp
);

2348 
	`memıy
(
pos
, &
tmp
, (
u16
));

2349 
pos
 +ğ(
u16
);

2352 *
pos
++ = 
ht_ÿp
->
ampdu_çùÜ
 |

2353 (
ht_ÿp
->
ampdu_d’s™y
 <<

2354 
IEEE80211_HT_AMPDU_PARM_DENSITY_SHIFT
);

2357 
	`memıy
(
pos
, &
ht_ÿp
->
mcs
, (ht_cap->mcs));

2358 
pos
 +ğ(
ht_ÿp
->
mcs
);

2361 
pos
 +ğ(
__Ë16
);

2364 
pos
 +ğ(
__Ë32
);

2367 
pos
 +ğ(
u8
);

2369  
pos
;

2370 
	}
}

2372 
u8
 *
	$›“80211_›_bud_vht_ÿp
(
u8
 *
pos
, 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
,

2373 
u32
 
ÿp
)

2375 
__Ë32
 
tmp
;

2377 *
pos
++ = 
WLAN_EID_VHT_CAPABILITY
;

2378 *
pos
++ = (
›“80211_vht_ÿp
);

2379 
	`mem£t
(
pos
, 0, (
›“80211_vht_ÿp
));

2382 
tmp
 = 
	`ıu_to_Ë32
(
ÿp
);

2383 
	`memıy
(
pos
, &
tmp
, (
u32
));

2384 
pos
 +ğ(
u32
);

2387 
	`memıy
(
pos
, &
vht_ÿp
->
vht_mcs
, (vht_cap->vht_mcs));

2388 
pos
 +ğ(
vht_ÿp
->
vht_mcs
);

2390  
pos
;

2391 
	}
}

2394 
u8
 
	$›“80211_›_Ën_he_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
)

2396 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
;

2397 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

2398 
u8
 
n
;

2400 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

2401 ià(!
sbªd
)

2404 
he_ÿp
 = 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

2405 ià(!
he_ÿp
)

2408 
n
 = 
	`›“80211_he_mcs_nss_size
(&
he_ÿp
->
he_ÿp_–em
);

2410 (
he_ÿp
->
he_ÿp_–em
è+ 
n
 +

2411 
	`›“80211_he_µe_size
(
he_ÿp
->
µe_th»s
[0],

2412 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
);

2413 
	}
}

2416 
	$›“80211_g‘_adju¡ed_he_ÿp
(cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
,

2417 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
,

2418 
›“80211_he_ÿp_–em
 *
–em
)

2420 
u8
 
ru_lim™
, 
max_ru
;

2422 *
–em
 = 
he_ÿp
->
he_ÿp_–em
;

2424 
cÚn
->
bw_lim™
) {

2425 
IEEE80211_CONN_BW_LIMIT_20
:

2426 
ru_lim™
 = 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_242
;

2428 
IEEE80211_CONN_BW_LIMIT_40
:

2429 
ru_lim™
 = 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_484
;

2431 
IEEE80211_CONN_BW_LIMIT_80
:

2432 
ru_lim™
 = 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_996
;

2435 
ru_lim™
 = 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_2x996
;

2439 
max_ru
 = 
–em
->
phy_ÿp_šfo
[8] & 
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_MASK
;

2440 
max_ru
 = 
	`mš
(max_ru, 
ru_lim™
);

2441 
–em
->
phy_ÿp_šfo
[8] &ğ~
IEEE80211_HE_PHY_CAP8_DCM_MAX_RU_MASK
;

2442 
–em
->
phy_ÿp_šfo
[8] |ğ
max_ru
;

2444 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_40
) {

2445 
–em
->
phy_ÿp_šfo
[0] &=

2446 ~(
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_80MHZ_IN_5G
 |

2447 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
);

2448 
–em
->
phy_ÿp_šfo
[9] &=

2449 ~
IEEE80211_HE_PHY_CAP9_LONGER_THAN_16_SIGB_OFDM_SYM
;

2452 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_160
) {

2453 
–em
->
phy_ÿp_šfo
[0] &=

2454 ~(
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
 |

2455 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
);

2456 
–em
->
phy_ÿp_šfo
[5] &=

2457 ~
IEEE80211_HE_PHY_CAP5_BEAMFORMEE_NUM_SND_DIM_ABOVE_80MHZ_MASK
;

2458 
–em
->
phy_ÿp_šfo
[7] &=

2459 ~(
IEEE80211_HE_PHY_CAP7_STBC_TX_ABOVE_80MHZ
 |

2460 
IEEE80211_HE_PHY_CAP7_STBC_RX_ABOVE_80MHZ
);

2462 
	}
}

2464 
	$›“80211_put_he_ÿp
(
sk_buff
 *
skb
,

2465 
›“80211_sub_if_d©a
 *
sd©a
,

2466 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

2467 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
)

2469 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
;

2470 
›“80211_he_ÿp_–em
 
–em
;

2471 
u8
 *
Ën
;

2472 
u8
 
n
;

2473 
u8
 
›_Ën
;

2475 ià(!
cÚn
)

2476 
cÚn
 = &
›“80211_cÚn_£‰šgs_uÆim™ed
;

2478 
he_ÿp
 = 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

2479 ià(!
he_ÿp
)

2483 
	`›“80211_g‘_adju¡ed_he_ÿp
(
cÚn
, 
he_ÿp
, &
–em
);

2485 
n
 = 
	`›“80211_he_mcs_nss_size
(&
–em
);

2486 
›_Ën
 = 2 + 1 +

2487 (
he_ÿp
->
he_ÿp_–em
è+ 
n
 +

2488 
	`›“80211_he_µe_size
(
he_ÿp
->
µe_th»s
[0],

2489 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
);

2491 ià(
	`skb_room
(
skb
è< 
›_Ën
)

2492  -
ENOBUFS
;

2494 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXTENSION
);

2495 
Ën
 = 
	`skb_put
(
skb
, 1);

2496 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXT_HE_CAPABILITY
);

2499 
	`skb_put_d©a
(
skb
, &
–em
, (elem));

2501 
	`skb_put_d©a
(
skb
, &
he_ÿp
->
he_mcs_nss_suµ
, 
n
);

2504 ià((
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[6] &

2505 
IEEE80211_HE_PHY_CAP6_PPE_THRESHOLD_PRESENT
) == 0)

2506 
’d
;

2512 
n
 = 
	`hweight8
(
he_ÿp
->
µe_th»s
[0] &

2513 
IEEE80211_PPE_THRES_RU_INDEX_BITMASK_MASK
);

2514 
n
 *ğ(1 + ((
he_ÿp
->
µe_th»s
[0] & 
IEEE80211_PPE_THRES_NSS_MASK
) >>

2515 
IEEE80211_PPE_THRES_NSS_POS
));

2521 
n
 = (À* 
IEEE80211_PPE_THRES_INFO_PPET_SIZE
 * 2) + 7;

2522 
n
 = 
	`DIV_ROUND_UP
(n, 8);

2525 
	`skb_put_d©a
(
skb
, &
he_ÿp
->
µe_th»s
, 
n
);

2527 
’d
:

2528 *
Ën
 = 
	`skb__poš‹r
(
skb
) -†en - 1;

2530 
	}
}

2532 
	$›“80211_put_he_6ghz_ÿp
(
sk_buff
 *
skb
,

2533 
›“80211_sub_if_d©a
 *
sd©a
,

2534 
›“80211_smps_mode
 
smps_mode
)

2536 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

2537 cÚ¡ 
›“80211_sbªd_iáy³_d©a
 *
iád
;

2538 
Æ80211_iáy³
 
iáy³
 = 
	`›“80211_vif_ty³_p2p
(&
sd©a
->
vif
);

2539 
__Ë16
 
ÿp
;

2541 ià(!
	`cfg80211_ªy_u§bË_chªÃls
(
sd©a
->
loÿl
->
hw
.
why
,

2542 
	`BIT
(
NL80211_BAND_6GHZ
),

2543 
IEEE80211_CHAN_NO_HE
))

2546 
sbªd
 = 
sd©a
->
loÿl
->
hw
.
why
->
bªds
[
NL80211_BAND_6GHZ
];

2548 
iád
 = 
	`›“80211_g‘_sbªd_iáy³_d©a
(
sbªd
, 
iáy³
);

2549 ià(!
iád
)

2553 ià(!
iád
->
he_6ghz_ÿ·
.
ÿ·
)

2556 
ÿp
 = 
iád
->
he_6ghz_ÿ·
.
ÿ·
;

2557 
ÿp
 &ğ
	`ıu_to_Ë16
(~
IEEE80211_HE_6GHZ_CAP_SM_PS
);

2559 
smps_mode
) {

2560 
IEEE80211_SMPS_AUTOMATIC
:

2561 
IEEE80211_SMPS_NUM_MODES
:

2562 
	`WARN_ON
(1);

2563 
çÎthrough
;

2564 
IEEE80211_SMPS_OFF
:

2565 
ÿp
 |ğ
	`Ë16_’code_b™s
(
WLAN_HT_CAP_SM_PS_DISABLED
,

2566 
IEEE80211_HE_6GHZ_CAP_SM_PS
);

2568 
IEEE80211_SMPS_STATIC
:

2569 
ÿp
 |ğ
	`Ë16_’code_b™s
(
WLAN_HT_CAP_SM_PS_STATIC
,

2570 
IEEE80211_HE_6GHZ_CAP_SM_PS
);

2572 
IEEE80211_SMPS_DYNAMIC
:

2573 
ÿp
 |ğ
	`Ë16_’code_b™s
(
WLAN_HT_CAP_SM_PS_DYNAMIC
,

2574 
IEEE80211_HE_6GHZ_CAP_SM_PS
);

2578 ià(
	`skb_room
(
skb
è< 2 + 1 + (
ÿp
))

2579  -
ENOBUFS
;

2581 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXTENSION
);

2582 
	`skb_put_u8
(
skb
, 1 + (
ÿp
));

2583 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXT_HE_6GHZ_CAPA
);

2584 
	`skb_put_d©a
(
skb
, &
ÿp
, (cap));

2586 
	}
}

2588 
u8
 *
	$›“80211_›_bud_ht_İ”
(
u8
 *
pos
, 
›“80211_¡a_ht_ÿp
 *
ht_ÿp
,

2589 cÚ¡ 
cfg80211_chª_def
 *
chªdef
,

2590 
u16
 
´Ù_mode
, 
boŞ
 
rifs_mode
)

2592 
›“80211_ht_İ”©iÚ
 *
ht_İ”
;

2594 *
pos
++ = 
WLAN_EID_HT_OPERATION
;

2595 *
pos
++ = (
›“80211_ht_İ”©iÚ
);

2596 
ht_İ”
 = (
›“80211_ht_İ”©iÚ
 *)
pos
;

2597 
ht_İ”
->
´im¬y_chª
 = 
	`›“80211_äequ’cy_to_chªÃl
(

2598 
chªdef
->
chª
->
ûÁ”_äeq
);

2599 
chªdef
->
width
) {

2600 
NL80211_CHAN_WIDTH_160
:

2601 
NL80211_CHAN_WIDTH_80P80
:

2602 
NL80211_CHAN_WIDTH_80
:

2603 
NL80211_CHAN_WIDTH_40
:

2604 ià(
chªdef
->
ûÁ”_äeq1
 > chªdef->
chª
->
ûÁ”_äeq
)

2605 
ht_İ”
->
ht_·¿m
 = 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
;

2607 
ht_İ”
->
ht_·¿m
 = 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
;

2609 
NL80211_CHAN_WIDTH_320
:

2611 
	`WARN_ON
(1);

2612  
pos
;

2614 
ht_İ”
->
ht_·¿m
 = 
IEEE80211_HT_PARAM_CHA_SEC_NONE
;

2617 ià(
ht_ÿp
->
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 &&

2618 
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_20_NOHT
 &&

2619 
chªdef
->
width
 !ğ
NL80211_CHAN_WIDTH_20
)

2620 
ht_İ”
->
ht_·¿m
 |ğ
IEEE80211_HT_PARAM_CHAN_WIDTH_ANY
;

2622 ià(
rifs_mode
)

2623 
ht_İ”
->
ht_·¿m
 |ğ
IEEE80211_HT_PARAM_RIFS_MODE
;

2625 
ht_İ”
->
İ”©iÚ_mode
 = 
	`ıu_to_Ë16
(
´Ù_mode
);

2626 
ht_İ”
->
¡bc_·¿m
 = 0x0000;

2630 
	`mem£t
(&
ht_İ”
->
basic_£t
, 0, 16);

2631 
	`memıy
(&
ht_İ”
->
basic_£t
, &
ht_ÿp
->
mcs
, 10);

2633  
pos
 + (
›“80211_ht_İ”©iÚ
);

2634 
	}
}

2636 
	$›“80211_›_bud_wide_bw_cs
(
u8
 *
pos
,

2637 cÚ¡ 
cfg80211_chª_def
 *
chªdef
)

2639 *
pos
++ = 
WLAN_EID_WIDE_BW_CHANNEL_SWITCH
;

2640 *
pos
++ = 3;

2642 
chªdef
->
width
) {

2643 
NL80211_CHAN_WIDTH_80
:

2644 *
pos
++ = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

2646 
NL80211_CHAN_WIDTH_160
:

2647 *
pos
++ = 
IEEE80211_VHT_CHANWIDTH_160MHZ
;

2649 
NL80211_CHAN_WIDTH_80P80
:

2650 *
pos
++ = 
IEEE80211_VHT_CHANWIDTH_80P80MHZ
;

2652 
NL80211_CHAN_WIDTH_320
:

2654 
	`WARN_ON
(1);

2655 
çÎthrough
;

2657 *
pos
++ = 
IEEE80211_VHT_CHANWIDTH_USE_HT
;

2661 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq1
);

2663 ià(
chªdef
->
ûÁ”_äeq2
)

2664 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq2
);

2666 *
pos
++ = 0;

2667 
	}
}

2669 
u8
 *
	$›“80211_›_bud_vht_İ”
(
u8
 *
pos
, 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
,

2670 cÚ¡ 
cfg80211_chª_def
 *
chªdef
)

2672 
›“80211_vht_İ”©iÚ
 *
vht_İ”
;

2674 *
pos
++ = 
WLAN_EID_VHT_OPERATION
;

2675 *
pos
++ = (
›“80211_vht_İ”©iÚ
);

2676 
vht_İ”
 = (
›“80211_vht_İ”©iÚ
 *)
pos
;

2677 
vht_İ”
->
ûÁ”_äeq_£g0_idx
 = 
	`›“80211_äequ’cy_to_chªÃl
(

2678 
chªdef
->
ûÁ”_äeq1
);

2679 ià(
chªdef
->
ûÁ”_äeq2
)

2680 
vht_İ”
->
ûÁ”_äeq_£g1_idx
 =

2681 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq2
);

2683 
vht_İ”
->
ûÁ”_äeq_£g1_idx
 = 0x00;

2685 
chªdef
->
width
) {

2686 
NL80211_CHAN_WIDTH_160
:

2691 
vht_İ”
->
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

2692 
vht_İ”
->
ûÁ”_äeq_£g1_idx
 = vht_İ”->
ûÁ”_äeq_£g0_idx
;

2693 ià(
chªdef
->
chª
->
ûÁ”_äeq
 < chªdef->
ûÁ”_äeq1
)

2694 
vht_İ”
->
ûÁ”_äeq_£g0_idx
 -= 8;

2696 
vht_İ”
->
ûÁ”_äeq_£g0_idx
 += 8;

2698 
NL80211_CHAN_WIDTH_80P80
:

2703 
vht_İ”
->
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

2705 
NL80211_CHAN_WIDTH_80
:

2706 
vht_İ”
->
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_80MHZ
;

2708 
NL80211_CHAN_WIDTH_320
:

2710 
	`WARN_ON
(1);

2711  
pos
;

2713 
vht_İ”
->
chª_width
 = 
IEEE80211_VHT_CHANWIDTH_USE_HT
;

2718 
vht_İ”
->
basic_mcs_£t
 = 
	`ıu_to_Ë16
(0xffff);

2720  
pos
 + (
›“80211_vht_İ”©iÚ
);

2721 
	}
}

2723 
u8
 *
	$›“80211_›_bud_he_İ”
(
u8
 *
pos
, 
cfg80211_chª_def
 *
chªdef
)

2725 
›“80211_he_İ”©iÚ
 *
he_İ”
;

2726 
›“80211_he_6ghz_İ”
 *
he_6ghz_İ
;

2727 
u32
 
he_İ”_·¿ms
;

2728 
u8
 
›_Ën
 = 1 + (
›“80211_he_İ”©iÚ
);

2730 ià(
chªdef
->
chª
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

2731 
›_Ën
 +ğ(
›“80211_he_6ghz_İ”
);

2733 *
pos
++ = 
WLAN_EID_EXTENSION
;

2734 *
pos
++ = 
›_Ën
;

2735 *
pos
++ = 
WLAN_EID_EXT_HE_OPERATION
;

2737 
he_İ”_·¿ms
 = 0;

2738 
he_İ”_·¿ms
 |ğ
	`u32_’code_b™s
(1023,

2739 
IEEE80211_HE_OPERATION_RTS_THRESHOLD_MASK
);

2740 
he_İ”_·¿ms
 |ğ
	`u32_’code_b™s
(1,

2741 
IEEE80211_HE_OPERATION_ER_SU_DISABLE
);

2742 
he_İ”_·¿ms
 |ğ
	`u32_’code_b™s
(1,

2743 
IEEE80211_HE_OPERATION_BSS_COLOR_DISABLED
);

2744 ià(
chªdef
->
chª
->
bªd
 =ğ
NL80211_BAND_6GHZ
)

2745 
he_İ”_·¿ms
 |ğ
	`u32_’code_b™s
(1,

2746 
IEEE80211_HE_OPERATION_6GHZ_OP_INFO
);

2748 
he_İ”
 = (
›“80211_he_İ”©iÚ
 *)
pos
;

2749 
he_İ”
->
he_İ”_·¿ms
 = 
	`ıu_to_Ë32
(he_oper_params);

2752 
he_İ”
->
he_mcs_nss_£t
 = 
	`ıu_to_Ë16
(0xffff);

2753 
pos
 +ğ(
›“80211_he_İ”©iÚ
);

2755 ià(
chªdef
->
chª
->
bªd
 !ğ
NL80211_BAND_6GHZ
)

2756 
out
;

2759 
he_6ghz_İ
 = (
›“80211_he_6ghz_İ”
 *)
pos
;

2760 
he_6ghz_İ
->
mš¿‹
 = 6;

2761 
he_6ghz_İ
->
´im¬y
 =

2762 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
chª
->
ûÁ”_äeq
);

2763 
he_6ghz_İ
->
ccfs0
 =

2764 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq1
);

2765 ià(
chªdef
->
ûÁ”_äeq2
)

2766 
he_6ghz_İ
->
ccfs1
 =

2767 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq2
);

2769 
he_6ghz_İ
->
ccfs1
 = 0;

2771 
chªdef
->
width
) {

2772 
NL80211_CHAN_WIDTH_320
:

2777 
	`WARN_ON
(1);

2779 
NL80211_CHAN_WIDTH_160
:

2783 
he_6ghz_İ
->
cÚŒŞ
 =

2784 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_160MHZ
;

2785 
he_6ghz_İ
->
ccfs1
 = he_6ghz_İ->
ccfs0
;

2786 ià(
chªdef
->
chª
->
ûÁ”_äeq
 < chªdef->
ûÁ”_äeq1
)

2787 
he_6ghz_İ
->
ccfs0
 -= 8;

2789 
he_6ghz_İ
->
ccfs0
 += 8;

2790 
çÎthrough
;

2791 
NL80211_CHAN_WIDTH_80P80
:

2792 
he_6ghz_İ
->
cÚŒŞ
 =

2793 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_160MHZ
;

2795 
NL80211_CHAN_WIDTH_80
:

2796 
he_6ghz_İ
->
cÚŒŞ
 =

2797 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_80MHZ
;

2799 
NL80211_CHAN_WIDTH_40
:

2800 
he_6ghz_İ
->
cÚŒŞ
 =

2801 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_40MHZ
;

2804 
he_6ghz_İ
->
cÚŒŞ
 =

2805 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_20MHZ
;

2809 
pos
 +ğ(
›“80211_he_6ghz_İ”
);

2811 
out
:

2812  
pos
;

2813 
	}
}

2815 
u8
 *
	$›“80211_›_bud_eht_İ”
(
u8
 *
pos
, 
cfg80211_chª_def
 *
chªdef
,

2816 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
)

2819 cÚ¡ 
›“80211_eht_mcs_nss_suµ_20mhz_Úly
 *
eht_mcs_nss
 =

2820 &
eht_ÿp
->
eht_mcs_nss_suµ
.
Úly_20mhz
;

2821 
›“80211_eht_İ”©iÚ
 *
eht_İ”
;

2822 
›“80211_eht_İ”©iÚ_šfo
 *
eht_İ”_šfo
;

2823 
u8
 
eht_İ”_Ën
 = 
	`off£tof
(
›“80211_eht_İ”©iÚ
, 
İtiÚ®
);

2824 
u8
 
eht_İ”_šfo_Ën
 =

2825 
	`off£tof
(
›“80211_eht_İ”©iÚ_šfo
, 
İtiÚ®
);

2826 
u8
 
chª_width
 = 0;

2828 *
pos
++ = 
WLAN_EID_EXTENSION
;

2829 *
pos
++ = 1 + 
eht_İ”_Ën
 + 
eht_İ”_šfo_Ën
;

2830 *
pos
++ = 
WLAN_EID_EXT_EHT_OPERATION
;

2832 
eht_İ”
 = (
›“80211_eht_İ”©iÚ
 *)
pos
;

2834 
	`memıy
(&
eht_İ”
->
basic_mcs_nss
, 
eht_mcs_nss
, (*eht_mcs_nss));

2835 
eht_İ”
->
·¿ms
 |ğ
IEEE80211_EHT_OPER_INFO_PRESENT
;

2836 
pos
 +ğ
eht_İ”_Ën
;

2838 
eht_İ”_šfo
 =

2839 (
›“80211_eht_İ”©iÚ_šfo
 *)
eht_İ”
->
İtiÚ®
;

2841 
eht_İ”_šfo
->
ccfs0
 =

2842 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq1
);

2843 ià(
chªdef
->
ûÁ”_äeq2
)

2844 
eht_İ”_šfo
->
ccfs1
 =

2845 
	`›“80211_äequ’cy_to_chªÃl
(
chªdef
->
ûÁ”_äeq2
);

2847 
eht_İ”_šfo
->
ccfs1
 = 0;

2849 
chªdef
->
width
) {

2850 
NL80211_CHAN_WIDTH_320
:

2851 
chª_width
 = 
IEEE80211_EHT_OPER_CHAN_WIDTH_320MHZ
;

2852 
eht_İ”_šfo
->
ccfs1
 =ƒht_İ”_šfo->
ccfs0
;

2853 ià(
chªdef
->
chª
->
ûÁ”_äeq
 < chªdef->
ûÁ”_äeq1
)

2854 
eht_İ”_šfo
->
ccfs0
 -= 16;

2856 
eht_İ”_šfo
->
ccfs0
 += 16;

2858 
NL80211_CHAN_WIDTH_160
:

2859 
eht_İ”_šfo
->
ccfs1
 =ƒht_İ”_šfo->
ccfs0
;

2860 ià(
chªdef
->
chª
->
ûÁ”_äeq
 < chªdef->
ûÁ”_äeq1
)

2861 
eht_İ”_šfo
->
ccfs0
 -= 8;

2863 
eht_İ”_šfo
->
ccfs0
 += 8;

2864 
çÎthrough
;

2865 
NL80211_CHAN_WIDTH_80P80
:

2866 
chª_width
 = 
IEEE80211_EHT_OPER_CHAN_WIDTH_160MHZ
;

2868 
NL80211_CHAN_WIDTH_80
:

2869 
chª_width
 = 
IEEE80211_EHT_OPER_CHAN_WIDTH_80MHZ
;

2871 
NL80211_CHAN_WIDTH_40
:

2872 
chª_width
 = 
IEEE80211_EHT_OPER_CHAN_WIDTH_40MHZ
;

2875 
chª_width
 = 
IEEE80211_EHT_OPER_CHAN_WIDTH_20MHZ
;

2878 
eht_İ”_šfo
->
cÚŒŞ
 = 
chª_width
;

2879 
pos
 +ğ
eht_İ”_šfo_Ën
;

2883  
pos
;

2884 
	}
}

2886 
boŞ
 
	$›“80211_chªdef_ht_İ”
(cÚ¡ 
›“80211_ht_İ”©iÚ
 *
ht_İ”
,

2887 
cfg80211_chª_def
 *
chªdef
)

2889 
Æ80211_chªÃl_ty³
 
chªÃl_ty³
;

2891 ià(!
ht_İ”
)

2892  
çl£
;

2894 
ht_İ”
->
ht_·¿m
 & 
IEEE80211_HT_PARAM_CHA_SEC_OFFSET
) {

2895 
IEEE80211_HT_PARAM_CHA_SEC_NONE
:

2896 
chªÃl_ty³
 = 
NL80211_CHAN_HT20
;

2898 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
:

2899 
chªÃl_ty³
 = 
NL80211_CHAN_HT40PLUS
;

2901 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
:

2902 
chªÃl_ty³
 = 
NL80211_CHAN_HT40MINUS
;

2905  
çl£
;

2908 
	`cfg80211_chªdef_ü—‹
(
chªdef
, chªdef->
chª
, 
chªÃl_ty³
);

2909  
Œue
;

2910 
	}
}

2912 
boŞ
 
	$›“80211_chªdef_vht_İ”
(
›“80211_hw
 *
hw
, 
u32
 
vht_ÿp_šfo
,

2913 cÚ¡ 
›“80211_vht_İ”©iÚ
 *
İ”
,

2914 cÚ¡ 
›“80211_ht_İ”©iÚ
 *
htİ
,

2915 
cfg80211_chª_def
 *
chªdef
)

2917 
cfg80211_chª_def
 
Ãw
 = *
chªdef
;

2918 
cf0
, 
cf1
;

2919 
ccfs0
, 
ccfs1
, 
ccfs2
;

2920 
ccf0
, 
ccf1
;

2921 
u32
 
vht_ÿp
;

2922 
boŞ
 
suµÜt_80_80
 = 
çl£
;

2923 
boŞ
 
suµÜt_160
 = 
çl£
;

2924 
u8
 
ext_nss_bw_suµ
 = 
	`u32_g‘_b™s
(
vht_ÿp_šfo
,

2925 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
);

2926 
u8
 
suµ_chwidth
 = 
	`u32_g‘_b™s
(
vht_ÿp_šfo
,

2927 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
);

2929 ià(!
İ”
 || !
htİ
)

2930  
çl£
;

2932 
vht_ÿp
 = 
hw
->
why
->
bªds
[
chªdef
->
chª
->
bªd
]->vht_ÿp.
ÿp
;

2933 
suµÜt_160
 = (
vht_ÿp
 & (
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
 |

2934 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
));

2935 
suµÜt_80_80
 = ((
vht_ÿp
 &

2936 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
) ||

2937 (
vht_ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
 &&

2938 
vht_ÿp
 & 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
) ||

2939 ((
vht_ÿp
 & 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
) >>

2940 
IEEE80211_VHT_CAP_EXT_NSS_BW_SHIFT
 > 1));

2941 
ccfs0
 = 
İ”
->
ûÁ”_äeq_£g0_idx
;

2942 
ccfs1
 = 
İ”
->
ûÁ”_äeq_£g1_idx
;

2943 
ccfs2
 = (
	`Ë16_to_ıu
(
htİ
->
İ”©iÚ_mode
) &

2944 
IEEE80211_HT_OP_MODE_CCFS2_MASK
)

2945 >> 
IEEE80211_HT_OP_MODE_CCFS2_SHIFT
;

2947 
ccf0
 = 
ccfs0
;

2950 ià(!
	`›“80211_hw_check
(
hw
, 
SUPPORTS_VHT_EXT_NSS_BW
))

2951 
ext_nss_bw_suµ
 = 0;

2959 (
suµ_chwidth
 << 4è| 
ext_nss_bw_suµ
) {

2962 
ccf1
 = 0;

2963 
suµÜt_160
 = 
çl£
;

2964 
suµÜt_80_80
 = 
çl£
;

2967 
suµÜt_80_80
 = 
çl£
;

2968 
çÎthrough
;

2971 
ccf1
 = 
ccfs2
;

2974 
ccf1
 = 
ccfs1
;

2978 ià(!
ccfs1
)

2979 
ccf1
 = 
ccfs2
;

2981 
ccf1
 = 
ccfs1
;

2986 
ccf1
 = 
ccfs1
;

2990 
cf0
 = 
	`›“80211_chªÃl_to_äequ’cy
(
ccf0
, 
chªdef
->
chª
->
bªd
);

2991 
cf1
 = 
	`›“80211_chªÃl_to_äequ’cy
(
ccf1
, 
chªdef
->
chª
->
bªd
);

2993 
İ”
->
chª_width
) {

2994 
IEEE80211_VHT_CHANWIDTH_USE_HT
:

2997 
IEEE80211_VHT_CHANWIDTH_80MHZ
:

2998 
Ãw
.
width
 = 
NL80211_CHAN_WIDTH_80
;

2999 
Ãw
.
ûÁ”_äeq1
 = 
cf0
;

3001 ià(
ccf1
) {

3002 
diff
;

3004 
diff
 = 
	`abs
(
ccf1
 - 
ccf0
);

3005 ià((
diff
 =ğ8è&& 
suµÜt_160
) {

3006 
Ãw
.
width
 = 
NL80211_CHAN_WIDTH_160
;

3007 
Ãw
.
ûÁ”_äeq1
 = 
cf1
;

3008 } ià((
diff
 > 8è&& 
suµÜt_80_80
) {

3009 
Ãw
.
width
 = 
NL80211_CHAN_WIDTH_80P80
;

3010 
Ãw
.
ûÁ”_äeq2
 = 
cf1
;

3014 
IEEE80211_VHT_CHANWIDTH_160MHZ
:

3016 
Ãw
.
width
 = 
NL80211_CHAN_WIDTH_160
;

3017 
Ãw
.
ûÁ”_äeq1
 = 
cf0
;

3019 
IEEE80211_VHT_CHANWIDTH_80P80MHZ
:

3021 
Ãw
.
width
 = 
NL80211_CHAN_WIDTH_80P80
;

3022 
Ãw
.
ûÁ”_äeq1
 = 
cf0
;

3023 
Ãw
.
ûÁ”_äeq2
 = 
cf1
;

3026  
çl£
;

3029 ià(!
	`cfg80211_chªdef_v®id
(&
Ãw
))

3030  
çl£
;

3032 *
chªdef
 = 
Ãw
;

3033  
Œue
;

3034 
	}
}

3036 
	$›“80211_chªdef_eht_İ”
(cÚ¡ 
›“80211_eht_İ”©iÚ_šfo
 *
šfo
,

3037 
cfg80211_chª_def
 *
chªdef
)

3039 
chªdef
->
ûÁ”_äeq1
 =

3040 
	`›“80211_chªÃl_to_äequ’cy
(
šfo
->
ccfs0
,

3041 
chªdef
->
chª
->
bªd
);

3043 
	`u8_g‘_b™s
(
šfo
->
cÚŒŞ
,

3044 
IEEE80211_EHT_OPER_CHAN_WIDTH
)) {

3045 
IEEE80211_EHT_OPER_CHAN_WIDTH_20MHZ
:

3046 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_20
;

3048 
IEEE80211_EHT_OPER_CHAN_WIDTH_40MHZ
:

3049 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_40
;

3051 
IEEE80211_EHT_OPER_CHAN_WIDTH_80MHZ
:

3052 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_80
;

3054 
IEEE80211_EHT_OPER_CHAN_WIDTH_160MHZ
:

3055 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_160
;

3056 
chªdef
->
ûÁ”_äeq1
 =

3057 
	`›“80211_chªÃl_to_äequ’cy
(
šfo
->
ccfs1
,

3058 
chªdef
->
chª
->
bªd
);

3060 
IEEE80211_EHT_OPER_CHAN_WIDTH_320MHZ
:

3061 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_320
;

3062 
chªdef
->
ûÁ”_äeq1
 =

3063 
	`›“80211_chªÃl_to_äequ’cy
(
šfo
->
ccfs1
,

3064 
chªdef
->
chª
->
bªd
);

3067 
	}
}

3069 
boŞ
 
	$›“80211_chªdef_he_6ghz_İ”
(
›“80211_loÿl
 *
loÿl
,

3070 cÚ¡ 
›“80211_he_İ”©iÚ
 *
he_İ”
,

3071 cÚ¡ 
›“80211_eht_İ”©iÚ
 *
eht_İ”
,

3072 
cfg80211_chª_def
 *
chªdef
)

3074 
cfg80211_chª_def
 
he_chªdef
 = *
chªdef
;

3075 cÚ¡ 
›“80211_he_6ghz_İ”
 *
he_6ghz_İ”
;

3076 
u32
 
äeq
;

3078 ià(
chªdef
->
chª
->
bªd
 !ğ
NL80211_BAND_6GHZ
)

3079  
Œue
;

3081 ià(!
he_İ”
)

3082  
çl£
;

3084 
he_6ghz_İ”
 = 
	`›“80211_he_6ghz_İ”
(
he_İ”
);

3085 ià(!
he_6ghz_İ”
)

3086  
çl£
;

3093 
äeq
 = 
	`›“80211_chªÃl_to_äequ’cy
(
he_6ghz_İ”
->
´im¬y
,

3094 
NL80211_BAND_6GHZ
);

3095 
he_chªdef
.
chª
 = 
	`›“80211_g‘_chªÃl
(
loÿl
->
hw
.
why
, 
äeq
);

3097 ià(!
he_chªdef
.
chª
)

3098  
çl£
;

3100 ià(!
eht_İ”
 ||

3101 !(
eht_İ”
->
·¿ms
 & 
IEEE80211_EHT_OPER_INFO_PRESENT
)) {

3102 
	`u8_g‘_b™s
(
he_6ghz_İ”
->
cÚŒŞ
,

3103 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH
)) {

3104 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_20MHZ
:

3105 
he_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_20
;

3107 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_40MHZ
:

3108 
he_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_40
;

3110 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_80MHZ
:

3111 
he_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_80
;

3113 
IEEE80211_HE_6GHZ_OPER_CTRL_CHANWIDTH_160MHZ
:

3114 
he_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_80
;

3115 ià(!
he_6ghz_İ”
->
ccfs1
)

3117 ià(
	`abs
(
he_6ghz_İ”
->
ccfs1
 - he_6ghz_İ”->
ccfs0
) == 8)

3118 
he_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_160
;

3120 
he_chªdef
.
width
 = 
NL80211_CHAN_WIDTH_80P80
;

3124 ià(
he_chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_160
) {

3125 
he_chªdef
.
ûÁ”_äeq1
 =

3126 
	`›“80211_chªÃl_to_äequ’cy
(
he_6ghz_İ”
->
ccfs1
,

3127 
NL80211_BAND_6GHZ
);

3129 
he_chªdef
.
ûÁ”_äeq1
 =

3130 
	`›“80211_chªÃl_to_äequ’cy
(
he_6ghz_İ”
->
ccfs0
,

3131 
NL80211_BAND_6GHZ
);

3132 
he_chªdef
.
ûÁ”_äeq2
 =

3133 
	`›“80211_chªÃl_to_äequ’cy
(
he_6ghz_İ”
->
ccfs1
,

3134 
NL80211_BAND_6GHZ
);

3137 
	`›“80211_chªdef_eht_İ”
((cÚ¡ *)
eht_İ”
->
İtiÚ®
,

3138 &
he_chªdef
);

3141 ià(!
	`cfg80211_chªdef_v®id
(&
he_chªdef
))

3142  
çl£
;

3144 *
chªdef
 = 
he_chªdef
;

3146  
Œue
;

3147 
	}
}

3149 
boŞ
 
	$›“80211_chªdef_s1g_İ”
(cÚ¡ 
›“80211_s1g_İ”_›
 *
İ”
,

3150 
cfg80211_chª_def
 *
chªdef
)

3152 
u32
 
İ”_äeq
;

3154 ià(!
İ”
)

3155  
çl£
;

3157 
	`FIELD_GET
(
S1G_OPER_CH_WIDTH_OPER
, 
İ”
->
ch_width
)) {

3158 
IEEE80211_S1G_CHANWIDTH_1MHZ
:

3159 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_1
;

3161 
IEEE80211_S1G_CHANWIDTH_2MHZ
:

3162 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_2
;

3164 
IEEE80211_S1G_CHANWIDTH_4MHZ
:

3165 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_4
;

3167 
IEEE80211_S1G_CHANWIDTH_8MHZ
:

3168 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_8
;

3170 
IEEE80211_S1G_CHANWIDTH_16MHZ
:

3171 
chªdef
->
width
 = 
NL80211_CHAN_WIDTH_16
;

3174  
çl£
;

3177 
İ”_äeq
 = 
	`›“80211_chªÃl_to_äeq_khz
(
İ”
->
İ”_ch
,

3178 
NL80211_BAND_S1GHZ
);

3179 
chªdef
->
ûÁ”_äeq1
 = 
	`KHZ_TO_MHZ
(
İ”_äeq
);

3180 
chªdef
->
äeq1_off£t
 = 
İ”_äeq
 % 1000;

3182  
Œue
;

3183 
	}
}

3185 
	$›“80211_put_¤©es_–em
(
sk_buff
 *
skb
,

3186 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

3187 
u32
 
basic_¿‹s
, u32 
¿‹_æags
, u32 
masked_¿‹s
,

3188 
u8
 
–em’t_id
)

3190 
u8
 
i
, 
¿‹s
, 
sk
;

3192 
¿‹s
 = 0;

3193 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
; i++) {

3194 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
i
].
æags
) !=„ate_flags)

3196 ià(
masked_¿‹s
 & 
	`BIT
(
i
))

3198 
¿‹s
++;

3201 ià(
–em’t_id
 =ğ
WLAN_EID_SUPP_RATES
) {

3202 
¿‹s
 = 
	`mš_t
(
u8
,„ates, 8);

3203 
sk
 = 0;

3205 
sk
 = 8;

3206 ià(
¿‹s
 <ğ
sk
)

3208 
¿‹s
 -ğ
sk
;

3211 ià(
	`skb_room
(
skb
è< 
¿‹s
 + 2)

3212  -
ENOBUFS
;

3214 
	`skb_put_u8
(
skb
, 
–em’t_id
);

3215 
	`skb_put_u8
(
skb
, 
¿‹s
);

3217 
i
 = 0; i < 
sbªd
->
n_b™¿‹s
 && 
¿‹s
; i++) {

3218 
¿‹
;

3219 
u8
 
basic
;

3221 ià((
¿‹_æags
 & 
sbªd
->
b™¿‹s
[
i
].
æags
) !=„ate_flags)

3223 ià(
masked_¿‹s
 & 
	`BIT
(
i
))

3226 ià(
sk
 > 0) {

3227 
sk
--;

3231 
basic
 = 
basic_¿‹s
 & 
	`BIT
(
i
) ? 0x80 : 0;

3233 
¿‹
 = 
	`DIV_ROUND_UP
(
sbªd
->
b™¿‹s
[
i
].
b™¿‹
, 5);

3234 
	`skb_put_u8
(
skb
, 
basic
 | (
u8
)
¿‹
);

3235 
¿‹s
--;

3238 
	`WARN
(
¿‹s
 > 0, "rates confused:„ates:%d,ƒlement:%d\n",

3239 
¿‹s
, 
–em’t_id
);

3242 
	}
}

3244 
	$›“80211_ave_rssi
(
›“80211_vif
 *
vif
)

3246 
›“80211_sub_if_d©a
 *
sd©a
 = 
	`vif_to_sd©a
(
vif
);

3248 ià(
	`WARN_ON_ONCE
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
))

3251  -
	`ewma_b—cÚ_sigÇl_»ad
(&
sd©a
->
deæšk
.
u
.
mgd
.
ave_b—cÚ_sigÇl
);

3252 
	}
}

3253 
EXPORT_SYMBOL_GPL
(
›“80211_ave_rssi
);

3255 
u8
 
	$›“80211_mcs_to_chašs
(cÚ¡ 
›“80211_mcs_šfo
 *
mcs
)

3257 ià(!
mcs
)

3262 ià(
mcs
->
rx_mask
[3])

3264 ià(
mcs
->
rx_mask
[2])

3266 ià(
mcs
->
rx_mask
[1])

3269 
	}
}

3284 
u64
 
	$›“80211_ÿlcuÏ‹_rx_time¡amp
(
›“80211_loÿl
 *
loÿl
,

3285 
›“80211_rx_¡©us
 *
¡©us
,

3286 
mpdu_Ën
,

3287 
mpdu_off£t
)

3289 
u64
 
ts
 = 
¡©us
->
maùime
;

3290 
boŞ
 
maùime_¶ı_¡¬t
;

3291 
¿‹_šfo
 
ri
;

3292 
u16
 
¿‹
;

3293 
u8
 
n_Éf
;

3295 ià(
	`WARN_ON
(!
	`›“80211_have_rx_time¡amp
(
¡©us
)))

3298 
maùime_¶ı_¡¬t
 = (
¡©us
->
æag
 & 
RX_FLAG_MACTIME
) ==

3299 
RX_FLAG_MACTIME_PLCP_START
;

3301 
	`mem£t
(&
ri
, 0, (ri));

3303 
ri
.
bw
 = 
¡©us
->bw;

3306 
¡©us
->
’codšg
) {

3307 
RX_ENC_EHT
:

3308 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_EHT_MCS
;

3309 
ri
.
mcs
 = 
¡©us
->
¿‹_idx
;

3310 
ri
.
nss
 = 
¡©us
->nss;

3311 
ri
.
eht_ru_®loc
 = 
¡©us
->
eht
.
ru
;

3312 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

3313 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

3315 ià(
maùime_¶ı_¡¬t
) {

3316 
mpdu_off£t
 += 2;

3317 
ts
 += 36;

3320 
RX_ENC_HE
:

3321 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_HE_MCS
;

3322 
ri
.
mcs
 = 
¡©us
->
¿‹_idx
;

3323 
ri
.
nss
 = 
¡©us
->nss;

3324 
ri
.
he_ru_®loc
 = 
¡©us
->
he_ru
;

3325 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

3326 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

3332 ià(
maùime_¶ı_¡¬t
) {

3333 
mpdu_off£t
 += 2;

3334 
ts
 += 36;

3346 
RX_ENC_HT
:

3347 
ri
.
mcs
 = 
¡©us
->
¿‹_idx
;

3348 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_MCS
;

3349 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

3350 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

3356 ià(
maùime_¶ı_¡¬t
) {

3357 
mpdu_off£t
 += 2;

3358 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_HT_GF
)

3359 
ts
 += 24;

3361 
ts
 += 32;

3367 
n_Éf
 = ((
ri
.
mcs
 >> 3) & 3) + 1;

3368 
n_Éf
 =‚_ltf == 3 ? 4 :‚_ltf;

3369 
ts
 +ğ
n_Éf
 * 4;

3373 
RX_ENC_VHT
:

3374 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_VHT_MCS
;

3375 
ri
.
mcs
 = 
¡©us
->
¿‹_idx
;

3376 
ri
.
nss
 = 
¡©us
->nss;

3377 ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORT_GI
)

3378 
ri
.
æags
 |ğ
RATE_INFO_FLAGS_SHORT_GI
;

3384 ià(
maùime_¶ı_¡¬t
) {

3385 
mpdu_off£t
 += 2;

3386 
ts
 += 36;

3391 
n_Éf
 = (
ri
.
nss
 != 1) && (ri.nss % 2) ?

3392 
ri
.
nss
 + 1 :„i.nss;

3393 
ts
 +ğ4 * 
n_Éf
;

3398 
	`WARN_ON
(1);

3399 
çÎthrough
;

3400 
RX_ENC_LEGACY
: {

3401 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

3403 
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
¡©us
->
bªd
];

3404 
ri
.
Ëgacy
 = 
sbªd
->
b™¿‹s
[
¡©us
->
¿‹_idx
].
b™¿‹
;

3406 ià(
maùime_¶ı_¡¬t
) {

3407 ià(
¡©us
->
bªd
 =ğ
NL80211_BAND_5GHZ
) {

3408 
ts
 += 20;

3409 
mpdu_off£t
 += 2;

3410 } ià(
¡©us
->
’c_æags
 & 
RX_ENC_FLAG_SHORTPRE
) {

3411 
ts
 += 96;

3413 
ts
 += 192;

3420 
¿‹
 = 
	`cfg80211_ÿlcuÏ‹_b™¿‹
(&
ri
);

3421 ià(
	`WARN_ONCE
(!
¿‹
,

3423 ()
¡©us
->
æag
, stus->
¿‹_idx
,

3424 
¡©us
->
nss
))

3428 ià((
¡©us
->
æag
 & 
RX_FLAG_MACTIME
è=ğ
RX_FLAG_MACTIME_END
)

3429 
ts
 -ğ
mpdu_Ën
 * 8 * 10 / 
¿‹
;

3431 
ts
 +ğ
mpdu_off£t
 * 8 * 10 / 
¿‹
;

3433  
ts
;

3434 
	}
}

3436 
	$›“80211_dfs_ÿc_ÿnûl
(
›“80211_loÿl
 *
loÿl
)

3438 
›“80211_sub_if_d©a
 *
sd©a
;

3439 
cfg80211_chª_def
 
chªdef
;

3441 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3443 
	`li¡_fÜ_—ch_’Œy
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
) {

3448 
	`why_d–ayed_wÜk_ÿnûl
(
loÿl
->
hw
.
why
,

3449 &
sd©a
->
deæšk
.
dfs_ÿc_tim”_wÜk
);

3451 ià(
sd©a
->
wdev
.
ÿc_¡¬‹d
) {

3452 
chªdef
 = 
sd©a
->
vif
.
bss_cÚf
.
chª»q
.
İ”
;

3453 
	`›“80211_lšk_»Ëa£_chªÃl
(&
sd©a
->
deæšk
);

3454 
	`cfg80211_ÿc_ev’t
(
sd©a
->
dev
,

3455 &
chªdef
,

3456 
NL80211_RADAR_CAC_ABORTED
,

3457 
GFP_KERNEL
);

3460 
	}
}

3462 
	$›“80211_dfs_¿d¬_d‘eùed_wÜk
(
why
 *wiphy,

3463 
why_wÜk
 *
wÜk
)

3465 
›“80211_loÿl
 *
loÿl
 =

3466 
	`cÚš”_of
(
wÜk
, 
›“80211_loÿl
, 
¿d¬_d‘eùed_wÜk
);

3467 
cfg80211_chª_def
 
chªdef
 = 
loÿl
->
hw
.
cÚf
.chandef;

3468 
›“80211_chªùx
 *
ùx
;

3469 
num_chªùx
 = 0;

3471 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3473 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

3474 ià(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_REPLACES_OTHER
)

3477 
num_chªùx
++;

3478 
chªdef
 = 
ùx
->
cÚf
.
def
;

3481 
	`›“80211_dfs_ÿc_ÿnûl
(
loÿl
);

3483 ià(
num_chªùx
 > 1)

3485 
	`WARN_ON
(1);

3487 
	`cfg80211_¿d¬_ev’t
(
loÿl
->
hw
.
why
, &
chªdef
, 
GFP_KERNEL
);

3488 
	}
}

3490 
	$›“80211_¿d¬_d‘eùed
(
›“80211_hw
 *
hw
)

3492 
›“80211_loÿl
 *
loÿl
 = 
	`hw_to_loÿl
(
hw
);

3494 
	`Œaû_­i_¿d¬_d‘eùed
(
loÿl
);

3496 
	`why_wÜk_queue
(
hw
->
why
, &
loÿl
->
¿d¬_d‘eùed_wÜk
);

3497 
	}
}

3498 
EXPORT_SYMBOL
(
›“80211_¿d¬_d‘eùed
);

3500 
	$›“80211_chªdef_downg¿de
(
cfg80211_chª_def
 *
c
,

3501 
›“80211_cÚn_£‰šgs
 *
cÚn
)

3503 
Æ80211_chª_width
 
Ãw_´im¬y_width
;

3504 
›“80211_cÚn_£‰šgs
 
_ignÜed
 = {};

3507 ià(!
cÚn
)

3508 
cÚn
 = &
_ignÜed
;

3510 
agaš
:

3512 
Ãw_´im¬y_width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

3514 
c
->
width
) {

3516 
NL80211_CHAN_WIDTH_20_NOHT
:

3517 
	`WARN_ON_ONCE
(1);

3518 
çÎthrough
;

3519 
NL80211_CHAN_WIDTH_20
:

3520 
c
->
width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

3521 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_LEGACY
;

3522 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

3523 
c
->
punùu»d
 = 0;

3525 
NL80211_CHAN_WIDTH_40
:

3526 
c
->
width
 = 
NL80211_CHAN_WIDTH_20
;

3527 
c
->
ûÁ”_äeq1
 = c->
chª
->
ûÁ”_äeq
;

3528 ià(
cÚn
->
mode
 =ğ
IEEE80211_CONN_MODE_VHT
)

3529 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_HT
;

3530 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

3531 
c
->
punùu»d
 = 0;

3533 
NL80211_CHAN_WIDTH_80
:

3534 
Ãw_´im¬y_width
 = 
NL80211_CHAN_WIDTH_40
;

3535 ià(
cÚn
->
mode
 =ğ
IEEE80211_CONN_MODE_VHT
)

3536 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_HT
;

3537 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_40
;

3539 
NL80211_CHAN_WIDTH_80P80
:

3540 
c
->
ûÁ”_äeq2
 = 0;

3541 
c
->
width
 = 
NL80211_CHAN_WIDTH_80
;

3542 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_80
;

3544 
NL80211_CHAN_WIDTH_160
:

3545 
Ãw_´im¬y_width
 = 
NL80211_CHAN_WIDTH_80
;

3546 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_80
;

3548 
NL80211_CHAN_WIDTH_320
:

3549 
Ãw_´im¬y_width
 = 
NL80211_CHAN_WIDTH_160
;

3550 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_160
;

3552 
NL80211_CHAN_WIDTH_1
:

3553 
NL80211_CHAN_WIDTH_2
:

3554 
NL80211_CHAN_WIDTH_4
:

3555 
NL80211_CHAN_WIDTH_8
:

3556 
NL80211_CHAN_WIDTH_16
:

3557 
	`WARN_ON_ONCE
(1);

3559 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_S1G
;

3560 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

3562 
NL80211_CHAN_WIDTH_5
:

3563 
NL80211_CHAN_WIDTH_10
:

3564 
	`WARN_ON_ONCE
(1);

3566 
cÚn
->
mode
 = 
IEEE80211_CONN_MODE_LEGACY
;

3567 
cÚn
->
bw_lim™
 = 
IEEE80211_CONN_BW_LIMIT_20
;

3571 ià(
Ãw_´im¬y_width
 !ğ
NL80211_CHAN_WIDTH_20_NOHT
) {

3572 
c
->
ûÁ”_äeq1
 = 
	`cfg80211_chªdef_´im¬y
(c, 
Ãw_´im¬y_width
,

3573 &
c
->
punùu»d
);

3574 
c
->
width
 = 
Ãw_´im¬y_width
;

3582 ià(!
	`cfg80211_chªdef_v®id
(
c
è&& c->
punùu»d
)

3583 
agaš
;

3585 
	`WARN_ON_ONCE
(!
	`cfg80211_chªdef_v®id
(
c
));

3586 
	}
}

3592 
boŞ
 
	$›“80211_smps_is_»¡riùive
(
›“80211_smps_mode
 
smps_mode_Şd
,

3593 
›“80211_smps_mode
 
smps_mode_Ãw
)

3595 ià(
	`WARN_ON_ONCE
(
smps_mode_Şd
 =ğ
IEEE80211_SMPS_AUTOMATIC
 ||

3596 
smps_mode_Ãw
 =ğ
IEEE80211_SMPS_AUTOMATIC
))

3597  
çl£
;

3599 
smps_mode_Şd
) {

3600 
IEEE80211_SMPS_STATIC
:

3601  
çl£
;

3602 
IEEE80211_SMPS_DYNAMIC
:

3603  
smps_mode_Ãw
 =ğ
IEEE80211_SMPS_STATIC
;

3604 
IEEE80211_SMPS_OFF
:

3605  
smps_mode_Ãw
 !ğ
IEEE80211_SMPS_OFF
;

3607 
	`WARN_ON
(1);

3610  
çl£
;

3611 
	}
}

3613 
	$›“80211_£nd_aùiÚ_c§
(
›“80211_sub_if_d©a
 *
sd©a
,

3614 
cfg80211_c§_£‰šgs
 *
c§_£‰šgs
)

3616 
sk_buff
 *
skb
;

3617 
›“80211_mgmt
 *
mgmt
;

3618 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3619 
äeq
;

3620 
hdr_Ën
 = 
	`off£toãnd
(
›“80211_mgmt
,

3621 
u
.
aùiÚ
.u.
chª_sw™ch
);

3622 
u8
 *
pos
;

3624 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_ADHOC
 &&

3625 
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_MESH_POINT
)

3626  -
EOPNOTSUPP
;

3628 
skb
 = 
	`dev_®loc_skb
(
loÿl
->
tx_h—droom
 + 
hdr_Ën
 +

3633 ià(!
skb
)

3634  -
ENOMEM
;

3636 
	`skb_»£rve
(
skb
, 
loÿl
->
tx_h—droom
);

3637 
mgmt
 = 
	`skb_put_z”o
(
skb
, 
hdr_Ën
);

3638 
mgmt
->
äame_cÚŒŞ
 = 
	`ıu_to_Ë16
(
IEEE80211_FTYPE_MGMT
 |

3639 
IEEE80211_STYPE_ACTION
);

3641 
	`‘h_brßdÿ¡_addr
(
mgmt
->
da
);

3642 
	`memıy
(
mgmt
->
§
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3643 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

3644 
	`memıy
(
mgmt
->
bssid
, 
sd©a
->
vif
.
addr
, 
ETH_ALEN
);

3646 
›“80211_if_ibss
 *
ifibss
 = &
sd©a
->
u
.
ibss
;

3647 
	`memıy
(
mgmt
->
bssid
, 
ifibss
->bssid, 
ETH_ALEN
);

3649 
mgmt
->
u
.
aùiÚ
.
ÿ‹gÜy
 = 
WLAN_CATEGORY_SPECTRUM_MGMT
;

3650 
mgmt
->
u
.
aùiÚ
.u.
chª_sw™ch
.
aùiÚ_code
 = 
WLAN_ACTION_SPCT_CHL_SWITCH
;

3651 
pos
 = 
	`skb_put
(
skb
, 5);

3652 *
pos
++ = 
WLAN_EID_CHANNEL_SWITCH
;

3653 *
pos
++ = 3;

3654 *
pos
++ = 
c§_£‰šgs
->
block_tx
 ? 1 : 0;

3655 
äeq
 = 
c§_£‰šgs
->
chªdef
.
chª
->
ûÁ”_äeq
;

3656 *
pos
++ = 
	`›“80211_äequ’cy_to_chªÃl
(
äeq
);

3657 *
pos
++ = 
c§_£‰šgs
->
couÁ
;

3659 ià(
c§_£‰šgs
->
chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_40
) {

3660 
Æ80211_chªÃl_ty³
 
ch_ty³
;

3662 
	`skb_put
(
skb
, 3);

3663 *
pos
++ = 
WLAN_EID_SECONDARY_CHANNEL_OFFSET
;

3664 *
pos
++ = 1;

3665 
ch_ty³
 = 
	`cfg80211_g‘_chªdef_ty³
(&
c§_£‰šgs
->
chªdef
);

3666 ià(
ch_ty³
 =ğ
NL80211_CHAN_HT40PLUS
)

3667 *
pos
++ = 
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
;

3669 *
pos
++ = 
IEEE80211_HT_PARAM_CHA_SEC_BELOW
;

3672 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

3673 
›“80211_if_mesh
 *
ifmsh
 = &
sd©a
->
u
.
mesh
;

3675 
	`skb_put
(
skb
, 8);

3676 *
pos
++ = 
WLAN_EID_CHAN_SWITCH_PARAM
;

3677 *
pos
++ = 6;

3678 *
pos
++ = 
sd©a
->
u
.
mesh
.
mshcfg
.
dÙ11MeshTTL
;

3679 *
pos
 = 0x00;

3680 *
pos
 |ğ
WLAN_EID_CHAN_SWITCH_PARAM_INITIATOR
;

3681 *
pos
++ |ğ
c§_£‰šgs
->
block_tx
 ?

3682 
WLAN_EID_CHAN_SWITCH_PARAM_TX_RESTRICT
 : 0x00;

3683 
	`put_uÇligÃd_Ë16
(
WLAN_REASON_MESH_CHAN
, 
pos
);

3684 
pos
 += 2;

3685 
	`put_uÇligÃd_Ë16
(
ifmsh
->
´e_v®ue
, 
pos
);

3686 
pos
 += 2;

3689 ià(
c§_£‰šgs
->
chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_80
 ||

3690 
c§_£‰šgs
->
chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_80P80
 ||

3691 
c§_£‰šgs
->
chªdef
.
width
 =ğ
NL80211_CHAN_WIDTH_160
) {

3692 
	`skb_put
(
skb
, 5);

3693 
	`›“80211_›_bud_wide_bw_cs
(
pos
, &
c§_£‰šgs
->
chªdef
);

3696 
	`›“80211_tx_skb
(
sd©a
, 
skb
);

3698 
	}
}

3700 
boŞ


3701 
	$›“80211_ex‹nd_nß_desc
(
›“80211_nß_d©a
 *
d©a
, 
u32
 
tsf
, 
i
)

3703 
s32
 
’d
 = 
d©a
->
desc
[
i
].
¡¬t
 + d©a->desc[i].
du¿tiÚ
 - (
tsf
 + 1);

3704 
sk
;

3706 ià(
’d
 > 0)

3707  
çl£
;

3710 ià(
d©a
->
couÁ
[
i
] == 1)

3711  
çl£
;

3713 ià(
d©a
->
desc
[
i
].
š‹rv®
 == 0)

3714  
çl£
;

3717 
sk
 = 
	`DIV_ROUND_UP
(-
’d
, 
d©a
->
desc
[
i
].
š‹rv®
);

3718 ià(
d©a
->
couÁ
[
i
] < 255) {

3719 ià(
d©a
->
couÁ
[
i
] <ğ
sk
) {

3720 
d©a
->
couÁ
[
i
] = 0;

3721  
çl£
;

3724 
d©a
->
couÁ
[
i
] -ğ
sk
;

3727 
d©a
->
desc
[
i
].
¡¬t
 +ğ
sk
 * d©a->desc[i].
š‹rv®
;

3729  
Œue
;

3730 
	}
}

3732 
boŞ


3733 
	$›“80211_ex‹nd_ab£Á_time
(
›“80211_nß_d©a
 *
d©a
, 
u32
 
tsf
,

3734 
s32
 *
off£t
)

3736 
boŞ
 
»t
 = 
çl£
;

3737 
i
;

3739 
i
 = 0; i < 
IEEE80211_P2P_NOA_DESC_MAX
; i++) {

3740 
s32
 
cur
;

3742 ià(!
d©a
->
couÁ
[
i
])

3745 ià(
	`›“80211_ex‹nd_nß_desc
(
d©a
, 
tsf
 + *
off£t
, 
i
))

3746 
»t
 = 
Œue
;

3748 
cur
 = 
d©a
->
desc
[
i
].
¡¬t
 - 
tsf
;

3749 ià(
cur
 > *
off£t
)

3752 
cur
 = 
d©a
->
desc
[
i
].
¡¬t
 + d©a->desc[i].
du¿tiÚ
 - 
tsf
;

3753 ià(
cur
 > *
off£t
)

3754 *
off£t
 = 
cur
;

3757  
»t
;

3758 
	}
}

3760 
u32


3761 
	$›“80211_g‘_nß_ab£Á_time
(
›“80211_nß_d©a
 *
d©a
, 
u32
 
tsf
)

3763 
s32
 
off£t
 = 0;

3764 
Œ›s
 = 0;

3769 
max_Œ›s
 = 5;

3771 
	`›“80211_ex‹nd_ab£Á_time
(
d©a
, 
tsf
, &
off£t
);

3773 ià(!
	`›“80211_ex‹nd_ab£Á_time
(
d©a
, 
tsf
, &
off£t
))

3776 
Œ›s
++;

3777 } 
Œ›s
 < 
max_Œ›s
);

3779  
off£t
;

3780 
	}
}

3782 
	$›“80211_upd©e_p2p_nß
(
›“80211_nß_d©a
 *
d©a
, 
u32
 
tsf
)

3784 
u32
 
Ãxt_off£t
 = 
	`BIT
(31) - 1;

3785 
i
;

3787 
d©a
->
ab£Á
 = 0;

3788 
d©a
->
has_Ãxt_tsf
 = 
çl£
;

3789 
i
 = 0; i < 
IEEE80211_P2P_NOA_DESC_MAX
; i++) {

3790 
s32
 
¡¬t
;

3792 ià(!
d©a
->
couÁ
[
i
])

3795 
	`›“80211_ex‹nd_nß_desc
(
d©a
, 
tsf
, 
i
);

3796 
¡¬t
 = 
d©a
->
desc
[
i
].¡¬ˆ- 
tsf
;

3797 ià(
¡¬t
 <= 0)

3798 
d©a
->
ab£Á
 |ğ
	`BIT
(
i
);

3800 ià(
Ãxt_off£t
 > 
¡¬t
)

3801 
Ãxt_off£t
 = 
¡¬t
;

3803 
d©a
->
has_Ãxt_tsf
 = 
Œue
;

3806 ià(
d©a
->
ab£Á
)

3807 
Ãxt_off£t
 = 
	`›“80211_g‘_nß_ab£Á_time
(
d©a
, 
tsf
);

3809 
d©a
->
Ãxt_tsf
 = 
tsf
 + 
Ãxt_off£t
;

3810 
	}
}

3811 
EXPORT_SYMBOL
(
›“80211_upd©e_p2p_nß
);

3813 
	$›“80211_·r£_p2p_nß
(cÚ¡ 
›“80211_p2p_nß_©Œ
 *
©Œ
,

3814 
›“80211_nß_d©a
 *
d©a
, 
u32
 
tsf
)

3816 
»t
 = 0;

3817 
i
;

3819 
	`mem£t
(
d©a
, 0, (*data));

3821 
i
 = 0; i < 
IEEE80211_P2P_NOA_DESC_MAX
; i++) {

3822 cÚ¡ 
›“80211_p2p_nß_desc
 *
desc
 = &
©Œ
->desc[
i
];

3824 ià(!
desc
->
couÁ
 || !desc->
du¿tiÚ
)

3827 
d©a
->
couÁ
[
i
] = 
desc
->count;

3828 
d©a
->
desc
[
i
].
¡¬t
 = 
	`Ë32_to_ıu
(desc->
¡¬t_time
);

3829 
d©a
->
desc
[
i
].
du¿tiÚ
 = 
	`Ë32_to_ıu
(desc->duration);

3830 
d©a
->
desc
[
i
].
š‹rv®
 = 
	`Ë32_to_ıu
(desc->interval);

3832 ià(
d©a
->
couÁ
[
i
] > 1 &&

3833 
d©a
->
desc
[
i
].
š‹rv®
 < d©a->desc[i].
du¿tiÚ
)

3836 
	`›“80211_ex‹nd_nß_desc
(
d©a
, 
tsf
, 
i
);

3837 
»t
++;

3840 ià(
»t
)

3841 
	`›“80211_upd©e_p2p_nß
(
d©a
, 
tsf
);

3843  
»t
;

3844 
	}
}

3845 
EXPORT_SYMBOL
(
›“80211_·r£_p2p_nß
);

3847 
	$›“80211_»ÿlc_dtim
(
›“80211_loÿl
 *
loÿl
,

3848 
›“80211_sub_if_d©a
 *
sd©a
)

3850 
u64
 
tsf
 = 
	`drv_g‘_tsf
(
loÿl
, 
sd©a
);

3851 
u64
 
dtim_couÁ
 = 0;

3852 
u16
 
b—cÚ_št
 = 
sd©a
->
vif
.
bss_cÚf
.beacon_int * 1024;

3853 
u8
 
dtim_³riod
 = 
sd©a
->
vif
.
bss_cÚf
.dtim_period;

3854 
ps_d©a
 *
ps
;

3855 
u8
 
bús_äom_dtim
;

3857 ià(
tsf
 =ğ-1ULL || !
b—cÚ_št
 || !
dtim_³riod
)

3860 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

3861 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP_VLAN
) {

3862 ià(!
sd©a
->
bss
)

3865 
ps
 = &
sd©a
->
bss
->ps;

3866 } ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

3867 
ps
 = &
sd©a
->
u
.
mesh
.ps;

3877 
	`do_div
(
tsf
, 
b—cÚ_št
);

3878 
bús_äom_dtim
 = 
	`do_div
(
tsf
, 
dtim_³riod
);

3880 ià(!
bús_äom_dtim
)

3881 
dtim_couÁ
 = 0;

3883 
dtim_couÁ
 = 
dtim_³riod
 - 
bús_äom_dtim
;

3885 
ps
->
dtim_couÁ
 = dtim_count;

3886 
	}
}

3888 
u8
 
	$›“80211_chªùx_¿d¬_d‘eù
(
›“80211_loÿl
 *
loÿl
,

3889 
›“80211_chªùx
 *
ùx
)

3891 
›“80211_lšk_d©a
 *
lšk
;

3892 
u8
 
¿d¬_d‘eù
 = 0;

3894 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3896 ià(
	`WARN_ON
(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
))

3899 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
»£rved_lšks
, 
»£rved_chªùx_li¡
)

3900 ià(
lšk
->
»£rved_¿d¬_»quœed
)

3901 
¿d¬_d‘eù
 |ğ
	`BIT
(
lšk
->
»£rved
.
İ”
.
width
);

3907 
	`WARN_ON
(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_REPLACES_OTHER
 &&

3908 !
	`li¡_em±y
(&
ùx
->
assigÃd_lšks
));

3910 
	`li¡_fÜ_—ch_’Œy
(
lšk
, &
ùx
->
assigÃd_lšks
, 
assigÃd_chªùx_li¡
) {

3911 ià(!
lšk
->
¿d¬_»quœed
)

3914 
¿d¬_d‘eù
 |=

3915 
	`BIT
(
lšk
->
cÚf
->
chª»q
.
İ”
.
width
);

3918  
¿d¬_d‘eù
;

3919 
	}
}

3921 
	$›“80211_check_combš©iÚs
(
›“80211_sub_if_d©a
 *
sd©a
,

3922 cÚ¡ 
cfg80211_chª_def
 *
chªdef
,

3923 
›“80211_chªùx_mode
 
chªmode
,

3924 
u8
 
¿d¬_d‘eù
)

3926 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

3927 
›“80211_sub_if_d©a
 *
sd©a_™”
;

3928 
Æ80211_iáy³
 
iáy³
 = 
sd©a
->
wdev
.iftype;

3929 
›“80211_chªùx
 *
ùx
;

3930 
tÙ®
 = 1;

3931 
içû_combš©iÚ_·¿ms
 
·¿ms
 = {

3932 .
¿d¬_d‘eù
 =„adar_detect,

3935 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

3937 ià(
	`WARN_ON
(
	`hweight32
(
¿d¬_d‘eù
) > 1))

3938  -
EINVAL
;

3940 ià(
	`WARN_ON
(
chªdef
 && 
chªmode
 =ğ
IEEE80211_CHANCTX_SHARED
 &&

3941 !
chªdef
->
chª
))

3942  -
EINVAL
;

3944 ià(
	`WARN_ON
(
iáy³
 >ğ
NUM_NL80211_IFTYPES
))

3945  -
EINVAL
;

3947 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 ||

3948 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
) {

3954 
·¿ms
.
Ãw_b—cÚ_št
 = 
sd©a
->
vif
.
bss_cÚf
.
b—cÚ_št
;

3958 ià(
	`cfg80211_iáy³_®lowed
(
loÿl
->
hw
.
why
, 
iáy³
, 0, 1)) {

3959 ià(
¿d¬_d‘eù
)

3960  -
EINVAL
;

3964 ià(
chªdef
)

3965 
·¿ms
.
num_difã»Á_chªÃls
 = 1;

3967 ià(
iáy³
 !ğ
NL80211_IFTYPE_UNSPECIFIED
)

3968 
·¿ms
.
iáy³_num
[
iáy³
] = 1;

3970 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

3971 ià(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
)

3973 
·¿ms
.
¿d¬_d‘eù
 |=

3974 
	`›“80211_chªùx_¿d¬_d‘eù
(
loÿl
, 
ùx
);

3975 ià(
ùx
->
mode
 =ğ
IEEE80211_CHANCTX_EXCLUSIVE
) {

3976 
·¿ms
.
num_difã»Á_chªÃls
++;

3979 ià(
chªdef
 && 
chªmode
 =ğ
IEEE80211_CHANCTX_SHARED
 &&

3980 
	`cfg80211_chªdef_com·tibË
(
chªdef
,

3981 &
ùx
->
cÚf
.
def
))

3983 
·¿ms
.
num_difã»Á_chªÃls
++;

3986 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a_™”
, &
loÿl
->
š‹rçûs
, 
li¡
) {

3987 
wœ–ess_dev
 *
wdev_™”
;

3989 
wdev_™”
 = &
sd©a_™”
->
wdev
;

3991 ià(
sd©a_™”
 =ğ
sd©a
 ||

3992 !
	`›“80211_sd©a_ruÂšg
(
sd©a_™”
) ||

3993 
	`cfg80211_iáy³_®lowed
(
loÿl
->
hw
.
why
,

3994 
wdev_™”
->
iáy³
, 0, 1))

3997 
·¿ms
.
iáy³_num
[
wdev_™”
->
iáy³
]++;

3998 
tÙ®
++;

4001 ià(
tÙ®
 =ğ1 && !
·¿ms
.
¿d¬_d‘eù
)

4004  
	`cfg80211_check_combš©iÚs
(
loÿl
->
hw
.
why
, &
·¿ms
);

4005 
	}
}

4008 
	$›“80211_™”_max_chªs
(cÚ¡ 
›“80211_içû_combš©iÚ
 *
c
,

4009 *
d©a
)

4011 
u32
 *
max_num_difã»Á_chªÃls
 = 
d©a
;

4013 *
max_num_difã»Á_chªÃls
 = 
	`max
(*max_num_different_channels,

4014 
c
->
num_difã»Á_chªÃls
);

4015 
	}
}

4017 
	$›“80211_max_num_chªÃls
(
›“80211_loÿl
 *
loÿl
)

4019 
›“80211_sub_if_d©a
 *
sd©a
;

4020 
›“80211_chªùx
 *
ùx
;

4021 
u32
 
max_num_difã»Á_chªÃls
 = 1;

4022 
”r
;

4023 
içû_combš©iÚ_·¿ms
 
·¿ms
 = {0};

4025 
	`lockd•_as£¹_why
(
loÿl
->
hw
.
why
);

4027 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
loÿl
->
chªùx_li¡
, 
li¡
) {

4028 ià(
ùx
->
»¶aû_¡©e
 =ğ
IEEE80211_CHANCTX_WILL_BE_REPLACED
)

4031 
·¿ms
.
num_difã»Á_chªÃls
++;

4033 
·¿ms
.
¿d¬_d‘eù
 |=

4034 
	`›“80211_chªùx_¿d¬_d‘eù
(
loÿl
, 
ùx
);

4037 
	`li¡_fÜ_—ch_’Œy_rcu
(
sd©a
, &
loÿl
->
š‹rçûs
, 
li¡
)

4038 
·¿ms
.
iáy³_num
[
sd©a
->
wdev
.
iáy³
]++;

4040 
”r
 = 
	`cfg80211_™”_combš©iÚs
(
loÿl
->
hw
.
why
, &
·¿ms
,

4041 
›“80211_™”_max_chªs
,

4042 &
max_num_difã»Á_chªÃls
);

4043 ià(
”r
 < 0)

4044  
”r
;

4046  
max_num_difã»Á_chªÃls
;

4047 
	}
}

4049 
	$›“80211_add_s1g_ÿ·b_›
(
›“80211_sub_if_d©a
 *
sd©a
,

4050 
›“80211_¡a_s1g_ÿp
 *
ÿps
,

4051 
sk_buff
 *
skb
)

4053 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

4054 
›“80211_s1g_ÿp
 
s1g_ÿ·b
;

4055 
u8
 *
pos
;

4056 
i
;

4058 ià(
	`WARN_ON
(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
))

4061 ià(!
ÿps
->
s1g
)

4064 
	`memıy
(
s1g_ÿ·b
.
ÿ·b_šfo
, 
ÿps
->
ÿp
, (caps->cap));

4065 
	`memıy
(
s1g_ÿ·b
.
suµ_mcs_nss
, 
ÿps
->
nss_mcs
, (caps->nss_mcs));

4068 
i
 = 0; i < (
ifmgd
->
s1g_ÿ·
.
ÿ·b_šfo
); i++) {

4069 
u8
 
mask
 = 
ifmgd
->
s1g_ÿ·_mask
.
ÿ·b_šfo
[
i
];

4071 
s1g_ÿ·b
.
ÿ·b_šfo
[
i
] &ğ~
mask
;

4072 
s1g_ÿ·b
.
ÿ·b_šfo
[
i
] |ğ
ifmgd
->
s1g_ÿ·
.ÿ·b_šfo[i] & 
mask
;

4076 
i
 = 0; i < (
ifmgd
->
s1g_ÿ·
.
suµ_mcs_nss
); i++) {

4077 
u8
 
mask
 = 
ifmgd
->
s1g_ÿ·_mask
.
suµ_mcs_nss
[
i
];

4079 
s1g_ÿ·b
.
suµ_mcs_nss
[
i
] &ğ~
mask
;

4080 
s1g_ÿ·b
.
suµ_mcs_nss
[
i
] |=

4081 
ifmgd
->
s1g_ÿ·
.
suµ_mcs_nss
[
i
] & 
mask
;

4084 
pos
 = 
	`skb_put
(
skb
, 2 + (
s1g_ÿ·b
));

4085 *
pos
++ = 
WLAN_EID_S1G_CAPABILITIES
;

4086 *
pos
++ = (
s1g_ÿ·b
);

4088 
	`memıy
(
pos
, &
s1g_ÿ·b
, (s1g_capab));

4089 
	}
}

4091 
	$›“80211_add_aid_»que¡_›
(
›“80211_sub_if_d©a
 *
sd©a
,

4092 
sk_buff
 *
skb
)

4094 
u8
 *
pos
 = 
	`skb_put
(
skb
, 3);

4096 *
pos
++ = 
WLAN_EID_AID_REQUEST
;

4097 *
pos
++ = 1;

4098 *
pos
++ = 0;

4099 
	}
}

4101 
u8
 *
	$›“80211_add_wmm_šfo_›
(
u8
 *
buf
, u8 
qosšfo
)

4103 *
buf
++ = 
WLAN_EID_VENDOR_SPECIFIC
;

4104 *
buf
++ = 7;

4105 *
buf
++ = 0x00;

4106 *
buf
++ = 0x50;

4107 *
buf
++ = 0xf2;

4108 *
buf
++ = 2;

4109 *
buf
++ = 0;

4110 *
buf
++ = 1;

4111 *
buf
++ = 
qosšfo
;

4113  
buf
;

4114 
	}
}

4116 
	$›“80211_txq_g‘_d•th
(
›“80211_txq
 *
txq
,

4117 *
äame_út
,

4118 *
by‹_út
)

4120 
txq_šfo
 *
txqi
 = 
	`to_txq_šfo
(
txq
);

4121 
u32
 
äag_út
 = 0, 
äag_by‹s
 = 0;

4122 
sk_buff
 *
skb
;

4124 
	`skb_queue_w®k
(&
txqi
->
äags
, 
skb
) {

4125 
äag_út
++;

4126 
äag_by‹s
 +ğ
skb
->
Ën
;

4129 ià(
äame_út
)

4130 *
äame_út
 = 
txqi
->
tš
.
backlog_·ck‘s
 + 
äag_út
;

4132 ià(
by‹_út
)

4133 *
by‹_út
 = 
txqi
->
tš
.
backlog_by‹s
 + 
äag_by‹s
;

4134 
	}
}

4135 
EXPORT_SYMBOL
(
›“80211_txq_g‘_d•th
);

4137 cÚ¡ 
u8
 
	g›“80211_ac_to_qos_mask
[
IEEE80211_NUM_ACS
] = {

4138 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VO
,

4139 
IEEE80211_WMM_IE_STA_QOSINFO_AC_VI
,

4140 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BE
,

4141 
IEEE80211_WMM_IE_STA_QOSINFO_AC_BK


4144 
u16
 
	$›“80211_’code_usf
(
li¡’_š‹rv®
)

4146 cÚ¡ 
li¡’_št_usf
[] = { 1, 10, 1000, 10000 };

4147 
u16
 
ui
, 
usf
 = 0;

4150 
usf
 < 
IEEE80211_MAX_USF
) {

4151 ià(
li¡’_š‹rv®
 % 
li¡’_št_usf
[
usf
 + 1])

4153 
usf
 += 1;

4155 
ui
 = 
li¡’_š‹rv®
 / 
li¡’_št_usf
[
usf
];

4158 
	`WARN_ON_ONCE
(
ui
 > 
IEEE80211_MAX_UI
);

4159 
li¡’_š‹rv®
 = 
	`FIELD_PREP
(
LISTEN_INT_USF
, 
usf
) |

4160 
	`FIELD_PREP
(
LISTEN_INT_UI
, 
ui
);

4162  (
u16
è
li¡’_š‹rv®
;

4163 
	}
}

4166 
u8
 
	$›“80211_›_Ën_eht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
)

4168 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
;

4169 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
;

4170 
›“80211_suµÜ‹d_bªd
 *
sbªd
;

4171 
boŞ
 
is_­
;

4172 
u8
 
n
;

4174 
sbªd
 = 
	`›“80211_g‘_sbªd
(
sd©a
);

4175 ià(!
sbªd
)

4178 
he_ÿp
 = 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4179 
eht_ÿp
 = 
	`›“80211_g‘_eht_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4180 ià(!
he_ÿp
 || !
eht_ÿp
)

4183 
is_­
 = 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
;

4185 
n
 = 
	`›“80211_eht_mcs_nss_size
(&
he_ÿp
->
he_ÿp_–em
,

4186 &
eht_ÿp
->
eht_ÿp_–em
,

4187 
is_­
);

4189 (
eht_ÿp
->
eht_ÿp_–em
è+ 
n
 +

4190 
	`›“80211_eht_µe_size
(
eht_ÿp
->
eht_µe_th»s
[0],

4191 
eht_ÿp
->
eht_ÿp_–em
.
phy_ÿp_šfo
);

4193 
	}
}

4195 
	$›“80211_put_eht_ÿp
(
sk_buff
 *
skb
,

4196 
›“80211_sub_if_d©a
 *
sd©a
,

4197 cÚ¡ 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

4198 cÚ¡ 
›“80211_cÚn_£‰šgs
 *
cÚn
)

4200 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
 =

4201 
	`›“80211_g‘_he_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4202 cÚ¡ 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
 =

4203 
	`›“80211_g‘_eht_iáy³_ÿp_vif
(
sbªd
, &
sd©a
->
vif
);

4204 
boŞ
 
fÜ_­
 = 
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
;

4205 
›“80211_eht_ÿp_–em_fixed
 
fixed
;

4206 
›“80211_he_ÿp_–em
 
he
;

4207 
u8
 
mcs_nss_Ën
, 
µ‘_Ën
;

4208 
u8
 
Üig_mcs_nss_Ën
;

4209 
u8
 
›_Ën
;

4211 ià(!
cÚn
)

4212 
cÚn
 = &
›“80211_cÚn_£‰šgs_uÆim™ed
;

4215 ià(!
he_ÿp
 || !
eht_ÿp
)

4218 
Üig_mcs_nss_Ën
 = 
	`›“80211_eht_mcs_nss_size
(&
he_ÿp
->
he_ÿp_–em
,

4219 &
eht_ÿp
->
eht_ÿp_–em
,

4220 
fÜ_­
);

4222 
	`›“80211_g‘_adju¡ed_he_ÿp
(
cÚn
, 
he_ÿp
, &
he
);

4224 
fixed
 = 
eht_ÿp
->
eht_ÿp_–em
;

4226 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_80
)

4227 
fixed
.
phy_ÿp_šfo
[6] &=

4228 ~
IEEE80211_EHT_PHY_CAP6_MCS15_SUPP_80MHZ
;

4230 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_160
) {

4231 
fixed
.
phy_ÿp_šfo
[1] &=

4232 ~
IEEE80211_EHT_PHY_CAP1_BEAMFORMEE_SS_160MHZ_MASK
;

4233 
fixed
.
phy_ÿp_šfo
[2] &=

4234 ~
IEEE80211_EHT_PHY_CAP2_SOUNDING_DIM_160MHZ_MASK
;

4235 
fixed
.
phy_ÿp_šfo
[6] &=

4236 ~
IEEE80211_EHT_PHY_CAP6_MCS15_SUPP_160MHZ
;

4239 ià(
cÚn
->
bw_lim™
 < 
IEEE80211_CONN_BW_LIMIT_320
) {

4240 
fixed
.
phy_ÿp_šfo
[0] &=

4241 ~
IEEE80211_EHT_PHY_CAP0_320MHZ_IN_6GHZ
;

4242 
fixed
.
phy_ÿp_šfo
[1] &=

4243 ~
IEEE80211_EHT_PHY_CAP1_BEAMFORMEE_SS_320MHZ_MASK
;

4244 
fixed
.
phy_ÿp_šfo
[2] &=

4245 ~
IEEE80211_EHT_PHY_CAP2_SOUNDING_DIM_320MHZ_MASK
;

4246 
fixed
.
phy_ÿp_šfo
[6] &=

4247 ~
IEEE80211_EHT_PHY_CAP6_MCS15_SUPP_320MHZ
;

4250 ià(
cÚn
->
bw_lim™
 =ğ
IEEE80211_CONN_BW_LIMIT_20
)

4251 
fixed
.
phy_ÿp_šfo
[0] &=

4252 ~
IEEE80211_EHT_PHY_CAP0_242_TONE_RU_GT20MHZ
;

4254 
mcs_nss_Ën
 = 
	`›“80211_eht_mcs_nss_size
(&
he
, &
fixed
, 
fÜ_­
);

4255 
µ‘_Ën
 = 
	`›“80211_eht_µe_size
(
eht_ÿp
->
eht_µe_th»s
[0],

4256 
fixed
.
phy_ÿp_šfo
);

4258 
›_Ën
 = 2 + 1 + (
eht_ÿp
->
eht_ÿp_–em
è+ 
mcs_nss_Ën
 + 
µ‘_Ën
;

4259 ià(
	`skb_room
(
skb
è< 
›_Ën
)

4260  -
ENOBUFS
;

4262 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXTENSION
);

4263 
	`skb_put_u8
(
skb
, 
›_Ën
 - 2);

4264 
	`skb_put_u8
(
skb
, 
WLAN_EID_EXT_EHT_CAPABILITY
);

4265 
	`skb_put_d©a
(
skb
, &
fixed
, (fixed));

4267 ià(
mcs_nss_Ën
 =ğ4 && 
Üig_mcs_nss_Ën
 != 4) {

4274 
	`skb_put_u8
(
skb
, 
eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_80
.
rx_tx_mcs9_max_nss
);

4275 
	`skb_put_u8
(
skb
, 
eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_80
.
rx_tx_mcs9_max_nss
);

4276 
	`skb_put_u8
(
skb
, 
eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_80
.
rx_tx_mcs11_max_nss
);

4277 
	`skb_put_u8
(
skb
, 
eht_ÿp
->
eht_mcs_nss_suµ
.
bw
.
_80
.
rx_tx_mcs13_max_nss
);

4279 
	`skb_put_d©a
(
skb
, &
eht_ÿp
->
eht_mcs_nss_suµ
, 
mcs_nss_Ën
);

4282 ià(
µ‘_Ën
)

4283 
	`skb_put_d©a
(
skb
, &
eht_ÿp
->
eht_µe_th»s
, 
µ‘_Ën
);

4286 
	}
}

4288 cÚ¡ *
	$›“80211_cÚn_mode_¡r
(
›“80211_cÚn_mode
 
mode
)

4290 cÚ¡ * cÚ¡ 
modes
[] = {

4291 [
IEEE80211_CONN_MODE_S1G
] = "S1G",

4292 [
IEEE80211_CONN_MODE_LEGACY
] = "legacy",

4293 [
IEEE80211_CONN_MODE_HT
] = "HT",

4294 [
IEEE80211_CONN_MODE_VHT
] = "VHT",

4295 [
IEEE80211_CONN_MODE_HE
] = "HE",

4296 [
IEEE80211_CONN_MODE_EHT
] = "EHT",

4299 ià(
	`WARN_ON
(
mode
 >ğ
	`ARRAY_SIZE
(
modes
)))

4302  
modes
[
mode
] ?: "<missing string>";

4303 
	}
}

4305 
›“80211_cÚn_bw_lim™


4306 
	$›“80211_mš_bw_lim™_äom_chªdef
(
cfg80211_chª_def
 *
chªdef
)

4308 
chªdef
->
width
) {

4309 
NL80211_CHAN_WIDTH_20_NOHT
:

4310 
NL80211_CHAN_WIDTH_20
:

4311  
IEEE80211_CONN_BW_LIMIT_20
;

4312 
NL80211_CHAN_WIDTH_40
:

4313  
IEEE80211_CONN_BW_LIMIT_40
;

4314 
NL80211_CHAN_WIDTH_80
:

4315  
IEEE80211_CONN_BW_LIMIT_80
;

4316 
NL80211_CHAN_WIDTH_80P80
:

4317 
NL80211_CHAN_WIDTH_160
:

4318  
IEEE80211_CONN_BW_LIMIT_160
;

4319 
NL80211_CHAN_WIDTH_320
:

4320  
IEEE80211_CONN_BW_LIMIT_320
;

4322 
	`WARN
(1, "unhªdËd chªdeàwidth %d\n", 
chªdef
->
width
);

4323  
IEEE80211_CONN_BW_LIMIT_20
;

4325 
	}
}

	@vht.c

10 
	~<lšux/›“80211.h
>

11 
	~<lšux/expÜt.h
>

12 
	~<Ãt/mac80211.h
>

13 
	~"›“80211_i.h
"

14 
	~"¿‹.h
"

17 
	$__check_vhtÿp_di§bË
(
›“80211_sub_if_d©a
 *
sd©a
,

18 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
,

19 
u32
 
æag
)

21 
__Ë32
 
Ë_æag
 = 
	`ıu_to_Ë32
(
æag
);

23 ià(
sd©a
->
u
.
mgd
.
vht_ÿ·_mask
.
vht_ÿp_šfo
 & 
Ë_æag
 &&

24 !(
sd©a
->
u
.
mgd
.
vht_ÿ·
.
vht_ÿp_šfo
 & 
Ë_æag
))

25 
vht_ÿp
->
ÿp
 &ğ~
æag
;

26 
	}
}

28 
	$›“80211_­¶y_vhtÿp_ov”rides
(
›“80211_sub_if_d©a
 *
sd©a
,

29 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
)

31 
i
;

32 
u16
 
rxmcs_mask
, 
rxmcs_ÿp
, 
rxmcs_n
, 
txmcs_mask
, 
txmcs_ÿp
, 
txmcs_n
;

34 ià(!
vht_ÿp
->
vht_suµÜ‹d
)

37 ià(
sd©a
->
vif
.
ty³
 !ğ
NL80211_IFTYPE_STATION
)

40 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

41 
IEEE80211_VHT_CAP_RXLDPC
);

42 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

43 
IEEE80211_VHT_CAP_SHORT_GI_80
);

44 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

45 
IEEE80211_VHT_CAP_SHORT_GI_160
);

46 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

47 
IEEE80211_VHT_CAP_TXSTBC
);

48 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

49 
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
);

50 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

51 
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
);

52 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

53 
IEEE80211_VHT_CAP_RX_ANTENNA_PATTERN
);

54 
	`__check_vhtÿp_di§bË
(
sd©a
, 
vht_ÿp
,

55 
IEEE80211_VHT_CAP_TX_ANTENNA_PATTERN
);

58 ià(
sd©a
->
u
.
mgd
.
vht_ÿ·_mask
.
vht_ÿp_šfo
 &

59 
	`ıu_to_Ë32
(
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
)) {

60 
u32
 
ÿp
, 
n
;

62 
n
 = 
	`Ë32_to_ıu
(
sd©a
->
u
.
mgd
.
vht_ÿ·
.
vht_ÿp_šfo
) &

63 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
;

64 
n
 >>ğ
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_SHIFT
;

65 
ÿp
 = 
vht_ÿp
->ÿ°& 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
;

66 
ÿp
 >>ğ
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_SHIFT
;

68 ià(
n
 < 
ÿp
) {

69 
vht_ÿp
->
ÿp
 &=

70 ~
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
;

71 
vht_ÿp
->
ÿp
 |=

72 
n
 << 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_SHIFT
;

77 
rxmcs_mask
 =

78 
	`Ë16_to_ıu
(
sd©a
->
u
.
mgd
.
vht_ÿ·_mask
.
suµ_mcs
.
rx_mcs_m­
);

79 
rxmcs_n
 = 
	`Ë16_to_ıu
(
sd©a
->
u
.
mgd
.
vht_ÿ·
.
suµ_mcs
.
rx_mcs_m­
);

80 
rxmcs_n
 &ğ
rxmcs_mask
;

81 
rxmcs_ÿp
 = 
	`Ë16_to_ıu
(
vht_ÿp
->
vht_mcs
.
rx_mcs_m­
);

83 
txmcs_mask
 =

84 
	`Ë16_to_ıu
(
sd©a
->
u
.
mgd
.
vht_ÿ·_mask
.
suµ_mcs
.
tx_mcs_m­
);

85 
txmcs_n
 = 
	`Ë16_to_ıu
(
sd©a
->
u
.
mgd
.
vht_ÿ·
.
suµ_mcs
.
tx_mcs_m­
);

86 
txmcs_n
 &ğ
txmcs_mask
;

87 
txmcs_ÿp
 = 
	`Ë16_to_ıu
(
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
);

88 
i
 = 0; i < 8; i++) {

89 
u8
 
m
, 
n
, 
c
;

91 
m
 = (
rxmcs_mask
 >> 2*
i
è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

92 
n
 = (
rxmcs_n
 >> 2*
i
è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

93 
c
 = (
rxmcs_ÿp
 >> 2*
i
è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

95 ià(
m
 && ((
c
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
 && 
n
 < c) ||

96 
n
 =ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
)) {

97 
rxmcs_ÿp
 &ğ~(3 << 2*
i
);

98 
rxmcs_ÿp
 |ğ(
rxmcs_n
 & (3 << 2*
i
));

101 
m
 = (
txmcs_mask
 >> 2*
i
è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

102 
n
 = (
txmcs_n
 >> 2*
i
è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

103 
c
 = (
txmcs_ÿp
 >> 2*
i
è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

105 ià(
m
 && ((
c
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
 && 
n
 < c) ||

106 
n
 =ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
)) {

107 
txmcs_ÿp
 &ğ~(3 << 2*
i
);

108 
txmcs_ÿp
 |ğ(
txmcs_n
 & (3 << 2*
i
));

111 
vht_ÿp
->
vht_mcs
.
rx_mcs_m­
 = 
	`ıu_to_Ë16
(
rxmcs_ÿp
);

112 
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
 = 
	`ıu_to_Ë16
(
txmcs_ÿp
);

113 
	}
}

116 
	$›“80211_vht_ÿp_›_to_¡a_vht_ÿp
(
›“80211_sub_if_d©a
 *
sd©a
,

117 
›“80211_suµÜ‹d_bªd
 *
sbªd
,

118 cÚ¡ 
›“80211_vht_ÿp
 *
vht_ÿp_›
,

119 cÚ¡ 
›“80211_vht_ÿp
 *
vht_ÿp_›2
,

120 
lšk_¡a_šfo
 *
lšk_¡a
)

122 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
 = &
lšk_¡a
->
pub
->vht_cap;

123 
›“80211_¡a_vht_ÿp
 
own_ÿp
;

124 
u32
 
ÿp_šfo
, 
i
;

125 
boŞ
 
have_80mhz
;

126 
u32
 
mpdu_Ën
;

128 
	`mem£t
(
vht_ÿp
, 0, (*vht_cap));

130 ià(!
lšk_¡a
->
pub
->
ht_ÿp
.
ht_suµÜ‹d
)

133 ià(!
vht_ÿp_›
 || !
sbªd
->
vht_ÿp
.
vht_suµÜ‹d
)

137 
have_80mhz
 = 
çl£
;

138 
i
 = 0; i < 
sbªd
->
n_chªÃls
; i++) {

139 ià(
sbªd
->
chªÃls
[
i
].
æags
 & (
IEEE80211_CHAN_DISABLED
 |

140 
IEEE80211_CHAN_NO_80MHZ
))

143 
have_80mhz
 = 
Œue
;

147 ià(!
have_80mhz
)

157 
vht_ÿp
->
vht_suµÜ‹d
 = 
Œue
;

159 
own_ÿp
 = 
sbªd
->
vht_ÿp
;

166 ià(
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_STATION
 &&

167 !
	`‹¡_¡a_æag
(
lšk_¡a
->
¡a
, 
WLAN_STA_TDLS_PEER
))

168 
	`›“80211_­¶y_vhtÿp_ov”rides
(
sd©a
, &
own_ÿp
);

171 
ÿp_šfo
 = 
	`Ë32_to_ıu
(
vht_ÿp_›
->
vht_ÿp_šfo
);

172 
vht_ÿp
->
ÿp
 = 
ÿp_šfo
;

173 
vht_ÿp
->
ÿp
 &ğ
IEEE80211_VHT_CAP_RXLDPC
 |

174 
IEEE80211_VHT_CAP_VHT_TXOP_PS
 |

175 
IEEE80211_VHT_CAP_HTC_VHT
 |

176 
IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK
 |

177 
IEEE80211_VHT_CAP_VHT_LINK_ADAPTATION_VHT_UNSOL_MFB
 |

178 
IEEE80211_VHT_CAP_VHT_LINK_ADAPTATION_VHT_MRQ_MFB
 |

179 
IEEE80211_VHT_CAP_RX_ANTENNA_PATTERN
 |

180 
IEEE80211_VHT_CAP_TX_ANTENNA_PATTERN
;

182 
vht_ÿp
->
ÿp
 |ğ
	`mš_t
(
u32
, 
ÿp_šfo
 & 
IEEE80211_VHT_CAP_MAX_MPDU_MASK
,

183 
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_MAX_MPDU_MASK
);

186 
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
) {

187 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
:

188 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 &

189 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
;

191 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
:

192 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 &

193 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
;

201 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 & 
own_ÿp
.cap &

202 (
IEEE80211_VHT_CAP_SHORT_GI_80
 |

203 
IEEE80211_VHT_CAP_SHORT_GI_160
);

206 ià(
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
)

207 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 &

208 (
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
 |

209 
IEEE80211_VHT_CAP_SOUNDING_DIMENSIONS_MASK
);

211 ià(
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_SU_BEAMFORMER_CAPABLE
)

212 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 &

213 (
IEEE80211_VHT_CAP_SU_BEAMFORMEE_CAPABLE
 |

214 
IEEE80211_VHT_CAP_BEAMFORMEE_STS_MASK
);

216 ià(
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_MU_BEAMFORMER_CAPABLE
)

217 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 &

218 
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
;

220 ià(
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_MU_BEAMFORMEE_CAPABLE
)

221 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 &

222 
IEEE80211_VHT_CAP_MU_BEAMFORMER_CAPABLE
;

224 ià(
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_TXSTBC
)

225 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 & 
IEEE80211_VHT_CAP_RXSTBC_MASK
;

227 ià(
own_ÿp
.
ÿp
 & 
IEEE80211_VHT_CAP_RXSTBC_MASK
)

228 
vht_ÿp
->
ÿp
 |ğ
ÿp_šfo
 & 
IEEE80211_VHT_CAP_TXSTBC
;

231 
	`memıy
(&
vht_ÿp
->
vht_mcs
, &
vht_ÿp_›
->
suµ_mcs
,

232 (
›“80211_vht_mcs_šfo
));

235 ià(
	`›“80211_hw_check
(&
sd©a
->
loÿl
->
hw
, 
SUPPORTS_VHT_EXT_NSS_BW
))

236 
vht_ÿp
->
ÿp
 |ğ(
ÿp_šfo
 & 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
);

238 
vht_ÿp
->
vht_mcs
.
tx_highe¡
 &=

239 ~
	`ıu_to_Ë16
(
IEEE80211_VHT_EXT_NSS_BW_CAPABLE
);

242 
i
 = 0; i < 8; i++) {

243 
u16
 
own_rx
, 
own_tx
, 
³”_rx
, 
³”_tx
;

245 
own_rx
 = 
	`Ë16_to_ıu
(
own_ÿp
.
vht_mcs
.
rx_mcs_m­
);

246 
own_rx
 = (own_rx >> 
i
 * 2è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

248 
own_tx
 = 
	`Ë16_to_ıu
(
own_ÿp
.
vht_mcs
.
tx_mcs_m­
);

249 
own_tx
 = (own_tx >> 
i
 * 2è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

251 
³”_rx
 = 
	`Ë16_to_ıu
(
vht_ÿp
->
vht_mcs
.
rx_mcs_m­
);

252 
³”_rx
 = (³”_rx >> 
i
 * 2è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

254 
³”_tx
 = 
	`Ë16_to_ıu
(
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
);

255 
³”_tx
 = (³”_tx >> 
i
 * 2è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

257 ià(
³”_tx
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
) {

258 ià(
own_rx
 =ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
)

259 
³”_tx
 = 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

260 ià(
own_rx
 < 
³”_tx
)

261 
³”_tx
 = 
own_rx
;

264 ià(
³”_rx
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
) {

265 ià(
own_tx
 =ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
)

266 
³”_rx
 = 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

267 ià(
own_tx
 < 
³”_rx
)

268 
³”_rx
 = 
own_tx
;

271 
vht_ÿp
->
vht_mcs
.
rx_mcs_m­
 &=

272 ~
	`ıu_to_Ë16
(
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 
i
 * 2);

273 
vht_ÿp
->
vht_mcs
.
rx_mcs_m­
 |ğ
	`ıu_to_Ë16
(
³”_rx
 << 
i
 * 2);

275 
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
 &=

276 ~
	`ıu_to_Ë16
(
IEEE80211_VHT_MCS_NOT_SUPPORTED
 << 
i
 * 2);

277 
vht_ÿp
->
vht_mcs
.
tx_mcs_m­
 |ğ
	`ıu_to_Ë16
(
³”_tx
 << 
i
 * 2);

289 ià(
vht_ÿp
->
vht_mcs
.
rx_mcs_m­
 =ğ
	`ıu_to_Ë16
(0xFFFF)) {

290 
vht_ÿp
->
vht_suµÜ‹d
 = 
çl£
;

291 
	`sd©a_šfo
(
sd©a
,

293 
lšk_¡a
->
¡a
->
addr
,†ink_sta->addr);

298 
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
) {

299 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
:

300 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
:

301 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_160
;

304 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_80
;

306 ià(!(
vht_ÿp
->
vht_mcs
.
tx_highe¡
 &

307 
	`ıu_to_Ë16
(
IEEE80211_VHT_EXT_NSS_BW_CAPABLE
)))

315 ià(
ÿp_šfo
 & 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
)

316 
lšk_¡a
->
cur_max_bªdwidth
 =

317 
IEEE80211_STA_RX_BW_160
;

320 
lšk_¡a
->
pub
->
bªdwidth
 = 
	`›“80211_¡a_cur_vht_bw
(link_sta);

326 
mpdu_Ën
 = 
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_MAX_MPDU_MASK
;

327 ià(
vht_ÿp_›2
)

328 
mpdu_Ën
 = 
	`mš_t
(
u32
, mpdu_len,

329 
	`Ë32_g‘_b™s
(
vht_ÿp_›2
->
vht_ÿp_šfo
,

330 
IEEE80211_VHT_CAP_MAX_MPDU_MASK
));

336 
mpdu_Ën
) {

337 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454
:

338 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_VHT_11454
;

340 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991
:

341 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_VHT_7991
;

343 
IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_3895
:

345 
lšk_¡a
->
pub
->
agg
.
max_amsdu_Ën
 = 
IEEE80211_MAX_MPDU_LEN_VHT_3895
;

349 
	`›“80211_¡a_»ÿlc_agg»g©es
(&
lšk_¡a
->
¡a
->sta);

350 
	}
}

353 
›“80211_¡a_rx_bªdwidth


354 
	$›“80211_¡a_ÿp_rx_bw
(
lšk_¡a_šfo
 *
lšk_¡a
)

356 
lšk_id
 = 
lšk_¡a
->link_id;

357 
›“80211_sub_if_d©a
 *
sd©a
 = 
lšk_¡a
->
¡a
->sdata;

358 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
 = &
lšk_¡a
->
pub
->vht_cap;

359 
›“80211_¡a_he_ÿp
 *
he_ÿp
 = &
lšk_¡a
->
pub
->he_cap;

360 
›“80211_¡a_eht_ÿp
 *
eht_ÿp
 = &
lšk_¡a
->
pub
->eht_cap;

361 
u32
 
ÿp_width
;

363 ià(
he_ÿp
->
has_he
) {

364 
›“80211_bss_cÚf
 *
lšk_cÚf
;

365 
›“80211_¡a_rx_bªdwidth
 
»t
;

366 
u8
 
šfo
;

368 
	`rcu_»ad_lock
();

369 
lšk_cÚf
 = 
	`rcu_d”eã»nû
(
sd©a
->
vif
.lšk_cÚf[
lšk_id
]);

371 ià(
eht_ÿp
->
has_eht
 &&

372 
lšk_cÚf
->
chª»q
.
İ”
.
chª
->
bªd
 =ğ
NL80211_BAND_6GHZ
) {

373 
šfo
 = 
eht_ÿp
->
eht_ÿp_–em
.
phy_ÿp_šfo
[0];

375 ià(
šfo
 & 
IEEE80211_EHT_PHY_CAP0_320MHZ_IN_6GHZ
) {

376 
»t
 = 
IEEE80211_STA_RX_BW_320
;

377 
out
;

381 
šfo
 = 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0];

383 ià(
lšk_cÚf
->
chª»q
.
İ”
.
chª
->
bªd
 =ğ
NL80211_BAND_2GHZ
) {

384 ià(
šfo
 & 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_IN_2G
)

385 
»t
 = 
IEEE80211_STA_RX_BW_40
;

387 
»t
 = 
IEEE80211_STA_RX_BW_20
;

388 
out
;

391 ià(
šfo
 & 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
 ||

392 
šfo
 & 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_80PLUS80_MHZ_IN_5G
)

393 
»t
 = 
IEEE80211_STA_RX_BW_160
;

394 ià(
šfo
 & 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_40MHZ_80MHZ_IN_5G
)

395 
»t
 = 
IEEE80211_STA_RX_BW_80
;

397 
»t
 = 
IEEE80211_STA_RX_BW_20
;

398 
out
:

399 
	`rcu_»ad_uÆock
();

401  
»t
;

404 ià(!
vht_ÿp
->
vht_suµÜ‹d
)

405  
lšk_¡a
->
pub
->
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 ?

406 
IEEE80211_STA_RX_BW_40
 :

407 
IEEE80211_STA_RX_BW_20
;

409 
ÿp_width
 = 
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
;

411 ià(
ÿp_width
 =ğ
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
 ||

412 
ÿp_width
 =ğ
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
)

413  
IEEE80211_STA_RX_BW_160
;

420 ià(
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_EXT_NSS_BW_MASK
)

421  
IEEE80211_STA_RX_BW_160
;

423  
IEEE80211_STA_RX_BW_80
;

424 
	}
}

426 
Æ80211_chª_width


427 
	$›“80211_¡a_ÿp_chª_bw
(
lšk_¡a_šfo
 *
lšk_¡a
)

429 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
 = &
lšk_¡a
->
pub
->vht_cap;

430 
u32
 
ÿp_width
;

432 ià(!
vht_ÿp
->
vht_suµÜ‹d
) {

433 ià(!
lšk_¡a
->
pub
->
ht_ÿp
.
ht_suµÜ‹d
)

434  
NL80211_CHAN_WIDTH_20_NOHT
;

436  
lšk_¡a
->
pub
->
ht_ÿp
.
ÿp
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 ?

437 
NL80211_CHAN_WIDTH_40
 : 
NL80211_CHAN_WIDTH_20
;

440 
ÿp_width
 = 
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
;

442 ià(
ÿp_width
 =ğ
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
)

443  
NL80211_CHAN_WIDTH_160
;

444 ià(
ÿp_width
 =ğ
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
)

445  
NL80211_CHAN_WIDTH_80P80
;

447  
NL80211_CHAN_WIDTH_80
;

448 
	}
}

450 
Æ80211_chª_width


451 
	$›“80211_¡a_rx_bw_to_chª_width
(
lšk_¡a_šfo
 *
lšk_¡a
)

453 
›“80211_¡a_rx_bªdwidth
 
cur_bw
 =

454 
lšk_¡a
->
pub
->
bªdwidth
;

455 
›“80211_¡a_vht_ÿp
 *
vht_ÿp
 =

456 &
lšk_¡a
->
pub
->
vht_ÿp
;

457 
u32
 
ÿp_width
;

459 
cur_bw
) {

460 
IEEE80211_STA_RX_BW_20
:

461 ià(!
lšk_¡a
->
pub
->
ht_ÿp
.
ht_suµÜ‹d
)

462  
NL80211_CHAN_WIDTH_20_NOHT
;

464  
NL80211_CHAN_WIDTH_20
;

465 
IEEE80211_STA_RX_BW_40
:

466  
NL80211_CHAN_WIDTH_40
;

467 
IEEE80211_STA_RX_BW_80
:

468  
NL80211_CHAN_WIDTH_80
;

469 
IEEE80211_STA_RX_BW_160
:

470 
ÿp_width
 =

471 
vht_ÿp
->
ÿp
 & 
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_MASK
;

473 ià(
ÿp_width
 =ğ
IEEE80211_VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
)

474  
NL80211_CHAN_WIDTH_160
;

476  
NL80211_CHAN_WIDTH_80P80
;

478  
NL80211_CHAN_WIDTH_20
;

480 
	}
}

482 
›“80211_¡a_rx_bªdwidth


483 
	$›“80211_chª_width_to_rx_bw
(
Æ80211_chª_width
 
width
)

485 
width
) {

486 
NL80211_CHAN_WIDTH_20_NOHT
:

487 
NL80211_CHAN_WIDTH_20
:

488  
IEEE80211_STA_RX_BW_20
;

489 
NL80211_CHAN_WIDTH_40
:

490  
IEEE80211_STA_RX_BW_40
;

491 
NL80211_CHAN_WIDTH_80
:

492  
IEEE80211_STA_RX_BW_80
;

493 
NL80211_CHAN_WIDTH_160
:

494 
NL80211_CHAN_WIDTH_80P80
:

495  
IEEE80211_STA_RX_BW_160
;

496 
NL80211_CHAN_WIDTH_320
:

497  
IEEE80211_STA_RX_BW_320
;

499 
	`WARN_ON_ONCE
(1);

500  
IEEE80211_STA_RX_BW_20
;

502 
	}
}

505 
›“80211_¡a_rx_bªdwidth


506 
	$›“80211_¡a_cur_vht_bw
(
lšk_¡a_šfo
 *
lšk_¡a
)

508 
¡a_šfo
 *
¡a
 = 
lšk_¡a
->sta;

509 
›“80211_bss_cÚf
 *
lšk_cÚf
;

510 
Æ80211_chª_width
 
bss_width
;

511 
›“80211_¡a_rx_bªdwidth
 
bw
;

513 
	`rcu_»ad_lock
();

514 
lšk_cÚf
 = 
	`rcu_d”eã»nû
(
¡a
->
sd©a
->
vif
.lšk_cÚf[
lšk_¡a
->
lšk_id
]);

515 ià(
	`WARN_ON
(!
lšk_cÚf
))

516 
bss_width
 = 
NL80211_CHAN_WIDTH_20_NOHT
;

518 
bss_width
 = 
lšk_cÚf
->
chª»q
.
İ”
.
width
;

519 
	`rcu_»ad_uÆock
();

521 
bw
 = 
	`›“80211_¡a_ÿp_rx_bw
(
lšk_¡a
);

522 
bw
 = 
	`mš
(bw, 
lšk_¡a
->
cur_max_bªdwidth
);

533 ià(
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_PEER
) &&

534 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_TDLS_WIDER_BW
) &&

535 
	`‹¡_¡a_æag
(
¡a
, 
WLAN_STA_AUTHORIZED
) &&

536 
¡a
->
tdls_chªdef
.
chª
)

537 
bw
 = 
	`mš
(bw, 
	`›“80211_chª_width_to_rx_bw
(
¡a
->
tdls_chªdef
.
width
));

539 
bw
 = 
	`mš
(bw, 
	`›“80211_chª_width_to_rx_bw
(
bss_width
));

541  
bw
;

542 
	}
}

544 
	$›“80211_¡a_š™_nss
(
lšk_¡a_šfo
 *
lšk_¡a
)

546 
u8
 
ht_rx_nss
 = 0, 
vht_rx_nss
 = 0, 
he_rx_nss
 = 0, 
eht_rx_nss
 = 0, 
rx_nss
;

547 
boŞ
 
suµÜt_160
;

549 ià(
lšk_¡a
->
pub
->
eht_ÿp
.
has_eht
) {

550 
i
;

551 cÚ¡ 
u8
 *
rx_nss_mcs
 = (*)&
lšk_¡a
->
pub
->
eht_ÿp
.
eht_mcs_nss_suµ
;

554 
i
 = 0; i < (
›“80211_eht_mcs_nss_suµ
); i++)

555 
eht_rx_nss
 = 
	`max_t
(
u8
,ƒht_rx_nss,

556 
	`u8_g‘_b™s
(
rx_nss_mcs
[
i
],

557 
IEEE80211_EHT_MCS_NSS_RX
));

560 ià(
lšk_¡a
->
pub
->
he_ÿp
.
has_he
) {

561 
i
;

562 
u8
 
rx_mcs_80
 = 0, 
rx_mcs_160
 = 0;

563 cÚ¡ 
›“80211_¡a_he_ÿp
 *
he_ÿp
 = &
lšk_¡a
->
pub
->he_cap;

564 
u16
 
mcs_160_m­
 =

565 
	`Ë16_to_ıu
(
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_160
);

566 
u16
 
mcs_80_m­
 = 
	`Ë16_to_ıu
(
he_ÿp
->
he_mcs_nss_suµ
.
rx_mcs_80
);

568 
i
 = 7; i >= 0; i--) {

569 
u8
 
mcs_160
 = (
mcs_160_m­
 >> (2 * 
i
)) & 3;

571 ià(
mcs_160
 !ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

572 
rx_mcs_160
 = 
i
 + 1;

576 
i
 = 7; i >= 0; i--) {

577 
u8
 
mcs_80
 = (
mcs_80_m­
 >> (2 * 
i
)) & 3;

579 ià(
mcs_80
 !ğ
IEEE80211_HE_MCS_NOT_SUPPORTED
) {

580 
rx_mcs_80
 = 
i
 + 1;

585 
suµÜt_160
 = 
he_ÿp
->
he_ÿp_–em
.
phy_ÿp_šfo
[0] &

586 
IEEE80211_HE_PHY_CAP0_CHANNEL_WIDTH_SET_160MHZ_IN_5G
;

588 ià(
suµÜt_160
)

589 
he_rx_nss
 = 
	`mš
(
rx_mcs_80
, 
rx_mcs_160
);

591 
he_rx_nss
 = 
rx_mcs_80
;

594 ià(
lšk_¡a
->
pub
->
ht_ÿp
.
ht_suµÜ‹d
) {

595 ià(
lšk_¡a
->
pub
->
ht_ÿp
.
mcs
.
rx_mask
[0])

596 
ht_rx_nss
++;

597 ià(
lšk_¡a
->
pub
->
ht_ÿp
.
mcs
.
rx_mask
[1])

598 
ht_rx_nss
++;

599 ià(
lšk_¡a
->
pub
->
ht_ÿp
.
mcs
.
rx_mask
[2])

600 
ht_rx_nss
++;

601 ià(
lšk_¡a
->
pub
->
ht_ÿp
.
mcs
.
rx_mask
[3])

602 
ht_rx_nss
++;

606 ià(
lšk_¡a
->
pub
->
vht_ÿp
.
vht_suµÜ‹d
) {

607 
i
;

608 
u16
 
rx_mcs_m­
;

610 
rx_mcs_m­
 = 
	`Ë16_to_ıu
(
lšk_¡a
->
pub
->
vht_ÿp
.
vht_mcs
.rx_mcs_map);

612 
i
 = 7; i >= 0; i--) {

613 
u8
 
mcs
 = (
rx_mcs_m­
 >> (2 * 
i
)) & 3;

615 ià(
mcs
 !ğ
IEEE80211_VHT_MCS_NOT_SUPPORTED
) {

616 
vht_rx_nss
 = 
i
 + 1;

623 
rx_nss
 = 
	`max
(
vht_rx_nss
, 
ht_rx_nss
);

624 
rx_nss
 = 
	`max
(
he_rx_nss
,„x_nss);

625 
rx_nss
 = 
	`max
(
eht_rx_nss
,„x_nss);

626 
rx_nss
 = 
	`max_t
(
u8
, 1,„x_nss);

627 
lšk_¡a
->
ÿ·_nss
 = 
rx_nss
;

630 ià(
lšk_¡a
->
İ_mode_nss
)

631 
lšk_¡a
->
pub
->
rx_nss
 =

632 
	`mš_t
(
u8
, 
rx_nss
, 
lšk_¡a
->
İ_mode_nss
);

634 
lšk_¡a
->
pub
->
rx_nss
 =„x_nss;

635 
	}
}

637 
u32
 
	$__›“80211_vht_hªdË_İmode
(
›“80211_sub_if_d©a
 *
sd©a
,

638 
lšk_¡a_šfo
 *
lšk_¡a
,

639 
u8
 
İmode
, 
Æ80211_bªd
 
bªd
)

641 
›“80211_¡a_rx_bªdwidth
 
Ãw_bw
;

642 
¡a_İmode_šfo
 
¡a_İmode
 = {};

643 
u32
 
chªged
 = 0;

644 
u8
 
nss
;

647 ià(
İmode
 & 
IEEE80211_OPMODE_NOTIF_RX_NSS_TYPE_BF
)

650 
nss
 = 
İmode
 & 
IEEE80211_OPMODE_NOTIF_RX_NSS_MASK
;

651 
nss
 >>ğ
IEEE80211_OPMODE_NOTIF_RX_NSS_SHIFT
;

652 
nss
 += 1;

654 ià(
lšk_¡a
->
İ_mode_nss
 !ğ
nss
) {

655 ià(
nss
 <ğ
lšk_¡a
->
ÿ·_nss
) {

656 
lšk_¡a
->
İ_mode_nss
 = 
nss
;

658 ià(
nss
 !ğ
lšk_¡a
->
pub
->
rx_nss
) {

659 
lšk_¡a
->
pub
->
rx_nss
 = 
nss
;

660 
chªged
 |ğ
IEEE80211_RC_NSS_CHANGED
;

661 
¡a_İmode
.
rx_nss
 = 
lšk_¡a
->
pub
->rx_nss;

662 
¡a_İmode
.
chªged
 |ğ
STA_OPMODE_N_SS_CHANGED
;

665 
	`´_w¬n_¿‹lim™ed
("Ignoring NSS change in VHT Operating Mode Notification from %pM with invalid‚ss %d",

666 
lšk_¡a
->
pub
->
addr
, 
nss
);

670 
İmode
 & 
IEEE80211_OPMODE_NOTIF_CHANWIDTH_MASK
) {

671 
IEEE80211_OPMODE_NOTIF_CHANWIDTH_20MHZ
:

673 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_20
;

675 
IEEE80211_OPMODE_NOTIF_CHANWIDTH_40MHZ
:

677 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_40
;

679 
IEEE80211_OPMODE_NOTIF_CHANWIDTH_80MHZ
:

680 ià(
İmode
 & 
IEEE80211_OPMODE_NOTIF_BW_160_80P80
)

681 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_160
;

683 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_80
;

685 
IEEE80211_OPMODE_NOTIF_CHANWIDTH_160MHZ
:

687 
lšk_¡a
->
cur_max_bªdwidth
 = 
IEEE80211_STA_RX_BW_160
;

691 
Ãw_bw
 = 
	`›“80211_¡a_cur_vht_bw
(
lšk_¡a
);

692 ià(
Ãw_bw
 !ğ
lšk_¡a
->
pub
->
bªdwidth
) {

693 
lšk_¡a
->
pub
->
bªdwidth
 = 
Ãw_bw
;

694 
¡a_İmode
.
bw
 = 
	`›“80211_¡a_rx_bw_to_chª_width
(
lšk_¡a
);

695 
chªged
 |ğ
IEEE80211_RC_BW_CHANGED
;

696 
¡a_İmode
.
chªged
 |ğ
STA_OPMODE_MAX_BW_CHANGED
;

699 ià(
¡a_İmode
.
chªged
)

700 
	`cfg80211_¡a_İmode_chªge_nÙify
(
sd©a
->
dev
, 
lšk_¡a
->
addr
,

701 &
¡a_İmode
, 
GFP_KERNEL
);

703  
chªged
;

704 
	}
}

706 
	$›“80211_´oûss_mu_groups
(
›“80211_sub_if_d©a
 *
sd©a
,

707 
›“80211_lšk_d©a
 *
lšk
,

708 
›“80211_mgmt
 *
mgmt
)

710 
›“80211_bss_cÚf
 *
lšk_cÚf
 = 
lšk
->
cÚf
;

712 ià(!
lšk_cÚf
->
mu_mimo_owÃr
)

715 ià(!
	`memcmp
(
mgmt
->
u
.
aùiÚ
.u.
vht_group_nÙif
.
pos™iÚ
,

716 
lšk_cÚf
->
mu_group
.
pos™iÚ
, 
WLAN_USER_POSITION_LEN
) &&

717 !
	`memcmp
(
mgmt
->
u
.
aùiÚ
.u.
vht_group_nÙif
.
memb”sh
,

718 
lšk_cÚf
->
mu_group
.
memb”sh
, 
WLAN_MEMBERSHIP_LEN
))

721 
	`memıy
(
lšk_cÚf
->
mu_group
.
memb”sh
,

722 
mgmt
->
u
.
aùiÚ
.u.
vht_group_nÙif
.
memb”sh
,

723 
WLAN_MEMBERSHIP_LEN
);

724 
	`memıy
(
lšk_cÚf
->
mu_group
.
pos™iÚ
,

725 
mgmt
->
u
.
aùiÚ
.u.
vht_group_nÙif
.
pos™iÚ
,

726 
WLAN_USER_POSITION_LEN
);

728 
	`›“80211_lšk_šfo_chªge_nÙify
(
sd©a
, 
lšk
,

729 
BSS_CHANGED_MU_GROUPS
);

730 
	}
}

732 
	$›“80211_upd©e_mu_groups
(
›“80211_vif
 *
vif
, 
lšk_id
,

733 cÚ¡ 
u8
 *
memb”sh
, cÚ¡ u8 *
pos™iÚ
)

735 
›“80211_bss_cÚf
 *
lšk_cÚf
;

737 
	`rcu_»ad_lock
();

738 
lšk_cÚf
 = 
	`rcu_d”eã»nû
(
vif
->lšk_cÚf[
lšk_id
]);

740 ià(!
	`WARN_ON_ONCE
(!
lšk_cÚf
 || !lšk_cÚf->
mu_mimo_owÃr
)) {

741 
	`memıy
(
lšk_cÚf
->
mu_group
.
memb”sh
, membership,

742 
WLAN_MEMBERSHIP_LEN
);

743 
	`memıy
(
lšk_cÚf
->
mu_group
.
pos™iÚ
,…osition,

744 
WLAN_USER_POSITION_LEN
);

746 
	`rcu_»ad_uÆock
();

747 
	}
}

748 
EXPORT_SYMBOL_GPL
(
›“80211_upd©e_mu_groups
);

750 
	$›“80211_vht_hªdË_İmode
(
›“80211_sub_if_d©a
 *
sd©a
,

751 
lšk_¡a_šfo
 *
lšk_¡a
,

752 
u8
 
İmode
, 
Æ80211_bªd
 
bªd
)

754 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

755 
›“80211_suµÜ‹d_bªd
 *
sbªd
 = 
loÿl
->
hw
.
why
->
bªds
[
bªd
];

757 
u32
 
chªged
 = 
	`__›“80211_vht_hªdË_İmode
(
sd©a
, 
lšk_¡a
,

758 
İmode
, 
bªd
);

760 ià(
chªged
 > 0) {

761 
	`›“80211_»ÿlc_mš_chªdef
(
sd©a
, 
lšk_¡a
->
lšk_id
);

762 
	`¿‹_cÚŒŞ_¿‹_upd©e
(
loÿl
, 
sbªd
, 
lšk_¡a
->
¡a
,

763 
lšk_¡a
->
lšk_id
, 
chªged
);

765 
	}
}

767 
	$›“80211_g‘_vht_mask_äom_ÿp
(
__Ë16
 
vht_ÿp
,

768 
u16
 
vht_mask
[
NL80211_VHT_NSS_MAX
])

770 
i
;

771 
u16
 
mask
, 
ÿp
 = 
	`Ë16_to_ıu
(
vht_ÿp
);

773 
i
 = 0; i < 
NL80211_VHT_NSS_MAX
; i++) {

774 
mask
 = (
ÿp
 >> 
i
 * 2è& 
IEEE80211_VHT_MCS_NOT_SUPPORTED
;

775 
mask
) {

776 
IEEE80211_VHT_MCS_SUPPORT_0_7
:

777 
vht_mask
[
i
] = 0x00FF;

779 
IEEE80211_VHT_MCS_SUPPORT_0_8
:

780 
vht_mask
[
i
] = 0x01FF;

782 
IEEE80211_VHT_MCS_SUPPORT_0_9
:

783 
vht_mask
[
i
] = 0x03FF;

785 
IEEE80211_VHT_MCS_NOT_SUPPORTED
:

787 
vht_mask
[
i
] = 0;

791 
	}
}

	@wbrf.c

8 
	~<lšux/aıi_amd_wbrf.h
>

9 
	~<lšux/un™s.h
>

10 
	~<Ãt/cfg80211.h
>

11 
	~"›“80211_i.h
"

13 
	$›“80211_check_wbrf_suµÜt
(
›“80211_loÿl
 *
loÿl
)

15 
why
 *why = 
loÿl
->
hw
.wiphy;

16 
deviû
 *
dev
;

18 ià(!
why
)

21 
dev
 = 
why
->dev.
·»Á
;

22 ià(!
dev
)

25 
loÿl
->
wbrf_suµÜ‹d
 = 
	`aıi_amd_wbrf_suµÜ‹d_´oduûr
(
dev
);

26 
	}
}

28 
	$g‘_chª_äeq_bound¬y
(
u32
 
ûÁ”_äeq
, u32 
bªdwidth
, 
u64
 *
¡¬t
, u64 *
’d
)

30 
bªdwidth
 *ğ
KHZ_PER_MHZ
;

31 
ûÁ”_äeq
 *ğ
KHZ_PER_MHZ
;

33 *
¡¬t
 = 
ûÁ”_äeq
 - 
bªdwidth
 / 2;

34 *
’d
 = 
ûÁ”_äeq
 + 
bªdwidth
 / 2;

37 *
¡¬t
 = *¡¬ˆ* 
HZ_PER_KHZ
;

38 *
’d
 = *’d * 
HZ_PER_KHZ
;

39 
	}
}

41 
	$g‘_¿nges_äom_chªdef
(
cfg80211_chª_def
 *
chªdef
,

42 
wbrf_¿nges_š_out
 *
¿nges_š
)

44 
u64
 
¡¬t_äeq1
, 
’d_äeq1
;

45 
u64
 
¡¬t_äeq2
, 
’d_äeq2
;

46 
bªdwidth
;

48 
bªdwidth
 = 
	`Æ80211_chª_width_to_mhz
(
chªdef
->
width
);

50 
	`g‘_chª_äeq_bound¬y
(
chªdef
->
ûÁ”_äeq1
, 
bªdwidth
, &
¡¬t_äeq1
, &
’d_äeq1
);

52 
¿nges_š
->
bªd_li¡
[0].
¡¬t
 = 
¡¬t_äeq1
;

53 
¿nges_š
->
bªd_li¡
[0].
’d
 = 
’d_äeq1
;

54 
¿nges_š
->
num_of_¿nges
 = 1;

56 ià(
chªdef
->
width
 =ğ
NL80211_CHAN_WIDTH_80P80
) {

57 
	`g‘_chª_äeq_bound¬y
(
chªdef
->
ûÁ”_äeq2
, 
bªdwidth
, &
¡¬t_äeq2
, &
’d_äeq2
);

59 
¿nges_š
->
bªd_li¡
[1].
¡¬t
 = 
¡¬t_äeq2
;

60 
¿nges_š
->
bªd_li¡
[1].
’d
 = 
’d_äeq2
;

61 
¿nges_š
->
num_of_¿nges
++;

63 
	}
}

65 
	$›“80211_add_wbrf
(
›“80211_loÿl
 *
loÿl
, 
cfg80211_chª_def
 *
chªdef
)

67 
wbrf_¿nges_š_out
 
¿nges_š
 = {0};

68 
deviû
 *
dev
;

70 ià(!
loÿl
->
wbrf_suµÜ‹d
)

73 
dev
 = 
loÿl
->
hw
.
why
->dev.
·»Á
;

75 
	`g‘_¿nges_äom_chªdef
(
chªdef
, &
¿nges_š
);

77 
	`aıi_amd_wbrf_add_»move
(
dev
, 
WBRF_RECORD_ADD
, &
¿nges_š
);

78 
	}
}

80 
	$›“80211_»move_wbrf
(
›“80211_loÿl
 *
loÿl
, 
cfg80211_chª_def
 *
chªdef
)

82 
wbrf_¿nges_š_out
 
¿nges_š
 = {0};

83 
deviû
 *
dev
;

85 ià(!
loÿl
->
wbrf_suµÜ‹d
)

88 
dev
 = 
loÿl
->
hw
.
why
->dev.
·»Á
;

90 
	`g‘_¿nges_äom_chªdef
(
chªdef
, &
¿nges_š
);

92 
	`aıi_amd_wbrf_add_»move
(
dev
, 
WBRF_RECORD_REMOVE
, &
¿nges_š
);

93 
	}
}

	@wep.c

9 
	~<lšux/Ãtdeviû.h
>

10 
	~<lšux/ty³s.h
>

11 
	~<lšux/¿ndom.h
>

12 
	~<lšux/comp”.h
>

13 
	~<lšux/üc32.h
>

14 
	~<lšux/üy±o.h
>

15 
	~<lšux/”r.h
>

16 
	~<lšux/mm.h
>

17 
	~<lšux/sÿ‰”li¡.h
>

18 
	~<lšux/¦ab.h
>

19 
	~<asm/uÇligÃd.h
>

21 
	~<Ãt/mac80211.h
>

22 
	~"›“80211_i.h
"

23 
	~"w•.h
"

26 
	$›“80211_w•_š™
(
›“80211_loÿl
 *
loÿl
)

29 
	`g‘_¿ndom_by‹s
(&
loÿl
->
w•_iv
, 
IEEE80211_WEP_IV_LEN
);

30 
	}
}

32 
šlše
 
boŞ
 
	$›“80211_w•_w—k_iv
(
u32
 
iv
, 
keyËn
)

39 ià((
iv
 & 0xff00) == 0xff00) {

40 
u8
 
B
 = (
iv
 >> 16) & 0xff;

41 ià(
B
 >ğ3 && B < 3 + 
keyËn
)

42  
Œue
;

44  
çl£
;

45 
	}
}

48 
	$›“80211_w•_g‘_iv
(
›“80211_loÿl
 *
loÿl
,

49 
keyËn
, 
keyidx
, 
u8
 *
iv
)

51 
loÿl
->
w•_iv
++;

52 ià(
	`›“80211_w•_w—k_iv
(
loÿl
->
w•_iv
, 
keyËn
))

53 
loÿl
->
w•_iv
 += 0x0100;

55 ià(!
iv
)

58 *
iv
++ = (
loÿl
->
w•_iv
 >> 16) & 0xff;

59 *
iv
++ = (
loÿl
->
w•_iv
 >> 8) & 0xff;

60 *
iv
++ = 
loÿl
->
w•_iv
 & 0xff;

61 *
iv
++ = 
keyidx
 << 6;

62 
	}
}

65 
u8
 *
	$›“80211_w•_add_iv
(
›“80211_loÿl
 *
loÿl
,

66 
sk_buff
 *
skb
,

67 
keyËn
, 
keyidx
)

69 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

70 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

71 
hd¾’
;

72 
u8
 *
Ãwhdr
;

74 
hdr
->
äame_cÚŒŞ
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

76 ià(
	`WARN_ON
(
	`skb_h—droom
(
skb
è< 
IEEE80211_WEP_IV_LEN
))

77  
NULL
;

79 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

80 
Ãwhdr
 = 
	`skb_push
(
skb
, 
IEEE80211_WEP_IV_LEN
);

81 
	`memmove
(
Ãwhdr
,‚ewhd¸+ 
IEEE80211_WEP_IV_LEN
, 
hd¾’
);

84 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

85 (
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
))

86  
Ãwhdr
 + 
hd¾’
;

88 
	`›“80211_w•_g‘_iv
(
loÿl
, 
keyËn
, 
keyidx
, 
Ãwhdr
 + 
hd¾’
);

89  
Ãwhdr
 + 
hd¾’
;

90 
	}
}

93 
	$›“80211_w•_»move_iv
(
›“80211_loÿl
 *
loÿl
,

94 
sk_buff
 *
skb
,

95 
›“80211_key
 *
key
)

97 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

98 
hd¾’
;

100 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

101 
	`memmove
(
skb
->
d©a
 + 
IEEE80211_WEP_IV_LEN
, skb->d©a, 
hd¾’
);

102 
	`skb_puÎ
(
skb
, 
IEEE80211_WEP_IV_LEN
);

103 
	}
}

109 
	$›“80211_w•_’üy±_d©a
(
¬c4_ùx
 *
ùx
, 
u8
 *
rc4key
,

110 
size_t
 
kËn
, 
u8
 *
d©a
, size_ˆ
d©a_Ën
)

112 
__Ë32
 
icv
;

114 
icv
 = 
	`ıu_to_Ë32
(~
	`üc32_Ë
(~0, 
d©a
, 
d©a_Ën
));

115 
	`put_uÇligÃd
(
icv
, (
__Ë32
 *)(
d©a
 + 
d©a_Ën
));

117 
	`¬c4_£tkey
(
ùx
, 
rc4key
, 
kËn
);

118 
	`¬c4_üy±
(
ùx
, 
d©a
, d©a, 
d©a_Ën
 + 
IEEE80211_WEP_ICV_LEN
);

119 
	`memz”o_ex¶ic™
(
ùx
, (*ctx));

122 
	}
}

132 
	$›“80211_w•_’üy±
(
›“80211_loÿl
 *
loÿl
,

133 
sk_buff
 *
skb
,

134 cÚ¡ 
u8
 *
key
, 
keyËn
, 
keyidx
)

136 
u8
 *
iv
;

137 
size_t
 
Ën
;

138 
u8
 
rc4key
[3 + 
WLAN_KEY_LEN_WEP104
];

140 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< 
IEEE80211_WEP_ICV_LEN
))

143 
iv
 = 
	`›“80211_w•_add_iv
(
loÿl
, 
skb
, 
keyËn
, 
keyidx
);

144 ià(!
iv
)

147 
Ën
 = 
skb
->ËÀ- (
iv
 + 
IEEE80211_WEP_IV_LEN
 - skb->
d©a
);

150 
	`memıy
(
rc4key
, 
iv
, 3);

153 
	`memıy
(
rc4key
 + 3, 
key
, 
keyËn
);

156 
	`skb_put
(
skb
, 
IEEE80211_WEP_ICV_LEN
);

158  
	`›“80211_w•_’üy±_d©a
(&
loÿl
->
w•_tx_ùx
, 
rc4key
, 
keyËn
 + 3,

159 
iv
 + 
IEEE80211_WEP_IV_LEN
, 
Ën
);

160 
	}
}

166 
	$›“80211_w•_deüy±_d©a
(
¬c4_ùx
 *
ùx
, 
u8
 *
rc4key
,

167 
size_t
 
kËn
, 
u8
 *
d©a
, size_ˆ
d©a_Ën
)

169 
__Ë32
 
üc
;

171 
	`¬c4_£tkey
(
ùx
, 
rc4key
, 
kËn
);

172 
	`¬c4_üy±
(
ùx
, 
d©a
, d©a, 
d©a_Ën
 + 
IEEE80211_WEP_ICV_LEN
);

173 
	`memz”o_ex¶ic™
(
ùx
, (*ctx));

175 
üc
 = 
	`ıu_to_Ë32
(~
	`üc32_Ë
(~0, 
d©a
, 
d©a_Ën
));

176 ià(
	`memcmp
(&
üc
, 
d©a
 + 
d©a_Ën
, 
IEEE80211_WEP_ICV_LEN
) != 0)

181 
	}
}

192 
	$›“80211_w•_deüy±
(
›“80211_loÿl
 *
loÿl
,

193 
sk_buff
 *
skb
,

194 
›“80211_key
 *
key
)

196 
u32
 
kËn
;

197 
u8
 
rc4key
[3 + 
WLAN_KEY_LEN_WEP104
];

198 
u8
 
keyidx
;

199 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

200 
hd¾’
;

201 
size_t
 
Ën
;

202 
»t
 = 0;

204 ià(!
	`›“80211_has_´Ùeùed
(
hdr
->
äame_cÚŒŞ
))

207 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

208 ià(
skb
->
Ën
 < 
hd¾’
 + 
IEEE80211_WEP_IV_LEN
 + 
IEEE80211_WEP_ICV_LEN
)

211 
Ën
 = 
skb
->ËÀ- 
hd¾’
 - 
IEEE80211_WEP_IV_LEN
 - 
IEEE80211_WEP_ICV_LEN
;

213 
keyidx
 = 
skb
->
d©a
[
hd¾’
 + 3] >> 6;

215 ià(!
key
 || 
keyidx
 !ğkey->
cÚf
.keyidx)

218 
kËn
 = 3 + 
key
->
cÚf
.
keyËn
;

221 
	`memıy
(
rc4key
, 
skb
->
d©a
 + 
hd¾’
, 3);

224 
	`memıy
(
rc4key
 + 3, 
key
->
cÚf
.key, key->cÚf.
keyËn
);

226 ià(
	`›“80211_w•_deüy±_d©a
(&
loÿl
->
w•_rx_ùx
, 
rc4key
, 
kËn
,

227 
skb
->
d©a
 + 
hd¾’
 +

228 
IEEE80211_WEP_IV_LEN
, 
Ën
))

229 
»t
 = -1;

232 
	`skb_Œim
(
skb
, skb->
Ën
 - 
IEEE80211_WEP_ICV_LEN
);

235 
	`memmove
(
skb
->
d©a
 + 
IEEE80211_WEP_IV_LEN
, skb->d©a, 
hd¾’
);

236 
	`skb_puÎ
(
skb
, 
IEEE80211_WEP_IV_LEN
);

238  
»t
;

239 
	}
}

241 
›“80211_rx_»suÉ


242 
	$›“80211_üy±o_w•_deüy±
(
›“80211_rx_d©a
 *
rx
)

244 
sk_buff
 *
skb
 = 
rx
->skb;

245 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

246 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

247 
__Ë16
 
fc
 = 
hdr
->
äame_cÚŒŞ
;

249 ià(!
	`›“80211_is_d©a
(
fc
è&& !
	`›“80211_is_auth
(fc))

250  
RX_CONTINUE
;

252 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

253 ià(
	`skb_lš—rize
(
rx
->
skb
))

254  
RX_DROP_U_OOM
;

255 ià(
	`›“80211_w•_deüy±
(
rx
->
loÿl
,„x->
skb
,„x->
key
))

256  
RX_DROP_U_WEP_DEC_FAIL
;

257 } ià(!(
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
)) {

258 ià(!
	`pskb_may_puÎ
(
rx
->
skb
, 
	`›“80211_hd¾’
(
fc
) +

259 
IEEE80211_WEP_IV_LEN
))

260  
RX_DROP_U_NO_IV
;

261 
	`›“80211_w•_»move_iv
(
rx
->
loÿl
,„x->
skb
,„x->
key
);

263 ià(!(
¡©us
->
æag
 & 
RX_FLAG_ICV_STRIPPED
) &&

264 
	`pskb_Œim
(
rx
->
skb
,„x->skb->
Ën
 - 
IEEE80211_WEP_ICV_LEN
))

265  
RX_DROP_U_NO_ICV
;

268  
RX_CONTINUE
;

269 
	}
}

271 
	$w•_’üy±_skb
(
›“80211_tx_d©a
 *
tx
, 
sk_buff
 *
skb
)

273 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

274 
›“80211_key_cÚf
 *
hw_key
 = 
šfo
->
cÚŒŞ
.hw_key;

276 ià(!
hw_key
) {

277 ià(
	`›“80211_w•_’üy±
(
tx
->
loÿl
, 
skb
,x->
key
->
cÚf
.key,

278 
tx
->
key
->
cÚf
.
keyËn
,

279 
tx
->
key
->
cÚf
.
keyidx
))

281 } ià((
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
) ||

282 (
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
)) {

283 ià(!
	`›“80211_w•_add_iv
(
tx
->
loÿl
, 
skb
,

284 
tx
->
key
->
cÚf
.
keyËn
,

285 
tx
->
key
->
cÚf
.
keyidx
))

290 
	}
}

292 
›“80211_tx_»suÉ


293 
	$›“80211_üy±o_w•_’üy±
(
›“80211_tx_d©a
 *
tx
)

295 
sk_buff
 *
skb
;

297 
	`›“80211_tx_£t_´Ùeùed
(
tx
);

299 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

300 ià(
	`w•_’üy±_skb
(
tx
, 
skb
) < 0) {

301 
	`I802_DEBUG_INC
(
tx
->
loÿl
->
tx_hªdËrs_drİ_w•
);

302  
TX_DROP
;

306  
TX_CONTINUE
;

307 
	}
}

	@wep.h

8 #iâdeà
WEP_H


9 
	#WEP_H


	)

11 
	~<lšux/skbuff.h
>

12 
	~<lšux/ty³s.h
>

13 
	~"›“80211_i.h
"

14 
	~"key.h
"

16 
›“80211_w•_š™
(
›“80211_loÿl
 *
loÿl
);

17 
›“80211_w•_’üy±_d©a
(
¬c4_ùx
 *
ùx
, 
u8
 *
rc4key
,

18 
size_t
 
kËn
, 
u8
 *
d©a
, size_ˆ
d©a_Ën
);

19 
›“80211_w•_’üy±
(
›“80211_loÿl
 *
loÿl
,

20 
sk_buff
 *
skb
,

21 cÚ¡ 
u8
 *
key
, 
keyËn
, 
keyidx
);

22 
›“80211_w•_deüy±_d©a
(
¬c4_ùx
 *
ùx
, 
u8
 *
rc4key
,

23 
size_t
 
kËn
, 
u8
 *
d©a
, size_ˆ
d©a_Ën
);

25 
›“80211_rx_»suÉ


26 
›“80211_üy±o_w•_deüy±
(
›“80211_rx_d©a
 *
rx
);

27 
›“80211_tx_»suÉ


28 
›“80211_üy±o_w•_’üy±
(
›“80211_tx_d©a
 *
tx
);

	@wme.c

8 
	~<lšux/Ãtdeviû.h
>

9 
	~<lšux/skbuff.h
>

10 
	~<lšux/moduË.h
>

11 
	~<lšux/if_¬p.h
>

12 
	~<lšux/ty³s.h
>

13 
	~<Ãt/.h
>

14 
	~<Ãt/pkt_sched.h
>

16 
	~<Ãt/mac80211.h
>

17 
	~"›“80211_i.h
"

18 
	~"wme.h
"

23 cÚ¡ 
	g›“802_1d_to_ac
[8] = {

24 
IEEE80211_AC_BE
,

25 
IEEE80211_AC_BK
,

26 
IEEE80211_AC_BK
,

27 
IEEE80211_AC_BE
,

28 
IEEE80211_AC_VI
,

29 
IEEE80211_AC_VI
,

30 
IEEE80211_AC_VO
,

31 
IEEE80211_AC_VO


34 
	$wme_downg¿de_ac
(
sk_buff
 *
skb
)

36 
skb
->
´iÜ™y
) {

39 
skb
->
´iÜ™y
 = 5;

43 
skb
->
´iÜ™y
 = 3;

47 
skb
->
´iÜ™y
 = 2;

52 
	}
}

60 
šlše
 
u8
 
	$›“80211_fix_»£rved_tid
(
u8
 
tid
)

62 
tid
) {

82 
	}
}

84 
u16
 
	$›“80211_downg¿de_queue
(
›“80211_sub_if_d©a
 *
sd©a
,

85 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

87 
›“80211_if_mªaged
 *
ifmgd
 = &
sd©a
->
u
.
mgd
;

90 
sd©a
->
wmm_acm
 & 
	`BIT
(
skb
->
´iÜ™y
)) {

91 
ac
 = 
›“802_1d_to_ac
[
skb
->
´iÜ™y
];

93 ià(
ifmgd
->
tx_t¥ec
[
ac
].
adm™‹d_time
 &&

94 
skb
->
´iÜ™y
 =ğ
ifmgd
->
tx_t¥ec
[
ac
].
up
)

95  
ac
;

97 ià(
	`wme_downg¿de_ac
(
skb
)) {

109 ià(
¡a
 && s->
»£rved_tid
 =ğ
skb
->
´iÜ™y
)

110 
skb
->
´iÜ™y
 = 
	`›“80211_fix_»£rved_tid
(skb->priority);

113  
›“802_1d_to_ac
[
skb
->
´iÜ™y
];

114 
	}
}

117 
u16
 
	$›“80211_£Ëù_queue_80211
(
›“80211_sub_if_d©a
 *
sd©a
,

118 
sk_buff
 *
skb
,

119 
›“80211_hdr
 *
hdr
)

121 
›“80211_loÿl
 *
loÿl
 = 
sd©a
->local;

122 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

123 
u8
 *
p
;

126 
	`skb_g‘_hash
(
skb
);

128 ià((
šfo
->
cÚŒŞ
.
æags
 & 
IEEE80211_TX_CTRL_DONT_REORDER
) ||

129 
loÿl
->
hw
.
queues
 < 
IEEE80211_NUM_ACS
)

132 ià(!
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
)) {

133 
skb
->
´iÜ™y
 = 7;

134  
›“802_1d_to_ac
[
skb
->
´iÜ™y
];

136 ià(!
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
)) {

137 
skb
->
´iÜ™y
 = 0;

138  
›“802_1d_to_ac
[
skb
->
´iÜ™y
];

141 
p
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

142 
skb
->
´iÜ™y
 = *
p
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

144  
	`›“80211_downg¿de_queue
(
sd©a
, 
NULL
, 
skb
);

145 
	}
}

147 
u16
 
	$›“80211_£Ëù_queue
(
›“80211_sub_if_d©a
 *
sd©a
,

148 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
)

150 cÚ¡ 
‘hhdr
 *
‘h
 = (*)
skb
->
d©a
;

151 
mac80211_qos_m­
 *
qos_m­
;

152 
boŞ
 
qos
;

155 
	`skb_g‘_hash
(
skb
);

158 ià((
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_MESH_POINT
 &&

159 !
	`is_muÉiÿ¡_‘h”_addr
(
‘h
->
h_de¡
)) ||

160 (
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_OCB
 && 
¡a
))

161 
qos
 = 
Œue
;

162 ià(
¡a
)

163 
qos
 = 
¡a
->¡a.
wme
;

165 
qos
 = 
çl£
;

167 ià(!
qos
) {

168 
skb
->
´iÜ™y
 = 0;

169  
IEEE80211_AC_BE
;

172 ià(
skb
->
´ÙocŞ
 =ğ
sd©a
->
cÚŒŞ_pÜt_´ÙocŞ
) {

173 
skb
->
´iÜ™y
 = 7;

174 
downg¿de
;

179 
qos_m­
 = 
	`rcu_d”eã»nû
(
sd©a
->qos_map);

180 
skb
->
´iÜ™y
 = 
	`cfg80211_şassify8021d
(skb, 
qos_m­
 ?

181 &
qos_m­
->qos_m­ : 
NULL
);

183 
downg¿de
:

184  
	`›“80211_downg¿de_queue
(
sd©a
, 
¡a
, 
skb
);

185 
	}
}

193 
	$›“80211_£t_qos_hdr
(
›“80211_sub_if_d©a
 *
sd©a
,

194 
sk_buff
 *
skb
)

196 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

197 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

198 
u8
 
tid
 = 
skb
->
´iÜ™y
 & 
IEEE80211_QOS_CTL_TAG1D_MASK
;

199 
u8
 
æags
;

200 
u8
 *
p
;

202 ià(!
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
))

205 
p
 = 
	`›“80211_g‘_qos_ùl
(
hdr
);

208 ià(
šfo
->
æags
 & 
IEEE80211_TX_CTL_INJECTED
) {

210 ià(*
p
 & 
IEEE80211_QOS_CTL_ACK_POLICY_NOACK
)

211 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

221 
æags
 = *
p
 & ~(
IEEE80211_QOS_CTL_TID_MASK
 |

222 
IEEE80211_QOS_CTL_ACK_POLICY_MASK
);

224 ià(
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) ||

225 
sd©a
->
nßck_m­
 & 
	`BIT
(
tid
)) {

226 
æags
 |ğ
IEEE80211_QOS_CTL_ACK_POLICY_NOACK
;

227 
šfo
->
æags
 |ğ
IEEE80211_TX_CTL_NO_ACK
;

230 *
p
 = 
æags
 | 
tid
;

233 
p
++;

235 ià(
	`›“80211_vif_is_mesh
(&
sd©a
->
vif
)) {

237 *
p
 &ğ((
IEEE80211_QOS_CTL_RSPI
 |

238 
IEEE80211_QOS_CTL_MESH_PS_LEVEL
) >> 8);

241 ià(!
	`›“80211_is_qos_nuÎfunc
(
hdr
->
äame_cÚŒŞ
))

242 *
p
 |ğ(
IEEE80211_QOS_CTL_MESH_CONTROL_PRESENT
 >> 8);

244 *
p
 = 0;

246 
	}
}

	@wme.h

7 #iâdeà
_WME_H


8 
	#_WME_H


	)

10 
	~<lšux/Ãtdeviû.h
>

11 
	~"›“80211_i.h
"

13 
u16
 
›“80211_£Ëù_queue_80211
(
›“80211_sub_if_d©a
 *
sd©a
,

14 
sk_buff
 *
skb
,

15 
›“80211_hdr
 *
hdr
);

16 
u16
 
›“80211_£Ëù_queue
(
›“80211_sub_if_d©a
 *
sd©a
,

17 
¡a_šfo
 *
¡a
, 
sk_buff
 *
skb
);

18 
›“80211_£t_qos_hdr
(
›“80211_sub_if_d©a
 *
sd©a
,

19 
sk_buff
 *
skb
);

	@wpa.c

9 
	~<lšux/Ãtdeviû.h
>

10 
	~<lšux/ty³s.h
>

11 
	~<lšux/skbuff.h
>

12 
	~<lšux/comp”.h
>

13 
	~<lšux/›“80211.h
>

14 
	~<lšux/gå.h
>

15 
	~<asm/uÇligÃd.h
>

16 
	~<Ãt/mac80211.h
>

17 
	~<üy±o/«s.h
>

18 
	~<üy±o/uts.h
>

20 
	~"›“80211_i.h
"

21 
	~"mich«l.h
"

22 
	~"tk.h
"

23 
	~"«s_ccm.h
"

24 
	~"«s_cmac.h
"

25 
	~"«s_gmac.h
"

26 
	~"«s_gcm.h
"

27 
	~"w·.h
"

29 
›“80211_tx_»suÉ


30 
	$›“80211_tx_h_mich«l_mic_add
(
›“80211_tx_d©a
 *
tx
)

32 
u8
 *
d©a
, *
key
, *
mic
;

33 
size_t
 
d©a_Ën
;

34 
hd¾’
;

35 
›“80211_hdr
 *
hdr
;

36 
sk_buff
 *
skb
 = 
tx
->skb;

37 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

38 

;

40 
hdr
 = (
›“80211_hdr
 *)
skb
->
d©a
;

41 ià(!
tx
->
key
 ||x->key->
cÚf
.
ch”
 !ğ
WLAN_CIPHER_SUITE_TKIP
 ||

42 
skb
->
Ën
 < 24 || !
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

43  
TX_CONTINUE
;

45 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

46 ià(
skb
->
Ën
 < 
hd¾’
)

47  
TX_DROP
;

49 
d©a
 = 
skb
->d©¨+ 
hd¾’
;

50 
d©a_Ën
 = 
skb
->
Ën
 - 
hd¾’
;

52 ià(
	`uÆik–y
(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_TKIP_MIC_FAILURE
)) {

54 
šfo
->
cÚŒŞ
.
hw_key
 = 
NULL
;

57 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

58 (
šfo
->
æags
 & 
IEEE80211_TX_CTL_DONTFRAG
 ||

59 
	`›“80211_hw_check
(&
tx
->
loÿl
->
hw
, 
SUPPORTS_TX_FRAG
)) &&

60 !(
tx
->
key
->
cÚf
.
æags
 & (
IEEE80211_KEY_FLAG_GENERATE_MMIC
 |

61 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
))) {

63  
TX_CONTINUE
;

66 

 = 
MICHAEL_MIC_LEN
;

67 ià(!
šfo
->
cÚŒŞ
.
hw_key
)

68 

 +ğ
IEEE80211_TKIP_ICV_LEN
;

70 ià(
	`WARN
(
	`skb_room
(
skb
è< 

 ||

71 
	`skb_h—droom
(
skb
è< 
IEEE80211_TKIP_IV_LEN
,

73 
	`skb_h—droom
(
skb
), 
IEEE80211_TKIP_IV_LEN
,

74 
	`skb_room
(
skb
), 

))

75  
TX_DROP
;

77 
mic
 = 
	`skb_put
(
skb
, 
MICHAEL_MIC_LEN
);

79 ià(
tx
->
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_PUT_MIC_SPACE
) {

81 
	`mem£t
(
mic
, 0, 
MICHAEL_MIC_LEN
);

82  
TX_CONTINUE
;

85 
key
 = &
tx
->key->
cÚf
.key[
NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
];

86 
	`mich«l_mic
(
key
, 
hdr
, 
d©a
, 
d©a_Ën
, 
mic
);

87 ià(
	`uÆik–y
(
šfo
->
æags
 & 
IEEE80211_TX_INTFL_TKIP_MIC_FAILURE
))

88 
mic
[0]++;

90  
TX_CONTINUE
;

91 
	}
}

94 
›“80211_rx_»suÉ


95 
	$›“80211_rx_h_mich«l_mic_v”ify
(
›“80211_rx_d©a
 *
rx
)

97 
u8
 *
d©a
, *
key
 = 
NULL
;

98 
size_t
 
d©a_Ën
;

99 
hd¾’
;

100 
u8
 
mic
[
MICHAEL_MIC_LEN
];

101 
sk_buff
 *
skb
 = 
rx
->skb;

102 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

103 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

109 ià(!
	`›“80211_is_d©a_´e£Á
(
hdr
->
äame_cÚŒŞ
))

110  
RX_CONTINUE
;

118 ià(
¡©us
->
æag
 & (
RX_FLAG_MMIC_STRIPPED
 | 
RX_FLAG_IV_STRIPPED
)) {

119 ià(
¡©us
->
æag
 & 
RX_FLAG_MMIC_ERROR
)

120 
mic_ç_no_key
;

122 ià(!(
¡©us
->
æag
 & 
RX_FLAG_IV_STRIPPED
è&& 
rx
->
key
 &&

123 
rx
->
key
->
cÚf
.
ch”
 =ğ
WLAN_CIPHER_SUITE_TKIP
)

124 
upd©e_iv
;

126  
RX_CONTINUE
;

134 ià(!
rx
->
key
 ||„x->key->
cÚf
.
ch”
 !ğ
WLAN_CIPHER_SUITE_TKIP
 ||

135 !(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
))

136  
RX_CONTINUE
;

138 ià(
rx
->
sd©a
->
vif
.
ty³
 =ğ
NL80211_IFTYPE_AP
 &&„x->
key
->
cÚf
.
keyidx
) {

145  
RX_DROP_U_AP_RX_GROUPCAST
;

148 ià(
¡©us
->
æag
 & 
RX_FLAG_MMIC_ERROR
)

149 
mic_ç
;

151 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

152 ià(
skb
->
Ën
 < 
hd¾’
 + 
MICHAEL_MIC_LEN
)

153  
RX_DROP_U_SHORT_MMIC
;

155 ià(
	`skb_lš—rize
(
rx
->
skb
))

156  
RX_DROP_U_OOM
;

157 
hdr
 = (*)
skb
->
d©a
;

159 
d©a
 = 
skb
->d©¨+ 
hd¾’
;

160 
d©a_Ën
 = 
skb
->
Ën
 - 
hd¾’
 - 
MICHAEL_MIC_LEN
;

161 
key
 = &
rx
->key->
cÚf
.key[
NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
];

162 
	`mich«l_mic
(
key
, 
hdr
, 
d©a
, 
d©a_Ën
, 
mic
);

163 ià(
	`üy±o_memÃq
(
mic
, 
d©a
 + 
d©a_Ën
, 
MICHAEL_MIC_LEN
))

164 
mic_ç
;

167 
	`skb_Œim
(
skb
, skb->
Ën
 - 
MICHAEL_MIC_LEN
);

169 
upd©e_iv
:

171 
rx
->
key
->
u
.
tk
.rx[rx->
£cur™y_idx
].
iv32
 =„x->tkip.iv32;

172 
rx
->
key
->
u
.
tk
.rx[rx->
£cur™y_idx
].
iv16
 =„x->tkip.iv16;

174  
RX_CONTINUE
;

176 
mic_ç
:

177 
rx
->
key
->
u
.
tk
.
mic_çu»s
++;

179 
mic_ç_no_key
:

185 
	`cfg80211_mich«l_mic_çu»
(
rx
->
sd©a
->
dev
, 
hdr
->
addr2
,

186 
	`is_muÉiÿ¡_‘h”_addr
(
hdr
->
addr1
) ?

187 
NL80211_KEYTYPE_GROUP
 :

188 
NL80211_KEYTYPE_PAIRWISE
,

189 
rx
->
key
 ?„x->key->
cÚf
.
keyidx
 : -1,

190 
NULL
, 
GFP_ATOMIC
);

191  
RX_DROP_U_MMIC_FAIL
;

192 
	}
}

194 
	$tk_’üy±_skb
(
›“80211_tx_d©a
 *
tx
, 
sk_buff
 *
skb
)

196 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

197 
›“80211_key
 *
key
 = 
tx
->key;

198 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

199 
hd¾’
;

200 
Ën
, 

;

201 
u64
 
²
;

202 
u8
 *
pos
;

204 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

205 !(
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
) &&

206 !(
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
)) {

211 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

212 
Ën
 = 
skb
->ËÀ- 
hd¾’
;

214 ià(
šfo
->
cÚŒŞ
.
hw_key
)

215 

 = 0;

217 

 = 
IEEE80211_TKIP_ICV_LEN
;

219 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< 

 ||

220 
	`skb_h—droom
(
skb
è< 
IEEE80211_TKIP_IV_LEN
))

223 
pos
 = 
	`skb_push
(
skb
, 
IEEE80211_TKIP_IV_LEN
);

224 
	`memmove
(
pos
,…o + 
IEEE80211_TKIP_IV_LEN
, 
hd¾’
);

225 
pos
 +ğ
hd¾’
;

228 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

229 (
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
))

233 
²
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

234 
pos
 = 
	`›“80211_tk_add_iv
Õos, &
key
->
cÚf
, 
²
);

237 ià(
šfo
->
cÚŒŞ
.
hw_key
)

241 
	`skb_put
(
skb
, 
IEEE80211_TKIP_ICV_LEN
);

243  
	`›“80211_tk_’üy±_d©a
(&
tx
->
loÿl
->
w•_tx_ùx
,

244 
key
, 
skb
, 
pos
, 
Ën
);

245 
	}
}

248 
›“80211_tx_»suÉ


249 
	$›“80211_üy±o_tk_’üy±
(
›“80211_tx_d©a
 *
tx
)

251 
sk_buff
 *
skb
;

253 
	`›“80211_tx_£t_´Ùeùed
(
tx
);

255 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

256 ià(
	`tk_’üy±_skb
(
tx
, 
skb
) < 0)

257  
TX_DROP
;

260  
TX_CONTINUE
;

261 
	}
}

264 
›“80211_rx_»suÉ


265 
	$›“80211_üy±o_tk_deüy±
(
›“80211_rx_d©a
 *
rx
)

267 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
rx
->
skb
->
d©a
;

268 
hd¾’
, 
»s
, 
hwacûl
 = 0;

269 
›“80211_key
 *
key
 = 
rx
->key;

270 
sk_buff
 *
skb
 = 
rx
->skb;

271 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

273 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

275 ià(!
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
))

276  
RX_CONTINUE
;

278 ià(!
rx
->
¡a
 || 
skb
->
Ën
 - 
hd¾’
 < 12)

279  
RX_DROP_U_SHORT_TKIP
;

282 ià(
	`skb_lš—rize
(
rx
->
skb
))

283  
RX_DROP_U_OOM
;

284 
hdr
 = (*)
skb
->
d©a
;

291 ià(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)

292 
hwacûl
 = 1;

294 
»s
 = 
	`›“80211_tk_deüy±_d©a
(&
rx
->
loÿl
->
w•_rx_ùx
,

295 
key
, 
skb
->
d©a
 + 
hd¾’
,

296 
skb
->
Ën
 - 
hd¾’
, 
rx
->
¡a
->¡a.
addr
,

297 
hdr
->
addr1
, 
hwacûl
, 
rx
->
£cur™y_idx
,

298 &
rx
->
tk
.
iv32
,

299 &
rx
->
tk
.
iv16
);

300 ià(
»s
 !ğ
TKIP_DECRYPT_OK
)

301  
RX_DROP_U_TKIP_FAIL
;

304 ià(!(
¡©us
->
æag
 & 
RX_FLAG_ICV_STRIPPED
))

305 
	`skb_Œim
(
skb
, skb->
Ën
 - 
IEEE80211_TKIP_ICV_LEN
);

308 
	`memmove
(
skb
->
d©a
 + 
IEEE80211_TKIP_IV_LEN
, skb->d©a, 
hd¾’
);

309 
	`skb_puÎ
(
skb
, 
IEEE80211_TKIP_IV_LEN
);

311  
RX_CONTINUE
;

312 
	}
}

318 
u8
 
	$ccmp_gcmp_¯d
(
sk_buff
 *
skb
, 
u8
 *
¯d
, 
boŞ
 
¥p_amsdu
)

320 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

321 
__Ë16
 
mask_fc
;

322 
a4_šşuded
, 
mgmt
;

323 
u8
 
qos_tid
;

324 
u16
 
Ën_a
 = 22;

330 
mgmt
 = 
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
);

331 
mask_fc
 = 
hdr
->
äame_cÚŒŞ
;

332 
mask_fc
 &ğ~
	`ıu_to_Ë16
(
IEEE80211_FCTL_RETRY
 |

333 
IEEE80211_FCTL_PM
 | 
IEEE80211_FCTL_MOREDATA
);

334 ià(!
mgmt
)

335 
mask_fc
 &ğ~
	`ıu_to_Ë16
(0x0070);

336 
mask_fc
 |ğ
	`ıu_to_Ë16
(
IEEE80211_FCTL_PROTECTED
);

338 
a4_šşuded
 = 
	`›“80211_has_a4
(
hdr
->
äame_cÚŒŞ
);

339 ià(
a4_šşuded
)

340 
Ën_a
 += 6;

342 ià(
	`›“80211_is_d©a_qos
(
hdr
->
äame_cÚŒŞ
)) {

343 
qos_tid
 = *
	`›“80211_g‘_qos_ùl
(
hdr
);

345 ià(
¥p_amsdu
)

346 
qos_tid
 &ğ
IEEE80211_QOS_CTL_TID_MASK
 |

347 
IEEE80211_QOS_CTL_A_MSDU_PRESENT
;

349 
qos_tid
 &ğ
IEEE80211_QOS_CTL_TID_MASK
;

351 
mask_fc
 &ğ~
	`ıu_to_Ë16
(
IEEE80211_FCTL_ORDER
);

352 
Ën_a
 += 2;

354 
qos_tid
 = 0;

359 
	`put_uÇligÃd_be16
(
Ën_a
, &
¯d
[0]);

360 
	`put_uÇligÃd
(
mask_fc
, (
__Ë16
 *)&
¯d
[2]);

361 
	`memıy
(&
¯d
[4], &
hdr
->
addrs
, 3 * 
ETH_ALEN
);

364 
¯d
[22] = *((
u8
 *è&
hdr
->
£q_ù¾
) & 0x0f;

365 
¯d
[23] = 0;

367 ià(
a4_šşuded
) {

368 
	`memıy
(&
¯d
[24], 
hdr
->
addr4
, 
ETH_ALEN
);

369 
¯d
[30] = 
qos_tid
;

370 
¯d
[31] = 0;

372 
	`mem£t
(&
¯d
[24], 0, 
ETH_ALEN
 + 
IEEE80211_QOS_CTL_LEN
);

373 
¯d
[24] = 
qos_tid
;

376  
qos_tid
;

377 
	}
}

379 
	$ccmp_¥ecŸl_blocks
(
sk_buff
 *
skb
, 
u8
 *
²
, u8 *
b_0
, u8 *
¯d
,

380 
boŞ
 
¥p_amsdu
)

382 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

383 
u8
 
qos_tid
 = 
	`ccmp_gcmp_¯d
(
skb
, 
¯d
, 
¥p_amsdu
);

392 
b_0
[0] = 0x1;

397 
b_0
[1] = 
qos_tid
 | (
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
) << 4);

398 
	`memıy
(&
b_0
[2], 
hdr
->
addr2
, 
ETH_ALEN
);

399 
	`memıy
(&
b_0
[8], 
²
, 
IEEE80211_CCMP_PN_LEN
);

400 
	}
}

402 
šlše
 
	$ccmp_²2hdr
(
u8
 *
hdr
, u8 *
²
, 
key_id
)

404 
hdr
[0] = 
²
[5];

405 
hdr
[1] = 
²
[4];

406 
hdr
[2] = 0;

407 
hdr
[3] = 0x20 | (
key_id
 << 6);

408 
hdr
[4] = 
²
[3];

409 
hdr
[5] = 
²
[2];

410 
hdr
[6] = 
²
[1];

411 
hdr
[7] = 
²
[0];

412 
	}
}

415 
šlše
 
	$ccmp_hdr2²
(
u8
 *
²
, u8 *
hdr
)

417 
²
[0] = 
hdr
[7];

418 
²
[1] = 
hdr
[6];

419 
²
[2] = 
hdr
[5];

420 
²
[3] = 
hdr
[4];

421 
²
[4] = 
hdr
[1];

422 
²
[5] = 
hdr
[0];

423 
	}
}

426 
	$ccmp_’üy±_skb
(
›“80211_tx_d©a
 *
tx
, 
sk_buff
 *
skb
,

427 
mic_Ën
)

429 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

430 
›“80211_key
 *
key
 = 
tx
->key;

431 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

432 
hd¾’
, 
Ën
, 

;

433 
u8
 *
pos
;

434 
u8
 
²
[6];

435 
u64
 
²64
;

436 
u8
 
¯d
[
CCM_AAD_LEN
];

437 
u8
 
b_0
[
AES_BLOCK_SIZE
];

439 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

440 !(
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
) &&

441 !(
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
) &&

442 !((
šfo
->
cÚŒŞ
.
hw_key
->
æags
 &

443 
IEEE80211_KEY_FLAG_GENERATE_IV_MGMT
) &&

444 
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))) {

452 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

453 
Ën
 = 
skb
->ËÀ- 
hd¾’
;

455 ià(
šfo
->
cÚŒŞ
.
hw_key
)

456 

 = 0;

458 

 = 
mic_Ën
;

460 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< 

 ||

461 
	`skb_h—droom
(
skb
è< 
IEEE80211_CCMP_HDR_LEN
))

464 
pos
 = 
	`skb_push
(
skb
, 
IEEE80211_CCMP_HDR_LEN
);

465 
	`memmove
(
pos
,…o + 
IEEE80211_CCMP_HDR_LEN
, 
hd¾’
);

468 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

469 (
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
))

472 
pos
 +ğ
hd¾’
;

474 
²64
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

476 
²
[5] = 
²64
;

477 
²
[4] = 
²64
 >> 8;

478 
²
[3] = 
²64
 >> 16;

479 
²
[2] = 
²64
 >> 24;

480 
²
[1] = 
²64
 >> 32;

481 
²
[0] = 
²64
 >> 40;

483 
	`ccmp_²2hdr
(
pos
, 
²
, 
key
->
cÚf
.
keyidx
);

486 ià(
šfo
->
cÚŒŞ
.
hw_key
)

489 
pos
 +ğ
IEEE80211_CCMP_HDR_LEN
;

490 
	`ccmp_¥ecŸl_blocks
(
skb
, 
²
, 
b_0
, 
¯d
,

491 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_SPP_AMSDU
);

492  
	`›“80211_«s_ccm_’üy±
(
key
->
u
.
ccmp
.
tfm
, 
b_0
, 
¯d
, 
pos
, 
Ën
,

493 
	`skb_put
(
skb
, 
mic_Ën
));

494 
	}
}

497 
›“80211_tx_»suÉ


498 
	$›“80211_üy±o_ccmp_’üy±
(
›“80211_tx_d©a
 *
tx
,

499 
mic_Ën
)

501 
sk_buff
 *
skb
;

503 
	`›“80211_tx_£t_´Ùeùed
(
tx
);

505 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

506 ià(
	`ccmp_’üy±_skb
(
tx
, 
skb
, 
mic_Ën
) < 0)

507  
TX_DROP
;

510  
TX_CONTINUE
;

511 
	}
}

514 
›“80211_rx_»suÉ


515 
	$›“80211_üy±o_ccmp_deüy±
(
›“80211_rx_d©a
 *
rx
,

516 
mic_Ën
)

518 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

519 
hd¾’
;

520 
›“80211_key
 *
key
 = 
rx
->key;

521 
sk_buff
 *
skb
 = 
rx
->skb;

522 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

523 
u8
 
²
[
IEEE80211_CCMP_PN_LEN
];

524 
d©a_Ën
;

525 
queue
;

527 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

529 ià(!
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

530 !
	`›“80211_is_robu¡_mgmt_äame
(
skb
))

531  
RX_CONTINUE
;

533 ià(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
) {

534 ià(!
	`pskb_may_puÎ
(
rx
->
skb
, 
hd¾’
 + 
IEEE80211_CCMP_HDR_LEN
))

535  
RX_DROP_U_SHORT_CCMP
;

536 ià(
¡©us
->
æag
 & 
RX_FLAG_MIC_STRIPPED
)

537 
mic_Ën
 = 0;

539 ià(
	`skb_lš—rize
(
rx
->
skb
))

540  
RX_DROP_U_OOM
;

544 
hdr
 = (*)
rx
->
skb
->
d©a
;

546 
d©a_Ën
 = 
skb
->
Ën
 - 
hd¾’
 - 
IEEE80211_CCMP_HDR_LEN
 - 
mic_Ën
;

547 ià(!
rx
->
¡a
 || 
d©a_Ën
 < 0)

548  
RX_DROP_U_SHORT_CCMP
;

550 ià(!(
¡©us
->
æag
 & 
RX_FLAG_PN_VALIDATED
)) {

551 
»s
;

553 
	`ccmp_hdr2²
(
²
, 
skb
->
d©a
 + 
hd¾’
);

555 
queue
 = 
rx
->
£cur™y_idx
;

557 
»s
 = 
	`memcmp
(
²
, 
key
->
u
.
ccmp
.
rx_²
[
queue
],

558 
IEEE80211_CCMP_PN_LEN
);

559 ià(
»s
 < 0 ||

560 (!
»s
 && !(
¡©us
->
æag
 & 
RX_FLAG_ALLOW_SAME_PN
))) {

561 
key
->
u
.
ccmp
.
»¶ays
++;

562  
RX_DROP_U_REPLAY
;

565 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

566 
u8
 
¯d
[2 * 
AES_BLOCK_SIZE
];

567 
u8
 
b_0
[
AES_BLOCK_SIZE
];

569 
	`ccmp_¥ecŸl_blocks
(
skb
, 
²
, 
b_0
, 
¯d
,

570 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_SPP_AMSDU
);

572 ià(
	`›“80211_«s_ccm_deüy±
(

573 
key
->
u
.
ccmp
.
tfm
, 
b_0
, 
¯d
,

574 
skb
->
d©a
 + 
hd¾’
 + 
IEEE80211_CCMP_HDR_LEN
,

575 
d©a_Ën
,

576 
skb
->
d©a
 + skb->
Ën
 - 
mic_Ën
))

577  
RX_DROP_U_MIC_FAIL
;

580 
	`memıy
(
key
->
u
.
ccmp
.
rx_²
[
queue
], 
²
, 
IEEE80211_CCMP_PN_LEN
);

581 ià(
	`uÆik–y
(
	`›“80211_is_äag
(
hdr
)))

582 
	`memıy
(
rx
->
ccm_gcm
.
²
,…n, 
IEEE80211_CCMP_PN_LEN
);

586 ià(
	`pskb_Œim
(
skb
, skb->
Ën
 - 
mic_Ën
))

587  
RX_DROP_U_SHORT_CCMP_MIC
;

588 
	`memmove
(
skb
->
d©a
 + 
IEEE80211_CCMP_HDR_LEN
, skb->d©a, 
hd¾’
);

589 
	`skb_puÎ
(
skb
, 
IEEE80211_CCMP_HDR_LEN
);

591  
RX_CONTINUE
;

592 
	}
}

594 
	$gcmp_¥ecŸl_blocks
(
sk_buff
 *
skb
, 
u8
 *
²
, u8 *
j_0
, u8 *
¯d
,

595 
boŞ
 
¥p_amsdu
)

597 
›“80211_hdr
 *
hdr
 = (*)
skb
->
d©a
;

599 
	`memıy
(
j_0
, 
hdr
->
addr2
, 
ETH_ALEN
);

600 
	`memıy
(&
j_0
[
ETH_ALEN
], 
²
, 
IEEE80211_GCMP_PN_LEN
);

601 
j_0
[13] = 0;

602 
j_0
[14] = 0;

603 
j_0
[
AES_BLOCK_SIZE
 - 1] = 0x01;

605 
	`ccmp_gcmp_¯d
(
skb
, 
¯d
, 
¥p_amsdu
);

606 
	}
}

608 
šlše
 
	$gcmp_²2hdr
(
u8
 *
hdr
, cÚ¡ u8 *
²
, 
key_id
)

610 
hdr
[0] = 
²
[5];

611 
hdr
[1] = 
²
[4];

612 
hdr
[2] = 0;

613 
hdr
[3] = 0x20 | (
key_id
 << 6);

614 
hdr
[4] = 
²
[3];

615 
hdr
[5] = 
²
[2];

616 
hdr
[6] = 
²
[1];

617 
hdr
[7] = 
²
[0];

618 
	}
}

620 
šlše
 
	$gcmp_hdr2²
(
u8
 *
²
, cÚ¡ u8 *
hdr
)

622 
²
[0] = 
hdr
[7];

623 
²
[1] = 
hdr
[6];

624 
²
[2] = 
hdr
[5];

625 
²
[3] = 
hdr
[4];

626 
²
[4] = 
hdr
[1];

627 
²
[5] = 
hdr
[0];

628 
	}
}

630 
	$gcmp_’üy±_skb
(
›“80211_tx_d©a
 *
tx
, 
sk_buff
 *
skb
)

632 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

633 
›“80211_key
 *
key
 = 
tx
->key;

634 
›“80211_tx_šfo
 *
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

635 
hd¾’
, 
Ën
, 

;

636 
u8
 *
pos
;

637 
u8
 
²
[6];

638 
u64
 
²64
;

639 
u8
 
¯d
[
GCM_AAD_LEN
];

640 
u8
 
j_0
[
AES_BLOCK_SIZE
];

642 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

643 !(
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_IV
) &&

644 !(
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
) &&

645 !((
šfo
->
cÚŒŞ
.
hw_key
->
æags
 &

646 
IEEE80211_KEY_FLAG_GENERATE_IV_MGMT
) &&

647 
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))) {

654 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

655 
Ën
 = 
skb
->ËÀ- 
hd¾’
;

657 ià(
šfo
->
cÚŒŞ
.
hw_key
)

658 

 = 0;

660 

 = 
IEEE80211_GCMP_MIC_LEN
;

662 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< 

 ||

663 
	`skb_h—droom
(
skb
è< 
IEEE80211_GCMP_HDR_LEN
))

666 
pos
 = 
	`skb_push
(
skb
, 
IEEE80211_GCMP_HDR_LEN
);

667 
	`memmove
(
pos
,…o + 
IEEE80211_GCMP_HDR_LEN
, 
hd¾’
);

668 
	`skb_£t_ÃtwÜk_h—d”
(
skb
, 
	`skb_ÃtwÜk_off£t
(skb) +

669 
IEEE80211_GCMP_HDR_LEN
);

672 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

673 (
šfo
->
cÚŒŞ
.
hw_key
->
æags
 & 
IEEE80211_KEY_FLAG_PUT_IV_SPACE
))

676 
pos
 +ğ
hd¾’
;

678 
²64
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

680 
²
[5] = 
²64
;

681 
²
[4] = 
²64
 >> 8;

682 
²
[3] = 
²64
 >> 16;

683 
²
[2] = 
²64
 >> 24;

684 
²
[1] = 
²64
 >> 32;

685 
²
[0] = 
²64
 >> 40;

687 
	`gcmp_²2hdr
(
pos
, 
²
, 
key
->
cÚf
.
keyidx
);

690 ià(
šfo
->
cÚŒŞ
.
hw_key
)

693 
pos
 +ğ
IEEE80211_GCMP_HDR_LEN
;

694 
	`gcmp_¥ecŸl_blocks
(
skb
, 
²
, 
j_0
, 
¯d
,

695 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_SPP_AMSDU
);

696  
	`›“80211_«s_gcm_’üy±
(
key
->
u
.
gcmp
.
tfm
, 
j_0
, 
¯d
, 
pos
, 
Ën
,

697 
	`skb_put
(
skb
, 
IEEE80211_GCMP_MIC_LEN
));

698 
	}
}

700 
›“80211_tx_»suÉ


701 
	$›“80211_üy±o_gcmp_’üy±
(
›“80211_tx_d©a
 *
tx
)

703 
sk_buff
 *
skb
;

705 
	`›“80211_tx_£t_´Ùeùed
(
tx
);

707 
	`skb_queue_w®k
(&
tx
->
skbs
, 
skb
) {

708 ià(
	`gcmp_’üy±_skb
(
tx
, 
skb
) < 0)

709  
TX_DROP
;

712  
TX_CONTINUE
;

713 
	}
}

715 
›“80211_rx_»suÉ


716 
	$›“80211_üy±o_gcmp_deüy±
(
›“80211_rx_d©a
 *
rx
)

718 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
rx
->
skb
->
d©a
;

719 
hd¾’
;

720 
›“80211_key
 *
key
 = 
rx
->key;

721 
sk_buff
 *
skb
 = 
rx
->skb;

722 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

723 
u8
 
²
[
IEEE80211_GCMP_PN_LEN
];

724 
d©a_Ën
, 
queue
, 
mic_Ën
 = 
IEEE80211_GCMP_MIC_LEN
;

726 
hd¾’
 = 
	`›“80211_hd¾’
(
hdr
->
äame_cÚŒŞ
);

728 ià(!
	`›“80211_is_d©a
(
hdr
->
äame_cÚŒŞ
) &&

729 !
	`›“80211_is_robu¡_mgmt_äame
(
skb
))

730  
RX_CONTINUE
;

732 ià(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
) {

733 ià(!
	`pskb_may_puÎ
(
rx
->
skb
, 
hd¾’
 + 
IEEE80211_GCMP_HDR_LEN
))

734  
RX_DROP_U_SHORT_GCMP
;

735 ià(
¡©us
->
æag
 & 
RX_FLAG_MIC_STRIPPED
)

736 
mic_Ën
 = 0;

738 ià(
	`skb_lš—rize
(
rx
->
skb
))

739  
RX_DROP_U_OOM
;

743 
hdr
 = (*)
rx
->
skb
->
d©a
;

745 
d©a_Ën
 = 
skb
->
Ën
 - 
hd¾’
 - 
IEEE80211_GCMP_HDR_LEN
 - 
mic_Ën
;

746 ià(!
rx
->
¡a
 || 
d©a_Ën
 < 0)

747  
RX_DROP_U_SHORT_GCMP
;

749 ià(!(
¡©us
->
æag
 & 
RX_FLAG_PN_VALIDATED
)) {

750 
»s
;

752 
	`gcmp_hdr2²
(
²
, 
skb
->
d©a
 + 
hd¾’
);

754 
queue
 = 
rx
->
£cur™y_idx
;

756 
»s
 = 
	`memcmp
(
²
, 
key
->
u
.
gcmp
.
rx_²
[
queue
],

757 
IEEE80211_GCMP_PN_LEN
);

758 ià(
»s
 < 0 ||

759 (!
»s
 && !(
¡©us
->
æag
 & 
RX_FLAG_ALLOW_SAME_PN
))) {

760 
key
->
u
.
gcmp
.
»¶ays
++;

761  
RX_DROP_U_REPLAY
;

764 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

765 
u8
 
¯d
[2 * 
AES_BLOCK_SIZE
];

766 
u8
 
j_0
[
AES_BLOCK_SIZE
];

768 
	`gcmp_¥ecŸl_blocks
(
skb
, 
²
, 
j_0
, 
¯d
,

769 
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_SPP_AMSDU
);

771 ià(
	`›“80211_«s_gcm_deüy±
(

772 
key
->
u
.
gcmp
.
tfm
, 
j_0
, 
¯d
,

773 
skb
->
d©a
 + 
hd¾’
 + 
IEEE80211_GCMP_HDR_LEN
,

774 
d©a_Ën
,

775 
skb
->
d©a
 + skb->
Ën
 -

776 
IEEE80211_GCMP_MIC_LEN
))

777  
RX_DROP_U_MIC_FAIL
;

780 
	`memıy
(
key
->
u
.
gcmp
.
rx_²
[
queue
], 
²
, 
IEEE80211_GCMP_PN_LEN
);

781 ià(
	`uÆik–y
(
	`›“80211_is_äag
(
hdr
)))

782 
	`memıy
(
rx
->
ccm_gcm
.
²
,…n, 
IEEE80211_CCMP_PN_LEN
);

786 ià(
	`pskb_Œim
(
skb
, skb->
Ën
 - 
mic_Ën
))

787  
RX_DROP_U_SHORT_GCMP_MIC
;

788 
	`memmove
(
skb
->
d©a
 + 
IEEE80211_GCMP_HDR_LEN
, skb->d©a, 
hd¾’
);

789 
	`skb_puÎ
(
skb
, 
IEEE80211_GCMP_HDR_LEN
);

791  
RX_CONTINUE
;

792 
	}
}

794 
	$b_¯d
(
sk_buff
 *
skb
, 
u8
 *
¯d
)

796 
__Ë16
 
mask_fc
;

797 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

803 
mask_fc
 = 
hdr
->
äame_cÚŒŞ
;

804 
mask_fc
 &ğ~
	`ıu_to_Ë16
(
IEEE80211_FCTL_RETRY
 | 
IEEE80211_FCTL_PM
 |

805 
IEEE80211_FCTL_MOREDATA
);

806 
	`put_uÇligÃd
(
mask_fc
, (
__Ë16
 *è&
¯d
[0]);

808 
	`memıy
(
¯d
 + 2, &
hdr
->
addrs
, 3 * 
ETH_ALEN
);

809 
	}
}

812 
šlše
 
	$b_n_£t64
(
u8
 *
d
, 
u64
 
²
)

814 *
d
++ = 
²
;

815 *
d
++ = 
²
 >> 8;

816 *
d
++ = 
²
 >> 16;

817 *
d
++ = 
²
 >> 24;

818 *
d
++ = 
²
 >> 32;

819 *
d
 = 
²
 >> 40;

820 
	}
}

822 
šlše
 
	$b_n_sw­
(
u8
 *
d
, cÚ¡ u8 *
s
)

824 *
d
++ = 
s
[5];

825 *
d
++ = 
s
[4];

826 *
d
++ = 
s
[3];

827 *
d
++ = 
s
[2];

828 *
d
++ = 
s
[1];

829 *
d
 = 
s
[0];

830 
	}
}

833 
›“80211_tx_»suÉ


834 
	$›“80211_üy±o_«s_cmac_’üy±
(
›“80211_tx_d©a
 *
tx
)

836 
sk_buff
 *
skb
;

837 
›“80211_tx_šfo
 *
šfo
;

838 
›“80211_key
 *
key
 = 
tx
->key;

839 
›“80211_mm›
 *
mm›
;

840 
u8
 
¯d
[20];

841 
u64
 
²64
;

843 ià(
	`WARN_ON
(
	`skb_queue_Ën
(&
tx
->
skbs
) != 1))

844  
TX_DROP
;

846 
skb
 = 
	`skb_³ek
(&
tx
->
skbs
);

848 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

850 ià(
šfo
->
cÚŒŞ
.
hw_key
 &&

851 !(
key
->
cÚf
.
æags
 & 
IEEE80211_KEY_FLAG_GENERATE_MMIE
))

852  
TX_CONTINUE
;

854 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< (*
mm›
)))

855  
TX_DROP
;

857 
mm›
 = 
	`skb_put
(
skb
, (*mmie));

858 
mm›
->
–em’t_id
 = 
WLAN_EID_MMIE
;

859 
mm›
->
Ëngth
 = (*mmie) - 2;

860 
mm›
->
key_id
 = 
	`ıu_to_Ë16
(
key
->
cÚf
.
keyidx
);

863 
²64
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

865 
	`b_n_£t64
(
mm›
->
£qu’û_numb”
, 
²64
);

867 ià(
šfo
->
cÚŒŞ
.
hw_key
)

868  
TX_CONTINUE
;

870 
	`b_¯d
(
skb
, 
¯d
);

875 
	`›“80211_«s_cmac
(
key
->
u
.
«s_cmac
.
tfm
, 
¯d
,

876 
skb
->
d©a
 + 24, skb->
Ën
 - 24, 
mm›
->
mic
);

878  
TX_CONTINUE
;

879 
	}
}

881 
›“80211_tx_»suÉ


882 
	$›“80211_üy±o_«s_cmac_256_’üy±
(
›“80211_tx_d©a
 *
tx
)

884 
sk_buff
 *
skb
;

885 
›“80211_tx_šfo
 *
šfo
;

886 
›“80211_key
 *
key
 = 
tx
->key;

887 
›“80211_mm›_16
 *
mm›
;

888 
u8
 
¯d
[20];

889 
u64
 
²64
;

891 ià(
	`WARN_ON
(
	`skb_queue_Ën
(&
tx
->
skbs
) != 1))

892  
TX_DROP
;

894 
skb
 = 
	`skb_³ek
(&
tx
->
skbs
);

896 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

898 ià(
šfo
->
cÚŒŞ
.
hw_key
)

899  
TX_CONTINUE
;

901 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< (*
mm›
)))

902  
TX_DROP
;

904 
mm›
 = 
	`skb_put
(
skb
, (*mmie));

905 
mm›
->
–em’t_id
 = 
WLAN_EID_MMIE
;

906 
mm›
->
Ëngth
 = (*mmie) - 2;

907 
mm›
->
key_id
 = 
	`ıu_to_Ë16
(
key
->
cÚf
.
keyidx
);

910 
²64
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

912 
	`b_n_£t64
(
mm›
->
£qu’û_numb”
, 
²64
);

914 
	`b_¯d
(
skb
, 
¯d
);

918 
	`›“80211_«s_cmac_256
(
key
->
u
.
«s_cmac
.
tfm
, 
¯d
,

919 
skb
->
d©a
 + 24, skb->
Ën
 - 24, 
mm›
->
mic
);

921  
TX_CONTINUE
;

922 
	}
}

924 
›“80211_rx_»suÉ


925 
	$›“80211_üy±o_«s_cmac_deüy±
(
›“80211_rx_d©a
 *
rx
)

927 
sk_buff
 *
skb
 = 
rx
->skb;

928 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

929 
›“80211_key
 *
key
 = 
rx
->key;

930 
›“80211_mm›
 *
mm›
;

931 
u8
 
¯d
[20], 
mic
[8], 
n
[6];

932 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*è
skb
->
d©a
;

934 ià(!
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

935  
RX_CONTINUE
;

939 ià(
skb
->
Ën
 < 24 + (*
mm›
))

940  
RX_DROP_U_SHORT_CMAC
;

942 
mm›
 = (
›“80211_mm›
 *)

943 (
skb
->
d©a
 + skb->
Ën
 - (*
mm›
));

944 ià(
mm›
->
–em’t_id
 !ğ
WLAN_EID_MMIE
 ||

945 
mm›
->
Ëngth
 != (*mmie) - 2)

946  
RX_DROP_U_BAD_MMIE
;

948 
	`b_n_sw­
(
n
, 
mm›
->
£qu’û_numb”
);

950 ià(
	`memcmp
(
n
, 
key
->
u
.
«s_cmac
.
rx_²
, 6) <= 0) {

951 
key
->
u
.
«s_cmac
.
»¶ays
++;

952  
RX_DROP_U_REPLAY
;

955 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

957 
	`b_¯d
(
skb
, 
¯d
);

958 
	`›“80211_«s_cmac
(
key
->
u
.
«s_cmac
.
tfm
, 
¯d
,

959 
skb
->
d©a
 + 24, skb->
Ën
 - 24, 
mic
);

960 ià(
	`üy±o_memÃq
(
mic
, 
mm›
->mic, (mmie->mic))) {

961 
key
->
u
.
«s_cmac
.
icv”rÜs
++;

962  
RX_DROP_U_MIC_FAIL
;

966 
	`memıy
(
key
->
u
.
«s_cmac
.
rx_²
, 
n
, 6);

969 
	`skb_Œim
(
skb
, skb->
Ën
 - (*
mm›
));

971  
RX_CONTINUE
;

972 
	}
}

974 
›“80211_rx_»suÉ


975 
	$›“80211_üy±o_«s_cmac_256_deüy±
(
›“80211_rx_d©a
 *
rx
)

977 
sk_buff
 *
skb
 = 
rx
->skb;

978 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

979 
›“80211_key
 *
key
 = 
rx
->key;

980 
›“80211_mm›_16
 *
mm›
;

981 
u8
 
¯d
[20], 
mic
[16], 
n
[6];

982 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

984 ià(!
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

985  
RX_CONTINUE
;

989 ià(
skb
->
Ën
 < 24 + (*
mm›
))

990  
RX_DROP_U_SHORT_CMAC256
;

992 
mm›
 = (
›“80211_mm›_16
 *)

993 (
skb
->
d©a
 + skb->
Ën
 - (*
mm›
));

994 ià(
mm›
->
–em’t_id
 !ğ
WLAN_EID_MMIE
 ||

995 
mm›
->
Ëngth
 != (*mmie) - 2)

996  
RX_DROP_U_BAD_MMIE
;

998 
	`b_n_sw­
(
n
, 
mm›
->
£qu’û_numb”
);

1000 ià(
	`memcmp
(
n
, 
key
->
u
.
«s_cmac
.
rx_²
, 6) <= 0) {

1001 
key
->
u
.
«s_cmac
.
»¶ays
++;

1002  
RX_DROP_U_REPLAY
;

1005 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

1007 
	`b_¯d
(
skb
, 
¯d
);

1008 
	`›“80211_«s_cmac_256
(
key
->
u
.
«s_cmac
.
tfm
, 
¯d
,

1009 
skb
->
d©a
 + 24, skb->
Ën
 - 24, 
mic
);

1010 ià(
	`üy±o_memÃq
(
mic
, 
mm›
->mic, (mmie->mic))) {

1011 
key
->
u
.
«s_cmac
.
icv”rÜs
++;

1012  
RX_DROP_U_MIC_FAIL
;

1016 
	`memıy
(
key
->
u
.
«s_cmac
.
rx_²
, 
n
, 6);

1019 
	`skb_Œim
(
skb
, skb->
Ën
 - (*
mm›
));

1021  
RX_CONTINUE
;

1022 
	}
}

1024 
›“80211_tx_»suÉ


1025 
	$›“80211_üy±o_«s_gmac_’üy±
(
›“80211_tx_d©a
 *
tx
)

1027 
sk_buff
 *
skb
;

1028 
›“80211_tx_šfo
 *
šfo
;

1029 
›“80211_key
 *
key
 = 
tx
->key;

1030 
›“80211_mm›_16
 *
mm›
;

1031 
›“80211_hdr
 *
hdr
;

1032 
u8
 
¯d
[
GMAC_AAD_LEN
];

1033 
u64
 
²64
;

1034 
u8
 
nÚû
[
GMAC_NONCE_LEN
];

1036 ià(
	`WARN_ON
(
	`skb_queue_Ën
(&
tx
->
skbs
) != 1))

1037  
TX_DROP
;

1039 
skb
 = 
	`skb_³ek
(&
tx
->
skbs
);

1041 
šfo
 = 
	`IEEE80211_SKB_CB
(
skb
);

1043 ià(
šfo
->
cÚŒŞ
.
hw_key
)

1044  
TX_CONTINUE
;

1046 ià(
	`WARN_ON
(
	`skb_room
(
skb
è< (*
mm›
)))

1047  
TX_DROP
;

1049 
mm›
 = 
	`skb_put
(
skb
, (*mmie));

1050 
mm›
->
–em’t_id
 = 
WLAN_EID_MMIE
;

1051 
mm›
->
Ëngth
 = (*mmie) - 2;

1052 
mm›
->
key_id
 = 
	`ıu_to_Ë16
(
key
->
cÚf
.
keyidx
);

1055 
²64
 = 
	`©omic64_šc_»tuº
(&
key
->
cÚf
.
tx_²
);

1057 
	`b_n_£t64
(
mm›
->
£qu’û_numb”
, 
²64
);

1059 
	`b_¯d
(
skb
, 
¯d
);

1061 
hdr
 = (
›“80211_hdr
 *)
skb
->
d©a
;

1062 
	`memıy
(
nÚû
, 
hdr
->
addr2
, 
ETH_ALEN
);

1063 
	`b_n_sw­
(
nÚû
 + 
ETH_ALEN
, 
mm›
->
£qu’û_numb”
);

1066 ià(
	`›“80211_«s_gmac
(
key
->
u
.
«s_gmac
.
tfm
, 
¯d
, 
nÚû
,

1067 
skb
->
d©a
 + 24, skb->
Ën
 - 24, 
mm›
->
mic
) < 0)

1068  
TX_DROP
;

1070  
TX_CONTINUE
;

1071 
	}
}

1073 
›“80211_rx_»suÉ


1074 
	$›“80211_üy±o_«s_gmac_deüy±
(
›“80211_rx_d©a
 *
rx
)

1076 
sk_buff
 *
skb
 = 
rx
->skb;

1077 
›“80211_rx_¡©us
 *
¡©us
 = 
	`IEEE80211_SKB_RXCB
(
skb
);

1078 
›“80211_key
 *
key
 = 
rx
->key;

1079 
›“80211_mm›_16
 *
mm›
;

1080 
u8
 
¯d
[
GMAC_AAD_LEN
], *
mic
, 
n
[6], 
nÚû
[
GMAC_NONCE_LEN
];

1081 
›“80211_hdr
 *
hdr
 = (›“80211_hd¸*)
skb
->
d©a
;

1083 ià(!
	`›“80211_is_mgmt
(
hdr
->
äame_cÚŒŞ
))

1084  
RX_CONTINUE
;

1088 ià(
skb
->
Ën
 < 24 + (*
mm›
))

1089  
RX_DROP_U_SHORT_GMAC
;

1091 
mm›
 = (
›“80211_mm›_16
 *)

1092 (
skb
->
d©a
 + skb->
Ën
 - (*
mm›
));

1093 ià(
mm›
->
–em’t_id
 !ğ
WLAN_EID_MMIE
 ||

1094 
mm›
->
Ëngth
 != (*mmie) - 2)

1095  
RX_DROP_U_BAD_MMIE
;

1097 
	`b_n_sw­
(
n
, 
mm›
->
£qu’û_numb”
);

1099 ià(
	`memcmp
(
n
, 
key
->
u
.
«s_gmac
.
rx_²
, 6) <= 0) {

1100 
key
->
u
.
«s_gmac
.
»¶ays
++;

1101  
RX_DROP_U_REPLAY
;

1104 ià(!(
¡©us
->
æag
 & 
RX_FLAG_DECRYPTED
)) {

1106 
	`b_¯d
(
skb
, 
¯d
);

1108 
	`memıy
(
nÚû
, 
hdr
->
addr2
, 
ETH_ALEN
);

1109 
	`memıy
(
nÚû
 + 
ETH_ALEN
, 
n
, 6);

1111 
mic
 = 
	`km®loc
(
GMAC_MIC_LEN
, 
GFP_ATOMIC
);

1112 ià(!
mic
)

1113  
RX_DROP_U_OOM
;

1114 ià(
	`›“80211_«s_gmac
(
key
->
u
.
«s_gmac
.
tfm
, 
¯d
, 
nÚû
,

1115 
skb
->
d©a
 + 24, skb->
Ën
 - 24,

1116 
mic
) < 0 ||

1117 
	`üy±o_memÃq
(
mic
, 
mm›
->mic, (mmie->mic))) {

1118 
key
->
u
.
«s_gmac
.
icv”rÜs
++;

1119 
	`kä“
(
mic
);

1120  
RX_DROP_U_MIC_FAIL
;

1122 
	`kä“
(
mic
);

1125 
	`memıy
(
key
->
u
.
«s_gmac
.
rx_²
, 
n
, 6);

1128 
	`skb_Œim
(
skb
, skb->
Ën
 - (*
mm›
));

1130  
RX_CONTINUE
;

1131 
	}
}

	@wpa.h

7 #iâdeà
WPA_H


8 
	#WPA_H


	)

10 
	~<lšux/skbuff.h
>

11 
	~<lšux/ty³s.h
>

12 
	~"›“80211_i.h
"

14 
›“80211_tx_»suÉ


15 
›“80211_tx_h_mich«l_mic_add
(
›“80211_tx_d©a
 *
tx
);

16 
›“80211_rx_»suÉ


17 
›“80211_rx_h_mich«l_mic_v”ify
(
›“80211_rx_d©a
 *
rx
);

19 
›“80211_tx_»suÉ


20 
›“80211_üy±o_tk_’üy±
(
›“80211_tx_d©a
 *
tx
);

21 
›“80211_rx_»suÉ


22 
›“80211_üy±o_tk_deüy±
(
›“80211_rx_d©a
 *
rx
);

24 
›“80211_tx_»suÉ


25 
›“80211_üy±o_ccmp_’üy±
(
›“80211_tx_d©a
 *
tx
,

26 
mic_Ën
);

27 
›“80211_rx_»suÉ


28 
›“80211_üy±o_ccmp_deüy±
(
›“80211_rx_d©a
 *
rx
,

29 
mic_Ën
);

31 
›“80211_tx_»suÉ


32 
›“80211_üy±o_«s_cmac_’üy±
(
›“80211_tx_d©a
 *
tx
);

33 
›“80211_tx_»suÉ


34 
›“80211_üy±o_«s_cmac_256_’üy±
(
›“80211_tx_d©a
 *
tx
);

35 
›“80211_rx_»suÉ


36 
›“80211_üy±o_«s_cmac_deüy±
(
›“80211_rx_d©a
 *
rx
);

37 
›“80211_rx_»suÉ


38 
›“80211_üy±o_«s_cmac_256_deüy±
(
›“80211_rx_d©a
 *
rx
);

39 
›“80211_tx_»suÉ


40 
›“80211_üy±o_«s_gmac_’üy±
(
›“80211_tx_d©a
 *
tx
);

41 
›“80211_rx_»suÉ


42 
›“80211_üy±o_«s_gmac_deüy±
(
›“80211_rx_d©a
 *
rx
);

44 
›“80211_tx_»suÉ


45 
›“80211_üy±o_gcmp_’üy±
(
›“80211_tx_d©a
 *
tx
);

46 
›“80211_rx_»suÉ


47 
›“80211_üy±o_gcmp_deüy±
(
›“80211_rx_d©a
 *
rx
);

	@/usr/include/linux/if.h

20 #iâdeà
_LINUX_IF_H


21 
	#_LINUX_IF_H


	)

23 
	~<lšux/libc-com·t.h
>

24 
	~<lšux/ty³s.h
>

25 
	~<lšux/sock‘.h
>

28 
	~<sys/sock‘.h
>

30 #ià
__UAPI_DEF_IF_IFNAMSIZ


31 
	#IFNAMSIZ
 16

	)

33 
	#IFALIASZ
 256

	)

34 
	#ALTIFNAMSIZ
 128

	)

35 
	~<lšux/hdlc/ioùl.h
>

38 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 != 0 || \

39 
	g__UAPI_DEF_IF_NET_DEVICE_FLAGS
 != 0

80 
	eÃt_deviû_æags
 {

82 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS


83 
IFF_UP
 = 1<<0,

84 
	mIFF_BROADCAST
 = 1<<1,

85 
	mIFF_DEBUG
 = 1<<2,

86 
	mIFF_LOOPBACK
 = 1<<3,

87 
	mIFF_POINTOPOINT
 = 1<<4,

88 
	mIFF_NOTRAILERS
 = 1<<5,

89 
	mIFF_RUNNING
 = 1<<6,

90 
	mIFF_NOARP
 = 1<<7,

91 
	mIFF_PROMISC
 = 1<<8,

92 
	mIFF_ALLMULTI
 = 1<<9,

93 
	mIFF_MASTER
 = 1<<10,

94 
	mIFF_SLAVE
 = 1<<11,

95 
	mIFF_MULTICAST
 = 1<<12,

96 
	mIFF_PORTSEL
 = 1<<13,

97 
	mIFF_AUTOMEDIA
 = 1<<14,

98 
	mIFF_DYNAMIC
 = 1<<15,

100 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


101 
	mIFF_LOWER_UP
 = 1<<16,

102 
	mIFF_DORMANT
 = 1<<17,

103 
	mIFF_ECHO
 = 1<<18,

109 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS


110 
	#IFF_UP
 
IFF_UP


	)

111 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

112 
	#IFF_DEBUG
 
IFF_DEBUG


	)

113 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

114 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

115 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

116 
	#IFF_RUNNING
 
IFF_RUNNING


	)

117 
	#IFF_NOARP
 
IFF_NOARP


	)

118 
	#IFF_PROMISC
 
IFF_PROMISC


	)

119 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

120 
	#IFF_MASTER
 
IFF_MASTER


	)

121 
	#IFF_SLAVE
 
IFF_SLAVE


	)

122 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

123 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

124 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

125 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

128 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


129 
	#IFF_LOWER_UP
 
IFF_LOWER_UP


	)

130 
	#IFF_DORMANT
 
IFF_DORMANT


	)

131 
	#IFF_ECHO
 
IFF_ECHO


	)

134 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

135 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

137 
	#IF_GET_IFACE
 0x0001

	)

138 
	#IF_GET_PROTO
 0x0002

	)

141 
	#IF_IFACE_V35
 0x1000

	)

142 
	#IF_IFACE_V24
 0x1001

	)

143 
	#IF_IFACE_X21
 0x1002

	)

144 
	#IF_IFACE_T1
 0x1003

	)

145 
	#IF_IFACE_E1
 0x1004

	)

146 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

147 
	#IF_IFACE_X21D
 0x1006

	)

150 
	#IF_PROTO_HDLC
 0x2000

	)

151 
	#IF_PROTO_PPP
 0x2001

	)

152 
	#IF_PROTO_CISCO
 0x2002

	)

153 
	#IF_PROTO_FR
 0x2003

	)

154 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

155 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

156 
	#IF_PROTO_X25
 0x2006

	)

157 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

158 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

159 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

160 
	#IF_PROTO_FR_PVC
 0x200A

	)

161 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

162 
	#IF_PROTO_RAW
 0x200C

	)

166 
	mIF_OPER_UNKNOWN
,

167 
	mIF_OPER_NOTPRESENT
,

168 
	mIF_OPER_DOWN
,

169 
	mIF_OPER_LOWERLAYERDOWN
,

170 
	mIF_OPER_TESTING
,

171 
	mIF_OPER_DORMANT
,

172 
	mIF_OPER_UP
,

177 
	mIF_LINK_MODE_DEFAULT
,

178 
	mIF_LINK_MODE_DORMANT
,

179 
	mIF_LINK_MODE_TESTING
,

193 #ià
__UAPI_DEF_IF_IFMAP


194 
	sifm­
 {

195 
	mmem_¡¬t
;

196 
	mmem_’d
;

197 
	mba£_addr
;

198 
	mœq
;

199 
	mdma
;

200 
	mpÜt
;

205 
	sif_£‰šgs
 {

206 
	mty³
;

207 
	msize
;

210 
¿w_hdlc_´Ùo
 *
	m¿w_hdlc
;

211 
cisco_´Ùo
 *
	mcisco
;

212 
ä_´Ùo
 *
	mä
;

213 
ä_´Ùo_pvc
 *
	mä_pvc
;

214 
ä_´Ùo_pvc_šfo
 *
	mä_pvc_šfo
;

215 
x25_hdlc_´Ùo
 *
	mx25
;

218 
sync_£rŸl_£‰šgs
 *
	msync
;

219 
‹1_£‰šgs
 *
	m‹1
;

220 } 
	mifs_ifsu
;

231 #ià
__UAPI_DEF_IF_IFREQ


232 
	siäeq
 {

233 
	#IFHWADDRLEN
 6

	)

236 
	miän_Çme
[
IFNAMSIZ
];

237 } 
	miä_iän
;

240 
sockaddr
 
	miäu_addr
;

241 
sockaddr
 
	miäu_d¡addr
;

242 
sockaddr
 
	miäu_brßdaddr
;

243 
sockaddr
 
	miäu_Ãtmask
;

244 
sockaddr
 
	miäu_hwaddr
;

245 
	miäu_æags
;

246 
	miäu_iv®ue
;

247 
	miäu_mtu
;

248 
ifm­
 
	miäu_m­
;

249 
	miäu_¦ave
[
IFNAMSIZ
];

250 
	miäu_ÃwÇme
[
IFNAMSIZ
];

251 * 
	miäu_d©a
;

252 
if_£‰šgs
 
	miäu_£‰šgs
;

253 } 
	miä_iäu
;

257 
	#iä_Çme
 
iä_iän
.
iän_Çme


	)

258 
	#iä_hwaddr
 
iä_iäu
.
iäu_hwaddr


	)

259 
	#iä_addr
 
iä_iäu
.
iäu_addr


	)

260 
	#iä_d¡addr
 
iä_iäu
.
iäu_d¡addr


	)

261 
	#iä_brßdaddr
 
iä_iäu
.
iäu_brßdaddr


	)

262 
	#iä_Ãtmask
 
iä_iäu
.
iäu_Ãtmask


	)

263 
	#iä_æags
 
iä_iäu
.
iäu_æags


	)

264 
	#iä_m‘ric
 
iä_iäu
.
iäu_iv®ue


	)

265 
	#iä_mtu
 
iä_iäu
.
iäu_mtu


	)

266 
	#iä_m­
 
iä_iäu
.
iäu_m­


	)

267 
	#iä_¦ave
 
iä_iäu
.
iäu_¦ave


	)

268 
	#iä_d©a
 
iä_iäu
.
iäu_d©a


	)

269 
	#iä_ifšdex
 
iä_iäu
.
iäu_iv®ue


	)

270 
	#iä_bªdwidth
 
iä_iäu
.
iäu_iv®ue


	)

271 
	#iä_qËn
 
iä_iäu
.
iäu_iv®ue


	)

272 
	#iä_ÃwÇme
 
iä_iäu
.
iäu_ÃwÇme


	)

273 
	#iä_£‰šgs
 
iä_iäu
.
iäu_£‰šgs


	)

283 #ià
__UAPI_DEF_IF_IFCONF


284 
	sifcÚf
 {

285 
	mifc_Ën
;

287 *
	mifcu_buf
;

288 
iäeq
 *
	mifcu_»q
;

289 } 
	mifc_ifcu
;

293 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

294 
	#ifc_»q
 
ifc_ifcu
.
ifcu_»q


	)

	@/usr/include/linux/if_arp.h

24 #iâdeà
_LINUX_IF_ARP_H


25 
	#_LINUX_IF_ARP_H


	)

27 
	~<lšux/Ãtdeviû.h
>

30 
	#ARPHRD_NETROM
 0

	)

31 
	#ARPHRD_ETHER
 1

	)

32 
	#ARPHRD_EETHER
 2

	)

33 
	#ARPHRD_AX25
 3

	)

34 
	#ARPHRD_PRONET
 4

	)

35 
	#ARPHRD_CHAOS
 5

	)

36 
	#ARPHRD_IEEE802
 6

	)

37 
	#ARPHRD_ARCNET
 7

	)

38 
	#ARPHRD_APPLETLK
 8

	)

39 
	#ARPHRD_DLCI
 15

	)

40 
	#ARPHRD_ATM
 19

	)

41 
	#ARPHRD_METRICOM
 23

	)

42 
	#ARPHRD_IEEE1394
 24

	)

43 
	#ARPHRD_EUI64
 27

	)

44 
	#ARPHRD_INFINIBAND
 32

	)

47 
	#ARPHRD_SLIP
 256

	)

48 
	#ARPHRD_CSLIP
 257

	)

49 
	#ARPHRD_SLIP6
 258

	)

50 
	#ARPHRD_CSLIP6
 259

	)

51 
	#ARPHRD_RSRVD
 260

	)

52 
	#ARPHRD_ADAPT
 264

	)

53 
	#ARPHRD_ROSE
 270

	)

54 
	#ARPHRD_X25
 271

	)

55 
	#ARPHRD_HWX25
 272

	)

56 
	#ARPHRD_CAN
 280

	)

57 
	#ARPHRD_MCTP
 290

	)

58 
	#ARPHRD_PPP
 512

	)

59 
	#ARPHRD_CISCO
 513

	)

60 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

61 
	#ARPHRD_LAPB
 516

	)

62 
	#ARPHRD_DDCMP
 517

	)

63 
	#ARPHRD_RAWHDLC
 518

	)

64 
	#ARPHRD_RAWIP
 519

	)

66 
	#ARPHRD_TUNNEL
 768

	)

67 
	#ARPHRD_TUNNEL6
 769

	)

68 
	#ARPHRD_FRAD
 770

	)

69 
	#ARPHRD_SKIP
 771

	)

70 
	#ARPHRD_LOOPBACK
 772

	)

71 
	#ARPHRD_LOCALTLK
 773

	)

72 
	#ARPHRD_FDDI
 774

	)

73 
	#ARPHRD_BIF
 775

	)

74 
	#ARPHRD_SIT
 776

	)

75 
	#ARPHRD_IPDDP
 777

	)

76 
	#ARPHRD_IPGRE
 778

	)

77 
	#ARPHRD_PIMREG
 779

	)

78 
	#ARPHRD_HIPPI
 780

	)

79 
	#ARPHRD_ASH
 781

	)

80 
	#ARPHRD_ECONET
 782

	)

81 
	#ARPHRD_IRDA
 783

	)

83 
	#ARPHRD_FCPP
 784

	)

84 
	#ARPHRD_FCAL
 785

	)

85 
	#ARPHRD_FCPL
 786

	)

86 
	#ARPHRD_FCFABRIC
 787

	)

88 
	#ARPHRD_IEEE802_TR
 800

	)

89 
	#ARPHRD_IEEE80211
 801

	)

90 
	#ARPHRD_IEEE80211_PRISM
 802

	)

91 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

92 
	#ARPHRD_IEEE802154
 804

	)

93 
	#ARPHRD_IEEE802154_MONITOR
 805

	)

95 
	#ARPHRD_PHONET
 820

	)

96 
	#ARPHRD_PHONET_PIPE
 821

	)

97 
	#ARPHRD_CAIF
 822

	)

98 
	#ARPHRD_IP6GRE
 823

	)

99 
	#ARPHRD_NETLINK
 824

	)

100 
	#ARPHRD_6LOWPAN
 825

	)

101 
	#ARPHRD_VSOCKMON
 826

	)

103 
	#ARPHRD_VOID
 0xFFFF

	)

104 
	#ARPHRD_NONE
 0xFFFE

	)

107 
	#ARPOP_REQUEST
 1

	)

108 
	#ARPOP_REPLY
 2

	)

109 
	#ARPOP_RREQUEST
 3

	)

110 
	#ARPOP_RREPLY
 4

	)

111 
	#ARPOP_InREQUEST
 8

	)

112 
	#ARPOP_InREPLY
 9

	)

113 
	#ARPOP_NAK
 10

	)

117 
	s¬´eq
 {

118 
sockaddr
 
	m¬p_·
;

119 
sockaddr
 
	m¬p_ha
;

120 
	m¬p_æags
;

121 
sockaddr
 
	m¬p_Ãtmask
;

122 
	m¬p_dev
[
IFNAMSIZ
];

125 
	s¬´eq_Şd
 {

126 
sockaddr
 
	m¬p_·
;

127 
sockaddr
 
	m¬p_ha
;

128 
	m¬p_æags
;

129 
sockaddr
 
	m¬p_Ãtmask
;

133 
	#ATF_COM
 0x02

	)

134 
	#ATF_PERM
 0x04

	)

135 
	#ATF_PUBL
 0x08

	)

136 
	#ATF_USETRAILERS
 0x10

	)

137 
	#ATF_NETMASK
 0x20

	)

139 
	#ATF_DONTPUB
 0x40

	)

145 
	s¬phdr
 {

146 
__be16
 
	m¬_hrd
;

147 
__be16
 
	m¬_´o
;

148 
	m¬_hÊ
;

149 
	m¬_¶n
;

150 
__be16
 
	m¬_İ
;

156 
	m¬_sha
[
ETH_ALEN
];

157 
	m¬_s
[4];

158 
	m¬_tha
[
ETH_ALEN
];

159 
	m¬_t
[4];

	@/usr/include/linux/if_ether.h

22 #iâdeà
_LINUX_IF_ETHER_H


23 
	#_LINUX_IF_ETHER_H


	)

25 
	~<lšux/ty³s.h
>

32 
	#ETH_ALEN
 6

	)

33 
	#ETH_TLEN
 2

	)

34 
	#ETH_HLEN
 14

	)

35 
	#ETH_ZLEN
 60

	)

36 
	#ETH_DATA_LEN
 1500

	)

37 
	#ETH_FRAME_LEN
 1514

	)

38 
	#ETH_FCS_LEN
 4

	)

40 
	#ETH_MIN_MTU
 68

	)

41 
	#ETH_MAX_MTU
 0xFFFFU

	)

47 
	#ETH_P_LOOP
 0x0060

	)

48 
	#ETH_P_PUP
 0x0200

	)

49 
	#ETH_P_PUPAT
 0x0201

	)

50 
	#ETH_P_TSN
 0x22F0

	)

51 
	#ETH_P_ERSPAN2
 0x22EB

	)

52 
	#ETH_P_IP
 0x0800

	)

53 
	#ETH_P_X25
 0x0805

	)

54 
	#ETH_P_ARP
 0x0806

	)

55 
	#ETH_P_BPQ
 0x08FF

	)

56 
	#ETH_P_IEEEPUP
 0x0a00

	)

57 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

58 
	#ETH_P_BATMAN
 0x4305

	)

59 
	#ETH_P_DEC
 0x6000

	)

60 
	#ETH_P_DNA_DL
 0x6001

	)

61 
	#ETH_P_DNA_RC
 0x6002

	)

62 
	#ETH_P_DNA_RT
 0x6003

	)

63 
	#ETH_P_LAT
 0x6004

	)

64 
	#ETH_P_DIAG
 0x6005

	)

65 
	#ETH_P_CUST
 0x6006

	)

66 
	#ETH_P_SCA
 0x6007

	)

67 
	#ETH_P_TEB
 0x6558

	)

68 
	#ETH_P_RARP
 0x8035

	)

69 
	#ETH_P_ATALK
 0x809B

	)

70 
	#ETH_P_AARP
 0x80F3

	)

71 
	#ETH_P_8021Q
 0x8100

	)

72 
	#ETH_P_ERSPAN
 0x88BE

	)

73 
	#ETH_P_IPX
 0x8137

	)

74 
	#ETH_P_IPV6
 0x86DD

	)

75 
	#ETH_P_PAUSE
 0x8808

	)

76 
	#ETH_P_SLOW
 0x8809

	)

77 
	#ETH_P_WCCP
 0x883E

	)

79 
	#ETH_P_MPLS_UC
 0x8847

	)

80 
	#ETH_P_MPLS_MC
 0x8848

	)

81 
	#ETH_P_ATMMPOA
 0x884ø

	)

82 
	#ETH_P_PPP_DISC
 0x8863

	)

83 
	#ETH_P_PPP_SES
 0x8864

	)

84 
	#ETH_P_LINK_CTL
 0x886ø

	)

85 
	#ETH_P_ATMFATE
 0x8884

	)

88 
	#ETH_P_PAE
 0x888E

	)

89 
	#ETH_P_AOE
 0x88A2

	)

90 
	#ETH_P_8021AD
 0x88A8

	)

91 
	#ETH_P_802_EX1
 0x88B5

	)

92 
	#ETH_P_PREAUTH
 0x88C7

	)

93 
	#ETH_P_TIPC
 0x88CA

	)

94 
	#ETH_P_LLDP
 0x88CC

	)

95 
	#ETH_P_MRP
 0x88E3

	)

96 
	#ETH_P_MACSEC
 0x88E5

	)

97 
	#ETH_P_8021AH
 0x88E7

	)

98 
	#ETH_P_MVRP
 0x88F5

	)

99 
	#ETH_P_1588
 0x88F7

	)

100 
	#ETH_P_NCSI
 0x88F8

	)

101 
	#ETH_P_PRP
 0x88FB

	)

102 
	#ETH_P_CFM
 0x8902

	)

103 
	#ETH_P_FCOE
 0x8906

	)

104 
	#ETH_P_IBOE
 0x8915

	)

105 
	#ETH_P_TDLS
 0x890D

	)

106 
	#ETH_P_FIP
 0x8914

	)

107 
	#ETH_P_80221
 0x8917

	)

108 
	#ETH_P_HSR
 0x892F

	)

109 
	#ETH_P_NSH
 0x894F

	)

110 
	#ETH_P_LOOPBACK
 0x9000

	)

111 
	#ETH_P_QINQ1
 0x9100

	)

112 
	#ETH_P_QINQ2
 0x9200

	)

113 
	#ETH_P_QINQ3
 0x9300

	)

114 
	#ETH_P_EDSA
 0xDADA

	)

115 
	#ETH_P_DSA_8021Q
 0xDADB

	)

116 
	#ETH_P_IFE
 0xED3E

	)

117 
	#ETH_P_AF_IUCV
 0xFBFB

	)

119 
	#ETH_P_802_3_MIN
 0x0600

	)

126 
	#ETH_P_802_3
 0x0001

	)

127 
	#ETH_P_AX25
 0x0002

	)

128 
	#ETH_P_ALL
 0x0003

	)

129 
	#ETH_P_802_2
 0x0004

	)

130 
	#ETH_P_SNAP
 0x0005

	)

131 
	#ETH_P_DDCMP
 0x0006

	)

132 
	#ETH_P_WAN_PPP
 0x0007

	)

133 
	#ETH_P_PPP_MP
 0x0008

	)

134 
	#ETH_P_LOCALTALK
 0x0009

	)

135 
	#ETH_P_CAN
 0x000C

	)

136 
	#ETH_P_CANFD
 0x000D

	)

137 
	#ETH_P_PPPTALK
 0x0010

	)

138 
	#ETH_P_TR_802_2
 0x0011

	)

139 
	#ETH_P_MOBITEX
 0x0015

	)

140 
	#ETH_P_CONTROL
 0x0016

	)

141 
	#ETH_P_IRDA
 0x0017

	)

142 
	#ETH_P_ECONET
 0x0018

	)

143 
	#ETH_P_HDLC
 0x0019

	)

144 
	#ETH_P_ARCNET
 0x001A

	)

145 
	#ETH_P_DSA
 0x001B

	)

146 
	#ETH_P_TRAILER
 0x001C

	)

147 
	#ETH_P_PHONET
 0x00F5

	)

148 
	#ETH_P_IEEE802154
 0x00F6

	)

149 
	#ETH_P_CAIF
 0x00F7

	)

150 
	#ETH_P_XDSA
 0x00F8

	)

151 
	#ETH_P_MAP
 0x00F9

	)

154 
	#ETH_P_MCTP
 0x00FA

	)

163 #iâdeà
__UAPI_DEF_ETHHDR


164 
	#__UAPI_DEF_ETHHDR
 1

	)

167 #ià
__UAPI_DEF_ETHHDR


168 
	s‘hhdr
 {

169 
	mh_de¡
[
ETH_ALEN
];

170 
	mh_sourû
[
ETH_ALEN
];

171 
__be16
 
	mh_´Ùo
;

172 } 
__©Œibu‹__
((
·cked
));

	@/usr/include/linux/if_vlan.h

14 #iâdeà
_LINUX_IF_VLAN_H_


15 
	#_LINUX_IF_VLAN_H_


	)

21 
	evÏn_ioùl_cmds
 {

22 
	mADD_VLAN_CMD
,

23 
	mDEL_VLAN_CMD
,

24 
	mSET_VLAN_INGRESS_PRIORITY_CMD
,

25 
	mSET_VLAN_EGRESS_PRIORITY_CMD
,

26 
	mGET_VLAN_INGRESS_PRIORITY_CMD
,

27 
	mGET_VLAN_EGRESS_PRIORITY_CMD
,

28 
	mSET_VLAN_NAME_TYPE_CMD
,

29 
	mSET_VLAN_FLAG_CMD
,

30 
	mGET_VLAN_REALDEV_NAME_CMD
,

31 
	mGET_VLAN_VID_CMD


34 
	evÏn_æags
 {

35 
	mVLAN_FLAG_REORDER_HDR
 = 0x1,

36 
	mVLAN_FLAG_GVRP
 = 0x2,

37 
	mVLAN_FLAG_LOOSE_BINDING
 = 0x4,

38 
	mVLAN_FLAG_MVRP
 = 0x8,

39 
	mVLAN_FLAG_BRIDGE_BINDING
 = 0x10,

42 
	evÏn_Çme_ty³s
 {

43 
	mVLAN_NAME_TYPE_PLUS_VID
,

44 
	mVLAN_NAME_TYPE_RAW_PLUS_VID
,

45 
	mVLAN_NAME_TYPE_PLUS_VID_NO_PAD
,

46 
	mVLAN_NAME_TYPE_RAW_PLUS_VID_NO_PAD
,

47 
	mVLAN_NAME_TYPE_HIGHEST


50 
	svÏn_ioùl_¬gs
 {

51 
	mcmd
;

52 
	mdeviû1
[24];

55 
	mdeviû2
[24];

56 
	mVID
;

57 
	mskb_´iÜ™y
;

58 
	mÇme_ty³
;

59 
	mbšd_ty³
;

60 
	mæag
;

61 } 
	mu
;

63 
	mvÏn_qos
;

	@/usr/include/linux/kcov.h

2 #iâdeà
_LINUX_KCOV_IOCTLS_H


3 
	#_LINUX_KCOV_IOCTLS_H


	)

5 
	~<lšux/ty³s.h
>

11 
	skcov_»mÙe_¬g
 {

12 
__u32
 
	mŒaû_mode
;

13 
__u32
 
	m¬—_size
;

14 
__u32
 
	mnum_hªdËs
;

15 
__®igÃd_u64
 
	mcommÚ_hªdË
;

16 
__®igÃd_u64
 
	mhªdËs
[0];

19 
	#KCOV_REMOTE_MAX_HANDLES
 0x100

	)

21 
	#KCOV_INIT_TRACE
 
	`_IOR
('c', 1, )

	)

22 
	#KCOV_ENABLE
 
	`_IO
('c', 100)

	)

23 
	#KCOV_DISABLE
 
	`_IO
('c', 101)

	)

24 
	#KCOV_REMOTE_ENABLE
 
	`_IOW
('c', 102, 
kcov_»mÙe_¬g
)

	)

35 
	mKCOV_TRACE_PC
 = 0,

37 
	mKCOV_TRACE_CMP
 = 1,

46 
	#KCOV_CMP_CONST
 (1 << 0)

	)

47 
	#KCOV_CMP_SIZE
(
n
è(Òè<< 1)

	)

48 
	#KCOV_CMP_MASK
 
	`KCOV_CMP_SIZE
(3)

	)

50 
	#KCOV_SUBSYSTEM_COMMON
 (0x00uÎ << 56)

	)

51 
	#KCOV_SUBSYSTEM_USB
 (0x01uÎ << 56)

	)

53 
	#KCOV_SUBSYSTEM_MASK
 (0xffuÎ << 56)

	)

54 
	#KCOV_INSTANCE_MASK
 (0xffffffffuÎ)

	)

56 
__šlše__
 
__u64
 
	$kcov_»mÙe_hªdË
(
__u64
 
subsys
, __u64 
š¡
)

58 ià(
subsys
 & ~
KCOV_SUBSYSTEM_MASK
 || 
š¡
 & ~
KCOV_INSTANCE_MASK
)

60  
subsys
 | 
š¡
;

61 
	}
}

	@/usr/include/linux/kernel.h

2 #iâdeà
_LINUX_KERNEL_H


3 
	#_LINUX_KERNEL_H


	)

5 
	~<lšux/sysšfo.h
>

6 
	~<lšux/cÚ¡.h
>

	@/usr/include/linux/module.h

2 #iâdeà
_LINUX_MODULE_H


3 
	#_LINUX_MODULE_H


	)

6 
	#MODULE_INIT_IGNORE_MODVERSIONS
 1

	)

7 
	#MODULE_INIT_IGNORE_VERMAGIC
 2

	)

	@/usr/include/linux/netdevice.h

26 #iâdeà
_LINUX_NETDEVICE_H


27 
	#_LINUX_NETDEVICE_H


	)

29 
	~<lšux/if.h
>

30 
	~<lšux/if_‘h”.h
>

31 
	~<lšux/if_·ck‘.h
>

32 
	~<lšux/if_lšk.h
>

35 
	#MAX_ADDR_LEN
 32

	)

38 
	#INIT_NETDEV_GROUP
 0

	)

42 
	#NET_NAME_UNKNOWN
 0

	)

43 
	#NET_NAME_ENUM
 1

	)

44 
	#NET_NAME_PREDICTABLE
 2

	)

45 
	#NET_NAME_USER
 3

	)

46 
	#NET_NAME_RENAMED
 4

	)

50 
	mIF_PORT_UNKNOWN
 = 0,

51 
	mIF_PORT_10BASE2
,

52 
	mIF_PORT_10BASET
,

53 
	mIF_PORT_AUI
,

54 
	mIF_PORT_100BASET
,

55 
	mIF_PORT_100BASETX
,

56 
	mIF_PORT_100BASEFX


60 
	#NET_ADDR_PERM
 0

	)

61 
	#NET_ADDR_RANDOM
 1

	)

62 
	#NET_ADDR_STOLEN
 2

	)

63 
	#NET_ADDR_SET
 3

	)

	@/usr/include/linux/nl80211.h

1 #iâdeà
__LINUX_NL80211_H


2 
	#__LINUX_NL80211_H


	)

43 
	~<lšux/ty³s.h
>

45 
	#NL80211_GENL_NAME
 "Æ80211"

	)

47 
	#NL80211_MULTICAST_GROUP_CONFIG
 "cÚfig"

	)

48 
	#NL80211_MULTICAST_GROUP_SCAN
 "sÿn"

	)

49 
	#NL80211_MULTICAST_GROUP_REG
 "»guÏtÜy"

	)

50 
	#NL80211_MULTICAST_GROUP_MLME
 "mlme"

	)

51 
	#NL80211_MULTICAST_GROUP_VENDOR
 "v’dÜ"

	)

52 
	#NL80211_MULTICAST_GROUP_NAN
 "Çn"

	)

53 
	#NL80211_MULTICAST_GROUP_TESTMODE
 "‹¡mode"

	)

55 
	#NL80211_EDMG_BW_CONFIG_MIN
 4

	)

56 
	#NL80211_EDMG_BW_CONFIG_MAX
 15

	)

57 
	#NL80211_EDMG_CHANNELS_MIN
 1

	)

58 
	#NL80211_EDMG_CHANNELS_MAX
 0x3ø

	)

1206 
	eÆ80211_commªds
 {

1208 
	mNL80211_CMD_UNSPEC
,

1210 
	mNL80211_CMD_GET_WIPHY
,

1211 
	mNL80211_CMD_SET_WIPHY
,

1212 
	mNL80211_CMD_NEW_WIPHY
,

1213 
	mNL80211_CMD_DEL_WIPHY
,

1215 
	mNL80211_CMD_GET_INTERFACE
,

1216 
	mNL80211_CMD_SET_INTERFACE
,

1217 
	mNL80211_CMD_NEW_INTERFACE
,

1218 
	mNL80211_CMD_DEL_INTERFACE
,

1220 
	mNL80211_CMD_GET_KEY
,

1221 
	mNL80211_CMD_SET_KEY
,

1222 
	mNL80211_CMD_NEW_KEY
,

1223 
	mNL80211_CMD_DEL_KEY
,

1225 
	mNL80211_CMD_GET_BEACON
,

1226 
	mNL80211_CMD_SET_BEACON
,

1227 
	mNL80211_CMD_START_AP
,

1228 
	mNL80211_CMD_NEW_BEACON
 = 
NL80211_CMD_START_AP
,

1229 
	mNL80211_CMD_STOP_AP
,

1230 
	mNL80211_CMD_DEL_BEACON
 = 
NL80211_CMD_STOP_AP
,

1232 
	mNL80211_CMD_GET_STATION
,

1233 
	mNL80211_CMD_SET_STATION
,

1234 
	mNL80211_CMD_NEW_STATION
,

1235 
	mNL80211_CMD_DEL_STATION
,

1237 
	mNL80211_CMD_GET_MPATH
,

1238 
	mNL80211_CMD_SET_MPATH
,

1239 
	mNL80211_CMD_NEW_MPATH
,

1240 
	mNL80211_CMD_DEL_MPATH
,

1242 
	mNL80211_CMD_SET_BSS
,

1244 
	mNL80211_CMD_SET_REG
,

1245 
	mNL80211_CMD_REQ_SET_REG
,

1247 
	mNL80211_CMD_GET_MESH_CONFIG
,

1248 
	mNL80211_CMD_SET_MESH_CONFIG
,

1250 
	mNL80211_CMD_SET_MGMT_EXTRA_IE
 ,

1252 
	mNL80211_CMD_GET_REG
,

1254 
	mNL80211_CMD_GET_SCAN
,

1255 
	mNL80211_CMD_TRIGGER_SCAN
,

1256 
	mNL80211_CMD_NEW_SCAN_RESULTS
,

1257 
	mNL80211_CMD_SCAN_ABORTED
,

1259 
	mNL80211_CMD_REG_CHANGE
,

1261 
	mNL80211_CMD_AUTHENTICATE
,

1262 
	mNL80211_CMD_ASSOCIATE
,

1263 
	mNL80211_CMD_DEAUTHENTICATE
,

1264 
	mNL80211_CMD_DISASSOCIATE
,

1266 
	mNL80211_CMD_MICHAEL_MIC_FAILURE
,

1268 
	mNL80211_CMD_REG_BEACON_HINT
,

1270 
	mNL80211_CMD_JOIN_IBSS
,

1271 
	mNL80211_CMD_LEAVE_IBSS
,

1273 
	mNL80211_CMD_TESTMODE
,

1275 
	mNL80211_CMD_CONNECT
,

1276 
	mNL80211_CMD_ROAM
,

1277 
	mNL80211_CMD_DISCONNECT
,

1279 
	mNL80211_CMD_SET_WIPHY_NETNS
,

1281 
	mNL80211_CMD_GET_SURVEY
,

1282 
	mNL80211_CMD_NEW_SURVEY_RESULTS
,

1284 
	mNL80211_CMD_SET_PMKSA
,

1285 
	mNL80211_CMD_DEL_PMKSA
,

1286 
	mNL80211_CMD_FLUSH_PMKSA
,

1288 
	mNL80211_CMD_REMAIN_ON_CHANNEL
,

1289 
	mNL80211_CMD_CANCEL_REMAIN_ON_CHANNEL
,

1291 
	mNL80211_CMD_SET_TX_BITRATE_MASK
,

1293 
	mNL80211_CMD_REGISTER_FRAME
,

1294 
	mNL80211_CMD_REGISTER_ACTION
 = 
NL80211_CMD_REGISTER_FRAME
,

1295 
	mNL80211_CMD_FRAME
,

1296 
	mNL80211_CMD_ACTION
 = 
NL80211_CMD_FRAME
,

1297 
	mNL80211_CMD_FRAME_TX_STATUS
,

1298 
	mNL80211_CMD_ACTION_TX_STATUS
 = 
NL80211_CMD_FRAME_TX_STATUS
,

1300 
	mNL80211_CMD_SET_POWER_SAVE
,

1301 
	mNL80211_CMD_GET_POWER_SAVE
,

1303 
	mNL80211_CMD_SET_CQM
,

1304 
	mNL80211_CMD_NOTIFY_CQM
,

1306 
	mNL80211_CMD_SET_CHANNEL
,

1307 
	mNL80211_CMD_SET_WDS_PEER
,

1309 
	mNL80211_CMD_FRAME_WAIT_CANCEL
,

1311 
	mNL80211_CMD_JOIN_MESH
,

1312 
	mNL80211_CMD_LEAVE_MESH
,

1314 
	mNL80211_CMD_UNPROT_DEAUTHENTICATE
,

1315 
	mNL80211_CMD_UNPROT_DISASSOCIATE
,

1317 
	mNL80211_CMD_NEW_PEER_CANDIDATE
,

1319 
	mNL80211_CMD_GET_WOWLAN
,

1320 
	mNL80211_CMD_SET_WOWLAN
,

1322 
	mNL80211_CMD_START_SCHED_SCAN
,

1323 
	mNL80211_CMD_STOP_SCHED_SCAN
,

1324 
	mNL80211_CMD_SCHED_SCAN_RESULTS
,

1325 
	mNL80211_CMD_SCHED_SCAN_STOPPED
,

1327 
	mNL80211_CMD_SET_REKEY_OFFLOAD
,

1329 
	mNL80211_CMD_PMKSA_CANDIDATE
,

1331 
	mNL80211_CMD_TDLS_OPER
,

1332 
	mNL80211_CMD_TDLS_MGMT
,

1334 
	mNL80211_CMD_UNEXPECTED_FRAME
,

1336 
	mNL80211_CMD_PROBE_CLIENT
,

1338 
	mNL80211_CMD_REGISTER_BEACONS
,

1340 
	mNL80211_CMD_UNEXPECTED_4ADDR_FRAME
,

1342 
	mNL80211_CMD_SET_NOACK_MAP
,

1344 
	mNL80211_CMD_CH_SWITCH_NOTIFY
,

1346 
	mNL80211_CMD_START_P2P_DEVICE
,

1347 
	mNL80211_CMD_STOP_P2P_DEVICE
,

1349 
	mNL80211_CMD_CONN_FAILED
,

1351 
	mNL80211_CMD_SET_MCAST_RATE
,

1353 
	mNL80211_CMD_SET_MAC_ACL
,

1355 
	mNL80211_CMD_RADAR_DETECT
,

1357 
	mNL80211_CMD_GET_PROTOCOL_FEATURES
,

1359 
	mNL80211_CMD_UPDATE_FT_IES
,

1360 
	mNL80211_CMD_FT_EVENT
,

1362 
	mNL80211_CMD_CRIT_PROTOCOL_START
,

1363 
	mNL80211_CMD_CRIT_PROTOCOL_STOP
,

1365 
	mNL80211_CMD_GET_COALESCE
,

1366 
	mNL80211_CMD_SET_COALESCE
,

1368 
	mNL80211_CMD_CHANNEL_SWITCH
,

1370 
	mNL80211_CMD_VENDOR
,

1372 
	mNL80211_CMD_SET_QOS_MAP
,

1374 
	mNL80211_CMD_ADD_TX_TS
,

1375 
	mNL80211_CMD_DEL_TX_TS
,

1377 
	mNL80211_CMD_GET_MPP
,

1379 
	mNL80211_CMD_JOIN_OCB
,

1380 
	mNL80211_CMD_LEAVE_OCB
,

1382 
	mNL80211_CMD_CH_SWITCH_STARTED_NOTIFY
,

1384 
	mNL80211_CMD_TDLS_CHANNEL_SWITCH
,

1385 
	mNL80211_CMD_TDLS_CANCEL_CHANNEL_SWITCH
,

1387 
	mNL80211_CMD_WIPHY_REG_CHANGE
,

1389 
	mNL80211_CMD_ABORT_SCAN
,

1391 
	mNL80211_CMD_START_NAN
,

1392 
	mNL80211_CMD_STOP_NAN
,

1393 
	mNL80211_CMD_ADD_NAN_FUNCTION
,

1394 
	mNL80211_CMD_DEL_NAN_FUNCTION
,

1395 
	mNL80211_CMD_CHANGE_NAN_CONFIG
,

1396 
	mNL80211_CMD_NAN_MATCH
,

1398 
	mNL80211_CMD_SET_MULTICAST_TO_UNICAST
,

1400 
	mNL80211_CMD_UPDATE_CONNECT_PARAMS
,

1402 
	mNL80211_CMD_SET_PMK
,

1403 
	mNL80211_CMD_DEL_PMK
,

1405 
	mNL80211_CMD_PORT_AUTHORIZED
,

1407 
	mNL80211_CMD_RELOAD_REGDB
,

1409 
	mNL80211_CMD_EXTERNAL_AUTH
,

1411 
	mNL80211_CMD_STA_OPMODE_CHANGED
,

1413 
	mNL80211_CMD_CONTROL_PORT_FRAME
,

1415 
	mNL80211_CMD_GET_FTM_RESPONDER_STATS
,

1417 
	mNL80211_CMD_PEER_MEASUREMENT_START
,

1418 
	mNL80211_CMD_PEER_MEASUREMENT_RESULT
,

1419 
	mNL80211_CMD_PEER_MEASUREMENT_COMPLETE
,

1421 
	mNL80211_CMD_NOTIFY_RADAR
,

1423 
	mNL80211_CMD_UPDATE_OWE_INFO
,

1425 
	mNL80211_CMD_PROBE_MESH_LINK
,

1427 
	mNL80211_CMD_SET_TID_CONFIG
,

1429 
	mNL80211_CMD_UNPROT_BEACON
,

1431 
	mNL80211_CMD_CONTROL_PORT_FRAME_TX_STATUS
,

1433 
	mNL80211_CMD_SET_SAR_SPECS
,

1435 
	mNL80211_CMD_OBSS_COLOR_COLLISION
,

1437 
	mNL80211_CMD_COLOR_CHANGE_REQUEST
,

1439 
	mNL80211_CMD_COLOR_CHANGE_STARTED
,

1440 
	mNL80211_CMD_COLOR_CHANGE_ABORTED
,

1441 
	mNL80211_CMD_COLOR_CHANGE_COMPLETED
,

1446 
	m__NL80211_CMD_AFTER_LAST
,

1447 
	mNL80211_CMD_MAX
 = 
__NL80211_CMD_AFTER_LAST
 - 1

1454 
	#NL80211_CMD_SET_BSS
 
NL80211_CMD_SET_BSS


	)

1455 
	#NL80211_CMD_SET_MGMT_EXTRA_IE
 
NL80211_CMD_SET_MGMT_EXTRA_IE


	)

1456 
	#NL80211_CMD_REG_CHANGE
 
NL80211_CMD_REG_CHANGE


	)

1457 
	#NL80211_CMD_AUTHENTICATE
 
NL80211_CMD_AUTHENTICATE


	)

1458 
	#NL80211_CMD_ASSOCIATE
 
NL80211_CMD_ASSOCIATE


	)

1459 
	#NL80211_CMD_DEAUTHENTICATE
 
NL80211_CMD_DEAUTHENTICATE


	)

1460 
	#NL80211_CMD_DISASSOCIATE
 
NL80211_CMD_DISASSOCIATE


	)

1461 
	#NL80211_CMD_REG_BEACON_HINT
 
NL80211_CMD_REG_BEACON_HINT


	)

1463 
	#NL80211_ATTR_FEATURE_FLAGS
 
NL80211_ATTR_FEATURE_FLAGS


	)

1466 
	#NL80211_CMD_GET_MESH_PARAMS
 
NL80211_CMD_GET_MESH_CONFIG


	)

1467 
	#NL80211_CMD_SET_MESH_PARAMS
 
NL80211_CMD_SET_MESH_CONFIG


	)

1468 
	#NL80211_MESH_SETUP_VENDOR_PATH_SEL_IE
 
NL80211_MESH_SETUP_IE


	)

2600 
	eÆ80211_©Œs
 {

2602 
	mNL80211_ATTR_UNSPEC
,

2604 
	mNL80211_ATTR_WIPHY
,

2605 
	mNL80211_ATTR_WIPHY_NAME
,

2607 
	mNL80211_ATTR_IFINDEX
,

2608 
	mNL80211_ATTR_IFNAME
,

2609 
	mNL80211_ATTR_IFTYPE
,

2611 
	mNL80211_ATTR_MAC
,

2613 
	mNL80211_ATTR_KEY_DATA
,

2614 
	mNL80211_ATTR_KEY_IDX
,

2615 
	mNL80211_ATTR_KEY_CIPHER
,

2616 
	mNL80211_ATTR_KEY_SEQ
,

2617 
	mNL80211_ATTR_KEY_DEFAULT
,

2619 
	mNL80211_ATTR_BEACON_INTERVAL
,

2620 
	mNL80211_ATTR_DTIM_PERIOD
,

2621 
	mNL80211_ATTR_BEACON_HEAD
,

2622 
	mNL80211_ATTR_BEACON_TAIL
,

2624 
	mNL80211_ATTR_STA_AID
,

2625 
	mNL80211_ATTR_STA_FLAGS
,

2626 
	mNL80211_ATTR_STA_LISTEN_INTERVAL
,

2627 
	mNL80211_ATTR_STA_SUPPORTED_RATES
,

2628 
	mNL80211_ATTR_STA_VLAN
,

2629 
	mNL80211_ATTR_STA_INFO
,

2631 
	mNL80211_ATTR_WIPHY_BANDS
,

2633 
	mNL80211_ATTR_MNTR_FLAGS
,

2635 
	mNL80211_ATTR_MESH_ID
,

2636 
	mNL80211_ATTR_STA_PLINK_ACTION
,

2637 
	mNL80211_ATTR_MPATH_NEXT_HOP
,

2638 
	mNL80211_ATTR_MPATH_INFO
,

2640 
	mNL80211_ATTR_BSS_CTS_PROT
,

2641 
	mNL80211_ATTR_BSS_SHORT_PREAMBLE
,

2642 
	mNL80211_ATTR_BSS_SHORT_SLOT_TIME
,

2644 
	mNL80211_ATTR_HT_CAPABILITY
,

2646 
	mNL80211_ATTR_SUPPORTED_IFTYPES
,

2648 
	mNL80211_ATTR_REG_ALPHA2
,

2649 
	mNL80211_ATTR_REG_RULES
,

2651 
	mNL80211_ATTR_MESH_CONFIG
,

2653 
	mNL80211_ATTR_BSS_BASIC_RATES
,

2655 
	mNL80211_ATTR_WIPHY_TXQ_PARAMS
,

2656 
	mNL80211_ATTR_WIPHY_FREQ
,

2657 
	mNL80211_ATTR_WIPHY_CHANNEL_TYPE
,

2659 
	mNL80211_ATTR_KEY_DEFAULT_MGMT
,

2661 
	mNL80211_ATTR_MGMT_SUBTYPE
,

2662 
	mNL80211_ATTR_IE
,

2664 
	mNL80211_ATTR_MAX_NUM_SCAN_SSIDS
,

2666 
	mNL80211_ATTR_SCAN_FREQUENCIES
,

2667 
	mNL80211_ATTR_SCAN_SSIDS
,

2668 
	mNL80211_ATTR_GENERATION
,

2669 
	mNL80211_ATTR_BSS
,

2671 
	mNL80211_ATTR_REG_INITIATOR
,

2672 
	mNL80211_ATTR_REG_TYPE
,

2674 
	mNL80211_ATTR_SUPPORTED_COMMANDS
,

2676 
	mNL80211_ATTR_FRAME
,

2677 
	mNL80211_ATTR_SSID
,

2678 
	mNL80211_ATTR_AUTH_TYPE
,

2679 
	mNL80211_ATTR_REASON_CODE
,

2681 
	mNL80211_ATTR_KEY_TYPE
,

2683 
	mNL80211_ATTR_MAX_SCAN_IE_LEN
,

2684 
	mNL80211_ATTR_CIPHER_SUITES
,

2686 
	mNL80211_ATTR_FREQ_BEFORE
,

2687 
	mNL80211_ATTR_FREQ_AFTER
,

2689 
	mNL80211_ATTR_FREQ_FIXED
,

2692 
	mNL80211_ATTR_WIPHY_RETRY_SHORT
,

2693 
	mNL80211_ATTR_WIPHY_RETRY_LONG
,

2694 
	mNL80211_ATTR_WIPHY_FRAG_THRESHOLD
,

2695 
	mNL80211_ATTR_WIPHY_RTS_THRESHOLD
,

2697 
	mNL80211_ATTR_TIMED_OUT
,

2699 
	mNL80211_ATTR_USE_MFP
,

2701 
	mNL80211_ATTR_STA_FLAGS2
,

2703 
	mNL80211_ATTR_CONTROL_PORT
,

2705 
	mNL80211_ATTR_TESTDATA
,

2707 
	mNL80211_ATTR_PRIVACY
,

2709 
	mNL80211_ATTR_DISCONNECTED_BY_AP
,

2710 
	mNL80211_ATTR_STATUS_CODE
,

2712 
	mNL80211_ATTR_CIPHER_SUITES_PAIRWISE
,

2713 
	mNL80211_ATTR_CIPHER_SUITE_GROUP
,

2714 
	mNL80211_ATTR_WPA_VERSIONS
,

2715 
	mNL80211_ATTR_AKM_SUITES
,

2717 
	mNL80211_ATTR_REQ_IE
,

2718 
	mNL80211_ATTR_RESP_IE
,

2720 
	mNL80211_ATTR_PREV_BSSID
,

2722 
	mNL80211_ATTR_KEY
,

2723 
	mNL80211_ATTR_KEYS
,

2725 
	mNL80211_ATTR_PID
,

2727 
	mNL80211_ATTR_4ADDR
,

2729 
	mNL80211_ATTR_SURVEY_INFO
,

2731 
	mNL80211_ATTR_PMKID
,

2732 
	mNL80211_ATTR_MAX_NUM_PMKIDS
,

2734 
	mNL80211_ATTR_DURATION
,

2736 
	mNL80211_ATTR_COOKIE
,

2738 
	mNL80211_ATTR_WIPHY_COVERAGE_CLASS
,

2740 
	mNL80211_ATTR_TX_RATES
,

2742 
	mNL80211_ATTR_FRAME_MATCH
,

2744 
	mNL80211_ATTR_ACK
,

2746 
	mNL80211_ATTR_PS_STATE
,

2748 
	mNL80211_ATTR_CQM
,

2750 
	mNL80211_ATTR_LOCAL_STATE_CHANGE
,

2752 
	mNL80211_ATTR_AP_ISOLATE
,

2754 
	mNL80211_ATTR_WIPHY_TX_POWER_SETTING
,

2755 
	mNL80211_ATTR_WIPHY_TX_POWER_LEVEL
,

2757 
	mNL80211_ATTR_TX_FRAME_TYPES
,

2758 
	mNL80211_ATTR_RX_FRAME_TYPES
,

2759 
	mNL80211_ATTR_FRAME_TYPE
,

2761 
	mNL80211_ATTR_CONTROL_PORT_ETHERTYPE
,

2762 
	mNL80211_ATTR_CONTROL_PORT_NO_ENCRYPT
,

2764 
	mNL80211_ATTR_SUPPORT_IBSS_RSN
,

2766 
	mNL80211_ATTR_WIPHY_ANTENNA_TX
,

2767 
	mNL80211_ATTR_WIPHY_ANTENNA_RX
,

2769 
	mNL80211_ATTR_MCAST_RATE
,

2771 
	mNL80211_ATTR_OFFCHANNEL_TX_OK
,

2773 
	mNL80211_ATTR_BSS_HT_OPMODE
,

2775 
	mNL80211_ATTR_KEY_DEFAULT_TYPES
,

2777 
	mNL80211_ATTR_MAX_REMAIN_ON_CHANNEL_DURATION
,

2779 
	mNL80211_ATTR_MESH_SETUP
,

2781 
	mNL80211_ATTR_WIPHY_ANTENNA_AVAIL_TX
,

2782 
	mNL80211_ATTR_WIPHY_ANTENNA_AVAIL_RX
,

2784 
	mNL80211_ATTR_SUPPORT_MESH_AUTH
,

2785 
	mNL80211_ATTR_STA_PLINK_STATE
,

2787 
	mNL80211_ATTR_WOWLAN_TRIGGERS
,

2788 
	mNL80211_ATTR_WOWLAN_TRIGGERS_SUPPORTED
,

2790 
	mNL80211_ATTR_SCHED_SCAN_INTERVAL
,

2792 
	mNL80211_ATTR_INTERFACE_COMBINATIONS
,

2793 
	mNL80211_ATTR_SOFTWARE_IFTYPES
,

2795 
	mNL80211_ATTR_REKEY_DATA
,

2797 
	mNL80211_ATTR_MAX_NUM_SCHED_SCAN_SSIDS
,

2798 
	mNL80211_ATTR_MAX_SCHED_SCAN_IE_LEN
,

2800 
	mNL80211_ATTR_SCAN_SUPP_RATES
,

2802 
	mNL80211_ATTR_HIDDEN_SSID
,

2804 
	mNL80211_ATTR_IE_PROBE_RESP
,

2805 
	mNL80211_ATTR_IE_ASSOC_RESP
,

2807 
	mNL80211_ATTR_STA_WME
,

2808 
	mNL80211_ATTR_SUPPORT_AP_UAPSD
,

2810 
	mNL80211_ATTR_ROAM_SUPPORT
,

2812 
	mNL80211_ATTR_SCHED_SCAN_MATCH
,

2813 
	mNL80211_ATTR_MAX_MATCH_SETS
,

2815 
	mNL80211_ATTR_PMKSA_CANDIDATE
,

2817 
	mNL80211_ATTR_TX_NO_CCK_RATE
,

2819 
	mNL80211_ATTR_TDLS_ACTION
,

2820 
	mNL80211_ATTR_TDLS_DIALOG_TOKEN
,

2821 
	mNL80211_ATTR_TDLS_OPERATION
,

2822 
	mNL80211_ATTR_TDLS_SUPPORT
,

2823 
	mNL80211_ATTR_TDLS_EXTERNAL_SETUP
,

2825 
	mNL80211_ATTR_DEVICE_AP_SME
,

2827 
	mNL80211_ATTR_DONT_WAIT_FOR_ACK
,

2829 
	mNL80211_ATTR_FEATURE_FLAGS
,

2831 
	mNL80211_ATTR_PROBE_RESP_OFFLOAD
,

2833 
	mNL80211_ATTR_PROBE_RESP
,

2835 
	mNL80211_ATTR_DFS_REGION
,

2837 
	mNL80211_ATTR_DISABLE_HT
,

2838 
	mNL80211_ATTR_HT_CAPABILITY_MASK
,

2840 
	mNL80211_ATTR_NOACK_MAP
,

2842 
	mNL80211_ATTR_INACTIVITY_TIMEOUT
,

2844 
	mNL80211_ATTR_RX_SIGNAL_DBM
,

2846 
	mNL80211_ATTR_BG_SCAN_PERIOD
,

2848 
	mNL80211_ATTR_WDEV
,

2850 
	mNL80211_ATTR_USER_REG_HINT_TYPE
,

2852 
	mNL80211_ATTR_CONN_FAILED_REASON
,

2854 
	mNL80211_ATTR_AUTH_DATA
,

2856 
	mNL80211_ATTR_VHT_CAPABILITY
,

2858 
	mNL80211_ATTR_SCAN_FLAGS
,

2860 
	mNL80211_ATTR_CHANNEL_WIDTH
,

2861 
	mNL80211_ATTR_CENTER_FREQ1
,

2862 
	mNL80211_ATTR_CENTER_FREQ2
,

2864 
	mNL80211_ATTR_P2P_CTWINDOW
,

2865 
	mNL80211_ATTR_P2P_OPPPS
,

2867 
	mNL80211_ATTR_LOCAL_MESH_POWER_MODE
,

2869 
	mNL80211_ATTR_ACL_POLICY
,

2871 
	mNL80211_ATTR_MAC_ADDRS
,

2873 
	mNL80211_ATTR_MAC_ACL_MAX
,

2875 
	mNL80211_ATTR_RADAR_EVENT
,

2877 
	mNL80211_ATTR_EXT_CAPA
,

2878 
	mNL80211_ATTR_EXT_CAPA_MASK
,

2880 
	mNL80211_ATTR_STA_CAPABILITY
,

2881 
	mNL80211_ATTR_STA_EXT_CAPABILITY
,

2883 
	mNL80211_ATTR_PROTOCOL_FEATURES
,

2884 
	mNL80211_ATTR_SPLIT_WIPHY_DUMP
,

2886 
	mNL80211_ATTR_DISABLE_VHT
,

2887 
	mNL80211_ATTR_VHT_CAPABILITY_MASK
,

2889 
	mNL80211_ATTR_MDID
,

2890 
	mNL80211_ATTR_IE_RIC
,

2892 
	mNL80211_ATTR_CRIT_PROT_ID
,

2893 
	mNL80211_ATTR_MAX_CRIT_PROT_DURATION
,

2895 
	mNL80211_ATTR_PEER_AID
,

2897 
	mNL80211_ATTR_COALESCE_RULE
,

2899 
	mNL80211_ATTR_CH_SWITCH_COUNT
,

2900 
	mNL80211_ATTR_CH_SWITCH_BLOCK_TX
,

2901 
	mNL80211_ATTR_CSA_IES
,

2902 
	mNL80211_ATTR_CNTDWN_OFFS_BEACON
,

2903 
	mNL80211_ATTR_CNTDWN_OFFS_PRESP
,

2905 
	mNL80211_ATTR_RXMGMT_FLAGS
,

2907 
	mNL80211_ATTR_STA_SUPPORTED_CHANNELS
,

2909 
	mNL80211_ATTR_STA_SUPPORTED_OPER_CLASSES
,

2911 
	mNL80211_ATTR_HANDLE_DFS
,

2913 
	mNL80211_ATTR_SUPPORT_5_MHZ
,

2914 
	mNL80211_ATTR_SUPPORT_10_MHZ
,

2916 
	mNL80211_ATTR_OPMODE_NOTIF
,

2918 
	mNL80211_ATTR_VENDOR_ID
,

2919 
	mNL80211_ATTR_VENDOR_SUBCMD
,

2920 
	mNL80211_ATTR_VENDOR_DATA
,

2921 
	mNL80211_ATTR_VENDOR_EVENTS
,

2923 
	mNL80211_ATTR_QOS_MAP
,

2925 
	mNL80211_ATTR_MAC_HINT
,

2926 
	mNL80211_ATTR_WIPHY_FREQ_HINT
,

2928 
	mNL80211_ATTR_MAX_AP_ASSOC_STA
,

2930 
	mNL80211_ATTR_TDLS_PEER_CAPABILITY
,

2932 
	mNL80211_ATTR_SOCKET_OWNER
,

2934 
	mNL80211_ATTR_CSA_C_OFFSETS_TX
,

2935 
	mNL80211_ATTR_MAX_CSA_COUNTERS
,

2937 
	mNL80211_ATTR_TDLS_INITIATOR
,

2939 
	mNL80211_ATTR_USE_RRM
,

2941 
	mNL80211_ATTR_WIPHY_DYN_ACK
,

2943 
	mNL80211_ATTR_TSID
,

2944 
	mNL80211_ATTR_USER_PRIO
,

2945 
	mNL80211_ATTR_ADMITTED_TIME
,

2947 
	mNL80211_ATTR_SMPS_MODE
,

2949 
	mNL80211_ATTR_OPER_CLASS
,

2951 
	mNL80211_ATTR_MAC_MASK
,

2953 
	mNL80211_ATTR_WIPHY_SELF_MANAGED_REG
,

2955 
	mNL80211_ATTR_EXT_FEATURES
,

2957 
	mNL80211_ATTR_SURVEY_RADIO_STATS
,

2959 
	mNL80211_ATTR_NETNS_FD
,

2961 
	mNL80211_ATTR_SCHED_SCAN_DELAY
,

2963 
	mNL80211_ATTR_REG_INDOOR
,

2965 
	mNL80211_ATTR_MAX_NUM_SCHED_SCAN_PLANS
,

2966 
	mNL80211_ATTR_MAX_SCAN_PLAN_INTERVAL
,

2967 
	mNL80211_ATTR_MAX_SCAN_PLAN_ITERATIONS
,

2968 
	mNL80211_ATTR_SCHED_SCAN_PLANS
,

2970 
	mNL80211_ATTR_PBSS
,

2972 
	mNL80211_ATTR_BSS_SELECT
,

2974 
	mNL80211_ATTR_STA_SUPPORT_P2P_PS
,

2976 
	mNL80211_ATTR_PAD
,

2978 
	mNL80211_ATTR_IFTYPE_EXT_CAPA
,

2980 
	mNL80211_ATTR_MU_MIMO_GROUP_DATA
,

2981 
	mNL80211_ATTR_MU_MIMO_FOLLOW_MAC_ADDR
,

2983 
	mNL80211_ATTR_SCAN_START_TIME_TSF
,

2984 
	mNL80211_ATTR_SCAN_START_TIME_TSF_BSSID
,

2985 
	mNL80211_ATTR_MEASUREMENT_DURATION
,

2986 
	mNL80211_ATTR_MEASUREMENT_DURATION_MANDATORY
,

2988 
	mNL80211_ATTR_MESH_PEER_AID
,

2990 
	mNL80211_ATTR_NAN_MASTER_PREF
,

2991 
	mNL80211_ATTR_BANDS
,

2992 
	mNL80211_ATTR_NAN_FUNC
,

2993 
	mNL80211_ATTR_NAN_MATCH
,

2995 
	mNL80211_ATTR_FILS_KEK
,

2996 
	mNL80211_ATTR_FILS_NONCES
,

2998 
	mNL80211_ATTR_MULTICAST_TO_UNICAST_ENABLED
,

3000 
	mNL80211_ATTR_BSSID
,

3002 
	mNL80211_ATTR_SCHED_SCAN_RELATIVE_RSSI
,

3003 
	mNL80211_ATTR_SCHED_SCAN_RSSI_ADJUST
,

3005 
	mNL80211_ATTR_TIMEOUT_REASON
,

3007 
	mNL80211_ATTR_FILS_ERP_USERNAME
,

3008 
	mNL80211_ATTR_FILS_ERP_REALM
,

3009 
	mNL80211_ATTR_FILS_ERP_NEXT_SEQ_NUM
,

3010 
	mNL80211_ATTR_FILS_ERP_RRK
,

3011 
	mNL80211_ATTR_FILS_CACHE_ID
,

3013 
	mNL80211_ATTR_PMK
,

3015 
	mNL80211_ATTR_SCHED_SCAN_MULTI
,

3016 
	mNL80211_ATTR_SCHED_SCAN_MAX_REQS
,

3018 
	mNL80211_ATTR_WANT_1X_4WAY_HS
,

3019 
	mNL80211_ATTR_PMKR0_NAME
,

3020 
	mNL80211_ATTR_PORT_AUTHORIZED
,

3022 
	mNL80211_ATTR_EXTERNAL_AUTH_ACTION
,

3023 
	mNL80211_ATTR_EXTERNAL_AUTH_SUPPORT
,

3025 
	mNL80211_ATTR_NSS
,

3026 
	mNL80211_ATTR_ACK_SIGNAL
,

3028 
	mNL80211_ATTR_CONTROL_PORT_OVER_NL80211
,

3030 
	mNL80211_ATTR_TXQ_STATS
,

3031 
	mNL80211_ATTR_TXQ_LIMIT
,

3032 
	mNL80211_ATTR_TXQ_MEMORY_LIMIT
,

3033 
	mNL80211_ATTR_TXQ_QUANTUM
,

3035 
	mNL80211_ATTR_HE_CAPABILITY
,

3037 
	mNL80211_ATTR_FTM_RESPONDER
,

3039 
	mNL80211_ATTR_FTM_RESPONDER_STATS
,

3041 
	mNL80211_ATTR_TIMEOUT
,

3043 
	mNL80211_ATTR_PEER_MEASUREMENTS
,

3045 
	mNL80211_ATTR_AIRTIME_WEIGHT
,

3046 
	mNL80211_ATTR_STA_TX_POWER_SETTING
,

3047 
	mNL80211_ATTR_STA_TX_POWER
,

3049 
	mNL80211_ATTR_SAE_PASSWORD
,

3051 
	mNL80211_ATTR_TWT_RESPONDER
,

3053 
	mNL80211_ATTR_HE_OBSS_PD
,

3055 
	mNL80211_ATTR_WIPHY_EDMG_CHANNELS
,

3056 
	mNL80211_ATTR_WIPHY_EDMG_BW_CONFIG
,

3058 
	mNL80211_ATTR_VLAN_ID
,

3060 
	mNL80211_ATTR_HE_BSS_COLOR
,

3062 
	mNL80211_ATTR_IFTYPE_AKM_SUITES
,

3064 
	mNL80211_ATTR_TID_CONFIG
,

3066 
	mNL80211_ATTR_CONTROL_PORT_NO_PREAUTH
,

3068 
	mNL80211_ATTR_PMK_LIFETIME
,

3069 
	mNL80211_ATTR_PMK_REAUTH_THRESHOLD
,

3071 
	mNL80211_ATTR_RECEIVE_MULTICAST
,

3072 
	mNL80211_ATTR_WIPHY_FREQ_OFFSET
,

3073 
	mNL80211_ATTR_CENTER_FREQ1_OFFSET
,

3074 
	mNL80211_ATTR_SCAN_FREQ_KHZ
,

3076 
	mNL80211_ATTR_HE_6GHZ_CAPABILITY
,

3078 
	mNL80211_ATTR_FILS_DISCOVERY
,

3080 
	mNL80211_ATTR_UNSOL_BCAST_PROBE_RESP
,

3082 
	mNL80211_ATTR_S1G_CAPABILITY
,

3083 
	mNL80211_ATTR_S1G_CAPABILITY_MASK
,

3085 
	mNL80211_ATTR_SAE_PWE
,

3087 
	mNL80211_ATTR_RECONNECT_REQUESTED
,

3089 
	mNL80211_ATTR_SAR_SPEC
,

3091 
	mNL80211_ATTR_DISABLE_HE
,

3093 
	mNL80211_ATTR_OBSS_COLOR_BITMAP
,

3095 
	mNL80211_ATTR_COLOR_CHANGE_COUNT
,

3096 
	mNL80211_ATTR_COLOR_CHANGE_COLOR
,

3097 
	mNL80211_ATTR_COLOR_CHANGE_ELEMS
,

3101 
	m__NL80211_ATTR_AFTER_LAST
,

3102 
	mNUM_NL80211_ATTR
 = 
__NL80211_ATTR_AFTER_LAST
,

3103 
	mNL80211_ATTR_MAX
 = 
__NL80211_ATTR_AFTER_LAST
 - 1

3107 
	#NL80211_ATTR_SCAN_GENERATION
 
NL80211_ATTR_GENERATION


	)

3108 
	#NL80211_ATTR_MESH_PARAMS
 
NL80211_ATTR_MESH_CONFIG


	)

3109 
	#NL80211_ATTR_IFACE_SOCKET_OWNER
 
NL80211_ATTR_SOCKET_OWNER


	)

3110 
	#NL80211_ATTR_SAE_DATA
 
NL80211_ATTR_AUTH_DATA


	)

3111 
	#NL80211_ATTR_CSA_C_OFF_BEACON
 
NL80211_ATTR_CNTDWN_OFFS_BEACON


	)

3112 
	#NL80211_ATTR_CSA_C_OFF_PRESP
 
NL80211_ATTR_CNTDWN_OFFS_PRESP


	)

3118 
	#NL80211_CMD_CONNECT
 
NL80211_CMD_CONNECT


	)

3119 
	#NL80211_ATTR_HT_CAPABILITY
 
NL80211_ATTR_HT_CAPABILITY


	)

3120 
	#NL80211_ATTR_BSS_BASIC_RATES
 
NL80211_ATTR_BSS_BASIC_RATES


	)

3121 
	#NL80211_ATTR_WIPHY_TXQ_PARAMS
 
NL80211_ATTR_WIPHY_TXQ_PARAMS


	)

3122 
	#NL80211_ATTR_WIPHY_FREQ
 
NL80211_ATTR_WIPHY_FREQ


	)

3123 
	#NL80211_ATTR_WIPHY_CHANNEL_TYPE
 
NL80211_ATTR_WIPHY_CHANNEL_TYPE


	)

3124 
	#NL80211_ATTR_MGMT_SUBTYPE
 
NL80211_ATTR_MGMT_SUBTYPE


	)

3125 
	#NL80211_ATTR_IE
 
NL80211_ATTR_IE


	)

3126 
	#NL80211_ATTR_REG_INITIATOR
 
NL80211_ATTR_REG_INITIATOR


	)

3127 
	#NL80211_ATTR_REG_TYPE
 
NL80211_ATTR_REG_TYPE


	)

3128 
	#NL80211_ATTR_FRAME
 
NL80211_ATTR_FRAME


	)

3129 
	#NL80211_ATTR_SSID
 
NL80211_ATTR_SSID


	)

3130 
	#NL80211_ATTR_AUTH_TYPE
 
NL80211_ATTR_AUTH_TYPE


	)

3131 
	#NL80211_ATTR_REASON_CODE
 
NL80211_ATTR_REASON_CODE


	)

3132 
	#NL80211_ATTR_CIPHER_SUITES_PAIRWISE
 
NL80211_ATTR_CIPHER_SUITES_PAIRWISE


	)

3133 
	#NL80211_ATTR_CIPHER_SUITE_GROUP
 
NL80211_ATTR_CIPHER_SUITE_GROUP


	)

3134 
	#NL80211_ATTR_WPA_VERSIONS
 
NL80211_ATTR_WPA_VERSIONS


	)

3135 
	#NL80211_ATTR_AKM_SUITES
 
NL80211_ATTR_AKM_SUITES


	)

3136 
	#NL80211_ATTR_KEY
 
NL80211_ATTR_KEY


	)

3137 
	#NL80211_ATTR_KEYS
 
NL80211_ATTR_KEYS


	)

3138 
	#NL80211_ATTR_FEATURE_FLAGS
 
NL80211_ATTR_FEATURE_FLAGS


	)

3140 
	#NL80211_WIPHY_NAME_MAXLEN
 64

	)

3142 
	#NL80211_MAX_SUPP_RATES
 32

	)

3143 
	#NL80211_MAX_SUPP_HT_RATES
 77

	)

3144 
	#NL80211_MAX_SUPP_REG_RULES
 128

	)

3145 
	#NL80211_TKIP_DATA_OFFSET_ENCR_KEY
 0

	)

3146 
	#NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
 16

	)

3147 
	#NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 24

	)

3148 
	#NL80211_HT_CAPABILITY_LEN
 26

	)

3149 
	#NL80211_VHT_CAPABILITY_LEN
 12

	)

3150 
	#NL80211_HE_MIN_CAPABILITY_LEN
 16

	)

3151 
	#NL80211_HE_MAX_CAPABILITY_LEN
 54

	)

3152 
	#NL80211_MAX_NR_CIPHER_SUITES
 5

	)

3153 
	#NL80211_MAX_NR_AKM_SUITES
 2

	)

3155 
	#NL80211_MIN_REMAIN_ON_CHANNEL_TIME
 10

	)

3158 
	#NL80211_SCAN_RSSI_THOLD_OFF
 -300

	)

3160 
	#NL80211_CQM_TXE_MAX_INTVL
 1800

	)

3191 
	eÆ80211_iáy³
 {

3192 
	mNL80211_IFTYPE_UNSPECIFIED
,

3193 
	mNL80211_IFTYPE_ADHOC
,

3194 
	mNL80211_IFTYPE_STATION
,

3195 
	mNL80211_IFTYPE_AP
,

3196 
	mNL80211_IFTYPE_AP_VLAN
,

3197 
	mNL80211_IFTYPE_WDS
,

3198 
	mNL80211_IFTYPE_MONITOR
,

3199 
	mNL80211_IFTYPE_MESH_POINT
,

3200 
	mNL80211_IFTYPE_P2P_CLIENT
,

3201 
	mNL80211_IFTYPE_P2P_GO
,

3202 
	mNL80211_IFTYPE_P2P_DEVICE
,

3203 
	mNL80211_IFTYPE_OCB
,

3204 
	mNL80211_IFTYPE_NAN
,

3207 
	mNUM_NL80211_IFTYPES
,

3208 
	mNL80211_IFTYPE_MAX
 = 
NUM_NL80211_IFTYPES
 - 1

3235 
	eÆ80211_¡a_æags
 {

3236 
	m__NL80211_STA_FLAG_INVALID
,

3237 
	mNL80211_STA_FLAG_AUTHORIZED
,

3238 
	mNL80211_STA_FLAG_SHORT_PREAMBLE
,

3239 
	mNL80211_STA_FLAG_WME
,

3240 
	mNL80211_STA_FLAG_MFP
,

3241 
	mNL80211_STA_FLAG_AUTHENTICATED
,

3242 
	mNL80211_STA_FLAG_TDLS_PEER
,

3243 
	mNL80211_STA_FLAG_ASSOCIATED
,

3246 
	m__NL80211_STA_FLAG_AFTER_LAST
,

3247 
	mNL80211_STA_FLAG_MAX
 = 
__NL80211_STA_FLAG_AFTER_LAST
 - 1

3257 
	eÆ80211_¡a_p2p_ps_¡©us
 {

3258 
	mNL80211_P2P_PS_UNSUPPORTED
 = 0,

3259 
	mNL80211_P2P_PS_SUPPORTED
,

3261 
	mNUM_NL80211_P2P_PS_STATUS
,

3264 
	#NL80211_STA_FLAG_MAX_OLD_API
 
NL80211_STA_FLAG_TDLS_PEER


	)

3273 
	sÆ80211_¡a_æag_upd©e
 {

3274 
__u32
 
	mmask
;

3275 
__u32
 
	m£t
;

3276 } 
__©Œibu‹__
((
·cked
));

3284 
	eÆ80211_he_gi
 {

3285 
	mNL80211_RATE_INFO_HE_GI_0_8
,

3286 
	mNL80211_RATE_INFO_HE_GI_1_6
,

3287 
	mNL80211_RATE_INFO_HE_GI_3_2
,

3296 
	eÆ80211_he_Éf
 {

3297 
	mNL80211_RATE_INFO_HE_1XLTF
,

3298 
	mNL80211_RATE_INFO_HE_2XLTF
,

3299 
	mNL80211_RATE_INFO_HE_4XLTF
,

3312 
	eÆ80211_he_ru_®loc
 {

3313 
	mNL80211_RATE_INFO_HE_RU_ALLOC_26
,

3314 
	mNL80211_RATE_INFO_HE_RU_ALLOC_52
,

3315 
	mNL80211_RATE_INFO_HE_RU_ALLOC_106
,

3316 
	mNL80211_RATE_INFO_HE_RU_ALLOC_242
,

3317 
	mNL80211_RATE_INFO_HE_RU_ALLOC_484
,

3318 
	mNL80211_RATE_INFO_HE_RU_ALLOC_996
,

3319 
	mNL80211_RATE_INFO_HE_RU_ALLOC_2x996
,

3363 
	eÆ80211_¿‹_šfo
 {

3364 
	m__NL80211_RATE_INFO_INVALID
,

3365 
	mNL80211_RATE_INFO_BITRATE
,

3366 
	mNL80211_RATE_INFO_MCS
,

3367 
	mNL80211_RATE_INFO_40_MHZ_WIDTH
,

3368 
	mNL80211_RATE_INFO_SHORT_GI
,

3369 
	mNL80211_RATE_INFO_BITRATE32
,

3370 
	mNL80211_RATE_INFO_VHT_MCS
,

3371 
	mNL80211_RATE_INFO_VHT_NSS
,

3372 
	mNL80211_RATE_INFO_80_MHZ_WIDTH
,

3373 
	mNL80211_RATE_INFO_80P80_MHZ_WIDTH
,

3374 
	mNL80211_RATE_INFO_160_MHZ_WIDTH
,

3375 
	mNL80211_RATE_INFO_10_MHZ_WIDTH
,

3376 
	mNL80211_RATE_INFO_5_MHZ_WIDTH
,

3377 
	mNL80211_RATE_INFO_HE_MCS
,

3378 
	mNL80211_RATE_INFO_HE_NSS
,

3379 
	mNL80211_RATE_INFO_HE_GI
,

3380 
	mNL80211_RATE_INFO_HE_DCM
,

3381 
	mNL80211_RATE_INFO_HE_RU_ALLOC
,

3384 
	m__NL80211_RATE_INFO_AFTER_LAST
,

3385 
	mNL80211_RATE_INFO_MAX
 = 
__NL80211_RATE_INFO_AFTER_LAST
 - 1

3405 
	eÆ80211_¡a_bss_·¿m
 {

3406 
	m__NL80211_STA_BSS_PARAM_INVALID
,

3407 
	mNL80211_STA_BSS_PARAM_CTS_PROT
,

3408 
	mNL80211_STA_BSS_PARAM_SHORT_PREAMBLE
,

3409 
	mNL80211_STA_BSS_PARAM_SHORT_SLOT_TIME
,

3410 
	mNL80211_STA_BSS_PARAM_DTIM_PERIOD
,

3411 
	mNL80211_STA_BSS_PARAM_BEACON_INTERVAL
,

3414 
	m__NL80211_STA_BSS_PARAM_AFTER_LAST
,

3415 
	mNL80211_STA_BSS_PARAM_MAX
 = 
__NL80211_STA_BSS_PARAM_AFTER_LAST
 - 1

3501 
	eÆ80211_¡a_šfo
 {

3502 
	m__NL80211_STA_INFO_INVALID
,

3503 
	mNL80211_STA_INFO_INACTIVE_TIME
,

3504 
	mNL80211_STA_INFO_RX_BYTES
,

3505 
	mNL80211_STA_INFO_TX_BYTES
,

3506 
	mNL80211_STA_INFO_LLID
,

3507 
	mNL80211_STA_INFO_PLID
,

3508 
	mNL80211_STA_INFO_PLINK_STATE
,

3509 
	mNL80211_STA_INFO_SIGNAL
,

3510 
	mNL80211_STA_INFO_TX_BITRATE
,

3511 
	mNL80211_STA_INFO_RX_PACKETS
,

3512 
	mNL80211_STA_INFO_TX_PACKETS
,

3513 
	mNL80211_STA_INFO_TX_RETRIES
,

3514 
	mNL80211_STA_INFO_TX_FAILED
,

3515 
	mNL80211_STA_INFO_SIGNAL_AVG
,

3516 
	mNL80211_STA_INFO_RX_BITRATE
,

3517 
	mNL80211_STA_INFO_BSS_PARAM
,

3518 
	mNL80211_STA_INFO_CONNECTED_TIME
,

3519 
	mNL80211_STA_INFO_STA_FLAGS
,

3520 
	mNL80211_STA_INFO_BEACON_LOSS
,

3521 
	mNL80211_STA_INFO_T_OFFSET
,

3522 
	mNL80211_STA_INFO_LOCAL_PM
,

3523 
	mNL80211_STA_INFO_PEER_PM
,

3524 
	mNL80211_STA_INFO_NONPEER_PM
,

3525 
	mNL80211_STA_INFO_RX_BYTES64
,

3526 
	mNL80211_STA_INFO_TX_BYTES64
,

3527 
	mNL80211_STA_INFO_CHAIN_SIGNAL
,

3528 
	mNL80211_STA_INFO_CHAIN_SIGNAL_AVG
,

3529 
	mNL80211_STA_INFO_EXPECTED_THROUGHPUT
,

3530 
	mNL80211_STA_INFO_RX_DROP_MISC
,

3531 
	mNL80211_STA_INFO_BEACON_RX
,

3532 
	mNL80211_STA_INFO_BEACON_SIGNAL_AVG
,

3533 
	mNL80211_STA_INFO_TID_STATS
,

3534 
	mNL80211_STA_INFO_RX_DURATION
,

3535 
	mNL80211_STA_INFO_PAD
,

3536 
	mNL80211_STA_INFO_ACK_SIGNAL
,

3537 
	mNL80211_STA_INFO_ACK_SIGNAL_AVG
,

3538 
	mNL80211_STA_INFO_RX_MPDUS
,

3539 
	mNL80211_STA_INFO_FCS_ERROR_COUNT
,

3540 
	mNL80211_STA_INFO_CONNECTED_TO_GATE
,

3541 
	mNL80211_STA_INFO_TX_DURATION
,

3542 
	mNL80211_STA_INFO_AIRTIME_WEIGHT
,

3543 
	mNL80211_STA_INFO_AIRTIME_LINK_METRIC
,

3544 
	mNL80211_STA_INFO_ASSOC_AT_BOOTTIME
,

3545 
	mNL80211_STA_INFO_CONNECTED_TO_AS
,

3548 
	m__NL80211_STA_INFO_AFTER_LAST
,

3549 
	mNL80211_STA_INFO_MAX
 = 
__NL80211_STA_INFO_AFTER_LAST
 - 1

3553 
	#NL80211_STA_INFO_DATA_ACK_SIGNAL_AVG
 
NL80211_STA_INFO_ACK_SIGNAL_AVG


	)

3571 
	eÆ80211_tid_¡©s
 {

3572 
	m__NL80211_TID_STATS_INVALID
,

3573 
	mNL80211_TID_STATS_RX_MSDU
,

3574 
	mNL80211_TID_STATS_TX_MSDU
,

3575 
	mNL80211_TID_STATS_TX_MSDU_RETRIES
,

3576 
	mNL80211_TID_STATS_TX_MSDU_FAILED
,

3577 
	mNL80211_TID_STATS_PAD
,

3578 
	mNL80211_TID_STATS_TXQ_STATS
,

3581 
	mNUM_NL80211_TID_STATS
,

3582 
	mNL80211_TID_STATS_MAX
 = 
NUM_NL80211_TID_STATS
 - 1

3604 
	eÆ80211_txq_¡©s
 {

3605 
	m__NL80211_TXQ_STATS_INVALID
,

3606 
	mNL80211_TXQ_STATS_BACKLOG_BYTES
,

3607 
	mNL80211_TXQ_STATS_BACKLOG_PACKETS
,

3608 
	mNL80211_TXQ_STATS_FLOWS
,

3609 
	mNL80211_TXQ_STATS_DROPS
,

3610 
	mNL80211_TXQ_STATS_ECN_MARKS
,

3611 
	mNL80211_TXQ_STATS_OVERLIMIT
,

3612 
	mNL80211_TXQ_STATS_OVERMEMORY
,

3613 
	mNL80211_TXQ_STATS_COLLISIONS
,

3614 
	mNL80211_TXQ_STATS_TX_BYTES
,

3615 
	mNL80211_TXQ_STATS_TX_PACKETS
,

3616 
	mNL80211_TXQ_STATS_MAX_FLOWS
,

3619 
	mNUM_NL80211_TXQ_STATS
,

3620 
	mNL80211_TXQ_STATS_MAX
 = 
NUM_NL80211_TXQ_STATS
 - 1

3632 
	eÆ80211_m·th_æags
 {

3633 
	mNL80211_MPATH_FLAG_ACTIVE
 = 1<<0,

3634 
	mNL80211_MPATH_FLAG_RESOLVING
 = 1<<1,

3635 
	mNL80211_MPATH_FLAG_SN_VALID
 = 1<<2,

3636 
	mNL80211_MPATH_FLAG_FIXED
 = 1<<3,

3637 
	mNL80211_MPATH_FLAG_RESOLVED
 = 1<<4,

3661 
	eÆ80211_m·th_šfo
 {

3662 
	m__NL80211_MPATH_INFO_INVALID
,

3663 
	mNL80211_MPATH_INFO_FRAME_QLEN
,

3664 
	mNL80211_MPATH_INFO_SN
,

3665 
	mNL80211_MPATH_INFO_METRIC
,

3666 
	mNL80211_MPATH_INFO_EXPTIME
,

3667 
	mNL80211_MPATH_INFO_FLAGS
,

3668 
	mNL80211_MPATH_INFO_DISCOVERY_TIMEOUT
,

3669 
	mNL80211_MPATH_INFO_DISCOVERY_RETRIES
,

3670 
	mNL80211_MPATH_INFO_HOP_COUNT
,

3671 
	mNL80211_MPATH_INFO_PATH_CHANGE
,

3674 
	m__NL80211_MPATH_INFO_AFTER_LAST
,

3675 
	mNL80211_MPATH_INFO_MAX
 = 
__NL80211_MPATH_INFO_AFTER_LAST
 - 1

3700 
	eÆ80211_bªd_iáy³_©Œ
 {

3701 
	m__NL80211_BAND_IFTYPE_ATTR_INVALID
,

3703 
	mNL80211_BAND_IFTYPE_ATTR_IFTYPES
,

3704 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_MAC
,

3705 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_PHY
,

3706 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_MCS_SET
,

3707 
	mNL80211_BAND_IFTYPE_ATTR_HE_CAP_PPE
,

3708 
	mNL80211_BAND_IFTYPE_ATTR_HE_6GHZ_CAPA
,

3709 
	mNL80211_BAND_IFTYPE_ATTR_VENDOR_ELEMS
,

3712 
	m__NL80211_BAND_IFTYPE_ATTR_AFTER_LAST
,

3713 
	mNL80211_BAND_IFTYPE_ATTR_MAX
 = 
__NL80211_BAND_IFTYPE_ATTR_AFTER_LAST
 - 1

3742 
	eÆ80211_bªd_©Œ
 {

3743 
	m__NL80211_BAND_ATTR_INVALID
,

3744 
	mNL80211_BAND_ATTR_FREQS
,

3745 
	mNL80211_BAND_ATTR_RATES
,

3747 
	mNL80211_BAND_ATTR_HT_MCS_SET
,

3748 
	mNL80211_BAND_ATTR_HT_CAPA
,

3749 
	mNL80211_BAND_ATTR_HT_AMPDU_FACTOR
,

3750 
	mNL80211_BAND_ATTR_HT_AMPDU_DENSITY
,

3752 
	mNL80211_BAND_ATTR_VHT_MCS_SET
,

3753 
	mNL80211_BAND_ATTR_VHT_CAPA
,

3754 
	mNL80211_BAND_ATTR_IFTYPE_DATA
,

3756 
	mNL80211_BAND_ATTR_EDMG_CHANNELS
,

3757 
	mNL80211_BAND_ATTR_EDMG_BW_CONFIG
,

3760 
	m__NL80211_BAND_ATTR_AFTER_LAST
,

3761 
	mNL80211_BAND_ATTR_MAX
 = 
__NL80211_BAND_ATTR_AFTER_LAST
 - 1

3764 
	#NL80211_BAND_ATTR_HT_CAPA
 
NL80211_BAND_ATTR_HT_CAPA


	)

3777 
	eÆ80211_wmm_ruË
 {

3778 
	m__NL80211_WMMR_INVALID
,

3779 
	mNL80211_WMMR_CW_MIN
,

3780 
	mNL80211_WMMR_CW_MAX
,

3781 
	mNL80211_WMMR_AIFSN
,

3782 
	mNL80211_WMMR_TXOP
,

3785 
	m__NL80211_WMMR_LAST
,

3786 
	mNL80211_WMMR_MAX
 = 
__NL80211_WMMR_LAST
 - 1

3863 
	eÆ80211_äequ’cy_©Œ
 {

3864 
	m__NL80211_FREQUENCY_ATTR_INVALID
,

3865 
	mNL80211_FREQUENCY_ATTR_FREQ
,

3866 
	mNL80211_FREQUENCY_ATTR_DISABLED
,

3867 
	mNL80211_FREQUENCY_ATTR_NO_IR
,

3868 
	m__NL80211_FREQUENCY_ATTR_NO_IBSS
,

3869 
	mNL80211_FREQUENCY_ATTR_RADAR
,

3870 
	mNL80211_FREQUENCY_ATTR_MAX_TX_POWER
,

3871 
	mNL80211_FREQUENCY_ATTR_DFS_STATE
,

3872 
	mNL80211_FREQUENCY_ATTR_DFS_TIME
,

3873 
	mNL80211_FREQUENCY_ATTR_NO_HT40_MINUS
,

3874 
	mNL80211_FREQUENCY_ATTR_NO_HT40_PLUS
,

3875 
	mNL80211_FREQUENCY_ATTR_NO_80MHZ
,

3876 
	mNL80211_FREQUENCY_ATTR_NO_160MHZ
,

3877 
	mNL80211_FREQUENCY_ATTR_DFS_CAC_TIME
,

3878 
	mNL80211_FREQUENCY_ATTR_INDOOR_ONLY
,

3879 
	mNL80211_FREQUENCY_ATTR_IR_CONCURRENT
,

3880 
	mNL80211_FREQUENCY_ATTR_NO_20MHZ
,

3881 
	mNL80211_FREQUENCY_ATTR_NO_10MHZ
,

3882 
	mNL80211_FREQUENCY_ATTR_WMM
,

3883 
	mNL80211_FREQUENCY_ATTR_NO_HE
,

3884 
	mNL80211_FREQUENCY_ATTR_OFFSET
,

3885 
	mNL80211_FREQUENCY_ATTR_1MHZ
,

3886 
	mNL80211_FREQUENCY_ATTR_2MHZ
,

3887 
	mNL80211_FREQUENCY_ATTR_4MHZ
,

3888 
	mNL80211_FREQUENCY_ATTR_8MHZ
,

3889 
	mNL80211_FREQUENCY_ATTR_16MHZ
,

3892 
	m__NL80211_FREQUENCY_ATTR_AFTER_LAST
,

3893 
	mNL80211_FREQUENCY_ATTR_MAX
 = 
__NL80211_FREQUENCY_ATTR_AFTER_LAST
 - 1

3896 
	#NL80211_FREQUENCY_ATTR_MAX_TX_POWER
 
NL80211_FREQUENCY_ATTR_MAX_TX_POWER


	)

3897 
	#NL80211_FREQUENCY_ATTR_PASSIVE_SCAN
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

3898 
	#NL80211_FREQUENCY_ATTR_NO_IBSS
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

3899 
	#NL80211_FREQUENCY_ATTR_NO_IR
 
NL80211_FREQUENCY_ATTR_NO_IR


	)

3900 
	#NL80211_FREQUENCY_ATTR_GO_CONCURRENT
 \

3901 
NL80211_FREQUENCY_ATTR_IR_CONCURRENT


	)

3913 
	eÆ80211_b™¿‹_©Œ
 {

3914 
	m__NL80211_BITRATE_ATTR_INVALID
,

3915 
	mNL80211_BITRATE_ATTR_RATE
,

3916 
	mNL80211_BITRATE_ATTR_2GHZ_SHORTPREAMBLE
,

3919 
	m__NL80211_BITRATE_ATTR_AFTER_LAST
,

3920 
	mNL80211_BITRATE_ATTR_MAX
 = 
__NL80211_BITRATE_ATTR_AFTER_LAST
 - 1

3939 
	eÆ80211_»g_š™ŸtÜ
 {

3940 
	mNL80211_REGDOM_SET_BY_CORE
,

3941 
	mNL80211_REGDOM_SET_BY_USER
,

3942 
	mNL80211_REGDOM_SET_BY_DRIVER
,

3943 
	mNL80211_REGDOM_SET_BY_COUNTRY_IE
,

3962 
	eÆ80211_»g_ty³
 {

3963 
	mNL80211_REGDOM_TYPE_COUNTRY
,

3964 
	mNL80211_REGDOM_TYPE_WORLD
,

3965 
	mNL80211_REGDOM_TYPE_CUSTOM_WORLD
,

3966 
	mNL80211_REGDOM_TYPE_INTERSECTION
,

3994 
	eÆ80211_»g_ruË_©Œ
 {

3995 
	m__NL80211_REG_RULE_ATTR_INVALID
,

3996 
	mNL80211_ATTR_REG_RULE_FLAGS
,

3998 
	mNL80211_ATTR_FREQ_RANGE_START
,

3999 
	mNL80211_ATTR_FREQ_RANGE_END
,

4000 
	mNL80211_ATTR_FREQ_RANGE_MAX_BW
,

4002 
	mNL80211_ATTR_POWER_RULE_MAX_ANT_GAIN
,

4003 
	mNL80211_ATTR_POWER_RULE_MAX_EIRP
,

4005 
	mNL80211_ATTR_DFS_CAC_TIME
,

4008 
	m__NL80211_REG_RULE_ATTR_AFTER_LAST
,

4009 
	mNL80211_REG_RULE_ATTR_MAX
 = 
__NL80211_REG_RULE_ATTR_AFTER_LAST
 - 1

4047 
	eÆ80211_sched_sÿn_m©ch_©Œ
 {

4048 
	m__NL80211_SCHED_SCAN_MATCH_ATTR_INVALID
,

4050 
	mNL80211_SCHED_SCAN_MATCH_ATTR_SSID
,

4051 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RSSI
,

4052 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RELATIVE_RSSI
,

4053 
	mNL80211_SCHED_SCAN_MATCH_ATTR_RSSI_ADJUST
,

4054 
	mNL80211_SCHED_SCAN_MATCH_ATTR_BSSID
,

4055 
	mNL80211_SCHED_SCAN_MATCH_PER_BAND_RSSI
,

4058 
	m__NL80211_SCHED_SCAN_MATCH_ATTR_AFTER_LAST
,

4059 
	mNL80211_SCHED_SCAN_MATCH_ATTR_MAX
 =

4060 
__NL80211_SCHED_SCAN_MATCH_ATTR_AFTER_LAST
 - 1

4064 
	#NL80211_ATTR_SCHED_SCAN_MATCH_SSID
 
NL80211_SCHED_SCAN_MATCH_ATTR_SSID


	)

4089 
	eÆ80211_»g_ruË_æags
 {

4090 
	mNL80211_RRF_NO_OFDM
 = 1<<0,

4091 
	mNL80211_RRF_NO_CCK
 = 1<<1,

4092 
	mNL80211_RRF_NO_INDOOR
 = 1<<2,

4093 
	mNL80211_RRF_NO_OUTDOOR
 = 1<<3,

4094 
	mNL80211_RRF_DFS
 = 1<<4,

4095 
	mNL80211_RRF_PTP_ONLY
 = 1<<5,

4096 
	mNL80211_RRF_PTMP_ONLY
 = 1<<6,

4097 
	mNL80211_RRF_NO_IR
 = 1<<7,

4098 
	m__NL80211_RRF_NO_IBSS
 = 1<<8,

4099 
	mNL80211_RRF_AUTO_BW
 = 1<<11,

4100 
	mNL80211_RRF_IR_CONCURRENT
 = 1<<12,

4101 
	mNL80211_RRF_NO_HT40MINUS
 = 1<<13,

4102 
	mNL80211_RRF_NO_HT40PLUS
 = 1<<14,

4103 
	mNL80211_RRF_NO_80MHZ
 = 1<<15,

4104 
	mNL80211_RRF_NO_160MHZ
 = 1<<16,

4105 
	mNL80211_RRF_NO_HE
 = 1<<17,

4108 
	#NL80211_RRF_PASSIVE_SCAN
 
NL80211_RRF_NO_IR


	)

4109 
	#NL80211_RRF_NO_IBSS
 
NL80211_RRF_NO_IR


	)

4110 
	#NL80211_RRF_NO_IR
 
NL80211_RRF_NO_IR


	)

4111 
	#NL80211_RRF_NO_HT40
 (
NL80211_RRF_NO_HT40MINUS
 |\

4112 
NL80211_RRF_NO_HT40PLUS
)

	)

4113 
	#NL80211_RRF_GO_CONCURRENT
 
NL80211_RRF_IR_CONCURRENT


	)

4116 
	#NL80211_RRF_NO_IR_ALL
 (
NL80211_RRF_NO_IR
 | 
__NL80211_RRF_NO_IBSS
)

	)

4126 
	eÆ80211_dfs_»giÚs
 {

4127 
	mNL80211_DFS_UNSET
 = 0,

4128 
	mNL80211_DFS_FCC
 = 1,

4129 
	mNL80211_DFS_ETSI
 = 2,

4130 
	mNL80211_DFS_JP
 = 3,

4150 
	eÆ80211_u£r_»g_hšt_ty³
 {

4151 
	mNL80211_USER_REG_HINT_USER
 = 0,

4152 
	mNL80211_USER_REG_HINT_CELL_BASE
 = 1,

4153 
	mNL80211_USER_REG_HINT_INDOOR
 = 2,

4186 
	eÆ80211_survey_šfo
 {

4187 
	m__NL80211_SURVEY_INFO_INVALID
,

4188 
	mNL80211_SURVEY_INFO_FREQUENCY
,

4189 
	mNL80211_SURVEY_INFO_NOISE
,

4190 
	mNL80211_SURVEY_INFO_IN_USE
,

4191 
	mNL80211_SURVEY_INFO_TIME
,

4192 
	mNL80211_SURVEY_INFO_TIME_BUSY
,

4193 
	mNL80211_SURVEY_INFO_TIME_EXT_BUSY
,

4194 
	mNL80211_SURVEY_INFO_TIME_RX
,

4195 
	mNL80211_SURVEY_INFO_TIME_TX
,

4196 
	mNL80211_SURVEY_INFO_TIME_SCAN
,

4197 
	mNL80211_SURVEY_INFO_PAD
,

4198 
	mNL80211_SURVEY_INFO_TIME_BSS_RX
,

4199 
	mNL80211_SURVEY_INFO_FREQUENCY_OFFSET
,

4202 
	m__NL80211_SURVEY_INFO_AFTER_LAST
,

4203 
	mNL80211_SURVEY_INFO_MAX
 = 
__NL80211_SURVEY_INFO_AFTER_LAST
 - 1

4207 
	#NL80211_SURVEY_INFO_CHANNEL_TIME
 
NL80211_SURVEY_INFO_TIME


	)

4208 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_BUSY
 
NL80211_SURVEY_INFO_TIME_BUSY


	)

4209 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_EXT_BUSY
 
NL80211_SURVEY_INFO_TIME_EXT_BUSY


	)

4210 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_RX
 
NL80211_SURVEY_INFO_TIME_RX


	)

4211 
	#NL80211_SURVEY_INFO_CHANNEL_TIME_TX
 
NL80211_SURVEY_INFO_TIME_TX


	)

4232 
	eÆ80211_mÁr_æags
 {

4233 
	m__NL80211_MNTR_FLAG_INVALID
,

4234 
	mNL80211_MNTR_FLAG_FCSFAIL
,

4235 
	mNL80211_MNTR_FLAG_PLCPFAIL
,

4236 
	mNL80211_MNTR_FLAG_CONTROL
,

4237 
	mNL80211_MNTR_FLAG_OTHER_BSS
,

4238 
	mNL80211_MNTR_FLAG_COOK_FRAMES
,

4239 
	mNL80211_MNTR_FLAG_ACTIVE
,

4242 
	m__NL80211_MNTR_FLAG_AFTER_LAST
,

4243 
	mNL80211_MNTR_FLAG_MAX
 = 
__NL80211_MNTR_FLAG_AFTER_LAST
 - 1

4264 
	eÆ80211_mesh_pow”_mode
 {

4265 
	mNL80211_MESH_POWER_UNKNOWN
,

4266 
	mNL80211_MESH_POWER_ACTIVE
,

4267 
	mNL80211_MESH_POWER_LIGHT_SLEEP
,

4268 
	mNL80211_MESH_POWER_DEEP_SLEEP
,

4270 
	m__NL80211_MESH_POWER_AFTER_LAST
,

4271 
	mNL80211_MESH_POWER_MAX
 = 
__NL80211_MESH_POWER_AFTER_LAST
 - 1

4397 
	eÆ80211_meshcÚf_·¿ms
 {

4398 
	m__NL80211_MESHCONF_INVALID
,

4399 
	mNL80211_MESHCONF_RETRY_TIMEOUT
,

4400 
	mNL80211_MESHCONF_CONFIRM_TIMEOUT
,

4401 
	mNL80211_MESHCONF_HOLDING_TIMEOUT
,

4402 
	mNL80211_MESHCONF_MAX_PEER_LINKS
,

4403 
	mNL80211_MESHCONF_MAX_RETRIES
,

4404 
	mNL80211_MESHCONF_TTL
,

4405 
	mNL80211_MESHCONF_AUTO_OPEN_PLINKS
,

4406 
	mNL80211_MESHCONF_HWMP_MAX_PREQ_RETRIES
,

4407 
	mNL80211_MESHCONF_PATH_REFRESH_TIME
,

4408 
	mNL80211_MESHCONF_MIN_DISCOVERY_TIMEOUT
,

4409 
	mNL80211_MESHCONF_HWMP_ACTIVE_PATH_TIMEOUT
,

4410 
	mNL80211_MESHCONF_HWMP_PREQ_MIN_INTERVAL
,

4411 
	mNL80211_MESHCONF_HWMP_NET_DIAM_TRVS_TIME
,

4412 
	mNL80211_MESHCONF_HWMP_ROOTMODE
,

4413 
	mNL80211_MESHCONF_ELEMENT_TTL
,

4414 
	mNL80211_MESHCONF_HWMP_RANN_INTERVAL
,

4415 
	mNL80211_MESHCONF_GATE_ANNOUNCEMENTS
,

4416 
	mNL80211_MESHCONF_HWMP_PERR_MIN_INTERVAL
,

4417 
	mNL80211_MESHCONF_FORWARDING
,

4418 
	mNL80211_MESHCONF_RSSI_THRESHOLD
,

4419 
	mNL80211_MESHCONF_SYNC_OFFSET_MAX_NEIGHBOR
,

4420 
	mNL80211_MESHCONF_HT_OPMODE
,

4421 
	mNL80211_MESHCONF_HWMP_PATH_TO_ROOT_TIMEOUT
,

4422 
	mNL80211_MESHCONF_HWMP_ROOT_INTERVAL
,

4423 
	mNL80211_MESHCONF_HWMP_CONFIRMATION_INTERVAL
,

4424 
	mNL80211_MESHCONF_POWER_MODE
,

4425 
	mNL80211_MESHCONF_AWAKE_WINDOW
,

4426 
	mNL80211_MESHCONF_PLINK_TIMEOUT
,

4427 
	mNL80211_MESHCONF_CONNECTED_TO_GATE
,

4428 
	mNL80211_MESHCONF_NOLEARN
,

4429 
	mNL80211_MESHCONF_CONNECTED_TO_AS
,

4432 
	m__NL80211_MESHCONF_ATTR_AFTER_LAST
,

4433 
	mNL80211_MESHCONF_ATTR_MAX
 = 
__NL80211_MESHCONF_ATTR_AFTER_LAST
 - 1

4485 
	eÆ80211_mesh_£tup_·¿ms
 {

4486 
	m__NL80211_MESH_SETUP_INVALID
,

4487 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_PATH_SEL
,

4488 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_METRIC
,

4489 
	mNL80211_MESH_SETUP_IE
,

4490 
	mNL80211_MESH_SETUP_USERSPACE_AUTH
,

4491 
	mNL80211_MESH_SETUP_USERSPACE_AMPE
,

4492 
	mNL80211_MESH_SETUP_ENABLE_VENDOR_SYNC
,

4493 
	mNL80211_MESH_SETUP_USERSPACE_MPM
,

4494 
	mNL80211_MESH_SETUP_AUTH_PROTOCOL
,

4497 
	m__NL80211_MESH_SETUP_ATTR_AFTER_LAST
,

4498 
	mNL80211_MESH_SETUP_ATTR_MAX
 = 
__NL80211_MESH_SETUP_ATTR_AFTER_LAST
 - 1

4515 
	eÆ80211_txq_©Œ
 {

4516 
	m__NL80211_TXQ_ATTR_INVALID
,

4517 
	mNL80211_TXQ_ATTR_AC
,

4518 
	mNL80211_TXQ_ATTR_TXOP
,

4519 
	mNL80211_TXQ_ATTR_CWMIN
,

4520 
	mNL80211_TXQ_ATTR_CWMAX
,

4521 
	mNL80211_TXQ_ATTR_AIFS
,

4524 
	m__NL80211_TXQ_ATTR_AFTER_LAST
,

4525 
	mNL80211_TXQ_ATTR_MAX
 = 
__NL80211_TXQ_ATTR_AFTER_LAST
 - 1

4528 
	eÆ80211_ac
 {

4529 
	mNL80211_AC_VO
,

4530 
	mNL80211_AC_VI
,

4531 
	mNL80211_AC_BE
,

4532 
	mNL80211_AC_BK
,

4533 
	mNL80211_NUM_ACS


4537 
	#NL80211_TXQ_ATTR_QUEUE
 
NL80211_TXQ_ATTR_AC


	)

4538 
	#NL80211_TXQ_Q_VO
 
NL80211_AC_VO


	)

4539 
	#NL80211_TXQ_Q_VI
 
NL80211_AC_VI


	)

4540 
	#NL80211_TXQ_Q_BE
 
NL80211_AC_BE


	)

4541 
	#NL80211_TXQ_Q_BK
 
NL80211_AC_BK


	)

4552 
	eÆ80211_chªÃl_ty³
 {

4553 
	mNL80211_CHAN_NO_HT
,

4554 
	mNL80211_CHAN_HT20
,

4555 
	mNL80211_CHAN_HT40MINUS
,

4556 
	mNL80211_CHAN_HT40PLUS


4574 
	eÆ80211_key_mode
 {

4575 
	mNL80211_KEY_RX_TX
,

4576 
	mNL80211_KEY_NO_TX
,

4577 
	mNL80211_KEY_SET_TX


4604 
	eÆ80211_chª_width
 {

4605 
	mNL80211_CHAN_WIDTH_20_NOHT
,

4606 
	mNL80211_CHAN_WIDTH_20
,

4607 
	mNL80211_CHAN_WIDTH_40
,

4608 
	mNL80211_CHAN_WIDTH_80
,

4609 
	mNL80211_CHAN_WIDTH_80P80
,

4610 
	mNL80211_CHAN_WIDTH_160
,

4611 
	mNL80211_CHAN_WIDTH_5
,

4612 
	mNL80211_CHAN_WIDTH_10
,

4613 
	mNL80211_CHAN_WIDTH_1
,

4614 
	mNL80211_CHAN_WIDTH_2
,

4615 
	mNL80211_CHAN_WIDTH_4
,

4616 
	mNL80211_CHAN_WIDTH_8
,

4617 
	mNL80211_CHAN_WIDTH_16
,

4631 
	eÆ80211_bss_sÿn_width
 {

4632 
	mNL80211_BSS_CHAN_WIDTH_20
,

4633 
	mNL80211_BSS_CHAN_WIDTH_10
,

4634 
	mNL80211_BSS_CHAN_WIDTH_5
,

4635 
	mNL80211_BSS_CHAN_WIDTH_1
,

4636 
	mNL80211_BSS_CHAN_WIDTH_2
,

4692 
	eÆ80211_bss
 {

4693 
	m__NL80211_BSS_INVALID
,

4694 
	mNL80211_BSS_BSSID
,

4695 
	mNL80211_BSS_FREQUENCY
,

4696 
	mNL80211_BSS_TSF
,

4697 
	mNL80211_BSS_BEACON_INTERVAL
,

4698 
	mNL80211_BSS_CAPABILITY
,

4699 
	mNL80211_BSS_INFORMATION_ELEMENTS
,

4700 
	mNL80211_BSS_SIGNAL_MBM
,

4701 
	mNL80211_BSS_SIGNAL_UNSPEC
,

4702 
	mNL80211_BSS_STATUS
,

4703 
	mNL80211_BSS_SEEN_MS_AGO
,

4704 
	mNL80211_BSS_BEACON_IES
,

4705 
	mNL80211_BSS_CHAN_WIDTH
,

4706 
	mNL80211_BSS_BEACON_TSF
,

4707 
	mNL80211_BSS_PRESP_DATA
,

4708 
	mNL80211_BSS_LAST_SEEN_BOOTTIME
,

4709 
	mNL80211_BSS_PAD
,

4710 
	mNL80211_BSS_PARENT_TSF
,

4711 
	mNL80211_BSS_PARENT_BSSID
,

4712 
	mNL80211_BSS_CHAIN_SIGNAL
,

4713 
	mNL80211_BSS_FREQUENCY_OFFSET
,

4716 
	m__NL80211_BSS_AFTER_LAST
,

4717 
	mNL80211_BSS_MAX
 = 
__NL80211_BSS_AFTER_LAST
 - 1

4732 
	eÆ80211_bss_¡©us
 {

4733 
	mNL80211_BSS_STATUS_AUTHENTICATED
,

4734 
	mNL80211_BSS_STATUS_ASSOCIATED
,

4735 
	mNL80211_BSS_STATUS_IBSS_JOINED
,

4755 
	eÆ80211_auth_ty³
 {

4756 
	mNL80211_AUTHTYPE_OPEN_SYSTEM
,

4757 
	mNL80211_AUTHTYPE_SHARED_KEY
,

4758 
	mNL80211_AUTHTYPE_FT
,

4759 
	mNL80211_AUTHTYPE_NETWORK_EAP
,

4760 
	mNL80211_AUTHTYPE_SAE
,

4761 
	mNL80211_AUTHTYPE_FILS_SK
,

4762 
	mNL80211_AUTHTYPE_FILS_SK_PFS
,

4763 
	mNL80211_AUTHTYPE_FILS_PK
,

4766 
	m__NL80211_AUTHTYPE_NUM
,

4767 
	mNL80211_AUTHTYPE_MAX
 = 
__NL80211_AUTHTYPE_NUM
 - 1,

4768 
	mNL80211_AUTHTYPE_AUTOMATIC


4778 
	eÆ80211_key_ty³
 {

4779 
	mNL80211_KEYTYPE_GROUP
,

4780 
	mNL80211_KEYTYPE_PAIRWISE
,

4781 
	mNL80211_KEYTYPE_PEERKEY
,

4783 
	mNUM_NL80211_KEYTYPES


4792 
	eÆ80211_må
 {

4793 
	mNL80211_MFP_NO
,

4794 
	mNL80211_MFP_REQUIRED
,

4795 
	mNL80211_MFP_OPTIONAL
,

4798 
	eÆ80211_w·_v”siÚs
 {

4799 
	mNL80211_WPA_VERSION_1
 = 1 << 0,

4800 
	mNL80211_WPA_VERSION_2
 = 1 << 1,

4801 
	mNL80211_WPA_VERSION_3
 = 1 << 2,

4813 
	eÆ80211_key_deçuÉ_ty³s
 {

4814 
	m__NL80211_KEY_DEFAULT_TYPE_INVALID
,

4815 
	mNL80211_KEY_DEFAULT_TYPE_UNICAST
,

4816 
	mNL80211_KEY_DEFAULT_TYPE_MULTICAST
,

4818 
	mNUM_NL80211_KEY_DEFAULT_TYPES


4847 
	eÆ80211_key_©Œibu‹s
 {

4848 
	m__NL80211_KEY_INVALID
,

4849 
	mNL80211_KEY_DATA
,

4850 
	mNL80211_KEY_IDX
,

4851 
	mNL80211_KEY_CIPHER
,

4852 
	mNL80211_KEY_SEQ
,

4853 
	mNL80211_KEY_DEFAULT
,

4854 
	mNL80211_KEY_DEFAULT_MGMT
,

4855 
	mNL80211_KEY_TYPE
,

4856 
	mNL80211_KEY_DEFAULT_TYPES
,

4857 
	mNL80211_KEY_MODE
,

4858 
	mNL80211_KEY_DEFAULT_BEACON
,

4861 
	m__NL80211_KEY_AFTER_LAST
,

4862 
	mNL80211_KEY_MAX
 = 
__NL80211_KEY_AFTER_LAST
 - 1

4884 
	eÆ80211_tx_¿‹_©Œibu‹s
 {

4885 
	m__NL80211_TXRATE_INVALID
,

4886 
	mNL80211_TXRATE_LEGACY
,

4887 
	mNL80211_TXRATE_HT
,

4888 
	mNL80211_TXRATE_VHT
,

4889 
	mNL80211_TXRATE_GI
,

4890 
	mNL80211_TXRATE_HE
,

4891 
	mNL80211_TXRATE_HE_GI
,

4892 
	mNL80211_TXRATE_HE_LTF
,

4895 
	m__NL80211_TXRATE_AFTER_LAST
,

4896 
	mNL80211_TXRATE_MAX
 = 
__NL80211_TXRATE_AFTER_LAST
 - 1

4899 
	#NL80211_TXRATE_MCS
 
NL80211_TXRATE_HT


	)

4900 
	#NL80211_VHT_NSS_MAX
 8

	)

4906 
	sÆ80211_tx¿‹_vht
 {

4907 
__u16
 
	mmcs
[
NL80211_VHT_NSS_MAX
];

4910 
	#NL80211_HE_NSS_MAX
 8

	)

4915 
	sÆ80211_tx¿‹_he
 {

4916 
__u16
 
	mmcs
[
NL80211_HE_NSS_MAX
];

4919 
	eÆ80211_tx¿‹_gi
 {

4920 
	mNL80211_TXRATE_DEFAULT_GI
,

4921 
	mNL80211_TXRATE_FORCE_SGI
,

4922 
	mNL80211_TXRATE_FORCE_LGI
,

4935 
	eÆ80211_bªd
 {

4936 
	mNL80211_BAND_2GHZ
,

4937 
	mNL80211_BAND_5GHZ
,

4938 
	mNL80211_BAND_60GHZ
,

4939 
	mNL80211_BAND_6GHZ
,

4940 
	mNL80211_BAND_S1GHZ
,

4942 
	mNUM_NL80211_BANDS
,

4950 
	eÆ80211_ps_¡©e
 {

4951 
	mNL80211_PS_DISABLED
,

4952 
	mNL80211_PS_ENABLED
,

4988 
	eÆ80211_©Œ_cqm
 {

4989 
	m__NL80211_ATTR_CQM_INVALID
,

4990 
	mNL80211_ATTR_CQM_RSSI_THOLD
,

4991 
	mNL80211_ATTR_CQM_RSSI_HYST
,

4992 
	mNL80211_ATTR_CQM_RSSI_THRESHOLD_EVENT
,

4993 
	mNL80211_ATTR_CQM_PKT_LOSS_EVENT
,

4994 
	mNL80211_ATTR_CQM_TXE_RATE
,

4995 
	mNL80211_ATTR_CQM_TXE_PKTS
,

4996 
	mNL80211_ATTR_CQM_TXE_INTVL
,

4997 
	mNL80211_ATTR_CQM_BEACON_LOSS_EVENT
,

4998 
	mNL80211_ATTR_CQM_RSSI_LEVEL
,

5001 
	m__NL80211_ATTR_CQM_AFTER_LAST
,

5002 
	mNL80211_ATTR_CQM_MAX
 = 
__NL80211_ATTR_CQM_AFTER_LAST
 - 1

5013 
	eÆ80211_cqm_rssi_th»shŞd_ev’t
 {

5014 
	mNL80211_CQM_RSSI_THRESHOLD_EVENT_LOW
,

5015 
	mNL80211_CQM_RSSI_THRESHOLD_EVENT_HIGH
,

5016 
	mNL80211_CQM_RSSI_BEACON_LOSS_EVENT
,

5026 
	eÆ80211_tx_pow”_£‰šg
 {

5027 
	mNL80211_TX_POWER_AUTOMATIC
,

5028 
	mNL80211_TX_POWER_LIMITED
,

5029 
	mNL80211_TX_POWER_FIXED
,

5037 
	eÆ80211_tid_cÚfig
 {

5038 
	mNL80211_TID_CONFIG_ENABLE
,

5039 
	mNL80211_TID_CONFIG_DISABLE
,

5047 
	eÆ80211_tx_¿‹_£‰šg
 {

5048 
	mNL80211_TX_RATE_AUTOMATIC
,

5049 
	mNL80211_TX_RATE_LIMITED
,

5050 
	mNL80211_TX_RATE_FIXED
,

5097 
	eÆ80211_tid_cÚfig_©Œ
 {

5098 
	m__NL80211_TID_CONFIG_ATTR_INVALID
,

5099 
	mNL80211_TID_CONFIG_ATTR_PAD
,

5100 
	mNL80211_TID_CONFIG_ATTR_VIF_SUPP
,

5101 
	mNL80211_TID_CONFIG_ATTR_PEER_SUPP
,

5102 
	mNL80211_TID_CONFIG_ATTR_OVERRIDE
,

5103 
	mNL80211_TID_CONFIG_ATTR_TIDS
,

5104 
	mNL80211_TID_CONFIG_ATTR_NOACK
,

5105 
	mNL80211_TID_CONFIG_ATTR_RETRY_SHORT
,

5106 
	mNL80211_TID_CONFIG_ATTR_RETRY_LONG
,

5107 
	mNL80211_TID_CONFIG_ATTR_AMPDU_CTRL
,

5108 
	mNL80211_TID_CONFIG_ATTR_RTSCTS_CTRL
,

5109 
	mNL80211_TID_CONFIG_ATTR_AMSDU_CTRL
,

5110 
	mNL80211_TID_CONFIG_ATTR_TX_RATE_TYPE
,

5111 
	mNL80211_TID_CONFIG_ATTR_TX_RATE
,

5114 
	m__NL80211_TID_CONFIG_ATTR_AFTER_LAST
,

5115 
	mNL80211_TID_CONFIG_ATTR_MAX
 = 
__NL80211_TID_CONFIG_ATTR_AFTER_LAST
 - 1

5139 
	eÆ80211_·ck‘_·‰”n_©Œ
 {

5140 
	m__NL80211_PKTPAT_INVALID
,

5141 
	mNL80211_PKTPAT_MASK
,

5142 
	mNL80211_PKTPAT_PATTERN
,

5143 
	mNL80211_PKTPAT_OFFSET
,

5145 
	mNUM_NL80211_PKTPAT
,

5146 
	mMAX_NL80211_PKTPAT
 = 
NUM_NL80211_PKTPAT
 - 1,

5162 
	sÆ80211_·‰”n_suµÜt
 {

5163 
__u32
 
	mmax_·‰”ns
;

5164 
__u32
 
	mmš_·‰”n_Ën
;

5165 
__u32
 
	mmax_·‰”n_Ën
;

5166 
__u32
 
	mmax_pkt_off£t
;

5167 } 
__©Œibu‹__
((
·cked
));

5170 
	#__NL80211_WOWLAN_PKTPAT_INVALID
 
__NL80211_PKTPAT_INVALID


	)

5171 
	#NL80211_WOWLAN_PKTPAT_MASK
 
NL80211_PKTPAT_MASK


	)

5172 
	#NL80211_WOWLAN_PKTPAT_PATTERN
 
NL80211_PKTPAT_PATTERN


	)

5173 
	#NL80211_WOWLAN_PKTPAT_OFFSET
 
NL80211_PKTPAT_OFFSET


	)

5174 
	#NUM_NL80211_WOWLAN_PKTPAT
 
NUM_NL80211_PKTPAT


	)

5175 
	#MAX_NL80211_WOWLAN_PKTPAT
 
MAX_NL80211_PKTPAT


	)

5176 
	#Æ80211_wowÏn_·‰”n_suµÜt
 
Æ80211_·‰”n_suµÜt


	)

5267 
	eÆ80211_wowÏn_Œigg”s
 {

5268 
	m__NL80211_WOWLAN_TRIG_INVALID
,

5269 
	mNL80211_WOWLAN_TRIG_ANY
,

5270 
	mNL80211_WOWLAN_TRIG_DISCONNECT
,

5271 
	mNL80211_WOWLAN_TRIG_MAGIC_PKT
,

5272 
	mNL80211_WOWLAN_TRIG_PKT_PATTERN
,

5273 
	mNL80211_WOWLAN_TRIG_GTK_REKEY_SUPPORTED
,

5274 
	mNL80211_WOWLAN_TRIG_GTK_REKEY_FAILURE
,

5275 
	mNL80211_WOWLAN_TRIG_EAP_IDENT_REQUEST
,

5276 
	mNL80211_WOWLAN_TRIG_4WAY_HANDSHAKE
,

5277 
	mNL80211_WOWLAN_TRIG_RFKILL_RELEASE
,

5278 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_80211
,

5279 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_80211_LEN
,

5280 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_8023
,

5281 
	mNL80211_WOWLAN_TRIG_WAKEUP_PKT_8023_LEN
,

5282 
	mNL80211_WOWLAN_TRIG_TCP_CONNECTION
,

5283 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_MATCH
,

5284 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_CONNLOST
,

5285 
	mNL80211_WOWLAN_TRIG_WAKEUP_TCP_NOMORETOKENS
,

5286 
	mNL80211_WOWLAN_TRIG_NET_DETECT
,

5287 
	mNL80211_WOWLAN_TRIG_NET_DETECT_RESULTS
,

5290 
	mNUM_NL80211_WOWLAN_TRIG
,

5291 
	mMAX_NL80211_WOWLAN_TRIG
 = 
NUM_NL80211_WOWLAN_TRIG
 - 1

5327 
	sÆ80211_wowÏn_tı_d©a_£q
 {

5328 
__u32
 
	m¡¬t
, 
	moff£t
, 
	mËn
;

5338 
	sÆ80211_wowÏn_tı_d©a_tok’
 {

5339 
__u32
 
	moff£t
, 
	mËn
;

5340 
__u8
 
	mtok’_¡»am
[];

5349 
	sÆ80211_wowÏn_tı_d©a_tok’_ã©u»
 {

5350 
__u32
 
	mmš_Ën
, 
	mmax_Ën
, 
	mbufsize
;

5385 
	eÆ80211_wowÏn_tı_©Œs
 {

5386 
	m__NL80211_WOWLAN_TCP_INVALID
,

5387 
	mNL80211_WOWLAN_TCP_SRC_IPV4
,

5388 
	mNL80211_WOWLAN_TCP_DST_IPV4
,

5389 
	mNL80211_WOWLAN_TCP_DST_MAC
,

5390 
	mNL80211_WOWLAN_TCP_SRC_PORT
,

5391 
	mNL80211_WOWLAN_TCP_DST_PORT
,

5392 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD
,

5393 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD_SEQ
,

5394 
	mNL80211_WOWLAN_TCP_DATA_PAYLOAD_TOKEN
,

5395 
	mNL80211_WOWLAN_TCP_DATA_INTERVAL
,

5396 
	mNL80211_WOWLAN_TCP_WAKE_PAYLOAD
,

5397 
	mNL80211_WOWLAN_TCP_WAKE_MASK
,

5400 
	mNUM_NL80211_WOWLAN_TCP
,

5401 
	mMAX_NL80211_WOWLAN_TCP
 = 
NUM_NL80211_WOWLAN_TCP
 - 1

5413 
	sÆ80211_cßËsû_ruË_suµÜt
 {

5414 
__u32
 
	mmax_ruËs
;

5415 
Æ80211_·‰”n_suµÜt
 
	m·t
;

5416 
__u32
 
	mmax_d–ay
;

5417 } 
__©Œibu‹__
((
·cked
));

5430 
	eÆ80211_©Œ_cßËsû_ruË
 {

5431 
	m__NL80211_COALESCE_RULE_INVALID
,

5432 
	mNL80211_ATTR_COALESCE_RULE_DELAY
,

5433 
	mNL80211_ATTR_COALESCE_RULE_CONDITION
,

5434 
	mNL80211_ATTR_COALESCE_RULE_PKT_PATTERN
,

5437 
	mNUM_NL80211_ATTR_COALESCE_RULE
,

5438 
	mNL80211_ATTR_COALESCE_RULE_MAX
 = 
NUM_NL80211_ATTR_COALESCE_RULE
 - 1

5448 
	eÆ80211_cßËsû_cÚd™iÚ
 {

5449 
	mNL80211_COALESCE_CONDITION_MATCH
,

5450 
	mNL80211_COALESCE_CONDITION_NO_MATCH


5463 
	eÆ80211_içû_lim™_©Œs
 {

5464 
	mNL80211_IFACE_LIMIT_UNSPEC
,

5465 
	mNL80211_IFACE_LIMIT_MAX
,

5466 
	mNL80211_IFACE_LIMIT_TYPES
,

5469 
	mNUM_NL80211_IFACE_LIMIT
,

5470 
	mMAX_NL80211_IFACE_LIMIT
 = 
NUM_NL80211_IFACE_LIMIT
 - 1

5522 
	eÆ80211_if_combš©iÚ_©Œs
 {

5523 
	mNL80211_IFACE_COMB_UNSPEC
,

5524 
	mNL80211_IFACE_COMB_LIMITS
,

5525 
	mNL80211_IFACE_COMB_MAXNUM
,

5526 
	mNL80211_IFACE_COMB_STA_AP_BI_MATCH
,

5527 
	mNL80211_IFACE_COMB_NUM_CHANNELS
,

5528 
	mNL80211_IFACE_COMB_RADAR_DETECT_WIDTHS
,

5529 
	mNL80211_IFACE_COMB_RADAR_DETECT_REGIONS
,

5530 
	mNL80211_IFACE_COMB_BI_MIN_GCD
,

5533 
	mNUM_NL80211_IFACE_COMB
,

5534 
	mMAX_NL80211_IFACE_COMB
 = 
NUM_NL80211_IFACE_COMB
 - 1

5556 
	eÆ80211_¶šk_¡©e
 {

5557 
	mNL80211_PLINK_LISTEN
,

5558 
	mNL80211_PLINK_OPN_SNT
,

5559 
	mNL80211_PLINK_OPN_RCVD
,

5560 
	mNL80211_PLINK_CNF_RCVD
,

5561 
	mNL80211_PLINK_ESTAB
,

5562 
	mNL80211_PLINK_HOLDING
,

5563 
	mNL80211_PLINK_BLOCKED
,

5566 
	mNUM_NL80211_PLINK_STATES
,

5567 
	mMAX_NL80211_PLINK_STATES
 = 
NUM_NL80211_PLINK_STATES
 - 1

5578 
	e¶šk_aùiÚs
 {

5579 
	mNL80211_PLINK_ACTION_NO_ACTION
,

5580 
	mNL80211_PLINK_ACTION_OPEN
,

5581 
	mNL80211_PLINK_ACTION_BLOCK
,

5583 
	mNUM_NL80211_PLINK_ACTIONS
,

5587 
	#NL80211_KCK_LEN
 16

	)

5588 
	#NL80211_KEK_LEN
 16

	)

5589 
	#NL80211_KCK_EXT_LEN
 24

	)

5590 
	#NL80211_KEK_EXT_LEN
 32

	)

5591 
	#NL80211_REPLAY_CTR_LEN
 8

	)

5603 
	eÆ80211_»key_d©a
 {

5604 
	m__NL80211_REKEY_DATA_INVALID
,

5605 
	mNL80211_REKEY_DATA_KEK
,

5606 
	mNL80211_REKEY_DATA_KCK
,

5607 
	mNL80211_REKEY_DATA_REPLAY_CTR
,

5608 
	mNL80211_REKEY_DATA_AKM
,

5611 
	mNUM_NL80211_REKEY_DATA
,

5612 
	mMAX_NL80211_REKEY_DATA
 = 
NUM_NL80211_REKEY_DATA
 - 1

5624 
	eÆ80211_hidd’_ssid
 {

5625 
	mNL80211_HIDDEN_SSID_NOT_IN_USE
,

5626 
	mNL80211_HIDDEN_SSID_ZERO_LEN
,

5627 
	mNL80211_HIDDEN_SSID_ZERO_CONTENTS


5640 
	eÆ80211_¡a_wme_©Œ
 {

5641 
	m__NL80211_STA_WME_INVALID
,

5642 
	mNL80211_STA_WME_UAPSD_QUEUES
,

5643 
	mNL80211_STA_WME_MAX_SP
,

5646 
	m__NL80211_STA_WME_AFTER_LAST
,

5647 
	mNL80211_STA_WME_MAX
 = 
__NL80211_STA_WME_AFTER_LAST
 - 1

5662 
	eÆ80211_pmk§_ÿndid©e_©Œ
 {

5663 
	m__NL80211_PMKSA_CANDIDATE_INVALID
,

5664 
	mNL80211_PMKSA_CANDIDATE_INDEX
,

5665 
	mNL80211_PMKSA_CANDIDATE_BSSID
,

5666 
	mNL80211_PMKSA_CANDIDATE_PREAUTH
,

5669 
	mNUM_NL80211_PMKSA_CANDIDATE
,

5670 
	mMAX_NL80211_PMKSA_CANDIDATE
 = 
NUM_NL80211_PMKSA_CANDIDATE
 - 1

5681 
	eÆ80211_tdls_İ”©iÚ
 {

5682 
	mNL80211_TDLS_DISCOVERY_REQ
,

5683 
	mNL80211_TDLS_SETUP
,

5684 
	mNL80211_TDLS_TEARDOWN
,

5685 
	mNL80211_TDLS_ENABLE_LINK
,

5686 
	mNL80211_TDLS_DISABLE_LINK
,

5790 
	eÆ80211_ã©u»_æags
 {

5791 
	mNL80211_FEATURE_SK_TX_STATUS
 = 1 << 0,

5792 
	mNL80211_FEATURE_HT_IBSS
 = 1 << 1,

5793 
	mNL80211_FEATURE_INACTIVITY_TIMER
 = 1 << 2,

5794 
	mNL80211_FEATURE_CELL_BASE_REG_HINTS
 = 1 << 3,

5795 
	mNL80211_FEATURE_P2P_DEVICE_NEEDS_CHANNEL
 = 1 << 4,

5796 
	mNL80211_FEATURE_SAE
 = 1 << 5,

5797 
	mNL80211_FEATURE_LOW_PRIORITY_SCAN
 = 1 << 6,

5798 
	mNL80211_FEATURE_SCAN_FLUSH
 = 1 << 7,

5799 
	mNL80211_FEATURE_AP_SCAN
 = 1 << 8,

5800 
	mNL80211_FEATURE_VIF_TXPOWER
 = 1 << 9,

5801 
	mNL80211_FEATURE_NEED_OBSS_SCAN
 = 1 << 10,

5802 
	mNL80211_FEATURE_P2P_GO_CTWIN
 = 1 << 11,

5803 
	mNL80211_FEATURE_P2P_GO_OPPPS
 = 1 << 12,

5805 
	mNL80211_FEATURE_ADVERTISE_CHAN_LIMITS
 = 1 << 14,

5806 
	mNL80211_FEATURE_FULL_AP_CLIENT_STATE
 = 1 << 15,

5807 
	mNL80211_FEATURE_USERSPACE_MPM
 = 1 << 16,

5808 
	mNL80211_FEATURE_ACTIVE_MONITOR
 = 1 << 17,

5809 
	mNL80211_FEATURE_AP_MODE_CHAN_WIDTH_CHANGE
 = 1 << 18,

5810 
	mNL80211_FEATURE_DS_PARAM_SET_IE_IN_PROBES
 = 1 << 19,

5811 
	mNL80211_FEATURE_WFA_TPC_IE_IN_PROBES
 = 1 << 20,

5812 
	mNL80211_FEATURE_QUIET
 = 1 << 21,

5813 
	mNL80211_FEATURE_TX_POWER_INSERTION
 = 1 << 22,

5814 
	mNL80211_FEATURE_ACKTO_ESTIMATION
 = 1 << 23,

5815 
	mNL80211_FEATURE_STATIC_SMPS
 = 1 << 24,

5816 
	mNL80211_FEATURE_DYNAMIC_SMPS
 = 1 << 25,

5817 
	mNL80211_FEATURE_SUPPORTS_WMM_ADMISSION
 = 1 << 26,

5818 
	mNL80211_FEATURE_MAC_ON_CREATE
 = 1 << 27,

5819 
	mNL80211_FEATURE_TDLS_CHANNEL_SWITCH
 = 1 << 28,

5820 
	mNL80211_FEATURE_SCAN_RANDOM_MAC_ADDR
 = 1 << 29,

5821 
	mNL80211_FEATURE_SCHED_SCAN_RANDOM_MAC_ADDR
 = 1 << 30,

5822 
	mNL80211_FEATURE_ND_RANDOM_MAC_ADDR
 = 1U << 31,

6001 
	eÆ80211_ext_ã©u»_šdex
 {

6002 
	mNL80211_EXT_FEATURE_VHT_IBSS
,

6003 
	mNL80211_EXT_FEATURE_RRM
,

6004 
	mNL80211_EXT_FEATURE_MU_MIMO_AIR_SNIFFER
,

6005 
	mNL80211_EXT_FEATURE_SCAN_START_TIME
,

6006 
	mNL80211_EXT_FEATURE_BSS_PARENT_TSF
,

6007 
	mNL80211_EXT_FEATURE_SET_SCAN_DWELL
,

6008 
	mNL80211_EXT_FEATURE_BEACON_RATE_LEGACY
,

6009 
	mNL80211_EXT_FEATURE_BEACON_RATE_HT
,

6010 
	mNL80211_EXT_FEATURE_BEACON_RATE_VHT
,

6011 
	mNL80211_EXT_FEATURE_FILS_STA
,

6012 
	mNL80211_EXT_FEATURE_MGMT_TX_RANDOM_TA
,

6013 
	mNL80211_EXT_FEATURE_MGMT_TX_RANDOM_TA_CONNECTED
,

6014 
	mNL80211_EXT_FEATURE_SCHED_SCAN_RELATIVE_RSSI
,

6015 
	mNL80211_EXT_FEATURE_CQM_RSSI_LIST
,

6016 
	mNL80211_EXT_FEATURE_FILS_SK_OFFLOAD
,

6017 
	mNL80211_EXT_FEATURE_4WAY_HANDSHAKE_STA_PSK
,

6018 
	mNL80211_EXT_FEATURE_4WAY_HANDSHAKE_STA_1X
,

6019 
	mNL80211_EXT_FEATURE_FILS_MAX_CHANNEL_TIME
,

6020 
	mNL80211_EXT_FEATURE_ACCEPT_BCAST_PROBE_RESP
,

6021 
	mNL80211_EXT_FEATURE_OCE_PROBE_REQ_HIGH_TX_RATE
,

6022 
	mNL80211_EXT_FEATURE_OCE_PROBE_REQ_DEFERRAL_SUPPRESSION
,

6023 
	mNL80211_EXT_FEATURE_MFP_OPTIONAL
,

6024 
	mNL80211_EXT_FEATURE_LOW_SPAN_SCAN
,

6025 
	mNL80211_EXT_FEATURE_LOW_POWER_SCAN
,

6026 
	mNL80211_EXT_FEATURE_HIGH_ACCURACY_SCAN
,

6027 
	mNL80211_EXT_FEATURE_DFS_OFFLOAD
,

6028 
	mNL80211_EXT_FEATURE_CONTROL_PORT_OVER_NL80211
,

6029 
	mNL80211_EXT_FEATURE_ACK_SIGNAL_SUPPORT
,

6031 
	mNL80211_EXT_FEATURE_DATA_ACK_SIGNAL_SUPPORT
 = 
NL80211_EXT_FEATURE_ACK_SIGNAL_SUPPORT
,

6032 
	mNL80211_EXT_FEATURE_TXQS
,

6033 
	mNL80211_EXT_FEATURE_SCAN_RANDOM_SN
,

6034 
	mNL80211_EXT_FEATURE_SCAN_MIN_PREQ_CONTENT
,

6035 
	mNL80211_EXT_FEATURE_CAN_REPLACE_PTK0
,

6036 
	mNL80211_EXT_FEATURE_ENABLE_FTM_RESPONDER
,

6037 
	mNL80211_EXT_FEATURE_AIRTIME_FAIRNESS
,

6038 
	mNL80211_EXT_FEATURE_AP_PMKSA_CACHING
,

6039 
	mNL80211_EXT_FEATURE_SCHED_SCAN_BAND_SPECIFIC_RSSI_THOLD
,

6040 
	mNL80211_EXT_FEATURE_EXT_KEY_ID
,

6041 
	mNL80211_EXT_FEATURE_STA_TX_PWR
,

6042 
	mNL80211_EXT_FEATURE_SAE_OFFLOAD
,

6043 
	mNL80211_EXT_FEATURE_VLAN_OFFLOAD
,

6044 
	mNL80211_EXT_FEATURE_AQL
,

6045 
	mNL80211_EXT_FEATURE_BEACON_PROTECTION
,

6046 
	mNL80211_EXT_FEATURE_CONTROL_PORT_NO_PREAUTH
,

6047 
	mNL80211_EXT_FEATURE_PROTECTED_TWT
,

6048 
	mNL80211_EXT_FEATURE_DEL_IBSS_STA
,

6049 
	mNL80211_EXT_FEATURE_MULTICAST_REGISTRATIONS
,

6050 
	mNL80211_EXT_FEATURE_BEACON_PROTECTION_CLIENT
,

6051 
	mNL80211_EXT_FEATURE_SCAN_FREQ_KHZ
,

6052 
	mNL80211_EXT_FEATURE_CONTROL_PORT_OVER_NL80211_TX_STATUS
,

6053 
	mNL80211_EXT_FEATURE_OPERATING_CHANNEL_VALIDATION
,

6054 
	mNL80211_EXT_FEATURE_4WAY_HANDSHAKE_AP_PSK
,

6055 
	mNL80211_EXT_FEATURE_SAE_OFFLOAD_AP
,

6056 
	mNL80211_EXT_FEATURE_FILS_DISCOVERY
,

6057 
	mNL80211_EXT_FEATURE_UNSOL_BCAST_PROBE_RESP
,

6058 
	mNL80211_EXT_FEATURE_BEACON_RATE_HE
,

6059 
	mNL80211_EXT_FEATURE_SECURE_LTF
,

6060 
	mNL80211_EXT_FEATURE_SECURE_RTT
,

6061 
	mNL80211_EXT_FEATURE_PROT_RANGE_NEGO_AND_MEASURE
,

6062 
	mNL80211_EXT_FEATURE_BSS_COLOR
,

6065 
	mNUM_NL80211_EXT_FEATURES
,

6066 
	mMAX_NL80211_EXT_FEATURES
 = 
NUM_NL80211_EXT_FEATURES
 - 1

6083 
	eÆ80211_´obe_»¥_ofæßd_suµÜt_©Œ
 {

6084 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS
 = 1<<0,

6085 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS2
 = 1<<1,

6086 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_P2P
 = 1<<2,

6087 
	mNL80211_PROBE_RESP_OFFLOAD_SUPPORT_80211U
 = 1<<3,

6096 
	eÆ80211_cÚÃù_çed_»asÚ
 {

6097 
	mNL80211_CONN_FAIL_MAX_CLIENTS
,

6098 
	mNL80211_CONN_FAIL_BLOCKED_CLIENT
,

6109 
	eÆ80211_timeout_»asÚ
 {

6110 
	mNL80211_TIMEOUT_UNSPECIFIED
,

6111 
	mNL80211_TIMEOUT_SCAN
,

6112 
	mNL80211_TIMEOUT_AUTH
,

6113 
	mNL80211_TIMEOUT_ASSOC
,

6180 
	eÆ80211_sÿn_æags
 {

6181 
	mNL80211_SCAN_FLAG_LOW_PRIORITY
 = 1<<0,

6182 
	mNL80211_SCAN_FLAG_FLUSH
 = 1<<1,

6183 
	mNL80211_SCAN_FLAG_AP
 = 1<<2,

6184 
	mNL80211_SCAN_FLAG_RANDOM_ADDR
 = 1<<3,

6185 
	mNL80211_SCAN_FLAG_FILS_MAX_CHANNEL_TIME
 = 1<<4,

6186 
	mNL80211_SCAN_FLAG_ACCEPT_BCAST_PROBE_RESP
 = 1<<5,

6187 
	mNL80211_SCAN_FLAG_OCE_PROBE_REQ_HIGH_TX_RATE
 = 1<<6,

6188 
	mNL80211_SCAN_FLAG_OCE_PROBE_REQ_DEFERRAL_SUPPRESSION
 = 1<<7,

6189 
	mNL80211_SCAN_FLAG_LOW_SPAN
 = 1<<8,

6190 
	mNL80211_SCAN_FLAG_LOW_POWER
 = 1<<9,

6191 
	mNL80211_SCAN_FLAG_HIGH_ACCURACY
 = 1<<10,

6192 
	mNL80211_SCAN_FLAG_RANDOM_SN
 = 1<<11,

6193 
	mNL80211_SCAN_FLAG_MIN_PREQ_CONTENT
 = 1<<12,

6194 
	mNL80211_SCAN_FLAG_FREQ_KHZ
 = 1<<13,

6195 
	mNL80211_SCAN_FLAG_COLOCATED_6GHZ
 = 1<<14,

6211 
	eÆ80211_aş_pŞicy
 {

6212 
	mNL80211_ACL_POLICY_ACCEPT_UNLESS_LISTED
,

6213 
	mNL80211_ACL_POLICY_DENY_UNLESS_LISTED
,

6226 
	eÆ80211_smps_mode
 {

6227 
	mNL80211_SMPS_OFF
,

6228 
	mNL80211_SMPS_STATIC
,

6229 
	mNL80211_SMPS_DYNAMIC
,

6231 
	m__NL80211_SMPS_AFTER_LAST
,

6232 
	mNL80211_SMPS_MAX
 = 
__NL80211_SMPS_AFTER_LAST
 - 1

6256 
	eÆ80211_¿d¬_ev’t
 {

6257 
	mNL80211_RADAR_DETECTED
,

6258 
	mNL80211_RADAR_CAC_FINISHED
,

6259 
	mNL80211_RADAR_CAC_ABORTED
,

6260 
	mNL80211_RADAR_NOP_FINISHED
,

6261 
	mNL80211_RADAR_PRE_CAC_EXPIRED
,

6262 
	mNL80211_RADAR_CAC_STARTED
,

6276 
	eÆ80211_dfs_¡©e
 {

6277 
	mNL80211_DFS_USABLE
,

6278 
	mNL80211_DFS_UNAVAILABLE
,

6279 
	mNL80211_DFS_AVAILABLE
,

6290 
	eÆ80211_´ÙocŞ_ã©u»s
 {

6291 
	mNL80211_PROTOCOL_FEATURE_SPLIT_WIPHY_DUMP
 = 1 << 0,

6303 
	eÆ80211_ü™_´Ùo_id
 {

6304 
	mNL80211_CRIT_PROTO_UNSPEC
,

6305 
	mNL80211_CRIT_PROTO_DHCP
,

6306 
	mNL80211_CRIT_PROTO_EAPOL
,

6307 
	mNL80211_CRIT_PROTO_APIPA
,

6309 
	mNUM_NL80211_CRIT_PROTO


6313 
	#NL80211_CRIT_PROTO_MAX_DURATION
 5000

	)

6326 
	eÆ80211_rxmgmt_æags
 {

6327 
	mNL80211_RXMGMT_FLAG_ANSWERED
 = 1 << 0,

6328 
	mNL80211_RXMGMT_FLAG_EXTERNAL_AUTH
 = 1 << 1,

6336 
	#NL80211_VENDOR_ID_IS_LINUX
 0x80000000

	)

6346 
	sÆ80211_v’dÜ_cmd_šfo
 {

6347 
__u32
 
	mv’dÜ_id
;

6348 
__u32
 
	msubcmd
;

6362 
	eÆ80211_tdls_³”_ÿ·b™y
 {

6363 
	mNL80211_TDLS_PEER_HT
 = 1<<0,

6364 
	mNL80211_TDLS_PEER_VHT
 = 1<<1,

6365 
	mNL80211_TDLS_PEER_WMM
 = 1<<2,

6366 
	mNL80211_TDLS_PEER_HE
 = 1<<3,

6382 
	eÆ80211_sched_sÿn_¶ª
 {

6383 
	m__NL80211_SCHED_SCAN_PLAN_INVALID
,

6384 
	mNL80211_SCHED_SCAN_PLAN_INTERVAL
,

6385 
	mNL80211_SCHED_SCAN_PLAN_ITERATIONS
,

6388 
	m__NL80211_SCHED_SCAN_PLAN_AFTER_LAST
,

6389 
	mNL80211_SCHED_SCAN_PLAN_MAX
 =

6390 
__NL80211_SCHED_SCAN_PLAN_AFTER_LAST
 - 1

6400 
	sÆ80211_bss_£Ëù_rssi_adju¡
 {

6401 
__u8
 
	mbªd
;

6402 
__s8
 
	md–
;

6403 } 
__©Œibu‹__
((
·cked
));

6427 
	eÆ80211_bss_£Ëù_©Œ
 {

6428 
	m__NL80211_BSS_SELECT_ATTR_INVALID
,

6429 
	mNL80211_BSS_SELECT_ATTR_RSSI
,

6430 
	mNL80211_BSS_SELECT_ATTR_BAND_PREF
,

6431 
	mNL80211_BSS_SELECT_ATTR_RSSI_ADJUST
,

6434 
	m__NL80211_BSS_SELECT_ATTR_AFTER_LAST
,

6435 
	mNL80211_BSS_SELECT_ATTR_MAX
 = 
__NL80211_BSS_SELECT_ATTR_AFTER_LAST
 - 1

6447 
	eÆ80211_Çn_funùiÚ_ty³
 {

6448 
	mNL80211_NAN_FUNC_PUBLISH
,

6449 
	mNL80211_NAN_FUNC_SUBSCRIBE
,

6450 
	mNL80211_NAN_FUNC_FOLLOW_UP
,

6453 
	m__NL80211_NAN_FUNC_TYPE_AFTER_LAST
,

6454 
	mNL80211_NAN_FUNC_MAX_TYPE
 = 
__NL80211_NAN_FUNC_TYPE_AFTER_LAST
 - 1,

6465 
	eÆ80211_Çn_publish_ty³
 {

6466 
	mNL80211_NAN_SOLICITED_PUBLISH
 = 1 << 0,

6467 
	mNL80211_NAN_UNSOLICITED_PUBLISH
 = 1 << 1,

6479 
	eÆ80211_Çn_func_‹rm_»asÚ
 {

6480 
	mNL80211_NAN_FUNC_TERM_REASON_USER_REQUEST
,

6481 
	mNL80211_NAN_FUNC_TERM_REASON_TTL_EXPIRED
,

6482 
	mNL80211_NAN_FUNC_TERM_REASON_ERROR
,

6485 
	#NL80211_NAN_FUNC_SERVICE_ID_LEN
 6

	)

6486 
	#NL80211_NAN_FUNC_SERVICE_SPEC_INFO_MAX_LEN
 0xff

	)

6487 
	#NL80211_NAN_FUNC_SRF_MAX_LEN
 0xff

	)

6531 
	eÆ80211_Çn_func_©Œibu‹s
 {

6532 
	m__NL80211_NAN_FUNC_INVALID
,

6533 
	mNL80211_NAN_FUNC_TYPE
,

6534 
	mNL80211_NAN_FUNC_SERVICE_ID
,

6535 
	mNL80211_NAN_FUNC_PUBLISH_TYPE
,

6536 
	mNL80211_NAN_FUNC_PUBLISH_BCAST
,

6537 
	mNL80211_NAN_FUNC_SUBSCRIBE_ACTIVE
,

6538 
	mNL80211_NAN_FUNC_FOLLOW_UP_ID
,

6539 
	mNL80211_NAN_FUNC_FOLLOW_UP_REQ_ID
,

6540 
	mNL80211_NAN_FUNC_FOLLOW_UP_DEST
,

6541 
	mNL80211_NAN_FUNC_CLOSE_RANGE
,

6542 
	mNL80211_NAN_FUNC_TTL
,

6543 
	mNL80211_NAN_FUNC_SERVICE_INFO
,

6544 
	mNL80211_NAN_FUNC_SRF
,

6545 
	mNL80211_NAN_FUNC_RX_MATCH_FILTER
,

6546 
	mNL80211_NAN_FUNC_TX_MATCH_FILTER
,

6547 
	mNL80211_NAN_FUNC_INSTANCE_ID
,

6548 
	mNL80211_NAN_FUNC_TERM_REASON
,

6551 
	mNUM_NL80211_NAN_FUNC_ATTR
,

6552 
	mNL80211_NAN_FUNC_ATTR_MAX
 = 
NUM_NL80211_NAN_FUNC_ATTR
 - 1

6570 
	eÆ80211_Çn_¤f_©Œibu‹s
 {

6571 
	m__NL80211_NAN_SRF_INVALID
,

6572 
	mNL80211_NAN_SRF_INCLUDE
,

6573 
	mNL80211_NAN_SRF_BF
,

6574 
	mNL80211_NAN_SRF_BF_IDX
,

6575 
	mNL80211_NAN_SRF_MAC_ADDRS
,

6578 
	mNUM_NL80211_NAN_SRF_ATTR
,

6579 
	mNL80211_NAN_SRF_ATTR_MAX
 = 
NUM_NL80211_NAN_SRF_ATTR
 - 1,

6595 
	eÆ80211_Çn_m©ch_©Œibu‹s
 {

6596 
	m__NL80211_NAN_MATCH_INVALID
,

6597 
	mNL80211_NAN_MATCH_FUNC_LOCAL
,

6598 
	mNL80211_NAN_MATCH_FUNC_PEER
,

6601 
	mNUM_NL80211_NAN_MATCH_ATTR
,

6602 
	mNL80211_NAN_MATCH_ATTR_MAX
 = 
NUM_NL80211_NAN_MATCH_ATTR
 - 1

6611 
	eÆ80211_ex‹º®_auth_aùiÚ
 {

6612 
	mNL80211_EXTERNAL_AUTH_START
,

6613 
	mNL80211_EXTERNAL_AUTH_ABORT
,

6630 
	eÆ80211_ám_»¥Úd”_©Œibu‹s
 {

6631 
	m__NL80211_FTM_RESP_ATTR_INVALID
,

6633 
	mNL80211_FTM_RESP_ATTR_ENABLED
,

6634 
	mNL80211_FTM_RESP_ATTR_LCI
,

6635 
	mNL80211_FTM_RESP_ATTR_CIVICLOC
,

6638 
	m__NL80211_FTM_RESP_ATTR_LAST
,

6639 
	mNL80211_FTM_RESP_ATTR_MAX
 = 
__NL80211_FTM_RESP_ATTR_LAST
 - 1,

6670 
	eÆ80211_ám_»¥Úd”_¡©s
 {

6671 
	m__NL80211_FTM_STATS_INVALID
,

6672 
	mNL80211_FTM_STATS_SUCCESS_NUM
,

6673 
	mNL80211_FTM_STATS_PARTIAL_NUM
,

6674 
	mNL80211_FTM_STATS_FAILED_NUM
,

6675 
	mNL80211_FTM_STATS_ASAP_NUM
,

6676 
	mNL80211_FTM_STATS_NON_ASAP_NUM
,

6677 
	mNL80211_FTM_STATS_TOTAL_DURATION_MSEC
,

6678 
	mNL80211_FTM_STATS_UNKNOWN_TRIGGERS_NUM
,

6679 
	mNL80211_FTM_STATS_RESCHEDULE_REQUESTS_NUM
,

6680 
	mNL80211_FTM_STATS_OUT_OF_WINDOW_TRIGGERS_NUM
,

6681 
	mNL80211_FTM_STATS_PAD
,

6684 
	m__NL80211_FTM_STATS_AFTER_LAST
,

6685 
	mNL80211_FTM_STATS_MAX
 = 
__NL80211_FTM_STATS_AFTER_LAST
 - 1

6696 
	eÆ80211_´—mbË
 {

6697 
	mNL80211_PREAMBLE_LEGACY
,

6698 
	mNL80211_PREAMBLE_HT
,

6699 
	mNL80211_PREAMBLE_VHT
,

6700 
	mNL80211_PREAMBLE_DMG
,

6701 
	mNL80211_PREAMBLE_HE
,

6714 
	eÆ80211_³”_m—su»m’t_ty³
 {

6715 
	mNL80211_PMSR_TYPE_INVALID
,

6717 
	mNL80211_PMSR_TYPE_FTM
,

6719 
	mNUM_NL80211_PMSR_TYPES
,

6720 
	mNL80211_PMSR_TYPE_MAX
 = 
NUM_NL80211_PMSR_TYPES
 - 1

6731 
	eÆ80211_³”_m—su»m’t_¡©us
 {

6732 
	mNL80211_PMSR_STATUS_SUCCESS
,

6733 
	mNL80211_PMSR_STATUS_REFUSED
,

6734 
	mNL80211_PMSR_STATUS_TIMEOUT
,

6735 
	mNL80211_PMSR_STATUS_FAILURE
,

6751 
	eÆ80211_³”_m—su»m’t_»q
 {

6752 
	m__NL80211_PMSR_REQ_ATTR_INVALID
,

6754 
	mNL80211_PMSR_REQ_ATTR_DATA
,

6755 
	mNL80211_PMSR_REQ_ATTR_GET_AP_TSF
,

6758 
	mNUM_NL80211_PMSR_REQ_ATTRS
,

6759 
	mNL80211_PMSR_REQ_ATTR_MAX
 = 
NUM_NL80211_PMSR_REQ_ATTRS
 - 1

6787 
	eÆ80211_³”_m—su»m’t_»¥
 {

6788 
	m__NL80211_PMSR_RESP_ATTR_INVALID
,

6790 
	mNL80211_PMSR_RESP_ATTR_DATA
,

6791 
	mNL80211_PMSR_RESP_ATTR_STATUS
,

6792 
	mNL80211_PMSR_RESP_ATTR_HOST_TIME
,

6793 
	mNL80211_PMSR_RESP_ATTR_AP_TSF
,

6794 
	mNL80211_PMSR_RESP_ATTR_FINAL
,

6795 
	mNL80211_PMSR_RESP_ATTR_PAD
,

6798 
	mNUM_NL80211_PMSR_RESP_ATTRS
,

6799 
	mNL80211_PMSR_RESP_ATTR_MAX
 = 
NUM_NL80211_PMSR_RESP_ATTRS
 - 1

6819 
	eÆ80211_³”_m—su»m’t_³”_©Œs
 {

6820 
	m__NL80211_PMSR_PEER_ATTR_INVALID
,

6822 
	mNL80211_PMSR_PEER_ATTR_ADDR
,

6823 
	mNL80211_PMSR_PEER_ATTR_CHAN
,

6824 
	mNL80211_PMSR_PEER_ATTR_REQ
,

6825 
	mNL80211_PMSR_PEER_ATTR_RESP
,

6828 
	mNUM_NL80211_PMSR_PEER_ATTRS
,

6829 
	mNL80211_PMSR_PEER_ATTR_MAX
 = 
NUM_NL80211_PMSR_PEER_ATTRS
 - 1,

6856 
	eÆ80211_³”_m—su»m’t_©Œs
 {

6857 
	m__NL80211_PMSR_ATTR_INVALID
,

6859 
	mNL80211_PMSR_ATTR_MAX_PEERS
,

6860 
	mNL80211_PMSR_ATTR_REPORT_AP_TSF
,

6861 
	mNL80211_PMSR_ATTR_RANDOMIZE_MAC_ADDR
,

6862 
	mNL80211_PMSR_ATTR_TYPE_CAPA
,

6863 
	mNL80211_PMSR_ATTR_PEERS
,

6866 
	mNUM_NL80211_PMSR_ATTR
,

6867 
	mNL80211_PMSR_ATTR_MAX
 = 
NUM_NL80211_PMSR_ATTR
 - 1

6902 
	eÆ80211_³”_m—su»m’t_ám_ÿ·
 {

6903 
	m__NL80211_PMSR_FTM_CAPA_ATTR_INVALID
,

6905 
	mNL80211_PMSR_FTM_CAPA_ATTR_ASAP
,

6906 
	mNL80211_PMSR_FTM_CAPA_ATTR_NON_ASAP
,

6907 
	mNL80211_PMSR_FTM_CAPA_ATTR_REQ_LCI
,

6908 
	mNL80211_PMSR_FTM_CAPA_ATTR_REQ_CIVICLOC
,

6909 
	mNL80211_PMSR_FTM_CAPA_ATTR_PREAMBLES
,

6910 
	mNL80211_PMSR_FTM_CAPA_ATTR_BANDWIDTHS
,

6911 
	mNL80211_PMSR_FTM_CAPA_ATTR_MAX_BURSTS_EXPONENT
,

6912 
	mNL80211_PMSR_FTM_CAPA_ATTR_MAX_FTMS_PER_BURST
,

6913 
	mNL80211_PMSR_FTM_CAPA_ATTR_TRIGGER_BASED
,

6914 
	mNL80211_PMSR_FTM_CAPA_ATTR_NON_TRIGGER_BASED
,

6917 
	mNUM_NL80211_PMSR_FTM_CAPA_ATTR
,

6918 
	mNL80211_PMSR_FTM_CAPA_ATTR_MAX
 = 
NUM_NL80211_PMSR_FTM_CAPA_ATTR
 - 1

6968 
	eÆ80211_³”_m—su»m’t_ám_»q
 {

6969 
	m__NL80211_PMSR_FTM_REQ_ATTR_INVALID
,

6971 
	mNL80211_PMSR_FTM_REQ_ATTR_ASAP
,

6972 
	mNL80211_PMSR_FTM_REQ_ATTR_PREAMBLE
,

6973 
	mNL80211_PMSR_FTM_REQ_ATTR_NUM_BURSTS_EXP
,

6974 
	mNL80211_PMSR_FTM_REQ_ATTR_BURST_PERIOD
,

6975 
	mNL80211_PMSR_FTM_REQ_ATTR_BURST_DURATION
,

6976 
	mNL80211_PMSR_FTM_REQ_ATTR_FTMS_PER_BURST
,

6977 
	mNL80211_PMSR_FTM_REQ_ATTR_NUM_FTMR_RETRIES
,

6978 
	mNL80211_PMSR_FTM_REQ_ATTR_REQUEST_LCI
,

6979 
	mNL80211_PMSR_FTM_REQ_ATTR_REQUEST_CIVICLOC
,

6980 
	mNL80211_PMSR_FTM_REQ_ATTR_TRIGGER_BASED
,

6981 
	mNL80211_PMSR_FTM_REQ_ATTR_NON_TRIGGER_BASED
,

6982 
	mNL80211_PMSR_FTM_REQ_ATTR_LMR_FEEDBACK
,

6983 
	mNL80211_PMSR_FTM_REQ_ATTR_BSS_COLOR
,

6986 
	mNUM_NL80211_PMSR_FTM_REQ_ATTR
,

6987 
	mNL80211_PMSR_FTM_REQ_ATTR_MAX
 = 
NUM_NL80211_PMSR_FTM_REQ_ATTR
 - 1

7006 
	eÆ80211_³”_m—su»m’t_ám_çu»_»asÚs
 {

7007 
	mNL80211_PMSR_FTM_FAILURE_UNSPECIFIED
,

7008 
	mNL80211_PMSR_FTM_FAILURE_NO_RESPONSE
,

7009 
	mNL80211_PMSR_FTM_FAILURE_REJECTED
,

7010 
	mNL80211_PMSR_FTM_FAILURE_WRONG_CHANNEL
,

7011 
	mNL80211_PMSR_FTM_FAILURE_PEER_NOT_CAPABLE
,

7012 
	mNL80211_PMSR_FTM_FAILURE_INVALID_TIMESTAMP
,

7013 
	mNL80211_PMSR_FTM_FAILURE_PEER_BUSY
,

7014 
	mNL80211_PMSR_FTM_FAILURE_BAD_CHANGED_PARAMS
,

7072 
	eÆ80211_³”_m—su»m’t_ám_»¥
 {

7073 
	m__NL80211_PMSR_FTM_RESP_ATTR_INVALID
,

7075 
	mNL80211_PMSR_FTM_RESP_ATTR_FAIL_REASON
,

7076 
	mNL80211_PMSR_FTM_RESP_ATTR_BURST_INDEX
,

7077 
	mNL80211_PMSR_FTM_RESP_ATTR_NUM_FTMR_ATTEMPTS
,

7078 
	mNL80211_PMSR_FTM_RESP_ATTR_NUM_FTMR_SUCCESSES
,

7079 
	mNL80211_PMSR_FTM_RESP_ATTR_BUSY_RETRY_TIME
,

7080 
	mNL80211_PMSR_FTM_RESP_ATTR_NUM_BURSTS_EXP
,

7081 
	mNL80211_PMSR_FTM_RESP_ATTR_BURST_DURATION
,

7082 
	mNL80211_PMSR_FTM_RESP_ATTR_FTMS_PER_BURST
,

7083 
	mNL80211_PMSR_FTM_RESP_ATTR_RSSI_AVG
,

7084 
	mNL80211_PMSR_FTM_RESP_ATTR_RSSI_SPREAD
,

7085 
	mNL80211_PMSR_FTM_RESP_ATTR_TX_RATE
,

7086 
	mNL80211_PMSR_FTM_RESP_ATTR_RX_RATE
,

7087 
	mNL80211_PMSR_FTM_RESP_ATTR_RTT_AVG
,

7088 
	mNL80211_PMSR_FTM_RESP_ATTR_RTT_VARIANCE
,

7089 
	mNL80211_PMSR_FTM_RESP_ATTR_RTT_SPREAD
,

7090 
	mNL80211_PMSR_FTM_RESP_ATTR_DIST_AVG
,

7091 
	mNL80211_PMSR_FTM_RESP_ATTR_DIST_VARIANCE
,

7092 
	mNL80211_PMSR_FTM_RESP_ATTR_DIST_SPREAD
,

7093 
	mNL80211_PMSR_FTM_RESP_ATTR_LCI
,

7094 
	mNL80211_PMSR_FTM_RESP_ATTR_CIVICLOC
,

7095 
	mNL80211_PMSR_FTM_RESP_ATTR_PAD
,

7098 
	mNUM_NL80211_PMSR_FTM_RESP_ATTR
,

7099 
	mNL80211_PMSR_FTM_RESP_ATTR_MAX
 = 
NUM_NL80211_PMSR_FTM_RESP_ATTR
 - 1

7119 
	eÆ80211_obss_pd_©Œibu‹s
 {

7120 
	m__NL80211_HE_OBSS_PD_ATTR_INVALID
,

7122 
	mNL80211_HE_OBSS_PD_ATTR_MIN_OFFSET
,

7123 
	mNL80211_HE_OBSS_PD_ATTR_MAX_OFFSET
,

7124 
	mNL80211_HE_OBSS_PD_ATTR_NON_SRG_MAX_OFFSET
,

7125 
	mNL80211_HE_OBSS_PD_ATTR_BSS_COLOR_BITMAP
,

7126 
	mNL80211_HE_OBSS_PD_ATTR_PARTIAL_BSSID_BITMAP
,

7127 
	mNL80211_HE_OBSS_PD_ATTR_SR_CTRL
,

7130 
	m__NL80211_HE_OBSS_PD_ATTR_LAST
,

7131 
	mNL80211_HE_OBSS_PD_ATTR_MAX
 = 
__NL80211_HE_OBSS_PD_ATTR_LAST
 - 1,

7145 
	eÆ80211_bss_cŞÜ_©Œibu‹s
 {

7146 
	m__NL80211_HE_BSS_COLOR_ATTR_INVALID
,

7148 
	mNL80211_HE_BSS_COLOR_ATTR_COLOR
,

7149 
	mNL80211_HE_BSS_COLOR_ATTR_DISABLED
,

7150 
	mNL80211_HE_BSS_COLOR_ATTR_PARTIAL
,

7153 
	m__NL80211_HE_BSS_COLOR_ATTR_LAST
,

7154 
	mNL80211_HE_BSS_COLOR_ATTR_MAX
 = 
__NL80211_HE_BSS_COLOR_ATTR_LAST
 - 1,

7170 
	eÆ80211_iáy³_akm_©Œibu‹s
 {

7171 
	m__NL80211_IFTYPE_AKM_ATTR_INVALID
,

7173 
	mNL80211_IFTYPE_AKM_ATTR_IFTYPES
,

7174 
	mNL80211_IFTYPE_AKM_ATTR_SUITES
,

7177 
	m__NL80211_IFTYPE_AKM_ATTR_LAST
,

7178 
	mNL80211_IFTYPE_AKM_ATTR_MAX
 = 
__NL80211_IFTYPE_AKM_ATTR_LAST
 - 1,

7197 
	eÆ80211_fs_discov”y_©Œibu‹s
 {

7198 
	m__NL80211_FILS_DISCOVERY_ATTR_INVALID
,

7200 
	mNL80211_FILS_DISCOVERY_ATTR_INT_MIN
,

7201 
	mNL80211_FILS_DISCOVERY_ATTR_INT_MAX
,

7202 
	mNL80211_FILS_DISCOVERY_ATTR_TMPL
,

7205 
	m__NL80211_FILS_DISCOVERY_ATTR_LAST
,

7206 
	mNL80211_FILS_DISCOVERY_ATTR_MAX
 = 
__NL80211_FILS_DISCOVERY_ATTR_LAST
 - 1

7213 
	#NL80211_FILS_DISCOVERY_TMPL_MIN_LEN
 42

	)

7230 
	eÆ80211_unsŞ_bÿ¡_´obe_»¥_©Œibu‹s
 {

7231 
	m__NL80211_UNSOL_BCAST_PROBE_RESP_ATTR_INVALID
,

7233 
	mNL80211_UNSOL_BCAST_PROBE_RESP_ATTR_INT
,

7234 
	mNL80211_UNSOL_BCAST_PROBE_RESP_ATTR_TMPL
,

7237 
	m__NL80211_UNSOL_BCAST_PROBE_RESP_ATTR_LAST
,

7238 
	mNL80211_UNSOL_BCAST_PROBE_RESP_ATTR_MAX
 =

7239 
__NL80211_UNSOL_BCAST_PROBE_RESP_ATTR_LAST
 - 1

7254 
	eÆ80211_§e_pwe_mechªism
 {

7255 
	mNL80211_SAE_PWE_UNSPECIFIED
,

7256 
	mNL80211_SAE_PWE_HUNT_AND_PECK
,

7257 
	mNL80211_SAE_PWE_HASH_TO_ELEMENT
,

7258 
	mNL80211_SAE_PWE_BOTH
,

7267 
	eÆ80211_§r_ty³
 {

7268 
	mNL80211_SAR_TYPE_POWER
,

7273 
	mNUM_NL80211_SAR_TYPE
,

7297 
	eÆ80211_§r_©Œs
 {

7298 
	m__NL80211_SAR_ATTR_INVALID
,

7300 
	mNL80211_SAR_ATTR_TYPE
,

7301 
	mNL80211_SAR_ATTR_SPECS
,

7303 
	m__NL80211_SAR_ATTR_LAST
,

7304 
	mNL80211_SAR_ATTR_MAX
 = 
__NL80211_SAR_ATTR_LAST
 - 1,

7340 
	eÆ80211_§r_¥ecs_©Œs
 {

7341 
	m__NL80211_SAR_ATTR_SPECS_INVALID
,

7343 
	mNL80211_SAR_ATTR_SPECS_POWER
,

7344 
	mNL80211_SAR_ATTR_SPECS_RANGE_INDEX
,

7345 
	mNL80211_SAR_ATTR_SPECS_START_FREQ
,

7346 
	mNL80211_SAR_ATTR_SPECS_END_FREQ
,

7348 
	m__NL80211_SAR_ATTR_SPECS_LAST
,

7349 
	mNL80211_SAR_ATTR_SPECS_MAX
 = 
__NL80211_SAR_ATTR_SPECS_LAST
 - 1,

	@/usr/include/linux/random.h

8 #iâdeà
_LINUX_RANDOM_H


9 
	#_LINUX_RANDOM_H


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/ioùl.h
>

13 
	~<lšux/œqÄ.h
>

18 
	#RNDGETENTCNT
 
	`_IOR
Ğ'R', 0x00, )

	)

21 
	#RNDADDTOENTCNT
 
	`_IOW
Ğ'R', 0x01, )

	)

24 
	#RNDGETPOOL
 
	`_IOR
Ğ'R', 0x02, [2] )

	)

30 
	#RNDADDENTROPY
 
	`_IOW
Ğ'R', 0x03, [2] )

	)

33 
	#RNDZAPENTCNT
 
	`_IO
Ğ'R', 0x04 )

	)

36 
	#RNDCLEARPOOL
 
	`_IO
Ğ'R', 0x06 )

	)

39 
	#RNDRESEEDCRNG
 
	`_IO
Ğ'R', 0x07 )

	)

41 
	s¿nd_poŞ_šfo
 {

42 
	m’Œİy_couÁ
;

43 
	mbuf_size
;

44 
__u32
 
	mbuf
[0];

54 
	#GRND_NONBLOCK
 0x0001

	)

55 
	#GRND_RANDOM
 0x0002

	)

56 
	#GRND_INSECURE
 0x0004

	)

	@/usr/include/linux/rtnetlink.h

2 #iâdeà
__LINUX_RTNETLINK_H


3 
	#__LINUX_RTNETLINK_H


	)

5 
	~<lšux/ty³s.h
>

6 
	~<lšux/Ãšk.h
>

7 
	~<lšux/if_lšk.h
>

8 
	~<lšux/if_addr.h
>

9 
	~<lšux/Ãighbour.h
>

14 
	#RTNL_FAMILY_IPMR
 128

	)

15 
	#RTNL_FAMILY_IP6MR
 129

	)

16 
	#RTNL_FAMILY_MAX
 129

	)

25 
	mRTM_BASE
 = 16,

26 
	#RTM_BASE
 
RTM_BASE


	)

28 
	mRTM_NEWLINK
 = 16,

29 
	#RTM_NEWLINK
 
RTM_NEWLINK


	)

30 
	mRTM_DELLINK
,

31 
	#RTM_DELLINK
 
RTM_DELLINK


	)

32 
	mRTM_GETLINK
,

33 
	#RTM_GETLINK
 
RTM_GETLINK


	)

34 
	mRTM_SETLINK
,

35 
	#RTM_SETLINK
 
RTM_SETLINK


	)

37 
	mRTM_NEWADDR
 = 20,

38 
	#RTM_NEWADDR
 
RTM_NEWADDR


	)

39 
	mRTM_DELADDR
,

40 
	#RTM_DELADDR
 
RTM_DELADDR


	)

41 
	mRTM_GETADDR
,

42 
	#RTM_GETADDR
 
RTM_GETADDR


	)

44 
	mRTM_NEWROUTE
 = 24,

45 
	#RTM_NEWROUTE
 
RTM_NEWROUTE


	)

46 
	mRTM_DELROUTE
,

47 
	#RTM_DELROUTE
 
RTM_DELROUTE


	)

48 
	mRTM_GETROUTE
,

49 
	#RTM_GETROUTE
 
RTM_GETROUTE


	)

51 
	mRTM_NEWNEIGH
 = 28,

52 
	#RTM_NEWNEIGH
 
RTM_NEWNEIGH


	)

53 
	mRTM_DELNEIGH
,

54 
	#RTM_DELNEIGH
 
RTM_DELNEIGH


	)

55 
	mRTM_GETNEIGH
,

56 
	#RTM_GETNEIGH
 
RTM_GETNEIGH


	)

58 
	mRTM_NEWRULE
 = 32,

59 
	#RTM_NEWRULE
 
RTM_NEWRULE


	)

60 
	mRTM_DELRULE
,

61 
	#RTM_DELRULE
 
RTM_DELRULE


	)

62 
	mRTM_GETRULE
,

63 
	#RTM_GETRULE
 
RTM_GETRULE


	)

65 
	mRTM_NEWQDISC
 = 36,

66 
	#RTM_NEWQDISC
 
RTM_NEWQDISC


	)

67 
	mRTM_DELQDISC
,

68 
	#RTM_DELQDISC
 
RTM_DELQDISC


	)

69 
	mRTM_GETQDISC
,

70 
	#RTM_GETQDISC
 
RTM_GETQDISC


	)

72 
	mRTM_NEWTCLASS
 = 40,

73 
	#RTM_NEWTCLASS
 
RTM_NEWTCLASS


	)

74 
	mRTM_DELTCLASS
,

75 
	#RTM_DELTCLASS
 
RTM_DELTCLASS


	)

76 
	mRTM_GETTCLASS
,

77 
	#RTM_GETTCLASS
 
RTM_GETTCLASS


	)

79 
	mRTM_NEWTFILTER
 = 44,

80 
	#RTM_NEWTFILTER
 
RTM_NEWTFILTER


	)

81 
	mRTM_DELTFILTER
,

82 
	#RTM_DELTFILTER
 
RTM_DELTFILTER


	)

83 
	mRTM_GETTFILTER
,

84 
	#RTM_GETTFILTER
 
RTM_GETTFILTER


	)

86 
	mRTM_NEWACTION
 = 48,

87 
	#RTM_NEWACTION
 
RTM_NEWACTION


	)

88 
	mRTM_DELACTION
,

89 
	#RTM_DELACTION
 
RTM_DELACTION


	)

90 
	mRTM_GETACTION
,

91 
	#RTM_GETACTION
 
RTM_GETACTION


	)

93 
	mRTM_NEWPREFIX
 = 52,

94 
	#RTM_NEWPREFIX
 
RTM_NEWPREFIX


	)

96 
	mRTM_GETMULTICAST
 = 58,

97 
	#RTM_GETMULTICAST
 
RTM_GETMULTICAST


	)

99 
	mRTM_GETANYCAST
 = 62,

100 
	#RTM_GETANYCAST
 
RTM_GETANYCAST


	)

102 
	mRTM_NEWNEIGHTBL
 = 64,

103 
	#RTM_NEWNEIGHTBL
 
RTM_NEWNEIGHTBL


	)

104 
	mRTM_GETNEIGHTBL
 = 66,

105 
	#RTM_GETNEIGHTBL
 
RTM_GETNEIGHTBL


	)

106 
	mRTM_SETNEIGHTBL
,

107 
	#RTM_SETNEIGHTBL
 
RTM_SETNEIGHTBL


	)

109 
	mRTM_NEWNDUSEROPT
 = 68,

110 
	#RTM_NEWNDUSEROPT
 
RTM_NEWNDUSEROPT


	)

112 
	mRTM_NEWADDRLABEL
 = 72,

113 
	#RTM_NEWADDRLABEL
 
RTM_NEWADDRLABEL


	)

114 
	mRTM_DELADDRLABEL
,

115 
	#RTM_DELADDRLABEL
 
RTM_DELADDRLABEL


	)

116 
	mRTM_GETADDRLABEL
,

117 
	#RTM_GETADDRLABEL
 
RTM_GETADDRLABEL


	)

119 
	mRTM_GETDCB
 = 78,

120 
	#RTM_GETDCB
 
RTM_GETDCB


	)

121 
	mRTM_SETDCB
,

122 
	#RTM_SETDCB
 
RTM_SETDCB


	)

124 
	mRTM_NEWNETCONF
 = 80,

125 
	#RTM_NEWNETCONF
 
RTM_NEWNETCONF


	)

126 
	mRTM_DELNETCONF
,

127 
	#RTM_DELNETCONF
 
RTM_DELNETCONF


	)

128 
	mRTM_GETNETCONF
 = 82,

129 
	#RTM_GETNETCONF
 
RTM_GETNETCONF


	)

131 
	mRTM_NEWMDB
 = 84,

132 
	#RTM_NEWMDB
 
RTM_NEWMDB


	)

133 
	mRTM_DELMDB
 = 85,

134 
	#RTM_DELMDB
 
RTM_DELMDB


	)

135 
	mRTM_GETMDB
 = 86,

136 
	#RTM_GETMDB
 
RTM_GETMDB


	)

138 
	mRTM_NEWNSID
 = 88,

139 
	#RTM_NEWNSID
 
RTM_NEWNSID


	)

140 
	mRTM_DELNSID
 = 89,

141 
	#RTM_DELNSID
 
RTM_DELNSID


	)

142 
	mRTM_GETNSID
 = 90,

143 
	#RTM_GETNSID
 
RTM_GETNSID


	)

145 
	mRTM_NEWSTATS
 = 92,

146 
	#RTM_NEWSTATS
 
RTM_NEWSTATS


	)

147 
	mRTM_GETSTATS
 = 94,

148 
	#RTM_GETSTATS
 
RTM_GETSTATS


	)

150 
	mRTM_NEWCACHEREPORT
 = 96,

151 
	#RTM_NEWCACHEREPORT
 
RTM_NEWCACHEREPORT


	)

153 
	mRTM_NEWCHAIN
 = 100,

154 
	#RTM_NEWCHAIN
 
RTM_NEWCHAIN


	)

155 
	mRTM_DELCHAIN
,

156 
	#RTM_DELCHAIN
 
RTM_DELCHAIN


	)

157 
	mRTM_GETCHAIN
,

158 
	#RTM_GETCHAIN
 
RTM_GETCHAIN


	)

160 
	mRTM_NEWNEXTHOP
 = 104,

161 
	#RTM_NEWNEXTHOP
 
RTM_NEWNEXTHOP


	)

162 
	mRTM_DELNEXTHOP
,

163 
	#RTM_DELNEXTHOP
 
RTM_DELNEXTHOP


	)

164 
	mRTM_GETNEXTHOP
,

165 
	#RTM_GETNEXTHOP
 
RTM_GETNEXTHOP


	)

167 
	mRTM_NEWLINKPROP
 = 108,

168 
	#RTM_NEWLINKPROP
 
RTM_NEWLINKPROP


	)

169 
	mRTM_DELLINKPROP
,

170 
	#RTM_DELLINKPROP
 
RTM_DELLINKPROP


	)

171 
	mRTM_GETLINKPROP
,

172 
	#RTM_GETLINKPROP
 
RTM_GETLINKPROP


	)

174 
	mRTM_NEWVLAN
 = 112,

175 
	#RTM_NEWNVLAN
 
RTM_NEWVLAN


	)

176 
	mRTM_DELVLAN
,

177 
	#RTM_DELVLAN
 
RTM_DELVLAN


	)

178 
	mRTM_GETVLAN
,

179 
	#RTM_GETVLAN
 
RTM_GETVLAN


	)

181 
	mRTM_NEWNEXTHOPBUCKET
 = 116,

182 
	#RTM_NEWNEXTHOPBUCKET
 
RTM_NEWNEXTHOPBUCKET


	)

183 
	mRTM_DELNEXTHOPBUCKET
,

184 
	#RTM_DELNEXTHOPBUCKET
 
RTM_DELNEXTHOPBUCKET


	)

185 
	mRTM_GETNEXTHOPBUCKET
,

186 
	#RTM_GETNEXTHOPBUCKET
 
RTM_GETNEXTHOPBUCKET


	)

188 
	m__RTM_MAX
,

189 
	#RTM_MAX
 (((
__RTM_MAX
 + 3è& ~3è- 1)

	)

192 
	#RTM_NR_MSGTYPES
 (
RTM_MAX
 + 1 - 
RTM_BASE
)

	)

193 
	#RTM_NR_FAMILIES
 (
RTM_NR_MSGTYPES
 >> 2)

	)

194 
	#RTM_FAM
(
cmd
è(((cmdè- 
RTM_BASE
è>> 2)

	)

202 
	s¹©Œ
 {

203 
	m¹a_Ën
;

204 
	m¹a_ty³
;

209 
	#RTA_ALIGNTO
 4U

	)

210 
	#RTA_ALIGN
(
Ën
èĞ(Ö’)+
RTA_ALIGNTO
-1è& ~(RTA_ALIGNTO-1è)

	)

211 
	#RTA_OK
(
¹a
,
Ën
è(Ö’è>ğ()(
¹©Œ
) && \

212 (
¹a
)->
¹a_Ën
 >ğ(
¹©Œ
) && \

213 (
¹a
)->
¹a_Ën
 <ğ(
Ën
))

	)

214 
	#RTA_NEXT
(
¹a
,
©ŒËn
è(×‰¾’è-ğ
	`RTA_ALIGN
(Ô)->
¹a_Ën
), \

215 (
¹©Œ
*)(((*)(
¹a
)è+ 
	`RTA_ALIGN
(Ô)->
¹a_Ën
)))

	)

216 
	#RTA_LENGTH
(
Ën
è(
	`RTA_ALIGN
((
¹©Œ
)è+ (Ën))

	)

217 
	#RTA_SPACE
(
Ën
è
	`RTA_ALIGN
(
	`RTA_LENGTH
Ö’))

	)

218 
	#RTA_DATA
(
¹a
è((*)(((*)Ô)è+ 
	`RTA_LENGTH
(0)))

	)

219 
	#RTA_PAYLOAD
(
¹a
è(()(Ô)->
¹a_Ën
è- 
	`RTA_LENGTH
(0))

	)

228 
	s¹msg
 {

229 
	m¹m_çmy
;

230 
	m¹m_d¡_Ën
;

231 
	m¹m_¤c_Ën
;

232 
	m¹m_tos
;

234 
	m¹m_bË
;

235 
	m¹m_´ÙocŞ
;

236 
	m¹m_scİe
;

237 
	m¹m_ty³
;

239 
	m¹m_æags
;

245 
	mRTN_UNSPEC
,

246 
	mRTN_UNICAST
,

247 
	mRTN_LOCAL
,

248 
	mRTN_BROADCAST
,

250 
	mRTN_ANYCAST
,

252 
	mRTN_MULTICAST
,

253 
	mRTN_BLACKHOLE
,

254 
	mRTN_UNREACHABLE
,

255 
	mRTN_PROHIBIT
,

256 
	mRTN_THROW
,

257 
	mRTN_NAT
,

258 
	mRTN_XRESOLVE
,

259 
	m__RTN_MAX


262 
	#RTN_MAX
 (
__RTN_MAX
 - 1)

	)

267 
	#RTPROT_UNSPEC
 0

	)

268 
	#RTPROT_REDIRECT
 1

	)

270 
	#RTPROT_KERNEL
 2

	)

271 
	#RTPROT_BOOT
 3

	)

272 
	#RTPROT_STATIC
 4

	)

281 
	#RTPROT_GATED
 8

	)

282 
	#RTPROT_RA
 9

	)

283 
	#RTPROT_MRT
 10

	)

284 
	#RTPROT_ZEBRA
 11

	)

285 
	#RTPROT_BIRD
 12

	)

286 
	#RTPROT_DNROUTED
 13

	)

287 
	#RTPROT_XORP
 14

	)

288 
	#RTPROT_NTK
 15

	)

289 
	#RTPROT_DHCP
 16

	)

290 
	#RTPROT_MROUTED
 17

	)

291 
	#RTPROT_KEEPALIVED
 18

	)

292 
	#RTPROT_BABEL
 42

	)

293 
	#RTPROT_OPENR
 99

	)

294 
	#RTPROT_BGP
 186

	)

295 
	#RTPROT_ISIS
 187

	)

296 
	#RTPROT_OSPF
 188

	)

297 
	#RTPROT_RIP
 189

	)

298 
	#RTPROT_EIGRP
 192

	)

311 
	e¹_scİe_t
 {

312 
	mRT_SCOPE_UNIVERSE
=0,

314 
	mRT_SCOPE_SITE
=200,

315 
	mRT_SCOPE_LINK
=253,

316 
	mRT_SCOPE_HOST
=254,

317 
	mRT_SCOPE_NOWHERE
=255

322 
	#RTM_F_NOTIFY
 0x100

	)

323 
	#RTM_F_CLONED
 0x200

	)

324 
	#RTM_F_EQUALIZE
 0x400

	)

325 
	#RTM_F_PREFIX
 0x800

	)

326 
	#RTM_F_LOOKUP_TABLE
 0x1000

	)

327 
	#RTM_F_FIB_MATCH
 0x2000

	)

328 
	#RTM_F_OFFLOAD
 0x4000

	)

329 
	#RTM_F_TRAP
 0x8000

	)

330 
	#RTM_F_OFFLOAD_FAILED
 0x20000000

	)

338 
	e¹_şass_t
 {

339 
	mRT_TABLE_UNSPEC
=0,

341 
	mRT_TABLE_COMPAT
=252,

342 
	mRT_TABLE_DEFAULT
=253,

343 
	mRT_TABLE_MAIN
=254,

344 
	mRT_TABLE_LOCAL
=255,

345 
	mRT_TABLE_MAX
=0xFFFFFFFF

351 
	e¹©Œ_ty³_t
 {

352 
	mRTA_UNSPEC
,

353 
	mRTA_DST
,

354 
	mRTA_SRC
,

355 
	mRTA_IIF
,

356 
	mRTA_OIF
,

357 
	mRTA_GATEWAY
,

358 
	mRTA_PRIORITY
,

359 
	mRTA_PREFSRC
,

360 
	mRTA_METRICS
,

361 
	mRTA_MULTIPATH
,

362 
	mRTA_PROTOINFO
,

363 
	mRTA_FLOW
,

364 
	mRTA_CACHEINFO
,

365 
	mRTA_SESSION
,

366 
	mRTA_MP_ALGO
,

367 
	mRTA_TABLE
,

368 
	mRTA_MARK
,

369 
	mRTA_MFC_STATS
,

370 
	mRTA_VIA
,

371 
	mRTA_NEWDST
,

372 
	mRTA_PREF
,

373 
	mRTA_ENCAP_TYPE
,

374 
	mRTA_ENCAP
,

375 
	mRTA_EXPIRES
,

376 
	mRTA_PAD
,

377 
	mRTA_UID
,

378 
	mRTA_TTL_PROPAGATE
,

379 
	mRTA_IP_PROTO
,

380 
	mRTA_SPORT
,

381 
	mRTA_DPORT
,

382 
	mRTA_NH_ID
,

383 
	m__RTA_MAX


386 
	#RTA_MAX
 (
__RTA_MAX
 - 1)

	)

388 
	#RTM_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
¹msg
))))

	)

389 
	#RTM_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
¹msg
))

	)

400 
	s¹Ãxthİ
 {

401 
	m¹nh_Ën
;

402 
	m¹nh_æags
;

403 
	m¹nh_hİs
;

404 
	m¹nh_ifšdex
;

409 
	#RTNH_F_DEAD
 1

	)

410 
	#RTNH_F_PERVASIVE
 2

	)

411 
	#RTNH_F_ONLINK
 4

	)

412 
	#RTNH_F_OFFLOAD
 8

	)

413 
	#RTNH_F_LINKDOWN
 16

	)

414 
	#RTNH_F_UNRESOLVED
 32

	)

415 
	#RTNH_F_TRAP
 64

	)

417 
	#RTNH_COMPARE_MASK
 (
RTNH_F_DEAD
 | 
RTNH_F_LINKDOWN
 | \

418 
RTNH_F_OFFLOAD
 | 
RTNH_F_TRAP
)

	)

422 
	#RTNH_ALIGNTO
 4

	)

423 
	#RTNH_ALIGN
(
Ën
èĞ(Ö’)+
RTNH_ALIGNTO
-1è& ~(RTNH_ALIGNTO-1è)

	)

424 
	#RTNH_OK
(
¹nh
,
Ën
è(ÔŠh)->
¹nh_Ën
 >ğ(
¹Ãxthİ
) && \

425 (()(
¹nh
)->
¹nh_Ën
è<ğ(
Ën
))

	)

426 
	#RTNH_NEXT
(
¹nh
è((
¹Ãxthİ
*)(((*)ÔŠh)è+ 
	`RTNH_ALIGN
(ÔŠh)->
¹nh_Ën
)))

	)

427 
	#RTNH_LENGTH
(
Ën
è(
	`RTNH_ALIGN
((
¹Ãxthİ
)è+ (Ën))

	)

428 
	#RTNH_SPACE
(
Ën
è
	`RTNH_ALIGN
(
	`RTNH_LENGTH
Ö’))

	)

429 
	#RTNH_DATA
(
¹nh
è((
¹©Œ
*)(((*)ÔŠh)è+ 
	`RTNH_LENGTH
(0)))

	)

432 
	s¹vŸ
 {

433 
__k”Ãl_§_çmy_t
 
	m¹vŸ_çmy
;

434 
__u8
 
	m¹vŸ_addr
[0];

439 
	s¹a_ÿchešfo
 {

440 
__u32
 
	m¹a_şÁ»f
;

441 
__u32
 
	m¹a_Ï¡u£
;

442 
__s32
 
	m¹a_expœes
;

443 
__u32
 
	m¹a_”rÜ
;

444 
__u32
 
	m¹a_u£d
;

446 
	#RTNETLINK_HAVE_PEERINFO
 1

	)

447 
__u32
 
	m¹a_id
;

448 
__u32
 
	m¹a_ts
;

449 
__u32
 
	m¹a_t§ge
;

455 
	mRTAX_UNSPEC
,

456 
	#RTAX_UNSPEC
 
RTAX_UNSPEC


	)

457 
	mRTAX_LOCK
,

458 
	#RTAX_LOCK
 
RTAX_LOCK


	)

459 
	mRTAX_MTU
,

460 
	#RTAX_MTU
 
RTAX_MTU


	)

461 
	mRTAX_WINDOW
,

462 
	#RTAX_WINDOW
 
RTAX_WINDOW


	)

463 
	mRTAX_RTT
,

464 
	#RTAX_RTT
 
RTAX_RTT


	)

465 
	mRTAX_RTTVAR
,

466 
	#RTAX_RTTVAR
 
RTAX_RTTVAR


	)

467 
	mRTAX_SSTHRESH
,

468 
	#RTAX_SSTHRESH
 
RTAX_SSTHRESH


	)

469 
	mRTAX_CWND
,

470 
	#RTAX_CWND
 
RTAX_CWND


	)

471 
	mRTAX_ADVMSS
,

472 
	#RTAX_ADVMSS
 
RTAX_ADVMSS


	)

473 
	mRTAX_REORDERING
,

474 
	#RTAX_REORDERING
 
RTAX_REORDERING


	)

475 
	mRTAX_HOPLIMIT
,

476 
	#RTAX_HOPLIMIT
 
RTAX_HOPLIMIT


	)

477 
	mRTAX_INITCWND
,

478 
	#RTAX_INITCWND
 
RTAX_INITCWND


	)

479 
	mRTAX_FEATURES
,

480 
	#RTAX_FEATURES
 
RTAX_FEATURES


	)

481 
	mRTAX_RTO_MIN
,

482 
	#RTAX_RTO_MIN
 
RTAX_RTO_MIN


	)

483 
	mRTAX_INITRWND
,

484 
	#RTAX_INITRWND
 
RTAX_INITRWND


	)

485 
	mRTAX_QUICKACK
,

486 
	#RTAX_QUICKACK
 
RTAX_QUICKACK


	)

487 
	mRTAX_CC_ALGO
,

488 
	#RTAX_CC_ALGO
 
RTAX_CC_ALGO


	)

489 
	mRTAX_FASTOPEN_NO_COOKIE
,

490 
	#RTAX_FASTOPEN_NO_COOKIE
 
RTAX_FASTOPEN_NO_COOKIE


	)

491 
	m__RTAX_MAX


494 
	#RTAX_MAX
 (
__RTAX_MAX
 - 1)

	)

496 
	#RTAX_FEATURE_ECN
 (1 << 0)

	)

497 
	#RTAX_FEATURE_SACK
 (1 << 1)

	)

498 
	#RTAX_FEATURE_TIMESTAMP
 (1 << 2)

	)

499 
	#RTAX_FEATURE_ALLFRAG
 (1 << 3)

	)

501 
	#RTAX_FEATURE_MASK
 (
RTAX_FEATURE_ECN
 | 
RTAX_FEATURE_SACK
 | \

502 
RTAX_FEATURE_TIMESTAMP
 | 
RTAX_FEATURE_ALLFRAG
)

	)

504 
	s¹a_£ssiÚ
 {

505 
__u8
 
	m´Ùo
;

506 
__u8
 
	m·d1
;

507 
__u16
 
	m·d2
;

511 
__u16
 
	m¥Üt
;

512 
__u16
 
	mdpÜt
;

513 } 
	mpÜts
;

516 
__u8
 
	mty³
;

517 
__u8
 
	mcode
;

518 
__u16
 
	mid’t
;

519 } 
	micm±
;

521 
__u32
 
	m¥i
;

522 } 
	mu
;

525 
	s¹a_mfc_¡©s
 {

526 
__u64
 
	mmfcs_·ck‘s
;

527 
__u64
 
	mmfcs_by‹s
;

528 
__u64
 
	mmfcs_wrÚg_if
;

535 
	s¹g’msg
 {

536 
	m¹g’_çmy
;

548 
	sifšfomsg
 {

549 
	mifi_çmy
;

550 
	m__ifi_·d
;

551 
	mifi_ty³
;

552 
	mifi_šdex
;

553 
	mifi_æags
;

554 
	mifi_chªge
;

561 
	s´efixmsg
 {

562 
	m´efix_çmy
;

563 
	m´efix_·d1
;

564 
	m´efix_·d2
;

565 
	m´efix_ifšdex
;

566 
	m´efix_ty³
;

567 
	m´efix_Ën
;

568 
	m´efix_æags
;

569 
	m´efix_·d3
;

574 
	mPREFIX_UNSPEC
,

575 
	mPREFIX_ADDRESS
,

576 
	mPREFIX_CACHEINFO
,

577 
	m__PREFIX_MAX


580 
	#PREFIX_MAX
 (
__PREFIX_MAX
 - 1)

	)

582 
	s´efix_ÿchešfo
 {

583 
__u32
 
	m´eã¼ed_time
;

584 
__u32
 
	mv®id_time
;

592 
	stcmsg
 {

593 
	mtcm_çmy
;

594 
	mtcm__·d1
;

595 
	mtcm__·d2
;

596 
	mtcm_ifšdex
;

597 
__u32
 
	mtcm_hªdË
;

598 
__u32
 
	mtcm_·»Á
;

602 
	#tcm_block_šdex
 
tcm_·»Á


	)

603 
__u32
 
	mtcm_šfo
;

610 
	#TCM_IFINDEX_MAGIC_BLOCK
 (0xFFFFFFFFU)

	)

613 
	mTCA_UNSPEC
,

614 
	mTCA_KIND
,

615 
	mTCA_OPTIONS
,

616 
	mTCA_STATS
,

617 
	mTCA_XSTATS
,

618 
	mTCA_RATE
,

619 
	mTCA_FCNT
,

620 
	mTCA_STATS2
,

621 
	mTCA_STAB
,

622 
	mTCA_PAD
,

623 
	mTCA_DUMP_INVISIBLE
,

624 
	mTCA_CHAIN
,

625 
	mTCA_HW_OFFLOAD
,

626 
	mTCA_INGRESS_BLOCK
,

627 
	mTCA_EGRESS_BLOCK
,

628 
	mTCA_DUMP_FLAGS
,

629 
	m__TCA_MAX


632 
	#TCA_MAX
 (
__TCA_MAX
 - 1)

	)

634 
	#TCA_DUMP_FLAGS_TERSE
 (1 << 0è

	)

639 
	#TCA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
tcmsg
))))

	)

640 
	#TCA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
tcmsg
))

	)

646 
	sndu£rİtmsg
 {

647 
	mndu£rİt_çmy
;

648 
	mndu£rİt_·d1
;

649 
	mndu£rİt_İts_Ën
;

650 
	mndu£rİt_ifšdex
;

651 
__u8
 
	mndu£rİt_icmp_ty³
;

652 
__u8
 
	mndu£rİt_icmp_code
;

653 
	mndu£rİt_·d2
;

654 
	mndu£rİt_·d3
;

659 
	mNDUSEROPT_UNSPEC
,

660 
	mNDUSEROPT_SRCADDR
,

661 
	m__NDUSEROPT_MAX


664 
	#NDUSEROPT_MAX
 (
__NDUSEROPT_MAX
 - 1)

	)

667 
	#RTMGRP_LINK
 1

	)

668 
	#RTMGRP_NOTIFY
 2

	)

669 
	#RTMGRP_NEIGH
 4

	)

670 
	#RTMGRP_TC
 8

	)

672 
	#RTMGRP_IPV4_IFADDR
 0x10

	)

673 
	#RTMGRP_IPV4_MROUTE
 0x20

	)

674 
	#RTMGRP_IPV4_ROUTE
 0x40

	)

675 
	#RTMGRP_IPV4_RULE
 0x80

	)

677 
	#RTMGRP_IPV6_IFADDR
 0x100

	)

678 
	#RTMGRP_IPV6_MROUTE
 0x200

	)

679 
	#RTMGRP_IPV6_ROUTE
 0x400

	)

680 
	#RTMGRP_IPV6_IFINFO
 0x800

	)

682 
	#RTMGRP_DECÃt_IFADDR
 0x1000

	)

683 
	#RTMGRP_DECÃt_ROUTE
 0x4000

	)

685 
	#RTMGRP_IPV6_PREFIX
 0x20000

	)

688 
	e¹Ãšk_groups
 {

689 
	mRTNLGRP_NONE
,

690 
	#RTNLGRP_NONE
 
RTNLGRP_NONE


	)

691 
	mRTNLGRP_LINK
,

692 
	#RTNLGRP_LINK
 
RTNLGRP_LINK


	)

693 
	mRTNLGRP_NOTIFY
,

694 
	#RTNLGRP_NOTIFY
 
RTNLGRP_NOTIFY


	)

695 
	mRTNLGRP_NEIGH
,

696 
	#RTNLGRP_NEIGH
 
RTNLGRP_NEIGH


	)

697 
	mRTNLGRP_TC
,

698 
	#RTNLGRP_TC
 
RTNLGRP_TC


	)

699 
	mRTNLGRP_IPV4_IFADDR
,

700 
	#RTNLGRP_IPV4_IFADDR
 
RTNLGRP_IPV4_IFADDR


	)

701 
	mRTNLGRP_IPV4_MROUTE
,

702 
	#RTNLGRP_IPV4_MROUTE
 
RTNLGRP_IPV4_MROUTE


	)

703 
	mRTNLGRP_IPV4_ROUTE
,

704 
	#RTNLGRP_IPV4_ROUTE
 
RTNLGRP_IPV4_ROUTE


	)

705 
	mRTNLGRP_IPV4_RULE
,

706 
	#RTNLGRP_IPV4_RULE
 
RTNLGRP_IPV4_RULE


	)

707 
	mRTNLGRP_IPV6_IFADDR
,

708 
	#RTNLGRP_IPV6_IFADDR
 
RTNLGRP_IPV6_IFADDR


	)

709 
	mRTNLGRP_IPV6_MROUTE
,

710 
	#RTNLGRP_IPV6_MROUTE
 
RTNLGRP_IPV6_MROUTE


	)

711 
	mRTNLGRP_IPV6_ROUTE
,

712 
	#RTNLGRP_IPV6_ROUTE
 
RTNLGRP_IPV6_ROUTE


	)

713 
	mRTNLGRP_IPV6_IFINFO
,

714 
	#RTNLGRP_IPV6_IFINFO
 
RTNLGRP_IPV6_IFINFO


	)

715 
	mRTNLGRP_DECÃt_IFADDR
,

716 
	#RTNLGRP_DECÃt_IFADDR
 
RTNLGRP_DECÃt_IFADDR


	)

717 
	mRTNLGRP_NOP2
,

718 
	mRTNLGRP_DECÃt_ROUTE
,

719 
	#RTNLGRP_DECÃt_ROUTE
 
RTNLGRP_DECÃt_ROUTE


	)

720 
	mRTNLGRP_DECÃt_RULE
,

721 
	#RTNLGRP_DECÃt_RULE
 
RTNLGRP_DECÃt_RULE


	)

722 
	mRTNLGRP_NOP4
,

723 
	mRTNLGRP_IPV6_PREFIX
,

724 
	#RTNLGRP_IPV6_PREFIX
 
RTNLGRP_IPV6_PREFIX


	)

725 
	mRTNLGRP_IPV6_RULE
,

726 
	#RTNLGRP_IPV6_RULE
 
RTNLGRP_IPV6_RULE


	)

727 
	mRTNLGRP_ND_USEROPT
,

728 
	#RTNLGRP_ND_USEROPT
 
RTNLGRP_ND_USEROPT


	)

729 
	mRTNLGRP_PHONET_IFADDR
,

730 
	#RTNLGRP_PHONET_IFADDR
 
RTNLGRP_PHONET_IFADDR


	)

731 
	mRTNLGRP_PHONET_ROUTE
,

732 
	#RTNLGRP_PHONET_ROUTE
 
RTNLGRP_PHONET_ROUTE


	)

733 
	mRTNLGRP_DCB
,

734 
	#RTNLGRP_DCB
 
RTNLGRP_DCB


	)

735 
	mRTNLGRP_IPV4_NETCONF
,

736 
	#RTNLGRP_IPV4_NETCONF
 
RTNLGRP_IPV4_NETCONF


	)

737 
	mRTNLGRP_IPV6_NETCONF
,

738 
	#RTNLGRP_IPV6_NETCONF
 
RTNLGRP_IPV6_NETCONF


	)

739 
	mRTNLGRP_MDB
,

740 
	#RTNLGRP_MDB
 
RTNLGRP_MDB


	)

741 
	mRTNLGRP_MPLS_ROUTE
,

742 
	#RTNLGRP_MPLS_ROUTE
 
RTNLGRP_MPLS_ROUTE


	)

743 
	mRTNLGRP_NSID
,

744 
	#RTNLGRP_NSID
 
RTNLGRP_NSID


	)

745 
	mRTNLGRP_MPLS_NETCONF
,

746 
	#RTNLGRP_MPLS_NETCONF
 
RTNLGRP_MPLS_NETCONF


	)

747 
	mRTNLGRP_IPV4_MROUTE_R
,

748 
	#RTNLGRP_IPV4_MROUTE_R
 
RTNLGRP_IPV4_MROUTE_R


	)

749 
	mRTNLGRP_IPV6_MROUTE_R
,

750 
	#RTNLGRP_IPV6_MROUTE_R
 
RTNLGRP_IPV6_MROUTE_R


	)

751 
	mRTNLGRP_NEXTHOP
,

752 
	#RTNLGRP_NEXTHOP
 
RTNLGRP_NEXTHOP


	)

753 
	mRTNLGRP_BRVLAN
,

754 
	#RTNLGRP_BRVLAN
 
RTNLGRP_BRVLAN


	)

755 
	m__RTNLGRP_MAX


757 
	#RTNLGRP_MAX
 (
__RTNLGRP_MAX
 - 1)

	)

760 
	stÿmsg
 {

761 
	mtÿ_çmy
;

762 
	mtÿ__·d1
;

763 
	mtÿ__·d2
;

767 
	mTCA_ROOT_UNSPEC
,

768 
	mTCA_ROOT_TAB
,

769 
	#TCA_ACT_TAB
 
TCA_ROOT_TAB


	)

770 
	#TCAA_MAX
 
TCA_ROOT_TAB


	)

771 
	mTCA_ROOT_FLAGS
,

772 
	mTCA_ROOT_COUNT
,

773 
	mTCA_ROOT_TIME_DELTA
,

774 
	m__TCA_ROOT_MAX
,

775 
	#TCA_ROOT_MAX
 (
__TCA_ROOT_MAX
 - 1)

	)

778 
	#TA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
tÿmsg
))))

	)

779 
	#TA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
tÿmsg
))

	)

791 
	#TCA_FLAG_LARGE_DUMP_ON
 (1 << 0)

	)

792 
	#TCA_ACT_FLAG_LARGE_DUMP_ON
 
TCA_FLAG_LARGE_DUMP_ON


	)

793 
	#TCA_ACT_FLAG_TERSE_DUMP
 (1 << 1)

	)

796 
	#RTEXT_FILTER_VF
 (1 << 0)

	)

797 
	#RTEXT_FILTER_BRVLAN
 (1 << 1)

	)

798 
	#RTEXT_FILTER_BRVLAN_COMPRESSED
 (1 << 2)

	)

799 
	#RTEXT_FILTER_SKIP_STATS
 (1 << 3)

	)

800 
	#RTEXT_FILTER_MRP
 (1 << 4)

	)

801 
	#RTEXT_FILTER_CFM_CONFIG
 (1 << 5)

	)

802 
	#RTEXT_FILTER_CFM_STATUS
 (1 << 6)

	)

	@/usr/include/linux/string.h

2 #iâdeà
_LINUX_STRING_H_


3 
	#_LINUX_STRING_H_


	)

7 
	~<¡ršg.h
>

	@/usr/include/linux/types.h

2 #iâdeà
_LINUX_TYPES_H


3 
	#_LINUX_TYPES_H


	)

5 
	~<asm/ty³s.h
>

7 #iâdeà
__ASSEMBLY__


9 
	~<lšux/posix_ty³s.h
>

17 #ifdeà
__CHECKER__


18 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

20 
	#__b™wi£__


	)

22 
	#__b™wi£
 
__b™wi£__


	)

24 
__u16
 
	t__b™wi£
 
	t__Ë16
;

25 
__u16
 
	t__b™wi£
 
	t__be16
;

26 
__u32
 
	t__b™wi£
 
	t__Ë32
;

27 
__u32
 
	t__b™wi£
 
	t__be32
;

28 
__u64
 
	t__b™wi£
 
	t__Ë64
;

29 
__u64
 
	t__b™wi£
 
	t__be64
;

31 
__u16
 
	t__b™wi£
 
	t__sum16
;

32 
__u32
 
	t__b™wi£
 
	t__wsum
;

43 
	#__®igÃd_u64
 
__u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

44 
	#__®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

45 
	#__®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

47 
	t__b™wi£
 
	t__pŞl_t
;

	@/usr/include/linux/const.h

4 #iâdeà
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifdeà
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
è
	)
X

18 
	#_AT
(
T
,
X
è
	)
X

20 
	#__AC
(
X
,
Y
è(X##Y)

	)

21 
	#_AC
(
X
,
Y
è
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
è((T)(X))

	)

25 
	#_UL
(
x
è(
	`_AC
(x, 
UL
))

	)

26 
	#_ULL
(
x
è(
	`_AC
(x, 
ULL
))

	)

28 
	#_BITUL
(
x
è(
	`_UL
(1è<< (x))

	)

29 
	#_BITULL
(
x
è(
	`_ULL
(1è<< (x))

	)

31 
	#__ALIGN_KERNEL
(
x
, 
a
è
	`__ALIGN_KERNEL_MASK
(x, (
	`__ty³of__
(x))×è- 1)

	)

32 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
è(((xè+ (mask)è& ~(mask))

	)

34 
	#__KERNEL_DIV_ROUND_UP
(
n
, 
d
è((Òè+ (dè- 1è/ (d))

	)

	@/usr/include/linux/hdlc/ioctl.h

2 #iâdeà
__HDLC_IOCTL_H__


3 
	#__HDLC_IOCTL_H__


	)

6 
	#GENERIC_HDLC_VERSION
 4

	)

8 
	#CLOCK_DEFAULT
 0

	)

9 
	#CLOCK_EXT
 1

	)

10 
	#CLOCK_INT
 2

	)

11 
	#CLOCK_TXINT
 3

	)

12 
	#CLOCK_TXFROMRX
 4

	)

15 
	#ENCODING_DEFAULT
 0

	)

16 
	#ENCODING_NRZ
 1

	)

17 
	#ENCODING_NRZI
 2

	)

18 
	#ENCODING_FM_MARK
 3

	)

19 
	#ENCODING_FM_SPACE
 4

	)

20 
	#ENCODING_MANCHESTER
 5

	)

23 
	#PARITY_DEFAULT
 0

	)

24 
	#PARITY_NONE
 1

	)

25 
	#PARITY_CRC16_PR0
 2

	)

26 
	#PARITY_CRC16_PR1
 3

	)

27 
	#PARITY_CRC16_PR0_CCITT
 4

	)

28 
	#PARITY_CRC16_PR1_CCITT
 5

	)

29 
	#PARITY_CRC32_PR0_CCITT
 6

	)

30 
	#PARITY_CRC32_PR1_CCITT
 7

	)

32 
	#LMI_DEFAULT
 0

	)

33 
	#LMI_NONE
 1

	)

34 
	#LMI_ANSI
 2

	)

35 
	#LMI_CCITT
 3

	)

36 
	#LMI_CISCO
 4

	)

38 #iâdeà
__ASSEMBLY__


41 
	mşock_¿‹
;

42 
	mşock_ty³
;

43 
	mloİback
;

44 } 
	tsync_£rŸl_£‰šgs
;

47 
	mşock_¿‹
;

48 
	mşock_ty³
;

49 
	mloİback
;

50 
	m¦Ù_m­
;

51 } 
	t‹1_£‰šgs
;

54 
	m’codšg
;

55 
	m·r™y
;

56 } 
	t¿w_hdlc_´Ùo
;

59 
	mt391
;

60 
	mt392
;

61 
	mn391
;

62 
	mn392
;

63 
	mn393
;

64 
	mlmi
;

65 
	mdû
;

66 } 
	tä_´Ùo
;

69 
	mdlci
;

70 } 
	tä_´Ùo_pvc
;

73 
	mdlci
;

74 
	mma¡”
[
IFNAMSIZ
];

75 }
	tä_´Ùo_pvc_šfo
;

78 
	mš‹rv®
;

79 
	mtimeout
;

80 } 
	tcisco_´Ùo
;

83 
	mdû
;

84 
	mmodulo
;

85 
	mwšdow
;

86 
	mt1
;

87 
	mt2
;

88 
	mn2
;

89 } 
	tx25_hdlc_´Ùo
;

	@/usr/include/linux/if_addr.h

2 #iâdeà
__LINUX_IF_ADDR_H


3 
	#__LINUX_IF_ADDR_H


	)

5 
	~<lšux/ty³s.h
>

6 
	~<lšux/Ãšk.h
>

8 
	siçddrmsg
 {

9 
__u8
 
	miç_çmy
;

10 
__u8
 
	miç_´efixËn
;

11 
__u8
 
	miç_æags
;

12 
__u8
 
	miç_scİe
;

13 
__u32
 
	miç_šdex
;

27 
	mIFA_UNSPEC
,

28 
	mIFA_ADDRESS
,

29 
	mIFA_LOCAL
,

30 
	mIFA_LABEL
,

31 
	mIFA_BROADCAST
,

32 
	mIFA_ANYCAST
,

33 
	mIFA_CACHEINFO
,

34 
	mIFA_MULTICAST
,

35 
	mIFA_FLAGS
,

36 
	mIFA_RT_PRIORITY
,

37 
	mIFA_TARGET_NETNSID
,

38 
	m__IFA_MAX
,

41 
	#IFA_MAX
 (
__IFA_MAX
 - 1)

	)

44 
	#IFA_F_SECONDARY
 0x01

	)

45 
	#IFA_F_TEMPORARY
 
IFA_F_SECONDARY


	)

47 
	#IFA_F_NODAD
 0x02

	)

48 
	#IFA_F_OPTIMISTIC
 0x04

	)

49 
	#IFA_F_DADFAILED
 0x08

	)

50 
	#IFA_F_HOMEADDRESS
 0x10

	)

51 
	#IFA_F_DEPRECATED
 0x20

	)

52 
	#IFA_F_TENTATIVE
 0x40

	)

53 
	#IFA_F_PERMANENT
 0x80

	)

54 
	#IFA_F_MANAGETEMPADDR
 0x100

	)

55 
	#IFA_F_NOPREFIXROUTE
 0x200

	)

56 
	#IFA_F_MCAUTOJOIN
 0x400

	)

57 
	#IFA_F_STABLE_PRIVACY
 0x800

	)

59 
	siç_ÿchešfo
 {

60 
__u32
 
	miç_´eã»d
;

61 
__u32
 
	miç_v®id
;

62 
__u32
 
	mc¡amp
;

63 
__u32
 
	mt¡amp
;

67 
	#IFA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
içddrmsg
))))

	)

68 
	#IFA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
içddrmsg
))

	)

	@/usr/include/linux/if_link.h

2 #iâdeà
_LINUX_IF_LINK_H


3 
	#_LINUX_IF_LINK_H


	)

5 
	~<lšux/ty³s.h
>

6 
	~<lšux/Ãšk.h
>

9 
	s¹Æ_lšk_¡©s
 {

10 
__u32
 
	mrx_·ck‘s
;

11 
__u32
 
	mtx_·ck‘s
;

12 
__u32
 
	mrx_by‹s
;

13 
__u32
 
	mtx_by‹s
;

14 
__u32
 
	mrx_”rÜs
;

15 
__u32
 
	mtx_”rÜs
;

16 
__u32
 
	mrx_drİ³d
;

17 
__u32
 
	mtx_drİ³d
;

18 
__u32
 
	mmuÉiÿ¡
;

19 
__u32
 
	mcŞlisiÚs
;

21 
__u32
 
	mrx_Ëngth_”rÜs
;

22 
__u32
 
	mrx_ov”_”rÜs
;

23 
__u32
 
	mrx_üc_”rÜs
;

24 
__u32
 
	mrx_äame_”rÜs
;

25 
__u32
 
	mrx_fifo_”rÜs
;

26 
__u32
 
	mrx_mis£d_”rÜs
;

29 
__u32
 
	mtx_abÜ‹d_”rÜs
;

30 
__u32
 
	mtx_ÿ¼›r_”rÜs
;

31 
__u32
 
	mtx_fifo_”rÜs
;

32 
__u32
 
	mtx_h—¹b—t_”rÜs
;

33 
__u32
 
	mtx_wšdow_”rÜs
;

36 
__u32
 
	mrx_com´es£d
;

37 
__u32
 
	mtx_com´es£d
;

39 
__u32
 
	mrx_nohªdËr
;

215 
	s¹Æ_lšk_¡©s64
 {

216 
__u64
 
	mrx_·ck‘s
;

217 
__u64
 
	mtx_·ck‘s
;

218 
__u64
 
	mrx_by‹s
;

219 
__u64
 
	mtx_by‹s
;

220 
__u64
 
	mrx_”rÜs
;

221 
__u64
 
	mtx_”rÜs
;

222 
__u64
 
	mrx_drİ³d
;

223 
__u64
 
	mtx_drİ³d
;

224 
__u64
 
	mmuÉiÿ¡
;

225 
__u64
 
	mcŞlisiÚs
;

228 
__u64
 
	mrx_Ëngth_”rÜs
;

229 
__u64
 
	mrx_ov”_”rÜs
;

230 
__u64
 
	mrx_üc_”rÜs
;

231 
__u64
 
	mrx_äame_”rÜs
;

232 
__u64
 
	mrx_fifo_”rÜs
;

233 
__u64
 
	mrx_mis£d_”rÜs
;

236 
__u64
 
	mtx_abÜ‹d_”rÜs
;

237 
__u64
 
	mtx_ÿ¼›r_”rÜs
;

238 
__u64
 
	mtx_fifo_”rÜs
;

239 
__u64
 
	mtx_h—¹b—t_”rÜs
;

240 
__u64
 
	mtx_wšdow_”rÜs
;

243 
__u64
 
	mrx_com´es£d
;

244 
__u64
 
	mtx_com´es£d
;

245 
__u64
 
	mrx_nohªdËr
;

249 
	s¹Æ_lšk_ifm­
 {

250 
__u64
 
	mmem_¡¬t
;

251 
__u64
 
	mmem_’d
;

252 
__u64
 
	mba£_addr
;

253 
__u16
 
	mœq
;

254 
__u8
 
	mdma
;

255 
__u8
 
	mpÜt
;

277 
	mIFLA_UNSPEC
,

278 
	mIFLA_ADDRESS
,

279 
	mIFLA_BROADCAST
,

280 
	mIFLA_IFNAME
,

281 
	mIFLA_MTU
,

282 
	mIFLA_LINK
,

283 
	mIFLA_QDISC
,

284 
	mIFLA_STATS
,

285 
	mIFLA_COST
,

286 
	#IFLA_COST
 
IFLA_COST


	)

287 
	mIFLA_PRIORITY
,

288 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

289 
	mIFLA_MASTER
,

290 
	#IFLA_MASTER
 
IFLA_MASTER


	)

291 
	mIFLA_WIRELESS
,

292 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

293 
	mIFLA_PROTINFO
,

294 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

295 
	mIFLA_TXQLEN
,

296 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

297 
	mIFLA_MAP
,

298 
	#IFLA_MAP
 
IFLA_MAP


	)

299 
	mIFLA_WEIGHT
,

300 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

301 
	mIFLA_OPERSTATE
,

302 
	mIFLA_LINKMODE
,

303 
	mIFLA_LINKINFO
,

304 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

305 
	mIFLA_NET_NS_PID
,

306 
	mIFLA_IFALIAS
,

307 
	mIFLA_NUM_VF
,

308 
	mIFLA_VFINFO_LIST
,

309 
	mIFLA_STATS64
,

310 
	mIFLA_VF_PORTS
,

311 
	mIFLA_PORT_SELF
,

312 
	mIFLA_AF_SPEC
,

313 
	mIFLA_GROUP
,

314 
	mIFLA_NET_NS_FD
,

315 
	mIFLA_EXT_MASK
,

316 
	mIFLA_PROMISCUITY
,

317 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

318 
	mIFLA_NUM_TX_QUEUES
,

319 
	mIFLA_NUM_RX_QUEUES
,

320 
	mIFLA_CARRIER
,

321 
	mIFLA_PHYS_PORT_ID
,

322 
	mIFLA_CARRIER_CHANGES
,

323 
	mIFLA_PHYS_SWITCH_ID
,

324 
	mIFLA_LINK_NETNSID
,

325 
	mIFLA_PHYS_PORT_NAME
,

326 
	mIFLA_PROTO_DOWN
,

327 
	mIFLA_GSO_MAX_SEGS
,

328 
	mIFLA_GSO_MAX_SIZE
,

329 
	mIFLA_PAD
,

330 
	mIFLA_XDP
,

331 
	mIFLA_EVENT
,

332 
	mIFLA_NEW_NETNSID
,

333 
	mIFLA_IF_NETNSID
,

334 
	mIFLA_TARGET_NETNSID
 = 
IFLA_IF_NETNSID
,

335 
	mIFLA_CARRIER_UP_COUNT
,

336 
	mIFLA_CARRIER_DOWN_COUNT
,

337 
	mIFLA_NEW_IFINDEX
,

338 
	mIFLA_MIN_MTU
,

339 
	mIFLA_MAX_MTU
,

340 
	mIFLA_PROP_LIST
,

341 
	mIFLA_ALT_IFNAME
,

342 
	mIFLA_PERM_ADDRESS
,

343 
	mIFLA_PROTO_DOWN_REASON
,

348 
	mIFLA_PARENT_DEV_NAME
,

349 
	mIFLA_PARENT_DEV_BUS_NAME
,

351 
	m__IFLA_MAX


355 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

358 
	mIFLA_PROTO_DOWN_REASON_UNSPEC
,

359 
	mIFLA_PROTO_DOWN_REASON_MASK
,

360 
	mIFLA_PROTO_DOWN_REASON_VALUE
,

362 
	m__IFLA_PROTO_DOWN_REASON_CNT
,

363 
	mIFLA_PROTO_DOWN_REASON_MAX
 = 
__IFLA_PROTO_DOWN_REASON_CNT
 - 1

367 
	#IFLA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
ifšfomsg
))))

	)

368 
	#IFLA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
ifšfomsg
))

	)

371 
	mIFLA_INET_UNSPEC
,

372 
	mIFLA_INET_CONF
,

373 
	m__IFLA_INET_MAX
,

376 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

409 
	mIFLA_INET6_UNSPEC
,

410 
	mIFLA_INET6_FLAGS
,

411 
	mIFLA_INET6_CONF
,

412 
	mIFLA_INET6_STATS
,

413 
	mIFLA_INET6_MCAST
,

414 
	mIFLA_INET6_CACHEINFO
,

415 
	mIFLA_INET6_ICMP6STATS
,

416 
	mIFLA_INET6_TOKEN
,

417 
	mIFLA_INET6_ADDR_GEN_MODE
,

418 
	mIFLA_INET6_RA_MTU
,

419 
	m__IFLA_INET6_MAX


422 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

424 
	eš6_addr_g’_mode
 {

425 
	mIN6_ADDR_GEN_MODE_EUI64
,

426 
	mIN6_ADDR_GEN_MODE_NONE
,

427 
	mIN6_ADDR_GEN_MODE_STABLE_PRIVACY
,

428 
	mIN6_ADDR_GEN_MODE_RANDOM
,

434 
	mIFLA_BR_UNSPEC
,

435 
	mIFLA_BR_FORWARD_DELAY
,

436 
	mIFLA_BR_HELLO_TIME
,

437 
	mIFLA_BR_MAX_AGE
,

438 
	mIFLA_BR_AGEING_TIME
,

439 
	mIFLA_BR_STP_STATE
,

440 
	mIFLA_BR_PRIORITY
,

441 
	mIFLA_BR_VLAN_FILTERING
,

442 
	mIFLA_BR_VLAN_PROTOCOL
,

443 
	mIFLA_BR_GROUP_FWD_MASK
,

444 
	mIFLA_BR_ROOT_ID
,

445 
	mIFLA_BR_BRIDGE_ID
,

446 
	mIFLA_BR_ROOT_PORT
,

447 
	mIFLA_BR_ROOT_PATH_COST
,

448 
	mIFLA_BR_TOPOLOGY_CHANGE
,

449 
	mIFLA_BR_TOPOLOGY_CHANGE_DETECTED
,

450 
	mIFLA_BR_HELLO_TIMER
,

451 
	mIFLA_BR_TCN_TIMER
,

452 
	mIFLA_BR_TOPOLOGY_CHANGE_TIMER
,

453 
	mIFLA_BR_GC_TIMER
,

454 
	mIFLA_BR_GROUP_ADDR
,

455 
	mIFLA_BR_FDB_FLUSH
,

456 
	mIFLA_BR_MCAST_ROUTER
,

457 
	mIFLA_BR_MCAST_SNOOPING
,

458 
	mIFLA_BR_MCAST_QUERY_USE_IFADDR
,

459 
	mIFLA_BR_MCAST_QUERIER
,

460 
	mIFLA_BR_MCAST_HASH_ELASTICITY
,

461 
	mIFLA_BR_MCAST_HASH_MAX
,

462 
	mIFLA_BR_MCAST_LAST_MEMBER_CNT
,

463 
	mIFLA_BR_MCAST_STARTUP_QUERY_CNT
,

464 
	mIFLA_BR_MCAST_LAST_MEMBER_INTVL
,

465 
	mIFLA_BR_MCAST_MEMBERSHIP_INTVL
,

466 
	mIFLA_BR_MCAST_QUERIER_INTVL
,

467 
	mIFLA_BR_MCAST_QUERY_INTVL
,

468 
	mIFLA_BR_MCAST_QUERY_RESPONSE_INTVL
,

469 
	mIFLA_BR_MCAST_STARTUP_QUERY_INTVL
,

470 
	mIFLA_BR_NF_CALL_IPTABLES
,

471 
	mIFLA_BR_NF_CALL_IP6TABLES
,

472 
	mIFLA_BR_NF_CALL_ARPTABLES
,

473 
	mIFLA_BR_VLAN_DEFAULT_PVID
,

474 
	mIFLA_BR_PAD
,

475 
	mIFLA_BR_VLAN_STATS_ENABLED
,

476 
	mIFLA_BR_MCAST_STATS_ENABLED
,

477 
	mIFLA_BR_MCAST_IGMP_VERSION
,

478 
	mIFLA_BR_MCAST_MLD_VERSION
,

479 
	mIFLA_BR_VLAN_STATS_PER_PORT
,

480 
	mIFLA_BR_MULTI_BOOLOPT
,

481 
	mIFLA_BR_MCAST_QUERIER_STATE
,

482 
	m__IFLA_BR_MAX
,

485 
	#IFLA_BR_MAX
 (
__IFLA_BR_MAX
 - 1)

	)

487 
	siæa_bridge_id
 {

488 
__u8
 
	m´io
[2];

489 
__u8
 
	maddr
[6];

493 
	mBRIDGE_MODE_UNSPEC
,

494 
	mBRIDGE_MODE_HAIRPIN
,

498 
	mIFLA_BRPORT_UNSPEC
,

499 
	mIFLA_BRPORT_STATE
,

500 
	mIFLA_BRPORT_PRIORITY
,

501 
	mIFLA_BRPORT_COST
,

502 
	mIFLA_BRPORT_MODE
,

503 
	mIFLA_BRPORT_GUARD
,

504 
	mIFLA_BRPORT_PROTECT
,

505 
	mIFLA_BRPORT_FAST_LEAVE
,

506 
	mIFLA_BRPORT_LEARNING
,

507 
	mIFLA_BRPORT_UNICAST_FLOOD
,

508 
	mIFLA_BRPORT_PROXYARP
,

509 
	mIFLA_BRPORT_LEARNING_SYNC
,

510 
	mIFLA_BRPORT_PROXYARP_WIFI
,

511 
	mIFLA_BRPORT_ROOT_ID
,

512 
	mIFLA_BRPORT_BRIDGE_ID
,

513 
	mIFLA_BRPORT_DESIGNATED_PORT
,

514 
	mIFLA_BRPORT_DESIGNATED_COST
,

515 
	mIFLA_BRPORT_ID
,

516 
	mIFLA_BRPORT_NO
,

517 
	mIFLA_BRPORT_TOPOLOGY_CHANGE_ACK
,

518 
	mIFLA_BRPORT_CONFIG_PENDING
,

519 
	mIFLA_BRPORT_MESSAGE_AGE_TIMER
,

520 
	mIFLA_BRPORT_FORWARD_DELAY_TIMER
,

521 
	mIFLA_BRPORT_HOLD_TIMER
,

522 
	mIFLA_BRPORT_FLUSH
,

523 
	mIFLA_BRPORT_MULTICAST_ROUTER
,

524 
	mIFLA_BRPORT_PAD
,

525 
	mIFLA_BRPORT_MCAST_FLOOD
,

526 
	mIFLA_BRPORT_MCAST_TO_UCAST
,

527 
	mIFLA_BRPORT_VLAN_TUNNEL
,

528 
	mIFLA_BRPORT_BCAST_FLOOD
,

529 
	mIFLA_BRPORT_GROUP_FWD_MASK
,

530 
	mIFLA_BRPORT_NEIGH_SUPPRESS
,

531 
	mIFLA_BRPORT_ISOLATED
,

532 
	mIFLA_BRPORT_BACKUP_PORT
,

533 
	mIFLA_BRPORT_MRP_RING_OPEN
,

534 
	mIFLA_BRPORT_MRP_IN_OPEN
,

535 
	mIFLA_BRPORT_MCAST_EHT_HOSTS_LIMIT
,

536 
	mIFLA_BRPORT_MCAST_EHT_HOSTS_CNT
,

537 
	m__IFLA_BRPORT_MAX


539 
	#IFLA_BRPORT_MAX
 (
__IFLA_BRPORT_MAX
 - 1)

	)

541 
	siæa_ÿchešfo
 {

542 
__u32
 
	mmax_»asm_Ën
;

543 
__u32
 
	mt¡amp
;

544 
__u32
 
	m»achabË_time
;

545 
__u32
 
	m»Œªs_time
;

549 
	mIFLA_INFO_UNSPEC
,

550 
	mIFLA_INFO_KIND
,

551 
	mIFLA_INFO_DATA
,

552 
	mIFLA_INFO_XSTATS
,

553 
	mIFLA_INFO_SLAVE_KIND
,

554 
	mIFLA_INFO_SLAVE_DATA
,

555 
	m__IFLA_INFO_MAX
,

558 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

563 
	mIFLA_VLAN_UNSPEC
,

564 
	mIFLA_VLAN_ID
,

565 
	mIFLA_VLAN_FLAGS
,

566 
	mIFLA_VLAN_EGRESS_QOS
,

567 
	mIFLA_VLAN_INGRESS_QOS
,

568 
	mIFLA_VLAN_PROTOCOL
,

569 
	m__IFLA_VLAN_MAX
,

572 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

574 
	siæa_vÏn_æags
 {

575 
__u32
 
	mæags
;

576 
__u32
 
	mmask
;

580 
	mIFLA_VLAN_QOS_UNSPEC
,

581 
	mIFLA_VLAN_QOS_MAPPING
,

582 
	m__IFLA_VLAN_QOS_MAX


585 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

587 
	siæa_vÏn_qos_m­pšg
 {

588 
__u32
 
	mäom
;

589 
__u32
 
	mto
;

594 
	mIFLA_MACVLAN_UNSPEC
,

595 
	mIFLA_MACVLAN_MODE
,

596 
	mIFLA_MACVLAN_FLAGS
,

597 
	mIFLA_MACVLAN_MACADDR_MODE
,

598 
	mIFLA_MACVLAN_MACADDR
,

599 
	mIFLA_MACVLAN_MACADDR_DATA
,

600 
	mIFLA_MACVLAN_MACADDR_COUNT
,

601 
	mIFLA_MACVLAN_BC_QUEUE_LEN
,

602 
	mIFLA_MACVLAN_BC_QUEUE_LEN_USED
,

603 
	m__IFLA_MACVLAN_MAX
,

606 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

608 
	emacvÏn_mode
 {

609 
	mMACVLAN_MODE_PRIVATE
 = 1,

610 
	mMACVLAN_MODE_VEPA
 = 2,

611 
	mMACVLAN_MODE_BRIDGE
 = 4,

612 
	mMACVLAN_MODE_PASSTHRU
 = 8,

613 
	mMACVLAN_MODE_SOURCE
 = 16,

616 
	emacvÏn_maÿddr_mode
 {

617 
	mMACVLAN_MACADDR_ADD
,

618 
	mMACVLAN_MACADDR_DEL
,

619 
	mMACVLAN_MACADDR_FLUSH
,

620 
	mMACVLAN_MACADDR_SET
,

623 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

624 
	#MACVLAN_FLAG_NODST
 2

	)

628 
	mIFLA_VRF_UNSPEC
,

629 
	mIFLA_VRF_TABLE
,

630 
	m__IFLA_VRF_MAX


633 
	#IFLA_VRF_MAX
 (
__IFLA_VRF_MAX
 - 1)

	)

636 
	mIFLA_VRF_PORT_UNSPEC
,

637 
	mIFLA_VRF_PORT_TABLE
,

638 
	m__IFLA_VRF_PORT_MAX


641 
	#IFLA_VRF_PORT_MAX
 (
__IFLA_VRF_PORT_MAX
 - 1)

	)

645 
	mIFLA_MACSEC_UNSPEC
,

646 
	mIFLA_MACSEC_SCI
,

647 
	mIFLA_MACSEC_PORT
,

648 
	mIFLA_MACSEC_ICV_LEN
,

649 
	mIFLA_MACSEC_CIPHER_SUITE
,

650 
	mIFLA_MACSEC_WINDOW
,

651 
	mIFLA_MACSEC_ENCODING_SA
,

652 
	mIFLA_MACSEC_ENCRYPT
,

653 
	mIFLA_MACSEC_PROTECT
,

654 
	mIFLA_MACSEC_INC_SCI
,

655 
	mIFLA_MACSEC_ES
,

656 
	mIFLA_MACSEC_SCB
,

657 
	mIFLA_MACSEC_REPLAY_PROTECT
,

658 
	mIFLA_MACSEC_VALIDATION
,

659 
	mIFLA_MACSEC_PAD
,

660 
	mIFLA_MACSEC_OFFLOAD
,

661 
	m__IFLA_MACSEC_MAX
,

664 
	#IFLA_MACSEC_MAX
 (
__IFLA_MACSEC_MAX
 - 1)

	)

668 
	mIFLA_XFRM_UNSPEC
,

669 
	mIFLA_XFRM_LINK
,

670 
	mIFLA_XFRM_IF_ID
,

671 
	m__IFLA_XFRM_MAX


674 
	#IFLA_XFRM_MAX
 (
__IFLA_XFRM_MAX
 - 1)

	)

676 
	emac£c_v®id©iÚ_ty³
 {

677 
	mMACSEC_VALIDATE_DISABLED
 = 0,

678 
	mMACSEC_VALIDATE_CHECK
 = 1,

679 
	mMACSEC_VALIDATE_STRICT
 = 2,

680 
	m__MACSEC_VALIDATE_END
,

681 
	mMACSEC_VALIDATE_MAX
 = 
__MACSEC_VALIDATE_END
 - 1,

684 
	emac£c_ofæßd
 {

685 
	mMACSEC_OFFLOAD_OFF
 = 0,

686 
	mMACSEC_OFFLOAD_PHY
 = 1,

687 
	mMACSEC_OFFLOAD_MAC
 = 2,

688 
	m__MACSEC_OFFLOAD_END
,

689 
	mMACSEC_OFFLOAD_MAX
 = 
__MACSEC_OFFLOAD_END
 - 1,

694 
	mIFLA_IPVLAN_UNSPEC
,

695 
	mIFLA_IPVLAN_MODE
,

696 
	mIFLA_IPVLAN_FLAGS
,

697 
	m__IFLA_IPVLAN_MAX


700 
	#IFLA_IPVLAN_MAX
 (
__IFLA_IPVLAN_MAX
 - 1)

	)

702 
	evÏn_mode
 {

703 
	mIPVLAN_MODE_L2
 = 0,

704 
	mIPVLAN_MODE_L3
,

705 
	mIPVLAN_MODE_L3S
,

706 
	mIPVLAN_MODE_MAX


709 
	#IPVLAN_F_PRIVATE
 0x01

	)

710 
	#IPVLAN_F_VEPA
 0x02

	)

714 
	mIFLA_VXLAN_UNSPEC
,

715 
	mIFLA_VXLAN_ID
,

716 
	mIFLA_VXLAN_GROUP
,

717 
	mIFLA_VXLAN_LINK
,

718 
	mIFLA_VXLAN_LOCAL
,

719 
	mIFLA_VXLAN_TTL
,

720 
	mIFLA_VXLAN_TOS
,

721 
	mIFLA_VXLAN_LEARNING
,

722 
	mIFLA_VXLAN_AGEING
,

723 
	mIFLA_VXLAN_LIMIT
,

724 
	mIFLA_VXLAN_PORT_RANGE
,

725 
	mIFLA_VXLAN_PROXY
,

726 
	mIFLA_VXLAN_RSC
,

727 
	mIFLA_VXLAN_L2MISS
,

728 
	mIFLA_VXLAN_L3MISS
,

729 
	mIFLA_VXLAN_PORT
,

730 
	mIFLA_VXLAN_GROUP6
,

731 
	mIFLA_VXLAN_LOCAL6
,

732 
	mIFLA_VXLAN_UDP_CSUM
,

733 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_TX
,

734 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_RX
,

735 
	mIFLA_VXLAN_REMCSUM_TX
,

736 
	mIFLA_VXLAN_REMCSUM_RX
,

737 
	mIFLA_VXLAN_GBP
,

738 
	mIFLA_VXLAN_REMCSUM_NOPARTIAL
,

739 
	mIFLA_VXLAN_COLLECT_METADATA
,

740 
	mIFLA_VXLAN_LABEL
,

741 
	mIFLA_VXLAN_GPE
,

742 
	mIFLA_VXLAN_TTL_INHERIT
,

743 
	mIFLA_VXLAN_DF
,

744 
	mIFLA_VXLAN_FAN_MAP
 = 33,

745 
	m__IFLA_VXLAN_MAX


747 
	#IFLA_VXLAN_MAX
 (
__IFLA_VXLAN_MAX
 - 1)

	)

749 
	siæa_vxÏn_pÜt_¿nge
 {

750 
__be16
 
	mlow
;

751 
__be16
 
	mhigh
;

754 
	eiæa_vxÏn_df
 {

755 
	mVXLAN_DF_UNSET
 = 0,

756 
	mVXLAN_DF_SET
,

757 
	mVXLAN_DF_INHERIT
,

758 
	m__VXLAN_DF_END
,

759 
	mVXLAN_DF_MAX
 = 
__VXLAN_DF_END
 - 1,

764 
	mIFLA_GENEVE_UNSPEC
,

765 
	mIFLA_GENEVE_ID
,

766 
	mIFLA_GENEVE_REMOTE
,

767 
	mIFLA_GENEVE_TTL
,

768 
	mIFLA_GENEVE_TOS
,

769 
	mIFLA_GENEVE_PORT
,

770 
	mIFLA_GENEVE_COLLECT_METADATA
,

771 
	mIFLA_GENEVE_REMOTE6
,

772 
	mIFLA_GENEVE_UDP_CSUM
,

773 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_TX
,

774 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_RX
,

775 
	mIFLA_GENEVE_LABEL
,

776 
	mIFLA_GENEVE_TTL_INHERIT
,

777 
	mIFLA_GENEVE_DF
,

778 
	m__IFLA_GENEVE_MAX


780 
	#IFLA_GENEVE_MAX
 (
__IFLA_GENEVE_MAX
 - 1)

	)

782 
	eiæa_g’eve_df
 {

783 
	mGENEVE_DF_UNSET
 = 0,

784 
	mGENEVE_DF_SET
,

785 
	mGENEVE_DF_INHERIT
,

786 
	m__GENEVE_DF_END
,

787 
	mGENEVE_DF_MAX
 = 
__GENEVE_DF_END
 - 1,

792 
	mIFLA_BAREUDP_UNSPEC
,

793 
	mIFLA_BAREUDP_PORT
,

794 
	mIFLA_BAREUDP_ETHERTYPE
,

795 
	mIFLA_BAREUDP_SRCPORT_MIN
,

796 
	mIFLA_BAREUDP_MULTIPROTO_MODE
,

797 
	m__IFLA_BAREUDP_MAX


800 
	#IFLA_BAREUDP_MAX
 (
__IFLA_BAREUDP_MAX
 - 1)

	)

804 
	mIFLA_PPP_UNSPEC
,

805 
	mIFLA_PPP_DEV_FD
,

806 
	m__IFLA_PPP_MAX


808 
	#IFLA_PPP_MAX
 (
__IFLA_PPP_MAX
 - 1)

	)

812 
	eiæa_g_rŞe
 {

813 
	mGTP_ROLE_GGSN
 = 0,

814 
	mGTP_ROLE_SGSN
,

818 
	mIFLA_GTP_UNSPEC
,

819 
	mIFLA_GTP_FD0
,

820 
	mIFLA_GTP_FD1
,

821 
	mIFLA_GTP_PDP_HASHSIZE
,

822 
	mIFLA_GTP_ROLE
,

823 
	m__IFLA_GTP_MAX
,

825 
	#IFLA_GTP_MAX
 (
__IFLA_GTP_MAX
 - 1)

	)

830 
	mIFLA_BOND_UNSPEC
,

831 
	mIFLA_BOND_MODE
,

832 
	mIFLA_BOND_ACTIVE_SLAVE
,

833 
	mIFLA_BOND_MIIMON
,

834 
	mIFLA_BOND_UPDELAY
,

835 
	mIFLA_BOND_DOWNDELAY
,

836 
	mIFLA_BOND_USE_CARRIER
,

837 
	mIFLA_BOND_ARP_INTERVAL
,

838 
	mIFLA_BOND_ARP_IP_TARGET
,

839 
	mIFLA_BOND_ARP_VALIDATE
,

840 
	mIFLA_BOND_ARP_ALL_TARGETS
,

841 
	mIFLA_BOND_PRIMARY
,

842 
	mIFLA_BOND_PRIMARY_RESELECT
,

843 
	mIFLA_BOND_FAIL_OVER_MAC
,

844 
	mIFLA_BOND_XMIT_HASH_POLICY
,

845 
	mIFLA_BOND_RESEND_IGMP
,

846 
	mIFLA_BOND_NUM_PEER_NOTIF
,

847 
	mIFLA_BOND_ALL_SLAVES_ACTIVE
,

848 
	mIFLA_BOND_MIN_LINKS
,

849 
	mIFLA_BOND_LP_INTERVAL
,

850 
	mIFLA_BOND_PACKETS_PER_SLAVE
,

851 
	mIFLA_BOND_AD_LACP_RATE
,

852 
	mIFLA_BOND_AD_SELECT
,

853 
	mIFLA_BOND_AD_INFO
,

854 
	mIFLA_BOND_AD_ACTOR_SYS_PRIO
,

855 
	mIFLA_BOND_AD_USER_PORT_KEY
,

856 
	mIFLA_BOND_AD_ACTOR_SYSTEM
,

857 
	mIFLA_BOND_TLB_DYNAMIC_LB
,

858 
	mIFLA_BOND_PEER_NOTIF_DELAY
,

859 
	mIFLA_BOND_AD_LACP_ACTIVE
,

860 
	mIFLA_BOND_MISSED_MAX
,

861 
	m__IFLA_BOND_MAX
,

864 
	#IFLA_BOND_MAX
 (
__IFLA_BOND_MAX
 - 1)

	)

867 
	mIFLA_BOND_AD_INFO_UNSPEC
,

868 
	mIFLA_BOND_AD_INFO_AGGREGATOR
,

869 
	mIFLA_BOND_AD_INFO_NUM_PORTS
,

870 
	mIFLA_BOND_AD_INFO_ACTOR_KEY
,

871 
	mIFLA_BOND_AD_INFO_PARTNER_KEY
,

872 
	mIFLA_BOND_AD_INFO_PARTNER_MAC
,

873 
	m__IFLA_BOND_AD_INFO_MAX
,

876 
	#IFLA_BOND_AD_INFO_MAX
 (
__IFLA_BOND_AD_INFO_MAX
 - 1)

	)

879 
	mIFLA_BOND_SLAVE_UNSPEC
,

880 
	mIFLA_BOND_SLAVE_STATE
,

881 
	mIFLA_BOND_SLAVE_MII_STATUS
,

882 
	mIFLA_BOND_SLAVE_LINK_FAILURE_COUNT
,

883 
	mIFLA_BOND_SLAVE_PERM_HWADDR
,

884 
	mIFLA_BOND_SLAVE_QUEUE_ID
,

885 
	mIFLA_BOND_SLAVE_AD_AGGREGATOR_ID
,

886 
	mIFLA_BOND_SLAVE_AD_ACTOR_OPER_PORT_STATE
,

887 
	mIFLA_BOND_SLAVE_AD_PARTNER_OPER_PORT_STATE
,

888 
	m__IFLA_BOND_SLAVE_MAX
,

891 
	#IFLA_BOND_SLAVE_MAX
 (
__IFLA_BOND_SLAVE_MAX
 - 1)

	)

896 
	mIFLA_VF_INFO_UNSPEC
,

897 
	mIFLA_VF_INFO
,

898 
	m__IFLA_VF_INFO_MAX
,

901 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

904 
	mIFLA_VF_UNSPEC
,

905 
	mIFLA_VF_MAC
,

906 
	mIFLA_VF_VLAN
,

907 
	mIFLA_VF_TX_RATE
,

908 
	mIFLA_VF_SPOOFCHK
,

909 
	mIFLA_VF_LINK_STATE
,

910 
	mIFLA_VF_RATE
,

911 
	mIFLA_VF_RSS_QUERY_EN
,

914 
	mIFLA_VF_STATS
,

915 
	mIFLA_VF_TRUST
,

916 
	mIFLA_VF_IB_NODE_GUID
,

917 
	mIFLA_VF_IB_PORT_GUID
,

918 
	mIFLA_VF_VLAN_LIST
,

919 
	mIFLA_VF_BROADCAST
,

920 
	m__IFLA_VF_MAX
,

923 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

925 
	siæa_vf_mac
 {

926 
__u32
 
	mvf
;

927 
__u8
 
	mmac
[32];

930 
	siæa_vf_brßdÿ¡
 {

931 
__u8
 
	mbrßdÿ¡
[32];

934 
	siæa_vf_vÏn
 {

935 
__u32
 
	mvf
;

936 
__u32
 
	mvÏn
;

937 
__u32
 
	mqos
;

941 
	mIFLA_VF_VLAN_INFO_UNSPEC
,

942 
	mIFLA_VF_VLAN_INFO
,

943 
	m__IFLA_VF_VLAN_INFO_MAX
,

946 
	#IFLA_VF_VLAN_INFO_MAX
 (
__IFLA_VF_VLAN_INFO_MAX
 - 1)

	)

947 
	#MAX_VLAN_LIST_LEN
 1

	)

949 
	siæa_vf_vÏn_šfo
 {

950 
__u32
 
	mvf
;

951 
__u32
 
	mvÏn
;

952 
__u32
 
	mqos
;

953 
__be16
 
	mvÏn_´Ùo
;

956 
	siæa_vf_tx_¿‹
 {

957 
__u32
 
	mvf
;

958 
__u32
 
	m¿‹
;

961 
	siæa_vf_¿‹
 {

962 
__u32
 
	mvf
;

963 
__u32
 
	mmš_tx_¿‹
;

964 
__u32
 
	mmax_tx_¿‹
;

967 
	siæa_vf_¥oofchk
 {

968 
__u32
 
	mvf
;

969 
__u32
 
	m£‰šg
;

972 
	siæa_vf_guid
 {

973 
__u32
 
	mvf
;

974 
__u64
 
	mguid
;

978 
	mIFLA_VF_LINK_STATE_AUTO
,

979 
	mIFLA_VF_LINK_STATE_ENABLE
,

980 
	mIFLA_VF_LINK_STATE_DISABLE
,

981 
	m__IFLA_VF_LINK_STATE_MAX
,

984 
	siæa_vf_lšk_¡©e
 {

985 
__u32
 
	mvf
;

986 
__u32
 
	mlšk_¡©e
;

989 
	siæa_vf_rss_qu”y_’
 {

990 
__u32
 
	mvf
;

991 
__u32
 
	m£‰šg
;

995 
	mIFLA_VF_STATS_RX_PACKETS
,

996 
	mIFLA_VF_STATS_TX_PACKETS
,

997 
	mIFLA_VF_STATS_RX_BYTES
,

998 
	mIFLA_VF_STATS_TX_BYTES
,

999 
	mIFLA_VF_STATS_BROADCAST
,

1000 
	mIFLA_VF_STATS_MULTICAST
,

1001 
	mIFLA_VF_STATS_PAD
,

1002 
	mIFLA_VF_STATS_RX_DROPPED
,

1003 
	mIFLA_VF_STATS_TX_DROPPED
,

1004 
	m__IFLA_VF_STATS_MAX
,

1007 
	#IFLA_VF_STATS_MAX
 (
__IFLA_VF_STATS_MAX
 - 1)

	)

1009 
	siæa_vf_Œu¡
 {

1010 
__u32
 
	mvf
;

1011 
__u32
 
	m£‰šg
;

1030 
	mIFLA_VF_PORT_UNSPEC
,

1031 
	mIFLA_VF_PORT
,

1032 
	m__IFLA_VF_PORT_MAX
,

1035 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

1038 
	mIFLA_PORT_UNSPEC
,

1039 
	mIFLA_PORT_VF
,

1040 
	mIFLA_PORT_PROFILE
,

1041 
	mIFLA_PORT_VSI_TYPE
,

1042 
	mIFLA_PORT_INSTANCE_UUID
,

1043 
	mIFLA_PORT_HOST_UUID
,

1044 
	mIFLA_PORT_REQUEST
,

1045 
	mIFLA_PORT_RESPONSE
,

1046 
	m__IFLA_PORT_MAX
,

1049 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

1051 
	#PORT_PROFILE_MAX
 40

	)

1052 
	#PORT_UUID_MAX
 16

	)

1053 
	#PORT_SELF_VF
 -1

	)

1056 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

1057 
	mPORT_REQUEST_PREASSOCIATE_RR
,

1058 
	mPORT_REQUEST_ASSOCIATE
,

1059 
	mPORT_REQUEST_DISASSOCIATE
,

1063 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

1064 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

1065 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

1066 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

1067 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

1068 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

1069 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

1071 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

1072 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

1073 
	mPORT_PROFILE_RESPONSE_INVALID
,

1074 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

1075 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

1076 
	mPORT_PROFILE_RESPONSE_ERROR
,

1079 
	siæa_pÜt_vsi
 {

1080 
__u8
 
	mvsi_mgr_id
;

1081 
__u8
 
	mvsi_ty³_id
[3];

1082 
__u8
 
	mvsi_ty³_v”siÚ
;

1083 
__u8
 
	m·d
[3];

1090 
	mIFLA_IPOIB_UNSPEC
,

1091 
	mIFLA_IPOIB_PKEY
,

1092 
	mIFLA_IPOIB_MODE
,

1093 
	mIFLA_IPOIB_UMCAST
,

1094 
	m__IFLA_IPOIB_MAX


1098 
	mIPOIB_MODE_DATAGRAM
 = 0,

1099 
	mIPOIB_MODE_CONNECTED
 = 1,

1102 
	#IFLA_IPOIB_MAX
 (
__IFLA_IPOIB_MAX
 - 1)

	)

1109 
	mHSR_PROTOCOL_HSR
,

1110 
	mHSR_PROTOCOL_PRP
,

1111 
	mHSR_PROTOCOL_MAX
,

1115 
	mIFLA_HSR_UNSPEC
,

1116 
	mIFLA_HSR_SLAVE1
,

1117 
	mIFLA_HSR_SLAVE2
,

1118 
	mIFLA_HSR_MULTICAST_SPEC
,

1119 
	mIFLA_HSR_SUPERVISION_ADDR
,

1120 
	mIFLA_HSR_SEQ_NR
,

1121 
	mIFLA_HSR_VERSION
,

1122 
	mIFLA_HSR_PROTOCOL
,

1125 
	m__IFLA_HSR_MAX
,

1128 
	#IFLA_HSR_MAX
 (
__IFLA_HSR_MAX
 - 1)

	)

1132 
	sif_¡©s_msg
 {

1133 
__u8
 
	mçmy
;

1134 
__u8
 
	m·d1
;

1135 
__u16
 
	m·d2
;

1136 
__u32
 
	mifšdex
;

1137 
__u32
 
	mf‹r_mask
;

1144 
	mIFLA_STATS_UNSPEC
,

1145 
	mIFLA_STATS_LINK_64
,

1146 
	mIFLA_STATS_LINK_XSTATS
,

1147 
	mIFLA_STATS_LINK_XSTATS_SLAVE
,

1148 
	mIFLA_STATS_LINK_OFFLOAD_XSTATS
,

1149 
	mIFLA_STATS_AF_SPEC
,

1150 
	m__IFLA_STATS_MAX
,

1153 
	#IFLA_STATS_MAX
 (
__IFLA_STATS_MAX
 - 1)

	)

1155 
	#IFLA_STATS_FILTER_BIT
(
ATTR
è(1 << (ATTR - 1))

	)

1163 
	mLINK_XSTATS_TYPE_UNSPEC
,

1164 
	mLINK_XSTATS_TYPE_BRIDGE
,

1165 
	mLINK_XSTATS_TYPE_BOND
,

1166 
	m__LINK_XSTATS_TYPE_MAX


1168 
	#LINK_XSTATS_TYPE_MAX
 (
__LINK_XSTATS_TYPE_MAX
 - 1)

	)

1172 
	mIFLA_OFFLOAD_XSTATS_UNSPEC
,

1173 
	mIFLA_OFFLOAD_XSTATS_CPU_HIT
,

1174 
	m__IFLA_OFFLOAD_XSTATS_MAX


1176 
	#IFLA_OFFLOAD_XSTATS_MAX
 (
__IFLA_OFFLOAD_XSTATS_MAX
 - 1)

	)

1180 
	#XDP_FLAGS_UPDATE_IF_NOEXIST
 (1U << 0)

	)

1181 
	#XDP_FLAGS_SKB_MODE
 (1U << 1)

	)

1182 
	#XDP_FLAGS_DRV_MODE
 (1U << 2)

	)

1183 
	#XDP_FLAGS_HW_MODE
 (1U << 3)

	)

1184 
	#XDP_FLAGS_REPLACE
 (1U << 4)

	)

1185 
	#XDP_FLAGS_MODES
 (
XDP_FLAGS_SKB_MODE
 | \

1186 
XDP_FLAGS_DRV_MODE
 | \

1187 
XDP_FLAGS_HW_MODE
)

	)

1188 
	#XDP_FLAGS_MASK
 (
XDP_FLAGS_UPDATE_IF_NOEXIST
 | \

1189 
XDP_FLAGS_MODES
 | 
XDP_FLAGS_REPLACE
)

	)

1193 
	mXDP_ATTACHED_NONE
 = 0,

1194 
	mXDP_ATTACHED_DRV
,

1195 
	mXDP_ATTACHED_SKB
,

1196 
	mXDP_ATTACHED_HW
,

1197 
	mXDP_ATTACHED_MULTI
,

1201 
	mIFLA_XDP_UNSPEC
,

1202 
	mIFLA_XDP_FD
,

1203 
	mIFLA_XDP_ATTACHED
,

1204 
	mIFLA_XDP_FLAGS
,

1205 
	mIFLA_XDP_PROG_ID
,

1206 
	mIFLA_XDP_DRV_PROG_ID
,

1207 
	mIFLA_XDP_SKB_PROG_ID
,

1208 
	mIFLA_XDP_HW_PROG_ID
,

1209 
	mIFLA_XDP_EXPECTED_FD
,

1210 
	m__IFLA_XDP_MAX
,

1213 
	#IFLA_XDP_MAX
 (
__IFLA_XDP_MAX
 - 1)

	)

1216 
	mIFLA_EVENT_NONE
,

1217 
	mIFLA_EVENT_REBOOT
,

1218 
	mIFLA_EVENT_FEATURES
,

1219 
	mIFLA_EVENT_BONDING_FAILOVER
,

1220 
	mIFLA_EVENT_NOTIFY_PEERS
,

1221 
	mIFLA_EVENT_IGMP_RESEND
,

1222 
	mIFLA_EVENT_BONDING_OPTIONS
,

1228 
	mIFLA_TUN_UNSPEC
,

1229 
	mIFLA_TUN_OWNER
,

1230 
	mIFLA_TUN_GROUP
,

1231 
	mIFLA_TUN_TYPE
,

1232 
	mIFLA_TUN_PI
,

1233 
	mIFLA_TUN_VNET_HDR
,

1234 
	mIFLA_TUN_PERSIST
,

1235 
	mIFLA_TUN_MULTI_QUEUE
,

1236 
	mIFLA_TUN_NUM_QUEUES
,

1237 
	mIFLA_TUN_NUM_DISABLED_QUEUES
,

1238 
	m__IFLA_TUN_MAX
,

1241 
	#IFLA_TUN_MAX
 (
__IFLA_TUN_MAX
 - 1)

	)

1245 
	#RMNET_FLAGS_INGRESS_DEAGGREGATION
 (1U << 0)

	)

1246 
	#RMNET_FLAGS_INGRESS_MAP_COMMANDS
 (1U << 1)

	)

1247 
	#RMNET_FLAGS_INGRESS_MAP_CKSUMV4
 (1U << 2)

	)

1248 
	#RMNET_FLAGS_EGRESS_MAP_CKSUMV4
 (1U << 3)

	)

1249 
	#RMNET_FLAGS_INGRESS_MAP_CKSUMV5
 (1U << 4)

	)

1250 
	#RMNET_FLAGS_EGRESS_MAP_CKSUMV5
 (1U << 5)

	)

1253 
	mIFLA_RMNET_UNSPEC
,

1254 
	mIFLA_RMNET_MUX_ID
,

1255 
	mIFLA_RMNET_FLAGS
,

1256 
	m__IFLA_RMNET_MAX
,

1259 
	#IFLA_RMNET_MAX
 (
__IFLA_RMNET_MAX
 - 1)

	)

1261 
	siæa_rmÃt_æags
 {

1262 
__u32
 
	mæags
;

1263 
__u32
 
	mmask
;

1269 
	mIFLA_MCTP_UNSPEC
,

1270 
	mIFLA_MCTP_NET
,

1271 
	m__IFLA_MCTP_MAX
,

1274 
	#IFLA_MCTP_MAX
 (
__IFLA_MCTP_MAX
 - 1)

	)

	@/usr/include/linux/if_packet.h

2 #iâdeà
__LINUX_IF_PACKET_H


3 
	#__LINUX_IF_PACKET_H


	)

5 
	~<asm/by‹Üd”.h
>

6 
	~<lšux/ty³s.h
>

8 
	ssockaddr_pkt
 {

9 
	m¥kt_çmy
;

10 
	m¥kt_deviû
[14];

11 
__be16
 
	m¥kt_´ÙocŞ
;

14 
	ssockaddr_Î
 {

15 
	m¦l_çmy
;

16 
__be16
 
	m¦l_´ÙocŞ
;

17 
	m¦l_ifšdex
;

18 
	m¦l_h©y³
;

19 
	m¦l_pk‰y³
;

20 
	m¦l_h®’
;

21 
	m¦l_addr
[8];

26 
	#PACKET_HOST
 0

	)

27 
	#PACKET_BROADCAST
 1

	)

28 
	#PACKET_MULTICAST
 2

	)

29 
	#PACKET_OTHERHOST
 3

	)

30 
	#PACKET_OUTGOING
 4

	)

31 
	#PACKET_LOOPBACK
 5

	)

32 
	#PACKET_USER
 6

	)

33 
	#PACKET_KERNEL
 7

	)

35 
	#PACKET_FASTROUTE
 6

	)

39 
	#PACKET_ADD_MEMBERSHIP
 1

	)

40 
	#PACKET_DROP_MEMBERSHIP
 2

	)

41 
	#PACKET_RECV_OUTPUT
 3

	)

43 
	#PACKET_RX_RING
 5

	)

44 
	#PACKET_STATISTICS
 6

	)

45 
	#PACKET_COPY_THRESH
 7

	)

46 
	#PACKET_AUXDATA
 8

	)

47 
	#PACKET_ORIGDEV
 9

	)

48 
	#PACKET_VERSION
 10

	)

49 
	#PACKET_HDRLEN
 11

	)

50 
	#PACKET_RESERVE
 12

	)

51 
	#PACKET_TX_RING
 13

	)

52 
	#PACKET_LOSS
 14

	)

53 
	#PACKET_VNET_HDR
 15

	)

54 
	#PACKET_TX_TIMESTAMP
 16

	)

55 
	#PACKET_TIMESTAMP
 17

	)

56 
	#PACKET_FANOUT
 18

	)

57 
	#PACKET_TX_HAS_OFF
 19

	)

58 
	#PACKET_QDISC_BYPASS
 20

	)

59 
	#PACKET_ROLLOVER_STATS
 21

	)

60 
	#PACKET_FANOUT_DATA
 22

	)

61 
	#PACKET_IGNORE_OUTGOING
 23

	)

63 
	#PACKET_FANOUT_HASH
 0

	)

64 
	#PACKET_FANOUT_LB
 1

	)

65 
	#PACKET_FANOUT_CPU
 2

	)

66 
	#PACKET_FANOUT_ROLLOVER
 3

	)

67 
	#PACKET_FANOUT_RND
 4

	)

68 
	#PACKET_FANOUT_QM
 5

	)

69 
	#PACKET_FANOUT_CBPF
 6

	)

70 
	#PACKET_FANOUT_EBPF
 7

	)

71 
	#PACKET_FANOUT_FLAG_ROLLOVER
 0x1000

	)

72 
	#PACKET_FANOUT_FLAG_UNIQUEID
 0x2000

	)

73 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

75 
	sack‘_¡©s
 {

76 
	m_·ck‘s
;

77 
	m_drİs
;

80 
	sack‘_¡©s_v3
 {

81 
	m_·ck‘s
;

82 
	m_drİs
;

83 
	m_ä“ze_q_út
;

86 
	sack‘_rŞlov”_¡©s
 {

87 
__®igÃd_u64
 
	m_®l
;

88 
__®igÃd_u64
 
	m_huge
;

89 
__®igÃd_u64
 
	m_çed
;

92 
	uack‘_¡©s_u
 {

93 
ack‘_¡©s
 
	m¡©s1
;

94 
ack‘_¡©s_v3
 
	m¡©s3
;

97 
	sack‘_auxd©a
 {

98 
__u32
 
	m_¡©us
;

99 
__u32
 
	m_Ën
;

100 
__u32
 
	m_¢­Ën
;

101 
__u16
 
	m_mac
;

102 
__u16
 
	m_Ãt
;

103 
__u16
 
	m_vÏn_tci
;

104 
__u16
 
	m_vÏn_id
;

108 
	#TP_STATUS_KERNEL
 0

	)

109 
	#TP_STATUS_USER
 (1 << 0)

	)

110 
	#TP_STATUS_COPY
 (1 << 1)

	)

111 
	#TP_STATUS_LOSING
 (1 << 2)

	)

112 
	#TP_STATUS_CSUMNOTREADY
 (1 << 3)

	)

113 
	#TP_STATUS_VLAN_VALID
 (1 << 4è

	)

114 
	#TP_STATUS_BLK_TMO
 (1 << 5)

	)

115 
	#TP_STATUS_VLAN_TPID_VALID
 (1 << 6è

	)

116 
	#TP_STATUS_CSUM_VALID
 (1 << 7)

	)

119 
	#TP_STATUS_AVAILABLE
 0

	)

120 
	#TP_STATUS_SEND_REQUEST
 (1 << 0)

	)

121 
	#TP_STATUS_SENDING
 (1 << 1)

	)

122 
	#TP_STATUS_WRONG_FORMAT
 (1 << 2)

	)

125 
	#TP_STATUS_TS_SOFTWARE
 (1 << 29)

	)

126 
	#TP_STATUS_TS_SYS_HARDWARE
 (1 << 30è

	)

127 
	#TP_STATUS_TS_RAW_HARDWARE
 (1U << 31)

	)

130 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

132 
	sack‘_hdr
 {

133 
	m_¡©us
;

134 
	m_Ën
;

135 
	m_¢­Ën
;

136 
	m_mac
;

137 
	m_Ãt
;

138 
	m_£c
;

139 
	m_u£c
;

142 
	#TPACKET_ALIGNMENT
 16

	)

143 
	#TPACKET_ALIGN
(
x
è(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

144 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘_hdr
)è+ (
sockaddr_Î
))

	)

146 
	sack‘2_hdr
 {

147 
__u32
 
	m_¡©us
;

148 
__u32
 
	m_Ën
;

149 
__u32
 
	m_¢­Ën
;

150 
__u16
 
	m_mac
;

151 
__u16
 
	m_Ãt
;

152 
__u32
 
	m_£c
;

153 
__u32
 
	m_n£c
;

154 
__u16
 
	m_vÏn_tci
;

155 
__u16
 
	m_vÏn_id
;

156 
__u8
 
	m_·ddšg
[4];

159 
	sack‘_hdr_v¬ŸÁ1
 {

160 
__u32
 
	m_rxhash
;

161 
__u32
 
	m_vÏn_tci
;

162 
__u16
 
	m_vÏn_id
;

163 
__u16
 
	m_·ddšg
;

166 
	sack‘3_hdr
 {

167 
__u32
 
	m_Ãxt_off£t
;

168 
__u32
 
	m_£c
;

169 
__u32
 
	m_n£c
;

170 
__u32
 
	m_¢­Ën
;

171 
__u32
 
	m_Ën
;

172 
__u32
 
	m_¡©us
;

173 
__u16
 
	m_mac
;

174 
__u16
 
	m_Ãt
;

177 
ack‘_hdr_v¬ŸÁ1
 
	mhv1
;

179 
__u8
 
	m_·ddšg
[8];

182 
	sack‘_bd_ts
 {

183 
	mts_£c
;

185 
	mts_u£c
;

186 
	mts_n£c
;

190 
	sack‘_hdr_v1
 {

191 
__u32
 
	mblock_¡©us
;

192 
__u32
 
	mnum_pkts
;

193 
__u32
 
	moff£t_to_fœ¡_pkt
;

198 
__u32
 
	mblk_Ën
;

209 
__®igÃd_u64
 
	m£q_num
;

236 
ack‘_bd_ts
 
	mts_fœ¡_pkt
, 
	mts_Ï¡_pkt
;

239 
	uack‘_bd_h—d”_u
 {

240 
ack‘_hdr_v1
 
	mbh1
;

243 
	sack‘_block_desc
 {

244 
__u32
 
	mv”siÚ
;

245 
__u32
 
	moff£t_to_´iv
;

246 
ack‘_bd_h—d”_u
 
	mhdr
;

249 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘2_hdr
)è+ (
sockaddr_Î
))

	)

250 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘3_hdr
)è+ (
sockaddr_Î
))

	)

252 
	eack‘_v”siÚs
 {

253 
	mTPACKET_V1
,

254 
	mTPACKET_V2
,

255 
	mTPACKET_V3


271 
	sack‘_»q
 {

272 
	m_block_size
;

273 
	m_block_Ä
;

274 
	m_äame_size
;

275 
	m_äame_Ä
;

278 
	sack‘_»q3
 {

279 
	m_block_size
;

280 
	m_block_Ä
;

281 
	m_äame_size
;

282 
	m_äame_Ä
;

283 
	m_»tœe_blk_tov
;

284 
	m_sizeof_´iv
;

285 
	m_ã©u»_»q_wÜd
;

288 
	uack‘_»q_u
 {

289 
ack‘_»q
 
	m»q
;

290 
ack‘_»q3
 
	m»q3
;

293 
	s·ck‘_m»q
 {

294 
	mmr_ifšdex
;

295 
	mmr_ty³
;

296 
	mmr_®’
;

297 
	mmr_add»ss
[8];

300 
	sçnout_¬gs
 {

301 #ià
defšed
(
__LITTLE_ENDIAN_BITFIELD
)

302 
__u16
 
	mid
;

303 
__u16
 
	mty³_æags
;

305 
__u16
 
	mty³_æags
;

306 
__u16
 
	mid
;

308 
__u32
 
	mmax_num_memb”s
;

311 
	#PACKET_MR_MULTICAST
 0

	)

312 
	#PACKET_MR_PROMISC
 1

	)

313 
	#PACKET_MR_ALLMULTI
 2

	)

314 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/ioctl.h

2 #iâdeà
_LINUX_IOCTL_H


3 
	#_LINUX_IOCTL_H


	)

5 
	~<asm/ioùl.h
>

	@/usr/include/linux/irqnr.h

	@/usr/include/linux/libc-compat.h

49 #iâdeà
_LIBC_COMPAT_H


50 
	#_LIBC_COMPAT_H


	)

53 #ià
defšed
(
__GLIBC__
)

56 #ià
defšed
(
_NET_IF_H
è&& defšed(
__USE_MISC
)

61 
	#__UAPI_DEF_IF_IFCONF
 0

	)

62 
	#__UAPI_DEF_IF_IFMAP
 0

	)

63 
	#__UAPI_DEF_IF_IFNAMSIZ
 0

	)

64 
	#__UAPI_DEF_IF_IFREQ
 0

	)

66 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 0

	)

68 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


69 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

78 
	#__UAPI_DEF_IF_IFCONF
 1

	)

79 
	#__UAPI_DEF_IF_IFMAP
 1

	)

80 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

81 
	#__UAPI_DEF_IF_IFREQ
 1

	)

83 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

85 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

90 #ià
defšed
(
_NETINET_IN_H
)

94 
	#__UAPI_DEF_IN_ADDR
 0

	)

95 
	#__UAPI_DEF_IN_IPPROTO
 0

	)

96 
	#__UAPI_DEF_IN_PKTINFO
 0

	)

97 
	#__UAPI_DEF_IP_MREQ
 0

	)

98 
	#__UAPI_DEF_SOCKADDR_IN
 0

	)

99 
	#__UAPI_DEF_IN_CLASS
 0

	)

101 
	#__UAPI_DEF_IN6_ADDR
 0

	)

106 #ià
defšed
(
__USE_MISC
è|| defšed (
__USE_GNU
)

107 
	#__UAPI_DEF_IN6_ADDR_ALT
 0

	)

109 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

111 
	#__UAPI_DEF_SOCKADDR_IN6
 0

	)

112 
	#__UAPI_DEF_IPV6_MREQ
 0

	)

113 
	#__UAPI_DEF_IPPROTO_V6
 0

	)

114 
	#__UAPI_DEF_IPV6_OPTIONS
 0

	)

115 
	#__UAPI_DEF_IN6_PKTINFO
 0

	)

116 
	#__UAPI_DEF_IP6_MTUINFO
 0

	)

123 
	#__UAPI_DEF_IN_ADDR
 1

	)

124 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

125 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

126 
	#__UAPI_DEF_IP_MREQ
 1

	)

127 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

128 
	#__UAPI_DEF_IN_CLASS
 1

	)

130 
	#__UAPI_DEF_IN6_ADDR
 1

	)

133 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

134 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

135 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

136 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

137 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

138 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

139 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

144 #ià
defšed
(
__NETIPX_IPX_H
)

146 
	#__UAPI_DEF_SOCKADDR_IPX
 0

	)

147 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 0

	)

148 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 0

	)

149 
	#__UAPI_DEF_IPX_CONFIG_DATA
 0

	)

150 
	#__UAPI_DEF_IPX_ROUTE_DEF
 0

	)

154 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

155 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

156 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

157 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

158 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

163 #ià
defšed
(
_SYS_XATTR_H
)

164 
	#__UAPI_DEF_XATTR
 0

	)

166 
	#__UAPI_DEF_XATTR
 1

	)

176 #iâdeà
__UAPI_DEF_IF_IFCONF


177 
	#__UAPI_DEF_IF_IFCONF
 1

	)

179 #iâdeà
__UAPI_DEF_IF_IFMAP


180 
	#__UAPI_DEF_IF_IFMAP
 1

	)

182 #iâdeà
__UAPI_DEF_IF_IFNAMSIZ


183 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

185 #iâdeà
__UAPI_DEF_IF_IFREQ


186 
	#__UAPI_DEF_IF_IFREQ
 1

	)

189 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS


190 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

193 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


194 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

198 #iâdeà
__UAPI_DEF_IN_ADDR


199 
	#__UAPI_DEF_IN_ADDR
 1

	)

201 #iâdeà
__UAPI_DEF_IN_IPPROTO


202 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

204 #iâdeà
__UAPI_DEF_IN_PKTINFO


205 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

207 #iâdeà
__UAPI_DEF_IP_MREQ


208 
	#__UAPI_DEF_IP_MREQ
 1

	)

210 #iâdeà
__UAPI_DEF_SOCKADDR_IN


211 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

213 #iâdeà
__UAPI_DEF_IN_CLASS


214 
	#__UAPI_DEF_IN_CLASS
 1

	)

218 #iâdeà
__UAPI_DEF_IN6_ADDR


219 
	#__UAPI_DEF_IN6_ADDR
 1

	)

221 #iâdeà
__UAPI_DEF_IN6_ADDR_ALT


222 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

224 #iâdeà
__UAPI_DEF_SOCKADDR_IN6


225 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

227 #iâdeà
__UAPI_DEF_IPV6_MREQ


228 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

230 #iâdeà
__UAPI_DEF_IPPROTO_V6


231 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

233 #iâdeà
__UAPI_DEF_IPV6_OPTIONS


234 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

236 #iâdeà
__UAPI_DEF_IN6_PKTINFO


237 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

239 #iâdeà
__UAPI_DEF_IP6_MTUINFO


240 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

244 #iâdeà
__UAPI_DEF_SOCKADDR_IPX


245 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

247 #iâdeà
__UAPI_DEF_IPX_ROUTE_DEFINITION


248 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

250 #iâdeà
__UAPI_DEF_IPX_INTERFACE_DEFINITION


251 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

253 #iâdeà
__UAPI_DEF_IPX_CONFIG_DATA


254 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

256 #iâdeà
__UAPI_DEF_IPX_ROUTE_DEF


257 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

261 #iâdeà
__UAPI_DEF_XATTR


262 
	#__UAPI_DEF_XATTR
 1

	)

	@/usr/include/linux/neighbour.h

2 #iâdeà
__LINUX_NEIGHBOUR_H


3 
	#__LINUX_NEIGHBOUR_H


	)

5 
	~<lšux/ty³s.h
>

6 
	~<lšux/Ãšk.h
>

8 
	sndmsg
 {

9 
__u8
 
	mndm_çmy
;

10 
__u8
 
	mndm_·d1
;

11 
__u16
 
	mndm_·d2
;

12 
__s32
 
	mndm_ifšdex
;

13 
__u16
 
	mndm_¡©e
;

14 
__u8
 
	mndm_æags
;

15 
__u8
 
	mndm_ty³
;

19 
	mNDA_UNSPEC
,

20 
	mNDA_DST
,

21 
	mNDA_LLADDR
,

22 
	mNDA_CACHEINFO
,

23 
	mNDA_PROBES
,

24 
	mNDA_VLAN
,

25 
	mNDA_PORT
,

26 
	mNDA_VNI
,

27 
	mNDA_IFINDEX
,

28 
	mNDA_MASTER
,

29 
	mNDA_LINK_NETNSID
,

30 
	mNDA_SRC_VNI
,

31 
	mNDA_PROTOCOL
,

32 
	mNDA_NH_ID
,

33 
	mNDA_FDB_EXT_ATTRS
,

34 
	m__NDA_MAX


37 
	#NDA_MAX
 (
__NDA_MAX
 - 1)

	)

43 
	#NTF_USE
 0x01

	)

44 
	#NTF_SELF
 0x02

	)

45 
	#NTF_MASTER
 0x04

	)

46 
	#NTF_PROXY
 0x08

	)

47 
	#NTF_EXT_LEARNED
 0x10

	)

48 
	#NTF_OFFLOADED
 0x20

	)

49 
	#NTF_STICKY
 0x40

	)

50 
	#NTF_ROUTER
 0x80

	)

56 
	#NUD_INCOMPLETE
 0x01

	)

57 
	#NUD_REACHABLE
 0x02

	)

58 
	#NUD_STALE
 0x04

	)

59 
	#NUD_DELAY
 0x08

	)

60 
	#NUD_PROBE
 0x10

	)

61 
	#NUD_FAILED
 0x20

	)

64 
	#NUD_NOARP
 0x40

	)

65 
	#NUD_PERMANENT
 0x80

	)

66 
	#NUD_NONE
 0x00

	)

76 
	snda_ÿchešfo
 {

77 
__u32
 
	mndm_cÚfœmed
;

78 
__u32
 
	mndm_u£d
;

79 
__u32
 
	mndm_upd©ed
;

80 
__u32
 
	mndm_»fút
;

108 
	sndt_¡©s
 {

109 
__u64
 
	mndts_®locs
;

110 
__u64
 
	mndts_de¡roys
;

111 
__u64
 
	mndts_hash_grows
;

112 
__u64
 
	mndts_»s_çed
;

113 
__u64
 
	mndts_lookups
;

114 
__u64
 
	mndts_h™s
;

115 
__u64
 
	mndts_rcv_´obes_mÿ¡
;

116 
__u64
 
	mndts_rcv_´obes_uÿ¡
;

117 
__u64
 
	mndts_³riodic_gc_runs
;

118 
__u64
 
	mndts_fÜûd_gc_runs
;

119 
__u64
 
	mndts_bË_fuÎs
;

123 
	mNDTPA_UNSPEC
,

124 
	mNDTPA_IFINDEX
,

125 
	mNDTPA_REFCNT
,

126 
	mNDTPA_REACHABLE_TIME
,

127 
	mNDTPA_BASE_REACHABLE_TIME
,

128 
	mNDTPA_RETRANS_TIME
,

129 
	mNDTPA_GC_STALETIME
,

130 
	mNDTPA_DELAY_PROBE_TIME
,

131 
	mNDTPA_QUEUE_LEN
,

132 
	mNDTPA_APP_PROBES
,

133 
	mNDTPA_UCAST_PROBES
,

134 
	mNDTPA_MCAST_PROBES
,

135 
	mNDTPA_ANYCAST_DELAY
,

136 
	mNDTPA_PROXY_DELAY
,

137 
	mNDTPA_PROXY_QLEN
,

138 
	mNDTPA_LOCKTIME
,

139 
	mNDTPA_QUEUE_LENBYTES
,

140 
	mNDTPA_MCAST_REPROBES
,

141 
	mNDTPA_PAD
,

142 
	m__NDTPA_MAX


144 
	#NDTPA_MAX
 (
__NDTPA_MAX
 - 1)

	)

146 
	sndtmsg
 {

147 
__u8
 
	mndtm_çmy
;

148 
__u8
 
	mndtm_·d1
;

149 
__u16
 
	mndtm_·d2
;

152 
	sndt_cÚfig
 {

153 
__u16
 
	mndtc_key_Ën
;

154 
__u16
 
	mndtc_’Œy_size
;

155 
__u32
 
	mndtc_’Œ›s
;

156 
__u32
 
	mndtc_Ï¡_æush
;

157 
__u32
 
	mndtc_Ï¡_¿nd
;

158 
__u32
 
	mndtc_hash_ºd
;

159 
__u32
 
	mndtc_hash_mask
;

160 
__u32
 
	mndtc_hash_chaš_gc
;

161 
__u32
 
	mndtc_´oxy_qËn
;

165 
	mNDTA_UNSPEC
,

166 
	mNDTA_NAME
,

167 
	mNDTA_THRESH1
,

168 
	mNDTA_THRESH2
,

169 
	mNDTA_THRESH3
,

170 
	mNDTA_CONFIG
,

171 
	mNDTA_PARMS
,

172 
	mNDTA_STATS
,

173 
	mNDTA_GC_INTERVAL
,

174 
	mNDTA_PAD
,

175 
	m__NDTA_MAX


177 
	#NDTA_MAX
 (
__NDTA_MAX
 - 1)

	)

184 
	mFDB_NOTIFY_BIT
 = (1 << 0),

185 
	mFDB_NOTIFY_INACTIVE_BIT
 = (1 << 1)

195 
	mNFEA_UNSPEC
,

196 
	mNFEA_ACTIVITY_NOTIFY
,

197 
	mNFEA_DONT_REFRESH
,

198 
	m__NFEA_MAX


200 
	#NFEA_MAX
 (
__NFEA_MAX
 - 1)

	)

	@/usr/include/linux/netlink.h

2 #iâdeà
__LINUX_NETLINK_H


3 
	#__LINUX_NETLINK_H


	)

5 
	~<lšux/cÚ¡.h
>

6 
	~<lšux/sock‘.h
>

7 
	~<lšux/ty³s.h
>

9 
	#NETLINK_ROUTE
 0

	)

10 
	#NETLINK_UNUSED
 1

	)

11 
	#NETLINK_USERSOCK
 2

	)

12 
	#NETLINK_FIREWALL
 3

	)

13 
	#NETLINK_SOCK_DIAG
 4

	)

14 
	#NETLINK_NFLOG
 5

	)

15 
	#NETLINK_XFRM
 6

	)

16 
	#NETLINK_SELINUX
 7

	)

17 
	#NETLINK_ISCSI
 8

	)

18 
	#NETLINK_AUDIT
 9

	)

19 
	#NETLINK_FIB_LOOKUP
 10

	)

20 
	#NETLINK_CONNECTOR
 11

	)

21 
	#NETLINK_NETFILTER
 12

	)

22 
	#NETLINK_IP6_FW
 13

	)

23 
	#NETLINK_DNRTMSG
 14

	)

24 
	#NETLINK_KOBJECT_UEVENT
 15

	)

25 
	#NETLINK_GENERIC
 16

	)

27 
	#NETLINK_SCSITRANSPORT
 18

	)

28 
	#NETLINK_ECRYPTFS
 19

	)

29 
	#NETLINK_RDMA
 20

	)

30 
	#NETLINK_CRYPTO
 21

	)

31 
	#NETLINK_SMC
 22

	)

33 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

35 
	#MAX_LINKS
 32

	)

37 
	ssockaddr_Æ
 {

38 
__k”Ãl_§_çmy_t
 
	mÆ_çmy
;

39 
	mÆ_·d
;

40 
__u32
 
	mÆ_pid
;

41 
__u32
 
	mÆ_groups
;

44 
	sÆmsghdr
 {

45 
__u32
 
	mÆmsg_Ën
;

46 
__u16
 
	mÆmsg_ty³
;

47 
__u16
 
	mÆmsg_æags
;

48 
__u32
 
	mÆmsg_£q
;

49 
__u32
 
	mÆmsg_pid
;

54 
	#NLM_F_REQUEST
 0x01

	)

55 
	#NLM_F_MULTI
 0x02

	)

56 
	#NLM_F_ACK
 0x04

	)

57 
	#NLM_F_ECHO
 0x08

	)

58 
	#NLM_F_DUMP_INTR
 0x10

	)

59 
	#NLM_F_DUMP_FILTERED
 0x20

	)

62 
	#NLM_F_ROOT
 0x100

	)

63 
	#NLM_F_MATCH
 0x200

	)

64 
	#NLM_F_ATOMIC
 0x400

	)

65 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

68 
	#NLM_F_REPLACE
 0x100

	)

69 
	#NLM_F_EXCL
 0x200

	)

70 
	#NLM_F_CREATE
 0x400

	)

71 
	#NLM_F_APPEND
 0x800

	)

74 
	#NLM_F_NONREC
 0x100

	)

77 
	#NLM_F_CAPPED
 0x100

	)

78 
	#NLM_F_ACK_TLVS
 0x200

	)

89 
	#NLMSG_ALIGNTO
 4U

	)

90 
	#NLMSG_ALIGN
(
Ën
èĞ(Ö’)+
NLMSG_ALIGNTO
-1è& ~(NLMSG_ALIGNTO-1è)

	)

91 
	#NLMSG_HDRLEN
 ((è
	`NLMSG_ALIGN
((
Æmsghdr
)))

	)

92 
	#NLMSG_LENGTH
(
Ën
è(Ö’è+ 
NLMSG_HDRLEN
)

	)

93 
	#NLMSG_SPACE
(
Ën
è
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
Ö’))

	)

94 
	#NLMSG_DATA
(
Æh
è((*)(((*êlhè+ 
NLMSG_HDRLEN
))

	)

95 
	#NLMSG_NEXT
(
Æh
,
Ën
è(Ö’è-ğ
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
), \

96 (
Æmsghdr
 *)(((*)(
Æh
)) + \

97 
	`NLMSG_ALIGN
((
Æh
)->
Æmsg_Ën
)))

	)

98 
	#NLMSG_OK
(
Æh
,
Ën
è(Ö’è>ğ()(
Æmsghdr
) && \

99 (
Æh
)->
Æmsg_Ën
 >ğ(
Æmsghdr
) && \

100 (
Æh
)->
Æmsg_Ën
 <ğ(
Ën
))

	)

101 
	#NLMSG_PAYLOAD
(
Æh
,
Ën
è(Òlh)->
Æmsg_Ën
 - 
	`NLMSG_SPACE
(Ö’)))

	)

103 
	#NLMSG_NOOP
 0x1

	)

104 
	#NLMSG_ERROR
 0x2

	)

105 
	#NLMSG_DONE
 0x3

	)

106 
	#NLMSG_OVERRUN
 0x4

	)

108 
	#NLMSG_MIN_TYPE
 0x10

	)

110 
	sÆmsg”r
 {

111 
	m”rÜ
;

112 
Æmsghdr
 
	mmsg
;

137 
	eÆmsg”r_©Œs
 {

138 
	mNLMSGERR_ATTR_UNUSED
,

139 
	mNLMSGERR_ATTR_MSG
,

140 
	mNLMSGERR_ATTR_OFFS
,

141 
	mNLMSGERR_ATTR_COOKIE
,

142 
	mNLMSGERR_ATTR_POLICY
,

144 
	m__NLMSGERR_ATTR_MAX
,

145 
	mNLMSGERR_ATTR_MAX
 = 
__NLMSGERR_ATTR_MAX
 - 1

148 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

149 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

150 
	#NETLINK_PKTINFO
 3

	)

151 
	#NETLINK_BROADCAST_ERROR
 4

	)

152 
	#NETLINK_NO_ENOBUFS
 5

	)

153 
	#NETLINK_RX_RING
 6

	)

154 
	#NETLINK_TX_RING
 7

	)

155 
	#NETLINK_LISTEN_ALL_NSID
 8

	)

156 
	#NETLINK_LIST_MEMBERSHIPS
 9

	)

157 
	#NETLINK_CAP_ACK
 10

	)

158 
	#NETLINK_EXT_ACK
 11

	)

159 
	#NETLINK_GET_STRICT_CHK
 12

	)

161 
	sÆ_pktšfo
 {

162 
__u32
 
	mgroup
;

165 
	sÆ_mm­_»q
 {

166 
	mnm_block_size
;

167 
	mnm_block_Ä
;

168 
	mnm_äame_size
;

169 
	mnm_äame_Ä
;

172 
	sÆ_mm­_hdr
 {

173 
	mnm_¡©us
;

174 
	mnm_Ën
;

175 
__u32
 
	mnm_group
;

177 
__u32
 
	mnm_pid
;

178 
__u32
 
	mnm_uid
;

179 
__u32
 
	mnm_gid
;

182 
	eÆ_mm­_¡©us
 {

183 
	mNL_MMAP_STATUS_UNUSED
,

184 
	mNL_MMAP_STATUS_RESERVED
,

185 
	mNL_MMAP_STATUS_VALID
,

186 
	mNL_MMAP_STATUS_COPY
,

187 
	mNL_MMAP_STATUS_SKIP
,

190 
	#NL_MMAP_MSG_ALIGNMENT
 
NLMSG_ALIGNTO


	)

191 
	#NL_MMAP_MSG_ALIGN
(
sz
è
	`__ALIGN_KERNEL
(sz, 
NL_MMAP_MSG_ALIGNMENT
)

	)

192 
	#NL_MMAP_HDRLEN
 
	`NL_MMAP_MSG_ALIGN
((
Æ_mm­_hdr
))

	)

194 
	#NET_MAJOR
 36

	)

197 
	mNETLINK_UNCONNECTED
 = 0,

198 
	mNETLINK_CONNECTED
,

210 
	sÆ©Œ
 {

211 
__u16
 
	mÆa_Ën
;

212 
__u16
 
	mÆa_ty³
;

225 
	#NLA_F_NESTED
 (1 << 15)

	)

226 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

227 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

229 
	#NLA_ALIGNTO
 4

	)

230 
	#NLA_ALIGN
(
Ën
è((Ö’è+ 
NLA_ALIGNTO
 - 1è& ~(NLA_ALIGNTO - 1))

	)

231 
	#NLA_HDRLEN
 ((è
	`NLA_ALIGN
((
Æ©Œ
)))

	)

246 
	sÆa_b™f›ld32
 {

247 
__u32
 
	mv®ue
;

248 
__u32
 
	m£ËùÜ
;

283 
	eÃšk_©Œibu‹_ty³
 {

284 
	mNL_ATTR_TYPE_INVALID
,

286 
	mNL_ATTR_TYPE_FLAG
,

288 
	mNL_ATTR_TYPE_U8
,

289 
	mNL_ATTR_TYPE_U16
,

290 
	mNL_ATTR_TYPE_U32
,

291 
	mNL_ATTR_TYPE_U64
,

293 
	mNL_ATTR_TYPE_S8
,

294 
	mNL_ATTR_TYPE_S16
,

295 
	mNL_ATTR_TYPE_S32
,

296 
	mNL_ATTR_TYPE_S64
,

298 
	mNL_ATTR_TYPE_BINARY
,

299 
	mNL_ATTR_TYPE_STRING
,

300 
	mNL_ATTR_TYPE_NUL_STRING
,

302 
	mNL_ATTR_TYPE_NESTED
,

303 
	mNL_ATTR_TYPE_NESTED_ARRAY
,

305 
	mNL_ATTR_TYPE_BITFIELD32
,

336 
	eÃšk_pŞicy_ty³_©Œ
 {

337 
	mNL_POLICY_TYPE_ATTR_UNSPEC
,

338 
	mNL_POLICY_TYPE_ATTR_TYPE
,

339 
	mNL_POLICY_TYPE_ATTR_MIN_VALUE_S
,

340 
	mNL_POLICY_TYPE_ATTR_MAX_VALUE_S
,

341 
	mNL_POLICY_TYPE_ATTR_MIN_VALUE_U
,

342 
	mNL_POLICY_TYPE_ATTR_MAX_VALUE_U
,

343 
	mNL_POLICY_TYPE_ATTR_MIN_LENGTH
,

344 
	mNL_POLICY_TYPE_ATTR_MAX_LENGTH
,

345 
	mNL_POLICY_TYPE_ATTR_POLICY_IDX
,

346 
	mNL_POLICY_TYPE_ATTR_POLICY_MAXTYPE
,

347 
	mNL_POLICY_TYPE_ATTR_BITFIELD32_MASK
,

348 
	mNL_POLICY_TYPE_ATTR_PAD
,

349 
	mNL_POLICY_TYPE_ATTR_MASK
,

352 
	m__NL_POLICY_TYPE_ATTR_MAX
,

353 
	mNL_POLICY_TYPE_ATTR_MAX
 = 
__NL_POLICY_TYPE_ATTR_MAX
 - 1

	@/usr/include/linux/posix_types.h

2 #iâdeà
_LINUX_POSIX_TYPES_H


3 
	#_LINUX_POSIX_TYPES_H


	)

5 
	~<lšux/¡ddef.h
>

22 #undeà
__FD_SETSIZE


23 
	#__FD_SETSIZE
 1024

	)

26 
	mfds_b™s
[
__FD_SETSIZE
 / (8 * ())];

27 } 
	t__k”Ãl_fd_£t
;

30 (*
	t__k”Ãl_sighªdËr_t
)();

33 
	t__k”Ãl_key_t
;

34 
	t__k”Ãl_mqd_t
;

36 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/socket.h

2 #iâdeà
_LINUX_SOCKET_H


3 
	#_LINUX_SOCKET_H


	)

8 
	#_K_SS_MAXSIZE
 128

	)

10 
	t__k”Ãl_§_çmy_t
;

16 
	s__k”Ãl_sockaddr_¡Üage
 {

19 
__k”Ãl_§_çmy_t
 
	mss_çmy
;

21 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

25 *
	m__®ign
;

29 
	#SOCK_SNDBUF_LOCK
 1

	)

30 
	#SOCK_RCVBUF_LOCK
 2

	)

32 
	#SOCK_BUF_LOCK_MASK
 (
SOCK_SNDBUF_LOCK
 | 
SOCK_RCVBUF_LOCK
)

	)

	@/usr/include/linux/sysinfo.h

2 #iâdeà
_LINUX_SYSINFO_H


3 
	#_LINUX_SYSINFO_H


	)

5 
	~<lšux/ty³s.h
>

7 
	#SI_LOAD_SHIFT
 16

	)

8 
	ssysšfo
 {

9 
__k”Ãl_lÚg_t
 
	mu±ime
;

10 
__k”Ãl_ulÚg_t
 
	mlßds
[3];

11 
__k”Ãl_ulÚg_t
 
	mtÙ®¿m
;

12 
__k”Ãl_ulÚg_t
 
	mä“¿m
;

13 
__k”Ãl_ulÚg_t
 
	msh¬ed¿m
;

14 
__k”Ãl_ulÚg_t
 
	mbufã¼am
;

15 
__k”Ãl_ulÚg_t
 
	mtÙ®sw­
;

16 
__k”Ãl_ulÚg_t
 
	mä“sw­
;

17 
__u16
 
	m´ocs
;

18 
__u16
 
	m·d
;

19 
__k”Ãl_ulÚg_t
 
	mtÙ®high
;

20 
__k”Ãl_ulÚg_t
 
	mä“high
;

21 
__u32
 
	mmem_un™
;

22 
	m_f
[20-2*(
__k”Ãl_ulÚg_t
)-(
__u32
)];

	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

28 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

36 #ià
defšed
 
__ılu¥lus
 && (
__GNUC_PREREQ
 (4, 4) \

37 || 
	$__glibc_şªg_´”eq
 (3, 5))

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

43 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

44 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

47 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

48 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

53 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN
 || 
	`__GLIBC_USE
 (
ISOC2X
)

54 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
	`__©Œ_acûss
 ((
__wr™e_Úly__
, 1, 4));

61 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

64 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

65 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

80 
	$__memcm³q
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

81 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

84 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


87 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

88 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

89 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

90 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

92 #ifdeà
__OPTIMIZE__


93 
__ex‹º_®ways_šlše
 *

94 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


96  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

99 
__ex‹º_®ways_šlše
 const *

100 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


102  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

105 
	}
}

107 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

108 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 #ifdeà
__USE_GNU


114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

116 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

118 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

125 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


126 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

127 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1))

128 
	`__©Œ_acûss
 ((
__»ad_Úly__
, 1, 3));

129 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

130 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1))

131 
	`__©Œ_acûss
 ((
__»ad_Úly__
, 1, 3));

133 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

134 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1))

135 
	`__©Œ_acûss
 ((
__»ad_Úly__
, 1, 3));

141 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

142 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

144 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

145 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

146 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

149 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

150 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

152 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

153 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

156 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

157 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

159 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

160 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

163 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

164 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

166 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

167 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

168 
__THROW
 
	`__nÚnuÎ
 ((2)è
	`__©Œ_acûss
 ((
__wr™e_Úly__
, 1, 3));

170 #ifdeà
__USE_XOPEN2K8


172 
	~<b™s/ty³s/loÿË_t.h
>

175 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__l
)

176 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

179 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

180 
loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4))

181 
	`__©Œ_acûss
 ((
__wr™e_Úly__
, 1, 3));

184 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8
 \

185 || 
	`__GLIBC_USE
 (
LIB_EXT2
è|| 
	$__GLIBC_USE
 (
ISOC2X
))

187 *
	$¡rdup
 (cÚ¡ *
__s
)

188 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

194 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
è|| __GLIBC_USE (
ISOC2X
)

195 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

196 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

199 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


201 
	#¡rdu·
(
s
) \

202 (
__ex‹nsiÚ__
 \

204 cÚ¡ *
__Şd
 = (
s
); \

205 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

206 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

207 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

208 
	}
}))

	)

211 
	#¡ºdu·
(
s
, 
n
) \

212 (
__ex‹nsiÚ__
 \

214 cÚ¡ *
__Şd
 = (
s
); \

215 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

216 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

217 
__Ãw
[
__Ën
] = '\0'; \

218 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

219 }))

	)

223 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


226 *
¡rchr
 (*
__s
, 
__c
)

227 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

228 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

229 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

231 #ifdeà
__OPTIMIZE__


232 
__ex‹º_®ways_šlše
 *

233 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


235  
__butš_¡rchr
 (
__s
, 
__c
);

238 
__ex‹º_®ways_šlše
 const *

239 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


241  
__butš_¡rchr
 (
__s
, 
__c
);

246 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

247 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

250 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


253 *
	`¡¼chr
 (*
__s
, 
__c
)

254 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

255 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

256 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

258 #ifdeà
__OPTIMIZE__


259 
__ex‹º_®ways_šlše
 *

260 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


262  
	`__butš_¡¼chr
 (
__s
, 
__c
);

265 
__ex‹º_®ways_šlše
 const *

266 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


268  
	`__butš_¡¼chr
 (
__s
, 
__c
);

271 
	}
}

273 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

274 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 #ifdeà
__USE_GNU


280 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


281 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

282 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

283 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

284 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

286 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

287 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

293 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

294 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

297 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

298 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

300 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


303 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

304 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

305 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

306 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

308 #ifdeà
__OPTIMIZE__


309 
__ex‹º_®ways_šlše
 *

310 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


312  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

315 
__ex‹º_®ways_šlše
 const *

316 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


318  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

321 
	}
}

323 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

324 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


330 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

331 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

332 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

333 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

335 #ifdeà
__OPTIMIZE__


336 
__ex‹º_®ways_šlše
 *

337 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


339  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

342 
__ex‹º_®ways_šlše
 const *

343 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


345  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

348 
	}
}

350 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

351 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

356 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

357 
__THROW
 
	`__nÚnuÎ
 ((2));

361 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

362 cÚ¡ *
__»¡riù
 
__d–im
,

363 **
__»¡riù
 
__§ve_±r
)

364 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

365 #ifdeà
__USE_POSIX


366 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

367 **
__»¡riù
 
__§ve_±r
)

368 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

371 #ifdeà
__USE_GNU


373 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


374 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

375 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

376 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

377 cÚ¡ *
__ÃedË
)

378 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

380 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

381 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

385 #ifdeà
__USE_GNU


389 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

390 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

391 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3))

392 
	`__©Œ_acûss
 ((
__»ad_Úly__
, 1, 2))

393 
	`__©Œ_acûss
 ((
__»ad_Úly__
, 3, 4));

397 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

398 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

399 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

400 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

401 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

402 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

407 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

408 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

410 #ifdef 
__USE_XOPEN2K8


413 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

414 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

419 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

420 #ifdeà
__USE_XOPEN2K


428 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


431 #ifdeà
__REDIRECT_NTH


432 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

433 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

434 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2))

435 
	`__©Œ_acûss
 ((
__wr™e_Úly__
, 2, 3));

437 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

438 
__THROW
 
	`__nÚnuÎ
 ((2)è
	`__©Œ_acûss
 ((
__wr™e_Úly__
, 2, 3));

439 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

444 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

445 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
 
	`__©Œ_acûss
 ((
__wr™e_Úly__
, 2, 3));

448 #ifdeà
__USE_GNU


450 cÚ¡ *
	$¡»¼Üdesc_Å
 (
__”r
è
__THROW
;

452 cÚ¡ *
	$¡»¼ÜÇme_Å
 (
__”r
è
__THROW
;

456 #ifdeà
__USE_XOPEN2K8


458 *
	$¡»¼Ü_l
 (
__”ºum
, 
loÿË_t
 
__l
è
__THROW
;

461 #ifdeà
__USE_MISC


462 
	~<¡ršgs.h
>

466 
	$ex¶ic™_bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1))

467 
	`__fÜtif›d_©Œ_acûss
 (
__wr™e_Úly__
, 1, 2);

471 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

472 cÚ¡ *
__»¡riù
 
__d–im
)

473 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

476 #ifdef 
__USE_XOPEN2K8


478 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

480 #ifdeà
__USE_GNU


482 cÚ¡ *
	$sigabb»v_Å
 (
__sig
è
__THROW
;

485 cÚ¡ *
	$sigdesü_Å
 (
__sig
è
__THROW
;

489 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

490 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

491 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

492 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

496 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

497 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

498 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

499 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

500 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

501 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

504 #ifdef 
__USE_GNU


506 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

507 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

510 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

513 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1))

514 
	`__©Œ_acûss
 ((
__»ad_wr™e__
, 1, 2));

516 #iâdeà
ba£Çme


521 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


522 "C++" *
	$ba£Çme
 (*
__f’ame
)

523 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

524 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

525 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

527 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

532 #ià
	`__GNUC_PREREQ
 (3,4)

533 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


535 
	~<b™s/¡ršg_fÜtif›d.h
>

539 
__END_DECLS


	@/usr/include/linux/stddef.h

2 #iâdeà
_LINUX_STDDEF_H


3 
	#_LINUX_STDDEF_H


	)

7 #iâdeà
__®ways_šlše


8 
	#__®ways_šlše
 
__šlše__


	)

26 
	#__¡ruù_group
(
TAG
, 
NAME
, 
ATTRS
, 
MEMBERS
...) \

28 ¡ruù { 
MEMBERS
 } 
ATTRS
; \

29 
	sTAG
 { 
MEMBERS
 } 
ATTRS
 
NAME
; \

30 } 
ATTRS


	)

42 
	#__DECLARE_FLEX_ARRAY
(
TYPE
, 
NAME
) \

44 ¡ruù { } 
__em±y_
 ## 
NAME
; \

45 
TYPE
 
NAME
[]; \

46 }

	)

	@/usr/include/strings.h

18 #iâdef 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

26 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

27 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

30 
	g__BEGIN_DECLS


32 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


34 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

35 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

38 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

39 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

42 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

45 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


48 *
	`šdex
 (*
__s
, 
__c
)

49 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

50 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

51 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

53 #ià
defšed
 
__OPTIMIZE__


54 
__ex‹º_®ways_šlše
 *

55 
	`šdex
 (*
__s
, 
__c
è
__THROW


57  
	`__butš_šdex
 (
__s
, 
__c
);

60 
__ex‹º_®ways_šlše
 const *

61 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


63  
	`__butš_šdex
 (
__s
, 
__c
);

66 
	}
}

68 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

73 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


76 *
	`ršdex
 (*
__s
, 
__c
)

77 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

79 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ià
defšed
 
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`ršdex
 (*
__s
, 
__c
è
__THROW


85  
	`__butš_ršdex
 (
__s
, 
__c
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


91  
	`__butš_ršdex
 (
__s
, 
__c
);

94 
	}
}

96 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

101 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8
 || defšed 
__USE_XOPEN2K8XSI


104 
	$ffs
 (
__i
è
__THROW
 
__©Œibu‹_cÚ¡__
;

109 #ifdef 
__USE_MISC


110 
	$ff¦
 (
__l
è
__THROW
 
__©Œibu‹_cÚ¡__
;

111 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

112 
__THROW
 
__©Œibu‹_cÚ¡__
;

116 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

117 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

120 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

123 #ifdef 
__USE_XOPEN2K8


125 
	~<b™s/ty³s/loÿË_t.h
>

128 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__loc
)

129 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

133 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

134 
size_t
 
__n
, 
loÿË_t
 
__loc
)

135 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

138 
__END_DECLS


140 #ià
	`__GNUC_PREREQ
 (3,4è&& 
__USE_FORTIFY_LEVEL
 > 0 \

141 && 
defšed
 
__fÜtify_funùiÚ


143 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


144 
	~<b™s/¡ršgs_fÜtif›d.h
>

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

126 #undeà
__USE_ISOC11


127 #undeà
__USE_ISOC99


128 #undeà
__USE_ISOC95


129 #undeà
__USE_ISOCXX11


130 #undeà
__USE_POSIX


131 #undeà
__USE_POSIX2


132 #undeà
__USE_POSIX199309


133 #undeà
__USE_POSIX199506


134 #undeà
__USE_XOPEN


135 #undeà
__USE_XOPEN_EXTENDED


136 #undeà
__USE_UNIX98


137 #undeà
__USE_XOPEN2K


138 #undeà
__USE_XOPEN2KXSI


139 #undeà
__USE_XOPEN2K8


140 #undeà
__USE_XOPEN2K8XSI


141 #undeà
__USE_LARGEFILE


142 #undeà
__USE_LARGEFILE64


143 #undeà
__USE_FILE_OFFSET64


144 #undeà
__USE_MISC


145 #undeà
__USE_ATFILE


146 #undeà
__USE_DYNAMIC_STACK_SIZE


147 #undeà
__USE_GNU


148 #undeà
__USE_FORTIFY_LEVEL


149 #undeà
__KERNEL_STRICT_NAMES


150 #undeà
__GLIBC_USE_ISOC2X


151 #undeà
__GLIBC_USE_DEPRECATED_GETS


152 #undeà
__GLIBC_USE_DEPRECATED_SCANF


156 #iâdeà
_LOOSE_KERNEL_NAMES


157 
	#__KERNEL_STRICT_NAMES


	)

167 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


168 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

169 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

171 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

178 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


179 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

180 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

182 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

186 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

192 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

193 && !
defšed
 
	g_DEFAULT_SOURCE


195 #undeà
_DEFAULT_SOURCE


196 
	#_DEFAULT_SOURCE
 1

	)

200 #ifdeà
_GNU_SOURCE


201 #undeà
_ISOC95_SOURCE


202 
	#_ISOC95_SOURCE
 1

	)

203 #undeà
_ISOC99_SOURCE


204 
	#_ISOC99_SOURCE
 1

	)

205 #undeà
_ISOC11_SOURCE


206 
	#_ISOC11_SOURCE
 1

	)

207 #undeà
_ISOC2X_SOURCE


208 
	#_ISOC2X_SOURCE
 1

	)

209 #undeà
_POSIX_SOURCE


210 
	#_POSIX_SOURCE
 1

	)

211 #undeà
_POSIX_C_SOURCE


212 
	#_POSIX_C_SOURCE
 200809L

	)

213 #undeà
_XOPEN_SOURCE


214 
	#_XOPEN_SOURCE
 700

	)

215 #undeà
_XOPEN_SOURCE_EXTENDED


216 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

217 #undeà
_LARGEFILE64_SOURCE


218 
	#_LARGEFILE64_SOURCE
 1

	)

219 #undeà
_DEFAULT_SOURCE


220 
	#_DEFAULT_SOURCE
 1

	)

221 #undeà
_ATFILE_SOURCE


222 
	#_ATFILE_SOURCE
 1

	)

223 #undeà
_DYNAMIC_STACK_SIZE_SOURCE


224 
	#_DYNAMIC_STACK_SIZE_SOURCE
 1

	)

229 #ià(
defšed
 
_DEFAULT_SOURCE
 \

230 || (!
defšed
 
	g__STRICT_ANSI__
 \

231 && !
defšed
 
	g_ISOC99_SOURCE
 && !defšed 
	g_ISOC11_SOURCE
 \

232 && !
defšed
 
	g_ISOC2X_SOURCE
 \

233 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

234 && !
defšed
 
	g_XOPEN_SOURCE
))

235 #undeà
_DEFAULT_SOURCE


236 
	#_DEFAULT_SOURCE
 1

	)

240 #ià(
defšed
 
_ISOC2X_SOURCE
 \

241 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ > 201710L))

242 
	#__GLIBC_USE_ISOC2X
 1

	)

244 
	#__GLIBC_USE_ISOC2X
 0

	)

248 #ià(
defšed
 
_ISOC11_SOURCE
 || defšed 
_ISOC2X_SOURCE
 \

249 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

250 
	#__USE_ISOC11
 1

	)

254 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

255 || 
defšed
 
_ISOC2X_SOURCE
 \

256 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

257 
	#__USE_ISOC99
 1

	)

261 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

262 || 
defšed
 
_ISOC2X_SOURCE
 \

263 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

264 
	#__USE_ISOC95
 1

	)

267 #ifdeà
__ılu¥lus


269 #ià
__ılu¥lus
 >= 201703L

270 
	#__USE_ISOC11
 1

	)

274 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


275 
	#__USE_ISOCXX11
 1

	)

276 
	#__USE_ISOC99
 1

	)

283 #ifdeà
_DEFAULT_SOURCE


284 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


285 
	#__USE_POSIX_IMPLICITLY
 1

	)

287 #undeà
_POSIX_SOURCE


288 
	#_POSIX_SOURCE
 1

	)

289 #undeà
_POSIX_C_SOURCE


290 
	#_POSIX_C_SOURCE
 200809L

	)

293 #ià((!
defšed
 
__STRICT_ANSI__
 \

294 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

295 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

296 
	#_POSIX_SOURCE
 1

	)

297 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

298 
	#_POSIX_C_SOURCE
 2

	)

299 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

300 
	#_POSIX_C_SOURCE
 199506L

	)

301 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

302 
	#_POSIX_C_SOURCE
 200112L

	)

304 
	#_POSIX_C_SOURCE
 200809L

	)

306 
	#__USE_POSIX_IMPLICITLY
 1

	)

315 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

316 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

317 
	#_POSIX_SOURCE
 1

	)

318 #undeà
_POSIX_C_SOURCE


319 
	#_POSIX_C_SOURCE
 199506L

	)

322 #ià(
defšed
 
_POSIX_SOURCE
 \

323 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

324 || 
defšed
 
_XOPEN_SOURCE
)

325 
	#__USE_POSIX
 1

	)

328 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


329 
	#__USE_POSIX2
 1

	)

332 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

333 
	#__USE_POSIX199309
 1

	)

336 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

337 
	#__USE_POSIX199506
 1

	)

340 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

341 
	#__USE_XOPEN2K
 1

	)

342 #undeà
__USE_ISOC95


343 
	#__USE_ISOC95
 1

	)

344 #undeà
__USE_ISOC99


345 
	#__USE_ISOC99
 1

	)

348 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

349 
	#__USE_XOPEN2K8
 1

	)

350 #undeà
_ATFILE_SOURCE


351 
	#_ATFILE_SOURCE
 1

	)

354 #ifdef 
_XOPEN_SOURCE


355 
	#__USE_XOPEN
 1

	)

356 #ià(
_XOPEN_SOURCE
 - 0) >= 500

357 
	#__USE_XOPEN_EXTENDED
 1

	)

358 
	#__USE_UNIX98
 1

	)

359 #undeà
_LARGEFILE_SOURCE


360 
	#_LARGEFILE_SOURCE
 1

	)

361 #ià(
_XOPEN_SOURCE
 - 0) >= 600

362 #ià(
_XOPEN_SOURCE
 - 0) >= 700

363 
	#__USE_XOPEN2K8
 1

	)

364 
	#__USE_XOPEN2K8XSI
 1

	)

366 
	#__USE_XOPEN2K
 1

	)

367 
	#__USE_XOPEN2KXSI
 1

	)

368 #undeà
__USE_ISOC95


369 
	#__USE_ISOC95
 1

	)

370 #undeà
__USE_ISOC99


371 
	#__USE_ISOC99
 1

	)

374 #ifdeà
_XOPEN_SOURCE_EXTENDED


375 
	#__USE_XOPEN_EXTENDED
 1

	)

380 #ifdeà
_LARGEFILE_SOURCE


381 
	#__USE_LARGEFILE
 1

	)

384 #ifdeà
_LARGEFILE64_SOURCE


385 
	#__USE_LARGEFILE64
 1

	)

388 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

389 
	#__USE_FILE_OFFSET64
 1

	)

392 
	~<ã©u»s-time64.h
>

394 #ià
defšed
 
_DEFAULT_SOURCE


395 
	#__USE_MISC
 1

	)

398 #ifdef 
_ATFILE_SOURCE


399 
	#__USE_ATFILE
 1

	)

402 #ifdef 
_DYNAMIC_STACK_SIZE_SOURCE


403 
	#__USE_DYNAMIC_STACK_SIZE
 1

	)

406 #ifdef 
_GNU_SOURCE


407 
	#__USE_GNU
 1

	)

410 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0

411 #ià!
defšed
 
__OPTIMIZE__
 || __OPTIMIZE__ <= 0

412 #–ià!
__GNUC_PREREQ
 (4, 1)

413 #–ià
_FORTIFY_SOURCE
 > 2 && (
__glibc_şªg_´”eq
 (9, 0) \

414 || 
	$__GNUC_PREREQ
 (12, 0))

416 #ià
_FORTIFY_SOURCE
 > 3

418 
	#__USE_FORTIFY_LEVEL
 3

	)

419 #–ià
_FORTIFY_SOURCE
 > 1

420 #ià
_FORTIFY_SOURCE
 > 2

422 
	#__USE_FORTIFY_LEVEL
 2

	)

424 
	#__USE_FORTIFY_LEVEL
 1

	)

427 #iâdeà
__USE_FORTIFY_LEVEL


428 
	#__USE_FORTIFY_LEVEL
 0

	)

435 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


436 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

438 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

453 #ià(
defšed
 
__USE_GNU
 \

454 && (
defšed
 
__ılu¥lus
 \

455 ? (
__ılu¥lus
 < 201103L && !
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
) \

456 : (!
defšed
 
__STDC_VERSION__
 || __STDC_VERSION__ < 199901L)))

457 
	#__GLIBC_USE_DEPRECATED_SCANF
 1

	)

459 
	#__GLIBC_USE_DEPRECATED_SCANF
 0

	)

464 
	~<¡dc-´edef.h
>

472 #undeà
__GNU_LIBRARY__


473 
	#__GNU_LIBRARY__
 6

	)

477 
	#__GLIBC__
 2

	)

478 
	#__GLIBC_MINOR__
 35

	)

480 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

481 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

484 #iâdeà
__ASSEMBLER__


485 #iâdeà
_SYS_CDEFS_H


486 
	~<sys/cdefs.h
>

491 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


492 
	#__USE_LARGEFILE
 1

	)

493 
	#__USE_LARGEFILE64
 1

	)

499 #ià
	`__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

500 && !
defšed
 
__OPTIMIZE_SIZE__
 && !defšed 
__NO_INLINE__
 \

501 && 
defšed
 
__ex‹º_šlše


502 
	#__USE_EXTERN_INLINES
 1

	)

510 
	~<gnu/¡ubs.h
>

	@/usr/include/features-time64.h

20 
	~<b™s/wÜdsize.h
>

21 
	~<b™s/timesize.h
>

23 #ià
defšed
 
_TIME_BITS


24 #ià
_TIME_BITS
 == 64

25 #ià! 
defšed
 (
_FILE_OFFSET_BITS
) || _FILE_OFFSET_BITS != 64

27 #–ià
__TIMESIZE
 == 32

28 
	#__USE_TIME_BITS64
 1

	)

30 #–ià
_TIME_BITS
 == 32

31 #ià
__TIMESIZE
 > 32

35 #”rÜ 
Inv®id
 
_TIME_BITS
 
v®ue
 (
ÿn
 
Úly
 
be
 32 
Ü
 64-
b™
)

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

39 
	#__STDC_IEC_60559_BFP__
 201404L

	)

42 
	#__STDC_IEC_559__
 1

	)

43 
	#__STDC_IEC_60559_BFP__
 201404L

	)

46 #ifdeà
__GCC_IEC_559_COMPLEX


47 #ià
__GCC_IEC_559_COMPLEX
 > 0

48 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_60559_COMPLEX__
 201404L

	)

52 
	#__STDC_IEC_559_COMPLEX__
 1

	)

53 
	#__STDC_IEC_60559_COMPLEX__
 201404L

	)

62 
	#__STDC_ISO_10646__
 201706L

	)

	@
1
.
1
/usr/include
118
1752
aead_api.c
aead_api.h
aes_ccm.h
aes_cmac.c
aes_cmac.h
aes_gcm.h
aes_gmac.c
aes_gmac.h
agg-rx.c
agg-tx.c
airtime.c
cfg.c
chan.c
debug.h
debugfs.c
debugfs.h
debugfs_key.c
debugfs_key.h
debugfs_netdev.c
debugfs_netdev.h
debugfs_sta.c
debugfs_sta.h
driver-ops.c
driver-ops.h
drop.h
eht.c
ethtool.c
fils_aead.c
fils_aead.h
he.c
ht.c
ibss.c
ieee80211_i.h
iface.c
key.c
key.h
led.c
led.h
link.c
mac80211.mod.c
main.c
mesh.c
mesh.h
mesh_hwmp.c
mesh_pathtbl.c
mesh_plink.c
mesh_ps.c
mesh_sync.c
michael.c
michael.h
mlme.c
ocb.c
offchannel.c
parse.c
pm.c
rate.c
rate.h
rc80211_minstrel_ht.c
rc80211_minstrel_ht.h
rc80211_minstrel_ht_debugfs.c
rx.c
s1g.c
scan.c
spectmgmt.c
sta_info.c
sta_info.h
status.c
tdls.c
tests/elems.c
tests/mfp.c
tests/module.c
tkip.c
tkip.h
trace.c
trace.h
trace_msg.h
tx.c
util.c
vht.c
wbrf.c
wep.c
wep.h
wme.c
wme.h
wpa.c
wpa.h
/usr/include/linux/if.h
/usr/include/linux/if_arp.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_vlan.h
/usr/include/linux/kcov.h
/usr/include/linux/kernel.h
/usr/include/linux/module.h
/usr/include/linux/netdevice.h
/usr/include/linux/nl80211.h
/usr/include/linux/random.h
/usr/include/linux/rtnetlink.h
/usr/include/linux/string.h
/usr/include/linux/types.h
/usr/include/linux/const.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/if_addr.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/ioctl.h
/usr/include/linux/irqnr.h
/usr/include/linux/libc-compat.h
/usr/include/linux/neighbour.h
/usr/include/linux/netlink.h
/usr/include/linux/posix_types.h
/usr/include/linux/socket.h
/usr/include/linux/sysinfo.h
/usr/include/string.h
/usr/include/linux/stddef.h
/usr/include/strings.h
/usr/include/features.h
/usr/include/features-time64.h
/usr/include/stdc-predef.h
